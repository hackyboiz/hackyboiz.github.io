

<!DOCTYPE html>
<html lang="ko-KR" data-default-color-scheme="&#34;auto&#34;">



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/favicon.ico">
  <link rel="icon" type="image/png" href="/img/favicon.ico">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="description" content="&lt;h1 id=&#34;Introduction&#34;&gt;&lt;a href=&#34;#Introduction&#34; class=&#34;headerlink&#34; title=&#34;Introduction&#34;&gt;&lt;/a&gt;Introduction&lt;/h1&gt;&lt;p&gt;Hello, this is &lt;strong&gt;pwndorei&lt;/strong&gt;&amp;#x2026; Since I started working at a company around last September, I&amp;#x2019;ve stopped writing research posts for a while, but now I can&amp;#x2019;t avoid it anymore so I&amp;#x2019;m back &amp;#x1F926;&amp;#x1F3FB;&amp;#x200D;&amp;#x2642;&amp;#xFE0F;. However, aside from work, I don&amp;#x2019;t really have anything I&amp;#x2019;m researching, so no topic came to mind that was worth writing about.&lt;br&gt;So I decided to simply present a JavaScript script that&amp;#x2019;s handy when analyzing with WinDbg. All right, let&amp;#x2019;s go!&lt;/p&gt;
&lt;h1 id=&#34;Windbg-Script-&amp;#x21D2;&#34;&gt;&lt;a href=&#34;#Windbg-Script-&amp;#x21D2;&#34; class=&#34;headerlink&#34; title=&#34;Windbg + Script &amp;#x21D2; ?&#34;&gt;&lt;/a&gt;Windbg + Script &amp;#x21D2; ?&lt;/h1&gt;&lt;p&gt;Using a script for debugging? The goal is one and the same&amp;#x2014;to debug lazily.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/2025/06/01/pwndorei/windbg_js_en/image.png&#34; alt=&#34;image.png&#34;&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;del&gt;It&amp;#x2019;s absolutely &lt;em&gt;not&lt;/em&gt; about working hard in advance so you can relax later&lt;/del&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Of course, you &lt;em&gt;can&lt;/em&gt; carefully &lt;code&gt;dq&lt;/code&gt;, &lt;code&gt;dd&lt;/code&gt;, etc. every single time to check what data lives in a crazy-looking data structure. And with TTD, even if you accidentally step over an important call, you don&amp;#x2019;t have to relaunch the process, so you can just smash &lt;strong&gt;F10&lt;/strong&gt; mindlessly while analyzing.&lt;br&gt;But! The larger the data gets, the less time it takes to write a script instead of doing it by hand, and if you rely on TTD too much you&amp;#x2019;ll turn into a fool.&lt;br&gt;So today, with a simple example, we&amp;#x2019;ll see how to use scripts effectively&amp;#x2014;and as a bonus I&amp;#x2019;ll also show you how to push TTD to the limit.&lt;/p&gt;
&lt;h1 id=&#34;Windbg-Script-Basic&#34;&gt;&lt;a href=&#34;#Windbg-Script-Basic&#34; class=&#34;headerlink&#34; title=&#34;Windbg Script Basic&#34;&gt;&lt;/a&gt;Windbg Script Basic&lt;/h1&gt;&lt;p&gt;In WinDbg you can create a new script or load an existing one from the &lt;strong&gt;Scripting&lt;/strong&gt; menu, like below. Besides JavaScript there&amp;#x2019;s something called &lt;strong&gt;NatVis&lt;/strong&gt;, but since we&amp;#x2019;re going to use JavaScript we&amp;#x2019;ll just ignore that.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/2025/06/01/pwndorei/windbg_js_en/image%201.png&#34; alt=&#34;image.png&#34;&gt;&lt;/p&gt;
&lt;p&gt;Next, in &lt;strong&gt;New Script&lt;/strong&gt; you choose between &lt;strong&gt;Extension&lt;/strong&gt; and &lt;strong&gt;Imperative&lt;/strong&gt;; it&amp;#x2019;s merely a difference in the default template.&lt;/p&gt;
&lt;p&gt;For &lt;strong&gt;Imperative&lt;/strong&gt;, the following boilerplate code is generated:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;hljs jsx&#34;&gt;&lt;span class=&#34;hljs-meta&#34;&gt;&amp;quot;use strict&amp;quot;&lt;/span&gt;;

&lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;function&lt;/span&gt; &lt;span class=&#34;hljs-title&#34;&gt;initializeScript&lt;/span&gt;(&lt;span class=&#34;hljs-params&#34;&gt;&lt;/span&gt;)&lt;/span&gt;
&lt;span class=&#34;hljs-function&#34;&gt;&lt;/span&gt;{
    &lt;span class=&#34;hljs-keyword&#34;&gt;return&lt;/span&gt; [&lt;span class=&#34;hljs-keyword&#34;&gt;new&lt;/span&gt; host.apiVersionSupport(&lt;span class=&#34;hljs-number&#34;&gt;1&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;9&lt;/span&gt;)];
}

&lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;function&lt;/span&gt; &lt;span class=&#34;hljs-title&#34;&gt;invokeScript&lt;/span&gt;(&lt;span class=&#34;hljs-params&#34;&gt;&lt;/span&gt;)&lt;/span&gt;
&lt;span class=&#34;hljs-function&#34;&gt;&lt;/span&gt;{
    &lt;span class=&#34;hljs-comment&#34;&gt;//&lt;/span&gt;
    &lt;span class=&#34;hljs-comment&#34;&gt;// Insert your script content here.  This method will be called whenever the script is&lt;/span&gt;
    &lt;span class=&#34;hljs-comment&#34;&gt;// invoked from a client.&lt;/span&gt;
    &lt;span class=&#34;hljs-comment&#34;&gt;//&lt;/span&gt;
    &lt;span class=&#34;hljs-comment&#34;&gt;// See the following for more details:&lt;/span&gt;
    &lt;span class=&#34;hljs-comment&#34;&gt;//&lt;/span&gt;
    &lt;span class=&#34;hljs-comment&#34;&gt;//     https://aka.ms/JsDbgExt&lt;/span&gt;
    &lt;span class=&#34;hljs-comment&#34;&gt;//&lt;/span&gt;
}&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;You can run it by pressing &lt;strong&gt;Execute&lt;/strong&gt; in &lt;strong&gt;Actions&lt;/strong&gt; or with commands such as &lt;code&gt;.scriptrun&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/2025/06/01/pwndorei/windbg_js_en/image%202.png&#34; alt=&#34;image.png&#34;&gt;&lt;/p&gt;
&lt;p&gt;For &lt;strong&gt;Extension&lt;/strong&gt;, it&amp;#x2019;s used literally to add extension functionality, and this template appears:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;hljs jsx&#34;&gt;&lt;span class=&#34;hljs-meta&#34;&gt;&amp;quot;use strict&amp;quot;&lt;/span&gt;;

&lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;function&lt;/span&gt; &lt;span class=&#34;hljs-title&#34;&gt;initializeScript&lt;/span&gt;(&lt;span class=&#34;hljs-params&#34;&gt;&lt;/span&gt;)&lt;/span&gt;
&lt;span class=&#34;hljs-function&#34;&gt;&lt;/span&gt;{
    &lt;span class=&#34;hljs-comment&#34;&gt;//&lt;/span&gt;
    &lt;span class=&#34;hljs-comment&#34;&gt;// Return an array of registration objects to modify the object model of the debugger&lt;/span&gt;
    &lt;span class=&#34;hljs-comment&#34;&gt;// See the following for more details:&lt;/span&gt;
    &lt;span class=&#34;hljs-comment&#34;&gt;//&lt;/span&gt;
    &lt;span class=&#34;hljs-comment&#34;&gt;//     https://aka.ms/JsDbgExt&lt;/span&gt;
    &lt;span class=&#34;hljs-comment&#34;&gt;//&lt;/span&gt;
    &lt;span class=&#34;hljs-keyword&#34;&gt;return&lt;/span&gt; [&lt;span class=&#34;hljs-keyword&#34;&gt;new&lt;/span&gt; host.apiVersionSupport(&lt;span class=&#34;hljs-number&#34;&gt;1&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;9&lt;/span&gt;)];
}&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Extensions added through a script can be invoked in WinDbg with a command like &lt;code&gt;!extname&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;We&amp;#x2019;ll see what functions we can implement through examples later, but first a few more script-related commands:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;p&gt;&lt;code&gt;.scriptlist&lt;/code&gt;&lt;br&gt;Shows all currently loaded scripts.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;hljs routeros&#34;&gt;0:038&amp;gt; .scriptlist
Command Loaded Scripts:
        &lt;span class=&#34;hljs-built_in&#34;&gt;..&lt;/span&gt;.
    JavaScript&lt;span class=&#34;hljs-built_in&#34;&gt; script &lt;/span&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;from&lt;/span&gt; &lt;span class=&#34;hljs-string&#34;&gt;&amp;apos;D:\windbg_Ext\utils.js&amp;apos;&lt;/span&gt;
    JavaScript&lt;span class=&#34;hljs-built_in&#34;&gt; script &lt;/span&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;from&lt;/span&gt; &lt;span class=&#34;hljs-string&#34;&gt;&amp;apos;D:\windbg_Ext\codecov.js&amp;apos;&lt;/span&gt;
    JavaScript&lt;span class=&#34;hljs-built_in&#34;&gt; script &lt;/span&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;from&lt;/span&gt; &lt;span class=&#34;hljs-string&#34;&gt;&amp;apos;C:\Program Files\WindowsApps\Microsoft.WinDbg_1.2504.15001.0_x64__8wekyb3d8bbwe\amd64\winext\ApiExtension\CodeFlow.js&amp;apos;&lt;/span&gt;
Other Clients&lt;span class=&#34;hljs-string&#34;&gt;&amp;apos; Scripts:&lt;/span&gt;
&lt;span class=&#34;hljs-string&#34;&gt;    Script named &amp;apos;&lt;/span&gt;untitled0&lt;span class=&#34;hljs-string&#34;&gt;&amp;apos;&lt;/span&gt;
&lt;span class=&#34;hljs-string&#34;&gt;    Script named &amp;apos;&lt;/span&gt;untitled1&lt;span class=&#34;hljs-string&#34;&gt;&amp;apos;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;&lt;code&gt;.scriptload&lt;/code&gt; &amp;amp; &lt;code&gt;.scriptunload&lt;/code&gt;&lt;br&gt;Commands to load or unload a script.&lt;br&gt;When loading, you can give the full path or just the name; WinDbg searches any directories in the &lt;code&gt;PATH&lt;/code&gt; environment variable.&lt;br&gt;&lt;code&gt;.scriptload&lt;/code&gt; only calls the script&amp;#x2019;s &lt;code&gt;initializeScript&lt;/code&gt; function.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;code&gt;.scriptrun&lt;/code&gt;&lt;br&gt;Unlike &lt;code&gt;.scriptload&lt;/code&gt;, it also calls the &lt;code&gt;invokeScript&lt;/code&gt; function.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;There are two commands&amp;#x2014;&lt;code&gt;.scriptload&lt;/code&gt; and &lt;code&gt;.scriptrun&lt;/code&gt;&amp;#x2014;that execute scripts. If the script is &lt;strong&gt;imperative&lt;/strong&gt;, you need to run &lt;code&gt;invokeScript&lt;/code&gt;, so you use &lt;strong&gt;run&lt;/strong&gt;; if it&amp;#x2019;s an &lt;strong&gt;extension&lt;/strong&gt;, you use &lt;strong&gt;load&lt;/strong&gt;, right?&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/2025/06/01/pwndorei/windbg_js_en/image%203.png&#34; alt=&#34;image.png&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;Hello-World&#34;&gt;&lt;a href=&#34;#Hello-World&#34; class=&#34;headerlink&#34; title=&#34;Hello World&#34;&gt;&lt;/a&gt;Hello World&lt;/h2&gt;&lt;p&gt;We&amp;#x2019;re not learning a &lt;em&gt;new&lt;/em&gt; language, but because we can&amp;#x2019;t use &lt;code&gt;console.log&lt;/code&gt; the way we do in the browser, let&amp;#x2019;s start by printing &amp;#x201C;Hello World&amp;#x201D; to the console.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;hljs jsx&#34;&gt;&lt;span class=&#34;hljs-meta&#34;&gt;&amp;quot;use strict&amp;quot;&lt;/span&gt;;

&lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;function&lt;/span&gt; &lt;span class=&#34;hljs-title&#34;&gt;initializeScript&lt;/span&gt;(&lt;span class=&#34;hljs-params&#34;&gt;&lt;/span&gt;)&lt;/span&gt;
&lt;span class=&#34;hljs-function&#34;&gt;&lt;/span&gt;{
    &lt;span class=&#34;hljs-keyword&#34;&gt;return&lt;/span&gt; [&lt;span class=&#34;hljs-keyword&#34;&gt;new&lt;/span&gt; host.apiVersionSupport(&lt;span class=&#34;hljs-number&#34;&gt;1&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;9&lt;/span&gt;)];
}

&lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;function&lt;/span&gt; &lt;span class=&#34;hljs-title&#34;&gt;invokeScript&lt;/span&gt;(&lt;span class=&#34;hljs-params&#34;&gt;&lt;/span&gt;)&lt;/span&gt;
&lt;span class=&#34;hljs-function&#34;&gt;&lt;/span&gt;{
    host.diagnostics.debugLog(&lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;Hello World!\n&amp;quot;&lt;/span&gt;)
}&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;As you can see, you use &lt;code&gt;host.diagnostics.debugLog&lt;/code&gt; instead of &lt;code&gt;console.log&lt;/code&gt;. If you run it, it prints normally.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/2025/06/01/pwndorei/windbg_js_en/image%204.png&#34; alt=&#34;image.png&#34;&gt;&lt;/p&gt;
&lt;p&gt;Since I have no intention of typing that code every time I need to log, let&amp;#x2019;s make an alias and use that instead &amp;#x1F923;&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;hljs jsx&#34;&gt;&lt;span class=&#34;hljs-meta&#34;&gt;&amp;quot;use strict&amp;quot;&lt;/span&gt;;

&lt;span class=&#34;hljs-keyword&#34;&gt;const&lt;/span&gt; log = &lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-params&#34;&gt;x&lt;/span&gt; =&amp;gt;&lt;/span&gt; host.diagnostics.debugLog(x)

&lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;function&lt;/span&gt; &lt;span class=&#34;hljs-title&#34;&gt;initializeScript&lt;/span&gt;(&lt;span class=&#34;hljs-params&#34;&gt;&lt;/span&gt;)&lt;/span&gt;
&lt;span class=&#34;hljs-function&#34;&gt;&lt;/span&gt;{
    &lt;span class=&#34;hljs-keyword&#34;&gt;return&lt;/span&gt; [&lt;span class=&#34;hljs-keyword&#34;&gt;new&lt;/span&gt; host.apiVersionSupport(&lt;span class=&#34;hljs-number&#34;&gt;1&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;9&lt;/span&gt;)];
}

&lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;function&lt;/span&gt; &lt;span class=&#34;hljs-title&#34;&gt;invokeScript&lt;/span&gt;(&lt;span class=&#34;hljs-params&#34;&gt;&lt;/span&gt;)&lt;/span&gt;
&lt;span class=&#34;hljs-function&#34;&gt;&lt;/span&gt;{
    log(&lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;Hello World!\n&amp;quot;&lt;/span&gt;)
}&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;Read-amp-Write-Memory&#34;&gt;&lt;a href=&#34;#Read-amp-Write-Memory&#34; class=&#34;headerlink&#34; title=&#34;Read &amp;amp; Write Memory&#34;&gt;&lt;/a&gt;Read &amp;amp; Write Memory&lt;/h2&gt;&lt;p&gt;We&amp;#x2019;re not going to write scripts just to print &amp;#x201C;Hello World&amp;#x201D;, right? &lt;code&gt;host.memory&lt;/code&gt; has the following functions, which let you read and write data in memory:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;readMemoryValues&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;readWideString&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;readString&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;writeMemoryValues&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;For today, knowing this much is plenty!&lt;/p&gt;
&lt;h1 id=&#34;Practice&#34;&gt;&lt;a href=&#34;#Practice&#34; class=&#34;headerlink&#34; title=&#34;Practice&#34;&gt;&lt;/a&gt;Practice&lt;/h1&gt;&lt;p&gt;Now let&amp;#x2019;s debug a sample program and see in what situations a script is useful.&lt;/p&gt;
&lt;h2 id=&#34;1-Dump-Data-Structure&#34;&gt;&lt;a href=&#34;#1-Dump-Data-Structure&#34; class=&#34;headerlink&#34; title=&#34;1. Dump Data Structure&#34;&gt;&lt;/a&gt;1. Dump Data Structure&lt;/h2&gt;&lt;p&gt;First up is dumping the data structure we mentioned earlier. ChatGPT made the sample program like this:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;hljs c&#34;&gt;&lt;span class=&#34;hljs-meta&#34;&gt;#&lt;span class=&#34;hljs-meta-keyword&#34;&gt;include&lt;/span&gt; &lt;span class=&#34;hljs-meta-string&#34;&gt;&amp;lt;stdio.h&amp;gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&#34;hljs-meta&#34;&gt;#&lt;span class=&#34;hljs-meta-keyword&#34;&gt;include&lt;/span&gt; &lt;span class=&#34;hljs-meta-string&#34;&gt;&amp;lt;stdlib.h&amp;gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&#34;hljs-meta&#34;&gt;#&lt;span class=&#34;hljs-meta-keyword&#34;&gt;include&lt;/span&gt; &lt;span class=&#34;hljs-meta-string&#34;&gt;&amp;lt;string.h&amp;gt;&lt;/span&gt;&lt;/span&gt;

&lt;span class=&#34;hljs-keyword&#34;&gt;typedef&lt;/span&gt; &lt;span class=&#34;hljs-class&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;hljs-title&#34;&gt;Node&lt;/span&gt; {&lt;/span&gt;
    &lt;span class=&#34;hljs-keyword&#34;&gt;char&lt;/span&gt;* word;
    &lt;span class=&#34;hljs-class&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;hljs-title&#34;&gt;Node&lt;/span&gt;* &lt;span class=&#34;hljs-title&#34;&gt;left&lt;/span&gt;;&lt;/span&gt;
    &lt;span class=&#34;hljs-class&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;hljs-title&#34;&gt;Node&lt;/span&gt;* &lt;span class=&#34;hljs-title&#34;&gt;right&lt;/span&gt;;&lt;/span&gt;
} Node;

&lt;span class=&#34;hljs-function&#34;&gt;Node* &lt;span class=&#34;hljs-title&#34;&gt;createNode&lt;/span&gt;&lt;span class=&#34;hljs-params&#34;&gt;(&lt;span class=&#34;hljs-keyword&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;hljs-keyword&#34;&gt;char&lt;/span&gt;* word)&lt;/span&gt; &lt;/span&gt;{
    Node* newNode = (Node*)&lt;span class=&#34;hljs-built_in&#34;&gt;malloc&lt;/span&gt;(&lt;span class=&#34;hljs-keyword&#34;&gt;sizeof&lt;/span&gt;(Node));
    &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; (!newNode) &lt;span class=&#34;hljs-keyword&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;hljs-literal&#34;&gt;NULL&lt;/span&gt;;

    newNode-&amp;gt;word = _strdup(word);
    newNode-&amp;gt;left = &lt;span class=&#34;hljs-literal&#34;&gt;NULL&lt;/span&gt;;
    newNode-&amp;gt;right = &lt;span class=&#34;hljs-literal&#34;&gt;NULL&lt;/span&gt;;
    &lt;span class=&#34;hljs-keyword&#34;&gt;return&lt;/span&gt; newNode;
}

&lt;span class=&#34;hljs-function&#34;&gt;Node* &lt;span class=&#34;hljs-title&#34;&gt;insert&lt;/span&gt;&lt;span class=&#34;hljs-params&#34;&gt;(Node* root, &lt;span class=&#34;hljs-keyword&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;hljs-keyword&#34;&gt;char&lt;/span&gt;* word)&lt;/span&gt; &lt;/span&gt;{
    &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; (root == &lt;span class=&#34;hljs-literal&#34;&gt;NULL&lt;/span&gt;) {
        &lt;span class=&#34;hljs-keyword&#34;&gt;return&lt;/span&gt; createNode(word);
    }

    &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; (&lt;span class=&#34;hljs-built_in&#34;&gt;strcmp&lt;/span&gt;(word, root-&amp;gt;word) &amp;lt; &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;) {
        root-&amp;gt;left = insert(root-&amp;gt;left, word);
    } &lt;span class=&#34;hljs-keyword&#34;&gt;else&lt;/span&gt; &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; (&lt;span class=&#34;hljs-built_in&#34;&gt;strcmp&lt;/span&gt;(word, root-&amp;gt;word) &amp;gt; &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;) {
        root-&amp;gt;right = insert(root-&amp;gt;right, word);
    }
    &lt;span class=&#34;hljs-keyword&#34;&gt;return&lt;/span&gt; root;
}

&lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;hljs-title&#34;&gt;inorderTraversal&lt;/span&gt;&lt;span class=&#34;hljs-params&#34;&gt;(Node* root)&lt;/span&gt; &lt;/span&gt;{
    &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; (root != &lt;span class=&#34;hljs-literal&#34;&gt;NULL&lt;/span&gt;) {
        inorderTraversal(root-&amp;gt;left);
        &lt;span class=&#34;hljs-built_in&#34;&gt;printf&lt;/span&gt;(&lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;%s\n&amp;quot;&lt;/span&gt;, root-&amp;gt;word);
        inorderTraversal(root-&amp;gt;right);
    }
}

&lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;hljs-title&#34;&gt;freeTree&lt;/span&gt;&lt;span class=&#34;hljs-params&#34;&gt;(Node* root)&lt;/span&gt; &lt;/span&gt;{
    &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; (root != &lt;span class=&#34;hljs-literal&#34;&gt;NULL&lt;/span&gt;) {
        freeTree(root-&amp;gt;left);
        freeTree(root-&amp;gt;right);
        &lt;span class=&#34;hljs-built_in&#34;&gt;free&lt;/span&gt;(root-&amp;gt;word);
        &lt;span class=&#34;hljs-built_in&#34;&gt;free&lt;/span&gt;(root);
    }
}

&lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;hljs-title&#34;&gt;main&lt;/span&gt;&lt;span class=&#34;hljs-params&#34;&gt;()&lt;/span&gt; &lt;/span&gt;{
    &lt;span class=&#34;hljs-keyword&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;hljs-keyword&#34;&gt;char&lt;/span&gt;* words[&lt;span class=&#34;hljs-number&#34;&gt;10&lt;/span&gt;] = {
        &lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;banana&amp;quot;&lt;/span&gt;, &lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;apple&amp;quot;&lt;/span&gt;, &lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;grape&amp;quot;&lt;/span&gt;, &lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;orange&amp;quot;&lt;/span&gt;, &lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;kiwi&amp;quot;&lt;/span&gt;,
        &lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;peach&amp;quot;&lt;/span&gt;, &lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;lemon&amp;quot;&lt;/span&gt;, &lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;mango&amp;quot;&lt;/span&gt;, &lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;cherry&amp;quot;&lt;/span&gt;, &lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;melon&amp;quot;&lt;/span&gt;
    };

    Node* root = &lt;span class=&#34;hljs-literal&#34;&gt;NULL&lt;/span&gt;;

    &lt;span class=&#34;hljs-keyword&#34;&gt;for&lt;/span&gt; (&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; i = &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;; i &amp;lt; &lt;span class=&#34;hljs-number&#34;&gt;10&lt;/span&gt;; i++) {
        root = insert(root, words[i]);
    }

    &lt;span class=&#34;hljs-built_in&#34;&gt;printf&lt;/span&gt;(&lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;Address of root node: %p\n&amp;quot;&lt;/span&gt;, (&lt;span class=&#34;hljs-keyword&#34;&gt;void&lt;/span&gt;*)root);

    &lt;span class=&#34;hljs-built_in&#34;&gt;printf&lt;/span&gt;(&lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;Press Enter to exit...&amp;quot;&lt;/span&gt;);
    getchar();

    freeTree(root);
    &lt;span class=&#34;hljs-keyword&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;;
}&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;It&amp;#x2019;s simple code that stores strings in a binary tree in order. It prints the root node&amp;#x2019;s address and waits for console input. We can attach the debugger and write a script that traverses the tree to print the data.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/2025/06/01/pwndorei/windbg_js_en/image%205.png&#34; alt=&#34;image.png&#34;&gt;&lt;/p&gt;
&lt;p&gt;A &lt;code&gt;Node&lt;/code&gt; is a 0x18-byte structure with three pointer fields, so I defined &lt;code&gt;getNode&lt;/code&gt; like this:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;hljs jsx&#34;&gt;&lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;function&lt;/span&gt; &lt;span class=&#34;hljs-title&#34;&gt;getNode&lt;/span&gt;(&lt;span class=&#34;hljs-params&#34;&gt;addr&lt;/span&gt;)&lt;/span&gt;{
    &lt;span class=&#34;hljs-keyword&#34;&gt;var&lt;/span&gt; node = host.memory.readMemoryValues(addr, &lt;span class=&#34;hljs-number&#34;&gt;3&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;8&lt;/span&gt;)
    &lt;span class=&#34;hljs-keyword&#34;&gt;return&lt;/span&gt; {
        &lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;word&amp;quot;&lt;/span&gt;: node[&lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;],
        &lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;left&amp;quot;&lt;/span&gt;: node[&lt;span class=&#34;hljs-number&#34;&gt;1&lt;/span&gt;],
        &lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;right&amp;quot;&lt;/span&gt;: node[&lt;span class=&#34;hljs-number&#34;&gt;2&lt;/span&gt;]
    }
}&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Reading memory is done with &lt;code&gt;host.memory.readMemoryValues&lt;/code&gt;. As you can guess from the parameters, it reads 3 elements (second parameter) of 8 bytes each (third parameter, &lt;code&gt;elementSize&lt;/code&gt;) starting at &lt;code&gt;addr&lt;/code&gt;. The return value is an array of integers containing the data, and I use it to build a node object.&lt;/p&gt;
&lt;p&gt;Now that we can use the &lt;code&gt;Node&lt;/code&gt; structure stored in memory, we need a traversal function. Below is a simple in-order traversal: given a node returned by &lt;code&gt;getNode&lt;/code&gt;, it reads the string at &lt;code&gt;word&lt;/code&gt; and prints it.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;hljs jsx&#34;&gt;&lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;function&lt;/span&gt; &lt;span class=&#34;hljs-title&#34;&gt;traverse&lt;/span&gt;(&lt;span class=&#34;hljs-params&#34;&gt;node&lt;/span&gt;)&lt;/span&gt;{
    &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt;(node[&lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;left&amp;quot;&lt;/span&gt;] != &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;) traverse(getNode(node[&lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;left&amp;quot;&lt;/span&gt;]))
    log(host.memory.readString(node[&lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;word&amp;quot;&lt;/span&gt;]) + &lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;\n&amp;quot;&lt;/span&gt;)
    &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt;(node[&lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;right&amp;quot;&lt;/span&gt;] != &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;) traverse(getNode(node[&lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;right&amp;quot;&lt;/span&gt;]))
}&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;To read a string, use &lt;code&gt;host.memory.readString&lt;/code&gt; like above. If it were a wide string, you&amp;#x2019;d use &lt;code&gt;readWideString&lt;/code&gt; instead. The full script is:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;hljs jsx&#34;&gt;&lt;span class=&#34;hljs-meta&#34;&gt;&amp;quot;use strict&amp;quot;&lt;/span&gt;;

&lt;span class=&#34;hljs-keyword&#34;&gt;const&lt;/span&gt; log = &lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-params&#34;&gt;x&lt;/span&gt; =&amp;gt;&lt;/span&gt; host.diagnostics.debugLog(x)

&lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;function&lt;/span&gt; &lt;span class=&#34;hljs-title&#34;&gt;initializeScript&lt;/span&gt;(&lt;span class=&#34;hljs-params&#34;&gt;&lt;/span&gt;)&lt;/span&gt;
&lt;span class=&#34;hljs-function&#34;&gt;&lt;/span&gt;{
    &lt;span class=&#34;hljs-keyword&#34;&gt;return&lt;/span&gt; [&lt;span class=&#34;hljs-keyword&#34;&gt;new&lt;/span&gt; host.apiVersionSupport(&lt;span class=&#34;hljs-number&#34;&gt;1&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;9&lt;/span&gt;)];
}

&lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;function&lt;/span&gt; &lt;span class=&#34;hljs-title&#34;&gt;getNode&lt;/span&gt;(&lt;span class=&#34;hljs-params&#34;&gt;addr&lt;/span&gt;)&lt;/span&gt;{
    &lt;span class=&#34;hljs-keyword&#34;&gt;var&lt;/span&gt; node = host.memory.readMemoryValues(addr, &lt;span class=&#34;hljs-number&#34;&gt;3&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;8&lt;/span&gt;)
    &lt;span class=&#34;hljs-keyword&#34;&gt;return&lt;/span&gt; {
        &lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;word&amp;quot;&lt;/span&gt;: node[&lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;],
        &lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;left&amp;quot;&lt;/span&gt;: node[&lt;span class=&#34;hljs-number&#34;&gt;1&lt;/span&gt;],
        &lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;right&amp;quot;&lt;/span&gt;: node[&lt;span class=&#34;hljs-number&#34;&gt;2&lt;/span&gt;]
    }
}

&lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;function&lt;/span&gt; &lt;span class=&#34;hljs-title&#34;&gt;traverse&lt;/span&gt;(&lt;span class=&#34;hljs-params&#34;&gt;node&lt;/span&gt;)&lt;/span&gt;{
    &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt;(node[&lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;left&amp;quot;&lt;/span&gt;] != &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;) traverse(getNode(node[&lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;left&amp;quot;&lt;/span&gt;]))
    log(host.memory.readString(node[&lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;word&amp;quot;&lt;/span&gt;]) + &lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;\n&amp;quot;&lt;/span&gt;)
    &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt;(node[&lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;right&amp;quot;&lt;/span&gt;] != &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;) traverse(getNode(node[&lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;right&amp;quot;&lt;/span&gt;]))
}

&lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;function&lt;/span&gt; &lt;span class=&#34;hljs-title&#34;&gt;invokeScript&lt;/span&gt;(&lt;span class=&#34;hljs-params&#34;&gt;&lt;/span&gt;)&lt;/span&gt;
&lt;span class=&#34;hljs-function&#34;&gt;&lt;/span&gt;{
    traverse(getNode(&lt;span class=&#34;hljs-number&#34;&gt;0x25DD2C211C0&lt;/span&gt;))
}&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;If you want to go beyond simple printing and, say, find the address where specific data is located, just add a condition and print it out:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;hljs jsx&#34;&gt;&lt;span class=&#34;hljs-meta&#34;&gt;&amp;quot;use strict&amp;quot;&lt;/span&gt;;

&lt;span class=&#34;hljs-keyword&#34;&gt;const&lt;/span&gt; log = &lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-params&#34;&gt;x&lt;/span&gt; =&amp;gt;&lt;/span&gt; host.diagnostics.debugLog(x)
&lt;span class=&#34;hljs-keyword&#34;&gt;const&lt;/span&gt; dat = &lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;melon&amp;quot;&lt;/span&gt;

&lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;function&lt;/span&gt; &lt;span class=&#34;hljs-title&#34;&gt;initializeScript&lt;/span&gt;(&lt;span class=&#34;hljs-params&#34;&gt;&lt;/span&gt;)&lt;/span&gt;
&lt;span class=&#34;hljs-function&#34;&gt;&lt;/span&gt;{
    &lt;span class=&#34;hljs-keyword&#34;&gt;return&lt;/span&gt; [&lt;span class=&#34;hljs-keyword&#34;&gt;new&lt;/span&gt; host.apiVersionSupport(&lt;span class=&#34;hljs-number&#34;&gt;1&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;9&lt;/span&gt;)];
}

&lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;function&lt;/span&gt; &lt;span class=&#34;hljs-title&#34;&gt;getNode&lt;/span&gt;(&lt;span class=&#34;hljs-params&#34;&gt;addr&lt;/span&gt;)&lt;/span&gt;{
    &lt;span class=&#34;hljs-keyword&#34;&gt;var&lt;/span&gt; node = host.memory.readMemoryValues(addr, &lt;span class=&#34;hljs-number&#34;&gt;3&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;8&lt;/span&gt;)
    &lt;span class=&#34;hljs-keyword&#34;&gt;return&lt;/span&gt; {
        &lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;word&amp;quot;&lt;/span&gt;: node[&lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;],
        &lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;left&amp;quot;&lt;/span&gt;: node[&lt;span class=&#34;hljs-number&#34;&gt;1&lt;/span&gt;],
        &lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;right&amp;quot;&lt;/span&gt;: node[&lt;span class=&#34;hljs-number&#34;&gt;2&lt;/span&gt;]
    }
}

&lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;function&lt;/span&gt; &lt;span class=&#34;hljs-title&#34;&gt;traverse&lt;/span&gt;(&lt;span class=&#34;hljs-params&#34;&gt;addr&lt;/span&gt;)&lt;/span&gt;{
    &lt;span class=&#34;hljs-keyword&#34;&gt;var&lt;/span&gt; node = getNode(addr)
    &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt;(node[&lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;left&amp;quot;&lt;/span&gt;] != &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;) traverse(node[&lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;left&amp;quot;&lt;/span&gt;])
    &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt;(dat.localeCompare(host.memory.readString(node[&lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;word&amp;quot;&lt;/span&gt;])) == &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;){
        log(&lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;Found at &amp;quot;&lt;/span&gt; + addr.toString(&lt;span class=&#34;hljs-number&#34;&gt;16&lt;/span&gt;) + &lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;\n&amp;quot;&lt;/span&gt;)
    }
    &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt;(node[&lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;right&amp;quot;&lt;/span&gt;] != &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;) traverse(node[&lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;right&amp;quot;&lt;/span&gt;])
}

&lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;function&lt;/span&gt; &lt;span class=&#34;hljs-title&#34;&gt;invokeScript&lt;/span&gt;(&lt;span class=&#34;hljs-params&#34;&gt;&lt;/span&gt;)&lt;/span&gt;
&lt;span class=&#34;hljs-function&#34;&gt;&lt;/span&gt;{
    traverse(&lt;span class=&#34;hljs-number&#34;&gt;0x25DD2C211C0&lt;/span&gt;)
}&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;This script checks whether the string &amp;#x201C;melon&amp;#x201D; is stored, and if so prints its address. Result:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;hljs apache&#34;&gt;&lt;span class=&#34;hljs-attribute&#34;&gt;Found&lt;/span&gt; at &lt;span class=&#34;hljs-number&#34;&gt;25&lt;/span&gt;dd&lt;span class=&#34;hljs-number&#34;&gt;2&lt;/span&gt;c&lt;span class=&#34;hljs-number&#34;&gt;21280&lt;/span&gt;
&lt;span class=&#34;hljs-attribute&#34;&gt;0&lt;/span&gt;:&lt;span class=&#34;hljs-number&#34;&gt;004&lt;/span&gt;&amp;gt; da poi(&lt;span class=&#34;hljs-number&#34;&gt;25&lt;/span&gt;dd&lt;span class=&#34;hljs-number&#34;&gt;2&lt;/span&gt;c&lt;span class=&#34;hljs-number&#34;&gt;21280&lt;/span&gt;)
&lt;span class=&#34;hljs-attribute&#34;&gt;0000025d&lt;/span&gt;`d&lt;span class=&#34;hljs-number&#34;&gt;2&lt;/span&gt;c&lt;span class=&#34;hljs-number&#34;&gt;19360&lt;/span&gt;  &lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;melon&amp;quot;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;2-TTD&#34;&gt;&lt;a href=&#34;#2-TTD&#34; class=&#34;headerlink&#34; title=&#34;2. TTD&#34;&gt;&lt;/a&gt;2. TTD&lt;/h2&gt;&lt;p&gt;We&amp;#x2019;ve used an &lt;strong&gt;imperative&lt;/strong&gt; script, so now it&amp;#x2019;s the &lt;strong&gt;extension&lt;/strong&gt;&amp;#x2019;s turn. For the extension example, here&amp;#x2019;s a simple script I always use with TTD:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;hljs jsx&#34;&gt;&lt;span class=&#34;hljs-meta&#34;&gt;&amp;apos;use strict&amp;apos;&lt;/span&gt;;

&lt;span class=&#34;hljs-keyword&#34;&gt;const&lt;/span&gt; log = host.diagnostics.debugLog;
&lt;span class=&#34;hljs-keyword&#34;&gt;const&lt;/span&gt; logln = &lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-params&#34;&gt;p&lt;/span&gt; =&amp;gt;&lt;/span&gt; host.diagnostics.debugLog(p + &lt;span class=&#34;hljs-string&#34;&gt;&amp;apos;\n&amp;apos;&lt;/span&gt;);
&lt;span class=&#34;hljs-keyword&#34;&gt;const&lt;/span&gt; hex = &lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-params&#34;&gt;p&lt;/span&gt; =&amp;gt;&lt;/span&gt; p.toString(&lt;span class=&#34;hljs-number&#34;&gt;16&lt;/span&gt;);

&lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;function&lt;/span&gt; &lt;span class=&#34;hljs-title&#34;&gt;__calls&lt;/span&gt;(&lt;span class=&#34;hljs-params&#34;&gt;...args&lt;/span&gt;)&lt;/span&gt;{
	&lt;span class=&#34;hljs-keyword&#34;&gt;return&lt;/span&gt; host.currentSession.TTD.Calls(...args)
}

&lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;function&lt;/span&gt; &lt;span class=&#34;hljs-title&#34;&gt;__memory&lt;/span&gt;(&lt;span class=&#34;hljs-params&#34;&gt;...args&lt;/span&gt;)&lt;/span&gt;{
	&lt;span class=&#34;hljs-keyword&#34;&gt;return&lt;/span&gt; host.currentSession.TTD.Memory(...args)
}

&lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;function&lt;/span&gt; &lt;span class=&#34;hljs-title&#34;&gt;__memoryforpositionrange&lt;/span&gt;(&lt;span class=&#34;hljs-params&#34;&gt;...args&lt;/span&gt;)&lt;/span&gt;
&lt;span class=&#34;hljs-function&#34;&gt;&lt;/span&gt;{
	&lt;span class=&#34;hljs-keyword&#34;&gt;return&lt;/span&gt; host.currentSession.TTD.MemoryForPositionRange(...args);
}

&lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;function&lt;/span&gt; &lt;span class=&#34;hljs-title&#34;&gt;ttdParsePosition&lt;/span&gt;(&lt;span class=&#34;hljs-params&#34;&gt;pos&lt;/span&gt;)&lt;/span&gt;{
	&lt;span class=&#34;hljs-keyword&#34;&gt;var&lt;/span&gt; sequence = &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;
	&lt;span class=&#34;hljs-keyword&#34;&gt;var&lt;/span&gt; steps = &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;
	&lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt;(&lt;span class=&#34;hljs-keyword&#34;&gt;typeof&lt;/span&gt;(pos) == &lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;string&amp;quot;&lt;/span&gt;){
		sequence = &lt;span class=&#34;hljs-built_in&#34;&gt;parseInt&lt;/span&gt;(pos.split(&lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;:&amp;quot;&lt;/span&gt;)[&lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;], &lt;span class=&#34;hljs-number&#34;&gt;16&lt;/span&gt;)
		steps = &lt;span class=&#34;hljs-built_in&#34;&gt;parseInt&lt;/span&gt;(pos.split(&lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;:&amp;quot;&lt;/span&gt;)[&lt;span class=&#34;hljs-number&#34;&gt;1&lt;/span&gt;], &lt;span class=&#34;hljs-number&#34;&gt;16&lt;/span&gt;)
	}
	&lt;span class=&#34;hljs-keyword&#34;&gt;else&lt;/span&gt;{
		sequence = pos.Sequence
		steps = pos.Steps
	}

	&lt;span class=&#34;hljs-keyword&#34;&gt;return&lt;/span&gt; {
		Sequence: sequence,
		Steps: steps
	}
}

&lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;function&lt;/span&gt; &lt;span class=&#34;hljs-title&#34;&gt;__ttd_position_compare&lt;/span&gt;(&lt;span class=&#34;hljs-params&#34;&gt;pos1, pos2&lt;/span&gt;)&lt;/span&gt;{
	&lt;span class=&#34;hljs-comment&#34;&gt;/*&lt;/span&gt;
&lt;span class=&#34;hljs-comment&#34;&gt;	alias: poscmp&lt;/span&gt;
&lt;span class=&#34;hljs-comment&#34;&gt;	parameters:&lt;/span&gt;
&lt;span class=&#34;hljs-comment&#34;&gt;		pos1 &amp;amp; pos2: Position object or string(Sequence:Steps in hexadicimal)&lt;/span&gt;
&lt;span class=&#34;hljs-comment&#34;&gt;	usage:&lt;/span&gt;
&lt;span class=&#34;hljs-comment&#34;&gt;		&amp;gt; !poscmp(pos1, pos2)&lt;/span&gt;
&lt;span class=&#34;hljs-comment&#34;&gt;		&amp;gt; dx @$poscmp(pos1, pos2)&lt;/span&gt;
&lt;span class=&#34;hljs-comment&#34;&gt;	example:&lt;/span&gt;
&lt;span class=&#34;hljs-comment&#34;&gt;		&amp;gt; dx @$calls(&amp;quot;function&amp;quot;).Where(x =&amp;gt; @$poscmp(&amp;quot;17C83A:1777&amp;quot;, x.TimeStart) &amp;lt; 0).Where(x =&amp;gt; @$poscmp(&amp;quot;17C861:1B3A&amp;quot;, x.TimeEnd) &amp;gt; 0)&lt;/span&gt;
&lt;span class=&#34;hljs-comment&#34;&gt;		=&amp;gt; get all `function` calls between 17C83A:1777 and 17C861:1B3A&lt;/span&gt;
&lt;span class=&#34;hljs-comment&#34;&gt;	*/&lt;/span&gt;

	pos1 = ttdParsePosition(pos1)
	pos2 = ttdParsePosition(pos2)

	&lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt;(pos1.Sequence != pos2.Sequence){
		&lt;span class=&#34;hljs-keyword&#34;&gt;return&lt;/span&gt; pos1.Sequence - pos2.Sequence
	}

	&lt;span class=&#34;hljs-keyword&#34;&gt;return&lt;/span&gt; pos1.Steps - pos2.Steps
	
}

&lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;function&lt;/span&gt; &lt;span class=&#34;hljs-title&#34;&gt;__d&lt;/span&gt;(&lt;span class=&#34;hljs-params&#34;&gt;...args&lt;/span&gt;)&lt;/span&gt;{
	&lt;span class=&#34;hljs-keyword&#34;&gt;return&lt;/span&gt; host.memory.readMemoryValues(...args)
}

&lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;function&lt;/span&gt; &lt;span class=&#34;hljs-title&#34;&gt;initializeScript&lt;/span&gt;(&lt;span class=&#34;hljs-params&#34;&gt;&lt;/span&gt;) &lt;/span&gt;{
    &lt;span class=&#34;hljs-keyword&#34;&gt;return&lt;/span&gt; [
        &lt;span class=&#34;hljs-keyword&#34;&gt;new&lt;/span&gt; host.apiVersionSupport(&lt;span class=&#34;hljs-number&#34;&gt;1&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;2&lt;/span&gt;),
        &lt;span class=&#34;hljs-keyword&#34;&gt;new&lt;/span&gt; host.functionAlias(
            __calls,
            &lt;span class=&#34;hljs-string&#34;&gt;&amp;apos;calls&amp;apos;&lt;/span&gt;
        ),
		&lt;span class=&#34;hljs-keyword&#34;&gt;new&lt;/span&gt; host.functionAlias(
			__memory,
			&lt;span class=&#34;hljs-string&#34;&gt;&amp;apos;memory&amp;apos;&lt;/span&gt;
		),
		&lt;span class=&#34;hljs-keyword&#34;&gt;new&lt;/span&gt; host.functionAlias(
			__memoryforpositionrange,
			&lt;span class=&#34;hljs-string&#34;&gt;&amp;apos;memoryrange&amp;apos;&lt;/span&gt;
		),
		&lt;span class=&#34;hljs-keyword&#34;&gt;new&lt;/span&gt; host.functionAlias(
			__ttd_position_compare,
			&lt;span class=&#34;hljs-string&#34;&gt;&amp;apos;poscmp&amp;apos;&lt;/span&gt;
		),
		&lt;span class=&#34;hljs-keyword&#34;&gt;new&lt;/span&gt; host.functionAlias(
			__d,
			&lt;span class=&#34;hljs-string&#34;&gt;&amp;apos;d&amp;apos;&lt;/span&gt;
		)
    ];
}&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;See the main difference from an &lt;strong&gt;imperative&lt;/strong&gt; script? In &lt;code&gt;initializeScript&lt;/code&gt; I create aliases with &lt;code&gt;host.functionAlias&lt;/code&gt;. An extension registers JavaScript functions as aliases so they can be used directly at the command line.&lt;/p&gt;
&lt;p&gt;I shorten the frequently used &lt;code&gt;@$cursession.TTD.Calls&lt;/code&gt; and &lt;code&gt;@$cursession.TTD.Memory&lt;/code&gt; to &lt;code&gt;@$calls&lt;/code&gt; and &lt;code&gt;@$memory&lt;/code&gt; to save my fingers &amp;#x1F60E;&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;hljs jsx&#34;&gt;&lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;function&lt;/span&gt; &lt;span class=&#34;hljs-title&#34;&gt;__calls&lt;/span&gt;(&lt;span class=&#34;hljs-params&#34;&gt;...args&lt;/span&gt;)&lt;/span&gt;{
	&lt;span class=&#34;hljs-keyword&#34;&gt;return&lt;/span&gt; host.currentSession.TTD.Calls(...args)
}

&lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;function&lt;/span&gt; &lt;span class=&#34;hljs-title&#34;&gt;__memory&lt;/span&gt;(&lt;span class=&#34;hljs-params&#34;&gt;...args&lt;/span&gt;)&lt;/span&gt;{
	&lt;span class=&#34;hljs-keyword&#34;&gt;return&lt;/span&gt; host.currentSession.TTD.Memory(...args)
}&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;So where do we use this?&lt;/p&gt;
&lt;h3 id=&#34;TTD-Calls-amp-Memory&#34;&gt;&lt;a href=&#34;#TTD-Calls-amp-Memory&#34; class=&#34;headerlink&#34; title=&#34;TTD Calls &amp;amp; Memory&#34;&gt;&lt;/a&gt;TTD Calls &amp;amp; Memory&lt;/h3&gt;&lt;p&gt;&lt;a href=&#34;https://hackyboiz.github.io/2021/03/14/fabu1ous/ttd-3/#Filtering-in-a-query&#34;&gt;The Time-Traveling Hacker&amp;#x2019;s Guide&lt;/a&gt; by Fabu1ous briefly explains Calls and Memory, but only skims over what you can do. Let&amp;#x2019;s see how to use them through an example.&lt;/p&gt;
&lt;p&gt;First, load the extension with the script below:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;hljs routeros&#34;&gt;0:038&amp;gt; .scriptload utils.js
JavaScript&lt;span class=&#34;hljs-built_in&#34;&gt; script &lt;/span&gt;successfully loaded &lt;span class=&#34;hljs-keyword&#34;&gt;from&lt;/span&gt; &lt;span class=&#34;hljs-string&#34;&gt;&amp;apos;D:\windbg_Ext\utils.js&amp;apos;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Then you can access Calls and Memory like this:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;hljs angelscript&#34;&gt;&lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;:&lt;span class=&#34;hljs-number&#34;&gt;000&lt;/span&gt;&amp;gt; !calls &lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;kernelbase!CreateFileW&amp;quot;&lt;/span&gt;
@$calls(&lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;kernelbase!CreateFileW&amp;quot;&lt;/span&gt;)                
    [&lt;span class=&#34;hljs-number&#34;&gt;0x0&lt;/span&gt;]           
    [&lt;span class=&#34;hljs-number&#34;&gt;0x1&lt;/span&gt;]           
    ...
&lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;:&lt;span class=&#34;hljs-number&#34;&gt;000&lt;/span&gt;&amp;gt; dx @$calls(&lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;kernelbase!CreateFileW&amp;quot;&lt;/span&gt;)[&lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;]
@$calls(&lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;kernelbase!CreateFileW&amp;quot;&lt;/span&gt;)[&lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;]                
    EventType        : &lt;span class=&#34;hljs-number&#34;&gt;0x0&lt;/span&gt;
    ThreadId         : &lt;span class=&#34;hljs-number&#34;&gt;0xe5c&lt;/span&gt;
    UniqueThreadId   : &lt;span class=&#34;hljs-number&#34;&gt;0x2&lt;/span&gt;
    TimeStart        : &lt;span class=&#34;hljs-number&#34;&gt;6&lt;/span&gt;F4F:&lt;span class=&#34;hljs-number&#34;&gt;1742&lt;/span&gt; [Time Travel]
    TimeEnd          : &lt;span class=&#34;hljs-number&#34;&gt;6&lt;/span&gt;F57:&lt;span class=&#34;hljs-number&#34;&gt;7E3&lt;/span&gt; [Time Travel]
    Function         : kernelbase!CreateFileW
    FunctionAddress  : &lt;span class=&#34;hljs-number&#34;&gt;0x7ffbf27f05f0&lt;/span&gt;
    ReturnAddress    : &lt;span class=&#34;hljs-number&#34;&gt;0x7ffbf2835846&lt;/span&gt;
    ReturnValue      : &lt;span class=&#34;hljs-number&#34;&gt;0x31c&lt;/span&gt;
    Parameters      
    SystemTimeStart  : Fri May &lt;span class=&#34;hljs-number&#34;&gt;30&lt;/span&gt; &lt;span class=&#34;hljs-number&#34;&gt;2025&lt;/span&gt; &lt;span class=&#34;hljs-number&#34;&gt;09&lt;/span&gt;:&lt;span class=&#34;hljs-number&#34;&gt;13&lt;/span&gt;:&lt;span class=&#34;hljs-number&#34;&gt;24.782&lt;/span&gt;
    SystemTimeEnd    : Fri May &lt;span class=&#34;hljs-number&#34;&gt;30&lt;/span&gt; &lt;span class=&#34;hljs-number&#34;&gt;2025&lt;/span&gt; &lt;span class=&#34;hljs-number&#34;&gt;09&lt;/span&gt;:&lt;span class=&#34;hljs-number&#34;&gt;13&lt;/span&gt;:&lt;span class=&#34;hljs-number&#34;&gt;24.782&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;code&gt;!calls&lt;/code&gt; does not let you directly index the returned array, so I more often use &lt;code&gt;dx @$calls&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Now let&amp;#x2019;s take a TTD recording of the example below and see what we can do.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;hljs c&#34;&gt;&lt;span class=&#34;hljs-meta&#34;&gt;#&lt;span class=&#34;hljs-meta-keyword&#34;&gt;include&lt;/span&gt; &lt;span class=&#34;hljs-meta-string&#34;&gt;&amp;lt;iostream&amp;gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&#34;hljs-meta&#34;&gt;#&lt;span class=&#34;hljs-meta-keyword&#34;&gt;include&lt;/span&gt; &lt;span class=&#34;hljs-meta-string&#34;&gt;&amp;lt;vector&amp;gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&#34;hljs-meta&#34;&gt;#&lt;span class=&#34;hljs-meta-keyword&#34;&gt;include&lt;/span&gt; &lt;span class=&#34;hljs-meta-string&#34;&gt;&amp;lt;memory&amp;gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&#34;hljs-meta&#34;&gt;#&lt;span class=&#34;hljs-meta-keyword&#34;&gt;include&lt;/span&gt; &lt;span class=&#34;hljs-meta-string&#34;&gt;&amp;lt;random&amp;gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&#34;hljs-meta&#34;&gt;#&lt;span class=&#34;hljs-meta-keyword&#34;&gt;include&lt;/span&gt; &lt;span class=&#34;hljs-meta-string&#34;&gt;&amp;lt;cstdlib&amp;gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&#34;hljs-meta&#34;&gt;#&lt;span class=&#34;hljs-meta-keyword&#34;&gt;include&lt;/span&gt; &lt;span class=&#34;hljs-meta-string&#34;&gt;&amp;lt;ctime&amp;gt;&lt;/span&gt;&lt;/span&gt;

&lt;span class=&#34;hljs-comment&#34;&gt;// Base class&lt;/span&gt;
&lt;span class=&#34;hljs-class&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;hljs-title&#34;&gt;BaseProcessor&lt;/span&gt; {&lt;/span&gt;
&lt;span class=&#34;hljs-keyword&#34;&gt;public&lt;/span&gt;:
    &lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;virtual&lt;/span&gt; &lt;span class=&#34;hljs-keyword&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;hljs-title&#34;&gt;process&lt;/span&gt;&lt;span class=&#34;hljs-params&#34;&gt;(&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; value)&lt;/span&gt; &lt;/span&gt;= &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;;
    &lt;span class=&#34;hljs-keyword&#34;&gt;virtual&lt;/span&gt; ~BaseProcessor() = &lt;span class=&#34;hljs-keyword&#34;&gt;default&lt;/span&gt;;
};

&lt;span class=&#34;hljs-comment&#34;&gt;// Derived class with actual behavior&lt;/span&gt;
&lt;span class=&#34;hljs-class&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;hljs-title&#34;&gt;ConcreteProcessor&lt;/span&gt; :&lt;/span&gt; &lt;span class=&#34;hljs-keyword&#34;&gt;public&lt;/span&gt; BaseProcessor {
&lt;span class=&#34;hljs-keyword&#34;&gt;public&lt;/span&gt;:
    &lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;hljs-title&#34;&gt;process&lt;/span&gt;&lt;span class=&#34;hljs-params&#34;&gt;(&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; value)&lt;/span&gt; &lt;span class=&#34;hljs-keyword&#34;&gt;override&lt;/span&gt; &lt;/span&gt;{
        &lt;span class=&#34;hljs-comment&#34;&gt;// Dummy operation to prevent optimization&lt;/span&gt;
        &lt;span class=&#34;hljs-keyword&#34;&gt;volatile&lt;/span&gt; &lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; sink = value;
        (&lt;span class=&#34;hljs-keyword&#34;&gt;void&lt;/span&gt;)sink; &lt;span class=&#34;hljs-comment&#34;&gt;// Prevent unused variable warning&lt;/span&gt;
    }
};

&lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;hljs-title&#34;&gt;main&lt;/span&gt;&lt;span class=&#34;hljs-params&#34;&gt;()&lt;/span&gt; &lt;/span&gt;{
    &lt;span class=&#34;hljs-built_in&#34;&gt;std&lt;/span&gt;::srand(&lt;span class=&#34;hljs-keyword&#34;&gt;static_cast&lt;/span&gt;&amp;lt;&lt;span class=&#34;hljs-keyword&#34;&gt;unsigned&lt;/span&gt; &lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt;&amp;gt;(&lt;span class=&#34;hljs-built_in&#34;&gt;std&lt;/span&gt;::time(&lt;span class=&#34;hljs-literal&#34;&gt;nullptr&lt;/span&gt;)));
    &lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-built_in&#34;&gt;std&lt;/span&gt;::mt19937 &lt;span class=&#34;hljs-title&#34;&gt;rng&lt;/span&gt;&lt;span class=&#34;hljs-params&#34;&gt;(&lt;span class=&#34;hljs-built_in&#34;&gt;std&lt;/span&gt;::random_device{}())&lt;/span&gt;&lt;/span&gt;;
    &lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-built_in&#34;&gt;std&lt;/span&gt;::uniform_int_distribution&amp;lt;&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt;&amp;gt; &lt;span class=&#34;hljs-title&#34;&gt;distIndex&lt;/span&gt;&lt;span class=&#34;hljs-params&#34;&gt;(&lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;9&lt;/span&gt;)&lt;/span&gt;&lt;/span&gt;;
    &lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-built_in&#34;&gt;std&lt;/span&gt;::uniform_int_distribution&amp;lt;&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt;&amp;gt; &lt;span class=&#34;hljs-title&#34;&gt;distValue&lt;/span&gt;&lt;span class=&#34;hljs-params&#34;&gt;(&lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;1000&lt;/span&gt;)&lt;/span&gt;&lt;/span&gt;;

    &lt;span class=&#34;hljs-comment&#34;&gt;// Create at least 10 instances&lt;/span&gt;
    &lt;span class=&#34;hljs-built_in&#34;&gt;std&lt;/span&gt;::&lt;span class=&#34;hljs-built_in&#34;&gt;vector&lt;/span&gt;&amp;lt;&lt;span class=&#34;hljs-built_in&#34;&gt;std&lt;/span&gt;::&lt;span class=&#34;hljs-built_in&#34;&gt;unique_ptr&lt;/span&gt;&amp;lt;BaseProcessor&amp;gt;&amp;gt; processors;
    &lt;span class=&#34;hljs-keyword&#34;&gt;for&lt;/span&gt; (&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; i = &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;; i &amp;lt; &lt;span class=&#34;hljs-number&#34;&gt;10&lt;/span&gt;; ++i) {
        processors.push_back(&lt;span class=&#34;hljs-built_in&#34;&gt;std&lt;/span&gt;::make_unique&amp;lt;ConcreteProcessor&amp;gt;());
    }

    &lt;span class=&#34;hljs-comment&#34;&gt;// Call virtual function 100 times with random instance and value&lt;/span&gt;
    &lt;span class=&#34;hljs-keyword&#34;&gt;for&lt;/span&gt; (&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; i = &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;; i &amp;lt; &lt;span class=&#34;hljs-number&#34;&gt;100&lt;/span&gt;; ++i) {
        &lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; idx = distIndex(rng);
        &lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; value = distValue(rng);
        processors[idx]-&amp;gt;process(value);
    }

    &lt;span class=&#34;hljs-comment&#34;&gt;// Wait for user input&lt;/span&gt;
    &lt;span class=&#34;hljs-built_in&#34;&gt;std&lt;/span&gt;::&lt;span class=&#34;hljs-built_in&#34;&gt;cout&lt;/span&gt; &amp;lt;&amp;lt; &lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;All calls completed. Press Enter to exit...&amp;quot;&lt;/span&gt;;
    &lt;span class=&#34;hljs-built_in&#34;&gt;std&lt;/span&gt;::&lt;span class=&#34;hljs-built_in&#34;&gt;cin&lt;/span&gt;.get();

    &lt;span class=&#34;hljs-keyword&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;;
}&lt;/code&gt;&lt;/pre&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;del&gt;It&amp;#x2019;s no secret that ChatGPT wrote this too&lt;/del&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;The code creates 10 instances, calls a virtual function 100 times, chooses random values and random instances, then waits.&lt;/p&gt;
&lt;p&gt;Though extreme, I often face similar situations while analyzing.&lt;br&gt;My main purposes for using Calls and Memory are:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Only function calls made by a specific instance  &lt;/li&gt;
&lt;li&gt;Filtering by return value or argument  &lt;/li&gt;
&lt;li&gt;Filtering calls or memory accesses before/after a given TTD position&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;First, check how many times the function was called:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;hljs arcade&#34;&gt;&lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;:&lt;span class=&#34;hljs-number&#34;&gt;000&lt;/span&gt;&amp;gt; dx @&lt;span class=&#34;hljs-symbol&#34;&gt;$calls&lt;/span&gt;(&lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;TTDCalls!ConcreteProcessor::process&amp;quot;&lt;/span&gt;).&lt;span class=&#34;hljs-built_in&#34;&gt;Count&lt;/span&gt;()
@&lt;span class=&#34;hljs-symbol&#34;&gt;$calls&lt;/span&gt;(&lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;TTDCalls!ConcreteProcessor::process&amp;quot;&lt;/span&gt;).&lt;span class=&#34;hljs-built_in&#34;&gt;Count&lt;/span&gt;() : &lt;span class=&#34;hljs-number&#34;&gt;0x64&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;That&amp;#x2019;s 100 times. To see only calls made by the 5th instance, we first need that instance&amp;#x2019;s address. Because it&amp;#x2019;s created with &lt;code&gt;std::make_unique&lt;/code&gt; (inlined), we can&amp;#x2019;t directly list constructor calls.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;hljs angelscript&#34;&gt;&lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;:&lt;span class=&#34;hljs-number&#34;&gt;000&lt;/span&gt;&amp;gt; u TTDCalls!main+b0
TTDCalls!std::make_unique [C:\Program Files\Microsoft Visual Studio\&lt;span class=&#34;hljs-number&#34;&gt;2022&lt;/span&gt;\Community\VC\Tools\MSVC\&lt;span class=&#34;hljs-number&#34;&gt;14.41&lt;/span&gt;&lt;span class=&#34;hljs-number&#34;&gt;.34120&lt;/span&gt;\include\memory @ &lt;span class=&#34;hljs-number&#34;&gt;3597&lt;/span&gt;] [inlined &lt;span class=&#34;hljs-keyword&#34;&gt;in&lt;/span&gt; TTDCalls!main+&lt;span class=&#34;hljs-number&#34;&gt;0xb0&lt;/span&gt; [D:\Src\WindbgExamplePrograms\TTDCalls\main.cpp @ &lt;span class=&#34;hljs-number&#34;&gt;34&lt;/span&gt;]]:
&lt;span class=&#34;hljs-number&#34;&gt;00007f&lt;/span&gt;f7`&lt;span class=&#34;hljs-number&#34;&gt;84&lt;/span&gt;d91260 b908000000      mov     ecx,&lt;span class=&#34;hljs-number&#34;&gt;8&lt;/span&gt;
&lt;span class=&#34;hljs-number&#34;&gt;00007f&lt;/span&gt;f7`&lt;span class=&#34;hljs-number&#34;&gt;84&lt;/span&gt;d91265 e8c6080000      call    TTDCalls!operator new (&lt;span class=&#34;hljs-number&#34;&gt;00007f&lt;/span&gt;f7`&lt;span class=&#34;hljs-number&#34;&gt;84&lt;/span&gt;d91b30)
&lt;span class=&#34;hljs-number&#34;&gt;00007f&lt;/span&gt;f7`&lt;span class=&#34;hljs-number&#34;&gt;84&lt;/span&gt;d9126a &lt;span class=&#34;hljs-number&#34;&gt;488930&lt;/span&gt;          mov     qword ptr [rax],rsi
&lt;span class=&#34;hljs-number&#34;&gt;00007f&lt;/span&gt;f7`&lt;span class=&#34;hljs-number&#34;&gt;84&lt;/span&gt;d9126d &lt;span class=&#34;hljs-number&#34;&gt;4889442420&lt;/span&gt;      mov     qword ptr [rsp+&lt;span class=&#34;hljs-number&#34;&gt;20&lt;/span&gt;h],rax
&lt;span class=&#34;hljs-number&#34;&gt;00007f&lt;/span&gt;f7`&lt;span class=&#34;hljs-number&#34;&gt;84&lt;/span&gt;d91272 &lt;span class=&#34;hljs-number&#34;&gt;488&lt;/span&gt;b542438      mov     rdx,qword ptr [rsp+&lt;span class=&#34;hljs-number&#34;&gt;38&lt;/span&gt;h]
&lt;span class=&#34;hljs-number&#34;&gt;00007f&lt;/span&gt;f7`&lt;span class=&#34;hljs-number&#34;&gt;84&lt;/span&gt;d91277 &lt;span class=&#34;hljs-number&#34;&gt;483&lt;/span&gt;b542440      cmp     rdx,qword ptr [rsp+&lt;span class=&#34;hljs-number&#34;&gt;40&lt;/span&gt;h]
&lt;span class=&#34;hljs-number&#34;&gt;00007f&lt;/span&gt;f7`&lt;span class=&#34;hljs-number&#34;&gt;84&lt;/span&gt;d9127c &lt;span class=&#34;hljs-number&#34;&gt;740&lt;/span&gt;e            je      TTDCalls!main+&lt;span class=&#34;hljs-number&#34;&gt;0xdc&lt;/span&gt; (&lt;span class=&#34;hljs-number&#34;&gt;00007f&lt;/span&gt;f7`&lt;span class=&#34;hljs-number&#34;&gt;84&lt;/span&gt;d9128c)
&lt;span class=&#34;hljs-number&#34;&gt;00007f&lt;/span&gt;f7`&lt;span class=&#34;hljs-number&#34;&gt;84&lt;/span&gt;d9127e &lt;span class=&#34;hljs-number&#34;&gt;488&lt;/span&gt;bcf          mov     rcx,rdi&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;But we can list executions of the &lt;code&gt;operator new&lt;/code&gt; instruction and pick the 5th one:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;hljs angelscript&#34;&gt;&lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;:&lt;span class=&#34;hljs-number&#34;&gt;000&lt;/span&gt;&amp;gt; dx @$memory(&lt;span class=&#34;hljs-number&#34;&gt;0x7ff784d91265&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;0x7ff784d91265&lt;/span&gt;+&lt;span class=&#34;hljs-number&#34;&gt;1&lt;/span&gt;, &lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;e&amp;quot;&lt;/span&gt;)[&lt;span class=&#34;hljs-number&#34;&gt;4&lt;/span&gt;]
@$memory(&lt;span class=&#34;hljs-number&#34;&gt;0x7ff784d91265&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;0x7ff784d91265&lt;/span&gt;+&lt;span class=&#34;hljs-number&#34;&gt;1&lt;/span&gt;, &lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;e&amp;quot;&lt;/span&gt;)[&lt;span class=&#34;hljs-number&#34;&gt;4&lt;/span&gt;]                
    EventType        : &lt;span class=&#34;hljs-number&#34;&gt;0x1&lt;/span&gt;
    ThreadId         : &lt;span class=&#34;hljs-number&#34;&gt;0x567c&lt;/span&gt;
    UniqueThreadId   : &lt;span class=&#34;hljs-number&#34;&gt;0x2&lt;/span&gt;
    TimeStart        : &lt;span class=&#34;hljs-number&#34;&gt;4&lt;/span&gt;D8:&lt;span class=&#34;hljs-number&#34;&gt;24&lt;/span&gt;A2 [Time Travel]
    TimeEnd          : &lt;span class=&#34;hljs-number&#34;&gt;4&lt;/span&gt;D8:&lt;span class=&#34;hljs-number&#34;&gt;24&lt;/span&gt;A2 [Time Travel]
    AccessType       : Execute
    IP               : &lt;span class=&#34;hljs-number&#34;&gt;0x7ff784d91265&lt;/span&gt;
    Address          : &lt;span class=&#34;hljs-number&#34;&gt;0x7ff784d91265&lt;/span&gt;
    Size             : &lt;span class=&#34;hljs-number&#34;&gt;0x5&lt;/span&gt;
    Value            : &lt;span class=&#34;hljs-number&#34;&gt;0x8c6e8&lt;/span&gt;
    SystemTimeStart  : &lt;span class=&#34;hljs-number&#34;&gt;2025&lt;/span&gt;&amp;#xB144; &lt;span class=&#34;hljs-number&#34;&gt;5&lt;/span&gt;&amp;#xC6D4; &lt;span class=&#34;hljs-number&#34;&gt;31&lt;/span&gt;&amp;#xC77C; &amp;#xD1A0;&amp;#xC694;&amp;#xC77C; &lt;span class=&#34;hljs-number&#34;&gt;12&lt;/span&gt;:&lt;span class=&#34;hljs-number&#34;&gt;24&lt;/span&gt;:&lt;span class=&#34;hljs-number&#34;&gt;28.628&lt;/span&gt;
    SystemTimeEnd    : &lt;span class=&#34;hljs-number&#34;&gt;2025&lt;/span&gt;&amp;#xB144; &lt;span class=&#34;hljs-number&#34;&gt;5&lt;/span&gt;&amp;#xC6D4; &lt;span class=&#34;hljs-number&#34;&gt;31&lt;/span&gt;&amp;#xC77C; &amp;#xD1A0;&amp;#xC694;&amp;#xC77C; &lt;span class=&#34;hljs-number&#34;&gt;12&lt;/span&gt;:&lt;span class=&#34;hljs-number&#34;&gt;24&lt;/span&gt;:&lt;span class=&#34;hljs-number&#34;&gt;28.628&lt;/span&gt;
&lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;:&lt;span class=&#34;hljs-number&#34;&gt;000&lt;/span&gt;&amp;gt; dx @$memory(&lt;span class=&#34;hljs-number&#34;&gt;0x7ff784d91265&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;0x7ff784d91265&lt;/span&gt;+&lt;span class=&#34;hljs-number&#34;&gt;1&lt;/span&gt;, &lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;e&amp;quot;&lt;/span&gt;)[&lt;span class=&#34;hljs-number&#34;&gt;4&lt;/span&gt;].TimeStart.SeekTo()
(&lt;span class=&#34;hljs-number&#34;&gt;43f&lt;/span&gt;8&lt;span class=&#34;hljs-number&#34;&gt;.567&lt;/span&gt;c): Break instruction exception - code &lt;span class=&#34;hljs-number&#34;&gt;80000003&lt;/span&gt; (first/second chance &lt;span class=&#34;hljs-keyword&#34;&gt;not&lt;/span&gt; available)
Time Travel Position: &lt;span class=&#34;hljs-number&#34;&gt;4&lt;/span&gt;D8:&lt;span class=&#34;hljs-number&#34;&gt;24&lt;/span&gt;A2&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;By looking at the &lt;code&gt;TimeStart&lt;/code&gt; and &lt;code&gt;TimeEnd&lt;/code&gt; fields, we can see when this memory access event started and when it ended. We can jump to that point in time by pressing &lt;code&gt;[Time Travel]&lt;/code&gt; next to the position, or by calling the &lt;code&gt;SeekTo&lt;/code&gt; method of &lt;code&gt;TimeStart&lt;/code&gt; or &lt;code&gt;TimeEnd&lt;/code&gt; directly.&lt;/p&gt;
&lt;p&gt;Now we can determine the address of the fifth instance from the return value of &lt;code&gt;operator new&lt;/code&gt; and use &lt;code&gt;Where&lt;/code&gt; to see only the &lt;code&gt;process&lt;/code&gt; calls of that instance, as shown below, or we can use Calls and access the &lt;code&gt;ReturnValue&lt;/code&gt; field to find out without going to the position.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;hljs angelscript&#34;&gt;&lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;:&lt;span class=&#34;hljs-number&#34;&gt;000&lt;/span&gt;&amp;gt; dx @$memory(&lt;span class=&#34;hljs-number&#34;&gt;0x7ff784d91265&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;0x7ff784d91265&lt;/span&gt;+&lt;span class=&#34;hljs-number&#34;&gt;1&lt;/span&gt;, &lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;e&amp;quot;&lt;/span&gt;)[&lt;span class=&#34;hljs-number&#34;&gt;4&lt;/span&gt;].TimeStart.SeekTo()
(&lt;span class=&#34;hljs-number&#34;&gt;43f&lt;/span&gt;8&lt;span class=&#34;hljs-number&#34;&gt;.567&lt;/span&gt;c): Break instruction exception - code &lt;span class=&#34;hljs-number&#34;&gt;80000003&lt;/span&gt; (first/second chance &lt;span class=&#34;hljs-keyword&#34;&gt;not&lt;/span&gt; available)
Time Travel Position: &lt;span class=&#34;hljs-number&#34;&gt;4&lt;/span&gt;D8:&lt;span class=&#34;hljs-number&#34;&gt;24&lt;/span&gt;A2
&lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;:&lt;span class=&#34;hljs-number&#34;&gt;000&lt;/span&gt;&amp;gt; p
Time Travel Position: &lt;span class=&#34;hljs-number&#34;&gt;4&lt;/span&gt;D8:&lt;span class=&#34;hljs-number&#34;&gt;25&lt;/span&gt;EA
TTDCalls!main+&lt;span class=&#34;hljs-number&#34;&gt;0xba&lt;/span&gt;:
&lt;span class=&#34;hljs-number&#34;&gt;00007f&lt;/span&gt;f7`&lt;span class=&#34;hljs-number&#34;&gt;84&lt;/span&gt;d9126a &lt;span class=&#34;hljs-number&#34;&gt;488930&lt;/span&gt;          mov     qword ptr [rax],rsi ds:&lt;span class=&#34;hljs-number&#34;&gt;000001e0&lt;/span&gt;`&lt;span class=&#34;hljs-number&#34;&gt;00059750&lt;/span&gt;=&lt;span class=&#34;hljs-number&#34;&gt;6562575&lt;/span&gt;c32336d65
&lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;:&lt;span class=&#34;hljs-number&#34;&gt;000&lt;/span&gt;&amp;gt; r rax
rax=&lt;span class=&#34;hljs-number&#34;&gt;000001e000059750&lt;/span&gt;

&lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;:&lt;span class=&#34;hljs-number&#34;&gt;000&lt;/span&gt;&amp;gt; dx @$calls(&lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;TTDCalls!operator new&amp;quot;&lt;/span&gt;).Where(x =&amp;gt; x.ReturnAddress == &lt;span class=&#34;hljs-number&#34;&gt;0x7ff784d9126a&lt;/span&gt;)[&lt;span class=&#34;hljs-number&#34;&gt;0x8&lt;/span&gt;].ReturnValue
@$calls(&lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;TTDCalls!operator new&amp;quot;&lt;/span&gt;).Where(x =&amp;gt; x.ReturnAddress == &lt;span class=&#34;hljs-number&#34;&gt;0x7ff784d9126a&lt;/span&gt;)[&lt;span class=&#34;hljs-number&#34;&gt;0x8&lt;/span&gt;].ReturnValue                 : &lt;span class=&#34;hljs-number&#34;&gt;0x1e000059750&lt;/span&gt; [Type: &lt;span class=&#34;hljs-built_in&#34;&gt;void&lt;/span&gt; *]&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;If you only want to see calls made by a specific instance, you can use the first argument (&lt;code&gt;this&lt;/code&gt;), which is the address of the instance, right? In this example, we have the pdb as well as the source code, so we can also go directly to the name of the parameter instead of the index in &lt;code&gt;Parameters&lt;/code&gt;.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;hljs angelscript&#34;&gt;&lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;:&lt;span class=&#34;hljs-number&#34;&gt;000&lt;/span&gt;&amp;gt; dx @$calls(&lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;TTDCalls!ConcreteProcessor::process&amp;quot;&lt;/span&gt;).Where(x =&amp;gt; x.Parameters[&lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;] == &lt;span class=&#34;hljs-number&#34;&gt;0x1e000059750&lt;/span&gt;)
@$calls(&lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;TTDCalls!ConcreteProcessor::process&amp;quot;&lt;/span&gt;).Where(x =&amp;gt; x.Parameters[&lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;] == &lt;span class=&#34;hljs-number&#34;&gt;0x1e000059750&lt;/span&gt;)                
    [&lt;span class=&#34;hljs-number&#34;&gt;0x6&lt;/span&gt;]           
    [&lt;span class=&#34;hljs-number&#34;&gt;0xf&lt;/span&gt;]           
    [&lt;span class=&#34;hljs-number&#34;&gt;0x21&lt;/span&gt;]          
    [&lt;span class=&#34;hljs-number&#34;&gt;0x2a&lt;/span&gt;]          
    [&lt;span class=&#34;hljs-number&#34;&gt;0x2c&lt;/span&gt;]          
    [&lt;span class=&#34;hljs-number&#34;&gt;0x2f&lt;/span&gt;]          
    [&lt;span class=&#34;hljs-number&#34;&gt;0x32&lt;/span&gt;]          
    [&lt;span class=&#34;hljs-number&#34;&gt;0x39&lt;/span&gt;]          
    [&lt;span class=&#34;hljs-number&#34;&gt;0x3f&lt;/span&gt;]          
    [&lt;span class=&#34;hljs-number&#34;&gt;0x43&lt;/span&gt;]          
    [&lt;span class=&#34;hljs-number&#34;&gt;0x57&lt;/span&gt;]          
    [&lt;span class=&#34;hljs-number&#34;&gt;0x5e&lt;/span&gt;]&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Need only the arguments? Pipe to &lt;code&gt;Select(...)&lt;/code&gt; and display with &lt;code&gt;-g&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Of course, you can use other conditions in the &lt;code&gt;Where&lt;/code&gt;, or you can implement the TTD position comparison as an extension and add it as a condition in the &lt;code&gt;Where&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;Putting it all together, you can produce queries like:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;hljs angelscript&#34;&gt;&lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;:&lt;span class=&#34;hljs-number&#34;&gt;000&lt;/span&gt;&amp;gt; dx -r1 @$calls(&lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;TTDCalls!ConcreteProcessor::process&amp;quot;&lt;/span&gt;).Where(x =&amp;gt; x.Parameters.&lt;span class=&#34;hljs-keyword&#34;&gt;this&lt;/span&gt; == &lt;span class=&#34;hljs-number&#34;&gt;0x1e000059750&lt;/span&gt;)[&lt;span class=&#34;hljs-number&#34;&gt;6&lt;/span&gt;]
@$calls(&lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;TTDCalls!ConcreteProcessor::process&amp;quot;&lt;/span&gt;).Where(x =&amp;gt; x.Parameters.&lt;span class=&#34;hljs-keyword&#34;&gt;this&lt;/span&gt; == &lt;span class=&#34;hljs-number&#34;&gt;0x1e000059750&lt;/span&gt;)[&lt;span class=&#34;hljs-number&#34;&gt;6&lt;/span&gt;]                
    EventType        : &lt;span class=&#34;hljs-number&#34;&gt;0x0&lt;/span&gt;
    ThreadId         : &lt;span class=&#34;hljs-number&#34;&gt;0x567c&lt;/span&gt;
    UniqueThreadId   : &lt;span class=&#34;hljs-number&#34;&gt;0x2&lt;/span&gt;
    TimeStart        : &lt;span class=&#34;hljs-number&#34;&gt;4&lt;/span&gt;DA:&lt;span class=&#34;hljs-number&#34;&gt;10&lt;/span&gt;F0 [Time Travel]
    TimeEnd          : &lt;span class=&#34;hljs-number&#34;&gt;4&lt;/span&gt;DA:&lt;span class=&#34;hljs-number&#34;&gt;10&lt;/span&gt;F3 [Time Travel]
    Function         : TTDCalls!ConcreteProcessor::process
    FunctionAddress  : &lt;span class=&#34;hljs-number&#34;&gt;0x7ff784d911a0&lt;/span&gt;
    ReturnAddress    : &lt;span class=&#34;hljs-number&#34;&gt;0x7ff784d9134e&lt;/span&gt;
    Parameters      
    SystemTimeStart  : &lt;span class=&#34;hljs-number&#34;&gt;2025&lt;/span&gt;&amp;#xB144; &lt;span class=&#34;hljs-number&#34;&gt;5&lt;/span&gt;&amp;#xC6D4; &lt;span class=&#34;hljs-number&#34;&gt;31&lt;/span&gt;&amp;#xC77C; &amp;#xD1A0;&amp;#xC694;&amp;#xC77C; &lt;span class=&#34;hljs-number&#34;&gt;12&lt;/span&gt;:&lt;span class=&#34;hljs-number&#34;&gt;24&lt;/span&gt;:&lt;span class=&#34;hljs-number&#34;&gt;28.633&lt;/span&gt;
    SystemTimeEnd    : &lt;span class=&#34;hljs-number&#34;&gt;2025&lt;/span&gt;&amp;#xB144; &lt;span class=&#34;hljs-number&#34;&gt;5&lt;/span&gt;&amp;#xC6D4; &lt;span class=&#34;hljs-number&#34;&gt;31&lt;/span&gt;&amp;#xC77C; &amp;#xD1A0;&amp;#xC694;&amp;#xC77C; &lt;span class=&#34;hljs-number&#34;&gt;12&lt;/span&gt;:&lt;span class=&#34;hljs-number&#34;&gt;24&lt;/span&gt;:&lt;span class=&#34;hljs-number&#34;&gt;28.633&lt;/span&gt;
&lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;:&lt;span class=&#34;hljs-number&#34;&gt;000&lt;/span&gt;&amp;gt; dx -r1 @$calls(&lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;TTDCalls!ConcreteProcessor::process&amp;quot;&lt;/span&gt;).Where(x =&amp;gt; x.Parameters.&lt;span class=&#34;hljs-keyword&#34;&gt;this&lt;/span&gt; == &lt;span class=&#34;hljs-number&#34;&gt;0x1e000059750&lt;/span&gt;)[&lt;span class=&#34;hljs-number&#34;&gt;94&lt;/span&gt;]
@$calls(&lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;TTDCalls!ConcreteProcessor::process&amp;quot;&lt;/span&gt;).Where(x =&amp;gt; x.Parameters.&lt;span class=&#34;hljs-keyword&#34;&gt;this&lt;/span&gt; == &lt;span class=&#34;hljs-number&#34;&gt;0x1e000059750&lt;/span&gt;)[&lt;span class=&#34;hljs-number&#34;&gt;94&lt;/span&gt;]                
    EventType        : &lt;span class=&#34;hljs-number&#34;&gt;0x0&lt;/span&gt;
    ThreadId         : &lt;span class=&#34;hljs-number&#34;&gt;0x567c&lt;/span&gt;
    UniqueThreadId   : &lt;span class=&#34;hljs-number&#34;&gt;0x2&lt;/span&gt;
    TimeStart        : &lt;span class=&#34;hljs-number&#34;&gt;4&lt;/span&gt;DB:&lt;span class=&#34;hljs-number&#34;&gt;820&lt;/span&gt; [Time Travel]
    TimeEnd          : &lt;span class=&#34;hljs-number&#34;&gt;4&lt;/span&gt;DB:&lt;span class=&#34;hljs-number&#34;&gt;823&lt;/span&gt; [Time Travel]
    Function         : TTDCalls!ConcreteProcessor::process
    FunctionAddress  : &lt;span class=&#34;hljs-number&#34;&gt;0x7ff784d911a0&lt;/span&gt;
    ReturnAddress    : &lt;span class=&#34;hljs-number&#34;&gt;0x7ff784d9134e&lt;/span&gt;
    Parameters      
    SystemTimeStart  : &lt;span class=&#34;hljs-number&#34;&gt;2025&lt;/span&gt;&amp;#xB144; &lt;span class=&#34;hljs-number&#34;&gt;5&lt;/span&gt;&amp;#xC6D4; &lt;span class=&#34;hljs-number&#34;&gt;31&lt;/span&gt;&amp;#xC77C; &amp;#xD1A0;&amp;#xC694;&amp;#xC77C; &lt;span class=&#34;hljs-number&#34;&gt;12&lt;/span&gt;:&lt;span class=&#34;hljs-number&#34;&gt;24&lt;/span&gt;:&lt;span class=&#34;hljs-number&#34;&gt;28.633&lt;/span&gt;
    SystemTimeEnd    : &lt;span class=&#34;hljs-number&#34;&gt;2025&lt;/span&gt;&amp;#xB144; &lt;span class=&#34;hljs-number&#34;&gt;5&lt;/span&gt;&amp;#xC6D4; &lt;span class=&#34;hljs-number&#34;&gt;31&lt;/span&gt;&amp;#xC77C; &amp;#xD1A0;&amp;#xC694;&amp;#xC77C; &lt;span class=&#34;hljs-number&#34;&gt;12&lt;/span&gt;:&lt;span class=&#34;hljs-number&#34;&gt;24&lt;/span&gt;:&lt;span class=&#34;hljs-number&#34;&gt;28.633&lt;/span&gt;
&lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;:&lt;span class=&#34;hljs-number&#34;&gt;000&lt;/span&gt;&amp;gt; dx @$calls(&lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;TTDCalls!ConcreteProcessor::process&amp;quot;&lt;/span&gt;).Where(x =&amp;gt; x.Parameters.&lt;span class=&#34;hljs-keyword&#34;&gt;this&lt;/span&gt; != &lt;span class=&#34;hljs-number&#34;&gt;0x1e000059750&lt;/span&gt; &amp;amp;&amp;amp; @$poscmp(x.TimeStart, &lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;4DA:10F0&amp;quot;&lt;/span&gt;) &amp;gt; &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt; &amp;amp;&amp;amp; @$poscmp(&lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;4DB:823&amp;quot;&lt;/span&gt;, x.TimeEnd) &amp;lt; &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;)
@$calls(&lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;TTDCalls!ConcreteProcessor::process&amp;quot;&lt;/span&gt;).Where(x =&amp;gt; x.Parameters.&lt;span class=&#34;hljs-keyword&#34;&gt;this&lt;/span&gt; != &lt;span class=&#34;hljs-number&#34;&gt;0x1e000059750&lt;/span&gt; &amp;amp;&amp;amp; @$poscmp(x.TimeStart, &lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;4DA:10F0&amp;quot;&lt;/span&gt;) &amp;gt; &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt; &amp;amp;&amp;amp; @$poscmp(&lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;4DB:823&amp;quot;&lt;/span&gt;, x.TimeEnd) &amp;lt; &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;)                
    [&lt;span class=&#34;hljs-number&#34;&gt;0x5f&lt;/span&gt;]          
    [&lt;span class=&#34;hljs-number&#34;&gt;0x60&lt;/span&gt;]          
    [&lt;span class=&#34;hljs-number&#34;&gt;0x61&lt;/span&gt;]          
    [&lt;span class=&#34;hljs-number&#34;&gt;0x62&lt;/span&gt;]          
    [&lt;span class=&#34;hljs-number&#34;&gt;0x63&lt;/span&gt;]          
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;The above command determines the position of the first and last &lt;code&gt;process&lt;/code&gt; calls of the fifth &lt;code&gt;ConcreteProcessor&lt;/code&gt; instance and lists only the &lt;code&gt;process&lt;/code&gt; calls of other instances that were called between them.&lt;/p&gt;
&lt;h1 id=&#34;Wrapping-up&#34;&gt;&lt;a href=&#34;#Wrapping-up&#34; class=&#34;headerlink&#34; title=&#34;Wrapping up&#34;&gt;&lt;/a&gt;Wrapping up&lt;/h1&gt;&lt;p&gt;After finishing, it feels like this post talks more about WinDbg&amp;#x2019;s TTD data objects (&lt;code&gt;Calls&lt;/code&gt;, &lt;code&gt;Memory&lt;/code&gt;) than about scripting itself &amp;#x1F605;. It wouldn&amp;#x2019;t have been bad to cover how to write and use scripts based on the &lt;a href=&#34;https://learn.microsoft.com/ko-kr/windows-hardware/drivers/debugger/javascript-debugger-scripting&#34;&gt;MS documentation&lt;/a&gt;, but I didn&amp;#x2019;t feel like reading it all;; I also learned by roughly studying &lt;strong&gt;0vercl0k&lt;/strong&gt;&amp;#x2019;s &lt;a href=&#34;https://github.com/0vercl0k/windbg-scripts&#34;&gt;examples&lt;/a&gt; and using only very simple scripts, yet the difference between &lt;em&gt;with&lt;/em&gt; and &lt;em&gt;without&lt;/em&gt; scripts was clear. I already thought TTD alone was revolutionary, and every time I learn a new feature I wonder how I ever lived without it.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/2025/06/01/pwndorei/windbg_js_en/image%206.png&#34; alt=&#34;image.png&#34;&gt;&lt;/p&gt;
&lt;p&gt;Anyway, thanks for reading this post, and I hope my teammates give it a try!&lt;/p&gt;
 - hack &amp; life">
  <meta name="author" content="j0dev, y2sman">
  <meta name="keywords" content>
  <meta name="google-site-verification" content="DXkyiaX95-ws53Tyt0m91_umRf4gfV2qJIQZ5zQDIO4">
  <meta name="naver-site-verification" content="0b4fea742ed293b82621684e466d9f26c3ccee06">


  <meta property="og:type" content="website"> 
  <meta property="og:title" content="[Research] A spoonful of javascript for windbg - hackyboiz">
  <meta property="og:description" content="&lt;h1 id=&#34;Introduction&#34;&gt;&lt;a href=&#34;#Introduction&#34; class=&#34;headerlink&#34; title=&#34;Introduction&#34;&gt;&lt;/a&gt;Introduction&lt;/h1&gt;&lt;p&gt;Hello, this is &lt;strong&gt;pwndorei&lt;/strong&gt;&amp;#x2026; Since I started working at a company around last September, I&amp;#x2019;ve stopped writing research posts for a while, but now I can&amp;#x2019;t avoid it anymore so I&amp;#x2019;m back &amp;#x1F926;&amp;#x1F3FB;&amp;#x200D;&amp;#x2642;&amp;#xFE0F;. However, aside from work, I don&amp;#x2019;t really have anything I&amp;#x2019;m researching, so no topic came to mind that was worth writing about.&lt;br&gt;So I decided to simply present a JavaScript script that&amp;#x2019;s handy when analyzing with WinDbg. All right, let&amp;#x2019;s go!&lt;/p&gt;
&lt;h1 id=&#34;Windbg-Script-&amp;#x21D2;&#34;&gt;&lt;a href=&#34;#Windbg-Script-&amp;#x21D2;&#34; class=&#34;headerlink&#34; title=&#34;Windbg + Script &amp;#x21D2; ?&#34;&gt;&lt;/a&gt;Windbg + Script &amp;#x21D2; ?&lt;/h1&gt;&lt;p&gt;Using a script for debugging? The goal is one and the same&amp;#x2014;to debug lazily.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/2025/06/01/pwndorei/windbg_js_en/image.png&#34; alt=&#34;image.png&#34;&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;del&gt;It&amp;#x2019;s absolutely &lt;em&gt;not&lt;/em&gt; about working hard in advance so you can relax later&lt;/del&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Of course, you &lt;em&gt;can&lt;/em&gt; carefully &lt;code&gt;dq&lt;/code&gt;, &lt;code&gt;dd&lt;/code&gt;, etc. every single time to check what data lives in a crazy-looking data structure. And with TTD, even if you accidentally step over an important call, you don&amp;#x2019;t have to relaunch the process, so you can just smash &lt;strong&gt;F10&lt;/strong&gt; mindlessly while analyzing.&lt;br&gt;But! The larger the data gets, the less time it takes to write a script instead of doing it by hand, and if you rely on TTD too much you&amp;#x2019;ll turn into a fool.&lt;br&gt;So today, with a simple example, we&amp;#x2019;ll see how to use scripts effectively&amp;#x2014;and as a bonus I&amp;#x2019;ll also show you how to push TTD to the limit.&lt;/p&gt;
&lt;h1 id=&#34;Windbg-Script-Basic&#34;&gt;&lt;a href=&#34;#Windbg-Script-Basic&#34; class=&#34;headerlink&#34; title=&#34;Windbg Script Basic&#34;&gt;&lt;/a&gt;Windbg Script Basic&lt;/h1&gt;&lt;p&gt;In WinDbg you can create a new script or load an existing one from the &lt;strong&gt;Scripting&lt;/strong&gt; menu, like below. Besides JavaScript there&amp;#x2019;s something called &lt;strong&gt;NatVis&lt;/strong&gt;, but since we&amp;#x2019;re going to use JavaScript we&amp;#x2019;ll just ignore that.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/2025/06/01/pwndorei/windbg_js_en/image%201.png&#34; alt=&#34;image.png&#34;&gt;&lt;/p&gt;
&lt;p&gt;Next, in &lt;strong&gt;New Script&lt;/strong&gt; you choose between &lt;strong&gt;Extension&lt;/strong&gt; and &lt;strong&gt;Imperative&lt;/strong&gt;; it&amp;#x2019;s merely a difference in the default template.&lt;/p&gt;
&lt;p&gt;For &lt;strong&gt;Imperative&lt;/strong&gt;, the following boilerplate code is generated:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;hljs jsx&#34;&gt;&lt;span class=&#34;hljs-meta&#34;&gt;&amp;quot;use strict&amp;quot;&lt;/span&gt;;

&lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;function&lt;/span&gt; &lt;span class=&#34;hljs-title&#34;&gt;initializeScript&lt;/span&gt;(&lt;span class=&#34;hljs-params&#34;&gt;&lt;/span&gt;)&lt;/span&gt;
&lt;span class=&#34;hljs-function&#34;&gt;&lt;/span&gt;{
    &lt;span class=&#34;hljs-keyword&#34;&gt;return&lt;/span&gt; [&lt;span class=&#34;hljs-keyword&#34;&gt;new&lt;/span&gt; host.apiVersionSupport(&lt;span class=&#34;hljs-number&#34;&gt;1&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;9&lt;/span&gt;)];
}

&lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;function&lt;/span&gt; &lt;span class=&#34;hljs-title&#34;&gt;invokeScript&lt;/span&gt;(&lt;span class=&#34;hljs-params&#34;&gt;&lt;/span&gt;)&lt;/span&gt;
&lt;span class=&#34;hljs-function&#34;&gt;&lt;/span&gt;{
    &lt;span class=&#34;hljs-comment&#34;&gt;//&lt;/span&gt;
    &lt;span class=&#34;hljs-comment&#34;&gt;// Insert your script content here.  This method will be called whenever the script is&lt;/span&gt;
    &lt;span class=&#34;hljs-comment&#34;&gt;// invoked from a client.&lt;/span&gt;
    &lt;span class=&#34;hljs-comment&#34;&gt;//&lt;/span&gt;
    &lt;span class=&#34;hljs-comment&#34;&gt;// See the following for more details:&lt;/span&gt;
    &lt;span class=&#34;hljs-comment&#34;&gt;//&lt;/span&gt;
    &lt;span class=&#34;hljs-comment&#34;&gt;//     https://aka.ms/JsDbgExt&lt;/span&gt;
    &lt;span class=&#34;hljs-comment&#34;&gt;//&lt;/span&gt;
}&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;You can run it by pressing &lt;strong&gt;Execute&lt;/strong&gt; in &lt;strong&gt;Actions&lt;/strong&gt; or with commands such as &lt;code&gt;.scriptrun&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/2025/06/01/pwndorei/windbg_js_en/image%202.png&#34; alt=&#34;image.png&#34;&gt;&lt;/p&gt;
&lt;p&gt;For &lt;strong&gt;Extension&lt;/strong&gt;, it&amp;#x2019;s used literally to add extension functionality, and this template appears:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;hljs jsx&#34;&gt;&lt;span class=&#34;hljs-meta&#34;&gt;&amp;quot;use strict&amp;quot;&lt;/span&gt;;

&lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;function&lt;/span&gt; &lt;span class=&#34;hljs-title&#34;&gt;initializeScript&lt;/span&gt;(&lt;span class=&#34;hljs-params&#34;&gt;&lt;/span&gt;)&lt;/span&gt;
&lt;span class=&#34;hljs-function&#34;&gt;&lt;/span&gt;{
    &lt;span class=&#34;hljs-comment&#34;&gt;//&lt;/span&gt;
    &lt;span class=&#34;hljs-comment&#34;&gt;// Return an array of registration objects to modify the object model of the debugger&lt;/span&gt;
    &lt;span class=&#34;hljs-comment&#34;&gt;// See the following for more details:&lt;/span&gt;
    &lt;span class=&#34;hljs-comment&#34;&gt;//&lt;/span&gt;
    &lt;span class=&#34;hljs-comment&#34;&gt;//     https://aka.ms/JsDbgExt&lt;/span&gt;
    &lt;span class=&#34;hljs-comment&#34;&gt;//&lt;/span&gt;
    &lt;span class=&#34;hljs-keyword&#34;&gt;return&lt;/span&gt; [&lt;span class=&#34;hljs-keyword&#34;&gt;new&lt;/span&gt; host.apiVersionSupport(&lt;span class=&#34;hljs-number&#34;&gt;1&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;9&lt;/span&gt;)];
}&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Extensions added through a script can be invoked in WinDbg with a command like &lt;code&gt;!extname&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;We&amp;#x2019;ll see what functions we can implement through examples later, but first a few more script-related commands:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;p&gt;&lt;code&gt;.scriptlist&lt;/code&gt;&lt;br&gt;Shows all currently loaded scripts.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;hljs routeros&#34;&gt;0:038&amp;gt; .scriptlist
Command Loaded Scripts:
        &lt;span class=&#34;hljs-built_in&#34;&gt;..&lt;/span&gt;.
    JavaScript&lt;span class=&#34;hljs-built_in&#34;&gt; script &lt;/span&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;from&lt;/span&gt; &lt;span class=&#34;hljs-string&#34;&gt;&amp;apos;D:\windbg_Ext\utils.js&amp;apos;&lt;/span&gt;
    JavaScript&lt;span class=&#34;hljs-built_in&#34;&gt; script &lt;/span&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;from&lt;/span&gt; &lt;span class=&#34;hljs-string&#34;&gt;&amp;apos;D:\windbg_Ext\codecov.js&amp;apos;&lt;/span&gt;
    JavaScript&lt;span class=&#34;hljs-built_in&#34;&gt; script &lt;/span&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;from&lt;/span&gt; &lt;span class=&#34;hljs-string&#34;&gt;&amp;apos;C:\Program Files\WindowsApps\Microsoft.WinDbg_1.2504.15001.0_x64__8wekyb3d8bbwe\amd64\winext\ApiExtension\CodeFlow.js&amp;apos;&lt;/span&gt;
Other Clients&lt;span class=&#34;hljs-string&#34;&gt;&amp;apos; Scripts:&lt;/span&gt;
&lt;span class=&#34;hljs-string&#34;&gt;    Script named &amp;apos;&lt;/span&gt;untitled0&lt;span class=&#34;hljs-string&#34;&gt;&amp;apos;&lt;/span&gt;
&lt;span class=&#34;hljs-string&#34;&gt;    Script named &amp;apos;&lt;/span&gt;untitled1&lt;span class=&#34;hljs-string&#34;&gt;&amp;apos;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;&lt;code&gt;.scriptload&lt;/code&gt; &amp;amp; &lt;code&gt;.scriptunload&lt;/code&gt;&lt;br&gt;Commands to load or unload a script.&lt;br&gt;When loading, you can give the full path or just the name; WinDbg searches any directories in the &lt;code&gt;PATH&lt;/code&gt; environment variable.&lt;br&gt;&lt;code&gt;.scriptload&lt;/code&gt; only calls the script&amp;#x2019;s &lt;code&gt;initializeScript&lt;/code&gt; function.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;code&gt;.scriptrun&lt;/code&gt;&lt;br&gt;Unlike &lt;code&gt;.scriptload&lt;/code&gt;, it also calls the &lt;code&gt;invokeScript&lt;/code&gt; function.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;There are two commands&amp;#x2014;&lt;code&gt;.scriptload&lt;/code&gt; and &lt;code&gt;.scriptrun&lt;/code&gt;&amp;#x2014;that execute scripts. If the script is &lt;strong&gt;imperative&lt;/strong&gt;, you need to run &lt;code&gt;invokeScript&lt;/code&gt;, so you use &lt;strong&gt;run&lt;/strong&gt;; if it&amp;#x2019;s an &lt;strong&gt;extension&lt;/strong&gt;, you use &lt;strong&gt;load&lt;/strong&gt;, right?&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/2025/06/01/pwndorei/windbg_js_en/image%203.png&#34; alt=&#34;image.png&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;Hello-World&#34;&gt;&lt;a href=&#34;#Hello-World&#34; class=&#34;headerlink&#34; title=&#34;Hello World&#34;&gt;&lt;/a&gt;Hello World&lt;/h2&gt;&lt;p&gt;We&amp;#x2019;re not learning a &lt;em&gt;new&lt;/em&gt; language, but because we can&amp;#x2019;t use &lt;code&gt;console.log&lt;/code&gt; the way we do in the browser, let&amp;#x2019;s start by printing &amp;#x201C;Hello World&amp;#x201D; to the console.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;hljs jsx&#34;&gt;&lt;span class=&#34;hljs-meta&#34;&gt;&amp;quot;use strict&amp;quot;&lt;/span&gt;;

&lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;function&lt;/span&gt; &lt;span class=&#34;hljs-title&#34;&gt;initializeScript&lt;/span&gt;(&lt;span class=&#34;hljs-params&#34;&gt;&lt;/span&gt;)&lt;/span&gt;
&lt;span class=&#34;hljs-function&#34;&gt;&lt;/span&gt;{
    &lt;span class=&#34;hljs-keyword&#34;&gt;return&lt;/span&gt; [&lt;span class=&#34;hljs-keyword&#34;&gt;new&lt;/span&gt; host.apiVersionSupport(&lt;span class=&#34;hljs-number&#34;&gt;1&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;9&lt;/span&gt;)];
}

&lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;function&lt;/span&gt; &lt;span class=&#34;hljs-title&#34;&gt;invokeScript&lt;/span&gt;(&lt;span class=&#34;hljs-params&#34;&gt;&lt;/span&gt;)&lt;/span&gt;
&lt;span class=&#34;hljs-function&#34;&gt;&lt;/span&gt;{
    host.diagnostics.debugLog(&lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;Hello World!\n&amp;quot;&lt;/span&gt;)
}&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;As you can see, you use &lt;code&gt;host.diagnostics.debugLog&lt;/code&gt; instead of &lt;code&gt;console.log&lt;/code&gt;. If you run it, it prints normally.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/2025/06/01/pwndorei/windbg_js_en/image%204.png&#34; alt=&#34;image.png&#34;&gt;&lt;/p&gt;
&lt;p&gt;Since I have no intention of typing that code every time I need to log, let&amp;#x2019;s make an alias and use that instead &amp;#x1F923;&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;hljs jsx&#34;&gt;&lt;span class=&#34;hljs-meta&#34;&gt;&amp;quot;use strict&amp;quot;&lt;/span&gt;;

&lt;span class=&#34;hljs-keyword&#34;&gt;const&lt;/span&gt; log = &lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-params&#34;&gt;x&lt;/span&gt; =&amp;gt;&lt;/span&gt; host.diagnostics.debugLog(x)

&lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;function&lt;/span&gt; &lt;span class=&#34;hljs-title&#34;&gt;initializeScript&lt;/span&gt;(&lt;span class=&#34;hljs-params&#34;&gt;&lt;/span&gt;)&lt;/span&gt;
&lt;span class=&#34;hljs-function&#34;&gt;&lt;/span&gt;{
    &lt;span class=&#34;hljs-keyword&#34;&gt;return&lt;/span&gt; [&lt;span class=&#34;hljs-keyword&#34;&gt;new&lt;/span&gt; host.apiVersionSupport(&lt;span class=&#34;hljs-number&#34;&gt;1&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;9&lt;/span&gt;)];
}

&lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;function&lt;/span&gt; &lt;span class=&#34;hljs-title&#34;&gt;invokeScript&lt;/span&gt;(&lt;span class=&#34;hljs-params&#34;&gt;&lt;/span&gt;)&lt;/span&gt;
&lt;span class=&#34;hljs-function&#34;&gt;&lt;/span&gt;{
    log(&lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;Hello World!\n&amp;quot;&lt;/span&gt;)
}&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;Read-amp-Write-Memory&#34;&gt;&lt;a href=&#34;#Read-amp-Write-Memory&#34; class=&#34;headerlink&#34; title=&#34;Read &amp;amp; Write Memory&#34;&gt;&lt;/a&gt;Read &amp;amp; Write Memory&lt;/h2&gt;&lt;p&gt;We&amp;#x2019;re not going to write scripts just to print &amp;#x201C;Hello World&amp;#x201D;, right? &lt;code&gt;host.memory&lt;/code&gt; has the following functions, which let you read and write data in memory:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;readMemoryValues&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;readWideString&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;readString&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;writeMemoryValues&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;For today, knowing this much is plenty!&lt;/p&gt;
&lt;h1 id=&#34;Practice&#34;&gt;&lt;a href=&#34;#Practice&#34; class=&#34;headerlink&#34; title=&#34;Practice&#34;&gt;&lt;/a&gt;Practice&lt;/h1&gt;&lt;p&gt;Now let&amp;#x2019;s debug a sample program and see in what situations a script is useful.&lt;/p&gt;
&lt;h2 id=&#34;1-Dump-Data-Structure&#34;&gt;&lt;a href=&#34;#1-Dump-Data-Structure&#34; class=&#34;headerlink&#34; title=&#34;1. Dump Data Structure&#34;&gt;&lt;/a&gt;1. Dump Data Structure&lt;/h2&gt;&lt;p&gt;First up is dumping the data structure we mentioned earlier. ChatGPT made the sample program like this:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;hljs c&#34;&gt;&lt;span class=&#34;hljs-meta&#34;&gt;#&lt;span class=&#34;hljs-meta-keyword&#34;&gt;include&lt;/span&gt; &lt;span class=&#34;hljs-meta-string&#34;&gt;&amp;lt;stdio.h&amp;gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&#34;hljs-meta&#34;&gt;#&lt;span class=&#34;hljs-meta-keyword&#34;&gt;include&lt;/span&gt; &lt;span class=&#34;hljs-meta-string&#34;&gt;&amp;lt;stdlib.h&amp;gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&#34;hljs-meta&#34;&gt;#&lt;span class=&#34;hljs-meta-keyword&#34;&gt;include&lt;/span&gt; &lt;span class=&#34;hljs-meta-string&#34;&gt;&amp;lt;string.h&amp;gt;&lt;/span&gt;&lt;/span&gt;

&lt;span class=&#34;hljs-keyword&#34;&gt;typedef&lt;/span&gt; &lt;span class=&#34;hljs-class&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;hljs-title&#34;&gt;Node&lt;/span&gt; {&lt;/span&gt;
    &lt;span class=&#34;hljs-keyword&#34;&gt;char&lt;/span&gt;* word;
    &lt;span class=&#34;hljs-class&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;hljs-title&#34;&gt;Node&lt;/span&gt;* &lt;span class=&#34;hljs-title&#34;&gt;left&lt;/span&gt;;&lt;/span&gt;
    &lt;span class=&#34;hljs-class&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;hljs-title&#34;&gt;Node&lt;/span&gt;* &lt;span class=&#34;hljs-title&#34;&gt;right&lt;/span&gt;;&lt;/span&gt;
} Node;

&lt;span class=&#34;hljs-function&#34;&gt;Node* &lt;span class=&#34;hljs-title&#34;&gt;createNode&lt;/span&gt;&lt;span class=&#34;hljs-params&#34;&gt;(&lt;span class=&#34;hljs-keyword&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;hljs-keyword&#34;&gt;char&lt;/span&gt;* word)&lt;/span&gt; &lt;/span&gt;{
    Node* newNode = (Node*)&lt;span class=&#34;hljs-built_in&#34;&gt;malloc&lt;/span&gt;(&lt;span class=&#34;hljs-keyword&#34;&gt;sizeof&lt;/span&gt;(Node));
    &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; (!newNode) &lt;span class=&#34;hljs-keyword&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;hljs-literal&#34;&gt;NULL&lt;/span&gt;;

    newNode-&amp;gt;word = _strdup(word);
    newNode-&amp;gt;left = &lt;span class=&#34;hljs-literal&#34;&gt;NULL&lt;/span&gt;;
    newNode-&amp;gt;right = &lt;span class=&#34;hljs-literal&#34;&gt;NULL&lt;/span&gt;;
    &lt;span class=&#34;hljs-keyword&#34;&gt;return&lt;/span&gt; newNode;
}

&lt;span class=&#34;hljs-function&#34;&gt;Node* &lt;span class=&#34;hljs-title&#34;&gt;insert&lt;/span&gt;&lt;span class=&#34;hljs-params&#34;&gt;(Node* root, &lt;span class=&#34;hljs-keyword&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;hljs-keyword&#34;&gt;char&lt;/span&gt;* word)&lt;/span&gt; &lt;/span&gt;{
    &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; (root == &lt;span class=&#34;hljs-literal&#34;&gt;NULL&lt;/span&gt;) {
        &lt;span class=&#34;hljs-keyword&#34;&gt;return&lt;/span&gt; createNode(word);
    }

    &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; (&lt;span class=&#34;hljs-built_in&#34;&gt;strcmp&lt;/span&gt;(word, root-&amp;gt;word) &amp;lt; &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;) {
        root-&amp;gt;left = insert(root-&amp;gt;left, word);
    } &lt;span class=&#34;hljs-keyword&#34;&gt;else&lt;/span&gt; &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; (&lt;span class=&#34;hljs-built_in&#34;&gt;strcmp&lt;/span&gt;(word, root-&amp;gt;word) &amp;gt; &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;) {
        root-&amp;gt;right = insert(root-&amp;gt;right, word);
    }
    &lt;span class=&#34;hljs-keyword&#34;&gt;return&lt;/span&gt; root;
}

&lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;hljs-title&#34;&gt;inorderTraversal&lt;/span&gt;&lt;span class=&#34;hljs-params&#34;&gt;(Node* root)&lt;/span&gt; &lt;/span&gt;{
    &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; (root != &lt;span class=&#34;hljs-literal&#34;&gt;NULL&lt;/span&gt;) {
        inorderTraversal(root-&amp;gt;left);
        &lt;span class=&#34;hljs-built_in&#34;&gt;printf&lt;/span&gt;(&lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;%s\n&amp;quot;&lt;/span&gt;, root-&amp;gt;word);
        inorderTraversal(root-&amp;gt;right);
    }
}

&lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;hljs-title&#34;&gt;freeTree&lt;/span&gt;&lt;span class=&#34;hljs-params&#34;&gt;(Node* root)&lt;/span&gt; &lt;/span&gt;{
    &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; (root != &lt;span class=&#34;hljs-literal&#34;&gt;NULL&lt;/span&gt;) {
        freeTree(root-&amp;gt;left);
        freeTree(root-&amp;gt;right);
        &lt;span class=&#34;hljs-built_in&#34;&gt;free&lt;/span&gt;(root-&amp;gt;word);
        &lt;span class=&#34;hljs-built_in&#34;&gt;free&lt;/span&gt;(root);
    }
}

&lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;hljs-title&#34;&gt;main&lt;/span&gt;&lt;span class=&#34;hljs-params&#34;&gt;()&lt;/span&gt; &lt;/span&gt;{
    &lt;span class=&#34;hljs-keyword&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;hljs-keyword&#34;&gt;char&lt;/span&gt;* words[&lt;span class=&#34;hljs-number&#34;&gt;10&lt;/span&gt;] = {
        &lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;banana&amp;quot;&lt;/span&gt;, &lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;apple&amp;quot;&lt;/span&gt;, &lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;grape&amp;quot;&lt;/span&gt;, &lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;orange&amp;quot;&lt;/span&gt;, &lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;kiwi&amp;quot;&lt;/span&gt;,
        &lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;peach&amp;quot;&lt;/span&gt;, &lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;lemon&amp;quot;&lt;/span&gt;, &lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;mango&amp;quot;&lt;/span&gt;, &lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;cherry&amp;quot;&lt;/span&gt;, &lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;melon&amp;quot;&lt;/span&gt;
    };

    Node* root = &lt;span class=&#34;hljs-literal&#34;&gt;NULL&lt;/span&gt;;

    &lt;span class=&#34;hljs-keyword&#34;&gt;for&lt;/span&gt; (&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; i = &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;; i &amp;lt; &lt;span class=&#34;hljs-number&#34;&gt;10&lt;/span&gt;; i++) {
        root = insert(root, words[i]);
    }

    &lt;span class=&#34;hljs-built_in&#34;&gt;printf&lt;/span&gt;(&lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;Address of root node: %p\n&amp;quot;&lt;/span&gt;, (&lt;span class=&#34;hljs-keyword&#34;&gt;void&lt;/span&gt;*)root);

    &lt;span class=&#34;hljs-built_in&#34;&gt;printf&lt;/span&gt;(&lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;Press Enter to exit...&amp;quot;&lt;/span&gt;);
    getchar();

    freeTree(root);
    &lt;span class=&#34;hljs-keyword&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;;
}&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;It&amp;#x2019;s simple code that stores strings in a binary tree in order. It prints the root node&amp;#x2019;s address and waits for console input. We can attach the debugger and write a script that traverses the tree to print the data.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/2025/06/01/pwndorei/windbg_js_en/image%205.png&#34; alt=&#34;image.png&#34;&gt;&lt;/p&gt;
&lt;p&gt;A &lt;code&gt;Node&lt;/code&gt; is a 0x18-byte structure with three pointer fields, so I defined &lt;code&gt;getNode&lt;/code&gt; like this:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;hljs jsx&#34;&gt;&lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;function&lt;/span&gt; &lt;span class=&#34;hljs-title&#34;&gt;getNode&lt;/span&gt;(&lt;span class=&#34;hljs-params&#34;&gt;addr&lt;/span&gt;)&lt;/span&gt;{
    &lt;span class=&#34;hljs-keyword&#34;&gt;var&lt;/span&gt; node = host.memory.readMemoryValues(addr, &lt;span class=&#34;hljs-number&#34;&gt;3&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;8&lt;/span&gt;)
    &lt;span class=&#34;hljs-keyword&#34;&gt;return&lt;/span&gt; {
        &lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;word&amp;quot;&lt;/span&gt;: node[&lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;],
        &lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;left&amp;quot;&lt;/span&gt;: node[&lt;span class=&#34;hljs-number&#34;&gt;1&lt;/span&gt;],
        &lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;right&amp;quot;&lt;/span&gt;: node[&lt;span class=&#34;hljs-number&#34;&gt;2&lt;/span&gt;]
    }
}&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Reading memory is done with &lt;code&gt;host.memory.readMemoryValues&lt;/code&gt;. As you can guess from the parameters, it reads 3 elements (second parameter) of 8 bytes each (third parameter, &lt;code&gt;elementSize&lt;/code&gt;) starting at &lt;code&gt;addr&lt;/code&gt;. The return value is an array of integers containing the data, and I use it to build a node object.&lt;/p&gt;
&lt;p&gt;Now that we can use the &lt;code&gt;Node&lt;/code&gt; structure stored in memory, we need a traversal function. Below is a simple in-order traversal: given a node returned by &lt;code&gt;getNode&lt;/code&gt;, it reads the string at &lt;code&gt;word&lt;/code&gt; and prints it.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;hljs jsx&#34;&gt;&lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;function&lt;/span&gt; &lt;span class=&#34;hljs-title&#34;&gt;traverse&lt;/span&gt;(&lt;span class=&#34;hljs-params&#34;&gt;node&lt;/span&gt;)&lt;/span&gt;{
    &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt;(node[&lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;left&amp;quot;&lt;/span&gt;] != &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;) traverse(getNode(node[&lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;left&amp;quot;&lt;/span&gt;]))
    log(host.memory.readString(node[&lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;word&amp;quot;&lt;/span&gt;]) + &lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;\n&amp;quot;&lt;/span&gt;)
    &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt;(node[&lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;right&amp;quot;&lt;/span&gt;] != &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;) traverse(getNode(node[&lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;right&amp;quot;&lt;/span&gt;]))
}&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;To read a string, use &lt;code&gt;host.memory.readString&lt;/code&gt; like above. If it were a wide string, you&amp;#x2019;d use &lt;code&gt;readWideString&lt;/code&gt; instead. The full script is:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;hljs jsx&#34;&gt;&lt;span class=&#34;hljs-meta&#34;&gt;&amp;quot;use strict&amp;quot;&lt;/span&gt;;

&lt;span class=&#34;hljs-keyword&#34;&gt;const&lt;/span&gt; log = &lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-params&#34;&gt;x&lt;/span&gt; =&amp;gt;&lt;/span&gt; host.diagnostics.debugLog(x)

&lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;function&lt;/span&gt; &lt;span class=&#34;hljs-title&#34;&gt;initializeScript&lt;/span&gt;(&lt;span class=&#34;hljs-params&#34;&gt;&lt;/span&gt;)&lt;/span&gt;
&lt;span class=&#34;hljs-function&#34;&gt;&lt;/span&gt;{
    &lt;span class=&#34;hljs-keyword&#34;&gt;return&lt;/span&gt; [&lt;span class=&#34;hljs-keyword&#34;&gt;new&lt;/span&gt; host.apiVersionSupport(&lt;span class=&#34;hljs-number&#34;&gt;1&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;9&lt;/span&gt;)];
}

&lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;function&lt;/span&gt; &lt;span class=&#34;hljs-title&#34;&gt;getNode&lt;/span&gt;(&lt;span class=&#34;hljs-params&#34;&gt;addr&lt;/span&gt;)&lt;/span&gt;{
    &lt;span class=&#34;hljs-keyword&#34;&gt;var&lt;/span&gt; node = host.memory.readMemoryValues(addr, &lt;span class=&#34;hljs-number&#34;&gt;3&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;8&lt;/span&gt;)
    &lt;span class=&#34;hljs-keyword&#34;&gt;return&lt;/span&gt; {
        &lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;word&amp;quot;&lt;/span&gt;: node[&lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;],
        &lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;left&amp;quot;&lt;/span&gt;: node[&lt;span class=&#34;hljs-number&#34;&gt;1&lt;/span&gt;],
        &lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;right&amp;quot;&lt;/span&gt;: node[&lt;span class=&#34;hljs-number&#34;&gt;2&lt;/span&gt;]
    }
}

&lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;function&lt;/span&gt; &lt;span class=&#34;hljs-title&#34;&gt;traverse&lt;/span&gt;(&lt;span class=&#34;hljs-params&#34;&gt;node&lt;/span&gt;)&lt;/span&gt;{
    &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt;(node[&lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;left&amp;quot;&lt;/span&gt;] != &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;) traverse(getNode(node[&lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;left&amp;quot;&lt;/span&gt;]))
    log(host.memory.readString(node[&lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;word&amp;quot;&lt;/span&gt;]) + &lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;\n&amp;quot;&lt;/span&gt;)
    &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt;(node[&lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;right&amp;quot;&lt;/span&gt;] != &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;) traverse(getNode(node[&lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;right&amp;quot;&lt;/span&gt;]))
}

&lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;function&lt;/span&gt; &lt;span class=&#34;hljs-title&#34;&gt;invokeScript&lt;/span&gt;(&lt;span class=&#34;hljs-params&#34;&gt;&lt;/span&gt;)&lt;/span&gt;
&lt;span class=&#34;hljs-function&#34;&gt;&lt;/span&gt;{
    traverse(getNode(&lt;span class=&#34;hljs-number&#34;&gt;0x25DD2C211C0&lt;/span&gt;))
}&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;If you want to go beyond simple printing and, say, find the address where specific data is located, just add a condition and print it out:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;hljs jsx&#34;&gt;&lt;span class=&#34;hljs-meta&#34;&gt;&amp;quot;use strict&amp;quot;&lt;/span&gt;;

&lt;span class=&#34;hljs-keyword&#34;&gt;const&lt;/span&gt; log = &lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-params&#34;&gt;x&lt;/span&gt; =&amp;gt;&lt;/span&gt; host.diagnostics.debugLog(x)
&lt;span class=&#34;hljs-keyword&#34;&gt;const&lt;/span&gt; dat = &lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;melon&amp;quot;&lt;/span&gt;

&lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;function&lt;/span&gt; &lt;span class=&#34;hljs-title&#34;&gt;initializeScript&lt;/span&gt;(&lt;span class=&#34;hljs-params&#34;&gt;&lt;/span&gt;)&lt;/span&gt;
&lt;span class=&#34;hljs-function&#34;&gt;&lt;/span&gt;{
    &lt;span class=&#34;hljs-keyword&#34;&gt;return&lt;/span&gt; [&lt;span class=&#34;hljs-keyword&#34;&gt;new&lt;/span&gt; host.apiVersionSupport(&lt;span class=&#34;hljs-number&#34;&gt;1&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;9&lt;/span&gt;)];
}

&lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;function&lt;/span&gt; &lt;span class=&#34;hljs-title&#34;&gt;getNode&lt;/span&gt;(&lt;span class=&#34;hljs-params&#34;&gt;addr&lt;/span&gt;)&lt;/span&gt;{
    &lt;span class=&#34;hljs-keyword&#34;&gt;var&lt;/span&gt; node = host.memory.readMemoryValues(addr, &lt;span class=&#34;hljs-number&#34;&gt;3&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;8&lt;/span&gt;)
    &lt;span class=&#34;hljs-keyword&#34;&gt;return&lt;/span&gt; {
        &lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;word&amp;quot;&lt;/span&gt;: node[&lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;],
        &lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;left&amp;quot;&lt;/span&gt;: node[&lt;span class=&#34;hljs-number&#34;&gt;1&lt;/span&gt;],
        &lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;right&amp;quot;&lt;/span&gt;: node[&lt;span class=&#34;hljs-number&#34;&gt;2&lt;/span&gt;]
    }
}

&lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;function&lt;/span&gt; &lt;span class=&#34;hljs-title&#34;&gt;traverse&lt;/span&gt;(&lt;span class=&#34;hljs-params&#34;&gt;addr&lt;/span&gt;)&lt;/span&gt;{
    &lt;span class=&#34;hljs-keyword&#34;&gt;var&lt;/span&gt; node = getNode(addr)
    &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt;(node[&lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;left&amp;quot;&lt;/span&gt;] != &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;) traverse(node[&lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;left&amp;quot;&lt;/span&gt;])
    &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt;(dat.localeCompare(host.memory.readString(node[&lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;word&amp;quot;&lt;/span&gt;])) == &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;){
        log(&lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;Found at &amp;quot;&lt;/span&gt; + addr.toString(&lt;span class=&#34;hljs-number&#34;&gt;16&lt;/span&gt;) + &lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;\n&amp;quot;&lt;/span&gt;)
    }
    &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt;(node[&lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;right&amp;quot;&lt;/span&gt;] != &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;) traverse(node[&lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;right&amp;quot;&lt;/span&gt;])
}

&lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;function&lt;/span&gt; &lt;span class=&#34;hljs-title&#34;&gt;invokeScript&lt;/span&gt;(&lt;span class=&#34;hljs-params&#34;&gt;&lt;/span&gt;)&lt;/span&gt;
&lt;span class=&#34;hljs-function&#34;&gt;&lt;/span&gt;{
    traverse(&lt;span class=&#34;hljs-number&#34;&gt;0x25DD2C211C0&lt;/span&gt;)
}&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;This script checks whether the string &amp;#x201C;melon&amp;#x201D; is stored, and if so prints its address. Result:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;hljs apache&#34;&gt;&lt;span class=&#34;hljs-attribute&#34;&gt;Found&lt;/span&gt; at &lt;span class=&#34;hljs-number&#34;&gt;25&lt;/span&gt;dd&lt;span class=&#34;hljs-number&#34;&gt;2&lt;/span&gt;c&lt;span class=&#34;hljs-number&#34;&gt;21280&lt;/span&gt;
&lt;span class=&#34;hljs-attribute&#34;&gt;0&lt;/span&gt;:&lt;span class=&#34;hljs-number&#34;&gt;004&lt;/span&gt;&amp;gt; da poi(&lt;span class=&#34;hljs-number&#34;&gt;25&lt;/span&gt;dd&lt;span class=&#34;hljs-number&#34;&gt;2&lt;/span&gt;c&lt;span class=&#34;hljs-number&#34;&gt;21280&lt;/span&gt;)
&lt;span class=&#34;hljs-attribute&#34;&gt;0000025d&lt;/span&gt;`d&lt;span class=&#34;hljs-number&#34;&gt;2&lt;/span&gt;c&lt;span class=&#34;hljs-number&#34;&gt;19360&lt;/span&gt;  &lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;melon&amp;quot;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;2-TTD&#34;&gt;&lt;a href=&#34;#2-TTD&#34; class=&#34;headerlink&#34; title=&#34;2. TTD&#34;&gt;&lt;/a&gt;2. TTD&lt;/h2&gt;&lt;p&gt;We&amp;#x2019;ve used an &lt;strong&gt;imperative&lt;/strong&gt; script, so now it&amp;#x2019;s the &lt;strong&gt;extension&lt;/strong&gt;&amp;#x2019;s turn. For the extension example, here&amp;#x2019;s a simple script I always use with TTD:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;hljs jsx&#34;&gt;&lt;span class=&#34;hljs-meta&#34;&gt;&amp;apos;use strict&amp;apos;&lt;/span&gt;;

&lt;span class=&#34;hljs-keyword&#34;&gt;const&lt;/span&gt; log = host.diagnostics.debugLog;
&lt;span class=&#34;hljs-keyword&#34;&gt;const&lt;/span&gt; logln = &lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-params&#34;&gt;p&lt;/span&gt; =&amp;gt;&lt;/span&gt; host.diagnostics.debugLog(p + &lt;span class=&#34;hljs-string&#34;&gt;&amp;apos;\n&amp;apos;&lt;/span&gt;);
&lt;span class=&#34;hljs-keyword&#34;&gt;const&lt;/span&gt; hex = &lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-params&#34;&gt;p&lt;/span&gt; =&amp;gt;&lt;/span&gt; p.toString(&lt;span class=&#34;hljs-number&#34;&gt;16&lt;/span&gt;);

&lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;function&lt;/span&gt; &lt;span class=&#34;hljs-title&#34;&gt;__calls&lt;/span&gt;(&lt;span class=&#34;hljs-params&#34;&gt;...args&lt;/span&gt;)&lt;/span&gt;{
	&lt;span class=&#34;hljs-keyword&#34;&gt;return&lt;/span&gt; host.currentSession.TTD.Calls(...args)
}

&lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;function&lt;/span&gt; &lt;span class=&#34;hljs-title&#34;&gt;__memory&lt;/span&gt;(&lt;span class=&#34;hljs-params&#34;&gt;...args&lt;/span&gt;)&lt;/span&gt;{
	&lt;span class=&#34;hljs-keyword&#34;&gt;return&lt;/span&gt; host.currentSession.TTD.Memory(...args)
}

&lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;function&lt;/span&gt; &lt;span class=&#34;hljs-title&#34;&gt;__memoryforpositionrange&lt;/span&gt;(&lt;span class=&#34;hljs-params&#34;&gt;...args&lt;/span&gt;)&lt;/span&gt;
&lt;span class=&#34;hljs-function&#34;&gt;&lt;/span&gt;{
	&lt;span class=&#34;hljs-keyword&#34;&gt;return&lt;/span&gt; host.currentSession.TTD.MemoryForPositionRange(...args);
}

&lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;function&lt;/span&gt; &lt;span class=&#34;hljs-title&#34;&gt;ttdParsePosition&lt;/span&gt;(&lt;span class=&#34;hljs-params&#34;&gt;pos&lt;/span&gt;)&lt;/span&gt;{
	&lt;span class=&#34;hljs-keyword&#34;&gt;var&lt;/span&gt; sequence = &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;
	&lt;span class=&#34;hljs-keyword&#34;&gt;var&lt;/span&gt; steps = &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;
	&lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt;(&lt;span class=&#34;hljs-keyword&#34;&gt;typeof&lt;/span&gt;(pos) == &lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;string&amp;quot;&lt;/span&gt;){
		sequence = &lt;span class=&#34;hljs-built_in&#34;&gt;parseInt&lt;/span&gt;(pos.split(&lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;:&amp;quot;&lt;/span&gt;)[&lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;], &lt;span class=&#34;hljs-number&#34;&gt;16&lt;/span&gt;)
		steps = &lt;span class=&#34;hljs-built_in&#34;&gt;parseInt&lt;/span&gt;(pos.split(&lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;:&amp;quot;&lt;/span&gt;)[&lt;span class=&#34;hljs-number&#34;&gt;1&lt;/span&gt;], &lt;span class=&#34;hljs-number&#34;&gt;16&lt;/span&gt;)
	}
	&lt;span class=&#34;hljs-keyword&#34;&gt;else&lt;/span&gt;{
		sequence = pos.Sequence
		steps = pos.Steps
	}

	&lt;span class=&#34;hljs-keyword&#34;&gt;return&lt;/span&gt; {
		Sequence: sequence,
		Steps: steps
	}
}

&lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;function&lt;/span&gt; &lt;span class=&#34;hljs-title&#34;&gt;__ttd_position_compare&lt;/span&gt;(&lt;span class=&#34;hljs-params&#34;&gt;pos1, pos2&lt;/span&gt;)&lt;/span&gt;{
	&lt;span class=&#34;hljs-comment&#34;&gt;/*&lt;/span&gt;
&lt;span class=&#34;hljs-comment&#34;&gt;	alias: poscmp&lt;/span&gt;
&lt;span class=&#34;hljs-comment&#34;&gt;	parameters:&lt;/span&gt;
&lt;span class=&#34;hljs-comment&#34;&gt;		pos1 &amp;amp; pos2: Position object or string(Sequence:Steps in hexadicimal)&lt;/span&gt;
&lt;span class=&#34;hljs-comment&#34;&gt;	usage:&lt;/span&gt;
&lt;span class=&#34;hljs-comment&#34;&gt;		&amp;gt; !poscmp(pos1, pos2)&lt;/span&gt;
&lt;span class=&#34;hljs-comment&#34;&gt;		&amp;gt; dx @$poscmp(pos1, pos2)&lt;/span&gt;
&lt;span class=&#34;hljs-comment&#34;&gt;	example:&lt;/span&gt;
&lt;span class=&#34;hljs-comment&#34;&gt;		&amp;gt; dx @$calls(&amp;quot;function&amp;quot;).Where(x =&amp;gt; @$poscmp(&amp;quot;17C83A:1777&amp;quot;, x.TimeStart) &amp;lt; 0).Where(x =&amp;gt; @$poscmp(&amp;quot;17C861:1B3A&amp;quot;, x.TimeEnd) &amp;gt; 0)&lt;/span&gt;
&lt;span class=&#34;hljs-comment&#34;&gt;		=&amp;gt; get all `function` calls between 17C83A:1777 and 17C861:1B3A&lt;/span&gt;
&lt;span class=&#34;hljs-comment&#34;&gt;	*/&lt;/span&gt;

	pos1 = ttdParsePosition(pos1)
	pos2 = ttdParsePosition(pos2)

	&lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt;(pos1.Sequence != pos2.Sequence){
		&lt;span class=&#34;hljs-keyword&#34;&gt;return&lt;/span&gt; pos1.Sequence - pos2.Sequence
	}

	&lt;span class=&#34;hljs-keyword&#34;&gt;return&lt;/span&gt; pos1.Steps - pos2.Steps
	
}

&lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;function&lt;/span&gt; &lt;span class=&#34;hljs-title&#34;&gt;__d&lt;/span&gt;(&lt;span class=&#34;hljs-params&#34;&gt;...args&lt;/span&gt;)&lt;/span&gt;{
	&lt;span class=&#34;hljs-keyword&#34;&gt;return&lt;/span&gt; host.memory.readMemoryValues(...args)
}

&lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;function&lt;/span&gt; &lt;span class=&#34;hljs-title&#34;&gt;initializeScript&lt;/span&gt;(&lt;span class=&#34;hljs-params&#34;&gt;&lt;/span&gt;) &lt;/span&gt;{
    &lt;span class=&#34;hljs-keyword&#34;&gt;return&lt;/span&gt; [
        &lt;span class=&#34;hljs-keyword&#34;&gt;new&lt;/span&gt; host.apiVersionSupport(&lt;span class=&#34;hljs-number&#34;&gt;1&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;2&lt;/span&gt;),
        &lt;span class=&#34;hljs-keyword&#34;&gt;new&lt;/span&gt; host.functionAlias(
            __calls,
            &lt;span class=&#34;hljs-string&#34;&gt;&amp;apos;calls&amp;apos;&lt;/span&gt;
        ),
		&lt;span class=&#34;hljs-keyword&#34;&gt;new&lt;/span&gt; host.functionAlias(
			__memory,
			&lt;span class=&#34;hljs-string&#34;&gt;&amp;apos;memory&amp;apos;&lt;/span&gt;
		),
		&lt;span class=&#34;hljs-keyword&#34;&gt;new&lt;/span&gt; host.functionAlias(
			__memoryforpositionrange,
			&lt;span class=&#34;hljs-string&#34;&gt;&amp;apos;memoryrange&amp;apos;&lt;/span&gt;
		),
		&lt;span class=&#34;hljs-keyword&#34;&gt;new&lt;/span&gt; host.functionAlias(
			__ttd_position_compare,
			&lt;span class=&#34;hljs-string&#34;&gt;&amp;apos;poscmp&amp;apos;&lt;/span&gt;
		),
		&lt;span class=&#34;hljs-keyword&#34;&gt;new&lt;/span&gt; host.functionAlias(
			__d,
			&lt;span class=&#34;hljs-string&#34;&gt;&amp;apos;d&amp;apos;&lt;/span&gt;
		)
    ];
}&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;See the main difference from an &lt;strong&gt;imperative&lt;/strong&gt; script? In &lt;code&gt;initializeScript&lt;/code&gt; I create aliases with &lt;code&gt;host.functionAlias&lt;/code&gt;. An extension registers JavaScript functions as aliases so they can be used directly at the command line.&lt;/p&gt;
&lt;p&gt;I shorten the frequently used &lt;code&gt;@$cursession.TTD.Calls&lt;/code&gt; and &lt;code&gt;@$cursession.TTD.Memory&lt;/code&gt; to &lt;code&gt;@$calls&lt;/code&gt; and &lt;code&gt;@$memory&lt;/code&gt; to save my fingers &amp;#x1F60E;&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;hljs jsx&#34;&gt;&lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;function&lt;/span&gt; &lt;span class=&#34;hljs-title&#34;&gt;__calls&lt;/span&gt;(&lt;span class=&#34;hljs-params&#34;&gt;...args&lt;/span&gt;)&lt;/span&gt;{
	&lt;span class=&#34;hljs-keyword&#34;&gt;return&lt;/span&gt; host.currentSession.TTD.Calls(...args)
}

&lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;function&lt;/span&gt; &lt;span class=&#34;hljs-title&#34;&gt;__memory&lt;/span&gt;(&lt;span class=&#34;hljs-params&#34;&gt;...args&lt;/span&gt;)&lt;/span&gt;{
	&lt;span class=&#34;hljs-keyword&#34;&gt;return&lt;/span&gt; host.currentSession.TTD.Memory(...args)
}&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;So where do we use this?&lt;/p&gt;
&lt;h3 id=&#34;TTD-Calls-amp-Memory&#34;&gt;&lt;a href=&#34;#TTD-Calls-amp-Memory&#34; class=&#34;headerlink&#34; title=&#34;TTD Calls &amp;amp; Memory&#34;&gt;&lt;/a&gt;TTD Calls &amp;amp; Memory&lt;/h3&gt;&lt;p&gt;&lt;a href=&#34;https://hackyboiz.github.io/2021/03/14/fabu1ous/ttd-3/#Filtering-in-a-query&#34;&gt;The Time-Traveling Hacker&amp;#x2019;s Guide&lt;/a&gt; by Fabu1ous briefly explains Calls and Memory, but only skims over what you can do. Let&amp;#x2019;s see how to use them through an example.&lt;/p&gt;
&lt;p&gt;First, load the extension with the script below:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;hljs routeros&#34;&gt;0:038&amp;gt; .scriptload utils.js
JavaScript&lt;span class=&#34;hljs-built_in&#34;&gt; script &lt;/span&gt;successfully loaded &lt;span class=&#34;hljs-keyword&#34;&gt;from&lt;/span&gt; &lt;span class=&#34;hljs-string&#34;&gt;&amp;apos;D:\windbg_Ext\utils.js&amp;apos;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Then you can access Calls and Memory like this:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;hljs angelscript&#34;&gt;&lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;:&lt;span class=&#34;hljs-number&#34;&gt;000&lt;/span&gt;&amp;gt; !calls &lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;kernelbase!CreateFileW&amp;quot;&lt;/span&gt;
@$calls(&lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;kernelbase!CreateFileW&amp;quot;&lt;/span&gt;)                
    [&lt;span class=&#34;hljs-number&#34;&gt;0x0&lt;/span&gt;]           
    [&lt;span class=&#34;hljs-number&#34;&gt;0x1&lt;/span&gt;]           
    ...
&lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;:&lt;span class=&#34;hljs-number&#34;&gt;000&lt;/span&gt;&amp;gt; dx @$calls(&lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;kernelbase!CreateFileW&amp;quot;&lt;/span&gt;)[&lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;]
@$calls(&lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;kernelbase!CreateFileW&amp;quot;&lt;/span&gt;)[&lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;]                
    EventType        : &lt;span class=&#34;hljs-number&#34;&gt;0x0&lt;/span&gt;
    ThreadId         : &lt;span class=&#34;hljs-number&#34;&gt;0xe5c&lt;/span&gt;
    UniqueThreadId   : &lt;span class=&#34;hljs-number&#34;&gt;0x2&lt;/span&gt;
    TimeStart        : &lt;span class=&#34;hljs-number&#34;&gt;6&lt;/span&gt;F4F:&lt;span class=&#34;hljs-number&#34;&gt;1742&lt;/span&gt; [Time Travel]
    TimeEnd          : &lt;span class=&#34;hljs-number&#34;&gt;6&lt;/span&gt;F57:&lt;span class=&#34;hljs-number&#34;&gt;7E3&lt;/span&gt; [Time Travel]
    Function         : kernelbase!CreateFileW
    FunctionAddress  : &lt;span class=&#34;hljs-number&#34;&gt;0x7ffbf27f05f0&lt;/span&gt;
    ReturnAddress    : &lt;span class=&#34;hljs-number&#34;&gt;0x7ffbf2835846&lt;/span&gt;
    ReturnValue      : &lt;span class=&#34;hljs-number&#34;&gt;0x31c&lt;/span&gt;
    Parameters      
    SystemTimeStart  : Fri May &lt;span class=&#34;hljs-number&#34;&gt;30&lt;/span&gt; &lt;span class=&#34;hljs-number&#34;&gt;2025&lt;/span&gt; &lt;span class=&#34;hljs-number&#34;&gt;09&lt;/span&gt;:&lt;span class=&#34;hljs-number&#34;&gt;13&lt;/span&gt;:&lt;span class=&#34;hljs-number&#34;&gt;24.782&lt;/span&gt;
    SystemTimeEnd    : Fri May &lt;span class=&#34;hljs-number&#34;&gt;30&lt;/span&gt; &lt;span class=&#34;hljs-number&#34;&gt;2025&lt;/span&gt; &lt;span class=&#34;hljs-number&#34;&gt;09&lt;/span&gt;:&lt;span class=&#34;hljs-number&#34;&gt;13&lt;/span&gt;:&lt;span class=&#34;hljs-number&#34;&gt;24.782&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;code&gt;!calls&lt;/code&gt; does not let you directly index the returned array, so I more often use &lt;code&gt;dx @$calls&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Now let&amp;#x2019;s take a TTD recording of the example below and see what we can do.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;hljs c&#34;&gt;&lt;span class=&#34;hljs-meta&#34;&gt;#&lt;span class=&#34;hljs-meta-keyword&#34;&gt;include&lt;/span&gt; &lt;span class=&#34;hljs-meta-string&#34;&gt;&amp;lt;iostream&amp;gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&#34;hljs-meta&#34;&gt;#&lt;span class=&#34;hljs-meta-keyword&#34;&gt;include&lt;/span&gt; &lt;span class=&#34;hljs-meta-string&#34;&gt;&amp;lt;vector&amp;gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&#34;hljs-meta&#34;&gt;#&lt;span class=&#34;hljs-meta-keyword&#34;&gt;include&lt;/span&gt; &lt;span class=&#34;hljs-meta-string&#34;&gt;&amp;lt;memory&amp;gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&#34;hljs-meta&#34;&gt;#&lt;span class=&#34;hljs-meta-keyword&#34;&gt;include&lt;/span&gt; &lt;span class=&#34;hljs-meta-string&#34;&gt;&amp;lt;random&amp;gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&#34;hljs-meta&#34;&gt;#&lt;span class=&#34;hljs-meta-keyword&#34;&gt;include&lt;/span&gt; &lt;span class=&#34;hljs-meta-string&#34;&gt;&amp;lt;cstdlib&amp;gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&#34;hljs-meta&#34;&gt;#&lt;span class=&#34;hljs-meta-keyword&#34;&gt;include&lt;/span&gt; &lt;span class=&#34;hljs-meta-string&#34;&gt;&amp;lt;ctime&amp;gt;&lt;/span&gt;&lt;/span&gt;

&lt;span class=&#34;hljs-comment&#34;&gt;// Base class&lt;/span&gt;
&lt;span class=&#34;hljs-class&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;hljs-title&#34;&gt;BaseProcessor&lt;/span&gt; {&lt;/span&gt;
&lt;span class=&#34;hljs-keyword&#34;&gt;public&lt;/span&gt;:
    &lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;virtual&lt;/span&gt; &lt;span class=&#34;hljs-keyword&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;hljs-title&#34;&gt;process&lt;/span&gt;&lt;span class=&#34;hljs-params&#34;&gt;(&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; value)&lt;/span&gt; &lt;/span&gt;= &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;;
    &lt;span class=&#34;hljs-keyword&#34;&gt;virtual&lt;/span&gt; ~BaseProcessor() = &lt;span class=&#34;hljs-keyword&#34;&gt;default&lt;/span&gt;;
};

&lt;span class=&#34;hljs-comment&#34;&gt;// Derived class with actual behavior&lt;/span&gt;
&lt;span class=&#34;hljs-class&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;hljs-title&#34;&gt;ConcreteProcessor&lt;/span&gt; :&lt;/span&gt; &lt;span class=&#34;hljs-keyword&#34;&gt;public&lt;/span&gt; BaseProcessor {
&lt;span class=&#34;hljs-keyword&#34;&gt;public&lt;/span&gt;:
    &lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;hljs-title&#34;&gt;process&lt;/span&gt;&lt;span class=&#34;hljs-params&#34;&gt;(&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; value)&lt;/span&gt; &lt;span class=&#34;hljs-keyword&#34;&gt;override&lt;/span&gt; &lt;/span&gt;{
        &lt;span class=&#34;hljs-comment&#34;&gt;// Dummy operation to prevent optimization&lt;/span&gt;
        &lt;span class=&#34;hljs-keyword&#34;&gt;volatile&lt;/span&gt; &lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; sink = value;
        (&lt;span class=&#34;hljs-keyword&#34;&gt;void&lt;/span&gt;)sink; &lt;span class=&#34;hljs-comment&#34;&gt;// Prevent unused variable warning&lt;/span&gt;
    }
};

&lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;hljs-title&#34;&gt;main&lt;/span&gt;&lt;span class=&#34;hljs-params&#34;&gt;()&lt;/span&gt; &lt;/span&gt;{
    &lt;span class=&#34;hljs-built_in&#34;&gt;std&lt;/span&gt;::srand(&lt;span class=&#34;hljs-keyword&#34;&gt;static_cast&lt;/span&gt;&amp;lt;&lt;span class=&#34;hljs-keyword&#34;&gt;unsigned&lt;/span&gt; &lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt;&amp;gt;(&lt;span class=&#34;hljs-built_in&#34;&gt;std&lt;/span&gt;::time(&lt;span class=&#34;hljs-literal&#34;&gt;nullptr&lt;/span&gt;)));
    &lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-built_in&#34;&gt;std&lt;/span&gt;::mt19937 &lt;span class=&#34;hljs-title&#34;&gt;rng&lt;/span&gt;&lt;span class=&#34;hljs-params&#34;&gt;(&lt;span class=&#34;hljs-built_in&#34;&gt;std&lt;/span&gt;::random_device{}())&lt;/span&gt;&lt;/span&gt;;
    &lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-built_in&#34;&gt;std&lt;/span&gt;::uniform_int_distribution&amp;lt;&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt;&amp;gt; &lt;span class=&#34;hljs-title&#34;&gt;distIndex&lt;/span&gt;&lt;span class=&#34;hljs-params&#34;&gt;(&lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;9&lt;/span&gt;)&lt;/span&gt;&lt;/span&gt;;
    &lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-built_in&#34;&gt;std&lt;/span&gt;::uniform_int_distribution&amp;lt;&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt;&amp;gt; &lt;span class=&#34;hljs-title&#34;&gt;distValue&lt;/span&gt;&lt;span class=&#34;hljs-params&#34;&gt;(&lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;1000&lt;/span&gt;)&lt;/span&gt;&lt;/span&gt;;

    &lt;span class=&#34;hljs-comment&#34;&gt;// Create at least 10 instances&lt;/span&gt;
    &lt;span class=&#34;hljs-built_in&#34;&gt;std&lt;/span&gt;::&lt;span class=&#34;hljs-built_in&#34;&gt;vector&lt;/span&gt;&amp;lt;&lt;span class=&#34;hljs-built_in&#34;&gt;std&lt;/span&gt;::&lt;span class=&#34;hljs-built_in&#34;&gt;unique_ptr&lt;/span&gt;&amp;lt;BaseProcessor&amp;gt;&amp;gt; processors;
    &lt;span class=&#34;hljs-keyword&#34;&gt;for&lt;/span&gt; (&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; i = &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;; i &amp;lt; &lt;span class=&#34;hljs-number&#34;&gt;10&lt;/span&gt;; ++i) {
        processors.push_back(&lt;span class=&#34;hljs-built_in&#34;&gt;std&lt;/span&gt;::make_unique&amp;lt;ConcreteProcessor&amp;gt;());
    }

    &lt;span class=&#34;hljs-comment&#34;&gt;// Call virtual function 100 times with random instance and value&lt;/span&gt;
    &lt;span class=&#34;hljs-keyword&#34;&gt;for&lt;/span&gt; (&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; i = &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;; i &amp;lt; &lt;span class=&#34;hljs-number&#34;&gt;100&lt;/span&gt;; ++i) {
        &lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; idx = distIndex(rng);
        &lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; value = distValue(rng);
        processors[idx]-&amp;gt;process(value);
    }

    &lt;span class=&#34;hljs-comment&#34;&gt;// Wait for user input&lt;/span&gt;
    &lt;span class=&#34;hljs-built_in&#34;&gt;std&lt;/span&gt;::&lt;span class=&#34;hljs-built_in&#34;&gt;cout&lt;/span&gt; &amp;lt;&amp;lt; &lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;All calls completed. Press Enter to exit...&amp;quot;&lt;/span&gt;;
    &lt;span class=&#34;hljs-built_in&#34;&gt;std&lt;/span&gt;::&lt;span class=&#34;hljs-built_in&#34;&gt;cin&lt;/span&gt;.get();

    &lt;span class=&#34;hljs-keyword&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;;
}&lt;/code&gt;&lt;/pre&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;del&gt;It&amp;#x2019;s no secret that ChatGPT wrote this too&lt;/del&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;The code creates 10 instances, calls a virtual function 100 times, chooses random values and random instances, then waits.&lt;/p&gt;
&lt;p&gt;Though extreme, I often face similar situations while analyzing.&lt;br&gt;My main purposes for using Calls and Memory are:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Only function calls made by a specific instance  &lt;/li&gt;
&lt;li&gt;Filtering by return value or argument  &lt;/li&gt;
&lt;li&gt;Filtering calls or memory accesses before/after a given TTD position&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;First, check how many times the function was called:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;hljs arcade&#34;&gt;&lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;:&lt;span class=&#34;hljs-number&#34;&gt;000&lt;/span&gt;&amp;gt; dx @&lt;span class=&#34;hljs-symbol&#34;&gt;$calls&lt;/span&gt;(&lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;TTDCalls!ConcreteProcessor::process&amp;quot;&lt;/span&gt;).&lt;span class=&#34;hljs-built_in&#34;&gt;Count&lt;/span&gt;()
@&lt;span class=&#34;hljs-symbol&#34;&gt;$calls&lt;/span&gt;(&lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;TTDCalls!ConcreteProcessor::process&amp;quot;&lt;/span&gt;).&lt;span class=&#34;hljs-built_in&#34;&gt;Count&lt;/span&gt;() : &lt;span class=&#34;hljs-number&#34;&gt;0x64&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;That&amp;#x2019;s 100 times. To see only calls made by the 5th instance, we first need that instance&amp;#x2019;s address. Because it&amp;#x2019;s created with &lt;code&gt;std::make_unique&lt;/code&gt; (inlined), we can&amp;#x2019;t directly list constructor calls.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;hljs angelscript&#34;&gt;&lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;:&lt;span class=&#34;hljs-number&#34;&gt;000&lt;/span&gt;&amp;gt; u TTDCalls!main+b0
TTDCalls!std::make_unique [C:\Program Files\Microsoft Visual Studio\&lt;span class=&#34;hljs-number&#34;&gt;2022&lt;/span&gt;\Community\VC\Tools\MSVC\&lt;span class=&#34;hljs-number&#34;&gt;14.41&lt;/span&gt;&lt;span class=&#34;hljs-number&#34;&gt;.34120&lt;/span&gt;\include\memory @ &lt;span class=&#34;hljs-number&#34;&gt;3597&lt;/span&gt;] [inlined &lt;span class=&#34;hljs-keyword&#34;&gt;in&lt;/span&gt; TTDCalls!main+&lt;span class=&#34;hljs-number&#34;&gt;0xb0&lt;/span&gt; [D:\Src\WindbgExamplePrograms\TTDCalls\main.cpp @ &lt;span class=&#34;hljs-number&#34;&gt;34&lt;/span&gt;]]:
&lt;span class=&#34;hljs-number&#34;&gt;00007f&lt;/span&gt;f7`&lt;span class=&#34;hljs-number&#34;&gt;84&lt;/span&gt;d91260 b908000000      mov     ecx,&lt;span class=&#34;hljs-number&#34;&gt;8&lt;/span&gt;
&lt;span class=&#34;hljs-number&#34;&gt;00007f&lt;/span&gt;f7`&lt;span class=&#34;hljs-number&#34;&gt;84&lt;/span&gt;d91265 e8c6080000      call    TTDCalls!operator new (&lt;span class=&#34;hljs-number&#34;&gt;00007f&lt;/span&gt;f7`&lt;span class=&#34;hljs-number&#34;&gt;84&lt;/span&gt;d91b30)
&lt;span class=&#34;hljs-number&#34;&gt;00007f&lt;/span&gt;f7`&lt;span class=&#34;hljs-number&#34;&gt;84&lt;/span&gt;d9126a &lt;span class=&#34;hljs-number&#34;&gt;488930&lt;/span&gt;          mov     qword ptr [rax],rsi
&lt;span class=&#34;hljs-number&#34;&gt;00007f&lt;/span&gt;f7`&lt;span class=&#34;hljs-number&#34;&gt;84&lt;/span&gt;d9126d &lt;span class=&#34;hljs-number&#34;&gt;4889442420&lt;/span&gt;      mov     qword ptr [rsp+&lt;span class=&#34;hljs-number&#34;&gt;20&lt;/span&gt;h],rax
&lt;span class=&#34;hljs-number&#34;&gt;00007f&lt;/span&gt;f7`&lt;span class=&#34;hljs-number&#34;&gt;84&lt;/span&gt;d91272 &lt;span class=&#34;hljs-number&#34;&gt;488&lt;/span&gt;b542438      mov     rdx,qword ptr [rsp+&lt;span class=&#34;hljs-number&#34;&gt;38&lt;/span&gt;h]
&lt;span class=&#34;hljs-number&#34;&gt;00007f&lt;/span&gt;f7`&lt;span class=&#34;hljs-number&#34;&gt;84&lt;/span&gt;d91277 &lt;span class=&#34;hljs-number&#34;&gt;483&lt;/span&gt;b542440      cmp     rdx,qword ptr [rsp+&lt;span class=&#34;hljs-number&#34;&gt;40&lt;/span&gt;h]
&lt;span class=&#34;hljs-number&#34;&gt;00007f&lt;/span&gt;f7`&lt;span class=&#34;hljs-number&#34;&gt;84&lt;/span&gt;d9127c &lt;span class=&#34;hljs-number&#34;&gt;740&lt;/span&gt;e            je      TTDCalls!main+&lt;span class=&#34;hljs-number&#34;&gt;0xdc&lt;/span&gt; (&lt;span class=&#34;hljs-number&#34;&gt;00007f&lt;/span&gt;f7`&lt;span class=&#34;hljs-number&#34;&gt;84&lt;/span&gt;d9128c)
&lt;span class=&#34;hljs-number&#34;&gt;00007f&lt;/span&gt;f7`&lt;span class=&#34;hljs-number&#34;&gt;84&lt;/span&gt;d9127e &lt;span class=&#34;hljs-number&#34;&gt;488&lt;/span&gt;bcf          mov     rcx,rdi&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;But we can list executions of the &lt;code&gt;operator new&lt;/code&gt; instruction and pick the 5th one:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;hljs angelscript&#34;&gt;&lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;:&lt;span class=&#34;hljs-number&#34;&gt;000&lt;/span&gt;&amp;gt; dx @$memory(&lt;span class=&#34;hljs-number&#34;&gt;0x7ff784d91265&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;0x7ff784d91265&lt;/span&gt;+&lt;span class=&#34;hljs-number&#34;&gt;1&lt;/span&gt;, &lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;e&amp;quot;&lt;/span&gt;)[&lt;span class=&#34;hljs-number&#34;&gt;4&lt;/span&gt;]
@$memory(&lt;span class=&#34;hljs-number&#34;&gt;0x7ff784d91265&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;0x7ff784d91265&lt;/span&gt;+&lt;span class=&#34;hljs-number&#34;&gt;1&lt;/span&gt;, &lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;e&amp;quot;&lt;/span&gt;)[&lt;span class=&#34;hljs-number&#34;&gt;4&lt;/span&gt;]                
    EventType        : &lt;span class=&#34;hljs-number&#34;&gt;0x1&lt;/span&gt;
    ThreadId         : &lt;span class=&#34;hljs-number&#34;&gt;0x567c&lt;/span&gt;
    UniqueThreadId   : &lt;span class=&#34;hljs-number&#34;&gt;0x2&lt;/span&gt;
    TimeStart        : &lt;span class=&#34;hljs-number&#34;&gt;4&lt;/span&gt;D8:&lt;span class=&#34;hljs-number&#34;&gt;24&lt;/span&gt;A2 [Time Travel]
    TimeEnd          : &lt;span class=&#34;hljs-number&#34;&gt;4&lt;/span&gt;D8:&lt;span class=&#34;hljs-number&#34;&gt;24&lt;/span&gt;A2 [Time Travel]
    AccessType       : Execute
    IP               : &lt;span class=&#34;hljs-number&#34;&gt;0x7ff784d91265&lt;/span&gt;
    Address          : &lt;span class=&#34;hljs-number&#34;&gt;0x7ff784d91265&lt;/span&gt;
    Size             : &lt;span class=&#34;hljs-number&#34;&gt;0x5&lt;/span&gt;
    Value            : &lt;span class=&#34;hljs-number&#34;&gt;0x8c6e8&lt;/span&gt;
    SystemTimeStart  : &lt;span class=&#34;hljs-number&#34;&gt;2025&lt;/span&gt;&amp;#xB144; &lt;span class=&#34;hljs-number&#34;&gt;5&lt;/span&gt;&amp;#xC6D4; &lt;span class=&#34;hljs-number&#34;&gt;31&lt;/span&gt;&amp;#xC77C; &amp;#xD1A0;&amp;#xC694;&amp;#xC77C; &lt;span class=&#34;hljs-number&#34;&gt;12&lt;/span&gt;:&lt;span class=&#34;hljs-number&#34;&gt;24&lt;/span&gt;:&lt;span class=&#34;hljs-number&#34;&gt;28.628&lt;/span&gt;
    SystemTimeEnd    : &lt;span class=&#34;hljs-number&#34;&gt;2025&lt;/span&gt;&amp;#xB144; &lt;span class=&#34;hljs-number&#34;&gt;5&lt;/span&gt;&amp;#xC6D4; &lt;span class=&#34;hljs-number&#34;&gt;31&lt;/span&gt;&amp;#xC77C; &amp;#xD1A0;&amp;#xC694;&amp;#xC77C; &lt;span class=&#34;hljs-number&#34;&gt;12&lt;/span&gt;:&lt;span class=&#34;hljs-number&#34;&gt;24&lt;/span&gt;:&lt;span class=&#34;hljs-number&#34;&gt;28.628&lt;/span&gt;
&lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;:&lt;span class=&#34;hljs-number&#34;&gt;000&lt;/span&gt;&amp;gt; dx @$memory(&lt;span class=&#34;hljs-number&#34;&gt;0x7ff784d91265&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;0x7ff784d91265&lt;/span&gt;+&lt;span class=&#34;hljs-number&#34;&gt;1&lt;/span&gt;, &lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;e&amp;quot;&lt;/span&gt;)[&lt;span class=&#34;hljs-number&#34;&gt;4&lt;/span&gt;].TimeStart.SeekTo()
(&lt;span class=&#34;hljs-number&#34;&gt;43f&lt;/span&gt;8&lt;span class=&#34;hljs-number&#34;&gt;.567&lt;/span&gt;c): Break instruction exception - code &lt;span class=&#34;hljs-number&#34;&gt;80000003&lt;/span&gt; (first/second chance &lt;span class=&#34;hljs-keyword&#34;&gt;not&lt;/span&gt; available)
Time Travel Position: &lt;span class=&#34;hljs-number&#34;&gt;4&lt;/span&gt;D8:&lt;span class=&#34;hljs-number&#34;&gt;24&lt;/span&gt;A2&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;By looking at the &lt;code&gt;TimeStart&lt;/code&gt; and &lt;code&gt;TimeEnd&lt;/code&gt; fields, we can see when this memory access event started and when it ended. We can jump to that point in time by pressing &lt;code&gt;[Time Travel]&lt;/code&gt; next to the position, or by calling the &lt;code&gt;SeekTo&lt;/code&gt; method of &lt;code&gt;TimeStart&lt;/code&gt; or &lt;code&gt;TimeEnd&lt;/code&gt; directly.&lt;/p&gt;
&lt;p&gt;Now we can determine the address of the fifth instance from the return value of &lt;code&gt;operator new&lt;/code&gt; and use &lt;code&gt;Where&lt;/code&gt; to see only the &lt;code&gt;process&lt;/code&gt; calls of that instance, as shown below, or we can use Calls and access the &lt;code&gt;ReturnValue&lt;/code&gt; field to find out without going to the position.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;hljs angelscript&#34;&gt;&lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;:&lt;span class=&#34;hljs-number&#34;&gt;000&lt;/span&gt;&amp;gt; dx @$memory(&lt;span class=&#34;hljs-number&#34;&gt;0x7ff784d91265&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;0x7ff784d91265&lt;/span&gt;+&lt;span class=&#34;hljs-number&#34;&gt;1&lt;/span&gt;, &lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;e&amp;quot;&lt;/span&gt;)[&lt;span class=&#34;hljs-number&#34;&gt;4&lt;/span&gt;].TimeStart.SeekTo()
(&lt;span class=&#34;hljs-number&#34;&gt;43f&lt;/span&gt;8&lt;span class=&#34;hljs-number&#34;&gt;.567&lt;/span&gt;c): Break instruction exception - code &lt;span class=&#34;hljs-number&#34;&gt;80000003&lt;/span&gt; (first/second chance &lt;span class=&#34;hljs-keyword&#34;&gt;not&lt;/span&gt; available)
Time Travel Position: &lt;span class=&#34;hljs-number&#34;&gt;4&lt;/span&gt;D8:&lt;span class=&#34;hljs-number&#34;&gt;24&lt;/span&gt;A2
&lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;:&lt;span class=&#34;hljs-number&#34;&gt;000&lt;/span&gt;&amp;gt; p
Time Travel Position: &lt;span class=&#34;hljs-number&#34;&gt;4&lt;/span&gt;D8:&lt;span class=&#34;hljs-number&#34;&gt;25&lt;/span&gt;EA
TTDCalls!main+&lt;span class=&#34;hljs-number&#34;&gt;0xba&lt;/span&gt;:
&lt;span class=&#34;hljs-number&#34;&gt;00007f&lt;/span&gt;f7`&lt;span class=&#34;hljs-number&#34;&gt;84&lt;/span&gt;d9126a &lt;span class=&#34;hljs-number&#34;&gt;488930&lt;/span&gt;          mov     qword ptr [rax],rsi ds:&lt;span class=&#34;hljs-number&#34;&gt;000001e0&lt;/span&gt;`&lt;span class=&#34;hljs-number&#34;&gt;00059750&lt;/span&gt;=&lt;span class=&#34;hljs-number&#34;&gt;6562575&lt;/span&gt;c32336d65
&lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;:&lt;span class=&#34;hljs-number&#34;&gt;000&lt;/span&gt;&amp;gt; r rax
rax=&lt;span class=&#34;hljs-number&#34;&gt;000001e000059750&lt;/span&gt;

&lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;:&lt;span class=&#34;hljs-number&#34;&gt;000&lt;/span&gt;&amp;gt; dx @$calls(&lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;TTDCalls!operator new&amp;quot;&lt;/span&gt;).Where(x =&amp;gt; x.ReturnAddress == &lt;span class=&#34;hljs-number&#34;&gt;0x7ff784d9126a&lt;/span&gt;)[&lt;span class=&#34;hljs-number&#34;&gt;0x8&lt;/span&gt;].ReturnValue
@$calls(&lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;TTDCalls!operator new&amp;quot;&lt;/span&gt;).Where(x =&amp;gt; x.ReturnAddress == &lt;span class=&#34;hljs-number&#34;&gt;0x7ff784d9126a&lt;/span&gt;)[&lt;span class=&#34;hljs-number&#34;&gt;0x8&lt;/span&gt;].ReturnValue                 : &lt;span class=&#34;hljs-number&#34;&gt;0x1e000059750&lt;/span&gt; [Type: &lt;span class=&#34;hljs-built_in&#34;&gt;void&lt;/span&gt; *]&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;If you only want to see calls made by a specific instance, you can use the first argument (&lt;code&gt;this&lt;/code&gt;), which is the address of the instance, right? In this example, we have the pdb as well as the source code, so we can also go directly to the name of the parameter instead of the index in &lt;code&gt;Parameters&lt;/code&gt;.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;hljs angelscript&#34;&gt;&lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;:&lt;span class=&#34;hljs-number&#34;&gt;000&lt;/span&gt;&amp;gt; dx @$calls(&lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;TTDCalls!ConcreteProcessor::process&amp;quot;&lt;/span&gt;).Where(x =&amp;gt; x.Parameters[&lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;] == &lt;span class=&#34;hljs-number&#34;&gt;0x1e000059750&lt;/span&gt;)
@$calls(&lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;TTDCalls!ConcreteProcessor::process&amp;quot;&lt;/span&gt;).Where(x =&amp;gt; x.Parameters[&lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;] == &lt;span class=&#34;hljs-number&#34;&gt;0x1e000059750&lt;/span&gt;)                
    [&lt;span class=&#34;hljs-number&#34;&gt;0x6&lt;/span&gt;]           
    [&lt;span class=&#34;hljs-number&#34;&gt;0xf&lt;/span&gt;]           
    [&lt;span class=&#34;hljs-number&#34;&gt;0x21&lt;/span&gt;]          
    [&lt;span class=&#34;hljs-number&#34;&gt;0x2a&lt;/span&gt;]          
    [&lt;span class=&#34;hljs-number&#34;&gt;0x2c&lt;/span&gt;]          
    [&lt;span class=&#34;hljs-number&#34;&gt;0x2f&lt;/span&gt;]          
    [&lt;span class=&#34;hljs-number&#34;&gt;0x32&lt;/span&gt;]          
    [&lt;span class=&#34;hljs-number&#34;&gt;0x39&lt;/span&gt;]          
    [&lt;span class=&#34;hljs-number&#34;&gt;0x3f&lt;/span&gt;]          
    [&lt;span class=&#34;hljs-number&#34;&gt;0x43&lt;/span&gt;]          
    [&lt;span class=&#34;hljs-number&#34;&gt;0x57&lt;/span&gt;]          
    [&lt;span class=&#34;hljs-number&#34;&gt;0x5e&lt;/span&gt;]&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Need only the arguments? Pipe to &lt;code&gt;Select(...)&lt;/code&gt; and display with &lt;code&gt;-g&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Of course, you can use other conditions in the &lt;code&gt;Where&lt;/code&gt;, or you can implement the TTD position comparison as an extension and add it as a condition in the &lt;code&gt;Where&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;Putting it all together, you can produce queries like:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;hljs angelscript&#34;&gt;&lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;:&lt;span class=&#34;hljs-number&#34;&gt;000&lt;/span&gt;&amp;gt; dx -r1 @$calls(&lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;TTDCalls!ConcreteProcessor::process&amp;quot;&lt;/span&gt;).Where(x =&amp;gt; x.Parameters.&lt;span class=&#34;hljs-keyword&#34;&gt;this&lt;/span&gt; == &lt;span class=&#34;hljs-number&#34;&gt;0x1e000059750&lt;/span&gt;)[&lt;span class=&#34;hljs-number&#34;&gt;6&lt;/span&gt;]
@$calls(&lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;TTDCalls!ConcreteProcessor::process&amp;quot;&lt;/span&gt;).Where(x =&amp;gt; x.Parameters.&lt;span class=&#34;hljs-keyword&#34;&gt;this&lt;/span&gt; == &lt;span class=&#34;hljs-number&#34;&gt;0x1e000059750&lt;/span&gt;)[&lt;span class=&#34;hljs-number&#34;&gt;6&lt;/span&gt;]                
    EventType        : &lt;span class=&#34;hljs-number&#34;&gt;0x0&lt;/span&gt;
    ThreadId         : &lt;span class=&#34;hljs-number&#34;&gt;0x567c&lt;/span&gt;
    UniqueThreadId   : &lt;span class=&#34;hljs-number&#34;&gt;0x2&lt;/span&gt;
    TimeStart        : &lt;span class=&#34;hljs-number&#34;&gt;4&lt;/span&gt;DA:&lt;span class=&#34;hljs-number&#34;&gt;10&lt;/span&gt;F0 [Time Travel]
    TimeEnd          : &lt;span class=&#34;hljs-number&#34;&gt;4&lt;/span&gt;DA:&lt;span class=&#34;hljs-number&#34;&gt;10&lt;/span&gt;F3 [Time Travel]
    Function         : TTDCalls!ConcreteProcessor::process
    FunctionAddress  : &lt;span class=&#34;hljs-number&#34;&gt;0x7ff784d911a0&lt;/span&gt;
    ReturnAddress    : &lt;span class=&#34;hljs-number&#34;&gt;0x7ff784d9134e&lt;/span&gt;
    Parameters      
    SystemTimeStart  : &lt;span class=&#34;hljs-number&#34;&gt;2025&lt;/span&gt;&amp;#xB144; &lt;span class=&#34;hljs-number&#34;&gt;5&lt;/span&gt;&amp;#xC6D4; &lt;span class=&#34;hljs-number&#34;&gt;31&lt;/span&gt;&amp;#xC77C; &amp;#xD1A0;&amp;#xC694;&amp;#xC77C; &lt;span class=&#34;hljs-number&#34;&gt;12&lt;/span&gt;:&lt;span class=&#34;hljs-number&#34;&gt;24&lt;/span&gt;:&lt;span class=&#34;hljs-number&#34;&gt;28.633&lt;/span&gt;
    SystemTimeEnd    : &lt;span class=&#34;hljs-number&#34;&gt;2025&lt;/span&gt;&amp;#xB144; &lt;span class=&#34;hljs-number&#34;&gt;5&lt;/span&gt;&amp;#xC6D4; &lt;span class=&#34;hljs-number&#34;&gt;31&lt;/span&gt;&amp;#xC77C; &amp;#xD1A0;&amp;#xC694;&amp;#xC77C; &lt;span class=&#34;hljs-number&#34;&gt;12&lt;/span&gt;:&lt;span class=&#34;hljs-number&#34;&gt;24&lt;/span&gt;:&lt;span class=&#34;hljs-number&#34;&gt;28.633&lt;/span&gt;
&lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;:&lt;span class=&#34;hljs-number&#34;&gt;000&lt;/span&gt;&amp;gt; dx -r1 @$calls(&lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;TTDCalls!ConcreteProcessor::process&amp;quot;&lt;/span&gt;).Where(x =&amp;gt; x.Parameters.&lt;span class=&#34;hljs-keyword&#34;&gt;this&lt;/span&gt; == &lt;span class=&#34;hljs-number&#34;&gt;0x1e000059750&lt;/span&gt;)[&lt;span class=&#34;hljs-number&#34;&gt;94&lt;/span&gt;]
@$calls(&lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;TTDCalls!ConcreteProcessor::process&amp;quot;&lt;/span&gt;).Where(x =&amp;gt; x.Parameters.&lt;span class=&#34;hljs-keyword&#34;&gt;this&lt;/span&gt; == &lt;span class=&#34;hljs-number&#34;&gt;0x1e000059750&lt;/span&gt;)[&lt;span class=&#34;hljs-number&#34;&gt;94&lt;/span&gt;]                
    EventType        : &lt;span class=&#34;hljs-number&#34;&gt;0x0&lt;/span&gt;
    ThreadId         : &lt;span class=&#34;hljs-number&#34;&gt;0x567c&lt;/span&gt;
    UniqueThreadId   : &lt;span class=&#34;hljs-number&#34;&gt;0x2&lt;/span&gt;
    TimeStart        : &lt;span class=&#34;hljs-number&#34;&gt;4&lt;/span&gt;DB:&lt;span class=&#34;hljs-number&#34;&gt;820&lt;/span&gt; [Time Travel]
    TimeEnd          : &lt;span class=&#34;hljs-number&#34;&gt;4&lt;/span&gt;DB:&lt;span class=&#34;hljs-number&#34;&gt;823&lt;/span&gt; [Time Travel]
    Function         : TTDCalls!ConcreteProcessor::process
    FunctionAddress  : &lt;span class=&#34;hljs-number&#34;&gt;0x7ff784d911a0&lt;/span&gt;
    ReturnAddress    : &lt;span class=&#34;hljs-number&#34;&gt;0x7ff784d9134e&lt;/span&gt;
    Parameters      
    SystemTimeStart  : &lt;span class=&#34;hljs-number&#34;&gt;2025&lt;/span&gt;&amp;#xB144; &lt;span class=&#34;hljs-number&#34;&gt;5&lt;/span&gt;&amp;#xC6D4; &lt;span class=&#34;hljs-number&#34;&gt;31&lt;/span&gt;&amp;#xC77C; &amp;#xD1A0;&amp;#xC694;&amp;#xC77C; &lt;span class=&#34;hljs-number&#34;&gt;12&lt;/span&gt;:&lt;span class=&#34;hljs-number&#34;&gt;24&lt;/span&gt;:&lt;span class=&#34;hljs-number&#34;&gt;28.633&lt;/span&gt;
    SystemTimeEnd    : &lt;span class=&#34;hljs-number&#34;&gt;2025&lt;/span&gt;&amp;#xB144; &lt;span class=&#34;hljs-number&#34;&gt;5&lt;/span&gt;&amp;#xC6D4; &lt;span class=&#34;hljs-number&#34;&gt;31&lt;/span&gt;&amp;#xC77C; &amp;#xD1A0;&amp;#xC694;&amp;#xC77C; &lt;span class=&#34;hljs-number&#34;&gt;12&lt;/span&gt;:&lt;span class=&#34;hljs-number&#34;&gt;24&lt;/span&gt;:&lt;span class=&#34;hljs-number&#34;&gt;28.633&lt;/span&gt;
&lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;:&lt;span class=&#34;hljs-number&#34;&gt;000&lt;/span&gt;&amp;gt; dx @$calls(&lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;TTDCalls!ConcreteProcessor::process&amp;quot;&lt;/span&gt;).Where(x =&amp;gt; x.Parameters.&lt;span class=&#34;hljs-keyword&#34;&gt;this&lt;/span&gt; != &lt;span class=&#34;hljs-number&#34;&gt;0x1e000059750&lt;/span&gt; &amp;amp;&amp;amp; @$poscmp(x.TimeStart, &lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;4DA:10F0&amp;quot;&lt;/span&gt;) &amp;gt; &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt; &amp;amp;&amp;amp; @$poscmp(&lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;4DB:823&amp;quot;&lt;/span&gt;, x.TimeEnd) &amp;lt; &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;)
@$calls(&lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;TTDCalls!ConcreteProcessor::process&amp;quot;&lt;/span&gt;).Where(x =&amp;gt; x.Parameters.&lt;span class=&#34;hljs-keyword&#34;&gt;this&lt;/span&gt; != &lt;span class=&#34;hljs-number&#34;&gt;0x1e000059750&lt;/span&gt; &amp;amp;&amp;amp; @$poscmp(x.TimeStart, &lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;4DA:10F0&amp;quot;&lt;/span&gt;) &amp;gt; &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt; &amp;amp;&amp;amp; @$poscmp(&lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;4DB:823&amp;quot;&lt;/span&gt;, x.TimeEnd) &amp;lt; &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;)                
    [&lt;span class=&#34;hljs-number&#34;&gt;0x5f&lt;/span&gt;]          
    [&lt;span class=&#34;hljs-number&#34;&gt;0x60&lt;/span&gt;]          
    [&lt;span class=&#34;hljs-number&#34;&gt;0x61&lt;/span&gt;]          
    [&lt;span class=&#34;hljs-number&#34;&gt;0x62&lt;/span&gt;]          
    [&lt;span class=&#34;hljs-number&#34;&gt;0x63&lt;/span&gt;]          
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;The above command determines the position of the first and last &lt;code&gt;process&lt;/code&gt; calls of the fifth &lt;code&gt;ConcreteProcessor&lt;/code&gt; instance and lists only the &lt;code&gt;process&lt;/code&gt; calls of other instances that were called between them.&lt;/p&gt;
&lt;h1 id=&#34;Wrapping-up&#34;&gt;&lt;a href=&#34;#Wrapping-up&#34; class=&#34;headerlink&#34; title=&#34;Wrapping up&#34;&gt;&lt;/a&gt;Wrapping up&lt;/h1&gt;&lt;p&gt;After finishing, it feels like this post talks more about WinDbg&amp;#x2019;s TTD data objects (&lt;code&gt;Calls&lt;/code&gt;, &lt;code&gt;Memory&lt;/code&gt;) than about scripting itself &amp;#x1F605;. It wouldn&amp;#x2019;t have been bad to cover how to write and use scripts based on the &lt;a href=&#34;https://learn.microsoft.com/ko-kr/windows-hardware/drivers/debugger/javascript-debugger-scripting&#34;&gt;MS documentation&lt;/a&gt;, but I didn&amp;#x2019;t feel like reading it all;; I also learned by roughly studying &lt;strong&gt;0vercl0k&lt;/strong&gt;&amp;#x2019;s &lt;a href=&#34;https://github.com/0vercl0k/windbg-scripts&#34;&gt;examples&lt;/a&gt; and using only very simple scripts, yet the difference between &lt;em&gt;with&lt;/em&gt; and &lt;em&gt;without&lt;/em&gt; scripts was clear. I already thought TTD alone was revolutionary, and every time I learn a new feature I wonder how I ever lived without it.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/2025/06/01/pwndorei/windbg_js_en/image%206.png&#34; alt=&#34;image.png&#34;&gt;&lt;/p&gt;
&lt;p&gt;Anyway, thanks for reading this post, and I hope my teammates give it a try!&lt;/p&gt;
 - hack &amp; life">
  <meta property="og:image" content="https://hackyboiz.github.io/2025/06/01/pwndorei/windbg_js_en/image%206.png">
  <meta property="og:url" content="https://hackyboiz.github.io/">

  <link rel="canonical" href="https://hackyboiz.github.io/2025/06/01/pwndorei/windbg_js_en/">

  <title>[Research] A spoonful of javascript for windbg - hackyboiz</title>

  <link rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/4.4.1/css/bootstrap.min.css">


  <link rel="stylesheet" href="https://cdn.staticfile.org/github-markdown-css/4.0.0/github-markdown.min.css">
  <link rel="stylesheet" href="/lib/hint/hint.min.css">

  
    
    <link rel="stylesheet" href="https://cdn.staticfile.org/highlight.js/10.0.0/styles/github-gist.min.css">
  

  


<!-- 主题依赖的图标库，不要自行修改 -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_6peoq002giu.css">
<link rel="stylesheet" href="/.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_pjno9b9zyxs.css">
<link rel="stylesheet" href="/.css">


<link rel="stylesheet" href="/css/main.css">

<!-- 自定义样式保持在最底部 -->


  <script src="/js/utils.js"></script>
  <script src="/js/color-schema.js"></script>

<meta name="generator" content="Hexo 5.1.1"><link rel="alternate" href="/rss2.xml" title="hackyboiz" type="application/rss+xml">
</head>


<body>
  <header style="height: 40vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">&nbsp;<strong>Hackyboiz</strong>&nbsp;</a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                Home
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                Archives
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                Categories
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                Tags
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-addrcard"></i>
                About
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/author/">
                <i class="iconfont icon-user-fill"></i>
                Author
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" data-toggle="modal" data-target="#modalSearch">&nbsp;<i class="iconfont icon-search"></i>&nbsp;</a>
          </li>
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" href="javascript:">&nbsp;<i class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="banner intro-2" id="background" parallax="true" style="background: url('/img/default.png') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="container page-header text-center fade-in-up">
            <span class="h2" id="subtitle">
              
            </span>

            
              
  <div class="mt-3 post-meta">
    <i class="iconfont icon-date-fill" aria-hidden="true"></i>
    <time datetime="2025-06-01 23:00" pubdate>
      2025년 6월 1일 오후
    </time>
  </div>


<div class="mt-1">
  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      3.4k 자
    </span>
  

  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      67
       분
    </span>
  

  
  
</div>

            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid">
  <div class="row">
    <div class="d-none d-lg-block col-lg-2">
      <!--<script data-ad-client="ca-pub-3672652207808168" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>-->
    </div>
    <div class="col-lg-8 nopadding-md">
      <div class="container nopadding-md" id="board-ctn">
        <div class="py-5" id="board">
          <article class="post-content mx-auto" id="post">
            <!-- SEO header -->
            <h1 style="display: none">[Research] A spoonful of javascript for windbg</h1>
                       
            <div class="markdown-body" id="post-body">
              <!-- <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>-->
              <!-- hackyboiz_horizen_index -->
              <!--
              <ins class="adsbygoogle"
                   style="display:block"
                   data-ad-client="ca-pub-3672652207808168"
                   data-ad-slot="8887862313"
                   data-ad-format="auto"
                   data-full-width-responsive="true"></ins>
              <script>
                   (adsbygoogle = window.adsbygoogle || []).push({});
              </script>
              -->
              <h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>Hello, this is <strong>pwndorei</strong>&#x2026; Since I started working at a company around last September, I&#x2019;ve stopped writing research posts for a while, but now I can&#x2019;t avoid it anymore so I&#x2019;m back &#x1F926;&#x1F3FB;&#x200D;&#x2642;&#xFE0F;. However, aside from work, I don&#x2019;t really have anything I&#x2019;m researching, so no topic came to mind that was worth writing about.<br>So I decided to simply present a JavaScript script that&#x2019;s handy when analyzing with WinDbg. All right, let&#x2019;s go!</p>
<h1 id="Windbg-Script-&#x21D2;"><a href="#Windbg-Script-&#x21D2;" class="headerlink" title="Windbg + Script &#x21D2; ?"></a>Windbg + Script &#x21D2; ?</h1><p>Using a script for debugging? The goal is one and the same&#x2014;to debug lazily.</p>
<p><img src="/2025/06/01/pwndorei/windbg_js_en/image.png" srcset="/img/loading.gif" alt="image.png"></p>
<blockquote>
<p><del>It&#x2019;s absolutely <em>not</em> about working hard in advance so you can relax later</del></p>
</blockquote>
<p>Of course, you <em>can</em> carefully <code>dq</code>, <code>dd</code>, etc. every single time to check what data lives in a crazy-looking data structure. And with TTD, even if you accidentally step over an important call, you don&#x2019;t have to relaunch the process, so you can just smash <strong>F10</strong> mindlessly while analyzing.<br>But! The larger the data gets, the less time it takes to write a script instead of doing it by hand, and if you rely on TTD too much you&#x2019;ll turn into a fool.<br>So today, with a simple example, we&#x2019;ll see how to use scripts effectively&#x2014;and as a bonus I&#x2019;ll also show you how to push TTD to the limit.</p>
<h1 id="Windbg-Script-Basic"><a href="#Windbg-Script-Basic" class="headerlink" title="Windbg Script Basic"></a>Windbg Script Basic</h1><p>In WinDbg you can create a new script or load an existing one from the <strong>Scripting</strong> menu, like below. Besides JavaScript there&#x2019;s something called <strong>NatVis</strong>, but since we&#x2019;re going to use JavaScript we&#x2019;ll just ignore that.</p>
<p><img src="/2025/06/01/pwndorei/windbg_js_en/image%201.png" srcset="/img/loading.gif" alt="image.png"></p>
<p>Next, in <strong>New Script</strong> you choose between <strong>Extension</strong> and <strong>Imperative</strong>; it&#x2019;s merely a difference in the default template.</p>
<p>For <strong>Imperative</strong>, the following boilerplate code is generated:</p>
<pre><code class="hljs jsx"><span class="hljs-meta">&quot;use strict&quot;</span>;

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">initializeScript</span>(<span class="hljs-params"></span>)</span>
<span class="hljs-function"></span>{
    <span class="hljs-keyword">return</span> [<span class="hljs-keyword">new</span> host.apiVersionSupport(<span class="hljs-number">1</span>, <span class="hljs-number">9</span>)];
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">invokeScript</span>(<span class="hljs-params"></span>)</span>
<span class="hljs-function"></span>{
    <span class="hljs-comment">//</span>
    <span class="hljs-comment">// Insert your script content here.  This method will be called whenever the script is</span>
    <span class="hljs-comment">// invoked from a client.</span>
    <span class="hljs-comment">//</span>
    <span class="hljs-comment">// See the following for more details:</span>
    <span class="hljs-comment">//</span>
    <span class="hljs-comment">//     https://aka.ms/JsDbgExt</span>
    <span class="hljs-comment">//</span>
}</code></pre>
<p>You can run it by pressing <strong>Execute</strong> in <strong>Actions</strong> or with commands such as <code>.scriptrun</code>.</p>
<p><img src="/2025/06/01/pwndorei/windbg_js_en/image%202.png" srcset="/img/loading.gif" alt="image.png"></p>
<p>For <strong>Extension</strong>, it&#x2019;s used literally to add extension functionality, and this template appears:</p>
<pre><code class="hljs jsx"><span class="hljs-meta">&quot;use strict&quot;</span>;

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">initializeScript</span>(<span class="hljs-params"></span>)</span>
<span class="hljs-function"></span>{
    <span class="hljs-comment">//</span>
    <span class="hljs-comment">// Return an array of registration objects to modify the object model of the debugger</span>
    <span class="hljs-comment">// See the following for more details:</span>
    <span class="hljs-comment">//</span>
    <span class="hljs-comment">//     https://aka.ms/JsDbgExt</span>
    <span class="hljs-comment">//</span>
    <span class="hljs-keyword">return</span> [<span class="hljs-keyword">new</span> host.apiVersionSupport(<span class="hljs-number">1</span>, <span class="hljs-number">9</span>)];
}</code></pre>
<p>Extensions added through a script can be invoked in WinDbg with a command like <code>!extname</code>.</p>
<p>We&#x2019;ll see what functions we can implement through examples later, but first a few more script-related commands:</p>
<ul>
<li><p><code>.scriptlist</code><br>Shows all currently loaded scripts.</p>
<pre><code class="hljs routeros">0:038&gt; .scriptlist
Command Loaded Scripts:
        <span class="hljs-built_in">..</span>.
    JavaScript<span class="hljs-built_in"> script </span><span class="hljs-keyword">from</span> <span class="hljs-string">&apos;D:\windbg_Ext\utils.js&apos;</span>
    JavaScript<span class="hljs-built_in"> script </span><span class="hljs-keyword">from</span> <span class="hljs-string">&apos;D:\windbg_Ext\codecov.js&apos;</span>
    JavaScript<span class="hljs-built_in"> script </span><span class="hljs-keyword">from</span> <span class="hljs-string">&apos;C:\Program Files\WindowsApps\Microsoft.WinDbg_1.2504.15001.0_x64__8wekyb3d8bbwe\amd64\winext\ApiExtension\CodeFlow.js&apos;</span>
Other Clients<span class="hljs-string">&apos; Scripts:</span>
<span class="hljs-string">    Script named &apos;</span>untitled0<span class="hljs-string">&apos;</span>
<span class="hljs-string">    Script named &apos;</span>untitled1<span class="hljs-string">&apos;</span></code></pre>
</li>
<li><p><code>.scriptload</code> &amp; <code>.scriptunload</code><br>Commands to load or unload a script.<br>When loading, you can give the full path or just the name; WinDbg searches any directories in the <code>PATH</code> environment variable.<br><code>.scriptload</code> only calls the script&#x2019;s <code>initializeScript</code> function.</p>
</li>
<li><code>.scriptrun</code><br>Unlike <code>.scriptload</code>, it also calls the <code>invokeScript</code> function.</li>
</ul>
<p>There are two commands&#x2014;<code>.scriptload</code> and <code>.scriptrun</code>&#x2014;that execute scripts. If the script is <strong>imperative</strong>, you need to run <code>invokeScript</code>, so you use <strong>run</strong>; if it&#x2019;s an <strong>extension</strong>, you use <strong>load</strong>, right?</p>
<p><img src="/2025/06/01/pwndorei/windbg_js_en/image%203.png" srcset="/img/loading.gif" alt="image.png"></p>
<h2 id="Hello-World"><a href="#Hello-World" class="headerlink" title="Hello World"></a>Hello World</h2><p>We&#x2019;re not learning a <em>new</em> language, but because we can&#x2019;t use <code>console.log</code> the way we do in the browser, let&#x2019;s start by printing &#x201C;Hello World&#x201D; to the console.</p>
<pre><code class="hljs jsx"><span class="hljs-meta">&quot;use strict&quot;</span>;

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">initializeScript</span>(<span class="hljs-params"></span>)</span>
<span class="hljs-function"></span>{
    <span class="hljs-keyword">return</span> [<span class="hljs-keyword">new</span> host.apiVersionSupport(<span class="hljs-number">1</span>, <span class="hljs-number">9</span>)];
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">invokeScript</span>(<span class="hljs-params"></span>)</span>
<span class="hljs-function"></span>{
    host.diagnostics.debugLog(<span class="hljs-string">&quot;Hello World!\n&quot;</span>)
}</code></pre>
<p>As you can see, you use <code>host.diagnostics.debugLog</code> instead of <code>console.log</code>. If you run it, it prints normally.</p>
<p><img src="/2025/06/01/pwndorei/windbg_js_en/image%204.png" srcset="/img/loading.gif" alt="image.png"></p>
<p>Since I have no intention of typing that code every time I need to log, let&#x2019;s make an alias and use that instead &#x1F923;</p>
<pre><code class="hljs jsx"><span class="hljs-meta">&quot;use strict&quot;</span>;

<span class="hljs-keyword">const</span> log = <span class="hljs-function"><span class="hljs-params">x</span> =&gt;</span> host.diagnostics.debugLog(x)

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">initializeScript</span>(<span class="hljs-params"></span>)</span>
<span class="hljs-function"></span>{
    <span class="hljs-keyword">return</span> [<span class="hljs-keyword">new</span> host.apiVersionSupport(<span class="hljs-number">1</span>, <span class="hljs-number">9</span>)];
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">invokeScript</span>(<span class="hljs-params"></span>)</span>
<span class="hljs-function"></span>{
    log(<span class="hljs-string">&quot;Hello World!\n&quot;</span>)
}</code></pre>
<h2 id="Read-amp-Write-Memory"><a href="#Read-amp-Write-Memory" class="headerlink" title="Read &amp; Write Memory"></a>Read &amp; Write Memory</h2><p>We&#x2019;re not going to write scripts just to print &#x201C;Hello World&#x201D;, right? <code>host.memory</code> has the following functions, which let you read and write data in memory:</p>
<ul>
<li><code>readMemoryValues</code></li>
<li><code>readWideString</code></li>
<li><code>readString</code></li>
<li><code>writeMemoryValues</code></li>
</ul>
<p>For today, knowing this much is plenty!</p>
<h1 id="Practice"><a href="#Practice" class="headerlink" title="Practice"></a>Practice</h1><p>Now let&#x2019;s debug a sample program and see in what situations a script is useful.</p>
<h2 id="1-Dump-Data-Structure"><a href="#1-Dump-Data-Structure" class="headerlink" title="1. Dump Data Structure"></a>1. Dump Data Structure</h2><p>First up is dumping the data structure we mentioned earlier. ChatGPT made the sample program like this:</p>
<pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdlib.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;string.h&gt;</span></span>

<span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Node</span> {</span>
    <span class="hljs-keyword">char</span>* word;
    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Node</span>* <span class="hljs-title">left</span>;</span>
    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Node</span>* <span class="hljs-title">right</span>;</span>
} Node;

<span class="hljs-function">Node* <span class="hljs-title">createNode</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>* word)</span> </span>{
    Node* newNode = (Node*)<span class="hljs-built_in">malloc</span>(<span class="hljs-keyword">sizeof</span>(Node));
    <span class="hljs-keyword">if</span> (!newNode) <span class="hljs-keyword">return</span> <span class="hljs-literal">NULL</span>;

    newNode-&gt;word = _strdup(word);
    newNode-&gt;left = <span class="hljs-literal">NULL</span>;
    newNode-&gt;right = <span class="hljs-literal">NULL</span>;
    <span class="hljs-keyword">return</span> newNode;
}

<span class="hljs-function">Node* <span class="hljs-title">insert</span><span class="hljs-params">(Node* root, <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>* word)</span> </span>{
    <span class="hljs-keyword">if</span> (root == <span class="hljs-literal">NULL</span>) {
        <span class="hljs-keyword">return</span> createNode(word);
    }

    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">strcmp</span>(word, root-&gt;word) &lt; <span class="hljs-number">0</span>) {
        root-&gt;left = insert(root-&gt;left, word);
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-built_in">strcmp</span>(word, root-&gt;word) &gt; <span class="hljs-number">0</span>) {
        root-&gt;right = insert(root-&gt;right, word);
    }
    <span class="hljs-keyword">return</span> root;
}

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">inorderTraversal</span><span class="hljs-params">(Node* root)</span> </span>{
    <span class="hljs-keyword">if</span> (root != <span class="hljs-literal">NULL</span>) {
        inorderTraversal(root-&gt;left);
        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%s\n&quot;</span>, root-&gt;word);
        inorderTraversal(root-&gt;right);
    }
}

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">freeTree</span><span class="hljs-params">(Node* root)</span> </span>{
    <span class="hljs-keyword">if</span> (root != <span class="hljs-literal">NULL</span>) {
        freeTree(root-&gt;left);
        freeTree(root-&gt;right);
        <span class="hljs-built_in">free</span>(root-&gt;word);
        <span class="hljs-built_in">free</span>(root);
    }
}

<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>* words[<span class="hljs-number">10</span>] = {
        <span class="hljs-string">&quot;banana&quot;</span>, <span class="hljs-string">&quot;apple&quot;</span>, <span class="hljs-string">&quot;grape&quot;</span>, <span class="hljs-string">&quot;orange&quot;</span>, <span class="hljs-string">&quot;kiwi&quot;</span>,
        <span class="hljs-string">&quot;peach&quot;</span>, <span class="hljs-string">&quot;lemon&quot;</span>, <span class="hljs-string">&quot;mango&quot;</span>, <span class="hljs-string">&quot;cherry&quot;</span>, <span class="hljs-string">&quot;melon&quot;</span>
    };

    Node* root = <span class="hljs-literal">NULL</span>;

    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++) {
        root = insert(root, words[i]);
    }

    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Address of root node: %p\n&quot;</span>, (<span class="hljs-keyword">void</span>*)root);

    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Press Enter to exit...&quot;</span>);
    getchar();

    freeTree(root);
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}</code></pre>
<p>It&#x2019;s simple code that stores strings in a binary tree in order. It prints the root node&#x2019;s address and waits for console input. We can attach the debugger and write a script that traverses the tree to print the data.</p>
<p><img src="/2025/06/01/pwndorei/windbg_js_en/image%205.png" srcset="/img/loading.gif" alt="image.png"></p>
<p>A <code>Node</code> is a 0x18-byte structure with three pointer fields, so I defined <code>getNode</code> like this:</p>
<pre><code class="hljs jsx"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getNode</span>(<span class="hljs-params">addr</span>)</span>{
    <span class="hljs-keyword">var</span> node = host.memory.readMemoryValues(addr, <span class="hljs-number">3</span>, <span class="hljs-number">8</span>)
    <span class="hljs-keyword">return</span> {
        <span class="hljs-string">&quot;word&quot;</span>: node[<span class="hljs-number">0</span>],
        <span class="hljs-string">&quot;left&quot;</span>: node[<span class="hljs-number">1</span>],
        <span class="hljs-string">&quot;right&quot;</span>: node[<span class="hljs-number">2</span>]
    }
}</code></pre>
<p>Reading memory is done with <code>host.memory.readMemoryValues</code>. As you can guess from the parameters, it reads 3 elements (second parameter) of 8 bytes each (third parameter, <code>elementSize</code>) starting at <code>addr</code>. The return value is an array of integers containing the data, and I use it to build a node object.</p>
<p>Now that we can use the <code>Node</code> structure stored in memory, we need a traversal function. Below is a simple in-order traversal: given a node returned by <code>getNode</code>, it reads the string at <code>word</code> and prints it.</p>
<pre><code class="hljs jsx"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">traverse</span>(<span class="hljs-params">node</span>)</span>{
    <span class="hljs-keyword">if</span>(node[<span class="hljs-string">&quot;left&quot;</span>] != <span class="hljs-number">0</span>) traverse(getNode(node[<span class="hljs-string">&quot;left&quot;</span>]))
    log(host.memory.readString(node[<span class="hljs-string">&quot;word&quot;</span>]) + <span class="hljs-string">&quot;\n&quot;</span>)
    <span class="hljs-keyword">if</span>(node[<span class="hljs-string">&quot;right&quot;</span>] != <span class="hljs-number">0</span>) traverse(getNode(node[<span class="hljs-string">&quot;right&quot;</span>]))
}</code></pre>
<p>To read a string, use <code>host.memory.readString</code> like above. If it were a wide string, you&#x2019;d use <code>readWideString</code> instead. The full script is:</p>
<pre><code class="hljs jsx"><span class="hljs-meta">&quot;use strict&quot;</span>;

<span class="hljs-keyword">const</span> log = <span class="hljs-function"><span class="hljs-params">x</span> =&gt;</span> host.diagnostics.debugLog(x)

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">initializeScript</span>(<span class="hljs-params"></span>)</span>
<span class="hljs-function"></span>{
    <span class="hljs-keyword">return</span> [<span class="hljs-keyword">new</span> host.apiVersionSupport(<span class="hljs-number">1</span>, <span class="hljs-number">9</span>)];
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getNode</span>(<span class="hljs-params">addr</span>)</span>{
    <span class="hljs-keyword">var</span> node = host.memory.readMemoryValues(addr, <span class="hljs-number">3</span>, <span class="hljs-number">8</span>)
    <span class="hljs-keyword">return</span> {
        <span class="hljs-string">&quot;word&quot;</span>: node[<span class="hljs-number">0</span>],
        <span class="hljs-string">&quot;left&quot;</span>: node[<span class="hljs-number">1</span>],
        <span class="hljs-string">&quot;right&quot;</span>: node[<span class="hljs-number">2</span>]
    }
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">traverse</span>(<span class="hljs-params">node</span>)</span>{
    <span class="hljs-keyword">if</span>(node[<span class="hljs-string">&quot;left&quot;</span>] != <span class="hljs-number">0</span>) traverse(getNode(node[<span class="hljs-string">&quot;left&quot;</span>]))
    log(host.memory.readString(node[<span class="hljs-string">&quot;word&quot;</span>]) + <span class="hljs-string">&quot;\n&quot;</span>)
    <span class="hljs-keyword">if</span>(node[<span class="hljs-string">&quot;right&quot;</span>] != <span class="hljs-number">0</span>) traverse(getNode(node[<span class="hljs-string">&quot;right&quot;</span>]))
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">invokeScript</span>(<span class="hljs-params"></span>)</span>
<span class="hljs-function"></span>{
    traverse(getNode(<span class="hljs-number">0x25DD2C211C0</span>))
}</code></pre>
<p>If you want to go beyond simple printing and, say, find the address where specific data is located, just add a condition and print it out:</p>
<pre><code class="hljs jsx"><span class="hljs-meta">&quot;use strict&quot;</span>;

<span class="hljs-keyword">const</span> log = <span class="hljs-function"><span class="hljs-params">x</span> =&gt;</span> host.diagnostics.debugLog(x)
<span class="hljs-keyword">const</span> dat = <span class="hljs-string">&quot;melon&quot;</span>

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">initializeScript</span>(<span class="hljs-params"></span>)</span>
<span class="hljs-function"></span>{
    <span class="hljs-keyword">return</span> [<span class="hljs-keyword">new</span> host.apiVersionSupport(<span class="hljs-number">1</span>, <span class="hljs-number">9</span>)];
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getNode</span>(<span class="hljs-params">addr</span>)</span>{
    <span class="hljs-keyword">var</span> node = host.memory.readMemoryValues(addr, <span class="hljs-number">3</span>, <span class="hljs-number">8</span>)
    <span class="hljs-keyword">return</span> {
        <span class="hljs-string">&quot;word&quot;</span>: node[<span class="hljs-number">0</span>],
        <span class="hljs-string">&quot;left&quot;</span>: node[<span class="hljs-number">1</span>],
        <span class="hljs-string">&quot;right&quot;</span>: node[<span class="hljs-number">2</span>]
    }
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">traverse</span>(<span class="hljs-params">addr</span>)</span>{
    <span class="hljs-keyword">var</span> node = getNode(addr)
    <span class="hljs-keyword">if</span>(node[<span class="hljs-string">&quot;left&quot;</span>] != <span class="hljs-number">0</span>) traverse(node[<span class="hljs-string">&quot;left&quot;</span>])
    <span class="hljs-keyword">if</span>(dat.localeCompare(host.memory.readString(node[<span class="hljs-string">&quot;word&quot;</span>])) == <span class="hljs-number">0</span>){
        log(<span class="hljs-string">&quot;Found at &quot;</span> + addr.toString(<span class="hljs-number">16</span>) + <span class="hljs-string">&quot;\n&quot;</span>)
    }
    <span class="hljs-keyword">if</span>(node[<span class="hljs-string">&quot;right&quot;</span>] != <span class="hljs-number">0</span>) traverse(node[<span class="hljs-string">&quot;right&quot;</span>])
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">invokeScript</span>(<span class="hljs-params"></span>)</span>
<span class="hljs-function"></span>{
    traverse(<span class="hljs-number">0x25DD2C211C0</span>)
}</code></pre>
<p>This script checks whether the string &#x201C;melon&#x201D; is stored, and if so prints its address. Result:</p>
<pre><code class="hljs apache"><span class="hljs-attribute">Found</span> at <span class="hljs-number">25</span>dd<span class="hljs-number">2</span>c<span class="hljs-number">21280</span>
<span class="hljs-attribute">0</span>:<span class="hljs-number">004</span>&gt; da poi(<span class="hljs-number">25</span>dd<span class="hljs-number">2</span>c<span class="hljs-number">21280</span>)
<span class="hljs-attribute">0000025d</span>`d<span class="hljs-number">2</span>c<span class="hljs-number">19360</span>  <span class="hljs-string">&quot;melon&quot;</span></code></pre>
<h2 id="2-TTD"><a href="#2-TTD" class="headerlink" title="2. TTD"></a>2. TTD</h2><p>We&#x2019;ve used an <strong>imperative</strong> script, so now it&#x2019;s the <strong>extension</strong>&#x2019;s turn. For the extension example, here&#x2019;s a simple script I always use with TTD:</p>
<pre><code class="hljs jsx"><span class="hljs-meta">&apos;use strict&apos;</span>;

<span class="hljs-keyword">const</span> log = host.diagnostics.debugLog;
<span class="hljs-keyword">const</span> logln = <span class="hljs-function"><span class="hljs-params">p</span> =&gt;</span> host.diagnostics.debugLog(p + <span class="hljs-string">&apos;\n&apos;</span>);
<span class="hljs-keyword">const</span> hex = <span class="hljs-function"><span class="hljs-params">p</span> =&gt;</span> p.toString(<span class="hljs-number">16</span>);

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__calls</span>(<span class="hljs-params">...args</span>)</span>{
	<span class="hljs-keyword">return</span> host.currentSession.TTD.Calls(...args)
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__memory</span>(<span class="hljs-params">...args</span>)</span>{
	<span class="hljs-keyword">return</span> host.currentSession.TTD.Memory(...args)
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__memoryforpositionrange</span>(<span class="hljs-params">...args</span>)</span>
<span class="hljs-function"></span>{
	<span class="hljs-keyword">return</span> host.currentSession.TTD.MemoryForPositionRange(...args);
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">ttdParsePosition</span>(<span class="hljs-params">pos</span>)</span>{
	<span class="hljs-keyword">var</span> sequence = <span class="hljs-number">0</span>
	<span class="hljs-keyword">var</span> steps = <span class="hljs-number">0</span>
	<span class="hljs-keyword">if</span>(<span class="hljs-keyword">typeof</span>(pos) == <span class="hljs-string">&quot;string&quot;</span>){
		sequence = <span class="hljs-built_in">parseInt</span>(pos.split(<span class="hljs-string">&quot;:&quot;</span>)[<span class="hljs-number">0</span>], <span class="hljs-number">16</span>)
		steps = <span class="hljs-built_in">parseInt</span>(pos.split(<span class="hljs-string">&quot;:&quot;</span>)[<span class="hljs-number">1</span>], <span class="hljs-number">16</span>)
	}
	<span class="hljs-keyword">else</span>{
		sequence = pos.Sequence
		steps = pos.Steps
	}

	<span class="hljs-keyword">return</span> {
		Sequence: sequence,
		Steps: steps
	}
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__ttd_position_compare</span>(<span class="hljs-params">pos1, pos2</span>)</span>{
	<span class="hljs-comment">/*</span>
<span class="hljs-comment">	alias: poscmp</span>
<span class="hljs-comment">	parameters:</span>
<span class="hljs-comment">		pos1 &amp; pos2: Position object or string(Sequence:Steps in hexadicimal)</span>
<span class="hljs-comment">	usage:</span>
<span class="hljs-comment">		&gt; !poscmp(pos1, pos2)</span>
<span class="hljs-comment">		&gt; dx @$poscmp(pos1, pos2)</span>
<span class="hljs-comment">	example:</span>
<span class="hljs-comment">		&gt; dx @$calls(&quot;function&quot;).Where(x =&gt; @$poscmp(&quot;17C83A:1777&quot;, x.TimeStart) &lt; 0).Where(x =&gt; @$poscmp(&quot;17C861:1B3A&quot;, x.TimeEnd) &gt; 0)</span>
<span class="hljs-comment">		=&gt; get all `function` calls between 17C83A:1777 and 17C861:1B3A</span>
<span class="hljs-comment">	*/</span>

	pos1 = ttdParsePosition(pos1)
	pos2 = ttdParsePosition(pos2)

	<span class="hljs-keyword">if</span>(pos1.Sequence != pos2.Sequence){
		<span class="hljs-keyword">return</span> pos1.Sequence - pos2.Sequence
	}

	<span class="hljs-keyword">return</span> pos1.Steps - pos2.Steps
	
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__d</span>(<span class="hljs-params">...args</span>)</span>{
	<span class="hljs-keyword">return</span> host.memory.readMemoryValues(...args)
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">initializeScript</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">return</span> [
        <span class="hljs-keyword">new</span> host.apiVersionSupport(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>),
        <span class="hljs-keyword">new</span> host.functionAlias(
            __calls,
            <span class="hljs-string">&apos;calls&apos;</span>
        ),
		<span class="hljs-keyword">new</span> host.functionAlias(
			__memory,
			<span class="hljs-string">&apos;memory&apos;</span>
		),
		<span class="hljs-keyword">new</span> host.functionAlias(
			__memoryforpositionrange,
			<span class="hljs-string">&apos;memoryrange&apos;</span>
		),
		<span class="hljs-keyword">new</span> host.functionAlias(
			__ttd_position_compare,
			<span class="hljs-string">&apos;poscmp&apos;</span>
		),
		<span class="hljs-keyword">new</span> host.functionAlias(
			__d,
			<span class="hljs-string">&apos;d&apos;</span>
		)
    ];
}</code></pre>
<p>See the main difference from an <strong>imperative</strong> script? In <code>initializeScript</code> I create aliases with <code>host.functionAlias</code>. An extension registers JavaScript functions as aliases so they can be used directly at the command line.</p>
<p>I shorten the frequently used <code>@$cursession.TTD.Calls</code> and <code>@$cursession.TTD.Memory</code> to <code>@$calls</code> and <code>@$memory</code> to save my fingers &#x1F60E;</p>
<pre><code class="hljs jsx"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__calls</span>(<span class="hljs-params">...args</span>)</span>{
	<span class="hljs-keyword">return</span> host.currentSession.TTD.Calls(...args)
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__memory</span>(<span class="hljs-params">...args</span>)</span>{
	<span class="hljs-keyword">return</span> host.currentSession.TTD.Memory(...args)
}</code></pre>
<p>So where do we use this?</p>
<h3 id="TTD-Calls-amp-Memory"><a href="#TTD-Calls-amp-Memory" class="headerlink" title="TTD Calls &amp; Memory"></a>TTD Calls &amp; Memory</h3><p><a href="https://hackyboiz.github.io/2021/03/14/fabu1ous/ttd-3/#Filtering-in-a-query">The Time-Traveling Hacker&#x2019;s Guide</a> by Fabu1ous briefly explains Calls and Memory, but only skims over what you can do. Let&#x2019;s see how to use them through an example.</p>
<p>First, load the extension with the script below:</p>
<pre><code class="hljs routeros">0:038&gt; .scriptload utils.js
JavaScript<span class="hljs-built_in"> script </span>successfully loaded <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;D:\windbg_Ext\utils.js&apos;</span></code></pre>
<p>Then you can access Calls and Memory like this:</p>
<pre><code class="hljs angelscript"><span class="hljs-number">0</span>:<span class="hljs-number">000</span>&gt; !calls <span class="hljs-string">&quot;kernelbase!CreateFileW&quot;</span>
@$calls(<span class="hljs-string">&quot;kernelbase!CreateFileW&quot;</span>)                
    [<span class="hljs-number">0x0</span>]           
    [<span class="hljs-number">0x1</span>]           
    ...
<span class="hljs-number">0</span>:<span class="hljs-number">000</span>&gt; dx @$calls(<span class="hljs-string">&quot;kernelbase!CreateFileW&quot;</span>)[<span class="hljs-number">0</span>]
@$calls(<span class="hljs-string">&quot;kernelbase!CreateFileW&quot;</span>)[<span class="hljs-number">0</span>]                
    EventType        : <span class="hljs-number">0x0</span>
    ThreadId         : <span class="hljs-number">0xe5c</span>
    UniqueThreadId   : <span class="hljs-number">0x2</span>
    TimeStart        : <span class="hljs-number">6</span>F4F:<span class="hljs-number">1742</span> [Time Travel]
    TimeEnd          : <span class="hljs-number">6</span>F57:<span class="hljs-number">7E3</span> [Time Travel]
    Function         : kernelbase!CreateFileW
    FunctionAddress  : <span class="hljs-number">0x7ffbf27f05f0</span>
    ReturnAddress    : <span class="hljs-number">0x7ffbf2835846</span>
    ReturnValue      : <span class="hljs-number">0x31c</span>
    Parameters      
    SystemTimeStart  : Fri May <span class="hljs-number">30</span> <span class="hljs-number">2025</span> <span class="hljs-number">09</span>:<span class="hljs-number">13</span>:<span class="hljs-number">24.782</span>
    SystemTimeEnd    : Fri May <span class="hljs-number">30</span> <span class="hljs-number">2025</span> <span class="hljs-number">09</span>:<span class="hljs-number">13</span>:<span class="hljs-number">24.782</span></code></pre>
<p><code>!calls</code> does not let you directly index the returned array, so I more often use <code>dx @$calls</code>.</p>
<p>Now let&#x2019;s take a TTD recording of the example below and see what we can do.</p>
<pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;iostream&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;vector&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;memory&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;random&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;cstdlib&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;ctime&gt;</span></span>

<span class="hljs-comment">// Base class</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BaseProcessor</span> {</span>
<span class="hljs-keyword">public</span>:
    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-keyword">void</span> <span class="hljs-title">process</span><span class="hljs-params">(<span class="hljs-keyword">int</span> value)</span> </span>= <span class="hljs-number">0</span>;
    <span class="hljs-keyword">virtual</span> ~BaseProcessor() = <span class="hljs-keyword">default</span>;
};

<span class="hljs-comment">// Derived class with actual behavior</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ConcreteProcessor</span> :</span> <span class="hljs-keyword">public</span> BaseProcessor {
<span class="hljs-keyword">public</span>:
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">process</span><span class="hljs-params">(<span class="hljs-keyword">int</span> value)</span> <span class="hljs-keyword">override</span> </span>{
        <span class="hljs-comment">// Dummy operation to prevent optimization</span>
        <span class="hljs-keyword">volatile</span> <span class="hljs-keyword">int</span> sink = value;
        (<span class="hljs-keyword">void</span>)sink; <span class="hljs-comment">// Prevent unused variable warning</span>
    }
};

<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-built_in">std</span>::srand(<span class="hljs-keyword">static_cast</span>&lt;<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span>&gt;(<span class="hljs-built_in">std</span>::time(<span class="hljs-literal">nullptr</span>)));
    <span class="hljs-function"><span class="hljs-built_in">std</span>::mt19937 <span class="hljs-title">rng</span><span class="hljs-params">(<span class="hljs-built_in">std</span>::random_device{}())</span></span>;
    <span class="hljs-function"><span class="hljs-built_in">std</span>::uniform_int_distribution&lt;<span class="hljs-keyword">int</span>&gt; <span class="hljs-title">distIndex</span><span class="hljs-params">(<span class="hljs-number">0</span>, <span class="hljs-number">9</span>)</span></span>;
    <span class="hljs-function"><span class="hljs-built_in">std</span>::uniform_int_distribution&lt;<span class="hljs-keyword">int</span>&gt; <span class="hljs-title">distValue</span><span class="hljs-params">(<span class="hljs-number">0</span>, <span class="hljs-number">1000</span>)</span></span>;

    <span class="hljs-comment">// Create at least 10 instances</span>
    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">vector</span>&lt;<span class="hljs-built_in">std</span>::<span class="hljs-built_in">unique_ptr</span>&lt;BaseProcessor&gt;&gt; processors;
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; ++i) {
        processors.push_back(<span class="hljs-built_in">std</span>::make_unique&lt;ConcreteProcessor&gt;());
    }

    <span class="hljs-comment">// Call virtual function 100 times with random instance and value</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">100</span>; ++i) {
        <span class="hljs-keyword">int</span> idx = distIndex(rng);
        <span class="hljs-keyword">int</span> value = distValue(rng);
        processors[idx]-&gt;process(value);
    }

    <span class="hljs-comment">// Wait for user input</span>
    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">&quot;All calls completed. Press Enter to exit...&quot;</span>;
    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cin</span>.get();

    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}</code></pre>
<blockquote>
<p><del>It&#x2019;s no secret that ChatGPT wrote this too</del></p>
</blockquote>
<p>The code creates 10 instances, calls a virtual function 100 times, chooses random values and random instances, then waits.</p>
<p>Though extreme, I often face similar situations while analyzing.<br>My main purposes for using Calls and Memory are:</p>
<ol>
<li>Only function calls made by a specific instance  </li>
<li>Filtering by return value or argument  </li>
<li>Filtering calls or memory accesses before/after a given TTD position</li>
</ol>
<p>First, check how many times the function was called:</p>
<pre><code class="hljs arcade"><span class="hljs-number">0</span>:<span class="hljs-number">000</span>&gt; dx @<span class="hljs-symbol">$calls</span>(<span class="hljs-string">&quot;TTDCalls!ConcreteProcessor::process&quot;</span>).<span class="hljs-built_in">Count</span>()
@<span class="hljs-symbol">$calls</span>(<span class="hljs-string">&quot;TTDCalls!ConcreteProcessor::process&quot;</span>).<span class="hljs-built_in">Count</span>() : <span class="hljs-number">0x64</span></code></pre>
<p>That&#x2019;s 100 times. To see only calls made by the 5th instance, we first need that instance&#x2019;s address. Because it&#x2019;s created with <code>std::make_unique</code> (inlined), we can&#x2019;t directly list constructor calls.</p>
<pre><code class="hljs angelscript"><span class="hljs-number">0</span>:<span class="hljs-number">000</span>&gt; u TTDCalls!main+b0
TTDCalls!std::make_unique [C:\Program Files\Microsoft Visual Studio\<span class="hljs-number">2022</span>\Community\VC\Tools\MSVC\<span class="hljs-number">14.41</span><span class="hljs-number">.34120</span>\include\memory @ <span class="hljs-number">3597</span>] [inlined <span class="hljs-keyword">in</span> TTDCalls!main+<span class="hljs-number">0xb0</span> [D:\Src\WindbgExamplePrograms\TTDCalls\main.cpp @ <span class="hljs-number">34</span>]]:
<span class="hljs-number">00007f</span>f7`<span class="hljs-number">84</span>d91260 b908000000      mov     ecx,<span class="hljs-number">8</span>
<span class="hljs-number">00007f</span>f7`<span class="hljs-number">84</span>d91265 e8c6080000      call    TTDCalls!operator new (<span class="hljs-number">00007f</span>f7`<span class="hljs-number">84</span>d91b30)
<span class="hljs-number">00007f</span>f7`<span class="hljs-number">84</span>d9126a <span class="hljs-number">488930</span>          mov     qword ptr [rax],rsi
<span class="hljs-number">00007f</span>f7`<span class="hljs-number">84</span>d9126d <span class="hljs-number">4889442420</span>      mov     qword ptr [rsp+<span class="hljs-number">20</span>h],rax
<span class="hljs-number">00007f</span>f7`<span class="hljs-number">84</span>d91272 <span class="hljs-number">488</span>b542438      mov     rdx,qword ptr [rsp+<span class="hljs-number">38</span>h]
<span class="hljs-number">00007f</span>f7`<span class="hljs-number">84</span>d91277 <span class="hljs-number">483</span>b542440      cmp     rdx,qword ptr [rsp+<span class="hljs-number">40</span>h]
<span class="hljs-number">00007f</span>f7`<span class="hljs-number">84</span>d9127c <span class="hljs-number">740</span>e            je      TTDCalls!main+<span class="hljs-number">0xdc</span> (<span class="hljs-number">00007f</span>f7`<span class="hljs-number">84</span>d9128c)
<span class="hljs-number">00007f</span>f7`<span class="hljs-number">84</span>d9127e <span class="hljs-number">488</span>bcf          mov     rcx,rdi</code></pre>
<p>But we can list executions of the <code>operator new</code> instruction and pick the 5th one:</p>
<pre><code class="hljs angelscript"><span class="hljs-number">0</span>:<span class="hljs-number">000</span>&gt; dx @$memory(<span class="hljs-number">0x7ff784d91265</span>, <span class="hljs-number">0x7ff784d91265</span>+<span class="hljs-number">1</span>, <span class="hljs-string">&quot;e&quot;</span>)[<span class="hljs-number">4</span>]
@$memory(<span class="hljs-number">0x7ff784d91265</span>, <span class="hljs-number">0x7ff784d91265</span>+<span class="hljs-number">1</span>, <span class="hljs-string">&quot;e&quot;</span>)[<span class="hljs-number">4</span>]                
    EventType        : <span class="hljs-number">0x1</span>
    ThreadId         : <span class="hljs-number">0x567c</span>
    UniqueThreadId   : <span class="hljs-number">0x2</span>
    TimeStart        : <span class="hljs-number">4</span>D8:<span class="hljs-number">24</span>A2 [Time Travel]
    TimeEnd          : <span class="hljs-number">4</span>D8:<span class="hljs-number">24</span>A2 [Time Travel]
    AccessType       : Execute
    IP               : <span class="hljs-number">0x7ff784d91265</span>
    Address          : <span class="hljs-number">0x7ff784d91265</span>
    Size             : <span class="hljs-number">0x5</span>
    Value            : <span class="hljs-number">0x8c6e8</span>
    SystemTimeStart  : <span class="hljs-number">2025</span>&#xB144; <span class="hljs-number">5</span>&#xC6D4; <span class="hljs-number">31</span>&#xC77C; &#xD1A0;&#xC694;&#xC77C; <span class="hljs-number">12</span>:<span class="hljs-number">24</span>:<span class="hljs-number">28.628</span>
    SystemTimeEnd    : <span class="hljs-number">2025</span>&#xB144; <span class="hljs-number">5</span>&#xC6D4; <span class="hljs-number">31</span>&#xC77C; &#xD1A0;&#xC694;&#xC77C; <span class="hljs-number">12</span>:<span class="hljs-number">24</span>:<span class="hljs-number">28.628</span>
<span class="hljs-number">0</span>:<span class="hljs-number">000</span>&gt; dx @$memory(<span class="hljs-number">0x7ff784d91265</span>, <span class="hljs-number">0x7ff784d91265</span>+<span class="hljs-number">1</span>, <span class="hljs-string">&quot;e&quot;</span>)[<span class="hljs-number">4</span>].TimeStart.SeekTo()
(<span class="hljs-number">43f</span>8<span class="hljs-number">.567</span>c): Break instruction exception - code <span class="hljs-number">80000003</span> (first/second chance <span class="hljs-keyword">not</span> available)
Time Travel Position: <span class="hljs-number">4</span>D8:<span class="hljs-number">24</span>A2</code></pre>
<p>By looking at the <code>TimeStart</code> and <code>TimeEnd</code> fields, we can see when this memory access event started and when it ended. We can jump to that point in time by pressing <code>[Time Travel]</code> next to the position, or by calling the <code>SeekTo</code> method of <code>TimeStart</code> or <code>TimeEnd</code> directly.</p>
<p>Now we can determine the address of the fifth instance from the return value of <code>operator new</code> and use <code>Where</code> to see only the <code>process</code> calls of that instance, as shown below, or we can use Calls and access the <code>ReturnValue</code> field to find out without going to the position.</p>
<pre><code class="hljs angelscript"><span class="hljs-number">0</span>:<span class="hljs-number">000</span>&gt; dx @$memory(<span class="hljs-number">0x7ff784d91265</span>, <span class="hljs-number">0x7ff784d91265</span>+<span class="hljs-number">1</span>, <span class="hljs-string">&quot;e&quot;</span>)[<span class="hljs-number">4</span>].TimeStart.SeekTo()
(<span class="hljs-number">43f</span>8<span class="hljs-number">.567</span>c): Break instruction exception - code <span class="hljs-number">80000003</span> (first/second chance <span class="hljs-keyword">not</span> available)
Time Travel Position: <span class="hljs-number">4</span>D8:<span class="hljs-number">24</span>A2
<span class="hljs-number">0</span>:<span class="hljs-number">000</span>&gt; p
Time Travel Position: <span class="hljs-number">4</span>D8:<span class="hljs-number">25</span>EA
TTDCalls!main+<span class="hljs-number">0xba</span>:
<span class="hljs-number">00007f</span>f7`<span class="hljs-number">84</span>d9126a <span class="hljs-number">488930</span>          mov     qword ptr [rax],rsi ds:<span class="hljs-number">000001e0</span>`<span class="hljs-number">00059750</span>=<span class="hljs-number">6562575</span>c32336d65
<span class="hljs-number">0</span>:<span class="hljs-number">000</span>&gt; r rax
rax=<span class="hljs-number">000001e000059750</span>

<span class="hljs-number">0</span>:<span class="hljs-number">000</span>&gt; dx @$calls(<span class="hljs-string">&quot;TTDCalls!operator new&quot;</span>).Where(x =&gt; x.ReturnAddress == <span class="hljs-number">0x7ff784d9126a</span>)[<span class="hljs-number">0x8</span>].ReturnValue
@$calls(<span class="hljs-string">&quot;TTDCalls!operator new&quot;</span>).Where(x =&gt; x.ReturnAddress == <span class="hljs-number">0x7ff784d9126a</span>)[<span class="hljs-number">0x8</span>].ReturnValue                 : <span class="hljs-number">0x1e000059750</span> [Type: <span class="hljs-built_in">void</span> *]</code></pre>
<p>If you only want to see calls made by a specific instance, you can use the first argument (<code>this</code>), which is the address of the instance, right? In this example, we have the pdb as well as the source code, so we can also go directly to the name of the parameter instead of the index in <code>Parameters</code>.</p>
<pre><code class="hljs angelscript"><span class="hljs-number">0</span>:<span class="hljs-number">000</span>&gt; dx @$calls(<span class="hljs-string">&quot;TTDCalls!ConcreteProcessor::process&quot;</span>).Where(x =&gt; x.Parameters[<span class="hljs-number">0</span>] == <span class="hljs-number">0x1e000059750</span>)
@$calls(<span class="hljs-string">&quot;TTDCalls!ConcreteProcessor::process&quot;</span>).Where(x =&gt; x.Parameters[<span class="hljs-number">0</span>] == <span class="hljs-number">0x1e000059750</span>)                
    [<span class="hljs-number">0x6</span>]           
    [<span class="hljs-number">0xf</span>]           
    [<span class="hljs-number">0x21</span>]          
    [<span class="hljs-number">0x2a</span>]          
    [<span class="hljs-number">0x2c</span>]          
    [<span class="hljs-number">0x2f</span>]          
    [<span class="hljs-number">0x32</span>]          
    [<span class="hljs-number">0x39</span>]          
    [<span class="hljs-number">0x3f</span>]          
    [<span class="hljs-number">0x43</span>]          
    [<span class="hljs-number">0x57</span>]          
    [<span class="hljs-number">0x5e</span>]</code></pre>
<p>Need only the arguments? Pipe to <code>Select(...)</code> and display with <code>-g</code>.</p>
<p>Of course, you can use other conditions in the <code>Where</code>, or you can implement the TTD position comparison as an extension and add it as a condition in the <code>Where</code></p>
<p>Putting it all together, you can produce queries like:</p>
<pre><code class="hljs angelscript"><span class="hljs-number">0</span>:<span class="hljs-number">000</span>&gt; dx -r1 @$calls(<span class="hljs-string">&quot;TTDCalls!ConcreteProcessor::process&quot;</span>).Where(x =&gt; x.Parameters.<span class="hljs-keyword">this</span> == <span class="hljs-number">0x1e000059750</span>)[<span class="hljs-number">6</span>]
@$calls(<span class="hljs-string">&quot;TTDCalls!ConcreteProcessor::process&quot;</span>).Where(x =&gt; x.Parameters.<span class="hljs-keyword">this</span> == <span class="hljs-number">0x1e000059750</span>)[<span class="hljs-number">6</span>]                
    EventType        : <span class="hljs-number">0x0</span>
    ThreadId         : <span class="hljs-number">0x567c</span>
    UniqueThreadId   : <span class="hljs-number">0x2</span>
    TimeStart        : <span class="hljs-number">4</span>DA:<span class="hljs-number">10</span>F0 [Time Travel]
    TimeEnd          : <span class="hljs-number">4</span>DA:<span class="hljs-number">10</span>F3 [Time Travel]
    Function         : TTDCalls!ConcreteProcessor::process
    FunctionAddress  : <span class="hljs-number">0x7ff784d911a0</span>
    ReturnAddress    : <span class="hljs-number">0x7ff784d9134e</span>
    Parameters      
    SystemTimeStart  : <span class="hljs-number">2025</span>&#xB144; <span class="hljs-number">5</span>&#xC6D4; <span class="hljs-number">31</span>&#xC77C; &#xD1A0;&#xC694;&#xC77C; <span class="hljs-number">12</span>:<span class="hljs-number">24</span>:<span class="hljs-number">28.633</span>
    SystemTimeEnd    : <span class="hljs-number">2025</span>&#xB144; <span class="hljs-number">5</span>&#xC6D4; <span class="hljs-number">31</span>&#xC77C; &#xD1A0;&#xC694;&#xC77C; <span class="hljs-number">12</span>:<span class="hljs-number">24</span>:<span class="hljs-number">28.633</span>
<span class="hljs-number">0</span>:<span class="hljs-number">000</span>&gt; dx -r1 @$calls(<span class="hljs-string">&quot;TTDCalls!ConcreteProcessor::process&quot;</span>).Where(x =&gt; x.Parameters.<span class="hljs-keyword">this</span> == <span class="hljs-number">0x1e000059750</span>)[<span class="hljs-number">94</span>]
@$calls(<span class="hljs-string">&quot;TTDCalls!ConcreteProcessor::process&quot;</span>).Where(x =&gt; x.Parameters.<span class="hljs-keyword">this</span> == <span class="hljs-number">0x1e000059750</span>)[<span class="hljs-number">94</span>]                
    EventType        : <span class="hljs-number">0x0</span>
    ThreadId         : <span class="hljs-number">0x567c</span>
    UniqueThreadId   : <span class="hljs-number">0x2</span>
    TimeStart        : <span class="hljs-number">4</span>DB:<span class="hljs-number">820</span> [Time Travel]
    TimeEnd          : <span class="hljs-number">4</span>DB:<span class="hljs-number">823</span> [Time Travel]
    Function         : TTDCalls!ConcreteProcessor::process
    FunctionAddress  : <span class="hljs-number">0x7ff784d911a0</span>
    ReturnAddress    : <span class="hljs-number">0x7ff784d9134e</span>
    Parameters      
    SystemTimeStart  : <span class="hljs-number">2025</span>&#xB144; <span class="hljs-number">5</span>&#xC6D4; <span class="hljs-number">31</span>&#xC77C; &#xD1A0;&#xC694;&#xC77C; <span class="hljs-number">12</span>:<span class="hljs-number">24</span>:<span class="hljs-number">28.633</span>
    SystemTimeEnd    : <span class="hljs-number">2025</span>&#xB144; <span class="hljs-number">5</span>&#xC6D4; <span class="hljs-number">31</span>&#xC77C; &#xD1A0;&#xC694;&#xC77C; <span class="hljs-number">12</span>:<span class="hljs-number">24</span>:<span class="hljs-number">28.633</span>
<span class="hljs-number">0</span>:<span class="hljs-number">000</span>&gt; dx @$calls(<span class="hljs-string">&quot;TTDCalls!ConcreteProcessor::process&quot;</span>).Where(x =&gt; x.Parameters.<span class="hljs-keyword">this</span> != <span class="hljs-number">0x1e000059750</span> &amp;&amp; @$poscmp(x.TimeStart, <span class="hljs-string">&quot;4DA:10F0&quot;</span>) &gt; <span class="hljs-number">0</span> &amp;&amp; @$poscmp(<span class="hljs-string">&quot;4DB:823&quot;</span>, x.TimeEnd) &lt; <span class="hljs-number">0</span>)
@$calls(<span class="hljs-string">&quot;TTDCalls!ConcreteProcessor::process&quot;</span>).Where(x =&gt; x.Parameters.<span class="hljs-keyword">this</span> != <span class="hljs-number">0x1e000059750</span> &amp;&amp; @$poscmp(x.TimeStart, <span class="hljs-string">&quot;4DA:10F0&quot;</span>) &gt; <span class="hljs-number">0</span> &amp;&amp; @$poscmp(<span class="hljs-string">&quot;4DB:823&quot;</span>, x.TimeEnd) &lt; <span class="hljs-number">0</span>)                
    [<span class="hljs-number">0x5f</span>]          
    [<span class="hljs-number">0x60</span>]          
    [<span class="hljs-number">0x61</span>]          
    [<span class="hljs-number">0x62</span>]          
    [<span class="hljs-number">0x63</span>]          
</code></pre>
<p>The above command determines the position of the first and last <code>process</code> calls of the fifth <code>ConcreteProcessor</code> instance and lists only the <code>process</code> calls of other instances that were called between them.</p>
<h1 id="Wrapping-up"><a href="#Wrapping-up" class="headerlink" title="Wrapping up"></a>Wrapping up</h1><p>After finishing, it feels like this post talks more about WinDbg&#x2019;s TTD data objects (<code>Calls</code>, <code>Memory</code>) than about scripting itself &#x1F605;. It wouldn&#x2019;t have been bad to cover how to write and use scripts based on the <a target="_blank" rel="external nofollow noopener noreferrer" href="https://learn.microsoft.com/ko-kr/windows-hardware/drivers/debugger/javascript-debugger-scripting">MS documentation</a>, but I didn&#x2019;t feel like reading it all;; I also learned by roughly studying <strong>0vercl0k</strong>&#x2019;s <a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/0vercl0k/windbg-scripts">examples</a> and using only very simple scripts, yet the difference between <em>with</em> and <em>without</em> scripts was clear. I already thought TTD alone was revolutionary, and every time I learn a new feature I wonder how I ever lived without it.</p>
<p><img src="/2025/06/01/pwndorei/windbg_js_en/image%206.png" srcset="/img/loading.gif" alt="image.png"></p>
<p>Anyway, thanks for reading this post, and I hope my teammates give it a try!</p>

            </div>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                <div class="post-meta mr-3">
                  <i class="iconfont icon-category"></i>
                  
                  <a class="hover-with-bg" href="/categories/Research/">Research</a>
                  
                </div>
                
                
                <div class="post-meta">
                  <i class="iconfont icon-tags"></i>
                  
                  <a class="hover-with-bg" href="/tags/windbg/">windbg</a>
                  
                  <a class="hover-with-bg" href="/tags/pwndorei/">pwndorei</a>
                  
                  <a class="hover-with-bg" href="/tags/TTD/">TTD</a>
                  
                  <a class="hover-with-bg" href="/tags/Debugging/">Debugging</a>
                  
                </div>
                
              </div>

              <div class="post-metas mb-3">
                <a class="hover-with-bg" style="display: flex;" href="/author">
                  <div class="link-avatar-page">
                    <img src="/img/profile_pwndorei.jpg" srcset="/img/loading.gif" alt="pwndorei">
                  </div>

                  <div class="link-text">
                    <div class="link-title">pwndorei</div>
                  </div>
                </a>
                <div class="link-text">
                  <div class="link-more">
                    <a href="/tags/pwndorei">
                      Read more
                      <i class="iconfont icon-arrowdown"></i>
                    </a>
                  </div>
                </div>
              </div>

              <hr>
              <!--<script data-ad-client="ca-pub-3672652207808168" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>-->
              
              <!--  -->
              <p class="note note-warning">본 글은 <a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/deed.ko" rel="external nofollow noopener noreferrer">CC BY-SA 4.0</a> 라이선스로 배포됩니다. 공유 또는 변경 시 반드시 출처를 남겨주시기 바랍니다.</p>
              
              
              
              <div class="post-prevnext row">
                <article class="post-prev col-6">
                  
                  
                  <a href="/2025/06/01/pwndorei/windbg_js/">
                    <i class="iconfont icon-arrowleft"></i>
                    <span class="hidden-mobile">[Research] windbg를 위한 javascript 한 스푼</span>
                    <span class="visible-mobile">Previous</span>
                  </a>
                  
                </article>
                <article class="post-next col-6">
                  
                  
                  <a href="/2025/05/31/l0ch/2025-05-31/">
                    <span class="hidden-mobile">[하루한줄] CVE-2025-5277: AWS MCP Server의 검증 부족으로 인한 Command Injection 취약점</span>
                    <span class="visible-mobile">Next</span>
                    <i class="iconfont icon-arrowright"></i>
                  </a>
                  
                </article>
              </div>
              
            </div>
            
            <!-- Embed Section -->
            <div style="width: 100%; height: 210px; margin-bottom: 50px; overflow: hidden;">
              <iframe src="https://maily.so/hackyboiz/embed?src=embed" style="width: 100%; height: 100%; border: none;" frameborder="0"></iframe>
            </div>            

            
            <!-- Comments -->
            <article class="comments" id="comments">
              
              
  <div class="disqus" style="width:100%">
    <div id="disqus_thread"></div>
    <script type="text/javascript">
      var disqus_config = function () {
        this.page.url = 'https://hackyboiz.github.io/2025/06/01/pwndorei/windbg_js_en/';
        this.page.identifier = '/2025/06/01/pwndorei/windbg_js_en/';
      };
      function loadDisqus() {
        (function () {
          var d = document,
            s = d.createElement('script');
          s.src = '//' + 'hackyboiz' + '.disqus.com/embed.js';
          s.setAttribute('data-timestamp', new Date());
          (d.head || d.body).appendChild(s);
        })();
      }
      waitElementVisible('disqus_thread', loadDisqus);
    </script>
    <noscript>Please enable JavaScript to view the
      <a target="_blank" href="https://disqus.com/?ref_noscript" rel="external nofollow noopener noreferrer">comments powered by Disqus.</a>
    </noscript>
  </div>


            </article>
            
          </article>
        </div>
      </div>
    </div>
    
    <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
      <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;TOC</p>
  <div id="tocbot"></div>
</div>

    </div>
    
  </div>
</div>

<!-- Custom -->

    
  </main>

  
    <a id="scroll-top-button" href="#" role="button">
      <i class="iconfont icon-arrowup" aria-hidden="true"></i>
    </a>
  

  
    <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">Search</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">keyword</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
  

  

  

  <footer class="mt-5">
  <div class="text-center py-3">
    <div>
      <a href="https://hexo.io" target="_blank" rel="external nofollow noopener noreferrer"><span>Hexo</span></a>
      <i class="iconfont icon-love"></i>
      <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="external nofollow noopener noreferrer">
        <span>Fluid</span></a>
    </div>
    

    

    
  </div>
</footer>

<!-- SCRIPTS -->
<script src="https://cdn.staticfile.org/jquery/3.4.1/jquery.min.js"></script>
<script src="https://cdn.staticfile.org/twitter-bootstrap/4.4.1/js/bootstrap.min.js"></script>
<script src="/js/debouncer.js"></script>
<script src="/js/main.js"></script>

<!-- Plugins -->


  
    <script src="/js/lazyload.js"></script>
  



  <script defer src="https://cdn.staticfile.org/clipboard.js/2.0.6/clipboard.min.js"></script>
  <script src="/js/clipboard-use.js"></script>







  <script src="https://cdn.staticfile.org/tocbot/4.11.1/tocbot.min.js"></script>
  <script>
    $(document).ready(function () {
      var boardCtn = $('#board-ctn');
      var boardTop = boardCtn.offset().top;

      tocbot.init({
        tocSelector: '#tocbot',
        contentSelector: '#post-body',
        headingSelector: 'h1,h2,h3,h4,h5,h6',
        linkClass: 'tocbot-link',
        activeLinkClass: 'tocbot-active-link',
        listClass: 'tocbot-list',
        isCollapsedClass: 'tocbot-is-collapsed',
        collapsibleClass: 'tocbot-is-collapsible',
        collapseDepth: 0,
        scrollSmooth: true,
        headingsOffset: -boardTop
      });
      if ($('.toc-list-item').length > 0) {
        $('#toc').css('visibility', 'visible');
      }
    });
  </script>



  <script src="https://cdn.staticfile.org/typed.js/2.0.11/typed.min.js"></script>
  <script>
    var typed = new Typed('#subtitle', {
      strings: [
        '  ',
        "[Research] A spoonful of javascript for windbg&nbsp;",
      ],
      cursorChar: "_",
      typeSpeed: 70,
      loop: false,
    });
    typed.stop();
    $(document).ready(function () {
      $(".typed-cursor").addClass("h2");
      typed.start();
    });
  </script>



  <script src="https://cdn.staticfile.org/anchor-js/4.2.2/anchor.min.js"></script>
  <script>
    anchors.options = {
      placement: "right",
      visible: "hover",
      
    };
    var el = "h1,h2,h3,h4,h5,h6".split(",");
    var res = [];
    for (item of el) {
      res.push(".markdown-body > " + item)
    }
    anchors.add(res.join(", "))
  </script>



  <script src="/js/local-search.js"></script>
  <script>
    var path = "/local-search.xml";
    var inputArea = document.querySelector("#local-search-input");
    inputArea.onclick = function () {
      searchFunc(path, 'local-search-input', 'local-search-result');
      this.onclick = null
    }
  </script>



  <script src="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.js"></script>
  <link rel="stylesheet" href="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.css">

  <script>
    $('#post img:not(.no-zoom img, img[no-zoom]), img[zoom]').each(
      function () {
        var element = document.createElement('a');
        $(element).attr('data-fancybox', 'images');
        $(element).attr('href', $(this).attr('src'));
        $(this).wrap(element);
      }
    );
  </script>





  

  
    <!-- MathJax -->
    <script>
      MathJax = {
        tex: {
          inlineMath: [['$', '$'], ['\\(', '\\)']]
        },
        options: {
          renderActions: {
            findScript: [10, doc => {
              document.querySelectorAll('script[type^="math/tex"]').forEach(node => {
                const display = !!node.type.match(/; *mode=display/);
                const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
                const text = document.createTextNode('');
                node.parentNode.replaceChild(text, node);
                math.start = { node: text, delim: '', n: 0 };
                math.end = { node: text, delim: '', n: 0 };
                doc.math.push(math);
              });
            }, '', false],
            insertedScript: [200, () => {
              document.querySelectorAll('mjx-container').forEach(node => {
                let target = node.parentNode;
                if (target.nodeName.toLowerCase() === 'li') {
                  target.parentNode.classList.add('has-jax');
                }
              });
            }, '', false]
          }
        }
      };
    </script>

    <script async src="https://cdn.staticfile.org/mathjax/3.0.5/es5/tex-svg.js"></script>

  













  

  
    <!-- Google Analytics -->
    <script defer>
      window.ga = window.ga || function () { (ga.q = ga.q || []).push(arguments) };
      ga.l = +new Date;
      ga('create', 'UA-177243668-2', 'auto');
      ga('send', 'pageview');
    </script>
    <script async src="https://www.google-analytics.com/analytics.js"></script>
  

  
    <!-- Google gtag.js -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-177243668-2"></script>
    <script defer>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'UA-177243668-2');
    </script>
  

  

  

  





</body>
</html>
