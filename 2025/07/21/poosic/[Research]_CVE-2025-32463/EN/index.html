

<!DOCTYPE html>
<html lang="ko-KR" data-default-color-scheme="&#34;auto&#34;">



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/favicon.ico">
  <link rel="icon" type="image/png" href="/img/favicon.ico">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="description" content="&lt;h2 id=&#34;Intro&#34;&gt;&lt;a href=&#34;#Intro&#34; class=&#34;headerlink&#34; title=&#34;Intro&#34;&gt;&lt;/a&gt;Intro&lt;/h2&gt;&lt;p&gt;Hi, I&amp;#x2019;m poosic. I&amp;#x2019;m back on Hackyboiz with my first research article! &amp;gt;_-&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/2025/07/21/poosic/[Research]_CVE-2025-32463/EN/1.png&#34; alt&gt;&lt;/p&gt;
&lt;p&gt;In this post, I&amp;#x2019;ll try to answer some of the questions I had while researching CVE-2025-32463: LPE with chroot in sudo. For a high-level overview of the vulnerability, see &lt;a href=&#34;https://hackyboiz.github.io/2025/07/12/poosic/cve-2025-32463/&#34;&gt;1Day1Line&lt;/a&gt;!&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;hljs bash&#34;&gt;&lt;span class=&#34;hljs-comment&#34;&gt;# sudoers.c&lt;/span&gt;
pivot_root()
-&amp;gt; resolve_cmnd() &lt;span class=&#34;hljs-comment&#34;&gt;# load changed root&amp;apos;s nsswitch.conf&lt;/span&gt;
-&amp;gt; unpivot_root() &lt;span class=&#34;hljs-comment&#34;&gt;# not load original root&amp;apos;s nsswitch.conf&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;However, if we briefly look at the flow of &lt;code&gt;sudoers.c&lt;/code&gt;, the vulnerability occurred because the NSS API is called in the &lt;code&gt;resolve_cmnd&lt;/code&gt; function after &lt;code&gt;pivot_root&lt;/code&gt; is executed, and the attacker&amp;#x2019;s arbitrary file (&lt;code&gt;/etc/nsswitch.conf&lt;/code&gt;) loaded with root privileges through &lt;code&gt;pivot_root&lt;/code&gt; is read and the nss_database related information is updated, but it is not updated to the original root&amp;#x2019;s nss_database after &lt;code&gt;unpivot_root&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;When I looked at &lt;code&gt;pivot.c&lt;/code&gt; and &lt;code&gt;sudoers.c&lt;/code&gt; where the vulnerability occurred, I had questions. The questions were as follows.&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;where is nsswitch.conf loaded in that code?&lt;/li&gt;
&lt;li&gt;why is nsswitch.conf recognizing files in the root directory that have been replaced with chroot?&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;When I checked the sudo v1.9.17 pivot.c code where the vulnerability actually occurred, I found that &lt;code&gt;unpivot_chroot()&lt;/code&gt; dutifully reads nsswitch.conf back in, so the problem got even more muddled.&lt;/p&gt;
&lt;p&gt;The obvious way to find out would be to see the sudo repo in git or analyze it with gdb.&lt;/p&gt;
&lt;h2 id=&#34;Environment-setting&#34;&gt;&lt;a href=&#34;#Environment-setting&#34; class=&#34;headerlink&#34; title=&#34;Environment setting&#34;&gt;&lt;/a&gt;Environment setting&lt;/h2&gt;&lt;p&gt;When I first set up the environment, I was going to compile sudo and glibc for debugging on my existing Ubuntu, but since the Ubuntu I installed on WSL didn&amp;#x2019;t use the -R option, there were a lot of things to set up in sudo.conf and other files, so I found a slightly(?) easier way.&lt;/p&gt;
&lt;p&gt;If you want to follow along with this article and analyze it, you can refer to [1] in the reference below to proceed with the installation. The installation process is simple, so let&amp;#x2019;s skip it and start setting up the environment.&lt;/p&gt;
&lt;p&gt;The environment doesn&amp;#x2019;t have gdb installed, obviously you need to have sudo privileges to install gdb, but when I run run.sh, I can&amp;#x2019;t install gdb because it puts me as a regular user named pwn.&lt;/p&gt;
&lt;p&gt;I stupidly went back to doing my own configuration here and thought, &amp;#x201C;Hahaha I can have sudo privileges!&amp;#x201D; and used the POC script that docker set up for me to get root privileges and install gdb.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/2025/07/21/poosic/[Research]_CVE-2025-32463/EN/2.jpg&#34; alt&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;L0ch finds out, and I remind him of the emotion of shock.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;In my delirium, I forgot that this is a docker container that I put up locally&amp;#x2026; You can easily set it up as root with &lt;code&gt;docker exec -it --user root &amp;lt;container-id&amp;gt; bash&lt;/code&gt;.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;hljs bash&#34;&gt;root@a593a22215ca:/&lt;span class=&#34;hljs-comment&#34;&gt;# echo &amp;apos;pwn ALL=(ALL) NOPASSWD:ALL&amp;apos; &amp;gt;&amp;gt; /etc/sudoers&lt;/span&gt;
root@a593a22215ca:/&lt;span class=&#34;hljs-comment&#34;&gt;# su - pwn&lt;/span&gt;
pwn@a593a22215ca:/tmp/sudowoot.stage.Ex5pZ2$ sudo gdb --args sudo -R woot woot&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;In order to debug sudo, you need sudo privileges. You can do it as root, but I gave sudo privileges to a pwn with normal privileges just in case it makes a difference in the flow. Afterwards, run gdb with sudo privileges and you&amp;#x2019;re ready to debug. Now let&amp;#x2019;s get started!&lt;/p&gt;
&lt;h2 id=&#34;After-pivot-root&#34;&gt;&lt;a href=&#34;#After-pivot-root&#34; class=&#34;headerlink&#34; title=&#34;After pivot_root&#34;&gt;&lt;/a&gt;After pivot_root&lt;/h2&gt;&lt;pre&gt;&lt;code class=&#34;hljs bash&#34;&gt;(gdb) b pivot_root
(gdb) r
Breakpoint 1.1, pivot_root (new_root=0x55aae9e866dc &lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;woot&amp;quot;&lt;/span&gt;, state=0x7ffd8c3bb4a8) at ./pivot.c:39
39      {
(gdb) b fopen
Breakpoint 2 at 0x7ff5aaf55e60: file ./libio/iofopen.c, line 85.&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;To find where nsswitch.conf is loaded, we first breakpointed the point where it opens after &lt;code&gt;pivot_root&lt;/code&gt;.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;hljs bash&#34;&gt;Breakpoint 2, _IO_new_fopen (filename=filename@entry=0x7ff5ab09ed92 &lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;/etc/nsswitch.conf&amp;quot;&lt;/span&gt;, mode=mode@entry=0x7ff5ab09adb4 &lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;rce&amp;quot;&lt;/span&gt;)
    at ./libio/iofopen.c:85
(gdb) bt
&lt;span class=&#34;hljs-comment&#34;&gt;#0  _IO_new_fopen (filename=filename@entry=0x7ff5ab09ed92 &amp;quot;/etc/nsswitch.conf&amp;quot;, mode=mode@entry=0x7ff5ab09adb4 &amp;quot;rce&amp;quot;)&lt;/span&gt;
    at ./libio/iofopen.c:85
&lt;span class=&#34;hljs-comment&#34;&gt;#1  0x00007ff5ab02247d in nss_database_reload (initial=0x7ffd8c3bab90, staging=0x7ffd8c3bac50) at ./nss/nss_database.c:306&lt;/span&gt;
&lt;span class=&#34;hljs-comment&#34;&gt;#2  nss_database_check_reload_and_get (local=&amp;lt;optimized out&amp;gt;, result=0x7ffd8c3bad80, database_index=nss_database_initgroups)&lt;/span&gt;
    at ./nss/nss_database.c:457
&lt;span class=&#34;hljs-comment&#34;&gt;#3  0x00007ff5ab026ddc in internal_getgrouplist (user=user@entry=0x55aae9e87d98 &amp;quot;root&amp;quot;, group=group@entry=0,&lt;/span&gt;
    size=size@entry=0x7ffd8c3badd8, groupsp=groupsp@entry=0x7ffd8c3bade0, &lt;span class=&#34;hljs-built_in&#34;&gt;limit&lt;/span&gt;=&lt;span class=&#34;hljs-built_in&#34;&gt;limit&lt;/span&gt;@entry=-1) at ./nss/initgroups.c:75
&lt;span class=&#34;hljs-comment&#34;&gt;#4  0x00007ff5ab0270dc in getgrouplist (user=user@entry=0x55aae9e87d98 &amp;quot;root&amp;quot;, group=group@entry=0,&lt;/span&gt;
    groups=groups@entry=0x7ff5aa7c9010, ngroups=ngroups@entry=0x7ffd8c3bae44) at ./nss/initgroups.c:156
&lt;span class=&#34;hljs-comment&#34;&gt;#5  0x00007ff5ab0f1149 in sudo_getgrouplist2_v1 (name=0x55aae9e87d98 &amp;quot;root&amp;quot;, basegid=0, groupsp=groupsp@entry=0x7ffd8c3baea0,&lt;/span&gt;
    ngroupsp=ngroupsp@entry=0x7ffd8c3baeac) at ./getgrouplist.c:105
&lt;span class=&#34;hljs-comment&#34;&gt;#6  0x00007ff5aa967b5e in sudo_make_gidlist_item (pw=0x55aae9e87d68, ngids=&amp;lt;optimized out&amp;gt;, gids=&amp;lt;optimized out&amp;gt;, gidstrs=0x0,&lt;/span&gt;
    &lt;span class=&#34;hljs-built_in&#34;&gt;type&lt;/span&gt;=1) at ./pwutil_impl.c:306
&lt;span class=&#34;hljs-comment&#34;&gt;#7  0x00007ff5aa9666b5 in sudo_get_gidlist (pw=0x55aae9e87d68, type=type@entry=1) at ./pwutil.c:1033&lt;/span&gt;
&lt;span class=&#34;hljs-comment&#34;&gt;#8  0x00007ff5aa95de8b in runas_getgroups (ctx=ctx@entry=0x7ff5aa9b76c0 &amp;lt;sudoers_ctx&amp;gt;) at ./match.c:146&lt;/span&gt;
&lt;span class=&#34;hljs-comment&#34;&gt;#9  0x00007ff5aa949f9c in runas_setgroups (ctx=0x7ff5aa9b76c0 &amp;lt;sudoers_ctx&amp;gt;) at ./set_perms.c:1634&lt;/span&gt;
&lt;span class=&#34;hljs-comment&#34;&gt;#10 set_perms (ctx=ctx@entry=0x7ff5aa9b76c0 &amp;lt;sudoers_ctx&amp;gt;, perm=perm@entry=5) at ./set_perms.c:285&lt;/span&gt;
&lt;span class=&#34;hljs-comment&#34;&gt;#11 0x00007ff5aa9690a8 in resolve_cmnd (ctx=ctx@entry=0x7ff5aa9b76c0 &amp;lt;sudoers_ctx&amp;gt;, infile=infile@entry=0x7ffd8c3bd7a2 &amp;quot;woot&amp;quot;,&lt;/span&gt;
    outfile=outfile@entry=0x7ffd8c3bb4b0,
    path=path@entry=0x55aae9e8dbc0 &lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin&amp;quot;&lt;/span&gt;) at ./resolve_cmnd.c:42
&lt;span class=&#34;hljs-comment&#34;&gt;#12 0x00007ff5aa94cf1c in set_cmnd_path (ctx=ctx@entry=0x7ff5aa9b76c0 &amp;lt;sudoers_ctx&amp;gt;, runchroot=0x55aae9e866dc &amp;quot;woot&amp;quot;)&lt;/span&gt;
    at ./sudoers.c:1108
&lt;span class=&#34;hljs-comment&#34;&gt;#13 0x00007ff5aa94d3a7 in set_cmnd (ctx=0x7ff5aa9b76c0 &amp;lt;sudoers_ctx&amp;gt;) at ./sudoers.c:1177&lt;/span&gt;
&lt;span class=&#34;hljs-comment&#34;&gt;#14 sudoers_check_common (pwflag=pwflag@entry=0, ctx=0x7ff5aa9b76c0 &amp;lt;sudoers_ctx&amp;gt;) at ./sudoers.c:358&lt;/span&gt;
&lt;span class=&#34;hljs-comment&#34;&gt;#15 0x00007ff5aa94ea28 in sudoers_check_cmnd (argc=argc@entry=1, argv=argv@entry=0x7ffd8c3bcb30, env_add=env_add@entry=0x0,&lt;/span&gt;
    closure=closure@entry=0x7ffd8c3bb640) at ./sudoers.c:689
&lt;span class=&#34;hljs-comment&#34;&gt;#16 0x00007ff5aa9449d3 in sudoers_policy_check (argc=1, argv=0x7ffd8c3bcb30, env_add=0x0, command_infop=0x7ffd8c3bb700,&lt;/span&gt;
    argv_out=0x7ffd8c3bb708, user_env_out=0x7ffd8c3bb710, errstr=0x7ffd8c3bb728) at ./policy.c:1244
&lt;span class=&#34;hljs-comment&#34;&gt;#17 0x000055aae921efb3 in policy_check (run_envp=0x7ffd8c3bb710, run_argv=0x7ffd8c3bb708, command_info=0x7ffd8c3bb700, env_add=0x0,&lt;/span&gt;
    argv=0x7ffd8c3bcb30, argc=1) at ./sudo.c:1266
&lt;span class=&#34;hljs-comment&#34;&gt;#18 main (argc=&amp;lt;optimized out&amp;gt;, argv=&amp;lt;optimized out&amp;gt;, envp=&amp;lt;optimized out&amp;gt;) at ./sudo.c:261&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Now that we&amp;#x2019;ve verified that &lt;code&gt;fopen&lt;/code&gt; loads &lt;code&gt;/etc/nsswitch.conf&lt;/code&gt; as an argument, let&amp;#x2019;s check the callstack with the backtrace command. The first thing we see is &lt;code&gt;nss_databse_reload&lt;/code&gt; and &lt;code&gt;nss_database_check_reload_and_get&lt;/code&gt;, which are related to nss. In our current flow, these functions do the following&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;nss_database_check_reload_and_get: reload if nsswitch.conf has been changed.&lt;/li&gt;
&lt;li&gt;nss_database_reload: Open and parse the &lt;code&gt;/etc/nsswitch.conf&lt;/code&gt; file, populate &lt;code&gt;staging&lt;/code&gt; with NSS service information, and fill in default values if necessary.&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;&lt;code class=&#34;hljs c&#34;&gt;(gdb) c
Breakpoint &lt;span class=&#34;hljs-number&#34;&gt;3&lt;/span&gt;, unpivot_root()
(gdb) c
Breakpoint &lt;span class=&#34;hljs-number&#34;&gt;4&lt;/span&gt;, nss_database_check_reload_and_get()
(gdb) c
Continuing.
Downloading separate debug info &lt;span class=&#34;hljs-keyword&#34;&gt;for&lt;/span&gt; libnss_/woot1337.so&lt;span class=&#34;hljs-number&#34;&gt;.2&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;I thought it would just skip &lt;code&gt;unpivot_root()&lt;/code&gt; afterward, but it&amp;#x2019;s caught at the break point. It loads &lt;code&gt;nss_database_check_reload_and_get()&lt;/code&gt; but doesn&amp;#x2019;t call &lt;code&gt;nss_database_reload()&lt;/code&gt;, unlike after pivot. So the problem is that &lt;code&gt;nss_database_reload&lt;/code&gt; doesn&amp;#x2019;t happen at &lt;code&gt;unpivot_root&lt;/code&gt;, so we still have the nsswitch.conf recognized by chroot.&lt;/p&gt;
&lt;p&gt;Now let&amp;#x2019;s take a hard look at the code!&lt;/p&gt;
&lt;h2 id=&#34;After-unpivot-root&#34;&gt;&lt;a href=&#34;#After-unpivot-root&#34; class=&#34;headerlink&#34; title=&#34;After unpivot_root&#34;&gt;&lt;/a&gt;After unpivot_root&lt;/h2&gt;&lt;pre&gt;&lt;code class=&#34;hljs c&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;static&lt;/span&gt; &lt;span class=&#34;hljs-keyword&#34;&gt;bool&lt;/span&gt;
nss_database_check_reload_and_get(struct nss_database_state *local,
                                  nss_action_list *result,
                                  &lt;span class=&#34;hljs-keyword&#34;&gt;enum&lt;/span&gt; nss_database database_index)
{
    &lt;span class=&#34;hljs-class&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;struct&lt;/span&gt; __&lt;span class=&#34;hljs-title&#34;&gt;stat64_t64&lt;/span&gt; &lt;span class=&#34;hljs-title&#34;&gt;str&lt;/span&gt;;&lt;/span&gt;
    &lt;span class=&#34;hljs-comment&#34;&gt;/* Acquire MO is needed because the thread that sets reload_disabled&lt;/span&gt;
&lt;span class=&#34;hljs-comment&#34;&gt;       may have loaded the configuration first, so synchronize with the&lt;/span&gt;
&lt;span class=&#34;hljs-comment&#34;&gt;       Release MO store there.  */&lt;/span&gt;
    &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; (atomic_load_acquire(&amp;amp;local-&amp;gt;data.reload_disabled))
    {
        *result = local-&amp;gt;data.services[database_index];
        &lt;span class=&#34;hljs-comment&#34;&gt;/* No reload, so there is no error.  */&lt;/span&gt;
        &lt;span class=&#34;hljs-keyword&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;hljs-literal&#34;&gt;true&lt;/span&gt;;
    }
    &lt;span class=&#34;hljs-class&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;hljs-title&#34;&gt;file_change_detection&lt;/span&gt; &lt;span class=&#34;hljs-title&#34;&gt;initial&lt;/span&gt;;&lt;/span&gt;
    &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; (!__file_change_detection_for_path(&amp;amp;initial, _PATH_NSSWITCH_CONF))
        &lt;span class=&#34;hljs-keyword&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;hljs-literal&#34;&gt;false&lt;/span&gt;;
    __libc_lock_lock(local-&amp;gt;lock);
    &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; (__file_is_unchanged(&amp;amp;initial, &amp;amp;local-&amp;gt;data.nsswitch_conf))
    {
        &lt;span class=&#34;hljs-comment&#34;&gt;/* Configuration is up-to-date.  Read it and return it to the&lt;/span&gt;
&lt;span class=&#34;hljs-comment&#34;&gt;           caller.  */&lt;/span&gt;
        *result = local-&amp;gt;data.services[database_index];
        __libc_lock_unlock(local-&amp;gt;lock);
        &lt;span class=&#34;hljs-keyword&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;hljs-literal&#34;&gt;true&lt;/span&gt;;
    }
    &lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; stat_rv = __stat64_time64(&lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;/&amp;quot;&lt;/span&gt;, &amp;amp;str);
    &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; (local-&amp;gt;data.services[database_index] != &lt;span class=&#34;hljs-literal&#34;&gt;NULL&lt;/span&gt;)
    {
        &lt;span class=&#34;hljs-comment&#34;&gt;/* Before we reload, verify that &amp;quot;/&amp;quot; hasn&amp;apos;t changed.  We assume that&lt;/span&gt;
&lt;span class=&#34;hljs-comment&#34;&gt;          errors here are very unlikely, but the chance that we&amp;apos;re entering&lt;/span&gt;
&lt;span class=&#34;hljs-comment&#34;&gt;          a container is also very unlikely, so we err on the side of both&lt;/span&gt;
&lt;span class=&#34;hljs-comment&#34;&gt;          very unlikely things not happening at the same time.  */&lt;/span&gt;
        &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; (stat_rv != &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt; || (local-&amp;gt;root_ino != &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt; &amp;amp;&amp;amp; (str.st_ino != local-&amp;gt;root_ino || str.st_dev != local-&amp;gt;root_dev)))
        {
            &lt;span class=&#34;hljs-comment&#34;&gt;/* Change detected; disable reloading and return current state.  */&lt;/span&gt;
            atomic_store_release(&amp;amp;local-&amp;gt;data.reload_disabled, &lt;span class=&#34;hljs-number&#34;&gt;1&lt;/span&gt;);
            *result = local-&amp;gt;data.services[database_index];
            __libc_lock_unlock(local-&amp;gt;lock);
            &lt;span class=&#34;hljs-keyword&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;hljs-literal&#34;&gt;true&lt;/span&gt;;
        }
    }
    &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; (stat_rv == &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;)
    {
        local-&amp;gt;root_ino = str.st_ino;
        local-&amp;gt;root_dev = str.st_dev;
    }
    __libc_lock_unlock(local-&amp;gt;lock);
    &lt;span class=&#34;hljs-comment&#34;&gt;/* Avoid overwriting the global configuration until we have loaded&lt;/span&gt;
&lt;span class=&#34;hljs-comment&#34;&gt;       everything successfully.  Otherwise, if the file change&lt;/span&gt;
&lt;span class=&#34;hljs-comment&#34;&gt;       information changes back to what is in the global configuration,&lt;/span&gt;
&lt;span class=&#34;hljs-comment&#34;&gt;       the lookups would use the partially-written  configuration.  */&lt;/span&gt;
    &lt;span class=&#34;hljs-class&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;hljs-title&#34;&gt;nss_database_data&lt;/span&gt; &lt;span class=&#34;hljs-title&#34;&gt;staging&lt;/span&gt; = {&lt;/span&gt;
        .initialized = &lt;span class=&#34;hljs-literal&#34;&gt;true&lt;/span&gt;,
    };
    &lt;span class=&#34;hljs-keyword&#34;&gt;bool&lt;/span&gt; ok = nss_database_reload(&amp;amp;staging, &amp;amp;initial);
    &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; (ok)
    {
        __libc_lock_lock(local-&amp;gt;lock);
        &lt;span class=&#34;hljs-comment&#34;&gt;/* See above for memory order.  */&lt;/span&gt;
        &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; (!atomic_load_acquire(&amp;amp;local-&amp;gt;data.reload_disabled))
            &lt;span class=&#34;hljs-comment&#34;&gt;/* This may go back in time if another thread beats this&lt;/span&gt;
&lt;span class=&#34;hljs-comment&#34;&gt;               thread with the update, but in this case, a reload happens&lt;/span&gt;
&lt;span class=&#34;hljs-comment&#34;&gt;               on the next NSS call.  */&lt;/span&gt;
            local-&amp;gt;data = staging;
        *result = local-&amp;gt;data.services[database_index];
        __libc_lock_unlock(local-&amp;gt;lock);
    }
    &lt;span class=&#34;hljs-keyword&#34;&gt;return&lt;/span&gt; ok;
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;In the first if statement, we check whether to perform a reload via &lt;code&gt;reload_disabled&lt;/code&gt; and if that value is set, we store the current value in result without reloading.&lt;/p&gt;
&lt;p&gt;After that, we check to see if the file has changed or if another thread is updating it in the meantime, and then proceed with the reload by calling &lt;code&gt;nss_databse_reload()&lt;/code&gt;. We get a return value of ok and check by calling &lt;code&gt;atomic_load_acquire(&amp;amp;local-&amp;gt;data.reload_disabled)&lt;/code&gt; as in the first if statement.&lt;/p&gt;
&lt;p&gt;If so, we can expect that &lt;code&gt;local-&amp;gt;data.reload_disabled&lt;/code&gt; is set to 1, or that the if statement associated with the file check terminates, preventing it from reloading.&lt;/p&gt;
&lt;p&gt;Since nss_database was reloaded after &lt;code&gt;pivot_root&lt;/code&gt;, let&amp;#x2019;s look at it after &lt;code&gt;unpivot_root&lt;/code&gt; with gdb to determine the exact cause.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;hljs bash&#34;&gt;Breakpoint 1.1, pivot_root (new_root=0x562c1e75943c &lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;woot&amp;quot;&lt;/span&gt;, state=0x7fff9f7e6638) at ./pivot.c:39
39      {
(gdb) c
Continuing.
Download failed: Invalid argument.  Continuing without &lt;span class=&#34;hljs-built_in&#34;&gt;source&lt;/span&gt; file ./nss/./nss/nss_database.c.

Breakpoint 2, nss_database_check_reload_and_get (&lt;span class=&#34;hljs-built_in&#34;&gt;local&lt;/span&gt;=0x562c1e753990, result=0x7fff9f7e5f10, database_index=nss_database_initgroups) at ./nss/nss_database.c:396
warning: 396    ./nss/nss_database.c: No such file or directory
(gdb) c
Continuing.
...
Breakpoint 1, unpivot_root (state=state@entry=0x7fff7b4bbd38) at ./pivot.c:64
64      {
Breakpoint 2, nss_database_check_reload_and_get (&lt;span class=&#34;hljs-built_in&#34;&gt;local&lt;/span&gt;=0x5631f772d990, result=0x7fb3a825fb30 &amp;lt;__nss_passwd_database&amp;gt;, database_index=nss_database_passwd) at ./nss/nss_database.c:396
warning: 396    ./nss/nss_database.c: No such file or directory
(gdb) n
...
(gdb) info args
&lt;span class=&#34;hljs-built_in&#34;&gt;local&lt;/span&gt; = &amp;lt;optimized out&amp;gt;
result = 0x7fb3a825fb30 &amp;lt;__nss_passwd_database&amp;gt;
database_index = nss_database_passwd
(gdb) n
&lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; (&lt;span class=&#34;hljs-built_in&#34;&gt;local&lt;/span&gt;-&amp;gt;data.services[database_index] != NULL)
425     &lt;span class=&#34;hljs-keyword&#34;&gt;in&lt;/span&gt; ./nss/nss_database.c
(gdb) n
&lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; (stat_rv != 0 || (&lt;span class=&#34;hljs-built_in&#34;&gt;local&lt;/span&gt;-&amp;gt;root_ino != 0 &amp;amp;&amp;amp; (str.st_ino != &lt;span class=&#34;hljs-built_in&#34;&gt;local&lt;/span&gt;-&amp;gt;root_ino || str.st_dev != &lt;span class=&#34;hljs-built_in&#34;&gt;local&lt;/span&gt;-&amp;gt;root_dev)))
431     &lt;span class=&#34;hljs-keyword&#34;&gt;in&lt;/span&gt; ./nss/nss_database.c&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Immediately after &lt;code&gt;pivot_root&lt;/code&gt; it was database_index = nss_database_initgroup, but after &lt;code&gt;unpivot_root&lt;/code&gt; it is passed nss_database_passwd, so it enters the syntax where &lt;code&gt;local-&amp;gt;data.reload_disabled&lt;/code&gt; is set to 1, and it will not reload.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;hljs bash&#34;&gt;(gdb) p *&lt;span class=&#34;hljs-built_in&#34;&gt;local&lt;/span&gt;-&amp;gt;data.services[6]-&amp;gt;module  &lt;span class=&#34;hljs-comment&#34;&gt;#nss_databse_initgroups&lt;/span&gt;
Cannot access memory at address 0x0
(gdb) p *&lt;span class=&#34;hljs-built_in&#34;&gt;local&lt;/span&gt;-&amp;gt;data.services[9]   &lt;span class=&#34;hljs-comment&#34;&gt;#nss_databse_passwd&lt;/span&gt;
&lt;span class=&#34;hljs-variable&#34;&gt;$25&lt;/span&gt; = {module = 0x5590f5e38a70, action_bits = 320}
(gdb) &lt;span class=&#34;hljs-built_in&#34;&gt;set&lt;/span&gt; &lt;span class=&#34;hljs-variable&#34;&gt;$m&lt;/span&gt; = (struct nss_module *) &lt;span class=&#34;hljs-built_in&#34;&gt;local&lt;/span&gt;-&amp;gt;data.services[9]-&amp;gt;module
(gdb) x/s &lt;span class=&#34;hljs-variable&#34;&gt;$m&lt;/span&gt;-&amp;gt;name
0x558e8c22bfb8: &lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;/woot1337&amp;quot;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Checking via gdb, we see that in &lt;code&gt;pivot_root&lt;/code&gt;, database_initgroup enters the default value of 0 and the statement is not executed, allowing us to reload, and in &lt;code&gt;unpivot_root&lt;/code&gt;, database_passwd is used as an argument and the statement is executed, not reloading the nsswitch.conf on the original root.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/2025/07/21/poosic/[Research]_CVE-2025-32463/EN/3.png&#34; alt&gt;&lt;/p&gt;
&lt;p&gt;While analyzing, I now have one more question. &amp;#x2018;How does it load a malicious lib with /woot1337 (the path to the malicious lib) in passwd&amp;#x2019;.&lt;/p&gt;
&lt;h2 id=&#34;how-to-load-my-lib&#34;&gt;&lt;a href=&#34;#how-to-load-my-lib&#34; class=&#34;headerlink&#34; title=&#34;how to load my_lib?&#34;&gt;&lt;/a&gt;how to load my_lib?&lt;/h2&gt;&lt;p&gt;Let&amp;#x2019;s break point at the point where we load the malicious lib and look at the backtrace.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;hljs bash&#34;&gt;Catchpoint 1
  Inferior loaded libnss_/woot1337.so.2
dl_open_worker_begin (a=a@entry=0x7ffcfd5bc3b0) at ./elf/dl-open.c:775
warning: 775    ./elf/dl-open.c: No such file or directory
(gdb) bt
&lt;span class=&#34;hljs-comment&#34;&gt;#0  dl_open_worker_begin (a=a@entry=0x7ffcfd5bc3b0) at ./elf/dl-open.c:775&lt;/span&gt;
...
&lt;span class=&#34;hljs-comment&#34;&gt;#4  0x00007f6a81a5d164 in _dl_open (file=0x55d54daf0e00 &amp;quot;libnss_/woot1337.so.2&amp;quot;, mode=&amp;lt;optimized out&amp;gt;, caller_dlopen=0x7f6a81968a0f &amp;lt;module_load+175&amp;gt;, nsid=&amp;lt;optimized out&amp;gt;, argc=4, argv=0x7ffcfd5be468, env=0x7ffcfd5be490) at ./elf/dl-open.c:905&lt;/span&gt;
...
&lt;span class=&#34;hljs-comment&#34;&gt;#10 0x00007f6a81968a0f in module_load (module=0x55d54daebda0) at ./nss/nss_module.c:187&lt;/span&gt;
&lt;span class=&#34;hljs-comment&#34;&gt;#11 0x00007f6a81968ee5 in __nss_module_load (module=0x55d54daebda0) at ./nss/nss_module.c:302&lt;/span&gt;
&lt;span class=&#34;hljs-comment&#34;&gt;#12 __nss_module_get_function (module=0x55d54daebda0, name=name@entry=0x7f6a819e4128 &amp;quot;getpwnam_r&amp;quot;) at ./nss/nss_module.c:328&lt;/span&gt;
&lt;span class=&#34;hljs-comment&#34;&gt;#13 0x00007f6a8196960b in __GI___nss_lookup_function (fct_name=0x7f6a819e4128 &amp;quot;getpwnam_r&amp;quot;, ni=&amp;lt;optimized out&amp;gt;) at ./nss/nsswitch.c:137&lt;/span&gt;
&lt;span class=&#34;hljs-comment&#34;&gt;#14 __GI___nss_lookup (ni=ni@entry=0x7ffcfd5bc9a8, fct_name=fct_name@entry=0x7f6a819e4128 &amp;quot;getpwnam_r&amp;quot;, fct2_name=fct2_name@entry=0x0, fctp=fctp@entry=0x7ffcfd5bc9b0) at ./nss/nsswitch.c:67&lt;/span&gt;
&lt;span class=&#34;hljs-comment&#34;&gt;#15 0x00007f6a81965928 in __GI___nss_passwd_lookup2 (ni=ni@entry=0x7ffcfd5bc9a8, fct_name=fct_name@entry=0x7f6a819e4128 &amp;quot;getpwnam_r&amp;quot;, fct2_name=fct2_name@entry=0x0, fctp=fctp@entry=0x7ffcfd5bc9b0) at ./nss/XXX-lookup.c:62&lt;/span&gt;
&lt;span class=&#34;hljs-comment&#34;&gt;#16 0x00007f6a81977628 in __getpwnam_r (name=0x55d54daec830 &amp;quot;root&amp;quot;, resbuf=0x55d54daf0e20,&lt;/span&gt;
    buffer=0x55d54daf0e50 &lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;r is\n#used.  If you really want nothing to happen then use pam_permit.so or\n#pam_deny.so as appropriate.\n\n# We fall back to the system default in /etc/pam.d/common-*\n# \n\n@include common-auth\n@include &amp;quot;&lt;/span&gt;..., buflen=1024, result=0x7ffcfd5bca28)
    at ../nss/getXXbyYY_r.c:264
...
&lt;span class=&#34;hljs-comment&#34;&gt;#27 0x00007f6a812229d3 in sudoers_policy_check (argc=1, argv=0x7ffcfd5be480, env_add=0x0, command_infop=0x7ffcfd5bd050, argv_out=0x7ffcfd5bd058, user_env_out=0x7ffcfd5bd060, errstr=0x7ffcfd5bd078) at ./policy.c:1244&lt;/span&gt;
&lt;span class=&#34;hljs-comment&#34;&gt;#28 0x000055d54cf16fb3 in policy_check (run_envp=0x7ffcfd5bd060, run_argv=0x7ffcfd5bd058, command_info=0x7ffcfd5bd050, env_add=0x0, argv=0x7ffcfd5be480, argc=1) at ./sudo.c:1266&lt;/span&gt;
&lt;span class=&#34;hljs-comment&#34;&gt;#29 main (argc=&amp;lt;optimized out&amp;gt;, argv=&amp;lt;optimized out&amp;gt;, envp=&amp;lt;optimized out&amp;gt;) at ./sudo.c:261&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;After the &lt;code&gt;nss_passwd_lookup&lt;/code&gt;, we run the functions for the module load. Let&amp;#x2019;s take a look at &lt;code&gt;module_load()&lt;/code&gt;.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;hljs bash&#34;&gt;module_load (struct nss_module *module)
{
  &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; (strcmp (module-&amp;gt;name, &lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;files&amp;quot;&lt;/span&gt;) == 0)
    &lt;span class=&#34;hljs-built_in&#34;&gt;return&lt;/span&gt; module_load_nss_files (module);
  &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; (strcmp (module-&amp;gt;name, &lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;dns&amp;quot;&lt;/span&gt;) == 0)
    &lt;span class=&#34;hljs-built_in&#34;&gt;return&lt;/span&gt; module_load_nss_dns (module);
  void *handle;
  {
    char *shlib_name;
    &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; (__asprintf (&amp;amp;shlib_name, &lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;libnss_%s.so%s&amp;quot;&lt;/span&gt;,
                    module-&amp;gt;name, __nss_shlib_revision) &amp;lt; 0)
      /* This is definitely a temporary failure.  Do not update
         module-&amp;gt;state.  This will trigger another attempt at the next
         call.  */
      &lt;span class=&#34;hljs-built_in&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;hljs-literal&#34;&gt;false&lt;/span&gt;;
    handle = __libc_dlopen (shlib_name);
    free (shlib_name);
  }
  ...&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;In nsswitch.conf, we basically define something like &lt;code&gt;passwd: files systemd&lt;/code&gt;, which means that if we&amp;#x2019;re not looking for passwd information in the /etc/passwd file, we&amp;#x2019;ll load &lt;code&gt;libnss_systemd.so.2&lt;/code&gt; and look it up in the db. If we come back to module_load again, because we simply gave a path value for passwd, after &lt;code&gt;asprintf&lt;/code&gt;, the shlib_name will have &lt;code&gt;libnss_woot1337.so.2&lt;/code&gt; in it and the malware will execute.&lt;/p&gt;
&lt;h2 id=&#34;Outro&#34;&gt;&lt;a href=&#34;#Outro&#34; class=&#34;headerlink&#34; title=&#34;Outro&#34;&gt;&lt;/a&gt;Outro&lt;/h2&gt;&lt;p&gt;&lt;img src=&#34;/2025/07/21/poosic/[Research]_CVE-2025-32463/EN/4.png&#34; alt&gt;&lt;/p&gt;
&lt;p&gt;I know that&amp;#x2019;s three questions instead of two, but let&amp;#x2019;s wrap things up with a final roundup of questions and the answers I found to them!&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;p&gt;where is nsswitch.conf loaded in that code?&lt;/p&gt;
&lt;p&gt; A. nss_database_check_reload_and_get to check and update the nss_database.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;why does nsswitch.conf recognize files in the root directory that have been replaced with chroot?&lt;/p&gt;
&lt;p&gt; A. Because &lt;code&gt;local-&amp;gt;data.reload_disabled&lt;/code&gt; is set to 1 and is not reloaded while checking nss_database after &lt;code&gt;unpivot_root&lt;/code&gt;.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;passwd contains /woot1337 (malicious lib path), does LPE load possible libs?&lt;/p&gt;
&lt;p&gt; A. During the &lt;code&gt;module_load&lt;/code&gt; process, path is neither files nor dns, so it is recognized as a lib and tries to load the module.&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;I didn&amp;#x2019;t expect to dig this deep after a day of writing lines, I&amp;#x2019;m very familiar with sudo but never had a chance to look at it like this, so I feel like I&amp;#x2019;ve gotten a little bit more familiar with sudo!&lt;/p&gt;
&lt;p&gt;Thanks for reading this long post and I&amp;#x2019;ll see you next time with something better!&lt;/p&gt;
&lt;h2 id=&#34;Reference&#34;&gt;&lt;a href=&#34;#Reference&#34; class=&#34;headerlink&#34; title=&#34;Reference&#34;&gt;&lt;/a&gt;Reference&lt;/h2&gt;&lt;p&gt;[1] &lt;a href=&#34;https://github.com/pr0v3rbs/CVE-2025-32463_chwoot/tree/main&#34;&gt;https://github.com/pr0v3rbs/CVE-2025-32463_chwoot/tree/main&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;[2] &lt;a href=&#34;https://codebrowser.dev/glibc/glibc/nss/nsswitch.c.html#132&#34;&gt;https://codebrowser.dev/glibc/glibc/nss/nsswitch.c.html#132&lt;/a&gt;&lt;/p&gt;
 - hack &amp; life">
  <meta name="author" content="j0dev, y2sman">
  <meta name="keywords" content>
  <meta name="google-site-verification" content="DXkyiaX95-ws53Tyt0m91_umRf4gfV2qJIQZ5zQDIO4">
  <meta name="naver-site-verification" content="0b4fea742ed293b82621684e466d9f26c3ccee06">


  <meta property="og:type" content="website"> 
  <meta property="og:title" content="[Research] CVE-2025-32463 Into the &#39;sudo -R&#39;(EN) - hackyboiz">
  <meta property="og:description" content="&lt;h2 id=&#34;Intro&#34;&gt;&lt;a href=&#34;#Intro&#34; class=&#34;headerlink&#34; title=&#34;Intro&#34;&gt;&lt;/a&gt;Intro&lt;/h2&gt;&lt;p&gt;Hi, I&amp;#x2019;m poosic. I&amp;#x2019;m back on Hackyboiz with my first research article! &amp;gt;_-&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/2025/07/21/poosic/[Research]_CVE-2025-32463/EN/1.png&#34; alt&gt;&lt;/p&gt;
&lt;p&gt;In this post, I&amp;#x2019;ll try to answer some of the questions I had while researching CVE-2025-32463: LPE with chroot in sudo. For a high-level overview of the vulnerability, see &lt;a href=&#34;https://hackyboiz.github.io/2025/07/12/poosic/cve-2025-32463/&#34;&gt;1Day1Line&lt;/a&gt;!&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;hljs bash&#34;&gt;&lt;span class=&#34;hljs-comment&#34;&gt;# sudoers.c&lt;/span&gt;
pivot_root()
-&amp;gt; resolve_cmnd() &lt;span class=&#34;hljs-comment&#34;&gt;# load changed root&amp;apos;s nsswitch.conf&lt;/span&gt;
-&amp;gt; unpivot_root() &lt;span class=&#34;hljs-comment&#34;&gt;# not load original root&amp;apos;s nsswitch.conf&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;However, if we briefly look at the flow of &lt;code&gt;sudoers.c&lt;/code&gt;, the vulnerability occurred because the NSS API is called in the &lt;code&gt;resolve_cmnd&lt;/code&gt; function after &lt;code&gt;pivot_root&lt;/code&gt; is executed, and the attacker&amp;#x2019;s arbitrary file (&lt;code&gt;/etc/nsswitch.conf&lt;/code&gt;) loaded with root privileges through &lt;code&gt;pivot_root&lt;/code&gt; is read and the nss_database related information is updated, but it is not updated to the original root&amp;#x2019;s nss_database after &lt;code&gt;unpivot_root&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;When I looked at &lt;code&gt;pivot.c&lt;/code&gt; and &lt;code&gt;sudoers.c&lt;/code&gt; where the vulnerability occurred, I had questions. The questions were as follows.&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;where is nsswitch.conf loaded in that code?&lt;/li&gt;
&lt;li&gt;why is nsswitch.conf recognizing files in the root directory that have been replaced with chroot?&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;When I checked the sudo v1.9.17 pivot.c code where the vulnerability actually occurred, I found that &lt;code&gt;unpivot_chroot()&lt;/code&gt; dutifully reads nsswitch.conf back in, so the problem got even more muddled.&lt;/p&gt;
&lt;p&gt;The obvious way to find out would be to see the sudo repo in git or analyze it with gdb.&lt;/p&gt;
&lt;h2 id=&#34;Environment-setting&#34;&gt;&lt;a href=&#34;#Environment-setting&#34; class=&#34;headerlink&#34; title=&#34;Environment setting&#34;&gt;&lt;/a&gt;Environment setting&lt;/h2&gt;&lt;p&gt;When I first set up the environment, I was going to compile sudo and glibc for debugging on my existing Ubuntu, but since the Ubuntu I installed on WSL didn&amp;#x2019;t use the -R option, there were a lot of things to set up in sudo.conf and other files, so I found a slightly(?) easier way.&lt;/p&gt;
&lt;p&gt;If you want to follow along with this article and analyze it, you can refer to [1] in the reference below to proceed with the installation. The installation process is simple, so let&amp;#x2019;s skip it and start setting up the environment.&lt;/p&gt;
&lt;p&gt;The environment doesn&amp;#x2019;t have gdb installed, obviously you need to have sudo privileges to install gdb, but when I run run.sh, I can&amp;#x2019;t install gdb because it puts me as a regular user named pwn.&lt;/p&gt;
&lt;p&gt;I stupidly went back to doing my own configuration here and thought, &amp;#x201C;Hahaha I can have sudo privileges!&amp;#x201D; and used the POC script that docker set up for me to get root privileges and install gdb.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/2025/07/21/poosic/[Research]_CVE-2025-32463/EN/2.jpg&#34; alt&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;L0ch finds out, and I remind him of the emotion of shock.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;In my delirium, I forgot that this is a docker container that I put up locally&amp;#x2026; You can easily set it up as root with &lt;code&gt;docker exec -it --user root &amp;lt;container-id&amp;gt; bash&lt;/code&gt;.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;hljs bash&#34;&gt;root@a593a22215ca:/&lt;span class=&#34;hljs-comment&#34;&gt;# echo &amp;apos;pwn ALL=(ALL) NOPASSWD:ALL&amp;apos; &amp;gt;&amp;gt; /etc/sudoers&lt;/span&gt;
root@a593a22215ca:/&lt;span class=&#34;hljs-comment&#34;&gt;# su - pwn&lt;/span&gt;
pwn@a593a22215ca:/tmp/sudowoot.stage.Ex5pZ2$ sudo gdb --args sudo -R woot woot&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;In order to debug sudo, you need sudo privileges. You can do it as root, but I gave sudo privileges to a pwn with normal privileges just in case it makes a difference in the flow. Afterwards, run gdb with sudo privileges and you&amp;#x2019;re ready to debug. Now let&amp;#x2019;s get started!&lt;/p&gt;
&lt;h2 id=&#34;After-pivot-root&#34;&gt;&lt;a href=&#34;#After-pivot-root&#34; class=&#34;headerlink&#34; title=&#34;After pivot_root&#34;&gt;&lt;/a&gt;After pivot_root&lt;/h2&gt;&lt;pre&gt;&lt;code class=&#34;hljs bash&#34;&gt;(gdb) b pivot_root
(gdb) r
Breakpoint 1.1, pivot_root (new_root=0x55aae9e866dc &lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;woot&amp;quot;&lt;/span&gt;, state=0x7ffd8c3bb4a8) at ./pivot.c:39
39      {
(gdb) b fopen
Breakpoint 2 at 0x7ff5aaf55e60: file ./libio/iofopen.c, line 85.&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;To find where nsswitch.conf is loaded, we first breakpointed the point where it opens after &lt;code&gt;pivot_root&lt;/code&gt;.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;hljs bash&#34;&gt;Breakpoint 2, _IO_new_fopen (filename=filename@entry=0x7ff5ab09ed92 &lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;/etc/nsswitch.conf&amp;quot;&lt;/span&gt;, mode=mode@entry=0x7ff5ab09adb4 &lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;rce&amp;quot;&lt;/span&gt;)
    at ./libio/iofopen.c:85
(gdb) bt
&lt;span class=&#34;hljs-comment&#34;&gt;#0  _IO_new_fopen (filename=filename@entry=0x7ff5ab09ed92 &amp;quot;/etc/nsswitch.conf&amp;quot;, mode=mode@entry=0x7ff5ab09adb4 &amp;quot;rce&amp;quot;)&lt;/span&gt;
    at ./libio/iofopen.c:85
&lt;span class=&#34;hljs-comment&#34;&gt;#1  0x00007ff5ab02247d in nss_database_reload (initial=0x7ffd8c3bab90, staging=0x7ffd8c3bac50) at ./nss/nss_database.c:306&lt;/span&gt;
&lt;span class=&#34;hljs-comment&#34;&gt;#2  nss_database_check_reload_and_get (local=&amp;lt;optimized out&amp;gt;, result=0x7ffd8c3bad80, database_index=nss_database_initgroups)&lt;/span&gt;
    at ./nss/nss_database.c:457
&lt;span class=&#34;hljs-comment&#34;&gt;#3  0x00007ff5ab026ddc in internal_getgrouplist (user=user@entry=0x55aae9e87d98 &amp;quot;root&amp;quot;, group=group@entry=0,&lt;/span&gt;
    size=size@entry=0x7ffd8c3badd8, groupsp=groupsp@entry=0x7ffd8c3bade0, &lt;span class=&#34;hljs-built_in&#34;&gt;limit&lt;/span&gt;=&lt;span class=&#34;hljs-built_in&#34;&gt;limit&lt;/span&gt;@entry=-1) at ./nss/initgroups.c:75
&lt;span class=&#34;hljs-comment&#34;&gt;#4  0x00007ff5ab0270dc in getgrouplist (user=user@entry=0x55aae9e87d98 &amp;quot;root&amp;quot;, group=group@entry=0,&lt;/span&gt;
    groups=groups@entry=0x7ff5aa7c9010, ngroups=ngroups@entry=0x7ffd8c3bae44) at ./nss/initgroups.c:156
&lt;span class=&#34;hljs-comment&#34;&gt;#5  0x00007ff5ab0f1149 in sudo_getgrouplist2_v1 (name=0x55aae9e87d98 &amp;quot;root&amp;quot;, basegid=0, groupsp=groupsp@entry=0x7ffd8c3baea0,&lt;/span&gt;
    ngroupsp=ngroupsp@entry=0x7ffd8c3baeac) at ./getgrouplist.c:105
&lt;span class=&#34;hljs-comment&#34;&gt;#6  0x00007ff5aa967b5e in sudo_make_gidlist_item (pw=0x55aae9e87d68, ngids=&amp;lt;optimized out&amp;gt;, gids=&amp;lt;optimized out&amp;gt;, gidstrs=0x0,&lt;/span&gt;
    &lt;span class=&#34;hljs-built_in&#34;&gt;type&lt;/span&gt;=1) at ./pwutil_impl.c:306
&lt;span class=&#34;hljs-comment&#34;&gt;#7  0x00007ff5aa9666b5 in sudo_get_gidlist (pw=0x55aae9e87d68, type=type@entry=1) at ./pwutil.c:1033&lt;/span&gt;
&lt;span class=&#34;hljs-comment&#34;&gt;#8  0x00007ff5aa95de8b in runas_getgroups (ctx=ctx@entry=0x7ff5aa9b76c0 &amp;lt;sudoers_ctx&amp;gt;) at ./match.c:146&lt;/span&gt;
&lt;span class=&#34;hljs-comment&#34;&gt;#9  0x00007ff5aa949f9c in runas_setgroups (ctx=0x7ff5aa9b76c0 &amp;lt;sudoers_ctx&amp;gt;) at ./set_perms.c:1634&lt;/span&gt;
&lt;span class=&#34;hljs-comment&#34;&gt;#10 set_perms (ctx=ctx@entry=0x7ff5aa9b76c0 &amp;lt;sudoers_ctx&amp;gt;, perm=perm@entry=5) at ./set_perms.c:285&lt;/span&gt;
&lt;span class=&#34;hljs-comment&#34;&gt;#11 0x00007ff5aa9690a8 in resolve_cmnd (ctx=ctx@entry=0x7ff5aa9b76c0 &amp;lt;sudoers_ctx&amp;gt;, infile=infile@entry=0x7ffd8c3bd7a2 &amp;quot;woot&amp;quot;,&lt;/span&gt;
    outfile=outfile@entry=0x7ffd8c3bb4b0,
    path=path@entry=0x55aae9e8dbc0 &lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin&amp;quot;&lt;/span&gt;) at ./resolve_cmnd.c:42
&lt;span class=&#34;hljs-comment&#34;&gt;#12 0x00007ff5aa94cf1c in set_cmnd_path (ctx=ctx@entry=0x7ff5aa9b76c0 &amp;lt;sudoers_ctx&amp;gt;, runchroot=0x55aae9e866dc &amp;quot;woot&amp;quot;)&lt;/span&gt;
    at ./sudoers.c:1108
&lt;span class=&#34;hljs-comment&#34;&gt;#13 0x00007ff5aa94d3a7 in set_cmnd (ctx=0x7ff5aa9b76c0 &amp;lt;sudoers_ctx&amp;gt;) at ./sudoers.c:1177&lt;/span&gt;
&lt;span class=&#34;hljs-comment&#34;&gt;#14 sudoers_check_common (pwflag=pwflag@entry=0, ctx=0x7ff5aa9b76c0 &amp;lt;sudoers_ctx&amp;gt;) at ./sudoers.c:358&lt;/span&gt;
&lt;span class=&#34;hljs-comment&#34;&gt;#15 0x00007ff5aa94ea28 in sudoers_check_cmnd (argc=argc@entry=1, argv=argv@entry=0x7ffd8c3bcb30, env_add=env_add@entry=0x0,&lt;/span&gt;
    closure=closure@entry=0x7ffd8c3bb640) at ./sudoers.c:689
&lt;span class=&#34;hljs-comment&#34;&gt;#16 0x00007ff5aa9449d3 in sudoers_policy_check (argc=1, argv=0x7ffd8c3bcb30, env_add=0x0, command_infop=0x7ffd8c3bb700,&lt;/span&gt;
    argv_out=0x7ffd8c3bb708, user_env_out=0x7ffd8c3bb710, errstr=0x7ffd8c3bb728) at ./policy.c:1244
&lt;span class=&#34;hljs-comment&#34;&gt;#17 0x000055aae921efb3 in policy_check (run_envp=0x7ffd8c3bb710, run_argv=0x7ffd8c3bb708, command_info=0x7ffd8c3bb700, env_add=0x0,&lt;/span&gt;
    argv=0x7ffd8c3bcb30, argc=1) at ./sudo.c:1266
&lt;span class=&#34;hljs-comment&#34;&gt;#18 main (argc=&amp;lt;optimized out&amp;gt;, argv=&amp;lt;optimized out&amp;gt;, envp=&amp;lt;optimized out&amp;gt;) at ./sudo.c:261&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Now that we&amp;#x2019;ve verified that &lt;code&gt;fopen&lt;/code&gt; loads &lt;code&gt;/etc/nsswitch.conf&lt;/code&gt; as an argument, let&amp;#x2019;s check the callstack with the backtrace command. The first thing we see is &lt;code&gt;nss_databse_reload&lt;/code&gt; and &lt;code&gt;nss_database_check_reload_and_get&lt;/code&gt;, which are related to nss. In our current flow, these functions do the following&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;nss_database_check_reload_and_get: reload if nsswitch.conf has been changed.&lt;/li&gt;
&lt;li&gt;nss_database_reload: Open and parse the &lt;code&gt;/etc/nsswitch.conf&lt;/code&gt; file, populate &lt;code&gt;staging&lt;/code&gt; with NSS service information, and fill in default values if necessary.&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;&lt;code class=&#34;hljs c&#34;&gt;(gdb) c
Breakpoint &lt;span class=&#34;hljs-number&#34;&gt;3&lt;/span&gt;, unpivot_root()
(gdb) c
Breakpoint &lt;span class=&#34;hljs-number&#34;&gt;4&lt;/span&gt;, nss_database_check_reload_and_get()
(gdb) c
Continuing.
Downloading separate debug info &lt;span class=&#34;hljs-keyword&#34;&gt;for&lt;/span&gt; libnss_/woot1337.so&lt;span class=&#34;hljs-number&#34;&gt;.2&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;I thought it would just skip &lt;code&gt;unpivot_root()&lt;/code&gt; afterward, but it&amp;#x2019;s caught at the break point. It loads &lt;code&gt;nss_database_check_reload_and_get()&lt;/code&gt; but doesn&amp;#x2019;t call &lt;code&gt;nss_database_reload()&lt;/code&gt;, unlike after pivot. So the problem is that &lt;code&gt;nss_database_reload&lt;/code&gt; doesn&amp;#x2019;t happen at &lt;code&gt;unpivot_root&lt;/code&gt;, so we still have the nsswitch.conf recognized by chroot.&lt;/p&gt;
&lt;p&gt;Now let&amp;#x2019;s take a hard look at the code!&lt;/p&gt;
&lt;h2 id=&#34;After-unpivot-root&#34;&gt;&lt;a href=&#34;#After-unpivot-root&#34; class=&#34;headerlink&#34; title=&#34;After unpivot_root&#34;&gt;&lt;/a&gt;After unpivot_root&lt;/h2&gt;&lt;pre&gt;&lt;code class=&#34;hljs c&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;static&lt;/span&gt; &lt;span class=&#34;hljs-keyword&#34;&gt;bool&lt;/span&gt;
nss_database_check_reload_and_get(struct nss_database_state *local,
                                  nss_action_list *result,
                                  &lt;span class=&#34;hljs-keyword&#34;&gt;enum&lt;/span&gt; nss_database database_index)
{
    &lt;span class=&#34;hljs-class&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;struct&lt;/span&gt; __&lt;span class=&#34;hljs-title&#34;&gt;stat64_t64&lt;/span&gt; &lt;span class=&#34;hljs-title&#34;&gt;str&lt;/span&gt;;&lt;/span&gt;
    &lt;span class=&#34;hljs-comment&#34;&gt;/* Acquire MO is needed because the thread that sets reload_disabled&lt;/span&gt;
&lt;span class=&#34;hljs-comment&#34;&gt;       may have loaded the configuration first, so synchronize with the&lt;/span&gt;
&lt;span class=&#34;hljs-comment&#34;&gt;       Release MO store there.  */&lt;/span&gt;
    &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; (atomic_load_acquire(&amp;amp;local-&amp;gt;data.reload_disabled))
    {
        *result = local-&amp;gt;data.services[database_index];
        &lt;span class=&#34;hljs-comment&#34;&gt;/* No reload, so there is no error.  */&lt;/span&gt;
        &lt;span class=&#34;hljs-keyword&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;hljs-literal&#34;&gt;true&lt;/span&gt;;
    }
    &lt;span class=&#34;hljs-class&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;hljs-title&#34;&gt;file_change_detection&lt;/span&gt; &lt;span class=&#34;hljs-title&#34;&gt;initial&lt;/span&gt;;&lt;/span&gt;
    &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; (!__file_change_detection_for_path(&amp;amp;initial, _PATH_NSSWITCH_CONF))
        &lt;span class=&#34;hljs-keyword&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;hljs-literal&#34;&gt;false&lt;/span&gt;;
    __libc_lock_lock(local-&amp;gt;lock);
    &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; (__file_is_unchanged(&amp;amp;initial, &amp;amp;local-&amp;gt;data.nsswitch_conf))
    {
        &lt;span class=&#34;hljs-comment&#34;&gt;/* Configuration is up-to-date.  Read it and return it to the&lt;/span&gt;
&lt;span class=&#34;hljs-comment&#34;&gt;           caller.  */&lt;/span&gt;
        *result = local-&amp;gt;data.services[database_index];
        __libc_lock_unlock(local-&amp;gt;lock);
        &lt;span class=&#34;hljs-keyword&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;hljs-literal&#34;&gt;true&lt;/span&gt;;
    }
    &lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; stat_rv = __stat64_time64(&lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;/&amp;quot;&lt;/span&gt;, &amp;amp;str);
    &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; (local-&amp;gt;data.services[database_index] != &lt;span class=&#34;hljs-literal&#34;&gt;NULL&lt;/span&gt;)
    {
        &lt;span class=&#34;hljs-comment&#34;&gt;/* Before we reload, verify that &amp;quot;/&amp;quot; hasn&amp;apos;t changed.  We assume that&lt;/span&gt;
&lt;span class=&#34;hljs-comment&#34;&gt;          errors here are very unlikely, but the chance that we&amp;apos;re entering&lt;/span&gt;
&lt;span class=&#34;hljs-comment&#34;&gt;          a container is also very unlikely, so we err on the side of both&lt;/span&gt;
&lt;span class=&#34;hljs-comment&#34;&gt;          very unlikely things not happening at the same time.  */&lt;/span&gt;
        &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; (stat_rv != &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt; || (local-&amp;gt;root_ino != &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt; &amp;amp;&amp;amp; (str.st_ino != local-&amp;gt;root_ino || str.st_dev != local-&amp;gt;root_dev)))
        {
            &lt;span class=&#34;hljs-comment&#34;&gt;/* Change detected; disable reloading and return current state.  */&lt;/span&gt;
            atomic_store_release(&amp;amp;local-&amp;gt;data.reload_disabled, &lt;span class=&#34;hljs-number&#34;&gt;1&lt;/span&gt;);
            *result = local-&amp;gt;data.services[database_index];
            __libc_lock_unlock(local-&amp;gt;lock);
            &lt;span class=&#34;hljs-keyword&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;hljs-literal&#34;&gt;true&lt;/span&gt;;
        }
    }
    &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; (stat_rv == &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;)
    {
        local-&amp;gt;root_ino = str.st_ino;
        local-&amp;gt;root_dev = str.st_dev;
    }
    __libc_lock_unlock(local-&amp;gt;lock);
    &lt;span class=&#34;hljs-comment&#34;&gt;/* Avoid overwriting the global configuration until we have loaded&lt;/span&gt;
&lt;span class=&#34;hljs-comment&#34;&gt;       everything successfully.  Otherwise, if the file change&lt;/span&gt;
&lt;span class=&#34;hljs-comment&#34;&gt;       information changes back to what is in the global configuration,&lt;/span&gt;
&lt;span class=&#34;hljs-comment&#34;&gt;       the lookups would use the partially-written  configuration.  */&lt;/span&gt;
    &lt;span class=&#34;hljs-class&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;hljs-title&#34;&gt;nss_database_data&lt;/span&gt; &lt;span class=&#34;hljs-title&#34;&gt;staging&lt;/span&gt; = {&lt;/span&gt;
        .initialized = &lt;span class=&#34;hljs-literal&#34;&gt;true&lt;/span&gt;,
    };
    &lt;span class=&#34;hljs-keyword&#34;&gt;bool&lt;/span&gt; ok = nss_database_reload(&amp;amp;staging, &amp;amp;initial);
    &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; (ok)
    {
        __libc_lock_lock(local-&amp;gt;lock);
        &lt;span class=&#34;hljs-comment&#34;&gt;/* See above for memory order.  */&lt;/span&gt;
        &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; (!atomic_load_acquire(&amp;amp;local-&amp;gt;data.reload_disabled))
            &lt;span class=&#34;hljs-comment&#34;&gt;/* This may go back in time if another thread beats this&lt;/span&gt;
&lt;span class=&#34;hljs-comment&#34;&gt;               thread with the update, but in this case, a reload happens&lt;/span&gt;
&lt;span class=&#34;hljs-comment&#34;&gt;               on the next NSS call.  */&lt;/span&gt;
            local-&amp;gt;data = staging;
        *result = local-&amp;gt;data.services[database_index];
        __libc_lock_unlock(local-&amp;gt;lock);
    }
    &lt;span class=&#34;hljs-keyword&#34;&gt;return&lt;/span&gt; ok;
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;In the first if statement, we check whether to perform a reload via &lt;code&gt;reload_disabled&lt;/code&gt; and if that value is set, we store the current value in result without reloading.&lt;/p&gt;
&lt;p&gt;After that, we check to see if the file has changed or if another thread is updating it in the meantime, and then proceed with the reload by calling &lt;code&gt;nss_databse_reload()&lt;/code&gt;. We get a return value of ok and check by calling &lt;code&gt;atomic_load_acquire(&amp;amp;local-&amp;gt;data.reload_disabled)&lt;/code&gt; as in the first if statement.&lt;/p&gt;
&lt;p&gt;If so, we can expect that &lt;code&gt;local-&amp;gt;data.reload_disabled&lt;/code&gt; is set to 1, or that the if statement associated with the file check terminates, preventing it from reloading.&lt;/p&gt;
&lt;p&gt;Since nss_database was reloaded after &lt;code&gt;pivot_root&lt;/code&gt;, let&amp;#x2019;s look at it after &lt;code&gt;unpivot_root&lt;/code&gt; with gdb to determine the exact cause.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;hljs bash&#34;&gt;Breakpoint 1.1, pivot_root (new_root=0x562c1e75943c &lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;woot&amp;quot;&lt;/span&gt;, state=0x7fff9f7e6638) at ./pivot.c:39
39      {
(gdb) c
Continuing.
Download failed: Invalid argument.  Continuing without &lt;span class=&#34;hljs-built_in&#34;&gt;source&lt;/span&gt; file ./nss/./nss/nss_database.c.

Breakpoint 2, nss_database_check_reload_and_get (&lt;span class=&#34;hljs-built_in&#34;&gt;local&lt;/span&gt;=0x562c1e753990, result=0x7fff9f7e5f10, database_index=nss_database_initgroups) at ./nss/nss_database.c:396
warning: 396    ./nss/nss_database.c: No such file or directory
(gdb) c
Continuing.
...
Breakpoint 1, unpivot_root (state=state@entry=0x7fff7b4bbd38) at ./pivot.c:64
64      {
Breakpoint 2, nss_database_check_reload_and_get (&lt;span class=&#34;hljs-built_in&#34;&gt;local&lt;/span&gt;=0x5631f772d990, result=0x7fb3a825fb30 &amp;lt;__nss_passwd_database&amp;gt;, database_index=nss_database_passwd) at ./nss/nss_database.c:396
warning: 396    ./nss/nss_database.c: No such file or directory
(gdb) n
...
(gdb) info args
&lt;span class=&#34;hljs-built_in&#34;&gt;local&lt;/span&gt; = &amp;lt;optimized out&amp;gt;
result = 0x7fb3a825fb30 &amp;lt;__nss_passwd_database&amp;gt;
database_index = nss_database_passwd
(gdb) n
&lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; (&lt;span class=&#34;hljs-built_in&#34;&gt;local&lt;/span&gt;-&amp;gt;data.services[database_index] != NULL)
425     &lt;span class=&#34;hljs-keyword&#34;&gt;in&lt;/span&gt; ./nss/nss_database.c
(gdb) n
&lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; (stat_rv != 0 || (&lt;span class=&#34;hljs-built_in&#34;&gt;local&lt;/span&gt;-&amp;gt;root_ino != 0 &amp;amp;&amp;amp; (str.st_ino != &lt;span class=&#34;hljs-built_in&#34;&gt;local&lt;/span&gt;-&amp;gt;root_ino || str.st_dev != &lt;span class=&#34;hljs-built_in&#34;&gt;local&lt;/span&gt;-&amp;gt;root_dev)))
431     &lt;span class=&#34;hljs-keyword&#34;&gt;in&lt;/span&gt; ./nss/nss_database.c&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Immediately after &lt;code&gt;pivot_root&lt;/code&gt; it was database_index = nss_database_initgroup, but after &lt;code&gt;unpivot_root&lt;/code&gt; it is passed nss_database_passwd, so it enters the syntax where &lt;code&gt;local-&amp;gt;data.reload_disabled&lt;/code&gt; is set to 1, and it will not reload.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;hljs bash&#34;&gt;(gdb) p *&lt;span class=&#34;hljs-built_in&#34;&gt;local&lt;/span&gt;-&amp;gt;data.services[6]-&amp;gt;module  &lt;span class=&#34;hljs-comment&#34;&gt;#nss_databse_initgroups&lt;/span&gt;
Cannot access memory at address 0x0
(gdb) p *&lt;span class=&#34;hljs-built_in&#34;&gt;local&lt;/span&gt;-&amp;gt;data.services[9]   &lt;span class=&#34;hljs-comment&#34;&gt;#nss_databse_passwd&lt;/span&gt;
&lt;span class=&#34;hljs-variable&#34;&gt;$25&lt;/span&gt; = {module = 0x5590f5e38a70, action_bits = 320}
(gdb) &lt;span class=&#34;hljs-built_in&#34;&gt;set&lt;/span&gt; &lt;span class=&#34;hljs-variable&#34;&gt;$m&lt;/span&gt; = (struct nss_module *) &lt;span class=&#34;hljs-built_in&#34;&gt;local&lt;/span&gt;-&amp;gt;data.services[9]-&amp;gt;module
(gdb) x/s &lt;span class=&#34;hljs-variable&#34;&gt;$m&lt;/span&gt;-&amp;gt;name
0x558e8c22bfb8: &lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;/woot1337&amp;quot;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Checking via gdb, we see that in &lt;code&gt;pivot_root&lt;/code&gt;, database_initgroup enters the default value of 0 and the statement is not executed, allowing us to reload, and in &lt;code&gt;unpivot_root&lt;/code&gt;, database_passwd is used as an argument and the statement is executed, not reloading the nsswitch.conf on the original root.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/2025/07/21/poosic/[Research]_CVE-2025-32463/EN/3.png&#34; alt&gt;&lt;/p&gt;
&lt;p&gt;While analyzing, I now have one more question. &amp;#x2018;How does it load a malicious lib with /woot1337 (the path to the malicious lib) in passwd&amp;#x2019;.&lt;/p&gt;
&lt;h2 id=&#34;how-to-load-my-lib&#34;&gt;&lt;a href=&#34;#how-to-load-my-lib&#34; class=&#34;headerlink&#34; title=&#34;how to load my_lib?&#34;&gt;&lt;/a&gt;how to load my_lib?&lt;/h2&gt;&lt;p&gt;Let&amp;#x2019;s break point at the point where we load the malicious lib and look at the backtrace.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;hljs bash&#34;&gt;Catchpoint 1
  Inferior loaded libnss_/woot1337.so.2
dl_open_worker_begin (a=a@entry=0x7ffcfd5bc3b0) at ./elf/dl-open.c:775
warning: 775    ./elf/dl-open.c: No such file or directory
(gdb) bt
&lt;span class=&#34;hljs-comment&#34;&gt;#0  dl_open_worker_begin (a=a@entry=0x7ffcfd5bc3b0) at ./elf/dl-open.c:775&lt;/span&gt;
...
&lt;span class=&#34;hljs-comment&#34;&gt;#4  0x00007f6a81a5d164 in _dl_open (file=0x55d54daf0e00 &amp;quot;libnss_/woot1337.so.2&amp;quot;, mode=&amp;lt;optimized out&amp;gt;, caller_dlopen=0x7f6a81968a0f &amp;lt;module_load+175&amp;gt;, nsid=&amp;lt;optimized out&amp;gt;, argc=4, argv=0x7ffcfd5be468, env=0x7ffcfd5be490) at ./elf/dl-open.c:905&lt;/span&gt;
...
&lt;span class=&#34;hljs-comment&#34;&gt;#10 0x00007f6a81968a0f in module_load (module=0x55d54daebda0) at ./nss/nss_module.c:187&lt;/span&gt;
&lt;span class=&#34;hljs-comment&#34;&gt;#11 0x00007f6a81968ee5 in __nss_module_load (module=0x55d54daebda0) at ./nss/nss_module.c:302&lt;/span&gt;
&lt;span class=&#34;hljs-comment&#34;&gt;#12 __nss_module_get_function (module=0x55d54daebda0, name=name@entry=0x7f6a819e4128 &amp;quot;getpwnam_r&amp;quot;) at ./nss/nss_module.c:328&lt;/span&gt;
&lt;span class=&#34;hljs-comment&#34;&gt;#13 0x00007f6a8196960b in __GI___nss_lookup_function (fct_name=0x7f6a819e4128 &amp;quot;getpwnam_r&amp;quot;, ni=&amp;lt;optimized out&amp;gt;) at ./nss/nsswitch.c:137&lt;/span&gt;
&lt;span class=&#34;hljs-comment&#34;&gt;#14 __GI___nss_lookup (ni=ni@entry=0x7ffcfd5bc9a8, fct_name=fct_name@entry=0x7f6a819e4128 &amp;quot;getpwnam_r&amp;quot;, fct2_name=fct2_name@entry=0x0, fctp=fctp@entry=0x7ffcfd5bc9b0) at ./nss/nsswitch.c:67&lt;/span&gt;
&lt;span class=&#34;hljs-comment&#34;&gt;#15 0x00007f6a81965928 in __GI___nss_passwd_lookup2 (ni=ni@entry=0x7ffcfd5bc9a8, fct_name=fct_name@entry=0x7f6a819e4128 &amp;quot;getpwnam_r&amp;quot;, fct2_name=fct2_name@entry=0x0, fctp=fctp@entry=0x7ffcfd5bc9b0) at ./nss/XXX-lookup.c:62&lt;/span&gt;
&lt;span class=&#34;hljs-comment&#34;&gt;#16 0x00007f6a81977628 in __getpwnam_r (name=0x55d54daec830 &amp;quot;root&amp;quot;, resbuf=0x55d54daf0e20,&lt;/span&gt;
    buffer=0x55d54daf0e50 &lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;r is\n#used.  If you really want nothing to happen then use pam_permit.so or\n#pam_deny.so as appropriate.\n\n# We fall back to the system default in /etc/pam.d/common-*\n# \n\n@include common-auth\n@include &amp;quot;&lt;/span&gt;..., buflen=1024, result=0x7ffcfd5bca28)
    at ../nss/getXXbyYY_r.c:264
...
&lt;span class=&#34;hljs-comment&#34;&gt;#27 0x00007f6a812229d3 in sudoers_policy_check (argc=1, argv=0x7ffcfd5be480, env_add=0x0, command_infop=0x7ffcfd5bd050, argv_out=0x7ffcfd5bd058, user_env_out=0x7ffcfd5bd060, errstr=0x7ffcfd5bd078) at ./policy.c:1244&lt;/span&gt;
&lt;span class=&#34;hljs-comment&#34;&gt;#28 0x000055d54cf16fb3 in policy_check (run_envp=0x7ffcfd5bd060, run_argv=0x7ffcfd5bd058, command_info=0x7ffcfd5bd050, env_add=0x0, argv=0x7ffcfd5be480, argc=1) at ./sudo.c:1266&lt;/span&gt;
&lt;span class=&#34;hljs-comment&#34;&gt;#29 main (argc=&amp;lt;optimized out&amp;gt;, argv=&amp;lt;optimized out&amp;gt;, envp=&amp;lt;optimized out&amp;gt;) at ./sudo.c:261&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;After the &lt;code&gt;nss_passwd_lookup&lt;/code&gt;, we run the functions for the module load. Let&amp;#x2019;s take a look at &lt;code&gt;module_load()&lt;/code&gt;.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;hljs bash&#34;&gt;module_load (struct nss_module *module)
{
  &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; (strcmp (module-&amp;gt;name, &lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;files&amp;quot;&lt;/span&gt;) == 0)
    &lt;span class=&#34;hljs-built_in&#34;&gt;return&lt;/span&gt; module_load_nss_files (module);
  &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; (strcmp (module-&amp;gt;name, &lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;dns&amp;quot;&lt;/span&gt;) == 0)
    &lt;span class=&#34;hljs-built_in&#34;&gt;return&lt;/span&gt; module_load_nss_dns (module);
  void *handle;
  {
    char *shlib_name;
    &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; (__asprintf (&amp;amp;shlib_name, &lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;libnss_%s.so%s&amp;quot;&lt;/span&gt;,
                    module-&amp;gt;name, __nss_shlib_revision) &amp;lt; 0)
      /* This is definitely a temporary failure.  Do not update
         module-&amp;gt;state.  This will trigger another attempt at the next
         call.  */
      &lt;span class=&#34;hljs-built_in&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;hljs-literal&#34;&gt;false&lt;/span&gt;;
    handle = __libc_dlopen (shlib_name);
    free (shlib_name);
  }
  ...&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;In nsswitch.conf, we basically define something like &lt;code&gt;passwd: files systemd&lt;/code&gt;, which means that if we&amp;#x2019;re not looking for passwd information in the /etc/passwd file, we&amp;#x2019;ll load &lt;code&gt;libnss_systemd.so.2&lt;/code&gt; and look it up in the db. If we come back to module_load again, because we simply gave a path value for passwd, after &lt;code&gt;asprintf&lt;/code&gt;, the shlib_name will have &lt;code&gt;libnss_woot1337.so.2&lt;/code&gt; in it and the malware will execute.&lt;/p&gt;
&lt;h2 id=&#34;Outro&#34;&gt;&lt;a href=&#34;#Outro&#34; class=&#34;headerlink&#34; title=&#34;Outro&#34;&gt;&lt;/a&gt;Outro&lt;/h2&gt;&lt;p&gt;&lt;img src=&#34;/2025/07/21/poosic/[Research]_CVE-2025-32463/EN/4.png&#34; alt&gt;&lt;/p&gt;
&lt;p&gt;I know that&amp;#x2019;s three questions instead of two, but let&amp;#x2019;s wrap things up with a final roundup of questions and the answers I found to them!&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;p&gt;where is nsswitch.conf loaded in that code?&lt;/p&gt;
&lt;p&gt; A. nss_database_check_reload_and_get to check and update the nss_database.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;why does nsswitch.conf recognize files in the root directory that have been replaced with chroot?&lt;/p&gt;
&lt;p&gt; A. Because &lt;code&gt;local-&amp;gt;data.reload_disabled&lt;/code&gt; is set to 1 and is not reloaded while checking nss_database after &lt;code&gt;unpivot_root&lt;/code&gt;.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;passwd contains /woot1337 (malicious lib path), does LPE load possible libs?&lt;/p&gt;
&lt;p&gt; A. During the &lt;code&gt;module_load&lt;/code&gt; process, path is neither files nor dns, so it is recognized as a lib and tries to load the module.&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;I didn&amp;#x2019;t expect to dig this deep after a day of writing lines, I&amp;#x2019;m very familiar with sudo but never had a chance to look at it like this, so I feel like I&amp;#x2019;ve gotten a little bit more familiar with sudo!&lt;/p&gt;
&lt;p&gt;Thanks for reading this long post and I&amp;#x2019;ll see you next time with something better!&lt;/p&gt;
&lt;h2 id=&#34;Reference&#34;&gt;&lt;a href=&#34;#Reference&#34; class=&#34;headerlink&#34; title=&#34;Reference&#34;&gt;&lt;/a&gt;Reference&lt;/h2&gt;&lt;p&gt;[1] &lt;a href=&#34;https://github.com/pr0v3rbs/CVE-2025-32463_chwoot/tree/main&#34;&gt;https://github.com/pr0v3rbs/CVE-2025-32463_chwoot/tree/main&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;[2] &lt;a href=&#34;https://codebrowser.dev/glibc/glibc/nss/nsswitch.c.html#132&#34;&gt;https://codebrowser.dev/glibc/glibc/nss/nsswitch.c.html#132&lt;/a&gt;&lt;/p&gt;
 - hack &amp; life">
  <meta property="og:image" content="https://hackyboiz.github.io/2025/07/21/poosic/[Research]_CVE-2025-32463/EN/1.png">
  <meta property="og:url" content="https://hackyboiz.github.io/">

  <link rel="canonical" href="https://hackyboiz.github.io/2025/07/21/poosic/[research]_cve-2025-32463/en/">

  <title>[Research] CVE-2025-32463 Into the &#39;sudo -R&#39;(EN) - hackyboiz</title>

  <link rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/4.4.1/css/bootstrap.min.css">


  <link rel="stylesheet" href="https://cdn.staticfile.org/github-markdown-css/4.0.0/github-markdown.min.css">
  <link rel="stylesheet" href="/lib/hint/hint.min.css">

  
    
    <link rel="stylesheet" href="https://cdn.staticfile.org/highlight.js/10.0.0/styles/github-gist.min.css">
  

  


<!--  -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_6peoq002giu.css">
<link rel="stylesheet" href="/.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_pjno9b9zyxs.css">
<link rel="stylesheet" href="/.css">


<link rel="stylesheet" href="/css/main.css">

<!--  -->


  <script src="/js/utils.js"></script>
  <script src="/js/color-schema.js"></script>

<meta name="generator" content="Hexo 5.1.1"><link rel="alternate" href="/rss2.xml" title="hackyboiz" type="application/rss+xml">
</head>


<body>
  <header style="height: 40vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">&nbsp;<strong>Hackyboiz</strong>&nbsp;</a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                Home
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                Archives
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                Categories
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                Tags
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-addrcard"></i>
                About
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/author/">
                <i class="iconfont icon-user-fill"></i>
                Author
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" data-toggle="modal" data-target="#modalSearch">&nbsp;<i class="iconfont icon-search"></i>&nbsp;</a>
          </li>
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" href="javascript:">&nbsp;<i class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="banner intro-2" id="background" parallax="true" style="background: url('/img/default.png') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="container page-header text-center fade-in-up">
            <span class="h2" id="subtitle">
              
            </span>

            
              
  <div class="mt-3 post-meta">
    <i class="iconfont icon-date-fill" aria-hidden="true"></i>
    <time datetime="2025-07-21 17:00" pubdate>
      2025 7 21 
    </time>
  </div>


<div class="mt-1">
  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      2.7k 
    </span>
  

  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      54
       
    </span>
  

  
  
</div>

            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid">
  <div class="row">
    <div class="d-none d-lg-block col-lg-2">
      <!--<script data-ad-client="ca-pub-3672652207808168" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>-->
    </div>
    <div class="col-lg-8 nopadding-md">
      <div class="container nopadding-md" id="board-ctn">
        <div class="py-5" id="board">
          <article class="post-content mx-auto" id="post">
            <!-- SEO header -->
            <h1 style="display: none">[Research] CVE-2025-32463 Into the &#39;sudo -R&#39;(EN)</h1>
                       
            <div class="markdown-body" id="post-body">
              <!-- <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>-->
              <!-- hackyboiz_horizen_index -->
              <!--
              <ins class="adsbygoogle"
                   style="display:block"
                   data-ad-client="ca-pub-3672652207808168"
                   data-ad-slot="8887862313"
                   data-ad-format="auto"
                   data-full-width-responsive="true"></ins>
              <script>
                   (adsbygoogle = window.adsbygoogle || []).push({});
              </script>
              -->
              <h2 id="Intro"><a href="#Intro" class="headerlink" title="Intro"></a>Intro</h2><p>Hi, I&#x2019;m poosic. I&#x2019;m back on Hackyboiz with my first research article! &gt;_-</p>
<p><img src="/2025/07/21/poosic/[Research]_CVE-2025-32463/EN/1.png" srcset="/img/loading.gif" alt></p>
<p>In this post, I&#x2019;ll try to answer some of the questions I had while researching CVE-2025-32463: LPE with chroot in sudo. For a high-level overview of the vulnerability, see <a href="https://hackyboiz.github.io/2025/07/12/poosic/cve-2025-32463/">1Day1Line</a>!</p>
<pre><code class="hljs bash"><span class="hljs-comment"># sudoers.c</span>
pivot_root()
-&gt; resolve_cmnd() <span class="hljs-comment"># load changed root&apos;s nsswitch.conf</span>
-&gt; unpivot_root() <span class="hljs-comment"># not load original root&apos;s nsswitch.conf</span></code></pre>
<p>However, if we briefly look at the flow of <code>sudoers.c</code>, the vulnerability occurred because the NSS API is called in the <code>resolve_cmnd</code> function after <code>pivot_root</code> is executed, and the attacker&#x2019;s arbitrary file (<code>/etc/nsswitch.conf</code>) loaded with root privileges through <code>pivot_root</code> is read and the nss_database related information is updated, but it is not updated to the original root&#x2019;s nss_database after <code>unpivot_root</code>.</p>
<p>When I looked at <code>pivot.c</code> and <code>sudoers.c</code> where the vulnerability occurred, I had questions. The questions were as follows.</p>
<ol>
<li>where is nsswitch.conf loaded in that code?</li>
<li>why is nsswitch.conf recognizing files in the root directory that have been replaced with chroot?</li>
</ol>
<p>When I checked the sudo v1.9.17 pivot.c code where the vulnerability actually occurred, I found that <code>unpivot_chroot()</code> dutifully reads nsswitch.conf back in, so the problem got even more muddled.</p>
<p>The obvious way to find out would be to see the sudo repo in git or analyze it with gdb.</p>
<h2 id="Environment-setting"><a href="#Environment-setting" class="headerlink" title="Environment setting"></a>Environment setting</h2><p>When I first set up the environment, I was going to compile sudo and glibc for debugging on my existing Ubuntu, but since the Ubuntu I installed on WSL didn&#x2019;t use the -R option, there were a lot of things to set up in sudo.conf and other files, so I found a slightly(?) easier way.</p>
<p>If you want to follow along with this article and analyze it, you can refer to [1] in the reference below to proceed with the installation. The installation process is simple, so let&#x2019;s skip it and start setting up the environment.</p>
<p>The environment doesn&#x2019;t have gdb installed, obviously you need to have sudo privileges to install gdb, but when I run run.sh, I can&#x2019;t install gdb because it puts me as a regular user named pwn.</p>
<p>I stupidly went back to doing my own configuration here and thought, &#x201C;Hahaha I can have sudo privileges!&#x201D; and used the POC script that docker set up for me to get root privileges and install gdb.</p>
<p><img src="/2025/07/21/poosic/[Research]_CVE-2025-32463/EN/2.jpg" srcset="/img/loading.gif" alt></p>
<blockquote>
<p>L0ch finds out, and I remind him of the emotion of shock.</p>
</blockquote>
<p>In my delirium, I forgot that this is a docker container that I put up locally&#x2026; You can easily set it up as root with <code>docker exec -it --user root &lt;container-id&gt; bash</code>.</p>
<pre><code class="hljs bash">root@a593a22215ca:/<span class="hljs-comment"># echo &apos;pwn ALL=(ALL) NOPASSWD:ALL&apos; &gt;&gt; /etc/sudoers</span>
root@a593a22215ca:/<span class="hljs-comment"># su - pwn</span>
pwn@a593a22215ca:/tmp/sudowoot.stage.Ex5pZ2$ sudo gdb --args sudo -R woot woot</code></pre>
<p>In order to debug sudo, you need sudo privileges. You can do it as root, but I gave sudo privileges to a pwn with normal privileges just in case it makes a difference in the flow. Afterwards, run gdb with sudo privileges and you&#x2019;re ready to debug. Now let&#x2019;s get started!</p>
<h2 id="After-pivot-root"><a href="#After-pivot-root" class="headerlink" title="After pivot_root"></a>After pivot_root</h2><pre><code class="hljs bash">(gdb) b pivot_root
(gdb) r
Breakpoint 1.1, pivot_root (new_root=0x55aae9e866dc <span class="hljs-string">&quot;woot&quot;</span>, state=0x7ffd8c3bb4a8) at ./pivot.c:39
39      {
(gdb) b fopen
Breakpoint 2 at 0x7ff5aaf55e60: file ./libio/iofopen.c, line 85.</code></pre>
<p>To find where nsswitch.conf is loaded, we first breakpointed the point where it opens after <code>pivot_root</code>.</p>
<pre><code class="hljs bash">Breakpoint 2, _IO_new_fopen (filename=filename@entry=0x7ff5ab09ed92 <span class="hljs-string">&quot;/etc/nsswitch.conf&quot;</span>, mode=mode@entry=0x7ff5ab09adb4 <span class="hljs-string">&quot;rce&quot;</span>)
    at ./libio/iofopen.c:85
(gdb) bt
<span class="hljs-comment">#0  _IO_new_fopen (filename=filename@entry=0x7ff5ab09ed92 &quot;/etc/nsswitch.conf&quot;, mode=mode@entry=0x7ff5ab09adb4 &quot;rce&quot;)</span>
    at ./libio/iofopen.c:85
<span class="hljs-comment">#1  0x00007ff5ab02247d in nss_database_reload (initial=0x7ffd8c3bab90, staging=0x7ffd8c3bac50) at ./nss/nss_database.c:306</span>
<span class="hljs-comment">#2  nss_database_check_reload_and_get (local=&lt;optimized out&gt;, result=0x7ffd8c3bad80, database_index=nss_database_initgroups)</span>
    at ./nss/nss_database.c:457
<span class="hljs-comment">#3  0x00007ff5ab026ddc in internal_getgrouplist (user=user@entry=0x55aae9e87d98 &quot;root&quot;, group=group@entry=0,</span>
    size=size@entry=0x7ffd8c3badd8, groupsp=groupsp@entry=0x7ffd8c3bade0, <span class="hljs-built_in">limit</span>=<span class="hljs-built_in">limit</span>@entry=-1) at ./nss/initgroups.c:75
<span class="hljs-comment">#4  0x00007ff5ab0270dc in getgrouplist (user=user@entry=0x55aae9e87d98 &quot;root&quot;, group=group@entry=0,</span>
    groups=groups@entry=0x7ff5aa7c9010, ngroups=ngroups@entry=0x7ffd8c3bae44) at ./nss/initgroups.c:156
<span class="hljs-comment">#5  0x00007ff5ab0f1149 in sudo_getgrouplist2_v1 (name=0x55aae9e87d98 &quot;root&quot;, basegid=0, groupsp=groupsp@entry=0x7ffd8c3baea0,</span>
    ngroupsp=ngroupsp@entry=0x7ffd8c3baeac) at ./getgrouplist.c:105
<span class="hljs-comment">#6  0x00007ff5aa967b5e in sudo_make_gidlist_item (pw=0x55aae9e87d68, ngids=&lt;optimized out&gt;, gids=&lt;optimized out&gt;, gidstrs=0x0,</span>
    <span class="hljs-built_in">type</span>=1) at ./pwutil_impl.c:306
<span class="hljs-comment">#7  0x00007ff5aa9666b5 in sudo_get_gidlist (pw=0x55aae9e87d68, type=type@entry=1) at ./pwutil.c:1033</span>
<span class="hljs-comment">#8  0x00007ff5aa95de8b in runas_getgroups (ctx=ctx@entry=0x7ff5aa9b76c0 &lt;sudoers_ctx&gt;) at ./match.c:146</span>
<span class="hljs-comment">#9  0x00007ff5aa949f9c in runas_setgroups (ctx=0x7ff5aa9b76c0 &lt;sudoers_ctx&gt;) at ./set_perms.c:1634</span>
<span class="hljs-comment">#10 set_perms (ctx=ctx@entry=0x7ff5aa9b76c0 &lt;sudoers_ctx&gt;, perm=perm@entry=5) at ./set_perms.c:285</span>
<span class="hljs-comment">#11 0x00007ff5aa9690a8 in resolve_cmnd (ctx=ctx@entry=0x7ff5aa9b76c0 &lt;sudoers_ctx&gt;, infile=infile@entry=0x7ffd8c3bd7a2 &quot;woot&quot;,</span>
    outfile=outfile@entry=0x7ffd8c3bb4b0,
    path=path@entry=0x55aae9e8dbc0 <span class="hljs-string">&quot;/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin&quot;</span>) at ./resolve_cmnd.c:42
<span class="hljs-comment">#12 0x00007ff5aa94cf1c in set_cmnd_path (ctx=ctx@entry=0x7ff5aa9b76c0 &lt;sudoers_ctx&gt;, runchroot=0x55aae9e866dc &quot;woot&quot;)</span>
    at ./sudoers.c:1108
<span class="hljs-comment">#13 0x00007ff5aa94d3a7 in set_cmnd (ctx=0x7ff5aa9b76c0 &lt;sudoers_ctx&gt;) at ./sudoers.c:1177</span>
<span class="hljs-comment">#14 sudoers_check_common (pwflag=pwflag@entry=0, ctx=0x7ff5aa9b76c0 &lt;sudoers_ctx&gt;) at ./sudoers.c:358</span>
<span class="hljs-comment">#15 0x00007ff5aa94ea28 in sudoers_check_cmnd (argc=argc@entry=1, argv=argv@entry=0x7ffd8c3bcb30, env_add=env_add@entry=0x0,</span>
    closure=closure@entry=0x7ffd8c3bb640) at ./sudoers.c:689
<span class="hljs-comment">#16 0x00007ff5aa9449d3 in sudoers_policy_check (argc=1, argv=0x7ffd8c3bcb30, env_add=0x0, command_infop=0x7ffd8c3bb700,</span>
    argv_out=0x7ffd8c3bb708, user_env_out=0x7ffd8c3bb710, errstr=0x7ffd8c3bb728) at ./policy.c:1244
<span class="hljs-comment">#17 0x000055aae921efb3 in policy_check (run_envp=0x7ffd8c3bb710, run_argv=0x7ffd8c3bb708, command_info=0x7ffd8c3bb700, env_add=0x0,</span>
    argv=0x7ffd8c3bcb30, argc=1) at ./sudo.c:1266
<span class="hljs-comment">#18 main (argc=&lt;optimized out&gt;, argv=&lt;optimized out&gt;, envp=&lt;optimized out&gt;) at ./sudo.c:261</span></code></pre>
<p>Now that we&#x2019;ve verified that <code>fopen</code> loads <code>/etc/nsswitch.conf</code> as an argument, let&#x2019;s check the callstack with the backtrace command. The first thing we see is <code>nss_databse_reload</code> and <code>nss_database_check_reload_and_get</code>, which are related to nss. In our current flow, these functions do the following</p>
<ul>
<li>nss_database_check_reload_and_get: reload if nsswitch.conf has been changed.</li>
<li>nss_database_reload: Open and parse the <code>/etc/nsswitch.conf</code> file, populate <code>staging</code> with NSS service information, and fill in default values if necessary.</li>
</ul>
<pre><code class="hljs c">(gdb) c
Breakpoint <span class="hljs-number">3</span>, unpivot_root()
(gdb) c
Breakpoint <span class="hljs-number">4</span>, nss_database_check_reload_and_get()
(gdb) c
Continuing.
Downloading separate debug info <span class="hljs-keyword">for</span> libnss_/woot1337.so<span class="hljs-number">.2</span></code></pre>
<p>I thought it would just skip <code>unpivot_root()</code> afterward, but it&#x2019;s caught at the break point. It loads <code>nss_database_check_reload_and_get()</code> but doesn&#x2019;t call <code>nss_database_reload()</code>, unlike after pivot. So the problem is that <code>nss_database_reload</code> doesn&#x2019;t happen at <code>unpivot_root</code>, so we still have the nsswitch.conf recognized by chroot.</p>
<p>Now let&#x2019;s take a hard look at the code!</p>
<h2 id="After-unpivot-root"><a href="#After-unpivot-root" class="headerlink" title="After unpivot_root"></a>After unpivot_root</h2><pre><code class="hljs c"><span class="hljs-keyword">static</span> <span class="hljs-keyword">bool</span>
nss_database_check_reload_and_get(struct nss_database_state *local,
                                  nss_action_list *result,
                                  <span class="hljs-keyword">enum</span> nss_database database_index)
{
    <span class="hljs-class"><span class="hljs-keyword">struct</span> __<span class="hljs-title">stat64_t64</span> <span class="hljs-title">str</span>;</span>
    <span class="hljs-comment">/* Acquire MO is needed because the thread that sets reload_disabled</span>
<span class="hljs-comment">       may have loaded the configuration first, so synchronize with the</span>
<span class="hljs-comment">       Release MO store there.  */</span>
    <span class="hljs-keyword">if</span> (atomic_load_acquire(&amp;local-&gt;data.reload_disabled))
    {
        *result = local-&gt;data.services[database_index];
        <span class="hljs-comment">/* No reload, so there is no error.  */</span>
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    }
    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">file_change_detection</span> <span class="hljs-title">initial</span>;</span>
    <span class="hljs-keyword">if</span> (!__file_change_detection_for_path(&amp;initial, _PATH_NSSWITCH_CONF))
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    __libc_lock_lock(local-&gt;lock);
    <span class="hljs-keyword">if</span> (__file_is_unchanged(&amp;initial, &amp;local-&gt;data.nsswitch_conf))
    {
        <span class="hljs-comment">/* Configuration is up-to-date.  Read it and return it to the</span>
<span class="hljs-comment">           caller.  */</span>
        *result = local-&gt;data.services[database_index];
        __libc_lock_unlock(local-&gt;lock);
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    }
    <span class="hljs-keyword">int</span> stat_rv = __stat64_time64(<span class="hljs-string">&quot;/&quot;</span>, &amp;str);
    <span class="hljs-keyword">if</span> (local-&gt;data.services[database_index] != <span class="hljs-literal">NULL</span>)
    {
        <span class="hljs-comment">/* Before we reload, verify that &quot;/&quot; hasn&apos;t changed.  We assume that</span>
<span class="hljs-comment">          errors here are very unlikely, but the chance that we&apos;re entering</span>
<span class="hljs-comment">          a container is also very unlikely, so we err on the side of both</span>
<span class="hljs-comment">          very unlikely things not happening at the same time.  */</span>
        <span class="hljs-keyword">if</span> (stat_rv != <span class="hljs-number">0</span> || (local-&gt;root_ino != <span class="hljs-number">0</span> &amp;&amp; (str.st_ino != local-&gt;root_ino || str.st_dev != local-&gt;root_dev)))
        {
            <span class="hljs-comment">/* Change detected; disable reloading and return current state.  */</span>
            atomic_store_release(&amp;local-&gt;data.reload_disabled, <span class="hljs-number">1</span>);
            *result = local-&gt;data.services[database_index];
            __libc_lock_unlock(local-&gt;lock);
            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
        }
    }
    <span class="hljs-keyword">if</span> (stat_rv == <span class="hljs-number">0</span>)
    {
        local-&gt;root_ino = str.st_ino;
        local-&gt;root_dev = str.st_dev;
    }
    __libc_lock_unlock(local-&gt;lock);
    <span class="hljs-comment">/* Avoid overwriting the global configuration until we have loaded</span>
<span class="hljs-comment">       everything successfully.  Otherwise, if the file change</span>
<span class="hljs-comment">       information changes back to what is in the global configuration,</span>
<span class="hljs-comment">       the lookups would use the partially-written  configuration.  */</span>
    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">nss_database_data</span> <span class="hljs-title">staging</span> = {</span>
        .initialized = <span class="hljs-literal">true</span>,
    };
    <span class="hljs-keyword">bool</span> ok = nss_database_reload(&amp;staging, &amp;initial);
    <span class="hljs-keyword">if</span> (ok)
    {
        __libc_lock_lock(local-&gt;lock);
        <span class="hljs-comment">/* See above for memory order.  */</span>
        <span class="hljs-keyword">if</span> (!atomic_load_acquire(&amp;local-&gt;data.reload_disabled))
            <span class="hljs-comment">/* This may go back in time if another thread beats this</span>
<span class="hljs-comment">               thread with the update, but in this case, a reload happens</span>
<span class="hljs-comment">               on the next NSS call.  */</span>
            local-&gt;data = staging;
        *result = local-&gt;data.services[database_index];
        __libc_lock_unlock(local-&gt;lock);
    }
    <span class="hljs-keyword">return</span> ok;
}
</code></pre>
<p>In the first if statement, we check whether to perform a reload via <code>reload_disabled</code> and if that value is set, we store the current value in result without reloading.</p>
<p>After that, we check to see if the file has changed or if another thread is updating it in the meantime, and then proceed with the reload by calling <code>nss_databse_reload()</code>. We get a return value of ok and check by calling <code>atomic_load_acquire(&amp;local-&gt;data.reload_disabled)</code> as in the first if statement.</p>
<p>If so, we can expect that <code>local-&gt;data.reload_disabled</code> is set to 1, or that the if statement associated with the file check terminates, preventing it from reloading.</p>
<p>Since nss_database was reloaded after <code>pivot_root</code>, let&#x2019;s look at it after <code>unpivot_root</code> with gdb to determine the exact cause.</p>
<pre><code class="hljs bash">Breakpoint 1.1, pivot_root (new_root=0x562c1e75943c <span class="hljs-string">&quot;woot&quot;</span>, state=0x7fff9f7e6638) at ./pivot.c:39
39      {
(gdb) c
Continuing.
Download failed: Invalid argument.  Continuing without <span class="hljs-built_in">source</span> file ./nss/./nss/nss_database.c.

Breakpoint 2, nss_database_check_reload_and_get (<span class="hljs-built_in">local</span>=0x562c1e753990, result=0x7fff9f7e5f10, database_index=nss_database_initgroups) at ./nss/nss_database.c:396
warning: 396    ./nss/nss_database.c: No such file or directory
(gdb) c
Continuing.
...
Breakpoint 1, unpivot_root (state=state@entry=0x7fff7b4bbd38) at ./pivot.c:64
64      {
Breakpoint 2, nss_database_check_reload_and_get (<span class="hljs-built_in">local</span>=0x5631f772d990, result=0x7fb3a825fb30 &lt;__nss_passwd_database&gt;, database_index=nss_database_passwd) at ./nss/nss_database.c:396
warning: 396    ./nss/nss_database.c: No such file or directory
(gdb) n
...
(gdb) info args
<span class="hljs-built_in">local</span> = &lt;optimized out&gt;
result = 0x7fb3a825fb30 &lt;__nss_passwd_database&gt;
database_index = nss_database_passwd
(gdb) n
<span class="hljs-keyword">if</span> (<span class="hljs-built_in">local</span>-&gt;data.services[database_index] != NULL)
425     <span class="hljs-keyword">in</span> ./nss/nss_database.c
(gdb) n
<span class="hljs-keyword">if</span> (stat_rv != 0 || (<span class="hljs-built_in">local</span>-&gt;root_ino != 0 &amp;&amp; (str.st_ino != <span class="hljs-built_in">local</span>-&gt;root_ino || str.st_dev != <span class="hljs-built_in">local</span>-&gt;root_dev)))
431     <span class="hljs-keyword">in</span> ./nss/nss_database.c</code></pre>
<p>Immediately after <code>pivot_root</code> it was database_index = nss_database_initgroup, but after <code>unpivot_root</code> it is passed nss_database_passwd, so it enters the syntax where <code>local-&gt;data.reload_disabled</code> is set to 1, and it will not reload.</p>
<pre><code class="hljs bash">(gdb) p *<span class="hljs-built_in">local</span>-&gt;data.services[6]-&gt;module  <span class="hljs-comment">#nss_databse_initgroups</span>
Cannot access memory at address 0x0
(gdb) p *<span class="hljs-built_in">local</span>-&gt;data.services[9]   <span class="hljs-comment">#nss_databse_passwd</span>
<span class="hljs-variable">$25</span> = {module = 0x5590f5e38a70, action_bits = 320}
(gdb) <span class="hljs-built_in">set</span> <span class="hljs-variable">$m</span> = (struct nss_module *) <span class="hljs-built_in">local</span>-&gt;data.services[9]-&gt;module
(gdb) x/s <span class="hljs-variable">$m</span>-&gt;name
0x558e8c22bfb8: <span class="hljs-string">&quot;/woot1337&quot;</span></code></pre>
<p>Checking via gdb, we see that in <code>pivot_root</code>, database_initgroup enters the default value of 0 and the statement is not executed, allowing us to reload, and in <code>unpivot_root</code>, database_passwd is used as an argument and the statement is executed, not reloading the nsswitch.conf on the original root.</p>
<p><img src="/2025/07/21/poosic/[Research]_CVE-2025-32463/EN/3.png" srcset="/img/loading.gif" alt></p>
<p>While analyzing, I now have one more question. &#x2018;How does it load a malicious lib with /woot1337 (the path to the malicious lib) in passwd&#x2019;.</p>
<h2 id="how-to-load-my-lib"><a href="#how-to-load-my-lib" class="headerlink" title="how to load my_lib?"></a>how to load my_lib?</h2><p>Let&#x2019;s break point at the point where we load the malicious lib and look at the backtrace.</p>
<pre><code class="hljs bash">Catchpoint 1
  Inferior loaded libnss_/woot1337.so.2
dl_open_worker_begin (a=a@entry=0x7ffcfd5bc3b0) at ./elf/dl-open.c:775
warning: 775    ./elf/dl-open.c: No such file or directory
(gdb) bt
<span class="hljs-comment">#0  dl_open_worker_begin (a=a@entry=0x7ffcfd5bc3b0) at ./elf/dl-open.c:775</span>
...
<span class="hljs-comment">#4  0x00007f6a81a5d164 in _dl_open (file=0x55d54daf0e00 &quot;libnss_/woot1337.so.2&quot;, mode=&lt;optimized out&gt;, caller_dlopen=0x7f6a81968a0f &lt;module_load+175&gt;, nsid=&lt;optimized out&gt;, argc=4, argv=0x7ffcfd5be468, env=0x7ffcfd5be490) at ./elf/dl-open.c:905</span>
...
<span class="hljs-comment">#10 0x00007f6a81968a0f in module_load (module=0x55d54daebda0) at ./nss/nss_module.c:187</span>
<span class="hljs-comment">#11 0x00007f6a81968ee5 in __nss_module_load (module=0x55d54daebda0) at ./nss/nss_module.c:302</span>
<span class="hljs-comment">#12 __nss_module_get_function (module=0x55d54daebda0, name=name@entry=0x7f6a819e4128 &quot;getpwnam_r&quot;) at ./nss/nss_module.c:328</span>
<span class="hljs-comment">#13 0x00007f6a8196960b in __GI___nss_lookup_function (fct_name=0x7f6a819e4128 &quot;getpwnam_r&quot;, ni=&lt;optimized out&gt;) at ./nss/nsswitch.c:137</span>
<span class="hljs-comment">#14 __GI___nss_lookup (ni=ni@entry=0x7ffcfd5bc9a8, fct_name=fct_name@entry=0x7f6a819e4128 &quot;getpwnam_r&quot;, fct2_name=fct2_name@entry=0x0, fctp=fctp@entry=0x7ffcfd5bc9b0) at ./nss/nsswitch.c:67</span>
<span class="hljs-comment">#15 0x00007f6a81965928 in __GI___nss_passwd_lookup2 (ni=ni@entry=0x7ffcfd5bc9a8, fct_name=fct_name@entry=0x7f6a819e4128 &quot;getpwnam_r&quot;, fct2_name=fct2_name@entry=0x0, fctp=fctp@entry=0x7ffcfd5bc9b0) at ./nss/XXX-lookup.c:62</span>
<span class="hljs-comment">#16 0x00007f6a81977628 in __getpwnam_r (name=0x55d54daec830 &quot;root&quot;, resbuf=0x55d54daf0e20,</span>
    buffer=0x55d54daf0e50 <span class="hljs-string">&quot;r is\n#used.  If you really want nothing to happen then use pam_permit.so or\n#pam_deny.so as appropriate.\n\n# We fall back to the system default in /etc/pam.d/common-*\n# \n\n@include common-auth\n@include &quot;</span>..., buflen=1024, result=0x7ffcfd5bca28)
    at ../nss/getXXbyYY_r.c:264
...
<span class="hljs-comment">#27 0x00007f6a812229d3 in sudoers_policy_check (argc=1, argv=0x7ffcfd5be480, env_add=0x0, command_infop=0x7ffcfd5bd050, argv_out=0x7ffcfd5bd058, user_env_out=0x7ffcfd5bd060, errstr=0x7ffcfd5bd078) at ./policy.c:1244</span>
<span class="hljs-comment">#28 0x000055d54cf16fb3 in policy_check (run_envp=0x7ffcfd5bd060, run_argv=0x7ffcfd5bd058, command_info=0x7ffcfd5bd050, env_add=0x0, argv=0x7ffcfd5be480, argc=1) at ./sudo.c:1266</span>
<span class="hljs-comment">#29 main (argc=&lt;optimized out&gt;, argv=&lt;optimized out&gt;, envp=&lt;optimized out&gt;) at ./sudo.c:261</span></code></pre>
<p>After the <code>nss_passwd_lookup</code>, we run the functions for the module load. Let&#x2019;s take a look at <code>module_load()</code>.</p>
<pre><code class="hljs bash">module_load (struct nss_module *module)
{
  <span class="hljs-keyword">if</span> (strcmp (module-&gt;name, <span class="hljs-string">&quot;files&quot;</span>) == 0)
    <span class="hljs-built_in">return</span> module_load_nss_files (module);
  <span class="hljs-keyword">if</span> (strcmp (module-&gt;name, <span class="hljs-string">&quot;dns&quot;</span>) == 0)
    <span class="hljs-built_in">return</span> module_load_nss_dns (module);
  void *handle;
  {
    char *shlib_name;
    <span class="hljs-keyword">if</span> (__asprintf (&amp;shlib_name, <span class="hljs-string">&quot;libnss_%s.so%s&quot;</span>,
                    module-&gt;name, __nss_shlib_revision) &lt; 0)
      /* This is definitely a temporary failure.  Do not update
         module-&gt;state.  This will trigger another attempt at the next
         call.  */
      <span class="hljs-built_in">return</span> <span class="hljs-literal">false</span>;
    handle = __libc_dlopen (shlib_name);
    free (shlib_name);
  }
  ...</code></pre>
<p>In nsswitch.conf, we basically define something like <code>passwd: files systemd</code>, which means that if we&#x2019;re not looking for passwd information in the /etc/passwd file, we&#x2019;ll load <code>libnss_systemd.so.2</code> and look it up in the db. If we come back to module_load again, because we simply gave a path value for passwd, after <code>asprintf</code>, the shlib_name will have <code>libnss_woot1337.so.2</code> in it and the malware will execute.</p>
<h2 id="Outro"><a href="#Outro" class="headerlink" title="Outro"></a>Outro</h2><p><img src="/2025/07/21/poosic/[Research]_CVE-2025-32463/EN/4.png" srcset="/img/loading.gif" alt></p>
<p>I know that&#x2019;s three questions instead of two, but let&#x2019;s wrap things up with a final roundup of questions and the answers I found to them!</p>
<ol>
<li><p>where is nsswitch.conf loaded in that code?</p>
<p> A. nss_database_check_reload_and_get to check and update the nss_database.</p>
</li>
<li><p>why does nsswitch.conf recognize files in the root directory that have been replaced with chroot?</p>
<p> A. Because <code>local-&gt;data.reload_disabled</code> is set to 1 and is not reloaded while checking nss_database after <code>unpivot_root</code>.</p>
</li>
<li><p>passwd contains /woot1337 (malicious lib path), does LPE load possible libs?</p>
<p> A. During the <code>module_load</code> process, path is neither files nor dns, so it is recognized as a lib and tries to load the module.</p>
</li>
</ol>
<p>I didn&#x2019;t expect to dig this deep after a day of writing lines, I&#x2019;m very familiar with sudo but never had a chance to look at it like this, so I feel like I&#x2019;ve gotten a little bit more familiar with sudo!</p>
<p>Thanks for reading this long post and I&#x2019;ll see you next time with something better!</p>
<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><p>[1] <a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/pr0v3rbs/CVE-2025-32463_chwoot/tree/main">https://github.com/pr0v3rbs/CVE-2025-32463_chwoot/tree/main</a></p>
<p>[2] <a target="_blank" rel="external nofollow noopener noreferrer" href="https://codebrowser.dev/glibc/glibc/nss/nsswitch.c.html#132">https://codebrowser.dev/glibc/glibc/nss/nsswitch.c.html#132</a></p>

            </div>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                <div class="post-meta mr-3">
                  <i class="iconfont icon-category"></i>
                  
                  <a class="hover-with-bg" href="/categories/Research/">Research</a>
                  
                </div>
                
                
                <div class="post-meta">
                  <i class="iconfont icon-tags"></i>
                  
                  <a class="hover-with-bg" href="/tags/LPE/">LPE</a>
                  
                  <a class="hover-with-bg" href="/tags/chroot/">chroot</a>
                  
                  <a class="hover-with-bg" href="/tags/poosic/">poosic</a>
                  
                  <a class="hover-with-bg" href="/tags/sudo/">sudo</a>
                  
                  <a class="hover-with-bg" href="/tags/CVE-2025-32463/">CVE-2025-32463</a>
                  
                </div>
                
              </div>

              <div class="post-metas mb-3">
                <a class="hover-with-bg" style="display: flex;" href="/author">
                  <div class="link-avatar-page">
                    <img src="/img/profile_poosic.jpg" srcset="/img/loading.gif" alt="poosic">
                  </div>

                  <div class="link-text">
                    <div class="link-title">poosic</div>
                  </div>
                </a>
                <div class="link-text">
                  <div class="link-more">
                    <a href="/tags/poosic">
                      Read more
                      <i class="iconfont icon-arrowdown"></i>
                    </a>
                  </div>
                </div>
              </div>

              <hr>
              <!--<script data-ad-client="ca-pub-3672652207808168" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>-->
              
              <!--  -->
              <p class="note note-warning">  <a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/deed.ko" rel="external nofollow noopener noreferrer">CC BY-SA 4.0</a>  .        .</p>
              
              
              
              <div class="post-prevnext row">
                <article class="post-prev col-6">
                  
                  
                  <a href="/2025/07/23/clalxk/CVE-2025-34508/">
                    <i class="iconfont icon-arrowleft"></i>
                    <span class="hidden-mobile">[] CVE-2025-34508: ZendTo Path Traversal </span>
                    <span class="visible-mobile">Previous</span>
                  </a>
                  
                </article>
                <article class="post-next col-6">
                  
                  
                  <a href="/2025/07/21/poosic/%5BResearch%5D_CVE-2025-32463/KR/">
                    <span class="hidden-mobile">[Research] CVE-2025-32463 Into the 'sudo -R'(KR)</span>
                    <span class="visible-mobile">Next</span>
                    <i class="iconfont icon-arrowright"></i>
                  </a>
                  
                </article>
              </div>
              
            </div>
            
            <!-- Embed Section -->
            <div style="width: 100%; height: 210px; margin-bottom: 50px; overflow: hidden;">
              <iframe src="https://maily.so/hackyboiz/embed?src=embed" style="width: 100%; height: 100%; border: none;" frameborder="0"></iframe>
            </div>            

            
            <!-- Comments -->
            <article class="comments" id="comments">
              
              
  <div class="disqus" style="width:100%">
    <div id="disqus_thread"></div>
    <script type="text/javascript">
      var disqus_config = function () {
        this.page.url = 'https://hackyboiz.github.io/2025/07/21/poosic/[Research]_CVE-2025-32463/EN/';
        this.page.identifier = '/2025/07/21/poosic/%5BResearch%5D_CVE-2025-32463/EN/';
      };
      function loadDisqus() {
        (function () {
          var d = document,
            s = d.createElement('script');
          s.src = '//' + 'hackyboiz' + '.disqus.com/embed.js';
          s.setAttribute('data-timestamp', new Date());
          (d.head || d.body).appendChild(s);
        })();
      }
      waitElementVisible('disqus_thread', loadDisqus);
    </script>
    <noscript>Please enable JavaScript to view the
      <a target="_blank" href="https://disqus.com/?ref_noscript" rel="external nofollow noopener noreferrer">comments powered by Disqus.</a>
    </noscript>
  </div>


            </article>
            
          </article>
        </div>
      </div>
    </div>
    
    <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
      <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;TOC</p>
  <div id="tocbot"></div>
</div>

    </div>
    
  </div>
</div>

<!-- Custom -->

    
  </main>

  
    <a id="scroll-top-button" href="#" role="button">
      <i class="iconfont icon-arrowup" aria-hidden="true"></i>
    </a>
  

  
    <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">Search</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">keyword</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
  

  

  

  <footer class="mt-5">
  <div class="text-center py-3">
    <div>
      <a href="https://hexo.io" target="_blank" rel="external nofollow noopener noreferrer"><span>Hexo</span></a>
      <i class="iconfont icon-love"></i>
      <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="external nofollow noopener noreferrer">
        <span>Fluid</span></a>
    </div>
    

    

    
  </div>
</footer>

<!-- SCRIPTS -->
<script src="https://cdn.staticfile.org/jquery/3.4.1/jquery.min.js"></script>
<script src="https://cdn.staticfile.org/twitter-bootstrap/4.4.1/js/bootstrap.min.js"></script>
<script src="/js/debouncer.js"></script>
<script src="/js/main.js"></script>

<!-- Plugins -->


  
    <script src="/js/lazyload.js"></script>
  



  <script defer src="https://cdn.staticfile.org/clipboard.js/2.0.6/clipboard.min.js"></script>
  <script src="/js/clipboard-use.js"></script>







  <script src="https://cdn.staticfile.org/tocbot/4.11.1/tocbot.min.js"></script>
  <script>
    $(document).ready(function () {
      var boardCtn = $('#board-ctn');
      var boardTop = boardCtn.offset().top;

      tocbot.init({
        tocSelector: '#tocbot',
        contentSelector: '#post-body',
        headingSelector: 'h1,h2,h3,h4,h5,h6',
        linkClass: 'tocbot-link',
        activeLinkClass: 'tocbot-active-link',
        listClass: 'tocbot-list',
        isCollapsedClass: 'tocbot-is-collapsed',
        collapsibleClass: 'tocbot-is-collapsible',
        collapseDepth: 0,
        scrollSmooth: true,
        headingsOffset: -boardTop
      });
      if ($('.toc-list-item').length > 0) {
        $('#toc').css('visibility', 'visible');
      }
    });
  </script>



  <script src="https://cdn.staticfile.org/typed.js/2.0.11/typed.min.js"></script>
  <script>
    var typed = new Typed('#subtitle', {
      strings: [
        '  ',
        "[Research] CVE-2025-32463 Into the 'sudo -R'(EN)&nbsp;",
      ],
      cursorChar: "_",
      typeSpeed: 70,
      loop: false,
    });
    typed.stop();
    $(document).ready(function () {
      $(".typed-cursor").addClass("h2");
      typed.start();
    });
  </script>



  <script src="https://cdn.staticfile.org/anchor-js/4.2.2/anchor.min.js"></script>
  <script>
    anchors.options = {
      placement: "right",
      visible: "hover",
      
    };
    var el = "h1,h2,h3,h4,h5,h6".split(",");
    var res = [];
    for (item of el) {
      res.push(".markdown-body > " + item)
    }
    anchors.add(res.join(", "))
  </script>



  <script src="/js/local-search.js"></script>
  <script>
    var path = "/local-search.xml";
    var inputArea = document.querySelector("#local-search-input");
    inputArea.onclick = function () {
      searchFunc(path, 'local-search-input', 'local-search-result');
      this.onclick = null
    }
  </script>



  <script src="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.js"></script>
  <link rel="stylesheet" href="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.css">

  <script>
    $('#post img:not(.no-zoom img, img[no-zoom]), img[zoom]').each(
      function () {
        var element = document.createElement('a');
        $(element).attr('data-fancybox', 'images');
        $(element).attr('href', $(this).attr('src'));
        $(this).wrap(element);
      }
    );
  </script>





  

  
    <!-- MathJax -->
    <script>
      MathJax = {
        tex: {
          inlineMath: [['$', '$'], ['\\(', '\\)']]
        },
        options: {
          renderActions: {
            findScript: [10, doc => {
              document.querySelectorAll('script[type^="math/tex"]').forEach(node => {
                const display = !!node.type.match(/; *mode=display/);
                const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
                const text = document.createTextNode('');
                node.parentNode.replaceChild(text, node);
                math.start = { node: text, delim: '', n: 0 };
                math.end = { node: text, delim: '', n: 0 };
                doc.math.push(math);
              });
            }, '', false],
            insertedScript: [200, () => {
              document.querySelectorAll('mjx-container').forEach(node => {
                let target = node.parentNode;
                if (target.nodeName.toLowerCase() === 'li') {
                  target.parentNode.classList.add('has-jax');
                }
              });
            }, '', false]
          }
        }
      };
    </script>

    <script async src="https://cdn.staticfile.org/mathjax/3.0.5/es5/tex-svg.js"></script>

  













  

  
    <!-- Google Analytics -->
    <script defer>
      window.ga = window.ga || function () { (ga.q = ga.q || []).push(arguments) };
      ga.l = +new Date;
      ga('create', 'UA-177243668-2', 'auto');
      ga('send', 'pageview');
    </script>
    <script async src="https://www.google-analytics.com/analytics.js"></script>
  

  
    <!-- Google gtag.js -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-177243668-2"></script>
    <script defer>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'UA-177243668-2');
    </script>
  

  

  

  





</body>
</html>
