

<!DOCTYPE html>
<html lang="ko-KR" data-default-color-scheme="&#34;auto&#34;">



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/favicon.ico">
  <link rel="icon" type="image/png" href="/img/favicon.ico">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="description" content="&lt;h2 id=&#34;Introduction&#34;&gt;&lt;a href=&#34;#Introduction&#34; class=&#34;headerlink&#34; title=&#34;Introduction&#34;&gt;&lt;/a&gt;Introduction&lt;/h2&gt;&lt;p&gt;Hi, this is ogu123!!!&lt;/p&gt;
&lt;p&gt;Today we&amp;#x2019;re going to talk about Windows Named Pipes!&lt;/p&gt;
&lt;p&gt;Until now, IPC is a way to communicate between processes~ &amp;#x2190; I&amp;#x2019;ve known about it in a vague way&amp;#x2026;&lt;/p&gt;
&lt;p&gt;This time, we&amp;#x2019;re going to learn more about Named Pipe, one of the many IPCs!&lt;/p&gt;
&lt;p&gt;&lt;del&gt;(What Tungx9 Sahur is holding is a Pipe.)&lt;/del&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/2025/05/12/ogu123/NamedPipe/EN/1.png&#34; alt&gt;&lt;/p&gt;
&lt;h2 id=&#34;Windows-IPC&#34;&gt;&lt;a href=&#34;#Windows-IPC&#34; class=&#34;headerlink&#34; title=&#34;Windows IPC&#34;&gt;&lt;/a&gt;Windows IPC&lt;/h2&gt;&lt;p&gt;First, let&amp;#x2019;s talk about Inter Process Communication (IPC), which is a method that allows processes to communicate with each other!&lt;/p&gt;
&lt;p&gt;Below are the different IPC methods used by Windows.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Shared Memory&lt;/li&gt;
&lt;li&gt;Mail Slot&lt;/li&gt;
&lt;li&gt;Component Object Model (COM)&lt;/li&gt;
&lt;li&gt;Pipe&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Here I was wondering, why do we need to communicate between processes and what are the advantages?&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/2025/05/12/ogu123/NamedPipe/EN/2.png&#34; alt&gt;&lt;/p&gt;
&lt;p&gt;First, processes are created individually, as shown in the image above, so they don&amp;#x2019;t have access to each other! This is called an &lt;strong&gt;Independent Process&lt;/strong&gt;.&lt;/p&gt;
&lt;p&gt;However, in complex situations, processes need to exchange state values or data with each other! Let&amp;#x2019;s explain this with a simple example.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/2025/05/12/ogu123/NamedPipe/EN/3.png&#34; alt&gt;&lt;/p&gt;
&lt;p&gt;Let&amp;#x2019;s say you&amp;#x2019;re downloading a file in a web browser! The browser has two processes running: one that displays the download progress on the screen, as shown in the figure, and one that downloads the actual file data.&lt;/p&gt;
&lt;p&gt;The download process needs to send progress information to the screen process, such as &amp;#x201C;&lt;strong&gt;Now 70% downloaded!&lt;/strong&gt;&amp;#x201D; so that the user can see the progress bar, and the screen process needs to tell the download process &amp;#x201C;&lt;strong&gt;You pressed the stop button!&lt;/strong&gt;&amp;#x201D; so that the download stops.&lt;/p&gt;
&lt;p&gt;When processes communicate with each other by sending and receiving state values or data, as in the example above, they are called co-operating processes, and the advantages of doing so are that they can share resources to work more efficiently, and parallel processing makes programs run faster and more efficiently.&lt;/p&gt;
&lt;p&gt;However, it increases system complexity and requires thorough design as it can introduce vulnerabilities and synchronization issues when reading/writing data.&lt;/p&gt;
&lt;h2 id=&#34;Windows-IPC-Pipe&#34;&gt;&lt;a href=&#34;#Windows-IPC-Pipe&#34; class=&#34;headerlink&#34; title=&#34;Windows IPC Pipe&#34;&gt;&lt;/a&gt;Windows IPC Pipe&lt;/h2&gt;&lt;p&gt;Now that we&amp;#x2019;ve covered what IPC is and why we use it, let&amp;#x2019;s take a look at the different Windows IPC techniques and learn about Pipe.&lt;/p&gt;
&lt;p&gt;First of all, there are two types of pipes: Anonymous Pipes and Named Pipes. The literal translation is an unnamed pipe and a named pipe&amp;#x2026; which makes no sense at all, but let&amp;#x2019;s see what we mean by names first!&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/2025/05/12/ogu123/NamedPipe/EN/4.png&#34; alt&gt;&lt;/p&gt;
&lt;p&gt;For Anonymous and named pipes, think of &lt;strong&gt;name as the address of the pipe&lt;/strong&gt;!&lt;/p&gt;
&lt;p&gt;If the pipe has an address, other processes or remote processes can access it, and conversely, if it doesn&amp;#x2019;t have an address, other processes can&amp;#x2019;t access it!&lt;/p&gt;
&lt;p&gt;Excuse me? Pipe is one of the IPCs, but how does it make sense that other processes can&amp;#x2019;t access it&amp;#x2026; &amp;#x2190; We&amp;#x2019;ll explain this in the Anonymous Pipe section later on lol.&lt;/p&gt;
&lt;p&gt;So what does the address of a pipe refer to? It depends on the local pipe and the remote pipe, but for the remote pipe, we use the &lt;strong&gt;computer name&lt;/strong&gt; to identify the PC on the network. You can find your computer name in your system properties, as shown above!&lt;/p&gt;
&lt;p&gt;To summarize, we already knew that Named Pipes have no limitations on the range of communication (remote, local) due to the existence of a pipe address, and Anonymous Pipes have no limitations on the range of communication (remote, local), which we&amp;#x2019;ll take a closer look at just below!&lt;/p&gt;
&lt;h3 id=&#34;Anonymous-Pipe&#34;&gt;&lt;a href=&#34;#Anonymous-Pipe&#34; class=&#34;headerlink&#34; title=&#34;Anonymous Pipe&#34;&gt;&lt;/a&gt;Anonymous Pipe&lt;/h3&gt;&lt;p&gt;&lt;img src=&#34;/2025/05/12/ogu123/NamedPipe/EN/5.png&#34; alt&gt;&lt;/p&gt;
&lt;p&gt;First, Anonymous Pipes are &lt;strong&gt;one-way&lt;/strong&gt; in nature. When a Pipe is created via the &lt;code&gt;CreatePipe&lt;/code&gt; function below, it returns a handle (hReadPipe, hWritePipe) for two processes to do their respective operations (Read/Write), since it is a one-way communication.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;hljs cpp&#34;&gt;&lt;span class=&#34;hljs-function&#34;&gt;BOOL &lt;span class=&#34;hljs-title&#34;&gt;CreatePipe&lt;/span&gt;&lt;span class=&#34;hljs-params&#34;&gt;(&lt;/span&gt;&lt;/span&gt;
&lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-params&#34;&gt;  [out]          PHANDLE               hReadPipe,&lt;/span&gt;&lt;/span&gt;
&lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-params&#34;&gt;  [out]          PHANDLE               hWritePipe,&lt;/span&gt;&lt;/span&gt;
&lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-params&#34;&gt;  [in, optional] LPSECURITY_ATTRIBUTES lpPipeAttributes,&lt;/span&gt;&lt;/span&gt;
&lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-params&#34;&gt;  [in]           DWORD                 nSize&lt;/span&gt;&lt;/span&gt;
&lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-params&#34;&gt;)&lt;/span&gt;&lt;/span&gt;;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;When you said above that Anonymous Pipes are not accessible to other processes, what do you mean by &amp;#x201C;&lt;strong&gt;two processes return handles (hReadPipe, hWritePipe) for each to do their own operations (Read/Write)&lt;/strong&gt;&amp;#x201D;&amp;#x2026;? The bottom line is that Anonymous Pipes are used to communicate between processes in a parent-child relationship!&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;hljs cpp&#34;&gt;&lt;span class=&#34;hljs-function&#34;&gt;BOOL &lt;span class=&#34;hljs-title&#34;&gt;CreateProcess&lt;/span&gt;&lt;span class=&#34;hljs-params&#34;&gt;(&lt;/span&gt;&lt;/span&gt;
&lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-params&#34;&gt;  [in, optional]      LPCSTR                lpApplicationName,&lt;/span&gt;&lt;/span&gt;
&lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-params&#34;&gt;  [in, out, optional] LPSTR                 lpCommandLine,&lt;/span&gt;&lt;/span&gt;
&lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-params&#34;&gt;  [in, optional]      LPSECURITY_ATTRIBUTES lpProcessAttributes,&lt;/span&gt;&lt;/span&gt;
&lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-params&#34;&gt;  [in, optional]      LPSECURITY_ATTRIBUTES lpThreadAttributes,&lt;/span&gt;&lt;/span&gt;
&lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-params&#34;&gt;  [in]                BOOL                  bInheritHandles,&lt;/span&gt;&lt;/span&gt;
&lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-params&#34;&gt;  [in]                DWORD                 dwCreationFlags,&lt;/span&gt;&lt;/span&gt;
&lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-params&#34;&gt;  [in, optional]      LPVOID                lpEnvironment,&lt;/span&gt;&lt;/span&gt;
&lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-params&#34;&gt;  [in, optional]      LPCSTR                lpCurrentDirectory,&lt;/span&gt;&lt;/span&gt;
&lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-params&#34;&gt;  [in]                LPSTARTUPINFOA        lpStartupInfo,&lt;/span&gt;&lt;/span&gt;
&lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-params&#34;&gt;  [out]               LPPROCESS_INFORMATION lpProcessInformation&lt;/span&gt;&lt;/span&gt;
&lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-params&#34;&gt;)&lt;/span&gt;&lt;/span&gt;;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Create a Pipe with the &lt;code&gt;CreatePipe&lt;/code&gt; function in the parent process and create a child process by setting the value of the &lt;code&gt;CreateProcess&lt;/code&gt; function bInheritHandles argument to True.&lt;/p&gt;
&lt;p&gt;This allows the parent process handle table to be inherited and used by the child process, so it can communicate with the Anonymous Pipe. The communication here uses the &lt;code&gt;ReadFile&lt;/code&gt; and &lt;code&gt;WriteFile&lt;/code&gt; functions.&lt;/p&gt;
&lt;p&gt;If we wanted to have two-way communication, we could create two pipes, right?&lt;/p&gt;
&lt;p&gt;Organizing an Anonymous Pipe means that other processes can&amp;#x2019;t access it because it doesn&amp;#x2019;t have a name, but child processes can access it through handle table inheritance, so Anonymous Pipe can be used for parent-child process communication.&lt;/p&gt;
&lt;h3 id=&#34;Named-Pipe&#34;&gt;&lt;a href=&#34;#Named-Pipe&#34; class=&#34;headerlink&#34; title=&#34;Named Pipe&#34;&gt;&lt;/a&gt;Named Pipe&lt;/h3&gt;&lt;p&gt;&lt;img src=&#34;/2025/05/12/ogu123/NamedPipe/EN/6.png&#34; alt&gt;&lt;/p&gt;
&lt;p&gt;Named Pipes are bi-directional in nature. The server is the one who creates the pipe, and the client is the one who uses the created pipe. Let&amp;#x2019;s take a look at the functions that are important when using Named Pipes!&lt;/p&gt;
&lt;p&gt;Check out the image above and the code below for a better understanding!&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;hljs cpp&#34;&gt;hPipe = HANDLE CreateNamedPipe(
  [in]           LPCSTR                lpName,
  [in]           DWORD                 dwOpenMode,
  [in]           DWORD                 dwPipeMode,
  [in]           DWORD                 nMaxInstances,
  [in]           DWORD                 nOutBufferSize,
  [in]           DWORD                 nInBufferSize,
  [in]           DWORD                 nDefaultTimeOut,
  [in, optional] LPSECURITY_ATTRIBUTES lpSecurityAttributes
);&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;First, we create a Pipe on the server with the &lt;code&gt;CreateNamedPipe&lt;/code&gt; function. This is a two-way communication, so it returns a single handle to the server.&lt;/p&gt;
&lt;p&gt;Here, the &lt;strong&gt;lpName&lt;/strong&gt; argument is the name of the Pipe being created, which can also be set to Half-Duplex (server &amp;#x2192; client, server &amp;#x2190; client) via the &lt;strong&gt;dwOpenMode&lt;/strong&gt; argument.&lt;/p&gt;
&lt;p&gt;The &lt;strong&gt;nMaxInstances&lt;/strong&gt; argument is the number of Pipe instances that will be created. If the value is 3, then up to 3 Pipes with the same name can be created and thus connected to a total of 3 clients.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/2025/05/12/ogu123/NamedPipe/EN/7.png&#34; alt&gt;&lt;/p&gt;
&lt;p&gt;PipeList allows you to see the named pipes in your system.&lt;/p&gt;
&lt;p&gt;If a Pipe with a Max Instances value of 1 receives requests from multiple clients, they will be associated with one Pipe and the remaining clients will be put into a waiting state. The amount of time the clients wait can be set by the &lt;strong&gt;nDefaultTimeOut&lt;/strong&gt; argument.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;hljs cpp&#34;&gt;ConnectNamedPipe(hPipe, &lt;span class=&#34;hljs-literal&#34;&gt;NULL&lt;/span&gt;);&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;After creating a Pipe on the server, the &lt;code&gt;ConnectNamedPipe&lt;/code&gt; function puts the Pipe in a &lt;strong&gt;connect-waiting state&lt;/strong&gt; so that it can be accessed by other processes, both remote and local. Think of it as exposing the Pipe to the outside world!&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;hljs cpp&#34;&gt;&lt;span class=&#34;hljs-function&#34;&gt;HANDLE &lt;span class=&#34;hljs-title&#34;&gt;CreateFile&lt;/span&gt;&lt;span class=&#34;hljs-params&#34;&gt;(&lt;/span&gt;&lt;/span&gt;
&lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-params&#34;&gt;  [in]           LPCSTR                lpFileName,&lt;/span&gt;&lt;/span&gt;
&lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-params&#34;&gt;  [in]           DWORD                 dwDesiredAccess,&lt;/span&gt;&lt;/span&gt;
&lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-params&#34;&gt;  [in]           DWORD                 dwShareMode,&lt;/span&gt;&lt;/span&gt;
&lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-params&#34;&gt;  [in, optional] LPSECURITY_ATTRIBUTES lpSecurityAttributes,&lt;/span&gt;&lt;/span&gt;
&lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-params&#34;&gt;  [in]           DWORD                 dwCreationDisposition,&lt;/span&gt;&lt;/span&gt;
&lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-params&#34;&gt;  [in]           DWORD                 dwFlagsAndAttributes,&lt;/span&gt;&lt;/span&gt;
&lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-params&#34;&gt;  [in, optional] HANDLE                hTemplateFile&lt;/span&gt;&lt;/span&gt;
&lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-params&#34;&gt;)&lt;/span&gt;&lt;/span&gt;;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Now, on the client, insert the server Named Pipe you want to connect to in the &lt;strong&gt;lpFileName&lt;/strong&gt; argument, run the &lt;code&gt;CreateFile&lt;/code&gt; function, and you will be able to communicate with the Named Pipe. Communication uses the &lt;code&gt;ReadFile&lt;/code&gt;, &lt;code&gt;WriteFile&lt;/code&gt; functions just like Anonymous Pipe.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;hljs cpp&#34;&gt;&lt;span class=&#34;hljs-function&#34;&gt;BOOL &lt;span class=&#34;hljs-title&#34;&gt;WaitNamedPipe&lt;/span&gt;&lt;span class=&#34;hljs-params&#34;&gt;(&lt;/span&gt;&lt;/span&gt;
&lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-params&#34;&gt;  [in] LPCSTR lpNamedPipeName,&lt;/span&gt;&lt;/span&gt;
&lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-params&#34;&gt;  [in] DWORD  nTimeOut&lt;/span&gt;&lt;/span&gt;
&lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-params&#34;&gt;)&lt;/span&gt;&lt;/span&gt;;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;If a client sends a request for a Pipe connection via the &lt;code&gt;CreateFile&lt;/code&gt; function, but the server Pipe instance is full, the &lt;code&gt;WaitNamedPipe&lt;/code&gt; function can wait for the value of the &lt;strong&gt;nTimeOut&lt;/strong&gt; argument.&lt;/p&gt;
&lt;p&gt;If the &lt;strong&gt;nTimeOut&lt;/strong&gt; argument is set to the default value, the &lt;code&gt;CreateNamedPipe&lt;/code&gt; function will wait as long as the &lt;strong&gt;nDefaultTimeOut&lt;/strong&gt; value.&lt;/p&gt;
&lt;p&gt;So far, we&amp;#x2019;ve seen what the names mean for Anonymous and Named Pipes, and how to create and use them in code. I think you should have no problem understanding the Windows Pipe code if you know the functions above!&lt;/p&gt;
&lt;h2 id=&#34;Windows-Named-pipe&#34;&gt;&lt;a href=&#34;#Windows-Named-pipe&#34; class=&#34;headerlink&#34; title=&#34;Windows Named pipe&#34;&gt;&lt;/a&gt;Windows Named pipe&lt;/h2&gt;&lt;p&gt;Now let&amp;#x2019;s dive into Named Pipes in earnest!&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/2025/05/12/ogu123/NamedPipe/EN/8.png&#34; alt&gt;&lt;/p&gt;
&lt;p&gt;Pipes created using the &lt;code&gt;CreatePipe&lt;/code&gt; or &lt;code&gt;CreateNamedPipe&lt;/code&gt; functions are created in the kernel area and behave like a kind of shared memory. Windows treats this shared memory as a File Object, which is why you can see in the figure above that the Pipe is a File Object.&lt;/p&gt;
&lt;p&gt;Therefore, when you send or receive data through a Pipe, you are using file-specific APIs like &lt;code&gt;ReadFile&lt;/code&gt; or &lt;code&gt;WriteFile&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;In the case of Named Pipes, remote and local processes can connect through the name of the Pipe. Here&amp;#x2019;s a look at the basic structure of a Pipe name.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;hljs cpp&#34;&gt;\\ServerName\pipe\PipeName&lt;/code&gt;&lt;/pre&gt;
&lt;ul&gt;
&lt;li&gt;Server-side: &lt;code&gt;\\\\.\\pipe\\ogu123&lt;/code&gt;&lt;ul&gt;
&lt;li&gt;Since the server is creating the pipe on its own machine, you can use a .(dot) in the server name and the name of the pipe being created (&lt;code&gt;ogu123&lt;/code&gt;) as the lpName argument to the &lt;code&gt;CreateNamedPipe&lt;/code&gt; function.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Client side: &lt;code&gt;\\\\.\\pipe\\ogu123&lt;/code&gt; or &lt;code&gt;\\\\ComputerName\\pipe\\ogu123&lt;/code&gt;&lt;ul&gt;
&lt;li&gt;If the pipe you want to connect to exists on the local machine, use &lt;code&gt;\\\\.\\pipe\\ogu123&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;If the pipe you want to connect to exists on the remote computer, use &lt;code&gt;\\\\ComputerName\\pipe\\ogu123&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img src=&#34;/2025/05/12/ogu123/NamedPipe/EN/9.png&#34; alt&gt;&lt;/p&gt;
&lt;p&gt;So far, we&amp;#x2019;ve checked the location of the Pipe in memory and looked at the Pipe name structure.&lt;/p&gt;
&lt;p&gt;If we create a Pipe on the server side via &lt;code&gt;\\\\.\\pipe\\ogu123&lt;/code&gt;, let&amp;#x2019;s see where the &lt;code&gt;ogu123&lt;/code&gt; Pipe is actually created.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/2025/05/12/ogu123/NamedPipe/EN/10.png&#34; alt&gt;&lt;/p&gt;
&lt;p&gt;NamedPipeServer.exe creates the &lt;code&gt;ogu123&lt;/code&gt; Pipe. If we check the NamedPipeServer.exe process handle with Process Explorer, we can see that it has a Named Pipe handle named &lt;code&gt;ogu123&lt;/code&gt;, as shown above.&lt;/p&gt;
&lt;p&gt;The strange thing here is that we created the Pipe at the path &lt;code&gt;\\\\.\\pipe\\ogu123&lt;/code&gt;, but it was actually created at &lt;code&gt;\\Device\\NamedPipe\\ogu123&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/2025/05/12/ogu123/NamedPipe/EN/11.png&#34; alt&gt;&lt;/p&gt;
&lt;p&gt;This can be seen by looking at the WinObj and seeing that &lt;code&gt;\\\\.\\pipe&lt;/code&gt; is symlinked to the path &lt;code&gt;\\Device\\NamedPipe&lt;/code&gt;, which creates the Pipe &lt;code&gt;\\Device\\NamedPipe\\ogu123&lt;/code&gt;.&lt;/p&gt;
&lt;h2 id=&#34;Find-Named-pipe-vulnerabilities&#34;&gt;&lt;a href=&#34;#Find-Named-pipe-vulnerabilities&#34; class=&#34;headerlink&#34; title=&#34;Find Named pipe vulnerabilities&#34;&gt;&lt;/a&gt;Find Named pipe vulnerabilities&lt;/h2&gt;&lt;p&gt;Now let&amp;#x2019;s dive into the process of finding vulnerabilities in Named Pipes!&lt;/p&gt;
&lt;p&gt;We&amp;#x2019;ll cover two exercises, the first to find them using Process Explorer, accesschk, IDA, etc. and the second to exploit them using the Client Impersonation technique!&lt;/p&gt;
&lt;p&gt;For the first lab, I used the code from &lt;a href=&#34;https://github.com/VerSprite/research/tree/master/projects/cpp/VulnerableApps/WindowsPipes&#34;&gt;link&lt;/a&gt; with some minor modifications.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/2025/05/12/ogu123/NamedPipe/EN/12.png&#34; alt&gt;&lt;/p&gt;
&lt;p&gt;First, enable the handle option in Process Explorer, and then check the handle value of the target process running with elevated privileges.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/2025/05/12/ogu123/NamedPipe/EN/13.png&#34; alt&gt;&lt;/p&gt;
&lt;p&gt;You can see that the target process (NamedPipeServer.exe) is running as administrator and that the ogu123 Pipe exists.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/2025/05/12/ogu123/NamedPipe/EN/14.png&#34; alt&gt;&lt;/p&gt;
&lt;p&gt;You can now check the DACLs of all Named Pipes under \.\pipe\ with accesschk&amp;#x2019;s &lt;code&gt;accesschk.exe \\pipe\\&lt;/code&gt; command.&lt;/p&gt;
&lt;p&gt;In the figure above, we can see that the ogu123 Pipe has RW permissions for the Everyone group, which means that the target process Named Pipe can be connected to and read/written by normal users.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/2025/05/12/ogu123/NamedPipe/EN/15.png&#34; alt&gt;&lt;/p&gt;
&lt;p&gt;Now we just need to find the server-side Named Pipe creation part through IDA and find the point in the process of communicating with the client that will trigger the LPE.&lt;/p&gt;
&lt;p&gt;First, you can find the server-side Named Pipe creation part by using IDA Imports or string search to find the functions shown above (including &lt;code&gt;CreateNamedPipeW()&lt;/code&gt;).&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/2025/05/12/ogu123/NamedPipe/EN/16.png&#34; alt&gt;&lt;/p&gt;
&lt;p&gt;We see that the target process uses the &lt;code&gt;CreateNamedPipeW&lt;/code&gt; function, and if we follow where it uses that function, we see that the&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/2025/05/12/ogu123/NamedPipe/EN/17.png&#34; alt&gt;&lt;/p&gt;
&lt;p&gt;You can see where to create the ogu123 Pipe. Now, after creating the Pipe, all you need to do is read the connected client messages on the server side and look for vectors that might trigger the LPE vulnerability! Simple, right?&lt;/p&gt;
&lt;h3 id=&#34;Client-Impersonation-Techniques&#34;&gt;&lt;a href=&#34;#Client-Impersonation-Techniques&#34; class=&#34;headerlink&#34; title=&#34;Client Impersonation Techniques&#34;&gt;&lt;/a&gt;Client Impersonation Techniques&lt;/h3&gt;&lt;p&gt;The Client Impersonation technique is a way for the server to obtain client authorization to perform LPE once it is connected to the client.&lt;/p&gt;
&lt;p&gt;First, the server must obtain client authorization to perform impersonation, which is stored in the Access Token. The Access Token needs to be able to control &amp;#x201C;&lt;strong&gt;what the server can do with my information&lt;/strong&gt;&amp;#x201D;, which is where the Impersonation Level comes in.&lt;/p&gt;
&lt;div class=&#34;table-container&#34;&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;SECURITY_IMPERSONATION_LEVEL&lt;/th&gt;
&lt;th&gt;Description&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;SecurityAnonymous&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;The server cannot impersonate or identify the client.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;SecurityIdentification&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;The server can get the identity and privileges of the client, but cannot impersonate the client.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;SecurityImpersonation&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;The server can impersonate the client&amp;#x2019;s security context on the local system.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;SecurityDelegation&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;The server can impersonate the client&amp;#x2019;s security context on remote systems.&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;/div&gt;
&lt;p&gt;There are two types of access tokens: primary tokens and impersonation tokens, which we&amp;#x2019;ll describe as processes and threads!&lt;/p&gt;
&lt;p&gt;In Windows, every process has an Access Token, where the process token uses the Primary Token and does not change until the process is terminated.&lt;/p&gt;
&lt;p&gt;A thread can have two values, a Primary Token and an Impersonation Token, and it shares the Primary Token value of the process.&lt;/p&gt;
&lt;p&gt;A thread can use the Access Token of another account instead of the Primary Token when it is created, and the token it uses is the Impersonation Token! This means that the thread always references the Primary Token and only has an Impersonation Token when it is in impersonation.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;hljs cpp&#34;&gt;CreateFile(
    &lt;span class=&#34;hljs-string&#34;&gt;L&amp;quot;Local pipe path or remote pipe path&amp;quot;&lt;/span&gt;,
    GENERIC_READ | GENERIC_WRITE,
    &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;,
    &lt;span class=&#34;hljs-literal&#34;&gt;NULL&lt;/span&gt;,
    OPEN_EXISTING,
    SECURITY_SQOS_PRESENT | SECURITY_IMPERSONATION, &lt;span class=&#34;hljs-comment&#34;&gt;// or SECURITY_DELEGATION&lt;/span&gt;
    &lt;span class=&#34;hljs-literal&#34;&gt;NULL&lt;/span&gt;
);&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Let&amp;#x2019;s take a closer look at the LPE method with Client Impersonation!&lt;/p&gt;
&lt;p&gt;When the target service or program calls &lt;code&gt;CreateFile()&lt;/code&gt;, instead of the normal file path, it connects to the attacker&amp;#x2019;s Named Pipe! The 6th argument of the &lt;code&gt;CreateFile()&lt;/code&gt; function must have the value SECURITY_SQOS_PRESENT | SECURITY_IMPERSONATION or SECURITY_DELEGATION as shown above.&lt;/p&gt;
&lt;p&gt;For remote pipes, SECURITY_IMPERSONATION is said to be enforced even if only SECURITY_SQOS_PRESENT is present.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;hljs cpp&#34;&gt;&lt;span class=&#34;hljs-comment&#34;&gt;// Create a server named pipe&lt;/span&gt;
serverPipe = CreateNamedPipe(
    pipeName,           &lt;span class=&#34;hljs-comment&#34;&gt;// name of our pipe, must be in the form of \\.\pipe\&amp;lt;NAME&amp;gt;&lt;/span&gt;
    PIPE_ACCESS_DUPLEX, &lt;span class=&#34;hljs-comment&#34;&gt;// The rest of the parameters don&amp;apos;t really matter&lt;/span&gt;
    PIPE_TYPE_MESSAGE,	&lt;span class=&#34;hljs-comment&#34;&gt;// as all you want is impersonate the client...&lt;/span&gt;
    &lt;span class=&#34;hljs-number&#34;&gt;1&lt;/span&gt;,		&lt;span class=&#34;hljs-comment&#34;&gt;// &lt;/span&gt;
    &lt;span class=&#34;hljs-number&#34;&gt;2048&lt;/span&gt;,	&lt;span class=&#34;hljs-comment&#34;&gt;// &lt;/span&gt;
    &lt;span class=&#34;hljs-number&#34;&gt;2048&lt;/span&gt;,	&lt;span class=&#34;hljs-comment&#34;&gt;// &lt;/span&gt;
    &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;,		&lt;span class=&#34;hljs-comment&#34;&gt;// &lt;/span&gt;
    &lt;span class=&#34;hljs-literal&#34;&gt;NULL&lt;/span&gt;	&lt;span class=&#34;hljs-comment&#34;&gt;// This should ne NULL so every client can connect&lt;/span&gt;
);
&lt;span class=&#34;hljs-comment&#34;&gt;// wait for pipe connections&lt;/span&gt;
BOOL bPipeConnected = ConnectNamedPipe(serverPipe, &lt;span class=&#34;hljs-literal&#34;&gt;NULL&lt;/span&gt;);
&lt;span class=&#34;hljs-comment&#34;&gt;// Impersonate client&lt;/span&gt;
BOOL bImpersonated = ImpersonateNamedPipeClient(serverPipe);
&lt;span class=&#34;hljs-comment&#34;&gt;// if successful open Thread token - your current thread token is now the client&amp;apos;s token&lt;/span&gt;
BOOL bSuccess = OpenThreadToken(GetCurrentThread(), TOKEN_ALL_ACCESS, FALSE, &amp;amp;hToken);
&lt;span class=&#34;hljs-comment&#34;&gt;// now you got the client token saved in hToken and you can safeyl revert back to self&lt;/span&gt;
bSuccess = RevertToSelf();
&lt;span class=&#34;hljs-comment&#34;&gt;// Now duplicate the client&amp;apos;s token to get a Primary token&lt;/span&gt;
bSuccess = DuplicateTokenEx(hToken,
    TOKEN_ALL_ACCESS,
    &lt;span class=&#34;hljs-literal&#34;&gt;NULL&lt;/span&gt;,
    SecurityImpersonation,
    TokenPrimary,
    &amp;amp;hDuppedToken
);
&lt;span class=&#34;hljs-comment&#34;&gt;// If that succeeds you got a Primary token as hDuppedToken and you can create a proccess with that token&lt;/span&gt;
CreateProcessWithTokenW(hDuppedToken, LOGON_WITH_PROFILE, command, &lt;span class=&#34;hljs-literal&#34;&gt;NULL&lt;/span&gt;, CREATE_NEW_CONSOLE, &lt;span class=&#34;hljs-literal&#34;&gt;NULL&lt;/span&gt;, &lt;span class=&#34;hljs-literal&#34;&gt;NULL&lt;/span&gt;, &amp;amp;si, &amp;amp;pi);&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Once the target client is connected to the attacker&amp;#x2019;s Named Pipe server, the server can LPE with client privileges via the above code. Let&amp;#x2019;s take a look at the main functions.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;ImpersonateNamedPipeClient()&lt;/code&gt; : Applies the client Impersonation Token to the server thread. The Impersonation Token used is the token for applying the client&amp;#x2019;s Primary Token to the thread.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;RetrieveToSelf()&lt;/code&gt;: Terminates the Impersonation. It must be executed before the &lt;code&gt;CreateProcessWithTokenW()&lt;/code&gt; function is called to avoid errors.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;DuplicateTokenEx()&lt;/code&gt; : Duplicates the client Impersonation Token obtained earlier as the Primary Token for use in the process.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;CreateProcessWithTokenW()&lt;/code&gt; : Creates a process with client privileges through the Primary Token token. &amp;#x2192; LPE occurs!&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;Conclusion&#34;&gt;&lt;a href=&#34;#Conclusion&#34; class=&#34;headerlink&#34; title=&#34;Conclusion&#34;&gt;&lt;/a&gt;&lt;strong&gt;Conclusion&lt;/strong&gt;&lt;/h2&gt;&lt;p&gt;In this article, we took a deep dive into Windows IPC and Named Pipes! Writing this article reminded me that there are a lot of Windows Attack Vectors out there.&lt;/p&gt;
&lt;p&gt;Thanks for reading this long post!&lt;/p&gt;
&lt;h2 id=&#34;Reference&#34;&gt;&lt;a href=&#34;#Reference&#34; class=&#34;headerlink&#34; title=&#34;Reference&#34;&gt;&lt;/a&gt;&lt;strong&gt;Reference&lt;/strong&gt;&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;&amp;#xC708;&amp;#xB3C4;&amp;#xC6B0; &amp;#xC2DC;&amp;#xC2A4;&amp;#xD15C; &amp;#xD504;&amp;#xB85C;&amp;#xADF8;&amp;#xB798;&amp;#xBC0D;&lt;/li&gt;
&lt;li&gt;&amp;#xB1CC;&amp;#xB97C; &amp;#xC790;&amp;#xADF9;&amp;#xD558;&amp;#xB294; &amp;#xC708;&amp;#xB3C4;&amp;#xC6B0;&amp;#xC988; &amp;#xC2DC;&amp;#xC2A4;&amp;#xD15C; &amp;#xD504;&amp;#xB85C;&amp;#xADF8;&amp;#xB798;&amp;#xBC0D;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.baeldung.com/cs/pipes-vs-sockets&#34;&gt;https://www.baeldung.com/cs/pipes-vs-sockets&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.codeproject.com/Articles/13724/Windows-IPC&#34;&gt;https://www.codeproject.com/Articles/13724/Windows-IPC&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://versprite.com/vs-labs/microsoft-windows-pipes-intro/&#34;&gt;https://versprite.com/vs-labs/microsoft-windows-pipes-intro/&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://versprite.com/vs-labs/vulnerable-named-pipe-application/&#34;&gt;https://versprite.com/vs-labs/vulnerable-named-pipe-application/&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://csandker.io/2021/01/10/Offensive-Windows-IPC-1-NamedPipes.html&#34;&gt;https://csandker.io/2021/01/10/Offensive-Windows-IPC-1-NamedPipes.html&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
 - hack &amp; life">
  <meta name="author" content="j0dev, y2sman">
  <meta name="keywords" content>
  <meta name="google-site-verification" content="DXkyiaX95-ws53Tyt0m91_umRf4gfV2qJIQZ5zQDIO4">
  <meta name="naver-site-verification" content="0b4fea742ed293b82621684e466d9f26c3ccee06">


  <meta property="og:type" content="website"> 
  <meta property="og:title" content="[Research] Windows Named Pipe (EN) - hackyboiz">
  <meta property="og:description" content="&lt;h2 id=&#34;Introduction&#34;&gt;&lt;a href=&#34;#Introduction&#34; class=&#34;headerlink&#34; title=&#34;Introduction&#34;&gt;&lt;/a&gt;Introduction&lt;/h2&gt;&lt;p&gt;Hi, this is ogu123!!!&lt;/p&gt;
&lt;p&gt;Today we&amp;#x2019;re going to talk about Windows Named Pipes!&lt;/p&gt;
&lt;p&gt;Until now, IPC is a way to communicate between processes~ &amp;#x2190; I&amp;#x2019;ve known about it in a vague way&amp;#x2026;&lt;/p&gt;
&lt;p&gt;This time, we&amp;#x2019;re going to learn more about Named Pipe, one of the many IPCs!&lt;/p&gt;
&lt;p&gt;&lt;del&gt;(What Tungx9 Sahur is holding is a Pipe.)&lt;/del&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/2025/05/12/ogu123/NamedPipe/EN/1.png&#34; alt&gt;&lt;/p&gt;
&lt;h2 id=&#34;Windows-IPC&#34;&gt;&lt;a href=&#34;#Windows-IPC&#34; class=&#34;headerlink&#34; title=&#34;Windows IPC&#34;&gt;&lt;/a&gt;Windows IPC&lt;/h2&gt;&lt;p&gt;First, let&amp;#x2019;s talk about Inter Process Communication (IPC), which is a method that allows processes to communicate with each other!&lt;/p&gt;
&lt;p&gt;Below are the different IPC methods used by Windows.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Shared Memory&lt;/li&gt;
&lt;li&gt;Mail Slot&lt;/li&gt;
&lt;li&gt;Component Object Model (COM)&lt;/li&gt;
&lt;li&gt;Pipe&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Here I was wondering, why do we need to communicate between processes and what are the advantages?&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/2025/05/12/ogu123/NamedPipe/EN/2.png&#34; alt&gt;&lt;/p&gt;
&lt;p&gt;First, processes are created individually, as shown in the image above, so they don&amp;#x2019;t have access to each other! This is called an &lt;strong&gt;Independent Process&lt;/strong&gt;.&lt;/p&gt;
&lt;p&gt;However, in complex situations, processes need to exchange state values or data with each other! Let&amp;#x2019;s explain this with a simple example.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/2025/05/12/ogu123/NamedPipe/EN/3.png&#34; alt&gt;&lt;/p&gt;
&lt;p&gt;Let&amp;#x2019;s say you&amp;#x2019;re downloading a file in a web browser! The browser has two processes running: one that displays the download progress on the screen, as shown in the figure, and one that downloads the actual file data.&lt;/p&gt;
&lt;p&gt;The download process needs to send progress information to the screen process, such as &amp;#x201C;&lt;strong&gt;Now 70% downloaded!&lt;/strong&gt;&amp;#x201D; so that the user can see the progress bar, and the screen process needs to tell the download process &amp;#x201C;&lt;strong&gt;You pressed the stop button!&lt;/strong&gt;&amp;#x201D; so that the download stops.&lt;/p&gt;
&lt;p&gt;When processes communicate with each other by sending and receiving state values or data, as in the example above, they are called co-operating processes, and the advantages of doing so are that they can share resources to work more efficiently, and parallel processing makes programs run faster and more efficiently.&lt;/p&gt;
&lt;p&gt;However, it increases system complexity and requires thorough design as it can introduce vulnerabilities and synchronization issues when reading/writing data.&lt;/p&gt;
&lt;h2 id=&#34;Windows-IPC-Pipe&#34;&gt;&lt;a href=&#34;#Windows-IPC-Pipe&#34; class=&#34;headerlink&#34; title=&#34;Windows IPC Pipe&#34;&gt;&lt;/a&gt;Windows IPC Pipe&lt;/h2&gt;&lt;p&gt;Now that we&amp;#x2019;ve covered what IPC is and why we use it, let&amp;#x2019;s take a look at the different Windows IPC techniques and learn about Pipe.&lt;/p&gt;
&lt;p&gt;First of all, there are two types of pipes: Anonymous Pipes and Named Pipes. The literal translation is an unnamed pipe and a named pipe&amp;#x2026; which makes no sense at all, but let&amp;#x2019;s see what we mean by names first!&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/2025/05/12/ogu123/NamedPipe/EN/4.png&#34; alt&gt;&lt;/p&gt;
&lt;p&gt;For Anonymous and named pipes, think of &lt;strong&gt;name as the address of the pipe&lt;/strong&gt;!&lt;/p&gt;
&lt;p&gt;If the pipe has an address, other processes or remote processes can access it, and conversely, if it doesn&amp;#x2019;t have an address, other processes can&amp;#x2019;t access it!&lt;/p&gt;
&lt;p&gt;Excuse me? Pipe is one of the IPCs, but how does it make sense that other processes can&amp;#x2019;t access it&amp;#x2026; &amp;#x2190; We&amp;#x2019;ll explain this in the Anonymous Pipe section later on lol.&lt;/p&gt;
&lt;p&gt;So what does the address of a pipe refer to? It depends on the local pipe and the remote pipe, but for the remote pipe, we use the &lt;strong&gt;computer name&lt;/strong&gt; to identify the PC on the network. You can find your computer name in your system properties, as shown above!&lt;/p&gt;
&lt;p&gt;To summarize, we already knew that Named Pipes have no limitations on the range of communication (remote, local) due to the existence of a pipe address, and Anonymous Pipes have no limitations on the range of communication (remote, local), which we&amp;#x2019;ll take a closer look at just below!&lt;/p&gt;
&lt;h3 id=&#34;Anonymous-Pipe&#34;&gt;&lt;a href=&#34;#Anonymous-Pipe&#34; class=&#34;headerlink&#34; title=&#34;Anonymous Pipe&#34;&gt;&lt;/a&gt;Anonymous Pipe&lt;/h3&gt;&lt;p&gt;&lt;img src=&#34;/2025/05/12/ogu123/NamedPipe/EN/5.png&#34; alt&gt;&lt;/p&gt;
&lt;p&gt;First, Anonymous Pipes are &lt;strong&gt;one-way&lt;/strong&gt; in nature. When a Pipe is created via the &lt;code&gt;CreatePipe&lt;/code&gt; function below, it returns a handle (hReadPipe, hWritePipe) for two processes to do their respective operations (Read/Write), since it is a one-way communication.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;hljs cpp&#34;&gt;&lt;span class=&#34;hljs-function&#34;&gt;BOOL &lt;span class=&#34;hljs-title&#34;&gt;CreatePipe&lt;/span&gt;&lt;span class=&#34;hljs-params&#34;&gt;(&lt;/span&gt;&lt;/span&gt;
&lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-params&#34;&gt;  [out]          PHANDLE               hReadPipe,&lt;/span&gt;&lt;/span&gt;
&lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-params&#34;&gt;  [out]          PHANDLE               hWritePipe,&lt;/span&gt;&lt;/span&gt;
&lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-params&#34;&gt;  [in, optional] LPSECURITY_ATTRIBUTES lpPipeAttributes,&lt;/span&gt;&lt;/span&gt;
&lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-params&#34;&gt;  [in]           DWORD                 nSize&lt;/span&gt;&lt;/span&gt;
&lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-params&#34;&gt;)&lt;/span&gt;&lt;/span&gt;;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;When you said above that Anonymous Pipes are not accessible to other processes, what do you mean by &amp;#x201C;&lt;strong&gt;two processes return handles (hReadPipe, hWritePipe) for each to do their own operations (Read/Write)&lt;/strong&gt;&amp;#x201D;&amp;#x2026;? The bottom line is that Anonymous Pipes are used to communicate between processes in a parent-child relationship!&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;hljs cpp&#34;&gt;&lt;span class=&#34;hljs-function&#34;&gt;BOOL &lt;span class=&#34;hljs-title&#34;&gt;CreateProcess&lt;/span&gt;&lt;span class=&#34;hljs-params&#34;&gt;(&lt;/span&gt;&lt;/span&gt;
&lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-params&#34;&gt;  [in, optional]      LPCSTR                lpApplicationName,&lt;/span&gt;&lt;/span&gt;
&lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-params&#34;&gt;  [in, out, optional] LPSTR                 lpCommandLine,&lt;/span&gt;&lt;/span&gt;
&lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-params&#34;&gt;  [in, optional]      LPSECURITY_ATTRIBUTES lpProcessAttributes,&lt;/span&gt;&lt;/span&gt;
&lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-params&#34;&gt;  [in, optional]      LPSECURITY_ATTRIBUTES lpThreadAttributes,&lt;/span&gt;&lt;/span&gt;
&lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-params&#34;&gt;  [in]                BOOL                  bInheritHandles,&lt;/span&gt;&lt;/span&gt;
&lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-params&#34;&gt;  [in]                DWORD                 dwCreationFlags,&lt;/span&gt;&lt;/span&gt;
&lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-params&#34;&gt;  [in, optional]      LPVOID                lpEnvironment,&lt;/span&gt;&lt;/span&gt;
&lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-params&#34;&gt;  [in, optional]      LPCSTR                lpCurrentDirectory,&lt;/span&gt;&lt;/span&gt;
&lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-params&#34;&gt;  [in]                LPSTARTUPINFOA        lpStartupInfo,&lt;/span&gt;&lt;/span&gt;
&lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-params&#34;&gt;  [out]               LPPROCESS_INFORMATION lpProcessInformation&lt;/span&gt;&lt;/span&gt;
&lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-params&#34;&gt;)&lt;/span&gt;&lt;/span&gt;;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Create a Pipe with the &lt;code&gt;CreatePipe&lt;/code&gt; function in the parent process and create a child process by setting the value of the &lt;code&gt;CreateProcess&lt;/code&gt; function bInheritHandles argument to True.&lt;/p&gt;
&lt;p&gt;This allows the parent process handle table to be inherited and used by the child process, so it can communicate with the Anonymous Pipe. The communication here uses the &lt;code&gt;ReadFile&lt;/code&gt; and &lt;code&gt;WriteFile&lt;/code&gt; functions.&lt;/p&gt;
&lt;p&gt;If we wanted to have two-way communication, we could create two pipes, right?&lt;/p&gt;
&lt;p&gt;Organizing an Anonymous Pipe means that other processes can&amp;#x2019;t access it because it doesn&amp;#x2019;t have a name, but child processes can access it through handle table inheritance, so Anonymous Pipe can be used for parent-child process communication.&lt;/p&gt;
&lt;h3 id=&#34;Named-Pipe&#34;&gt;&lt;a href=&#34;#Named-Pipe&#34; class=&#34;headerlink&#34; title=&#34;Named Pipe&#34;&gt;&lt;/a&gt;Named Pipe&lt;/h3&gt;&lt;p&gt;&lt;img src=&#34;/2025/05/12/ogu123/NamedPipe/EN/6.png&#34; alt&gt;&lt;/p&gt;
&lt;p&gt;Named Pipes are bi-directional in nature. The server is the one who creates the pipe, and the client is the one who uses the created pipe. Let&amp;#x2019;s take a look at the functions that are important when using Named Pipes!&lt;/p&gt;
&lt;p&gt;Check out the image above and the code below for a better understanding!&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;hljs cpp&#34;&gt;hPipe = HANDLE CreateNamedPipe(
  [in]           LPCSTR                lpName,
  [in]           DWORD                 dwOpenMode,
  [in]           DWORD                 dwPipeMode,
  [in]           DWORD                 nMaxInstances,
  [in]           DWORD                 nOutBufferSize,
  [in]           DWORD                 nInBufferSize,
  [in]           DWORD                 nDefaultTimeOut,
  [in, optional] LPSECURITY_ATTRIBUTES lpSecurityAttributes
);&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;First, we create a Pipe on the server with the &lt;code&gt;CreateNamedPipe&lt;/code&gt; function. This is a two-way communication, so it returns a single handle to the server.&lt;/p&gt;
&lt;p&gt;Here, the &lt;strong&gt;lpName&lt;/strong&gt; argument is the name of the Pipe being created, which can also be set to Half-Duplex (server &amp;#x2192; client, server &amp;#x2190; client) via the &lt;strong&gt;dwOpenMode&lt;/strong&gt; argument.&lt;/p&gt;
&lt;p&gt;The &lt;strong&gt;nMaxInstances&lt;/strong&gt; argument is the number of Pipe instances that will be created. If the value is 3, then up to 3 Pipes with the same name can be created and thus connected to a total of 3 clients.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/2025/05/12/ogu123/NamedPipe/EN/7.png&#34; alt&gt;&lt;/p&gt;
&lt;p&gt;PipeList allows you to see the named pipes in your system.&lt;/p&gt;
&lt;p&gt;If a Pipe with a Max Instances value of 1 receives requests from multiple clients, they will be associated with one Pipe and the remaining clients will be put into a waiting state. The amount of time the clients wait can be set by the &lt;strong&gt;nDefaultTimeOut&lt;/strong&gt; argument.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;hljs cpp&#34;&gt;ConnectNamedPipe(hPipe, &lt;span class=&#34;hljs-literal&#34;&gt;NULL&lt;/span&gt;);&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;After creating a Pipe on the server, the &lt;code&gt;ConnectNamedPipe&lt;/code&gt; function puts the Pipe in a &lt;strong&gt;connect-waiting state&lt;/strong&gt; so that it can be accessed by other processes, both remote and local. Think of it as exposing the Pipe to the outside world!&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;hljs cpp&#34;&gt;&lt;span class=&#34;hljs-function&#34;&gt;HANDLE &lt;span class=&#34;hljs-title&#34;&gt;CreateFile&lt;/span&gt;&lt;span class=&#34;hljs-params&#34;&gt;(&lt;/span&gt;&lt;/span&gt;
&lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-params&#34;&gt;  [in]           LPCSTR                lpFileName,&lt;/span&gt;&lt;/span&gt;
&lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-params&#34;&gt;  [in]           DWORD                 dwDesiredAccess,&lt;/span&gt;&lt;/span&gt;
&lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-params&#34;&gt;  [in]           DWORD                 dwShareMode,&lt;/span&gt;&lt;/span&gt;
&lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-params&#34;&gt;  [in, optional] LPSECURITY_ATTRIBUTES lpSecurityAttributes,&lt;/span&gt;&lt;/span&gt;
&lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-params&#34;&gt;  [in]           DWORD                 dwCreationDisposition,&lt;/span&gt;&lt;/span&gt;
&lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-params&#34;&gt;  [in]           DWORD                 dwFlagsAndAttributes,&lt;/span&gt;&lt;/span&gt;
&lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-params&#34;&gt;  [in, optional] HANDLE                hTemplateFile&lt;/span&gt;&lt;/span&gt;
&lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-params&#34;&gt;)&lt;/span&gt;&lt;/span&gt;;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Now, on the client, insert the server Named Pipe you want to connect to in the &lt;strong&gt;lpFileName&lt;/strong&gt; argument, run the &lt;code&gt;CreateFile&lt;/code&gt; function, and you will be able to communicate with the Named Pipe. Communication uses the &lt;code&gt;ReadFile&lt;/code&gt;, &lt;code&gt;WriteFile&lt;/code&gt; functions just like Anonymous Pipe.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;hljs cpp&#34;&gt;&lt;span class=&#34;hljs-function&#34;&gt;BOOL &lt;span class=&#34;hljs-title&#34;&gt;WaitNamedPipe&lt;/span&gt;&lt;span class=&#34;hljs-params&#34;&gt;(&lt;/span&gt;&lt;/span&gt;
&lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-params&#34;&gt;  [in] LPCSTR lpNamedPipeName,&lt;/span&gt;&lt;/span&gt;
&lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-params&#34;&gt;  [in] DWORD  nTimeOut&lt;/span&gt;&lt;/span&gt;
&lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-params&#34;&gt;)&lt;/span&gt;&lt;/span&gt;;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;If a client sends a request for a Pipe connection via the &lt;code&gt;CreateFile&lt;/code&gt; function, but the server Pipe instance is full, the &lt;code&gt;WaitNamedPipe&lt;/code&gt; function can wait for the value of the &lt;strong&gt;nTimeOut&lt;/strong&gt; argument.&lt;/p&gt;
&lt;p&gt;If the &lt;strong&gt;nTimeOut&lt;/strong&gt; argument is set to the default value, the &lt;code&gt;CreateNamedPipe&lt;/code&gt; function will wait as long as the &lt;strong&gt;nDefaultTimeOut&lt;/strong&gt; value.&lt;/p&gt;
&lt;p&gt;So far, we&amp;#x2019;ve seen what the names mean for Anonymous and Named Pipes, and how to create and use them in code. I think you should have no problem understanding the Windows Pipe code if you know the functions above!&lt;/p&gt;
&lt;h2 id=&#34;Windows-Named-pipe&#34;&gt;&lt;a href=&#34;#Windows-Named-pipe&#34; class=&#34;headerlink&#34; title=&#34;Windows Named pipe&#34;&gt;&lt;/a&gt;Windows Named pipe&lt;/h2&gt;&lt;p&gt;Now let&amp;#x2019;s dive into Named Pipes in earnest!&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/2025/05/12/ogu123/NamedPipe/EN/8.png&#34; alt&gt;&lt;/p&gt;
&lt;p&gt;Pipes created using the &lt;code&gt;CreatePipe&lt;/code&gt; or &lt;code&gt;CreateNamedPipe&lt;/code&gt; functions are created in the kernel area and behave like a kind of shared memory. Windows treats this shared memory as a File Object, which is why you can see in the figure above that the Pipe is a File Object.&lt;/p&gt;
&lt;p&gt;Therefore, when you send or receive data through a Pipe, you are using file-specific APIs like &lt;code&gt;ReadFile&lt;/code&gt; or &lt;code&gt;WriteFile&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;In the case of Named Pipes, remote and local processes can connect through the name of the Pipe. Here&amp;#x2019;s a look at the basic structure of a Pipe name.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;hljs cpp&#34;&gt;\\ServerName\pipe\PipeName&lt;/code&gt;&lt;/pre&gt;
&lt;ul&gt;
&lt;li&gt;Server-side: &lt;code&gt;\\\\.\\pipe\\ogu123&lt;/code&gt;&lt;ul&gt;
&lt;li&gt;Since the server is creating the pipe on its own machine, you can use a .(dot) in the server name and the name of the pipe being created (&lt;code&gt;ogu123&lt;/code&gt;) as the lpName argument to the &lt;code&gt;CreateNamedPipe&lt;/code&gt; function.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Client side: &lt;code&gt;\\\\.\\pipe\\ogu123&lt;/code&gt; or &lt;code&gt;\\\\ComputerName\\pipe\\ogu123&lt;/code&gt;&lt;ul&gt;
&lt;li&gt;If the pipe you want to connect to exists on the local machine, use &lt;code&gt;\\\\.\\pipe\\ogu123&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;If the pipe you want to connect to exists on the remote computer, use &lt;code&gt;\\\\ComputerName\\pipe\\ogu123&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img src=&#34;/2025/05/12/ogu123/NamedPipe/EN/9.png&#34; alt&gt;&lt;/p&gt;
&lt;p&gt;So far, we&amp;#x2019;ve checked the location of the Pipe in memory and looked at the Pipe name structure.&lt;/p&gt;
&lt;p&gt;If we create a Pipe on the server side via &lt;code&gt;\\\\.\\pipe\\ogu123&lt;/code&gt;, let&amp;#x2019;s see where the &lt;code&gt;ogu123&lt;/code&gt; Pipe is actually created.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/2025/05/12/ogu123/NamedPipe/EN/10.png&#34; alt&gt;&lt;/p&gt;
&lt;p&gt;NamedPipeServer.exe creates the &lt;code&gt;ogu123&lt;/code&gt; Pipe. If we check the NamedPipeServer.exe process handle with Process Explorer, we can see that it has a Named Pipe handle named &lt;code&gt;ogu123&lt;/code&gt;, as shown above.&lt;/p&gt;
&lt;p&gt;The strange thing here is that we created the Pipe at the path &lt;code&gt;\\\\.\\pipe\\ogu123&lt;/code&gt;, but it was actually created at &lt;code&gt;\\Device\\NamedPipe\\ogu123&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/2025/05/12/ogu123/NamedPipe/EN/11.png&#34; alt&gt;&lt;/p&gt;
&lt;p&gt;This can be seen by looking at the WinObj and seeing that &lt;code&gt;\\\\.\\pipe&lt;/code&gt; is symlinked to the path &lt;code&gt;\\Device\\NamedPipe&lt;/code&gt;, which creates the Pipe &lt;code&gt;\\Device\\NamedPipe\\ogu123&lt;/code&gt;.&lt;/p&gt;
&lt;h2 id=&#34;Find-Named-pipe-vulnerabilities&#34;&gt;&lt;a href=&#34;#Find-Named-pipe-vulnerabilities&#34; class=&#34;headerlink&#34; title=&#34;Find Named pipe vulnerabilities&#34;&gt;&lt;/a&gt;Find Named pipe vulnerabilities&lt;/h2&gt;&lt;p&gt;Now let&amp;#x2019;s dive into the process of finding vulnerabilities in Named Pipes!&lt;/p&gt;
&lt;p&gt;We&amp;#x2019;ll cover two exercises, the first to find them using Process Explorer, accesschk, IDA, etc. and the second to exploit them using the Client Impersonation technique!&lt;/p&gt;
&lt;p&gt;For the first lab, I used the code from &lt;a href=&#34;https://github.com/VerSprite/research/tree/master/projects/cpp/VulnerableApps/WindowsPipes&#34;&gt;link&lt;/a&gt; with some minor modifications.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/2025/05/12/ogu123/NamedPipe/EN/12.png&#34; alt&gt;&lt;/p&gt;
&lt;p&gt;First, enable the handle option in Process Explorer, and then check the handle value of the target process running with elevated privileges.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/2025/05/12/ogu123/NamedPipe/EN/13.png&#34; alt&gt;&lt;/p&gt;
&lt;p&gt;You can see that the target process (NamedPipeServer.exe) is running as administrator and that the ogu123 Pipe exists.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/2025/05/12/ogu123/NamedPipe/EN/14.png&#34; alt&gt;&lt;/p&gt;
&lt;p&gt;You can now check the DACLs of all Named Pipes under \.\pipe\ with accesschk&amp;#x2019;s &lt;code&gt;accesschk.exe \\pipe\\&lt;/code&gt; command.&lt;/p&gt;
&lt;p&gt;In the figure above, we can see that the ogu123 Pipe has RW permissions for the Everyone group, which means that the target process Named Pipe can be connected to and read/written by normal users.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/2025/05/12/ogu123/NamedPipe/EN/15.png&#34; alt&gt;&lt;/p&gt;
&lt;p&gt;Now we just need to find the server-side Named Pipe creation part through IDA and find the point in the process of communicating with the client that will trigger the LPE.&lt;/p&gt;
&lt;p&gt;First, you can find the server-side Named Pipe creation part by using IDA Imports or string search to find the functions shown above (including &lt;code&gt;CreateNamedPipeW()&lt;/code&gt;).&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/2025/05/12/ogu123/NamedPipe/EN/16.png&#34; alt&gt;&lt;/p&gt;
&lt;p&gt;We see that the target process uses the &lt;code&gt;CreateNamedPipeW&lt;/code&gt; function, and if we follow where it uses that function, we see that the&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/2025/05/12/ogu123/NamedPipe/EN/17.png&#34; alt&gt;&lt;/p&gt;
&lt;p&gt;You can see where to create the ogu123 Pipe. Now, after creating the Pipe, all you need to do is read the connected client messages on the server side and look for vectors that might trigger the LPE vulnerability! Simple, right?&lt;/p&gt;
&lt;h3 id=&#34;Client-Impersonation-Techniques&#34;&gt;&lt;a href=&#34;#Client-Impersonation-Techniques&#34; class=&#34;headerlink&#34; title=&#34;Client Impersonation Techniques&#34;&gt;&lt;/a&gt;Client Impersonation Techniques&lt;/h3&gt;&lt;p&gt;The Client Impersonation technique is a way for the server to obtain client authorization to perform LPE once it is connected to the client.&lt;/p&gt;
&lt;p&gt;First, the server must obtain client authorization to perform impersonation, which is stored in the Access Token. The Access Token needs to be able to control &amp;#x201C;&lt;strong&gt;what the server can do with my information&lt;/strong&gt;&amp;#x201D;, which is where the Impersonation Level comes in.&lt;/p&gt;
&lt;div class=&#34;table-container&#34;&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;SECURITY_IMPERSONATION_LEVEL&lt;/th&gt;
&lt;th&gt;Description&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;SecurityAnonymous&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;The server cannot impersonate or identify the client.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;SecurityIdentification&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;The server can get the identity and privileges of the client, but cannot impersonate the client.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;SecurityImpersonation&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;The server can impersonate the client&amp;#x2019;s security context on the local system.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;SecurityDelegation&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;The server can impersonate the client&amp;#x2019;s security context on remote systems.&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;/div&gt;
&lt;p&gt;There are two types of access tokens: primary tokens and impersonation tokens, which we&amp;#x2019;ll describe as processes and threads!&lt;/p&gt;
&lt;p&gt;In Windows, every process has an Access Token, where the process token uses the Primary Token and does not change until the process is terminated.&lt;/p&gt;
&lt;p&gt;A thread can have two values, a Primary Token and an Impersonation Token, and it shares the Primary Token value of the process.&lt;/p&gt;
&lt;p&gt;A thread can use the Access Token of another account instead of the Primary Token when it is created, and the token it uses is the Impersonation Token! This means that the thread always references the Primary Token and only has an Impersonation Token when it is in impersonation.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;hljs cpp&#34;&gt;CreateFile(
    &lt;span class=&#34;hljs-string&#34;&gt;L&amp;quot;Local pipe path or remote pipe path&amp;quot;&lt;/span&gt;,
    GENERIC_READ | GENERIC_WRITE,
    &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;,
    &lt;span class=&#34;hljs-literal&#34;&gt;NULL&lt;/span&gt;,
    OPEN_EXISTING,
    SECURITY_SQOS_PRESENT | SECURITY_IMPERSONATION, &lt;span class=&#34;hljs-comment&#34;&gt;// or SECURITY_DELEGATION&lt;/span&gt;
    &lt;span class=&#34;hljs-literal&#34;&gt;NULL&lt;/span&gt;
);&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Let&amp;#x2019;s take a closer look at the LPE method with Client Impersonation!&lt;/p&gt;
&lt;p&gt;When the target service or program calls &lt;code&gt;CreateFile()&lt;/code&gt;, instead of the normal file path, it connects to the attacker&amp;#x2019;s Named Pipe! The 6th argument of the &lt;code&gt;CreateFile()&lt;/code&gt; function must have the value SECURITY_SQOS_PRESENT | SECURITY_IMPERSONATION or SECURITY_DELEGATION as shown above.&lt;/p&gt;
&lt;p&gt;For remote pipes, SECURITY_IMPERSONATION is said to be enforced even if only SECURITY_SQOS_PRESENT is present.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;hljs cpp&#34;&gt;&lt;span class=&#34;hljs-comment&#34;&gt;// Create a server named pipe&lt;/span&gt;
serverPipe = CreateNamedPipe(
    pipeName,           &lt;span class=&#34;hljs-comment&#34;&gt;// name of our pipe, must be in the form of \\.\pipe\&amp;lt;NAME&amp;gt;&lt;/span&gt;
    PIPE_ACCESS_DUPLEX, &lt;span class=&#34;hljs-comment&#34;&gt;// The rest of the parameters don&amp;apos;t really matter&lt;/span&gt;
    PIPE_TYPE_MESSAGE,	&lt;span class=&#34;hljs-comment&#34;&gt;// as all you want is impersonate the client...&lt;/span&gt;
    &lt;span class=&#34;hljs-number&#34;&gt;1&lt;/span&gt;,		&lt;span class=&#34;hljs-comment&#34;&gt;// &lt;/span&gt;
    &lt;span class=&#34;hljs-number&#34;&gt;2048&lt;/span&gt;,	&lt;span class=&#34;hljs-comment&#34;&gt;// &lt;/span&gt;
    &lt;span class=&#34;hljs-number&#34;&gt;2048&lt;/span&gt;,	&lt;span class=&#34;hljs-comment&#34;&gt;// &lt;/span&gt;
    &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;,		&lt;span class=&#34;hljs-comment&#34;&gt;// &lt;/span&gt;
    &lt;span class=&#34;hljs-literal&#34;&gt;NULL&lt;/span&gt;	&lt;span class=&#34;hljs-comment&#34;&gt;// This should ne NULL so every client can connect&lt;/span&gt;
);
&lt;span class=&#34;hljs-comment&#34;&gt;// wait for pipe connections&lt;/span&gt;
BOOL bPipeConnected = ConnectNamedPipe(serverPipe, &lt;span class=&#34;hljs-literal&#34;&gt;NULL&lt;/span&gt;);
&lt;span class=&#34;hljs-comment&#34;&gt;// Impersonate client&lt;/span&gt;
BOOL bImpersonated = ImpersonateNamedPipeClient(serverPipe);
&lt;span class=&#34;hljs-comment&#34;&gt;// if successful open Thread token - your current thread token is now the client&amp;apos;s token&lt;/span&gt;
BOOL bSuccess = OpenThreadToken(GetCurrentThread(), TOKEN_ALL_ACCESS, FALSE, &amp;amp;hToken);
&lt;span class=&#34;hljs-comment&#34;&gt;// now you got the client token saved in hToken and you can safeyl revert back to self&lt;/span&gt;
bSuccess = RevertToSelf();
&lt;span class=&#34;hljs-comment&#34;&gt;// Now duplicate the client&amp;apos;s token to get a Primary token&lt;/span&gt;
bSuccess = DuplicateTokenEx(hToken,
    TOKEN_ALL_ACCESS,
    &lt;span class=&#34;hljs-literal&#34;&gt;NULL&lt;/span&gt;,
    SecurityImpersonation,
    TokenPrimary,
    &amp;amp;hDuppedToken
);
&lt;span class=&#34;hljs-comment&#34;&gt;// If that succeeds you got a Primary token as hDuppedToken and you can create a proccess with that token&lt;/span&gt;
CreateProcessWithTokenW(hDuppedToken, LOGON_WITH_PROFILE, command, &lt;span class=&#34;hljs-literal&#34;&gt;NULL&lt;/span&gt;, CREATE_NEW_CONSOLE, &lt;span class=&#34;hljs-literal&#34;&gt;NULL&lt;/span&gt;, &lt;span class=&#34;hljs-literal&#34;&gt;NULL&lt;/span&gt;, &amp;amp;si, &amp;amp;pi);&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Once the target client is connected to the attacker&amp;#x2019;s Named Pipe server, the server can LPE with client privileges via the above code. Let&amp;#x2019;s take a look at the main functions.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;ImpersonateNamedPipeClient()&lt;/code&gt; : Applies the client Impersonation Token to the server thread. The Impersonation Token used is the token for applying the client&amp;#x2019;s Primary Token to the thread.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;RetrieveToSelf()&lt;/code&gt;: Terminates the Impersonation. It must be executed before the &lt;code&gt;CreateProcessWithTokenW()&lt;/code&gt; function is called to avoid errors.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;DuplicateTokenEx()&lt;/code&gt; : Duplicates the client Impersonation Token obtained earlier as the Primary Token for use in the process.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;CreateProcessWithTokenW()&lt;/code&gt; : Creates a process with client privileges through the Primary Token token. &amp;#x2192; LPE occurs!&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;Conclusion&#34;&gt;&lt;a href=&#34;#Conclusion&#34; class=&#34;headerlink&#34; title=&#34;Conclusion&#34;&gt;&lt;/a&gt;&lt;strong&gt;Conclusion&lt;/strong&gt;&lt;/h2&gt;&lt;p&gt;In this article, we took a deep dive into Windows IPC and Named Pipes! Writing this article reminded me that there are a lot of Windows Attack Vectors out there.&lt;/p&gt;
&lt;p&gt;Thanks for reading this long post!&lt;/p&gt;
&lt;h2 id=&#34;Reference&#34;&gt;&lt;a href=&#34;#Reference&#34; class=&#34;headerlink&#34; title=&#34;Reference&#34;&gt;&lt;/a&gt;&lt;strong&gt;Reference&lt;/strong&gt;&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;&amp;#xC708;&amp;#xB3C4;&amp;#xC6B0; &amp;#xC2DC;&amp;#xC2A4;&amp;#xD15C; &amp;#xD504;&amp;#xB85C;&amp;#xADF8;&amp;#xB798;&amp;#xBC0D;&lt;/li&gt;
&lt;li&gt;&amp;#xB1CC;&amp;#xB97C; &amp;#xC790;&amp;#xADF9;&amp;#xD558;&amp;#xB294; &amp;#xC708;&amp;#xB3C4;&amp;#xC6B0;&amp;#xC988; &amp;#xC2DC;&amp;#xC2A4;&amp;#xD15C; &amp;#xD504;&amp;#xB85C;&amp;#xADF8;&amp;#xB798;&amp;#xBC0D;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.baeldung.com/cs/pipes-vs-sockets&#34;&gt;https://www.baeldung.com/cs/pipes-vs-sockets&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.codeproject.com/Articles/13724/Windows-IPC&#34;&gt;https://www.codeproject.com/Articles/13724/Windows-IPC&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://versprite.com/vs-labs/microsoft-windows-pipes-intro/&#34;&gt;https://versprite.com/vs-labs/microsoft-windows-pipes-intro/&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://versprite.com/vs-labs/vulnerable-named-pipe-application/&#34;&gt;https://versprite.com/vs-labs/vulnerable-named-pipe-application/&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://csandker.io/2021/01/10/Offensive-Windows-IPC-1-NamedPipes.html&#34;&gt;https://csandker.io/2021/01/10/Offensive-Windows-IPC-1-NamedPipes.html&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
 - hack &amp; life">
  <meta property="og:image" content="https://hackyboiz.github.io/2025/05/12/ogu123/NamedPipe/EN/1.png">
  <meta property="og:url" content="https://hackyboiz.github.io/">

  <link rel="canonical" href="https://hackyboiz.github.io/2025/05/12/ogu123/namedpipe/en/">

  <title>[Research] Windows Named Pipe (EN) - hackyboiz</title>

  <link rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/4.4.1/css/bootstrap.min.css">


  <link rel="stylesheet" href="https://cdn.staticfile.org/github-markdown-css/4.0.0/github-markdown.min.css">
  <link rel="stylesheet" href="/lib/hint/hint.min.css">

  
    
    <link rel="stylesheet" href="https://cdn.staticfile.org/highlight.js/10.0.0/styles/github-gist.min.css">
  

  


<!-- 主题依赖的图标库，不要自行修改 -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_6peoq002giu.css">
<link rel="stylesheet" href="/.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_pjno9b9zyxs.css">
<link rel="stylesheet" href="/.css">


<link rel="stylesheet" href="/css/main.css">

<!-- 自定义样式保持在最底部 -->


  <script src="/js/utils.js"></script>
  <script src="/js/color-schema.js"></script>

<meta name="generator" content="Hexo 5.1.1"><link rel="alternate" href="/rss2.xml" title="hackyboiz" type="application/rss+xml">
</head>


<body>
  <header style="height: 40vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">&nbsp;<strong>Hackyboiz</strong>&nbsp;</a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                Home
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                Archives
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                Categories
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                Tags
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-addrcard"></i>
                About
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/author/">
                <i class="iconfont icon-user-fill"></i>
                Author
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" data-toggle="modal" data-target="#modalSearch">&nbsp;<i class="iconfont icon-search"></i>&nbsp;</a>
          </li>
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" href="javascript:">&nbsp;<i class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="banner intro-2" id="background" parallax="true" style="background: url('/img/default.png') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="container page-header text-center fade-in-up">
            <span class="h2" id="subtitle">
              
            </span>

            
              
  <div class="mt-3 post-meta">
    <i class="iconfont icon-date-fill" aria-hidden="true"></i>
    <time datetime="2025-05-12 21:00" pubdate>
      2025년 5월 12일 오후
    </time>
  </div>


<div class="mt-1">
  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      2.6k 자
    </span>
  

  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      52
       분
    </span>
  

  
  
</div>

            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid">
  <div class="row">
    <div class="d-none d-lg-block col-lg-2">
      <!--<script data-ad-client="ca-pub-3672652207808168" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>-->
    </div>
    <div class="col-lg-8 nopadding-md">
      <div class="container nopadding-md" id="board-ctn">
        <div class="py-5" id="board">
          <article class="post-content mx-auto" id="post">
            <!-- SEO header -->
            <h1 style="display: none">[Research] Windows Named Pipe (EN)</h1>
                       
            <div class="markdown-body" id="post-body">
              <!-- <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>-->
              <!-- hackyboiz_horizen_index -->
              <!--
              <ins class="adsbygoogle"
                   style="display:block"
                   data-ad-client="ca-pub-3672652207808168"
                   data-ad-slot="8887862313"
                   data-ad-format="auto"
                   data-full-width-responsive="true"></ins>
              <script>
                   (adsbygoogle = window.adsbygoogle || []).push({});
              </script>
              -->
              <h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><p>Hi, this is ogu123!!!</p>
<p>Today we&#x2019;re going to talk about Windows Named Pipes!</p>
<p>Until now, IPC is a way to communicate between processes~ &#x2190; I&#x2019;ve known about it in a vague way&#x2026;</p>
<p>This time, we&#x2019;re going to learn more about Named Pipe, one of the many IPCs!</p>
<p><del>(What Tungx9 Sahur is holding is a Pipe.)</del></p>
<p><img src="/2025/05/12/ogu123/NamedPipe/EN/1.png" srcset="/img/loading.gif" alt></p>
<h2 id="Windows-IPC"><a href="#Windows-IPC" class="headerlink" title="Windows IPC"></a>Windows IPC</h2><p>First, let&#x2019;s talk about Inter Process Communication (IPC), which is a method that allows processes to communicate with each other!</p>
<p>Below are the different IPC methods used by Windows.</p>
<ul>
<li>Shared Memory</li>
<li>Mail Slot</li>
<li>Component Object Model (COM)</li>
<li>Pipe</li>
</ul>
<p>Here I was wondering, why do we need to communicate between processes and what are the advantages?</p>
<p><img src="/2025/05/12/ogu123/NamedPipe/EN/2.png" srcset="/img/loading.gif" alt></p>
<p>First, processes are created individually, as shown in the image above, so they don&#x2019;t have access to each other! This is called an <strong>Independent Process</strong>.</p>
<p>However, in complex situations, processes need to exchange state values or data with each other! Let&#x2019;s explain this with a simple example.</p>
<p><img src="/2025/05/12/ogu123/NamedPipe/EN/3.png" srcset="/img/loading.gif" alt></p>
<p>Let&#x2019;s say you&#x2019;re downloading a file in a web browser! The browser has two processes running: one that displays the download progress on the screen, as shown in the figure, and one that downloads the actual file data.</p>
<p>The download process needs to send progress information to the screen process, such as &#x201C;<strong>Now 70% downloaded!</strong>&#x201D; so that the user can see the progress bar, and the screen process needs to tell the download process &#x201C;<strong>You pressed the stop button!</strong>&#x201D; so that the download stops.</p>
<p>When processes communicate with each other by sending and receiving state values or data, as in the example above, they are called co-operating processes, and the advantages of doing so are that they can share resources to work more efficiently, and parallel processing makes programs run faster and more efficiently.</p>
<p>However, it increases system complexity and requires thorough design as it can introduce vulnerabilities and synchronization issues when reading/writing data.</p>
<h2 id="Windows-IPC-Pipe"><a href="#Windows-IPC-Pipe" class="headerlink" title="Windows IPC Pipe"></a>Windows IPC Pipe</h2><p>Now that we&#x2019;ve covered what IPC is and why we use it, let&#x2019;s take a look at the different Windows IPC techniques and learn about Pipe.</p>
<p>First of all, there are two types of pipes: Anonymous Pipes and Named Pipes. The literal translation is an unnamed pipe and a named pipe&#x2026; which makes no sense at all, but let&#x2019;s see what we mean by names first!</p>
<p><img src="/2025/05/12/ogu123/NamedPipe/EN/4.png" srcset="/img/loading.gif" alt></p>
<p>For Anonymous and named pipes, think of <strong>name as the address of the pipe</strong>!</p>
<p>If the pipe has an address, other processes or remote processes can access it, and conversely, if it doesn&#x2019;t have an address, other processes can&#x2019;t access it!</p>
<p>Excuse me? Pipe is one of the IPCs, but how does it make sense that other processes can&#x2019;t access it&#x2026; &#x2190; We&#x2019;ll explain this in the Anonymous Pipe section later on lol.</p>
<p>So what does the address of a pipe refer to? It depends on the local pipe and the remote pipe, but for the remote pipe, we use the <strong>computer name</strong> to identify the PC on the network. You can find your computer name in your system properties, as shown above!</p>
<p>To summarize, we already knew that Named Pipes have no limitations on the range of communication (remote, local) due to the existence of a pipe address, and Anonymous Pipes have no limitations on the range of communication (remote, local), which we&#x2019;ll take a closer look at just below!</p>
<h3 id="Anonymous-Pipe"><a href="#Anonymous-Pipe" class="headerlink" title="Anonymous Pipe"></a>Anonymous Pipe</h3><p><img src="/2025/05/12/ogu123/NamedPipe/EN/5.png" srcset="/img/loading.gif" alt></p>
<p>First, Anonymous Pipes are <strong>one-way</strong> in nature. When a Pipe is created via the <code>CreatePipe</code> function below, it returns a handle (hReadPipe, hWritePipe) for two processes to do their respective operations (Read/Write), since it is a one-way communication.</p>
<pre><code class="hljs cpp"><span class="hljs-function">BOOL <span class="hljs-title">CreatePipe</span><span class="hljs-params">(</span></span>
<span class="hljs-function"><span class="hljs-params">  [out]          PHANDLE               hReadPipe,</span></span>
<span class="hljs-function"><span class="hljs-params">  [out]          PHANDLE               hWritePipe,</span></span>
<span class="hljs-function"><span class="hljs-params">  [in, optional] LPSECURITY_ATTRIBUTES lpPipeAttributes,</span></span>
<span class="hljs-function"><span class="hljs-params">  [in]           DWORD                 nSize</span></span>
<span class="hljs-function"><span class="hljs-params">)</span></span>;</code></pre>
<p>When you said above that Anonymous Pipes are not accessible to other processes, what do you mean by &#x201C;<strong>two processes return handles (hReadPipe, hWritePipe) for each to do their own operations (Read/Write)</strong>&#x201D;&#x2026;? The bottom line is that Anonymous Pipes are used to communicate between processes in a parent-child relationship!</p>
<pre><code class="hljs cpp"><span class="hljs-function">BOOL <span class="hljs-title">CreateProcess</span><span class="hljs-params">(</span></span>
<span class="hljs-function"><span class="hljs-params">  [in, optional]      LPCSTR                lpApplicationName,</span></span>
<span class="hljs-function"><span class="hljs-params">  [in, out, optional] LPSTR                 lpCommandLine,</span></span>
<span class="hljs-function"><span class="hljs-params">  [in, optional]      LPSECURITY_ATTRIBUTES lpProcessAttributes,</span></span>
<span class="hljs-function"><span class="hljs-params">  [in, optional]      LPSECURITY_ATTRIBUTES lpThreadAttributes,</span></span>
<span class="hljs-function"><span class="hljs-params">  [in]                BOOL                  bInheritHandles,</span></span>
<span class="hljs-function"><span class="hljs-params">  [in]                DWORD                 dwCreationFlags,</span></span>
<span class="hljs-function"><span class="hljs-params">  [in, optional]      LPVOID                lpEnvironment,</span></span>
<span class="hljs-function"><span class="hljs-params">  [in, optional]      LPCSTR                lpCurrentDirectory,</span></span>
<span class="hljs-function"><span class="hljs-params">  [in]                LPSTARTUPINFOA        lpStartupInfo,</span></span>
<span class="hljs-function"><span class="hljs-params">  [out]               LPPROCESS_INFORMATION lpProcessInformation</span></span>
<span class="hljs-function"><span class="hljs-params">)</span></span>;</code></pre>
<p>Create a Pipe with the <code>CreatePipe</code> function in the parent process and create a child process by setting the value of the <code>CreateProcess</code> function bInheritHandles argument to True.</p>
<p>This allows the parent process handle table to be inherited and used by the child process, so it can communicate with the Anonymous Pipe. The communication here uses the <code>ReadFile</code> and <code>WriteFile</code> functions.</p>
<p>If we wanted to have two-way communication, we could create two pipes, right?</p>
<p>Organizing an Anonymous Pipe means that other processes can&#x2019;t access it because it doesn&#x2019;t have a name, but child processes can access it through handle table inheritance, so Anonymous Pipe can be used for parent-child process communication.</p>
<h3 id="Named-Pipe"><a href="#Named-Pipe" class="headerlink" title="Named Pipe"></a>Named Pipe</h3><p><img src="/2025/05/12/ogu123/NamedPipe/EN/6.png" srcset="/img/loading.gif" alt></p>
<p>Named Pipes are bi-directional in nature. The server is the one who creates the pipe, and the client is the one who uses the created pipe. Let&#x2019;s take a look at the functions that are important when using Named Pipes!</p>
<p>Check out the image above and the code below for a better understanding!</p>
<pre><code class="hljs cpp">hPipe = HANDLE CreateNamedPipe(
  [in]           LPCSTR                lpName,
  [in]           DWORD                 dwOpenMode,
  [in]           DWORD                 dwPipeMode,
  [in]           DWORD                 nMaxInstances,
  [in]           DWORD                 nOutBufferSize,
  [in]           DWORD                 nInBufferSize,
  [in]           DWORD                 nDefaultTimeOut,
  [in, optional] LPSECURITY_ATTRIBUTES lpSecurityAttributes
);</code></pre>
<p>First, we create a Pipe on the server with the <code>CreateNamedPipe</code> function. This is a two-way communication, so it returns a single handle to the server.</p>
<p>Here, the <strong>lpName</strong> argument is the name of the Pipe being created, which can also be set to Half-Duplex (server &#x2192; client, server &#x2190; client) via the <strong>dwOpenMode</strong> argument.</p>
<p>The <strong>nMaxInstances</strong> argument is the number of Pipe instances that will be created. If the value is 3, then up to 3 Pipes with the same name can be created and thus connected to a total of 3 clients.</p>
<p><img src="/2025/05/12/ogu123/NamedPipe/EN/7.png" srcset="/img/loading.gif" alt></p>
<p>PipeList allows you to see the named pipes in your system.</p>
<p>If a Pipe with a Max Instances value of 1 receives requests from multiple clients, they will be associated with one Pipe and the remaining clients will be put into a waiting state. The amount of time the clients wait can be set by the <strong>nDefaultTimeOut</strong> argument.</p>
<pre><code class="hljs cpp">ConnectNamedPipe(hPipe, <span class="hljs-literal">NULL</span>);</code></pre>
<p>After creating a Pipe on the server, the <code>ConnectNamedPipe</code> function puts the Pipe in a <strong>connect-waiting state</strong> so that it can be accessed by other processes, both remote and local. Think of it as exposing the Pipe to the outside world!</p>
<pre><code class="hljs cpp"><span class="hljs-function">HANDLE <span class="hljs-title">CreateFile</span><span class="hljs-params">(</span></span>
<span class="hljs-function"><span class="hljs-params">  [in]           LPCSTR                lpFileName,</span></span>
<span class="hljs-function"><span class="hljs-params">  [in]           DWORD                 dwDesiredAccess,</span></span>
<span class="hljs-function"><span class="hljs-params">  [in]           DWORD                 dwShareMode,</span></span>
<span class="hljs-function"><span class="hljs-params">  [in, optional] LPSECURITY_ATTRIBUTES lpSecurityAttributes,</span></span>
<span class="hljs-function"><span class="hljs-params">  [in]           DWORD                 dwCreationDisposition,</span></span>
<span class="hljs-function"><span class="hljs-params">  [in]           DWORD                 dwFlagsAndAttributes,</span></span>
<span class="hljs-function"><span class="hljs-params">  [in, optional] HANDLE                hTemplateFile</span></span>
<span class="hljs-function"><span class="hljs-params">)</span></span>;</code></pre>
<p>Now, on the client, insert the server Named Pipe you want to connect to in the <strong>lpFileName</strong> argument, run the <code>CreateFile</code> function, and you will be able to communicate with the Named Pipe. Communication uses the <code>ReadFile</code>, <code>WriteFile</code> functions just like Anonymous Pipe.</p>
<pre><code class="hljs cpp"><span class="hljs-function">BOOL <span class="hljs-title">WaitNamedPipe</span><span class="hljs-params">(</span></span>
<span class="hljs-function"><span class="hljs-params">  [in] LPCSTR lpNamedPipeName,</span></span>
<span class="hljs-function"><span class="hljs-params">  [in] DWORD  nTimeOut</span></span>
<span class="hljs-function"><span class="hljs-params">)</span></span>;</code></pre>
<p>If a client sends a request for a Pipe connection via the <code>CreateFile</code> function, but the server Pipe instance is full, the <code>WaitNamedPipe</code> function can wait for the value of the <strong>nTimeOut</strong> argument.</p>
<p>If the <strong>nTimeOut</strong> argument is set to the default value, the <code>CreateNamedPipe</code> function will wait as long as the <strong>nDefaultTimeOut</strong> value.</p>
<p>So far, we&#x2019;ve seen what the names mean for Anonymous and Named Pipes, and how to create and use them in code. I think you should have no problem understanding the Windows Pipe code if you know the functions above!</p>
<h2 id="Windows-Named-pipe"><a href="#Windows-Named-pipe" class="headerlink" title="Windows Named pipe"></a>Windows Named pipe</h2><p>Now let&#x2019;s dive into Named Pipes in earnest!</p>
<p><img src="/2025/05/12/ogu123/NamedPipe/EN/8.png" srcset="/img/loading.gif" alt></p>
<p>Pipes created using the <code>CreatePipe</code> or <code>CreateNamedPipe</code> functions are created in the kernel area and behave like a kind of shared memory. Windows treats this shared memory as a File Object, which is why you can see in the figure above that the Pipe is a File Object.</p>
<p>Therefore, when you send or receive data through a Pipe, you are using file-specific APIs like <code>ReadFile</code> or <code>WriteFile</code>.</p>
<p>In the case of Named Pipes, remote and local processes can connect through the name of the Pipe. Here&#x2019;s a look at the basic structure of a Pipe name.</p>
<pre><code class="hljs cpp">\\ServerName\pipe\PipeName</code></pre>
<ul>
<li>Server-side: <code>\\\\.\\pipe\\ogu123</code><ul>
<li>Since the server is creating the pipe on its own machine, you can use a .(dot) in the server name and the name of the pipe being created (<code>ogu123</code>) as the lpName argument to the <code>CreateNamedPipe</code> function.</li>
</ul>
</li>
<li>Client side: <code>\\\\.\\pipe\\ogu123</code> or <code>\\\\ComputerName\\pipe\\ogu123</code><ul>
<li>If the pipe you want to connect to exists on the local machine, use <code>\\\\.\\pipe\\ogu123</code></li>
<li>If the pipe you want to connect to exists on the remote computer, use <code>\\\\ComputerName\\pipe\\ogu123</code></li>
</ul>
</li>
</ul>
<p><img src="/2025/05/12/ogu123/NamedPipe/EN/9.png" srcset="/img/loading.gif" alt></p>
<p>So far, we&#x2019;ve checked the location of the Pipe in memory and looked at the Pipe name structure.</p>
<p>If we create a Pipe on the server side via <code>\\\\.\\pipe\\ogu123</code>, let&#x2019;s see where the <code>ogu123</code> Pipe is actually created.</p>
<p><img src="/2025/05/12/ogu123/NamedPipe/EN/10.png" srcset="/img/loading.gif" alt></p>
<p>NamedPipeServer.exe creates the <code>ogu123</code> Pipe. If we check the NamedPipeServer.exe process handle with Process Explorer, we can see that it has a Named Pipe handle named <code>ogu123</code>, as shown above.</p>
<p>The strange thing here is that we created the Pipe at the path <code>\\\\.\\pipe\\ogu123</code>, but it was actually created at <code>\\Device\\NamedPipe\\ogu123</code>.</p>
<p><img src="/2025/05/12/ogu123/NamedPipe/EN/11.png" srcset="/img/loading.gif" alt></p>
<p>This can be seen by looking at the WinObj and seeing that <code>\\\\.\\pipe</code> is symlinked to the path <code>\\Device\\NamedPipe</code>, which creates the Pipe <code>\\Device\\NamedPipe\\ogu123</code>.</p>
<h2 id="Find-Named-pipe-vulnerabilities"><a href="#Find-Named-pipe-vulnerabilities" class="headerlink" title="Find Named pipe vulnerabilities"></a>Find Named pipe vulnerabilities</h2><p>Now let&#x2019;s dive into the process of finding vulnerabilities in Named Pipes!</p>
<p>We&#x2019;ll cover two exercises, the first to find them using Process Explorer, accesschk, IDA, etc. and the second to exploit them using the Client Impersonation technique!</p>
<p>For the first lab, I used the code from <a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/VerSprite/research/tree/master/projects/cpp/VulnerableApps/WindowsPipes">link</a> with some minor modifications.</p>
<p><img src="/2025/05/12/ogu123/NamedPipe/EN/12.png" srcset="/img/loading.gif" alt></p>
<p>First, enable the handle option in Process Explorer, and then check the handle value of the target process running with elevated privileges.</p>
<p><img src="/2025/05/12/ogu123/NamedPipe/EN/13.png" srcset="/img/loading.gif" alt></p>
<p>You can see that the target process (NamedPipeServer.exe) is running as administrator and that the ogu123 Pipe exists.</p>
<p><img src="/2025/05/12/ogu123/NamedPipe/EN/14.png" srcset="/img/loading.gif" alt></p>
<p>You can now check the DACLs of all Named Pipes under \.\pipe\ with accesschk&#x2019;s <code>accesschk.exe \\pipe\\</code> command.</p>
<p>In the figure above, we can see that the ogu123 Pipe has RW permissions for the Everyone group, which means that the target process Named Pipe can be connected to and read/written by normal users.</p>
<p><img src="/2025/05/12/ogu123/NamedPipe/EN/15.png" srcset="/img/loading.gif" alt></p>
<p>Now we just need to find the server-side Named Pipe creation part through IDA and find the point in the process of communicating with the client that will trigger the LPE.</p>
<p>First, you can find the server-side Named Pipe creation part by using IDA Imports or string search to find the functions shown above (including <code>CreateNamedPipeW()</code>).</p>
<p><img src="/2025/05/12/ogu123/NamedPipe/EN/16.png" srcset="/img/loading.gif" alt></p>
<p>We see that the target process uses the <code>CreateNamedPipeW</code> function, and if we follow where it uses that function, we see that the</p>
<p><img src="/2025/05/12/ogu123/NamedPipe/EN/17.png" srcset="/img/loading.gif" alt></p>
<p>You can see where to create the ogu123 Pipe. Now, after creating the Pipe, all you need to do is read the connected client messages on the server side and look for vectors that might trigger the LPE vulnerability! Simple, right?</p>
<h3 id="Client-Impersonation-Techniques"><a href="#Client-Impersonation-Techniques" class="headerlink" title="Client Impersonation Techniques"></a>Client Impersonation Techniques</h3><p>The Client Impersonation technique is a way for the server to obtain client authorization to perform LPE once it is connected to the client.</p>
<p>First, the server must obtain client authorization to perform impersonation, which is stored in the Access Token. The Access Token needs to be able to control &#x201C;<strong>what the server can do with my information</strong>&#x201D;, which is where the Impersonation Level comes in.</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>SECURITY_IMPERSONATION_LEVEL</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>SecurityAnonymous</code></td>
<td>The server cannot impersonate or identify the client.</td>
</tr>
<tr>
<td><code>SecurityIdentification</code></td>
<td>The server can get the identity and privileges of the client, but cannot impersonate the client.</td>
</tr>
<tr>
<td><code>SecurityImpersonation</code></td>
<td>The server can impersonate the client&#x2019;s security context on the local system.</td>
</tr>
<tr>
<td><code>SecurityDelegation</code></td>
<td>The server can impersonate the client&#x2019;s security context on remote systems.</td>
</tr>
</tbody>
</table>
</div>
<p>There are two types of access tokens: primary tokens and impersonation tokens, which we&#x2019;ll describe as processes and threads!</p>
<p>In Windows, every process has an Access Token, where the process token uses the Primary Token and does not change until the process is terminated.</p>
<p>A thread can have two values, a Primary Token and an Impersonation Token, and it shares the Primary Token value of the process.</p>
<p>A thread can use the Access Token of another account instead of the Primary Token when it is created, and the token it uses is the Impersonation Token! This means that the thread always references the Primary Token and only has an Impersonation Token when it is in impersonation.</p>
<pre><code class="hljs cpp">CreateFile(
    <span class="hljs-string">L&quot;Local pipe path or remote pipe path&quot;</span>,
    GENERIC_READ | GENERIC_WRITE,
    <span class="hljs-number">0</span>,
    <span class="hljs-literal">NULL</span>,
    OPEN_EXISTING,
    SECURITY_SQOS_PRESENT | SECURITY_IMPERSONATION, <span class="hljs-comment">// or SECURITY_DELEGATION</span>
    <span class="hljs-literal">NULL</span>
);</code></pre>
<p>Let&#x2019;s take a closer look at the LPE method with Client Impersonation!</p>
<p>When the target service or program calls <code>CreateFile()</code>, instead of the normal file path, it connects to the attacker&#x2019;s Named Pipe! The 6th argument of the <code>CreateFile()</code> function must have the value SECURITY_SQOS_PRESENT | SECURITY_IMPERSONATION or SECURITY_DELEGATION as shown above.</p>
<p>For remote pipes, SECURITY_IMPERSONATION is said to be enforced even if only SECURITY_SQOS_PRESENT is present.</p>
<pre><code class="hljs cpp"><span class="hljs-comment">// Create a server named pipe</span>
serverPipe = CreateNamedPipe(
    pipeName,           <span class="hljs-comment">// name of our pipe, must be in the form of \\.\pipe\&lt;NAME&gt;</span>
    PIPE_ACCESS_DUPLEX, <span class="hljs-comment">// The rest of the parameters don&apos;t really matter</span>
    PIPE_TYPE_MESSAGE,	<span class="hljs-comment">// as all you want is impersonate the client...</span>
    <span class="hljs-number">1</span>,		<span class="hljs-comment">// </span>
    <span class="hljs-number">2048</span>,	<span class="hljs-comment">// </span>
    <span class="hljs-number">2048</span>,	<span class="hljs-comment">// </span>
    <span class="hljs-number">0</span>,		<span class="hljs-comment">// </span>
    <span class="hljs-literal">NULL</span>	<span class="hljs-comment">// This should ne NULL so every client can connect</span>
);
<span class="hljs-comment">// wait for pipe connections</span>
BOOL bPipeConnected = ConnectNamedPipe(serverPipe, <span class="hljs-literal">NULL</span>);
<span class="hljs-comment">// Impersonate client</span>
BOOL bImpersonated = ImpersonateNamedPipeClient(serverPipe);
<span class="hljs-comment">// if successful open Thread token - your current thread token is now the client&apos;s token</span>
BOOL bSuccess = OpenThreadToken(GetCurrentThread(), TOKEN_ALL_ACCESS, FALSE, &amp;hToken);
<span class="hljs-comment">// now you got the client token saved in hToken and you can safeyl revert back to self</span>
bSuccess = RevertToSelf();
<span class="hljs-comment">// Now duplicate the client&apos;s token to get a Primary token</span>
bSuccess = DuplicateTokenEx(hToken,
    TOKEN_ALL_ACCESS,
    <span class="hljs-literal">NULL</span>,
    SecurityImpersonation,
    TokenPrimary,
    &amp;hDuppedToken
);
<span class="hljs-comment">// If that succeeds you got a Primary token as hDuppedToken and you can create a proccess with that token</span>
CreateProcessWithTokenW(hDuppedToken, LOGON_WITH_PROFILE, command, <span class="hljs-literal">NULL</span>, CREATE_NEW_CONSOLE, <span class="hljs-literal">NULL</span>, <span class="hljs-literal">NULL</span>, &amp;si, &amp;pi);</code></pre>
<p>Once the target client is connected to the attacker&#x2019;s Named Pipe server, the server can LPE with client privileges via the above code. Let&#x2019;s take a look at the main functions.</p>
<ul>
<li><code>ImpersonateNamedPipeClient()</code> : Applies the client Impersonation Token to the server thread. The Impersonation Token used is the token for applying the client&#x2019;s Primary Token to the thread.</li>
<li><code>RetrieveToSelf()</code>: Terminates the Impersonation. It must be executed before the <code>CreateProcessWithTokenW()</code> function is called to avoid errors.</li>
<li><code>DuplicateTokenEx()</code> : Duplicates the client Impersonation Token obtained earlier as the Primary Token for use in the process.</li>
<li><code>CreateProcessWithTokenW()</code> : Creates a process with client privileges through the Primary Token token. &#x2192; LPE occurs!</li>
</ul>
<h2 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a><strong>Conclusion</strong></h2><p>In this article, we took a deep dive into Windows IPC and Named Pipes! Writing this article reminded me that there are a lot of Windows Attack Vectors out there.</p>
<p>Thanks for reading this long post!</p>
<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a><strong>Reference</strong></h2><ul>
<li>&#xC708;&#xB3C4;&#xC6B0; &#xC2DC;&#xC2A4;&#xD15C; &#xD504;&#xB85C;&#xADF8;&#xB798;&#xBC0D;</li>
<li>&#xB1CC;&#xB97C; &#xC790;&#xADF9;&#xD558;&#xB294; &#xC708;&#xB3C4;&#xC6B0;&#xC988; &#xC2DC;&#xC2A4;&#xD15C; &#xD504;&#xB85C;&#xADF8;&#xB798;&#xBC0D;</li>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="https://www.baeldung.com/cs/pipes-vs-sockets">https://www.baeldung.com/cs/pipes-vs-sockets</a></li>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="https://www.codeproject.com/Articles/13724/Windows-IPC">https://www.codeproject.com/Articles/13724/Windows-IPC</a></li>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="https://versprite.com/vs-labs/microsoft-windows-pipes-intro/">https://versprite.com/vs-labs/microsoft-windows-pipes-intro/</a></li>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="https://versprite.com/vs-labs/vulnerable-named-pipe-application/">https://versprite.com/vs-labs/vulnerable-named-pipe-application/</a></li>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="https://csandker.io/2021/01/10/Offensive-Windows-IPC-1-NamedPipes.html">https://csandker.io/2021/01/10/Offensive-Windows-IPC-1-NamedPipes.html</a></li>
</ul>

            </div>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                <div class="post-meta mr-3">
                  <i class="iconfont icon-category"></i>
                  
                  <a class="hover-with-bg" href="/categories/Research/">Research</a>
                  
                </div>
                
                
                <div class="post-meta">
                  <i class="iconfont icon-tags"></i>
                  
                  <a class="hover-with-bg" href="/tags/Windows/">Windows</a>
                  
                  <a class="hover-with-bg" href="/tags/ogu123/">ogu123</a>
                  
                  <a class="hover-with-bg" href="/tags/IPC/">IPC</a>
                  
                  <a class="hover-with-bg" href="/tags/Named-Pipe/">Named Pipe</a>
                  
                  <a class="hover-with-bg" href="/tags/Anonymous-Pipe/">Anonymous Pipe</a>
                  
                  <a class="hover-with-bg" href="/tags/Client-Impersonation/">Client Impersonation</a>
                  
                </div>
                
              </div>

              <div class="post-metas mb-3">
                <a class="hover-with-bg" style="display: flex;" href="/author">
                  <div class="link-avatar-page">
                    <img src="/img/profile_ogu123.jpg" srcset="/img/loading.gif" alt="ogu123">
                  </div>

                  <div class="link-text">
                    <div class="link-title">ogu123</div>
                  </div>
                </a>
                <div class="link-text">
                  <div class="link-more">
                    <a href="/tags/ogu123">
                      Read more
                      <i class="iconfont icon-arrowdown"></i>
                    </a>
                  </div>
                </div>
              </div>

              <hr>
              <!--<script data-ad-client="ca-pub-3672652207808168" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>-->
              
              <!--  -->
              <p class="note note-warning">본 글은 <a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/deed.ko" rel="external nofollow noopener noreferrer">CC BY-SA 4.0</a> 라이선스로 배포됩니다. 공유 또는 변경 시 반드시 출처를 남겨주시기 바랍니다.</p>
              
              
              
              <div class="post-prevnext row">
                <article class="post-prev col-6">
                  
                  
                  <a href="/2025/05/14/OUYA77/2025-05-14/">
                    <i class="iconfont icon-arrowleft"></i>
                    <span class="hidden-mobile">[하루한줄] CVE-2024-55030 : NASA fPrime의 Queue Overflow로 인한 DoS 취약점</span>
                    <span class="visible-mobile">Previous</span>
                  </a>
                  
                </article>
                <article class="post-next col-6">
                  
                  
                  <a href="/2025/05/12/ogu123/NamedPipe/KR/">
                    <span class="hidden-mobile">[Research] Windows Named Pipe (KR)</span>
                    <span class="visible-mobile">Next</span>
                    <i class="iconfont icon-arrowright"></i>
                  </a>
                  
                </article>
              </div>
              
            </div>
            
            <!-- Embed Section -->
            <div style="width: 100%; height: 210px; margin-bottom: 50px; overflow: hidden;">
              <iframe src="https://maily.so/hackyboiz/embed?src=embed" style="width: 100%; height: 100%; border: none;" frameborder="0"></iframe>
            </div>            

            
            <!-- Comments -->
            <article class="comments" id="comments">
              
              
  <div class="disqus" style="width:100%">
    <div id="disqus_thread"></div>
    <script type="text/javascript">
      var disqus_config = function () {
        this.page.url = 'https://hackyboiz.github.io/2025/05/12/ogu123/NamedPipe/EN/';
        this.page.identifier = '/2025/05/12/ogu123/NamedPipe/EN/';
      };
      function loadDisqus() {
        (function () {
          var d = document,
            s = d.createElement('script');
          s.src = '//' + 'hackyboiz' + '.disqus.com/embed.js';
          s.setAttribute('data-timestamp', new Date());
          (d.head || d.body).appendChild(s);
        })();
      }
      waitElementVisible('disqus_thread', loadDisqus);
    </script>
    <noscript>Please enable JavaScript to view the
      <a target="_blank" href="https://disqus.com/?ref_noscript" rel="external nofollow noopener noreferrer">comments powered by Disqus.</a>
    </noscript>
  </div>


            </article>
            
          </article>
        </div>
      </div>
    </div>
    
    <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
      <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;TOC</p>
  <div id="tocbot"></div>
</div>

    </div>
    
  </div>
</div>

<!-- Custom -->

    
  </main>

  
    <a id="scroll-top-button" href="#" role="button">
      <i class="iconfont icon-arrowup" aria-hidden="true"></i>
    </a>
  

  
    <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">Search</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">keyword</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
  

  

  

  <footer class="mt-5">
  <div class="text-center py-3">
    <div>
      <a href="https://hexo.io" target="_blank" rel="external nofollow noopener noreferrer"><span>Hexo</span></a>
      <i class="iconfont icon-love"></i>
      <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="external nofollow noopener noreferrer">
        <span>Fluid</span></a>
    </div>
    

    

    
  </div>
</footer>

<!-- SCRIPTS -->
<script src="https://cdn.staticfile.org/jquery/3.4.1/jquery.min.js"></script>
<script src="https://cdn.staticfile.org/twitter-bootstrap/4.4.1/js/bootstrap.min.js"></script>
<script src="/js/debouncer.js"></script>
<script src="/js/main.js"></script>

<!-- Plugins -->


  
    <script src="/js/lazyload.js"></script>
  



  <script defer src="https://cdn.staticfile.org/clipboard.js/2.0.6/clipboard.min.js"></script>
  <script src="/js/clipboard-use.js"></script>







  <script src="https://cdn.staticfile.org/tocbot/4.11.1/tocbot.min.js"></script>
  <script>
    $(document).ready(function () {
      var boardCtn = $('#board-ctn');
      var boardTop = boardCtn.offset().top;

      tocbot.init({
        tocSelector: '#tocbot',
        contentSelector: '#post-body',
        headingSelector: 'h1,h2,h3,h4,h5,h6',
        linkClass: 'tocbot-link',
        activeLinkClass: 'tocbot-active-link',
        listClass: 'tocbot-list',
        isCollapsedClass: 'tocbot-is-collapsed',
        collapsibleClass: 'tocbot-is-collapsible',
        collapseDepth: 0,
        scrollSmooth: true,
        headingsOffset: -boardTop
      });
      if ($('.toc-list-item').length > 0) {
        $('#toc').css('visibility', 'visible');
      }
    });
  </script>



  <script src="https://cdn.staticfile.org/typed.js/2.0.11/typed.min.js"></script>
  <script>
    var typed = new Typed('#subtitle', {
      strings: [
        '  ',
        "[Research] Windows Named Pipe (EN)&nbsp;",
      ],
      cursorChar: "_",
      typeSpeed: 70,
      loop: false,
    });
    typed.stop();
    $(document).ready(function () {
      $(".typed-cursor").addClass("h2");
      typed.start();
    });
  </script>



  <script src="https://cdn.staticfile.org/anchor-js/4.2.2/anchor.min.js"></script>
  <script>
    anchors.options = {
      placement: "right",
      visible: "hover",
      
    };
    var el = "h1,h2,h3,h4,h5,h6".split(",");
    var res = [];
    for (item of el) {
      res.push(".markdown-body > " + item)
    }
    anchors.add(res.join(", "))
  </script>



  <script src="/js/local-search.js"></script>
  <script>
    var path = "/local-search.xml";
    var inputArea = document.querySelector("#local-search-input");
    inputArea.onclick = function () {
      searchFunc(path, 'local-search-input', 'local-search-result');
      this.onclick = null
    }
  </script>



  <script src="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.js"></script>
  <link rel="stylesheet" href="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.css">

  <script>
    $('#post img:not(.no-zoom img, img[no-zoom]), img[zoom]').each(
      function () {
        var element = document.createElement('a');
        $(element).attr('data-fancybox', 'images');
        $(element).attr('href', $(this).attr('src'));
        $(this).wrap(element);
      }
    );
  </script>





  

  
    <!-- MathJax -->
    <script>
      MathJax = {
        tex: {
          inlineMath: [['$', '$'], ['\\(', '\\)']]
        },
        options: {
          renderActions: {
            findScript: [10, doc => {
              document.querySelectorAll('script[type^="math/tex"]').forEach(node => {
                const display = !!node.type.match(/; *mode=display/);
                const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
                const text = document.createTextNode('');
                node.parentNode.replaceChild(text, node);
                math.start = { node: text, delim: '', n: 0 };
                math.end = { node: text, delim: '', n: 0 };
                doc.math.push(math);
              });
            }, '', false],
            insertedScript: [200, () => {
              document.querySelectorAll('mjx-container').forEach(node => {
                let target = node.parentNode;
                if (target.nodeName.toLowerCase() === 'li') {
                  target.parentNode.classList.add('has-jax');
                }
              });
            }, '', false]
          }
        }
      };
    </script>

    <script async src="https://cdn.staticfile.org/mathjax/3.0.5/es5/tex-svg.js"></script>

  













  

  
    <!-- Google Analytics -->
    <script defer>
      window.ga = window.ga || function () { (ga.q = ga.q || []).push(arguments) };
      ga.l = +new Date;
      ga('create', 'UA-177243668-2', 'auto');
      ga('send', 'pageview');
    </script>
    <script async src="https://www.google-analytics.com/analytics.js"></script>
  

  
    <!-- Google gtag.js -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-177243668-2"></script>
    <script defer>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'UA-177243668-2');
    </script>
  

  

  

  





</body>
</html>
