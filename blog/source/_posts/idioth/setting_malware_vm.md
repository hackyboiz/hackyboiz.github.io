---
title: "[Research] ì•…ì„±ì½”ë“œ ë¶„ì„ìš© VM ì„¸íŒ…ì„ ìë™í™”í•´ë³´ì!"
author: idioth
tags: [idioth, malware, automated, virtual machine, powershell]
categories: [Research]
date: 2021-06-06 18:00:00
cc: true
index_img: /2021/06/06/idioth/setting_malware_vm/thumbnail.jpg
---

# ì„œë¡ 

ì•ˆë…•í•˜ì„¸ìš”. idiothì…ë‹ˆë‹¤. ì˜¤ëŠ˜ ê°€ì ¸ì˜¨ ì£¼ì œëŠ” "ì•…ì„±ì½”ë“œ ë¶„ì„ìš© ê°€ìƒ ë¨¸ì‹  ì„¤ì • ìë™í™”"ì…ë‹ˆë‹¤.

ë‹ê²ì€ ê·€ì°®ì€ í–‰ë™ì„ í•˜ê¸° ì‹«ì–´í•©ë‹ˆë‹¤.(ì €ë§Œ ê·¸ëŸ° ê±´ ì•„ë‹ˆê² ì£ ?) ë³´í†µ ì•…ì„±ì½”ë“œ ë¶„ì„ì€ ê°€ìƒ ë¨¸ì‹ ì—ì„œ ìˆ˜í–‰í•˜ê³ , ë˜ ë¶„ì„ìš© VMì„ ì—¬ëŸ¬ ê°œ ë“¤ê³  ìˆê±°ë‚˜ ì•„ë‹ˆë©´ ë‹¤ë¥¸ PCì— ì„¤ì¹˜í•´ì•¼ í•  ì¼ ë“±ì´ ìˆì£ . ì˜ˆë¥¼ ë“¤ì–´ ì € ê°™ì€ ê²½ìš°ëŠ” ì§‘ì— ìˆëŠ” ë°ìŠ¤í¬í†±ê³¼ í•™êµë‚˜ ì¹´í˜ ë“±ì—ì„œ ì‚¬ìš©í•˜ëŠ” ë…¸íŠ¸ë¶ìœ¼ë¡œ ë‚˜ë‰˜ì–´ ìˆìŠµë‹ˆë‹¤.

Windows ê°€ìƒ ë¨¸ì‹ ì—ë‹¤ê°€ ì´ëŸ°ì €ëŸ° ë„êµ¬ë“¤ì„ ì„¤ì •í•˜ë©´ ìš©ëŸ‰ì´ ì»¤ì ¸ì„œ ì••ì¶•í•˜ê±°ë‚˜ ì˜®ê¸°ëŠ” ë°ì—ë„ ì‹œê°„ì´ ê½¤ ê±¸ë¦½ë‹ˆë‹¤. ë°–ì— ìˆëŠ”ë° ë…¸íŠ¸ë¶ì„ í¬ë§·í•˜ê±°ë‚˜ í•˜ëŠ” ìƒí™©ì´ ë°œìƒí•˜ë©´ Windows ê°€ìƒ ë¨¸ì‹ ì„ ìƒˆë¡œ ë§Œë“¤ì–´ì„œ ì„¤ì •ì„ ì­‰ í•´ì•¼ í•˜ì£ .

í¬ë„ˆë¸”ì„ ê³µë¶€í•  ë•Œ ì‚¬ìš©í•˜ëŠ” ìš°ë¶„íˆ¬ì—ì„œëŠ” ì œê°€ ì‚¬ìš©í•˜ëŠ” íˆ´ ë“±ì„ ì‰˜ ìŠ¤í¬ë¦½íŠ¸ë¡œ ë‹¤ìš´ë¡œë“œ ë° ì„¤ì •í•˜ê²Œ ë§Œë“¤ì–´ì„œ ë¦¬ëˆ…ìŠ¤ë¥¼ ì‚¬ìš©í•  ë•Œ ì‰˜ ìŠ¤í¬ë¦½íŠ¸ë§Œ ì‹¤í–‰í•˜ê³  ë”´ì§“ì„ í•˜ë‹¤ ì˜¤ë©´ ì„¸íŒ…ì´ ë‹¤ ë˜ëŠ”ë° Windowsë„ ê°€ëŠ¥í• ê¹Œ?ë¼ëŠ” ìƒê°ì—ì„œ ì‹œì‘í–ˆìŠµë‹ˆë‹¤.

[FireEyeì—ì„œ ë°°í¬í•˜ëŠ” FlareVM](https://github.com/fireeye/flare-vm)ë„ ì¡´ì¬í•˜ì§€ë§Œ ëª¨ë“  íˆ´ì„ ë‹¤ ë‹¤ìš´ë¡œë“œí•˜ê¸°ë„ í•˜ê³  ì˜¤ë˜ ê±¸ë¦¬ë©´ í•˜ë£¨ ì¢…ì¼ ê±¸ë¦¬ëŠ” ê²½ìš°ë„ ìˆë”ë¼ê³ ìš”... ê·¸ë˜ì„œ ê±°ê¸°ì„œ ì˜ê°ì„ ì–»ì–´ì„œ ì œê°€ ìì£¼ ì‚¬ìš©í•˜ëŠ” íˆ´ë“¤ë¡œ êµ¬ì„±í•˜ì—¬ ì‘ì„±ì„ í•´ë³´ì•˜ìŠµë‹ˆë‹¤.(FlareVMì—ì„œ ê°€ì ¸ì˜¨ ì½”ë“œë„ ìˆìŠµë‹ˆë‹¤ ğŸ˜‚)

ë³¸ë˜ SSG ë™ì•„ë¦¬ ë‚´ë¶€ì—ì„œ ì•…ì„±ì½”ë“œ ê´€ë ¨ ìŠ¤í„°ë”” ë“±ì„ í•  ë•Œ ìŠ¤í¬ë¦½íŠ¸ ì£¼ë©´ì„œ ì´ê±° ì‹¤í–‰í•˜ë©´ ë  ê±°ì•¼~ í–ˆëŠ”ë° ê·¸ê±¸ ê·¸ëŒ€ë¡œ ë¸”ë¡œê·¸ì— ì˜¬ë¦¬ê¸°ì—ëŠ” ì½”ë“œê°€ ë„ˆë¬´ ì²˜ì°¸í•´ì„œ... (ë§¤ìš° ë”ëŸ½ìŠµë‹ˆë‹¤.) ì´ë²ˆ ê¸°íšŒì— ê¹”ë”í•˜ê²Œ ì‘ì„±í–ˆìŠµë‹ˆë‹¤.(ë¬¼ë¡  ì œ ê¸°ì¤€ì—ì„œë§Œ ê¹”ë”í•  ìˆ˜ë„ ìˆì–´ìš”! ì–‘í•´ ë°”ëë‹ˆë‹¤. ğŸ™‚   

íŒŒíŠ¸ëŠ” í¬ê²Œ ë‘ ê°€ì§€ë¡œ ë‚˜ë‰  ì˜ˆì •ì…ë‹ˆë‹¤. ì²« ë²ˆì§¸ íŒŒíŠ¸ì—ì„œëŠ” Windows ì„¤ì •ì— ëŒ€í•œ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‘ì„±í•  ì˜ˆì •ì´ê³ , ë‘ ë²ˆì§¸ íŒŒíŠ¸ì—ì„œëŠ” [chocolatey](https://chocolatey.org/)ë¥¼ í™œìš©í•œ íˆ´ë“¤ì„ ì„¤ì¹˜í•  ê²ë‹ˆë‹¤!

# ë¬´ì—‡ì„ ì„¤ì •í•´ì•¼ í• ê¹Œ?

ê°€ì¥ ë¨¼ì € ìŠ¤í¬ë¦½íŠ¸ë¥¼ í†µí•´ì„œ ë¬´ì—‡ì„ í•´ì•¼ í• ì§€ ì •ë¦¬ë¥¼ í•˜ê³  ì‹œì‘í•©ì‹œë‹¤. ì•„ë¬´ë˜ë„ ì•…ì„±ì½”ë“œ ë¶„ì„ì„ í•´ì•¼ í•˜ë¯€ë¡œ Windows Defenderì™€ Windows UpdateëŠ” êº¼ë†“ëŠ” ê²ƒì´ ì¢‹ê² ì£ ? ì‹œì‘ í”„ë¡œê·¸ë¨ì— ë“±ë¡ë˜ì—ˆì„ ë•Œ ë³µì¡í•˜ê²Œ í•˜ì§€ ì•Šê¸° ìœ„í•´ì„œ ì‹œì‘ í”„ë¡œê·¸ë¨ë„ ì •ë¦¬í•˜ê³ ... ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” ê¸°ë³¸ ì•± ì‚­ì œ ë“±... ì œê°€ ìƒê°ë‚˜ëŠ” ëŒ€ë¡œ ê°„ë‹¨í•˜ê²Œ ì •ë¦¬í•´ë³´ì•˜ìŠµë‹ˆë‹¤.

1. ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” ê¸°ë³¸ ì•± ì‚­ì œ
2. ë°©í™”ë²½ ë¹„í™œì„±í™”
3. Windows Update ë¹„í™œì„±í™”
4. Windows Defender ë¹„í™œì„±í™”
5. ë³´ì•ˆìœ ì§€ ì •ì±… ì•Œë¦¼ ë¹„í™œì„±í™”
6. ì‘ì—… ìŠ¤ì¼€ì¤„ëŸ¬ ì‚­ì œ
7. ì‹œì‘ í”„ë¡œê·¸ë¨ ì‚­ì œ
8. ìˆ¨ê¹€ íŒŒì¼ í‘œì‹œ

Windowsì—ì„œ ì‰˜ ìŠ¤í¬ë¦½íŠ¸ë¡œ í•œ ë²ˆì— ì„¤ì •ì„ í•œë‹¤ê³ ? ë­”ê°€ ë‚¯ì„¤ê²Œ ëŠê»´ì§€ì‹œëŠ” ë¶„ë“¤ë„ ê³„ì‹œê² ì§€ë§Œ Windowsì—ëŠ” Powershellì´ ì¡´ì¬í•©ë‹ˆë‹¤. Powershellì„ ì‚¬ìš©í•´ì„œ ìœ„ì˜ ì‘ì—…ë“¤ì„ í•˜ë‚˜í•˜ë‚˜ ì§„í–‰í•´ë´…ì‹œë‹¤!

# ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” ê¸°ë³¸ ì•± ì‚­ì œ

ì²˜ìŒ Windowsë¥¼ ì„¤ì¹˜í•˜ë©´ 3D ë·°ì–´ë‚˜, BingFinance, OfficeHub ë“±ë“± ì•…ì„±ì½”ë“œ ë¶„ì„ì—ëŠ” í™œìš©ë˜ì§€ ì•ŠëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ë“¤ì´ ë§ì´ ì„¤ì¹˜ë˜ì–´ ìˆìŠµë‹ˆë‹¤. ì´ëŸ° ì•±ì„ ì†ìˆ˜ ì§€ìš¸ ìˆ˜ë„ ìˆìœ¼ë‚˜ `Remove-AppxPackage` ëª…ë ¹ì–´ë¥¼ í†µí•´ì„œ ì‚­ì œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```powershell
PS C:\Windows\system32> Get-AppxPackage Microsoft.XboxApp

Name              : Microsoft.XboxApp
Publisher         : CN=Microsoft Corporation, O=Microsoft Corporation, L=Redmond, S=Washington, C=US
Architecture      : X64
ResourceId        :
Version           : 48.76.8001.0
PackageFullName   : Microsoft.XboxApp_48.76.8001.0_x64__8wekyb3d8bbwe
InstallLocation   : C:\Program Files\WindowsApps\Microsoft.XboxApp_48.76.8001.0_x64__8wekyb3d8bbwe
IsFramework       : False
PackageFamilyName : Microsoft.XboxApp_8wekyb3d8bbwe
PublisherId       : 8wekyb3d8bbwe
IsResourcePackage : False
IsBundle          : False
IsDevelopmentMode : False
NonRemovable      : False
Dependencies      : {Microsoft.NET.Native.Framework.1.7_1.7.27413.0_x64__8wekyb3d8bbwe, Microsoft.NET.Native.Runtime.1.7_1.7.27422.0_x64__8wekyb3d8bbwe, Microsoft.VCLibs.140.00_14.0.29231.0_x64__8wekyb3d8bbwe, Microsoft.VCLibs.140.00.UWPDesktop_14.0.29231.0_x64__8wekyb3
                    d8bbwe...}
IsPartiallyStaged : False
SignatureKind     : Store
Status            : Ok
```

ì˜ˆë¥¼ ë“¤ì–´ XboxAppì˜ ê²½ìš° ë¶„ì„ì—ì„œëŠ” ì•„ì˜ˆ ì‚¬ìš©í•˜ì§€ ì•Šê² ì£ ? `Get-AppxPackage`ë¥¼ í†µí•´ íŒ¨í‚¤ì§€ì˜ ì •ë³´ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ìˆê³ , íŒŒì´í”„ë¼ì¸ìœ¼ë¡œ `Remove-AppxPackage`ë¥¼ ì‚¬ìš©í•˜ë©´ í•´ë‹¹ íŒ¨í‚¤ì§€ê°€ ì‚­ì œë©ë‹ˆë‹¤.

ì´ë¥¼ í† ëŒ€ë¡œ ì‘ì„±í•œ ì†ŒìŠ¤ ì½”ë“œëŠ” ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤.

```powershell
$packages = @(
    "7EE7776C.LinkedInforWindows"
    "C27EB4BA.DropboxOEM"
    "Microsoft.3DBuilder"
    "Microsoft.Microsoft3DViewer"
    "Microsoft.Advertising.Xaml"
    "Microsoft.Appconnector"
    "Microsoft.BingFinance"
    "Microsoft.BingFoodAndDrink"
    "Microsoft.BingHealthAndFitness"
    "Microsoft.BingNews"
    "Microsoft.BingSports"
    "Microsoft.BingTravel"
    "Microsoft.BingWeather"
    "Microsoft.CommsPhone"
    "Microsoft.ConnectivityStore"
    "Microsoft.DesktopAppInstaller"
    "Microsoft.Getstarted"
    "Microsoft.Messaging"
    "Microsoft.Microsoft3DViewer"
    "Microsoft.MicrosoftOfficeHub"
    "Microsoft.MicrosoftSolitaireCollection"
    "Microsoft.MixedReality.Portal"
    "Microsoft.Netflix"
    "Microsoft.NetworkSpeedTest"
    "Microsoft.Office.Desktop"
    "Microsoft.Office.OneNote"
    "Microsoft.Office.Sway"
    "Microsoft.OfficeLens"
    "Microsoft.OneConnect"
    "Microsoft.OneDrive"
    "Microsoft.People"
    "Microsoft.Print3D"
    "Microsoft.RemoteDesktop"
    "Microsoft.SkypeApp"
    "Microsoft.Wallet"
    "Microsoft.Windows.CloudExperienceHost"
    "Microsoft.Windows.NarratorQuickStart"
    "Microsoft.Windows.PeopleExperienceHost"
    "Microsoft.Windows.Photos"
    "Microsoft.WindowsAlarms"
    "Microsoft.WindowsCamera"
    "Microsoft.windowscommunicationsapps"
    "Microsoft.WindowsFeedbackHub"
    "Microsoft.WindowsMaps"
    "Microsoft.WindowsPhone"
    "Microsoft.WindowsReadingList"
    "Microsoft.WindowsSoundRecorder"
    "Microsoft.Xbox.TCUI"
    "Microsoft.XboxApp"
    "Microsoft.XboxGameCallableUI"
    "Microsoft.XboxGameOverlay"
    "Microsoft.XboxGamingOverlay"
    "Microsoft.XboxIdentityProvider"
    "Microsoft.XboxLive"
    "Microsoft.XboxSpeechToTextOverlay"
    "Microsoft.YourPhone"
    "Microsoft.ZuneMusic"
    "Microsoft.ZuneVideo"
    "Windows.CBSPreview"
)

foreach($name in $packages)
{
    Get-AppxPackage $name | Remove-AppxPackage
}
```

`$packages`ì— ìˆëŠ” íŒ¨í‚¤ì§€ ì´ë¦„ì„ í•˜ë‚˜ì”© ê°€ì ¸ì™€ì„œ ì‚­ì œë¥¼ í•˜ëŠ” ë¶€ë¶„ì…ë‹ˆë‹¤. ì¶”ê°€ë˜ì–´ ìˆì§€ ì•Šì€ ì• í”Œë¦¬ì¼€ì´ì…˜ë„ ì¡´ì¬í•˜ê¸° ë•Œë¬¸ì— í˜¹ì‹œ ë³¸ì¸ì´ ì‚­ì œí•˜ê³  ì‹¶ì§€ ì•Šê±°ë‚˜ ì‚­ì œí•˜ê³  ì‹¶ì€ í”„ë¡œê·¸ë¨ì´ ìˆìœ¼ë©´ ì¶”ê°€ë¥¼ í•˜ì‹œë©´ ë©ë‹ˆë‹¤.

![](setting_malware_vm/Untitled.png)

ì‚­ì œí•˜ê³  ì‹¶ì€ ì•±ì´ ìˆëŠ”ë° íŒ¨í‚¤ì§€ ì´ë¦„ì„ ëª¨ë¥´ì‹œê² ë‹¤ê³ ìš”? ê±±ì •í•˜ì§€ ë§ˆì„¸ìš”! ê¹”ë ¤ìˆëŠ” íŒ¨í‚¤ì§€ë¥¼ ì´ë¦„ìœ¼ë¡œ ì •ë ¬í•´ì„œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤!

```powershell
PS C:\Windows\system32> Get-AppxPackage | Select Name

Name
----
windows.immersivecontrolpanel
Microsoft.VCLibs.140.00
Microsoft.UI.Xaml.2.0
Windows.PrintDialog
Microsoft.Wallet
Microsoft.VCLibs.140.00
Microsoft.VCLibs.140.00
RealtekSemiconductorCorp.RealtekAudioControl
Microsoft.VCLibs.140.00.UWPDesktop
Microsoft.VCLibs.140.00.UWPDesktop
AdvancedMicroDevicesInc-2.AMDRadeonSoftware
Microsoft.XboxSpeechToTextOverlay
Microsoft.XboxGameOverlay
Microsoft.NET.Native.Runtime.2.2
Microsoft.NET.Native.Runtime.2.2
Microsoft.NET.Native.Framework.2.2
Microsoft.NET.Native.Framework.2.2
Microsoft.Xbox.TCUI
Microsoft.UI.Xaml.2.4
Microsoft.UI.Xaml.2.4
Microsoft.UI.Xaml.2.0
Microsoft.UI.Xaml.2.1
Microsoft.UI.Xaml.2.1
Microsoft.NET.Native.Framework.1.7
Microsoft.NET.Native.Framework.1.7
Microsoft.NET.Native.Runtime.1.7
Microsoft.NET.Native.Runtime.1.7
Microsoft.UI.Xaml.2.3
Microsoft.UI.Xaml.2.3
Microsoft.UI.Xaml.2.5
Microsoft.UI.Xaml.2.5
Microsoft.549981C3F5F10
Microsoft.StorePurchaseApp
Microsoft.LanguageExperiencePackko-KR
Microsoft.WinDbg
microsoft.windowscommunicationsapps
Microsoft.WebpImageExtension
Microsoft.XboxIdentityProvider
Microsoft.DesktopAppInstaller
Microsoft.Windows.Photos
Microsoft.WebMediaExtensions
Microsoft.XboxApp
Microsoft.MixedReality.Portal
Microsoft.People
Microsoft.WindowsStore
Microsoft.ZuneVideo
Microsoft.Microsoft3DViewer
Microsoft.WindowsFeedbackHub
Microsoft.MicrosoftStickyNotes
Microsoft.WindowsAlarms
Microsoft.GetHelp
Microsoft.BingWeather
Microsoft.WindowsCamera
Microsoft.ScreenSketch
Microsoft.WindowsMaps
Microsoft.WindowsCalculator
Microsoft.WindowsSoundRecorder
Microsoft.ZuneMusic
Microsoft.BioEnrollment
Microsoft.Windows.CloudExperienceHost
Microsoft.Windows.OOBENetworkConnectionFlow
Microsoft.AAD.BrokerPlugin
Microsoft.Windows.OOBENetworkCaptivePortal
MicrosoftWindows.UndockedDevKit
Microsoft.Windows.StartMenuExperienceHost
Microsoft.Windows.ShellExperienceHost
Microsoft.Windows.Search
Microsoft.MicrosoftEdge
Microsoft.Windows.ContentDeliveryManager
MicrosoftWindows.Client.CBS
Windows.CBSPreview
NcsiUwpApp
Microsoft.XboxGameCallableUI
Microsoft.Windows.XGpuEjectDialog
Microsoft.Windows.SecureAssessmentBrowser
Microsoft.Windows.SecHealthUI
Microsoft.Windows.PinningConfirmationDialog
Microsoft.Windows.PeopleExperienceHost
Microsoft.Windows.ParentalControls
Microsoft.Windows.NarratorQuickStart
Microsoft.Windows.CapturePicker
Microsoft.Windows.CallingShellApp
Microsoft.Windows.AssignedAccessLockApp
Microsoft.Windows.Apprep.ChxApp
Microsoft.Win32WebViewHost
Microsoft.MicrosoftEdgeDevToolsClient
Microsoft.LockApp
Microsoft.ECApp
Microsoft.CredDialogHost
Microsoft.AsyncTextService
Microsoft.AccountsControl
Microsoft.VP9VideoExtensions
Microsoft.XboxGamingOverlay
Microsoft.HEIFImageExtension
Microsoft.MSPaint
91750D7E.Slack
Microsoft.MicrosoftEdge.Stable
Microsoft.Getstarted
Microsoft.YourPhone
```

ì´ë¦„ì„ ì°¾ì•˜ëŠ”ë° `Xbox`ì²˜ëŸ¼ ì—¬ëŸ¬ ê°œê°€ ìˆëŠ”ë° ì ê¸°ê°€ ë„ˆë¬´ ê·€ì°®ë‹¤. ë‚˜ëŠ” í•œ ë²ˆì— í•´ì¹˜ìš°ê³  ì‹¶ë‹¤! í•˜ì‹œëŠ” ë¶„ì€ `Microsoft.Xbox*`í•˜ì‹œë©´ ë¦¬ëˆ…ìŠ¤ì™€ ê°™ì´ `Microsoft.Xbox1` ë“± ë’¤ì— ì¶”ê°€ë˜ì–´ ìˆëŠ”(?) ë­ë¼ ë§í•´ì•¼ í•˜ì§€... ìƒê°ì´ ì•ˆ ë‚˜ë„¤ìš”! ì•„ë¬´íŠ¼! ì € ë¬¸ìì—´ë¡œ ì‹œì‘í•˜ëŠ” ì¹œêµ¬ë“¤ì„ ëª¨ë‘ ì‚­ì œí•´ì¤ë‹ˆë‹¤!

ê·¸ëŸ¼ ì´ì œ ë°©í™”ë²½ì„ ë¹„í™œì„±í™”í•˜ëŸ¬ ê°€ë³¼ê¹Œìš”?

# ë°©í™”ë²½ ë¹„í™œì„±í™”

ë°©í™”ë²½ ë¹„í™œì„±í™”ëŠ” êµ‰ì¥íˆ~~~~~~ ì½”ë“œê°€ ê°„ë‹¨í•©ë‹ˆë‹¤.

ë„ë©”ì¸, ê³µìš©, ê°œì¸ì— ëŒ€í•œ ë°©í™”ë²½ ëª¨ë‘ë¥¼ ë¹„í™œì„±í™”í•˜ë©´ ë˜ëŠ”ë° ìš”ê±°ëŠ” PowerShellì„ í†µí•´ í•œë²ˆì— ì‘ì—…í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. XD

```powershell
Set-NetFirewallProfile -Profile Domain, Public, Private -Enabled False
```

# Windows Update ë¹„í™œì„±í™”

Windows Updateë¥¼ ë¹„í™œì„±í™”í•˜ê¸° ìœ„í•´ì„œëŠ” WindowsUpdate ë ˆì§€ìŠ¤íŠ¸ë¦¬ì— `NoAutoUpdate`ë¥¼ ì„¤ì •í•´ì£¼ë©´ ë©ë‹ˆë‹¤.

```powershell
New-Item -Path "HKLM:\SOFTWARE\Policies\Microsoft\Windows" -Name "WindowsUpdate" -ea 0 | Out-Null
New-Item -Path "HKLM:\SOFTWARE\Policies\Microsoft\Windows\WindowsUpdate" -Name "AU" -ea 0 | Out-Null
New-ItemProperty -Path "HKLM:\SOFTWARE\Policies\Microsoft\Windows\WindowsUpdate\AU" -Name "NoAutoUpdate" -Value 1 -PropertyType DWORD -Force -ea 0 | Out-Null
```

# Windows Defender ë¹„í™œì„±í™”

ë°©í™”ë²½ ë¹„í™œì„±í™”ëŠ” Windows Defender ë ˆì§€ìŠ¤íŠ¸ë¦¬ì— `DisableAntiSpyware`ë§Œ ì¶”ê°€ë¥¼ í•´ë†“ì•˜ì—ˆëŠ”ë°, flare-vmì—ì„œ ì‚¬ìš©í•˜ëŠ” ì½”ë“œë¥¼ ê·¸ëŒ€ë¡œ ê°€ì ¸ì™”ìŠµë‹ˆë‹¤.

```powershell
function disable_defender()
{
    Write-Host "[*] Disable Windows Defender"

    try
    {
        Get-Service WinDefend | Stop-Service -Force
        Set-ItemProperty -Path "HKLM:\SYSTEM\CurrentControlSet\Services\WinDefend" -Name "Start" -Value 4 -Type DWORD -Force -ea 0 | Out-Null
    }
    catch
    {
        Write-Error "Failed disable WinDefend Service"
    }

    New-Item -Path "HKLM:\SOFTWARE\Policies\Microsoft" -Name "Windows Defender" -Force -ea 0 | Out-Null
    New-ItemProperty -Path "HKLM:\SOFTWARE\Policies\Microsoft\Windows Defender" -Name "DisableAntiSpyware" -Value 1 -PropertyType DWORD -Force -ea 0 | Out-Null
    New-ItemProperty -Path "HKLM:\SOFTWARE\Policies\Microsoft\Windows Defender" -Name "DisableRoutinelyTakingAction" -Value 1 -PropertyType DWORD -Force -ea 0 | Out-Null

    New-Item -Path "HKLM:\SOFTWARE\Policies\Microsoft\Windows Defender" -Name "Spynet" -Force -ea 0 | Out-Null
    New-ItemProperty -Path "HKLM:\SOFTWARE\Policies\Microsoft\Windows Defender\Spynet" -Name "SpyNetReporting" -Value 0 -PropertyType DWORD -Force -ea 0 | Out-Null
    New-ItemProperty -Path "HKLM:\SOFTWARE\Policies\Microsoft\Windows Defender\Spynet" -Name "SubmitSamplesConsent" -Value 0 -PropertyType DWORD -Force -ea 0 | Out-Null

    New-Item -Path "HKLM:\SOFTWARE\Policies\Microsoft" -Name "MRT" -Force -ea 0 | Out-Null
    New-ItemProperty -Path "HKLM:\SOFTWARE\Policies\Microsoft\MRT" -Name "DontReportInfectionInformation" -Value 1 -PropertyType DWORD -Force -ea 0 | Out-Null

    if(-Not ((Get-WmiObject -Class Win32_OperatingSystem).Version -eq "6.1.7601"))
    {
        Add-MpPreference -ExclusionPath "C:\" -Force -ea 0 | Out-Null
        Set-MpPreference -DisableArchiveScanning $true  -ea 0 | Out-Null
        Set-MpPreference -DisableBehaviorMonitoring $true -Force -ea 0 | Out-Null
        Set-MpPreference -DisableBlockAtFirstSeen $true -Force -ea 0 | Out-Null
        Set-MpPreference -DisableCatchupFullScan $true -Force -ea 0 | Out-Null
        Set-MpPreference -DisableCatchupQuickScan $true -Force -ea 0 | Out-Null
        Set-MpPreference -DisableIntrusionPreventionSystem $true  -Force -ea 0 | Out-Null
        Set-MpPreference -DisableIOAVProtection $true -Force -ea 0 | Out-Null
        Set-MpPreference -DisableRealtimeMonitoring $true -Force -ea 0 | Out-Null
        Set-MpPreference -DisableRemovableDriveScanning $true -Force -ea 0 | Out-Null
        Set-MpPreference -DisableRestorePoint $true -Force -ea 0 | Out-Null
        Set-MpPreference -DisableScanningMappedNetworkDrivesForFullScan $true -Force -ea 0 | Out-Null
        Set-MpPreference -DisableScanningNetworkFiles $true -Force -ea 0 | Out-Null
        Set-MpPreference -DisableScriptScanning $true -Force -ea 0 | Out-Null
        Set-MpPreference -EnableControlledFolderAccess Disabled -Force -ea 0 | Out-Null
        Set-MpPreference -EnableNetworkProtection AuditMode -Force -ea 0 | Out-Null
        Set-MpPreference -MAPSReporting Disabled -Force -ea 0 | Out-Null
        Set-MpPreference -SubmitSamplesConsent NeverSend -Force -ea 0 | Out-Null
        Set-MpPreference -PUAProtection Disabled -Force -ea 0 | Out-Null    
    }

}
```

WinDefend Serviceì˜ ê²½ìš° ì—ëŸ¬ê°€ ëœ¨ëŠ” ê²½ìš°ê°€ ë§ì•„ try-catch ì²˜ë¦¬ë¥¼ í•˜ì˜€ê³ , ë§ˆì´í¬ë¡œì†Œí”„íŠ¸ì— ë¦¬í¬íŠ¸ë¥¼ ë³´ë‚´ëŠ” ê²ƒ, ê·¸ë¦¬ê³  OS ë²„ì „ì´ 6.1.7601 (Windows 7 Service Pack 1)ì´ ì•„ë‹ ê²½ìš° (Windows 10ì¼ ê²½ìš°ì¸ ê²ƒ ê°™ìŠµë‹ˆë‹¤.) Defenderì— ì¶”ê°€ëœ ë‹¤ë¥¸ ì„¤ì •ë“¤ì„ ë¹„í™œì„±í™”í•´ì¤ë‹ˆë‹¤.

ì†ŒìŠ¤ ì½”ë“œë¥¼ ê°€ì ¸ì™€ì„œ ì½ìœ¼ë©´ì„œ ëŠë‚€ ê±´ Windows 7 Service Pack 1ë¡œ ê²€ì‚¬í•˜ëŠ” ê²Œ ì•„ë‹ˆë¼ Windows 10ê³¼ Server 2019ì— ëŒ€í•œ Defender ëª…ë ¹ì–´ì¸ ê²ƒ ê°™ì€ë° `[System.Envrionment]::OSVersion.Version.Major -eq 10`ìœ¼ë¡œ Windows 10ì¸ì§€ í™•ì¸í•˜ë©´ ë˜ì§€ ì•Šë‚˜? ì‹¶ì—ˆìŠµë‹ˆë‹¤.

ì‚¬ì‹¤ìƒ ì €ëŠ” Windows 10 ê¸°ì¤€ìœ¼ë¡œ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‘ì„±í–ˆì§€ë§Œìš”.

# ë³´ì•ˆ ìœ ì§€ ì •ì±… ì•Œë¦¼ ë¹„í™œì„±í™”

ë³´ì•ˆ ìœ ì§€ ì •ì±… ì•Œë¦¼ ì•„ì´ì½˜ ë¹„í™œì„±í™”ì…ë‹ˆë‹¤. ì´ê±´ êµ³ì´ í•„ìš” ì—†ì–´ ë³´ì´ê¸´ í•˜ì§€ë§Œ ì €ëŠ” ë¹¨ê°„ ë¶ˆì´ ë– ìˆë‹¤ê±°ë‚˜ ëŠë‚Œí‘œê°€ ë– ìˆë‹¤ê±°ë‚˜ í•˜ë©´ ì‹ ê²½ì´ êµ‰ì¥íˆ ë§ì´ ì“°ì´ëŠ” ì‚¬ëŒì´ê¸°ì—...

![](setting_malware_vm/Untitled%201.png)

```powershell
New-ItemProperty -Path "HKCU:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\Explorer" -Name "HideSCAHealth" -Value 1 -PropertyType DWORD -Force -ea 0 | Out-Null
```

ì°¾ì•„ë³´ì•˜ë”ë‹ˆ Microsoft Policiesì— [HideSCAHealth ë ˆì§€ìŠ¤íŠ¸ë¦¬](https://admx.help/?Category=Windows_10_2016&Policy=Microsoft.Policies.TaskBar2::HideSCAHealth)ì— í•´ë‹¹ ë¶€ë¶„ì„ ë¹„í™œì„±í™”í•  ìˆ˜ ìˆë‹¤ëŠ” ì‚¬ì‹¤ì„ ì•Œì•˜ìŠµë‹ˆë‹¤! ì˜¤ì˜ˆ ë°”ë¡œ ì„¤ì •í•˜ì£ ! `HKCU\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\Explorer`ì— `HideSCAHealth`ì˜ ê°’ì„ 1ë¡œ í•˜ë©´ í•´ë‹¹ í”Œë˜ê·¸ê°€ ì„¤ì •ë˜ì–´ ë³´ì•ˆ ì•Œë¦¼ ì„¤ì •ì´ ìˆ¨ê²¨ì§‘ë‹ˆë‹¤!

# ì‘ì—… ìŠ¤ì¼€ì¤„ëŸ¬ ì‚­ì œ

ì´ì œ Windowsì— ê¸°ë³¸ì ìœ¼ë¡œ ì„¤ì •ë˜ì–´ ìˆê±°ë‚˜, ë‹¤ë¥¸ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ì¶”ê°€í•˜ë©´ì„œ ë“±ë¡ëœ ë¶ˆí•„ìš”í•œ ì‘ì—… ìŠ¤ì¼€ì¤„ëŸ¬ë¥¼ ì‚­ì œí•  ì‹œê°„ì…ë‹ˆë‹¤.

![](setting_malware_vm/Untitled%202.png)

ì‘ì—… ìŠ¤ì¼€ì¤„ëŸ¬ì— í‘œì‹œëœ ì´ ë…€ì„ë“¤ì„ ì‚­ì œë¥¼ í•˜ëŠ” ê±°ì£ . ì´ ì‘ì—…ì—” ë¹„í•˜ì¸ë“œ ì—í”¼ì†Œë“œê°€ ìˆìŠµë‹ˆë‹¤. Task ë¦¬ìŠ¤íŠ¸ë¥¼ ê°€ì ¸ì™€ì„œ ëª¨ë‘ ì‚­ì œë¥¼ í•´ë²„ë¦¬ë©´ ë  ê±°ë¼ ìƒê°í–ˆì–´ìš”. ì € ë¶€ë¶„ì— ìˆëŠ” ì¹œêµ¬ë“¤ë§Œ ê°€ì ¸ì˜¨ë‹¤ê³  ìƒê°í–ˆìŠµë‹ˆë‹¤.

ê·¼ë° í…ŒìŠ¤íŠ¸ë¥¼ í•˜ëŠ”ë°... Windows ê¸°ëŠ¥ì´ ì •ìƒì ìœ¼ë¡œ ë™ì‘ ì•ˆ í•˜ëŠ” ê²Œ ìˆëŠ” ê±°ì—ìš”... ê²€ìƒ‰ì´ ì•ˆ ë˜ê³ ... ì™œ ì´ëŸ¬ì§€? ì™œ ì´ëŸ¬ì§€? ì–´ë””ê°€ ë¬¸ì œì§€? í•˜ë©´ì„œ í•¨ìˆ˜ í˜¸ì¶œì„ í•˜ë‚˜í•˜ë‚˜ ì£¼ì„ ì²˜ë¦¬í•˜ë‹¤ê°€ ë°œê²¬í–ˆìŠµë‹ˆë‹¤.

```powershell
function remove_task()
{
    $TS = New-Object -ComObject Schedule.Service
    $TS.Connect($env:COMPUTERNAME)
    $TaskFolder = $TS.GetFolder('\')
    $Tasks = $TaskFolder.GetTasks(1)

    foreach($Task in $Tasks)
    {
        $TaskFolder.DeleteTask($Task.Name, 0)
    }

}
```

remove taskëŠ” ComObjectë¥¼ í†µí•´ Schedule.Serviceì—ì„œ Task ë¦¬ìŠ¤íŠ¸ë¥¼ ê°€ì ¸ì™€ì„œ ì‚­ì œë¥¼ í•´ì¤ë‹ˆë‹¤. ì‹œìŠ¤í…œ ìŠ¤ì¼€ì¤„ê¹Œì§€ ëª¨ë‘ ì‚­ì œí•´ë²„ë ¤ì„œ ë°œìƒí•œ í•´í”„ë‹ì´ì—ˆìŠµë‹ˆë‹¤. ã…œ.ã…œ

# ì‹œì‘ í”„ë¡œê·¸ë¨ ì‚­ì œ

ì•…ì„±ì½”ë“œë¥¼ ì‹¤í–‰í•˜ê³ , ì–´ë–¤ ê²ƒë“¤ì´ autorun ë˜ëŠ”ì§€ í™•ì¸í•  ë•Œ ì—¬ëŸ¬ ì¡ë‹¤í•œ í”„ë¡œê·¸ë¨ë“¤ì´ ì‹¤í–‰ë˜ë©´ ë³´ê¸° í˜ë“¤ê² ì£ ? ê·¸ë˜ì„œ ì´ê²ƒ ë˜í•œ ì§€ì›Œë²„ë¦½ì‹œë‹¤!

```powershell
function disable_startup()
{
    $user = New-Object System.Security.Principal.NTAccount($env:username)
    $sid = ($user.Translate([System.Security.Principal.SecurityIdentifier])).Value

    Remove-Item -Path "HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Run\*" -Recurse
    Remove-Item -Path "Registry::HKEY_USERS\S-1-5-19\SOFTWARE\Microsoft\Windows\CurrentVersion\Run\*" -Recurse
    Remove-Item -Path "Registry::HKEY_USERS\S-1-5-20\SOFTWARE\Microsoft\Windows\CurrentVersion\Run\*" -Recurse
    Remove-Item -Path "Registry::HKEY_USERS\$sid\SOFTWARE\Microsoft\Windows\CurrentVersion\Run\*" -Recurse
}
```

íŠ¹ì • ì‚¬ìš©ìì— í•œí•´ ë“±ë¡ëœ ì‹œì‘ í”„ë¡œê·¸ë¨ì€ ê·¸ ì‚¬ìš©ìì˜ SID ê²½ë¡œë¥¼ í†µí•´ ì €ì¥ì´ ë©ë‹ˆë‹¤. ë”°ë¼ì„œ ì‚¬ìš©ìì— ë”°ë¥¸ SID ê°’ì„ ê°€ì ¸ì™€ì„œ ì‚­ì œë¥¼ í•´ì£¼ëŠ” ê±°ì£ ! ì¼ë‹¨ì€... ì €ë ‡ê²Œ ì§€ì •ì„ í–ˆëŠ”ë° ì•ˆ ì§€ì›Œì§€ëŠ” ê²ƒë“¤ì´ ìˆë”ë¼êµ¬ìš”...??? ì´ìœ ë¥¼... ëª» ì°¾ê² ì–´ì„œ ë‚¨ì•„ìˆëŠ” ê±°ëŠ” ì†ìœ¼ë¡œ ì§€ì› ìŠµë‹ˆë‹¤.

![](setting_malware_vm/Untitled%203.png)

ìµœì¢…ë³¸ì„ ê°€ì ¸ì˜¬ ë•ŒëŠ” ê¼­ ìˆ˜ì •í•´ì„œ ê°€ì ¸ì˜¬ê²Œìš”! ì´ë²ˆë§Œ ë„ˆê·¸ëŸ¬ì´ ë´ì£¼ì‹œë©´...

# ìˆ¨ê¹€ íŒŒì¼ í‘œì‹œ

ì´ì œ ìˆ¨ê¹€ íŒŒì¼ê³¼ ì‹œìŠ¤í…œ ìˆ¨ê¹€ íŒŒì¼ë“¤ì„ í‘œì‹œí•´ë´…ì‹œë‹¤. ì„¤ì¹˜í•˜ê³  ìˆ¨ê¹€ íŒŒì¼ì„ ì²´í¬í•˜ê³  í•˜ëŠ” ê²ƒ ë˜í•œ ë ˆì§€ìŠ¤íŠ¸ë¦¬ë¥¼ í†µí•´ì„œ ì‘ì—…í•  ìˆ˜ ìˆì–´ìš”. WindowsëŠ” ë ˆì§€ìŠ¤íŠ¸ë¦¬ë¥¼ í†µí•´ì„œ ì´ê²ƒì €ê²ƒ ì„¤ì •í•˜ë‹ˆê¹Œìš”.

```powershell
New-ItemProperty -Path "HKCU:\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\Advanced" -Name "Hidden" -Value 1 -PropertyType DWORD -Force -ea 0 | Out-Null
New-ItemProperty -Path "HKCU:\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\Advanced" -Name "ShowSuperHidden" -Value 1 -PropertyType DWORD -Force -ea 0 | Out-Null
```

`Hidden`ê³¼ `ShowSuperHidden`ì˜ ê°’ì„ 1ë¡œ ì„¤ì •í•´ì£¼ë©´ ëì…ë‹ˆë‹¤! ì´ì œ ê¸°ë³¸ì ì¸ ì„¤ì •ì€ ì™„ë£Œë˜ì—ˆì–´ìš”.

# ë§ˆì¹˜ë©°

ê°„ë‹¨í•œ Windows ì„¤ì •ì„ ìŠ¤í¬ë¦½íŠ¸ë¡œ ì‘ì„±í•´ë³´ì•˜ìŠµë‹ˆë‹¤. ì†ìœ¼ë¡œ í•´ë„ ì–¼ë§ˆ ì•ˆ ê±¸ë¦¬ì§€ë§Œ, ê°€ë” ëª‡ ê°œ ê¹Œë¨¹ì„ ë•Œë„ ìˆê³  ê·€ì°®ì–ì•„ìš”? ìŠ¤í¬ë¦½íŠ¸ë¡œ ì‘ì„±í•˜ë©´ ì‹¤í–‰ë§Œ í•˜ë©´ ì´ ëª¨ë“  ê²ƒë“¤ì„ ~~ë¬´ë£Œ!~~ ê¹Œë¨¹ì€ ê±° ì—†ì´ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ë‹¤ìŒ íŒŒíŠ¸ì—ì„œ chocolateyë¥¼ í†µí•´ì„œ ì—¬ëŸ¬ ê°€ì§€ íˆ´ë“¤ì„ ì„¤ì¹˜í•˜ê³  ê°œì¸ì˜ ì…ë§›ì— ë§ê²Œ ì‘ì—… í‘œì‹œì¤„ì— ì¶”ê°€, ë°”íƒ•í™”ë©´ ë°”ë¡œê°€ê¸° ë§Œë“¤ê¸° ë“±ì— ëŒ€í•´ì„œ ì•Œì•„ë´…ì‹œë‹¤. ë‹¤ìŒ íŒŒíŠ¸ê°€ ëª¨ë‘ ì§„í–‰ë˜ê³  ë‚˜ë©´ ì „ì²´ ì†ŒìŠ¤ ì½”ë“œë¥¼ githubì— ì˜¬ë ¤ì„œ ë§í¬ë¥¼ ê±¸ì–´ë“œë¦¬ê² ìŠµë‹ˆë‹¤! ë§ˆì§€ë§‰ìœ¼ë¡œ í•´ë‹¹ ê¸°ëŠ¥ë“¤ì„ êµ¬í˜„í•  ë•Œ ì°¸ê³  ë§í¬ë“¤ì„ ì‘ì„±í•˜ë©° ì´ë§Œ ë¬¼ëŸ¬ê°€ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤. ê·¸ëŸ¼ ì•ˆë‡½~

# Reference

disableÂ securityÂ maintenanceÂ icon: [https://admx.help/?Category=Windows_10_2016&Policy=Microsoft.Policies.TaskBar2::HideSCAHealth](https://admx.help/?Category=Windows_10_2016&Policy=Microsoft.Policies.TaskBar2::HideSCAHealth)

show hidden files: [https://www.python2.net/questions-1237399.htm](https://www.python2.net/questions-1237399.htm)

remove app list: [https://community.spiceworks.com/topic/2230169-powershell-script-to-remove-xbox-gamebar-from-the-app-list](https://community.spiceworks.com/topic/2230169-powershell-script-to-remove-xbox-gamebar-from-the-app-list)

disable windows defender: [https://github.com/fireeye/flare-vm/blob/master/install.ps1](https://github.com/fireeye/flare-vm/blob/master/install.ps1)

disable windows update: [https://social.technet.microsoft.com/Forums/lync/en-US/abde2699-0d5a-49ad-bfda-e87d903dd865/disable-windows-update-via-powershell?forum=winserverpowershell](https://social.technet.microsoft.com/Forums/lync/en-US/abde2699-0d5a-49ad-bfda-e87d903dd865/disable-windows-update-via-powershell?forum=winserverpowershell)

get specific sid: [https://techexpert.tips/powershell/powershell-get-user-sid/](https://techexpert.tips/powershell/powershell-get-user-sid/)

remove all registry key under specific key: [https://docs.microsoft.com/ko-kr/powershell/scripting/samples/working-with-registry-keys?view=powershell-7.1#removing-all-keys-under-a-specific-key](https://docs.microsoft.com/ko-kr/powershell/scripting/samples/working-with-registry-keys?view=powershell-7.1#removing-all-keys-under-a-specific-key)

remove task: [https://community.spiceworks.com/how_to/159324-delete-scheduled-task-with-powershell](https://community.spiceworks.com/how_to/159324-delete-scheduled-task-with-powershell)